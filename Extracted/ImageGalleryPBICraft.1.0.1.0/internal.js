var ImageGalleryPBICraft;(()=>{"use strict";var e={406:(e,t,a)=>{a.d(t,{A:()=>i});const i='\n<div class="gallery" id="gallery">\n  \x3c!-- Динамически добавляемые изображения --\x3e\n  <div id="upload-btn-wrapper">\n    <button id="upload-btn">Upload images</button>\n    <input type="file" id="image-upload" accept="image/png, image/jpeg" multiple />\n  </div>\n\n  <span class="last-element"></span>\n</div>\n\n<div id="lightbox" class="lightbox">\n  <span class="close">&times;</span>\n  <a class="prev">&#10094;</a>\n  <img class="lightbox-image" src="">\n  <a class="next" >&#10095;</a>\n</div>\n    '},652:(e,t,a)=>{a.d(t,{a:()=>i});class i{imageGallery;lightbox;images=[];currentImageIndex=-1;onSaveImages;constructor(e,t){this.imageGallery=e,this.lightbox=t;const a=document.getElementById("image-upload");a.addEventListener("change",this.handleImageUpload.bind(this)),document.getElementById("upload-btn").addEventListener("click",(function(){a.click()})),this.lightbox.onChangeImage=this.onChangeImage.bind(this),this.lightbox.onCloseImage=this.onCloseImage.bind(this),this.imageGallery.onOpenImage=this.onOpenImage.bind(this),this.imageGallery.onRemoveImage=this.onRemoveImage.bind(this)}onChangeImage(e){this.currentImageIndex+=e,this.currentImageIndex>=this.images.length?this.currentImageIndex=0:this.currentImageIndex<0&&(this.currentImageIndex=this.images.length-1),this.lightbox.toggleLightbox(!0,this.images[this.currentImageIndex]),this.saveImages()}onCloseImage(){this.currentImageIndex=-1,this.lightbox.toggleLightbox(!1),this.saveImages()}onOpenImage(e){this.currentImageIndex=this.images.indexOf(e),this.lightbox.toggleLightbox(!0,e),this.saveImages()}onRemoveImage(e){this.images=this.images.filter((t=>t!==e)),this.saveImages()}handleImageUpload(e){const t=e.target.files;for(let e=0;e<t.length;e++){const a=t[e],i=new FileReader;i.onload=e=>{const t=e.target?.result;this.imageGallery.add(t),this.images.push(t),this.saveImages()},i.readAsDataURL(a)}}loadImages(e,t){try{this.images=JSON.parse(e),this.currentImageIndex=t,this.imageGallery.clear();for(const e of this.images)this.imageGallery.add(e);-1!==this.currentImageIndex&&this.lightbox.toggleLightbox(!0,this.images[this.currentImageIndex])}catch(e){console.error("Error loading images",e)}}saveImages(){const e=JSON.stringify(this.images);void 0!==this.onSaveImages&&this.onSaveImages(e,this.currentImageIndex)}toggleEditMode(e){document.getElementById("upload-btn-wrapper").style.display=e?"flex":"none",this.imageGallery.toggleEditMode(e)}}},791:(e,t,a)=>{a.d(t,{i:()=>i});class i{galleryContainer;onOpenImage;onRemoveImage;constructor(){this.galleryContainer=document.querySelector(".gallery")}removeImage(e){void 0!==this.onRemoveImage&&(this.onRemoveImage(e.src),e.closest(".image-container").remove())}openImage(e){void 0!==this.onOpenImage&&this.onOpenImage(e.src)}clear(){this.galleryContainer.querySelectorAll(".image-container").forEach((e=>{e.remove()}))}add(e){const t=document.createElement("img");t.addEventListener("click",this.openImage.bind(this,t)),t.src=e;const a=document.createElement("span");a.classList.add("remove-btn"),a.innerHTML="&times;",a.addEventListener("click",this.removeImage.bind(this,t));const i=document.createElement("div");i.classList.add("image-container");const s=document.createElement("div");s.classList.add("float-container"),s.appendChild(t),s.appendChild(a),i.appendChild(s),this.galleryContainer.insertBefore(i,document.querySelector(".last-element"))}toggleEditMode(e){document.querySelectorAll(".remove-btn").forEach((t=>{t.style.display=e?"block":"none"}))}}},172:(e,t,a)=>{a.d(t,{Y:()=>i});class i{lightbox;onChangeImage;onCloseImage;constructor(){this.lightbox=document.getElementById("lightbox"),this.lightbox.querySelector(".prev")?.addEventListener("click",(()=>this.changeImage(-1))),this.lightbox.querySelector(".next")?.addEventListener("click",(()=>this.changeImage(1))),this.lightbox.querySelector(".close")?.addEventListener("click",(()=>this.closeImage())),document.addEventListener("keydown",(e=>{if("none"!==this.lightbox.style.display)switch(e.key){case"ArrowLeft":this.changeImage(-1);break;case"ArrowRight":this.changeImage(1);break;case"Escape":this.closeImage()}}))}closeImage(){void 0!==this.onCloseImage&&this.onCloseImage()}toggleLightbox(e,t=""){document.querySelector(".lightbox-image").src=t,this.lightbox.style.display=e?"flex":"none"}changeImage(e){void 0!==this.onChangeImage&&this.onChangeImage(e)}}},789:(e,t,a)=>{a.d(t,{b:()=>r});var i,s=a(406),n=a(172),o=a(791),l=a(652);!function(e){e.Show="Show",e.ShowWithNotification="ShowWithNotification",e.Block="Block",e.BlockUnsupportedEnv="BlockUnsupportedEnv"}(i||(i={}));class r{target;formattingSettings=null;selectionManager;host;lastData="";lastModified=0;lightbox;imageGallery;fileManager;isEditMode=!1;constructor(e){this.target=e.element,this.host=e.host,e.element.innerHTML=s.A,this.selectionManager=this.host.createSelectionManager(),this.handleContextMenu(),this.imageGallery=new o.i,this.lightbox=new n.Y,this.fileManager=new l.a(this.imageGallery,this.lightbox),this.fileManager.onSaveImages=this.onSaveImages.bind(this),this.host.licenseManager.notifyLicenseRequired(0)}onSaveImages(e,t){if(!0!==this.isEditMode)return;const a=Date.now();this.lastData!=e?(this.host.persistProperties({merge:[{objectName:"storage",properties:{images:e,imageIndex:t,modified:a},selector:null}]}),this.lastData=e,this.lastModified=a):this.host.persistProperties({merge:[{objectName:"storage",properties:{imageIndex:t,modified:a},selector:null}]})}handleContextMenu(){this.target.addEventListener("contextmenu",(e=>{this.selectionManager.showContextMenu({},{x:e.clientX,y:e.clientY}),e.preventDefault()}))}update(e){if(this.host.eventService.renderingStarted(e),this.isEditMode=1===e.viewMode,this.fileManager.toggleEditMode(this.isEditMode),e?.dataViews?.length&&e.dataViews[0].metadata?.objects?.storage?.images){const t=e.dataViews[0].metadata?.objects?.storage?.images,a=e.dataViews[0].metadata?.objects?.storage?.imageIndex||-1,i=e.dataViews[0].metadata?.objects?.storage?.modified||0;t!==this.lastData&&i>=this.lastModified&&(this.fileManager.loadImages(t,a),this.lastData=t)}this.host.eventService.renderingFinished(e)}getFormattingModel(){if(!this.formattingSettings)return null}}}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{a.r(i),a.d(i,{default:()=>n});var e=a(789),t=window.powerbi,s={name:"ImageGalleryPBICraft",displayName:"Image Gallery",class:"Visual",apiVersion:"5.4.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,a)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,a)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.ImageGalleryPBICraft=s);const n=s})(),ImageGalleryPBICraft=i})();