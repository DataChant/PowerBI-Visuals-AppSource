var k4217CE0FC919C43CF9FD4AE5EBD64655F;(()=>{"use strict";var e={346:(e,t,i)=>{i.d(t,{b:()=>r});var s=i(674),n=i(539),a=i(789);class r{id;rendering=!1;initialized=!1;acquireAADTokenService;formattingSettingsService;host;storageV2Service;downloadService;root;communication;updateQueue=[];currentProperties=void 0;currentApiKey=void 0;currentEntraIdEnabled=void 0;currentEntraIdAccessToken=void 0;currentOnBehalfOfToken=void 0;currentOnBehalfOfUsername=void 0;currentFormattingSettings;currentTokenStatus=void 0;currentOptions=void 0;currentEmbedConfiguration=void 0;constructor(e){if(!e)throw new Error("options is undefined");this.id=`pbi.${e.host.instanceId}`,this.host=e.host,this.acquireAADTokenService=e.host.acquireAADTokenService,this.formattingSettingsService=new s.O,this.storageV2Service=e.host.storageV2Service,this.downloadService=e.host.downloadService,this.root=e.element,this.communication=new a.X(this.id,this),window.addEventListener("unload",()=>{this.communication.stop()})}update=e=>{this.updateQueue.push(e),this.processNextUpdate()};processNextUpdate=async()=>{if(!this.rendering){this.rendering=!0;try{for(;this.updateQueue.length>0;){const e=this.updateQueue.shift();e&&(this.currentOptions=e,this.currentFormattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(n.S,e.dataViews[0]),await this.render())}}finally{this.rendering=!1}}};render=async()=>{if(this.currentFormattingSettings&&this.currentOptions)try{let e=!1;const t=this.currentFormattingSettings.k4.settings.entraIdSSO.value;e=t!==this.currentEntraIdEnabled,e&&(this.currentEntraIdEnabled=t,this.currentTokenStatus=void 0,t&&(this.initialized=!1));const i=this.k4_getDatasets(this.currentOptions.dataViews[0]),s=this.k4_getFilters(i);let n,a="";if(""!==this.currentFormattingSettings.k4.settings.server.value&&(n=this.currentFormattingSettings.k4.settings.server.value,n.endsWith("/")&&(n=n.slice(0,-1))),this.currentEntraIdEnabled)a=this.currentOnBehalfOfUsername??"";else if(""!==this.currentFormattingSettings.k4.settings.k4user.value)a=this.currentFormattingSettings.k4.settings.k4user.value;else for(const e in s)if("k4user"===e.toLowerCase()){a=s[e];break}let r,o,l="";this.currentEntraIdEnabled?(this.currentApiKey||(this.currentApiKey=""),l=this.currentApiKey):""!==this.currentFormattingSettings.k4.settings.apiKey.value&&(l=this.currentFormattingSettings.k4.settings.apiKey.value),""!==this.currentFormattingSettings.k4.properties.loadMessage.value&&(r=this.currentFormattingSettings.k4.properties.loadMessage.value),""!==this.currentFormattingSettings.k4.properties.dynamicRows.value&&(o=this.currentFormattingSettings.k4.properties.dynamicRows.value);const c={modelName:this.currentFormattingSettings.k4.settings.model.value,publicUri:n??"",hostName:"MSPOWERBI",license:"Power BI",authenticationType:this.currentEntraIdEnabled?"Bearer":"Basic",username:a,editMode:1===this.currentOptions.viewMode,debug:Boolean(this.host.sandboxExtended),datasets:i,filters:s,hidden:"off"===this.currentFormattingSettings.k4.properties.showCondition.value,loadMessage:r,dynamicRows:o};if(!this.currentProperties||this.currentProperties.publicUri!==c.publicUri||this.currentProperties.username!==c.username||this.currentApiKey!==l||e){const e=document.getElementById(this.id);if(e&&(this.communication.stop(),e.remove()),!n||""===n)return;const t=`${n}/embed.html?embedId=${this.id}`;let i;try{if(i=await fetch(t,{method:"GET",cache:"no-store"}),!i.ok)return void console.error(`Failed to load ${t}: ${String(i.status)} ${i.statusText}`);if(!(await i.text()).includes("<title>K4 Analytics - Embed</title>"))return void console.error("Invalid embed URL")}catch(e){return void(e instanceof Error&&console.error(`Failed to load ${t}: ${e.message}`))}const s=document.createElement("iframe");if(s.id=this.id,s.src=t,s.style.width="100%",s.style.height="100%",s.style.border="none",this.root.appendChild(s),this.currentEmbedConfiguration=await this.communication.start(),!this.initialized)try{await this.initializeTokenService(),this.currentEntraIdEnabled&&(c.username=this.currentOnBehalfOfUsername??"")}finally{this.initialized=!0}}else if(JSON.stringify(this.currentProperties)===JSON.stringify(c))return;this.currentProperties=c,this.currentApiKey=l,this.communication.setCurrentConfig(this.currentProperties)}catch(e){throw console.error(e),e}};initializeTokenService=async()=>{if(this.currentTokenStatus=void 0,this.currentEntraIdAccessToken=void 0,this.currentOnBehalfOfToken=void 0,this.currentOnBehalfOfUsername=void 0,this.currentEntraIdEnabled)try{const e=await this.acquireAADTokenService.acquireAADTokenstatus();if(this.currentTokenStatus=e,0!==this.currentTokenStatus){let e="";switch(this.currentTokenStatus){case 1:e="Token acquisition not declared in capabilities";break;case 2:e="Token acquisition not supported in this host";break;case 3:e="Token acquisition disabled by admin";break;default:e="Token acquisition not allowed"}return void console.log(e)}const t=await this.acquireAADTokenService.acquireAADToken();if(!t.accessToken)throw new Error("Could not acquire token from power bi.");this.currentEntraIdAccessToken=t.accessToken;const i=await this.fetchOnBehalfOf(t.accessToken,this.currentEmbedConfiguration?.publicUri);this.currentOnBehalfOfToken=i;const{preferred_username:s,upn:n}=this.extractTokenClaims(this.currentEntraIdAccessToken);this.currentOnBehalfOfUsername=s??n}catch(e){console.error("Error initializing token service",e),this.currentTokenStatus=2}};k4_getDatasets=e=>{if(!this.currentFormattingSettings)throw new Error("currentVisualSettings is undefined");const t=[],i=[];try{for(const s of e.categorical?.categories??[])i.push(s.values),t.push(s.source.displayName);for(const s of e.categorical?.values??[])t.push(`v|${s.source.displayName}`),i.push(s.values);const s=this.k4_transpose(i);s.unshift(t);const n={[this.currentFormattingSettings.k4.datasets.mainDatasetName.value]:s};if(""!==this.currentFormattingSettings.k4.datasets.otherDatasets1.value){const[e,t]=this.k4_getOtherDataset(this.currentFormattingSettings.k4.datasets.otherDatasets1.value);e&&(n[e]=t)}if(""!==this.currentFormattingSettings.k4.datasets.otherDatasets2.value){const[e,t]=this.k4_getOtherDataset(this.currentFormattingSettings.k4.datasets.otherDatasets2.value);e&&(n[e]=t)}return n}catch{return{}}};k4_getOtherDataset=e=>{try{const t=e.split(/\r?\n/);if(t.length<3)return[void 0,[]];const i=[];let s=t[1].replaceAll("|","###");s=s.replace("m:","v|"),i.push(s.split("###"));for(let e=2;e<t.length;e++)i.push(t[e].split("|"));return[t[0],i]}catch(e){return console.log("error in k4_getOtherDataset",e),[void 0,[]]}};k4_getFilters=e=>{if(!this.currentFormattingSettings)throw new Error("currentVisualSettings is undefined");const t={},i={};if(""!==this.currentFormattingSettings.k4.properties.context.value)try{const e=this.currentFormattingSettings.k4.properties.context.value.split(";");for(const i of e){const e=i.split(":")[0],s=i.split(":")[1];e in t||(t[e]=[]);for(const i of s.split(",").map(e=>e.trim()))t[e].includes(i)||t[e].push(i)}}catch{}const s=[];if(this.currentEntraIdEnabled||s.push("k4user"),""!==this.currentFormattingSettings.k4.properties.selection.value&&s.push(...this.currentFormattingSettings.k4.properties.selection.value.split(",")),s.length>0){let n="";for(const e of s)e.includes(":")?(i[e.split(":")[0]]=e.split(":")[1],n+=`,${e.split(":")[0]}`):(i[e]=e,n+=`,${e}`);n+=",";const a=e[this.currentFormattingSettings.k4.datasets.mainDatasetName.value];try{for(let e=1;e<a.length;e++)for(let s=0;s<a[0].length;s++){let r=a[0][s];if("string"!=typeof r)continue;r.startsWith("v|")&&(r=r.substring(2));const o=i[r];n.includes(`,${r},`)&&(o in t||(t[o]=[]),`,${t[o].join(",")},`.includes(`,${String(a[e][s])},`)||t[o].push(String(a[e][s])))}}catch{}}const n={};for(const e in t){const i=t[e].filter(e=>0!==e.trim().length).join(",");0!==i.length&&(n[e]=i)}return n};k4_transpose=e=>{const t=e.length;if(0===t)return[];const i=e[0].length,s=[];for(let e=0;e<i;e++)s[e]=Array(t);for(let n=0;n<t;n++)for(let t=0;t<i;t++){let i=e[n][t];isNaN(Number(i))&&(i=String(i).replaceAll("&","n")),s[t][n]=String(i)}return s};getFormattingModel=()=>{if(void 0===this.currentFormattingSettings)throw new Error("currentVisualSettings is undefined");return this.currentFormattingSettings.k4.settings.apiKey.visible=!this.currentFormattingSettings.k4.settings.entraIdSSO.value,this.currentFormattingSettings.k4.settings.k4user.visible=!this.currentFormattingSettings.k4.settings.entraIdSSO.value,this.formattingSettingsService.buildFormattingModel(this.currentFormattingSettings)};getAccessToken=async()=>{if(!this.currentEntraIdEnabled)return{type:"Basic",token:btoa(`${this.currentProperties?.username??""}:${this.currentApiKey??""}`)};if(0!==this.currentTokenStatus)switch(this.currentTokenStatus){case 1:return{type:"Bearer",token:"<NotDeclared>"};case 2:return{type:"Bearer",token:"<NotSupported>"};case 3:return{type:"Bearer",token:"<DisabledByAdmin>"}}const e=await this.acquireAADTokenService.acquireAADToken();if(!e.accessToken)throw this.currentEntraIdAccessToken=void 0,new Error("Could not acquire token from power bi.");if(this.currentEntraIdAccessToken===e.accessToken&&this.currentOnBehalfOfToken&&this.isTokenValid(this.currentOnBehalfOfToken))return{type:"Bearer",token:this.currentOnBehalfOfToken};this.currentEntraIdAccessToken=e.accessToken;const t=await this.fetchOnBehalfOf(e.accessToken,this.currentEmbedConfiguration?.publicUri);return this.currentOnBehalfOfToken=t,{type:"Bearer",token:this.currentOnBehalfOfToken}};async fetchOnBehalfOf(e,t){if(!t)throw new Error("onBehalfOfUri is undefined.");const i=new Headers,s=`Bearer ${String(e)}`;i.append("Authorization",s);const n={method:"GET",headers:i},a=await fetch(`${String(t)}/obotoken`,n);if(!a.ok)throw new Error(`Failed to acquire token on behalf of: ${String(t)} ${String(a.status)} ${a.statusText}.`);const r=await a.json();if(!r.accessToken)throw new Error("On behalf of does not contain accessToken.");return r.accessToken}extractTokenClaims=e=>{const t=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(e);if(!t||t.length<4)throw new Error("invalidToken");let i=t[2].replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw new Error("invalidBase64String")}const s=atob(i),n=Uint8Array.from(s,e=>e.codePointAt(0)||0),a=(new TextDecoder).decode(n);return JSON.parse(a)};isTokenValid=e=>{if(!e)return!1;try{const t=this.extractTokenClaims(e),i=Math.floor(Date.now()/1e3);return!(t.nbf>i||t.exp<i+60)}catch{return!1}};getProperties=()=>{if(!this.currentProperties)throw new Error("invalid configuration");return this.currentProperties};getLocalStorageValue=async e=>0!==await this.storageV2Service.status()?null:await this.storageV2Service.get(e);setLocalStorageValue=async(e,t)=>{0===await this.storageV2Service.status()&&await this.storageV2Service.set(e,t)};clearLocalStorageValue=async e=>{0===await this.storageV2Service.status()&&this.storageV2Service.remove(e)};setModelName=e=>this.currentFormattingSettings?(this.host.persistProperties({merge:[{objectName:"k4object",selector:null,properties:{k4objid:e}}]}),Promise.resolve()):Promise.resolve();downloadFile=async(e,t)=>{const i=await e.arrayBuffer(),s=new Uint8Array(i);let n="";for(let e=0;e<s.length;e+=32768){const t=s.subarray(e,e+32768);n+=String.fromCharCode(...t)}const a=btoa(n);await this.downloadService.exportVisualsContentExtended(a,t,"base64",e.type)};checkDownloadFileStatus=async()=>{const e=await this.downloadService.exportStatus();if(0!==e){let t="";switch(e){case 1:t="Download service not declared in capabilities";break;case 2:t="Download service not supported in this host";break;case 3:t="Download service disabled by admin";break;default:t="Download service not allowed"}return console.log(t),"disabled"}return"custom"}}},539:(e,t,i)=>{i.d(t,{S:()=>n});var s=i(674);class n extends s.z.Kx{k4=new a;cards=[this.k4]}class a extends s.z.St{name="k4object";displayName="K4";settings=new r;properties=new o;datasets=new l;groups=[this.settings,this.properties,this.datasets]}class r extends s.z.Tn{displayName="Settings";name="k4settings";server=new s.z.ks({name:"k4server",displayName:"Server",placeholder:"",value:"",instanceKind:3});model=new s.z.ks({name:"k4objid",displayName:"Model ID",placeholder:"",value:"",instanceKind:3});apiKey=new s.z.ks({name:"k4apikey",displayName:"API Key",placeholder:"",value:"",instanceKind:3});k4user=new s.z.ks({name:"k4user",displayName:"User",placeholder:"",value:"",instanceKind:3});entraIdSSO=new s.z.jF({name:"k4entraidsso",displayName:"ID",value:!1});slices=[this.server,this.model,this.apiKey,this.k4user,this.entraIdSSO]}class o extends s.z.Tn{displayName="Properties";name="k4properties";selection=new s.z.ks({name:"k4filters",displayName:"Dims,Measures as filters",placeholder:"",value:"",instanceKind:3});context=new s.z.ks({name:"k4context",displayName:"Context",placeholder:"",value:"",instanceKind:3});dynamicRows=new s.z.ks({name:"k4dynamicrows",displayName:"Dynamic Rows",placeholder:"",value:"",instanceKind:3});loadMessage=new s.z.ks({name:"k4loadmessage",displayName:"Load Message",placeholder:"",value:"",instanceKind:3});showCondition=new s.z.ks({name:"k4showcondition",displayName:"Show condition",placeholder:"",value:"",instanceKind:3});slices=[this.selection,this.context,this.dynamicRows,this.loadMessage,this.showCondition]}class l extends s.z.Tn{displayName="Datasets";name="k4datasets";mainDatasetName=new s.z.ks({name:"k4dataset",displayName:"Main Dataset Name",placeholder:"",value:"HOST",instanceKind:3});otherDatasets1=new s.z.ks({name:"k4dataset2",displayName:"Other Dataset 1",placeholder:"",value:"",instanceKind:3});otherDatasets2=new s.z.ks({name:"k4dataset3",displayName:"Other Dataset 2",placeholder:"",value:"",instanceKind:3});slices=[this.mainDatasetName,this.otherDatasets1,this.otherDatasets2]}},639:(e,t,i)=>{function s(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function n(e,t,i){return null==t||"object"==typeof t&&!t.solid?i:t.solid?{value:null==t?void 0:t.solid.color}:"Dropdown"===(null==e?void 0:e.type)&&e.items?e.items.find(e=>e.value==t):t}i.d(t,{D:()=>n,y:()=>s})},667:(e,t,i)=>{i.d(t,{A:()=>n});var s=i(754);const n=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var i,n;const a=new e,r=null===(i=null==t?void 0:t.metadata)||void 0===i?void 0:i.objects;return r&&(null===(n=a.cards)||void 0===n||n.forEach(e=>{var t;e instanceof s.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(r,e.name)),(e instanceof s.Tn?[e]:e.groups).forEach(t=>{var i,s,n,a;null===(i=t.topLevelSlice)||void 0===i||i.setPropertiesValues(r,e.name),null===(s=null==t?void 0:t.slices)||void 0===s||s.forEach(t=>{null==t||t.setPropertiesValues(r,e.name)}),null===(a=null===(n=null==t?void 0:t.container)||void 0===n?void 0:n.containerItems)||void 0===a||a.forEach(t=>{var i;null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach(t=>{null==t||t.setPropertiesValues(r,e.name)})})})})),a}buildFormattingModel(e){const t={cards:[]};return e.cards.filter(({visible:e=!0})=>e).forEach(e=>{var i;const n={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane},a=e.name;if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(a,this.localizationManager);t.suppressDisplayName=!0,n.topLevelToggle=t}null===(i=e.onPreProcess)||void 0===i||i.call(e);const r=e instanceof s.Tn;(r?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(e=>{const t=e.name+"-group",i={displayName:r?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:r?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};n.groups.push(i);const s={};if(e.container){const n=e.container,r=t+"-container",o={displayName:this.localizationManager&&n.displayNameKey?this.localizationManager.getDisplayName(n.displayNameKey):n.displayName,description:this.localizationManager&&n.descriptionKey?this.localizationManager.getDisplayName(n.descriptionKey):n.description,containerItems:[],uid:r};n.containerItems.forEach(e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,i=r+t,n={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:i};this.buildFormattingSlices({slices:e.slices,objectName:a,sliceNames:s,formattingSlices:n.slices}),o.containerItems.push(n)}),i.container=o}if(e.slices){if(e.topLevelSlice){const t=e.topLevelSlice.getFormattingSlice(a,this.localizationManager);t.suppressDisplayName=!0,(null==i.displayName?n:i).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:a,sliceNames:s,formattingSlices:i.slices})}}),n.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(n)}),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:i,formattingSlices:s}){null==e||e.filter(({visible:e=!0})=>e).forEach(e=>{const n=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);n&&(void 0===i[e.name]?i[e.name]=0:(i[e.name]++,n.uid=`${n.uid}-${i[e.name]}`),s.push(n))})}getRevertToDefaultDescriptor(e){var t;const i={},n=[];let a,r=[];return e instanceof s.St&&e.topLevelSlice&&n.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof s.Tn?[e].filter(({visible:e=!0})=>e):e.groups.filter(({visible:e=!0})=>e)).forEach(t=>{var s,o;a=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i,t.topLevelSlice),null===(o=null===(s=t.container)||void 0===s?void 0:s.containerItems)||void 0===o||o.forEach(t=>{r=r.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,i))}),n.push(...a.concat(r))}),n}getSlicesRevertToDefaultDescriptor(e,t,i,s){let n=[];return s&&(i[s.name]=!0,n=n.concat(s.getRevertToDefaultDescriptor(e))),null==t||t.forEach(t=>{t&&!i[t.name]&&(i[t.name]=!0,n=n.concat(t.getRevertToDefaultDescriptor(e)))}),n}}},674:(e,t,i)=>{i.d(t,{O:()=>n.A,z:()=>s});var s=i(754),n=i(667)},754:(e,t,i)=>{i.d(t,{Kx:()=>r,St:()=>o,Tn:()=>l,jF:()=>u,ks:()=>d});var s=i(639);class n{}class a extends n{}class r{}class o extends n{}class l extends a{}class c extends n{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const i=this.type,s=this.name,n={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+s};return Object.assign(Object.assign({},n),{control:{type:i,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:s.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var i;const n=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i[this.name];this.value=s.D(this,n,this.value)}}class u extends c{constructor(e){super(e),this.type="ToggleSwitch"}}class d extends c{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}},789:(e,t,i)=>{i.d(t,{X:()=>a});var s=Object.defineProperty,n=(e,t,i)=>((e,t,i)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class a{constructor(e,t){n(this,"currentInitializationCompletionSource"),n(this,"start",()=>new Promise(e=>{this.currentInitializationCompletionSource=e,window.addEventListener("message",this.listener)})),n(this,"setCurrentConfig",e=>{this.notify({source:"k4.host",type:"propsUpdate",content:e})}),n(this,"stop",()=>{window.removeEventListener("message",this.listener)}),n(this,"listener",e=>{if(e.data.source!==`k4.embed.${this.id}`)return;const t=e.data;switch(t.type){case"initialized":if(!this.currentInitializationCompletionSource)throw new Error("No initialization in progress");this.currentInitializationCompletionSource(t.config),this.notify({uuid:t.uuid,source:"k4.host",type:"initializedResponse"});break;case"requestToken":this.handler.getAccessToken().then(e=>{this.notify({uuid:t.uuid,source:"k4.host",type:"tokenReceived",token:e})}).catch(e=>{this.notify({uuid:t.uuid,source:"k4.host",type:"tokenReceived",token:e instanceof Error?e:new Error("Unknown error")})});break;case"localStorageGetValue":this.handler.getLocalStorageValue(t.key).then(e=>{this.notify({uuid:t.uuid,source:"k4.host",type:"localStorageGetValueResponse",value:e})}).catch(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"localStorageGetValueResponse",value:null})});break;case"localStorageSetValue":void 0===t.value?this.handler.clearLocalStorageValue(t.key).finally(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"localStorageSetValueResponse"})}):this.handler.setLocalStorageValue(t.key,t.value).finally(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"localStorageSetValueResponse"})});break;case"localStorageClearValue":this.handler.clearLocalStorageValue(t.key).finally(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"localStorageClearValueResponse"})});break;case"setModelName":this.handler.setModelName(t.name).finally(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"setModelNameResponse"})});break;case"downloadFile":if(!this.handler.downloadFile)throw new Error("downloadFile is not supported");this.handler.downloadFile(t.file,t.name).finally(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"downloadFileResponse"})});break;case"checkDownloadFileStatus":this.handler.checkDownloadFileStatus().then(e=>{this.notify({uuid:t.uuid,source:"k4.host",type:"checkDownloadFileStatusResponse",status:e})}).catch(()=>{this.notify({uuid:t.uuid,source:"k4.host",type:"checkDownloadFileStatusResponse",status:"disabled"})});break;default:throw new Error(`Unknown message type: ${e.data.type} from source: ${e.data.source}`)}}),n(this,"notify",e=>{const t=document.getElementById(this.id);if(null==t||!t.contentWindow)throw new Error(`iframe ${this.id} not initialized`);t.contentWindow.postMessage(e,"*")}),this.id=e,this.handler=t}}}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};(()=>{i.r(s),i.d(s,{default:()=>a});var e=i(346),t=window.powerbi,n={name:"k4217CE0FC919C43CF9FD4AE5EBD64655F",displayName:"K4 Analytics 25.0.0.1775",class:"Visual",apiVersion:"5.11.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,i)=>{const s=globalThis.dialogRegistry;e in s&&new s[e](t,i)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.k4217CE0FC919C43CF9FD4AE5EBD64655F=n);const a=n})(),k4217CE0FC919C43CF9FD4AE5EBD64655F=s})();