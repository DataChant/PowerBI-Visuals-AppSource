var videoPlayer9439BF571F794C09AE8B97BD2199A94C;(()=>{var e={181:e=>{var t=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,n=/^0o[0-7]+$/i,o=parseInt,r="object"==typeof global&&global&&global.Object===Object&&global,a="object"==typeof self&&self&&self.Object===Object&&self,l=r||a||Function("return this")(),c=Object.prototype.toString,d=Math.max,u=Math.min,h=function(){return l.Date.now()};function p(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==c.call(e)}(e))return NaN;if(p(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=p(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(t,"");var a=i.test(e);return a||n.test(e)?o(e.slice(2),a?2:8):s.test(e)?NaN:+e}e.exports=function(e,t,s){var i,n,o,r,a,l,c=0,m=!1,g=!1,y=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var s=i,o=n;return i=n=void 0,c=t,r=e.apply(o,s)}function b(e){var s=e-l;return void 0===l||s>=t||s<0||g&&e-c>=o}function S(){var e=h();if(b(e))return E(e);a=setTimeout(S,function(e){var s=t-(e-l);return g?u(s,o-(e-c)):s}(e))}function E(e){return a=void 0,y&&i?f(e):(i=n=void 0,r)}function L(){var e=h(),s=b(e);if(i=arguments,n=this,l=e,s){if(void 0===a)return function(e){return c=e,a=setTimeout(S,t),m?f(e):r}(l);if(g)return a=setTimeout(S,t),f(l)}return void 0===a&&(a=setTimeout(S,t)),r}return t=v(t)||0,p(s)&&(m=!!s.leading,o=(g="maxWait"in s)?d(v(s.maxWait)||0,t):o,y="trailing"in s?!!s.trailing:y),L.cancel=function(){void 0!==a&&clearTimeout(a),c=0,i=l=n=a=void 0},L.flush=function(){return void 0===a?r:E(h())},L}},572:(e,t,s)=>{"use strict";s.r(t)},754:(e,t,s)=>{"use strict";s.r(t),s.d(t,{AlignmentGroup:()=>u,AutoDropdown:()=>f,AutoFlagsSelection:()=>P,CardGroupEntity:()=>o,ColorPicker:()=>p,CompositeCard:()=>a,CompositeSlice:()=>I,Container:()=>R,ContainerItem:()=>N,DatePicker:()=>g,DurationPicker:()=>b,ErrorRangeControl:()=>S,FieldPicker:()=>E,FontControl:()=>F,FontPicker:()=>w,GradientBar:()=>C,Group:()=>l,ImageUpload:()=>T,ItemDropdown:()=>y,ItemFlagsSelection:()=>L,ListEditor:()=>D,MarginPadding:()=>V,Model:()=>r,NumUpDown:()=>v,ReadOnlyText:()=>A,ShapeMapSelector:()=>_,SimpleCard:()=>c,SimpleSlice:()=>d,Slider:()=>m,TextArea:()=>k,TextInput:()=>M,ToggleSwitch:()=>h});var i=s(639);class n{}class o extends n{}class r{}class a extends n{}class l extends o{constructor(e){super(),Object.assign(this,e)}}class c extends o{}class d extends n{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const s=this.type,i=this.name,n={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+i};return Object.assign(Object.assign({},n),{control:{type:s,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:i.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var s;let n=null===(s=null==e?void 0:e[t])||void 0===s?void 0:s[this.name];this.value=i.D(this,n,this.value)}}class u extends d{constructor(e){super(e),this.type="AlignmentGroup"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{mode:this.mode,supportsNoSelection:this.supportsNoSelection})}}class h extends d{constructor(e){super(e),this.type="ToggleSwitch"}}class p extends d{constructor(e){super(e),this.type="ColorPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{defaultColor:this.defaultColor,isNoFillItemSupported:this.isNoFillItemSupported})}}class v extends d{constructor(e){super(e),this.type="NumUpDown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{options:this.options})}}class m extends v{constructor(){super(...arguments),this.type="Slider"}}class g extends d{constructor(e){super(e),this.type="DatePicker"}getFormattingComponent(e,t){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:t&&this.placeholderKey?t.getDisplayName(this.placeholderKey):this.placeholder,validators:this.validators})}}class y extends d{constructor(e){super(e),this.type="Dropdown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{items:this.items})}}class f extends d{constructor(e){super(e),this.type="Dropdown"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{mergeValues:this.mergeValues,filterValues:this.filterValues})}}class b extends d{constructor(e){super(e),this.type="DurationPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{validators:this.validators})}}class S extends d{constructor(e){super(e),this.type="ErrorRangeControl"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{validators:this.validators})}}class E extends d{constructor(e){super(e),this.type="FieldPicker"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{validators:this.validators,allowMultipleValues:this.allowMultipleValues})}}class L extends d{constructor(e){super(e),this.type="FlagsSelection"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{items:this.items})}}class P extends d{constructor(){super(...arguments),this.type="FlagsSelection"}}class M extends d{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}class k extends M{constructor(){super(...arguments),this.type="TextArea"}}class w extends d{constructor(){super(...arguments),this.type="FontPicker"}}class C extends d{constructor(){super(...arguments),this.type="GradientBar"}}class T extends d{constructor(){super(...arguments),this.type="ImageUpload"}}class D extends d{constructor(){super(...arguments),this.type="ListEditor"}}class A extends d{constructor(){super(...arguments),this.type="ReadOnlyText"}}class _ extends d{constructor(e){super(e),this.type="ShapeMapSelector"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{isAzMapReferenceSelector:this.isAzMapReferenceSelector})}}class I extends n{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const s=this.type,i=this.name,n={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+i};return Object.assign(Object.assign({},n),{control:{type:s,properties:this.getFormattingComponent(e)}})}}class F extends I{constructor(e){super(e),this.type="FontControl"}getFormattingComponent(e){var t,s,i;return{fontFamily:this.fontFamily.getFormattingComponent(e),fontSize:this.fontSize.getFormattingComponent(e),bold:null===(t=this.bold)||void 0===t?void 0:t.getFormattingComponent(e),italic:null===(s=this.italic)||void 0===s?void 0:s.getFormattingComponent(e),underline:null===(i=this.underline)||void 0===i?void 0:i.getFormattingComponent(e)}}getRevertToDefaultDescriptor(e){return this.fontFamily.getRevertToDefaultDescriptor(e).concat(this.fontSize.getRevertToDefaultDescriptor(e)).concat(this.bold?this.bold.getRevertToDefaultDescriptor(e):[]).concat(this.italic?this.italic.getRevertToDefaultDescriptor(e):[]).concat(this.underline?this.underline.getRevertToDefaultDescriptor(e):[])}setPropertiesValues(e,t){var s,i,n;this.fontFamily.setPropertiesValues(e,t),this.fontSize.setPropertiesValues(e,t),null===(s=this.bold)||void 0===s||s.setPropertiesValues(e,t),null===(i=this.italic)||void 0===i||i.setPropertiesValues(e,t),null===(n=this.underline)||void 0===n||n.setPropertiesValues(e,t)}}class V extends I{constructor(e){super(e),this.type="MarginPadding"}getFormattingComponent(e){return{left:this.left.getFormattingComponent(e),right:this.right.getFormattingComponent(e),top:this.top.getFormattingComponent(e),bottom:this.bottom.getFormattingComponent(e)}}getRevertToDefaultDescriptor(e){return this.left.getRevertToDefaultDescriptor(e).concat(this.right.getRevertToDefaultDescriptor(e)).concat(this.top.getRevertToDefaultDescriptor(e)).concat(this.bottom.getRevertToDefaultDescriptor(e))}setPropertiesValues(e,t){this.left.setPropertiesValues(e,t),this.right.setPropertiesValues(e,t),this.top.setPropertiesValues(e,t),this.bottom.setPropertiesValues(e,t)}}class R extends n{constructor(e){super(),Object.assign(this,e)}}class N extends n{}},667:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var i=s(754);const n=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var s,n;let o=new e,r=null===(s=null==t?void 0:t.metadata)||void 0===s?void 0:s.objects;return r&&(null===(n=o.cards)||void 0===n||n.forEach((e=>{var t;e instanceof i.CompositeCard&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(r,e.name)),(e instanceof i.SimpleCard?[e]:e.groups).forEach((t=>{var s,i,n,o;null===(s=t.topLevelSlice)||void 0===s||s.setPropertiesValues(r,e.name),null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach((t=>{null==t||t.setPropertiesValues(r,e.name)})),null===(o=null===(n=null==t?void 0:t.container)||void 0===n?void 0:n.containerItems)||void 0===o||o.forEach((t=>{var s;null===(s=null==t?void 0:t.slices)||void 0===s||s.forEach((t=>{null==t||t.setPropertiesValues(r,e.name)}))}))}))}))),o}buildFormattingModel(e){let t={cards:[]};return e.cards.filter((({visible:e=!0})=>e)).forEach((e=>{var s;let n={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane};const o=e.name;if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(o,this.localizationManager);t.suppressDisplayName=!0,n.topLevelToggle=t}null===(s=e.onPreProcess)||void 0===s||s.call(e);const r=e instanceof i.SimpleCard;(r?[e].filter((({visible:e=!0})=>e)):e.groups.filter((({visible:e=!0})=>e))).forEach((e=>{const t=e.name+"-group",s={displayName:r?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:r?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};n.groups.push(s);const i={};if(e.container){const n=e.container,r=t+"-container",a={displayName:this.localizationManager&&n.displayNameKey?this.localizationManager.getDisplayName(n.displayNameKey):n.displayName,description:this.localizationManager&&n.descriptionKey?this.localizationManager.getDisplayName(n.descriptionKey):n.description,containerItems:[],uid:r};n.containerItems.forEach((e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,s=r+t;let n={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:s};this.buildFormattingSlices({slices:e.slices,objectName:o,sliceNames:i,formattingSlices:n.slices}),a.containerItems.push(n)})),s.container=a}if(e.slices){if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(o,this.localizationManager);t.suppressDisplayName=!0,(null==s.displayName?n:s).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:o,sliceNames:i,formattingSlices:s.slices})}})),n.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(n)})),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:s,formattingSlices:i}){null==e||e.filter((({visible:e=!0})=>e)).forEach((e=>{let n=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);n&&(void 0===s[e.name]?s[e.name]=0:(s[e.name]++,n.uid=`${n.uid}-${s[e.name]}`),i.push(n))}))}getRevertToDefaultDescriptor(e){var t;const s={};let n,o=[],r=[];return e instanceof i.CompositeCard&&e.topLevelSlice&&o.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof i.SimpleCard?[e].filter((({visible:e=!0})=>e)):e.groups.filter((({visible:e=!0})=>e))).forEach((t=>{var i,a;n=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,s,t.topLevelSlice),null===(a=null===(i=t.container)||void 0===i?void 0:i.containerItems)||void 0===a||a.forEach((t=>{r=r.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,s))})),o.push(...n.concat(r))})),o}getSlicesRevertToDefaultDescriptor(e,t,s,i){let n=[];return i&&(s[i.name]=!0,n=n.concat(i.getRevertToDefaultDescriptor(e))),null==t||t.forEach((t=>{t&&!s[t.name]&&(s[t.name]=!0,n=n.concat(t.getRevertToDefaultDescriptor(e)))})),n}}},674:(e,t,s)=>{"use strict";s.r(t),s.d(t,{FormattingSettingsService:()=>n.A,formattingSettings:()=>i});var i=s(754),n=s(667)},639:(e,t,s)=>{"use strict";function i(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function n(e,t,s){return null==t||"object"==typeof t&&!t.solid?s:t.solid?{value:null==t?void 0:t.solid.color}:(null==e?void 0:e.items)?e.items.find((e=>e.value==t)):t}s.d(t,{D:()=>n,y:()=>i})},450:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StreamPlayer=void 0;const n=i(s(824));t.StreamPlayer=class{eventEmitter;container;video;videoSource;videoControls;playButton;playbackIcons;timeElapsed;duration;progressBar;seek;seekTooltip;volumeButton;volumeIcons;volumeMute;volumeLow;volumeHigh;volume;playbackAnimation;fullscreenButton;videoContainer;fullscreenIcons;pipButton;playerState="NON_STARTED";loop=!1;constructor(e,t){this.eventEmitter=e,this.container=t,this.initControls(),this.initEventListeners(),this.eventEmitter.on("duration",this.setDuration.bind(this)),this.eventEmitter.on("updateTime",this.updateTime.bind(this)),this.eventEmitter.on("preview",this.setPreviewURL.bind(this)),this.eventEmitter.on("videoEnded",this.onVideoEnded.bind(this))}initControls(){const e=this.container;e.classList.add("player-container"),e.innerHTML=n.default,this.video=e.querySelector("#video"),this.videoSource=this.video.querySelector("source"),this.videoControls=e.querySelector("#video-controls"),this.playButton=e.querySelector("#play"),this.playbackIcons=e.querySelectorAll(".playback-icons use"),this.timeElapsed=e.querySelector("#time-elapsed"),this.duration=e.querySelector("#duration"),this.progressBar=e.querySelector("#progress-bar"),this.seek=e.querySelector("#seek"),this.seekTooltip=e.querySelector("#seek-tooltip"),this.volumeButton=e.querySelector("#volume-button"),this.volumeIcons=e.querySelectorAll(".volume-button use"),this.volumeMute=e.querySelector('use[href="#volume-mute"]'),this.volumeLow=e.querySelector('use[href="#volume-low"]'),this.volumeHigh=e.querySelector('use[href="#volume-high"]'),this.volume=e.querySelector("#volume"),this.playbackAnimation=e.querySelector("#playback-animation"),this.fullscreenButton=e.querySelector("#fullscreen-button"),this.videoContainer=e.querySelector("#video-container"),this.fullscreenIcons=this.fullscreenButton?.querySelectorAll("use"),this.pipButton=e.querySelector("#pip-button")}initEventListeners(){!!document.createElement("video").canPlayType&&(this.video.controls=!1,this.videoControls.classList.remove("hidden")),this.video.onerror=()=>console.log("Error loading this video"),this.playButton.addEventListener("click",(()=>this.togglePlay())),this.video.addEventListener("volumechange",(()=>this.updateVolumeIcon())),this.video.addEventListener("click",(()=>this.togglePlay())),this.video.addEventListener("click",(()=>this.animatePlayback())),this.video.addEventListener("mouseenter",(()=>this.showControls())),this.video.addEventListener("mouseleave",(()=>this.hideControls())),this.videoControls.addEventListener("mouseenter",(()=>this.showControls())),this.videoControls.addEventListener("mouseleave",(()=>this.hideControls())),this.seek.addEventListener("mousemove",(e=>this.updateSeekTooltip(e))),this.seek.addEventListener("input",(e=>this.skipAhead(e))),this.volume.addEventListener("input",(()=>this.updateVolume())),this.volumeButton.addEventListener("click",(()=>this.toggleMute())),this.fullscreenButton.addEventListener("click",(()=>this.toggleFullScreen())),this.videoContainer.addEventListener("fullscreenchange",(()=>this.updateFullscreenButton())),this.pipButton.addEventListener("click",(()=>this.togglePip())),"pictureInPictureEnabled"in document||this.pipButton.classList.add("hidden")}is_state_playing(){return"PLAYING"===this.playerState}async play(){"NON_STARTED"===this.playerState?this.eventEmitter.emit("play",0):this.eventEmitter.emit("play",-1),this.playerState="PLAYING",this.video.play()}async pause(){this.playerState="PAUSED",this.eventEmitter.emit("pause")}setVideo(e,t){this.videoSource.onerror=()=>{t(),console.log("Error loading this video source")},e.thumbnails.length>0?this.video.poster=e.thumbnails[e.thumbnails.length-1].url:this.video.poster="",e.formats.length>0?(this.videoSource.src=e.formats[e.formats.length-1].url,this.video.load()):this.videoSource.src=""}getVideoElement(){return this.video}setDirectLinkVideo(e,t){this.video.poster="",this.videoSource.src=e,this.videoSource.onerror=()=>{t(),console.log("Error loading this video source")},this.video.load()}togglePlay(){this.is_state_playing()?this.pause():this.play(),this.updatePlayButton()}updatePlayButton(){this.playbackIcons.forEach((e=>e.classList.toggle("hidden"))),this.is_state_playing()?this.playButton.setAttribute("data-title","Pause"):this.playButton.setAttribute("data-title","Play")}formatTime(e){if(!e)return"00:00";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60,n=s<10?"0"+s:s,o=i<10?"0"+i:i;return t>0?`${t}:${n}:${o}`:`${n}:${o}`}setPreviewURL(e){this.video.setAttribute("poster",e)}onVideoEnded(){console.log("onVideoEnded"),this.updateTime(0),this.playerState="NON_STARTED",this.updatePlayButton(),this.eventEmitter.emit("pause"),this.loop&&(console.log("Looping video"),this.play())}setDuration(e){const t=Math.floor(e);this.seek.setAttribute("max",t.toString()),this.progressBar.setAttribute("max",t.toString());const s=this.formatTime(t);this.duration.innerText=`${s}`,this.duration.setAttribute("datetime",`${s}`)}updateTime(e){const t=this.formatTime(Math.floor(e));this.timeElapsed.innerText=`${t}`,this.timeElapsed.setAttribute("datetime",`${t}`),this.seek.value=Math.floor(e).toString(),this.progressBar.value=Math.floor(e)}updateSeekTooltip(e){const t=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));this.seek.setAttribute("data-seek",t.toString()),this.seekTooltip.textContent=this.formatTime(t);const s=this.video.getBoundingClientRect();this.seekTooltip.style.left=e.pageX-s.left+"px"}skipAhead(e){const t=(s=e.target?.dataset?.seek,/^\d+$/.test(s)?e.target.dataset.seek:e.target.value);var s;this.video.currentTime=t,this.progressBar.value=t,this.seek.value=t,this.eventEmitter.emit("seekTo",t),"NON_STARTED"===this.playerState&&(this.playerState="PAUSED",this.video.play())}updateVolume(){this.video.muted&&(this.video.muted=!1),this.video.volume=parseFloat(this.volume.value)}updateVolumeIcon(){this.volumeIcons.forEach((e=>{e.classList.add("hidden")})),this.volumeButton.setAttribute("data-title","Mute (m)"),this.video.muted||0===this.video.volume?(this.volumeMute.classList.remove("hidden"),this.volumeButton.setAttribute("data-title","Unmute (m)")):this.video.volume>0&&this.video.volume<=.5?this.volumeLow.classList.remove("hidden"):this.volumeHigh.classList.remove("hidden")}toggleMute(){this.video.muted=!this.video.muted,this.video.muted?(this.volume.setAttribute("data-volume",this.volume.value),this.volume.value="0"):this.volume.value=this.volume.dataset.volume}animatePlayback(){this.playbackAnimation.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(1.3)"}],{duration:500})}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():this.videoContainer.webkitRequestFullscreen?this.videoContainer.webkitRequestFullscreen():this.videoContainer.requestFullscreen()}updateFullscreenButton(){this.fullscreenIcons.forEach((e=>e.classList.toggle("hidden"))),document.fullscreenElement?this.fullscreenButton.setAttribute("data-title","Exit full screen (f)"):this.fullscreenButton.setAttribute("data-title","Full screen (f)")}async togglePip(){try{this.video!==document.pictureInPictureElement?(this.pipButton.disabled=!0,await this.video.requestPictureInPicture()):await document.exitPictureInPicture()}catch(e){console.error(e)}finally{this.pipButton.disabled=!1}}hideControls(){0!=this.is_state_playing()&&this.videoControls.classList.add("hide")}showControls(){this.videoControls.classList.remove("hide")}setLoop(e){this.loop=e}}},69:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PC_CONFIG=t.TIME_PING_INTERVAL=t.TIME_UPDATE_INTERVAL=t.SESSION_ID=t.SIGNALING_SERVER_URL=void 0,t.SIGNALING_SERVER_URL="wss://websockets.pbicraft.com",t.SESSION_ID="18",t.TIME_UPDATE_INTERVAL=1e3,t.TIME_PING_INTERVAL=30;const s="c722dfb187f0b615f51147636d3089a534e1fc8372f7ece789a7e895fc6270bc",i="5ad34e05abd8bef9db4cdc6c62f25c4344d0e87ff2a0d3104481fffe76cdbf2f";t.PC_CONFIG={iceServers:[{urls:"stun:stun.cloudflare.com:3478",username:s,credential:i},{urls:"turn:turn.cloudflare.com:3478?transport=udp",username:s,credential:i},{urls:"turn:turn.cloudflare.com:3478?transport=tcp",username:s,credential:i},{urls:"turns:turn.cloudflare.com:5349?transport=tcp",username:s,credential:i}]}},824:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default='\n    <div class="video-container" id="video-container">\n      <div class="playback-animation" id="playback-animation">\n        <svg class="playback-icons">\n          <use class="hidden" href="#play-icon"></use>\n          <use href="#pause"></use>\n        </svg>\n      </div>\n\n      <video controls class="video" id="video" preload="auto" poster="">\n        <source src="" type="video/mp4"></source>\n      </video>\n\n      <div class="video-controls hidden" id="video-controls">\n        <div class="video-progress">\n          <progress id="progress-bar" value="0" min="0"></progress>\n          <input class="seek" id="seek" value="0" min="0" type="range" step="1">\n          <div class="seek-tooltip" id="seek-tooltip">00:00</div>\n        </div>\n\n        <div class="bottom-controls">\n          <div class="left-controls">\n            <button data-title="Play (k)" id="play">\n              <svg class="playback-icons">\n                <use href="#play-icon"></use>\n                <use class="hidden" href="#pause"></use>\n              </svg>\n            </button>\n\n            <div class="volume-controls">\n              <button data-title="Mute (m)" class="volume-button" id="volume-button">\n                <svg>\n                  <use class="hidden" href="#volume-mute"></use>\n                  <use class="hidden" href="#volume-low"></use>\n                  <use href="#volume-high"></use>\n                </svg>\n              </button>\n\n              <input class="volume" id="volume" value="1"\n              data-mute="0.5" type="range" max="1" min="0" step="0.01">\n            </div>\n\n            <div class="time">\n              <time id="time-elapsed">00:00</time>\n              <span> / </span>\n              <time id="duration">00:00</time>\n            </div>\n          </div>\n\n          <div class="right-controls">\n            <button data-title="PIP (p)" class="pip-button" id="pip-button">\n              <svg>\n                <use href="#pip"></use>\n              </svg>\n            </button>\n            <button data-title="Full screen (f)" class="fullscreen-button" id="fullscreen-button">\n              <svg>\n                <use href="#fullscreen"></use>\n                <use href="#fullscreen-exit" class="hidden"></use>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n\n<svg style="display: none">\n<defs>\n  <symbol id="pause" viewBox="0 0 24 24">\n    <path d="M14.016 5.016h3.984v13.969h-3.984v-13.969zM6 18.984v-13.969h3.984v13.969h-3.984z"></path>\n  </symbol>\n\n  <symbol id="play-icon" viewBox="0 0 24 24">\n    <path d="M8.016 5.016l10.969 6.984-10.969 6.984v-13.969z"></path>\n  </symbol>\n\n  <symbol id="volume-high" viewBox="0 0 24 24">\n  <path d="M14.016 3.234q3.047 0.656 5.016 3.117t1.969 5.648-1.969 5.648-5.016 3.117v-2.063q2.203-0.656 3.586-2.484t1.383-4.219-1.383-4.219-3.586-2.484v-2.063zM16.5 12q0 2.813-2.484 4.031v-8.063q1.031 0.516 1.758 1.688t0.727 2.344zM3 9h3.984l5.016-5.016v16.031l-5.016-5.016h-3.984v-6z"></path>\n  </symbol>\n\n  <symbol id="volume-low" viewBox="0 0 24 24">\n  <path d="M5.016 9h3.984l5.016-5.016v16.031l-5.016-5.016h-3.984v-6zM18.516 12q0 2.766-2.531 4.031v-8.063q1.031 0.516 1.781 1.711t0.75 2.32z"></path>\n  </symbol>\n\n  <symbol id="volume-mute" viewBox="0 0 24 24">\n  <path d="M12 3.984v4.219l-2.109-2.109zM4.266 3l16.734 16.734-1.266 1.266-2.063-2.063q-1.547 1.313-3.656 1.828v-2.063q1.172-0.328 2.25-1.172l-4.266-4.266v6.75l-5.016-5.016h-3.984v-6h4.734l-4.734-4.734zM18.984 12q0-2.391-1.383-4.219t-3.586-2.484v-2.063q3.047 0.656 5.016 3.117t1.969 5.648q0 2.203-1.031 4.172l-1.5-1.547q0.516-1.266 0.516-2.625zM16.5 12q0 0.422-0.047 0.609l-2.438-2.438v-2.203q1.031 0.516 1.758 1.688t0.727 2.344z"></path>\n  </symbol>\n\n  <symbol id="fullscreen" viewBox="0 0 24 24">\n  <path d="M14.016 5.016h4.969v4.969h-1.969v-3h-3v-1.969zM17.016 17.016v-3h1.969v4.969h-4.969v-1.969h3zM5.016 9.984v-4.969h4.969v1.969h-3v3h-1.969zM6.984 14.016v3h3v1.969h-4.969v-4.969h1.969z"></path>\n  </symbol>\n\n  <symbol id="fullscreen-exit" viewBox="0 0 24 24">\n  <path d="M15.984 8.016h3v1.969h-4.969v-4.969h1.969v3zM14.016 18.984v-4.969h4.969v1.969h-3v3h-1.969zM8.016 8.016v-3h1.969v4.969h-4.969v-1.969h3zM5.016 15.984v-1.969h4.969v4.969h-1.969v-3h-3z"></path>\n  </symbol>\n\n  <symbol id="pip" viewBox="0 0 24 24">\n  <path d="M21 19.031v-14.063h-18v14.063h18zM23.016 18.984q0 0.797-0.609 1.406t-1.406 0.609h-18q-0.797 0-1.406-0.609t-0.609-1.406v-14.016q0-0.797 0.609-1.383t1.406-0.586h18q0.797 0 1.406 0.586t0.609 1.383v14.016zM18.984 11.016v6h-7.969v-6h7.969z"></path>\n  </symbol>\n</defs>\n</svg>\n'},715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorBanner=void 0,t.ErrorBanner=class{container;errorBanner;errorBannerMessage;constructor(e){this.container=e,this.container.classList.add("error-banner-container"),this.container.innerHTML='\n            <div class="error-banner">\n                <h2></h2>\n            </div>\n        ',this.errorBanner=this.container.querySelector(".error-banner"),this.errorBannerMessage=this.container.querySelector(".error-banner h2"),this.hide()}hide(){this.container.classList.add("hidden"),this.setError("")}show(){this.container.classList.remove("hidden")}setError(e){e.length>0?(this.errorBannerMessage.innerText="Error: "+e,this.errorBanner.style.visibility="visible"):(this.errorBannerMessage.innerText="",this.errorBanner.style.visibility="hidden")}}},750:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0,t.EventEmitter=class{events={};on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}removeListener(e,t){if(!this.events[e])return;const s=this.events[e].indexOf(t);s>=0&&this.events[e].splice(s,1)}emit(e,...t){this.events[e]&&this.events[e].forEach((e=>e(...t)))}}},514:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HashGenerator=void 0;class s{static version="v1";static hashSolt="3728c5eb-4429-43c4-bc9f-9e38dd8f5fe1";static getHashString(e){const t=e.substring(0,8);return s.version+t}static async digestMessage(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")}static getUTCDate(){const e=new Date;return e.getUTCFullYear()+"-"+(e.getUTCMonth()+1)+"-"+e.getUTCDate()}static async encode(e){const t=e+s.hashSolt+this.getUTCDate(),i=await this.digestMessage(t);return this.getHashString(i)}}t.HashGenerator=s},576:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VideoManager=void 0;const i=s(530),n=s(450),o=s(514),r=s(715),a=s(67),l=s(750);var c,d;!function(e){e[e.Player=0]="Player",e[e.Error=1]="Error"}(c||(c={})),function(e){e.DirectLink="DirectLink",e.VideoService="VideoService"}(d||(d={}));const u=[".WEBM",".MPG",".MP2",".MP3",".MPEG",".MPE",".MPV",".OGG",".MP4",".M4P",".M4V",".AVI",".WMV",".MOV",".QT",".FLV",".SWF",".MKV",".AVCHD"],h=["http://","https://","ftp://","ftps://"];class p{player=null;errorBanner;currentURL="";currentPass="";controller;player_container;loop=!1;static version="2024.09.30";constructor(e){this.player_container=document.createElement("div"),e.appendChild(this.player_container),console.log("Local VideoManager constructor, version",p.version);const t=document.createElement("div");this.errorBanner=new r.ErrorBanner(t),e.appendChild(t),this.controller=new AbortController,this.switchView(c.Player)}destroy_player(){}setStreamVideo(e){this.destroy_player(),this.switchView(c.Player);const t=new l.EventEmitter;this.player=new n.StreamPlayer(t,this.player_container),this.player.setLoop(this.loop),new a.Receiver(t,this.player.getVideoElement(),e).init(),window.onbeforeunload=()=>{console.log("beforeunload closing connections"),t.emit("shutdown")}}setRemoteVideo(e){this.destroy_player(),this.switchView(c.Player),this.player=new i.Player(this.player_container),this.player.setLoop(this.loop),this.player?.setVideo(e,(()=>this.onError("Can't load the video")))}setDimensions(e,t){console.log("setDimensions",e,t)}hide_player_container(){this.player_container.classList.add("hidden")}show_player_container(){this.player_container.classList.remove("hidden")}switchView(e=c.Player){switch(e){case c.Player:this.errorBanner.hide(),this.show_player_container();break;case c.Error:this.errorBanner.show(),this.hide_player_container()}}onError(e){console.log(e),this.errorBanner.setError("Can't load the video"),this.switchView(c.Error)}setDirectLinkVideo(e){this.destroy_player(),this.switchView(c.Player),this.player=new i.Player(this.player_container),this.player.setLoop(this.loop);for(const t of h)if(e.toLowerCase().startsWith(t.toLowerCase()))return void this.player?.setDirectLinkVideo(e,(()=>this.onError("Can't load the video")));e.includes(";base64,")?this.player?.setDirectLinkVideo(e,(()=>this.onError("Can't load the video"))):this.player?.setDirectLinkVideo(`https://${e}`,(()=>this.onError("Can't load the video")))}static getVideoType(e){for(const t of u)if(e.toLowerCase().endsWith(t.toLowerCase()))return d.DirectLink;return e.includes(";base64,")?d.DirectLink:d.VideoService}async load(e,t=""){if(this.switchView(c.Player),this.currentURL===e&&this.currentPass==t)return;if(this.currentURL=e,this.currentPass=t,p.getVideoType(e)===d.DirectLink)return void this.setDirectLinkVideo(e);const s=await o.HashGenerator.encode(e),i=await this.getVideoDetails(e,s,t);i?.stream&&i?.session_id?this.setStreamVideo(i.session_id):i?.status&&this.setRemoteVideo(i)}async getVideoDetails(e,t,s=""){let i=`https://videoplayer.pbicraft.com/api/v2/process?id=${encodeURIComponent(e)}&hash=${t}`;""!=s&&(i+="&pass="+s);const n=this.controller.signal;try{const e=await fetch(encodeURI(i),{signal:n}),t=await e.json();if(t?.status)return t;this.onError("Can't load the video")}catch(e){this.onError(e)}return null}setLoop(e){this.loop=e,this.player?.setLoop(e)}}t.VideoManager=p},530:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Player=void 0;const n=i(s(824));t.Player=class{container;video;videoSource;videoControls;playButton;playbackIcons;timeElapsed;duration;progressBar;seek;seekTooltip;volumeButton;volumeIcons;volumeMute;volumeLow;volumeHigh;volume;playbackAnimation;fullscreenButton;videoContainer;fullscreenIcons;pipButton;constructor(e){this.container=e,this.initControls(),this.initEventListeners()}initControls(){const e=this.container;e.classList.add("player-container"),e.innerHTML=n.default,this.video=e.querySelector("#video"),this.videoSource=this.video.querySelector("source"),this.videoControls=e.querySelector("#video-controls"),this.playButton=e.querySelector("#play"),this.playbackIcons=e.querySelectorAll(".playback-icons use"),this.timeElapsed=e.querySelector("#time-elapsed"),this.duration=e.querySelector("#duration"),this.progressBar=e.querySelector("#progress-bar"),this.seek=e.querySelector("#seek"),this.seekTooltip=e.querySelector("#seek-tooltip"),this.volumeButton=e.querySelector("#volume-button"),this.volumeIcons=e.querySelectorAll(".volume-button use"),this.volumeMute=e.querySelector('use[href="#volume-mute"]'),this.volumeLow=e.querySelector('use[href="#volume-low"]'),this.volumeHigh=e.querySelector('use[href="#volume-high"]'),this.volume=e.querySelector("#volume"),this.playbackAnimation=e.querySelector("#playback-animation"),this.fullscreenButton=e.querySelector("#fullscreen-button"),this.videoContainer=e.querySelector("#video-container"),this.fullscreenIcons=this.fullscreenButton?.querySelectorAll("use"),this.pipButton=e.querySelector("#pip-button")}initEventListeners(){!!document.createElement("video").canPlayType&&(this.video.controls=!1,this.videoControls.classList.remove("hidden")),this.video.onerror=()=>console.log("Error loading this video"),this.playButton.addEventListener("click",(()=>this.togglePlay())),this.video.addEventListener("play",(()=>this.updatePlayButton())),this.video.addEventListener("pause",(()=>this.updatePlayButton())),this.video.addEventListener("loadedmetadata",(()=>this.initializeVideo())),this.video.addEventListener("timeupdate",(()=>this.updateTimeElapsed())),this.video.addEventListener("timeupdate",(()=>this.updateProgress())),this.video.addEventListener("volumechange",(()=>this.updateVolumeIcon())),this.video.addEventListener("click",(()=>this.togglePlay())),this.video.addEventListener("click",(()=>this.animatePlayback())),this.video.addEventListener("mouseenter",(()=>this.showControls())),this.video.addEventListener("mouseleave",(()=>this.hideControls())),this.videoControls.addEventListener("mouseenter",(()=>this.showControls())),this.videoControls.addEventListener("mouseleave",(()=>this.hideControls())),this.seek.addEventListener("mousemove",(e=>this.updateSeekTooltip(e))),this.seek.addEventListener("input",(e=>this.skipAhead(e))),this.volume.addEventListener("input",(()=>this.updateVolume())),this.volumeButton.addEventListener("click",(()=>this.toggleMute())),this.fullscreenButton.addEventListener("click",(()=>this.toggleFullScreen())),this.videoContainer.addEventListener("fullscreenchange",(()=>this.updateFullscreenButton())),this.pipButton.addEventListener("click",(()=>this.togglePip())),"pictureInPictureEnabled"in document||this.pipButton.classList.add("hidden"),document.addEventListener("keyup",(()=>this.keyboardShortcuts))}pause(){this.video.pause()}hide(){this.container.classList.add("hidden")}show(){this.container.classList.remove("hidden")}setVideo(e,t){this.videoSource.onerror=()=>{t(),console.log("Error loading this video source")},e.thumbnails.length>0?this.video.poster=e.thumbnails[e.thumbnails.length-1].url:this.video.poster="",e.formats.length>0?(this.videoSource.src=e.formats[e.formats.length-1].url,this.video.load()):this.videoSource.src=""}getVideoElement(){return this.video}setDirectLinkVideo(e,t){this.video.poster="",this.videoSource.src=e,this.videoSource.onerror=()=>{t(),console.log("Error loading this video source")},this.video.load()}togglePlay(){this.video.paused||this.video.ended?this.video.play():this.video.pause()}updatePlayButton(){this.playbackIcons.forEach((e=>e.classList.toggle("hidden"))),this.video.paused?this.playButton.setAttribute("data-title","Play (k)"):this.playButton.setAttribute("data-title","Pause (k)")}formatTime(e){if(!e)return"00:00";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60,n=s<10?"0"+s:s,o=i<10?"0"+i:i;return t>0?`${t}:${n}:${o}`:`${n}:${o}`}initializeVideo(){const e=Math.round(this.video.duration);this.seek.setAttribute("max",e.toString()),this.progressBar.setAttribute("max",e.toString());const t=this.formatTime(e);this.duration.innerText=`${t}`,this.duration.setAttribute("datetime",`${t}`)}updateTimeElapsed(){const e=this.formatTime(Math.round(this.video.currentTime));this.timeElapsed.innerText=`${e}`,this.timeElapsed.setAttribute("datetime",`${e}`)}updateProgress(){this.seek.value=Math.floor(this.video.currentTime).toString(),this.progressBar.value=Math.floor(this.video.currentTime)}updateSeekTooltip(e){const t=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));this.seek.setAttribute("data-seek",t.toString()),this.seekTooltip.textContent=this.formatTime(t);const s=this.video.getBoundingClientRect();this.seekTooltip.style.left=e.pageX-s.left+"px"}skipAhead(e){const t=(s=e.target?.dataset?.seek,/^\d+$/.test(s)?e.target.dataset.seek:e.target.value);var s;this.video.currentTime=t,this.progressBar.value=t,this.seek.value=t}updateVolume(){this.video.muted&&(this.video.muted=!1),this.video.volume=parseFloat(this.volume.value)}updateVolumeIcon(){this.volumeIcons.forEach((e=>{e.classList.add("hidden")})),this.volumeButton.setAttribute("data-title","Mute (m)"),this.video.muted||0===this.video.volume?(this.volumeMute.classList.remove("hidden"),this.volumeButton.setAttribute("data-title","Unmute (m)")):this.video.volume>0&&this.video.volume<=.5?this.volumeLow.classList.remove("hidden"):this.volumeHigh.classList.remove("hidden")}toggleMute(){this.video.muted=!this.video.muted,this.video.muted?(this.volume.setAttribute("data-volume",this.volume.value),this.volume.value="0"):this.volume.value=this.volume.dataset.volume}animatePlayback(){this.playbackAnimation.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(1.3)"}],{duration:500})}toggleFullScreen(){document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():this.videoContainer.webkitRequestFullscreen?this.videoContainer.webkitRequestFullscreen():this.videoContainer.requestFullscreen()}updateFullscreenButton(){this.fullscreenIcons.forEach((e=>e.classList.toggle("hidden"))),document.fullscreenElement?this.fullscreenButton.setAttribute("data-title","Exit full screen (f)"):this.fullscreenButton.setAttribute("data-title","Full screen (f)")}async togglePip(){try{this.video!==document.pictureInPictureElement?(this.pipButton.disabled=!0,await this.video.requestPictureInPicture()):await document.exitPictureInPicture()}catch(e){console.error(e)}finally{this.pipButton.disabled=!1}}hideControls(){this.video.paused||this.videoControls.classList.add("hide")}showControls(){this.videoControls.classList.remove("hide")}keyboardShortcuts(e){const{key:t}=e;switch(t){case"k":this.togglePlay(),this.animatePlayback(),this.video.paused?this.showControls():setTimeout((()=>{this.hideControls()}),2e3);break;case"m":this.toggleMute();break;case"f":break;case"p":this.togglePip()}}setLoop(e){this.video.loop=e}}},67:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Receiver=void 0;const n=s(680),o=s(431),r=i(s(181));t.Receiver=class{eventEmitter;videoElement;sessionId;startButton=null;ws=null;webrtc=null;senderReady=!1;currentVersion=0;remoteStream=new MediaStream;constructor(e,t,s){this.eventEmitter=e,this.videoElement=t,this.sessionId=s,console.log("Receiver. Session ID:",this.sessionId),this.videoElement.srcObject=this.remoteStream,this.eventEmitter.on("play",this.sendPlayMessage.bind(this)),this.eventEmitter.on("pause",this.sendPauseMessage.bind(this)),this.eventEmitter.on("seekTo",(0,r.default)(this.sendSeekToMessage.bind(this),100)),this.eventEmitter.on("shutdown",(()=>{console.log("Shutting down receiver"),this.send_data({type:"shutdown"}),this.ws?.close(),this.webrtc?.pc.close()}))}send_data(e){this.currentVersion=Date.now();const t={...e,version:this.currentVersion};this.ws?.sendData(t)}async init(){this.sessionId&&(this.ws=new n.WSocket("receiver",this.sessionId,this.onMessage.bind(this)),await this.ws.connect(),this.send_data({type:"receiverReady"}))}async sendPlayMessage(e){console.log("sendPlayMessage",e),this.send_data({type:"play",time:e})}async sendPauseMessage(){console.log("sendPauseMessage"),this.send_data({type:"pause"})}async sendSeekToMessage(e){console.log("sendSeekToMessage",e),this.send_data({type:"seekTo",time:e})}async onMessage(e){switch("senderReady"===e.type&&(console.log("Sender is ready"),this.senderReady||(this.send_data({type:"receiverReady"}),this.webrtc=new o.WebRTC(this.onIceCandidate.bind(this),this.onTrack.bind(this))),this.senderReady=!0),e.type){case"senderReady":break;case"videoPlay":console.log("Received sender play command");break;case"offer":console.log("Received offer, setting remote description"),await(this.webrtc?.setRemoteDescription(e)),console.log("Creating answer");const t=await(this.webrtc?.createAnswer());t&&this.send_data(t);break;case"candidate":console.log("Received ICE candidate"),await(this.webrtc?.addIceCandidate(e.candidate));break;case"updateTime":e.version<this.currentVersion?console.log("Received new time with old version, skipping",e.time,"version",e.version):this.eventEmitter.emit("updateTime",e.time);break;case"duration":console.log("Received duration time: ",e.duration),this.eventEmitter.emit("duration",e.duration);break;case"preview":console.log("Received preview URL: ",e.url),this.eventEmitter.emit("preview",e.url);break;case"videoEnded":console.log("Received videoEnded command"),this.eventEmitter.emit("videoEnded");break;case"ping":console.log("Received ping");break;default:console.error("Unknown message type",e)}}onIceCandidate(e){this.send_data({type:"candidate",candidate:e})}onTrack(e){console.log("Received remote track"),e.streams[0].getTracks().forEach((e=>{const t=this.remoteStream.getTrackById(e.id);t&&(this.remoteStream.removeTrack(t),console.log(`Replaced track: ${e.id}`)),this.remoteStream.addTrack(e),console.log(`Added track: ${e.id}`)}))}}},431:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebRTC=void 0;const i=s(69);t.WebRTC=class{pc;onIceCandidateCallback;onTrackCallback;isOfferer;localStream;constructor(e,t,s=!1,n=null){this.pc=new RTCPeerConnection(i.PC_CONFIG),this.onIceCandidateCallback=e,this.onTrackCallback=t,this.isOfferer=s,this.localStream=n,this.setupPeerConnection()}setupPeerConnection(){this.pc.onicecandidate=e=>{e.candidate&&this.onIceCandidateCallback(e.candidate)},this.onTrackCallback&&(this.pc.ontrack=this.onTrackCallback),this.localStream&&this.addLocalStream(this.localStream),this.pc.oniceconnectionstatechange=()=>{console.log("ICE connection state: ",this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{console.log("Connection state: ",this.pc.connectionState)}}addLocalStream(e){e.getTracks().forEach((t=>{this.pc.addTrack(t,e)}))}async createOffer(){const e=await this.pc.createOffer();return await this.pc.setLocalDescription(e),e}async createAnswer(){const e=await this.pc.createAnswer();return await this.pc.setLocalDescription(e),e}async setLocalDescription(e){await this.pc.setLocalDescription(e)}async setRemoteDescription(e){await this.pc.setRemoteDescription(e)}async addIceCandidate(e){await this.pc.addIceCandidate(e)}}},680:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WSocket=void 0;const i=s(69);t.WSocket=class{sessionId;onMessageCallback;socket;path;reconnectAttempts;maxReconnectAttempts;reconnectDelay;pingInterval;pingTimeout;constructor(e,t,s){this.sessionId=t,this.onMessageCallback=s,this.socket=null,this.path=e,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.pingInterval=3e4,this.pingTimeout=null}connect(){return new Promise(((e,t)=>{this.socket=new WebSocket(`${i.SIGNALING_SERVER_URL}/${this.path}`),this.socket.onopen=()=>{console.log(`Connected to ${this.path} with sessionId ${this.sessionId}`),this.socket.send(this.sessionId),this.reconnectAttempts=0,this.startPing(),e()},this.socket.onmessage=e=>{const t=JSON.parse(e.data);this.onMessageCallback(t)},this.socket.onerror=e=>{console.error("WebSocket error:",e),this.tryReconnect(),t(e)},this.socket.onclose=()=>{console.log(`${this.path} disconnected`),this.stopPing(),this.tryReconnect()}}))}startPing(){this.stopPing(),this.pingTimeout=setInterval((()=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&(console.log("Sending ping to keep connection alive."),this.socket.send(JSON.stringify({type:"ping"})))}),this.pingInterval)}stopPing(){this.pingTimeout&&(clearInterval(this.pingTimeout),this.pingTimeout=null)}tryReconnect(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;const e=this.reconnectDelay*this.reconnectAttempts;console.log(`Attempting to reconnect (${this.reconnectAttempts}) in ${e/1e3} seconds...`),setTimeout((()=>{this.connect().catch((()=>{}))}),e)}else console.error("Max reconnection attempts reached. Giving up.")}sendData(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(e)):console.error("WebSocket is not open. Ready state: ",this.socket?.readyState)}close(){this.socket&&(this.socket.close(),this.stopPing(),console.log("WebSocket closed manually."))}}},175:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseEmbeddedPremium=void 0;const i=s(76);class n extends i.LicenseEmbedded{constructor(e,t){super(e,t)}static validate(e){if(!e||!e.length)return 4;const t=this.hasActiveServicePlan(e),s=this.hasActiveMinimalServicePlan(e);return t&&!s?e.some((e=>1==e.state))?1:e.some((e=>2==e.state))?2:4:4}static hasActiveServicePlan(e){return e&&e.length&&e.some((e=>1==e.state||2==e.state))}static hasActiveMinimalServicePlan(e){return e&&e.length&&e.some((e=>(e.spIdentifier.includes("freemium1")||e.spIdentifier.includes("plan1"))&&(1==e.state||2==e.state)))}}t.LicenseEmbeddedPremium=n},357:function(e,t,s){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseLicensedVisual=void 0;const n=s(674),o=s(980),r=i(s(181)),a=s(295);t.BaseLicensedVisual=class{host;target;formattingSettings;formattingSettingsService;selectionManager;cachedLicense=-1;licenseManager;renderLicense;setItemDebouncedInternal=()=>this.renderLicense&&this.renderLicense();runRenderLicenseDebounced=(0,r.default)(this.setItemDebouncedInternal,200);constructor(e,t){this.host=e.host,this.target=e.element,this.selectionManager=this.host.createSelectionManager(),this.formattingSettingsService=new n.FormattingSettingsService,this.licenseManager=new a.LicenseManager(this.host,t)}update(e){this.host.eventService.renderingStarted(e),(e?.dataViews?.length||e.dataViews[0].metadata)&&(this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(o.VisualFormattingSettingsModel,e.dataViews[0]))}getFormattingModel(){return this.formattingSettings?this.formattingSettingsService.buildFormattingModel(this.formattingSettings):null}async toggleLicenseMode(e){const t=await this.licenseManager.checkLicense(e);if(1==e.viewMode&&this.licenseManager.saveLicense(e.savedPlans),t!==this.cachedLicense)switch(this.cachedLicense=t,t){case 1:this.host.licenseManager.clearLicenseNotification();break;case 2:this.host.licenseManager.notifyLicenseRequired(0);break;default:this.host.licenseManager.notifyLicenseRequired(2)}}}},599:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseAPI=void 0;const i=s(804);class n extends i.LicenseCached{getAvailableServicePlans;servicePlans=[];constructor(e){super(),this.getAvailableServicePlans=()=>(0,i.wrapIPromise2)(e.getAvailableServicePlans())}async checkLicenseInternal(){try{const e=await this.getAvailableServicePlans();return this.servicePlans=e?.plans||[],e?.plans?.some((e=>1==e.state))?1:e?.plans?.some((e=>2==e.state))?2:4}catch(e){console.error(e)}return 4}}t.LicenseAPI=n},804:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseCached=t.wrapIPromise2=void 0,t.wrapIPromise2=function(e){return new Promise(((t,s)=>{e.then((e=>{t(e)})).catch((e=>{s(e)}))}))},t.LicenseCached=class{hasChecked=!1;cachedResult=4;async checkLicense(){if(this.hasChecked)return this.cachedResult;{const e=await this.checkLicenseInternal();return this.cachedResult=e,this.hasChecked=!0,e}}}},345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateShortLicenseKey=void 0,t.generateShortLicenseKey=function(e){if(!e)return"";let t=[...e.toString()].reduce(((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0),0);t=Math.abs(t);let s=t.toString(16);for(;s.length<10;)s+=s;return s.substring(0,10).toUpperCase()}},76:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseEmbedded=void 0;const s=128;class i{savedLicensePlans;isEmbedded;constructor(e,t){this.savedLicensePlans=t,this.isEmbedded=[2,8,s].includes(e)}async checkLicense(){if(!this.isEmbedded)return 4;try{const e=JSON.parse(this.savedLicensePlans);return i.validate(e)}catch(e){return 4}}static validate(e){return e&&e.length?e.some((e=>1==e.state))?1:e.some((e=>2==e.state))?2:4:4}}t.LicenseEmbedded=i},295:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseManager=void 0;const i=s(676),n=s(599),o=s(610),r=s(83),a=s(76),l=s(175);t.LicenseManager=class{host;licenseOptions;strategies=[];licenseAPI;constructor(e,t){this.host=e,this.licenseOptions=t,this.licenseAPI=new n.LicenseAPI(this.host.licenseManager),this.strategies.push(this.licenseAPI),this.strategies.push(new i.LicenseTrial(this.host.storageV2Service))}async checkLicense(e){const t=[new o.LicenseTestData(this.licenseOptions.TEST_DATA,e.testDataInput),new r.LicensePersistent(this.licenseOptions.licenseGUID,e.persistentKey)];this.licenseOptions.IsPremiumRequiredForEmbedded?t.push(new l.LicenseEmbeddedPremium(this.host.hostEnv,e.savedPlans)):t.push(new a.LicenseEmbedded(this.host.hostEnv,e.savedPlans));const s=[...this.strategies,...t],i=await Promise.all(s.map((e=>e.checkLicense())));return i.includes(1)?1:i.includes(2)?2:4}saveLicense(e){try{const t=JSON.stringify(this?.licenseAPI?.servicePlans);if(!this.licenseAPI||t.length<10)return;if(e==t)return;this.host.persistProperties({merge:[{objectName:"license",properties:{plans:t},selector:null}]})}catch(e){console.error(e)}}}},83:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicensePersistent=void 0;const i=s(345);t.LicensePersistent=class{licenseGUID;persistentKey;constructor(e,t){this.licenseGUID=e,this.persistentKey=t}async checkLicense(){const e=new Date,t=e.getFullYear(),s=e.getMonth()+1,n=s<10?`0${s}`:`${s}`,o=`${this.licenseGUID}-${t}-${n}`;return this.persistentKey==(0,i.generateShortLicenseKey)(o)?2:4}}},395:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseSettings=void 0;const i=s(674);var n=i.formattingSettings.SimpleCard;t.LicenseSettings=class extends n{plans=new i.formattingSettings.TextInput({name:"plans",displayName:"Plans",value:"",placeholder:"",visible:!1});licenseKey=new i.formattingSettings.TextInput({name:"licenseKey",displayName:"License Key",value:"",placeholder:"",visible:!0});name="license";displayName="License";slices=[this.plans,this.licenseKey]}},610:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseTestData=void 0;const i=s(345);t.LicenseTestData=class{TEST_DATA;input;constructor(e,t){this.TEST_DATA=e,this.input=t}async checkLicense(){if(!this.TEST_DATA||0===this.TEST_DATA.length)return 4;if(!this.input||0===this.input.length)return 2;try{if(this.validateTestData(this.input))return 2}catch(e){console.error(e)}return 4}validateTestData(e){if(!e)return!1;if(Array.isArray(e))return e.every((e=>{if(!e)return!0;const t=(0,i.generateShortLicenseKey)(e);return this.TEST_DATA.includes(t)}));{const t=(0,i.generateShortLicenseKey)(e);return this.TEST_DATA.includes(t)}}}},676:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LicenseTrial=void 0;const i=s(804);class n extends i.LicenseCached{static LICENSE_STORAGE_NAME="license_date_start";static MAX_DATE_DIFF=3;statusAsync;setAsync;getAsync;constructor(e){super(),this.statusAsync=()=>(0,i.wrapIPromise2)(e.status()),this.setAsync=(t,s)=>(0,i.wrapIPromise2)(e.set(t,s)),this.getAsync=t=>(0,i.wrapIPromise2)(e.get(t))}async checkLicenseInternal(){try{if(await this.hasValidTrialLicense())return 2}catch(e){console.error(e)}return 4}async getLicenseStartDate(){const e=await this.getAsync(n.LICENSE_STORAGE_NAME);return!!e&&this.validateLicenseDate(Number(e))}async hasValidTrialLicense(){const e=await this.getStatus();if(1==e)return!1;if(0!=e)return!1;try{if(await this.getLicenseStartDate())return!0}catch(e){}return!!await this.saveLicenseStartDate()&&this.getLicenseStartDate()}validateLicenseDate(e){if(isNaN(e))return!1;const t=Number(new Date);return!(Math.abs(t-e)/864e5>n.MAX_DATE_DIFF)}async getStatus(){try{return this.statusAsync()}catch(e){return 2}}async saveLicenseStartDate(){try{const e=Number(new Date);return!!(await this.setAsync(n.LICENSE_STORAGE_NAME,e)).success}catch(e){return!1}}}t.LicenseTrial=n},980:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisualFormattingSettingsModel=void 0;const i=s(674),n=s(395);var o=i.formattingSettings.SimpleCard,r=i.formattingSettings.Model;class a extends o{loopVideo=new i.formattingSettings.ToggleSwitch({name:"loopVideo",displayName:"Loop video",value:!1,visible:!0});name="player";displayName="Player";slices=[this.loopVideo]}t.VisualFormattingSettingsModel=class extends r{playerSettings=new a;licenseSettings=new n.LicenseSettings;cards=[this.playerSettings,this.licenseSettings]}},789:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Visual=void 0,s(572);const i=s(576),n=s(357);class o extends n.BaseLicensedVisual{static LICENSE_GUID="a0f4647f-3e02-41a1-a530-e5f7878a6cb2";static TEST_DATA=["4F821D94F8","70B0C15270","56EF471456","123F5EB512","42D52D6842"];static IsPremiumRequiredForEmbedded=!1;visualHostTooltipService;videoManager;visualManagerPromise;constructor(e){super(e,{licenseGUID:o.LICENSE_GUID,TEST_DATA:o.TEST_DATA,IsPremiumRequiredForEmbedded:o.IsPremiumRequiredForEmbedded}),this.visualHostTooltipService=this.host.tooltipService,this.handleContextMenu(),this.visualManagerPromise=o.loadScript().then((e=>{this.videoManager=new e(this.target)})).catch((e=>{console.error("Failed to load any script.",e)}))}static async loadScript(){try{const e=await import("https://video-static.pbicraft.com/video-manager.js");return console.log("Remote script loaded successfully."),e.VideoManager}catch(e){return console.error("Remote script failed to load, falling back to local script.",e),i.VideoManager}}handleContextMenu(){this.target.addEventListener("contextmenu",(e=>{this.selectionManager.showContextMenu({},{x:e.clientX,y:e.clientY}),e.preventDefault()}))}handleTooltips(){}parseVideoURL(e){const t=e[0].toString();return e.length>1&&""!=e[1]?{videoURL:t,pass:e[1].toString()}:{videoURL:t,pass:""}}update(e){if(super.update(e),!e.dataViews?.length||!e.dataViews[0]?.table?.rows?.length)return;const t=e.dataViews[0].table.rows;if(t.length<1)return;const{videoURL:s,pass:i}=this.parseVideoURL(t[0]),n=this.formattingSettings?.licenseSettings?.plans?.value||"",o=this.formattingSettings?.licenseSettings?.licenseKey?.value||"",r=this.formattingSettings?.playerSettings?.loopVideo?.value||!1;if(this.renderLicense=async()=>{this.videoManager&&(this.videoManager?.setDimensions&&this.videoManager.setDimensions(e.viewport.width,e.viewport.height),this.videoManager?.setLoop(r),await(this.videoManager?.load(s,i)));const t={savedPlans:n,persistentKey:o,testDataInput:s,viewMode:e.viewMode};this.toggleLicenseMode(t)},this.videoManager)this.runRenderLicenseDebounced();else{if(!this.visualManagerPromise)return void console.error("this.visualManagerPromise is undefined");this.visualManagerPromise.then((()=>{this.runRenderLicenseDebounced()})).catch((e=>{console.error("Failed to load any script.",e)}))}this.host.eventService.renderingFinished(e)}}t.Visual=o}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";var e=i;Object.defineProperty(e,"__esModule",{value:!0});const t=s(789);var n=window.powerbi,o={name:"videoPlayer9439BF571F794C09AE8B97BD2199A94C",displayName:"VideoPlayer",class:"Visual",apiVersion:"5.8.0",create:e=>{if(t.Visual)return new t.Visual(e);throw"Visual instance not found"},createModalDialog:(e,t,s)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,s)},custom:!0};void 0!==n&&(n.visuals=n.visuals||{},n.visuals.plugins=n.visuals.plugins||{},n.visuals.plugins.videoPlayer9439BF571F794C09AE8B97BD2199A94C=o),e.default=o})(),videoPlayer9439BF571F794C09AE8B97BD2199A94C=i})();