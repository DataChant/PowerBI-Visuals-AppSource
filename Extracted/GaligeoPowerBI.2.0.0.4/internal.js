var GaligeoPowerBI;(()=>{var e={324:e=>{e.exports={visual:{name:"GaligeoPowerBI",displayName:"Galigeo for PowerBI (2.0.0.4)",guid:"GaligeoPowerBI",visualClassName:"Visual",version:"2.0.0.4",description:"Galigeo for PowerBI",supportUrl:"https://galigeo.com",gitHubUrl:"https://github.com/Galigeo/Galigeo-for-PowerBI"},apiVersion:"5.11.0",author:{name:"Galigeo",email:"contact@galigeo.com"},assets:{icon:"assets/icon.png"},externalJS:null,style:"style/visual.less",capabilities:"capabilities.json",dependencies:null,stringResources:[]}},951:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});const i=class{xmin;ymin;xmax;ymax;constructor(e,t,s,i){this.xmin=e,this.ymin=t,this.xmax=s,this.ymax=i}}},231:(e,t,s)=>{"use strict";s.d(t,{$h:()=>a.$h,T5:()=>i.A});var i=s(421),a=(s(950),s(680),s(470))},950:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var i=s(351);class a extends i.A{id;name;datasourceId;datasetId;visible;isApiLayer;messenger;constructor(e,t){super(),this.id=e,this.name=t.name?t.name:e,this.datasourceId=t.datasourceId,this.datasetId=t.datasetId,this.visible=t.visible,this.isApiLayer=t.isApiLayer,this.messenger=t.messenger,this.messenger&&this.registerEvents()}getId(){return this.id}getName(){return this.name}getDatasetId(){return this.datasetId}isIssuedFromAPIData(){return this.datasourceId&&"CE"===this.datasourceId}getDatasourceId(){return this.datasourceId}setVisible(e){return this.messenger.postMessage("setVisible",e,this)}disableInfoWindow(){return this.messenger.postMessage("disableInfoWindow","",this)}filter(e){return this.messenger.postMessage("filter",e,this)}registerEvents(){this.messenger.addEventListener("layer",(e=>{e.layer&&e.layer.id===this.id&&this.fireEvent(e.action,e.value)}))}}const o=a},351:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});const i=class{_listeners=new Map;_messages=[];constructor(){}addEventListener(e,t){let s=this._listeners.get(e);s||(s=[],this._listeners.set(e,s)),s.push(t)}removeEventListner(e,t){let s=this._listeners.get(e);return!!s&&(s=s.filter((e=>e!==t)),!0)}fireEvent(e,t){let s=this._listeners.get(e);if(s)for(const e of s)e(t)}}},421:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var i=s(951),a=s(950),o=s(680),n=s(351);class r extends n.A{refreshId;element;options;iframe;messenger;loaded=!1;constructor(e,t){super(),console.log("Welcome to Galigeo"),this.options=t,this.element="string"==typeof e?document.getElementById(e):e,t.lang||(t.lang=navigator.language.split("-")[0]),t.url||(t.url="https://showroom.galigeo.com/Galigeo"),t.id&&!t.mapId&&(t.mapId=t.id),t.name&&!t.mapId&&(t.mapId=t.name.toUpperCase().toLowerCase().replace(/[^a-z0-9]/gi,"")),this.options.url.endsWith("/")&&(this.options.url=this.options.url.slice(0,-1)),this.options.data||(this.options.data=[]);for(const e of this.options.data)e.url&&(e.url=this.fixRelativeUrl(e.url));return this}async load(){return console.log("Loading Map"),new Promise(((e,t)=>{fetch(this.options.url+"/api/openMap/encoded",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},mode:"cors",body:`status=200&lang=${navigator.language}&data=${encodeURIComponent(JSON.stringify(this.options))}`}).then((e=>e.json())).then((t=>{t.message?this.showError(t.message,null):(this.iframe=this.createIframe(this.element,t),this.messenger=new o.A(this.iframe,this.options.timeout),this.refreshId=t.refreshId,this.registerEvents(),console.log("API- after fetch json",t),this.messenger.waitMapIsLoad().then((s=>{console.log("API- Map loaded",t),this.loaded=!0,this.setMapControlsVisible(!1),e(this)})))})).catch((e=>{this.showError("Unable to access Galigeo",e),t(e)}))}))}update(e){if(!this.refreshId||!this.loaded)throw new Error("Data update not available");return new Promise(((t,s)=>{fetch(this.options.url+"/api/openMap/encoded?refreshId="+this.refreshId,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:`status=200&lang=${navigator.language}&data=${encodeURIComponent(JSON.stringify(e))}`}).then((e=>e.json().then((e=>{e.message?s(e):t(e)})))).catch((e=>{this.showError("Unable to update data",e),s(e)}))}))}showError(e,t){console.error("Failed to load map",e,t);const s=this.element;for(;s.firstChild;)s.removeChild(s.firstChild);s.insertAdjacentHTML("beforeend",`<div id="galigeoError" style="height:100%;\n               text-align: center;\n               padding: 30px;\n               background-image: linear-gradient(135deg, #2ecc71 0%, #27a0ad 100%) !important; \n               color:white;\n               font-size: x-large;">\n            <h4>Unable to access Galigeo from ${this.options.url}</h4> \n            <p>${e}</p>\n            <p>${t?t.toLocaleString():""}</p></div>`)}isLoaded(){return this.loaded}refresh(){return this.messenger.postMessage("refresh",{})}setExtent(e){return this.messenger.postMessage("setExtent",e)}flyTo(e,t,s){return this.messenger.postMessage("flyTo",{x:e,y:t,zoom:s})}zoomTo(e,t,s){return this.messenger.postMessage("zoomTo",{x:e,y:t,zoom:s})}print(e,t,s){return new Promise(((i,a)=>{this.messenger.postMessage("print",{withLegend:e,savePng:t,title:s}).then((e=>{i(e)}))}))}enableMapNavigation(){return this.messenger.postMessage("enableMapNavigation",{})}disableMapNavigation(){return this.messenger.postMessage("disableMapNavigation",{})}setMenuVisible(e){return this.messenger.postMessage("setMenuVisible",e)}setMapControlsVisible(e){return this.messenger.postMessage("setMapControlsVisible",e)}setOpenNewTabVisible(e){return this.messenger.postMessage("setOpenNewTabVisible",e)}setBasemap(e){return this.messenger.postMessage("setBasemap",e)}addDataUrl(e,t){if(this.isLoaded())throw new Error("Cannot add new data once the map is loaded");this.options.data.push({format:"link",url:this.fixRelativeUrl(e),name:t})}createGeojsonFeatures(e,t){return new Promise(((s,i)=>{this.messenger.postMessage("createGeojsonFeatures",{features:e,style:t}).then((e=>{const t=new a.A(e.layer_id,{name:e.layer_id,isApiLayer:!0,datasetId:void 0,datasourceId:void 0,visible:!0,messenger:this.messenger});s(t)}))}))}addMarker(e,t,s,i){return new Promise(((o,n)=>{this.messenger.postMessage("addMarker",{coordinates:e,style:t,iconSvgOptions:s,urlSvg:i}).then((e=>{const t=new a.A(e.layer_id,{name:e.layer_id,isApiLayer:!0,datasetId:void 0,datasourceId:void 0,visible:!0,messenger:this.messenger});o(t)}))}))}removeLayer(e){return new Promise(((t,s)=>{this.messenger.postMessage("removeLayer",{layer:e}).then((e=>{t(e)}))}))}getLayers(){return new Promise(((e,t)=>{this.messenger.postMessage("getLayers",null).then((t=>{const s=[];for(const e of t){const t=new a.A(e.id,{name:e.name,datasetId:e.datasetId,datasourceId:e.datasourceId,visible:e.visible,messenger:this.messenger});s.push(t)}e(s)}))}))}registerEvents(){this.messenger.addEventListener("map",(e=>{let t;t="zoomend"===e.action?new i.A(e.value.minX,e.value.minY,e.value.maxX,e.value.maxY):e.value,this.fireEvent(e.action,t)}))}createIframe(e,t){const s=e;let i="index.html";this.options.devMode&&(i="indexdev.jsp"),this.options.viewerGL&&(i="indexgl.html");const a=document.getElementById("galigeoError");a&&a.remove();let o="listenMessages=true";this.options.crossDomain&&(o+="&crossDomain=true"),this.options.parent&&(o+="&parent="+this.options.parent),this.options.lang&&(o+="&lang="+this.options.lang),this.options.listenExternalLinks&&(o+="&listenExternalLinks="+this.options.listenExternalLinks),this.options.showLoginButton&&(o+="&showLoginButton="+this.options.showLoginButton);const n=this.options.url+"/"+t.relativeUrlServiceUrl;let r=`${this.options.url}/viewer/${i}?${o}&url=${n}&lang=${navigator.language.split("-")[0]}`;if(t.sso&&this.options.oauth2Enabled&&(r=`${this.options.url}/oauth/login.html?orgId=${t.orgId}&service=${t.service}&redirect=${encodeURIComponent(r)}`,this.options.oauth2Popup&&(r+="&popup=true"),console.log("sso",r)),this.options.redirect)return window.location.href=r,null;let l=e.querySelector("#galigeoMap");return l?l.src=r:(l=document.createElement("iframe"),l.src=r,l.width="100%",l.height="100%",l.title="Galigeo Map",l.id="galigeoMap",l.setAttribute("style","border: 0px"),l.addEventListener("error",(function(e){console.log("Failed to load iframe : ",e)})),"iPhone"!==navigator.platform&&"iPad"!==navigator.platform||setTimeout((()=>{try{""===l.contentWindow.document.querySelector("body").innerHTML&&(l.focus(),l.src=r)}catch(e){console.log("Failed to load iframe : ",e)}}),2e3),s.appendChild(l)),l}fixRelativeUrl(e){if(0!==e.toLowerCase().indexOf("http")){const t=window.location.href.lastIndexOf("/");return window.location.href.substring(0,t+1)+e}return e}}const l=r},680:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var i=s(351),a=s(470);class o extends i.A{iframe;timeout;ready=!1;responses=new Map;idCounter=1;constructor(e,t=3e4){super(),this.iframe=e,this.timeout=t,this.registerEvents()}registerEvents(){const e=this.iframe;console.log("API - Listen for messages",e.contentWindow),window.addEventListener("message",(t=>{if(t.source!==e.contentWindow)return;if("GaligeoMapLoaded"===t.data)return;const s=new a.QB(t.data);if("response"===s.type){console.log("API- receive response",s);const e=this.responses.get(s.id);e?(console.log("API- resolve response",e),this.responses.delete(s.id),e.resolve(s.value)):console.warn("API- Missing response handler for message ",s)}"event"===s.type&&this.fireEvent(s.source,s)}))}waitMapIsLoad(){return new Promise(((e,t)=>{window.addEventListener("message",(t=>{"GaligeoMapLoaded"===t.data&&(this.ready=!0,e("map loaded"))})),setTimeout((()=>{this.ready||t("Timeout excedeed, failed to load map")}),this.timeout)}))}postMessage(e,t,s){return new Promise(((i,o)=>{const n=new a.QB;if(n.source="api",n.type="function",n.action=e,n.value=t,n.id=""+this.idCounter++,n.layer=s,!this.ready)throw new Error("Map not ready, unable to send messages");{console.log("API- action =",e,n);const t=new a.QB;if(t.resolve=i,this.responses.set(n.id,t),!this.iframe||!this.iframe.contentWindow)throw new Error("Map iframe not ready, unable to send message "+e);this.iframe.contentWindow.postMessage(JSON.stringify(n),"*")}}))}}const n=o},470:(e,t,s)=>{"use strict";s.d(t,{$h:()=>a,QB:()=>o});var i=s(950);class a{id;mapId;name;lang;url;devMode;crossDomain;parent;skipAutoCreateLayer;data;profile;user;apiKey;redirect;oauth2Enabled;oauth2Popup;timeout;showLoginButton=!1;listenExternalLinks;viewerGL}class o{constructor(e){if(e)try{const t=JSON.parse(e);this.id=t.id,this.source=t.source,this.type=t.type,this.action=t.action,this.value=t.value,t.layer&&(this.layer=new i.A(t.layer.id,{name:t.layer.name}))}catch(t){console.debug("Skip message",e,t)}}source;type;action;value;layer;id;resolve}},96:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});class i{static getDataset(e){const t=e.categorical;if(!t)return null;const s={id:"data",name:"PowerBI Data",fields:[],features:[]},a={};t.categories&&i.parseCategory(s,a,t.categories,!0),t.values&&i.parseCategory(s,a,t.values,!1);const o={};for(const e in s.fields){const t=this.getFieldName(s.fields[e].name),i=a[t];for(let e=0;e<i.length;e++)o[e]||(o[e]={}),o[e][t]=i[e]}for(const e in o)s.features.push({attributes:o[e]});return console.log("Nb features",s.features.length),s}static parseCategory(e,t,s,a){if(s)for(let o=0;o<s.length;o++)try{const n=s[o],r=i.getFieldName(n.source.displayName);t[r]=n.values,e.fields.push({name:r,alias:r,alias2:r,type:this.getFieldType(n.source.type),geodim:a})}catch(e){console.error(o,s,e)}}static getFieldName(e){return e.startsWith("Moyenne de ")?e.substring(11):e.startsWith("Somme de ")?e.substring(9):e.startsWith("Sum of ")?e.substring(7):e.startsWith("Average of ")?e.substring(11):e}static getFieldType(e){return e.numeric?"esriFieldTypeDouble":e.integer?"esriFieldTypeInteger":e.bool?"esriFieldTypeBoolean":"esriFieldTypeString"}static hasSameKeys(e,t){return!(!e||!t)&&Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((e=>t.hasOwnProperty(e)))}static getFieldKeys(e){const t={};if(void 0===e)return t;for(let s=0;s<e.length;s++)t[e[s].name]=!0;return t}}},247:(e,t,s)=>{"use strict";s.d(t,{S:()=>l});var i=s(674),a=s(324),o=i.z.Tn,n=i.z.Kx;class r extends o{desc=new i.z.uI({name:"desc",displayName:"Product Version",value:a.visual.version});url=new i.z.ks({name:"url",displayName:"Galigeo URL",placeholder:"https://powerbi.galigeo.com/Galigeo",value:"https://powerbi.galigeo.com/Galigeo"});apiKey=new i.z.ks({name:"apiKey",displayName:"API Key",placeholder:"Put your API key here",value:"To be completed"});mapId=new i.z.ks({name:"mapId",displayName:"Identifier of the map",placeholder:"Put the identifier of the map here",value:""});highlight=new i.z.jF({name:"highlight",displayName:"Allow map interactions",value:!0});infowindow=new i.z.jF({name:"infowindow",displayName:"Display the infowindow",value:!0});name="galigeo";displayName="Galigeo config";slices=[this.desc,this.url,this.apiKey,this.mapId,this.highlight,this.infowindow]}class l extends n{settingCard=new r;cards=[this.settingCard];getGeneralSetting(e){return this.settingCard[e]?.value}}},510:(e,t,s)=>{"use strict";s.d(t,{b:()=>r});var i=s(674),a=s(247),o=s(231),n=s(96);class r{target;updateCount;textNode;formattingSettings;formattingSettingsService;settings;element;selectionManager;visualConstructorOptions;dataPoints={};listenersRegistered=!1;previousOpenMapData;previousSettings={};previoudFieldsMap={};previousState="";map;onDuplicateMap=!1;constructor(e){console.log("Visual constructor",e),this.formattingSettingsService=new i.O,this.target=e.element,this.updateCount=0,document&&(console.log("Visual constructor",e),this.visualConstructorOptions=e,this.element=e.element,this.showWelcomePage(e.element),this.selectionManager=this.visualConstructorOptions.host.createSelectionManager(),this.selectionManager.clear()),window.addEventListener("message",(async e=>{e?.data?.openUrl&&this.visualConstructorOptions.host.launchUrl(e.data.openUrl)}))}getMapId(){let e=this.settings.getGeneralSetting("mapId");if(!e||e.length<3){e="map"+Date.now().toString(),console.log("Generate mapId",e);const t={objectName:"galigeo",selector:void 0,properties:{mapId:e}};this.visualConstructorOptions.host.persistProperties({merge:[t]})}return e.replace(/[^a-z0-9]/gi,"")}update(e){if(4===e.type)return;this.onDuplicateMap=!1,this.formattingSettings=this.formattingSettingsService.populateFormattingSettingsModel(a.S,e.dataViews[0]),this.settings=this.formattingSettings,console.log("Visual update",e),console.log("Visual update",e,this.settings,this.settings.getGeneralSetting("mapId"));const t=new Array;for(const s of e.dataViews){const e=s;t.push(n.A.getDataset(e))}if("to be completed"===this.settings.getGeneralSetting("apiKey").toLowerCase()||this.settings.getGeneralSetting("apiKey").length<3){if("missingApiKey"===this.previousState)return;return this.previousState="missingApiKey",void this.showWelcomePage(this.element,"missingApiKey")}const s=new o.$h;s.name=this.settings.getGeneralSetting("mapId"),s.mapId=this.getMapId(),s.user=e.viewMode?"Creator":"Viewer",s.profile=e.viewMode?"Designer":"Viewer",s.lang=navigator.language,s.data=t,s.apiKey=this.settings.getGeneralSetting("apiKey"),s.url=this.settings.getGeneralSetting("url"),s.crossDomain=!0,s.listenExternalLinks=!0,s.parent="PowerBI";let i=this.previousOpenMapData&&(this.previousOpenMapData.apiKey!==s.apiKey||this.previousOpenMapData.profile!==s.profile||this.previousOpenMapData.url!==s.url||this.settings.getGeneralSetting("highlight")!==this.previousSettings?.highlight||this.settings.getGeneralSetting("infowindow")!==this.previousSettings?.infowindow||"ok"!==this.previousState);this.previousOpenMapData&&this.previousOpenMapData.mapId!==s.mapId&&this.map?.refreshId&&this.createDuplicateModal(s,e),this.previousState="ok",n.A.hasSameKeys(this.previoudFieldsMap,n.A.getFieldKeys(t[0].fields))||(console.log("Change in fields map"),i=!0),this.previousOpenMapData=s,this.previousSettings.highlight=this.settings.getGeneralSetting("highlight"),this.previousSettings.infowindow=this.settings.getGeneralSetting("infowindow"),this.previoudFieldsMap=n.A.getFieldKeys(t[0].fields);const r=document.getElementById("galigeoWelcome");r&&(r.style.display="none"),this.onDuplicateMap||(this.map?.refreshId&&!i?this.map.update(s).then((()=>{this.registerMap2Report(e),this.map.refresh()})):(this.map=new o.T5(this.element.id,s),this.map.load().then((()=>{this.listenersRegistered=!1,this.registerMap2Report(e)}))))}createDuplicateModal(e,t){this.onDuplicateMap=!0,document.getElementById("ggo-modal")&&document.getElementById("ggo-modal").remove();const s=document.createElement("div");s.id="ggo-modal",s.className="ggo-modal",s.style.position="fixed",s.style.zIndex="1",s.style.paddingTop="50px",s.style.left="0",s.style.top="0",s.style.width="100%",s.style.height="100%",s.style.overflow="auto",s.style.backgroundColor="rgba(0,0,0,0.4)",s.style.display="block";const i=document.createElement("div");i.id="ggo-modal-content",i.className="ggo-modal-content",i.style.backgroundColor="#fefefe",i.style.margin="auto",i.style.padding="20px",i.style.border="1px solid #888",i.style.width="80%",i.style.height="80%",i.style.overflow="auto",i.style.position="relative",i.style.display="block",i.style.borderRadius="10px";const a=document.createElement("h2");a.innerText="Duplicate map",i.appendChild(a);const n=document.createElement("p");n.innerText="A change has been detected in the map ID. You can duplicate the map to keep the current configuration.";const r=document.createElement("input");r.type="text",r.value=this.getMapId(),r.style.width="100%",r.style.padding="10px",r.style.margin="10px 0",r.style.border="1px solid #ccc",r.style.boxSizing="border-box";const l=document.createElement("div");l.style.display="flex",l.style.flexDirection="row",l.style.width="100%";const d=document.createElement("button");d.innerText="Duplicate",d.style.padding="10px",d.style.margin="10px 0",d.style.border="1px solid #ccc",d.style.width="100px",d.style.backgroundColor="#4CAF50",d.style.color="white";const c=document.createElement("button");c.innerText="Cancel",c.style.padding="10px",c.style.margin="10px 0",c.style.border="1px solid #ccc",c.style.width="100px",c.addEventListener("click",(()=>{s.remove(),this.map=new o.T5(this.element.id,e),this.map.load().then((()=>{this.listenersRegistered=!1,this.registerMap2Report(t)})),this.onDuplicateMap=!1})),d.addEventListener("click",(()=>{const i=new XMLHttpRequest,a=document.getElementById("galigeoMap");i.open("GET",new URLSearchParams(a.src).get("url")+"/duplicate?name="+this.getMapId(),!1),console.log("loaded"),i.send(null),console.log("sent"),console.log("New map ID: "+JSON.parse(i.response).docId),e.mapId=JSON.parse(i.response).docId,this.map=new o.T5(this.element.id,e),this.map.load().then((()=>{this.listenersRegistered=!1,this.registerMap2Report(t)})),s.remove(),this.onDuplicateMap=!1})),i.appendChild(n),i.appendChild(r),l.appendChild(d),l.appendChild(c),i.appendChild(l),s.appendChild(i),this.element.appendChild(s)}registerMap2Report(e){const t=this.setupFilter(e);this.settings.getGeneralSetting("highlight")&&!this.listenersRegistered&&(this.listenersRegistered=!0,this.map.addEventListener("contextmenu",(e=>{console.log("Context menu on ",e),this.selectionManager.showContextMenu({},{x:e.x,y:e.y})})),this.listenersRegistered=!0,this.map.getLayers().then((e=>{for(const s of e)s.isIssuedFromAPIData()&&(console.log(`Listen interactions from layer ${s.getName()}`),this.settings.getGeneralSetting("infowindow")||s.disableInfoWindow(),s.addEventListener("click",(e=>{const s=[],i={};for(const a of Object.keys(e)){const o=e[a];if(!o?.properties)return;let n=o.properties[t];if(void 0===n&&(n=o.properties[t.toLowerCase().replace(/\s/g,"")]),n&&!i[n]){const e=this.dataPoints[n];s.push(...e),i[n]=1}}console.log("Click on "+Object.keys(e).length+" entities of "+t+". "+s.length+" objects will be selected."),this.selectionManager.select(s),console.log("Selection done"),this.showClearSelectionButton(this.element)})))})))}setupFilter(e){if(!e.dataViews||0===e.dataViews.length)return"Error";const t=e.dataViews[0]?.categorical.categories,s=t[0],i=s.values.length;this.dataPoints={};for(let e=0;e<i;e++){const t=s.values[e],i=this.visualConstructorOptions.host.createSelectionIdBuilder().withCategory(s,e).createSelectionId(),a=this.dataPoints[t+""];a?a.push(i):this.dataPoints[t+""]=[i]}return t[0].source.displayName}showClearSelectionButton(e){const t=document.getElementById("ggo-clear-selection");if(t)t.style.display="block";else{const t=document.createElement("button");t.value="clear",t.innerText=navigator.language.indexOf("fr")>=0?"Supprimer la sélection":"Clear selection",t.id="ggo-clear-selection",t.setAttribute("style","position:fixed;bottom:0px;left:0px;display:block"),t.addEventListener("click",(()=>{this.selectionManager.clear(),this.hideClearSelectionButton()})),e.appendChild(t)}}hideClearSelectionButton(){const e=document.getElementById("ggo-clear-selection");e&&e.remove()}showWelcomePage(e,t="missingApiKey"){const s=`https://api.galigeo.com/services/powerbi?action=${t}`;for(console.log("Show welcome page",s);e.lastElementChild;)e.removeChild(e.lastElementChild);e.insertAdjacentHTML("beforeend",`<iframe id="galigeoWelcome" style="height: 100%;width:100%;border:none" src="${s}">`)}getFormattingModel(){return this.formattingSettingsService.buildFormattingModel(this.formattingSettings)}}},754:(e,t,s)=>{"use strict";s.d(t,{Kx:()=>n,St:()=>r,Tn:()=>l,jF:()=>c,ks:()=>p,uI:()=>g});var i=s(639);class a{}class o extends a{}class n{}class r extends a{}class l extends o{}class d extends a{constructor(e){super(),Object.assign(this,e)}getFormattingSlice(e,t){const s=this.type,i=this.name,a={displayName:t&&this.displayNameKey?t.getDisplayName(this.displayNameKey):this.displayName,description:t&&this.descriptionKey?t.getDisplayName(this.descriptionKey):this.description,uid:e+"-"+i};return Object.assign(Object.assign({},a),{control:{type:s,properties:this.getFormattingComponent(e,t)}})}getFormattingComponent(e,t){return{descriptor:i.y(e,this),value:this.value}}getRevertToDefaultDescriptor(e){return[{objectName:e,propertyName:this.name}]}setPropertiesValues(e,t){var s;let a=null===(s=null==e?void 0:e[t])||void 0===s?void 0:s[this.name];this.value=i.D(this,a,this.value)}}class c extends d{constructor(e){super(e),this.type="ToggleSwitch"}}class p extends d{constructor(e){super(e),this.type="TextInput"}getFormattingComponent(e){return Object.assign(Object.assign({},super.getFormattingComponent(e)),{placeholder:this.placeholder})}}class g extends d{constructor(){super(...arguments),this.type="ReadOnlyText"}}},667:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var i=s(754);const a=class{constructor(e){this.localizationManager=e}populateFormattingSettingsModel(e,t){var s,a;let o=new e,n=null===(s=null==t?void 0:t.metadata)||void 0===s?void 0:s.objects;return n&&(null===(a=o.cards)||void 0===a||a.forEach((e=>{var t;e instanceof i.St&&(null===(t=e.topLevelSlice)||void 0===t||t.setPropertiesValues(n,e.name)),(e instanceof i.Tn?[e]:e.groups).forEach((t=>{var s,i,a,o;null===(s=t.topLevelSlice)||void 0===s||s.setPropertiesValues(n,e.name),null===(i=null==t?void 0:t.slices)||void 0===i||i.forEach((t=>{null==t||t.setPropertiesValues(n,e.name)})),null===(o=null===(a=null==t?void 0:t.container)||void 0===a?void 0:a.containerItems)||void 0===o||o.forEach((t=>{var s;null===(s=null==t?void 0:t.slices)||void 0===s||s.forEach((t=>{null==t||t.setPropertiesValues(n,e.name)}))}))}))}))),o}buildFormattingModel(e){let t={cards:[]};return e.cards.filter((({visible:e=!0})=>e)).forEach((e=>{var s;let a={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,groups:[],uid:e.name+"-card",analyticsPane:e.analyticsPane};const o=e.name;if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(o,this.localizationManager);t.suppressDisplayName=!0,a.topLevelToggle=t}null===(s=e.onPreProcess)||void 0===s||s.call(e);const n=e instanceof i.Tn;(n?[e].filter((({visible:e=!0})=>e)):e.groups.filter((({visible:e=!0})=>e))).forEach((e=>{const t=e.name+"-group",s={displayName:n?void 0:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,description:n?void 0:this.localizationManager&&e.descriptionKey?this.localizationManager.getDisplayName(e.descriptionKey):e.description,slices:[],uid:t,collapsible:e.collapsible,delaySaveSlices:e.delaySaveSlices,disabled:e.disabled,disabledReason:e.disabledReason};a.groups.push(s);const i={};if(e.container){const a=e.container,n=t+"-container",r={displayName:this.localizationManager&&a.displayNameKey?this.localizationManager.getDisplayName(a.displayNameKey):a.displayName,description:this.localizationManager&&a.descriptionKey?this.localizationManager.getDisplayName(a.descriptionKey):a.description,containerItems:[],uid:n};a.containerItems.forEach((e=>{const t=e.displayNameKey?e.displayNameKey:e.displayName,s=n+t;let a={displayName:this.localizationManager&&e.displayNameKey?this.localizationManager.getDisplayName(e.displayNameKey):e.displayName,slices:[],uid:s};this.buildFormattingSlices({slices:e.slices,objectName:o,sliceNames:i,formattingSlices:a.slices}),r.containerItems.push(a)})),s.container=r}if(e.slices){if(e.topLevelSlice){let t=e.topLevelSlice.getFormattingSlice(o,this.localizationManager);t.suppressDisplayName=!0,(null==s.displayName?a:s).topLevelToggle=t}this.buildFormattingSlices({slices:e.slices,objectName:o,sliceNames:i,formattingSlices:s.slices})}})),a.revertToDefaultDescriptors=this.getRevertToDefaultDescriptor(e),t.cards.push(a)})),t}buildFormattingSlices({slices:e,objectName:t,sliceNames:s,formattingSlices:i}){null==e||e.filter((({visible:e=!0})=>e)).forEach((e=>{let a=null==e?void 0:e.getFormattingSlice(t,this.localizationManager);a&&(void 0===s[e.name]?s[e.name]=0:(s[e.name]++,a.uid=`${a.uid}-${s[e.name]}`),i.push(a))}))}getRevertToDefaultDescriptor(e){var t;const s={};let a,o=[],n=[];return e instanceof i.St&&e.topLevelSlice&&o.push(...null===(t=e.topLevelSlice)||void 0===t?void 0:t.getRevertToDefaultDescriptor(e.name)),(e instanceof i.Tn?[e].filter((({visible:e=!0})=>e)):e.groups.filter((({visible:e=!0})=>e))).forEach((t=>{var i,r;a=this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,s,t.topLevelSlice),null===(r=null===(i=t.container)||void 0===i?void 0:i.containerItems)||void 0===r||r.forEach((t=>{n=n.concat(this.getSlicesRevertToDefaultDescriptor(e.name,t.slices,s))})),o.push(...a.concat(n))})),o}getSlicesRevertToDefaultDescriptor(e,t,s,i){let a=[];return i&&(s[i.name]=!0,a=a.concat(i.getRevertToDefaultDescriptor(e))),null==t||t.forEach((t=>{t&&!s[t.name]&&(s[t.name]=!0,a=a.concat(t.getRevertToDefaultDescriptor(e)))})),a}}},674:(e,t,s)=>{"use strict";s.d(t,{O:()=>a.A,z:()=>i});var i=s(754),a=s(667)},639:(e,t,s)=>{"use strict";function i(e,t){return{objectName:e,propertyName:t.name,selector:t.selector,altConstantValueSelector:t.altConstantSelector,instanceKind:t.instanceKind}}function a(e,t,s){return null==t||"object"==typeof t&&!t.solid?s:t.solid?{value:null==t?void 0:t.solid.color}:(null==e?void 0:e.items)?e.items.find((e=>e.value==t)):t}s.d(t,{D:()=>a,y:()=>i})}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";s.r(i),s.d(i,{default:()=>o});var e=s(510),t=window.powerbi,a={name:"GaligeoPowerBI",displayName:"Galigeo for PowerBI (2.0.0.4)",class:"Visual",apiVersion:"5.11.0",create:t=>{if(e.b)return new e.b(t);throw"Visual instance not found"},createModalDialog:(e,t,s)=>{const i=globalThis.dialogRegistry;e in i&&new i[e](t,s)},custom:!0};void 0!==t&&(t.visuals=t.visuals||{},t.visuals.plugins=t.visuals.plugins||{},t.visuals.plugins.GaligeoPowerBI=a);const o=a})(),GaligeoPowerBI=i})();