!function(t){"";function e(t){var e=t.filter(function(t){return t&&t instanceof Date});if(0===e.length)return function(t){return t+""};var n=e.map(function(t){return t.getFullYear()}),r=e.map(function(t){return t.getMonth()}),i=e.map(function(t){return t.getDate()}),o=e.map(function(t){return t.getHours()}),a=e.map(function(t){return t.getMinutes()}),s=e.map(function(t){return t.getSeconds()}),u=function(t){var e=t[0];return t.every(function(t){return t===e})},l=function(t){return t.every(function(t){return 0===t})},c=function(t){return 10>t?"0"+t:t},h=function(t){return c(t.getHours())+":"+c(t.getMinutes())},f=function(t){return h(t)+":"+c(t.getSeconds())},p=function(t){return t.getDate()+"/"+(t.getMonth()+1)},d=function(t){return p(t)+"/"+t.getFullYear()};return u(n)?l(s)?l(a)&&l(o)?function(t){return d(t)}:function(t){return p(t)+" "+h(t)}:function(t){return p(t)+" "+f(t)}:l(s)?l(a)&&l(o)?u(i)?u(r)?function(t){return t.getFullYear()+""}:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)}:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}:function(t){return d(t)+" "+h(t)}:function(t){return d(t)+" "+f(t)}}function n(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n={},r=0,i=t;r<i.length;r++){var o=i[r];for(var a in o)n[a]=!0}return Object.keys(n)}function r(t,e){e=e||{};for(var n in t)e[n]=t[n];return e}function i(t,e,n){return e>t?e:t>n?n:t}function o(t,e,n){var r={};if(e)for(var i=0,o=t;i<o.length;i++){var a=o[i];r[e(a)]=n?n(a):a}else for(var s=0,u=t;s<u.length;s++){var a=u[s];r[a]=a}return r}function a(t,e){for(var n=[],r=t+e;r>t;t++)n.push(t);return n}function s(t,e){var n={};return n[t]=e,n}function u(t,e){for(var n=0,r=t;n<r.length;n++){var i=r[n];if(e(i))return i}}function l(t,e){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r],a=e(o);a in n?n[a].push(o):n[a]=[o]}return n}function c(t,e,n){var r=[];if(n)return t.filter(n).map(e);for(var i=0,o=t;i<o.length;i++){var a=o[i],s=e(a);void 0!==s&&null!==s&&r.push(s)}return r}function h(t){return Object.keys(t).map(function(e){return t[e]})}function f(t,e){for(var n={},r=0,i=e;r<i.length;r++){var o=i[r];n[o]=t[o]}return n}function p(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ot&&e.documentElement.namespaceURI===Ot?e.createElement(t):e.createElementNS(n,t)}}function d(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function m(t,e,n){return t=v(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function v(t,e,n){return function(r){var i=Ut;Ut=r;try{t.call(this,this.__data__,e,n)}finally{Ut=i}}}function _(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}function g(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;o>r;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function y(t,e,n){var r=Wt.hasOwnProperty(t.type)?m:v;return function(i,o,a){var s,u=this.__on,l=r(e,o,a);if(u)for(var c=0,h=u.length;h>c;++c)if((s=u[c]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=l,s.capture=n),void(s.value=e);this.addEventListener(t.type,l,n),s={type:t.type,name:t.name,value:e,listener:l,capture:n},u?u.push(s):this.__on=[s]}}function w(){}function b(){return[]}function x(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function M(t,e,n,r,i,o){for(var a,s=0,u=e.length,l=o.length;l>s;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new x(t,o[s]);for(;u>s;++s)(a=e[s])&&(i[s]=a)}function A(t,e,n,r,i,o,a){var s,u,l,c={},h=e.length,f=o.length,p=new Array(h);for(s=0;h>s;++s)(u=e[s])&&(p[s]=l=oe+a.call(u,u.__data__,s,e),l in c?i[s]=u:c[l]=u);for(s=0;f>s;++s)l=oe+a.call(t,o[s],s,o),(u=c[l])?(r[s]=u,u.__data__=o[s],c[l]=null):n[s]=new x(t,o[s]);for(s=0;h>s;++s)(u=e[s])&&c[p[s]]===u&&(i[s]=u)}function E(t,e){return e>t?-1:t>e?1:t>=e?0:NaN}function S(t){return function(){this.removeAttribute(t)}}function k(t){return function(){this.removeAttributeNS(t.space,t.local)}}function C(t,e){return function(){this.setAttribute(t,e)}}function T(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function z(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function I(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function D(t){return function(){this.style.removeProperty(t)}}function j(t,e,n){return function(){this.style.setProperty(t,e,n)}}function F(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function N(t,e){return t.style.getPropertyValue(e)||ge(t).getComputedStyle(t,null).getPropertyValue(e)}function P(t){return function(){delete this[t]}}function O(t,e){return function(){this[t]=e}}function B(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function L(t){return t.trim().split(/^|\s+/)}function H(t){return t.classList||new G(t)}function G(t){this._node=t,this._names=L(t.getAttribute("class")||"")}function R(t,e){for(var n=H(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function V(t,e){for(var n=H(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function q(t){return function(){R(this,t)}}function W(t){return function(){V(this,t)}}function U(t,e){return function(){(e.apply(this,arguments)?R:V)(this,t)}}function J(){this.textContent=""}function Z(t){return function(){this.textContent=t}}function Y(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function K(){this.innerHTML=""}function X(t){return function(){this.innerHTML=t}}function Q(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function $(){this.nextSibling&&this.parentNode.appendChild(this)}function tt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function et(){return null}function nt(){var t=this.parentNode;t&&t.removeChild(this)}function rt(t,e,n){var r=ge(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function it(t,e){return function(){return rt(this,t,e)}}function ot(t,e){return function(){return rt(this,t,e.apply(this,arguments))}}function at(t,e){this._groups=t,this._parents=e}function st(){return new at([[document.documentElement]],Ie)}function ut(t){var e=ht(t);if(!e)return null;for(var n=e.longitude,r=e.latitude,i=e.positive,o=0,a=0,s=0,u=0,l=0,c=[],h=0;h<t.length;h++){var f=t[h];if(f){l++;var p=f.longitude,d=f.latitude;d>r?u=Math.max(u,d-r):s=Math.max(s,r-d),i?p>n?a=Math.max(a,p-n):n-p>p+360-n?(a=Math.max(p+360-n,a),c[h]=1):o=Math.max(n-p,o):n>p?o=Math.max(n-p,o):p-n>n-(p-360)?(o=Math.max(n-(p-360),o),c[h]=-1):a=Math.max(p-n,a)}}return 1>=l&&(a=o=s=u=.1),{anchor:{longitude:n,latitude:r},margin:{east:a,west:o,south:s,north:u},offsets:c}}function lt(t,e){if(t=(t||[]).filter(function(t){return!!t}),0===t.length)return{zoom:mt(e.width,e.height),center:new Microsoft.Maps.Location(0,0)};var n=Math.max.apply(Math,t.map(function(t){return t.anchor.latitude+t.margin.north})),r=Math.min.apply(Math,t.map(function(t){return t.anchor.latitude-t.margin.south})),o=Math.min.apply(Math,t.map(function(t){return t.anchor.longitude-t.margin.west})),a=Math.max.apply(Math,t.map(function(t){return t.anchor.longitude+t.margin.east}));r=i(r,-88,88),n=i(n,-88,88);for(var s=Microsoft.Maps.LocationRect.fromCorners(new Microsoft.Maps.Location(n,o),new Microsoft.Maps.Location(r,a)),u=Math.abs(Oe.lat2y(n,20)-Oe.lat2y(r,20)),l=Oe.lon2x(s.width-180,20),c=20;c>1&&!(l<e.width&&u<e.height);c--)l/=2,u/=2;return{zoom:c,center:s.center}}function ct(t,e){var n=t.getZoom(),r=e.anchor,i=e.margin,o=new Microsoft.Maps.Location(r.latitude,r.longitude),a=t.tryLocationToPixel(o),s=Oe.lon2x(i.east-180,n),u=Oe.lon2x(i.west-180,n),l=t.getWidth(),c=a.x+l/2-u,h=Oe.mapSize(n),f=s/2+u/2;return 0>c?l-c-h>f?(a.x+=h,a):a:c>l-f?c+f-h>0?(a.x-=h,a):c>l?(a.x-=h,a):a:a}function ht(t){if(!t||0===t.length)return null;for(var e=0,n=0,r=0,i=0,o=0,a=0;a<t.length;a++){var s=t[a];if(s){var u=s.longitude,l=s.latitude;o+=l,u>0?(e++,r+=u):(n++,i+=u)}}if(0===e&&0===n)return null;var c=r+i>0;return{longitude:c?r/e:i/n,latitude:o/t.length,positive:c}}function ft(t,e){void 0===e&&(e=20);var n=ut(t);if(!ut)return null;for(var r=n.offsets,i=n.anchor,o=i.longitude,a=i.latitude,s=Oe.lon2x(180,e),u=Oe.lon2x(o,e),l=Oe.lat2y(a,e),c=[],h=0;h<t.length;h++){var f=t[h];if(f){var p=Math.round(Oe.lon2x(f.longitude,e)-u),d=Math.round(Oe.lat2y(f.latitude,e)-l);c.push({x:p+(r[h]||0)*s,y:d})}else c.push(null)}return n.points=c,n.scale=function(t){return Math.pow(2,t-e)},n}function pt(t,e){return"number"==typeof t?"translate("+t+","+e+")":"translate("+t.x+","+t.y+")"}function dt(t){return"scale("+t+")"}function mt(t,e){for(var n=Math.min(t,e),r=1;20>r&&!(256*Math.pow(2,r)>n);r++);return r}function vt(t,e,n){var r=new Microsoft.Maps.Location(e.latitude,e.longitude);return t.tryLocationToPixel(r,n)}function _t(t,e,n){var r={credentials:"ArGDNgzMeXDeuUUj07chAShxzkvmjJJafgCRkdMOfx5h8fqvXAUMT0cQ1iNvFYBw",showDashboard:!1,showTermsLink:!1,showLogo:!1,customMapStyle:yt(e),disablePanning:!e.pan,disableZooming:!e.zoom,mapTypeId:gt(e)};return t?(r.center=t.getCenter(),r.zoom=t.getZoom()):(r.center=new Microsoft.Maps.Location(0,0),r.zoom=mt(n.offsetWidth,n.offsetHeight)),r}function gt(t){switch(t.type){case"aerial":return Microsoft.Maps.MapTypeId.aerial;case"road":return Microsoft.Maps.MapTypeId.road;case"canvasDark":return Microsoft.Maps.MapTypeId.canvasDark;case"canvasLight":return Microsoft.Maps.MapTypeId.canvasLight;case"grayscale":return Microsoft.Maps.MapTypeId.grayscale}}function yt(t){var e={labelVisible:!1,visible:!1},n={visible:!0,labelVisible:t.label},r={version:"1.0",elements:{highSpeedRamp:e,ramp:e,unpavedStreet:e,tollRoad:e,trail:e}};return t.building||(r.elements.structure={visible:!1},r.elements.building={visible:!1}),r.elements.mapElement={labelVisible:t.label},r.elements.political={labelVisible:t.label,visible:!0},r.elements.district={labelVisible:t.label,visible:!0},"gray"===t.road||"gray_label"===t.road?(r.elements.transportation={visible:!0,labelVisible:"gray_label"===t.road,fillColor:"#DDDDDD",strokeColor:"#AAAAAA",labelOutlineColor:"#EEEEEE"},r.elements.street={visible:!0,labelVisible:"gray_label"===t.road,fillColor:"#EEEEEE",strokeColor:"#DDDDDD",labelOutlineColor:"#DDDDDD"}):"hidden"===t.road&&(r.elements.transportation=e),r.elements.point=t.icon?n:e,r.elements.vegetation=t.forest?n:e,r.elements.populatedPlace={labelVisible:t.city,visible:t.icon},r.elements.area=t.area?n:e,r}function wt(){Re={},Ve=[],qe=0,clearTimeout(We),We=null}function bt(){try{var t=window.window.onerror||function(){};window.window.onerror=function(e,n,r,i,o){return-1!=n.indexOf(Ue.BingURL)||-1!=n.indexOf(Ue.BingUrlGeodata)?!1:void t(e,n,r,i,o)}}catch(e){console.log(e)}}function xt(t,e){var n=e.x-t.x,r=e.y-t.y,i=Math.sqrt(n*n+r*r);return[n/i,r/i]}function Mt(t){return null===t||void 0===t||isNaN(t)}function At(t){Je=t}function Et(){return h(nn)}function St(t){Ze=t}function kt(t){return Ye=t,{transform:function(t,e,n){Et().forEach(function(e){return e.transform(t)})}}}function Ct(t){Ye.selectAll("*").remove(),nn={};for(var e in t){var n=new tn(t[e],e),r=new rn(n,Ye.append("g"),Ke.map.getZoom());nn[n.group]=r}}function Tt(t,e,n){Xe=e,un=je(t),un.append("div").attr("id","view").style("width","100%").style("height","100%"),un.append("div").attr("id","legend").style("position","absolute").style("top","0px").style("left","0px"),ln=new $e(un.select("#legend")),Ke=new Ge(un.select("#view").node()),Ke.restyle(He.build(Xe.mapControl,Xe.mapElement),function(t){zt(),Ke.svg.style("cursor","default").style("pointer-events","visiblePainted"),Ke.add({resize:function(t){return zt()}}),Ke.add(kt(Ke.svg.append("g"))),n(t)})}function zt(){var t=Xe.legend,e=t.show,n=t.position,r=(Ke.map.getWidth(),Ke.map.getHeight()),i=e?ln.height():0,o="top"===n?null:r-i+2+"px";un.select("#legend").style("margin-top",o).style("display",e?null:"none")}function It(){if(Xe.mapControl.autofit&&Et().length>=1){var t=cn.selection.flags(),e=c(Et(),function(e){return e.bound(t)});e&&e.length>0&&Ke.fitView(e)}}function Dt(t){zt(),Ct(t),ln.update();var e=He.build(Xe.mapElement,Xe.mapControl);Ke.restyle(e,function(t){return zt()})}function jt(t,e){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r],a=e(o);a in n?n[a].push(o):n[a]=[o]}return n}function Ft(t){var e={};if(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],a=0,s=n(o.source.roles);a<s.length;a++){var u=s[a];e[u]?e[u].push(o):e[u]=[o]}return e}return e}var Nt;!function(t){function e(e){t.visualhost=e}function n(){return t.visualhost.createSelectionManager()}function r(e,n){return t.visualhost.createSelectionIdBuilder().withCategory(e,+n).createSelectionId()}function i(e,n){t.visualhost.persistProperties({merge:[{objectName:e,properties:n,selector:null}]})}function o(t){return Pt.dirty(t)}t.init=e,t.selectionManager=n,t.id=r,t.persist=i,t.dirtyPersist=o}(Nt||(Nt={}));var Pt=function(){function t(e,n){this.oname=e,this.pname=n,this.handler=void 0,this.stamp=void 0,this._value=null,t._all.push(this)}return t.dirty=function(e){for(var n=!1,r=0,i=t._all;r<i.length;r++){var o=i[r];o._updated(e)&&(n=!0)}return n},t.prototype._updated=function(t){var e=this.oname,n=this.pname,r=t&&t.metadata&&t.metadata.objects;if(r&&r[e]&&r[e][n]){var i=r[e][n],o=i.slice(0,13);if(o!==this.stamp)return this.stamp=o,!0}else this.stamp&&console.log("#########"+this.oname+" => "+this.pname+"############## cannot persist, forget to add it to capabilities.json??");return!1},t.prototype.read=function(t,e){var n=this.oname,r=this.pname,i=t&&t.metadata&&t.metadata.objects;if(i&&i[n]&&i[n][r]){var o=i[n][r];this.stamp=o.slice(0,13);var a=o.slice(13);return JSON.parse(a)}return e||null},t.prototype.run=function(t,e){var n=this,r=this.oname,i=this.pname;this.handler&&clearTimeout(this.handler),this.handler=window.setTimeout(function(){var e={},o=(new Date).getTime();e[i]=o+" running persist",t.merge.push({objectName:r,properties:e,selector:null}),Nt.visualhost.persistProperties(t),n.handler=null},e)},t.prototype.value=function(t){return void 0===t?this._value:(this._value=t,this)},t.prototype.write=function(t,e){var n=this;this._value=t;var r=this.oname,i=this.pname;this.handler&&clearTimeout(this.handler),this.handler=window.setTimeout(function(){var e={},o=(new Date).getTime();e[i]=o+JSON.stringify(t),null===t?Nt.visualhost.persistProperties({remove:[{objectName:r,properties:{pname:null},selector:null}]}):Nt.visualhost.persistProperties({merge:[{objectName:r,properties:e,selector:null}]}),n.handler=null},e)},t._all=[],t}(),Ot="http://www.w3.org/1999/xhtml",Bt={svg:"http://www.w3.org/2000/svg",xhtml:Ot,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Lt=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Bt.hasOwnProperty(e)?{space:Bt[e],local:t}:t},Ht=function(t){var e=Lt(t);return(e.local?d:p)(e)},Gt=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var Rt=document.documentElement;if(!Rt.matches){var Vt=Rt.webkitMatchesSelector||Rt.msMatchesSelector||Rt.mozMatchesSelector||Rt.oMatchesSelector;Gt=function(t){return function(){return Vt.call(this,t)}}}}var qt=Gt,Wt={},Ut=null;if("undefined"!=typeof document){var Jt=document.documentElement;"onmouseenter"in Jt||(Wt={mouseenter:"mouseover",mouseleave:"mouseout"})}var Zt=function(t,e,n){var r,i,o=_(t+""),a=o.length;{if(!(arguments.length<2)){for(s=e?y:g,null==n&&(n=!1),r=0;a>r;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var u,l=0,c=s.length;c>l;++l)for(r=0,u=s[l];a>r;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value}},Yt=function(){for(var t,e=Ut;t=e.sourceEvent;)e=t;return e},Kt=function(t,e){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]},Xt=function(t){return null==t?w:function(){return this.querySelector(t)}},Qt=function(t){"function"!=typeof t&&(t=Xt(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;n>i;++i)for(var o,a,s=e[i],u=s.length,l=r[i]=new Array(u),c=0;u>c;++c)(o=s[c])&&(a=t.call(o,o.__data__,c,s))&&("__data__"in o&&(a.__data__=o.__data__),l[c]=a);return new at(r,this._parents)},$t=function(t){return null==t?b:function(){return this.querySelectorAll(t)}},te=function(t){"function"!=typeof t&&(t=$t(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;n>o;++o)for(var a,s=e[o],u=s.length,l=0;u>l;++l)(a=s[l])&&(r.push(t.call(a,a.__data__,l,s)),i.push(a));return new at(r,i)},ee=function(t){"function"!=typeof t&&(t=qt(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;n>i;++i)for(var o,a=e[i],s=a.length,u=r[i]=[],l=0;s>l;++l)(o=a[l])&&t.call(o,o.__data__,l,a)&&u.push(o);return new at(r,this._parents)},ne=function(t){return new Array(t.length)},re=function(){return new at(this._enter||this._groups.map(ne),this._parents)};x.prototype={constructor:x,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var ie=function(t){return function(){return t}},oe="$",ae=function(t,e){if(!t)return p=new Array(this.size()),l=-1,this.each(function(t){p[++l]=t}),p;var n=e?A:M,r=this._parents,i=this._groups;"function"!=typeof t&&(t=ie(t));for(var o=i.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;o>l;++l){var c=r[l],h=i[l],f=h.length,p=t.call(c,c&&c.__data__,l,r),d=p.length,m=s[l]=new Array(d),v=a[l]=new Array(d),_=u[l]=new Array(f);n(c,h,m,v,_,p,e);for(var g,y,w=0,b=0;d>w;++w)if(g=m[w]){for(w>=b&&(b=w+1);!(y=v[b])&&++b<d;);g._next=y||null}}return a=new at(a,r),a._enter=s,a._exit=u,a},se=function(){return new at(this._exit||this._groups.map(ne),this._parents)},ue=function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;o>s;++s)for(var u,l=e[s],c=n[s],h=l.length,f=a[s]=new Array(h),p=0;h>p;++p)(u=l[p]||c[p])&&(f[p]=u);for(;r>s;++s)a[s]=e[s];return new at(a,this._parents)},le=function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},ce=function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=E);for(var n=this._groups,r=n.length,i=new Array(r),o=0;r>o;++o){for(var a,s=n[o],u=s.length,l=i[o]=new Array(u),c=0;u>c;++c)(a=s[c])&&(l[c]=a);l.sort(e)}return new at(i,this._parents).order()},he=function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},fe=function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},pe=function(){for(var t=this._groups,e=0,n=t.length;n>e;++e)for(var r=t[e],i=0,o=r.length;o>i;++i){var a=r[i];if(a)return a}return null},de=function(){var t=0;return this.each(function(){++t}),t},me=function(){return!this.node()},ve=function(t){for(var e=this._groups,n=0,r=e.length;r>n;++n)for(var i,o=e[n],a=0,s=o.length;s>a;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},_e=function(t,e){var n=Lt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?k:S:"function"==typeof e?n.local?I:z:n.local?T:C)(n,e))},ge=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView},ye=function(t,e,n){return arguments.length>1?this.each((null==e?D:"function"==typeof e?F:j)(t,e,null==n?"":n)):N(this.node(),t)},we=function(t,e){return arguments.length>1?this.each((null==e?P:"function"==typeof e?B:O)(t,e)):this.node()[t]};G.prototype={add:function(t){var e=this._names.indexOf(t);0>e&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var be=function(t,e){var n=L(t+"");if(arguments.length<2){for(var r=H(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?U:e?q:W)(n,e))},xe=function(t){return arguments.length?this.each(null==t?J:("function"==typeof t?Y:Z)(t)):this.node().textContent},Me=function(t){return arguments.length?this.each(null==t?K:("function"==typeof t?Q:X)(t)):this.node().innerHTML},Ae=function(){return this.each($)},Ee=function(){return this.each(tt)},Se=function(t){var e="function"==typeof t?t:Ht(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},ke=function(t,e){var n="function"==typeof t?t:Ht(t),r=null==e?et:"function"==typeof e?e:Xt(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},Ce=function(){return this.each(nt)},Te=function(t){return arguments.length?this.property("__data__",t):this.node().__data__},ze=function(t,e){return this.each(("function"==typeof e?ot:it)(t,e))},Ie=[null];at.prototype=st.prototype={constructor:at,select:Qt,selectAll:te,filter:ee,data:ae,enter:re,exit:se,merge:ue,order:le,sort:ce,call:he,nodes:fe,node:pe,size:de,empty:me,each:ve,attr:_e,style:ye,property:we,classed:be,text:xe,html:Me,raise:Ae,lower:Ee,append:Se,insert:ke,remove:Ce,datum:Te,on:Zt,dispatch:ze};var De,je=function(t){return"string"==typeof t?new at([[document.querySelector(t)]],[document.documentElement]):new at([[t]],Ie)},Fe=function(t){return"string"==typeof t?new at([document.querySelectorAll(t)],[document.documentElement]):new at([null==t?[]:t],Ie)},Ne=function(t,e){null==e&&(e=Yt().touches);for(var n=0,r=e?e.length:0,i=new Array(r);r>n;++n)i[n]=Kt(t,e[n]);return i};!function(t){var e;!function(t){var e;!function(t){function e(){var t="touchstart";return window.PointerEvent&&(t="pointerdown"),t}function n(){var t="touchend";return window.PointerEvent&&(t="pointerup"),t}function r(){var t=e();return"pointerdown"===t||"MSPointerDown"===t}t.touchStartEventName=e,t.touchEndEventName=n,t.usePointerEvents=r}(e=t.touch||(t.touch={}))}(e=t.tooltip||(t.tooltip={}))}(De||(De={})),function(t){var e;!function(t){function e(t,e,i){return void 0===i&&(i=n),new r(t,e,i)}var n=1e3;t.createTooltipServiceWrapper=e;var r=function(){function e(t,e,r){void 0===r&&(r=n),this.visualHostTooltipService=t,this.rootElement=e,this.handleTouchDelay=r}return e.prototype.addTooltip=function(e,n,r,i){var o=this;if(e&&this.visualHostTooltipService.enabled()){var a=this.rootElement;e.on("mouseover.tooltip",function(){if(o.canDisplayTooltip(Ut)){var t=o.makeTooltipEventArgs(a,!0,!1);if(t){var e=n(t);if(null!=e){var i=o.getSelectionIds(t,r);o.visualHostTooltipService.show({coordinates:t.coordinates,isTouchEvent:!1,dataItems:e,identities:i})}}}}),e.on("mouseout.tooltip",function(){o.visualHostTooltipService.hide({isTouchEvent:!1,immediately:!1})}),e.on("mousemove.tooltip",function(){if(o.canDisplayTooltip(Ut)){var t=o.makeTooltipEventArgs(a,!0,!1);if(t){var e;if(!i||(e=n(t),null!=e)){var s=o.getSelectionIds(t,r);o.visualHostTooltipService.move({coordinates:t.coordinates,isTouchEvent:!1,dataItems:e,identities:s})}}}});var s=t.touch.touchStartEventName(),u=t.touch.touchEndEventName(),l=t.touch.usePointerEvents();e.on(s+".tooltip",function(){o.visualHostTooltipService.hide({isTouchEvent:!0,immediately:!0});var t=o.makeTooltipEventArgs(a,l,!0);if(t){var e=n(t),i=o.getSelectionIds(t,r);o.visualHostTooltipService.show({coordinates:t.coordinates,isTouchEvent:!0,dataItems:e,identities:i})}}),e.on(u+".tooltip",function(){o.visualHostTooltipService.hide({isTouchEvent:!0,immediately:!1}),o.handleTouchTimeoutId&&clearTimeout(o.handleTouchTimeoutId),o.handleTouchTimeoutId=setTimeout(function(){o.handleTouchTimeoutId=void 0},o.handleTouchDelay)})}},e.prototype.getSelectionIds=function(t,e){var n=e?e(t):null;return n?[n]:[]},e.prototype.hide=function(){this.visualHostTooltipService.hide({immediately:!0,isTouchEvent:!1})},e.prototype.makeTooltipEventArgs=function(t,e,n){var r=Ut.target,i=je(r).datum(),o=this.getCoordinates(t,e),a=this.getCoordinates(r,e),s={data:i,coordinates:o,elementCoordinates:a,context:r,isTouchEvent:n};return s},e.prototype.canDisplayTooltip=function(t){var e=!0,n=t;if(void 0!==n.buttons){var r=0!==n.buttons;e=!r}return e=e&&null==this.handleTouchTimeoutId},e.prototype.getCoordinates=function(t,e){var n;if(e){for(var r=Ut,i=void 0;i=r.sourceEvent;)r=i;var o=t.getBoundingClientRect();n=[r.clientX-o.left-t.clientLeft,r.clientY-o.top-t.clientTop]}else{var a=Ne(t);a&&a.length>0&&(n=a[0])}return n},e}();t.TooltipServiceWrapper=r}(e=t.tooltip||(t.tooltip={}))}(De||(De={}));var Pe;!function(t){function e(t){o=De.tooltip.createTooltipServiceWrapper(t.host.tooltipService,t.element)}function n(t,e){o.addTooltip(t,e)}function r(){o.hide()}function i(t){}var o=null;t.init=e,t.add=n,t.hide=r,t.setup=i}(Pe||(Pe={}));var Oe,Be=function(){function t(t){this._level=t}return t.prototype.factor=function(t){return Math.pow(2,t-this._level)},t.prototype.line=function(t){for(var e=this.points(t),n=Oe.lon2x(0,this._level),r=e.points,i=null,o=0,a=r;o<a.length;o++){var s=a[o];if(s)if(null===i)i=s;else{var u=i.x-s.x;Math.abs(u)>n&&(s.x+=(u>0?2:-2)*n),i=s}}return e},t.prototype.points=function(t){return ft(t,this._level)},t.prototype.x=function(t){return Oe.lon2x(t,this._level)},t.prototype.y=function(t){return Oe.lat2y(t,this._level)},t}();!function(t){function e(t,e){var r=n(e);return Math.min(t*r+.5,r-1)}function n(t){var e=0;return t===a[0]?e=a[1]:(e=23===t?2147483648:Math.floor(t)==t?256<<t:256*Math.pow(2,t),a=[t,e]),e}function r(t,n){-85.05112878>t&&(t=-85.05112878),t>85.05112878&&(t=85.05112878);var r=Math.sin(t*Math.PI/180),i=.5-Math.log((1+r)/(1-r))/(4*Math.PI);return e(i,n)}function i(t,n){return-180>t&&(t=-180),t>180&&(t=180),e((t+180)/360,n)}function o(t,e,n){var r=r(n),i=Math.min(t,r-1)/r-.5,o=.5-Math.min(e,r-1)/r,a=90-360*Math.atan(Math.exp(2*-o*Math.PI))/Math.PI,s=360*i;return{latitude:a,longitude:s}}var a=[0,0];t.mapSize=n,t.lat2y=r,t.lon2x=i,t.loc=o}(Oe||(Oe={}));var Le,He=function(){function t(){this.type="road",this.lang="default",this.pan=!0,this.zoom=!0,this.city=!1,this.road="color",this.label=!0,this.forest=!0,this.icon=!1,this.building=!1,this.area=!1}return t.build=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=new t,i=0,o=e.filter(function(t){return t});i<o.length;i++){var a=o[i];for(var s in r)s in a&&(r[s]=a[s])}return r},t.control=function(t,e){var n=f(t,["type","lang","pan","zoom"]);for(var r in e)n[r]=e[r];return n},t.element=function(t,e){var n=f(t,["road","forest","label","city","icon","building","area"]);for(var r in e)n[r]=e[r];return n},t}(),Ge=function(){function t(t){var e=this;this._listener=[],this._fmt={},this._div=t;var n=function(t){return t.attr("tabIndex",-1).style("pointer-events","none").style("position","absolute").style("visibility","inherit").style("user-select","none"),t};this._canvas=n(je(t).append("canvas")),this._svg=n(je(t).append("svg")),this._svgroot=this._svg.append("g").attr("id","root"),__lavaBuildMap=function(){e._remap(),e._then&&e._then(e._map),e._then=null}}return Object.defineProperty(t.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._fmt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svg",{get:function(){return this._svgroot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),t.prototype.location=function(t){var e=new Microsoft.Maps.Point(t.x,t.y);return this._map.tryPixelToLocation(e)},t.prototype.pixel=function(t,e){return t.anchor?ct(this._map,t):vt(this._map,t,e)},t.prototype.anchor=function(t){return ht(t)},t.prototype.area=function(t,e){return void 0===e&&(e=20),ft(t,e)},t.prototype.bound=function(t){return ut(t)},t.prototype.add=function(t){this._listener.push(t)},t.prototype.fitView=function(t){var e=this._map.getWidth(),n=this._map.getHeight();this._map.setView(lt(t,{width:e,height:n})),this._viewChange(!1)},t.prototype._remap=function(){var t=this,e=_t(this._map,this._fmt,this._div);je(this._div).select("div").remove();var n=new Microsoft.Maps.Map(this._div,e),r=Microsoft.Maps.Events;return this._map&&this._handler1&&(r.removeHandler(this._handler1),r.removeHandler(this._handler2),r.removeHandler(this._handler3)),n.getRootElement().appendChild(this._canvas.node()),n.getRootElement().appendChild(this._svg.node()),this._map?this._map=n:(this._map=n,this._resize()),this._handler1=r.addHandler(n,"viewchange",function(){return t._viewChange(!1)}),this._handler2=r.addHandler(n,"viewchangeend",function(){return t._viewChange(!0)}),this._handler3=r.addHandler(n,"mapresize",function(){return t._resize()}),n},t.prototype._viewChange=function(t){void 0===t&&(t=!1);for(var e=this._map.getZoom(),n=0,r=this._listener;n<r.length;n++){var i=r[n];i.transform&&i.transform(this._map,this._zoom,t)}this._zoom=e},t.prototype._resize=function(){if(this._map){var t=this._map.getWidth(),e=this._map.getHeight();this._svg.attr("width",t).attr("height",e),this._canvas.attr("width",t).attr("height",e),this._svgroot.attr("transform",pt(t/2,e/2));for(var n=0,r=this._listener;n<r.length;n++){var i=r[n];i.resize&&i.resize(this._map)}}},t.prototype.restyle=function(t,e){var r=this;e=e||function(){};var i={};for(var o in t)t[o]!==this._fmt[o]&&(i[o]=this._fmt[o]=t[o]);if(0!==n(i).length){if("lang"in i||!this._map){je("#mapscript").remove(),je("head").selectAll("link").filter(function(){var t=je(this).attr("href");return t&&t.indexOf("www.bing.com")>0}).remove(),je("head").selectAll("script").filter(function(){var t=je(this).attr("src");return t&&t.indexOf("www.bing.com")>0}).remove();var a=document.createElement("script");return a.type="text/javascript",a.id="mapscript",a.src="https://www.bing.com/api/maps/mapcontrol?callback=__lavaBuildMap","default"!==i.lang&&(a.src+="&setLang="+i.lang),a.async=!0,a.defer=!0,this._then=e,void document.body.appendChild(a)}var s={label:1,forest:1,road:1,city:1,icon:1,area:1,building:1};for(var o in i)if(o in s)return void setTimeout(function(){return e(r._remap())},0);var u={};"pan"in i&&(u.disablePanning=!i.pan),"zoom"in i&&(u.disableZooming=!i.zoom),"type"in i&&setTimeout(function(){return r._map.setView({mapTypeId:gt(r._fmt)})},0),Object.keys(u).length&&setTimeout(function(){return r._map.setOptions(u)},0),e(null)}},t}();!function(t){function e(t,e,r,s){var u=document.createElement("script"),l=!1;u.src=t,u.async=!0,"function"==typeof e&&(u.onerror=function(t){return s(null)}),u.onload=function(){if(!l){if(l=!0,a.length>0){var t=a.shift();n(r,t.url,t.then)}else o.push(r);u.onload=null,u&&u.parentNode&&u.parentNode.removeChild(u)}},i=i||document.getElementsByTagName("head")[0],i.appendChild(u)}function n(t,n,r){0===t?__geocode_jsonp0=r:1===t?__geocode_jsonp1=r:2===t?__geocode_jsonp2=r:3===t?__geocode_jsonp3=r:4===t?__geocode_jsonp4=r:5===t?__geocode_jsonp5=r:6===t&&(__geocode_jsonp6=r),e(n+"&jsonp=__geocode_jsonp"+t,null,t,r)}function r(t,e){0===o.length?a.push({url:t,then:function(t){e(t)}}):n(o.shift(),t,function(t){e(t)})}var i,o=[0,1,2,3,4,5,6],a=[];
t.get=r}(Le||(Le={}));var Re,Ve,qe,We,Ue={MaxBingRequest:6,MaxCacheSize:3e3,MaxCacheSizeOverflow:1e3,BingKey:"AidYBxBA7LCx2Uo3v-4QJE2zRVgvqg4KquhupR_dRRIGbmKd1A1CpWnjEJulgAUe",BingURL:"https://dev.virtualearth.net/REST/v1/Locations?",BingUrlGeodata:"https://platform.bing.com/geo/spatial/v1/public/Geodata?"};new Error("Geocode result is empty.");wt(),bt();var Je,Ze,Ye,Ke,Xe,Qe,$e=function(){function t(t){this._svg=t.append("svg").style("position","absolute"),this._svg.append("rect").attr("fill","white").attr("id","mask"),this._svg.append("g").attr("id","color"),this._svg.append("g").attr("id","thick"),this._svg.append("g").attr("id","style")}return t.prototype.update=function(){var t=Xe.legend.show;this._svg.style("display",t?null:"none");var e=Ke.map.getWidth(),n=this.height();if(this._svg.attr("width",e).attr("height",n),this._svg.select("#mask").attr("width",e).attr("height",n),t){var r=cn.legend,i=r.color,o=r.style,a=r.thick;this._restyle(o,this._rethick(a,this._recolor(i,0)))}},t.prototype._group=function(t,e,n){var r=this._svg.select("#"+e),i=(this._textBase(),r.selectAll(".item").data(a(0,t))),o=i.enter().append("g").attr("class","item");return o.append(n),o.append("text"),i.exit().remove(),this._svg.select("#"+e).selectAll(".item")},t.prototype._text=function(t,e,n,r){var i=this._textBase(),o=[0],a=+Xe.legend.fontSize;return t.selectAll("text").attr("x",e).attr("y",i).attr("font-size",a).text(function(t){return n[t]}).each(function(t){var n=je(this).node().getBBox().width;o[t+1]=o[t]+e+1.2*a+n}),t.attr("transform",function(t){return"translate("+(o[t]+r)+",0)"}),0===n.length?r:o[o.length-1]+r+2.4*a},t.prototype._restyle=function(t,e){var r=n(t),i=+Xe.legend.fontSize,o=this._group(r.length,"style","line"),a=this._textBase()-.7*i/2,s=2*i,u=s/12,l=r.map(function(t){return an[t]});return o.selectAll("line").attr("class","dash").attr("x1",0).attr("x2",s).attr("y1",a).attr("y2",a).attr("stroke","black").attr("stroke-width",u).attr("stroke-opacity",1).attr("stroke-dasharray",function(t){return l[t](u)}),this._text(o,s+2,r.map(function(e){return t[e]}),e)},t.prototype._rethick=function(t,e){var r=n(t),i=+Xe.legend.fontSize,o=this._group(r.length,"thick","rect"),a=this._textBase()-.7*i/2,s=1.5*i;return o.selectAll("rect").attr("y",function(t){return a-+r[t]/2}).attr("fill","#555").attr("width",s).attr("height",function(t){return r[t]}),this._text(o,s+2,r.map(function(e){return t[e]}),e)},t.prototype._recolor=function(t,e){var r=n(t),i=this._group(r.length,"color","circle"),o=.7*+Xe.legend.fontSize/2,a=this._textBase()-o+1;return i.selectAll("circle").attr("cx",o+2).attr("cy",a).attr("r",o).attr("fill",function(t){return r[t]}),this._text(i,2*o+4,r.map(function(e){return t[e]}),e)},t.prototype._textBase=function(){return+Xe.legend.fontSize+2},t.prototype.height=function(){return 1.35*+Xe.legend.fontSize+4},t}(),tn=function(){function t(t,e){this.color=[],this.thick=[],this.style=[],this.segmt=[],this.selet=[],this.points=[],this.group=null;var n,r,o,a,s=cn.color,u=cn.thick,l=cn.style,c=cn.lat,h=cn.lon,f=Xe.advance,p=f.nonzero,d=f.onlyvalid,m=cn.selection.flags(),v=m?function(t){return t in m}:function(t){return!0};this.group=e;for(var _=0,g=t;_<g.length;_++){var y=g[_],w=c(y),b=h(y);if(!Mt(w)&&!Mt(b)&&!(p&&0===w||0===b)){if(-85.05112878>w||w>85.05112878){if(d)continue;w=i(w,-85.05112878,85.05112878)}if(-180>b||b>180){if(d)continue;b=i(b,-180,180)}var x=v(y),M=s(y),A=u(y),E=l(y);x===r&&M===n&&A===o&&E===a||(0!==this.points.length&&this._segment(r,n,o,a),r=x,n=M,o=A,a=E),this.points.push({longitude:b,latitude:w,row:y,segment:this.segmt.length})}}0!==this.points.length&&this._segment(r,n,o,a)}return t.prototype._segment=function(t,e,n,r){this.selet.push(t),this.color.push(e),this.style.push(r),this.thick.push(n),this.segmt.push(this.points.length)},t}(),en=new Be(20),nn={},rn=function(){function t(t,e,n){var r=this;this._arrowPoints=null,this._onclick=function(){cn.selection.click(r._base.points.map(function(t){return t.row}))},this._d3=e,this._base=t,this._zoom=n,this._pnts=t.points;var i=en.line(t.points);this._bound={anchor:i.anchor,margin:i.margin};for(var o=i.points,a=0,s=1,u=0;u<o.length;u++){var l=o[u],c=o[u+1],h=t.points[u];!c||l.x===c.x&&l.y===c.y||(f=xt(l,c),a=f[0],s=f[1]),h.ux=a,h.uy=s,h.x=l.x,h.y=l.y}this._drawRoute(),this.drawGlyphs(),this.transform(Ke.map);var f}return t.prototype.bound=function(t){if(!t)return this._bound;var e=this._pnts.filter(function(e){return e.row in t});return e.length<=0?null:Ke.bound(e)},t.prototype.transform=function(t){if(this._d3){if(this._zoom!==t.getZoom()){var e=en.factor(t.getZoom()),n=this._base.thick.map(function(t){return+t/e}),r=this._base.style;this._d3.selectAll(".segment").attr("transform",dt(e)).attr("stroke-width",function(t){return n[t]}).attr("stroke-dasharray",function(t){return an[r[t]](n[t])}),this._d3.selectAll(".glyph").attr("transform",function(t){return pt(t.x*e,t.y*e)}),this._zoom=t.getZoom()}this._d3.attr("transform",pt(Ke.pixel(this._bound)))}},t.prototype.highlight=function(t){var e=!t||this._pnts[0].row in t,n=this._base.color;this._d3.selectAll(".segment").attr("stroke",function(t){return e?n[t]:on}),this._d3.selectAll(".glyph").attr("fill",function(t){return e?n[t.segment]:on})},t.prototype._resetArrowPoints=function(){this._arrowPoints=[];var t=0,e=[],n=this._pnts;if(!(this._pnts.length<=2)){if(cn.glyph.interval<=1)return void(this._arrowPoints=n.slice(1,n.length-1));for(var r=0;r<n.length-1;r++){var i=n[r],o=n[r+1],a=i.x-o.x,s=i.y-o.y;t+=e[r]=Math.sqrt(a*a+s*s)}for(var u=t/n.length*cn.glyph.interval,l=e[0],c=1;c<n.length-1;)l>u?(this._arrowPoints.push(n[c]),l=e[c]):l+=e[c],c++}},t.prototype.drawGlyphs=function(){var t=this,e=Xe.arrow,n=this._pnts,r=this._base,i=en.factor(this._zoom),o=(this._base.segmt,this._base.color),a=this._base.selet,s=this._base.thick;if(this._d3.selectAll(".glyph").remove(),e.show&&(!e.customize||cn.glyph.show(r.points[0].row))){var u=function(e,n,r){var s=e.segment;return t._d3.append(n).datum(e).attr("fill",function(t){return a[s]?o[s]:on}).attr("class",r+" glyph").attr("transform",pt(e.x*i,e.y*i))};if(e.middle){this._arrowPoints||this._resetArrowPoints();for(var l=0,c=this._arrowPoints;l<c.length;l++){var h=c[l];u(h,"path","arrow").attr("d",this._arrow(h.ux,h.uy,e.middleScale*+s[h.segment]))}}if(e.start&&u(n[0],"circle","start").attr("cx",0).attr("cy",0).attr("r",e.startScale*+s[n[0].segment]/2),e.end){var f=n[n.length-1];this._endShape(u(f,"g","end"),f,e.endScale*+s[f.segment])}var p=this._d3.selectAll(".glyph");Ze&&Ze(p),p.on("click",this._onclick)}},t.prototype._rotate=function(t){var e=180*Math.atan2(t.uy,t.ux)/Math.PI;switch(Xe.arrow.endDirectional){case"right":return"rotate("+e+")";case"up":return"rotate("+(e+90)+")";case"left":return"rotate("+(e+180)+")";case"down":return"rotate("+(e+270)+")"}},t.prototype._vertical=function(){return"up"===Xe.arrow.endDirectional||"down"===Xe.arrow.endDirectional},t.prototype._endShape=function(e,n,r){var i=this,o=e.append("g").attr("class","rotate").datum(n),a=o.append("g").attr("class","resize").datum(n),s=a.node(),u=Xe.arrow;if(u.endShape in sn){var l=sn[u.endShape];return s.innerHTML=l.group,l.directional&&o.attr("transform","rotate("+(180*Math.atan2(n.uy,n.ux)/Math.PI+90)+")"),n.iconWidth=l.width||s.getBBox().width,Je&&Je(!1),a.attr("transform",function(t){return"scale("+r/t.iconWidth+")"}),void e.selectAll("*").each(function(){je(this).datum(n)})}if("image"!==u.endShape){var c=u.endData||"";s.innerHTML=c;var h=t.IMAGE_CACHE,f=h[0],p=h[1],d=h[2];if(f===c&&0>p)return;if(f!==c){if(c&&s.innerHTML.length<=1)return Je&&Je(!0),void(t.IMAGE_CACHE=[c,-1,-1]);p=s.getBBox().width,d=s.getBBox().height,t.IMAGE_CACHE=[c,p,d]}return n.iconWidth=this._vertical()?p:d,o.attr("transform",this._rotate(n)),a.attr("transform",function(t){return"scale("+r/t.iconWidth+")"}),e.selectAll("*").each(function(){je(this).datum(n)}),void(Je&&Je(!1))}var m=u.endImage||"",v=t.IMAGE_CACHE,f=v[0],_=v[1],g=v[2];if(!(f===m&&0>_))if(f===m){n.iconWidth=this._vertical()?_:g;var y='<image xlink:href="'+m+'" height="'+g+'" width="'+_+'" transform="translate('+(0-_/2)+","+(0-g/2)+')"/>';s.innerHTML=y,o.attr("transform",this._rotate(n)),a.attr("transform",function(t){return"scale("+r/t.iconWidth+")"}),e.selectAll("*").each(function(){je(this).datum(n)}),Je&&Je(!1)}else if(t.IMAGE_FETCHING)t.IMAGE_ACTIONS.push(function(){return i._endShape(e,n,r)});else{t.IMAGE_FETCHING=!0;var w=new Image;t.IMAGE_ACTIONS.push(function(){return i._endShape(e,n,r)}),w.onload=function(){t.IMAGE_FETCHING=!1,t.IMAGE_CACHE=[m,w.width,w.height],t.IMAGE_ACTIONS.forEach(function(t){return t()}),t.IMAGE_ACTIONS=[]},w.onerror=function(){t.IMAGE_FETCHING=!1,t.IMAGE_CACHE=[m,-1,-1],t.IMAGE_ACTIONS=[],Je&&Je(!0)},w.src=m}},t.prototype._arrow=function(t,e,n){var r=-1*e*n,i=t*n,o=e*n,a=-1*t*n;t*=2*n,e*=2*n;var s="M ";return s+=r+","+i+" ",s+=t+","+e+" ",s+=o+","+a},t.prototype._drawRoute=function(){var t=en.factor(this._zoom),e=this._base,n=this._pnts;this._d3.selectAll(".segment").remove();for(var r=e.segmt.length-1;r>=0;r--){for(var i=e.segmt[r]-1,o=r>0?e.segmt[r-1]:1,a=r>0?n[o-1]:n[0],s=["M",a.x,a.y],u=o;i>u;u++){var l=n[u];s.push("L",l.x,l.y)}s.push("L",n[i].x,n[i].y);var c=+e.thick[r]/t;this._d3.append("path").datum(r).attr("class","segment").attr("d",s.join(" ")).style("fill","none").attr("transform",dt(t)).attr("stroke",e.selet[r]?e.color[r]:on).attr("stroke-width",c).attr("stroke-opacity",1).attr("stroke-linecap","round").attr("stroke-dasharray",an[e.style[r]](c))}},t.IMAGE_CACHE=[null,1,1],t.IMAGE_FETCHING=!1,t.IMAGE_ACTIONS=[],t}(),on="#AAA",an={solid:function(t){return null},dash1:function(t){return 3*t+", "+3*t},dash3:function(t){return 1.5*t+", "+1.5*t},dash2:function(t){return 4*t+", "+1*t},dash4:function(t){return 3*t+", "+1*t+", "+1*t+", "+1*t}},sn={car1:{group:'<rect height="12.5391" width="8.48453" y="-6.96649" x="-4.33321" FILL="#ffffff"/>\n        <path d="m2.24288,-10.70412l-4.61563,0c-1.22348,0 -2.21499,1.36086 -2.21499,2.58435l0,13.66124c0,1.22309 0.9915,2.21538 2.21499,2.21538l4.61563,0c1.22309,0 2.21538,-0.9919 2.21538,-2.21538l0,-13.66124c-0.00078,-1.22348 -0.99229,-2.58435 -2.21538,-2.58435zm1.82718,5.56906l0,4.57874l-1.07119,0.13777l0,-1.88645l1.07119,-2.83006zm-0.56209,-1.34045c-0.3988,1.53083 -0.871,3.34034 -0.871,3.34034l-5.40421,0l-0.87218,-3.34034c0.00039,0 3.48714,-1.18462 7.14738,0zm-6.62455,4.29416l0,1.7632l-1.07158,-0.13699l0,-4.45666l1.07158,2.83046zm-1.07158,6.36863l0,-4.06611l1.07158,0.13463l0,3.21709l-1.07158,0.71439zm0.61115,1.15558l0.87061,-1.30945l5.40538,0l0.871,1.30945l-7.14699,0zm6.57588,-1.99282l0,-3.08991l1.07119,-0.13934l0,3.94403l-1.07119,-0.71478z"/>',directional:!0,width:9},triangle:{group:'<path d="m0,-16l-10,20l10,-4l10,4z" stroke="white" stroke-width="1"/>',directional:!0,width:20},plane:{group:'<path d="m9.60938,0.81251l0,-2l-8,-5l0,-5.5c0,-0.83 -0.67,-1.5 -1.5,-1.5s-1.5,0.67 -1.5,1.5l0,5.5l-8,5l0,2l8,-2.5l0,5.5l-2,1.5l0,1.5l3.5,-1l3.5,1l0,-1.5l-2,-1.5l0,-5.5l8,2.5z" stroke="white" stroke-width="1"/>',directional:!0,width:12},planefront:{group:'<ellipse ry="64" rx="65.5" cy="1.5" cx="1.999" FILL="#ffffff"/>\n        <path d="m220.25,6.198l-150.703,-35.65599c-6.25,-20.91701 -20.43701,-36.705 -47.142,-42.082l-9.646,-49.25101l13.444,0c4.61301,0 8.353,-3.74001 8.353,-8.353c0,-4.61301 -3.73801,-8.35301 -8.353,-8.35301l-16.71901,0l-0.65399,-3.345c-0.76801,-3.91899 -4.203,-6.74698 -8.196,-6.74698c-3.994,0 -7.43001,2.82799 -8.19701,6.74698l-0.65399,3.345l-16.71901,0c-4.61299,0 -8.35199,3.74001 -8.35199,8.35301c0,4.61299 3.73799,8.353 8.35199,8.353l13.44501,0l-9.646,49.25101c-26.705,5.37799 -40.88901,21.16499 -47.13901,42.082l-151.039,35.735c-5.76599,1.36401 -9.49399,6.95801 -8.535,12.806c0.90201,5.495 5.65601,9.45401 11.121,9.45401c0.35199,0 0.70502,-0.017 1.061,-0.04901l74.939,-7.00299c-0.30298,1.59399 -0.46698,3.23801 -0.46698,4.92099c0,14.30801 11.47098,25.94601 25.56998,25.94601s25.57001,-11.64001 25.57001,-25.94601c0,-3.349 -0.63699,-6.54999 -1.78101,-9.491l20.662,-1.93201c6.10001,35.18301 35.92801,61.88699 71.80901,61.88699c35.88101,0 65.70898,-26.70398 71.80899,-61.88699l20.66202,1.93201c-1.14502,2.94101 -1.77902,6.14301 -1.77902,9.491c0,14.30801 11.47,25.94601 25.56802,25.94601s25.56998,-11.64001 25.56998,-25.94601c0,-1.68298 -0.164,-3.327 -0.46698,-4.92099l74.93799,7.00299c0.35501,0.03201 0.70901,0.04901 1.06201,0.04901c0.237,0 0.47699,-0.008 0.71298,-0.022c5.89902,-0.36499 10.57101,-5.267 10.57101,-11.258c0.00198,-5.46301 -3.87701,-10.01703 -9.03101,-11.05902zm-219.616,53.673c-7.754,0 -14.039,-7.85599 -14.039,-17.548s6.285,-17.54901 14.039,-17.54901c7.754,0 14.039,7.85703 14.039,17.54901s-6.285,17.548 -14.039,17.548zm32.95001,-59.841c0,0 -0.004,0 -0.00601,0l-65.896,0c-3.89299,0 -7.56799,-1.80701 -9.94099,-4.89499c-2.377,-3.082 -3.186,-7.09801 -2.189,-10.86101l5.01999,-18.97c1.455,-5.504 6.43401,-9.338 12.127,-9.338l55.86499,0c5.69501,0 10.67401,3.834 12.12701,9.338l4.90601,18.535c0.34799,1.15399 0.53699,2.377 0.53699,3.64499c0,6.929 -5.61899,12.54601 -12.54999,12.54601z" stroke="white" stroke-width="1"/>',directional:!1,width:230},car2:{group:'<path d="m-8.88919,-11.43457l18.38139,-0.43065l3.55957,8.8943l-0.2373,9.61546l-24.67969,0l-0.71191,-9.37508l1.18652,-4.80773z" FILL="#ffffff"/>\n        <path d="m11.40474,-10.92698c-0.32229,-0.96667 -1.28889,-1.61111 -2.25556,-1.61111l-17.72222,0c-1.12778,0 -1.93333,0.64444 -2.25555,1.61111l-3.38334,9.66666l0,12.8889c0,0.96666 0.64445,1.6111 1.61111,1.6111l1.61111,0c0.96667,0 1.61111,-0.64444 1.61111,-1.6111l0,-1.61111l19.33334,0l0,1.61111c0,0.96666 0.64444,1.6111 1.61111,1.6111l1.61111,0c0.96666,0 1.61111,-0.64444 1.61111,-1.6111l0,-12.8889l-3.38333,-9.66666zm-19.97778,16.11112c-1.28889,0 -2.41667,-1.12778 -2.41667,-2.41667s1.12778,-2.41668 2.41667,-2.41668s2.41667,1.12778 2.41667,2.41668s-1.12778,2.41667 -2.41667,2.41667zm17.72222,0c-1.28888,0 -2.41666,-1.12778 -2.41666,-2.41667s1.12778,-2.41668 2.41666,-2.41668s2.41667,1.12778 2.41667,2.41668s-1.12778,2.41667 -2.41667,2.41667zm-20.13889,-8.05556l2.41667,-7.25l17.72222,0l2.41667,7.25l-22.55556,0z"/>',directional:!1},shipfront:{group:'<rect height="115" width="181" y="-135" x="-82" fill="#ffffff"/>\n        <path d="m-107.28602,92.54368c1.95013,1.10467 3.60371,2.23276 5.03317,3.21274c3.53811,2.42711 4.72978,3.24493 8.42027,3.24493c3.69117,0 4.88284,-0.81723 8.42096,-3.24493c4.82886,-3.31226 12.1258,-8.31694 25.2902,-8.31694c13.16441,0 20.46066,5.00468 25.28952,8.31694c3.53811,2.42711 4.7291,3.24493 8.41959,3.24493c3.69049,0 4.88284,-0.81723 8.42027,-3.24493c4.82818,-3.31226 12.12511,-8.31694 25.28952,-8.31694c13.16372,0 20.46134,5.00468 25.28952,8.31694c3.5388,2.42653 4.72978,3.24493 8.42096,3.24493s4.88284,-0.81723 8.42096,-3.24493c4.82818,-3.31226 12.1258,-8.31694 25.2902,-8.31694s20.46134,5.00468 25.2902,8.31694c3.54085,2.42653 4.73115,3.24493 8.42369,3.24493s4.88558,-0.8184 8.42369,-3.24493c1.43082,-0.98115 3.0844,-2.11041 5.03522,-3.21391l0,-26.18368l13.40424,-77.70338l-24.15456,-17.50379l0,-102.66004c0,-13.3462 -20.64993,-18.61022 -36.18265,-21.40907c-18.19211,-3.27713 -42.22026,-5.08254 -67.65532,-5.08254s-49.46321,1.80541 -67.65806,5.08254c-15.53272,2.79885 -36.18265,8.06287 -36.18265,21.40907l0,102.65945l-24.15388,17.50379l13.40424,77.70338l0.00068,26.18544l0,0zm33.76104,-211.4464c2.56988,-1.23112 9.25185,-3.70214 24.55839,-5.94485c15.76094,-2.30828 35.74534,-3.5792 56.27022,-3.5792c20.52489,0 40.5086,1.27034 56.26954,3.5792c15.30723,2.2433 21.98851,4.71373 24.55839,5.94485l0,73.3766l-80.82793,-58.57624l-80.82861,58.57682l0,-73.37719z"/>\n        <path d="m116.85876,110.44848c-3.53948,2.42711 -4.73115,3.24493 -8.42369,3.24493s-4.88421,-0.81665 -8.42369,-3.24493c-4.82818,-3.31109 -12.12716,-8.31694 -25.29157,-8.31694s-20.46134,5.00585 -25.28884,8.31811c-3.53948,2.42711 -4.72978,3.24376 -8.42096,3.24376s-4.88284,-0.81665 -8.42232,-3.24376c-4.8275,-3.31109 -12.1258,-8.31811 -25.28884,-8.31811c-13.16372,0 -20.46066,5.00585 -25.28952,8.31811c-3.53811,2.42711 -4.72978,3.24376 -8.42027,3.24376c-3.69049,0 -4.88216,-0.81665 -8.41959,-3.24376c-4.82818,-3.31109 -12.12511,-8.31811 -25.28952,-8.31811c-13.16441,0 -20.46134,5.00585 -25.2902,8.31811c-3.53811,2.42711 -4.72978,3.24376 -8.42096,3.24376c-3.69049,0 -4.88284,-0.81665 -8.42027,-3.24376c-4.82818,-3.31109 -12.12511,-8.31811 -25.28952,-8.31811l0,23.12374c3.69049,0 4.88284,0.81723 8.42027,3.24493c4.82818,3.31226 12.12511,8.31694 25.28952,8.31694c13.16441,0 20.46134,-5.00468 25.2902,-8.31694c3.53811,-2.42653 4.72978,-3.24493 8.42096,-3.24493c3.69049,0 4.88216,0.81723 8.41959,3.24493c4.82818,3.31226 12.12511,8.31694 25.28952,8.31694c13.16441,0 20.46066,-5.00468 25.28952,-8.31694c3.53811,-2.42711 4.72978,-3.24493 8.42027,-3.24493c3.69117,0 4.88284,0.81723 8.42096,3.24493c4.82886,3.31226 12.1258,8.31694 25.29089,8.31694c13.16441,0 20.46134,-5.00468 25.28884,-8.31694c3.53811,-2.42711 4.72978,-3.24493 8.42096,-3.24493c3.69254,0 4.88421,0.8184 8.42369,3.24493c4.82818,3.31226 12.12716,8.31694 25.29157,8.31694c13.16577,0 20.46271,-5.00468 25.29157,-8.31694c3.53948,-2.42653 4.73252,-3.24493 8.42369,-3.24493l0,-23.12374c-13.16646,0 -20.46407,5.00585 -25.29225,8.31694z"/>',directional:!1},shiptop:{group:'<rect height="153" width="131" y="-74.5" x="-65.501" fill="#ffffff""/>\n        <path d="m137.621,-139.81601c-0.73401,-1.39499 -1.66699,-2.638 -2.75101,-3.70398c-1.06,-1.077 -2.29401,-2.005 -3.67801,-2.737c-3.56998,-1.89001 -7.65399,-2.22 -11.35699,-1.10001l-4.44498,0.59698c-69.50302,9.33801 -135.95001,42.65201 -187.104,93.80701l-56.89203,56.892c-2.81396,2.81201 -4.39398,6.62802 -4.39398,10.60599s1.58002,7.79404 4.39398,10.60602l94.80402,94.80396c2.929,2.92908 6.76801,4.39404 10.606,4.39404s7.67799,-1.46497 10.606,-4.39404l56.892,-56.89197c51.155,-51.15497 84.47,-117.604 93.80701,-187.104l0.59698,-4.43799c1.117,-3.69598 0.793,-7.771 -1.08499,-11.33701l0,0zm-121.008,199.78799l-10.86301,10.86401c-2.813,2.81299 -6.629,4.39398 -10.60699,4.39398c-3.97801,0 -7.79401,-1.57996 -10.606,-4.39398l-64.022,-64.022c-5.85701,-5.85699 -5.858,-15.35397 -0.00101,-21.21298l10.86301,-10.86401c2.813,-2.81299 6.629,-4.39398 10.60699,-4.39398c3.97801,0 7.793,1.57999 10.606,4.39398l64.022,64.022c5.858,5.85699 5.85899,15.354 0.00101,21.21298zm51.17899,-51.17899l-10.86299,10.86398c-2.813,2.81302 -6.629,4.39401 -10.60699,4.39401c-3.97801,0 -7.793,-1.57999 -10.606,-4.39401l-64.02301,-64.02197c-2.81299,-2.81299 -4.394,-6.62799 -4.394,-10.60602s1.58,-7.79398 4.394,-10.60599l10.86401,-10.86401c5.85699,-5.85699 15.355,-5.85699 21.213,0l64.02199,64.022c5.85602,5.85703 5.85699,15.354 0,21.21201l0,0z" transform="rotate(-45 3.17447 -11.8253)"/>',directional:!0,width:150}},un=null,ln=null,cn={selection:{},glyph:{},legend:{}},hn=function(){function t(t){this._highlight=null,this._highlighted=!1,this._highCount=null,this._seleFlags=null,this._highFlags=null,this._dirty=!1,this._clicked=!1,this._data=t}return t.shrink=function(t,e,n){return Qe.shrink(t,e,n)},Object.defineProperty(t.prototype,"highlighted",{get:function(){return!!this._highlighted},enumerable:!0,configurable:!0}),t.prototype.highlight=function(t){this._highlight=t},t.prototype.clear=function(){this._seleFlags=null},t.prototype.flags=function(){return this._highFlags||this._seleFlags},Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),t.prototype.reset=function(t,e,r){if(this._dirty=!1,r&&this._seleFlags){if(t){for(var i={},o=0,a=0;a<t.length;a++)null!==t[a]&&(i[a]=!0,o++);return this._highFlags=i,this._highCount=o,this._seleFlags=null,void(this._dirty=!0)}return this._manager&&this._manager.clear(),this._seleFlags=null,this._highFlags=null,this._highCount=null,void(this._dirty=!0)}if(t){for(var s={},o=0,a=0;a<t.length;a++)null!==t[a]&&(s[a]=!0,o++);return o!==this._highCount?this._dirty=!0:this._highFlags?n(this._highFlags).some(function(t){return!(t in s)})&&(this._dirty=!0):this._dirty=!0,this._highFlags=s,void(this._highCount=o)}return this._highFlags?(this._seleFlags=null,this._highFlags=null,this._highCount=null,this._manager&&this._manager.clear(),void(this._dirty=!0)):void 0},t.prototype.click=function(t,e){var r=this;if(this._clicked=!0,this._dirty=!0,this._manager||(this._manager=Nt.selectionManager()),this._highCount=this._highFlags=null,null===t)return this._seleFlags=null,void this._manager.clear();var i=event.ctrlKey;if(this._seleFlags=this._seleFlags||{},i)for(var a=0,s=t;a<s.length;a++){var u=s[a];u in this._seleFlags?delete this._seleFlags[u]:this._seleFlags[u]=!0}else n(this._seleFlags).length===t.length&&t.every(function(t){return t in r._seleFlags})?this._seleFlags={}:this._seleFlags=o(t,function(t){return t},function(t){return!0});if(0===n(this._seleFlags).length)this._seleFlags=null,this._manager.clear();else if(e)this._manager.select(e,i);else{var l=this._data.ids(n(this._seleFlags).map(function(t){return+t}));this._manager.select(l,!1)}this._highlight&&this._highlight(this._seleFlags)},t}();!function(t){function e(t,n){return t?t.right&&t.right.ref===n?t:t.left&&t.left.ref===n?t:e(t.right,n)||e(t.left,n):null}function n(t,e,n){var r=i(JSON.parse(t),e);return r?JSON.stringify(r):e+"<--lava-->"+n}function r(t,r,i){var a=t.getSelector().data[0],s=n(a.key,r,i),u={data:[{kind:1,expr:e(a.expr,r),key:s}],id:s};return new o(u,s)}function i(t,e){if("string"==typeof t)return null;for(var n in t){var r=t[n];if(r&&r.l&&r.l.col&&r.l.col.r===e)return t;var o=i(r,e);if(o)return o}return null}var o=function(){function t(t,e){this._sel=t,this._key=e}return t.prototype.equals=function(t){return t.getKey()===this._key},t.prototype.includes=function(t,e){return!1},t.prototype.getKey=function(){return this._key},t.prototype.getSelector=function(){return this._sel},t.prototype.getSelectorsByColumn=function(){return null},t.prototype.hasIdentity=function(){return!0},t}();t.shrink=r}(Qe||(Qe={}));var fn=new He,pn=function(){function t(){this.legend={show:!1,position:"top",fontSize:12,color:!1,thick:!1,style:!1,color_label:"",thick_label:"",style_label:"",color_default:!1,thick_default:!1,style_default:!1},this.color={customize:!0,item:{solid:{color:"#01B8AA"}}},this.thick={customize:!0,item:3},this.style={customize:!0,item:"solid"},this.route={customize:!0,item:!0},this.arrow={show:!0,startScale:6,start:!1,middle:!0,middleScale:1.5,interval:0,end:!1,endScale:6,endData:"",endImage:"",endDirectional:"up",endShape:"triangle",customize:!1,item:!0},this.advance={onlyvalid:!0,nonzero:!0,debug:!1},this.mapControl=He.control(fn,{autofit:!0}),this.mapElement=He.element(fn,{})}return t}(),dn=function(){function t(t,e){this._meta={},this._dirty={},this._binds={},this._persist=null,this.oname=t,this._default=e,r(e,this._meta),this._binds={}}return t.prototype.flip=function(t){return this.dirty(t)?this._meta[t]?"on":"off":!1},t.prototype.bind=function(t,e,n){this._persist||(this._persist=new Pt(this.oname,"persist")),this._binds[e]?this._binds[e].role!==t&&(this._binds[e].role=t,this._binds[e].toggle=n):this._binds[e]={role:t,toggle:n},"boolean"==typeof n&&(this._binds[e].active=n)},t.prototype.initPersist=function(t){if("color"===this.oname,this._persist){var e=this._persist.read(t,null);e&&this._persist.value(e)}},t.prototype.init=function(t){if(this._persist){var e=this._persist.read(t,{});for(var n in e)n in this._binds&&(this._binds[n].special=JSON.parse(e[n]),console.log(this._binds[n].special,"special for",this.oname,n))}if(t&&t.metadata&&t.metadata.objects){var r=t.metadata.objects[this.oname]||{};for(var i in r)i in this._meta&&(this._meta[i]=r[i])}},t.prototype.persist=function(t,e){var n={};n[t]=e,Nt.persist(this.oname,n)},t.prototype._active=function(t){return"boolean"==typeof t?t:this._meta[t]},t.prototype.dirty=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e&&0!==e.length?this._dirty?e.some(function(e){return e in t._dirty}):!1:this._dirty},Object.defineProperty(t.prototype,"meta",{get:function(){return this._meta},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaults",{get:function(){return this._default},enumerable:!0,configurable:!0}),t.prototype.update=function(t,e,r){var i=this;void 0===r&&(r=!1),this._cater=t;var o=this._dirty={};for(var a in this._updateMeta(e||{}))o[a]=!0;"color"===this.oname;var s=function(a){var s=u._binds[a],l=s["default"]=u._meta[a],c=s.role,f=s.toggle,p=s.special,d=t(c),m=function(t){!o[a]&&t&&h(t).some(function(t){return i._diff(t,l)})&&(o[a]=!0)};if(!d||!d.column)return m(p),delete s.special,s.active=u._active(f),"continue";s.active&&!u._active(f)&&m(p);var v=d.column.objects||{},_={},g=!r;for(var y in v){var w=v[y][u.oname];if(w&&(g=!1,a in w)){var b=d.key(+y);b in _||(_[b]=w[a])}}p=p||{};for(var b in _)u._diff(p[b],_[b])&&(u._dirty[a]=!0),p[b]=_[b];!e&&g?(m(p),delete s.special):n(p).length>0?s.special=p:delete s.special,s.active=u._active(f)},u=this;for(var l in this._binds)s(l);if(!this._persist)return n(this._dirty).length>0;var c=this._persist.value()||{},f=!1;for(var l in this._binds)!this._binds[l].special&&c[l]&&(e?this._binds[l].special=JSON.parse(c[l]):this._persist.value(null));for(var l in this._binds){var p=this._binds[l].special;if(p){var d=this._json(p);d!==c[l]&&(f=!0,c[l]=d)}}f&&this._persist.write(c,10);var m=n(this._dirty).length;return m>0?!0:(this._dirty=null,!1)},t.prototype._json=function(t){var e=Object.keys(t).sort();return JSON.stringify(e.reduce(function(e,n){return e[n]=t[n],e},{}))},t.prototype._diff=function(t,e){return t&&t.solid&&e&&e.solid?t.solid.color!==e.solid.color:t!==e},t.prototype._updateMeta=function(t){var e={};for(var n in this._default){var r=this._default[n];if(n in t){var i=t[n];this._diff(this._meta[n],i)&&(e[n]=i),this._meta[n]=i}else this._diff(r,this._meta[n])&&(e[n]=r),this._meta[n]=r}return e},t.prototype.resetDefault=function(t){for(var e in t)this._default[e]=t[e]},t.prototype.cat=function(t){return this._cater(t)},t.prototype.property=function(t,e){var r=this._binds[t],i=r["default"],o=r.special,a=r.role,s=r.active;if(i=void 0===e?i:e,!s)return function(t){return i};if(o&&n(o).length){var u=this.cat(a).key;return function(t){var e="number"==typeof t?u(t):t;if(null===e)return i;var n=o[e];return void 0===n?i:n}}return function(t){return i}},t.prototype.binding=function(t){return this._binds[t]},t}(),mn=function(){function t(t,e){this._dump=[],this._override={},this._override=e,this._fmt=t}return t.prototype._meta=function(t,e){e=e||this._override;var n=this._fmt.meta;if(t){n=f(n,t);for(var r=0,i=t;r<i.length;r++){var o=i[r];e&&o in e&&(n[o]=e[o])}}return this._dump.push({objectName:this._fmt.oname,properties:n,selector:null}),this},t.prototype.items=function(t,e,n,r){var i=this._fmt.binding(t),o=i.role,a=(i.toggle,i["default"]),s=i.special,l=this._fmt.cat(o),c=l.key;e=e?l.distincts(e):l.distincts(),n=n||c;var h=l.row2label(e),f=jt(e,n),p=function(e,n){var r={},i=c(e);return s&&i in s?r[t]=s[i]:r[t]=n,r};for(var d in f){var m=f[d],v=m[0];s&&(v=u(m,function(t){return c(+t)in s})||v);var _=m.map(function(t){return h[t]}).join(",");this._dump.push({objectName:this._fmt.oname,displayName:"• "+_,selector:l.id(v).getSelector(),properties:p(v,r?"boolean"==typeof r?_:r(v):a)})}return this},t.prototype.custom=function(t,e,n){var r=this._fmt.binding(t),i=(r.role,r.toggle);r["default"],r.special;if("string"==typeof i){if(this._dump.push({objectName:this._fmt.oname,selector:null,properties:f(this._fmt.meta,[i])}),!this._fmt.meta[i])return this}else if(!i)return this;return this.items(t,e,n)},t.prototype.meta=function(t,e,n){var r=this;if("string"==typeof t||"boolean"==typeof t){var i=t,a=e,s=n||this._override,u=function(t){return s&&t in s?s[t]:r._fmt.meta[t]};return"boolean"==typeof i?i&&this._dump.push({objectName:this._fmt.oname,properties:o(a,function(t){return t},function(t){return u(t)}),selector:null}):(a=this._fmt.meta[i]?[i].concat(a):[i],this._dump.push({objectName:this._fmt.oname,properties:o(a,function(t){return t},function(t){return u(t)}),selector:null})),this}return this._meta(t,e),this},t.prototype.add=function(t,e){if(void 0===e)this._dump.push(t);else{var n={};n[t]=e,this._dump.push({objectName:this._fmt.oname,properties:n,selector:null})}return this},t.prototype.dump=function(){return 0===this._dump.length&&this._meta(),this._dump},t}(),vn=function(){function t(t,e,n){if(this._rids={},this._rows=[],this._distincts=null,this.column=t,this.role=n,this._rows=e,t){var r=t.values;this.key=function(t){return r[t]+""}}else this.key=function(t){return""}}return t.prototype.id=function(t){var e=this._rids[t];return e||(e=this._rids[t]=Nt.id(this.column,t)),e},t.prototype.distincts=function(t){if(this._distincts&&!t)return this._distincts;if(!this.column)return this._distincts=[];for(var e={},n=[],r=t||this._rows,i=0,o=r;i<o.length;i++){var a=o[i],s=this.key(a);s in e||(e[s]=!0,n.push(+a))}return t||(this._distincts=n),n},t.prototype.row2label=function(t){var n=this;if(!t||0===t.length)return{};var r=t.map(function(t){return n.column.values[t]});if(this.column.source.type.dateTime){var i=e(r);r=r.map(function(t){return t instanceof Date?i(t):t})}for(var o={},a=0;a<t.length;a++)o[t[a]]=r[a];return o},t.prototype.labels=function(t){var n=this;if(!t||0===t.length)return[];var r=t.map(function(t){return n.column.values[t]});if(!this.column.source.type.dateTime)return r;var i=e(r);return r.map(function(t){return t instanceof Date?i(t):t})},t}(),_n=function(){function t(){this._cmap={},this._vmap={},this._dirty={},this._mute={}}return t.prototype.dirty=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 0===e.length?(e=n(this._dirty),0===e.length?!1:e.some(function(e){return!(e in t._mute)})):e.some(function(e){return e in t._dirty})},t.prototype.silence=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._mute=o(t),this},t.prototype.update=function(t){if(t&&t.categorical){this._dirty={};var e=Ft(t.categorical.categories),r=Ft(t.categorical.values);this._compare(this._cmap,e),this._compare(this._vmap,r),this._cmap=e,this._vmap=r}else this._dirty=o(n(this._cmap,this._vmap)),this._vmap=this._cmap={};return this},t.prototype.exist=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.every(function(e){return e in t._cmap||e in t._vmap})},t.prototype.column=function(t){return void 0===t?h(this._cmap)[0][0]:(this.columns(t)||[])[0]},t.prototype.columns=function(t){return this._cmap[t]||this._vmap[t]},t.prototype.sorter=function(t){var e=this;if(!this.exist(t))return function(){return 0};var n=this.columns(t).map(function(t){return e._sorter(t)});return 1===n.length?n[0]:function(t,e){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o(t,e);if(0!==a)return a}return 0}},t.prototype._sorter=function(t){var e=t.values,n=function(t){return function(n,r){var i=e[n],o=e[r];return null===i||void 0===i?-1:null===o||void 0===o?1:t(i,o)}};return n(t.source.type.numeric?function(t,e){return t-e}:t.source.type.dateTime?function(t,e){return t.getTime()-e.getTime()}:function(t,e){return(t+"").localeCompare(e+"")})},t.prototype._compare=function(t,e){for(var r=(function(n){if(n in t&&n in e){var r=t[n],a=e[n];if(r.length!==a.length)return i._dirty[n]=!0,"continue";var s=o(r,function(t){return t.source.displayName});if(a.some(function(t){return!(t.source.displayName in s)}))return i._dirty[n]=!0,"continue"}else i._dirty[n]=!0}),i=this,a=0,s=n(t,e);a<s.length;a++){var u=s[a];r(u)}},t}(),gn=function(){function t(t){this._dirty={},this._count=null,this._highlights=null,this._grand=t}return t.prototype.dirty=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 0===e.length?n(this._dirty).length>0:e.some(function(e){return e in t._dirty})},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlights",{get:function(){return this._highlights},enumerable:!0,configurable:!0}),t.prototype.rows=function(){if(this._cachedRows)return this._cachedRows;
var t=[];this._highlights;return t=a(0,this._count),this._cachedRows=t,t},t.prototype.update=function(t){this._dirty={},this._cachedRows=null;var e=0,n=null;if(t&&t.categorical){var r=t.categorical,i=r.categories,o=r.values;i&&i[0]&&(e=i[0].values.length),o&&o[0]&&(n=o[0].highlights,e=o[0].values.length)}if(e!==this._count)return this._dirty.count=!0,this._count=e,this._dirty.highlight=!0,void(this._highlights=n);if(this._highlights&&n)for(var a=0;e>a;a++){var s=null===this._highlights[a],u=null===n[a];if(s!==u){this._dirty.highlight=!0;break}}!this._highlights!=!n&&(this._dirty.highlight=!0),this._highlights=n},t}(),yn=function(){function t(t,e){this._catRoles=[],this._required=[],this._contentDirty=!1,this._catRoles=e,this._FORMAT=t,this._formatter={},this._cats={};for(var n in t)this._formatter[n]=new dn(n,t[n]);this.fmt=this._formatter,this.selection=new hn(this),this.roles=new _n,this.items=new gn(this)}return t.prototype.require=function(t,e){for(var n={},r=0;r<t.length;r++)n[t[r]]=e[r];this._required.push(n)},t.prototype.delta=function(){var t={};for(var e in this.fmt){t[e]={};var n=this.fmt[e],r=n.dirty();if(r)for(var i in r)t[e][i]=n.meta[i]}return t},t.prototype.isPersistingCache=function(t){return Nt.dirtyPersist(t)&&!this.issue()&&!this.issue(t)},t.prototype.sorter=function(t){return this.roles.sorter(t)},t.prototype.column=function(t,e){return e?(new _n).update(e).column(t):this.roles.column(t)},t.prototype.issue=function(t){if(t=t||this._view,!t)return"Data is empty.";var e=(new _n).update(t);if(this._required.length>1){for(var r=0,i=this._required;r<i.length;r++){var o=i[r],a=n(o);if(e.exist.apply(e,a))return null}return"Some required fields are missing"}if(1===this._required.length){var s=this._required[0],a=n(s),u=c(a,function(t){return s[t]},function(t){return!e.exist(t)});return 0===u.length?null:1===u.length?u[0]+" field is missing.":u.join(" and ")+" fields are missing."}return null},t.prototype.init=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t&&t.metadata&&t.metadata.objects){e&&0!==e.length||(e=n(this._formatter));for(var i in this._formatter)this._formatter[i].initPersist(t);for(var o=0,a=e;o<a.length;o++){var s=a[o];this._formatter[s].init(t)}}},t.prototype.values=function(t,e){var n=this.column(t);if(!n)return null;var r=n.values;return(e||this.rows()).map(function(t){return r[t]})},t.prototype.rows=function(){return this.items.rows()},t.prototype.key=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(1===e.length)return this.cat(e[0]).key;e=e.filter(function(e){return t.exist(e)});var r=e.map(function(e){return t.cat(e).key});return function(t){return r.map(function(e){return e(t)}).join("_")}},t.prototype.meta=function(t,e,n,r){return t&&t.metadata&&t.metadata.objects&&t.metadata.objects[e]?t.metadata.objects[e][n]||r:r},t.prototype.cat=function(t){var e=this._cats[t];return e||(e=this._cats[t]=new vn(this.column(t),this.rows(),t)),e},t.prototype.columns=function(t,e){if(e=e||this._view,!e||!e.categorical)return null;for(var n=[],r=0,i=e.categorical.categories;r<i.length;r++){var o=i[r];o.source.roles[t]&&n.push(o)}for(var a=0,s=e.categorical.values;a<s.length;a++){var o=s[a];o.source.roles[t]&&n.push(o)}return n},t.prototype.exist=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return(n=this.roles).exist.apply(n,t);var n},t.prototype._exist=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return(r=(new _n).update(t)).exist.apply(r,e);var r},t.prototype._updateFormat=function(t){var e=this;this._dirtyFormat=!1;var n=function(t){return e.cat(t)},r=this.items.dirty("count")||this.roles.dirty(),i=t&&t.metadata&&t.metadata.objects||{};for(var o in this._FORMAT)this._formatter[o].update(n,i[o],r)&&(this._dirtyFormat=!0)},t.prototype.update=function(t){var e=this;if(this._cats={},this._view){this._contentDirty=!1;var n=c(this._catRoles.map(function(t){return e.column(t)}),function(t){return t&&t.values}),r=c(this._catRoles.map(function(n){return e.column(n,t)}),function(t){return t&&t.values});if(n.length===r.length)for(var i=this.items.count,o=Math.floor(Math.max(i/10,1)),s=a(0,n.length),u=function(t){return s.some(function(e){return n[e][t]!==r[e][t]})?(l._contentDirty=!0,"break"):void 0},l=this,h=0;i>h;h+=o){var f=u(h);if("break"===f)break}else this._contentDirty=!0}else this._contentDirty=!0;this.roles.update(t),this.items.update(t),this._updateFormat(t),this.selection.reset(this.items.highlights,!this.dirty("data"),!this._dirtyFormat),this._view=t},t.prototype.dirty=function(t){return"content"===t?this._contentDirty:"data"===t?this.roles.dirty()||this.items.dirty()||this._contentDirty:"format"===t?this._dirtyFormat:"role"===t?this.roles.dirty():this.items.dirty(t)},t.prototype.inser=function(t,e){return new mn(this._formatter[t],e)},t.prototype.property=function(t,e){return this._formatter[t].property(e)},t.prototype.ids=function(t,e){var n=this.roles.column(e);return t.map(function(t){return Nt.id(n,t)})},t.prototype.value=function(t){var e=this.column(t)&&this.column(t).values;return e?function(t){return e[t]}:function(t){return null}},t.prototype.group=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(e.every(function(e){return!t.exist(e)}))return[this.rows()];for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i];this.exist(a)&&r.push(this.key(a))}var s=r[0];r.length>1&&(s=function(t){return r.map(function(e){return e(t)}).join(" ")});for(var u={},l=0,c=this.rows();l<c.length;l++){var f=c[l],p=s(f),d=u[p];d||(d=u[p]=[]),d.push(f)}return h(u)},t}(),wn=window&&window.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),bn=["color","thick","style"],xn=["color","thick","style","route"],Mn=function(t){function e(){var e=t.call(this,new pn,["stamp"])||this;e.selection.highlight(function(t){Et().forEach(function(e){return e.highlight(t)}),It()});for(var n=0,r=xn;n<r.length;n++){var i=r[n];e.fmt[i].bind(i,"item","customize"),"route"===i?e.fmt.arrow.bind("route","item","customize"):e.fmt.legend.bind(i,i+"_label",i)}return e.require(["stamp"],["Timestamp"]),e.roles.silence("tooltip"),e}return wn(e,t),e.prototype.update=function(e){var n=this;if(t.prototype.update.call(this,e),this.invalid())return cn.legend={color:{},thick:{},style:{}},void Dt({});var r=+this.fmt.arrow.meta.interval;isNaN(r)||0>=r?cn.glyph.interval=Math.max(this.items.rows().length/50,1):cn.glyph.interval=r;var i=this.property("arrow","item");cn.glyph.show=function(t){return i(+t)},bn.forEach(function(t){cn.legend[t]=n._buildLegendItems(t)});var a=this.property("color","item");cn.color=function(t){return a(t).solid.color};var s=this.property("thick","item");cn.thick=function(t){return s(t)};var u=this.property("style","item");cn.style=function(t){return u(t)};var l=this.column("latitude").values;cn.lat=function(t){return+l[t]};var c=this.column("longitude").values;cn.lon=function(t){return+c[t]};var h=this.key("route");Dt(o(this.group("route"),function(t){return h(t[0])})),this.dirty("data")?It():"on"===this.fmt.mapControl.flip("autofit")&&It()},e.prototype._buildLegendItems=function(t){if(!this.fmt.legend.meta[t])return{};var e=this.cat(t),n=t+"_label",r=this.fmt.legend.meta[t+"_default"];if(!e.column||!this.fmt[t].meta.customize){var i=this.fmt[t].meta.item;"color"===t&&(i=i.solid.color);var o=this.fmt.legend.meta[n]||"";return r&&!o.trim()?s(i,"All"):o.trim()?s(i,o):{}}var a=this.property(t,"item"),c=this.fmt.legend.property(n),h=a;"color"===t&&(h=function(t){return a(t).solid.color});var f={},p=e.distincts(),d=l(p,h);for(var m in d){var v=u(d[m],function(t){return c(+t)});void 0!==v?f[m]=c(+v):r&&(f[m]=d[m].map(function(t){return e.key(t)}).join(", "))}return f},e.prototype.invalid=function(t){return t=t||this._view,this._exist(t,"stamp","longitude","latitude")?null:"fields are missing"},e}(yn),An={map:new Pt("persist","centerzoom")},En=new Mn,Sn=function(){function t(t){this._loading=!1,this._options=null,this._persistZoomCenter=!0,Nt.init(t.host),Pe.init(t),cn.selection.click=function(t){var e=En.column("route"),n=t[0],r=e.source.expr.ref,i=En.value("route")(n),o=hn.shrink(Nt.id(e,n),r,i);En.selection.click(t,o)},cn.selection.flags=function(){return En.selection.flags()},St(function(t){Pe.add(t,function(t){var e=t.data.row,n=En.columns("tooltip");return console.log(n.map(function(t){return t.source.displayName}).join(", ")),n&&n.length?n.map(function(t){return{displayName:t.source.displayName,value:t.values[e]+""}}):null})}),At(function(t){Fe(".iconMsg").style("display",t?null:"none")}),this._div=t.element}return t.prototype._setupIconDiv=function(t){t.selectAll("*").remove();var e=t.attr("class","iconMsg").style("background-color","#ec6d71").style("font-size","14px").style("display","none").style("position","absolute").style("padding","10px").style("top","0px");e.append("div").style("padding-bottom","5px").text("The icon shape/url is invalid. Please visit the supporter's webpage for more information. In case the text is truncated by the format panel, which has about 250 character limit, please input it here instead:");var n=e.append("div");n.append("input").attr("type","input").style("padding-left","10px").style("padding-right","10px").style("margin-right","10px"),n.append("button").attr("type","button").text("Ok").style("margin-right","10px").on("click",function(){var t=n.select("input").property("value");e.style("display","none"),En.fmt.arrow.persist("endData",t)}),n.append("button").attr("type","button").text("Cancel").on("click",function(){return e.style("display","none")})},t.prototype.update=function(t){var e=this;if(this._loading)return void(this._options=t);var n=t.dataViews[0]||{};if(!Ke){this._options=t,this._loading=!0,En.init(n,"mapControl","mapElement");var r={};for(var i in En.fmt)r[i]=En.fmt[i].meta;return Tt(this._div,r,function(t){e._loading=!1,e._setupIconDiv(je(e._div).append("div"));var n=e._options.dataViews[0],r=An.map.read(n,[]),i=r[0],o=r[1];i&&t.setView({center:i,zoom:o}),e.update(e._options)}),void Ke.add({transform:function(t,e,n){n&&An.map.write([t.getCenter(),t.getZoom()],400)}})}return!Nt.dirtyPersist(n)||En.invalid()||En.invalid(n)?void(4!==t.type&&36!==t.type&&t.type!==powerbi.VisualUpdateType.ViewMode&&(En.update(n),console.log("update done"))):void console.log("return by new persist")},t.prototype.enumerateObjectInstances=function(t){var e=t.objectName;switch(e){case"legend":for(var n=En.inser(e).meta(["show","position","fontSize"]),r=0,i=bn;r<i.length;r++){var o=i[r],a=En.fmt[o].property("item");if("color"===o){var s=a;a=function(t){return s(t).solid.color}}En.fmt[o].meta.customize&&En.exist(o)&&(n.meta([o]),En.fmt.legend.meta[o]&&(n.meta(o+"_default"),n.items(o+"_label",null,a,En.fmt.legend.meta[o+"_default"])))}return n.dump();case"color":case"thick":case"style":return En.inser(e).meta(["item"]).custom("item").dump();case"arrow":var u=En.fmt.arrow.meta,l=u.end,c=u.endShape;return En.inser(e).meta(["show"]).meta("start",["startScale"]).meta("middle",["interval","middleScale"],{interval:cn.glyph.interval}).meta("end",["endScale","endShape"]).meta("customize"===c&&l,["endData","endDirectional"]).meta("image"===c&&l,["endImage","endDirectional"]).dump();case"advance":case"mapControl":case"mapElement":return En.inser(e).dump()}return[]},t}();t.Visual=Sn}(this.app=this.app||{});var app=this.app||app,powerbi;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(){function t(t){this._self=new app.Visual(t)}return t.prototype.update=function(t){this._self.update(t)},t.prototype.enumerateObjectInstances=function(t){return this._self.enumerateObjectInstances(t)},t}();t.Visual=e}(e=t.routemap863828C4992A473C9A5FB6A6B0EDF5DC||(t.routemap863828C4992A473C9A5FB6A6B0EDF5DC={}))}(e=t.visual||(t.visual={}))}(e=t.extensibility||(t.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(t){var e;!function(e){var n;!function(e){e.routemap863828C4992A473C9A5FB6A6B0EDF5DC={name:"routemap863828C4992A473C9A5FB6A6B0EDF5DC",displayName:"Route map","class":"Visual",version:"1.3.3",apiVersion:"1.6.0",create:function(e){return new t.extensibility.visual.routemap863828C4992A473C9A5FB6A6B0EDF5DC.Visual(e)},custom:!0}}(n=e.plugins||(e.plugins={}))}(e=t.visuals||(t.visuals={}))}(powerbi||(powerbi={}));