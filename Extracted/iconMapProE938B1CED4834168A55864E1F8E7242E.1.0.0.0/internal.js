/*! For license information please see visual.js.LICENSE.txt */
var iconMapProE938B1CED4834168A55864E1F8E7242E;(()=>{var t={86680:()=>{L.Curve=L.Path.extend({options:{},initialize:function(t,e){L.setOptions(this,e),this._setPath(t)},setLatLngs:function(t){return this.setPath(t)},getLatLngs:function(){return this.getPath()},_updateBounds:function(){var t=this._clickTolerance(),e=new L.Point(t,t);this._pxBounds=new L.Bounds([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)])},getPath:function(){return this._coords},setPath:function(t){return this._setPath(t),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(t){this._coords=t,this._bounds=this._computeBounds()},_computeBounds:function(){for(var t,e,i,r=new L.LatLngBounds,n=0;n<this._coords.length;n++)if("string"==typeof(i=this._coords[n])||i instanceof String)e=i;else if("H"==e)r.extend([t.lat,i[0]]),t=new L.latLng(t.lat,i[0]);else if("V"==e)r.extend([i[0],t.lng]),t=new L.latLng(i[0],t.lng);else if("C"==e){var o=new L.latLng(i[0],i[1]);i=this._coords[++n];var s=new L.latLng(i[0],i[1]);i=this._coords[++n];var a=new L.latLng(i[0],i[1]);r.extend(o),r.extend(s),r.extend(a),a.controlPoint1=o,a.controlPoint2=s,t=a}else if("S"==e){if(s=new L.latLng(i[0],i[1]),i=this._coords[++n],a=new L.latLng(i[0],i[1]),o=t,t.controlPoint2){var l=t.lat-t.controlPoint2.lat,c=t.lng-t.controlPoint2.lng;o=new L.latLng(t.lat+l,t.lng+c)}r.extend(o),r.extend(s),r.extend(a),a.controlPoint1=o,a.controlPoint2=s,t=a}else if("Q"==e){var u=new L.latLng(i[0],i[1]);i=this._coords[++n],a=new L.latLng(i[0],i[1]),r.extend(u),r.extend(a),a.controlPoint=u,t=a}else"T"==e?(a=new L.latLng(i[0],i[1]),u=t,t.controlPoint&&(l=t.lat-t.controlPoint.lat,c=t.lng-t.controlPoint.lng,u=new L.latLng(t.lat+l,t.lng+c)),r.extend(u),r.extend(a),a.controlPoint=u,t=a):(r.extend(i),t=new L.latLng(i[0],i[1]));return r},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._usingCanvas?this._updateCurveCanvas():this._updateCurveSvg()},_project:function(){var t,e,i,r;this._points=[];for(var n=0;n<this._coords.length;n++)if("string"==typeof(t=this._coords[n])||t instanceof String)this._points.push(t),i=t;else{switch(t.length){case 2:r=this._map.latLngToLayerPoint(t),e=t;break;case 1:"H"==i?(r=this._map.latLngToLayerPoint([e[0],t[0]]),e=[e[0],t[0]]):(r=this._map.latLngToLayerPoint([t[0],e[1]]),e=[t[0],e[1]])}this._points.push(r)}if(this._bounds.isValid()){var o=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),s=this._map.latLngToLayerPoint(this._bounds.getSouthEast());this._rawPxBounds=new L.Bounds(o,s),this._updateBounds()}},_curvePointsToPath:function(t){for(var e,i,r="",n=0;n<t.length;n++)if("string"==typeof(e=t[n])||e instanceof String)r+=i=e;else switch(i){case"H":r+=e.x+" ";break;case"V":r+=e.y+" ";break;default:r+=e.x+","+e.y+" "}return r||"M0 0"},beforeAdd:function(t){L.Path.prototype.beforeAdd.call(this,t),this._usingCanvas=this._renderer instanceof L.Canvas,this._usingCanvas&&(this._pathSvgElement=document.createElementNS("http://www.w3.org/2000/svg","path"))},onAdd:function(t){if(this._usingCanvas&&(this._canvasSetDashArray=!this.options.dashArray),L.Path.prototype.onAdd.call(this,t),this._usingCanvas)this.options.animate&&"object"==typeof TWEEN?(this._normalizeCanvasAnimationOptions(),this._tweenedObject={offset:this._pathSvgElement.getTotalLength()},this._tween=new TWEEN.Tween(this._tweenedObject).to({offset:0},this.options.animate.duration).delay(this.options.animate.delay).repeat(this.options.animate.iterations-1).onComplete((i=this,function(){i._canvasAnimating=!1})).start(),this._canvasAnimating=!0,this._animateCanvas()):this._canvasAnimating=!1;else if(this.options.animate&&this._path.animate){var e=Math.min(this._svgSetDashArray(),1e3);this._path.pathLength.baseVal=e,this._path.animate([{strokeDashoffset:e},{strokeDashoffset:0}],this.options.animate)}var i},_updateCurveSvg:function(){this._renderer._setPath(this,this._curvePointsToPath(this._points)),this.options.animate&&this._svgSetDashArray()},_svgSetDashArray:function(){var t=this._path,e=t.getTotalLength();return this.options.dashArray||(t.style.strokeDasharray=e+" "+e),e},_containsPoint:function(t){return!!this._bounds.isValid()&&this._bounds.contains(this._map.layerPointToLatLng(t))},_normalizeCanvasAnimationOptions:function(){var t={delay:0,duration:0,iterations:1};"number"==typeof this.options.animate?t.duration=this.options.animate:(this.options.animate.duration&&(t.duration=this.options.animate.duration),this.options.animate.delay&&(t.delay=this.options.animate.delay),this.options.animate.iterations&&(t.iterations=this.options.animate.iterations)),this.options.animate=t},_updateCurveCanvas:function(){var t=this._curvePointsToPath(this._points);this._pathSvgElement.setAttribute("d",t),this.options.animate&&"object"==typeof TWEEN&&this._canvasSetDashArray&&(this.options.dashArray=this._pathSvgElement.getTotalLength()+"",this._renderer._updateDashArray(this)),this._curveFillStroke(new Path2D(t),this._renderer._ctx)},_animateCanvas:function(){TWEEN.update(),this._renderer._updatePaths(),this._canvasAnimating&&(this._animationFrameId=L.Util.requestAnimFrame(this._animateCanvas,this))},_curveFillStroke:function(t,e){e.lineDashOffset=this._canvasAnimating?this._tweenedObject.offset:0;var i=this.options;i.fill&&(e.globalAlpha=i.fillOpacity,e.fillStyle=i.fillColor||i.color,e.fill(t,i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(e.setLineDash&&e.setLineDash(this.options&&this.options._dashArray||[]),e.globalAlpha=i.opacity,e.lineWidth=i.weight,e.strokeStyle=i.color,e.lineCap=i.lineCap,e.lineJoin=i.lineJoin,e.stroke(t))},trace:function(t){if(void 0===this._map||null===this._map)return[];var e,i,r,n,o,s,a;t=t.filter((function(t){return t>=0&&t<=1}));for(var l=[],c=0;c<this._points.length;c++)if("string"==typeof(e=this._points[c])||e instanceof String)"Z"==(i=e)&&(l=l.concat(this._linearTrace(t,n,r)));else switch(i){case"M":r=e,n=e;break;case"L":case"H":case"V":l=l.concat(this._linearTrace(t,n,e)),n=e;break;case"C":o=e,s=this._points[++c],a=this._points[++c],l=l.concat(this._cubicTrace(t,n,o,s,a)),n=a;break;case"S":o=this._reflectPoint(s,n),s=e,a=this._points[++c],l=l.concat(this._cubicTrace(t,n,o,s,a)),n=a;break;case"Q":o=e,s=this._points[++c],l=l.concat(this._quadraticTrace(t,n,o,s)),n=s;break;case"T":o=this._reflectPoint(o,n),s=e,l=l.concat(this._quadraticTrace(t,n,o,s)),n=s}return l},_linearTrace:function(t,e,i){return t.map((t=>{var r=this._singleLinearTrace(t,e.x,i.x),n=this._singleLinearTrace(t,e.y,i.y);return this._map.layerPointToLatLng([r,n])}))},_quadraticTrace:function(t,e,i,r){return t.map((t=>{var n=this._singleQuadraticTrace(t,e.x,i.x,r.x),o=this._singleQuadraticTrace(t,e.y,i.y,r.y);return this._map.layerPointToLatLng([n,o])}))},_cubicTrace:function(t,e,i,r,n){return t.map((t=>{var o=this._singleCubicTrace(t,e.x,i.x,r.x,n.x),s=this._singleCubicTrace(t,e.y,i.y,r.y,n.y);return this._map.layerPointToLatLng([o,s])}))},_singleLinearTrace:function(t,e,i){return e+t*(i-e)},_singleQuadraticTrace:function(t,e,i,r){var n=1-t;return Math.pow(n,2)*e+2*n*t*i+Math.pow(t,2)*r},_singleCubicTrace:function(t,e,i,r,n){var o=1-t;return Math.pow(o,3)*e+3*Math.pow(o,2)*t*i+3*o*Math.pow(t,2)*r+Math.pow(t,3)*n},_reflectPoint:function(t,e){return x=e.x+(e.x-t.x),y=e.y+(e.y-t.y),L.point(x,y)}}),L.curve=function(t,e){return new L.Curve(t,e)}},46838:function(t,e,i){t.exports=function(t){"use strict";var e=(t=t&&t.hasOwnProperty("default")?t.default:t).Polygon.extend({options:{color:"#00",opacity:.5,fillColor:"#00",fillOpacity:.5,resolution:2},initialize:function(e){this.version="0.1.0",this._R2D=180/Math.PI,this._D2R=Math.PI/180,t.Util.setOptions(this,e);var i=this._compute(this.options.time);this.setLatLngs(i)},setTime:function(t){this.options.time=t;var e=this._compute(t);this.setLatLngs(e)},_sunEclipticPosition:function(t){var e=t-2451545,i=280.46+.9856474*e,r=357.528+.9856003*e;return r%=360,{lambda:(i%=360)+1.915*Math.sin(r*this._D2R)+.02*Math.sin(2*r*this._D2R),R:1.00014-.01671*Math.cos(r*this._D2R)-.0014*Math.cos(2*r*this._D2R)}},_eclipticObliquity:function(t){var e=(t-2451545)/36525;return 23.43929111-e*(46.836769/3600-e*(1831e-7/3600+e*(5.565e-7-e*(1.6e-10-4.34e-8*e/3600))))},_sunEquatorialPosition:function(t,e){var i=Math.atan(Math.cos(e*this._D2R)*Math.tan(t*this._D2R))*this._R2D,r=Math.asin(Math.sin(e*this._D2R)*Math.sin(t*this._D2R))*this._R2D;return{alpha:i+=90*Math.floor(t/90)-90*Math.floor(i/90),delta:r}},_hourAngle:function(t,e,i){return 15*(i+t/15)-e.alpha},_latitude:function(t,e){return Math.atan(-Math.cos(t*this._D2R)/Math.tan(e.delta*this._D2R))*this._R2D},_compute:function(t){for(var e=(t?new Date(t):new Date)/864e5+2440587.5,i=function(t){return(18.697374558+24.06570982441908*(t-2451545))%24}(e),r=[],n=this._sunEclipticPosition(e),o=this._eclipticObliquity(e),s=this._sunEquatorialPosition(n.lambda,o),a=0;a<=720*this.options.resolution;a++){var l=a/this.options.resolution-360,c=this._hourAngle(l,s,i);r[a+1]=[this._latitude(c,s),l]}return s.delta<0?(r[0]=[90,-360],r[r.length]=[90,360]):(r[0]=[-90,-360],r[r.length]=[-90,360]),r}});return function(t){return new e(t)}}(i(53481))},77600:function(t,e,i){var r;"undefined"!=typeof globalThis?globalThis:this||self,r=function(t,e){t.MaplibreGL=t.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(e){t.setOptions(this,e),this._throttledUpdate=t.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(e){this._container||this._initContainer();var i=this.getPaneName();e.getPane(i).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),e.options.zoomAnimation&&t.DomEvent.on(e._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(e){this._map._proxy&&this._map.options.zoomAnimation&&t.DomEvent.off(this._map._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this);var i=this.getPaneName();e.getPane(i).removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getBounds:function(){var e=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return t.latLngBounds(this._map.containerPointToLatLng(i.subtract(e)),this._map.containerPointToLatLng(i.add(e)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_roundPoint:function(t){return{x:Math.round(t.x),y:Math.round(t.y)}},_initContainer:function(){var e=this._container=t.DomUtil.create("div","leaflet-gl-layer"),i=this.getSize(),r=this._map.getSize().multiplyBy(this.options.padding);e.style.width=i.x+"px",e.style.height=i.y+"px";var n=this._map.containerPointToLayerPoint([0,0]).subtract(r);t.DomUtil.setPosition(e,this._roundPoint(n))},_initGL:function(){var i=this._map.getCenter(),r=t.extend({},this.options,{container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new e.Map(r),this._glMap.transform.latRange=null,this._glMap.transform.maxValidLatitude=1/0,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var n=this._glMap._actualCanvas;t.DomUtil.addClass(n,"leaflet-image-layer"),t.DomUtil.addClass(n,"leaflet-zoom-animated"),this.options.interactive&&t.DomUtil.addClass(n,"leaflet-interactive"),this.options.className&&t.DomUtil.addClass(n,this.options.className)},_update:function(e){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var i=this.getSize(),r=this._container,n=this._glMap,o=this._map.getSize().multiplyBy(this.options.padding),s=this._map.containerPointToLayerPoint([0,0]).subtract(o);t.DomUtil.setPosition(r,this._roundPoint(s)),this._transformGL(n),n.transform.width!==i.x||n.transform.height!==i.y?(r.style.width=i.x+"px",r.style.height=i.y+"px",null!==n._resize&&void 0!==n._resize?n._resize():n.resize()):null!==n._update&&void 0!==n._update?n._update():n.update()}},_transformGL:function(t){var i=this._map.getCenter(),r=t.transform;r.center=e.LngLat.convert([i.lng,i.lat]),r.zoom=this._map.getZoom()-1},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(e){var i=this._map.getZoomScale(e.zoom),r=this._map.getSize().multiplyBy(this.options.padding*i),n=this.getSize()._divideBy(2),o=this._map.project(e.center,e.zoom)._subtract(n)._add(this._map._getMapPanePos().add(r))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),e.zoom)._subtract(o);t.DomUtil.setTransform(this._glMap._actualCanvas,s.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var e=this._map.getZoomScale(this._map.getZoom());t.DomUtil.setTransform(this._glMap._actualCanvas,null,e),this._zooming=!1,this._update()},_transitionEnd:function(e){t.Util.requestAnimFrame((function(){var e=this._map.getZoom(),i=this._map.getCenter(),r=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());t.DomUtil.setTransform(this._glMap._actualCanvas,r,1),this._glMap.once("moveend",t.Util.bind((function(){this._zoomEnd()}),this)),this._glMap.jumpTo({center:i,zoom:e-1})}),this)},_resize:function(t){this._transitionEnd(t)}}),t.maplibreGL=function(e){return new t.MaplibreGL(e)}},"function"==typeof define&&define.amd?define(["leaflet","maplibre-gl"],r):t.exports=r(i(53481),i(16443))},27088:(t,e,i)=>{"use strict";i.d(e,{e:()=>c,i:()=>h});var r=function(t,e,i,r){var n=(r[0]-i[0])*(t[1]-i[1])-(r[1]-i[1])*(t[0]-i[0]),o=(e[0]-t[0])*(t[1]-i[1])-(e[1]-t[1])*(t[0]-i[0]),s=(r[1]-i[1])*(e[0]-t[0])-(r[0]-i[0])*(e[1]-t[1]);if(0!==s){var a=n/s,l=o/s;if(a>=0&&a<=1&&l>=0&&l<=1)return!0}return!1},n=function(t,e){for(var i=0;i<t.length-1;i++)for(var n=0;n<e.length-1;n++)if(r(t[i],t[i+1],e[n],e[n+1]))return!0;return!1},o=function(t){return function(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}(t[0],t[t.length-1])||t.push(t[0]),t},s=function(t){for(var e,i=0,r=0,n=t.length,o=t[r];r<n-1;r++)i+=((e=t[r+1])[0]-o[0])*(e[1]+o[1]),o=e;return i>=0},a=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},l=function(t,e){var i=n(t,e),r=function(t,e){for(var i=!1,r=-1,n=t.length,o=n-1;++r<n;o=r)(t[r][1]<=e[1]&&e[1]<t[o][1]||t[o][1]<=e[1]&&e[1]<t[r][1])&&e[0]<(t[o][0]-t[r][0])*(e[1]-t[r][1])/(t[o][1]-t[r][1])+t[r][0]&&(i=!i);return i}(t,e[0]);return!(i||!r)},c=function t(e,i){var r={};if(e.features){r.type="FeatureCollection",r.features=[];for(var c=0;c<e.features.length;c++)r.features.push(t(e.features[c],i))}if("number"==typeof e.x&&"number"==typeof e.y&&(r.type="Point",r.coordinates=[e.x,e.y],"number"==typeof e.z&&r.coordinates.push(e.z)),e.points&&(r.type="MultiPoint",r.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(r.type="LineString",r.coordinates=e.paths[0].slice(0)):(r.type="MultiLineString",r.coordinates=e.paths.slice(0))),e.rings&&(r=function(t){for(var e,i,r,a=[],c=[],u=0;u<t.length;u++){var h=o(t[u].slice(0));if(!(h.length<4))if(s(h)){var p=[h.slice().reverse()];a.push(p)}else c.push(h.slice().reverse())}for(var d=[];c.length;){r=c.pop();var f=!1;for(e=a.length-1;e>=0;e--)if(i=a[e][0],l(i,r)){a[e].push(r),f=!0;break}f||d.push(r)}for(;d.length;){r=d.pop();var m=!1;for(e=a.length-1;e>=0;e--)if(i=a[e][0],n(i,r)){a[e].push(r),m=!0;break}m||a.push([r.reverse()])}return 1===a.length?{type:"Polygon",coordinates:a[0]}:{type:"MultiPolygon",coordinates:a}}(e.rings.slice(0))),"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax&&(r.type="Polygon",r.coordinates=[[[e.xmax,e.ymax],[e.xmin,e.ymax],[e.xmin,e.ymin],[e.xmax,e.ymin],[e.xmax,e.ymax]]]),(e.geometry||e.attributes)&&(r.type="Feature",r.geometry=e.geometry?t(e.geometry):null,r.properties=e.attributes?a(e.attributes):null,e.attributes))try{r.id=function(t,e){for(var i=e?[e,"OBJECTID","FID"]:["OBJECTID","FID"],r=0;r<i.length;r++){var n=i[r];if(n in t&&("string"==typeof t[n]||"number"==typeof t[n]))return t[n]}throw Error("No valid id attribute found")}(e.attributes,i)}catch(t){}return JSON.stringify(r.geometry)===JSON.stringify({})&&(r.geometry=null),e.spatialReference&&e.spatialReference.wkid&&4326!==e.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(e.spatialReference)),r},u=function(t){var e=[],i=t.slice(0),r=o(i.shift().slice(0));if(r.length>=4){s(r)||r.reverse(),e.push(r);for(var n=0;n<i.length;n++){var a=o(i[n].slice(0));a.length>=4&&(s(a)&&a.reverse(),e.push(a))}}return e},h=function t(e,i){i=i||"OBJECTID";var r,n={wkid:4326},o={};switch(e.type){case"Point":o.x=e.coordinates[0],o.y=e.coordinates[1],null!=e.coordinates[2]&&(o.z=e.coordinates[2]),o.spatialReference=n;break;case"MultiPoint":o.points=e.coordinates.slice(0),null!=e.coordinates[0][2]&&(o.hasZ=!0),o.spatialReference=n;break;case"LineString":o.paths=[e.coordinates.slice(0)],null!=e.coordinates[0][2]&&(o.hasZ=!0),o.spatialReference=n;break;case"MultiLineString":o.paths=e.coordinates.slice(0),null!=e.coordinates[0][0][2]&&(o.hasZ=!0),o.spatialReference=n;break;case"Polygon":o.rings=u(e.coordinates.slice(0)),null!=e.coordinates[0][0][2]&&(o.hasZ=!0),o.spatialReference=n;break;case"MultiPolygon":o.rings=function(t){for(var e=[],i=0;i<t.length;i++)for(var r=u(t[i]),n=r.length-1;n>=0;n--){var o=r[n].slice(0);e.push(o)}return e}(e.coordinates.slice(0)),null!=e.coordinates[0][0][0][2]&&(o.hasZ=!0),o.spatialReference=n;break;case"Feature":e.geometry&&(o.geometry=t(e.geometry,i)),o.attributes=e.properties?a(e.properties):{},e.id&&(o.attributes[i]=e.id);break;case"FeatureCollection":for(o=[],r=0;r<e.features.length;r++)o.push(t(e.features[r],i));break;case"GeometryCollection":for(o=[],r=0;r<e.geometries.length;r++)o.push(t(e.geometries[r],i))}return o}},44383:(t,e,i)=>{"use strict";var r=i(58421);function n(t){var e=[1/0,1/0,-1/0,-1/0];return r.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}n.default=n,e.A=n},88967:(t,e)=>{"use strict";function i(t,e,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=t,r}function r(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!d(t[0])||!d(t[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:t},e,r)}function n(t,e,r){void 0===r&&(r={});for(var n=0,o=t;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:t},e,r)}function o(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:t},e,r)}function s(t,e){void 0===e&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function a(t,e,r){return void 0===r&&(r={}),i({type:"MultiLineString",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),i({type:"MultiPoint",coordinates:t},e,r)}function c(t,e,r){return void 0===r&&(r={}),i({type:"MultiPolygon",coordinates:t},e,r)}function u(t,i){void 0===i&&(i="kilometers");var r=e.factors[i];if(!r)throw new Error(i+" units is invalid");return t*r}function h(t,i){void 0===i&&(i="kilometers");var r=e.factors[i];if(!r)throw new Error(i+" units is invalid");return t/r}function p(t){return t%(2*Math.PI)*180/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=i,e.geometry=function(t,e,i){switch(void 0===i&&(i={}),t){case"Point":return r(e).geometry;case"LineString":return o(e).geometry;case"Polygon":return n(e).geometry;case"MultiPoint":return l(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return c(e).geometry;default:throw new Error(t+" is invalid")}},e.point=r,e.points=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return r(t,e)})),i)},e.polygon=n,e.polygons=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return n(t,e)})),i)},e.lineString=o,e.lineStrings=function(t,e,i){return void 0===i&&(i={}),s(t.map((function(t){return o(t,e)})),i)},e.featureCollection=s,e.multiLineString=a,e.multiPoint=l,e.multiPolygon=c,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),i({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var i=Math.pow(10,e||0);return Math.round(t*i)/i},e.radiansToLength=u,e.lengthToRadians=h,e.lengthToDegrees=function(t,e){return p(h(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=p,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,i){if(void 0===e&&(e="kilometers"),void 0===i&&(i="kilometers"),!(t>=0))throw new Error("length must be a positive number");return u(h(t,e),i)},e.convertArea=function(t,i,r){if(void 0===i&&(i="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw new Error("area must be a positive number");var n=e.areaFactors[i];if(!n)throw new Error("invalid original units");var o=e.areaFactors[r];if(!o)throw new Error("invalid final units");return t/n*o},e.isNumber=d,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},e.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}},58421:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(88967);function n(t,e,i){if(null!==t)for(var r,o,s,a,l,c,u,h,p=0,d=0,f=t.type,m="FeatureCollection"===f,g="Feature"===f,_=m?t.features.length:1,y=0;y<_;y++){l=(h=!!(u=m?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var A=0;A<l;A++){var v=0,x=0;if(null!==(a=h?u.geometries[A]:u)){c=a.coordinates;var b=a.type;switch(p=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(c,d,y,v,x))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(!1===e(c[r],d,y,v,x))return!1;d++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(o=0;o<c[r].length-p;o++){if(!1===e(c[r][o],d,y,v,x))return!1;d++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(x=0,o=0;o<c[r].length;o++){for(s=0;s<c[r][o].length-p;s++){if(!1===e(c[r][o][s],d,y,v,x))return!1;d++}x++}v++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===n(a.geometries[r],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e){var i;switch(t.type){case"FeatureCollection":for(i=0;i<t.features.length&&!1!==e(t.features[i].properties,i);i++);break;case"Feature":e(t.properties,0)}}function s(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}function a(t,e){var i,r,n,o,s,a,l,c,u,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(i=0;i<m;i++){for(a=d?t.features[i].geometry:f?t.geometry:t,c=d?t.features[i].properties:f?t.properties:{},u=d?t.features[i].bbox:f?t.bbox:void 0,h=d?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=l?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,c,u,h))return!1;p++}}function l(t,e){a(t,(function(t,i,n,o,s){var a,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e(r.feature(t,n,{bbox:o,id:s}),i,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<t.coordinates.length;c++){var u={type:a,coordinates:t.coordinates[c]};if(!1===e(r.feature(u,n),i,c))return!1}}))}function c(t,e){l(t,(function(t,i,o){var s=0;if(t.geometry){var a=t.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var l,c=0,u=0,h=0;return!1!==n(t,(function(n,a,p,d,f){if(void 0===l||i>c||d>u||f>h)return l=n,c=i,u=d,h=f,void(s=0);var m=r.lineString([l,n],t.properties);if(!1===e(m,i,o,f,s))return!1;s++,l=n}))&&void 0}}}))}function u(t,e){if(!t)throw new Error("geojson is required");l(t,(function(t,i,n){if(null!==t.geometry){var o=t.geometry.type,s=t.geometry.coordinates;switch(o){case"LineString":if(!1===e(t,i,n,0,0))return!1;break;case"Polygon":for(var a=0;a<s.length;a++)if(!1===e(r.lineString(s[a],t.properties),i,n,a))return!1}}}))}e.coordAll=function(t){var e=[];return n(t,(function(t){e.push(t)})),e},e.coordEach=n,e.coordReduce=function(t,e,i,r){var o=i;return n(t,(function(t,r,n,s,a){o=0===r&&void 0===i?t:e(o,t,r,n,s,a)}),r),o},e.featureEach=s,e.featureReduce=function(t,e,i){var r=i;return s(t,(function(t,n){r=0===n&&void 0===i?t:e(r,t,n)})),r},e.findPoint=function(t,e){if(e=e||{},!r.isObject(e))throw new Error("options is invalid");var i,n=e.featureIndex||0,o=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.coordIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),l=l||t.features[n].properties,i=t.features[n].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var c=i.coordinates;switch(i.type){case"Point":return r.point(c,l,e);case"MultiPoint":return o<0&&(o=c.length+o),r.point(c[o],l,e);case"LineString":return a<0&&(a=c.length+a),r.point(c[a],l,e);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a),r.point(c[s][a],l,e);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a),r.point(c[o][a],l,e);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a),r.point(c[o][s][a],l,e)}throw new Error("geojson is invalid")},e.findSegment=function(t,e){if(e=e||{},!r.isObject(e))throw new Error("options is invalid");var i,n=e.featureIndex||0,o=e.multiFeatureIndex||0,s=e.geometryIndex||0,a=e.segmentIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),l=l||t.features[n].properties,i=t.features[n].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw new Error("geojson is invalid")}if(null===i)return null;var c=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),r.lineString([c[a],c[a+1]],l,e);case"Polygon":return s<0&&(s=c.length+s),a<0&&(a=c[s].length+a-1),r.lineString([c[s][a],c[s][a+1]],l,e);case"MultiLineString":return o<0&&(o=c.length+o),a<0&&(a=c[o].length+a-1),r.lineString([c[o][a],c[o][a+1]],l,e);case"MultiPolygon":return o<0&&(o=c.length+o),s<0&&(s=c[o].length+s),a<0&&(a=c[o][s].length-a-1),r.lineString([c[o][s][a],c[o][s][a+1]],l,e)}throw new Error("geojson is invalid")},e.flattenEach=l,e.flattenReduce=function(t,e,i){var r=i;return l(t,(function(t,n,o){r=0===n&&0===o&&void 0===i?t:e(r,t,n,o)})),r},e.geomEach=a,e.geomReduce=function(t,e,i){var r=i;return a(t,(function(t,n,o,s,a){r=0===n&&void 0===i?t:e(r,t,n,o,s,a)})),r},e.lineEach=u,e.lineReduce=function(t,e,i){var r=i;return u(t,(function(t,n,o,s){r=0===n&&void 0===i?t:e(r,t,n,o,s)})),r},e.propEach=o,e.propReduce=function(t,e,i){var r=i;return o(t,(function(t,n){r=0===n&&void 0===i?t:e(r,t,n)})),r},e.segmentEach=c,e.segmentReduce=function(t,e,i){var r=i,n=!1;return c(t,(function(t,o,s,a,l){r=!1===n&&void 0===i?t:e(r,t,o,s,a,l),n=!0})),r}},78820:(t,e,i)=>{"use strict";function r(){return this._array=null,Promise.resolve()}i.d(e,{A:()=>r})},87892:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(78820),n=i(59354);function o(t){return new s(t instanceof Uint8Array?t:new Uint8Array(t))}function s(t){this._array=t}s.prototype.read=n.A,s.prototype.cancel=r.A},59354:(t,e,i)=>{"use strict";function r(){var t=this._array;return this._array=null,Promise.resolve(t?{done:!1,value:t}:{done:!0,value:void 0})}i.d(e,{A:()=>r})},95236:(t,e,i)=>{"use strict";var r=i(79795),n=[],o=[],s=r.makeRequestCallFromTimer((function(){if(o.length)throw o.shift()}));function a(t){var e;(e=n.length?n.pop():new l).task=t,r(e)}function l(){this.task=null}t.exports=a,l.prototype.call=function(){try{this.task.call()}catch(t){a.onerror?a.onerror(t):(o.push(t),s())}finally{this.task=null,n[n.length]=this}}},79795:t=>{"use strict";function e(t){r.length||i(),r[r.length]=t}t.exports=e;var i,r=[],n=0;function o(){for(;n<r.length;){var t=n;if(n+=1,r[t].call(),n>1024){for(var e=0,i=r.length-n;e<i;e++)r[e]=r[e+n];r.length-=n,n=0}}r.length=0,n=0}var s,a,l,c="undefined"!=typeof global?global:self,u=c.MutationObserver||c.WebKitMutationObserver;function h(t){return function(){var e=setTimeout(r,0),i=setInterval(r,50);function r(){clearTimeout(e),clearInterval(i),t()}}}"function"==typeof u?(s=1,a=new u(o),l=document.createTextNode(""),a.observe(l,{characterData:!0}),i=function(){s=-s,l.data=s}):i=h(o),e.requestFlush=i,e.makeRequestCallFromTimer=h},38075:(t,e,i)=>{"use strict";var r=i(70453),n=i(10487),o=n(r("String.prototype.indexOf"));t.exports=function(t,e){var i=r(t,!!e);return"function"==typeof i&&o(t,".prototype.")>-1?n(i):i}},10487:(t,e,i)=>{"use strict";var r=i(66743),n=i(70453),o=i(96897),s=i(69675),a=n("%Function.prototype.apply%"),l=n("%Function.prototype.call%"),c=n("%Reflect.apply%",!0)||r.call(l,a),u=i(30655),h=n("%Math.max%");t.exports=function(t){if("function"!=typeof t)throw new s("a function is required");var e=c(r,l,arguments);return o(e,1+h(0,t.length-(arguments.length-1)),!0)};var p=function(){return c(r,a,arguments)};u?u(t.exports,"apply",{value:p}):t.exports.apply=p},71582:(t,e,i)=>{"use strict";var r=i(9248),n=i(44262),o=i(51476),s=i(53467).orient2d;function a(t,e,i){e=Math.max(0,void 0===e?2:e),i=i||0;var n=function(t){for(var e=t[0],i=t[0],r=t[0],n=t[0],s=0;s<t.length;s++){var a=t[s];a[0]<e[0]&&(e=a),a[0]>r[0]&&(r=a),a[1]<i[1]&&(i=a),a[1]>n[1]&&(n=a)}var l=[e,i,r,n],c=l.slice();for(s=0;s<t.length;s++)o(t[s],l)||c.push(t[s]);return function(t){t.sort(A);for(var e=[],i=0;i<t.length;i++){for(;e.length>=2&&d(e[e.length-2],e[e.length-1],t[i])<=0;)e.pop();e.push(t[i])}for(var r=[],n=t.length-1;n>=0;n--){for(;r.length>=2&&d(r[r.length-2],r[r.length-1],t[n])<=0;)r.pop();r.push(t[n])}return r.pop(),e.pop(),e.concat(r)}(c)}(t),s=new r(16);s.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},s.compareMinX=function(t,e){return t[0]-e[0]},s.compareMinY=function(t,e){return t[1]-e[1]},s.load(t);for(var a,c=[],u=0;u<n.length;u++){var h=n[u];s.remove(h),a=m(h,a),c.push(a)}var p=new r(16);for(u=0;u<c.length;u++)p.insert(f(c[u]));for(var _=e*e,y=i*i;c.length;){var v=c.shift(),x=v.p,b=v.next.p,w=g(x,b);if(!(w<y)){var S=w/_;(h=l(s,v.prev.p,x,b,v.next.next.p,S,p))&&Math.min(g(h,x),g(h,b))<=S&&(c.push(v),c.push(m(h,v)),s.remove(h),p.remove(v),p.insert(f(v)),p.insert(f(v.next)))}}v=a;var T=[];do{T.push(v.p),v=v.next}while(v!==a);return T.push(v.p),T}function l(t,e,i,r,o,s,a){for(var l=new n([],c),h=t.data;h;){for(var d=0;d<h.children.length;d++){var f=h.children[d],m=h.leaf?_(f,i,r):u(i,r,f);m>s||l.push({node:f,dist:m})}for(;l.length&&!l.peek().node.children;){var g=l.pop(),y=g.node,A=_(y,e,i),v=_(y,r,o);if(g.dist<A&&g.dist<v&&p(i,y,a)&&p(r,y,a))return y}(h=l.pop())&&(h=h.node)}return null}function c(t,e){return t.dist-e.dist}function u(t,e,i){if(h(t,i)||h(e,i))return 0;var r=y(t[0],t[1],e[0],e[1],i.minX,i.minY,i.maxX,i.minY);if(0===r)return 0;var n=y(t[0],t[1],e[0],e[1],i.minX,i.minY,i.minX,i.maxY);if(0===n)return 0;var o=y(t[0],t[1],e[0],e[1],i.maxX,i.minY,i.maxX,i.maxY);if(0===o)return 0;var s=y(t[0],t[1],e[0],e[1],i.minX,i.maxY,i.maxX,i.maxY);return 0===s?0:Math.min(r,n,o,s)}function h(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function p(t,e,i){for(var r,n,o,s,a=Math.min(t[0],e[0]),l=Math.min(t[1],e[1]),c=Math.max(t[0],e[0]),u=Math.max(t[1],e[1]),h=i.search({minX:a,minY:l,maxX:c,maxY:u}),p=0;p<h.length;p++)if(r=h[p].p,n=h[p].next.p,o=t,r!==(s=e)&&n!==o&&d(r,n,o)>0!=d(r,n,s)>0&&d(o,s,r)>0!=d(o,s,n)>0)return!1;return!0}function d(t,e,i){return s(t[0],t[1],e[0],e[1],i[0],i[1])}function f(t){var e=t.p,i=t.next.p;return t.minX=Math.min(e[0],i[0]),t.minY=Math.min(e[1],i[1]),t.maxX=Math.max(e[0],i[0]),t.maxY=Math.max(e[1],i[1]),t}function m(t,e){var i={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(i.next=e.next,i.prev=e,e.next.prev=i,e.next=i):(i.prev=i,i.next=i),i}function g(t,e){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function _(t,e,i){var r=e[0],n=e[1],o=i[0]-r,s=i[1]-n;if(0!==o||0!==s){var a=((t[0]-r)*o+(t[1]-n)*s)/(o*o+s*s);a>1?(r=i[0],n=i[1]):a>0&&(r+=o*a,n+=s*a)}return(o=t[0]-r)*o+(s=t[1]-n)*s}function y(t,e,i,r,n,o,s,a){var l,c,u,h,p=i-t,d=r-e,f=s-n,m=a-o,g=t-n,_=e-o,y=p*p+d*d,A=p*f+d*m,v=f*f+m*m,x=p*g+d*_,b=f*g+m*_,w=y*v-A*A,S=w,T=w;0===w?(c=0,S=1,h=b,T=v):(h=y*b-A*x,(c=A*b-v*x)<0?(c=0,h=b,T=v):c>S&&(c=S,h=b+A,T=v)),h<0?(h=0,-x<0?c=0:-x>y?c=S:(c=-x,S=y)):h>T&&(h=T,-x+A<0?c=0:-x+A>y?c=S:(c=-x+A,S=y));var C=(1-(u=0===h?0:h/T))*n+u*s-((1-(l=0===c?0:c/S))*t+l*i),M=(1-u)*o+u*a-((1-l)*e+l*r);return C*C+M*M}function A(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}n.default&&(n=n.default),t.exports=a,t.exports.default=a},9248:function(t){t.exports=function(){"use strict";function t(t,r,n,o,s){!function t(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var p=i[r],d=n,f=o;for(e(i,n,r),s(i[o],p)>0&&e(i,n,o);d<f;){for(e(i,d,f),d++,f--;s(i[d],p)<0;)d++;for(;s(i[f],p)>0;)f--}0===s(i[n],p)?e(i,n,f):e(i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}(t,r,n||0,o||t.length-1,s||i)}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,r,n){n||(n=f(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];a(n,t.leaf?r(s):s)}return n}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,i,r,n,o){for(var s=[i,r];s.length;)if(!((r=s.pop())-(i=s.pop())<=n)){var a=i+Math.ceil((r-i)/n/2)*n;t(e,a,i,r,o),s.push(i,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,i=[];if(!d(t,e))return i;for(var r=this.toBBox,n=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?r(s):s;d(t,a)&&(e.leaf?i.push(s):p(t,a)?this._all(s,i):n.push(s))}e=n.pop()}return i},r.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var i=[];e;){for(var r=0;r<e.children.length;r++){var n=e.children[r],o=e.leaf?this.toBBox(n):n;if(d(t,o)){if(e.leaf||p(t,o))return!0;i.push(n)}}e=i.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var i,r,o,s=this.data,a=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=c.pop(),o=!0),s.leaf){var u=n(t,s.children,e);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!p(s,a)?r?(i++,s=r.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},r.prototype._build=function(t,e,i,r){var n,s=i-e+1,a=this._maxEntries;if(s<=a)return o(n=f(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(n=f([])).leaf=!1,n.height=r;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(t,e,i,c,this.compareMinX);for(var u=e;u<=i;u+=c){var h=Math.min(u+c-1,i);m(t,u,h,l,this.compareMinY);for(var p=u;p<=h;p+=l){var d=Math.min(p+l-1,h);n.children.push(this._build(t,p,d,r-1))}}return o(n,this.toBBox),n},r.prototype._chooseSubtree=function(t,e,i,r){for(;r.push(e),!e.leaf&&r.length-1!==i;){for(var n=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=u(l),h=(p=t,d=l,(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-c);h<o?(o=h,n=c<n?c:n,s=l):h===o&&c<n&&(n=c,s=l)}e=s||e.children[0]}var p,d;return e},r.prototype._insert=function(t,e,i){var r=i?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),a(o,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},r.prototype._split=function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),a=f(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},r.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,i){for(var r,n,o,a,l,c,h,p=1/0,d=1/0,f=e;f<=i-e;f++){var m=s(t,0,f,this.toBBox),g=s(t,f,i,this.toBBox),_=(n=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(n.minX,o.minX),l=Math.max(n.minY,o.minY),c=Math.min(n.maxX,o.maxX),h=Math.min(n.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(m)+u(g);_<p?(p=_,r=f,d=y<d?y:d):_===p&&y<d&&(d=y,r=f)}return r||i-e},r.prototype._chooseSplitAxis=function(t,e,i){var r=t.leaf?this.compareMinX:l,n=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,i,r){t.children.sort(r);for(var n=this.toBBox,o=s(t,0,e,n),l=s(t,i-e,i,n),c=h(o)+h(l),u=e;u<i-e;u++){var p=t.children[u];a(o,t.leaf?n(p):p),c+=h(o)}for(var d=i-e-1;d>=e;d--){var f=t.children[d];a(l,t.leaf?n(f):f),c+=h(l)}return c},r.prototype._adjustParentBBoxes=function(t,e,i){for(var r=i;r>=0;r--)a(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},r}()},57672:(t,e,i)=>{"use strict";i(73004),i(26520),i(51001),i(60365),i(55566),i(10652),i(38146),i(18457),i(5018),i(91449),i(68881),i(52308),i(5325),i(93997),i(1625),i(35016),i(73702),i(63034),i(25431),i(5591),i(76253),i(85923),i(96318),i(16969),i(26585),i(43127),i(35901),i(18983),i(54341),i(79421)},67345:(t,e,i)=>{"use strict";var r=Array.prototype;r.slice,r.map},62210:(t,e,i)=>{"use strict";function r(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}i.d(e,{A:()=>r})},7548:(t,e,i)=>{"use strict";var r=i(62210),n=(0,i(77465).A)(r.A);n.right,n.left},77465:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(62210);function n(t){var e;return 1===t.length&&(e=t,t=function(t,i){return(0,r.A)(e(t),i)}),{left:function(e,i,r,n){for(null==r&&(r=0),null==n&&(n=e.length);r<n;){var o=r+n>>>1;t(e[o],i)<0?r=o+1:n=o}return r},right:function(e,i,r,n){for(null==r&&(r=0),null==n&&(n=e.length);r<n;){var o=r+n>>>1;t(e[o],i)>0?n=o:r=o+1}return r}}}},63722:(t,e,i)=>{"use strict";i(67345),i(7548),i(51358)},89880:(t,e,i)=>{"use strict";i.d(e,{Am:()=>r.A}),i(7548),i(63722),i(43778);var r=i(63572);i(51358)},63572:(t,e,i)=>{"use strict";function r(t){for(var e,i,r,n=t.length,o=-1,s=0;++o<n;)s+=t[o].length;for(i=new Array(s);--n>=0;)for(e=(r=t[n]).length;--e>=0;)i[--s]=r[e];return i}i.d(e,{A:()=>r})},43778:(t,e,i)=>{"use strict";i(67345)},51358:(t,e,i)=>{"use strict";Math.sqrt(50),Math.sqrt(10),Math.sqrt(2)},71637:(t,e,i)=>{"use strict";function r(){return new n}function n(){this.reset()}i.d(e,{A:()=>r}),n.prototype={constructor:n,reset:function(){this.s=this.t=0},add:function(t){s(o,t,this.t),s(this,o.s,this.s),this.s?this.t+=o.t:this.s=o.t},valueOf:function(){return this.s}};var o=new n;function s(t,e,i){var r=t.s=e+i,n=r-e,o=r-n;t.t=e-o+(i-n)}},73004:(t,e,i)=>{"use strict";i.d(e,{B0:()=>h,Y7:()=>d});var r,n,o,s,a,l=i(71637),c=i(86407),u=i(33774),h=(i(54341),(0,l.A)()),p=(0,l.A)(),d={point:u.A,lineStart:u.A,lineEnd:u.A,polygonStart:function(){h.reset(),d.lineStart=f,d.lineEnd=m},polygonEnd:function(){var t=+h;p.add(t<0?c.FA+t:t),this.lineStart=this.lineEnd=this.point=u.A},sphere:function(){p.add(c.FA)}};function f(){d.point=g}function m(){_(r,n)}function g(t,e){d.point=_,r=t,n=e,t*=c.F2,e*=c.F2,o=t,s=(0,c.gn)(e=e/2+c.gz),a=(0,c.F8)(e)}function _(t,e){t*=c.F2,e=(e*=c.F2)/2+c.gz;var i=t-o,r=i>=0?1:-1,n=r*i,l=(0,c.gn)(e),u=(0,c.F8)(e),p=a*u,d=s*l+p*(0,c.gn)(n),f=p*r*(0,c.F8)(n);h.add((0,c.FP)(f,d)),o=t,s=l,a=u}},26520:(t,e,i)=>{"use strict";var r=i(71637);i(73004),i(19715),i(86407),i(54341),(0,r.A)()},19715:(t,e,i)=>{"use strict";i.d(e,{Cx:()=>a,EV:()=>n,jf:()=>o,r8:()=>s});var r=i(86407);function n(t){return[(0,r.FP)(t[1],t[0]),(0,r.qR)(t[2])]}function o(t){var e=t[0],i=t[1],n=(0,r.gn)(i);return[n*(0,r.gn)(e),n*(0,r.F8)(e),(0,r.F8)(i)]}function s(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function a(t){var e=(0,r.RZ)(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}},51001:(t,e,i)=>{"use strict";var r,n,o,s,a,l,c,u,h,p=i(86407),d=i(33774),f=(i(54341),{sphere:d.A,point:m,lineStart:_,lineEnd:v,polygonStart:function(){f.lineStart=x,f.lineEnd=b},polygonEnd:function(){f.lineStart=_,f.lineEnd=v}});function m(t,e){t*=p.F2,e*=p.F2;var i=(0,p.gn)(e);g(i*(0,p.gn)(t),i*(0,p.F8)(t),(0,p.F8)(e))}function g(t,e,i){++r,n+=(t-n)/r,o+=(e-o)/r,s+=(i-s)/r}function _(){f.point=y}function y(t,e){t*=p.F2,e*=p.F2;var i=(0,p.gn)(e);c=i*(0,p.gn)(t),u=i*(0,p.F8)(t),h=(0,p.F8)(e),f.point=A,g(c,u,h)}function A(t,e){t*=p.F2,e*=p.F2;var i=(0,p.gn)(e),r=i*(0,p.gn)(t),n=i*(0,p.F8)(t),o=(0,p.F8)(e),s=(0,p.FP)((0,p.RZ)((s=u*o-h*n)*s+(s=h*r-c*o)*s+(s=c*n-u*r)*s),c*r+u*n+h*o);g(c=r,u=n,h=o)}function v(){f.point=m}function x(){f.point=w}function b(){S(a,l),f.point=m}function w(t,e){a=t,l=e,t*=p.F2,e*=p.F2,f.point=S;var i=(0,p.gn)(e);c=i*(0,p.gn)(t),u=i*(0,p.F8)(t),h=(0,p.F8)(e),g(c,u,h)}function S(t,e){t*=p.F2,e*=p.F2;var i=(0,p.gn)(e),r=i*(0,p.gn)(t),n=i*(0,p.F8)(t),o=(0,p.F8)(e),s=u*o-h*n,a=h*r-c*o,l=c*n-u*r,d=(0,p.RZ)(s*s+a*a+l*l);(0,p.qR)(d);g(c=r,u=n,h=o)}},60365:(t,e,i)=>{"use strict";i(19715),i(86407),i(18983)},44417:(t,e,i)=>{"use strict";var r=i(9276),n=i(86407);(0,r.A)((function(){return!0}),(function(t){var e,i=NaN,r=NaN,o=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(s,a){var l=s>0?n.pi:-n.pi,c=(0,n.tn)(s-i);(0,n.tn)(c-n.pi)<n.Ni?(t.point(i,r=(r+a)/2>0?n.TW:-n.TW),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(l,r),t.point(s,r),e=0):o!==l&&c>=n.pi&&((0,n.tn)(i-o)<n.Ni&&(i-=o*n.Ni),(0,n.tn)(s-l)<n.Ni&&(s-=l*n.Ni),r=function(t,e,i,r){var o,s,a=(0,n.F8)(t-i);return(0,n.tn)(a)>n.Ni?(0,n.rY)(((0,n.F8)(e)*(s=(0,n.gn)(r))*(0,n.F8)(i)-(0,n.F8)(r)*(o=(0,n.gn)(e))*(0,n.F8)(t))/(o*s*a)):(e+r)/2}(i,r,s,a),t.point(o,r),t.lineEnd(),t.lineStart(),t.point(l,r),e=0),t.point(i=s,r=a),o=l},lineEnd:function(){t.lineEnd(),i=r=NaN},clean:function(){return 2-e}}}),(function(t,e,i,r){var o;if(null==t)o=i*n.TW,r.point(-n.pi,o),r.point(0,o),r.point(n.pi,o),r.point(n.pi,0),r.point(n.pi,-o),r.point(0,-o),r.point(-n.pi,-o),r.point(-n.pi,0),r.point(-n.pi,o);else if((0,n.tn)(t[0]-e[0])>n.Ni){var s=t[0]<e[0]?n.pi:-n.pi;o=i*s/2,r.point(-s,o),r.point(0,o),r.point(s,o)}else r.point(e[0],e[1])}),[-n.pi,-n.TW])},83692:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(33774);function n(){var t,e=[];return{point:function(e,i){t.push([e,i])},lineStart:function(){e.push(t=[])},lineEnd:r.A,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}}},62846:(t,e,i)=>{"use strict";i(19715),i(60365),i(86407),i(47379),i(9276)},55566:(t,e,i)=>{"use strict";i(86407),i(94750),i(89880)},9276:(t,e,i)=>{"use strict";i.d(e,{A:()=>l});var r=i(83692),n=i(94750),o=i(86407),s=i(94318),a=i(89880);function l(t,e,i,o){return function(l,h){var p,d,f,m=e(h),g=l.invert(o[0],o[1]),_=(0,r.A)(),y=e(_),A=!1,v={point:x,lineStart:w,lineEnd:S,polygonStart:function(){v.point=T,v.lineStart=C,v.lineEnd=M,d=[],p=[]},polygonEnd:function(){v.point=x,v.lineStart=w,v.lineEnd=S,d=(0,a.Am)(d);var t=(0,s.A)(p,g);d.length?(A||(h.polygonStart(),A=!0),(0,n.A)(d,u,t,i,h)):t&&(A||(h.polygonStart(),A=!0),h.lineStart(),i(null,null,1,h),h.lineEnd()),A&&(h.polygonEnd(),A=!1),d=p=null},sphere:function(){h.polygonStart(),h.lineStart(),i(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function x(e,i){var r=l(e,i);t(e=r[0],i=r[1])&&h.point(e,i)}function b(t,e){var i=l(t,e);m.point(i[0],i[1])}function w(){v.point=b,m.lineStart()}function S(){v.point=x,m.lineEnd()}function T(t,e){f.push([t,e]);var i=l(t,e);y.point(i[0],i[1])}function C(){y.lineStart(),f=[]}function M(){T(f[0][0],f[0][1]),y.lineEnd();var t,e,i,r,n=y.clean(),o=_.result(),s=o.length;if(f.pop(),p.push(f),f=null,s)if(1&n){if((e=(i=o[0]).length-1)>0){for(A||(h.polygonStart(),A=!0),h.lineStart(),t=0;t<e;++t)h.point((r=i[t])[0],r[1]);h.lineEnd()}}else s>1&&2&n&&o.push(o.pop().concat(o.shift())),d.push(o.filter(c))}return v}}function c(t){return t.length>1}function u(t,e){return((t=t.x)[0]<0?t[1]-o.TW-o.Ni:o.TW-t[1])-((e=e.x)[0]<0?e[1]-o.TW-o.Ni:o.TW-e[1])}},94750:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(47379);function n(t,e,i,r){this.x=t,this.z=e,this.o=i,this.e=r,this.v=!1,this.n=this.p=null}function o(t,e,i,o,a){var l,c,u=[],h=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,i,o=t[0],s=t[e];if((0,r.A)(o,s)){for(a.lineStart(),l=0;l<e;++l)a.point((o=t[l])[0],o[1]);a.lineEnd()}else u.push(i=new n(o,t,null,!0)),h.push(i.o=new n(o,null,i,!1)),u.push(i=new n(s,t,null,!1)),h.push(i.o=new n(s,null,i,!0))}})),u.length){for(h.sort(e),s(u),s(h),l=0,c=h.length;l<c;++l)h[l].e=i=!i;for(var p,d,f=u[0];;){for(var m=f,g=!0;m.v;)if((m=m.n)===f)return;p=m.z,a.lineStart();do{if(m.v=m.o.v=!0,m.e){if(g)for(l=0,c=p.length;l<c;++l)a.point((d=p[l])[0],d[1]);else o(m.x,m.n.x,1,a);m=m.n}else{if(g)for(p=m.p.z,l=p.length-1;l>=0;--l)a.point((d=p[l])[0],d[1]);else o(m.x,m.p.x,-1,a);m=m.p}p=(m=m.o).z,g=!g}while(!m.v);a.lineEnd()}}}function s(t){if(e=t.length){for(var e,i,r=0,n=t[0];++r<e;)n.n=i=t[r],i.p=n,n=i;n.n=i=t[0],i.p=n}}},10652:(t,e,i)=>{"use strict";i(94318),i(38146),i(86407)},38146:(t,e,i)=>{"use strict";i.d(e,{A:()=>s});var r=i(91449),n=[null,null],o={type:"LineString",coordinates:n};function s(t,e){return n[0]=t,n[1]=e,(0,r.A)(o)}},18457:(t,e,i)=>{"use strict";i(89880),i(86407)},5018:(t,e,i)=>{"use strict";i(86407)},91449:(t,e,i)=>{"use strict";i.d(e,{A:()=>m});var r,n,o,s=i(71637),a=i(86407),l=i(33774),c=i(54341),u=(0,s.A)(),h={sphere:l.A,point:l.A,lineStart:function(){h.point=d,h.lineEnd=p},lineEnd:l.A,polygonStart:l.A,polygonEnd:l.A};function p(){h.point=h.lineEnd=l.A}function d(t,e){t*=a.F2,e*=a.F2,r=t,n=(0,a.F8)(e),o=(0,a.gn)(e),h.point=f}function f(t,e){t*=a.F2,e*=a.F2;var i=(0,a.F8)(e),s=(0,a.gn)(e),l=(0,a.tn)(t-r),c=(0,a.gn)(l),h=s*(0,a.F8)(l),p=o*i-n*s*c,d=n*i+o*s*c;u.add((0,a.FP)((0,a.RZ)(h*h+p*p),d)),r=t,n=i,o=s}function m(t){return u.reset(),(0,c.A)(t,h),+u}},86407:(t,e,i)=>{"use strict";i.d(e,{F2:()=>c,F8:()=>g,FA:()=>a,FP:()=>p,HQ:()=>A,Ml:()=>y,Ni:()=>r,RZ:()=>_,Rm:()=>m,TW:()=>o,gn:()=>d,gz:()=>s,oN:()=>f,pi:()=>n,qR:()=>v,rY:()=>h,tn:()=>u,uj:()=>l});var r=1e-6,n=Math.PI,o=n/2,s=n/4,a=2*n,l=180/n,c=n/180,u=Math.abs,h=Math.atan,p=Math.atan2,d=Math.cos,f=(Math.ceil,Math.exp),m=(Math.floor,Math.log),g=(Math.pow,Math.sin),_=(Math.sign,Math.sqrt),y=Math.tan;function A(t){return t>1?0:t<-1?n:Math.acos(t)}function v(t){return t>1?o:t<-1?-o:Math.asin(t)}},33774:(t,e,i)=>{"use strict";function r(){}i.d(e,{A:()=>r})},99068:(t,e,i)=>{"use strict";var r,n,o,s,a=i(71637),l=i(86407),c=i(33774),u=(0,a.A)(),h=(0,a.A)(),p={point:c.A,lineStart:c.A,lineEnd:c.A,polygonStart:function(){p.lineStart=d,p.lineEnd=g},polygonEnd:function(){p.lineStart=p.lineEnd=p.point=c.A,u.add((0,l.tn)(h)),h.reset()},result:function(){var t=u/2;return u.reset(),t}};function d(){p.point=f}function f(t,e){p.point=m,r=o=t,n=s=e}function m(t,e){h.add(s*t-o*e),o=t,s=e}function g(){m(r,n)}},56680:(t,e,i)=>{"use strict";var r=i(33774);r.A,r.A,r.A,r.A},8457:(t,e,i)=>{"use strict";i(86407)},59438:(t,e,i)=>{"use strict";i(86407),i(33774).A},68881:(t,e,i)=>{"use strict";i(54341),i(99068),i(56680),i(8457),i(59438),i(36929),i(78232)},36929:(t,e,i)=>{"use strict";var r,n,o,s,a,l=i(71637),c=i(86407),u=i(33774),h=(0,l.A)(),p={point:u.A,lineStart:function(){p.point=d},lineEnd:function(){r&&f(n,o),p.point=u.A},polygonStart:function(){r=!0},polygonEnd:function(){r=null},result:function(){var t=+h;return h.reset(),t}};function d(t,e){p.point=f,n=s=t,o=a=e}function f(t,e){s-=t,a-=e,h.add((0,c.RZ)(s*s+a*a)),s=t,a=e}},78232:(t,e,i)=>{"use strict"},47379:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(86407);function n(t,e){return(0,r.tn)(t[0]-e[0])<r.Ni&&(0,r.tn)(t[1]-e[1])<r.Ni}},94318:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(71637),n=i(19715),o=i(86407),s=(0,r.A)();function a(t,e){var i=e[0],r=e[1],a=[(0,o.F8)(i),-(0,o.gn)(i),0],l=0,c=0;s.reset();for(var u=0,h=t.length;u<h;++u)if(d=(p=t[u]).length)for(var p,d,f=p[d-1],m=f[0],g=f[1]/2+o.gz,_=(0,o.F8)(g),y=(0,o.gn)(g),A=0;A<d;++A,m=x,_=w,y=S,f=v){var v=p[A],x=v[0],b=v[1]/2+o.gz,w=(0,o.F8)(b),S=(0,o.gn)(b),T=x-m,C=T>=0?1:-1,M=C*T,E=M>o.pi,I=_*w;if(s.add((0,o.FP)(I*C*(0,o.F8)(M),y*S+I*(0,o.gn)(M))),l+=E?T+C*o.FA:T,E^m>=i^x>=i){var L=(0,n.r8)((0,n.jf)(f),(0,n.jf)(v));(0,n.Cx)(L);var P=(0,n.r8)(a,L);(0,n.Cx)(P);var k=(E^T>=0?-1:1)*(0,o.qR)(P[2]);(r>k||r===k&&(L[0]||L[1]))&&(c+=E^T>=0?1:-1)}}return(l<-o.Ni||l<o.Ni&&s<-o.Ni)^1&c}},52308:(t,e,i)=>{"use strict";i(73702)},5325:(t,e,i)=>{"use strict";i(86407),i(52308),i(73702),i(19060)},65078:(t,e,i)=>{"use strict";i.d(e,{I:()=>o,c:()=>n});var r=i(86407);function n(t){return function(e,i){var n=(0,r.gn)(e),o=(0,r.gn)(i),s=t(n*o);return[s*o*(0,r.F8)(e),s*(0,r.F8)(i)]}}function o(t){return function(e,i){var n=(0,r.RZ)(e*e+i*i),o=t(n),s=(0,r.F8)(o),a=(0,r.gn)(o);return[(0,r.FP)(e*s,n*a),(0,r.qR)(n&&i*s/n)]}}},93997:(t,e,i)=>{"use strict";var r=i(86407),n=i(65078);(i(85923),(0,n.c)((function(t){return(0,r.RZ)(2/(1+t))}))).invert=(0,n.I)((function(t){return 2*(0,r.qR)(t/2)}))},1625:(t,e,i)=>{"use strict";var r=i(86407),n=i(65078);(i(85923),(0,n.c)((function(t){return(t=(0,r.HQ)(t))&&t/(0,r.F8)(t)}))).invert=(0,n.I)((function(t){return t}))},99307:(t,e,i)=>{"use strict";i(86407),i(85923)},35016:(t,e,i)=>{"use strict";i(86407),i(99307),i(96318)},73702:(t,e,i)=>{"use strict";i(86407),i(99307),i(41186)},63034:(t,e,i)=>{"use strict";i(86407),i(99307),i(25431)},41186:(t,e,i)=>{"use strict";i(86407)},25431:(t,e,i)=>{"use strict";function r(t,e){return[t,e]}i(85923),r.invert=r},19060:(t,e,i)=>{"use strict";i(54341),i(56680)},5591:(t,e,i)=>{"use strict";var r=i(86407),n=i(65078);i(85923),(0,n.I)(r.rY)},76253:(t,e,i)=>{"use strict";i(55566),i(79421),i(19060)},85923:(t,e,i)=>{"use strict";i(44417),i(62846),i(55566);var r=i(86407),n=(i(18983),i(79421));i(19060),i(52184),(0,n.G)({point:function(t,e){this.stream.point(t*r.F2,e*r.F2)}})},96318:(t,e,i)=>{"use strict";i(86407);i(18983),i(85923)},16969:(t,e,i)=>{"use strict";i(85923);i(86407)},26585:(t,e,i)=>{"use strict";var r=i(86407),n=i(65078);i(85923),(0,n.I)(r.qR)},52184:(t,e,i)=>{"use strict";i(19715);var r=i(86407);i(79421),(0,r.gn)(30*r.F2)},43127:(t,e,i)=>{"use strict";var r=i(86407),n=i(65078);i(85923),(0,n.I)((function(t){return 2*(0,r.rY)(t)}))},35901:(t,e,i)=>{"use strict";i(86407);i(96318)},18983:(t,e,i)=>{"use strict";var r=i(86407);function n(t,e){return[t>r.pi?t-r.FA:t<-r.pi?t+r.FA:t,e]}n.invert=n},54341:(t,e,i)=>{"use strict";function r(t,e){t&&o.hasOwnProperty(t.type)&&o[t.type](t,e)}i.d(e,{A:()=>l});var n={Feature:function(t,e){r(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,o=i.length;++n<o;)r(i[n].geometry,e)}},o={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,r=-1,n=i.length;++r<n;)t=i[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){s(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,r=-1,n=i.length;++r<n;)s(i[r],e,0)},Polygon:function(t,e){a(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,r=-1,n=i.length;++r<n;)a(i[r],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,o=i.length;++n<o;)r(i[n],e)}};function s(t,e,i){var r,n=-1,o=t.length-i;for(e.lineStart();++n<o;)r=t[n],e.point(r[0],r[1],r[2]);e.lineEnd()}function a(t,e){var i=-1,r=t.length;for(e.polygonStart();++i<r;)s(t[i],e,1);e.polygonEnd()}function l(t,e){t&&n.hasOwnProperty(t.type)?n[t.type](t,e):r(t,e)}},79421:(t,e,i)=>{"use strict";function r(t){return function(e){var i=new n;for(var r in t)i[r]=t[r];return i.stream=e,i}}function n(){}i.d(e,{G:()=>r}),n.prototype={constructor:n,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}}},79539:(t,e,i)=>{"use strict";i(8160)},56373:(t,e,i)=>{"use strict";i.d(e,{G:()=>p,f:()=>d});var r=i(89278),n=i(10004),o=i(83424),s=i(7737),a=i(42415),l=[];function c(){(0,r.T)(this),this.edge=this.site=this.circle=null}function u(t){var e=l.pop()||new c;return e.site=t,e}function h(t){(0,o.oq)(t),a.cR.remove(t),l.push(t),(0,r.T)(t)}function p(t){var e=t.circle,i=e.x,r=e.cy,n=[i,r],l=t.P,c=t.N,u=[t];h(t);for(var p=l;p.circle&&Math.abs(i-p.circle.x)<a.Ni&&Math.abs(r-p.circle.cy)<a.Ni;)l=p.P,u.unshift(p),h(p),p=l;u.unshift(p),(0,o.oq)(p);for(var d=c;d.circle&&Math.abs(i-d.circle.x)<a.Ni&&Math.abs(r-d.circle.cy)<a.Ni;)c=d.N,u.push(d),h(d),d=c;u.push(d),(0,o.oq)(d);var f,m=u.length;for(f=1;f<m;++f)d=u[f],p=u[f-1],(0,s.$Y)(d.edge,p.site,d.site,n);p=u[0],(d=u[m-1]).edge=(0,s.Qd)(p.site,d.site,null,n),(0,o.An)(p),(0,o.An)(d)}function d(t){for(var e,i,r,l,c=t[0],h=t[1],p=a.cR._;p;)if((r=f(p,h)-c)>a.Ni)p=p.L;else{if(!((l=c-m(p,h))>a.Ni)){r>-a.Ni?(e=p.P,i=p):l>-a.Ni?(e=p,i=p.N):e=i=p;break}if(!p.R){e=p;break}p=p.R}(0,n.P9)(t);var d=u(t);if(a.cR.insert(e,d),e||i){if(e===i)return(0,o.oq)(e),i=u(e.site),a.cR.insert(d,i),d.edge=i.edge=(0,s.Qd)(e.site,d.site),(0,o.An)(e),void(0,o.An)(i);if(i){(0,o.oq)(e),(0,o.oq)(i);var g=e.site,_=g[0],y=g[1],A=t[0]-_,v=t[1]-y,x=i.site,b=x[0]-_,w=x[1]-y,S=2*(A*w-v*b),T=A*A+v*v,C=b*b+w*w,M=[(w*T-v*C)/S+_,(A*C-b*T)/S+y];(0,s.$Y)(i.edge,g,x,M),d.edge=(0,s.Qd)(g,t,null,M),i.edge=(0,s.Qd)(t,x,null,M),(0,o.An)(e),(0,o.An)(i)}else d.edge=(0,s.Qd)(e.site,d.site)}}function f(t,e){var i=t.site,r=i[0],n=i[1],o=n-e;if(!o)return r;var s=t.P;if(!s)return-1/0;var a=(i=s.site)[0],l=i[1],c=l-e;if(!c)return a;var u=a-r,h=1/o-1/c,p=u/c;return h?(-p+Math.sqrt(p*p-2*h*(u*u/(-2*c)-l+c/2+n-o/2)))/h+r:(r+a)/2}function m(t,e){var i=t.N;if(i)return f(i,e);var r=t.site;return r[1]===e?r[0]:1/0}},10004:(t,e,i)=>{"use strict";i.d(e,{Bb:()=>a,Oc:()=>u,P9:()=>o,UO:()=>c});var r=i(7737),n=i(42415);function o(t){return n.Yo[t.index]={site:t,halfedges:[]}}function s(t,e){var i=t.site,r=e.left,n=e.right;return i===n&&(n=r,r=i),n?Math.atan2(n[1]-r[1],n[0]-r[0]):(i===r?(r=e[1],n=e[0]):(r=e[0],n=e[1]),Math.atan2(r[0]-n[0],n[1]-r[1]))}function a(t,e){return e[+(e.left!==t.site)]}function l(t,e){return e[+(e.left===t.site)]}function c(){for(var t,e,i,r,o=0,a=n.Yo.length;o<a;++o)if((t=n.Yo[o])&&(r=(e=t.halfedges).length)){var l=new Array(r),c=new Array(r);for(i=0;i<r;++i)l[i]=i,c[i]=s(t,n.Jo[e[i]]);for(l.sort((function(t,e){return c[e]-c[t]})),i=0;i<r;++i)c[i]=e[l[i]];for(i=0;i<r;++i)e[i]=c[i]}}function u(t,e,i,o){var s,c,u,h,p,d,f,m,g,_,y,A,v=n.Yo.length,x=!0;for(s=0;s<v;++s)if(c=n.Yo[s]){for(u=c.site,h=(p=c.halfedges).length;h--;)n.Jo[p[h]]||p.splice(h,1);for(h=0,d=p.length;h<d;)y=(_=l(c,n.Jo[p[h]]))[0],A=_[1],m=(f=a(c,n.Jo[p[++h%d]]))[0],g=f[1],(Math.abs(y-m)>n.Ni||Math.abs(A-g)>n.Ni)&&(p.splice(h,0,n.Jo.push((0,r.iX)(u,_,Math.abs(y-t)<n.Ni&&o-A>n.Ni?[t,Math.abs(m-t)<n.Ni?g:o]:Math.abs(A-o)<n.Ni&&i-y>n.Ni?[Math.abs(g-o)<n.Ni?m:i,o]:Math.abs(y-i)<n.Ni&&A-e>n.Ni?[i,Math.abs(m-i)<n.Ni?g:e]:Math.abs(A-e)<n.Ni&&y-t>n.Ni?[Math.abs(g-e)<n.Ni?m:t,e]:null))-1),++d);d&&(x=!1)}if(x){var b,w,S,T=1/0;for(s=0,x=null;s<v;++s)(c=n.Yo[s])&&(S=(b=(u=c.site)[0]-t)*b+(w=u[1]-e)*w)<T&&(T=S,x=c);if(x){var C=[t,e],M=[t,o],E=[i,o],I=[i,e];x.halfedges.push(n.Jo.push((0,r.iX)(u=x.site,C,M))-1,n.Jo.push((0,r.iX)(u,M,E))-1,n.Jo.push((0,r.iX)(u,E,I))-1,n.Jo.push((0,r.iX)(u,I,C))-1)}}for(s=0;s<v;++s)(c=n.Yo[s])&&(c.halfedges.length||delete n.Yo[s])}},83424:(t,e,i)=>{"use strict";i.d(e,{An:()=>l,Rg:()=>r,oq:()=>c});var r,n=i(89278),o=i(42415),s=[];function a(){(0,n.T)(this),this.x=this.y=this.arc=this.site=this.cy=null}function l(t){var e=t.P,i=t.N;if(e&&i){var n=e.site,l=t.site,c=i.site;if(n!==c){var u=l[0],h=l[1],p=n[0]-u,d=n[1]-h,f=c[0]-u,m=c[1]-h,g=2*(p*m-d*f);if(!(g>=-o.$t)){var _=p*p+d*d,y=f*f+m*m,A=(m*_-d*y)/g,v=(p*y-f*_)/g,x=s.pop()||new a;x.arc=t,x.site=l,x.x=A+u,x.y=(x.cy=v+h)+Math.sqrt(A*A+v*v),t.circle=x;for(var b=null,w=o.CT._;w;)if(x.y<w.y||x.y===w.y&&x.x<=w.x){if(!w.L){b=w.P;break}w=w.L}else{if(!w.R){b=w;break}w=w.R}o.CT.insert(b,x),b||(r=x)}}}}function c(t){var e=t.circle;e&&(e.P||(r=e.N),o.CT.remove(e),s.push(e),(0,n.T)(e),t.circle=null)}},42415:(t,e,i)=>{"use strict";i.d(e,{$t:()=>d,CT:()=>o,Jo:()=>s,Ni:()=>p,Yo:()=>n,cR:()=>r});var r,n,o,s,a=i(56373),l=i(10004),c=i(83424),u=i(7737),h=i(89278),p=1e-6,d=1e-12;function f(t,e){return e[1]-t[1]||e[0]-t[0]}function m(t,e){var i,p,d,m=t.sort(f).pop();for(s=[],n=new Array(t.length),r=new h.A,o=new h.A;;)if(d=c.Rg,m&&(!d||m[1]<d.y||m[1]===d.y&&m[0]<d.x))m[0]===i&&m[1]===p||((0,a.f)(m),i=m[0],p=m[1]),m=t.pop();else{if(!d)break;(0,a.G)(d.arc)}if((0,l.UO)(),e){var g=+e[0][0],_=+e[0][1],y=+e[1][0],A=+e[1][1];(0,u.$e)(g,_,y,A),(0,l.Oc)(g,_,y,A)}this.edges=s,this.cells=n,r=o=s=n=null}m.prototype={constructor:m,polygons:function(){var t=this.edges;return this.cells.map((function(e){var i=e.halfedges.map((function(i){return(0,l.Bb)(e,t[i])}));return i.data=e.site.data,i}))},triangles:function(){var t=[],e=this.edges;return this.cells.forEach((function(i,r){if(o=(n=i.halfedges).length)for(var n,o,s,a,l,c,u=i.site,h=-1,p=e[n[o-1]],d=p.left===u?p.right:p.left;++h<o;)s=d,d=(p=e[n[h]]).left===u?p.right:p.left,s&&d&&r<s.index&&r<d.index&&(l=s,c=d,((a=u)[0]-c[0])*(l[1]-a[1])-(a[0]-l[0])*(c[1]-a[1])<0)&&t.push([u.data,s.data,d.data])})),t},links:function(){return this.edges.filter((function(t){return t.right})).map((function(t){return{source:t.left.data,target:t.right.data}}))},find:function(t,e,i){for(var r,n,o=this,s=o._found||0,a=o.cells.length;!(n=o.cells[s]);)if(++s>=a)return null;var l=t-n.site[0],c=e-n.site[1],u=l*l+c*c;do{n=o.cells[r=s],s=null,n.halfedges.forEach((function(i){var r=o.edges[i],a=r.left;if(a!==n.site&&a||(a=r.right)){var l=t-a[0],c=e-a[1],h=l*l+c*c;h<u&&(u=h,s=a.index)}}))}while(null!==s);return o._found=r,null==i||u<=i*i?n.site:null}}},7737:(t,e,i)=>{"use strict";i.d(e,{$Y:()=>s,$e:()=>c,Qd:()=>n,iX:()=>o});var r=i(42415);function n(t,e,i,n){var o=[null,null],a=r.Jo.push(o)-1;return o.left=t,o.right=e,i&&s(o,t,e,i),n&&s(o,e,t,n),r.Yo[t.index].halfedges.push(a),r.Yo[e.index].halfedges.push(a),o}function o(t,e,i){var r=[e,i];return r.left=t,r}function s(t,e,i,r){t[0]||t[1]?t.left===i?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=i)}function a(t,e,i,r,n){var o,s=t[0],a=t[1],l=s[0],c=s[1],u=0,h=1,p=a[0]-l,d=a[1]-c;if(o=e-l,p||!(o>0)){if(o/=p,p<0){if(o<u)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>u&&(u=o)}if(o=r-l,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>u&&(u=o)}else if(p>0){if(o<u)return;o<h&&(h=o)}if(o=i-c,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<h&&(h=o)}else if(d>0){if(o>h)return;o>u&&(u=o)}if(o=n-c,d||!(o<0)){if(o/=d,d<0){if(o>h)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<h&&(h=o)}return!(u>0||h<1)||(u>0&&(t[0]=[l+u*p,c+u*d]),h<1&&(t[1]=[l+h*p,c+h*d]),!0)}}}}}function l(t,e,i,r,n){var o=t[1];if(o)return!0;var s,a,l=t[0],c=t.left,u=t.right,h=c[0],p=c[1],d=u[0],f=u[1],m=(h+d)/2,g=(p+f)/2;if(f===p){if(m<e||m>=r)return;if(h>d){if(l){if(l[1]>=n)return}else l=[m,i];o=[m,n]}else{if(l){if(l[1]<i)return}else l=[m,n];o=[m,i]}}else if(a=g-(s=(h-d)/(f-p))*m,s<-1||s>1)if(h>d){if(l){if(l[1]>=n)return}else l=[(i-a)/s,i];o=[(n-a)/s,n]}else{if(l){if(l[1]<i)return}else l=[(n-a)/s,n];o=[(i-a)/s,i]}else if(p<f){if(l){if(l[0]>=r)return}else l=[e,s*e+a];o=[r,s*r+a]}else{if(l){if(l[0]<e)return}else l=[r,s*r+a];o=[e,s*e+a]}return t[0]=l,t[1]=o,!0}function c(t,e,i,n){for(var o,s=r.Jo.length;s--;)l(o=r.Jo[s],t,e,i,n)&&a(o,t,e,i,n)&&(Math.abs(o[0][0]-o[1][0])>r.Ni||Math.abs(o[0][1]-o[1][1])>r.Ni)||delete r.Jo[s]}},89278:(t,e,i)=>{"use strict";function r(){this._=null}function n(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function o(t,e){var i=e,r=e.R,n=i.U;n?n.L===i?n.L=r:n.R=r:t._=r,r.U=n,i.U=r,i.R=r.L,i.R&&(i.R.U=i),r.L=i}function s(t,e){var i=e,r=e.L,n=i.U;n?n.L===i?n.L=r:n.R=r:t._=r,r.U=n,i.U=r,i.L=r.R,i.L&&(i.L.U=i),r.R=i}function a(t){for(;t.L;)t=t.L;return t}i.d(e,{A:()=>l,T:()=>n}),r.prototype={constructor:r,insert:function(t,e){var i,r,n;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=a(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)i===(r=i.U).L?(n=r.R)&&n.C?(i.C=n.C=!1,r.C=!0,t=r):(t===i.R&&(o(this,i),i=(t=i).U),i.C=!1,r.C=!0,s(this,r)):(n=r.L)&&n.C?(i.C=n.C=!1,r.C=!0,t=r):(t===i.L&&(s(this,i),i=(t=i).U),i.C=!1,r.C=!0,o(this,r)),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,i,r,n=t.U,l=t.L,c=t.R;if(i=l?c?a(c):l:c,n?n.L===t?n.L=i:n.R=i:this._=i,l&&c?(r=i.C,i.C=t.C,i.L=l,l.U=i,i!==c?(n=i.U,i.U=t.U,t=i.R,n.L=t,i.R=c,c.U=i):(i.U=n,n=i,t=i.R)):(r=t.C,t=i),t&&(t.U=n),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===n.L){if((e=n.R).C&&(e.C=!1,n.C=!0,o(this,n),e=n.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,s(this,e),e=n.R),e.C=n.C,n.C=e.R.C=!1,o(this,n),t=this._;break}}else if((e=n.L).C&&(e.C=!1,n.C=!0,s(this,n),e=n.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,o(this,e),e=n.L),e.C=n.C,n.C=e.L.C=!1,s(this,n),t=this._;break}e.C=!0,t=n,n=n.U}while(!t.C);t&&(t.C=!1)}}};const l=r},8160:(t,e,i)=>{"use strict";i(42415)},4982:(t,e,i)=>{var r=i(1189),n=i(47244),o=i(37653),s=i(14035),a=i(71589),l=i(62120),c=Date.prototype.getTime;function u(t){return null==t}function h(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0])}t.exports=function t(e,i,p){var d=p||{};return!!(d.strict?o(e,i):e===i)||(!e||!i||"object"!=typeof e&&"object"!=typeof i?d.strict?o(e,i):e==i:function(e,i,o){var p,d;if(typeof e!=typeof i)return!1;if(u(e)||u(i))return!1;if(e.prototype!==i.prototype)return!1;if(n(e)!==n(i))return!1;var f=s(e),m=s(i);if(f!==m)return!1;if(f||m)return e.source===i.source&&a(e)===a(i);if(l(e)&&l(i))return c.call(e)===c.call(i);var g=h(e),_=h(i);if(g!==_)return!1;if(g||_){if(e.length!==i.length)return!1;for(p=0;p<e.length;p++)if(e[p]!==i[p])return!1;return!0}if(typeof e!=typeof i)return!1;try{var y=r(e),A=r(i)}catch(t){return!1}if(y.length!==A.length)return!1;for(y.sort(),A.sort(),p=y.length-1;p>=0;p--)if(y[p]!=A[p])return!1;for(p=y.length-1;p>=0;p--)if(!t(e[d=y[p]],i[d],o))return!1;return!0}(e,i,d))}},30041:(t,e,i)=>{"use strict";var r=i(30655),n=i(58068),o=i(69675),s=i(75795);t.exports=function(t,e,i){if(!t||"object"!=typeof t&&"function"!=typeof t)throw new o("`obj` must be an object or a function`");if("string"!=typeof e&&"symbol"!=typeof e)throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new o("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!s&&s(t,e);if(r)r(t,e,{configurable:null===c&&h?h.configurable:!c,enumerable:null===a&&h?h.enumerable:!a,value:i,writable:null===l&&h?h.writable:!l});else{if(!u&&(a||l||c))throw new n("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");t[e]=i}}},38452:(t,e,i)=>{"use strict";var r=i(1189),n="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,s=Array.prototype.concat,a=i(30041),l=i(30592)(),c=function(t,e,i,r){if(e in t)if(!0===r){if(t[e]===i)return}else if("function"!=typeof(n=r)||"[object Function]"!==o.call(n)||!r())return;var n;l?a(t,e,i,!0):a(t,e,i)},u=function(t,e){var i=arguments.length>2?arguments[2]:{},o=r(e);n&&(o=s.call(o,Object.getOwnPropertySymbols(e)));for(var a=0;a<o.length;a+=1)c(t,o[a],e[o[a]],i[o[a]])};u.supportsDescriptors=!!l,t.exports=u},53509:t=>{function e(t,e,i,r){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(t,e,i,r)}e.prototype.run=function(t,e,i,r){this._init(t,e,i,r);for(var n=0;n<this._datasetLength;n++)if(1!==this._visited[n]){this._visited[n]=1;var o=this._regionQuery(n);if(o.length<this.minPts)this.noise.push(n);else{var s=this.clusters.length;this.clusters.push([]),this._addToCluster(n,s),this._expandCluster(s,o)}}return this.clusters},e.prototype._init=function(t,e,i,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this.noise=[],this._datasetLength=t.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}e&&(this.epsilon=e),i&&(this.minPts=i),r&&(this.distance=r)},e.prototype._expandCluster=function(t,e){for(var i=0;i<e.length;i++){var r=e[i];if(1!==this._visited[r]){this._visited[r]=1;var n=this._regionQuery(r);n.length>=this.minPts&&(e=this._mergeArrays(e,n))}1!==this._assigned[r]&&this._addToCluster(r,t)}},e.prototype._addToCluster=function(t,e){this.clusters[e].push(t),this._assigned[t]=1},e.prototype._regionQuery=function(t){for(var e=[],i=0;i<this._datasetLength;i++)this.distance(this.dataset[t],this.dataset[i])<this.epsilon&&e.push(i);return e},e.prototype._mergeArrays=function(t,e){for(var i=e.length,r=0;r<i;r++){var n=e[r];t.indexOf(n)<0&&t.push(n)}return t},e.prototype._euclideanDistance=function(t,e){for(var i=0,r=Math.min(t.length,e.length);r--;)i+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(i)},t.exports&&(t.exports=e)},32347:t=>{function e(t,e,i){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(t,e,i)}e.prototype.init=function(t,e,i){this.assignments=[],this.centroids=[],void 0!==t&&(this.dataset=t),void 0!==e&&(this.k=e),void 0!==i&&(this.distance=i)},e.prototype.run=function(t,e){this.init(t,e);for(var i=this.dataset.length,r=0;r<this.k;r++)this.centroids[r]=this.randomCentroid();for(var n=!0;n;){n=this.assign();for(var o=0;o<this.k;o++){for(var s=new Array(u),a=0,l=0;l<u;l++)s[l]=0;for(var c=0;c<i;c++){var u=this.dataset[c].length;if(o===this.assignments[c]){for(l=0;l<u;l++)s[l]+=this.dataset[c][l];a++}}if(a>0){for(l=0;l<u;l++)s[l]/=a;this.centroids[o]=s}else this.centroids[o]=this.randomCentroid(),n=!0}}return this.getClusters()},e.prototype.randomCentroid=function(){var t,e,i=this.dataset.length-1;do{e=Math.round(Math.random()*i),t=this.dataset[e]}while(this.centroids.indexOf(t)>=0);return t},e.prototype.assign=function(){for(var t,e=!1,i=this.dataset.length,r=0;r<i;r++)(t=this.argmin(this.dataset[r],this.centroids,this.distance))!=this.assignments[r]&&(this.assignments[r]=t,e=!0);return e},e.prototype.getClusters=function(){for(var t,e=new Array(this.k),i=0;i<this.assignments.length;i++)void 0===e[t=this.assignments[i]]&&(e[t]=[]),e[t].push(i);return e},e.prototype.argmin=function(t,e,i){for(var r,n=Number.MAX_VALUE,o=0,s=e.length,a=0;a<s;a++)(r=i(t,e[a]))<n&&(n=r,o=a);return o},e.prototype.distance=function(t,e){for(var i=0,r=Math.min(t.length,e.length);r--;){var n=t[r]-e[r];i+=n*n}return Math.sqrt(i)},t.exports&&(t.exports=e)},75172:(t,e,i)=>{if(t.exports)var r=i(1283);function n(t,e,i,r){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(t,e,i,r)}n.prototype.run=function(t,e,i,n){this._init(t,e,i,n);for(var o=0,s=this.dataset.length;o<s;o++)if(1!==this._processed[o]){this._processed[o]=1,this.clusters.push([o]);var a=this.clusters.length-1;this._orderedList.push(o);var l=new r(null,null,"asc"),c=this._regionQuery(o);void 0!==this._distanceToCore(o)&&(this._updateQueue(o,c,l),this._expandCluster(a,l))}return this.clusters},n.prototype.getReachabilityPlot=function(){for(var t=[],e=0,i=this._orderedList.length;e<i;e++){var r=this._orderedList[e],n=this._reachability[r];t.push([r,n])}return t},n.prototype._init=function(t,e,i,r){if(t){if(!(t instanceof Array))throw Error("Dataset must be of type array, "+typeof t+" given");this.dataset=t,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}e&&(this.epsilon=e),i&&(this.minPts=i),r&&(this.distance=r)},n.prototype._updateQueue=function(t,e,i){var r=this;this._coreDistance=this._distanceToCore(t),e.forEach((function(e){if(void 0===r._processed[e]){var n=r.distance(r.dataset[t],r.dataset[e]),o=Math.max(r._coreDistance,n);void 0===r._reachability[e]?(r._reachability[e]=o,i.insert(e,o)):o<r._reachability[e]&&(r._reachability[e]=o,i.remove(e),i.insert(e,o))}}))},n.prototype._expandCluster=function(t,e){for(var i=e.getElements(),r=0,n=i.length;r<n;r++){var o=i[r];if(void 0===this._processed[o]){var s=this._regionQuery(o);this._processed[o]=1,this.clusters[t].push(o),this._orderedList.push(o),void 0!==this._distanceToCore(o)&&(this._updateQueue(o,s,e),this._expandCluster(t,e))}}},n.prototype._distanceToCore=function(t){for(var e=this.epsilon,i=0;i<e;i++)if(this._regionQuery(t,i).length>=this.minPts)return i},n.prototype._regionQuery=function(t,e){e=e||this.epsilon;for(var i=[],r=0,n=this.dataset.length;r<n;r++)this.distance(this.dataset[t],this.dataset[r])<e&&i.push(r);return i},n.prototype._euclideanDistance=function(t,e){for(var i=0,r=Math.min(t.length,e.length);r--;)i+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(i)},t.exports&&(t.exports=n)},1283:t=>{function e(t,e,i){this._queue=[],this._priorities=[],this._sorting="desc",this._init(t,e,i)}e.prototype.insert=function(t,e){for(var i=this._queue.length,r=i;r--;){var n=this._priorities[r];"desc"===this._sorting?e>n&&(i=r):e<n&&(i=r)}this._insertAt(t,e,i)},e.prototype.remove=function(t){for(var e=this._queue.length;e--;)if(t===this._queue[e]){this._queue.splice(e,1),this._priorities.splice(e,1);break}},e.prototype.forEach=function(t){this._queue.forEach(t)},e.prototype.getElements=function(){return this._queue},e.prototype.getElementPriority=function(t){return this._priorities[t]},e.prototype.getPriorities=function(){return this._priorities},e.prototype.getElementsWithPriorities=function(){for(var t=[],e=0,i=this._queue.length;e<i;e++)t.push([this._queue[e],this._priorities[e]]);return t},e.prototype._init=function(t,e,i){if(t&&e){if(this._queue=[],this._priorities=[],t.length!==e.length)throw new Error("Arrays must have the same length");for(var r=0;r<t.length;r++)this.insert(t[r],e[r])}i&&(this._sorting=i)},e.prototype._insertAt=function(t,e,i){this._queue.length===i?(this._queue.push(t),this._priorities.push(e)):(this._queue.splice(i,0,t),this._priorities.splice(i,0,e))},t.exports&&(t.exports=e)},36112:(t,e,i)=>{t.exports&&(t.exports={DBSCAN:i(53509),KMEANS:i(32347),OPTICS:i(75172),PriorityQueue:i(1283)})},66570:t=>{"use strict";function e(t,e,r){r=r||2;var o,s,a,l,h,p,f,m=e&&e.length,g=m?e[0]*r:t.length,_=i(t,0,g,r,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(t,e,r,n){var o,s,a,l=[];for(o=0,s=e.length;o<s;o++)(a=i(t,e[o]*n,o<s-1?e[o+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),l.push(d(a));for(l.sort(c),o=0;o<l.length;o++)r=u(l[o],r);return r}(t,e,_,r)),t.length>80*r){o=a=t[0],s=l=t[1];for(var A=r;A<g;A+=r)(h=t[A])<o&&(o=h),(p=t[A+1])<s&&(s=p),h>a&&(a=h),p>l&&(l=p);f=0!==(f=Math.max(a-o,l-s))?32767/f:0}return n(_,y,r,o,s,f,0),y}function i(t,e,i,r,n){var o,s;if(n===C(t,e,i,r)>0)for(o=e;o<i;o+=r)s=w(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=w(o,t[o],t[o+1],s);return s&&_(s,s.next)&&(S(s),s=s.next),s}function r(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function n(t,e,i,c,u,h,d){if(t){!d&&h&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=p(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,c,u,h);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?s(t,c,u,h):o(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),S(t),t=m.next,g=m.next;else if((t=m)===g){d?1===d?n(t=a(r(t),e,i),e,i,c,u,h,2):2===d&&l(t,e,i,c,u,h):n(r(t),e,i,c,u,h,1);break}}}function o(t){var e=t.prev,i=t,r=t.next;if(g(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,p=n>o?n>s?n:s:o>s?o:s,d=a>l?a>c?a:c:l>c?l:c,m=r.next;m!==e;){if(m.x>=u&&m.x<=p&&m.y>=h&&m.y<=d&&f(n,a,o,l,s,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(t,e,i,r){var n=t.prev,o=t,s=t.next;if(g(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,m=a<l?a<c?a:c:l<c?l:c,_=u<h?u<d?u:d:h<d?h:d,y=a>l?a>c?a:c:l>c?l:c,A=u>h?u>d?u:d:h>d?h:d,v=p(m,_,e,i,r),x=p(y,A,e,i,r),b=t.prevZ,w=t.nextZ;b&&b.z>=v&&w&&w.z<=x;){if(b.x>=m&&b.x<=y&&b.y>=_&&b.y<=A&&b!==n&&b!==s&&f(a,u,l,h,c,d,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,w.x>=m&&w.x<=y&&w.y>=_&&w.y<=A&&w!==n&&w!==s&&f(a,u,l,h,c,d,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;b&&b.z>=v;){if(b.x>=m&&b.x<=y&&b.y>=_&&b.y<=A&&b!==n&&b!==s&&f(a,u,l,h,c,d,b.x,b.y)&&g(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=x;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=A&&w!==n&&w!==s&&f(a,u,l,h,c,d,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function a(t,e,i){var n=t;do{var o=n.prev,s=n.next.next;!_(o,s)&&y(o,n,n.next,s)&&x(o,s)&&x(s,o)&&(e.push(o.i/i|0),e.push(n.i/i|0),e.push(s.i/i|0),S(n),S(n.next),n=t=s),n=n.next}while(n!==t);return r(n)}function l(t,e,i,o,s,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=b(l,c);return l=r(l,l.next),u=r(u,u.next),n(l,e,i,o,s,a,0),void n(u,e,i,o,s,a,0)}c=c.next}l=l.next}while(l!==t)}function c(t,e){return t.x-e.x}function u(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,p=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&f(o<p?n:s,o,u,p,o<p?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),x(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&h(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var n=b(i,t);return r(n,n.next),r(i,i.next)}function h(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function p(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function d(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&y(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(x(t,e)&&x(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||_(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,i,r){var n=v(g(t,e,i)),o=v(g(t,e,r)),s=v(g(i,r,t)),a=v(g(i,r,e));return n!==o&&s!==a||!(0!==n||!A(t,i,e))||!(0!==o||!A(t,r,e))||!(0!==s||!A(i,t,r))||!(0!==a||!A(i,e,r))}function A(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function v(t){return t>0?1:t<0?-1:0}function x(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function b(t,e){var i=new T(t.i,t.x,t.y),r=new T(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function w(t,e,i,r){var n=new T(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,r){var n=e&&e.length,o=n?e[0]*i:t.length,s=Math.abs(C(t,0,o,i));if(n)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(C(t,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var p=r[a]*i,d=r[a+1]*i,f=r[a+2]*i;h+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}},30655:(t,e,i)=>{"use strict";var r=i(70453)("%Object.defineProperty%",!0)||!1;if(r)try{r({},"a",{value:1})}catch(t){r=!1}t.exports=r},41237:t=>{"use strict";t.exports=EvalError},69383:t=>{"use strict";t.exports=Error},79290:t=>{"use strict";t.exports=RangeError},79538:t=>{"use strict";t.exports=ReferenceError},58068:t=>{"use strict";t.exports=SyntaxError},69675:t=>{"use strict";t.exports=TypeError},35345:t=>{"use strict";t.exports=URIError},88524:function(t,e,i){!function(t,e,i,r){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(r);function s(t,i,r){/^https?:\/\//.test(t)&&/\/VectorTileServer\/?$/.test(t)?l(t,i,r):function(t,i,r){const n=i.portalUrl+"/sharing/rest/content/items/"+t+"/resources/styles/root.json";c(n,i,(function(o,s){!function(t,i,r){const n=i.token?{token:i.token}:{},o=i.portalUrl+"/sharing/rest/content/items/"+t;e.request(o,n,r)}(t,i,o?function(t,e){t?r(t):l(e.url,i,r)}:function(t,e){t?r(t):a(e.url,i,(function(t,i){r(t,s,n,i,e.url)}))})}))}(t,i,r)}function a(t,i,r){const n=i.token?{token:i.token}:{};e.request(t,n,r)}function l(t,e,i){a(t,e,(function(r,n){if(r)return void i(r);let o,s=t;"/"===t.charAt(t.length-1)&&(s=t.slice(0,t.length-1)),o="/"===n.defaultStyles.charAt(0)?s+n.defaultStyles+"/root.json":s+"/"+n.defaultStyles+"/root.json",c(o,e,(function(e,r){e?i(e):i(null,r,o,n,t)}))}))}function c(t,i,r){const n=i.token?{token:i.token}:{};e.request(t,n,r)}function u(t,e){return new URL(t).hostname===new URL(e).hostname}function h(t,e,i,r){const n=Object.keys(t.sources);for(let o=0;o<n.length;o++){const s=t.sources[n[o]];-1===s.url.indexOf("http")&&(s.url=e.replace("/resources/styles/root.json","")),"/"===s.url.charAt(s.url.length-1)&&(s.url=s.url.slice(0,s.url.length-1)),s.tiles||(i.tiles&&"/"!==i.tiles[0].charAt(0)&&(i.tiles[0]="/"+i.tiles[0]),s.tiles=[s.url+i.tiles[0]]),s.url+="?f=json",s.url+=r?"&token="+r:"",s.tiles[0]+=r?"?token="+r:"",s.minzoom=i.minLOD||i.tileInfo.lods[0].level,s.maxzoom=i.maxLOD||i.tileInfo.lods[i.tileInfo.lods.length-1].level}const o=t.sources[n[n.length-1]];o.attribution=i.copyrightText||"",o.copyrightText=i.copyrightText||"";for(let e=0;e<t.layers.length;e++){const i=t.layers[e];i.layout&&i.layout["text-font"]&&i.layout["text-font"].length>1&&(i.layout["text-font"]=[i.layout["text-font"][0]])}return t.sprite&&-1===t.sprite.indexOf("http")&&(t.sprite=e.replace("styles/root.json",t.sprite.replace("../",""))),t.sprite&&r&&(u(e,t.sprite)?t.sprite+="?token="+r:console.warn("Passing a token but sprite URL is not on same base URL, so you must pass the token manually.")),t.glyphs&&-1===t.glyphs.indexOf("http")&&(t.glyphs=e.replace("styles/root.json",t.glyphs.replace("../",""))),t.glyphs&&r&&(u(e,t.glyphs)?t.glyphs+="?token="+r:console.warn("Passing a token but glyph URL is not on same base URL, so you must pass the token manually.")),t}function p(t,r){e.Support.cors&&e.request(t,{},(function(t,n){if(t)return;r._esriAttributions=r._esriAttributions||[];for(let t=0;t<n.contributors.length;t++){const e=n.contributors[t];for(let t=0;t<e.coverageAreas.length;t++){const n=e.coverageAreas[t],o=i.latLng(n.bbox[0],n.bbox[1]),s=i.latLng(n.bbox[2],n.bbox[3]);r._esriAttributions.push({attribution:e.attribution,score:n.score,bounds:i.latLngBounds(o,s),minZoom:n.zoomMin,maxZoom:n.zoomMax})}}r._esriAttributions.sort((function(t,e){return e.score-t.score}));const o={target:r};e.Util._updateMapAttribution(o)}))}const d=[3857,102100,102113];var f={formatStyle:h};var m=i.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(t){i.setOptions(this,t),this._throttledUpdate=i.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(t){this._container||this._initContainer();const e=this.getPaneName();t.getPane(e).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&i.DomEvent.on(t._proxy,i.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(t){this._map._proxy&&this._map.options.zoomAnimation&&i.DomEvent.off(this._map._proxy,i.DomUtil.TRANSITION_END,this._transitionEnd,this);const e=this.getPaneName();t.getPane(e).removeChild(this._container),this._container=null,this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getOpacity:function(){return this.options.opacity},setOpacity:function(t){this.options.opacity=t,this._container.style.opacity=t},getBounds:function(){const t=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return i.latLngBounds(this._map.containerPointToLatLng(e.subtract(t)),this._map.containerPointToLatLng(e.add(t)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_resize:function(){return this._glMap._resize},_initContainer:function(){if(this._container)return;this._container=i.DomUtil.create("div","leaflet-gl-layer");const t=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=t.x+"px",this._container.style.height=t.y+"px";const r=this._map.containerPointToLayerPoint([0,0]).subtract(e);i.DomUtil.setPosition(this._container,r)},_initGL:function(){if(this._glMap)return;const t=this._map.getCenter(),e=i.extend({},this.options,{container:this._container,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new o.default.Map(e),this._glMap.once("styledata",function(t){this.fire("styleLoaded")}.bind(this)),this._glMap.transform.latRange=null,this._glMap.transform.maxValidLatitude=1/0,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;const r=this._glMap._actualCanvas;i.DomUtil.addClass(r,"leaflet-image-layer"),i.DomUtil.addClass(r,"leaflet-zoom-animated"),this.options.interactive&&i.DomUtil.addClass(r,"leaflet-interactive"),this.options.className&&i.DomUtil.addClass(r,this.options.className)},_update:function(t){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const e=this.getSize(),r=this._container,n=this._glMap,o=this._map.getSize().multiplyBy(this.options.padding),s=this._map.containerPointToLayerPoint([0,0]).subtract(o);i.DomUtil.setPosition(r,s),this._transformGL(n),n.transform.width!==e.x||n.transform.height!==e.y?(r.style.width=e.x+"px",r.style.height=e.y+"px",null!==n._resize&&void 0!==n._resize?n._resize():n.resize()):null!==n._update&&void 0!==n._update?n._update():n.update()},_transformGL:function(t){const e=this._map.getCenter(),i=t.transform;i.center=o.default.LngLat.convert([e.lng,e.lat]),i.zoom=this._map.getZoom()-1},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){const e=this._map.getZoomScale(t.zoom),r=this._map.getSize().multiplyBy(this.options.padding*e),n=this.getSize()._divideBy(2),o=this._map.project(t.center,t.zoom)._subtract(n)._add(this._map._getMapPanePos().add(r))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),t.zoom)._subtract(o);i.DomUtil.setTransform(this._glMap._actualCanvas,s.subtract(this._offset),e)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){const t=this._map.getZoomScale(this._map.getZoom());i.DomUtil.setTransform(this._glMap._actualCanvas,null,t),this._zooming=!1,this._update()},_transitionEnd:function(t){i.Util.requestAnimFrame((function(){const t=this._map.getZoom(),e=this._map.getCenter(),r=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());i.DomUtil.setTransform(this._glMap._actualCanvas,r,1),this._glMap.once("moveend",i.Util.bind((function(){this._zoomEnd()}),this)),this._glMap.jumpTo({center:e,zoom:t-1})}),this)}});function g(t){return new m(t)}var _=i.Layer.extend({options:{portalUrl:"https://www.arcgis.com",preserveDrawingBuffer:!1},initialize:function(t,e){if(e&&i.setOptions(this,e),this.options.apiKey&&(this.options.apikey=this.options.apiKey),this.options.apikey?this.options.token=this.options.apikey:this.options.token&&(this.options.apikey=this.options.token),!t)throw new Error("An ITEM ID or SERVICE URL is required for vectorTileLayer.");t&&(this.options.key=t),this._createLayer()},_createLayer:function(){s(this.options.key,this.options,function(t,e,i,r){var n;t?this.fire("load-error",{value:t}):(n=r.tileInfo.spatialReference.wkid,d.indexOf(n)>=0||console.warn('This layer is not guaranteed to display properly because its service does not use the Web Mercator projection. The "tileInfo.spatialReference" property is:',r.tileInfo.spatialReference,"\nMore information is available at https://github.com/maplibre/maplibre-gl-js/issues/168 and https://github.com/Esri/esri-leaflet-vector/issues/94."),e=h(e,i,r,this.options.token),this._createMaplibreLayer(e))}.bind(this))},_setupAttribution:function(){if(!this.getAttribution()){const t=this._maplibreGL.getMaplibreMap().style.stylesheet.sources,e=Object.keys(t);this.options.attribution=t[e[e.length-1]].attribution,this._map&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution())}},_createMaplibreLayer:function(t){this._maplibreGL=g({style:t,pane:this.options.pane,opacity:this.options.opacity,preserveDrawingBuffer:this.options.preserveDrawingBuffer}),this._ready=!0,this.fire("ready",{},!0),this._maplibreGL.on("styleLoaded",function(){this._setupAttribution(),this.options.style&&"function"==typeof this.options.style&&this._maplibreGL._glMap.setStyle(this.options.style(this._maplibreGL._glMap.getStyle()))}.bind(this))},onAdd:function(t){this._map=t,this._ready?this._asyncAdd():this.once("ready",(function(){this._asyncAdd()}),this)},onRemove:function(t){t.removeLayer(this._maplibreGL)},_asyncAdd:function(){const t=this._map;this._maplibreGL.addTo(t,this)}});var y=_.extend({initialize:function(t,e){if(e.version||(t.includes("/")?e.version=2:e.version=1),t||(t=1===e.version?"ArcGIS:Streets":"arcgis/streets"),!(e.apikey||e.apiKey||e.token))throw new Error("An API Key or token is required for vectorBasemapLayer.");if(2!==e.version){if(e.language)throw new Error("The language parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.");if(e.worldview)throw new Error("The worldview parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.");if(e.places)throw new Error("The places parameter is only supported by the basemap styles service v2. Provide a v2 style enumeration to use this option.")}e.pane||(t.includes(":Label")||t.includes("/label")?e.pane="esri-labels":t.includes(":Detail")||t.includes("/detail")?e.pane="esri-detail":e.pane="tilePane"),_.prototype.initialize.call(this,t,e)},_createLayer:function(){let t;t=this.options.version&&2===this.options.version?function(t,e,i){if(t.includes(":"))throw new Error(t+" is a v1 style enumeration. Set version:1 to request this style");let r="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2/styles/";if(t.startsWith("osm/")||t.startsWith("arcgis/")||32!==t.length)r+=t;else if(r=r+"items/"+t,i.language)throw new Error("The 'language' parameter is not supported for custom basemap styles");if(!e)throw new Error("A token is required to access basemap styles.");return r=r+"?token="+e,i.language&&(r=r+"&language="+i.language),i.worldview&&(r=r+"&worldview="+i.worldview),i.places&&(r=r+"&places="+i.places),r}(this.options.key,this.options.apikey,{language:this.options.language,worldview:this.options.worldview,places:this.options.places}):function(t,e){if(t.includes("/"))throw new Error(t+" is a v2 style enumeration. Set version:2 to request this style");let i="https://basemaps-api.arcgis.com/arcgis/rest/services/styles/"+t+"?type=style";return e&&(i=i+"&token="+e),i}(this.options.key,this.options.apikey),this._createMaplibreLayer(t)},_setupAttribution:function(){if(e.Util.setEsriAttribution(this._map),32===this.options.key.length){const t=this._maplibreGL.getMaplibreMap().style.stylesheet.sources,e=[];Object.keys(t).forEach((function(i){e.push(t[i].attribution),t[i].copyrightText&&t[i].copyrightText&&""!==t[i].copyrightText&&t[i].attribution!==t[i].copyrightText&&e.push(t[i].copyrightText)})),this._map.attributionControl.addAttribution('<span class="">'+e.join(", ")+"</span>")}else if(this.options.attributionUrls||(this.options.attributionUrls=this._getAttributionUrls(this.options.key)),this._map&&this.options.attributionUrls){if(this._map.attributionControl){for(let t=0;t<this.options.attributionUrls.length;t++)p(this.options.attributionUrls[t],this._map);this._map.attributionControl.addAttribution('<span class="esri-dynamic-attribution"></span>')}e.Util._updateMapAttribution({target:this._map})}},_getAttributionUrls:function(t){return 0===t.indexOf("OSM:")||0===t.indexOf("osm/")?["https://static.arcgis.com/attribution/Vector/OpenStreetMap_v2"]:0===t.indexOf("ArcGIS:Imagery")||0===t.indexOf("arcgis/imagery")?["https://static.arcgis.com/attribution/World_Imagery","https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]:["https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]},_initPane:function(){if(!this._map.getPane(this.options.pane)){const t=this._map.createPane(this.options.pane);t.style.pointerEvents="none";let e=500;"esri-detail"===this.options.pane?e=250:"esri-labels"===this.options.pane&&(e=300),t.style.zIndex=e}},onRemove:function(t){if(t.off("moveend",e.Util._updateMapAttribution),t.removeLayer(this._maplibreGL),t.attributionControl){const e=document.getElementsByClassName("esri-dynamic-attribution");if(e&&e.length>0){const i=e[0].outerHTML;t.attributionControl.removeAttribution(i)}}},_asyncAdd:function(){const t=this._map;this._initPane(),t.on("moveend",e.Util._updateMapAttribution),this._maplibreGL.addTo(t,this)}});t.MaplibreGLJSLayer=m,t.Util=f,t.VERSION="4.2.3",t.VectorBasemapLayer=y,t.VectorTileLayer=_,t.maplibreGLJSLayer=g,t.setRTLTextPlugin=(t,e,i)=>{o.default.setRTLTextPlugin(t,e,i)},t.vectorBasemapLayer=function(t,e){return new y(t,e)},t.vectorTileLayer=function(t,e){return new _(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}(e,i(19619),i(53481),i(16443))},19619:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BasemapLayer:()=>A.bm,DynamicMapLayer:()=>w.zn,FeatureLayer:()=>T.GF,FeatureLayerService:()=>y.HD,FeatureManager:()=>S.m,Find:()=>h.ko,Identify:()=>p.T$,IdentifyFeatures:()=>d.Y2,IdentifyImage:()=>f.Of,ImageMapLayer:()=>b.jF,ImageService:()=>_.fD,MapService:()=>g.uk,Query:()=>u.XK,RasterLayer:()=>x.B,Service:()=>m.kl,Support:()=>o.EF,Task:()=>c.YZ,TiledMapLayer:()=>v.au,Util:()=>a.M5,VERSION:()=>C,basemapLayer:()=>A.X0,dynamicMapLayer:()=>w.dU,featureLayer:()=>T.YK,featureLayerService:()=>y.xm,find:()=>h.I6,get:()=>l.Jt,identify:()=>p.ls,identifyFeatures:()=>d.Gr,identifyImage:()=>f.cE,imageMapLayer:()=>b.Be,imageService:()=>_.dG,mapService:()=>g.Gi,options:()=>s.f,post:()=>l.bE,query:()=>u.P,request:()=>l.Em,service:()=>m.eu,task:()=>c._W,tiledMapLayer:()=>v.Ko});var r=i(28481),n=i.n(r),o=i(31646),s=i(63143),a=i(62837),l=i(78944),c=i(80147),u=i(24056),h=i(48029),p=i(80734),d=i(14797),f=i(13269),m=i(45877),g=i(69669),_=i(21236),y=i(52468),A=i(65328),v=i(23519),x=i(40526),b=i(98490),w=i(72526),S=i(68529),T=i(83983),C=n().version},65328:(t,e,i)=>{"use strict";i.d(e,{X0:()=>l,bm:()=>a});var r=i(53481),n=i(31646),o=i(62837),s="https:"!==window.location.protocol?"http:":"https:",a=r.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:s+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:s+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:n.Hs?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:s+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:s+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:s+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:s+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(t,e){var i;if("object"==typeof t&&t.urlTemplate&&t.options)i=t;else{if("string"!=typeof t||!a.TILES[t])throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');i=a.TILES[t]}var n=r.Util.extend(i.options,e);r.Util.setOptions(this,n),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&-1===i.urlTemplate.indexOf("token=")&&(i.urlTemplate+="?token="+this.options.token),this.options.proxy&&(i.urlTemplate=this.options.proxy+"?"+i.urlTemplate),r.TileLayer.prototype.initialize.call(this,i.urlTemplate,n)},onAdd:function(t){(0,o.JF)(t),"esri-labels"===this.options.pane&&this._initPane(),this.options.attributionUrl&&(0,o.xF)((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,t),t.on("moveend",o.Gc),r.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){(0,o.Zo)(t),t.off("moveend",o.Gc),r.TileLayer.prototype.onRemove.call(this,t)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var t='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return t}});function l(t,e){return new a(t,e)}},72526:(t,e,i)=>{"use strict";i.d(e,{dU:()=>l,zn:()=>a});var r=i(53481),n=i(40526),o=i(62837),s=i(69669),a=n.B.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(t){t=(0,o.al)(t),this.service=(0,s.Ay)(t),this.service.addEventParent(this),r.Util.setOptions(this,t)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(t){return this.options.dynamicLayers=t,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(t){return this.options.layers=t,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(t){return this.options.timeOptions=t,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(t){var e,i=r.Util.bind((function(e,i,n){e||setTimeout(r.Util.bind((function(){this._renderPopup(t.latlng,e,i,n)}),this),300)}),this);if((e=this.options.popup?this.options.popup.on(this._map).at(t.latlng):this.identify().on(this._map).at(t.latlng)).params.maxAllowableOffset||e.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?e.layers("visible:"+this.options.layers.join(",")):e.layers("visible")),this.options.layerDefs&&"string"!=typeof this.options.layerDefs&&!e.params.layerDefs)for(var n in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,n)&&e.layerDef(n,this.options.layerDefs[n]);e.run(i),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(0===this.options.layers.length)return;e.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(e.layerDefs="string"==typeof this.options.layerDefs?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport:function(t,e){if("json"===this.options.f)this.service.request("export",t,(function(t,i){t||(this.options.token&&i.href&&(i.href+="?token="+this.options.token),this.options.proxy&&i.href&&(i.href=this.options.proxy+"?"+i.href),i.href?this._renderImage(i.href,e):this._renderImage(i.imageData,e,i.contentType))}),this);else{t.f="image";var i=this.options.url+"export"+r.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});function l(t,e){return new a(t,e)}},72464:(t,e,i)=>{"use strict";i.d(e,{h:()=>n});var r=i(53481),n=r.Layer.extend({options:{cellSize:512,updateWhenIdle:r.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(t){r.Util.setOptions(this,t)},onAdd:function(t){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(t){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=r.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),t},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var t=this.options.cellSize;return t instanceof r.Point?t:new r.Point(t,t)},_pruneCells:function(){if(this._map){var t,e;for(t in this._cells)(e=this._cells[t]).retain=e.current;for(t in this._cells)if((e=this._cells[t]).current&&!e.active){var i=e.coords;this._retainParent(i.x,i.y,i.z,i.z-5)||this._retainChildren(i.x,i.y,i.z,i.z+2)}for(t in this._cells)this._cells[t].retain||this._removeCell(t)}},_removeAllCells:function(){for(var t in this._cells)this._removeCell(t)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(t,e,i,n){var o=Math.floor(t/2),s=Math.floor(e/2),a=i-1,l=new r.Point(+o,+s);l.z=+a;var c=this._cellCoordsToKey(l),u=this._cells[c];return u&&u.active?(u.retain=!0,!0):(u&&u.loaded&&(u.retain=!0),a>n&&this._retainParent(o,s,a,n))},_retainChildren:function(t,e,i,n){for(var o=2*t;o<2*t+2;o++)for(var s=2*e;s<2*e+2;s++){var a=new r.Point(o,s);a.z=i+1;var l=this._cellCoordsToKey(a),c=this._cells[l];c&&c.active?c.retain=!0:(c&&c.loaded&&(c.retain=!0),i+1<n&&this._retainChildren(o,s,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);e||this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_setView:function(t,e,i,r){var n=Math.round(e);r||(this._cellZoom=n,this._abortLoading&&this._abortLoading(),this._resetGrid(),void 0!==n&&this._update(t),i||this._pruneCells(),this._noPrune=!!i)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._cellSize=this.getCellSize(),r=this._cellZoom,n=this._map.getPixelWorldBounds(this._cellZoom);n&&(this._globalCellRange=this._pxBoundsToCellRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],r).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],r).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],r).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(t){t&&(t.pinch||t.flyTo)||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._cellZoom),o=e.project(t,this._cellZoom).floor(),s=e.getSize().divideBy(2*n);return new r.Bounds(o.subtract(s),o.add(s))},_update:function(t){var e=this._map;if(e){var i=Math.round(e.getZoom());void 0===t&&(t=e.getCenter());var n=this._getCelldPixelBounds(t),o=this._pxBoundsToCellRange(n),s=o.getCenter(),a=[],l=this.options.keepBuffer,c=new r.Bounds(o.getBottomLeft().subtract([l,-l]),o.getTopRight().add([l,-l]));if(!(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.max.x)&&isFinite(o.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var u in this._cells){var h=this._cells[u].coords;h.z===this._cellZoom&&c.contains(new r.Point(h.x,h.y))||(this._cells[u].current=!1)}if(Math.abs(i-this._cellZoom)>1)this._setView(t,i);else{for(var p=o.min.y;p<=o.max.y;p++)for(var d=o.min.x;d<=o.max.x;d++){var f=new r.Point(d,p);if(f.z=this._cellZoom,this._isValidCell(f)){var m=this._cells[this._cellCoordsToKey(f)];m?m.current=!0:a.push(f)}}if(a.sort((function(t,e){return t.distanceTo(s)-e.distanceTo(s)})),0!==a.length)for(this._loading||(this._loading=!0),d=0;d<a.length;d++){var g=this._cellCoordsToKey(a[d]),_=this._keyToCellCoords(g);this._activeCells[_]?this._reuseCell(a[d]):this._createCell(a[d])}}}},_isValidCell:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalCellRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._cellCoordsToBounds(t);return(0,r.toLatLngBounds)(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._cellCoordsToBounds(this._keyToCellCoords(t))},_cellCoordsToNwSe:function(t){var e=this._map,i=this.getCellSize(),r=t.scaleBy(i),n=r.add(i);return[e.unproject(r,t.z),e.unproject(n,t.z)]},_cellCoordsToBounds:function(t){var e=this._cellCoordsToNwSe(t),i=new r.LatLngBounds(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_cellCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToCellCoords:function(t){var e=t.split(":"),i=new r.Point(+e[0],+e[1]);return i.z=+e[2],i},_removeCell:function(t){var e=this._cells[t];if(e){var i=this._keyToCellCoords(t),r=this._wrapCoords(i),n=this._cellCoordsToBounds(this._wrapCoords(i));e.current=!1,delete this._cells[t],this._activeCells[t]=e,this.cellLeave(n,r,t),this.fire("cellleave",{key:t,coords:r,bounds:n})}},_reuseCell:function(t){var e=this._cellCoordsToKey(t);this._cells[e]=this._activeCells[e],this._cells[e].current=!0;var i=this._wrapCoords(t),r=this._cellCoordsToBounds(this._wrapCoords(t));this.cellEnter(r,i,e),this.fire("cellenter",{key:e,coords:i,bounds:r})},_createCell:function(t){var e=this._cellCoordsToKey(t),i=this._wrapCoords(t),n=this._cellCoordsToBounds(this._wrapCoords(t));this.createCell(n,i,e),this.fire("cellcreate",{key:e,coords:i,bounds:n}),this._cells[e]={coords:t,current:!0},r.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(t,e,i){var r=this._cellCoordsToKey(t);(i=this._cells[r])&&(i.loaded=+new Date,i.active=!0)},_getCellPos:function(t){return t.scaleBy(this.getCellSize())},_wrapCoords:function(t){var e=new r.Point(this._wrapX?r.Util.wrapNum(t.x,this._wrapX):t.x,this._wrapY?r.Util.wrapNum(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToCellRange:function(t){var e=this.getCellSize();return new r.Bounds(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))}})},83983:(t,e,i)=>{"use strict";i.d(e,{GF:()=>s,YK:()=>a});var r=i(53481),n=i(68529),o=i(62837),s=n.m.extend({options:{cacheLayers:!0},initialize:function(t){t.apikey&&(t.token=t.apikey),n.m.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return n.m.prototype.onRemove.call(this,t)},createNewLayer:function(t){var e=r.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer:function(t,e){var i=[],n=this.options.coordsToLatLng||r.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=r.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=r.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,n),t.setLatLngs(i);break;case"MultiLineString":case"Polygon":i=r.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,n),t.setLatLngs(i);break;case"MultiPolygon":i=r.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,n),t.setLatLngs(i)}this.redraw(t.feature.id)},createLayers:function(t){for(var e=t.length-1;e>=0;e--){var i,r=t[e],n=this._layers[r.id];!this._visibleZoom()||!n||this._map.hasLayer(n)||this.options.timeField&&!this._featureWithinTimeRange(r)||(this._map.addLayer(n),this.fire("addfeature",{feature:n.feature},!0)),n&&(n.setLatLngs||n.setLatLng)&&this._updateLayer(n,r),n||((i=this.createNewLayer(r))?(i.feature=r,i.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(i.feature,i),this._layers[i.feature.id]=i,this.setFeatureStyle(i.feature.id,this.options.style),this.fire("createfeature",{feature:i.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(r))&&this._map.addLayer(i)):(0,o.R8)("invalid GeoJSON encountered"))}},addLayers:function(t){for(var e=t.length-1;e>=0;e--){var i=this._layers[t[e]];!i||this.options.timeField&&!this._featureWithinTimeRange(i.feature)||(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0))}},removeLayers:function(t,e){for(var i=t.length-1;i>=0;i--){var r=t[i],n=this._layers[r];n&&(this.fire("removefeature",{feature:n.feature,permanent:e},!0),this._map.removeLayer(n)),n&&e&&delete this._layers[r]}},cellEnter:function(t,e){this._visibleZoom()&&!this._zooming&&this._map&&r.Util.requestAnimFrame(r.Util.bind((function(){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t];this._activeCells[i]&&r&&this.addLayers(r)}),this))},cellLeave:function(t,e){this._zooming||r.Util.requestAnimFrame(r.Util.bind((function(){if(this._map){var t=this._cacheKey(e),i=this._cellCoordsToKey(e),r=this._cache[t],n=this._map.getBounds();if(!this._activeCells[i]&&r){for(var o=!0,s=0;s<r.length;s++){var a=this._layers[r[s]];a&&a.getBounds&&n.intersects(a.getBounds())&&(o=!1)}o&&this.removeLayers(r,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[t],delete this._cells[i],delete this._activeCells[i])}}}),this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature((function(t){this.resetFeatureStyle(t.feature.id)}),this),this},setStyle:function(t){return this.options.style=t,this.eachFeature((function(e){this.setFeatureStyle(e.feature.id,t)}),this),this},resetFeatureStyle:function(t){var e=this._layers[t],i=this._originalStyle||r.Path.prototype.options;return e&&(r.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle:function(t,e){var i=this._layers[t];return"function"==typeof e&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature:function(t,e){if(this._map){var i=this._map.getBounds();for(var r in this._layers)-1!==this._currentSnapshot.indexOf(this._layers[r].feature.id)&&("function"==typeof this._layers[r].getLatLng&&i.contains(this._layers[r].getLatLng())||"function"==typeof this._layers[r].getBounds&&i.intersects(this._layers[r].getBounds()))&&t.call(e,this._layers[r])}return this},eachFeature:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getFeature:function(t){return this._layers[t]},bringToBack:function(){this.eachFeature((function(t){t.bringToBack&&t.bringToBack()}))},bringToFront:function(){this.eachFeature((function(t){t.bringToFront&&t.bringToFront()}))},redraw:function(t){return t&&this._redraw(t),this},_redraw:function(t){var e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var n=this.options.pointToLayer(i,(0,r.latLng)(i.geometry.coordinates[1],i.geometry.coordinates[0])).options.icon;e.setIcon(n)}if(e&&e.setStyle&&this.options.pointToLayer){var o=this.options.pointToLayer(i,(0,r.latLng)(i.geometry.coordinates[1],i.geometry.coordinates[0])).options;this.setFeatureStyle(i.id,o)}e&&e.setStyle&&this.options.style&&this.resetFeatureStyle(i.id)},openPopup(t){return this._popup&&this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(t){return this._tooltip&&this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});function a(t){return new s(t)}},68529:(t,e,i)=>{"use strict";i.d(e,{m:()=>l});var r=i(53481),n=i(52468),o=i(62837),s=i(72464),a=i(54742),l=s.h.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(t){if(s.h.prototype.initialize.call(this,t),t=(0,o.al)(t),t=r.Util.setOptions(this,t),this.service=(0,n.Ay)(t),this.service.addEventParent(this),"*"!==this.options.fields[0]){for(var e=!1,i=0;i<this.options.fields.length;i++)this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)&&(e=!0);!1===e&&(0,o.R8)("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new a.A,this._endTimeIndex=new a.A):this.options.timeField&&(this._timeIndex=new a.A),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(t){return(0,o.JF)(t),this.service.metadata((function(e,i){if(!e){var r=i.supportedQueryFormats,n=!1;(!1===this.service.options.isModern||this.options.fetchAllFeatures)&&(n=!0),!n&&r&&-1!==r.indexOf("geoJSON")&&(this.service.options.isModern=!0),i.objectIdField&&(this.service.options.idAttribute=i.objectIdField),!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}}),this),t.on("zoomend",this._handleZoomChange,this),s.h.prototype.onAdd.call(this,t)},onRemove:function(t){return(0,o.Zo)(t),t.off("zoomend",this._handleZoomChange,this),s.h.prototype.onRemove.call(this,t)},getAttribution:function(){return this.options.attribution},createCell:function(t,e){this._visibleZoom()&&this._requestFeatures(t,e)},_requestFeatures:function(t,e,i,n){this._activeRequests++,n=n||0;var o=this.options.where;return 1===this._activeRequests&&this.fire("loading",{bounds:t},!0),this._buildQuery(t,n).run((function(s,a,l){l&&l.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===o&&(!s&&a&&a.features.length&&r.Util.requestAnimFrame(r.Util.bind((function(){this._addFeatures(a.features,e),this._postProcessFeatures(t)}),this)),s||!a||a.features.length||this._postProcessFeatures(t),s&&this._postProcessFeatures(t),i&&i.call(this,s,a),l&&(l.exceededTransferLimit||l.properties&&l.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(t,e,i,n+a.features.length))}),this)},_postProcessFeatures:function(t){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:t})},_cacheKey:function(t){return t.z+":"+t.x+":"+t.y},_addFeatures:function(t,e){if(e){var i=this._cacheKey(e);this._cache[i]=this._cache[i]||[]}for(var r=t.length-1;r>=0;r--){var n=t[r].id;-1===this._currentSnapshot.indexOf(n)&&this._currentSnapshot.push(n),void 0!==i&&-1===this._cache[i].indexOf(n)&&this._cache[i].push(n)}this.options.timeField&&this._buildTimeIndexes(t),this.createLayers(t)},_buildQuery:function(t,e){var i=this.service.query().intersects(t).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(e))&&(i=i.offset(e)),i.params.resultType="tile",this.options.requestParams&&r.Util.extend(i.params,this.options.requestParams),this.options.simplifyFactor&&i.simplify(this._map,this.options.simplifyFactor),"server"===this.options.timeFilterMode&&this.options.from&&this.options.to&&i.between(this.options.from,this.options.to),i},setWhere:function(t,e,i){this.options.where=t&&t.length?t:"1=1";for(var n=[],o=[],s=0,a=null,l=r.Util.bind((function(l,c){if(l&&(a=l),c)for(var u=c.features.length-1;u>=0;u--)o.push(c.features[u].id);--s<=0&&this._visibleZoom()&&t===this.options.where&&(this._currentSnapshot=o,r.Util.requestAnimFrame(r.Util.bind((function(){this.removeLayers(n),this.addLayers(o),e&&e.call(i,a)}),this)))}),this),c=this._currentSnapshot.length-1;c>=0;c--)n.push(this._currentSnapshot[c]);for(var u in this._cache={},this._cells){s++;var h=this._keyToCellCoords(u),p=this._cellCoordsToBounds(h);this._requestFeatures(p,h,l)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(t,e,i,n){var o=this.options.from,s=this.options.to,a=0,l=null,c=r.Util.bind((function(r){r&&(l=r),this._filterExistingFeatures(o,s,t,e),a--,i&&a<=0&&i.call(n,l)}),this);if(this.options.from=t,this.options.to=e,this._filterExistingFeatures(o,s,t,e),"server"===this.options.timeFilterMode)for(var u in this._cells){a++;var h=this._keyToCellCoords(u),p=this._cellCoordsToBounds(h);this._requestFeatures(p,h,c)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(t,e,i,n){var o=t&&e?this._getFeaturesInTimeRange(t,e):this._currentSnapshot,s=this._getFeaturesInTimeRange(i,n);if(s.indexOf)for(var a=0;a<s.length;a++){var l=o.indexOf(s[a]);l>=0&&o.splice(l,1)}r.Util.requestAnimFrame(r.Util.bind((function(){this.removeLayers(o),this.addLayers(s)}),this))},_getFeaturesInTimeRange:function(t,e){var i,r=[];if(this.options.timeField.start&&this.options.timeField.end){var n=this._startTimeIndex.between(t,e),s=this._endTimeIndex.between(t,e);i=n.concat(s)}else{if(!this._timeIndex)return(0,o.R8)("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];i=this._timeIndex.between(t,e)}for(var a=i.length-1;a>=0;a--)r.push(i[a].id);return r},_buildTimeIndexes:function(t){var e,i;if(this.options.timeField.start&&this.options.timeField.end){var r=[],n=[];for(e=t.length-1;e>=0;e--)i=t[e],r.push({id:i.id,value:new Date(i.properties[this.options.timeField.start])}),n.push({id:i.id,value:new Date(i.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(r),this._endTimeIndex.bulkAdd(n)}else{var o=[];for(e=t.length-1;e>=0;e--)i=t[e],o.push({id:i.id,value:new Date(i.properties[this.options.timeField])});this._timeIndex.bulkAdd(o)}},_featureWithinTimeRange:function(t){if(!this.options.from||!this.options.to)return!0;var e=+this.options.from.valueOf(),i=+this.options.to.valueOf();if("string"==typeof this.options.timeField){var r=+t.properties[this.options.timeField];return r>=e&&r<=i}if(this.options.timeField.start&&this.options.timeField.end){var n=+t.properties[this.options.timeField.start],o=+t.properties[this.options.timeField.end];return n>=e&&n<=i||o>=e&&o<=i||n<=e&&o>=i}},_visibleZoom:function(){if(!this._map)return!1;var t=this._map.getZoom();return!(t>this.options.maxZoom||t<this.options.minZoom)},_handleZoomChange:function(){if(this._visibleZoom())for(var t in this._cells){var e=this._cells[t].coords,i=this._cacheKey(e);this._cache[i]&&this.addLayers(this._cache[i])}else this.removeLayers(this._currentSnapshot),this._currentSnapshot=[]},authenticate:function(t){return this.service.authenticate(t),this},metadata:function(t,e){return this.service.metadata(t,e),this},query:function(){return this.service.query()},_getMetadata:function(t){this._metadata?t(void 0,this._metadata):this.metadata(r.Util.bind((function(e,i){this._metadata=i,t(e,this._metadata)}),this))},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(t,e,i){this._getMetadata(r.Util.bind((function(n,o){if(n)e&&e.call(this,n,null);else{var s=t.features?t.features:[t];this.service.addFeatures(t,r.Util.bind((function(t,r){if(!t){for(var n=s.length-1;n>=0;n--)s[n].properties[o.objectIdField]=s.length>1?r[n].objectId:r.objectId,s[n].id=s.length>1?r[n].objectId:r.objectId;this._addFeatures(s)}e&&e.call(i,t,r)}),this))}}),this))},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,e,i){var r=t.features?t.features:[t];this.service.updateFeatures(t,(function(t,n){if(!t){for(var o=r.length-1;o>=0;o--)this.removeLayers([r[o].id],!0);this._addFeatures(r)}e&&e.call(i,t,n)}),this)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,e,i){return this.service.deleteFeatures(t,(function(t,r){var n=r.length?r:[r];if(!t&&n.length>0)for(var o=n.length-1;o>=0;o--)this.removeLayers([n[o].objectId],!0);e&&e.call(i,t,r)}),this)}})},98490:(t,e,i)=>{"use strict";i.d(e,{Be:()=>l,jF:()=>a});var r=i(53481),n=i(40526),o=i(62837),s=i(21236),a=n.B.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(t){t=(0,o.al)(t),this.service=(0,s.Ay)(t),this.service.addEventParent(this),r.Util.setOptions(this,t)},setPixelType:function(t){return this.options.pixelType=t,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(t){return r.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(t,e){return r.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(t){this.options.renderingRule=t,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(t){this.options.mosaicRule=t,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(t){var e=r.Util.bind((function(e,i,n){e||setTimeout(r.Util.bind((function(){this._renderPopup(t.latlng,e,i,n)}),this),300)}),this),i=this.identify().at(t.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(0===this.options.noData||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport:function(t,e){if("json"===this.options.f)this.service.request("exportImage",t,(function(t,i){t||(this.options.token&&(i.href+="?token="+this.options.token),this.options.proxy&&(i.href=this.options.proxy+"?"+i.href),this._renderImage(i.href,e))}),this);else{t.f="image";var i=this.options.url+"exportImage"+r.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});function l(t,e){return new a(t,e)}},40526:(t,e,i)=>{"use strict";i.d(e,{B:()=>a});var r=i(53481),n=i(31646),o=i(62837),s=r.ImageOverlay.extend({onAdd:function(t){this._topLeft=t.getPixelBounds().min,r.ImageOverlay.prototype.onAdd.call(this,t)},_reset:function(){this._map.options.crs===r.CRS.EPSG3857?r.ImageOverlay.prototype._reset.call(this):r.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),a=r.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:n.W6,attribution:null,interactive:!1,alt:""},onAdd:function(t){(0,o.JF)(t),this.options.zIndex&&(this.options.position=null),this._update=r.Util.throttle(this._update,this.options.updateInterval,this),t.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?t.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata((function(e,i){!e&&!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution()))}),this)},onRemove:function(t){(0,o.Zo)(t),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(t,e){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=(0,r.popup)(e),this._popupFunction=t,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(t){return this.options.zIndex=t,this._currentImage&&this._currentImage.setZIndex(t),this},_setAutoZIndex:function(t){if(this._currentImage){for(var e,i=this._currentImage.getPane().children,r=-t(-1/0,1/0),n=0,o=i.length;n<o;n++)e=i[n].style.zIndex,i[n]!==this._currentImage._image&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.options.opacity=t,this._currentImage&&this._currentImage.setOpacity(t),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(t,e){return this.options.from=t,this.options.to=e,this._update(),this},metadata:function(t,e){return this.service.metadata(t,e),this},authenticate:function(t){return this.service.authenticate(t),this},redraw:function(){this._update()},_renderImage:function(t,e,i){if(this._map){if(i&&(t="data:"+i+";base64,"+t),!t)return;var r=new s(t,e,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),n=function(){this._map.removeLayer(r),this.fire("error"),r.off("load",o,this)},o=function(t){if(r.off("error",n,this),this._map){var i=t.target,o=this._currentImage;i._bounds.equals(e)&&i._bounds.equals(this._map.getBounds())?(this._currentImage=i,"front"===this.options.position?this.bringToFront():"back"===this.options.position&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),o&&this._map&&this._map.removeLayer(o),o&&o._map&&o._map.removeLayer(o)):this._map.removeLayer(i)}this.fire("load",{bounds:e})};r.once("error",n,this),r.once("load",o,this)}},_update:function(){if(this._map){var t=this._map.getZoom(),e=this._map.getBounds();if(!(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress))if(t>this.options.maxZoom||t<this.options.minZoom)this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);else{var i=this._buildExportParams();r.Util.extend(i,this.options.requestParams),i?(this._requestExport(i,e),this.fire("loading",{bounds:e})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(t,e,i,n){if(t=(0,r.latLng)(t),this._shouldRenderPopup&&this._lastClick.equals(t)){var o=this._popupFunction(e,i,n);o&&this._popup.setLatLng(t).setContent(o).openOn(this._map)}},_resetPopupState:function(t){this._shouldRenderPopup=!1,this._lastClick=t.latlng},_calculateBbox:function(){var t=this._map.getPixelBounds(),e=this._map.unproject(t.getBottomLeft()),i=this._map.unproject(t.getTopRight()),n=this._map.options.crs.project(i),o=this._map.options.crs.project(e),s=(0,r.bounds)(n,o);return[s.getBottomLeft().x,s.getBottomLeft().y,s.getTopRight().x,s.getTopRight().y].join(",")},_calculateImageSize:function(){var t=this._map.getPixelBounds(),e=this._map.getSize(),i=this._map.unproject(t.getBottomLeft()),r=this._map.unproject(t.getTopRight()),n=this._map.latLngToLayerPoint(r).y,o=this._map.latLngToLayerPoint(i).y;return(n>0||o<e.y)&&(e.y=o-n),e.x+","+e.y}})},23519:(t,e,i)=>{"use strict";i.d(e,{Ko:()=>a,au:()=>s});var r=i(53481),n=i(62837),o=i(69669),s=r.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(t){t=r.Util.setOptions(this,t),t=(0,n.al)(t),this.tileUrl=(t.proxy?t.proxy+"?":"")+t.url+"tile/{z}/{y}/{x}"+(t.requestParams&&Object.keys(t.requestParams).length>0?r.Util.getParamString(t.requestParams):""),-1!==t.url.indexOf("{s}")&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=(0,o.Ay)(t),this.service.addEventParent(this),new RegExp(/tiles.arcgis(online)?\.com/g).test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),r.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl:function(t){var e=this._getZoomForUrl();return r.Util.template(this.tileUrl,r.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&void 0!==this._lodMap[e]?this._lodMap[e]:e},this.options))},createTile:function(t,e){var i=document.createElement("img");return r.DomEvent.on(i,"load",r.Util.bind(this._tileOnLoad,this,e,i)),r.DomEvent.on(i,"error",r.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&void 0!==this._lodMap[this._getZoomForUrl()]?i.src=this.getTileUrl(t):this.once("lodmap",(function(){i.src=this.getTileUrl(t)}),this),i},onAdd:function(t){(0,n.JF)(t),this._lodMap||this.metadata((function(e,i){if(!e&&i.spatialReference){var o=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution())),t.options.crs!==r.CRS.EPSG3857||102100!==o&&3857!==o)t.options.crs&&t.options.crs.code&&t.options.crs.code.indexOf(o)>-1||(0,n.R8)("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/");else{this._lodMap={};for(var a=i.tileInfo.lods,l=s.MercatorZoomLevels,c=0;c<a.length;c++){var u=a[c];for(var h in l){var p=l[h];if(this._withinPercentage(u.resolution,p,this.options.zoomOffsetAllowance)){this._lodMap[h]=u.level;break}}}this.fire("lodmap")}}}),this),r.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){(0,n.Zo)(t),r.TileLayer.prototype.onRemove.call(this,t)},metadata:function(t,e){return this.service.metadata(t,e),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(t){var e="?token="+t;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage:function(t,e,i){return Math.abs(t/e-1)<i}});function a(t,e){return new s(t,e)}},63143:(t,e,i)=>{"use strict";i.d(e,{f:()=>r});var r={attributionWidthOffset:55}},78944:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>f,Em:()=>u,Jt:()=>p,R8:()=>d,bE:()=>l});var r=i(53481),n=i(31646),o=0;function s(t){var e="";for(var i in t.f=t.f||"json",t)if(Object.prototype.hasOwnProperty.call(t,i)){var r,n=t[i],o=Object.prototype.toString.call(n);e.length&&(e+="&"),r="[object Array]"===o?"[object Object]"===Object.prototype.toString.call(n[0])?JSON.stringify(n):n.join(","):"[object Object]"===o?JSON.stringify(n):"[object Date]"===o?n.valueOf():n,e+=encodeURIComponent(i)+"="+encodeURIComponent(r)}return e.replaceAll("'","%27")}function a(t,e){var i=new window.XMLHttpRequest;return i.onerror=function(n){i.onreadystatechange=r.Util.falseFn,t.call(e,{error:{code:500,message:"XMLHttpRequest error"}},null)},i.onreadystatechange=function(){var n,o;if(4===i.readyState){try{n=JSON.parse(i.responseText)}catch(t){n=null,o={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!o&&n.error&&(o=n.error,n=null),i.onerror=r.Util.falseFn,t.call(e,o,n)}},i.ontimeout=function(){this.onerror()},i}function l(t,e,i,r){var n=a(i,r);return n.open("POST",t),null!=r&&void 0!==r.options&&(n.timeout=r.options.timeout),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(s(e)),n}function c(t,e,i,r){var n=a(i,r);return n.open("GET",t+"?"+s(e),!0),null!=r&&void 0!==r.options&&(n.timeout=r.options.timeout,r.options.withCredentials&&(n.withCredentials=!0)),n.send(null),n}function u(t,e,i,r){var o=s(e),l=a(i,r),c=(t+"?"+o).length;if(c<=2e3&&n.EF.cors?l.open("GET",t+"?"+o):c>2e3&&n.EF.cors&&(l.open("POST",t),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),null!=r&&void 0!==r.options&&(l.timeout=r.options.timeout,r.options.withCredentials&&(l.withCredentials=!0)),c<=2e3&&n.EF.cors)l.send(null);else{if(!(c>2e3&&n.EF.cors))return c<=2e3&&!n.EF.cors?h(t,e,i,r):void d("a request to "+t+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");l.send(o)}return l}function h(t,e,i,n){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var a="c"+o;e.callback="window._EsriLeafletCallbacks."+a,window._EsriLeafletCallbacks[a]=function(t){if(!0!==window._EsriLeafletCallbacks[a]){var e,r=Object.prototype.toString.call(t);"[object Object]"!==r&&"[object Array]"!==r&&(e={error:{code:500,message:"Expected array or object as JSONP response"}},t=null),!e&&t.error&&(e=t,t=null),i.call(n,e,t),window._EsriLeafletCallbacks[a]=!0}};var l=r.DomUtil.create("script",null,document.body);return l.type="text/javascript",l.src=t+"?"+s(e),l.id=a,l.onerror=function(t){t&&!0!==window._EsriLeafletCallbacks[a]&&(i.call(n,{error:{code:500,message:"An unknown error occurred"}}),window._EsriLeafletCallbacks[a]=!0)},r.DomUtil.addClass(l,"esri-leaflet-jsonp"),o++,{id:a,url:l.src,abort:function(){window._EsriLeafletCallbacks._callback[a]({code:0,message:"Request aborted."})}}}var p=n.EF.cors?c:h;function d(){console&&console.warn&&console.warn.apply(console,arguments)}p.CORS=c,p.JSONP=h;const f={request:u,get:p,post:l}},52468:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l,HD:()=>s,xm:()=>a});var r=i(45877),n=i(24056),o=i(62837),s=r.kl.extend({options:{idAttribute:"OBJECTID"},query:function(){return(0,n.Ay)(this)},addFeature:function(t,e,i){this.addFeatures(t,e,i)},addFeatures:function(t,e,i){for(var r=t.features?t.features:[t],n=r.length-1;n>=0;n--)delete r[n].id;return t=(0,o.iI)(t),t=r.length>1?t:[t],this.post("addFeatures",{features:t},(function(t,r){var n=r&&r.addResults?r.addResults.length>1?r.addResults:r.addResults[0]:void 0;e&&e.call(i,t||r.addResults[0].error,n)}),i)},updateFeature:function(t,e,i){this.updateFeatures(t,e,i)},updateFeatures:function(t,e,i){var r=t.features?t.features:[t];return t=(0,o.iI)(t,this.options.idAttribute),t=r.length>1?t:[t],this.post("updateFeatures",{features:t},(function(t,r){var n=r&&r.updateResults?r.updateResults.length>1?r.updateResults:r.updateResults[0]:void 0;e&&e.call(i,t||r.updateResults[0].error,n)}),i)},deleteFeature:function(t,e,i){this.deleteFeatures(t,e,i)},deleteFeatures:function(t,e,i){return this.post("deleteFeatures",{objectIds:t},(function(t,r){var n=r&&r.deleteResults?r.deleteResults.length>1?r.deleteResults:r.deleteResults[0]:void 0;e&&e.call(i,t||r.deleteResults[0].error,n)}),i)}});function a(t){return new s(t)}const l=a},21236:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l,dG:()=>a,fD:()=>s});var r=i(45877),n=i(13269),o=i(24056),s=r.kl.extend({query:function(){return(0,o.Ay)(this)},identify:function(){return(0,n.Ay)(this)}});function a(t){return new s(t)}const l=a},69669:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c,Gi:()=>l,uk:()=>a});var r=i(45877),n=i(14797),o=i(24056),s=i(48029),a=r.kl.extend({identify:function(){return(0,n.Ay)(this)},find:function(){return(0,s.Ay)(this)},query:function(){return(0,o.Ay)(this)}});function l(t){return new a(t)}const c=l},45877:(t,e,i)=>{"use strict";i.d(e,{eu:()=>l,kl:()=>a});var r=i(53481),n=i(31646),o=i(62837),s=i(78944),a=r.Evented.extend({options:{proxy:!1,useCors:n.W6,timeout:0},initialize:function(t){t=t||{},this._requestQueue=[],this._authenticating=!1,r.Util.setOptions(this,t),this.options.url=(0,o.TG)(this.options.url)},get:function(t,e,i,r){return this._request("get",t,e,i,r)},post:function(t,e,i,r){return this._request("post",t,e,i,r)},request:function(t,e,i,r){return this._request("request",t,e,i,r)},metadata:function(t,e){return this._request("get","",{},t,e)},authenticate:function(t){return this._authenticating=!1,this.options.token=t,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(t){this.options.timeout=t},_request:function(t,e,i,n,o){this.fire("requeststart",{url:this.options.url+e,params:i,method:t},!0);var a=this._createServiceCallback(t,e,i,n,o);if(this.options.token&&(i.token=this.options.token),this.options.requestParams&&r.Util.extend(i,this.options.requestParams),!this._authenticating){var l=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?s.Ay[t](l,i,a,o):s.Ay.get.JSONP(l,i,a,o)}this._requestQueue.push([t,e,i,n,o])},_createServiceCallback:function(t,e,i,n,o){return r.Util.bind((function(s,a){!s||499!==s.code&&498!==s.code||(this._authenticating=!0,this._requestQueue.push([t,e,i,n,o]),this.fire("authenticationrequired",{authenticate:r.Util.bind(this.authenticate,this)},!0),s.authenticate=r.Util.bind(this.authenticate,this)),n.call(o,s,a),s?this.fire("requesterror",{url:this.options.url+e,params:i,message:s.message,code:s.code,method:t},!0):this.fire("requestsuccess",{url:this.options.url+e,params:i,response:a,method:t},!0),this.fire("requestend",{url:this.options.url+e,params:i,method:t},!0)}),this)},_runQueue:function(){for(var t=this._requestQueue.length-1;t>=0;t--){var e=this._requestQueue[t];this[e.shift()].apply(this,e)}this._requestQueue=[]}});function l(t){return t=(0,o.al)(t),new a(t)}},31646:(t,e,i)=>{"use strict";i.d(e,{EF:()=>o,Hs:()=>n,W6:()=>r});var r=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,n=""===document.documentElement.style.pointerEvents,o={cors:r,pointerEvents:n}},48029:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>a,I6:()=>s,ko:()=>o});var r=i(80147),n=i(62837),o=r.YZ.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(t,e){return this.request((function(i,r){t.call(e,i,r&&(0,n.tt)(r),r)}),e)}});function s(t){return new o(t)}const a=s},80734:(t,e,i)=>{"use strict";i.d(e,{T$:()=>r,ls:()=>n});var r=i(80147).YZ.extend({path:"identify",between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this}});function n(t){return new r(t)}},14797:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l,Gr:()=>a,Y2:()=>s});var r=i(53481),n=i(80734),o=i(62837),s=n.T$.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(t){var e=(0,o.vR)(t.getBounds()),i=t.getSize();return this.params.imageDisplay=[i.x,i.y,96],this.params.mapExtent=[e.xmin,e.ymin,e.xmax,e.ymax],this},at:function(t){return 2===t.length&&(t=(0,r.latLng)(t)),this._setGeometryParams(t),this},layerDef:function(t,e){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[t,e].join(":"),this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},run:function(t,e){return this.request((function(i,r){if(i)t.call(e,i,void 0,r);else{var n=(0,o.tt)(r);r.results=r.results.reverse();for(var s=0;s<n.features.length;s++)n.features[s].layerId=r.results[s].layerId;t.call(e,void 0,n,r)}}))},_setGeometryParams:function(t){var e=(0,o.ir)(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function a(t){return new s(t)}const l=a},13269:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l,Of:()=>s,cE:()=>a});var r=i(53481),n=i(80734),o=i(62837),s=n.T$.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(t){return t=(0,r.latLng)(t),this.params.geometry=JSON.stringify({x:t.lng,y:t.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(t,e){return this.request((function(i,r){t.call(e,i,r&&this._responseToGeoJSON(r),r)}),this)},_responseToGeoJSON:function(t){var e=t.location,i=t.catalogItems,r=t.catalogItemVisibilities,n={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[e.x,e.y]},crs:{type:"EPSG",properties:{code:e.spatialReference.wkid}},properties:{OBJECTID:t.objectId,name:t.name,value:t.value},id:t.objectId}};if(t.properties&&t.properties.Values&&(n.pixel.properties.values=t.properties.Values),i&&i.features&&(n.catalogItems=(0,o.tt)(i),r&&r.length===n.catalogItems.features.length))for(var s=r.length-1;s>=0;s--)n.catalogItems.features[s].properties.catalogItemVisibility=r[s];return n}});function a(t){return new s(t)}const l=a},24056:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l,P:()=>a,XK:()=>s});var r=i(53481),n=i(80147),o=i(62837),s=n.YZ.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(t){return this._setGeometryParams(t),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(t,e){return t=(0,r.latLng)(t),this.params.geometry=[t.lng,t.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=e,this.params.inSR=4326,this},where:function(t){return this.params.where=t,this},between:function(t,e){return this.params.time=[t.valueOf(),e.valueOf()],this},simplify:function(t,e){var i=Math.abs(t.getBounds().getWest()-t.getBounds().getEast());return this.params.maxAllowableOffset=i/t.getSize().y*e,this},orderBy:function(t,e){return e=e||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[t,e].join(" "),this},run:function(t,e){return this._cleanParams(),this.options.isModern||(0,o.ZR)(this.options.url)&&void 0===this.options.isModern?(this.params.f="geojson",this.request((function(i,r){this._trapSQLerrors(i),t.call(e,i,r,r)}),this)):this.request((function(i,r){this._trapSQLerrors(i),t.call(e,i,r&&(0,o.tt)(r),r)}),this)},count:function(t,e){return this._cleanParams(),this.params.returnCountOnly=!0,this.request((function(e,i){t.call(this,e,i&&i.count,i)}),e)},ids:function(t,e){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request((function(e,i){t.call(this,e,i&&i.objectIds,i)}),e)},bounds:function(t,e){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request((function(i,r){r&&r.extent&&(0,o.bx)(r.extent)?t.call(e,i,(0,o.bx)(r.extent),r):(i={message:"Invalid Bounds"},t.call(e,i,null,r))}),e)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(t){var e=(0,r.point)(t);return this.params.pixelSize=[e.x,e.y],this},layer:function(t){return this.path=t+"/query",this},_trapSQLerrors:function(t){t&&"400"===t.code&&(0,o.R8)("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(t){this.params.inSR=4326;var e=(0,o.ir)(t);this.params.geometry=e.geometry,this.params.geometryType=e.geometryType}});function a(t){return new s(t)}const l=a},80147:(t,e,i)=>{"use strict";i.d(e,{YZ:()=>a,_W:()=>l});var r=i(53481),n=i(31646),o=i(62837),s=i(78944),a=r.Class.extend({options:{proxy:!1,useCors:n.W6},generateSetter:function(t,e){return r.Util.bind((function(e){return this.params[t]=e,this}),e)},initialize:function(t){if(t.request&&t.options?(this._service=t,r.Util.setOptions(this,t.options)):(r.Util.setOptions(this,t),this.options.url=(0,o.TG)(t.url)),this.params=r.Util.extend({},this.params||{}),this.setters)for(var e in this.setters){var i=this.setters[e];this[e]=this.generateSetter(i,this)}},token:function(t){return this._service?this._service.authenticate(t):this.params.token=t,this},apikey:function(t){return this.token(t)},format:function(t){return this.params.returnUnformattedValues=!t,this},request:function(t,e){return this.options.requestParams&&r.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,t,e):this._request("request",this.path,this.params,t,e)},_request:function(t,e,i,r,n){var o=this.options.proxy?this.options.proxy+"?"+this.options.url+e:this.options.url+e;return"get"!==t&&"request"!==t||this.options.useCors?s.Ay[t](o,i,r,n):s.Ay.get.JSONP(o,i,r,n)}});function l(t){return t=(0,o.al)(t),new a(t)}},62837:(t,e,i)=>{"use strict";i.d(e,{Gc:()=>C,JF:()=>b,M5:()=>M,R8:()=>n.R8,TG:()=>_,ZR:()=>A,Zo:()=>w,al:()=>y,bx:()=>h,iI:()=>c,ir:()=>S,tt:()=>g,vR:()=>p,xF:()=>T});var r=i(53481),n=i(78944),o=i(63143),s=i(31646),a=i(27088),l='Powered by <a href="https://www.esri.com">Esri</a>';function c(t,e){return(0,a.i)(t,e)}function u(t,e){return(0,a.e)(t,e)}function h(t){if("NaN"!==t.xmin&&"NaN"!==t.ymin&&"NaN"!==t.xmax&&"NaN"!==t.ymax){var e=(0,r.latLng)(t.ymin,t.xmin),i=(0,r.latLng)(t.ymax,t.xmax);return(0,r.latLngBounds)(e,i)}return null}function p(t){return{xmin:(t=(0,r.latLngBounds)(t)).getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}var d=/^(OBJECTID|FID|OID|ID)$/i;function f(t){var e;if(t.objectIdFieldName)e=t.objectIdFieldName;else if(t.fields){for(var i=0;i<=t.fields.length-1;i++)if("esriFieldTypeOID"===t.fields[i].type){e=t.fields[i].name;break}if(!e)for(i=0;i<=t.fields.length-1;i++)if(t.fields[i].name.match(d)){e=t.fields[i].name;break}}return e}function m(t){for(var e in t.attributes)if(e.match(d))return e}function g(t,e){var i,r=t.features||t.results,n=r&&r.length;i=e||f(t);var o={type:"FeatureCollection",features:[]};if(n)for(var s=r.length-1;s>=0;s--){var a=u(r[s],i||m(r[s]));o.features.push(a)}return o}function _(t){return"/"!==(t=r.Util.trim(t))[t.length-1]&&(t+="/"),t}function y(t){if(-1!==t.url.indexOf("?")){t.requestParams=t.requestParams||{};var e=t.url.substring(t.url.indexOf("?")+1);t.url=t.url.split("?")[0],t.requestParams=JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return t.url=_(t.url.split("?")[0]),t}function A(t){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(t)}function v(t){var e;switch(t){case"Point":e="esriGeometryPoint";break;case"MultiPoint":e="esriGeometryMultipoint";break;case"LineString":case"MultiLineString":e="esriGeometryPolyline";break;case"Polygon":case"MultiPolygon":e="esriGeometryPolygon"}return e}function x(t){return t.getSize().x-o.f.attributionWidthOffset+"px"}function b(t){if(t.attributionControl){if(t.attributionControl._esriAttributionLayerCount||(t.attributionControl._esriAttributionLayerCount=0),0===t.attributionControl._esriAttributionLayerCount){if(!t.attributionControl._esriAttributionAddedOnce){var e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(e);var i=document.createElement("style");i.type="text/css",i.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+x(t)+";}",document.getElementsByTagName("head")[0].appendChild(i),t.on("resize",(function(e){t.attributionControl&&(t.attributionControl._container.style.maxWidth=x(e.target))})),t.attributionControl._esriAttributionAddedOnce=!0}r.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution:hover"),r.DomUtil.addClass(t.attributionControl._container,"esri-truncated-attribution")}t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount+1}}function w(t){t.attributionControl&&(t.attributionControl._esriAttributionLayerCount&&1===t.attributionControl._esriAttributionLayerCount&&(r.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution:hover"),r.DomUtil.removeClass(t.attributionControl._container,"esri-truncated-attribution")),t.attributionControl._esriAttributionLayerCount=t.attributionControl._esriAttributionLayerCount-1)}function S(t){var e={geometry:null,geometryType:null};return t instanceof r.LatLngBounds?(e.geometry=p(t),e.geometryType="esriGeometryEnvelope",e):(t.getLatLng&&(t=t.getLatLng()),t instanceof r.LatLng&&(t={type:"Point",coordinates:[t.lng,t.lat]}),t instanceof r.GeoJSON&&(t=t.getLayers()[0].feature.geometry,e.geometry=c(t),e.geometryType=v(t.type)),t.toGeoJSON&&(t=t.toGeoJSON()),"Feature"===t.type&&(t=t.geometry),"Point"===t.type||"LineString"===t.type||"Polygon"===t.type||"MultiPolygon"===t.type?(e.geometry=c(t),e.geometryType=v(t.type),e):void(0,n.R8)("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}function T(t,e){s.EF.cors&&(0,n.Em)(t,{},r.Util.bind((function(t,i){if(!t){e._esriAttributions=[];for(var n=0;n<i.contributors.length;n++)for(var o=i.contributors[n],s=0;s<o.coverageAreas.length;s++){var a=o.coverageAreas[s],l=(0,r.latLng)(a.bbox[0],a.bbox[1]),c=(0,r.latLng)(a.bbox[2],a.bbox[3]);e._esriAttributions.push({attribution:o.attribution,score:a.score,bounds:(0,r.latLngBounds)(l,c),minZoom:a.zoomMin,maxZoom:a.zoomMax})}e._esriAttributions.sort((function(t,e){return e.score-t.score})),C({target:e})}}),this))}function C(t){var e=t.target,i=e._esriAttributions;if(e&&e.attributionControl){var n=e.attributionControl._container.querySelector(".esri-dynamic-attribution");if(n&&i){for(var o="",s=e.getBounds(),a=(0,r.latLngBounds)(s.getSouthWest().wrap(),s.getNorthEast().wrap()),c=e.getZoom(),u=0;u<i.length;u++){var h=i[u],p=h.attribution;!o.match(p)&&h.bounds.intersects(a)&&c>=h.minZoom&&c<=h.maxZoom&&(o+=", "+p)}o=l+" | "+o.substr(2),n.innerHTML=o,n.style.maxWidth=x(e),e.fire("attributionupdated",{attribution:o})}}}var M={warn:n.R8,cleanUrl:_,getUrlParams:y,isArcgisOnline:A,geojsonTypeToArcGIS:v,responseToFeatureCollection:g,geojsonToArcGIS:c,arcgisToGeoJSON:u,boundsToExtent:p,extentToBounds:h,calcAttributionWidth:x,setEsriAttribution:b,removeEsriAttribution:w,_setGeometry:S,_getAttributionData:T,_updateMapAttribution:C,_findIdAttributeFromFeature:m,_findIdAttributeFromResponse:f}},37007:t=>{"use strict";var e,i="object"==typeof Reflect?Reflect:null,r=i&&"function"==typeof i.apply?i.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(i,r){function n(i){t.removeListener(e,o),r(i)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}m(t,e,o,{once:!0}),"error"!==e&&function(t,e,i){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,n)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function c(t,e,i,r){var n,o,s,c;if(a(i),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),s=o[e]),void 0===s)s=o[e]=i,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[i,s]:[s,i]:r?s.unshift(i):s.push(i),(n=l(t))>0&&s.length>n&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=u.bind(r);return n.listener=i,r.wrapFn=n,n}function p(t,e,i){var r=t._events;if(void 0===r)return[];var n=r[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(n):f(n,n.length)}function d(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function m(t,e,i,r){if("function"==typeof t.on)r.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(o){r.once&&t.removeEventListener(e,n),i(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[t];if(void 0===l)return!1;if("function"==typeof l)r(l,this,e);else{var c=l.length,u=f(l,c);for(i=0;i<c;++i)r(u[i],this,e)}return!0},o.prototype.addListener=function(t,e){return c(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return c(this,t,e,!0)},o.prototype.once=function(t,e){return a(e),this.on(t,h(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,h(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,r,n,o,s;if(a(e),void 0===(r=this._events))return this;if(void 0===(i=r[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){s=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,n),1===i.length&&(r[t]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,o=Object.keys(i);for(r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return p(this,t,!0)},o.prototype.rawListeners=function(t){return p(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},89353:t=>{"use strict";var e=Object.prototype.toString,i=Math.max,r=function(t,e){for(var i=[],r=0;r<t.length;r+=1)i[r]=t[r];for(var n=0;n<e.length;n+=1)i[n+t.length]=e[n];return i};t.exports=function(t){var n=this;if("function"!=typeof n||"[object Function]"!==e.apply(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var o,s=function(t,e){for(var i=[],r=1,n=0;r<t.length;r+=1,n+=1)i[n]=t[r];return i}(arguments),a=i(0,n.length-s.length),l=[],c=0;c<a;c++)l[c]="$"+c;if(o=Function("binder","return function ("+function(t,e){for(var i="",r=0;r<t.length;r+=1)i+=t[r],r+1<t.length&&(i+=",");return i}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof o){var e=n.apply(this,r(s,arguments));return Object(e)===e?e:this}return n.apply(t,r(s,arguments))})),n.prototype){var u=function(){};u.prototype=n.prototype,o.prototype=new u,u.prototype=null}return o}},66743:(t,e,i)=>{"use strict";var r=i(89353);t.exports=Function.prototype.bind||r},74462:t=>{"use strict";var e=function(){return"string"==typeof function(){}.name},i=Object.getOwnPropertyDescriptor;if(i)try{i([],"length")}catch(t){i=null}e.functionsHaveConfigurableNames=function(){if(!e()||!i)return!1;var t=i((function(){}),"name");return!!t&&!!t.configurable};var r=Function.prototype.bind;e.boundFunctionsHaveNames=function(){return e()&&"function"==typeof r&&""!==function(){}.bind().name},t.exports=e},11016:(t,e,i)=>{var r=i(4982),n=function(t){this.precision=t&&t.precision?t.precision:17,this.direction=!(!t||!t.direction)&&t.direction,this.pseudoNode=!(!t||!t.pseudoNode)&&t.pseudoNode,this.objectComparator=t&&t.objectComparator?t.objectComparator:a};function o(t){return t.coordinates.map((function(e){return{type:t.type.replace("Multi",""),coordinates:e}}))}function s(t,e){return t.hasOwnProperty("coordinates")?t.coordinates.length===e.coordinates.length:t.length===e.length}function a(t,e){return r(t,e,{strict:!0})}n.prototype.compare=function(t,e){if(t.type!==e.type||!s(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates,0,!1);case"Polygon":return this.comparePolygon(t,e);case"Feature":return this.compareFeature(t,e);default:if(0===t.type.indexOf("Multi")){var i=this,r=o(t),n=o(e);return r.every((function(t){return this.some((function(e){return i.compare(t,e)}))}),n)}}return!1},n.prototype.compareCoord=function(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i].toFixed(this.precision)!==e[i].toFixed(this.precision))return!1;return!0},n.prototype.compareLine=function(t,e,i,r){if(!s(t,e))return!1;var n=this.pseudoNode?t:this.removePseudo(t),o=this.pseudoNode?e:this.removePseudo(e);if(!r||this.compareCoord(n[0],o[0])||(o=this.fixStartIndex(o,n))){var a=this.compareCoord(n[i],o[i]);return this.direction||a?this.comparePath(n,o):!!this.compareCoord(n[i],o[o.length-(1+i)])&&this.comparePath(n.slice().reverse(),o)}},n.prototype.fixStartIndex=function(t,e){for(var i,r=-1,n=0;n<t.length;n++)if(this.compareCoord(t[n],e[0])){r=n;break}return r>=0&&(i=[].concat(t.slice(r,t.length),t.slice(1,r+1))),i},n.prototype.comparePath=function(t,e){var i=this;return t.every((function(t,e){return i.compareCoord(t,this[e])}),e)},n.prototype.comparePolygon=function(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){var i=t.coordinates.slice(1,t.coordinates.length),r=e.coordinates.slice(1,e.coordinates.length),n=this;return i.every((function(t){return this.some((function(e){return n.compareLine(t,e,1,!0)}))}),r)}return!1},n.prototype.compareFeature=function(t,e){return!(t.id!==e.id||!this.objectComparator(t.properties,e.properties)||!this.compareBBox(t,e))&&this.compare(t.geometry,e.geometry)},n.prototype.compareBBox=function(t,e){return!!(!t.bbox&&!e.bbox||t.bbox&&e.bbox&&this.compareCoord(t.bbox,e.bbox))},n.prototype.removePseudo=function(t){return t},t.exports=n},4945:(t,e,i)=>{var r=i(93385),n=i(88967),o=i(58421),s=i(44383).A,a=o.featureEach,l=(o.coordEach,n.polygon,n.featureCollection);function c(t){var e=new r(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),r.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})):a(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:s(t),e.push(t)})),r.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:s(t),r.prototype.remove.call(this,t,e)},e.clear=function(){return r.prototype.clear.call(this)},e.search=function(t){var e=r.prototype.search.call(this,this.toBBox(t));return l(e)},e.collides=function(t){return r.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=r.prototype.all.call(this);return l(t)},e.toJSON=function(){return r.prototype.toJSON.call(this)},e.fromJSON=function(t){return r.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=s(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=s(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}t.exports=c,t.exports.default=c},93385:function(t){t.exports=function(){"use strict";function t(t,r,n,o,s){!function t(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var p=i[r],d=n,f=o;for(e(i,n,r),s(i[o],p)>0&&e(i,n,o);d<f;){for(e(i,d,f),d++,f--;s(i[d],p)<0;)d++;for(;s(i[f],p)>0;)f--}0===s(i[n],p)?e(i,n,f):e(i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}(t,r,n||0,o||t.length-1,s||i)}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function o(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,r,n){n||(n=f(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o=e;o<i;o++){var s=t.children[o];a(n,t.leaf?r(s):s)}return n}function a(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,i,r,n,o){for(var s=[i,r];s.length;)if(!((r=s.pop())-(i=s.pop())<=n)){var a=i+Math.ceil((r-i)/n/2)*n;t(e,a,i,r,o),s.push(i,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,i=[];if(!d(t,e))return i;for(var r=this.toBBox,n=[];e;){for(var o=0;o<e.children.length;o++){var s=e.children[o],a=e.leaf?r(s):s;d(t,a)&&(e.leaf?i.push(s):p(t,a)?this._all(s,i):n.push(s))}e=n.pop()}return i},r.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var i=[];e;){for(var r=0;r<e.children.length;r++){var n=e.children[r],o=e.leaf?this.toBBox(n):n;if(d(t,o)){if(e.leaf||p(t,o))return!0;i.push(n)}}e=i.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=f([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var i,r,o,s=this.data,a=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],i=c.pop(),o=!0),s.leaf){var u=n(t,s.children,e);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!p(s,a)?r?(i++,s=r.children[i],o=!1):s=null:(l.push(s),c.push(i),i=0,r=s,s=s.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},r.prototype._build=function(t,e,i,r){var n,s=i-e+1,a=this._maxEntries;if(s<=a)return o(n=f(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),(n=f([])).leaf=!1,n.height=r;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(t,e,i,c,this.compareMinX);for(var u=e;u<=i;u+=c){var h=Math.min(u+c-1,i);m(t,u,h,l,this.compareMinY);for(var p=u;p<=h;p+=l){var d=Math.min(p+l-1,h);n.children.push(this._build(t,p,d,r-1))}}return o(n,this.toBBox),n},r.prototype._chooseSubtree=function(t,e,i,r){for(;r.push(e),!e.leaf&&r.length-1!==i;){for(var n=1/0,o=1/0,s=void 0,a=0;a<e.children.length;a++){var l=e.children[a],c=u(l),h=(p=t,d=l,(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-c);h<o?(o=h,n=c<n?c:n,s=l):h===o&&c<n&&(n=c,s=l)}e=s||e.children[0]}var p,d;return e},r.prototype._insert=function(t,e,i){var r=i?t:this.toBBox(t),n=[],o=this._chooseSubtree(r,this.data,e,n);for(o.children.push(t),a(o,r);e>=0&&n[e].children.length>this._maxEntries;)this._split(n,e),e--;this._adjustParentBBoxes(r,n,e)},r.prototype._split=function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var s=this._chooseSplitIndex(i,n,r),a=f(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},r.prototype._splitRoot=function(t,e){this.data=f([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,i){for(var r,n,o,a,l,c,h,p=1/0,d=1/0,f=e;f<=i-e;f++){var m=s(t,0,f,this.toBBox),g=s(t,f,i,this.toBBox),_=(n=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(n.minX,o.minX),l=Math.max(n.minY,o.minY),c=Math.min(n.maxX,o.maxX),h=Math.min(n.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(m)+u(g);_<p?(p=_,r=f,d=y<d?y:d):_===p&&y<d&&(d=y,r=f)}return r||i-e},r.prototype._chooseSplitAxis=function(t,e,i){var r=t.leaf?this.compareMinX:l,n=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,i,r){t.children.sort(r);for(var n=this.toBBox,o=s(t,0,e,n),l=s(t,i-e,i,n),c=h(o)+h(l),u=e;u<i-e;u++){var p=t.children[u];a(o,t.leaf?n(p):p),c+=h(o)}for(var d=i-e-1;d>=e;d--){var f=t.children[d];a(l,t.leaf?n(f):f),c+=h(l)}return c},r.prototype._adjustParentBBoxes=function(t,e,i){for(var r=i;r>=0;r--)a(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},r}()},70453:(t,e,i)=>{"use strict";var r,n=i(69383),o=i(41237),s=i(79290),a=i(79538),l=i(58068),c=i(69675),u=i(35345),h=Function,p=function(t){try{return h('"use strict"; return ('+t+").constructor;")()}catch(t){}},d=Object.getOwnPropertyDescriptor;if(d)try{d({},"")}catch(t){d=null}var f=function(){throw new c},m=d?function(){try{return f}catch(t){try{return d(arguments,"callee").get}catch(t){return f}}}():f,g=i(64039)(),_=i(80024)(),y=Object.getPrototypeOf||(_?function(t){return t.__proto__}:null),A={},v="undefined"!=typeof Uint8Array&&y?y(Uint8Array):r,x={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":A,"%AsyncGenerator%":A,"%AsyncGeneratorFunction%":A,"%AsyncIteratorPrototype%":A,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":h,"%GeneratorFunction%":A,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&g&&y?y((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":s,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&g&&y?y((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):r,"%Symbol%":g?Symbol:r,"%SyntaxError%":l,"%ThrowTypeError%":m,"%TypedArray%":v,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};if(y)try{null.error}catch(t){var b=y(y(t));x["%Error.prototype%"]=b}var w=function t(e){var i;if("%AsyncFunction%"===e)i=p("async function () {}");else if("%GeneratorFunction%"===e)i=p("function* () {}");else if("%AsyncGeneratorFunction%"===e)i=p("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(i=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var n=t("%AsyncGenerator%");n&&y&&(i=y(n.prototype))}return x[e]=i,i},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},T=i(66743),C=i(9957),M=T.call(Function.call,Array.prototype.concat),E=T.call(Function.apply,Array.prototype.splice),I=T.call(Function.call,String.prototype.replace),L=T.call(Function.call,String.prototype.slice),P=T.call(Function.call,RegExp.prototype.exec),k=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,N=/\\(\\)?/g,D=function(t,e){var i,r=t;if(C(S,r)&&(r="%"+(i=S[r])[0]+"%"),C(x,r)){var n=x[r];if(n===A&&(n=w(r)),void 0===n&&!e)throw new c("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:r,value:n}}throw new l("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new c('"allowMissing" argument must be a boolean');if(null===P(/^%?[^%]*%?$/,t))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=function(t){var e=L(t,0,1),i=L(t,-1);if("%"===e&&"%"!==i)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==e)throw new l("invalid intrinsic syntax, expected opening `%`");var r=[];return I(t,k,(function(t,e,i,n){r[r.length]=i?I(n,N,"$1"):e||t})),r}(t),r=i.length>0?i[0]:"",n=D("%"+r+"%",e),o=n.name,s=n.value,a=!1,u=n.alias;u&&(r=u[0],E(i,M([0,1],u)));for(var h=1,p=!0;h<i.length;h+=1){var f=i[h],m=L(f,0,1),g=L(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new l("property names with quotes must have matching quotes");if("constructor"!==f&&p||(a=!0),C(x,o="%"+(r+="."+f)+"%"))s=x[o];else if(null!=s){if(!(f in s)){if(!e)throw new c("base intrinsic for "+t+" exists, but the property is not available.");return}if(d&&h+1>=i.length){var _=d(s,f);s=(p=!!_)&&"get"in _&&!("originalValue"in _.get)?_.get:s[f]}else p=C(s,f),s=s[f];p&&!a&&(x[o]=s)}}return s}},75795:(t,e,i)=>{"use strict";var r=i(70453)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(t){r=null}t.exports=r},54923:(t,e,i)=>{"use strict";i.d(e,{Sg:()=>C,u$:()=>M});var r=function(t){var e,i=void 0!==(t=t||{})?t:{},r={};for(e in i)i.hasOwnProperty(e)&&(r[e]=i[e]);var n,o=[],s="";"undefined"!=typeof document&&document.currentScript&&(s=document.currentScript.src),s=0!==s.indexOf("blob:")?s.substr(0,s.lastIndexOf("/")+1):"",n=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(200==r.status||0==r.status&&r.response)e(r.response);else{var n=W(t);n?e(n.buffer):i()}},r.onerror=i,r.send(null)};var a=i.print||console.log.bind(console),l=i.printErr||console.warn.bind(console);for(e in r)r.hasOwnProperty(e)&&(i[e]=r[e]);r=null,i.arguments&&(o=i.arguments);var c=0,u=!1;function h(t){var e=i["_"+t];return e||ot("Assertion failed: "+("Cannot call unknown function "+t+", make sure it is exported")),e}var p,d,f,m,g,_,y,A="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function v(t,e){return t?function(t,e,i){for(var r=e+i,n=e;t[n]&&!(n>=r);)++n;if(n-e>16&&t.subarray&&A)return A.decode(t.subarray(e,n));for(var o="";e<n;){var s=t[e++];if(128&s){var a=63&t[e++];if(192!=(224&s)){var l=63&t[e++];if((s=224==(240&s)?(15&s)<<12|a<<6|l:(7&s)<<18|a<<12|l<<6|63&t[e++])<65536)o+=String.fromCharCode(s);else{var c=s-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o}(f,t,e):""}function x(t,e){return t%e>0&&(t+=e-t%e),t}function b(t){p=t,i.HEAP8=d=new Int8Array(t),i.HEAP16=m=new Int16Array(t),i.HEAP32=g=new Int32Array(t),i.HEAPU8=f=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAPU32=new Uint32Array(t),i.HEAPF32=_=new Float32Array(t),i.HEAPF64=y=new Float64Array(t)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var w=i.TOTAL_MEMORY||33554432;function S(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var r=e.func;"number"==typeof r?void 0===e.arg?i.dynCall_v(r):i.dynCall_vi(r,e.arg):r(void 0===e.arg?null:e.arg)}else e()}}w=(p=i.buffer?i.buffer:new ArrayBuffer(w)).byteLength,b(p),g[6032]=5267040;var T=[],C=[],M=[],E=[],I=Math.abs,L=Math.ceil,P=Math.floor,k=Math.min,N=0,D=null,O=null;i.preloadedImages={},i.preloadedAudios={};var R,F,z=null,B="data:application/octet-stream;base64,";function U(t){return String.prototype.startsWith?t.startsWith(B):0===t.indexOf(B)}function V(t){return t.replace(/\b__Z[\w\d_]+/g,(function(t){return t==t?t:t+" ["+t+"]"}))}function j(){var t=new Error;if(!t.stack){try{throw new Error(0)}catch(e){t=e}if(!t.stack)return"(no stack trace available)"}return t.stack.toString()}function G(){return d.length}function Z(t){try{var e=new ArrayBuffer(t);if(e.byteLength!=t)return;return new Int8Array(e).set(d),$(e),b(e),1}catch(t){}}z="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var q="function"==typeof atob?atob:function(t){var e,i,r,n,o,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{e=a.indexOf(t.charAt(c++))<<2|(n=a.indexOf(t.charAt(c++)))>>4,i=(15&n)<<4|(o=a.indexOf(t.charAt(c++)))>>2,r=(3&o)<<6|(s=a.indexOf(t.charAt(c++))),l+=String.fromCharCode(e),64!==o&&(l+=String.fromCharCode(i)),64!==s&&(l+=String.fromCharCode(r))}while(c<t.length);return l};function W(t){if(U(t))return function(t){try{for(var e=q(t),i=new Uint8Array(e.length),r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}catch(t){throw new Error("Converting base64 string to bytes failed.")}}(t.slice(B.length))}var H,J,K=function(t,e,i){var r=new t.Int8Array(i),n=new t.Int32Array(i),o=(new t.Uint8Array(i),new t.Float32Array(i),new t.Float64Array(i)),s=0|e.o,a=0|e.p,l=t.Math.floor,c=t.Math.abs,u=t.Math.sqrt,h=t.Math.pow,p=t.Math.cos,d=t.Math.sin,f=t.Math.tan,m=t.Math.acos,g=t.Math.asin,_=t.Math.atan,y=t.Math.atan2,A=t.Math.ceil,v=t.Math.imul,x=t.Math.min,b=t.Math.max,w=t.Math.clz32,S=e.b,T=e.c,C=e.d,M=e.e,E=e.f,I=e.g,L=e.h,P=e.i,k=24160;function N(t,e,i,r){return 0|D(t|=0,e|=0,i|=0,r|=0,0)}function D(t,e,i,r,o){var s,a=0,l=0,c=0,u=0;if(s=k,k=k+16|0,l=s,!(0|O(t|=0,e|=0,i|=0,r|=0,o|=0)))return k=s,0;do{if((0|i)>=0){if((0|i)>13780509){if(0|(a=0|ee(15,l)))break;l=0|n[(c=l)>>2],c=0|n[c+4>>2]}else u=0|Fe(0|i,0|(a=((0|i)<0)<<31>>31),3,0),c=0|T(),a=0|ke(0|i,0|a,1,0),a=0|ke(0|(a=0|Fe(0|u,0|c,0|a,0|T())),0|T(),1,0),c=0|T(),n[l>>2]=a,n[l+4>>2]=c,l=a;if(He(0|r,0,l<<3),0|o){He(0|o,0,l<<2),a=0|R(t,e,i,r,o,l,c,0);break}(a=0|Pe(l,4))?(u=0|R(t,e,i,r,a,l,c,0),Le(a),a=u):a=13}else a=2}while(0);return k=s,0|a}function O(t,e,i,r,o){t|=0,e|=0,i|=0,r|=0,o|=0;var s,a,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0;if(a=k,k=k+16|0,g=a+8|0,n[(m=s=a)>>2]=t,n[m+4>>2]=e,(0|i)<0)return k=a,2;if(n[(l=r)>>2]=t,n[l+4>>2]=e,(l=!!(0|o))&&(n[o>>2]=0),0|Ft(t,e))return k=a,9;n[g>>2]=0;t:do{if((0|i)>=1)if(l)for(d=1,p=0,f=0,m=1,l=t;;){if(!(p|f)){if(0|(l=0|F(l,e,4,g,s)))break t;if(0|Ft(l=0|n[(e=s)>>2],e=0|n[e+4>>2])){l=9;break t}}if(0|(l=0|F(l,e,0|n[22384+(f<<2)>>2],g,s)))break t;if(l=0|n[(e=s)>>2],e=0|n[e+4>>2],n[(t=r+(d<<3)|0)>>2]=l,n[t+4>>2]=e,n[o+(d<<2)>>2]=m,c=(0|(t=p+1|0))==(0|m),h=6==(0|(u=f+1|0)),0|Ft(l,e)){l=9;break t}if((0|(m=m+(h&c&1)|0))>(0|i)){l=0;break}d=d+1|0,p=c?0:t,f=c?h?0:u:f}else for(d=1,p=0,f=0,m=1,l=t;;){if(!(p|f)){if(0|(l=0|F(l,e,4,g,s)))break t;if(0|Ft(l=0|n[(e=s)>>2],e=0|n[e+4>>2])){l=9;break t}}if(0|(l=0|F(l,e,0|n[22384+(f<<2)>>2],g,s)))break t;if(l=0|n[(e=s)>>2],e=0|n[e+4>>2],n[(t=r+(d<<3)|0)>>2]=l,n[t+4>>2]=e,c=(0|(t=p+1|0))==(0|m),h=6==(0|(u=f+1|0)),0|Ft(l,e)){l=9;break t}if((0|(m=m+(h&c&1)|0))>(0|i)){l=0;break}d=d+1|0,p=c?0:t,f=c?h?0:u:f}else l=0}while(0);return k=a,0|l}function R(t,e,i,r,o,s,a,l){i|=0,r|=0,o|=0,l|=0;var c,u,h,p=0,d=0,f=0,m=0,g=0,_=0,y=0;if(h=k,k=k+16|0,c=h+8|0,u=h,p=0|Be(0|(t|=0),0|(e|=0),0|(s|=0),0|(a|=0)),f=0|T(),!(!(0|(y=0|n[(_=m=r+(p<<3)|0)>>2]))&!(0|(_=0|n[_+4>>2]))|(d=(0|y)==(0|t)&(0|_)==(0|e))))do{p=0|ze(0|(p=0|ke(0|p,0|f,1,0)),0|T(),0|s,0|a),f=0|T(),d=(0|(_=0|n[(y=m=r+(p<<3)|0)>>2]))==(0|t)&(0|(y=0|n[y+4>>2]))==(0|e)}while(!(!(0|_)&!(0|y)|d));if(p=o+(p<<2)|0,d&&(0|n[p>>2])<=(0|l))return k=h,0;if(n[(y=m)>>2]=t,n[y+4>>2]=e,n[p>>2]=l,(0|l)>=(0|i))return k=h,0;switch(d=l+1|0,n[c>>2]=0,0|(p=0|F(t,e,2,c,u))){case 9:g=9;break;case 0:(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d))||(g=9)}t:do{if(9==(0|g)){switch(n[c>>2]=0,0|(p=0|F(t,e,3,c,u))){case 9:break;case 0:if(0|(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d)))break t;break;default:break t}switch(n[c>>2]=0,0|(p=0|F(t,e,1,c,u))){case 9:break;case 0:if(0|(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d)))break t;break;default:break t}switch(n[c>>2]=0,0|(p=0|F(t,e,5,c,u))){case 9:break;case 0:if(0|(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d)))break t;break;default:break t}switch(n[c>>2]=0,0|(p=0|F(t,e,4,c,u))){case 9:break;case 0:if(0|(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d)))break t;break;default:break t}switch(n[c>>2]=0,0|(p=0|F(t,e,6,c,u))){case 9:break;case 0:if(0|(p=0|R(0|n[(p=u)>>2],0|n[p+4>>2],i,r,o,s,a,d)))break t;break;default:break t}return k=h,0}}while(0);return k=h,0|p}function F(t,e,i,r,o){t|=0,e|=0,o|=0;var s,a,l=0,c=0,u=0,h=0,p=0,d=0,f=0;if((i|=0)>>>0>6)return 1;if(p=(0|n[(r|=0)>>2])%6|0,n[r>>2]=p,(0|p)>0){l=0;do{i=0|ft(i),l=l+1|0}while((0|l)<(0|n[r>>2]))}if(p=0|Ve(0|t,0|e,45),T(),(a=127&p)>>>0>121)return 5;s=0|zt(t,e),l=0|Ve(0|t,0|e,52),T(),l&=15;t:do{if(l){for(;;){if(u=0|Ve(0|t,0|e,0|(c=3*(15-l|0)|0)),T(),7==(0|(u&=7))){e=5;break}if(f=!(0|Gt(l)),l=l+-1|0,d=0|je(7,0,0|c),e&=~T(),t=je(0|n[(f?432:16)+(28*u|0)+(i<<2)>>2],0,0|c)|t&~d,e|=c=0|T(),!(i=0|n[(f?640:224)+(28*u|0)+(i<<2)>>2])){i=0;break t}if(!l){h=8;break t}}return 0|e}h=8}while(0);8==(0|h)&&(t|=0|je(0|(f=0|n[848+(28*a|0)+(i<<2)>>2]),0,45),e=T()|-1040385&e,i=0|n[4272+(28*a|0)+(i<<2)>>2],127&~f||(f=0|je(0|n[848+(28*a|0)+20>>2],0,45),e=T()|-1040385&e,i=0|n[4272+(28*a|0)+20>>2],t=0|Ut(f|t,e),e=0|T(),n[r>>2]=1+(0|n[r>>2]))),u=0|Ve(0|t,0|e,45),T(),u&=127;t:do{if(0|U(u)){e:do{if(1==(0|zt(t,e))){if((0|a)!=(0|u)){if(0|Z(u,0|n[7696+(28*a|0)>>2])){t=0|jt(t,e),c=1,e=0|T();break}C(23313,22416,436,22424)}switch(0|s){case 3:t=0|Ut(t,e),e=0|T(),n[r>>2]=1+(0|n[r>>2]),c=0;break e;case 5:t=0|jt(t,e),e=0|T(),n[r>>2]=5+(0|n[r>>2]),c=0;break e;case 0:return 9;default:return 1}}else c=0}while(0);if((0|i)>0){l=0;do{t=0|Bt(t,e),e=0|T(),l=l+1|0}while((0|l)!=(0|i))}if((0|a)!=(0|u)){if(!(0|V(u))){if(!!(0|c)|5!=(0|zt(t,e)))break;n[r>>2]=1+(0|n[r>>2]);break}switch(127&p){case 8:case 118:break t}3!=(0|zt(t,e))&&(n[r>>2]=1+(0|n[r>>2]))}}else if((0|i)>0){l=0;do{t=0|Ut(t,e),e=0|T(),l=l+1|0}while((0|l)!=(0|i))}}while(0);return n[r>>2]=((0|n[r>>2])+i|0)%6|0,n[(f=o)>>2]=t,n[f+4>>2]=e,0}function z(t,e,i,r){i|=0,r|=0;var o,s,a,l=0,c=0;for(a=k,k=k+16|0,o=a,s=a+8|0,l=(l=!(0|Ft(t|=0,e|=0)))?1:2;;){if(n[s>>2]=0,!(0|F(t,e,l,s,o))&((0|n[(c=o)>>2])==(0|i)?(0|n[c+4>>2])==(0|r):0)){t=4;break}if((l=l+1|0)>>>0>=7){l=7,t=4;break}}return 4==(0|t)?(k=a,0|l):0}function B(t,e,i,r,s,a,l){e|=0,i|=0,r|=0,s|=0,a|=0,l|=0;var c,u,h,p,d,f,m,g,_,y,A=0,v=0,x=0,b=0,w=0,S=0,C=0,M=0,E=0,I=0,L=0,P=0,N=0,D=0,O=0,R=0,F=0,z=0,B=0;if(y=k,k=k+64|0,m=y+48|0,g=y+32|0,_=y+24|0,c=y+8|0,u=y,(0|(v=0|n[(t|=0)>>2]))<=0)return k=y,0;for(h=t+4|0,p=m+8|0,d=g+8|0,f=c+8|0,A=0,N=0;;){P=(x=0|n[h>>2])+(N<<4)|0,n[m>>2]=n[P>>2],n[m+4>>2]=n[P+4>>2],n[m+8>>2]=n[P+8>>2],n[m+12>>2]=n[P+12>>2],(0|N)==(v+-1|0)?(n[g>>2]=n[x>>2],n[g+4>>2]=n[x+4>>2],n[g+8>>2]=n[x+8>>2],n[g+12>>2]=n[x+12>>2]):(P=x+(N+1<<4)|0,n[g>>2]=n[P>>2],n[g+4>>2]=n[P+4>>2],n[g+8>>2]=n[P+8>>2],n[g+12>>2]=n[P+12>>2]),v=0|$(m,g,r,_);t:do{if(v)x=0,A=v;else if(v=0|n[(x=_)>>2],(0|(x=0|n[x+4>>2]))>0|!(0|x)&v>>>0>0){L=0,P=0;e:for(;;){if(B=+o[m>>3],z=+((I=0|Ne(0|v,0|x,0|L,0|P))>>>0)+4294967296*+(0|T()),R=+(v>>>0)+4294967296*+(0|x),F=+(L>>>0)+4294967296*+(0|P),o[c>>3]=B*z/R+ +o[g>>3]*F/R,o[f>>3]=+o[p>>3]*z/R+ +o[d>>3]*F/R,0|(v=0|Zt(c,r,u))){A=v;break}S=0|Be(0|(E=0|n[(I=u)>>2]),0|(I=0|n[I+4>>2]),0|e,0|i),b=0|T(),x=0|n[(w=v=l+(S<<3)|0)>>2],w=0|n[w+4>>2];i:do{if(!(0|x)&!(0|w))D=v,O=16;else for(C=0,M=0;;){if((0|C)>(0|i)|(0|C)==(0|i)&M>>>0>e>>>0){A=1;break e}if((0|x)==(0|E)&(0|w)==(0|I))break i;if(S=0|ze(0|(v=0|ke(0|S,0|b,1,0)),0|T(),0|e,0|i),b=0|T(),M=0|ke(0|M,0|C,1,0),C=0|T(),!(0|(x=0|n[(w=v=l+(S<<3)|0)>>2]))&!(0|(w=0|n[w+4>>2]))){D=v,O=16;break}}}while(0);if(16!=(0|O)||(O=0,!(0|E)&!(0|I))||(n[(M=D)>>2]=E,n[M+4>>2]=I,M=a+(n[s>>2]<<3)|0,n[M>>2]=E,n[M+4>>2]=I,M=0|ke(0|n[(M=s)>>2],0|n[M+4>>2],1,0),E=0|T(),n[(I=s)>>2]=M,n[I+4>>2]=E),L=0|ke(0|L,0|P,1,0),P=0|T(),v=0|n[(x=_)>>2],!((0|(x=0|n[x+4>>2]))>(0|P)|(0|x)==(0|P)&v>>>0>L>>>0)){x=1;break t}}x=0}else x=1}while(0);if(N=N+1|0,!x){O=21;break}if((0|N)>=(0|(v=0|n[t>>2]))){A=0,O=21;break}}return 21==(0|O)?(k=y,0|A):0}function U(t){return(t|=0)>>>0>121?0|(t=0):0|(t=0|n[7696+(28*t|0)+16>>2])}function V(t){return 4==(0|(t|=0))|117==(0|t)}function j(t){return 0|n[11120+(216*(0|n[(t|=0)>>2])|0)+(72*(0|n[t+4>>2])|0)+(24*(0|n[t+8>>2])|0)+(n[t+12>>2]<<3)>>2]}function G(t){return 0|n[11120+(216*(0|n[(t|=0)>>2])|0)+(72*(0|n[t+4>>2])|0)+(24*(0|n[t+8>>2])|0)+(n[t+12>>2]<<3)+4>>2]}function Z(t,e){return e|=0,(0|n[7696+(28*(t|=0)|0)+20>>2])==(0|e)?0|(e=1):0|(e=(0|n[7696+(28*t|0)+24>>2])==(0|e))}function q(t,e){return 0|n[848+(28*(t|=0)|0)+((e|=0)<<2)>>2]}function W(t,e){return e|=0,(0|n[848+(28*(t|=0)|0)>>2])==(0|e)?0|(e=0):(0|n[848+(28*t|0)+4>>2])==(0|e)?0|(e=1):(0|n[848+(28*t|0)+8>>2])==(0|e)?0|(e=2):(0|n[848+(28*t|0)+12>>2])==(0|e)?0|(e=3):(0|n[848+(28*t|0)+16>>2])==(0|e)?0|(e=4):(0|n[848+(28*t|0)+20>>2])==(0|e)?0|(e=5):0|((0|n[848+(28*t|0)+24>>2])==(0|e)?6:7)}function H(t){return+o[16+(t|=0)>>3]<+o[t+24>>3]|0}function J(t,e){t|=0;var i,r,n=0;return(n=+o[(e|=0)>>3])>=+o[t+8>>3]&&n<=+o[t>>3]?(i=+o[t+16>>3],n=+o[t+24>>3],e=(r=+o[e+8>>3])>=n,t=r<=i&1,i<n?e&&(t=1):e||(t=0),0|(e=!!(0|t))):0|(e=0)}function K(t,e,i){t|=0,e|=0,i|=0;var r,a,u,h,p,d,f,m=0,g=0,_=0,y=0,v=0,b=0,w=0;d=k,k=k+288|0,p=d+264|0,y=d+96|0,g=(m=_=d)+96|0;do{n[m>>2]=0,m=m+4|0}while((0|m)<(0|g));return 0|(e=0|Kt(e,_))?(k=d,0|(b=e)):(Ht(_=0|n[(g=_)>>2],g=0|n[g+4>>2],p),Jt(_,g,y),h=+te(p,y+8|0),o[p>>3]=+o[t>>3],o[(g=p+8|0)>>3]=+o[t+16>>3],o[y>>3]=+o[t+8>>3],o[(_=y+8|0)>>3]=+o[t+24>>3],a=+te(p,y),w=+o[g>>3]-+o[_>>3],u=+c(+w),f=+o[p>>3]-+o[y>>3],r=+c(+f),!(0==w|0==f)&&(w=+Ge(+u,+r),w=+A(+a*a/+Ze(+w/+Ze(+u,+r),3)/(h*(2.59807621135*h)*.8)),o[s>>3]=w,v=~~w>>>0,b=+c(w)>=1?w>0?~~+x(+l(w/4294967296),4294967295)>>>0:~~+A((w-+(~~w>>>0))/4294967296)>>>0:0,2146435072&~n[s+4>>2])?(y=!(0|v)&!(0|b),n[(e=i)>>2]=y?1:v,n[e+4>>2]=y?0:b,e=0):e=1,k=d,0|(b=e))}function $(t,e,i,r){t|=0,e|=0,i|=0,r|=0;var a,u,h,p,d=0,f=0,m=0;p=k,k=k+288|0,u=p+264|0,h=p+96|0,a=(d=f=p)+96|0;do{n[d>>2]=0,d=d+4|0}while((0|d)<(0|a));return 0|(i=0|Kt(i,f))?(k=p,0|(r=i)):(Ht(d=0|n[(i=f)>>2],i=0|n[i+4>>2],u),Jt(d,i,h),m=+te(u,h+8|0),m=+A(+ +te(t,e)/(2*m)),o[s>>3]=m,i=~~m>>>0,d=+c(m)>=1?m>0?~~+x(+l(m/4294967296),4294967295)>>>0:~~+A((m-+(~~m>>>0))/4294967296)>>>0:0,2146435072&~n[s+4>>2]?(f=!(0|i)&!(0|d),n[r>>2]=f?1:i,n[r+4>>2]=f?0:d,k=p,0|(r=0)):(k=p,0|(r=1)))}function Y(t,e,i,r){e|=0,i|=0,r|=0,n[(t|=0)>>2]=e,n[t+4>>2]=i,n[t+8>>2]=r}function X(t,e){t|=0;var i,r,s,a,l=0,u=0,h=0,p=0,d=0,f=0,m=0;n[(a=8+(e|=0)|0)>>2]=0,r=+o[t>>3],p=+c(+r),s=+o[t+8>>3],p+=.5*(d=+c(+s)/.8660254037844386),p-=+(0|(l=~~p)),d-=+(0|(t=~~d));do{if(p<.5){if(p<.3333333333333333){if(n[e>>2]=l,d<.5*(p+1)){n[e+4>>2]=t;break}t=t+1|0,n[e+4>>2]=t;break}if(t=(1&!(d<(m=1-p)))+t|0,n[e+4>>2]=t,m<=d&d<2*p){l=l+1|0,n[e>>2]=l;break}n[e>>2]=l;break}if(!(p<.6666666666666666)){if(l=l+1|0,n[e>>2]=l,d<.5*p){n[e+4>>2]=t;break}t=t+1|0,n[e+4>>2]=t;break}if(d<1-p){if(n[e+4>>2]=t,2*p-1<d){n[e>>2]=l;break}}else t=t+1|0,n[e+4>>2]=t;l=l+1|0,n[e>>2]=l}while(0);do{if(r<0){if(1&t){l=~~(+(0|l)-(2*(+((f=0|Ne(0|l,((0|l)<0)<<31>>31,0|(f=(t+1|0)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))+1)),n[e>>2]=l;break}l=~~(+(0|l)-2*(+((f=0|Ne(0|l,((0|l)<0)<<31>>31,0|(f=(0|t)/2|0),((0|f)<0)<<31>>31))>>>0)+4294967296*+(0|T()))),n[e>>2]=l;break}}while(0);f=e+4|0,s<0&&(l=l-((1|t<<1)/2|0)|0,n[e>>2]=l,t=0-t|0,n[f>>2]=t),u=t-l|0,(0|l)<0?(h=0-l|0,n[f>>2]=u,n[a>>2]=h,n[e>>2]=0,t=u,l=0):h=0,(0|t)<0&&(l=l-t|0,n[e>>2]=l,h=h-t|0,n[a>>2]=h,n[f>>2]=0,t=0),i=l-h|0,u=t-h|0,(0|h)<0&&(n[e>>2]=i,n[f>>2]=u,n[a>>2]=0,t=u,l=i,h=0),(0|(u=(0|h)<(0|(u=(0|t)<(0|l)?t:l))?h:u))<=0||(n[e>>2]=l-u,n[f>>2]=t-u,n[a>>2]=h-u)}function Q(t){var e,i=0,r=0,o=0,s=0,a=0;i=0|n[(t|=0)>>2],r=0|n[(e=t+4|0)>>2],(0|i)<0&&(r=r-i|0,n[e>>2]=r,n[(a=t+8|0)>>2]=(0|n[a>>2])-i,n[t>>2]=0,i=0),(0|r)<0?(i=i-r|0,n[t>>2]=i,s=(0|n[(a=t+8|0)>>2])-r|0,n[a>>2]=s,n[e>>2]=0,r=0):(a=s=t+8|0,s=0|n[s>>2]),(0|s)<0&&(i=i-s|0,n[t>>2]=i,r=r-s|0,n[e>>2]=r,n[a>>2]=0,s=0),(0|(o=(0|s)<(0|(o=(0|r)<(0|i)?r:i))?s:o))<=0||(n[t>>2]=i-o,n[e>>2]=r-o,n[a>>2]=s-o)}function tt(t,e){var i,r;e|=0,r=0|n[8+(t|=0)>>2],i=+((0|n[t+4>>2])-r|0),o[e>>3]=+((0|n[t>>2])-r|0)-.5*i,o[e+8>>3]=.8660254037844386*i}function et(t,e,i){t|=0,e|=0,n[(i|=0)>>2]=(0|n[e>>2])+(0|n[t>>2]),n[i+4>>2]=(0|n[e+4>>2])+(0|n[t+4>>2]),n[i+8>>2]=(0|n[e+8>>2])+(0|n[t+8>>2])}function it(t,e,i){t|=0,e|=0,n[(i|=0)>>2]=(0|n[t>>2])-(0|n[e>>2]),n[i+4>>2]=(0|n[t+4>>2])-(0|n[e+4>>2]),n[i+8>>2]=(0|n[t+8>>2])-(0|n[e+8>>2])}function rt(t,e){e|=0;var i,r=0;r=0|v(0|n[(t|=0)>>2],e),n[t>>2]=r,i=0|v(0|n[(r=t+4|0)>>2],e),n[r>>2]=i,e=0|v(0|n[(t=t+8|0)>>2],e),n[t>>2]=e}function nt(t){var e,i,r=0,o=0,s=0,a=0,l=0;l=(0|(i=0|n[(t|=0)>>2]))<0,t=(t=(o=(0|(a=((e=(0|(s=(0|n[t+4>>2])-(l?i:0)|0))<0)?0-s|0:0)+((0|n[t+8>>2])-(l?i:0))|0))<0)?0:a)-((s=(0|(o=(0|t)<(0|(o=(0|(r=(e?0:s)-(o?a:0)|0))<(0|(a=(l?0:i)-(e?s:0)-(o?a:0)|0))?r:a))?t:o))>0)?o:0)|0,r=r-(s?o:0)|0;t:do{switch(a-(s?o:0)|0){case 0:switch(0|r){case 0:return 0|(0|t?1==(0|t)?1:7:0);case 1:return 0|(0|t?1==(0|t)?3:7:2);default:break t}case 1:switch(0|r){case 0:return 0|(0|t?1==(0|t)?5:7:4);case 1:if(t)break t;return 6;default:break t}}}while(0);return 7}function ot(t){var e,i=0,r=0,o=0,s=0,a=0,l=0;s=0|n[(e=8+(t|=0)|0)>>2],a=(0|n[t>>2])-s|0,s=(0|n[(l=t+4|0)>>2])-s|0;do{if(a>>>0>715827881|s>>>0>715827881){if(r=(0|a)>0){if((2147483647-a|0)<(0|a))return 1;if((2147483647-(a<<1)|0)<(0|a))return 1}else{if((-2147483648-a|0)>(0|a))return 1;if((-2147483648-(a<<1)|0)>(0|a))return 1}if(i=3*a|0,(0|s)>0){if((2147483647-s|0)<(0|s))return 1}else if((-2147483648-s|0)>(0|s))return 1;if(o=s<<1,(0|a)>-1){if((-2147483648|i)>=(0|s))return 1}else if((-2147483648^i)<(0|s))return 1;if(r){if(!((2147483647-a|0)<(0|o))){r=o;break}return 1}if(!((-2147483648-a|0)>(0|o))){r=o;break}return 1}r=s<<1,i=3*a|0}while(0);o=0|Ee(+(i-s|0)/7),n[t>>2]=o,s=0|Ee(+(r+a|0)/7),n[l>>2]=s,n[e>>2]=0,i=(r=(0|s)<(0|o))?o:s,r=r?s:o;do{if((0|r)<0){if((0|i)>0){if((-2147483648|i)<(0|r)&-2147483648!=(0|r)&(2147483647-i|0)>=(0|r))break;C(23313,22444,355,22455)}if(-2147483648==(0|r)|(-2147483648-i|0)>(0|r)&&C(23313,22444,355,22455),(0|i)>-1){if((-2147483648|i)<(0|r))break;C(23313,22444,355,22455)}else{if((-2147483648^i)>=(0|r))break;C(23313,22444,355,22455)}}}while(0);return i=s-o|0,(0|o)<0?(r=0-o|0,n[l>>2]=i,n[e>>2]=r,n[t>>2]=0,o=0):(i=s,r=0),(0|i)<0&&(o=o-i|0,n[t>>2]=o,r=r-i|0,n[e>>2]=r,n[l>>2]=0,i=0),a=o-r|0,s=i-r|0,(0|r)<0?(n[t>>2]=a,n[l>>2]=s,n[e>>2]=0,i=s,s=a,r=0):s=o,(0|(o=(0|r)<(0|(o=(0|i)<(0|s)?i:s))?r:o))<=0||(n[t>>2]=s-o,n[l>>2]=i-o,n[e>>2]=r-o),0}function st(t){var e,i=0,r=0,o=0,s=0,a=0,l=0;s=0|n[(e=8+(t|=0)|0)>>2],a=(0|n[t>>2])-s|0,s=(0|n[(l=t+4|0)>>2])-s|0;do{if(a>>>0>715827881|s>>>0>715827881){if(r=(0|a)>0){if((2147483647-a|0)<(0|a))return 1}else if((-2147483648-a|0)>(0|a))return 1;if(i=a<<1,(0|s)>0){if((2147483647-s|0)<(0|s))return 1;if((2147483647-(s<<1)|0)<(0|s))return 1}else{if((-2147483648-s|0)>(0|s))return 1;if((-2147483648-(s<<1)|0)>(0|s))return 1}if(o=3*s|0,r){if((2147483647-i|0)<(0|s))return 1}else if((-2147483648-i|0)>(0|s))return 1;if((0|s)>-1){if((-2147483648|o)<(0|a)){r=o;break}return 1}if(!((-2147483648^o)<(0|a))){r=o;break}return 1}r=3*s|0,i=a<<1}while(0);o=0|Ee(+(i+s|0)/7),n[t>>2]=o,s=0|Ee(+(r-a|0)/7),n[l>>2]=s,n[e>>2]=0,i=(r=(0|s)<(0|o))?o:s,r=r?s:o;do{if((0|r)<0){if((0|i)>0){if((-2147483648|i)<(0|r)&-2147483648!=(0|r)&(2147483647-i|0)>=(0|r))break;C(23313,22444,404,22469)}if(-2147483648==(0|r)|(-2147483648-i|0)>(0|r)&&C(23313,22444,404,22469),(0|i)>-1){if((-2147483648|i)<(0|r))break;C(23313,22444,404,22469)}else{if((-2147483648^i)>=(0|r))break;C(23313,22444,404,22469)}}}while(0);return i=s-o|0,(0|o)<0?(r=0-o|0,n[l>>2]=i,n[e>>2]=r,n[t>>2]=0,o=0):(i=s,r=0),(0|i)<0&&(o=o-i|0,n[t>>2]=o,r=r-i|0,n[e>>2]=r,n[l>>2]=0,i=0),a=o-r|0,s=i-r|0,(0|r)<0?(n[t>>2]=a,n[l>>2]=s,n[e>>2]=0,i=s,s=a,r=0):s=o,(0|(o=(0|r)<(0|(o=(0|i)<(0|s)?i:s))?r:o))<=0||(n[t>>2]=s-o,n[l>>2]=i-o,n[e>>2]=r-o),0}function at(t){var e,i,r=0,o=0,s=0,a=0,l=0;o=0|n[(e=8+(t|=0)|0)>>2],s=0|Ee(+((3*(r=(0|n[t>>2])-o|0)|0)-(o=(0|n[(i=t+4|0)>>2])-o|0)|0)/7),n[t>>2]=s,r=0|Ee(+((o<<1)+r|0)/7),n[i>>2]=r,n[e>>2]=0,o=r-s|0,(0|s)<0?(l=0-s|0,n[i>>2]=o,n[e>>2]=l,n[t>>2]=0,r=o,s=0,o=l):o=0,(0|r)<0&&(s=s-r|0,n[t>>2]=s,o=o-r|0,n[e>>2]=o,n[i>>2]=0,r=0),l=s-o|0,a=r-o|0,(0|o)<0?(n[t>>2]=l,n[i>>2]=a,n[e>>2]=0,r=a,a=l,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|r)<(0|a)?r:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=r-s,n[e>>2]=o-s)}function lt(t){var e,i,r=0,o=0,s=0,a=0,l=0;o=0|n[(e=8+(t|=0)|0)>>2],s=0|Ee(+(((r=(0|n[t>>2])-o|0)<<1)+(o=(0|n[(i=t+4|0)>>2])-o|0)|0)/7),n[t>>2]=s,r=0|Ee(+((3*o|0)-r|0)/7),n[i>>2]=r,n[e>>2]=0,o=r-s|0,(0|s)<0?(l=0-s|0,n[i>>2]=o,n[e>>2]=l,n[t>>2]=0,r=o,s=0,o=l):o=0,(0|r)<0&&(s=s-r|0,n[t>>2]=s,o=o-r|0,n[e>>2]=o,n[i>>2]=0,r=0),l=s-o|0,a=r-o|0,(0|o)<0?(n[t>>2]=l,n[i>>2]=a,n[e>>2]=0,r=a,a=l,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|r)<(0|a)?r:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=r-s,n[e>>2]=o-s)}function ct(t){var e,i,r,o=0,s=0,a=0,l=0;o=0|n[(t|=0)>>2],s=0|n[(i=t+4|0)>>2],a=0|n[(r=t+8|0)>>2],l=s+(3*o|0)|0,n[t>>2]=l,s=a+(3*s|0)|0,n[i>>2]=s,o=(3*a|0)+o|0,n[r>>2]=o,a=s-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=a,n[r>>2]=o,n[t>>2]=0,s=a,a=0):a=l,(0|s)<0&&(a=a-s|0,n[t>>2]=a,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=a-o|0,l=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=l,n[r>>2]=0,a=e,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=l-s,n[r>>2]=o-s)}function ut(t){var e,i,r,o=0,s=0,a=0,l=0;l=0|n[(t|=0)>>2],a=(3*(o=0|n[(i=t+4|0)>>2])|0)+l|0,l=(s=0|n[(r=t+8|0)>>2])+(3*l|0)|0,n[t>>2]=l,n[i>>2]=a,o=(3*s|0)+o|0,n[r>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=s,n[r>>2]=o,n[t>>2]=0,l=0):s=a,(0|s)<0&&(l=l-s|0,n[t>>2]=l,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=l-o|0,a=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=a,n[r>>2]=0,l=e,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|l)?a:l))?o:s))<=0||(n[t>>2]=l-s,n[i>>2]=a-s,n[r>>2]=o-s)}function ht(t,e){t|=0;var i,r,o,s=0,a=0,l=0;((e|=0)-1|0)>>>0>=6||(l=(0|n[15440+(12*e|0)>>2])+(0|n[t>>2])|0,n[t>>2]=l,o=t+4|0,a=(0|n[15440+(12*e|0)+4>>2])+(0|n[o>>2])|0,n[o>>2]=a,r=t+8|0,e=(0|n[15440+(12*e|0)+8>>2])+(0|n[r>>2])|0,n[r>>2]=e,s=a-l|0,(0|l)<0?(e=e-l|0,n[o>>2]=s,n[r>>2]=e,n[t>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,n[t>>2]=a,e=e-s|0,n[r>>2]=e,n[o>>2]=0,s=0),i=a-e|0,l=s-e|0,(0|e)<0?(n[t>>2]=i,n[o>>2]=l,n[r>>2]=0,a=i,e=0):l=s,(0|(s=(0|e)<(0|(s=(0|l)<(0|a)?l:a))?e:s))<=0||(n[t>>2]=a-s,n[o>>2]=l-s,n[r>>2]=e-s))}function pt(t){var e,i,r,o=0,s=0,a=0,l=0;l=0|n[(t|=0)>>2],a=(o=0|n[(i=t+4|0)>>2])+l|0,l=(s=0|n[(r=t+8|0)>>2])+l|0,n[t>>2]=l,n[i>>2]=a,o=s+o|0,n[r>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=s,n[r>>2]=o,n[t>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,n[t>>2]=a,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=a-o|0,l=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=l,n[r>>2]=0,a=e,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=l-s,n[r>>2]=o-s)}function dt(t){var e,i,r,o=0,s=0,a=0,l=0;o=0|n[(t|=0)>>2],a=0|n[(i=t+4|0)>>2],s=0|n[(r=t+8|0)>>2],l=a+o|0,n[t>>2]=l,a=s+a|0,n[i>>2]=a,o=s+o|0,n[r>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=s,n[r>>2]=o,n[t>>2]=0,a=0):(s=a,a=l),(0|s)<0&&(a=a-s|0,n[t>>2]=a,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=a-o|0,l=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=l,n[r>>2]=0,a=e,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=l-s,n[r>>2]=o-s)}function ft(t){switch(0|(t|=0)){case 1:t=5;break;case 5:t=4;break;case 4:t=6;break;case 6:t=2;break;case 2:t=3;break;case 3:t=1}return 0|t}function mt(t){switch(0|(t|=0)){case 1:t=3;break;case 3:t=2;break;case 2:t=6;break;case 6:t=4;break;case 4:t=5;break;case 5:t=1}return 0|t}function gt(t){var e,i,r,o=0,s=0,a=0,l=0;o=0|n[(t|=0)>>2],s=0|n[(i=t+4|0)>>2],a=0|n[(r=t+8|0)>>2],l=s+(o<<1)|0,n[t>>2]=l,s=a+(s<<1)|0,n[i>>2]=s,o=(a<<1)+o|0,n[r>>2]=o,a=s-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=a,n[r>>2]=o,n[t>>2]=0,s=a,a=0):a=l,(0|s)<0&&(a=a-s|0,n[t>>2]=a,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=a-o|0,l=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=l,n[r>>2]=0,a=e,o=0):l=s,(0|(s=(0|o)<(0|(s=(0|l)<(0|a)?l:a))?o:s))<=0||(n[t>>2]=a-s,n[i>>2]=l-s,n[r>>2]=o-s)}function _t(t){var e,i,r,o=0,s=0,a=0,l=0;l=0|n[(t|=0)>>2],a=((o=0|n[(i=t+4|0)>>2])<<1)+l|0,l=(s=0|n[(r=t+8|0)>>2])+(l<<1)|0,n[t>>2]=l,n[i>>2]=a,o=(s<<1)+o|0,n[r>>2]=o,s=a-l|0,(0|l)<0?(o=o-l|0,n[i>>2]=s,n[r>>2]=o,n[t>>2]=0,l=0):s=a,(0|s)<0&&(l=l-s|0,n[t>>2]=l,o=o-s|0,n[r>>2]=o,n[i>>2]=0,s=0),e=l-o|0,a=s-o|0,(0|o)<0?(n[t>>2]=e,n[i>>2]=a,n[r>>2]=0,l=e,o=0):a=s,(0|(s=(0|o)<(0|(s=(0|a)<(0|l)?a:l))?o:s))<=0||(n[t>>2]=l-s,n[i>>2]=a-s,n[r>>2]=o-s)}function yt(t,e){e|=0;var i,r,o,s=0,a=0,l=0;return o=(0|(r=(0|n[(t|=0)>>2])-(0|n[e>>2])|0))<0,i=(0|(a=(0|n[t+4>>2])-(0|n[e+4>>2])-(o?r:0)|0))<0,e=(e=(t=(0|(l=(o?0-r|0:0)+(0|n[t+8>>2])-(0|n[e+8>>2])+(i?0-a|0:0)|0))<0)?0:l)-((a=(0|(t=(0|e)<(0|(t=(0|(s=(i?0:a)-(t?l:0)|0))<(0|(l=(o?0:r)-(i?a:0)-(t?l:0)|0))?s:l))?e:t))>0)?t:0)|0,s=s-(a?t:0)|0,0|((0|(t=(0|(t=l-(a?t:0)|0))>-1?t:0-t|0))>(0|(e=(0|(s=(0|s)>-1?s:0-s|0))>(0|(e=(0|e)>-1?e:0-e|0))?s:e))?t:e)}function At(t,e){var i;e|=0,i=0|n[8+(t|=0)>>2],n[e>>2]=(0|n[t>>2])-i,n[e+4>>2]=(0|n[t+4>>2])-i}function vt(t,e){e|=0;var i,r,o,s=0,a=0,l=0;a=0|n[(t|=0)>>2],n[e>>2]=a,l=0|n[t+4>>2],n[(r=e+4|0)>>2]=l,n[(o=e+8|0)>>2]=0,t=(s=(0|l)<(0|a))?a:l,s=s?l:a;do{if((0|s)<0){if((0|t)>0){if((-2147483648|t)<(0|s)&-2147483648!=(0|s)&(2147483647-t|0)>=(0|s))break;return 1}if(-2147483648==(0|s)|(-2147483648-t|0)>(0|s))return 1;if((0|t)>-1){if((-2147483648|t)<(0|s))break;return 1}if(!((-2147483648^t)<(0|s)))break;return 1}}while(0);return t=l-a|0,(0|a)<0?(s=0-a|0,n[r>>2]=t,n[o>>2]=s,n[e>>2]=0,a=0):(t=l,s=0),(0|t)<0&&(a=a-t|0,n[e>>2]=a,s=s-t|0,n[o>>2]=s,n[r>>2]=0,t=0),i=a-s|0,l=t-s|0,(0|s)<0?(n[e>>2]=i,n[r>>2]=l,n[o>>2]=0,t=l,l=i,s=0):l=a,(0|(a=(0|s)<(0|(a=(0|t)<(0|l)?t:l))?s:a))<=0||(n[e>>2]=l-a,n[r>>2]=t-a,n[o>>2]=s-a),0}function xt(t){var e,i,r,o;i=(o=0|n[(e=8+(t|=0)|0)>>2])-(0|n[t>>2])|0,n[t>>2]=i,t=(0|n[(r=t+4|0)>>2])-o|0,n[r>>2]=t,n[e>>2]=0-(t+i)}function bt(t){var e,i,r=0,o=0,s=0,a=0,l=0;r=0-(o=0|n[(t|=0)>>2])|0,n[t>>2]=r,n[(e=t+8|0)>>2]=0,a=(s=0|n[(i=t+4|0)>>2])+o|0,(0|o)>0?(n[i>>2]=a,n[e>>2]=o,n[t>>2]=0,r=0,s=a):o=0,(0|s)<0?(l=r-s|0,n[t>>2]=l,o=o-s|0,n[e>>2]=o,n[i>>2]=0,a=l-o|0,r=0-o|0,(0|o)<0?(n[t>>2]=a,n[i>>2]=r,n[e>>2]=0,s=r,o=0):(s=0,a=l)):a=r,(0|(r=(0|o)<(0|(r=(0|s)<(0|a)?s:a))?o:r))<=0||(n[t>>2]=a-r,n[i>>2]=s-r,n[e>>2]=o-r)}function wt(t,e,i){i|=0;var r,o,s=0,a=0;return o=k,k=k+16|0,r=o,a=-2130706433&(e|=0)|134217728,!0&268435456==(2013265920&e)?(s=0|Ve(0|(t|=0),0|e,56),T(),s=0|function(t,e,i){i|=0;var r,o=0,s=0;if(r=k,k=k+16|0,s=r,o=0|Ft(t|=0,e|=0),(i+-1|0)>>>0>5)return k=r,-1;if(1==(0|i)&(o=!!(0|o)))return k=r,-1;do{if(!(0|Ae(t,e,s))){if(o){o=(5+(0|n[21936+(i<<2)>>2])-(0|n[s>>2])|0)%5|0;break}o=(6+(0|n[21968+(i<<2)>>2])-(0|n[s>>2])|0)%6|0;break}o=-1}while(0);return k=r,0|(s=o)}(t,a,7&s),-1==(0|s)?(n[i>>2]=0,k=o,0|(a=6)):(0|Wt(t,a,r)&&C(23313,22484,282,22499),e=0|Ve(0|t,0|e,52),T(),e&=15,0|Ft(t,a)?Mt(r,e,s,2,i):Pt(r,e,s,2,i),k=o,0|(a=0))):(k=o,0|(a=6))}function St(t,e,i,r){e|=0,r|=0;var s,a=0,l=0,c=0,u=0;if(s=k,k=k+16|0,function(t,e,i){e|=0,i|=0;var r,s,a=0;s=k,k=k+32|0,function(t,e){e|=0;var i,r,n=0;n=+o[(t|=0)>>3],i=+p(+n),n=+d(+n),o[e+16>>3]=n,n=+o[t+8>>3],r=i*+p(+n),o[e>>3]=r,n=i*+d(+n),o[e+8>>3]=n}(t|=0,r=s),n[e>>2]=0,o[i>>3]=5,(a=+ye(16400,r))<+o[i>>3]&&(n[e>>2]=0,o[i>>3]=a),(a=+ye(16424,r))<+o[i>>3]&&(n[e>>2]=1,o[i>>3]=a),(a=+ye(16448,r))<+o[i>>3]&&(n[e>>2]=2,o[i>>3]=a),(a=+ye(16472,r))<+o[i>>3]&&(n[e>>2]=3,o[i>>3]=a),(a=+ye(16496,r))<+o[i>>3]&&(n[e>>2]=4,o[i>>3]=a),(a=+ye(16520,r))<+o[i>>3]&&(n[e>>2]=5,o[i>>3]=a),(a=+ye(16544,r))<+o[i>>3]&&(n[e>>2]=6,o[i>>3]=a),(a=+ye(16568,r))<+o[i>>3]&&(n[e>>2]=7,o[i>>3]=a),(a=+ye(16592,r))<+o[i>>3]&&(n[e>>2]=8,o[i>>3]=a),(a=+ye(16616,r))<+o[i>>3]&&(n[e>>2]=9,o[i>>3]=a),(a=+ye(16640,r))<+o[i>>3]&&(n[e>>2]=10,o[i>>3]=a),(a=+ye(16664,r))<+o[i>>3]&&(n[e>>2]=11,o[i>>3]=a),(a=+ye(16688,r))<+o[i>>3]&&(n[e>>2]=12,o[i>>3]=a),(a=+ye(16712,r))<+o[i>>3]&&(n[e>>2]=13,o[i>>3]=a),(a=+ye(16736,r))<+o[i>>3]&&(n[e>>2]=14,o[i>>3]=a),(a=+ye(16760,r))<+o[i>>3]&&(n[e>>2]=15,o[i>>3]=a),(a=+ye(16784,r))<+o[i>>3]&&(n[e>>2]=16,o[i>>3]=a),(a=+ye(16808,r))<+o[i>>3]&&(n[e>>2]=17,o[i>>3]=a),(a=+ye(16832,r))<+o[i>>3]&&(n[e>>2]=18,o[i>>3]=a),(a=+ye(16856,r))<+o[i>>3]?(n[e>>2]=19,o[i>>3]=a,k=s):k=s}(t|=0,i|=0,u=s),(l=+m(+(1-.5*+o[u>>3])))<1e-16)return n[r>>2]=0,n[r+4>>2]=0,n[r+8>>2]=0,n[r+12>>2]=0,void(k=s);if(u=0|n[i>>2],a=+Xt((a=+o[15920+(24*u|0)>>3])-+Xt(+function(t,e){t|=0;var i,r,n,s,a;return s=+o[(e|=0)>>3],r=+p(+s),n=+o[e+8>>3]-+o[t+8>>3],a=r*+d(+n),i=+o[t>>3],+ +y(+a,+(+d(+s)*+p(+i)-+p(+n)*(r*+d(+i))))}(15600+(u<<4)|0,t))),c=0|Gt(e)?+Xt(a+-.3334731722518321):a,a=+f(+l)/.381966011250105,(0|e)>0){t=0;do{a*=2.6457513110645907,t=t+1|0}while((0|t)!=(0|e))}l=+p(+c)*a,o[r>>3]=l,c=+d(+c)*a,o[r+8>>3]=c,k=s}function Tt(t,e,i,r,s){e|=0,i|=0,r|=0,s|=0;var a=0,l=0;if(a=+function(t){var e,i;return i=+o[(t|=0)>>3],e=+o[t+8>>3],+ +u(+(i*i+e*e))}(t|=0),a<1e-16)return e=15600+(e<<4)|0,n[s>>2]=n[e>>2],n[s+4>>2]=n[e+4>>2],n[s+8>>2]=n[e+8>>2],void(n[s+12>>2]=n[e+12>>2]);if(l=+y(+ +o[t+8>>3],+ +o[t>>3]),(0|i)>0){t=0;do{a/=2.6457513110645907,t=t+1|0}while((0|t)!=(0|i))}r?(a/=3,i=!(0|Gt(i)),a=+_(.381966011250105*(i?a:a/2.6457513110645907))):(a=+_(.381966011250105*a),0|Gt(i)&&(l=+Xt(l+.3334731722518321))),function(t,e,i,r){t|=0,e=+e,r|=0;var s=0,a=0,l=0,u=0;if((i=+i)<1e-16)return n[r>>2]=n[t>>2],n[r+4>>2]=n[t+4>>2],n[r+8>>2]=n[t+8>>2],void(n[r+12>>2]=n[t+12>>2]);a=e<0?e+6.283185307179586:e,a=e>=6.283185307179586?a+-6.283185307179586:a;do{if(!(a<1e-16)){if(s=+c(+(a+-3.141592653589793))<1e-16,e=+o[t>>3],s){e-=i,o[r>>3]=e,s=r;break}if(l=+p(+i),i=+d(+i),e=l*+d(+e)+ +p(+a)*(i*+p(+e)),e=+g(+((e=e>1?1:e)<-1?-1:e)),o[r>>3]=e,+c(+(e+-1.5707963267948966))<1e-16)return o[r>>3]=1.5707963267948966,void(o[r+8>>3]=0);if(+c(+(e+1.5707963267948966))<1e-16)return o[r>>3]=-1.5707963267948966,void(o[r+8>>3]=0);if(u=+p(+e),a=i*+d(+a)/u,i=+o[t>>3],e=(l-+d(+e)*+d(+i))/+p(+i)/u,l=a>1?1:a,e=e>1?1:e,(e=+o[t+8>>3]+ +y(+(l<-1?-1:l),+(e<-1?-1:e)))>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);return void(o[r+8>>3]=e)}e=+o[t>>3]+i,o[r>>3]=e,s=r}while(0);if(+c(+(e+-1.5707963267948966))<1e-16)return o[s>>3]=1.5707963267948966,void(o[r+8>>3]=0);if(+c(+(e+1.5707963267948966))<1e-16)return o[s>>3]=-1.5707963267948966,void(o[r+8>>3]=0);if((e=+o[t+8>>3])>3.141592653589793)do{e+=-6.283185307179586}while(e>3.141592653589793);if(e<-3.141592653589793)do{e+=6.283185307179586}while(e<-3.141592653589793);o[r+8>>3]=e}(15600+(e<<4)|0,+Xt(+o[15920+(24*e|0)>>3]-l),a,s)}function Ct(t,e,i){var r,o;e|=0,i|=0,r=k,k=k+16|0,tt(4+(t|=0)|0,o=r),Tt(o,0|n[t>>2],e,0,i),k=r}function Mt(t,e,i,r,s){t|=0,e|=0,i|=0,r|=0,s|=0;var a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,M,E,I,L=0,P=0,N=0,D=0,O=0,R=0;if(I=k,k=k+272|0,D=I+240|0,T=I,M=I+224|0,E=I+208|0,_=I+176|0,y=I+160|0,A=I+192|0,v=I+144|0,x=I+128|0,b=I+112|0,w=I+96|0,S=I+80|0,n[(L=I+256|0)>>2]=e,n[D>>2]=n[t>>2],n[D+4>>2]=n[t+4>>2],n[D+8>>2]=n[t+8>>2],n[D+12>>2]=n[t+12>>2],Et(D,L,T),n[s>>2]=0,(0|(D=r+i+(5==(0|r)&1)|0))<=(0|i))k=I;else{l=M+4|0,c=_+4|0,u=i+5|0,h=16880+((a=0|n[L>>2])<<2)|0,p=16960+(a<<2)|0,d=x+8|0,f=b+8|0,m=w+8|0,g=E+4|0,N=i;t:for(;;){P=T+((0|N)%5<<4)|0,n[E>>2]=n[P>>2],n[E+4>>2]=n[P+4>>2],n[E+8>>2]=n[P+8>>2],n[E+12>>2]=n[P+12>>2];do{}while(2==(0|It(E,a,0,1)));if((0|N)>(0|i)&!!(0|Gt(e))){if(n[_>>2]=n[E>>2],n[_+4>>2]=n[E+4>>2],n[_+8>>2]=n[E+8>>2],n[_+12>>2]=n[E+12>>2],tt(l,y),r=0|n[_>>2],L=0|n[17040+(80*r|0)+(n[M>>2]<<2)>>2],n[_>>2]=n[18640+(80*r|0)+(20*L|0)>>2],(0|(P=0|n[18640+(80*r|0)+(20*L|0)+16>>2]))>0){t=0;do{pt(c),t=t+1|0}while((0|t)<(0|P))}switch(P=18640+(80*r|0)+(20*L|0)+4|0,n[A>>2]=n[P>>2],n[A+4>>2]=n[P+4>>2],n[A+8>>2]=n[P+8>>2],rt(A,3*(0|n[h>>2])|0),et(c,A,c),Q(c),tt(c,v),O=+(0|n[p>>2]),o[x>>3]=3*O,o[d>>3]=0,R=-1.5*O,o[b>>3]=R,o[f>>3]=2.598076211353316*O,o[w>>3]=R,o[m>>3]=-2.598076211353316*O,0|n[17040+(80*(0|n[_>>2])|0)+(n[E>>2]<<2)>>2]){case 1:t=b,r=x;break;case 3:t=w,r=b;break;case 2:t=x,r=w;break;default:t=12;break t}ge(y,v,r,t,S),Tt(S,0|n[_>>2],a,1,s+8+(n[s>>2]<<4)|0),n[s>>2]=1+(0|n[s>>2])}if((0|N)<(0|u)&&(tt(g,_),Tt(_,0|n[E>>2],a,1,s+8+(n[s>>2]<<4)|0),n[s>>2]=1+(0|n[s>>2])),n[M>>2]=n[E>>2],n[M+4>>2]=n[E+4>>2],n[M+8>>2]=n[E+8>>2],n[M+12>>2]=n[E+12>>2],(0|(N=N+1|0))>=(0|D)){t=3;break}}3!=(0|t)?12==(0|t)&&C(22522,22569,571,22579):k=I}}function Et(t,e,i){t|=0,e|=0,i|=0;var r,o=0,s=0,a=0,l=0,c=0;r=k,k=k+128|0,s=r,l=20240,c=60+(a=o=r+64|0)|0;do{n[a>>2]=n[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));l=20304,c=(a=s)+60|0;do{n[a>>2]=n[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));o=(c=!(0|Gt(0|n[e>>2])))?o:s,gt(s=t+4|0),_t(s),0|Gt(0|n[e>>2])&&(ut(s),n[e>>2]=1+(0|n[e>>2])),n[i>>2]=n[t>>2],et(s,o,e=i+4|0),Q(e),n[i+16>>2]=n[t>>2],et(s,o+12|0,e=i+20|0),Q(e),n[i+32>>2]=n[t>>2],et(s,o+24|0,e=i+36|0),Q(e),n[i+48>>2]=n[t>>2],et(s,o+36|0,e=i+52|0),Q(e),n[i+64>>2]=n[t>>2],et(s,o+48|0,i=i+68|0),Q(i),k=r}function It(t,e,i,r){i|=0,r|=0;var o,s,a,l,c,u,h=0,p=0,d=0,f=0,m=0;if(u=k,k=k+32|0,c=u+12|0,s=u,m=4+(t|=0)|0,f=0|n[16960+((e|=0)<<2)>>2],f=(l=!!(0|r))?3*f|0:f,h=0|n[m>>2],o=0|n[(a=t+8|0)>>2],l){if((0|(h=o+h+(r=0|n[(p=t+12|0)>>2])|0))==(0|f))return k=u,1;d=p}else h=o+h+(r=0|n[(d=t+12|0)>>2])|0;if((0|h)<=(0|f))return k=u,0;do{if((0|r)>0){if(r=0|n[t>>2],(0|o)>0){p=18640+(80*r|0)+60|0,r=t;break}r=18640+(80*r|0)+40|0,i?(Y(c,f,0,0),it(m,c,s),dt(s),et(s,c,m),p=r,r=t):(p=r,r=t)}else p=18640+(80*(0|n[t>>2])|0)+20|0,r=t}while(0);if(n[r>>2]=n[p>>2],(0|n[(h=p+16|0)>>2])>0){r=0;do{pt(m),r=r+1|0}while((0|r)<(0|n[h>>2]))}return t=p+4|0,n[c>>2]=n[t>>2],n[c+4>>2]=n[t+4>>2],n[c+8>>2]=n[t+8>>2],e=0|n[16880+(e<<2)>>2],rt(c,l?3*e|0:e),et(m,c,m),Q(m),r=l&&((0|n[a>>2])+(0|n[m>>2])+(0|n[d>>2])|0)==(0|f)?1:2,k=u,0|r}function Lt(t,e){t|=0,e|=0;var i=0;do{i=0|It(t,e,0,1)}while(2==(0|i));return 0|i}function Pt(t,e,i,r,s){t|=0,e|=0,i|=0,r|=0,s|=0;var a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T=0,M=0,E=0,I=0,L=0;if(S=k,k=k+240|0,v=S+208|0,x=S,b=S+192|0,w=S+176|0,m=S+160|0,g=S+144|0,_=S+128|0,y=S+112|0,A=S+96|0,n[(T=S+224|0)>>2]=e,n[v>>2]=n[t>>2],n[v+4>>2]=n[t+4>>2],n[v+8>>2]=n[t+8>>2],n[v+12>>2]=n[t+12>>2],kt(v,T,x),n[s>>2]=0,(0|(f=r+i+(6==(0|r)&1)|0))<=(0|i))k=S;else{l=i+6|0,c=16960+((a=0|n[T>>2])<<2)|0,u=g+8|0,h=_+8|0,p=y+8|0,d=b+4|0,M=0,E=i,r=-1;t:for(;;){if(t=x+((T=(0|E)%6|0)<<4)|0,n[b>>2]=n[t>>2],n[b+4>>2]=n[t+4>>2],n[b+8>>2]=n[t+8>>2],n[b+12>>2]=n[t+12>>2],t=M,M=0|It(b,a,0,1),(0|E)>(0|i)&!!(0|Gt(e))&&1!=(0|t)&&(0|n[b>>2])!=(0|r)){switch(tt(x+((T+5|0)%6<<4)+4|0,w),tt(x+(T<<4)+4|0,m),I=+(0|n[c>>2]),o[g>>3]=3*I,o[u>>3]=0,L=-1.5*I,o[_>>3]=L,o[h>>3]=2.598076211353316*I,o[y>>3]=L,o[p>>3]=-2.598076211353316*I,T=0|n[v>>2],0|n[17040+(80*T|0)+(((0|r)==(0|T)?n[b>>2]:r)<<2)>>2]){case 1:t=_,r=g;break;case 3:t=y,r=_;break;case 2:t=g,r=y;break;default:t=8;break t}ge(w,m,r,t,A),0|_e(w,A)||0|_e(m,A)||(Tt(A,0|n[v>>2],a,1,s+8+(n[s>>2]<<4)|0),n[s>>2]=1+(0|n[s>>2]))}if((0|E)<(0|l)&&(tt(d,w),Tt(w,0|n[b>>2],a,1,s+8+(n[s>>2]<<4)|0),n[s>>2]=1+(0|n[s>>2])),(0|(E=E+1|0))>=(0|f)){t=3;break}r=0|n[b>>2]}3!=(0|t)?8==(0|t)&&C(22606,22569,736,22651):k=S}}function kt(t,e,i){t|=0,e|=0,i|=0;var r,o=0,s=0,a=0,l=0,c=0;r=k,k=k+160|0,s=r,l=20368,c=72+(a=o=r+80|0)|0;do{n[a>>2]=n[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));l=20448,c=(a=s)+72|0;do{n[a>>2]=n[l>>2],a=a+4|0,l=l+4|0}while((0|a)<(0|c));o=(c=!(0|Gt(0|n[e>>2])))?o:s,gt(s=t+4|0),_t(s),0|Gt(0|n[e>>2])&&(ut(s),n[e>>2]=1+(0|n[e>>2])),n[i>>2]=n[t>>2],et(s,o,e=i+4|0),Q(e),n[i+16>>2]=n[t>>2],et(s,o+12|0,e=i+20|0),Q(e),n[i+32>>2]=n[t>>2],et(s,o+24|0,e=i+36|0),Q(e),n[i+48>>2]=n[t>>2],et(s,o+36|0,e=i+52|0),Q(e),n[i+64>>2]=n[t>>2],et(s,o+48|0,e=i+68|0),Q(e),n[i+80>>2]=n[t>>2],et(s,o+60|0,i=i+84|0),Q(i),k=r}function Nt(t,e){return e=0|Ve(0|(t|=0),0|(e|=0),45),T(),127&e}function Dt(t,e){var i=0,r=0,n=0,o=0,s=0,a=0;if(!(!0&134217728==(-16777216&(e|=0))))return 0;if(s=0|Ve(0|(t|=0),0|e,45),T(),(s&=127)>>>0>121)return 0;i=0|Ve(0|t,0|e,52),T(),i&=15;do{if(0|i){for(n=1,r=0;;){if(o=0|Ve(0|t,0|e,3*(15-n|0)|0),T(),!!(0|(o&=7))&(1^r)){if(1==(0|o)&!!(0|U(s))){a=0,r=13;break}r=1}if(7==(0|o)){a=0,r=13;break}if(!(n>>>0<i>>>0)){r=9;break}n=n+1|0}if(9==(0|r)){if(15!=(0|i))break;return 1}if(13==(0|r))return 0|a}}while(0);for(;;){if(a=0|Ve(0|t,0|e,3*(14-i|0)|0),T(),!(!0&!(7&~a))){a=0,r=13;break}if(!(i>>>0<14)){a=1,r=13;break}i=i+1|0}return 13==(0|r)?0|a:0}function Ot(t,e,i,r){i|=0,r|=0;var o=0,s=0;if(s=0|Ve(0|(t|=0),0|(e|=0),52),T(),i>>>0>15)return 4;if((0|(s&=15))<(0|i))return 12;if((0|s)==(0|i))return n[r>>2]=t,n[r+4>>2]=e,0;if(o=0|je(0|i,0,52),o|=t,t=T()|-15728641&e,(0|s)>(0|i))do{e=0|je(7,0,3*(14-i|0)|0),i=i+1|0,o|=e,t=T()|t}while((0|i)<(0|s));return n[r>>2]=o,n[r+4>>2]=t,0}function Rt(t,e,i,r){i|=0,r|=0;var o=0,s=0,a=0;if(s=0|Ve(0|(t|=0),0|(e|=0),52),T(),!((0|i)<16&(0|(s&=15))<=(0|i)))return 4;o=i-s|0,i=0|Ve(0|t,0|e,45),T();t:do{if(0|U(127&i)){e:do{if(0|s){for(i=1;!((a=0|je(7,0,3*(15-i|0)|0))&t)&!(T()&e);){if(!(i>>>0<s>>>0))break e;i=i+1|0}i=0|he(7,0,o,((0|o)<0)<<31>>31),o=0|T();break t}}while(0);i=0|ke(0|(i=0|Fe(0|(i=0|he(7,0,o,((0|o)<0)<<31>>31)),0|T(),5,0)),0|T(),-5,-1),i=0|ke(0|(i=0|Re(0|i,0|T(),6,0)),0|T(),1,0),o=0|T()}else i=0|he(7,0,o,((0|o)<0)<<31>>31),o=0|T()}while(0);return n[(a=r)>>2]=i,n[a+4>>2]=o,0}function Ft(t,e){var i=0,r=0,n=0;if(n=0|Ve(0|(t|=0),0|(e|=0),45),T(),!(0|U(127&n)))return 0;n=0|Ve(0|t,0|e,52),T(),n&=15;t:do{if(n)for(r=1;;){if(i=0|Ve(0|t,0|e,3*(15-r|0)|0),T(),0|(i&=7))break t;if(!(r>>>0<n>>>0)){i=0;break}r=r+1|0}else i=0}while(0);return 1&!(0|i)}function zt(t,e){var i=0,r=0,n=0;if(n=0|Ve(0|(t|=0),0|(e|=0),52),T(),!(n&=15))return 0;for(r=1;;){if(i=0|Ve(0|t,0|e,3*(15-r|0)|0),T(),0|(i&=7)){r=5;break}if(!(r>>>0<n>>>0)){i=0,r=5;break}r=r+1|0}return 5==(0|r)?0|i:0}function Bt(t,e){var i=0,r=0,n=0,o=0,s=0,a=0,l=0;if(l=0|Ve(0|(t|=0),0|(e|=0),52),T(),!(l&=15))return l=t,S(0|(a=e)),0|l;for(a=1,i=0;;){r=0|je(7,0,0|(o=3*(15-a|0)|0)),n=0|T(),s=0|Ve(0|t,0|e,0|o),T(),t=(o=0|je(0|ft(7&s),0,0|o))|t&~r,e=(s=0|T())|e&~n;t:do{if(!i)if(!(o&r)&!(s&n))i=0;else if(r=0|Ve(0|t,0|e,52),T(),r&=15){i=1;e:for(;;){switch(s=0|Ve(0|t,0|e,3*(15-i|0)|0),T(),7&s){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<r>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(n=0|Ve(0|t,0|e,0|(s=3*(15-i|0)|0)),T(),o=0|je(7,0,0|s),e&=~T(),t=t&~o|(s=0|je(0|ft(7&n),0,0|s)),e|=T(),!(i>>>0<r>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return S(0|e),0|t}function Ut(t,e){var i=0,r=0,n=0,o=0,s=0;if(r=0|Ve(0|(t|=0),0|(e|=0),52),T(),!(r&=15))return r=t,S(0|(i=e)),0|r;for(i=1;s=0|Ve(0|t,0|e,0|(o=3*(15-i|0)|0)),T(),n=0|je(7,0,0|o),e&=~T(),t=(o=0|je(0|ft(7&s),0,0|o))|t&~n,e=T()|e,i>>>0<r>>>0;)i=i+1|0;return S(0|e),0|t}function Vt(t,e){var i=0,r=0,n=0,o=0,s=0,a=0,l=0;if(l=0|Ve(0|(t|=0),0|(e|=0),52),T(),!(l&=15))return l=t,S(0|(a=e)),0|l;for(a=1,i=0;;){r=0|je(7,0,0|(o=3*(15-a|0)|0)),n=0|T(),s=0|Ve(0|t,0|e,0|o),T(),t=(o=0|je(0|mt(7&s),0,0|o))|t&~r,e=(s=0|T())|e&~n;t:do{if(!i)if(!(o&r)&!(s&n))i=0;else if(r=0|Ve(0|t,0|e,52),T(),r&=15){i=1;e:for(;;){switch(s=0|Ve(0|t,0|e,3*(15-i|0)|0),T(),7&s){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<r>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(o=0|je(7,0,0|(n=3*(15-i|0)|0)),s=e&~T(),e=0|Ve(0|t,0|e,0|n),T(),t=t&~o|(e=0|je(0|mt(7&e),0,0|n)),e=s|T(),!(i>>>0<r>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return S(0|e),0|t}function jt(t,e){var i=0,r=0,n=0,o=0,s=0;if(r=0|Ve(0|(t|=0),0|(e|=0),52),T(),!(r&=15))return r=t,S(0|(i=e)),0|r;for(i=1;o=0|je(7,0,0|(s=3*(15-i|0)|0)),n=e&~T(),e=0|Ve(0|t,0|e,0|s),T(),t=(e=0|je(0|mt(7&e),0,0|s))|t&~o,e=T()|n,i>>>0<r>>>0;)i=i+1|0;return S(0|e),0|t}function Gt(t){return(0|(t|=0))%2|0}function Zt(t,e,i){i|=0;var r,o=0;return r=k,k=k+16|0,o=r,(e|=0)>>>0>15?(k=r,0|(o=4)):2146435072&~n[4+(t|=0)>>2]&&2146435072&~n[t+8+4>>2]?(function(t,e,i){var r,n;r=k,k=k+16|0,St(t|=0,e|=0,i|=0,n=r),X(n,i+4|0),k=r}(t,e,o),e=0|function(t,e){t|=0;var i,r=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0;if(i=k,k=k+64|0,c=i+40|0,o=i+24|0,s=i+12|0,a=i,je(0|(e|=0),0,52),r=134225919|T(),!e)return(0|n[t+4>>2])>2||(0|n[t+8>>2])>2||(0|n[t+12>>2])>2?(c=0,S(0|(l=0)),k=i,0|c):(je(0|j(t),0,45),l=T()|r,c=-1,S(0|l),k=i,0|c);if(n[c>>2]=n[t>>2],n[c+4>>2]=n[t+4>>2],n[c+8>>2]=n[t+8>>2],n[c+12>>2]=n[t+12>>2],l=c+4|0,(0|e)>0)for(t=-1;n[o>>2]=n[l>>2],n[o+4>>2]=n[l+4>>2],n[o+8>>2]=n[l+8>>2],1&e?(at(l),n[s>>2]=n[l>>2],n[s+4>>2]=n[l+4>>2],n[s+8>>2]=n[l+8>>2],ct(s)):(lt(l),n[s>>2]=n[l>>2],n[s+4>>2]=n[l+4>>2],n[s+8>>2]=n[l+8>>2],ut(s)),it(o,s,a),Q(a),u=0|je(7,0,0|(h=3*(15-e|0)|0)),r&=~T(),t=(h=0|je(0|nt(a),0,0|h))|t&~u,r=T()|r,(0|e)>1;)e=e+-1|0;else t=-1;t:do{if((0|n[l>>2])<=2&&(0|n[c+8>>2])<=2&&(0|n[c+12>>2])<=2){if(e=0|je(0|(o=0|j(c)),0,45),e|=t,t=T()|-1040385&r,a=0|G(c),!(0|U(o))){if((0|a)<=0)break;for(s=0;;){if(o=0|Ve(0|e,0|t,52),T(),o&=15)for(r=1;c=0|Ve(0|e,0|t,0|(h=3*(15-r|0)|0)),T(),u=0|je(7,0,0|h),t&=~T(),e=e&~u|(h=0|je(0|ft(7&c),0,0|h)),t|=T(),r>>>0<o>>>0;)r=r+1|0;if((0|(s=s+1|0))==(0|a))break t}}s=0|Ve(0|e,0|t,52),T(),s&=15;e:do{if(s){r=1;i:for(;;){switch(h=0|Ve(0|e,0|t,3*(15-r|0)|0),T(),7&h){case 1:break i;case 0:break;default:break e}if(!(r>>>0<s>>>0))break e;r=r+1|0}if(0|Z(o,0|n[c>>2]))for(r=1;u=0|je(7,0,0|(c=3*(15-r|0)|0)),h=t&~T(),t=0|Ve(0|e,0|t,0|c),T(),e=e&~u|(t=0|je(0|mt(7&t),0,0|c)),t=h|T(),r>>>0<s>>>0;)r=r+1|0;else for(r=1;c=0|Ve(0|e,0|t,0|(h=3*(15-r|0)|0)),T(),u=0|je(7,0,0|h),t&=~T(),e=e&~u|(h=0|je(0|ft(7&c),0,0|h)),t|=T(),r>>>0<s>>>0;)r=r+1|0}}while(0);if((0|a)>0){r=0;do{e=0|Bt(e,t),t=0|T(),r=r+1|0}while((0|r)!=(0|a))}}else e=0,t=0}while(0);return h=e,S(0|(u=t)),k=i,0|h}(o,e),o=0|T(),n[i>>2]=e,n[i+4>>2]=o,!(0|e)&!(0|o)&&C(23313,22674,786,22697),k=r,0|(o=0)):(k=r,0|(o=3))}function qt(t,e,i){var r,o=0,s=0,a=0;if(r=4+(i|=0)|0,s=0|Ve(0|(t|=0),0|(e|=0),52),T(),s&=15,a=0|Ve(0|t,0|e,45),T(),o=!(0|s),0|U(127&a)){if(o)return 1;o=1}else{if(o)return 0;o=0|n[r>>2]||0|n[i+8>>2]?1:1&!!(0|n[i+12>>2])}for(i=1;1&i?ct(r):ut(r),a=0|Ve(0|t,0|e,3*(15-i|0)|0),T(),ht(r,7&a),i>>>0<s>>>0;)i=i+1|0;return 0|o}function Wt(t,e,i){i|=0;var r,o,s=0,a=0,l=0,c=0,u=0,h=0;if(o=k,k=k+16|0,r=o,h=0|Ve(0|(t|=0),0|(e|=0),45),T(),(h&=127)>>>0>121)return n[i>>2]=0,n[i+4>>2]=0,n[i+8>>2]=0,n[i+12>>2]=0,k=o,5;t:do{if(0|U(h)&&(l=0|Ve(0|t,0|e,52),T(),0|(l&=15))){s=1;e:for(;;){switch(u=0|Ve(0|t,0|e,3*(15-s|0)|0),T(),7&u){case 5:break e;case 0:break;default:s=e;break t}if(!(s>>>0<l>>>0)){s=e;break t}s=s+1|0}for(a=1,s=e;c=0|je(7,0,0|(e=3*(15-a|0)|0)),u=s&~T(),s=0|Ve(0|t,0|s,0|e),T(),t=t&~c|(s=0|je(0|mt(7&s),0,0|e)),s=u|T(),a>>>0<l>>>0;)a=a+1|0}else s=e}while(0);if(u=7696+(28*h|0)|0,n[i>>2]=n[u>>2],n[i+4>>2]=n[u+4>>2],n[i+8>>2]=n[u+8>>2],n[i+12>>2]=n[u+12>>2],!(0|qt(t,s,i)))return k=o,0;if(c=i+4|0,n[r>>2]=n[c>>2],n[r+4>>2]=n[c+4>>2],n[r+8>>2]=n[c+8>>2],l=0|Ve(0|t,0|s,52),T(),u=15&l,1&l?(ut(c),l=u+1|0):l=u,0|U(h)){t:do{if(u)for(e=1;;){if(a=0|Ve(0|t,0|s,3*(15-e|0)|0),T(),0|(a&=7)){s=a;break t}if(!(e>>>0<u>>>0)){s=0;break}e=e+1|0}else s=0}while(0);s=4==(0|s)&1}else s=0;if(0|It(i,l,s,0)){if(0|U(h))do{}while(0|It(i,l,0,0));(0|l)!=(0|u)&&lt(c)}else(0|l)!=(0|u)&&(n[c>>2]=n[r>>2],n[c+4>>2]=n[r+4>>2],n[c+8>>2]=n[r+8>>2]);return k=o,0}function Ht(t,e,i){i|=0;var r,n,o=0;return n=k,k=k+16|0,0|(o=0|Wt(t|=0,e|=0,r=n))?(k=n,0|o):(o=0|Ve(0|t,0|e,52),T(),Ct(r,15&o,i),k=n,0|(o=0))}function Jt(t,e,i){i|=0;var r,n=0,o=0,s=0;if(r=k,k=k+16|0,0|(n=0|Wt(t|=0,e|=0,s=r)))return k=r,0|n;n=0|Ve(0|t,0|e,45),T(),n=!(0|U(127&n)),o=0|Ve(0|t,0|e,52),T(),o&=15;t:do{if(!n){if(0|o)for(n=1;;){if(!(!(je(7,0,3*(15-n|0)|0)&t)&!(T()&e)))break t;if(!(n>>>0<o>>>0))break;n=n+1|0}return Mt(s,o,0,5,i),k=r,0}}while(0);return Pt(s,o,0,6,i),k=r,0}function Kt(t,e){e|=0;var i=0,r=0,o=0,s=0,a=0,l=0,c=0;if((t|=0)>>>0>15)return 4;if(je(0|t,0,52),l=134225919|T(),!t){i=0,r=0;do{0|U(r)&&(je(0|r,0,45),a=l|T(),n[(t=e+(i<<3)|0)>>2]=-1,n[t+4>>2]=a,i=i+1|0),r=r+1|0}while(122!=(0|r));return 0}i=0,a=0;do{if(0|U(a)){for(je(0|a,0,45),r=1,o=-1,s=l|T();o&=~(c=0|je(7,0,3*(15-r|0)|0)),s&=~T(),(0|r)!=(0|t);)r=r+1|0;n[(c=e+(i<<3)|0)>>2]=o,n[c+4>>2]=s,i=i+1|0}a=a+1|0}while(122!=(0|a));return 0}function $t(t,e,i,r){t|=0,r|=0;var o=0,s=0;o=0|Ve(0|(e|=0),0|(i|=0),52),T(),!(0|e)&!(0|i)|(0|r)>15|(0|(o&=15))>(0|r)?(r=-1,o=-1,e=0,i=0):(s=0|function(t,e,i,r){return t|=0,e|=0,(0|(r|=0))<(0|(i|=0))?(r=t,S(0|(i=e)),0|r):(i=0|je(-1,-1,3+(3*(r-i|0)|0)|0),r=0|je(0|~i,0|~T(),3*(15-r|0)|0),i=~T()&e,r=~r&t,S(0|i),0|r)}(e,i,o+1|0,r),i=-15728641&T(),e=0|je(0|r,0,52),r=(s=!(0|Ft(e|=s,i|=T())))?-1:r),n[(s=t)>>2]=e,n[s+4>>2]=i,n[t+8>>2]=o,n[t+12>>2]=r}function Yt(t){var e,i=0,r=0,o=0,s=0,a=0,l=0,c=0,u=0;if(!(!(0|(i=0|n[(r=t|=0)>>2]))&!(0|(r=0|n[r+4>>2]))||(o=0|Ve(0|i,0|r,52),T(),i=0|ke(0|(c=0|je(1,0,3*(15^(o&=15))|0)),0|T(),0|i,0|r),r=0|T(),n[(c=t)>>2]=i,n[c+4>>2]=r,(0|o)<(0|(l=0|n[(c=t+8|0)>>2]))))){for(e=t+12|0,a=o;;){if((0|a)==(0|l)){o=5;break}if(u=(0|a)==(0|n[e>>2]),o=0|Ve(0|i,0|r,0|(s=3*(15-a|0)|0)),T(),u&1==(0|(o&=7))&!0){o=7;break}if(!(7==(0|o)&!0)){o=10;break}if(i=0|ke(0|i,0|r,0|(u=0|je(1,0,0|s)),0|T()),r=0|T(),n[(u=t)>>2]=i,n[u+4>>2]=r,!((0|a)>(0|l))){o=10;break}a=a+-1|0}if(5==(0|o))return n[(u=t)>>2]=0,n[u+4>>2]=0,n[c>>2]=-1,void(n[e>>2]=-1);if(7==(0|o))return l=0|ke(0|i,0|r,0|(l=0|je(1,0,0|s)),0|T()),c=0|T(),n[(u=t)>>2]=l,n[u+4>>2]=c,void(n[e>>2]=a+-1)}}function Xt(t){var e;return e=(t=+t)<0?t+6.283185307179586:t,+(t>=6.283185307179586?e+-6.283185307179586:e)}function Qt(t,e){return e|=0,+c(+(+o[(t|=0)>>3]-+o[e>>3]))<17453292519943298e-27?0|(e=+c(+(+o[t+8>>3]-+o[e+8>>3]))<17453292519943298e-27):0|(e=0)}function te(t,e){t|=0;var i,r,n,s=0;return r=+o[(e|=0)>>3],i=+o[t>>3],s=(n=+d(.5*(r-i)))*n+(s=+d(.5*(+o[e+8>>3]-+o[t+8>>3])))*(+p(+r)*+p(+i)*s),2*+y(+ +u(+s),+ +u(+(1-s)))*6371.007180918475}function ee(t,e){e|=0;var i=0;return(t|=0)>>>0>15?0|(e=4):(i=0|Fe(0|(i=0|he(7,0,t,((0|t)<0)<<31>>31)),0|T(),120,0),t=0|T(),n[e>>2]=2|i,n[e+4>>2]=t,0|(e=0))}function ie(t,e,i){t|=0,i|=0;var r,n,s,a,l=0,c=0,h=0,m=0,g=0,A=0;return A=+o[(e|=0)>>3],s=+o[t>>3],g=+d(.5*(A-s)),h=+o[e+8>>3],n=+o[t+8>>3],m=+d(.5*(h-n)),r=+p(+s),a=+p(+A),m=2*+y(+ +u(+(m=g*g+m*(a*r*m))),+ +u(+(1-m))),g=+o[i>>3],A=+d(.5*(g-A)),l=+o[i+8>>3],h=+d(.5*(l-h)),c=+p(+g),h=2*+y(+ +u(+(h=A*A+h*(a*c*h))),+ +u(+(1-h))),g=+d(.5*(s-g)),l=+d(.5*(n-l)),l=2*+y(+ +u(+(l=g*g+l*(r*c*l))),+ +u(+(1-l))),4*+_(+ +u(+ +f(.5*(c=.5*(m+h+l)))*+f(.5*(c-m))*+f(.5*(c-h))*+f(.5*(c-l))))}function re(t,e,i){i|=0;var r,s,a,l=0,c=0;if(a=k,k=k+192|0,s=a,0|(c=0|Ht(t|=0,e|=0,r=a+168|0)))return k=a,0|c;if(0|Jt(t,e,s)&&C(23313,22742,386,22751),(0|(e=0|n[s>>2]))>0){if(l=+ie(s+8|0,s+8+((1!=(0|e)&1)<<4)|0,r)+0,1!=(0|e)){t=1;do{l+=+ie(s+8+((c=t)<<4)|0,s+8+((0|(t=t+1|0))%(0|e)<<4)|0,r)}while((0|t)<(0|e))}}else l=0;return o[i>>3]=l,k=a,0}function ne(t){t|=0;var e,i,r=0;return(e=0|Pe(1,12))||C(22832,22787,49,22845),0|(r=0|n[(i=t+4|0)>>2])?(n[(r=r+8|0)>>2]=e,n[i>>2]=e,0|e):(0|n[t>>2]&&C(22862,22787,61,22885),n[(r=t)>>2]=e,n[i>>2]=e,0|e)}function oe(t,e){var i,r;return t|=0,e|=0,(r=0|Ie(24))||C(22899,22787,78,22913),n[r>>2]=n[e>>2],n[r+4>>2]=n[e+4>>2],n[r+8>>2]=n[e+8>>2],n[r+12>>2]=n[e+12>>2],n[r+16>>2]=0,0|(i=0|n[(e=t+4|0)>>2])?(n[i+16>>2]=r,n[e>>2]=r,0|r):(0|n[t>>2]&&C(22928,22787,82,22913),n[t>>2]=r,n[e>>2]=r,0|r)}function se(t){var e=0,i=0,r=0,o=0;if(t|=0)for(r=1;;){if(0|(e=0|n[t>>2]))do{if(0|(i=0|n[e>>2]))do{o=i,i=0|n[i+16>>2],Le(o)}while(0|i);o=e,e=0|n[e+8>>2],Le(o)}while(0|e);if(e=t,t=0|n[t+8>>2],r||Le(e),!t)break;r=0}}function ae(t){var e,i,r=0,s=0,a=0,l=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,T=0,M=0,E=0,I=0,L=0,P=0,k=0,N=0,D=0,O=0,R=0;if(0|n[(l=8+(t|=0)|0)>>2])return 1;if(!(a=0|n[t>>2]))return 0;r=a,s=0;do{s=s+1|0,r=0|n[r+8>>2]}while(0|r);if(s>>>0<2)return 0;(i=0|Ie(s<<2))||C(22948,22787,317,22967),(e=0|Ie(s<<5))||C(22989,22787,321,22967),n[t>>2]=0,n[(E=t+4|0)>>2]=0,n[l>>2]=0,s=0,D=0,M=0,g=0;t:for(;;){if(m=0|n[a>>2]){u=0,h=m;do{if(d=+o[h+8>>3],r=h,h=0|n[h+16>>2],p=+o[(l=(f=!(0|h))?m:h)+8>>3],+c(+(d-p))>3.141592653589793){R=14;break}u+=(p-d)*(+o[r>>3]+ +o[l>>3])}while(!f);if(14==(0|R)){R=0,u=0,r=m;do{T=+o[r+8>>3],k=0|n[(N=r+16|0)>>2],S=+o[(k=0|k?k:m)+8>>3],u+=(+o[r>>3]+ +o[k>>3])*((S<0?S+6.283185307179586:S)-(T<0?T+6.283185307179586:T)),r=0|n[(0|r?N:a)>>2]}while(0|r)}u>0?(n[i+(D<<2)>>2]=a,D=D+1|0,l=M,r=g):R=19}else R=19;if(19==(0|R)){R=0;do{if(!s){if(g){l=E,h=g+8|0,r=a,s=t;break}if(0|n[t>>2]){R=27;break t}l=E,h=t,r=a,s=t;break}if(0|n[(r=s+8|0)>>2]){R=21;break t}if(!(s=0|Pe(1,12))){R=23;break t}n[r>>2]=s,l=s+4|0,h=s,r=g}while(0);if(n[h>>2]=a,n[l>>2]=a,h=e+(M<<5)|0,f=0|n[a>>2]){for(o[(m=e+(M<<5)+8|0)>>3]=17976931348623157e292,o[(g=e+(M<<5)+24|0)>>3]=17976931348623157e292,o[h>>3]=-17976931348623157e292,o[(_=e+(M<<5)+16|0)>>3]=-17976931348623157e292,b=17976931348623157e292,w=-17976931348623157e292,l=0,y=f,d=17976931348623157e292,v=17976931348623157e292,x=-17976931348623157e292,p=-17976931348623157e292;u=+o[y>>3],T=+o[y+8>>3],y=0|n[y+16>>2],S=+o[((A=!(0|y))?f:y)+8>>3],u<d&&(o[m>>3]=u,d=u),T<v&&(o[g>>3]=T,v=T),u>x?o[h>>3]=u:u=x,T>p&&(o[_>>3]=T,p=T),b=T>0&T<b?T:b,w=T<0&T>w?T:w,l|=+c(+(T-S))>3.141592653589793,!A;)x=u;l&&(o[_>>3]=w,o[g>>3]=b)}else n[h>>2]=0,n[h+4>>2]=0,n[h+8>>2]=0,n[h+12>>2]=0,n[h+16>>2]=0,n[h+20>>2]=0,n[h+24>>2]=0,n[h+28>>2]=0;l=M+1|0}if(a=0|n[(N=a+8|0)>>2],n[N>>2]=0,!a){R=45;break}M=l,g=r}if(21==(0|R))C(22765,22787,35,22799);else if(23==(0|R))C(22819,22787,37,22799);else if(27==(0|R))C(22862,22787,61,22885);else if(45==(0|R)){t:do{if((0|D)>0){for(N=!(0|l),P=l<<2,k=!(0|t),L=0,r=0;;){if(I=0|n[i+(L<<2)>>2],N)R=73;else{if(!(M=0|Ie(P))){R=50;break}if(!(E=0|Ie(P))){R=52;break}e:do{if(k)s=0;else{for(l=0,s=0,h=t;a=e+(l<<5)|0,0|le(0|n[h>>2],a,0|n[I>>2])?(n[M+(s<<2)>>2]=h,n[E+(s<<2)>>2]=a,A=s+1|0):A=s,h=0|n[h+8>>2];)l=l+1|0,s=A;if((0|A)>0)if(a=0|n[M>>2],1==(0|A))s=a;else for(_=0,y=-1,s=a,g=a;;){for(f=0|n[g>>2],a=0,h=0;m=(0|(l=0|n[n[M+(h<<2)>>2]>>2]))==(0|f)?a:a+(1&le(l,0|n[E+(h<<2)>>2],0|n[f>>2]))|0,(0|(h=h+1|0))!=(0|A);)a=m;if(s=(l=(0|m)>(0|y))?g:s,(0|(a=_+1|0))==(0|A))break e;_=a,y=l?m:y,g=0|n[M+(a<<2)>>2]}else s=0}}while(0);if(Le(M),Le(E),s){if(a=0|n[(l=s+4|0)>>2])s=a+8|0;else if(0|n[s>>2]){R=70;break}n[s>>2]=I,n[l>>2]=I}else R=73}if(73==(0|R)){if(R=0,0|(r=0|n[I>>2]))do{E=r,r=0|n[r+16>>2],Le(E)}while(0|r);Le(I),r=1}if((0|(L=L+1|0))>=(0|D)){O=r;break t}}50==(0|R)?C(23004,22787,249,23023):52==(0|R)?C(23042,22787,252,23023):70==(0|R)&&C(22862,22787,61,22885)}else O=0}while(0);return Le(i),Le(e),0|O}return 0}function le(t,e,i){t|=0;var r=0,s=0,a=0,l=0,c=0,u=0,h=0,p=0;if(!(0|J(e|=0,i|=0)))return 0;if(e=0|H(e),r=+o[i>>3],s=e&(s=+o[i+8>>3])<0?s+6.283185307179586:s,!(t=0|n[t>>2]))return 0;if(e){e=0,h=s,i=t;t:for(;;){for(;l=+o[i>>3],s=+o[i+8>>3],p=0|n[(i=i+16|0)>>2],a=+o[(p=0|p?p:t)>>3],c=+o[p+8>>3],l>a?(u=l,l=c):(u=a,a=l,l=s,s=c),(r=r==a|r==u?r+2220446049250313e-31:r)<a|r>u;)if(!(i=0|n[i>>2])){i=22;break t}if(((u=(c=l<0?l+6.283185307179586:l)+(r-a)/(u-a)*((l=s<0?s+6.283185307179586:s)-c))<0?u+6.283185307179586:u)>(h=c==h|l==h?h+-2220446049250313e-31:h)&&(e^=1),!(i=0|n[i>>2])){i=22;break}}if(22==(0|i))return 0|e}else{e=0,h=s,i=t;t:for(;;){for(;l=+o[i>>3],s=+o[i+8>>3],p=0|n[(i=i+16|0)>>2],a=+o[(p=0|p?p:t)>>3],c=+o[p+8>>3],l>a?(u=l,l=c):(u=a,a=l,l=s,s=c),(r=r==a|r==u?r+2220446049250313e-31:r)<a|r>u;)if(!(i=0|n[i>>2])){i=22;break t}if(l+(r-a)/(u-a)*(s-l)>(h=l==h|s==h?h+-2220446049250313e-31:h)&&(e^=1),!(i=0|n[i>>2])){i=22;break}}if(22==(0|i))return 0|e}return 0}function ce(t,e,i,o,s){i|=0,o|=0,s|=0;var a,l,c,u,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0;if(u=k,k=k+32|0,v=u+16|0,c=u,h=0|Ve(0|(t|=0),0|(e|=0),52),T(),h&=15,_=0|Ve(0|i,0|o,52),T(),(0|h)!=(15&_))return k=u,12;if(m=0|Ve(0|t,0|e,45),T(),m&=127,g=0|Ve(0|i,0|o,45),T(),m>>>0>121|(g&=127)>>>0>121)return k=u,5;if(_=(0|m)!=(0|g)){if(7==(0|(d=0|W(m,g))))return k=u,1;7==(0|(f=0|W(g,m)))?C(23066,23090,161,23100):(y=d,p=f)}else y=0,p=0;a=0|U(m),l=0|U(g),n[v>>2]=0,n[v+4>>2]=0,n[v+8>>2]=0,n[v+12>>2]=0;do{if(y){if(d=(0|(g=0|n[4272+(28*m|0)+(y<<2)>>2]))>0,l)if(d){m=0,f=i,d=o;do{f=0|Vt(f,d),d=0|T(),1==(0|(p=0|mt(p)))&&(p=0|mt(1)),m=m+1|0}while((0|m)!=(0|g));g=p,m=f,f=d}else g=p,m=i,f=o;else if(d){m=0,f=i,d=o;do{f=0|jt(f,d),d=0|T(),p=0|mt(p),m=m+1|0}while((0|m)!=(0|g));g=p,m=f,f=d}else g=p,m=i,f=o;if(qt(m,f,v),_||C(23115,23090,191,23100),(d=!!(0|a))&(p=!!(0|l))&&C(23142,23090,192,23100),d){if(7==(0|(p=0|zt(t,e)))){h=5;break}if(0|r[21872+(7*p|0)+y|0]){h=1;break}m=f=0|n[21040+(28*p|0)+(y<<2)>>2]}else if(p){if(7==(0|(p=0|zt(m,f)))){h=5;break}if(0|r[21872+(7*p|0)+g|0]){h=1;break}m=0,f=0|n[21040+(28*g|0)+(p<<2)>>2]}else m=0,f=0;if((m|f)<0)h=5;else{if((0|f)>0){d=v+4|0,p=0;do{dt(d),p=p+1|0}while((0|p)!=(0|f))}if(n[c>>2]=0,n[c+4>>2]=0,n[c+8>>2]=0,ht(c,y),0|h)for(;0|Gt(h)?ct(c):ut(c),(0|h)>1;)h=h+-1|0;if((0|m)>0){h=0;do{dt(c),h=h+1|0}while((0|h)!=(0|m))}et(A=v+4|0,c,A),Q(A),A=51}}else if(qt(i,o,v),!!(0|a)&!!(0|l))if((0|g)!=(0|m)&&C(23173,23090,261,23100),7==(0|(p=0|zt(t,e)))|7==(0|(h=0|zt(i,o))))h=5;else if(0|r[21872+(7*p|0)+h|0])h=1;else if((0|(p=0|n[21040+(28*p|0)+(h<<2)>>2]))>0){d=v+4|0,h=0;do{dt(d),h=h+1|0}while((0|h)!=(0|p));A=51}else A=51;else A=51}while(0);return 51==(0|A)&&(h=v+4|0,n[s>>2]=n[h>>2],n[s+4>>2]=n[h+4>>2],n[s+8>>2]=n[h+8>>2],h=0),k=u,0|h}function ue(t,e,i,r){i|=0,r|=0;var o,s,a,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0;if(a=k,k=k+48|0,o=a+36|0,u=a+24|0,h=a+12|0,p=a,l=0|Ve(0|(t|=0),0|(e|=0),52),T(),l&=15,f=0|Ve(0|t,0|e,45),T(),(f&=127)>>>0>121)return k=a,5;if(s=0|U(f),je(0|l,0,52),_=134225919|T(),n[(c=r)>>2]=-1,n[c+4>>2]=_,!l)return 7==(0|(l=0|nt(i)))||127==(0|(l=0|q(f,l)))?(k=a,0|(_=1)):(m=0|je(0|l,0,45),g=0|T(),g=-1040385&n[(f=r)+4>>2]|g,n[(_=r)>>2]=n[f>>2]|m,n[_+4>>2]=g,k=a,0|(_=0));for(n[o>>2]=n[i>>2],n[o+4>>2]=n[i+4>>2],n[o+8>>2]=n[i+8>>2],i=l;;){if(c=i,i=i+-1|0,n[u>>2]=n[o>>2],n[u+4>>2]=n[o+4>>2],n[u+8>>2]=n[o+8>>2],0|Gt(c)){if(0|(l=0|ot(o))){i=13;break}n[h>>2]=n[o>>2],n[h+4>>2]=n[o+4>>2],n[h+8>>2]=n[o+8>>2],ct(h)}else{if(0|(l=0|st(o))){i=13;break}n[h>>2]=n[o>>2],n[h+4>>2]=n[o+4>>2],n[h+8>>2]=n[o+8>>2],ut(h)}if(it(u,h,p),Q(p),A=0|n[(l=r)>>2],l=0|n[l+4>>2],y=0|je(7,0,0|(v=3*(15-c|0)|0)),l&=~T(),v=0|je(0|nt(p),0,0|v),l=T()|l,n[(_=r)>>2]=v|A&~y,n[_+4>>2]=l,(0|c)<=1){i=14;break}}t:do{if(13!=(0|i)&&14==(0|i))if((0|n[o>>2])<=1&&(0|n[o+4>>2])<=1&&(0|n[o+8>>2])<=1){p=127==(0|(l=0|q(f,i=0|nt(o))))?0:0|U(l);e:do{if(i){if(s){if(7==(0|(l=0|zt(t,e)))){l=5;break t}if((0|(c=0|n[21248+(28*l|0)+(i<<2)>>2]))>0){l=i,i=0;do{l=0|ft(l),i=i+1|0}while((0|i)!=(0|c))}else l=i;if(1==(0|l)){l=9;break t}127==(0|(i=0|q(f,l)))&&C(23200,23090,411,23230),0|U(i)?C(23245,23090,412,23230):(g=i,m=c,d=l)}else g=l,m=0,d=i;if((0|(h=0|n[4272+(28*f|0)+(d<<2)>>2]))<=-1&&C(23276,23090,419,23230),!p){if((0|m)<0){l=5;break t}if(0|m){l=0,i=0|n[(c=r)>>2],c=0|n[c+4>>2];do{i=0|Ut(i,c),c=0|T(),n[(v=r)>>2]=i,n[v+4>>2]=c,l=l+1|0}while((0|l)<(0|m))}if((0|h)<=0){l=g,i=58;break}for(l=0,i=0|n[(c=r)>>2],c=0|n[c+4>>2];;)if(i=0|Ut(i,c),c=0|T(),n[(v=r)>>2]=i,n[v+4>>2]=c,(0|(l=l+1|0))==(0|h)){l=g,i=58;break e}}if(7==(0|(u=0|W(g,f)))&&C(23066,23090,428,23230),i=0|n[(l=r)>>2],l=0|n[l+4>>2],(0|h)>0){c=0;do{i=0|Ut(i,l),l=0|T(),n[(v=r)>>2]=i,n[v+4>>2]=l,c=c+1|0}while((0|c)!=(0|h))}if(7==(0|(l=0|zt(i,l)))&&C(23313,23090,440,23230),i=0|V(g),(0|(i=0|n[(i?21664:21456)+(28*u|0)+(l<<2)>>2]))<0&&C(23313,23090,454,23230),i){l=0,c=0|n[(u=r)>>2],u=0|n[u+4>>2];do{c=0|Bt(c,u),u=0|T(),n[(v=r)>>2]=c,n[v+4>>2]=u,l=l+1|0}while((0|l)<(0|i));l=g,i=58}else l=g,i=58}else if(!!(0|s)&!!(0|p)){if(7==(0|(i=0|zt(t,e)))|7==(0|(c=0|zt(0|n[(c=r)>>2],0|n[c+4>>2])))){l=5;break t}if((0|(c=0|n[21248+(28*i|0)+(c<<2)>>2]))<0){l=5;break t}if(c){i=0,u=0|n[(h=r)>>2],h=0|n[h+4>>2];do{u=0|Ut(u,h),h=0|T(),n[(v=r)>>2]=u,n[v+4>>2]=h,i=i+1|0}while((0|i)<(0|c));i=58}else i=59}else i=58}while(0);if(58==(0|i)&&p&&(i=59),59==(0|i)&&1==(0|zt(0|n[(v=r)>>2],0|n[v+4>>2]))){l=9;break}y=0|n[(v=r)>>2],v=-1040385&n[v+4>>2],A=0|je(0|l,0,45),v|=T(),n[(l=r)>>2]=y|A,n[l+4>>2]=v,l=0}else l=1}while(0);return k=a,0|l}function he(t,e,i,r){t|=0,e|=0;var n=0,o=0,s=0;if(!(0|(i|=0))&!(0|(r|=0)))return o=1,S(0|(n=0)),0|o;o=t,n=e,t=1,e=0;do{t=0|Fe(0|((s=!0&!(1&i))?1:o),0|(s?0:n),0|t,0|e),e=0|T(),i=0|Ue(0|i,0|r,1),r=0|T(),o=0|Fe(0|o,0|n,0|o,0|n),n=0|T()}while(!(!(0|i)&!(0|r)));return S(0|e),0|t}function pe(t,e,i){t|=0;var r,s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0;if(!(0|J(e|=0,i|=0)))return 0;if(e=0|H(e),s=+o[i>>3],a=e&(a=+o[i+8>>3])<0?a+6.283185307179586:a,(0|(f=0|n[t>>2]))<=0)return 0;if(r=0|n[t+4>>2],e){e=0,d=a,i=-1,t=0;t:for(;;){for(p=t;c=+o[r+(p<<4)>>3],a=+o[r+(p<<4)+8>>3],l=+o[r+((t=(i+2|0)%(0|f)|0)<<4)>>3],u=+o[r+(t<<4)+8>>3],c>l?(h=c,c=u):(h=l,l=c,c=a,a=u),(s=s==l|s==h?s+2220446049250313e-31:s)<l|s>h;){if((0|(i=p+1|0))>=(0|f)){i=22;break t}t=p,p=i,i=t}if(((h=(u=c<0?c+6.283185307179586:c)+(s-l)/(h-l)*((c=a<0?a+6.283185307179586:a)-u))<0?h+6.283185307179586:h)>(d=u==d|c==d?d+-2220446049250313e-31:d)&&(e^=1),(0|(t=p+1|0))>=(0|f)){i=22;break}i=p}if(22==(0|i))return 0|e}else{e=0,d=a,i=-1,t=0;t:for(;;){for(p=t;c=+o[r+(p<<4)>>3],a=+o[r+(p<<4)+8>>3],l=+o[r+((t=(i+2|0)%(0|f)|0)<<4)>>3],u=+o[r+(t<<4)+8>>3],c>l?(h=c,c=u):(h=l,l=c,c=a,a=u),(s=s==l|s==h?s+2220446049250313e-31:s)<l|s>h;){if((0|(i=p+1|0))>=(0|f)){i=22;break t}t=p,p=i,i=t}if(c+(s-l)/(h-l)*(a-c)>(d=c==d|a==d?d+-2220446049250313e-31:d)&&(e^=1),(0|(t=p+1|0))>=(0|f)){i=22;break}i=p}if(22==(0|i))return 0|e}return 0}function de(t,e){e|=0;var i,r,s,a,l,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0;if(!(r=0|n[(t|=0)>>2]))return n[e>>2]=0,n[e+4>>2]=0,n[e+8>>2]=0,n[e+12>>2]=0,n[e+16>>2]=0,n[e+20>>2]=0,n[e+24>>2]=0,void(n[e+28>>2]=0);if(o[(s=e+8|0)>>3]=17976931348623157e292,o[(a=e+24|0)>>3]=17976931348623157e292,o[e>>3]=-17976931348623157e292,o[(l=e+16|0)>>3]=-17976931348623157e292,!((0|r)<=0)){for(i=0|n[t+4>>2],_=17976931348623157e292,y=-17976931348623157e292,A=0,t=-1,d=17976931348623157e292,f=17976931348623157e292,g=-17976931348623157e292,h=-17976931348623157e292,v=0;u=+o[i+(v<<4)>>3],m=+o[i+(v<<4)+8>>3],p=+o[i+(((0|(t=t+2|0))==(0|r)?0:t)<<4)+8>>3],u<d&&(o[s>>3]=u,d=u),m<f&&(o[a>>3]=m,f=m),u>g?o[e>>3]=u:u=g,m>h&&(o[l>>3]=m,h=m),_=m>0&m<_?m:_,y=m<0&m>y?m:y,A|=+c(+(m-p))>3.141592653589793,(0|(t=v+1|0))!=(0|r);)x=v,g=u,v=t,t=x;A&&(o[l>>3]=y,o[a>>3]=_)}}function fe(t,e){e|=0;var i,r=0,s=0,a=0,l=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,T=0,C=0;if(y=0|n[(t|=0)>>2]){if(o[(A=e+8|0)>>3]=17976931348623157e292,o[(v=e+24|0)>>3]=17976931348623157e292,o[e>>3]=-17976931348623157e292,o[(x=e+16|0)>>3]=-17976931348623157e292,(0|y)>0){for(a=0|n[t+4>>2],g=17976931348623157e292,_=-17976931348623157e292,s=0,r=-1,p=17976931348623157e292,d=17976931348623157e292,m=-17976931348623157e292,u=-17976931348623157e292,b=0;l=+o[a+(b<<4)>>3],f=+o[a+(b<<4)+8>>3],h=+o[a+(((0|(T=r+2|0))==(0|y)?0:T)<<4)+8>>3],l<p&&(o[A>>3]=l,p=l),f<d&&(o[v>>3]=f,d=f),l>m?o[e>>3]=l:l=m,f>u&&(o[x>>3]=f,u=f),g=f>0&f<g?f:g,_=f<0&f>_?f:_,s|=+c(+(f-h))>3.141592653589793,(0|(r=b+1|0))!=(0|y);)T=b,m=l,b=r,r=T;s&&(o[x>>3]=_,o[v>>3]=g)}}else n[e>>2]=0,n[e+4>>2]=0,n[e+8>>2]=0,n[e+12>>2]=0,n[e+16>>2]=0,n[e+20>>2]=0,n[e+24>>2]=0,n[e+28>>2]=0;if(!((0|(r=0|n[(T=t+8|0)>>2]))<=0)){i=t+12|0,S=0;do{if(a=0|n[i>>2],s=S,v=e+((S=S+1|0)<<5)|0,x=0|n[a+(s<<3)>>2]){if(o[(b=e+(S<<5)+8|0)>>3]=17976931348623157e292,o[(t=e+(S<<5)+24|0)>>3]=17976931348623157e292,o[v>>3]=-17976931348623157e292,o[(w=e+(S<<5)+16|0)>>3]=-17976931348623157e292,(0|x)>0){for(y=0|n[a+(s<<3)+4>>2],g=17976931348623157e292,_=-17976931348623157e292,a=0,s=-1,A=0,p=17976931348623157e292,d=17976931348623157e292,f=-17976931348623157e292,u=-17976931348623157e292;l=+o[y+(A<<4)>>3],m=+o[y+(A<<4)+8>>3],h=+o[y+(((0|(s=s+2|0))==(0|x)?0:s)<<4)+8>>3],l<p&&(o[b>>3]=l,p=l),m<d&&(o[t>>3]=m,d=m),l>f?o[v>>3]=l:l=f,m>u&&(o[w>>3]=m,u=m),g=m>0&m<g?m:g,_=m<0&m>_?m:_,a|=+c(+(m-h))>3.141592653589793,(0|(s=A+1|0))!=(0|x);)C=A,A=s,f=l,s=C;a&&(o[w>>3]=_,o[t>>3]=g)}}else n[v>>2]=0,n[v+4>>2]=0,n[v+8>>2]=0,n[v+12>>2]=0,n[v+16>>2]=0,n[v+20>>2]=0,n[v+24>>2]=0,n[v+28>>2]=0,r=0|n[T>>2]}while((0|S)<(0|r))}}function me(t,e,i){var r=0,o=0,s=0;if(!(0|pe(t|=0,e|=0,i|=0)))return 0;if((0|n[(o=t+8|0)>>2])<=0)return 1;for(r=t+12|0,t=0;;){if(s=t,t=t+1|0,0|pe((0|n[r>>2])+(s<<3)|0,e+(t<<5)|0,i)){t=0,r=6;break}if((0|t)>=(0|n[o>>2])){t=1,r=6;break}}return 6==(0|r)?0|t:0}function ge(t,e,i,r,n){e|=0,i|=0,r|=0,n|=0;var s,a,l,c,u,h,p,d=0;c=+o[(t|=0)>>3],l=+o[e>>3]-c,a=+o[t+8>>3],s=+o[e+8>>3]-a,h=+o[i>>3],d=((d=+o[r>>3]-h)*(a-(p=+o[i+8>>3]))-(c-h)*(u=+o[r+8>>3]-p))/(l*u-s*d),o[n>>3]=c+l*d,o[n+8>>3]=a+s*d}function _e(t,e){return e|=0,+c(+(+o[(t|=0)>>3]-+o[e>>3]))<1.1920928955078125e-7?0|(e=+c(+(+o[t+8>>3]-+o[e+8>>3]))<1.1920928955078125e-7):0|(e=0)}function ye(t,e){var i,r,n;return e|=0,+((n=+o[(t|=0)>>3]-+o[e>>3])*n+(r=+o[t+8>>3]-+o[e+8>>3])*r+(i=+o[t+16>>3]-+o[e+16>>3])*i)}function Ae(t,e,i){i|=0;var r,o,s,a,l=0,c=0,u=0;if(a=k,k=k+32|0,u=a,0|(l=0|Wt(t|=0,e|=0,o=a+16|0)))return k=a,0|l;r=0|Nt(t,e),s=0|zt(t,e),function(t,e){t=7696+(28*(t|=0)|0)|0,n[(e|=0)>>2]=n[t>>2],n[e+4>>2]=n[t+4>>2],n[e+8>>2]=n[t+8>>2],n[e+12>>2]=n[t+12>>2]}(r,u),l=0|function(t,e){t|=0;var i=0,r=0;if((e|=0)>>>0>20)return-1;do{if((0|n[11120+(216*e|0)>>2])!=(0|t))if((0|n[11120+(216*e|0)+8>>2])!=(0|t))if((0|n[11120+(216*e|0)+16>>2])!=(0|t))if((0|n[11120+(216*e|0)+24>>2])!=(0|t))if((0|n[11120+(216*e|0)+32>>2])!=(0|t))if((0|n[11120+(216*e|0)+40>>2])!=(0|t))if((0|n[11120+(216*e|0)+48>>2])!=(0|t))if((0|n[11120+(216*e|0)+56>>2])!=(0|t))if((0|n[11120+(216*e|0)+64>>2])!=(0|t))if((0|n[11120+(216*e|0)+72>>2])!=(0|t))if((0|n[11120+(216*e|0)+80>>2])!=(0|t))if((0|n[11120+(216*e|0)+88>>2])!=(0|t))if((0|n[11120+(216*e|0)+96>>2])!=(0|t))if((0|n[11120+(216*e|0)+104>>2])!=(0|t))if((0|n[11120+(216*e|0)+112>>2])!=(0|t))if((0|n[11120+(216*e|0)+120>>2])!=(0|t))if((0|n[11120+(216*e|0)+128>>2])!=(0|t)){if((0|n[11120+(216*e|0)+136>>2])!=(0|t)){if((0|n[11120+(216*e|0)+144>>2])==(0|t)){t=0,i=2,r=0;break}if((0|n[11120+(216*e|0)+152>>2])==(0|t)){t=0,i=2,r=1;break}if((0|n[11120+(216*e|0)+160>>2])==(0|t)){t=0,i=2,r=2;break}if((0|n[11120+(216*e|0)+168>>2])==(0|t)){t=1,i=2,r=0;break}if((0|n[11120+(216*e|0)+176>>2])==(0|t)){t=1,i=2,r=1;break}if((0|n[11120+(216*e|0)+184>>2])==(0|t)){t=1,i=2,r=2;break}if((0|n[11120+(216*e|0)+192>>2])==(0|t)){t=2,i=2,r=0;break}if((0|n[11120+(216*e|0)+200>>2])==(0|t)){t=2,i=2,r=1;break}if((0|n[11120+(216*e|0)+208>>2])==(0|t)){t=2,i=2,r=2;break}return-1}t=2,i=1,r=2}else t=2,i=1,r=1;else t=2,i=1,r=0;else t=1,i=1,r=2;else t=1,i=1,r=1;else t=1,i=1,r=0;else t=0,i=1,r=2;else t=0,i=1,r=1;else t=0,i=1,r=0;else t=2,i=0,r=2;else t=2,i=0,r=1;else t=2,i=0,r=0;else t=1,i=0,r=2;else t=1,i=0,r=1;else t=1,i=0,r=0;else t=0,i=0,r=2;else t=0,i=0,r=1;else t=0,i=0,r=0}while(0);return 0|n[11120+(216*e|0)+(72*i|0)+(24*t|0)+(r<<3)+4>>2]}(r,0|n[o>>2]);t:do{if(0|U(r)){switch(0|r){case 4:t=0;break;case 14:t=1;break;case 24:t=2;break;case 38:t=3;break;case 49:t=4;break;case 58:t=5;break;case 63:t=6;break;case 72:t=7;break;case 83:t=8;break;case 97:t=9;break;case 107:t=10;break;case 117:t=11;break;default:l=1;break t}if(c=0|n[22e3+(24*t|0)+8>>2],e=0|n[22e3+(24*t|0)+16>>2],(0|(t=0|n[o>>2]))!=(0|n[u>>2])&&(u=0|V(r))|(0|(t=0|n[o>>2]))==(0|e)&&(l=(l+1|0)%6|0),3==(0|s)&(0|t)==(0|e)){l=(l+5|0)%6|0,c=22;break}5==(0|s)&(0|t)==(0|c)?(l=(l+1|0)%6|0,c=22):c=22}else c=22}while(0);return 22==(0|c)&&(n[i>>2]=l,l=0),k=a,0|l}function ve(t,e,i,r){i|=0,r|=0;var o,s,a,l,c,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0;if(c=k,k=k+32|0,v=c+24|0,l=c+20|0,a=c+8|0,s=c+16|0,o=c,f=(f=!(0|Ft(t|=0,e|=0)))?6:5,g=0|Ve(0|t,0|e,52),T(),f>>>0<=i>>>0)return k=c,2;!(_=!(0|(g&=15)))&&!((y=0|je(7,0,3*(15^g)|0))&t)&!(T()&e)?u=i:h=4;t:do{if(4==(0|h)){if((0|((u=!!(0|Ft(t,e)))?4:5))<(0|i))return k=c,1;if(0|Ae(t,e,v))return k=c,1;if(h=(0|n[v>>2])+i|0,7==(0|(y=0|n[(u=u?22288+((0|h)%5<<2)|0:22320+((0|h)%6<<2)|0)>>2])))return k=c,1;n[l>>2]=0,u=0|F(t,e,y,l,a);do{if(!u){if(m=0|n[(d=a)>>2],h=(p=(d=0|n[d+4>>2])>>>0<e>>>0|(0|d)==(0|e)&m>>>0<t>>>0)?m:t,p=p?d:e,!_&&!(m&(_=0|je(7,0,3*(15^g)|0)))&!(d&T()))u=i;else{if(d=(i+-1+f|0)%(0|f)|0,u=0|Ft(t,e),(0|d)<0&&C(23313,23315,245,23324),(0|((f=!!(0|u))?4:5))<(0|d)&&C(23313,23315,245,23324),0|Ae(t,e,v)&&C(23313,23315,245,23324),u=(0|n[v>>2])+d|0,7==(0|(d=0|n[(u=f?22288+((0|u)%5<<2)|0:22320+((0|u)%6<<2)|0)>>2]))&&C(23313,23315,245,23324),n[s>>2]=0,0|(u=0|F(t,e,d,s,o)))break;f=0|n[(m=o)>>2],m=0|n[m+4>>2];do{if(m>>>0<p>>>0|(0|m)==(0|p)&f>>>0<h>>>0){if(h=0|Ft(f,m)?0|z(f,m,t,e):0|n[22384+(((0|n[s>>2])+(0|n[22352+(d<<2)>>2])|0)%6<<2)>>2],u=0|Ft(f,m),(h+-1|0)>>>0>5){u=-1,h=f,p=m;break}if(1==(0|h)&(u=!!(0|u))){u=-1,h=f,p=m;break}do{if(!(0|Ae(f,m,v))){if(u){u=(5+(0|n[21936+(h<<2)>>2])-(0|n[v>>2])|0)%5|0;break}u=(6+(0|n[21968+(h<<2)>>2])-(0|n[v>>2])|0)%6|0;break}u=-1}while(0);h=f,p=m}else u=i}while(0);m=0|n[(d=a)>>2],d=0|n[d+4>>2]}if((0|h)==(0|m)&(0|p)==(0|d)){if(t=(f=!!(0|Ft(m,d)))?0|z(m,d,t,e):0|n[22384+(((0|n[l>>2])+(0|n[22352+(y<<2)>>2])|0)%6<<2)>>2],u=0|Ft(m,d),(t+-1|0)>>>0<=5&&!(1==(0|t)&(A=!!(0|u))))do{if(!(0|Ae(m,d,v))){if(A){u=(5+(0|n[21936+(t<<2)>>2])-(0|n[v>>2])|0)%5|0;break}u=(6+(0|n[21968+(t<<2)>>2])-(0|n[v>>2])|0)%6|0;break}u=-1}while(0);else u=-1;u=6==(0|(u=u+1|0))|f&5==(0|u)?0:u}e=p,t=h;break t}}while(0);return k=c,0|u}}while(0);return A=0|je(0|u,0,56),v=T()|-2130706433&e|536870912,n[r>>2]=A|t,n[r+4>>2]=v,k=c,0}function xe(t,e,i){t|=0,i|=0;var r=0;(0|(e|=0))>0?(r=0|Pe(e,4),n[t>>2]=r,r||C(23337,23360,40,23374)):n[t>>2]=0,n[t+4>>2]=e,n[t+8>>2]=0,n[t+12>>2]=i}function be(t){var e,i,r,s=0,a=0,l=0,u=0;e=4+(t|=0)|0,i=t+12|0,r=t+8|0;t:for(;;){for(a=0|n[e>>2],s=0;;){if((0|s)>=(0|a))break t;if(l=0|n[t>>2],u=0|n[l+(s<<2)>>2])break;s=s+1|0}s=l+(~~(+c(+ +h(10,+ +(15-(0|n[i>>2])|0))*(+o[u>>3]+ +o[u+8>>3]))%+(0|a))>>>0<<2)|0,a=0|n[s>>2];e:do{if(0|a){if(l=u+32|0,(0|a)==(0|u))n[s>>2]=n[l>>2];else{if(!(s=0|n[(a=a+32|0)>>2]))break;for(;(0|s)!=(0|u);)if(!(s=0|n[(a=s+32|0)>>2]))break e;n[a>>2]=n[l>>2]}Le(u),n[r>>2]=(0|n[r>>2])-1}}while(0)}Le(0|n[t>>2])}function we(t){var e,i=0,r=0;for(e=0|n[4+(t|=0)>>2],r=0;;){if((0|r)>=(0|e)){i=0,r=4;break}if(i=0|n[(0|n[t>>2])+(r<<2)>>2]){r=4;break}r=r+1|0}return 4==(0|r)?0|i:0}function Se(t,e){e|=0;var i=0,r=0,s=0,a=0;if(i=~~(+c(+ +h(10,+ +(15-(0|n[12+(t|=0)>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|n[t+4>>2]))>>>0,i=(0|n[t>>2])+(i<<2)|0,!(r=0|n[i>>2]))return 1;a=e+32|0;do{if((0|r)!=(0|e)){if(!(i=0|n[r+32>>2]))return 1;for(s=i;;){if((0|s)==(0|e)){s=8;break}if(!(i=0|n[s+32>>2])){i=1,s=10;break}r=s,s=i}if(8==(0|s)){n[r+32>>2]=n[a>>2];break}if(10==(0|s))return 0|i}else n[i>>2]=n[a>>2]}while(0);return Le(e),n[(a=t+8|0)>>2]=(0|n[a>>2])-1,0}function Te(t,e,i){t|=0,e|=0,i|=0;var r,s=0,a=0,l=0;(r=0|Ie(40))||C(23390,23360,98,23403),n[r>>2]=n[e>>2],n[r+4>>2]=n[e+4>>2],n[r+8>>2]=n[e+8>>2],n[r+12>>2]=n[e+12>>2],n[(a=r+16|0)>>2]=n[i>>2],n[a+4>>2]=n[i+4>>2],n[a+8>>2]=n[i+8>>2],n[a+12>>2]=n[i+12>>2],n[r+32>>2]=0,a=~~(+c(+ +h(10,+ +(15-(0|n[t+12>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|n[t+4>>2]))>>>0,a=(0|n[t>>2])+(a<<2)|0,s=0|n[a>>2];do{if(s){for(;!(0|Qt(s,e)&&0|Qt(s+16|0,i));)if(a=0|n[s+32>>2],!(0|n[(s=0|a?a:s)+32>>2])){l=10;break}if(10==(0|l)){n[s+32>>2]=r;break}return Le(r),0|s}n[a>>2]=r}while(0);return n[(l=t+8|0)>>2]=1+(0|n[l>>2]),0|r}function Ce(t,e,i){e|=0,i|=0;var r=0,s=0;if(s=~~(+c(+ +h(10,+ +(15-(0|n[12+(t|=0)>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|n[t+4>>2]))>>>0,!(s=0|n[(0|n[t>>2])+(s<<2)>>2]))return 0;if(!i){for(t=s;;){if(0|Qt(t,e)){r=10;break}if(!(t=0|n[t+32>>2])){t=0,r=10;break}}if(10==(0|r))return 0|t}for(t=s;;){if(0|Qt(t,e)&&0|Qt(t+16|0,i)){r=10;break}if(!(t=0|n[t+32>>2])){t=0,r=10;break}}return 10==(0|r)?0|t:0}function Me(t,e){e|=0;var i=0;if(i=~~(+c(+ +h(10,+ +(15-(0|n[12+(t|=0)>>2])|0))*(+o[e>>3]+ +o[e+8>>3]))%+(0|n[t+4>>2]))>>>0,!(t=0|n[(0|n[t>>2])+(i<<2)>>2]))return 0;for(;;){if(0|Qt(t,e)){e=5;break}if(!(t=0|n[t+32>>2])){t=0,e=5;break}}return 5==(0|e)?0|t:0}function Ee(t){return 0|+function(t){return+ +Je(+(t=+t))}(t=+t)}function Ie(t){t|=0;var e,i=0,r=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0;e=k,k=k+16|0,f=e;do{if(t>>>0<245){if(t=(h=t>>>0<11?16:t+11&-8)>>>3,3&(r=(d=0|n[5857])>>>t))return o=0|n[(r=8+(t=23468+((i=(1&r^1)+t|0)<<1<<2)|0)|0)>>2],(0|(a=0|n[(s=o+8|0)>>2]))==(0|t)?n[5857]=d&~(1<<i):(n[a+12>>2]=t,n[r>>2]=a),b=i<<3,n[o+4>>2]=3|b,n[(b=o+b+4|0)>>2]=1|n[b>>2],k=e,0|s;if(h>>>0>(p=0|n[5859])>>>0){if(0|r)return i=((i=r<<t&((i=2<<t)|0-i))&0-i)-1|0,a=0|n[(t=8+(i=23468+((o=((r=(i>>>=c=i>>>12&16)>>>5&8)|c|(a=(i>>>=r)>>>2&4)|(t=(i>>>=a)>>>1&2)|(o=(i>>>=t)>>>1&1))+(i>>>o)|0)<<1<<2)|0)|0)>>2],(0|(r=0|n[(c=a+8|0)>>2]))==(0|i)?(t=d&~(1<<o),n[5857]=t):(n[r+12>>2]=i,n[t>>2]=r,t=d),l=(b=o<<3)-h|0,n[a+4>>2]=3|h,n[4+(s=a+h|0)>>2]=1|l,n[a+b>>2]=l,0|p&&(o=0|n[5862],r=23468+((i=p>>>3)<<1<<2)|0,t&(i=1<<i)?i=0|n[(t=r+8|0)>>2]:(n[5857]=t|i,i=r,t=r+8|0),n[t>>2]=o,n[i+12>>2]=o,n[o+8>>2]=i,n[o+12>>2]=r),n[5859]=l,n[5862]=s,k=e,0|c;if(a=0|n[5858]){for(r=(a&0-a)-1|0,r=u=0|n[23732+(((o=(r>>>=s=r>>>12&16)>>>5&8)|s|(l=(r>>>=o)>>>2&4)|(c=(r>>>=l)>>>1&2)|(u=(r>>>=c)>>>1&1))+(r>>>u)<<2)>>2],c=u,u=(-8&n[u+4>>2])-h|0;(t=0|n[r+16>>2])||(t=0|n[r+20>>2]);)r=t,c=(s=(l=(-8&n[t+4>>2])-h|0)>>>0<u>>>0)?t:c,u=s?l:u;if((l=c+h|0)>>>0>c>>>0){s=0|n[c+24>>2],i=0|n[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|n[(t=c+20|0)>>2])&&!(i=0|n[(t=c+16|0)>>2])){r=0;break}for(;;)if(r=0|n[(o=i+20|0)>>2])i=r,t=o;else{if(!(r=0|n[(o=i+16|0)>>2]))break;i=r,t=o}n[t>>2]=0,r=i}else r=0|n[c+8>>2],n[r+12>>2]=i,n[i+8>>2]=r,r=i}while(0);do{if(0|s){if(i=0|n[c+28>>2],(0|c)==(0|n[(t=23732+(i<<2)|0)>>2])){if(n[t>>2]=r,!r){n[5858]=a&~(1<<i);break}}else if(n[((0|n[(b=s+16|0)>>2])==(0|c)?b:s+20)>>2]=r,!r)break;n[r+24>>2]=s,0|(i=0|n[c+16>>2])&&(n[r+16>>2]=i,n[i+24>>2]=r),0|(i=0|n[c+20>>2])&&(n[r+20>>2]=i,n[i+24>>2]=r)}}while(0);return u>>>0<16?(b=u+h|0,n[c+4>>2]=3|b,n[(b=c+b+4|0)>>2]=1|n[b>>2]):(n[c+4>>2]=3|h,n[l+4>>2]=1|u,n[l+u>>2]=u,0|p&&(o=0|n[5862],r=23468+((i=p>>>3)<<1<<2)|0,(i=1<<i)&d?i=0|n[(t=r+8|0)>>2]:(n[5857]=i|d,i=r,t=r+8|0),n[t>>2]=o,n[i+12>>2]=o,n[o+8>>2]=i,n[o+12>>2]=r),n[5859]=u,n[5862]=l),k=e,0|c+8}d=h}else d=h}else d=h}else if(t>>>0<=4294967231)if(h=-8&(t=t+11|0),o=0|n[5858]){s=0-h|0,u=(t>>>=8)?h>>>0>16777215?31:h>>>(7+(u=14-((c=(520192+(_=t<<(d=(t+1048320|0)>>>16&8))|0)>>>16&4)|d|(u=(245760+(_<<=c)|0)>>>16&2))+(_<<u>>>15)|0)|0)&1|u<<1:0,r=0|n[23732+(u<<2)>>2];t:do{if(r)for(t=0,c=h<<(31==(0|u)?0:25-(u>>>1)),a=0;;){if((l=(-8&n[r+4>>2])-h|0)>>>0<s>>>0){if(!l){t=r,s=0,_=65;break t}t=r,s=l}if(a=!(0|(_=0|n[r+20>>2]))|(0|_)==(0|(r=0|n[r+16+(c>>>31<<2)>>2]))?a:_,!r){r=a,_=61;break}c<<=1}else r=0,t=0,_=61}while(0);if(61==(0|_)){if(!(0|r)&!(0|t)){if(!(t=((t=2<<u)|0-t)&o)){d=h;break}d=(t&0-t)-1|0,t=0,r=0|n[23732+(((a=(d>>>=l=d>>>12&16)>>>5&8)|l|(c=(d>>>=a)>>>2&4)|(u=(d>>>=c)>>>1&2)|(r=(d>>>=u)>>>1&1))+(d>>>r)<<2)>>2]}r?_=65:(c=t,l=s)}if(65==(0|_))for(a=r;;){if(s=(r=(d=(-8&n[a+4>>2])-h|0)>>>0<s>>>0)?d:s,t=r?a:t,(r=0|n[a+16>>2])||(r=0|n[a+20>>2]),!r){c=t,l=s;break}a=r}if(0|c&&l>>>0<((0|n[5859])-h|0)>>>0&&(p=c+h|0)>>>0>c>>>0){a=0|n[c+24>>2],i=0|n[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|n[(t=c+20|0)>>2])&&!(i=0|n[(t=c+16|0)>>2])){i=0;break}for(;;)if(r=0|n[(s=i+20|0)>>2])i=r,t=s;else{if(!(r=0|n[(s=i+16|0)>>2]))break;i=r,t=s}n[t>>2]=0}else b=0|n[c+8>>2],n[b+12>>2]=i,n[i+8>>2]=b}while(0);do{if(a){if(t=0|n[c+28>>2],(0|c)==(0|n[(r=23732+(t<<2)|0)>>2])){if(n[r>>2]=i,!i){o&=~(1<<t),n[5858]=o;break}}else if(n[((0|n[(b=a+16|0)>>2])==(0|c)?b:a+20)>>2]=i,!i)break;n[i+24>>2]=a,0|(t=0|n[c+16>>2])&&(n[i+16>>2]=t,n[t+24>>2]=i),(t=0|n[c+20>>2])&&(n[i+20>>2]=t,n[t+24>>2]=i)}}while(0);t:do{if(l>>>0<16)b=l+h|0,n[c+4>>2]=3|b,n[(b=c+b+4|0)>>2]=1|n[b>>2];else{if(n[c+4>>2]=3|h,n[p+4>>2]=1|l,n[p+l>>2]=l,i=l>>>3,l>>>0<256){r=23468+(i<<1<<2)|0,(t=0|n[5857])&(i=1<<i)?i=0|n[(t=r+8|0)>>2]:(n[5857]=t|i,i=r,t=r+8|0),n[t>>2]=p,n[i+12>>2]=p,n[p+8>>2]=i,n[p+12>>2]=r;break}if(i=23732+((r=(i=l>>>8)?l>>>0>16777215?31:l>>>(7+(r=14-((v=(520192+(b=i<<(x=(i+1048320|0)>>>16&8))|0)>>>16&4)|x|(r=(245760+(b<<=v)|0)>>>16&2))+(b<<r>>>15)|0)|0)&1|r<<1:0)<<2)|0,n[p+28>>2]=r,n[4+(t=p+16|0)>>2]=0,n[t>>2]=0,!(o&(t=1<<r))){n[5858]=o|t,n[i>>2]=p,n[p+24>>2]=i,n[p+12>>2]=p,n[p+8>>2]=p;break}i=0|n[i>>2];e:do{if((-8&n[i+4>>2])!=(0|l)){for(o=l<<(31==(0|r)?0:25-(r>>>1));t=0|n[(r=i+16+(o>>>31<<2)|0)>>2];){if((-8&n[t+4>>2])==(0|l)){i=t;break e}o<<=1,i=t}n[r>>2]=p,n[p+24>>2]=i,n[p+12>>2]=p,n[p+8>>2]=p;break t}}while(0);b=0|n[(x=i+8|0)>>2],n[b+12>>2]=p,n[x>>2]=p,n[p+8>>2]=b,n[p+12>>2]=i,n[p+24>>2]=0}}while(0);return k=e,0|c+8}d=h}else d=h;else d=-1}while(0);if((r=0|n[5859])>>>0>=d>>>0)return i=r-d|0,t=0|n[5862],i>>>0>15?(b=t+d|0,n[5862]=b,n[5859]=i,n[b+4>>2]=1|i,n[t+r>>2]=i,n[t+4>>2]=3|d):(n[5859]=0,n[5862]=0,n[t+4>>2]=3|r,n[(b=t+r+4|0)>>2]=1|n[b>>2]),k=e,0|t+8;if((l=0|n[5860])>>>0>d>>>0)return v=l-d|0,n[5860]=v,x=(b=0|n[5863])+d|0,n[5863]=x,n[x+4>>2]=1|v,n[b+4>>2]=3|d,k=e,0|b+8;if(0|n[5975]?t=0|n[5977]:(n[5977]=4096,n[5976]=4096,n[5978]=-1,n[5979]=-1,n[5980]=0,n[5968]=0,n[5975]=-16&f^1431655768,t=4096),c=d+48|0,(h=(a=t+(u=d+47|0)|0)&(s=0-t|0))>>>0<=d>>>0)return k=e,0;if(0|(t=0|n[5967])&&(f=(p=0|n[5965])+h|0)>>>0<=p>>>0|f>>>0>t>>>0)return k=e,0;t:do{if(4&n[5968])i=0,_=143;else{r=0|n[5863];e:do{if(r){for(o=23876;!((f=0|n[o>>2])>>>0<=r>>>0&&(f+(0|n[o+4>>2])|0)>>>0>r>>>0);){if(!(t=0|n[o+8>>2])){_=128;break e}o=t}if((i=a-l&s)>>>0<2147483647)if((0|(t=0|Ke(0|i)))==((0|n[o>>2])+(0|n[o+4>>2])|0)){if(-1!=(0|t)){l=i,a=t,_=145;break t}}else o=t,_=136;else i=0}else _=128}while(0);do{if(128==(0|_))if(-1!=(0|(r=0|Ke(0)))&&(i=r,g=(i=((g=(m=0|n[5976])-1|0)&i?(g+i&0-m)-i|0:0)+h|0)+(m=0|n[5965])|0,i>>>0>d>>>0&i>>>0<2147483647)){if(0|(f=0|n[5967])&&g>>>0<=m>>>0|g>>>0>f>>>0){i=0;break}if((0|(t=0|Ke(0|i)))==(0|r)){l=i,a=r,_=145;break t}o=t,_=136}else i=0}while(0);do{if(136==(0|_)){if(r=0-i|0,!(c>>>0>i>>>0&i>>>0<2147483647&-1!=(0|o))){if(-1==(0|o)){i=0;break}l=i,a=o,_=145;break t}if((t=u-i+(t=0|n[5977])&0-t)>>>0>=2147483647){l=i,a=o,_=145;break t}if(-1==(0|Ke(0|t))){Ke(0|r),i=0;break}l=t+i|0,a=o,_=145;break t}}while(0);n[5968]=4|n[5968],_=143}}while(0);if(143==(0|_)&&h>>>0<2147483647&&!(-1==(0|(v=0|Ke(0|h)))|1^(A=(y=(g=0|Ke(0))-v|0)>>>0>(d+40|0)>>>0)|v>>>0<g>>>0&-1!=(0|v)&-1!=(0|g)^1)&&(l=A?y:i,a=v,_=145),145==(0|_)){i=(0|n[5965])+l|0,n[5965]=i,i>>>0>(0|n[5966])>>>0&&(n[5966]=i),u=0|n[5863];t:do{if(u){for(i=23876;;){if((0|a)==((t=0|n[i>>2])+(r=0|n[i+4>>2])|0)){_=154;break}if(!(o=0|n[i+8>>2]))break;i=o}if(!(154!=(0|_)||(x=i+4|0,8&n[i+12>>2]))&&a>>>0>u>>>0&t>>>0<=u>>>0){n[x>>2]=r+l,x=u+(v=7&(v=u+8|0)?0-v&7:0)|0,v=(b=(0|n[5860])+l|0)-v|0,n[5863]=x,n[5860]=v,n[x+4>>2]=1|v,n[u+b+4>>2]=40,n[5864]=n[5979];break}for(a>>>0<(0|n[5861])>>>0&&(n[5861]=a),r=a+l|0,i=23876;;){if((0|n[i>>2])==(0|r)){_=162;break}if(!(t=0|n[i+8>>2]))break;i=t}if(162==(0|_)&&!(8&n[i+12>>2])){n[i>>2]=a,n[(p=i+4|0)>>2]=(0|n[p>>2])+l,h=(p=a+(7&(p=a+8|0)?0-p&7:0)|0)+d|0,c=(i=r+(7&(i=r+8|0)?0-i&7:0)|0)-p-d|0,n[p+4>>2]=3|d;e:do{if((0|u)==(0|i))b=(0|n[5860])+c|0,n[5860]=b,n[5863]=h,n[h+4>>2]=1|b;else{if((0|n[5862])==(0|i)){b=(0|n[5859])+c|0,n[5859]=b,n[5862]=h,n[h+4>>2]=1|b,n[h+b>>2]=b;break}if(1==(3&(t=0|n[i+4>>2]))){l=-8&t,o=t>>>3;i:do{if(t>>>0<256){if(t=0|n[i+8>>2],(0|(r=0|n[i+12>>2]))==(0|t)){n[5857]=n[5857]&~(1<<o);break}n[t+12>>2]=r,n[r+8>>2]=t;break}a=0|n[i+24>>2],t=0|n[i+12>>2];do{if((0|t)==(0|i)){if(t=0|n[(o=4+(r=i+16|0)|0)>>2])r=o;else if(!(t=0|n[r>>2])){t=0;break}for(;;)if(o=0|n[(s=t+20|0)>>2])t=o,r=s;else{if(!(o=0|n[(s=t+16|0)>>2]))break;t=o,r=s}n[r>>2]=0}else b=0|n[i+8>>2],n[b+12>>2]=t,n[t+8>>2]=b}while(0);if(!a)break;o=23732+((r=0|n[i+28>>2])<<2)|0;do{if((0|n[o>>2])==(0|i)){if(n[o>>2]=t,0|t)break;n[5858]=n[5858]&~(1<<r);break i}if(n[((0|n[(b=a+16|0)>>2])==(0|i)?b:a+20)>>2]=t,!t)break i}while(0);if(n[t+24>>2]=a,0|(o=0|n[(r=i+16|0)>>2])&&(n[t+16>>2]=o,n[o+24>>2]=t),!(r=0|n[r+4>>2]))break;n[t+20>>2]=r,n[r+24>>2]=t}while(0);i=i+l|0,s=l+c|0}else s=c;if(n[(i=i+4|0)>>2]=-2&n[i>>2],n[h+4>>2]=1|s,n[h+s>>2]=s,i=s>>>3,s>>>0<256){r=23468+(i<<1<<2)|0,(t=0|n[5857])&(i=1<<i)?i=0|n[(t=r+8|0)>>2]:(n[5857]=t|i,i=r,t=r+8|0),n[t>>2]=h,n[i+12>>2]=h,n[h+8>>2]=i,n[h+12>>2]=r;break}i=s>>>8;do{if(i){if(s>>>0>16777215){o=31;break}o=s>>>(7+(o=14-((v=(520192+(b=i<<(x=(i+1048320|0)>>>16&8))|0)>>>16&4)|x|(o=(245760+(b<<=v)|0)>>>16&2))+(b<<o>>>15)|0)|0)&1|o<<1}else o=0}while(0);if(i=23732+(o<<2)|0,n[h+28>>2]=o,n[4+(t=h+16|0)>>2]=0,n[t>>2]=0,!((t=0|n[5858])&(r=1<<o))){n[5858]=t|r,n[i>>2]=h,n[h+24>>2]=i,n[h+12>>2]=h,n[h+8>>2]=h;break}i=0|n[i>>2];i:do{if((-8&n[i+4>>2])!=(0|s)){for(o=s<<(31==(0|o)?0:25-(o>>>1));t=0|n[(r=i+16+(o>>>31<<2)|0)>>2];){if((-8&n[t+4>>2])==(0|s)){i=t;break i}o<<=1,i=t}n[r>>2]=h,n[h+24>>2]=i,n[h+12>>2]=h,n[h+8>>2]=h;break e}}while(0);b=0|n[(x=i+8|0)>>2],n[b+12>>2]=h,n[x>>2]=h,n[h+8>>2]=b,n[h+12>>2]=i,n[h+24>>2]=0}}while(0);return k=e,0|p+8}for(i=23876;!((t=0|n[i>>2])>>>0<=u>>>0&&(b=t+(0|n[i+4>>2])|0)>>>0>u>>>0);)i=0|n[i+8>>2];i=(t=(t=(s=b+-47|0)+(7&(t=s+8|0)?0-t&7:0)|0)>>>0<(s=u+16|0)>>>0?u:t)+8|0,x=a+(v=7&(v=a+8|0)?0-v&7:0)|0,v=(r=l+-40|0)-v|0,n[5863]=x,n[5860]=v,n[x+4>>2]=1|v,n[a+r+4>>2]=40,n[5864]=n[5979],n[(r=t+4|0)>>2]=27,n[i>>2]=n[5969],n[i+4>>2]=n[5970],n[i+8>>2]=n[5971],n[i+12>>2]=n[5972],n[5969]=a,n[5970]=l,n[5972]=0,n[5971]=i,i=t+24|0;do{x=i,n[(i=i+4|0)>>2]=7}while((x+8|0)>>>0<b>>>0);if((0|t)!=(0|u)){if(a=t-u|0,n[r>>2]=-2&n[r>>2],n[u+4>>2]=1|a,n[t>>2]=a,i=a>>>3,a>>>0<256){r=23468+(i<<1<<2)|0,(t=0|n[5857])&(i=1<<i)?i=0|n[(t=r+8|0)>>2]:(n[5857]=t|i,i=r,t=r+8|0),n[t>>2]=u,n[i+12>>2]=u,n[u+8>>2]=i,n[u+12>>2]=r;break}if(r=23732+((o=(i=a>>>8)?a>>>0>16777215?31:a>>>(7+(o=14-((v=(520192+(b=i<<(x=(i+1048320|0)>>>16&8))|0)>>>16&4)|x|(o=(245760+(b<<=v)|0)>>>16&2))+(b<<o>>>15)|0)|0)&1|o<<1:0)<<2)|0,n[u+28>>2]=o,n[u+20>>2]=0,n[s>>2]=0,!((i=0|n[5858])&(t=1<<o))){n[5858]=i|t,n[r>>2]=u,n[u+24>>2]=r,n[u+12>>2]=u,n[u+8>>2]=u;break}i=0|n[r>>2];e:do{if((-8&n[i+4>>2])!=(0|a)){for(o=a<<(31==(0|o)?0:25-(o>>>1));t=0|n[(r=i+16+(o>>>31<<2)|0)>>2];){if((-8&n[t+4>>2])==(0|a)){i=t;break e}o<<=1,i=t}n[r>>2]=u,n[u+24>>2]=i,n[u+12>>2]=u,n[u+8>>2]=u;break t}}while(0);b=0|n[(x=i+8|0)>>2],n[b+12>>2]=u,n[x>>2]=u,n[u+8>>2]=b,n[u+12>>2]=i,n[u+24>>2]=0}}else!(0|(b=0|n[5861]))|a>>>0<b>>>0&&(n[5861]=a),n[5969]=a,n[5970]=l,n[5972]=0,n[5866]=n[5975],n[5865]=-1,n[5870]=23468,n[5869]=23468,n[5872]=23476,n[5871]=23476,n[5874]=23484,n[5873]=23484,n[5876]=23492,n[5875]=23492,n[5878]=23500,n[5877]=23500,n[5880]=23508,n[5879]=23508,n[5882]=23516,n[5881]=23516,n[5884]=23524,n[5883]=23524,n[5886]=23532,n[5885]=23532,n[5888]=23540,n[5887]=23540,n[5890]=23548,n[5889]=23548,n[5892]=23556,n[5891]=23556,n[5894]=23564,n[5893]=23564,n[5896]=23572,n[5895]=23572,n[5898]=23580,n[5897]=23580,n[5900]=23588,n[5899]=23588,n[5902]=23596,n[5901]=23596,n[5904]=23604,n[5903]=23604,n[5906]=23612,n[5905]=23612,n[5908]=23620,n[5907]=23620,n[5910]=23628,n[5909]=23628,n[5912]=23636,n[5911]=23636,n[5914]=23644,n[5913]=23644,n[5916]=23652,n[5915]=23652,n[5918]=23660,n[5917]=23660,n[5920]=23668,n[5919]=23668,n[5922]=23676,n[5921]=23676,n[5924]=23684,n[5923]=23684,n[5926]=23692,n[5925]=23692,n[5928]=23700,n[5927]=23700,n[5930]=23708,n[5929]=23708,n[5932]=23716,n[5931]=23716,x=a+(v=7&(v=a+8|0)?0-v&7:0)|0,v=(b=l+-40|0)-v|0,n[5863]=x,n[5860]=v,n[x+4>>2]=1|v,n[a+b+4>>2]=40,n[5864]=n[5979]}while(0);if((i=0|n[5860])>>>0>d>>>0)return v=i-d|0,n[5860]=v,x=(b=0|n[5863])+d|0,n[5863]=x,n[x+4>>2]=1|v,n[b+4>>2]=3|d,k=e,0|b+8}return n[(b=23424)>>2]=12,k=e,0}function Le(t){var e=0,i=0,r=0,o=0,s=0,a=0,l=0,c=0;if(t|=0){i=t+-8|0,o=0|n[5861],c=i+(e=-8&(t=0|n[t+-4>>2]))|0;do{if(1&t)l=i,a=i;else{if(r=0|n[i>>2],!(3&t))return;if(s=r+e|0,(a=i+(0-r)|0)>>>0<o>>>0)return;if((0|n[5862])==(0|a)){if(3&~(e=0|n[(t=c+4|0)>>2])){l=a,e=s;break}return n[5859]=s,n[t>>2]=-2&e,n[a+4>>2]=1|s,void(n[a+s>>2]=s)}if(i=r>>>3,r>>>0<256){if(t=0|n[a+8>>2],(0|(e=0|n[a+12>>2]))==(0|t)){n[5857]=n[5857]&~(1<<i),l=a,e=s;break}n[t+12>>2]=e,n[e+8>>2]=t,l=a,e=s;break}o=0|n[a+24>>2],t=0|n[a+12>>2];do{if((0|t)==(0|a)){if(t=0|n[(i=4+(e=a+16|0)|0)>>2])e=i;else if(!(t=0|n[e>>2])){t=0;break}for(;;)if(i=0|n[(r=t+20|0)>>2])t=i,e=r;else{if(!(i=0|n[(r=t+16|0)>>2]))break;t=i,e=r}n[e>>2]=0}else l=0|n[a+8>>2],n[l+12>>2]=t,n[t+8>>2]=l}while(0);if(o){if(e=0|n[a+28>>2],(0|n[(i=23732+(e<<2)|0)>>2])==(0|a)){if(n[i>>2]=t,!t){n[5858]=n[5858]&~(1<<e),l=a,e=s;break}}else if(n[((0|n[(l=o+16|0)>>2])==(0|a)?l:o+20)>>2]=t,!t){l=a,e=s;break}n[t+24>>2]=o,0|(i=0|n[(e=a+16|0)>>2])&&(n[t+16>>2]=i,n[i+24>>2]=t),(e=0|n[e+4>>2])?(n[t+20>>2]=e,n[e+24>>2]=t,l=a,e=s):(l=a,e=s)}else l=a,e=s}}while(0);if(!(a>>>0>=c>>>0)&&1&(r=0|n[(t=c+4|0)>>2])){if(2&r)n[t>>2]=-2&r,n[l+4>>2]=1|e,n[a+e>>2]=e,o=e;else{if((0|n[5863])==(0|c)){if(c=(0|n[5860])+e|0,n[5860]=c,n[5863]=l,n[l+4>>2]=1|c,(0|l)!=(0|n[5862]))return;return n[5862]=0,void(n[5859]=0)}if((0|n[5862])==(0|c))return c=(0|n[5859])+e|0,n[5859]=c,n[5862]=a,n[l+4>>2]=1|c,void(n[a+c>>2]=c);o=(-8&r)+e|0,i=r>>>3;do{if(r>>>0<256){if(e=0|n[c+8>>2],(0|(t=0|n[c+12>>2]))==(0|e)){n[5857]=n[5857]&~(1<<i);break}n[e+12>>2]=t,n[t+8>>2]=e;break}s=0|n[c+24>>2],t=0|n[c+12>>2];do{if((0|t)==(0|c)){if(t=0|n[(i=4+(e=c+16|0)|0)>>2])e=i;else if(!(t=0|n[e>>2])){i=0;break}for(;;)if(i=0|n[(r=t+20|0)>>2])t=i,e=r;else{if(!(i=0|n[(r=t+16|0)>>2]))break;t=i,e=r}n[e>>2]=0,i=t}else i=0|n[c+8>>2],n[i+12>>2]=t,n[t+8>>2]=i,i=t}while(0);if(0|s){if(t=0|n[c+28>>2],(0|n[(e=23732+(t<<2)|0)>>2])==(0|c)){if(n[e>>2]=i,!i){n[5858]=n[5858]&~(1<<t);break}}else if(n[((0|n[(r=s+16|0)>>2])==(0|c)?r:s+20)>>2]=i,!i)break;n[i+24>>2]=s,0|(e=0|n[(t=c+16|0)>>2])&&(n[i+16>>2]=e,n[e+24>>2]=i),0|(t=0|n[t+4>>2])&&(n[i+20>>2]=t,n[t+24>>2]=i)}}while(0);if(n[l+4>>2]=1|o,n[a+o>>2]=o,(0|l)==(0|n[5862]))return void(n[5859]=o)}if(t=o>>>3,o>>>0<256)return i=23468+(t<<1<<2)|0,(e=0|n[5857])&(t=1<<t)?t=0|n[(e=i+8|0)>>2]:(n[5857]=e|t,t=i,e=i+8|0),n[e>>2]=l,n[t+12>>2]=l,n[l+8>>2]=t,void(n[l+12>>2]=i);t=23732+((r=(t=o>>>8)?o>>>0>16777215?31:o>>>(7+(r=14-((s=(520192+(c=t<<(a=(t+1048320|0)>>>16&8))|0)>>>16&4)|a|(r=(245760+(c<<=s)|0)>>>16&2))+(c<<r>>>15)|0)|0)&1|r<<1:0)<<2)|0,n[l+28>>2]=r,n[l+20>>2]=0,n[l+16>>2]=0,e=0|n[5858],i=1<<r;t:do{if(e&i){t=0|n[t>>2];e:do{if((-8&n[t+4>>2])!=(0|o)){for(r=o<<(31==(0|r)?0:25-(r>>>1));e=0|n[(i=t+16+(r>>>31<<2)|0)>>2];){if((-8&n[e+4>>2])==(0|o)){t=e;break e}r<<=1,t=e}n[i>>2]=l,n[l+24>>2]=t,n[l+12>>2]=l,n[l+8>>2]=l;break t}}while(0);c=0|n[(a=t+8|0)>>2],n[c+12>>2]=l,n[a>>2]=l,n[l+8>>2]=c,n[l+12>>2]=t,n[l+24>>2]=0}else n[5858]=e|i,n[t>>2]=l,n[l+24>>2]=t,n[l+12>>2]=l,n[l+8>>2]=l}while(0);if(c=(0|n[5865])-1|0,n[5865]=c,!(0|c)){for(t=23884;t=0|n[t>>2];)t=t+8|0;n[5865]=-1}}}}function Pe(t,e){e|=0;var i=0;return(t|=0)?(i=0|v(e,t),(e|t)>>>0>65535&&(i=((i>>>0)/(t>>>0)|0)==(0|e)?i:-1)):i=0,(t=0|Ie(i))&&3&n[t+-4>>2]?(He(0|t,0,0|i),0|t):0|t}function ke(t,e,i,r){return 0|(S((e|=0)+(r|=0)+((i=(t|=0)+(i|=0)>>>0)>>>0<t>>>0|0)>>>0|0),i)}function Ne(t,e,i,r){return 0|(S(0|(r=(e|=0)-(r|=0)-((i|=0)>>>0>(t|=0)>>>0|0)>>>0)),t-i>>>0)}function De(t){return 0|((t|=0)?31-(0|w(t^t-1)):32)}function Oe(t,e,i,r,o){o|=0;var s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0;if(h=t|=0,a=i|=0,l=d=r|=0,!(u=c=e|=0))return s=!!(0|o),l?s?(n[o>>2]=0|t,n[o+4>>2]=0,o=0,0|(S(0|(d=0)),o)):(o=0,0|(S(0|(d=0)),o)):(s&&(n[o>>2]=(h>>>0)%(a>>>0),n[o+4>>2]=0),o=(h>>>0)/(a>>>0)>>>0,0|(S(0|(d=0)),o));s=!(0|l);do{if(a){if(!s){if((s=(0|w(0|l))-(0|w(0|u))|0)>>>0<=31){a=p=s+1|0,t=h>>>(p>>>0)&(e=s-31>>31)|u<<(l=31-s|0),e&=u>>>(p>>>0),s=0,l=h<<l;break}return o?(n[o>>2]=0|t,n[o+4>>2]=0|c,o=0,0|(S(0|(d=0)),o)):(o=0,0|(S(0|(d=0)),o))}if((s=a-1|0)&a){a=l=33+(0|w(0|a))-(0|w(0|u))|0,t=(p=32-l|0)-1>>31&u>>>((f=l-32|0)>>>0)|(u<<p|h>>>(l>>>0))&(e=f>>31),e&=u>>>(l>>>0),s=h<<(m=64-l|0)&(c=p>>31),l=(u<<m|h>>>(f>>>0))&c|h<<p&l-33>>31;break}return 0|o&&(n[o>>2]=s&h,n[o+4>>2]=0),1==(0|a)?(m=0|t,0|(S(0|(f=0|c)),m)):(f=u>>>((m=0|De(0|a))>>>0)|0,m=u<<32-m|h>>>(m>>>0),0|(S(0|f),m))}if(s)return 0|o&&(n[o>>2]=(u>>>0)%(a>>>0),n[o+4>>2]=0),m=(u>>>0)/(a>>>0)>>>0,0|(S(0|(f=0)),m);if(!h)return 0|o&&(n[o>>2]=0,n[o+4>>2]=(u>>>0)%(l>>>0)),m=(u>>>0)/(l>>>0)>>>0,0|(S(0|(f=0)),m);if(!((s=l-1|0)&l))return 0|o&&(n[o>>2]=0|t,n[o+4>>2]=s&u),f=0,m=u>>>((0|De(0|l))>>>0),0|(S(0|f),m);if((s=(0|w(0|l))-(0|w(0|u))|0)>>>0<=30){a=e=s+1|0,t=u<<(l=31-s|0)|h>>>(e>>>0),e=u>>>(e>>>0),s=0,l=h<<l;break}return o?(n[o>>2]=0|t,n[o+4>>2]=0|c,m=0,0|(S(0|(f=0)),m)):(m=0,0|(S(0|(f=0)),m))}while(0);if(a){u=0|ke(0|(p=0|i),0|(h=0|d),-1,-1),i=0|T(),c=l,l=0;do{r=c,c=s>>>31|c<<1,s=l|s<<1,Ne(0|u,0|i,0|(r=t<<1|r>>>31),0|(d=t>>>31|e<<1)),l=1&(f=(m=0|T())>>31|((0|m)<0?-1:0)<<1),t=0|Ne(0|r,0|d,f&p,(((0|m)<0?-1:0)>>31|((0|m)<0?-1:0)<<1)&h),e=0|T(),a=a-1|0}while(0|a);u=c,c=0}else u=l,c=0,l=0;return a=0,0|o&&(n[o>>2]=t,n[o+4>>2]=e),m=s<<1&-2|l,0|(S(0|(f=(0|s)>>>31|(u|a)<<1|c)),m)}function Re(t,e,i,r){var n,o,s,a,l;return i|=0,o=(r|=0)>>31|((0|r)<0?-1:0)<<1,n=((0|r)<0?-1:0)>>31|((0|r)<0?-1:0)<<1,s=0|Ne((l=(e|=0)>>31|((0|e)<0?-1:0)<<1)^(t|=0),(a=((0|e)<0?-1:0)>>31|((0|e)<0?-1:0)<<1)^e,0|l,0|a),t=o^l,e=n^a,0|Ne(Oe(s,0|T(),0|Ne(o^i,n^r,0|o,0|n),0|T(),0)^t,T()^e,0|t,0|e)}function Fe(t,e,i,r){var n,o;return e|=0,r|=0,i=0|function(t,e){var i,r,n,o=0;return t=((i=0|v(o=65535&(e|=0),n=65535&(t|=0)))>>>16)+(0|v(o,r=t>>>16))|0,e=0|v(o=e>>>16,n),0|(S((t>>>16)+(0|v(o,r))+(((65535&t)+e|0)>>>16)|0),t+e<<16|65535&i)}(n=t|=0,o=i|=0),t=0|T(),0|(S((0|v(e,o))+(0|v(r,n))+t|0),i)}function ze(t,e,i,r){var o,s,a,l,c,u;return i|=0,o=k,k=k+16|0,l=0|o,u=(r|=0)>>31|((0|r)<0?-1:0)<<1,c=((0|r)<0?-1:0)>>31|((0|r)<0?-1:0)<<1,Oe(t=0|Ne((a=(e|=0)>>31|((0|e)<0?-1:0)<<1)^(t|=0),(s=((0|e)<0?-1:0)>>31|((0|e)<0?-1:0)<<1)^e,0|a,0|s),e=0|T(),0|Ne(u^i,c^r,0|u,0|c),0|T(),l),r=0|Ne(n[l>>2]^a,n[l+4>>2]^s,0|a,0|s),i=0|T(),k=o,0|(S(0|i),r)}function Be(t,e,i,r){var o,s;return s=k,k=k+16|0,Oe(t|=0,e|=0,i|=0,r|=0,o=0|s),k=s,0|(S(0|n[o+4>>2]),n[o>>2])}function Ue(t,e,i){return t|=0,e|=0,(0|(i|=0))<32?(S(e>>i),t>>>i|(e&(1<<i)-1)<<32-i):(S(0|((0|e)<0?-1:0)),e>>i-32)}function Ve(t,e,i){return t|=0,e|=0,(0|(i|=0))<32?(S(e>>>i|0),t>>>i|(e&(1<<i)-1)<<32-i):(S(0),e>>>i-32|0)}function je(t,e,i){return t|=0,(0|(i|=0))<32?(S((e|=0)<<i|(t&(1<<i)-1<<32-i)>>>32-i),t<<i):(S(t<<i-32),0)}function Ge(t,e){return e=+e,(t=+t)!=t?+e:e!=e?+t:+b(+t,+e)}function Ze(t,e){return e=+e,(t=+t)!=t?+e:e!=e?+t:+x(+t,+e)}function qe(t){return(t=+t)>=0?+l(t+.5):+A(t-.5)}function We(t,e,i){t|=0,e|=0;var o,s,a=0;if((0|(i|=0))>=8192)return I(0|t,0|e,0|i),0|t;if(s=0|t,o=t+i|0,(3&t)==(3&e)){for(;3&t;){if(!i)return 0|s;r[0|t]=0|r[0|e],t=t+1|0,e=e+1|0,i=i-1|0}for(a=(i=-4&o)-64|0;(0|t)<=(0|a);)n[t>>2]=n[e>>2],n[t+4>>2]=n[e+4>>2],n[t+8>>2]=n[e+8>>2],n[t+12>>2]=n[e+12>>2],n[t+16>>2]=n[e+16>>2],n[t+20>>2]=n[e+20>>2],n[t+24>>2]=n[e+24>>2],n[t+28>>2]=n[e+28>>2],n[t+32>>2]=n[e+32>>2],n[t+36>>2]=n[e+36>>2],n[t+40>>2]=n[e+40>>2],n[t+44>>2]=n[e+44>>2],n[t+48>>2]=n[e+48>>2],n[t+52>>2]=n[e+52>>2],n[t+56>>2]=n[e+56>>2],n[t+60>>2]=n[e+60>>2],t=t+64|0,e=e+64|0;for(;(0|t)<(0|i);)n[t>>2]=n[e>>2],t=t+4|0,e=e+4|0}else for(i=o-4|0;(0|t)<(0|i);)r[0|t]=0|r[0|e],r[t+1|0]=0|r[e+1|0],r[t+2|0]=0|r[e+2|0],r[t+3|0]=0|r[e+3|0],t=t+4|0,e=e+4|0;for(;(0|t)<(0|o);)r[0|t]=0|r[0|e],t=t+1|0,e=e+1|0;return 0|s}function He(t,e,i){e|=0;var o,s=0,a=0,l=0;if(o=(t|=0)+(i|=0)|0,e&=255,(0|i)>=67){for(;3&t;)r[0|t]=e,t=t+1|0;for(l=e|e<<8|e<<16|e<<24,a=(s=-4&o)-64|0;(0|t)<=(0|a);)n[t>>2]=l,n[t+4>>2]=l,n[t+8>>2]=l,n[t+12>>2]=l,n[t+16>>2]=l,n[t+20>>2]=l,n[t+24>>2]=l,n[t+28>>2]=l,n[t+32>>2]=l,n[t+36>>2]=l,n[t+40>>2]=l,n[t+44>>2]=l,n[t+48>>2]=l,n[t+52>>2]=l,n[t+56>>2]=l,n[t+60>>2]=l,t=t+64|0;for(;(0|t)<(0|s);)n[t>>2]=l,t=t+4|0}for(;(0|t)<(0|o);)r[0|t]=e,t=t+1|0;return o-i|0}function Je(t){return(t=+t)>=0?+l(t+.5):+A(t-.5)}function Ke(t){var e,i,r;return t|=0,r=0|E(),(0|t)>0&(0|(e=(i=0|n[a>>2])+t|0))<(0|i)|(0|e)<0?(P(0|e),M(12),-1):(0|e)>(0|r)&&!(0|L(0|e))?(M(12),-1):(n[a>>2]=e,0|i)}return{___divdi3:Re,___muldi3:Fe,___remdi3:ze,___uremdi3:Be,_areNeighborCells:function(t,e,i,r,o){o|=0;var s,a,l,c=0,u=0,h=0,p=0;if(l=k,k=k+64|0,a=l,s=l+56|0,!(!0&134217728==(2013265920&(e|=0))&!0&134217728==(2013265920&(r|=0))))return k=l,5;if((0|(t|=0))==(0|(i|=0))&(0|e)==(0|r))return n[o>>2]=0,k=l,0;if(u=0|Ve(0|t,0|e,52),T(),u&=15,p=0|Ve(0|i,0|r,52),T(),(0|u)!=(15&p))return k=l,12;if(c=u+-1|0,u>>>0>1){Ot(t,e,c,a),Ot(i,r,c,s),h=0|n[(p=a)>>2],p=0|n[p+4>>2];t:do{if((0|h)==(0|n[s>>2])&&(0|p)==(0|n[s+4>>2])){c=0|Ve(0|t,0|e,0|(u=3*(15^u)|0)),T(),c&=7,u=0|Ve(0|i,0|r,0|u),T(),u&=7;do{if(!(0|c)|!(0|u))n[o>>2]=1,c=0;else if(7==(0|c))c=5;else{if(1==(0|c)|1==(0|u)&&0|Ft(h,p)){c=5;break}if((0|n[15536+(c<<2)>>2])!=(0|u)&&(0|n[15568+(c<<2)>>2])!=(0|u))break t;n[o>>2]=1,c=0}}while(0);return k=l,0|c}}while(0)}u=(c=a)+56|0;do{n[c>>2]=0,c=c+4|0}while((0|c)<(0|u));return N(t,e,1,a),c=(0|n[(e=a)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)||(0|n[(e=a+8|0)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)||(0|n[(e=a+16|0)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)||(0|n[(e=a+24|0)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)||(0|n[(e=a+32|0)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)||(0|n[(e=a+40|0)>>2])==(0|i)&&(0|n[e+4>>2])==(0|r)?1:1&((0|n[(c=a+48|0)>>2])==(0|i)?(0|n[c+4>>2])==(0|r):0),n[o>>2]=c,k=l,0},_bitshift64Ashr:Ue,_bitshift64Lshr:Ve,_bitshift64Shl:je,_calloc:Pe,_cellAreaKm2:function(t,e,i){return 0|(t=0|re(t|=0,e|=0,i|=0))||(o[i>>3]=6371.007180918475*+o[i>>3]*6371.007180918475),0|t},_cellAreaM2:function(t,e,i){return 0|(t=0|re(t|=0,e|=0,i|=0))||(o[i>>3]=6371.007180918475*+o[i>>3]*6371.007180918475*1e3*1e3),0|t},_cellAreaRads2:re,_cellToBoundary:Jt,_cellToCenterChild:function(t,e,i,r){i|=0,r|=0;var o=0;return o=0|Ve(0|(t|=0),0|(e|=0),52),T(),(0|i)<16&(0|(o&=15))<=(0|i)?((0|o)<(0|i)&&(o=0|je(-1,-1,3+(3*(i+-1-o|0)|0)|0),o=0|je(0|~o,0|~T(),3*(15-i|0)|0),e=~T()&e,t&=~o),o=0|je(0|i,0,52),i=-15728641&e|T(),n[r>>2]=t|o,n[r+4>>2]=i,0|(r=0)):0|(r=4)},_cellToChildPos:function(t,e,i,r){i|=0,r|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0;if(o=k,k=k+16|0,y=o,A=0|Ve(0|(t|=0),0|(e|=0),52),T(),i>>>0>15)return k=o,4;if((0|(A&=15))<(0|i))return k=o,12;if((0|A)!=(0|i))if(a=0|je(0|i,0,52),a|=t,c=T()|-15728641&e,(0|A)>(0|i)){u=i;do{_=0|je(7,0,3*(14-u|0)|0),u=u+1|0,a|=_,c=T()|c}while((0|u)<(0|A));_=a}else _=a;else _=t,c=e;g=0|Ve(0|_,0|c,45),T();t:do{if(0|U(127&g)){if(u=0|Ve(0|_,0|c,52),T(),0|(u&=15))for(a=1;;){if(!(!((g=0|je(7,0,3*(15-a|0)|0))&_)&!(T()&c))){h=33;break t}if(!(a>>>0<u>>>0))break;a=a+1|0}if(n[(g=r)>>2]=0,n[g+4>>2]=0,(0|A)>(0|i)){for(g=-15728641&e,m=A;;){if(f=m,(m=m+-1|0)>>>0>15|(0|A)<(0|m)){h=19;break}if((0|A)!=(0|m))if(a=0|je(0|m,0,52),a|=t,u=T()|g,(0|A)<(0|f))d=a;else{h=m;do{d=0|je(7,0,3*(14-h|0)|0),h=h+1|0,a|=d,u=T()|u}while((0|h)<(0|A));d=a}else d=t,u=e;if(p=0|Ve(0|d,0|u,45),T(),0|U(127&p)){p=0|Ve(0|d,0|u,52),T(),p&=15;e:do{if(p)for(h=1;;){if(a=0|Ve(0|d,0|u,3*(15-h|0)|0),T(),0|(a&=7))break e;if(!(h>>>0<p>>>0)){a=0;break}h=h+1|0}else a=0}while(0);a=1&!(0|a)}else a=0;if(u=0|Ve(0|t,0|e,3*(15-f|0)|0),T(),7==(0|(u&=7))){s=5,h=42;break}if(1==(0|u)&(a=!!(0|a))){s=5,h=42;break}if(0|(d=u+((!!(0|u)&a)<<31>>31)|0)&&(h=0|he(7,0,h=A-f|0,((0|h)<0)<<31>>31),p=0|T(),a?(a=0|ke(0|(a=0|Fe(0|h,0|p,5,0)),0|T(),-5,-1),a=0|ke(0|(a=0|Re(0|a,0|T(),6,0)),0|T(),1,0),u=0|T()):(a=h,u=p),f=0|ke(0|a,0|u,0|(f=0|Fe(0|h,0|p,0|(f=d+-1|0),((0|f)<0)<<31>>31)),0|T()),p=0|ke(0|f,0|(d=0|T()),0|n[(p=r)>>2],0|n[p+4>>2]),d=0|T(),n[(f=r)>>2]=p,n[f+4>>2]=d),(0|m)<=(0|i)){h=37;break}}if(19==(0|h))C(23313,22674,1099,22710);else{if(37==(0|h)){s=0|n[(l=r)+4>>2],l=0|n[l>>2];break}if(42==(0|h))return k=o,0|s}}else s=0,l=0}else h=33}while(0);t:do{if(33==(0|h)){if(n[(g=r)>>2]=0,n[g+4>>2]=0,(0|A)>(0|i)){for(a=A;;){if(s=0|Ve(0|t,0|e,3*(15-a|0)|0),T(),7==(0|(s&=7))){s=5;break}if(s=0|Fe(0|(l=0|he(7,0,l=A-a|0,((0|l)<0)<<31>>31)),0|T(),0|s,0),l=0|T(),l=0|ke(0|n[(g=r)>>2],0|n[g+4>>2],0|s,0|l),s=0|T(),n[(g=r)>>2]=l,n[g+4>>2]=s,(0|(a=a+-1|0))<=(0|i))break t}return k=o,0|s}s=0,l=0}}while(0);return 0|Rt(_,c,A,y)&&C(23313,22674,1063,22725),((0|s)>-1|-1==(0|s)&l>>>0>4294967295)&((0|(y=0|n[(A=y)+4>>2]))>(0|s)|((0|y)==(0|s)?(0|n[A>>2])>>>0>l>>>0:0))?(k=o,0|(A=0)):(C(23313,22674,1139,22710),0)},_cellToChildren:function(t,e,i,r){r|=0;var o,s,a=0,l=0;if(s=k,k=k+16|0,$t(o=s,t|=0,e|=0,i|=0),!(0|(t=0|n[(e=o)>>2]))&!(0|(e=0|n[e+4>>2])))return k=s,0;a=0,i=0;do{n[(l=r+(a<<3)|0)>>2]=t,n[l+4>>2]=e,a=0|ke(0|a,0|i,1,0),i=0|T(),Yt(o),t=0|n[(l=o)>>2],e=0|n[l+4>>2]}while(!(!(0|t)&!(0|e)));return k=s,0},_cellToChildrenSize:Rt,_cellToLatLng:Ht,_cellToLocalIj:function(t,e,i,r,n,o){var s,a;return t|=0,o|=0,a=k,k=k+16|0,s=a,(n|=0)?t=15:(t=0|ce(t,e|=0,i|=0,r|=0,s))||(At(s,o),t=0),k=a,0|t},_cellToParent:Ot,_cellToVertex:ve,_cellToVertexes:function(t,e,i){i|=0;var r,o=0,s=0;return s=!(0|Ft(t|=0,e|=0)),r=!(0|(o=0|ve(t,e,0,i))),s?r?0|(o=0|ve(t,e,1,i+8|0))||0|(o=0|ve(t,e,2,i+16|0))||0|(o=0|ve(t,e,3,i+24|0))||(o=0|ve(t,e,4,i+32|0))?0|(s=o):0|ve(t,e,5,i+40|0):0|(s=o):r?0|(o=0|ve(t,e,1,i+8|0))||0|(o=0|ve(t,e,2,i+16|0))||0|(o=0|ve(t,e,3,i+24|0))||0|(o=0|ve(t,e,4,i+32|0))?0|(s=o):(n[(s=i+40|0)>>2]=0,n[s+4>>2]=0,0|(s=0)):0|(s=o)},_cellsToDirectedEdge:function(t,e,i,r,o){return o|=0,7==(0|(i=0|z(t|=0,e|=0,i|=0,r|=0)))?0|(o=11):(r=0|je(0|i,0,56),e=-2130706433&e|T()|268435456,n[o>>2]=t|r,n[o+4>>2]=e,0|(o=0))},_cellsToLinkedMultiPolygon:function(t,e,i){i|=0;var r,o,s,a=0;if(s=k,k=k+32|0,r=s,t=0|function(t,e,i){t|=0,i|=0;var r,o,s=0,a=0,l=0,c=0,u=0,h=0;if(o=k,k=k+176|0,r=o,(0|(e|=0))<1)return xe(i,0,0),k=o,0;for(u=0|Ve(0|n[(u=t)>>2],0|n[u+4>>2],52),T(),xe(i,(0|e)>6?e:6,15&u),u=0;!(0|(s=0|Jt(0|n[(s=t+(u<<3)|0)>>2],0|n[s+4>>2],r)));){if((0|(s=0|n[r>>2]))>0){c=0;do{l=r+8+(c<<4)|0,(a=0|Ce(i,s=r+8+((0|(c=c+1|0))%(0|s)<<4)|0,l))?Se(i,a):Te(i,l,s),s=0|n[r>>2]}while((0|c)<(0|s))}if((0|(u=u+1|0))>=(0|e)){s=0,h=13;break}}return 13==(0|h)?(k=o,0|s):(be(i),k=o,0|(h=s))}(t|=0,e|=0,o=s+16|0),0|t)return k=s,0|t;if(n[i>>2]=0,n[i+4>>2]=0,n[i+8>>2]=0,0|(t=0|we(o)))do{e=0|ne(i);do{oe(e,t),a=t+16|0,n[r>>2]=n[a>>2],n[r+4>>2]=n[a+4>>2],n[r+8>>2]=n[a+8>>2],n[r+12>>2]=n[a+12>>2],Se(o,t),t=0|Me(o,r)}while(0|t);t=0|we(o)}while(0|t);return be(o),(t=0|ae(i))?(se(i),k=s,0|(a=t)):(k=s,0|(a=0))},_childPosToCell:function(t,e,i,r,o,s){t|=0,e|=0,s|=0;var a,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0;if(a=k,k=k+16|0,l=a,(o|=0)>>>0>15)return k=a,4;if(c=0|Ve(0|(i|=0),0|(r|=0),52),T(),(0|(c&=15))>(0|o))return k=a,12;if(0|Rt(i,r,o,l)&&C(23313,22674,1063,22725),!(((0|e)>-1|-1==(0|e)&t>>>0>4294967295)&((0|(h=0|n[(p=l)+4>>2]))>(0|e)|((0|h)==(0|e)?(0|n[p>>2])>>>0>t>>>0:0))))return k=a,2;p=o-c|0,o=0|je(0|o,0,52),u=T()|-15728641&r,n[(h=s)>>2]=o|i,n[h+4>>2]=u,h=0|Ve(0|i,0|r,45),T();t:do{if(0|U(127&h)){if(0|c)for(l=1;;){if(!(!((h=0|je(7,0,3*(15-l|0)|0))&i)&!(T()&r)))break t;if(!(l>>>0<c>>>0))break;l=l+1|0}if((0|p)<1)return k=a,0;for(h=15^c,r=-1,u=1,l=1;;){c=0|he(7,0,c=p-u|0,((0|c)<0)<<31>>31),i=0|T();do{if(l){if(l=0|Re(0|(l=0|ke(0|(l=0|Fe(0|c,0|i,5,0)),0|T(),-5,-1)),0|T(),6,0),(0|e)>(0|(o=0|T()))|(0|e)==(0|o)&t>>>0>l>>>0){e=0|Ne(0|(e=0|ke(0|t,0|e,-1,-1)),0|T(),0|l,0|o),l=0|T(),m=0|n[(d=s)>>2],d=0|n[d+4>>2],f=0|je(7,0,0|(g=3*(h+r|0)|0)),d&=~T(),g=0|je(0|(o=0|ke(0|(r=0|Re(0|e,0|l,0|c,0|i)),0|(t=0|T()),2,0)),0|T(),0|g),d=T()|d,n[(o=s)>>2]=g|m&~f,n[o+4>>2]=d,t=0|Ne(0|e,0|l,0|(t=0|Fe(0|r,0|t,0|c,0|i)),0|T()),l=0,e=0|T();break}f=0|n[(g=s)>>2],g=0|n[g+4>>2],m=0|je(7,0,3*(h+r|0)|0),g&=~T(),n[(l=s)>>2]=f&~m,n[l+4>>2]=g,l=1;break}o=0|n[(f=s)>>2],f=0|n[f+4>>2],d=0|je(7,0,0|(r=3*(h+r|0)|0)),f&=~T(),r=0|je(0|(g=0|Re(0|t,0|e,0|c,0|i)),0|(l=0|T()),0|r),f=T()|f,n[(m=s)>>2]=r|o&~d,n[m+4>>2]=f,t=0|Ne(0|t,0|e,0|(l=0|Fe(0|g,0|l,0|c,0|i)),0|T()),l=0,e=0|T()}while(0);if(!((0|p)>(0|u))){e=0;break}r=~u,u=u+1|0}return k=a,0|e}}while(0);if((0|p)<1)return k=a,0;for(o=15^c,l=1;;){if(m=0|he(7,0,m=p-l|0,((0|m)<0)<<31>>31),g=0|T(),i=0|n[(u=s)>>2],u=0|n[u+4>>2],r=0|je(7,0,0|(c=3*(o-l|0)|0)),u&=~T(),c=0|je(0|(d=0|Re(0|t,0|e,0|m,0|g)),0|(f=0|T()),0|c),u=T()|u,n[(h=s)>>2]=c|i&~r,n[h+4>>2]=u,t=0|Ne(0|t,0|e,0|(g=0|Fe(0|d,0|f,0|m,0|g)),0|T()),e=0|T(),(0|p)<=(0|l)){e=0;break}l=l+1|0}return k=a,0|e},_compactCells:function(t,e,i,r){e|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,M=0;if(!(0|(i|=0))&!(0|(r|=0)))return 0;if(a=0|n[(s=t|=0)>>2],!0&!(15728640&(s=0|n[s+4>>2]))){if(!((0|r)>0|!(0|r)&i>>>0>0))return 0;if(n[(S=e)>>2]=a,n[S+4>>2]=s,1==(0|i)&!(0|r))return 0;s=1;do{w=0|n[4+(b=t+(s<<3)|0)>>2],n[(S=e+(s<<3)|0)>>2]=n[b>>2],n[S+4>>2]=w,s=s+1|0}while(0<(0|r)|!(0|r)&s>>>0<i>>>0);return 0}if(!(w=0|Ie(o=i<<3)))return 13;if(We(0|w,0|t,0|o),!(b=0|Pe(i,8)))return Le(w),13;t:do{if(0|i){e:for(;;){v=0|Ve(0|(A=0|n[(s=w)>>2]),0|(s=0|n[s+4>>2]),52),T(),x=(v&=15)-1|0,y=(0|i)>0;i:do{if(!!(0|v)&y){if(m=((0|i)<0)<<31>>31,g=0|je(0|x,0,52),_=0|T(),x>>>0>15){if(!(!(0|A)&!(0|s))){S=17;break e}for(a=0;;){if((0|(a=a+1|0))>=(0|i))break i;if(!(!(0|(_=0|n[(r=w+(a<<3)|0)>>2]))&!(0|(r=0|n[r+4>>2])))){s=r,S=17;break e}}}for(a=0,t=A,r=s;;){if(!(!(0|t)&!(0|r))){if(!(!0&!(117440512&r))){S=22;break e}if(c=0|Ve(0|t,0|r,52),T(),(0|(c&=15))<(0|x)){s=12,S=28;break e}if((0|c)!=(0|x)&&(t|=g,r=-15728641&r|_,c>>>0>=v>>>0)){l=x;do{f=0|je(7,0,3*(14-l|0)|0),l=l+1|0,t|=f,r=T()|r}while(l>>>0<c>>>0)}if(l=0|Be(0|t,0|r,0|i,0|m),T(),!(0|(u=0|n[(c=h=b+(l<<3)|0)>>2]))&!(0|(c=0|n[c+4>>2])))l=h;else for(f=0;;){if((0|f)>(0|i)){S=32;break e}if((0|u)==(0|t)&(-117440513&c)==(0|r)){p=0|Ve(0|u,0|c,56),T(),d=1+(p&=7)|0,M=0|Ve(0|u,0|c,45),T();r:do{if(0|U(127&M)){if(u=0|Ve(0|u,0|c,52),T(),!(u&=15)){c=6;break}for(c=1;;){if(!(!((M=0|je(7,0,3*(15-c|0)|0))&t)&!(T()&r))){c=7;break r}if(!(c>>>0<u>>>0)){c=6;break}c=c+1|0}}else c=7}while(0);if((p+2|0)>>>0>c>>>0){S=42;break e}M=0|je(0|d,0,56),r=T()|-117440513&r,n[(d=h)>>2]=0,n[d+4>>2]=0,t|=M}else l=(l+1|0)%(0|i)|0;if(!(0|(u=0|n[(c=h=b+(l<<3)|0)>>2]))&!(0|(c=0|n[c+4>>2]))){l=h;break}f=f+1|0}n[(M=l)>>2]=t,n[M+4>>2]=r}if((0|(a=a+1|0))>=(0|i))break i;t=0|n[(r=w+(a<<3)|0)>>2],r=0|n[r+4>>2]}}}while(0);if((i+5|0)>>>0<11){S=85;break}if(!(_=0|Pe((0|i)/6|0,8))){S=49;break}i:do{if(y){f=0,d=0;do{if(!(!(0|(a=0|n[(r=c=b+(f<<3)|0)>>2]))&!(0|(r=0|n[r+4>>2])))){u=0|Ve(0|a,0|r,56),T(),t=1+(u&=7)|0,h=-117440513&r,M=0|Ve(0|a,0|r,45),T();r:do{if(0|U(127&M)){if(p=0|Ve(0|a,0|r,52),T(),0|(p&=15))for(l=1;;){if(!(!(a&(M=0|je(7,0,3*(15-l|0)|0)))&!(h&T())))break r;if(!(l>>>0<p>>>0))break;l=l+1|0}a|=r=0|je(0|t,0,56),r=T()|h,n[(t=c)>>2]=a,n[t+4>>2]=r,t=u+2|0}}while(0);7==(0|t)&&(n[(M=_+(d<<3)|0)>>2]=a,n[M+4>>2]=-117440513&r,d=d+1|0)}f=f+1|0}while((0|f)!=(0|i));if(y){if(f=((0|i)<0)<<31>>31,m=0|je(0|x,0,52),g=0|T(),x>>>0>15){if(!(!(0|A)&!(0|s))){s=4,S=84;break e}for(s=0;;){if((0|(s=s+1|0))>=(0|i)){a=0,s=d;break i}if(!(!(0|n[(M=w+(s<<3)|0)>>2])&!(0|n[M+4>>2]))){s=4,S=84;break e}}}for(p=0,a=0,h=A;;){do{if(!(!(0|h)&!(0|s))){if(c=0|Ve(0|h,0|s,52),T(),(0|(c&=15))<(0|x)){s=12,S=84;break e}do{if((0|c)==(0|x))r=h,c=s;else{if(r=h|m,t=-15728641&s|g,c>>>0<v>>>0){c=t;break}l=x;do{M=0|je(7,0,3*(14-l|0)|0),l=l+1|0,r|=M,t=T()|t}while(l>>>0<c>>>0);c=t}}while(0);for(l=0|Be(0|r,0|c,0|i,0|f),T(),t=0;;){if((0|t)>(0|i)){S=77;break e}if((-117440513&(u=0|n[4+(M=b+(l<<3)|0)>>2]))==(0|c)&&(0|n[M>>2])==(0|r)){S=79;break}if((0|n[(M=b+((l=(l+1|0)%(0|i)|0)<<3)|0)>>2])==(0|r)&&(0|n[M+4>>2])==(0|c))break;t=t+1|0}if(79==(0|S)&&(S=0,!0&100663296==(117440512&u)))break;n[(M=e+(a<<3)|0)>>2]=h,n[M+4>>2]=s,a=a+1|0}}while(0);if((0|(s=p+1|0))>=(0|i)){s=d;break i}p=s,h=0|n[(M=w+(s<<3)|0)>>2],s=0|n[M+4>>2]}}else a=0,s=d}else a=0,s=0}while(0);if(He(0|b,0,0|o),We(0|w,0|_,s<<3),Le(_),!s)break t;e=e+(a<<3)|0,i=s}if(17==(0|S))!0&!(117440512&s)?(s=4,S=28):S=22;else if(32==(0|S))C(23313,22674,362,22684);else{if(42==(0|S))return Le(w),Le(b),10;if(49==(0|S))return Le(w),Le(b),13;if(77==(0|S))C(23313,22674,462,22684);else{if(84==(0|S))return Le(_),Le(w),Le(b),0|s;if(85==(0|S)){We(0|e,0|w,i<<3);break}}}if(22==(0|S))return Le(w),Le(b),5;if(28==(0|S))return Le(w),Le(b),0|s}}while(0);return Le(w),Le(b),0},_destroyLinkedMultiPolygon:se,_directedEdgeToBoundary:wt,_directedEdgeToCells:function(t,e,i){t|=0;var r,o,s,a=0;return r=k,k=k+16|0,a=r,!0&268435456==(2013265920&(e|=0))?(o=-2130706433&e|134217728,n[(s=i|=0)>>2]=t,n[s+4>>2]=o,n[a>>2]=0,e=0|Ve(0|t,0|e,56),T(),a=0|F(t,o,7&e,a,i+8|0),k=r,0|a):(k=r,0|(a=6))},_edgeLengthKm:function(t,e,i){i|=0;var r,s=0,a=0,l=0,c=0,h=0,f=0,m=0;if(r=k,k=k+176|0,0|(t=0|wt(t|=0,e|=0,c=r)))return c=t,l=+o[i>>3],l*=6371.007180918475,o[i>>3]=l,k=r,0|c;if(o[i>>3]=0,(0|(t=0|n[c>>2]))<=1)return c=0,l=0,l*=6371.007180918475,o[i>>3]=l,k=r,0|c;e=t+-1|0,t=0,s=+o[c+8>>3],a=+o[c+16>>3],l=0;do{f=s,s=+o[c+8+((t=t+1|0)<<4)>>3],m=+d(.5*(s-f)),h=a,a=+o[c+8+(t<<4)+8>>3],h=m*m+(h=+d(.5*(a-h)))*(+p(+f)*+p(+s)*h),l+=2*+y(+ +u(+h),+ +u(+(1-h)))}while((0|t)!=(0|e));return o[i>>3]=l,c=0,m=l,m*=6371.007180918475,o[i>>3]=m,k=r,0|c},_edgeLengthM:function(t,e,i){i|=0;var r,s=0,a=0,l=0,c=0,h=0,f=0,m=0;if(r=k,k=k+176|0,0|(t=0|wt(t|=0,e|=0,c=r)))return c=t,l=+o[i>>3],l*=6371.007180918475,l*=1e3,o[i>>3]=l,k=r,0|c;if(o[i>>3]=0,(0|(t=0|n[c>>2]))<=1)return c=0,l=0,l*=6371.007180918475,l*=1e3,o[i>>3]=l,k=r,0|c;e=t+-1|0,t=0,s=+o[c+8>>3],a=+o[c+16>>3],l=0;do{f=s,s=+o[c+8+((t=t+1|0)<<4)>>3],m=+d(.5*(s-f)),h=a,a=+o[c+8+(t<<4)+8>>3],h=m*m+(h=+d(.5*(a-h)))*(+p(+f)*+p(+s)*h),l+=2*+y(+ +u(+h),+ +u(+(1-h)))}while((0|t)!=(0|e));return o[i>>3]=l,c=0,m=l,m*=6371.007180918475,m*=1e3,o[i>>3]=m,k=r,0|c},_edgeLengthRads:function(t,e,i){i|=0;var r,s=0,a=0,l=0,c=0,h=0,f=0,m=0;if(r=k,k=k+176|0,0|(t=0|wt(t|=0,e|=0,c=r)))return k=r,0|t;if(o[i>>3]=0,(0|(t=0|n[c>>2]))<=1)return k=r,0;e=t+-1|0,t=0,s=+o[c+8>>3],a=+o[c+16>>3],l=0;do{f=s,s=+o[c+8+((t=t+1|0)<<4)>>3],m=+d(.5*(s-f)),h=a,a=+o[c+8+(t<<4)+8>>3],h=m*m+(h=+d(.5*(a-h)))*(+p(+s)*+p(+f)*h),l+=2*+y(+ +u(+h),+ +u(+(1-h)))}while((0|t)<(0|e));return o[i>>3]=l,k=r,0},_emscripten_replace_memory:function(t){return r=new Int8Array(t),new Uint8Array(t),n=new Int32Array(t),new Float32Array(t),o=new Float64Array(t),i=t,!0},_free:Le,_getBaseCellNumber:Nt,_getDirectedEdgeDestination:function(t,e,i){t|=0,e|=0,i|=0;var r,o,s=0;return r=k,k=k+16|0,n[(s=r)>>2]=0,!0&268435456==(2013265920&e)?(o=0|Ve(0|t,0|e,56),T(),s=0|F(t,-2130706433&e|134217728,7&o,s,i),k=r,0|s):(k=r,0|(s=6))},_getDirectedEdgeOrigin:function(t,e,i){return t|=0,i|=0,!0&268435456==(2013265920&(e|=0))?(n[i>>2]=t,n[i+4>>2]=-2130706433&e|134217728,0|(i=0)):0|(i=6)},_getHexagonAreaAvgKm2:function(t,e){return e|=0,(t|=0)>>>0>15?0|(e=4):(o[e>>3]=+o[20528+(t<<3)>>3],0|(e=0))},_getHexagonAreaAvgM2:function(t,e){return e|=0,(t|=0)>>>0>15?0|(e=4):(o[e>>3]=+o[20656+(t<<3)>>3],0|(e=0))},_getHexagonEdgeLengthAvgKm:function(t,e){return e|=0,(t|=0)>>>0>15?0|(e=4):(o[e>>3]=+o[20784+(t<<3)>>3],0|(e=0))},_getHexagonEdgeLengthAvgM:function(t,e){return e|=0,(t|=0)>>>0>15?0|(e=4):(o[e>>3]=+o[20912+(t<<3)>>3],0|(e=0))},_getIcosahedronFaces:function t(e,i,r){r|=0;var o,s=0,a=0,l=0,c=0,u=0,h=0,p=0,d=0;o=k,k=k+128|0,p=o+112|0,l=o+96|0,d=o,a=0|Ve(0|(e|=0),0|(i|=0),52),T(),u=15&a,n[p>>2]=u,c=0|Ve(0|e,0|i,45),T(),c&=127;t:do{if(0|U(c)){if(0|u)for(s=1;;){if(!(!((h=0|je(7,0,3*(15-s|0)|0))&e)&!(T()&i))){a=0;break t}if(!(s>>>0<u>>>0))break;s=s+1|0}if(!(1&a))return h=0|je(u+1|0,0,52),d=T()|-15728641&i,d=0|t((h|e)&~(p=0|je(7,0,3*(14-u|0)|0)),d&~T(),r),k=o,0|d;a=1}else a=0}while(0);if(!(s=0|Wt(e,i,l))){a?(Et(l,p,d),h=5):(kt(l,p,d),h=6);t:do{if(0|U(c))if(u)for(s=1;;){if(!(!((c=0|je(7,0,3*(15-s|0)|0))&e)&!(T()&i))){e=2;break t}if(!(s>>>0<u>>>0)){e=5;break}s=s+1|0}else e=5;else e=2}while(0);He(0|r,-1,e<<2);t:do{if(a)for(l=0;;){if(Lt(c=d+(l<<4)|0,0|n[p>>2]),c=0|n[c>>2],-1==(0|(u=0|n[r>>2]))|(0|u)==(0|c))s=r;else{a=0;do{if((a=a+1|0)>>>0>=e>>>0){s=1;break t}u=0|n[(s=r+(a<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|c)))}if(n[s>>2]=c,(l=l+1|0)>>>0>=h>>>0){s=0;break}}else for(l=0;;){if(It(c=d+(l<<4)|0,0|n[p>>2],0,1),c=0|n[c>>2],-1==(0|(u=0|n[r>>2]))|(0|u)==(0|c))s=r;else{a=0;do{if((a=a+1|0)>>>0>=e>>>0){s=1;break t}u=0|n[(s=r+(a<<2)|0)>>2]}while(!(-1==(0|u)|(0|u)==(0|c)))}if(n[s>>2]=c,(l=l+1|0)>>>0>=h>>>0){s=0;break}}}while(0)}return k=o,0|s},_getNumCells:ee,_getPentagons:Kt,_getRes0Cells:function(t){t|=0;var e=0,i=0,r=0;e=0;do{je(0|e,0,45),r=134225919|T(),n[(i=t+(e<<3)|0)>>2]=-1,n[i+4>>2]=r,e=e+1|0}while(122!=(0|e));return 0},_getResolution:function(t,e){return e=0|Ve(0|(t|=0),0|(e|=0),52),T(),15&e},_greatCircleDistanceKm:te,_greatCircleDistanceM:function(t,e){t|=0;var i,r,n,s=0;return r=+o[(e|=0)>>3],i=+o[t>>3],s=(n=+d(.5*(r-i)))*n+(s=+d(.5*(+o[e+8>>3]-+o[t+8>>3])))*(+p(+r)*+p(+i)*s),2*+y(+ +u(+s),+ +u(+(1-s)))*6371.007180918475*1e3},_greatCircleDistanceRads:function(t,e){t|=0;var i,r,n,s=0;return r=+o[(e|=0)>>3],i=+o[t>>3],s=(n=+d(.5*(r-i)))*n+(s=+d(.5*(+o[e+8>>3]-+o[t+8>>3])))*(+p(+r)*+p(+i)*s),2*+y(+ +u(+s),+ +u(+(1-s)))},_gridDisk:N,_gridDiskDistances:D,_gridDistance:function(t,e,i,r,o){i|=0,r|=0,o|=0;var s,a,l=0,c=0;return a=k,k=k+32|0,c=a,0|(s=0|ce(t|=0,e|=0,t,e,l=a+12|0))?(k=a,0|(c=s)):0|(t=0|ce(t,e,i,r,c))?(k=a,0|(c=t)):(l=0|yt(l,c),n[(c=o)>>2]=l,n[c+4>>2]=((0|l)<0)<<31>>31,k=a,0|(c=0))},_gridPathCells:function(t,e,i,r,o){i|=0,r|=0,o|=0;var s,a=0,l=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,M=0,E=0;if(s=k,k=k+48|0,u=s+12|0,M=s,!(a=0|ce(t|=0,e|=0,t,e,l=s+24|0))&&!(a=0|ce(t,e,i,r,u))){S=((0|(w=0|yt(l,u)))<0)<<31>>31,n[l>>2]=0,n[l+4>>2]=0,n[l+8>>2]=0,n[u>>2]=0,n[u+4>>2]=0,n[u+8>>2]=0,0|ce(t,e,t,e,l)&&C(23313,23090,691,23299),0|ce(t,e,i,r,u)&&C(23313,23090,696,23299),xt(l),xt(u),w?(_=+(0|w),b=l,r=f=0|n[l>>2],a=m=0|n[(v=l+4|0)>>2],i=g=0|n[(x=l+8|0)>>2],y=+((0|n[u>>2])-f|0)/_,A=+((0|n[u+4>>2])-m|0)/_,_=+((0|n[u+8>>2])-g|0)/_):(v=a=l+4|0,x=i=l+8|0,b=l,r=0|n[l>>2],a=0|n[a>>2],i=0|n[i>>2],y=0,A=0,_=0),n[M>>2]=r,n[(g=M+4|0)>>2]=a,n[(m=M+8|0)>>2]=i;t:do{if((0|w)<0)a=0;else for(d=0,f=0,a=r;;){E=y*(p=+(f>>>0)+4294967296*+(0|d))+ +(0|a),h=A*p+ +(0|n[v>>2]),p=_*p+ +(0|n[x>>2]),i=~~+qe(+E),l=~~+qe(+h),a=~~+qe(+p),E=+c(+(+(0|i)-E)),h=+c(+(+(0|l)-h)),p=+c(+(+(0|a)-p));do{if(!(E>h&E>p)){if(u=0-i|0,h>p){r=u-a|0;break}r=l,a=u-l|0;break}i=0-(l+a)|0,r=l}while(0);if(n[M>>2]=i,n[g>>2]=r,n[m>>2]=a,bt(M),0|(a=0|ue(t,e,M,o+(f<<3)|0)))break t;if(!((0|d)<(0|S)|(0|d)==(0|S)&f>>>0<w>>>0)){a=0;break t}a=0|ke(0|f,0|d,1,0),d=u=0|T(),f=a,a=0|n[b>>2]}}while(0);return k=s,0|a}return k=s,0|a},_gridPathCellsSize:function(t,e,i,r,o){i|=0,r|=0,o|=0;var s,a=0,l=0,c=0;return s=k,k=k+32|0,c=s,(a=0|ce(t|=0,e|=0,t,e,l=s+12|0))||(a=0|ce(t,e,i,r,c))?(k=s,0|(c=a)):(r=0|ke(0|(r=0|yt(l,c)),((0|r)<0)<<31>>31,1,0),l=0|T(),n[(c=o)>>2]=r,n[c+4>>2]=l,k=s,0|(c=0))},_gridRingUnsafe:function(t,e,i,r){t|=0,e|=0,i|=0,r|=0;var o,s,a=0,l=0,c=0,u=0,h=0,p=0,d=0,f=0,m=0;if(s=k,k=k+16|0,m=s+8|0,n[(f=o=s)>>2]=t,n[f+4>>2]=e,!i)return n[(m=r)>>2]=t,n[m+4>>2]=e,k=s,0;n[m>>2]=0;t:do{if(0|Ft(t,e))t=9;else{if(l=(0|i)>0){a=0,f=t;do{if(0|(t=0|F(f,e,4,m,o)))break t;if(a=a+1|0,0|Ft(f=0|n[(e=o)>>2],e=0|n[e+4>>2])){t=9;break t}}while((0|a)<(0|i));if(n[(d=r)>>2]=f,n[d+4>>2]=e,d=i+-1|0,l){p=0,t=1;do{if(a=22384+(p<<2)|0,5==(0|p))for(c=0|n[a>>2],l=0,a=t;;){if(0|(t=0|F(0|n[(t=o)>>2],0|n[t+4>>2],c,m,o)))break t;if((0|l)!=(0|d)){if(u=0|n[(h=o)>>2],h=0|n[h+4>>2],n[(t=r+(a<<3)|0)>>2]=u,n[t+4>>2]=h,0|Ft(u,h)){t=9;break t}t=a+1|0}else t=a;if((0|(l=l+1|0))>=(0|i))break;a=t}else for(c=o,h=0|n[a>>2],u=0,a=t,l=0|n[c>>2],c=0|n[c+4>>2];;){if(0|(t=0|F(l,c,h,m,o)))break t;if(l=0|n[(c=o)>>2],c=0|n[c+4>>2],n[(t=r+(a<<3)|0)>>2]=l,n[t+4>>2]=c,t=a+1|0,0|Ft(l,c)){t=9;break t}if((0|(u=u+1|0))>=(0|i))break;a=t}p=p+1|0}while(p>>>0<6);c=f,a=0|n[(t=o)>>2],l=e,t=0|n[t+4>>2]}else c=f,a=f,l=e,t=e}else n[(c=r)>>2]=t,n[c+4>>2]=e,c=t,a=t,l=e,t=e;t=(0|c)==(0|a)&(0|l)==(0|t)?0:9}}while(0);return k=s,0|t},_i64Add:ke,_i64Subtract:Ne,_isPentagon:Ft,_isResClassIII:function(t,e){return e=0|Ve(0|(t|=0),0|(e|=0),52),T(),1&e},_isValidCell:Dt,_isValidDirectedEdge:function(t,e){var i=0;switch(i=0|Ve(0|(t|=0),0|(e|=0),56),T(),7&i){case 0:case 7:return 0}return i=-2130706433&e|134217728,!0&268435456==(2013265920&e)?!0&16777216==(117440512&e)&!!(0|Ft(t,i))?0|(i=0):0|(i=0|Dt(t,i)):0|(i=0)},_isValidVertex:function(t,e){t|=0;var i,r,o=0,s=0;return r=k,k=k+16|0,i=r,!0&536870912==(2013265920&(e|=0))&&0|Dt(t,o=-2130706433&e|134217728)?(s=0|Ve(0|t,0|e,56),T(),o=(s=!(0|ve(t,o,7&s,i)))&((0|n[(o=i)>>2])==(0|t)?(0|n[o+4>>2])==(0|e):0)&1,k=r,0|o):(k=r,0|(o=0))},_latLngToCell:Zt,_llvm_maxnum_f64:Ge,_llvm_minnum_f64:Ze,_llvm_round_f64:qe,_localIjToCell:function(t,e,i,r,n){var o,s;return t|=0,e|=0,i|=0,n|=0,s=k,k=k+16|0,o=s,(r|=0)?i=15:(i=0|vt(i,o))||(i=0|ue(t,e,o,n)),k=s,0|i},_malloc:Ie,_maxFaceCount:function(t,e,i){i|=0;var r=0,o=0;if(o=0|Ve(0|(t|=0),0|(e|=0),45),T(),!(0|U(127&o)))return o=2,n[i>>2]=o,0;if(o=0|Ve(0|t,0|e,52),T(),!(o&=15))return o=5,n[i>>2]=o,0;for(r=1;;){if(!(!(je(7,0,3*(15-r|0)|0)&t)&!(T()&e))){r=2,t=6;break}if(!(r>>>0<o>>>0)){r=5,t=6;break}r=r+1|0}return 6==(0|t)?(n[i>>2]=r,0):0},_maxGridDiskSize:function(t,e){e|=0;var i=0,r=0,o=0;return(0|(t|=0))<0?0|(e=2):(0|t)>13780509?0|(e=0|ee(15,e)):(o=0|Fe(0|t,0|(i=((0|t)<0)<<31>>31),3,0),r=0|T(),i=0|ke(0|t,0|i,1,0),i=0|ke(0|(i=0|Fe(0|o,0|r,0|i,0|T())),0|T(),1,0),t=0|T(),n[e>>2]=i,n[e+4>>2]=t,0|(e=0))},_maxPolygonToCellsSize:function(t,e,i,r){e|=0,r|=0;var o,s=0,a=0,l=0,c=0,u=0;if(o=k,k=k+48|0,s=o+16|0,a=o+8|0,l=o,0|(i|=0))return k=o,15;if(c=0|n[4+(u=t|=0)>>2],n[(i=a)>>2]=n[u>>2],n[i+4>>2]=c,de(a,s),!(e=0|K(s,e,l))){if(i=0|n[a>>2],(0|(a=0|n[t+8>>2]))>0){s=0|n[t+12>>2],e=0;do{i=(0|n[s+(e<<3)>>2])+i|0,e=e+1|0}while((0|e)<(0|a))}s=0|n[(e=l)>>2],(0|(e=0|n[e+4>>2]))<(0|(a=((0|i)<0)<<31>>31))|(0|e)==(0|a)&s>>>0<i>>>0?(n[(e=l)>>2]=i,n[e+4>>2]=a,e=a):i=s,c=0|ke(0|i,0|e,12,0),u=0|T(),n[(e=l)>>2]=c,n[e+4>>2]=u,n[(e=r)>>2]=c,n[e+4>>2]=u,e=0}return k=o,0|e},_memcpy:We,_memset:He,_originToDirectedEdges:function(t,e,i){i|=0;var r,o=0;return r=!(0|Ft(t|=0,e|=0)),e&=-2130706433,n[(o=i)>>2]=r?t:0,n[o+4>>2]=r?285212672|e:0,n[(o=i+8|0)>>2]=t,n[o+4>>2]=301989888|e,n[(o=i+16|0)>>2]=t,n[o+4>>2]=318767104|e,n[(o=i+24|0)>>2]=t,n[o+4>>2]=335544320|e,n[(o=i+32|0)>>2]=t,n[o+4>>2]=352321536|e,n[(i=i+40|0)>>2]=t,n[i+4>>2]=369098752|e,0},_pentagonCount:function(){return 12},_polygonToCells:function(t,e,i,r){e|=0,r|=0;var o,s,a,l,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,C=0,M=0,E=0,I=0,L=0,P=0,N=0,D=0,F=0,z=0,U=0;if(l=k,k=k+112|0,o=l+80|0,d=l+72|0,s=l,a=l+56|0,0|(i|=0))return k=l,15;if(!(U=0|Ie(32+(n[(f=8+(t|=0)|0)>>2]<<5)|0)))return k=l,13;if(fe(t,U),z=0|n[(F=t)+4>>2],n[(i=d)>>2]=n[F>>2],n[i+4>>2]=z,de(d,o),i=0|K(o,e,s))F=0,z=0;else{if(i=0|n[d>>2],(0|(u=0|n[f>>2]))>0){h=0|n[t+12>>2],c=0;do{i=(0|n[h+(c<<3)>>2])+i|0,c=c+1|0}while((0|c)!=(0|u));c=i}else c=i;u=0|n[(i=s)>>2],(0|(i=0|n[i+4>>2]))<(0|(h=((0|c)<0)<<31>>31))|(0|i)==(0|h)&u>>>0<c>>>0?(n[(i=s)>>2]=c,n[i+4>>2]=h,i=h):c=u,F=0|ke(0|c,0|i,12,0),z=0|T(),n[(i=s)>>2]=F,n[i+4>>2]=z,i=0}if(0|i)return Le(U),k=l,0|i;if(!(c=0|Pe(F,8)))return Le(U),k=l,13;if(!(p=0|Pe(F,8)))return Le(U),Le(c),k=l,13;n[(N=o)>>2]=0,n[N+4>>2]=0,D=0|n[(N=t)+4>>2],n[(i=d)>>2]=n[N>>2],n[i+4>>2]=D,i=0|B(d,F,z,e,o,c,p);t:do{if(i)Le(c),Le(p),Le(U);else{e:do{if((0|n[f>>2])>0){for(h=t+12|0,u=0;i=0|B((0|n[h>>2])+(u<<3)|0,F,z,e,o,c,p),u=u+1|0,!(0|i);)if((0|u)>=(0|n[f>>2]))break e;Le(c),Le(p),Le(U);break t}}while(0);(0|z)>0|!(0|z)&F>>>0>0&&He(0|p,0,F<<3),N=0|n[(D=o)+4>>2];e:do{if((0|N)>0|!(0|N)&(0|n[D>>2])>>>0>0){I=c,L=p,P=c,N=p,D=c,i=c,C=c,M=p,E=p,c=p;i:for(;;){for(x=0,b=0,w=0,S=0,u=0,h=0;;){d=(p=s)+56|0;do{n[p>>2]=0,p=p+4|0}while((0|p)<(0|d));if(0|O(f=0|n[(e=I+(x<<3)|0)>>2],e=0|n[e+4>>2],1,s,0)){d=(p=s)+56|0;do{n[p>>2]=0,p=p+4|0}while((0|p)<(0|d));0|(p=0|Pe(7,4))&&(R(f,e,1,s,p,7,0,0),Le(p))}for(v=0;;){y=0|n[(A=s+(v<<3)|0)>>2],A=0|n[A+4>>2];r:do{if(!(0|y)&!(0|A))p=u,d=h;else{if(m=0|Be(0|y,0|A,0|F,0|z),f=0|T(),!(!(0|(d=0|n[(e=p=r+(m<<3)|0)>>2]))&!(0|(e=0|n[e+4>>2])))){g=0,_=0;do{if((0|g)>(0|z)|(0|g)==(0|z)&_>>>0>F>>>0)break i;if((0|d)==(0|y)&(0|e)==(0|A)){p=u,d=h;break r}m=0|ze(0|(p=0|ke(0|m,0|f,1,0)),0|T(),0|F,0|z),f=0|T(),_=0|ke(0|_,0|g,1,0),g=0|T(),d=0|n[(e=p=r+(m<<3)|0)>>2],e=0|n[e+4>>2]}while(!(!(0|d)&!(0|e)))}!(0|y)&!(0|A)?(p=u,d=h):(Ht(y,A,a),0|me(t,U,a)&&(_=0|ke(0|u,0|h,1,0),h=0|T(),n[(g=p)>>2]=y,n[g+4>>2]=A,n[(u=L+(u<<3)|0)>>2]=y,n[u+4>>2]=A,u=_),p=u,d=h)}}while(0);if((v=v+1|0)>>>0>=7)break;u=p,h=d}if(x=0|ke(0|x,0|b,1,0),b=0|T(),w=0|ke(0|w,0|S,1,0),S=0|T(),u=0|n[(h=o)>>2],!((0|S)<(0|(h=0|n[h+4>>2]))|(0|S)==(0|h)&w>>>0<u>>>0))break;u=p,h=d}if((0|h)>0|!(0|h)&u>>>0>0){u=0,h=0;do{n[(S=I+(u<<3)|0)>>2]=0,n[S+4>>2]=0,u=0|ke(0|u,0|h,1,0),h=0|T(),w=0|n[(S=o)+4>>2]}while((0|h)<(0|w)|((0|h)==(0|w)?u>>>0<(0|n[S>>2])>>>0:0))}if(n[(S=o)>>2]=p,n[S+4>>2]=d,!((0|d)>0|!(0|d)&p>>>0>0))break e;v=c,x=E,b=D,w=M,S=L,c=C,E=i,M=P,C=v,i=x,D=N,N=b,P=w,L=I,I=S}Le(P),Le(N),Le(U),i=1;break t}i=p}while(0);Le(U),Le(c),Le(i),i=0}}while(0);return k=l,0|i},_readInt64AsDoubleFromPointer:function(t){return+(+((0|n[(t|=0)>>2])>>>0)+4294967296*+(0|n[t+4>>2]))},_res0CellCount:function(){return 122},_round:Je,_sbrk:Ke,_sizeOfCellBoundary:function(){return 168},_sizeOfCoordIJ:function(){return 8},_sizeOfGeoLoop:function(){return 8},_sizeOfGeoPolygon:function(){return 16},_sizeOfH3Index:function(){return 8},_sizeOfLatLng:function(){return 16},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompactCells:function(t,e,i,r,o,s,a){t|=0,r|=0,o|=0,s|=0;var l,c=0,u=0,h=0,p=0,d=0,f=0,m=0,g=0;if(l=k,k=k+16|0,g=l,!((0|(i|=0))>0|!(0|i)&(e|=0)>>>0>0))return k=l,0;if((0|(a|=0))>=16)return k=l,12;f=0,m=0,d=0,c=0;t:for(;;){if(p=0|Ve(0|(u=0|n[(h=t+(f<<3)|0)>>2]),0|(h=0|n[h+4>>2]),52),T(),(15&p)>(0|a)){c=12,u=11;break}if($t(g,u,h,a),!(0|(h=0|n[(p=g)>>2]))&!(0|(p=0|n[p+4>>2])))u=d;else{u=d;do{if(!((0|c)<(0|s)|(0|c)==(0|s)&u>>>0<o>>>0)){u=10;break t}n[(d=r+(u<<3)|0)>>2]=h,n[d+4>>2]=p,u=0|ke(0|u,0|c,1,0),c=0|T(),Yt(g),h=0|n[(d=g)>>2],p=0|n[d+4>>2]}while(!(!(0|h)&!(0|p)))}if(f=0|ke(0|f,0|m,1,0),!((0|(m=0|T()))<(0|i)|(0|m)==(0|i)&f>>>0<e>>>0)){c=0,u=11;break}d=u}return 10==(0|u)?(k=l,0|(g=14)):11==(0|u)?(k=l,0|c):0},_uncompactCellsSize:function(t,e,i,r,o){t|=0,e|=0,i|=0,r|=0,o|=0;var s,a,l=0,c=0,u=0,h=0,p=0,d=0;a=k,k=k+16|0,s=a;t:do{if((0|i)>0|!(0|i)&e>>>0>0){for(p=0,c=0,l=0,d=0;;){if(!(!(0|(u=0|n[(h=t+(p<<3)|0)>>2]))&!(0|(h=0|n[h+4>>2]))||(h=!(0|Rt(u,h,r,s)),c=0|ke(0|n[(u=s)>>2],0|n[u+4>>2],0|c,0|l),l=0|T(),h))){l=12;break}if(p=0|ke(0|p,0|d,1,0),!((0|(d=0|T()))<(0|i)|(0|d)==(0|i)&p>>>0<e>>>0))break t}return k=a,0|l}c=0,l=0}while(0);return n[o>>2]=c,n[o+4>>2]=l,k=a,0},_vertexToLatLng:function(t,e,i){i|=0;var r,o,s,a,l=0,c=0;return a=k,k=k+192|0,o=a,s=a+168|0,l=0|Ve(0|(t|=0),0|(e|=0),56),T(),l&=7,0|(r=0|Wt(t,c=-2130706433&e|134217728,s))?(k=a,0|(c=r)):(e=0|Ve(0|t,0|e,52),T(),e&=15,0|Ft(t,c)?Mt(s,e,l,1,o):Pt(s,e,l,1,o),c=o+8|0,n[i>>2]=n[c>>2],n[i+4>>2]=n[c+4>>2],n[i+8>>2]=n[c+8>>2],n[i+12>>2]=n[c+12>>2],k=a,0|(c=0))},establishStackSpace:function(t,e){k=t|=0},stackAlloc:function(t){var e;return e=k,k=15+(k=k+(t|=0)|0)&-16,0|e},stackRestore:function(t){k=t|=0},stackSave:function(){return 0|k}}}({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:ot,b:function(t){c=t},c:function(){return c},d:function(t,e,i,r){ot("Assertion failed: "+v(t)+", at: "+[e?v(e):"unknown filename",i,r?v(r):"unknown function"])},e:function(t){return i.___errno_location&&(g[i.___errno_location()>>2]=t),t},f:G,g:function(t,e,i){f.set(f.subarray(e,e+i),t)},h:function(t){var e=G(),i=16777216,r=2130706432;if(t>r)return!1;for(var n=Math.max(e,16777216);n<t;)n=n<=536870912?x(2*n,i):Math.min(x((3*n+2147483648)/4,i),r);return!!Z(n)},i:function(t){ot("OOM")},j:function(t){return t},k:V,l:Z,m:j,n:function(){var t=j();return i.extraStackTrace&&(t+="\n"+i.extraStackTrace()),V(t)},o:24144,p:24128},p),$=(i.___divdi3=K.___divdi3,i.___muldi3=K.___muldi3,i.___remdi3=K.___remdi3,i.___uremdi3=K.___uremdi3,i._areNeighborCells=K._areNeighborCells,i._bitshift64Ashr=K._bitshift64Ashr,i._bitshift64Lshr=K._bitshift64Lshr,i._bitshift64Shl=K._bitshift64Shl,i._calloc=K._calloc,i._cellAreaKm2=K._cellAreaKm2,i._cellAreaM2=K._cellAreaM2,i._cellAreaRads2=K._cellAreaRads2,i._cellToBoundary=K._cellToBoundary,i._cellToCenterChild=K._cellToCenterChild,i._cellToChildPos=K._cellToChildPos,i._cellToChildren=K._cellToChildren,i._cellToChildrenSize=K._cellToChildrenSize,i._cellToLatLng=K._cellToLatLng,i._cellToLocalIj=K._cellToLocalIj,i._cellToParent=K._cellToParent,i._cellToVertex=K._cellToVertex,i._cellToVertexes=K._cellToVertexes,i._cellsToDirectedEdge=K._cellsToDirectedEdge,i._cellsToLinkedMultiPolygon=K._cellsToLinkedMultiPolygon,i._childPosToCell=K._childPosToCell,i._compactCells=K._compactCells,i._destroyLinkedMultiPolygon=K._destroyLinkedMultiPolygon,i._directedEdgeToBoundary=K._directedEdgeToBoundary,i._directedEdgeToCells=K._directedEdgeToCells,i._edgeLengthKm=K._edgeLengthKm,i._edgeLengthM=K._edgeLengthM,i._edgeLengthRads=K._edgeLengthRads,i._emscripten_replace_memory=K._emscripten_replace_memory),Y=(i._free=K._free,i._getBaseCellNumber=K._getBaseCellNumber,i._getDirectedEdgeDestination=K._getDirectedEdgeDestination,i._getDirectedEdgeOrigin=K._getDirectedEdgeOrigin,i._getHexagonAreaAvgKm2=K._getHexagonAreaAvgKm2,i._getHexagonAreaAvgM2=K._getHexagonAreaAvgM2,i._getHexagonEdgeLengthAvgKm=K._getHexagonEdgeLengthAvgKm,i._getHexagonEdgeLengthAvgM=K._getHexagonEdgeLengthAvgM,i._getIcosahedronFaces=K._getIcosahedronFaces,i._getNumCells=K._getNumCells,i._getPentagons=K._getPentagons,i._getRes0Cells=K._getRes0Cells,i._getResolution=K._getResolution,i._greatCircleDistanceKm=K._greatCircleDistanceKm,i._greatCircleDistanceM=K._greatCircleDistanceM,i._greatCircleDistanceRads=K._greatCircleDistanceRads,i._gridDisk=K._gridDisk,i._gridDiskDistances=K._gridDiskDistances,i._gridDistance=K._gridDistance,i._gridPathCells=K._gridPathCells,i._gridPathCellsSize=K._gridPathCellsSize,i._gridRingUnsafe=K._gridRingUnsafe,i._i64Add=K._i64Add,i._i64Subtract=K._i64Subtract,i._isPentagon=K._isPentagon,i._isResClassIII=K._isResClassIII,i._isValidCell=K._isValidCell,i._isValidDirectedEdge=K._isValidDirectedEdge,i._isValidVertex=K._isValidVertex,i._latLngToCell=K._latLngToCell,i._llvm_maxnum_f64=K._llvm_maxnum_f64,i._llvm_minnum_f64=K._llvm_minnum_f64,i._llvm_round_f64=K._llvm_round_f64,i._localIjToCell=K._localIjToCell,i._malloc=K._malloc,i._maxFaceCount=K._maxFaceCount,i._maxGridDiskSize=K._maxGridDiskSize,i._maxPolygonToCellsSize=K._maxPolygonToCellsSize,i._memcpy=K._memcpy,i._memset=K._memset,i._originToDirectedEdges=K._originToDirectedEdges,i._pentagonCount=K._pentagonCount,i._polygonToCells=K._polygonToCells,i._readInt64AsDoubleFromPointer=K._readInt64AsDoubleFromPointer,i._res0CellCount=K._res0CellCount,i._round=K._round,i._sbrk=K._sbrk,i._sizeOfCellBoundary=K._sizeOfCellBoundary,i._sizeOfCoordIJ=K._sizeOfCoordIJ,i._sizeOfGeoLoop=K._sizeOfGeoLoop,i._sizeOfGeoPolygon=K._sizeOfGeoPolygon,i._sizeOfH3Index=K._sizeOfH3Index,i._sizeOfLatLng=K._sizeOfLatLng,i._sizeOfLinkedGeoPolygon=K._sizeOfLinkedGeoPolygon,i._uncompactCells=K._uncompactCells,i._uncompactCellsSize=K._uncompactCellsSize,i._vertexToLatLng=K._vertexToLatLng,i.establishStackSpace=K.establishStackSpace,i.stackAlloc=K.stackAlloc),X=i.stackRestore=K.stackRestore,Q=i.stackSave=K.stackSave;if(i.asm=K,i.cwrap=function(t,e,i,r){var n=(i=i||[]).every((function(t){return"number"===t}));return"string"!==e&&n&&!r?h(t):function(){return function(t,e,i,r,n){var o={string:function(t){var e=0;if(null!=t&&0!==t){var i=1+(t.length<<2);!function(t,e,i){!function(t,e,i,r){if(!(r>0))return 0;for(var n=i+r-1,o=0;o<t.length;++o){var s=t.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&t.charCodeAt(++o)),s<=127){if(i>=n)break;e[i++]=s}else if(s<=2047){if(i+1>=n)break;e[i++]=192|s>>6,e[i++]=128|63&s}else if(s<=65535){if(i+2>=n)break;e[i++]=224|s>>12,e[i++]=128|s>>6&63,e[i++]=128|63&s}else{if(i+3>=n)break;e[i++]=240|s>>18,e[i++]=128|s>>12&63,e[i++]=128|s>>6&63,e[i++]=128|63&s}}e[i]=0}(t,f,e,i)}(t,e=Y(i),i)}return e},array:function(t){var e=Y(t.length);return function(t,e){d.set(t,e)}(t,e),e}},s=h(t),a=[],l=0;if(r)for(var c=0;c<r.length;c++){var u=o[i[c]];u?(0===l&&(l=Q()),a[c]=u(r[c])):a[c]=r[c]}var p=s.apply(null,a);return p=function(t){return"string"===e?v(t):"boolean"===e?Boolean(t):t}(p),0!==l&&X(l),p}(t,e,i,arguments)}},i.setValue=function(t,e,i,r){switch("*"===(i=i||"i8").charAt(i.length-1)&&(i="i32"),i){case"i1":case"i8":d[0|t]=e;break;case"i16":m[t>>1]=e;break;case"i32":g[t>>2]=e;break;case"i64":F=[e>>>0,(R=e,+I(R)>=1?R>0?(0|k(+P(R/4294967296),4294967295))>>>0:~~+L((R-+(~~R>>>0))/4294967296)>>>0:0)],g[t>>2]=F[0],g[t+4>>2]=F[1];break;case"float":_[t>>2]=e;break;case"double":y[t>>3]=e;break;default:ot("invalid type for setValue: "+i)}},i.getValue=function(t,e,i){switch("*"===(e=e||"i8").charAt(e.length-1)&&(e="i32"),e){case"i1":case"i8":return d[0|t];case"i16":return m[t>>1];case"i32":case"i64":return g[t>>2];case"float":return _[t>>2];case"double":return y[t>>3];default:ot("invalid type for getValue: "+e)}return null},z){U(z)||(J=z,z=i.locateFile?i.locateFile(J,s):s+J),N++,i.monitorRunDependencies&&i.monitorRunDependencies(N);var tt=function(t){t.byteLength&&(t=new Uint8Array(t)),f.set(t,8),i.memoryInitializerRequest&&delete i.memoryInitializerRequest.response,function(t){if(N--,i.monitorRunDependencies&&i.monitorRunDependencies(N),0==N&&(null!==D&&(clearInterval(D),D=null),O)){var e=O;O=null,e()}}()},et=function(){n(z,tt,(function(){throw"could not load memory initializer "+z}))},it=W(z);if(it)tt(it.buffer);else if(i.memoryInitializerRequest){var rt=function(){var t=i.memoryInitializerRequest,e=t.response;if(200!==t.status&&0!==t.status){var r=W(i.memoryInitializerRequestURL);if(!r)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+t.status+", retrying "+z),void et();e=r.buffer}tt(e)};i.memoryInitializerRequest.response?setTimeout(rt,0):i.memoryInitializerRequest.addEventListener("load",rt)}else et()}function nt(t){function e(){H||(H=!0,u||(S(C),S(M),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),E.unshift(t);var t;S(E)}()))}t=t||o,N>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),T.unshift(t);var t;S(T)}(),N>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),e()}),1)):e()))}function ot(t){throw i.onAbort&&i.onAbort(t),a(t+=""),l(t),u=!0,"abort("+t+"). Build with -s ASSERTIONS=1 for more info."}if(O=function t(){H||nt(),H||(O=t)},i.run=nt,i.abort=ot,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return nt(),t}("object"==typeof r?r:{}),n="number",o=[["sizeOfH3Index",n],["sizeOfLatLng",n],["sizeOfCellBoundary",n],["sizeOfGeoLoop",n],["sizeOfGeoPolygon",n],["sizeOfLinkedGeoPolygon",n],["sizeOfCoordIJ",n],["readInt64AsDoubleFromPointer",n],["isValidCell",n,[n,n]],["latLngToCell",n,[n,n,n,n]],["cellToLatLng",n,[n,n,n]],["cellToBoundary",n,[n,n,n]],["maxGridDiskSize",n,[n,n]],["gridDisk",n,[n,n,n,n]],["gridDiskDistances",n,[n,n,n,n,n]],["gridRingUnsafe",n,[n,n,n,n]],["maxPolygonToCellsSize",n,[n,n,n,n]],["polygonToCells",n,[n,n,n,n]],["cellsToLinkedMultiPolygon",n,[n,n,n]],["destroyLinkedMultiPolygon",null,[n]],["compactCells",n,[n,n,n,n]],["uncompactCells",n,[n,n,n,n,n,n]],["uncompactCellsSize",n,[n,n,n,n,n]],["isPentagon",n,[n,n]],["isResClassIII",n,[n,n]],["getBaseCellNumber",n,[n,n]],["getResolution",n,[n,n]],["maxFaceCount",n,[n,n,n]],["getIcosahedronFaces",n,[n,n,n]],["cellToParent",n,[n,n,n,n]],["cellToChildren",n,[n,n,n,n]],["cellToCenterChild",n,[n,n,n,n]],["cellToChildrenSize",n,[n,n,n,n]],["cellToChildPos",n,[n,n,n,n]],["childPosToCell",n,[n,n,n,n,n,n]],["areNeighborCells",n,[n,n,n,n,n]],["cellsToDirectedEdge",n,[n,n,n,n,n]],["getDirectedEdgeOrigin",n,[n,n,n]],["getDirectedEdgeDestination",n,[n,n,n]],["isValidDirectedEdge",n,[n,n]],["directedEdgeToCells",n,[n,n,n]],["originToDirectedEdges",n,[n,n,n]],["directedEdgeToBoundary",n,[n,n,n]],["gridDistance",n,[n,n,n,n,n]],["gridPathCells",n,[n,n,n,n,n]],["gridPathCellsSize",n,[n,n,n,n,n]],["cellToLocalIj",n,[n,n,n,n,n,n]],["localIjToCell",n,[n,n,n,n,n]],["getHexagonAreaAvgM2",n,[n,n]],["getHexagonAreaAvgKm2",n,[n,n]],["getHexagonEdgeLengthAvgM",n,[n,n]],["getHexagonEdgeLengthAvgKm",n,[n,n]],["greatCircleDistanceM",n,[n,n]],["greatCircleDistanceKm",n,[n,n]],["greatCircleDistanceRads",n,[n,n]],["cellAreaM2",n,[n,n,n]],["cellAreaKm2",n,[n,n,n]],["cellAreaRads2",n,[n,n,n]],["edgeLengthM",n,[n,n,n]],["edgeLengthKm",n,[n,n,n]],["edgeLengthRads",n,[n,n,n]],["getNumCells",n,[n,n]],["getRes0Cells",n,[n]],["res0CellCount",n],["getPentagons",n,[n,n]],["pentagonCount",n],["cellToVertex",n,[n,n,n,n]],["cellToVertexes",n,[n,n,n]],["vertexToLatLng",n,[n,n,n]],["isValidVertex",n,[n,n]]],s={0:"Success",1:"The operation failed but a more specific error is not available",2:"Argument was outside of acceptable range",3:"Latitude or longitude arguments were outside of acceptable range",4:"Resolution argument was outside of acceptable range",5:"Cell argument was not valid",6:"Directed edge argument was not valid",7:"Undirected edge argument was not valid",8:"Vertex argument was not valid",9:"Pentagon distortion was encountered",10:"Duplicate input",11:"Cell arguments were not neighbors",12:"Cell arguments had incompatible resolutions",13:"Memory allocation failed",14:"Bounds of provided memory were insufficient",15:"Mode or flags argument was not valid"},a=1002,l={1e3:"Unknown unit",1001:"Array length out of bounds"};l[a]="Got unexpected null value for H3 index";var c="Unknown error";function u(t,e,i){var r=i&&"value"in i,n=new Error((t[e]||c)+" (code: "+e+(r?", value: "+i.value:"")+")");return n.code=e,n}function h(t){if(0!==t)throw function(t,e){return u(s,t,2===arguments.length?{value:e}:{})}(t)}var p={};o.forEach((function(t){p[t[0]]=r.cwrap.apply(r,t)}));var d=16,f=4,m=8,g=p.sizeOfH3Index(),_=p.sizeOfLatLng(),y=p.sizeOfCellBoundary();function A(t){if(!t)throw function(t,e){return u(l,t,2===arguments.length?{value:e}:{})}(a);return t}p.sizeOfGeoPolygon(),p.sizeOfGeoLoop(),p.sizeOfLinkedGeoPolygon(),p.sizeOfCoordIJ(),Math.pow(2,32);var v=/[^0-9a-fA-F]/;function x(t){if(t>=0)return t.toString(d);var e=b(8,(t&=2147483647).toString(d));return(parseInt(e[0],d)+8).toString(d)+e.substring(1)}function b(t,e){for(var i=t-e.length,r="",n=0;n<i;n++)r+="0";return r+e}function w(t){return 180*r.getValue(t,"double")/Math.PI}function S(t){return[w(t),w(t+m)]}function T(t){return[w(t+m),w(t)]}function C(t,e,i){var n=r._malloc(_);r.HEAPF64.set([t,e].map(E),n/m);var o=r._malloc(g);try{return h(p.latLngToCell(n,i,o)),A(function(t,e){void 0===e&&(e=0);var i=r.getValue(t+g*e,"i32"),n=r.getValue(t+g*e+f,"i32");return n?function(t,e){return x(e)+b(8,x(t))}(i,n):null}(o))}finally{r._free(o),r._free(n)}}function M(t,e){var i=r._malloc(y),n=function(t){if(Array.isArray(t)&&2===t.length&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if("string"!=typeof t||v.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),d);return[parseInt(t.substring(t.length-8),d),e]}(t),o=n[0],s=n[1];try{return h(p.cellToBoundary(o,s,i)),function(t,e,i){for(var n=r.getValue(t,"i32"),o=t+m,s=[],a=e?T:S,l=0;l<2*n;l+=2)s.push(a(o+m*l));return i&&s.push(s[0]),s}(i,e,e)}finally{r._free(i)}}function E(t){return t*Math.PI/180}Math.pow(2,32)},30592:(t,e,i)=>{"use strict";var r=i(30655),n=function(){return!!r};n.hasArrayLengthDefineBug=function(){if(!r)return null;try{return 1!==r([],"length",{value:1}).length}catch(t){return!0}},t.exports=n},80024:t=>{"use strict";var e={__proto__:null,foo:{}},i=Object;t.exports=function(){return{__proto__:e}.foo===e.foo&&!(e instanceof i)}},64039:(t,e,i)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,n=i(41333);t.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&n()}},41333:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),i=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(t,e);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},49092:(t,e,i)=>{"use strict";var r=i(41333);t.exports=function(){return r()&&!!Symbol.toStringTag}},9957:(t,e,i)=>{"use strict";var r=Function.prototype.call,n=Object.prototype.hasOwnProperty,o=i(66743);t.exports=o.call(r,n)},11781:t=>{"use strict";var e=function(){function t(t,e,i,r){if("number"!=typeof t)throw new TypeError("statusCode must be a number but was "+typeof t);if(null===e)throw new TypeError("headers cannot be null");if("object"!=typeof e)throw new TypeError("headers must be an object but was "+typeof e);this.statusCode=t;var n={};for(var o in e)n[o.toLowerCase()]=e[o];this.headers=n,this.body=i,this.url=r}return t.prototype.isError=function(){return 0===this.statusCode||this.statusCode>=400},t.prototype.getBody=function(t){var e;if(0===this.statusCode)throw(e=new Error("This request to "+this.url+" resulted in a status code of 0. This usually indicates some kind of network error in a browser (e.g. CORS not being set up or the DNS failing to resolve):\n"+this.body.toString())).statusCode=this.statusCode,e.headers=this.headers,e.body=this.body,e.url=this.url,e;if(this.statusCode>=300)throw(e=new Error("Server responded to "+this.url+" with status code "+this.statusCode+":\n"+this.body.toString())).statusCode=this.statusCode,e.headers=this.headers,e.body=this.body,e.url=this.url,e;return t&&"string"!=typeof this.body?this.body.toString(t):this.body},t}();t.exports=e},47244:(t,e,i)=>{"use strict";var r=i(49092)(),n=i(38075)("Object.prototype.toString"),o=function(t){return!(r&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===n(t)},s=function(t){return!!o(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==n(t)&&"[object Function]"===n(t.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,t.exports=a?o:s},62120:(t,e,i)=>{"use strict";var r=Date.prototype.getDay,n=Object.prototype.toString,o=i(49092)();t.exports=function(t){return"object"==typeof t&&null!==t&&(o?function(t){try{return r.call(t),!0}catch(t){return!1}}(t):"[object Date]"===n.call(t))}},14035:(t,e,i)=>{"use strict";var r,n,o,s,a=i(38075),l=i(49092)();if(l){r=a("Object.prototype.hasOwnProperty"),n=a("RegExp.prototype.exec"),o={};var c=function(){throw o};s={toString:c,valueOf:c},"symbol"==typeof Symbol.toPrimitive&&(s[Symbol.toPrimitive]=c)}var u=a("Object.prototype.toString"),h=Object.getOwnPropertyDescriptor;t.exports=l?function(t){if(!t||"object"!=typeof t)return!1;var e=h(t,"lastIndex");if(!e||!r(e,"value"))return!1;try{n(t,s)}catch(t){return t===o}}:function(t){return!(!t||"object"!=typeof t&&"function"!=typeof t)&&"[object RegExp]"===u(t)}},71710:(t,e,i)=>{var r=i(50252).hp,n=i(40047);t.exports=function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){return n(e[s][1][t]||t)}),c,c.exports,t,e,i,r)}return i[s].exports}for(var o=void 0,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,i){"use strict";var r=t("./utils"),n=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,n,s,a,l,c,u=[],h=0,p=t.length,d=p,f="string"!==r.getTypeOf(t);h<t.length;)d=p-h,n=f?(e=t[h++],i=h<p?t[h++]:0,h<p?t[h++]:0):(e=t.charCodeAt(h++),i=h<p?t.charCodeAt(h++):0,h<p?t.charCodeAt(h++):0),s=e>>2,a=(3&e)<<4|i>>4,l=1<d?(15&i)<<2|n>>6:64,c=2<d?63&n:64,u.push(o.charAt(s)+o.charAt(a)+o.charAt(l)+o.charAt(c));return u.join("")},i.decode=function(t){var e,i,r,s,a,l,c=0,u=0,h="data:";if(t.substr(0,5)===h)throw new Error("Invalid base64 input, it looks like a data url.");var p,d=3*(t=t.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(t.charAt(t.length-1)===o.charAt(64)&&d--,t.charAt(t.length-2)===o.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(p=n.uint8array?new Uint8Array(0|d):new Array(0|d);c<t.length;)e=o.indexOf(t.charAt(c++))<<2|(s=o.indexOf(t.charAt(c++)))>>4,i=(15&s)<<4|(a=o.indexOf(t.charAt(c++)))>>2,r=(3&a)<<6|(l=o.indexOf(t.charAt(c++))),p[u++]=e,64!==a&&(p[u++]=i),64!==l&&(p[u++]=r);return p}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var r=t("./external"),n=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),s=t("./stream/DataLengthProbe");function a(t,e,i,r,n){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=r,this.compressedContent=n}a.prototype={getContentWorker:function(){var t=new n(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new n(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(t,e,i){return t.pipe(new o).pipe(new s("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new s("compressedSize")).withStreamInfo("compression",e)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var r=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var r=t("./utils"),n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==r.getTypeOf(t)?function(t,e,i,r){var o=n,s=0+i;t^=-1;for(var a=0;a<s;a++)t=t>>>8^o[255&(t^e[a])];return~t}(0|e,t,t.length):function(t,e,i,r){var o=n,s=0+i;t^=-1;for(var a=0;a<s;a++)t=t>>>8^o[255&(t^e.charCodeAt(a))];return~t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var r;r="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:r}},{lie:37}],7:[function(t,e,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=t("pako"),o=t("./utils"),s=t("./stream/GenericWorker"),a=r?"uint8array":"array";function l(t,e){s.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",o.inherits(l,s),l.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(a,t.data),!1)},l.prototype.flush=function(){s.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new l("Deflate",t)},i.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){"use strict";function r(t,e){var i,r="";for(i=0;i<e;i++)r+=String.fromCharCode(255&t),t>>>=8;return r}function n(t,e,i,n,s,u){var h,p,d=t.file,f=t.compression,m=u!==a.utf8encode,g=o.transformTo("string",u(d.name)),_=o.transformTo("string",a.utf8encode(d.name)),y=d.comment,A=o.transformTo("string",u(y)),v=o.transformTo("string",a.utf8encode(y)),x=_.length!==d.name.length,b=v.length!==y.length,w="",S="",T="",C=d.dir,M=d.date,E={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(E.crc32=t.crc32,E.compressedSize=t.compressedSize,E.uncompressedSize=t.uncompressedSize);var I=0;e&&(I|=8),m||!x&&!b||(I|=2048);var L=0,P=0;C&&(L|=16),"UNIX"===s?(P=798,L|=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16}(d.unixPermissions,C)):(P=20,L|=function(t){return 63&(t||0)}(d.dosPermissions)),h=M.getUTCHours(),h<<=6,h|=M.getUTCMinutes(),h<<=5,h|=M.getUTCSeconds()/2,p=M.getUTCFullYear()-1980,p<<=4,p|=M.getUTCMonth()+1,p<<=5,p|=M.getUTCDate(),x&&(S=r(1,1)+r(l(g),4)+_,w+="up"+r(S.length,2)+S),b&&(T=r(1,1)+r(l(A),4)+v,w+="uc"+r(T.length,2)+T);var k="";return k+="\n\0",k+=r(I,2),k+=f.magic,k+=r(h,2),k+=r(p,2),k+=r(E.crc32,4),k+=r(E.compressedSize,4),k+=r(E.uncompressedSize,4),k+=r(g.length,2),k+=r(w.length,2),{fileRecord:c.LOCAL_FILE_HEADER+k+g+w,dirRecord:c.CENTRAL_FILE_HEADER+r(P,2)+k+r(A.length,2)+"\0\0\0\0"+r(L,4)+r(n,4)+g+w+A}}var o=t("../utils"),s=t("../stream/GenericWorker"),a=t("../utf8"),l=t("../crc32"),c=t("../signature");function u(t,e,i,r){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(u,s),u.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,s.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-r-1))/i:100}}))},u.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=n(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=n(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return c.DATA_DESCRIPTOR+r(t.crc32,4)+r(t.compressedSize,4)+r(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,n=function(t,e,i,n,s){var a=o.transformTo("string",s(n));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(t,2)+r(t,2)+r(e,4)+r(i,4)+r(a.length,2)+a}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:n,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},u.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(t){var e=this._sources;if(!s.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},u.prototype.lock=function(){s.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var r=t("../compressions"),n=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var o=new n(e.streamFiles,i,e.platform,e.encodeFileName),s=0;try{t.forEach((function(t,i){s++;var n=function(t,e){var i=t||e,n=r[i];if(!n)throw new Error(i+" is not a valid compression method !");return n}(i.options.compression,e.compression),a=i.options.compressionOptions||e.compressionOptions||{},l=i.dir,c=i.date;i._compressWorker(n,a).withStreamInfo("file",{name:t,dir:l,date:c,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(o)})),o.entriesCount=s}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new r;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(t,e){return(new r).loadAsync(t,e)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var r=t("./utils"),n=t("./external"),o=t("./utf8"),s=t("./zipEntries"),a=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(t){return new n.Promise((function(e,i){var r=t.decompressed.getContentWorker().pipe(new a);r.on("error",(function(t){i(t)})).on("end",(function(){r.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var i=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),l.isNode&&l.isStream(t)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var i=new s(e);return i.load(t),i})).then((function(t){var i=[n.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var o=0;o<r.length;o++)i.push(c(r[o]));return n.Promise.all(i)})).then((function(t){for(var n=t.shift(),o=n.files,s=0;s<o.length;s++){var a=o[s],l=a.fileNameStr,c=r.resolve(a.fileNameStr);i.file(c,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders}),a.dir||(i.file(c).unsafeOriginalName=l)}return n.zipComment.length&&(i.comment=n.zipComment),i}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var r=t("../utils"),n=t("../stream/GenericWorker");function o(t,e){n.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}r.inherits(o,n),o.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},o.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var r=t("readable-stream").Readable;function n(t,e,i){r.call(this,e),this._helper=t;var n=this;t.on("data",(function(t,e){n.push(t)||n._helper.pause(),i&&i(e)})).on("error",(function(t){n.emit("error",t)})).on("end",(function(){n.push(null)}))}t("../utils").inherits(n,r),n.prototype._read=function(){this._helper.resume()},e.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:void 0!==r,newBufferFrom:function(t,e){if(r.from&&r.from!==Uint8Array.from)return r.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new r(t,e)},allocBuffer:function(t){if(r.alloc)return r.alloc(t);var e=new r(t);return e.fill(0),e},isBuffer:function(t){return r.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function r(t,e,i){var r,n=o.getTypeOf(e),a=o.extend(i||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=m(t)),a.createFolders&&(r=f(t))&&g.call(this,r,!0);var h="string"===n&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!h),(e instanceof c&&0===e.uncompressedSize||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",n="string");var _;_=e instanceof c||e instanceof s?e:p.isNode&&p.isStream(e)?new d(t,e):o.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var y=new u(t,_,a);this.files[t]=y}var n=t("./utf8"),o=t("./utils"),s=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),l=t("./defaults"),c=t("./compressedObject"),u=t("./zipObject"),h=t("./generate"),p=t("./nodejsUtils"),d=t("./nodejs/NodejsStreamInputAdapter"),f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e=void 0!==e?e:l.createFolders,t=m(t),this.files[t]||r.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function _(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,r;for(e in this.files)r=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,r)},filter:function(t){var e=[];return this.forEach((function(i,r){t(i,r)&&e.push(r)})),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,r.call(this,t,e,i),this;if(_(t)){var n=t;return this.filter((function(t,e){return!e.dir&&n.test(t)}))}var o=this.files[this.root+t];return o&&!o.dir?o:null},folder:function(t){if(!t)return this;if(_(t))return this.filter((function(e,i){return i.dir&&t.test(e)}));var e=this.root+t,i=g.call(this,e),r=this.clone();return r.root=i.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter((function(e,i){return i.name.slice(0,t.length)===t})),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");o.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var r=i.comment||this.comment||"";e=h.generateWorker(this,i,r)}catch(t){(e=new s("error")).error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){"use strict";e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var r=t("./DataReader");function n(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(n,r),n.prototype.byteAt=function(t){return this.data[this.zero+t]},n.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===e&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o-this.zero;return-1},n.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),r=t.charCodeAt(2),n=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&i===o[1]&&r===o[2]&&n===o[3]},n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var r=t("../utils");function n(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=n},{"../utils":32}],19:[function(t,e,i){"use strict";var r=t("./Uint8ArrayReader");function n(t){r.call(this,t)}t("../utils").inherits(n,r),n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var r=t("./DataReader");function n(t){r.call(this,t)}t("../utils").inherits(n,r),n.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},n.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},n.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},n.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var r=t("./ArrayReader");function n(t){r.call(this,t)}t("../utils").inherits(n,r),n.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var r=t("../utils"),n=t("../support"),o=t("./ArrayReader"),s=t("./StringReader"),a=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(t){var e=r.getTypeOf(t);return r.checkSupport(e),"string"!==e||n.uint8array?"nodebuffer"===e?new a(t):n.uint8array?new l(r.transformTo("uint8array",t)):new o(r.transformTo("array",t)):new s(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var r=t("./GenericWorker"),n=t("../utils");function o(t){r.call(this,"ConvertWorker to "+t),this.destType=t}n.inherits(o,r),o.prototype.processChunk=function(t){this.push({data:n.transformTo(this.destType,t.data),meta:t.meta})},e.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var r=t("./GenericWorker"),n=t("../crc32");function o(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,r),o.prototype.processChunk=function(t){this.streamInfo.crc32=n(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var r=t("../utils"),n=t("./GenericWorker");function o(t){n.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}r.inherits(o,n),o.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}n.prototype.processChunk.call(this,t)},e.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var r=t("../utils"),n=t("./GenericWorker");function o(t){n.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}r.inherits(o,n),o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function r(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=r},{}],29:[function(t,e,i){"use strict";var n=t("../utils"),o=t("./ConvertWorker"),s=t("./GenericWorker"),a=t("../base64"),l=t("../support"),c=t("../external"),u=null;if(l.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function h(t,e,i){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=i,n.checkSupport(r),this._worker=t.pipe(new o(r)),t.lock()}catch(t){this._worker=new s("error"),this._worker.error(t)}}h.prototype={accumulate:function(t){return function(t,e){return new c.Promise((function(i,o){var s=[],l=t._internalType,c=t._outputType,u=t._mimeType;t.on("data",(function(t,i){s.push(t),e&&e(i)})).on("error",(function(t){s=[],o(t)})).on("end",(function(){try{var t=function(t,e,i){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),i);case"base64":return a.encode(e);default:return n.transformTo(t,e)}}(c,function(t,e){var i,n=0,o=null,s=0;for(i=0;i<e.length;i++)s+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(o=new Uint8Array(s),i=0;i<e.length;i++)o.set(e[i],n),n+=e[i].length;return o;case"nodebuffer":return r.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(l,s),u);i(t)}catch(t){o(t)}s=[]})).resume()}))}(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,(function(t){e.call(i,t.data,t.meta)})):this._worker.on(t,(function(){n.delay(e,arguments,i)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==r,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(n),i.blob=0===o.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var r=t("./utils"),n=t("./support"),o=t("./nodejsUtils"),s=t("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function c(){s.call(this,"utf-8 decode"),this.leftOver=null}function u(){s.call(this,"utf-8 encode")}a[254]=a[254]=1,i.utf8encode=function(t){return n.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,i,r,o,s,a=t.length,l=0;for(o=0;o<a;o++)55296==(64512&(i=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=n.uint8array?new Uint8Array(l):new Array(l),o=s=0;s<l;o++)55296==(64512&(i=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),i<128?e[s++]=i:(i<2048?e[s++]=192|i>>>6:(i<65536?e[s++]=224|i>>>12:(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63),e[s++]=128|i>>>6&63),e[s++]=128|63&i);return e}(t)},i.utf8decode=function(t){return n.nodebuffer?r.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,n,o,s=t.length,l=new Array(2*s);for(e=i=0;e<s;)if((n=t[e++])<128)l[i++]=n;else if(4<(o=a[n]))l[i++]=65533,e+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&e<s;)n=n<<6|63&t[e++],o--;1<o?l[i++]=65533:n<65536?l[i++]=n:(n-=65536,l[i++]=55296|n>>10&1023,l[i++]=56320|1023&n)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),r.applyFromCharCode(l)}(t=r.transformTo(n.uint8array?"uint8array":"array",t))},r.inherits(c,s),c.prototype.processChunk=function(t){var e=r.transformTo(n.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var o=e;(e=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),e.set(o,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var s=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+a[t[i]]>e?i:e}(e),l=e;s!==e.length&&(n.uint8array?(l=e.subarray(0,s),this.leftOver=e.subarray(s,e.length)):(l=e.slice(0,s),this.leftOver=e.slice(s,e.length))),this.push({data:i.utf8decode(l),meta:t.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=c,r.inherits(u,s),u.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";var r=t("./support"),n=t("./base64"),o=t("./nodejsUtils"),s=t("./external");function a(t){return t}function l(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}t("setimmediate"),i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,i){var r=[],n=0,o=t.length;if(o<=i)return String.fromCharCode.apply(null,t);for(;n<o;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+i,o)))):r.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+i,o)))),n+=i;return r.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function u(t){var e=65536,r=i.getTypeOf(t),n=!0;if("uint8array"===r?n=c.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=c.applyCanBeUsed.nodebuffer),n)for(;1<e;)try{return c.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function h(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=u;var p={};p.string={string:a,array:function(t){return l(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return l(t,new Uint8Array(t.length))},nodebuffer:function(t){return l(t,o.allocBuffer(t.length))}},p.array={string:u,array:a,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}},p.arraybuffer={string:function(t){return u(new Uint8Array(t))},array:function(t){return h(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:a,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:u,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:a,nodebuffer:function(t){return o.newBufferFrom(t)}},p.nodebuffer={string:u,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return h(t,new Uint8Array(t.length))},nodebuffer:a},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var r=i.getTypeOf(e);return p[r][t](e)},i.resolve=function(t){for(var e=t.split("/"),i=[],r=0;r<e.length;r++){var n=e[r];"."===n||""===n&&0!==r&&r!==e.length-1||(".."===n?i.pop():i.push(n))}return i.join("/")},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":r.nodebuffer&&o.isBuffer(t)?"nodebuffer":r.uint8array&&t instanceof Uint8Array?"uint8array":r.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!r[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,r="";for(i=0;i<(t||"").length;i++)r+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return r},i.delay=function(t,e,i){setImmediate((function(){t.apply(i||null,e||[])}))},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,o,a,c){return s.Promise.resolve(e).then((function(t){return r.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise((function(e,i){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){i(t.target.error)},r.readAsArrayBuffer(t)})):t})).then((function(e){var u=i.getTypeOf(e);return u?("arraybuffer"===u?e=i.transformTo("uint8array",e):"string"===u&&(c?e=n.decode(e):o&&!0!==a&&(e=function(t){return l(t,r.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,e,i){"use strict";var r=t("./reader/readerFor"),n=t("./utils"),o=t("./signature"),s=t("./zipEntry"),a=t("./support");function l(t){this.files=[],this.loadOptions=t}l.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(e)+", expected "+n.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(i),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.uint8array?"uint8array":"array",i=n.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(t=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var r=e-i;if(0<r)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var r=t("./reader/readerFor"),n=t("./utils"),o=t("./compressedObject"),s=t("./crc32"),a=t("./utf8"),l=t("./compressions"),c=t("./support");function u(t,e){this.options=t,this.loadOptions=e}u.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in l)if(Object.prototype.hasOwnProperty.call(l,e)&&l[e].magic===t)return l[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,i,r,n=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<n;)e=t.readInt(2),i=t.readInt(2),r=t.readData(i),this.extraFields[e]={id:e,length:i,value:r};t.setIndex(n)},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=n.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var o=n.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)||s(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)||s(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null}},e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";function r(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var n=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),s=t("./utf8"),a=t("./compressedObject"),l=t("./stream/GenericWorker");r.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var r="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var o=!this._dataBinary;o&&!r&&(e=e.pipe(new s.Utf8EncodeWorker)),!o&&r&&(e=e.pipe(new s.Utf8DecodeWorker))}catch(t){(e=new l("error")).error(t)}return new n(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new s.Utf8EncodeWorker)),a.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new o(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<c.length;h++)r.prototype[c[h]]=u;e.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){(function(t){"use strict";var i,r,n=t.MutationObserver||t.WebKitMutationObserver;if(n){var o=0,s=new n(u),a=t.document.createTextNode("");s.observe(a,{characterData:!0}),i=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,i=function(){l.port2.postMessage(0)}}var c=[];function u(){var t,e;r=!0;for(var i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}r=!1}e.exports=function(t){1!==c.push(t)||r||i()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){"use strict";var r=t("immediate");function n(){}var o={},s=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==n&&d(this,t)}function u(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function h(t,e,i){r((function(){var r;try{r=e(i)}catch(r){return o.reject(t,r)}r===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,r)}))}function p(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var i=!1;function r(e){i||(i=!0,o.reject(t,e))}function n(e){i||(i=!0,o.resolve(t,e))}var s=f((function(){e(n,r)}));"error"===s.status&&r(s.value)}function f(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=c).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(i){return e.resolve(t()).then((function(){return i}))}),(function(i){return e.resolve(t()).then((function(){throw i}))}))},c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===s)return this;var i=new this.constructor(n);return this.state!==l?h(i,this.state===a?t:e,this.outcome):this.queue.push(new u(i,t,e)),i},u.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){o.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},o.resolve=function(t,e){var i=f(p,e);if("error"===i.status)return o.reject(t,i.value);var r=i.value;if(r)d(t,r);else{t.state=a,t.outcome=e;for(var n=-1,s=t.queue.length;++n<s;)t.queue[n].callFulfilled(e)}return t},o.reject=function(t,e){t.state=s,t.outcome=e;for(var i=-1,r=t.queue.length;++i<r;)t.queue[i].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:o.resolve(new this(n),t)},c.reject=function(t){var e=new this(n);return o.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,r=!1;if(!i)return this.resolve([]);for(var s=new Array(i),a=0,l=-1,c=new this(n);++l<i;)u(t[l],l);return c;function u(t,n){e.resolve(t).then((function(t){s[n]=t,++a!==i||r||(r=!0,o.resolve(c,s))}),(function(t){r||(r=!0,o.reject(c,t))}))}},c.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var r,s=-1,a=new this(n);++s<e;)r=t[s],this.resolve(r).then((function(t){i||(i=!0,o.resolve(a,t))}),(function(t){i||(i=!0,o.reject(a,t))}));return a}},{immediate:36}],38:[function(t,e,i){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){"use strict";var r=t("./zlib/deflate"),n=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/messages"),a=t("./zlib/zstream"),l=Object.prototype.toString,c=0,u=-1,h=0,p=8;function d(t){if(!(this instanceof d))return new d(t);this.options=n.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==c)throw new Error(s[i]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(i=r.deflateSetDictionary(this.strm,f))!==c)throw new Error(s[i]);this._dict_set=!0}}function f(t,e){var i=new d(e);if(i.push(t,!0),i.err)throw i.msg||s[i.err];return i.result}d.prototype.push=function(t,e){var i,s,a=this.strm,u=this.options.chunkSize;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=o.string2buf(t):"[object ArrayBuffer]"===l.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new n.Buf8(u),a.next_out=0,a.avail_out=u),1!==(i=r.deflate(a,s))&&i!==c)return this.onEnd(i),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(n.shrinkBuf(a.output,a.next_out))):this.onData(n.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==i);return 4===s?(i=r.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===c):2!==s||(this.onEnd(c),!(a.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=d,i.deflate=f,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,f(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){"use strict";var r=t("./zlib/inflate"),n=t("./utils/common"),o=t("./utils/strings"),s=t("./zlib/constants"),a=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),u=Object.prototype.toString;function h(t){if(!(this instanceof h))return new h(t);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=r.inflateInit2(this.strm,e.windowBits);if(i!==s.Z_OK)throw new Error(a[i]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function p(t,e){var i=new h(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}h.prototype.push=function(t,e){var i,a,l,c,h,p,d=this.strm,f=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof t?d.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(f),d.next_out=0,d.avail_out=f),(i=r.inflate(d,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&m&&(p="string"==typeof m?o.string2buf(m):"[object ArrayBuffer]"===u.call(m)?new Uint8Array(m):m,i=r.inflateSetDictionary(this.strm,p)),i===s.Z_BUF_ERROR&&!0===g&&(i=s.Z_OK,g=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),!(this.ended=!0);d.next_out&&(0!==d.avail_out&&i!==s.Z_STREAM_END&&(0!==d.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(d.output,d.next_out),c=d.next_out-l,h=o.buf2string(d.output,l),d.next_out=c,d.avail_out=f-c,c&&n.arraySet(d.output,d.output,l,c,0),this.onData(h)):this.onData(n.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(g=!0)}while((0<d.avail_in||0===d.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(i=r.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(d.avail_out=0))},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=h,i.inflate=p,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},i.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,i,r,n){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+r),n);else for(var o=0;o<r;o++)t[n+o]=e[i+o]},flattenChunks:function(t){var e,i,r,n,o,s;for(e=r=0,i=t.length;e<i;e++)r+=t[e].length;for(s=new Uint8Array(r),e=n=0,i=t.length;e<i;e++)o=t[e],s.set(o,n),n+=o.length;return s}},o={arraySet:function(t,e,i,r,n){for(var o=0;o<r;o++)t[n+o]=e[i+o]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],42:[function(t,e,i){"use strict";var r=t("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var s=new r.Buf8(256),a=0;a<256;a++)s[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&n))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var i="",s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i}s[254]=s[254]=1,i.string2buf=function(t){var e,i,n,o,s,a=t.length,l=0;for(o=0;o<a;o++)55296==(64512&(i=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(n=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(n-56320),o++),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new r.Buf8(l),o=s=0;s<l;o++)55296==(64512&(i=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(n=t.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(n-56320),o++),i<128?e[s++]=i:(i<2048?e[s++]=192|i>>>6:(i<65536?e[s++]=224|i>>>12:(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63),e[s++]=128|i>>>6&63),e[s++]=128|63&i);return e},i.buf2binstring=function(t){return l(t,t.length)},i.binstring2buf=function(t){for(var e=new r.Buf8(t.length),i=0,n=e.length;i<n;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,r,n,o,a=e||t.length,c=new Array(2*a);for(i=r=0;i<a;)if((n=t[i++])<128)c[r++]=n;else if(4<(o=s[n]))c[r++]=65533,i+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&i<a;)n=n<<6|63&t[i++],o--;1<o?c[r++]=65533:n<65536?c[r++]=n:(n-=65536,c[r++]=55296|n>>10&1023,c[r++]=56320|1023&n)}return l(c,r)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+s[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){"use strict";e.exports=function(t,e,i,r){for(var n=65535&t,o=t>>>16&65535,s=0;0!==i;){for(i-=s=2e3<i?2e3:i;o=o+(n=n+e[r++]|0)|0,--s;);n%=65521,o%=65521}return n|o<<16}},{}],44:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){"use strict";var r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,n){var o=r,s=n+i;t^=-1;for(var a=n;a<s;a++)t=t>>>8^o[255&(t^e[a])];return~t}},{}],46:[function(t,e,i){"use strict";var r,n=t("../utils/common"),o=t("./trees"),s=t("./adler32"),a=t("./crc32"),l=t("./messages"),c=0,u=0,h=-2,p=2,d=8,f=286,m=30,g=19,_=2*f+1,y=15,A=3,v=258,x=v+A+1,b=42,w=113;function S(t,e){return t.msg=l[e],e}function T(t){return(t<<1)-(4<t?9:0)}function C(t){for(var e=t.length;0<=--e;)t[e]=0}function M(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(n.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function E(t,e){o._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,M(t.strm)}function I(t,e){t.pending_buf[t.pending++]=e}function L(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function P(t,e){var i,r,n=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-x?t.strstart-(t.w_size-x):0,c=t.window,u=t.w_mask,h=t.prev,p=t.strstart+v,d=c[o+s-1],f=c[o+s];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do{if(c[(i=e)+s]===f&&c[i+s-1]===d&&c[i]===c[o]&&c[++i]===c[o+1]){o+=2,i++;do{}while(c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&o<p);if(r=v-(p-o),o=p-v,s<r){if(t.match_start=e,a<=(s=r))break;d=c[o+s-1],f=c[o+s]}}}while((e=h[e&u])>l&&0!=--n);return s<=t.lookahead?s:t.lookahead}function k(t){var e,i,r,o,l,c,u,h,p,d,f=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-x)){for(n.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=i=t.hash_size;r=t.head[--e],t.head[e]=f<=r?r-f:0,--i;);for(e=i=f;r=t.prev[--e],t.prev[e]=f<=r?r-f:0,--i;);o+=f}if(0===t.strm.avail_in)break;if(c=t.strm,u=t.window,h=t.strstart+t.lookahead,d=void 0,(p=o)<(d=c.avail_in)&&(d=p),i=0===d?0:(c.avail_in-=d,n.arraySet(u,c.input,c.next_in,d,h),1===c.state.wrap?c.adler=s(c.adler,u,d,h):2===c.state.wrap&&(c.adler=a(c.adler,u,d,h)),c.next_in+=d,c.total_in+=d,d),t.lookahead+=i,t.lookahead+t.insert>=A)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+A-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<A)););}while(t.lookahead<x&&0!==t.strm.avail_in)}function N(t,e){for(var i,r;;){if(t.lookahead<x){if(k(t),t.lookahead<x&&e===c)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=A&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+A-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-x&&(t.match_length=P(t,i)),t.match_length>=A)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-A),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=A){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+A-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(E(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<A-1?t.strstart:A-1,4===e?(E(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(E(t,!1),0===t.strm.avail_out)?1:2}function D(t,e){for(var i,r,n;;){if(t.lookahead<x){if(k(t),t.lookahead<x&&e===c)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=A&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+A-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=A-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-x&&(t.match_length=P(t,i),t.match_length<=5&&(1===t.strategy||t.match_length===A&&4096<t.strstart-t.match_start)&&(t.match_length=A-1)),t.prev_length>=A&&t.match_length<=t.prev_length){for(n=t.strstart+t.lookahead-A,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-A),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+A-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=A-1,t.strstart++,r&&(E(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&E(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<A-1?t.strstart:A-1,4===e?(E(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(E(t,!1),0===t.strm.avail_out)?1:2}function O(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}function R(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*_),this.dyn_dtree=new n.Buf16(2*(2*m+1)),this.bl_tree=new n.Buf16(2*(2*g+1)),C(this.dyn_ltree),C(this.dyn_dtree),C(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(y+1),this.heap=new n.Buf16(2*f+1),C(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*f+1),C(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function F(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=p,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?b:w,t.adler=2===e.wrap?0:1,e.last_flush=c,o._tr_init(e),u):S(t,h)}function z(t){var e=F(t);return e===u&&function(t){t.window_size=2*t.w_size,C(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=A-1,t.match_available=0,t.ins_h=0}(t.state),e}function B(t,e,i,r,o,s){if(!t)return h;var a=1;if(-1===e&&(e=6),r<0?(a=0,r=-r):15<r&&(a=2,r-=16),o<1||9<o||i!==d||r<8||15<r||e<0||9<e||s<0||4<s)return S(t,h);8===r&&(r=9);var l=new R;return(t.state=l).strm=t,l.wrap=a,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+A-1)/A),l.window=new n.Buf8(2*l.w_size),l.head=new n.Buf16(l.hash_size),l.prev=new n.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new n.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,z(t)}r=[new O(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(k(t),0===t.lookahead&&e===c)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+i;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,E(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-x&&(E(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(E(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(E(t,!1),t.strm.avail_out),1)})),new O(4,4,8,4,N),new O(4,5,16,8,N),new O(4,6,32,32,N),new O(4,4,16,16,D),new O(8,16,32,32,D),new O(8,16,128,128,D),new O(8,32,128,256,D),new O(32,128,258,1024,D),new O(32,258,258,4096,D)],i.deflateInit=function(t,e){return B(t,e,d,15,8,0)},i.deflateInit2=B,i.deflateReset=z,i.deflateResetKeep=F,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?h:(t.state.gzhead=e,u):h},i.deflate=function(t,e){var i,n,s,l;if(!t||!t.state||5<e||e<0)return t?S(t,h):h;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||666===n.status&&4!==e)return S(t,0===t.avail_out?-5:h);if(n.strm=t,i=n.last_flush,n.last_flush=e,n.status===b)if(2===n.wrap)t.adler=0,I(n,31),I(n,139),I(n,8),n.gzhead?(I(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),I(n,255&n.gzhead.time),I(n,n.gzhead.time>>8&255),I(n,n.gzhead.time>>16&255),I(n,n.gzhead.time>>24&255),I(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),I(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(I(n,255&n.gzhead.extra.length),I(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=a(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(I(n,0),I(n,0),I(n,0),I(n,0),I(n,0),I(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),I(n,3),n.status=w);else{var p=d+(n.w_bits-8<<4)<<8;p|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(p|=32),p+=31-p%31,n.status=w,L(n,p),0!==n.strstart&&(L(n,t.adler>>>16),L(n,65535&t.adler)),t.adler=1}if(69===n.status)if(n.gzhead.extra){for(s=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),M(t),s=n.pending,n.pending!==n.pending_buf_size));)I(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),M(t),s=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,I(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),0===l&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){s=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),M(t),s=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,I(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>s&&(t.adler=a(t.adler,n.pending_buf,n.pending-s,s)),0===l&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&M(t),n.pending+2<=n.pending_buf_size&&(I(n,255&t.adler),I(n,t.adler>>8&255),t.adler=0,n.status=w)):n.status=w),0!==n.pending){if(M(t),0===t.avail_out)return n.last_flush=-1,u}else if(0===t.avail_in&&T(e)<=T(i)&&4!==e)return S(t,-5);if(666===n.status&&0!==t.avail_in)return S(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==c&&666!==n.status){var f=2===n.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(k(t),0===t.lookahead)){if(e===c)return 1;break}if(t.match_length=0,i=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(E(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(E(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(E(t,!1),0===t.strm.avail_out)?1:2}(n,e):3===n.strategy?function(t,e){for(var i,r,n,s,a=t.window;;){if(t.lookahead<=v){if(k(t),t.lookahead<=v&&e===c)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=A&&0<t.strstart&&(r=a[n=t.strstart-1])===a[++n]&&r===a[++n]&&r===a[++n]){s=t.strstart+v;do{}while(r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&n<s);t.match_length=v-(s-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=A?(i=o._tr_tally(t,1,t.match_length-A),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(E(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(E(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(E(t,!1),0===t.strm.avail_out)?1:2}(n,e):r[n.level].func(n,e);if(3!==f&&4!==f||(n.status=666),1===f||3===f)return 0===t.avail_out&&(n.last_flush=-1),u;if(2===f&&(1===e?o._tr_align(n):5!==e&&(o._tr_stored_block(n,0,0,!1),3===e&&(C(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),M(t),0===t.avail_out))return n.last_flush=-1,u}return 4!==e?u:n.wrap<=0?1:(2===n.wrap?(I(n,255&t.adler),I(n,t.adler>>8&255),I(n,t.adler>>16&255),I(n,t.adler>>24&255),I(n,255&t.total_in),I(n,t.total_in>>8&255),I(n,t.total_in>>16&255),I(n,t.total_in>>24&255)):(L(n,t.adler>>>16),L(n,65535&t.adler)),M(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?u:1)},i.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==b&&69!==e&&73!==e&&91!==e&&103!==e&&e!==w&&666!==e?S(t,h):(t.state=null,e===w?S(t,-3):u):h},i.deflateSetDictionary=function(t,e){var i,r,o,a,l,c,p,d,f=e.length;if(!t||!t.state)return h;if(2===(a=(i=t.state).wrap)||1===a&&i.status!==b||i.lookahead)return h;for(1===a&&(t.adler=s(t.adler,e,f,0)),i.wrap=0,f>=i.w_size&&(0===a&&(C(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new n.Buf8(i.w_size),n.arraySet(d,e,f-i.w_size,i.w_size,0),e=d,f=i.w_size),l=t.avail_in,c=t.next_in,p=t.input,t.avail_in=f,t.next_in=0,t.input=e,k(i);i.lookahead>=A;){for(r=i.strstart,o=i.lookahead-(A-1);i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+A-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,--o;);i.strstart=r,i.lookahead=A-1,k(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=A-1,i.match_available=0,t.next_in=c,t.input=p,t.avail_in=l,i.wrap=a,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){"use strict";e.exports=function(t,e){var i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C;i=t.state,r=t.next_in,T=t.input,n=r+(t.avail_in-5),o=t.next_out,C=t.output,s=o-(e-t.avail_out),a=o+(t.avail_out-257),l=i.dmax,c=i.wsize,u=i.whave,h=i.wnext,p=i.window,d=i.hold,f=i.bits,m=i.lencode,g=i.distcode,_=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do{f<15&&(d+=T[r++]<<f,f+=8,d+=T[r++]<<f,f+=8),A=m[d&_];e:for(;;){if(d>>>=v=A>>>24,f-=v,0==(v=A>>>16&255))C[o++]=65535&A;else{if(!(16&v)){if(!(64&v)){A=m[(65535&A)+(d&(1<<v)-1)];continue e}if(32&v){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}x=65535&A,(v&=15)&&(f<v&&(d+=T[r++]<<f,f+=8),x+=d&(1<<v)-1,d>>>=v,f-=v),f<15&&(d+=T[r++]<<f,f+=8,d+=T[r++]<<f,f+=8),A=g[d&y];i:for(;;){if(d>>>=v=A>>>24,f-=v,!(16&(v=A>>>16&255))){if(!(64&v)){A=g[(65535&A)+(d&(1<<v)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(b=65535&A,f<(v&=15)&&(d+=T[r++]<<f,(f+=8)<v&&(d+=T[r++]<<f,f+=8)),l<(b+=d&(1<<v)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=v,f-=v,(v=o-s)<b){if(u<(v=b-v)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(S=p,(w=0)===h){if(w+=c-v,v<x){for(x-=v;C[o++]=p[w++],--v;);w=o-b,S=C}}else if(h<v){if(w+=c+h-v,(v-=h)<x){for(x-=v;C[o++]=p[w++],--v;);if(w=0,h<x){for(x-=v=h;C[o++]=p[w++],--v;);w=o-b,S=C}}}else if(w+=h-v,v<x){for(x-=v;C[o++]=p[w++],--v;);w=o-b,S=C}for(;2<x;)C[o++]=S[w++],C[o++]=S[w++],C[o++]=S[w++],x-=3;x&&(C[o++]=S[w++],1<x&&(C[o++]=S[w++]))}else{for(w=o-b;C[o++]=C[w++],C[o++]=C[w++],C[o++]=C[w++],2<(x-=3););x&&(C[o++]=C[w++],1<x&&(C[o++]=C[w++]))}break}}break}}while(r<n&&o<a);r-=x=f>>3,d&=(1<<(f-=x<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<n?n-r+5:5-(r-n),t.avail_out=o<a?a-o+257:257-(o-a),i.hold=d,i.bits=f}},{}],49:[function(t,e,i){"use strict";var r=t("../utils/common"),n=t("./adler32"),o=t("./crc32"),s=t("./inffast"),a=t("./inftrees"),l=0,c=-2,u=1,h=852,p=592;function d(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function f(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function m(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=u,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(h),e.distcode=e.distdyn=new r.Buf32(p),e.sane=1,e.back=-1,l):c}function g(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,m(t)):c}function _(t,e){var i,r;return t&&t.state?(r=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?c:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,g(t))):c}function y(t,e){var i,r;return t?(r=new f,(t.state=r).window=null,(i=_(t,e))!==l&&(t.state=null),i):c}var A,v,x=!0;function b(t){if(x){var e;for(A=new r.Buf32(512),v=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(1,t.lens,0,288,A,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(2,t.lens,0,32,v,0,t.work,{bits:5}),x=!1}t.lencode=A,t.lenbits=9,t.distcode=v,t.distbits=5}function w(t,e,i,n){var o,s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new r.Buf8(s.wsize)),n>=s.wsize?(r.arraySet(s.window,e,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(n<(o=s.wsize-s.wnext)&&(o=n),r.arraySet(s.window,e,i-n,o,s.wnext),(n-=o)?(r.arraySet(s.window,e,i-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}i.inflateReset=g,i.inflateReset2=_,i.inflateResetKeep=m,i.inflateInit=function(t){return y(t,15)},i.inflateInit2=y,i.inflate=function(t,e){var i,h,p,f,m,g,_,y,A,v,x,S,T,C,M,E,I,L,P,k,N,D,O,R,F=0,z=new r.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return c;12===(i=t.state).mode&&(i.mode=13),m=t.next_out,p=t.output,_=t.avail_out,f=t.next_in,h=t.input,g=t.avail_in,y=i.hold,A=i.bits,v=g,x=_,D=l;t:for(;;)switch(i.mode){case u:if(0===i.wrap){i.mode=13;break}for(;A<16;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(2&i.wrap&&35615===y){z[i.check=0]=255&y,z[1]=y>>>8&255,i.check=o(i.check,z,2,0),A=y=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&y)){t.msg="unknown compression method",i.mode=30;break}if(A-=4,N=8+(15&(y>>>=4)),0===i.wbits)i.wbits=N;else if(N>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<N,t.adler=i.check=1,i.mode=512&y?10:12,A=y=0;break;case 2:for(;A<16;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(i.flags=y,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=y>>8&1),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=o(i.check,z,2,0)),A=y=0,i.mode=3;case 3:for(;A<32;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.head&&(i.head.time=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,z[2]=y>>>16&255,z[3]=y>>>24&255,i.check=o(i.check,z,4,0)),A=y=0,i.mode=4;case 4:for(;A<16;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=o(i.check,z,2,0)),A=y=0,i.mode=5;case 5:if(1024&i.flags){for(;A<16;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.length=y,i.head&&(i.head.extra_len=y),512&i.flags&&(z[0]=255&y,z[1]=y>>>8&255,i.check=o(i.check,z,2,0)),A=y=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(g<(S=i.length)&&(S=g),S&&(i.head&&(N=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),r.arraySet(i.head.extra,h,f,S,N)),512&i.flags&&(i.check=o(i.check,h,S,f)),g-=S,f+=S,i.length-=S),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===g)break t;for(S=0;N=h[f+S++],i.head&&N&&i.length<65536&&(i.head.name+=String.fromCharCode(N)),N&&S<g;);if(512&i.flags&&(i.check=o(i.check,h,S,f)),g-=S,f+=S,N)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===g)break t;for(S=0;N=h[f+S++],i.head&&N&&i.length<65536&&(i.head.comment+=String.fromCharCode(N)),N&&S<g;);if(512&i.flags&&(i.check=o(i.check,h,S,f)),g-=S,f+=S,N)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;A<16;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(y!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}A=y=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;A<32;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}t.adler=i.check=d(y),A=y=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=m,t.avail_out=_,t.next_in=f,t.avail_in=g,i.hold=y,i.bits=A,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){y>>>=7&A,A-=7&A,i.mode=27;break}for(;A<3;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}switch(i.last=1&y,A-=1,3&(y>>>=1)){case 0:i.mode=14;break;case 1:if(b(i),i.mode=20,6!==e)break;y>>>=2,A-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}y>>>=2,A-=2;break;case 14:for(y>>>=7&A,A-=7&A;A<32;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&y,A=y=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(S=i.length){if(g<S&&(S=g),_<S&&(S=_),0===S)break t;r.arraySet(p,h,f,S,m),g-=S,f+=S,_-=S,m+=S,i.length-=S;break}i.mode=12;break;case 17:for(;A<14;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(i.nlen=257+(31&y),y>>>=5,A-=5,i.ndist=1+(31&y),y>>>=5,A-=5,i.ncode=4+(15&y),y>>>=4,A-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;A<3;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.lens[B[i.have++]]=7&y,y>>>=3,A-=3}for(;i.have<19;)i.lens[B[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,O={bits:i.lenbits},D=a(0,i.lens,0,19,i.lencode,0,i.work,O),i.lenbits=O.bits,D){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;E=(F=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,I=65535&F,!((M=F>>>24)<=A);){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(I<16)y>>>=M,A-=M,i.lens[i.have++]=I;else{if(16===I){for(R=M+2;A<R;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(y>>>=M,A-=M,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}N=i.lens[i.have-1],S=3+(3&y),y>>>=2,A-=2}else if(17===I){for(R=M+3;A<R;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}A-=M,N=0,S=3+(7&(y>>>=M)),y>>>=3,A-=3}else{for(R=M+7;A<R;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}A-=M,N=0,S=11+(127&(y>>>=M)),y>>>=7,A-=7}if(i.have+S>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;S--;)i.lens[i.have++]=N}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,O={bits:i.lenbits},D=a(1,i.lens,0,i.nlen,i.lencode,0,i.work,O),i.lenbits=O.bits,D){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,O={bits:i.distbits},D=a(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,O),i.distbits=O.bits,D){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=g&&258<=_){t.next_out=m,t.avail_out=_,t.next_in=f,t.avail_in=g,i.hold=y,i.bits=A,s(t,x),m=t.next_out,p=t.output,_=t.avail_out,f=t.next_in,h=t.input,g=t.avail_in,y=i.hold,A=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;E=(F=i.lencode[y&(1<<i.lenbits)-1])>>>16&255,I=65535&F,!((M=F>>>24)<=A);){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(E&&!(240&E)){for(L=M,P=E,k=I;E=(F=i.lencode[k+((y&(1<<L+P)-1)>>L)])>>>16&255,I=65535&F,!(L+(M=F>>>24)<=A);){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}y>>>=L,A-=L,i.back+=L}if(y>>>=M,A-=M,i.back+=M,i.length=I,0===E){i.mode=26;break}if(32&E){i.back=-1,i.mode=12;break}if(64&E){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&E,i.mode=22;case 22:if(i.extra){for(R=i.extra;A<R;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,A-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;E=(F=i.distcode[y&(1<<i.distbits)-1])>>>16&255,I=65535&F,!((M=F>>>24)<=A);){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(!(240&E)){for(L=M,P=E,k=I;E=(F=i.distcode[k+((y&(1<<L+P)-1)>>L)])>>>16&255,I=65535&F,!(L+(M=F>>>24)<=A);){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}y>>>=L,A-=L,i.back+=L}if(y>>>=M,A-=M,i.back+=M,64&E){t.msg="invalid distance code",i.mode=30;break}i.offset=I,i.extra=15&E,i.mode=24;case 24:if(i.extra){for(R=i.extra;A<R;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,A-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===_)break t;if(S=x-_,i.offset>S){if((S=i.offset-S)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}T=S>i.wnext?(S-=i.wnext,i.wsize-S):i.wnext-S,S>i.length&&(S=i.length),C=i.window}else C=p,T=m-i.offset,S=i.length;for(_<S&&(S=_),_-=S,i.length-=S;p[m++]=C[T++],--S;);0===i.length&&(i.mode=21);break;case 26:if(0===_)break t;p[m++]=i.length,_--,i.mode=21;break;case 27:if(i.wrap){for(;A<32;){if(0===g)break t;g--,y|=h[f++]<<A,A+=8}if(x-=_,t.total_out+=x,i.total+=x,x&&(t.adler=i.check=i.flags?o(i.check,p,x,m-x):n(i.check,p,x,m-x)),x=_,(i.flags?y:d(y))!==i.check){t.msg="incorrect data check",i.mode=30;break}A=y=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;A<32;){if(0===g)break t;g--,y+=h[f++]<<A,A+=8}if(y!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}A=y=0}i.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;default:return c}return t.next_out=m,t.avail_out=_,t.next_in=f,t.avail_in=g,i.hold=y,i.bits=A,(i.wsize||x!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&w(t,t.output,t.next_out,x-t.avail_out)?(i.mode=31,-4):(v-=t.avail_in,x-=t.avail_out,t.total_in+=v,t.total_out+=x,i.total+=x,i.wrap&&x&&(t.adler=i.check=i.flags?o(i.check,p,x,t.next_out-x):n(i.check,p,x,t.next_out-x)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==v&&0===x||4===e)&&D===l&&(D=-5),D)},i.inflateEnd=function(t){if(!t||!t.state)return c;var e=t.state;return e.window&&(e.window=null),t.state=null,l},i.inflateGetHeader=function(t,e){var i;return t&&t.state&&2&(i=t.state).wrap?((i.head=e).done=!1,l):c},i.inflateSetDictionary=function(t,e){var i,r=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?c:11===i.mode&&n(1,e,r,0)!==i.check?-3:w(t,e,r,r)?(i.mode=31,-4):(i.havedict=1,l):c},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){"use strict";var r=t("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,l,c,u,h,p){var d,f,m,g,_,y,A,v,x,b=p.bits,w=0,S=0,T=0,C=0,M=0,E=0,I=0,L=0,P=0,k=0,N=null,D=0,O=new r.Buf16(16),R=new r.Buf16(16),F=null,z=0;for(w=0;w<=15;w++)O[w]=0;for(S=0;S<l;S++)O[e[i+S]]++;for(M=b,C=15;1<=C&&0===O[C];C--);if(C<M&&(M=C),0===C)return c[u++]=20971520,c[u++]=20971520,p.bits=1,0;for(T=1;T<C&&0===O[T];T++);for(M<T&&(M=T),w=L=1;w<=15;w++)if(L<<=1,(L-=O[w])<0)return-1;if(0<L&&(0===t||1!==C))return-1;for(R[1]=0,w=1;w<15;w++)R[w+1]=R[w]+O[w];for(S=0;S<l;S++)0!==e[i+S]&&(h[R[e[i+S]]++]=S);if(y=0===t?(N=F=h,19):1===t?(N=n,D-=257,F=o,z-=257,256):(N=s,F=a,-1),w=T,_=u,I=S=k=0,m=-1,g=(P=1<<(E=M))-1,1===t&&852<P||2===t&&592<P)return 1;for(;;){for(A=w-I,x=h[S]<y?(v=0,h[S]):h[S]>y?(v=F[z+h[S]],N[D+h[S]]):(v=96,0),d=1<<w-I,T=f=1<<E;c[_+(k>>I)+(f-=d)]=A<<24|v<<16|x,0!==f;);for(d=1<<w-1;k&d;)d>>=1;if(0!==d?(k&=d-1,k+=d):k=0,S++,0==--O[w]){if(w===C)break;w=e[i+h[S]]}if(M<w&&(k&g)!==m){for(0===I&&(I=M),_+=T,L=1<<(E=w-I);E+I<C&&!((L-=O[E+I])<=0);)E++,L<<=1;if(P+=1<<E,1===t&&852<P||2===t&&592<P)return 1;c[m=k&g]=M<<24|E<<16|_-u}}return 0!==k&&(c[_+k]=w-I<<24|64<<16),p.bits=M,0}},{"../utils/common":41}],51:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){"use strict";var r=t("../utils/common");function n(t){for(var e=t.length;0<=--e;)t[e]=0}var o=256,s=286,a=30,l=15,c=16,u=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],h=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);n(f);var m=new Array(60);n(m);var g=new Array(512);n(g);var _=new Array(256);n(_);var y=new Array(29);n(y);var A,v,x,b=new Array(a);function w(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}function S(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function T(t){return t<256?g[t]:g[256+(t>>>7)]}function C(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function M(t,e,i){t.bi_valid>c-i?(t.bi_buf|=e<<t.bi_valid&65535,C(t,t.bi_buf),t.bi_buf=e>>c-t.bi_valid,t.bi_valid+=i-c):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function E(t,e,i){M(t,i[2*e],i[2*e+1])}function I(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function L(t,e,i){var r,n,o=new Array(l+1),s=0;for(r=1;r<=l;r++)o[r]=s=s+i[r-1]<<1;for(n=0;n<=e;n++){var a=t[2*n+1];0!==a&&(t[2*n]=I(o[a]++,a))}}function P(t){var e;for(e=0;e<s;e++)t.dyn_ltree[2*e]=0;for(e=0;e<a;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function k(t){8<t.bi_valid?C(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function N(t,e,i,r){var n=2*e,o=2*i;return t[n]<t[o]||t[n]===t[o]&&r[e]<=r[i]}function D(t,e,i){for(var r=t.heap[i],n=i<<1;n<=t.heap_len&&(n<t.heap_len&&N(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!N(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r}function O(t,e,i){var r,n,s,a,l=0;if(0!==t.last_lit)for(;r=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],n=t.pending_buf[t.l_buf+l],l++,0===r?E(t,n,e):(E(t,(s=_[n])+o+1,e),0!==(a=u[s])&&M(t,n-=y[s],a),E(t,s=T(--r),i),0!==(a=h[s])&&M(t,r-=b[s],a)),l<t.last_lit;);E(t,256,e)}function R(t,e){var i,r,n,o=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<c;i++)0!==o[2*i]?(t.heap[++t.heap_len]=u=i,t.depth[i]=0):o[2*i+1]=0;for(;t.heap_len<2;)o[2*(n=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[n]=0,t.opt_len--,a&&(t.static_len-=s[2*n+1]);for(e.max_code=u,i=t.heap_len>>1;1<=i;i--)D(t,o,i);for(n=c;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],D(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=r,o[2*n]=o[2*i]+o[2*r],t.depth[n]=(t.depth[i]>=t.depth[r]?t.depth[i]:t.depth[r])+1,o[2*i+1]=o[2*r+1]=n,t.heap[1]=n++,D(t,o,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,r,n,o,s,a,c=e.dyn_tree,u=e.max_code,h=e.stat_desc.static_tree,p=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,m=e.stat_desc.max_length,g=0;for(o=0;o<=l;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)m<(o=c[2*c[2*(r=t.heap[i])+1]+1]+1)&&(o=m,g++),c[2*r+1]=o,u<r||(t.bl_count[o]++,s=0,f<=r&&(s=d[r-f]),a=c[2*r],t.opt_len+=a*(o+s),p&&(t.static_len+=a*(h[2*r+1]+s)));if(0!==g){do{for(o=m-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[m]--,g-=2}while(0<g);for(o=m;0!==o;o--)for(r=t.bl_count[o];0!==r;)u<(n=t.heap[--i])||(c[2*n+1]!==o&&(t.opt_len+=(o-c[2*n+1])*c[2*n],c[2*n+1]=o),r--)}}(t,e),L(o,u,t.bl_count)}function F(t,e,i){var r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=e[2*(r+1)+1],++a<l&&n===s||(a<c?t.bl_tree[2*n]+=a:0!==n?(n!==o&&t.bl_tree[2*n]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=n,c=(a=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4))}function z(t,e,i){var r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=i;r++)if(n=s,s=e[2*(r+1)+1],!(++a<l&&n===s)){if(a<c)for(;E(t,n,t.bl_tree),0!=--a;);else 0!==n?(n!==o&&(E(t,n,t.bl_tree),a--),E(t,16,t.bl_tree),M(t,a-3,2)):a<=10?(E(t,17,t.bl_tree),M(t,a-3,3)):(E(t,18,t.bl_tree),M(t,a-11,7));o=n,c=(a=0)===s?(l=138,3):n===s?(l=6,3):(l=7,4)}}n(b);var B=!1;function U(t,e,i,n){M(t,0+(n?1:0),3),function(t,e,i,n){k(t),C(t,i),C(t,~i),r.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}i._tr_init=function(t){B||(function(){var t,e,i,r,n,o=new Array(l+1);for(r=i=0;r<28;r++)for(y[r]=i,t=0;t<1<<u[r];t++)_[i++]=r;for(_[i-1]=r,r=n=0;r<16;r++)for(b[r]=n,t=0;t<1<<h[r];t++)g[n++]=r;for(n>>=7;r<a;r++)for(b[r]=n<<7,t=0;t<1<<h[r]-7;t++)g[256+n++]=r;for(e=0;e<=l;e++)o[e]=0;for(t=0;t<=143;)f[2*t+1]=8,t++,o[8]++;for(;t<=255;)f[2*t+1]=9,t++,o[9]++;for(;t<=279;)f[2*t+1]=7,t++,o[7]++;for(;t<=287;)f[2*t+1]=8,t++,o[8]++;for(L(f,287,o),t=0;t<a;t++)m[2*t+1]=5,m[2*t]=I(t,5);A=new w(f,u,257,s,l),v=new w(m,h,0,a,l),x=new w(new Array(0),p,0,19,7)}(),B=!0),t.l_desc=new S(t.dyn_ltree,A),t.d_desc=new S(t.dyn_dtree,v),t.bl_desc=new S(t.bl_tree,x),t.bi_buf=0,t.bi_valid=0,P(t)},i._tr_stored_block=U,i._tr_flush_block=function(t,e,i,r){var n,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<o;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),R(t,t.l_desc),R(t,t.d_desc),a=function(t){var e;for(F(t,t.dyn_ltree,t.l_desc.max_code),F(t,t.dyn_dtree,t.d_desc.max_code),R(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*d[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=n&&(n=s)):n=s=i+5,i+4<=n&&-1!==e?U(t,e,i,r):4===t.strategy||s===n?(M(t,2+(r?1:0),3),O(t,f,m)):(M(t,4+(r?1:0),3),function(t,e,i,r){var n;for(M(t,e-257,5),M(t,i-1,5),M(t,r-4,4),n=0;n<r;n++)M(t,t.bl_tree[2*d[n]+1],3);z(t,t.dyn_ltree,e-1),z(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),O(t,t.dyn_ltree,t.dyn_dtree)),P(t),r&&k(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(_[i]+o+1)]++,t.dyn_dtree[2*T(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){M(t,2,3),E(t,256,f),function(t){16===t.bi_valid?(C(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,i){(function(t){!function(t,e){"use strict";if(!t.setImmediate){var i,r,o,s,a=1,l={},c=!1,u=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,i="[object process]"==={}.toString.call(t.process)?function(t){n.nextTick((function(){d(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(s="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",f,!1):t.attachEvent("onmessage",f),function(e){t.postMessage(s+e,"*")}):t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},function(t){o.port2.postMessage(t)}):u&&"onreadystatechange"in u.createElement("script")?(r=u.documentElement,function(t){var e=u.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):function(t){setTimeout(d,0,t)},h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var n={callback:t,args:e};return l[a]=n,i(a),a++},h.clearImmediate=p}function p(t){delete l[t]}function d(t){if(c)setTimeout(d,0,t);else{var i=l[t];if(i){c=!0;try{!function(t){var i=t.callback,r=t.args;switch(r.length){case 0:i();break;case 1:i(r[0]);break;case 2:i(r[0],r[1]);break;case 3:i(r[0],r[1],r[2]);break;default:i.apply(e,r)}}(i)}finally{p(t),c=!1}}}}function f(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&d(+e.data.slice(s.length))}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},41180:()=>{var t,e,i;t=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,i="msTransform"===L.DomUtil.TRANSFORM,L.Marker.addInitHook((function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",(function(t){t.target._applyRotation()}))})),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,i?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})},38886:()=>{L.WebGLHeatMap=L.Renderer.extend({version:"0.2.7",options:{size:3e4,units:"m",opacity:1,gradientTexture:!1,alphaRange:1,padding:0},_initContainer:function(){var t=this._container=L.DomUtil.create("canvas","leaflet-zoom-animated"),e=this.options;t.id="webgl-leaflet-"+L.Util.stamp(this),t.style.opacity=e.opacity,t.style.position="absolute";try{this.gl=window.createWebGLHeatmap({canvas:t,gradientTexture:e.gradientTexture,alphaRange:[0,e.alphaRange]})}catch(t){console.error(t),this.gl={clear:function(){},update:function(){},multiply:function(){},addPoint:function(){},display:function(){},adjustSize:function(){}}}this._container=t},onAdd:function(){this.size=this.options.size,L.Renderer.prototype.onAdd.call(this),this.resize()},_destroyContainer:function(){delete this.gl,L.DomUtil.remove(this._container),L.DomEvent.off(this._container),delete this._container},getEvents:function(){var t=L.Renderer.prototype.getEvents.call(this);return L.Util.extend(t,{resize:this.resize,move:L.Util.throttle(this._update,49,this)}),t},resize:function(){var t=this._container,e=this._map.getSize();t.width=e.x,t.height=e.y,this.gl.adjustSize(),this.draw()},reposition:function(){var t=this._map._getMapPanePos().multiplyBy(-1);L.DomUtil.setPosition(this._container,t)},_update:function(){L.Renderer.prototype._update.call(this),this.draw()},draw:function(){var t=this._map,e=this.gl,i=this.data,r=i.length,n=Math.floor,o=this["_scale"+this.options.units].bind(this),s=this._multiply;if(t){if(e.clear(),this.reposition(),r){for(var a=0;a<r;a++){var l=i[a],c=L.latLng(l),u=t.latLngToContainerPoint(c);e.addPoint(n(u.x),n(u.y),o(c),l[2])}e.update(),s&&(e.multiply(s),e.update())}e.display()}},_scalem:function(t){var e=this._map,i=this.size/40075017*360/Math.cos(Math.PI/180*t.lat),r=new L.LatLng(t.lat,t.lng-i),n=e.latLngToLayerPoint(t),o=e.latLngToLayerPoint(r);return Math.max(Math.round(n.x-o.x),1)},_scalepx:function(){return this.size},data:[],addDataPoint:function(t,e,i){this.data.push([t,e,i/100])},setData:function(t){this.data=t,this._multiply=null,this.draw()},clear:function(){this.setData([])},multiply:function(t){this._multiply=t,this.draw()}}),L.webGLHeatmap=function(t){return new L.WebGLHeatMap(t)}},37769:()=>{!function(){"use strict";var t=Symbol("newer"),e=Symbol("older"),i=function(t,e){"number"!=typeof t&&(e=t,t=0),this.size=0,this.limit=t,this.oldest=this.newest=void 0,this._keymap=new Map,e&&(this.assign(e),t<1&&(this.limit=this.size))};function r(i,r){this.key=i,this.value=r,this[t]=void 0,this[e]=void 0}function n(t){this.entry=t}function o(t){this.entry=t}function s(t){this.entry=t}i.prototype._markEntryAsUsed=function(i){i!==this.newest&&(i[t]&&(i===this.oldest&&(this.oldest=i[t]),i[t][e]=i[e]),i[e]&&(i[e][t]=i[t]),i[t]=void 0,i[e]=this.newest,this.newest&&(this.newest[t]=i),this.newest=i)},i.prototype.assign=function(i){var n,o=this.limit||Number.MAX_VALUE;this._keymap.clear();for(var s=i[Symbol.iterator](),a=s.next();!a.done;a=s.next()){var l=new r(a.value[0],a.value[1]);if(this._keymap.set(l.key,l),n?(n[t]=l,l[e]=n):this.oldest=l,n=l,0==o--)throw new Error("overflow")}this.newest=n,this.size=this._keymap.size},i.prototype.get=function(t){var e=this._keymap.get(t);if(e)return this._markEntryAsUsed(e),e.value},i.prototype.set=function(i,n){var o=this._keymap.get(i);return o?(o.value=n,this._markEntryAsUsed(o),this):(this._keymap.set(i,o=new r(i,n)),this.newest?(this.newest[t]=o,o[e]=this.newest):this.oldest=o,this.newest=o,++this.size,this.size>this.limit&&this.shift(),this)},i.prototype.shift=function(){var i=this.oldest;if(i)return this.oldest[t]?(this.oldest=this.oldest[t],this.oldest[e]=void 0):(this.oldest=void 0,this.newest=void 0),i[t]=i[e]=void 0,this._keymap.delete(i.key),--this.size,[i.key,i.value]},i.prototype.find=function(t){var e=this._keymap.get(t);return e?e.value:void 0},i.prototype.has=function(t){return this._keymap.has(t)},i.prototype.delete=function(i){var r=this._keymap.get(i);if(r)return this._keymap.delete(r.key),r[t]&&r[e]?(r[e][t]=r[t],r[t][e]=r[e]):r[t]?(r[t][e]=void 0,this.oldest=r[t]):r[e]?(r[e][t]=void 0,this.newest=r[e]):this.oldest=this.newest=void 0,this.size--,r.value},i.prototype.clear=function(){this.oldest=this.newest=void 0,this.size=0,this._keymap.clear()},i.prototype.keys=function(){return new o(this.oldest)},i.prototype.values=function(){return new s(this.oldest)},i.prototype.entries=function(){return this},i.prototype[Symbol.iterator]=function(){return new n(this.oldest)},i.prototype.forEach=function(e,i){"object"!=typeof i&&(i=this);for(var r=this.oldest;r;)e.call(i,r.value,r.key,this),r=r[t]},i.prototype.toJSON=function(){for(var e=new Array(this.size),i=0,r=this.oldest;r;)e[i++]={key:r.key,value:r.value},r=r[t];return e},i.prototype.toString=function(){for(var e="",i=this.oldest;i;)e+=String(i.key)+":"+i.value,(i=i[t])&&(e+=" < ");return e},n.prototype[Symbol.iterator]=function(){return this},n.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}},o.prototype[Symbol.iterator]=function(){return this},o.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.key}):{done:!0,value:void 0}},s.prototype[Symbol.iterator]=function(){return this},s.prototype.next=function(){var e=this.entry;return e?(this.entry=e[t],{done:!1,value:e.value}):{done:!0,value:void 0}},L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{maxZoom:21,type:"roadmap",maxNativeZoom:21},initialize:function(t){L.GridLayer.prototype.initialize.call(this,t),this._tileCallbacks={},this._lru=new i(100),this._imagesPerTile="hybrid"===this.options.type?2:1,this._boundOnMutatedImage=this._onMutatedImage.bind(this)},onAdd:function(t){var e,i,r,n=this;L.GridLayer.prototype.onAdd.call(this,t),this._initMutantContainer(),this._logoContainer&&t._controlCorners.bottomleft.appendChild(this._logoContainer),this._attributionContainer&&t._controlCorners.bottomright.appendChild(this._attributionContainer),e=function(){n._map&&(n._initMutant(),google.maps.event.addListenerOnce(n._mutant,"idle",(function(){n._map&&(n._checkZoomLevels(),n._mutantIsReady=!0)})))},i=0,r=null,r=setInterval((function(){if(i>=20)throw clearInterval(r),new Error("window.google not found after 10 seconds");window.google&&window.google.maps&&window.google.maps.Map&&(clearInterval(r),e.call(undefined)),++i}),500)},onRemove:function(t){L.GridLayer.prototype.onRemove.call(this,t),this._observer.disconnect(),t._container.removeChild(this._mutantContainer),this._logoContainer&&L.DomUtil.remove(this._logoContainer),this._attributionContainer&&L.DomUtil.remove(this._attributionContainer),this._mutant&&google.maps.event.clearListeners(this._mutant,"idle")},addGoogleLayer:function(t,e){var i=this;return this._subLayers||(this._subLayers={}),this.whenReady((function(){var r=new(0,google.maps[t])(e);r.setMap(i._mutant),i._subLayers[t]=r})),this},removeGoogleLayer:function(t){var e=this;return this.whenReady((function(){var i=e._subLayers&&e._subLayers[t];i&&(i.setMap(null),delete e._subLayers[t])})),this},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.pointerEvents="none",this._mutantContainer.style.visibility="hidden",L.DomEvent.off(this._mutantContainer)),this._map.getContainer().appendChild(this._mutantContainer),this.setOpacity(this.options.opacity);var t=this._mutantContainer.style;this._map.options.zoomSnap<1?(t.width="180%",t.height="180%"):(t.width="100%",t.height="100%"),t.zIndex=-1,this._attachObserver(this._mutantContainer)},_initMutant:function(){if(!this._mutant){var t=new google.maps.Map(this._mutantContainer,{center:{lat:0,lng:0},zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,styles:this.options.styles||[],backgroundColor:"transparent"});this._mutant=t,this._update(),this.fire("spawned",{mapObject:t}),this._waitControls(),this.once("controls_ready",this._setupAttribution)}},_attachObserver:function(t){this._observer||(this._observer=new MutationObserver(this._onMutations.bind(this))),this._observer.observe(t,{childList:!0,subtree:!0}),Array.prototype.forEach.call(t.querySelectorAll("img"),this._boundOnMutatedImage)},_waitControls:function(){var t=this,e=setInterval((function(){var i,r=t._mutant.__gm.layoutManager;r&&(clearInterval(e),Object.keys(r).forEach((function(t){var e=r[t];e.get&&e.get(1)instanceof Node&&(i=e)})),t.fire("controls_ready",{positions:i}))}),50)},_setupAttribution:function(t){if(this._map){var e=google.maps.ControlPosition,i=this._attributionContainer=t.positions.get(e.BOTTOM_RIGHT);L.DomUtil.addClass(i,"leaflet-control leaflet-control-attribution"),L.DomEvent.disableClickPropagation(i),i.style.height="14px",this._map._controlCorners.bottomright.appendChild(i),this._logoContainer=t.positions.get(e.BOTTOM_LEFT),this._logoContainer.style.pointerEvents="auto",this._map._controlCorners.bottomleft.appendChild(this._logoContainer)}},_onMutations:function(t){for(var e=0;e<t.length;++e)for(var i=t[e],r=0;r<i.addedNodes.length;++r){var n=i.addedNodes[r];n instanceof HTMLImageElement?this._onMutatedImage(n):n instanceof HTMLElement&&Array.prototype.forEach.call(n.querySelectorAll("img"),this._boundOnMutatedImage)}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+|VinaFnapurmBegrtn)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+|VinaFnapurmBegrtn)/,_onMutatedImage:function(t){var e,i=t.src.match(this._roadRegexp),r=0;if(i?(e={z:i[1],x:i[2],y:i[3]},this._imagesPerTile>1&&(t.style.zIndex=1,r=1)):((i=t.src.match(this._satRegexp))&&(e={x:i[1],y:i[2],z:i[3]}),r=0),e){var n=this._tileCoordsToKey(e);t.style.position="absolute";var o=n+"/"+r;this._lru.set(o,t),o in this._tileCallbacks&&this._tileCallbacks[o]&&(this._tileCallbacks[o].forEach((function(e){return e(t)})),delete this._tileCallbacks[o])}},createTile:function(t,e){var i=this._tileCoordsToKey(t),r=L.DomUtil.create("div");r.style.textAlign="left",r.dataset.pending=this._imagesPerTile,e=e.bind(this,null,r);for(var n=0;n<this._imagesPerTile;++n){var o=i+"/"+n,s=this._lru.get(o);s?(r.appendChild(this._clone(s)),--r.dataset.pending):(this._tileCallbacks[o]=this._tileCallbacks[o]||[],this._tileCallbacks[o].push(function(t){return function(i){t.appendChild(this._clone(i)),--t.dataset.pending,parseInt(t.dataset.pending)||e()}.bind(this)}.bind(this)(r)))}return parseInt(r.dataset.pending)||L.Util.requestAnimFrame(e),r},_clone:function(t){var e=t.cloneNode(!0);return e.style.visibility="visible",e},_checkZoomLevels:function(){var t=this._map.getZoom(),e=this._mutant.getZoom();t&&e&&(e!==t||e>this.options.maxNativeZoom)&&this._setMaxNativeZoom(e)},_setMaxNativeZoom:function(t){t!==this.options.maxNativeZoom&&(this.options.maxNativeZoom=t,this._resetView())},_update:function(t){if(this._mutant){t=t||this._map.getCenter();var e=new google.maps.LatLng(t.lat,t.lng),i=Math.round(this._map.getZoom()),r=this._mutant.getZoom();this._mutant.setCenter(e),i!==r&&(this._mutant.setZoom(i),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this,t)},whenReady:function(t,e){return this._mutant?t.call(e||this,{target:this}):this.on("spawned",t,e),this}}),L.gridLayer.googleMutant=function(t){return new L.GridLayer.GoogleMutant(t)}}()},39389:function(t,e){!function(t){"use strict";var e=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,i=this._zoom;if(t.__parent)for(;e.__parent._zoom>=i;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var i,r=this._featureGroup,n=this._nonPointGroup,o=this.options.chunkedLoading,s=this.options.chunkInterval,a=this.options.chunkProgress,l=t.length,c=0,u=!0;if(this._map){var h=(new Date).getTime(),p=L.bind((function(){var d=(new Date).getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();c<l&&!(o&&c%200==0&&(new Date).getTime()-d>s);c++)if((i=t[c])instanceof L.LayerGroup)u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),l=t.length;else if(i.getLatLng){if(!this.hasLayer(i)&&(this._addLayer(i,this._maxZoom),e||this.fire("layeradd",{layer:i}),i.__parent&&2===i.__parent.getChildCount())){var f=i.__parent.getAllChildMarkers(),m=f[0]===i?f[1]:f[0];r.removeLayer(m)}}else n.addLayer(i),e||this.fire("layeradd",{layer:i});a&&a(c,l,(new Date).getTime()-h),c===l?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(p,this.options.chunkDelay)}),this);p()}else for(var d=this._needsClustering;c<l;c++)(i=t[c])instanceof L.LayerGroup?(u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),l=t.length):i.getLatLng?this.hasLayer(i)||d.push(i):n.addLayer(i);return this},removeLayers:function(t){var e,i,r=t.length,n=this._featureGroup,o=this._nonPointGroup,s=!0;if(!this._map){for(e=0;e<r;e++)(i=t[e])instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(i,t),r=t.length):(this._arraySplice(this._needsClustering,i),o.removeLayer(i),this.hasLayer(i)&&this._needsRemoving.push({layer:i,latlng:i._latlng}),this.fire("layerremove",{layer:i}));return this}if(this._unspiderfy){this._unspiderfy();var a=t.slice(),l=r;for(e=0;e<l;e++)(i=a[e])instanceof L.LayerGroup?(this._extractNonGroupLayers(i,a),l=a.length):this._unspiderfyLayer(i)}for(e=0;e<r;e++)(i=t[e])instanceof L.LayerGroup?(s&&(t=t.slice(),s=!1),this._extractNonGroupLayers(i,t),r=t.length):i.__parent?(this._removeLayer(i,!0,!0),this.fire("layerremove",{layer:i}),n.hasLayer(i)&&(n.removeLayer(i),i.clusterShow&&i.clusterShow())):(o.removeLayer(i),this.fire("layerremove",{layer:i}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer((function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent}),this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i,r,n,o=this._needsClustering.slice(),s=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(o),r=o.length-1;r>=0;r--){for(i=!0,n=s.length-1;n>=0;n--)if(s[n].layer===o[r]){i=!1;break}i&&t.call(e,o[r])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer((function(e){t.push(e)})),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer((function(i){L.stamp(i)===t&&(e=i)})),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(e=(i=this._needsRemoving).length-1;e>=0;e--)if(i[e].layer===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=this._map;"function"!=typeof e&&(e=function(){});var r=function(){!i.hasLayer(t)&&!i.hasLayer(t.__parent)||this._inZoomAnimation||(this._map.off("moveend",r,this),this.off("animationend",r,this),i.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",r,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",r,this),this.on("animationend",r,this),t.__parent.zoomToBounds())},onAdd:function(t){var e,i,r;if(this._map=t,!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,i=this._needsRemoving.length;e<i;e++)(r=this._needsRemoving[e]).newlatlng=r.layer._latlng,r.layer._latlng=r.latlng;for(e=0,i=this._needsRemoving.length;e<i;e++)r=this._needsRemoving[e],this._removeLayer(r.layer,!0),r.layer._latlng=r.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),i=this._needsClustering,this._needsClustering=[],this.addLayers(i,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeFromGridUnclustered:function(t,e){for(var i=this._map,r=this._gridUnclustered,n=Math.floor(this._map.getMinZoom());e>=n&&r[e].removeObject(t,i.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,i){t._latlng=e,this.removeLayer(t),t._latlng=i,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,i){var r=this._gridClusters,n=this._gridUnclustered,o=this._featureGroup,s=this._map,a=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var l,c=t.__parent,u=c._markers;for(this._arraySplice(u,t);c&&(c._childCount--,c._boundsNeedUpdate=!0,!(c._zoom<a));)e&&c._childCount<=1?(l=c._markers[0]===t?c._markers[1]:c._markers[0],r[c._zoom].removeObject(c,s.project(c._cLatLng,c._zoom)),n[c._zoom].addObject(l,s.project(l.getLatLng(),c._zoom)),this._arraySplice(c.__parent._childClusters,c),c.__parent._markers.push(l),l.__parent=c.__parent,c._icon&&(o.removeLayer(c),i||o.addLayer(l))):c._iconNeedsUpdate=!0,c=c.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,i){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,i)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return i+=e<10?"small":e<100?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,r=this.options.zoomToBoundsOnClick,n=this.options.spiderfyOnEveryZoom;(e||r||n)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,i=e;if("clusterkeypress"!==t.type||!t.originalEvent||13===t.originalEvent.keyCode){for(;1===i._childClusters.length;)i=i._childClusters[0];i._zoom===this._maxZoom&&i._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,r=this.options.spiderfyOnEveryZoom,n=this._map;(t||i||r)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),n.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),i=this.options.maxClusterRadius,r=i;"function"!=typeof i&&(r=function(){return i}),null!==this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var n=t;n>=e;n--)this._gridClusters[n]=new L.DistanceGrid(r(n)),this._gridUnclustered[n]=new L.DistanceGrid(r(n));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var i,r,n=this._gridClusters,o=this._gridUnclustered,s=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=s;e--){i=this._map.project(t.getLatLng(),e);var a=n[e].getNearObject(i);if(a)return a._addChild(t),void(t.__parent=a);if(a=o[e].getNearObject(i)){var l=a.__parent;l&&this._removeLayer(a,!1);var c=new this._markerCluster(this,e,a,t);n[e].addObject(c,this._map.project(c._cLatLng,e)),a.__parent=c,t.__parent=c;var u=c;for(r=e-1;r>l._zoom;r--)u=new this._markerCluster(this,r,u),n[r].addObject(u,this._map.project(a.getLatLng(),r));return l._addChild(u),void this._removeFromGridUnclustered(a,e)}o[e].addObject(t,i)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer((function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()}))},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return void 0!==e&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var i,r=t.getLayers(),n=0;for(e=e||[];n<r.length;n++)(i=r[n])instanceof L.LayerGroup?this._extractNonGroupLayers(i,e):e.push(i);return e},_overrideMarkerIcon:function(t){return t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var i,r=this._getExpandedVisibleBounds(),n=this._featureGroup,o=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(r,t,o,(function(o){var s,a=o._latlng,l=o._markers;for(r.contains(a)||(a=null),o._isSingleParent()&&t+1===e?(n.removeLayer(o),o._recursivelyAddChildrenToMap(null,e,r)):(o.clusterHide(),o._recursivelyAddChildrenToMap(a,e,r)),i=l.length-1;i>=0;i--)s=l[i],r.contains(s._latlng)||n.removeLayer(s)})),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(r,e),n.eachLayer((function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()})),this._topClusterLevel._recursively(r,t,e,(function(t){t._recursivelyRestoreChildPositions(e)})),this._ignoreMove=!1,this._enqueue((function(){this._topClusterLevel._recursively(r,t,o,(function(t){n.removeLayer(t),t.clusterShow()})),this._animationEnd()}))},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var i=this,r=this._featureGroup;r.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue((function(){r.removeLayer(t),t.clusterShow(),i._animationEnd()}))):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,i){var r=this._getExpandedVisibleBounds(),n=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(r,n,e+1,i);var o=this;this._forceLayout(),t._recursivelyBecomeVisible(r,i),this._enqueue((function(){if(1===t._childCount){var s=t._markers[0];this._ignoreMove=!0,s.setLatLng(s.getLatLng()),this._ignoreMove=!1,s.clusterShow&&s.clusterShow()}else t._recursively(r,i,n,(function(t){t._recursivelyRemoveChildrenFromMap(r,n,e+1)}));o._animationEnd()}))},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var i=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,i,r){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),r&&this._addChild(r)},getAllChildMarkers:function(t,e){t=t||[];for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i].getAllChildMarkers(t,e);for(var r=this._markers.length-1;r>=0;r--)e&&this._markers[r].__dragStart||t.push(this._markers[r]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e,i=this._childClusters.slice(),r=this._group._map,n=r.getBoundsZoom(this._bounds),o=this._zoom+1,s=r.getZoom();i.length>0&&n>o;){o++;var a=[];for(e=0;e<i.length;e++)a=a.concat(i[e]._childClusters);i=a}n>o?this._group._map.setView(this._latlng,o):n<=s?this._group._map.setView(this._latlng,s+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t,e,i,r,n=this._markers,o=this._childClusters,s=0,a=0,l=this._childCount;if(0!==l){for(this._resetBounds(),t=0;t<n.length;t++)i=n[t]._latlng,this._bounds.extend(i),s+=i.lat,a+=i.lng;for(t=0;t<o.length;t++)(e=o[t])._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),i=e._wLatLng,r=e._childCount,s+=i.lat*r,a+=i.lng*r;this._latlng=this._wLatLng=new L.LatLng(s/l,a/l),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,this._group._map.getMinZoom(),i-1,(function(t){var i,r,n=t._markers;for(i=n.length-1;i>=0;i--)(r=n[i])._icon&&(r._setPos(e),r.clusterHide())}),(function(t){var i,r,n=t._childClusters;for(i=n.length-1;i>=0;i--)(r=n[i])._icon&&(r._setPos(e),r.clusterHide())}))},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i,r){this._recursively(t,r,e,(function(n){n._recursivelyAnimateChildrenIn(t,n._group._map.latLngToLayerPoint(n.getLatLng()).round(),i),n._isSingleParent()&&i-1===r?(n.clusterShow(),n._recursivelyRemoveChildrenFromMap(t,e,i)):n.clusterHide(),n._addToMap()}))},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,(function(t){t.clusterShow()}))},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,this._group._map.getMinZoom()-1,e,(function(r){if(e!==r._zoom)for(var n=r._markers.length-1;n>=0;n--){var o=r._markers[n];i.contains(o._latlng)&&(t&&(o._backupLatlng=o.getLatLng(),o.setLatLng(t),o.clusterHide&&o.clusterHide()),r._group._featureGroup.addLayer(o))}}),(function(e){e._addToMap(t)}))},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._restorePosition();else for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i,r){var n,o;this._recursively(t,e-1,i-1,(function(t){for(o=t._markers.length-1;o>=0;o--)n=t._markers[o],r&&r.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())}),(function(t){for(o=t._childClusters.length-1;o>=0;o--)n=t._childClusters[o],r&&r.contains(n._latlng)||(t._group._featureGroup.removeLayer(n),n.clusterShow&&n.clusterShow())}))},_recursively:function(t,e,i,r,n){var o,s,a=this._childClusters,l=this._zoom;if(e<=l&&(r&&r(this),n&&l===i&&n(this)),l<e||l<i)for(o=a.length-1;o>=0;o--)(s=a[o])._boundsNeedUpdate&&s._recalculateBounds(),t.intersects(s._bounds)&&s._recursively(t,e,i,r,n)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),r=this._getCoord(e.y),n=this._grid,o=n[r]=n[r]||{},s=o[i]=o[i]||[],a=L.Util.stamp(t);this._objectPoint[a]=e,s.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i,r,n=this._getCoord(e.x),o=this._getCoord(e.y),s=this._grid,a=s[o]=s[o]||{},l=a[n]=a[n]||[];for(delete this._objectPoint[L.Util.stamp(t)],i=0,r=l.length;i<r;i++)if(l[i]===t)return l.splice(i,1),1===r&&delete a[n],!0},eachObject:function(t,e){var i,r,n,o,s,a,l=this._grid;for(i in l)for(r in s=l[i])for(n=0,o=(a=s[r]).length;n<o;n++)t.call(e,a[n])&&(n--,o--)},getNearObject:function(t){var e,i,r,n,o,s,a,l,c=this._getCoord(t.x),u=this._getCoord(t.y),h=this._objectPoint,p=this._sqCellSize,d=null;for(e=u-1;e<=u+1;e++)if(n=this._grid[e])for(i=c-1;i<=c+1;i++)if(o=n[i])for(r=0,s=o.length;r<s;r++)a=o[r],((l=this._sqDist(h[L.Util.stamp(a)],t))<p||l<=p&&null===d)&&(p=l,d=a);return d},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}},L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat;return(e[0].lng-e[1].lng)*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i,r,n,o=0,s=null,a=[];for(i=e.length-1;i>=0;i--)r=e[i],(n=this.getDistant(r,t))>0&&(a.push(r),n>o&&(o=n,s=r));return{maxPoint:s,newPoints:a}},buildConvexHull:function(t,e){var i=[],r=this.findMostDistantPointFromBaseLine(t,e);return r.maxPoint?i=(i=i.concat(this.buildConvexHull([t[0],r.maxPoint],r.newPoints))).concat(this.buildConvexHull([r.maxPoint,t[1]],r.newPoints)):[t[0]]},getConvexHull:function(t){var e,i=!1,r=!1,n=!1,o=!1,s=null,a=null,l=null,c=null,u=null,h=null;for(e=t.length-1;e>=0;e--){var p=t[e];(!1===i||p.lat>i)&&(s=p,i=p.lat),(!1===r||p.lat<r)&&(a=p,r=p.lat),(!1===n||p.lng>n)&&(l=p,n=p.lng),(!1===o||p.lng<o)&&(c=p,o=p.lng)}return r!==i?(h=a,u=s):(h=c,u=l),[].concat(this.buildConvexHull([h,u],t),this.buildConvexHull([u,h],t))}},L.MarkerCluster.include({getConvexHull:function(){var t,e,i=this.getAllChildMarkers(),r=[];for(e=i.length-1;e>=0;e--)t=i[e].getLatLng(),r.push(t);return L.QuickHull.getConvexHull(r)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(null,!0),i=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?t=this._group.options.spiderfyShapePositions(e.length,i):e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,i):(i.y+=10,t=this._generatePointsCircle(e.length,i)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i,r,n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t)/this._2PI,o=this._2PI/t,s=[];for(n=Math.max(n,35),s.length=t,i=0;i<t;i++)r=this._circleStartAngle+i*o,s[i]=new L.Point(e.x+n*Math.cos(r),e.y+n*Math.sin(r))._round();return s},_generatePointsSpiral:function(t,e){var i,r=this._group.options.spiderfyDistanceMultiplier,n=r*this._spiralLengthStart,o=r*this._spiralFootSeparation,s=r*this._spiralLengthFactor*this._2PI,a=0,l=[];for(l.length=t,i=t;i>=0;i--)i<t&&(l[i]=new L.Point(e.x+n*Math.cos(a),e.y+n*Math.sin(a))._round()),n+=s/(a+=o/n+5e-4*i);return l},_noanimationUnspiderfy:function(){var t,e,i=this._group,r=i._map,n=i._featureGroup,o=this.getAllChildMarkers(null,!0);for(i._ignoreMove=!0,this.setOpacity(1),e=o.length-1;e>=0;e--)t=o[e],n.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(r.removeLayer(t._spiderLeg),delete t._spiderLeg);i.fire("unspiderfied",{cluster:this,markers:o}),i._ignoreMove=!1,i._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var i,r,n,o,s=this._group,a=s._map,l=s._featureGroup,c=this._group.options.spiderLegPolylineOptions;for(s._ignoreMove=!0,i=0;i<t.length;i++)o=a.layerPointToLatLng(e[i]),r=t[i],n=new L.Polyline([this._latlng,o],c),a.addLayer(n),r._spiderLeg=n,r._preSpiderfyLatlng=r._latlng,r.setLatLng(o),r.setZIndexOffset&&r.setZIndexOffset(1e6),l.addLayer(r);this.setOpacity(.3),s._ignoreMove=!1,s.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var i,r,n,o,s,a,l=this,c=this._group,u=c._map,h=c._featureGroup,p=this._latlng,d=u.latLngToLayerPoint(p),f=L.Path.SVG,m=L.extend({},this._group.options.spiderLegPolylineOptions),g=m.opacity;for(void 0===g&&(g=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),f?(m.opacity=0,m.className=(m.className||"")+" leaflet-cluster-spider-leg"):m.opacity=g,c._ignoreMove=!0,i=0;i<t.length;i++)r=t[i],a=u.layerPointToLatLng(e[i]),n=new L.Polyline([p,a],m),u.addLayer(n),r._spiderLeg=n,f&&(s=(o=n._path).getTotalLength()+.1,o.style.strokeDasharray=s,o.style.strokeDashoffset=s),r.setZIndexOffset&&r.setZIndexOffset(1e6),r.clusterHide&&r.clusterHide(),h.addLayer(r),r._setPos&&r._setPos(d);for(c._forceLayout(),c._animationStart(),i=t.length-1;i>=0;i--)a=u.layerPointToLatLng(e[i]),(r=t[i])._preSpiderfyLatlng=r._latlng,r.setLatLng(a),r.clusterShow&&r.clusterShow(),f&&((o=(n=r._spiderLeg)._path).style.strokeDashoffset=0,n.setStyle({opacity:g}));this.setOpacity(.3),c._ignoreMove=!1,setTimeout((function(){c._animationEnd(),c.fire("spiderfied",{cluster:l,markers:t})}),200)},_animationUnspiderfy:function(t){var e,i,r,n,o,s,a=this,l=this._group,c=l._map,u=l._featureGroup,h=t?c._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):c.latLngToLayerPoint(this._latlng),p=this.getAllChildMarkers(null,!0),d=L.Path.SVG;for(l._ignoreMove=!0,l._animationStart(),this.setOpacity(1),i=p.length-1;i>=0;i--)(e=p[i])._preSpiderfyLatlng&&(e.closePopup(),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,s=!0,e._setPos&&(e._setPos(h),s=!1),e.clusterHide&&(e.clusterHide(),s=!1),s&&u.removeLayer(e),d&&(o=(n=(r=e._spiderLeg)._path).getTotalLength()+.1,n.style.strokeDashoffset=o,r.setStyle({opacity:0})));l._ignoreMove=!1,setTimeout((function(){var t=0;for(i=p.length-1;i>=0;i--)(e=p[i])._spiderLeg&&t++;for(i=p.length-1;i>=0;i--)(e=p[i])._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&u.removeLayer(e),c.removeLayer(e._spiderLeg),delete e._spiderLeg);l._animationEnd(),l.fire("unspiderfied",{cluster:a,markers:p})}),200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,i;for(e in t)for(i=t[e].__parent;i;)i._iconNeedsUpdate=!0,i=i.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,i;for(e in t)i=t[e],this.hasLayer(i)&&i.setIcon(this._overrideMarkerIcon(i))}}),L.Marker.include({refreshIconOptions:function(t,e){var i=this.options.icon;return L.setOptions(i,t),this.setIcon(i),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),t.MarkerClusterGroup=e,t.MarkerCluster=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)},17423:(t,e,i)=>{var r;r=function(t){var e="polyline-measure-unicode-icon";return t.Control.PolylineMeasure=t.Control.extend({options:{position:"topleft",unit:"metres",clearMeasurementsOnStop:!0,showBearings:!1,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Click to <b>finish line</b><br>",tooltipTextDelete:"Press SHIFT-key and click to <b>delete point</b>",tooltipTextMove:"Click and drag to <b>move point</b><br>",tooltipTextResume:"<br>Press CTRL-key and click to <b>resume line</b>",tooltipTextAdd:"Press CTRL-key and click to <b>add point</b>",measureControlTitleOn:"Turn on PolylineMeasure",measureControlTitleOff:"Turn off PolylineMeasure",measureControlLabel:"&#8614;",measureControlClasses:[],showClearControl:!1,clearControlTitle:"Clear Measurements",clearControlLabel:"&times;",clearControlClasses:[],showUnitControl:!1,distanceShowSameUnit:!1,unitControlTitle:{text:"Change Units",metres:"metres",landmiles:"land miles",nauticalmiles:"nautical miles"},unitControlLabel:{metres:"m",kilometres:"km",feet:"ft",landmiles:"mi",nauticalmiles:"nm"},tempLine:{color:"#00f",weight:2},fixedLine:{color:"#006",weight:2},startCircle:{color:"#000",weight:1,fillColor:"#0f0",fillOpacity:1,radius:3},intermedCircle:{color:"#000",weight:1,fillColor:"#ff0",fillOpacity:1,radius:3},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:6},endCircle:{color:"#000",weight:1,fillColor:"#f00",fillOpacity:1,radius:3}},_arcpoints:100,_circleNr:-1,_lineNr:-1,_createControl:function(e,i,r,n,o,s){var a=document.createElement("a");return a.innerHTML=e,a.setAttribute("title",i),r.forEach((function(t){a.classList.add(t)})),t.DomEvent.on(a,"click",o,s),n.appendChild(a),a},onAdd:function(i){var r=this;i.on("movestart ",(function(){r._mapdragging=!0})),this._container=document.createElement("div"),this._container.classList.add("leaflet-bar"),t.DomEvent.disableClickPropagation(this._container);var n=this.options.measureControlTitleOn,o=this.options.measureControlLabel,s=this.options.measureControlClasses;return-1!=o.indexOf("&")&&s.push(e),this._arrPolylines=[],this._measureControl=this._createControl(o,n,s,this._container,this._toggleMeasure,this),this._defaultControlBgColor=this._measureControl.style.backgroundColor,this._measureControl.setAttribute("id","polyline-measure-control"),this.options.showClearControl&&(n=this.options.clearControlTitle,o=this.options.clearControlLabel,s=this.options.clearControlClasses,-1!=o.indexOf("&")&&s.push(e),this._clearMeasureControl=this._createControl(o,n,s,this._container,this._clearAllMeasurements,this),this._clearMeasureControl.classList.add("polyline-measure-clearControl")),this.options.showUnitControl&&("metres"==this.options.unit?(o=this.options.unitControlLabel.metres,n=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.metres+"]"):"landmiles"==this.options.unit?(o=this.options.unitControlLabel.landmiles,n=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.landmiles+"]"):(o=this.options.unitControlLabel.nauticalmiles,n=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.nauticalmiles+"]"),s=[],this._unitControl=this._createControl(o,n,s,this._container,this._changeUnit,this),this._unitControl.setAttribute("id","unitControlId")),this._container},onRemove:function(){this._measuring&&this._toggleMeasure()},_saveNonpolylineEvents:function(){this._nonpolylineTargets=this._map._targets,void 0!==this._polylineTargets?this._map._targets=this._polylineTargets:this._map._targets={}},_savePolylineEvents:function(){this._polylineTargets=this._map._targets,this._map._targets=this._nonpolylineTargets},_toggleMeasure:function(){this._measuring=!this._measuring,this._measuring?(this._mapdragging=!1,this._saveNonpolylineEvents(),this._measureControl.classList.add("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this.options.backgroundColor,this._measureControl.title=this.options.measureControlTitleOff,this._oldCursor=this._map._container.style.cursor,this._map._container.style.cursor="crosshair",this._doubleClickZoom=this._map.doubleClickZoom.enabled(),this._map.doubleClickZoom.disable(),this._layerPaint||(this._layerPaint=t.layerGroup().addTo(this._map)),this._map.on("mousemove",this._mouseMove,this),this._map.on("click",this._mouseClick,this),t.DomEvent.on(document,"keydown",this._onKeyDown,this),this._resetPathVariables()):(this._savePolylineEvents(),this._measureControl.classList.remove("polyline-measure-controlOnBgColor"),this._measureControl.style.backgroundColor=this._defaultControlBgColor,this._measureControl.title=this.options.measureControlTitleOn,this._map._container.style.cursor=this._oldCursor,this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.off("mouseup",this._dragCircleMouseup,this),t.DomEvent.off(document,"keydown",this._onKeyDown,this),this._doubleClickZoom&&this._map.doubleClickZoom.enable(),this.options.clearMeasurementsOnStop&&this._layerPaint&&this._clearAllMeasurements(),0!==this._cntCircle&&this._finishPolylinePath()),this._map.fire("polylinemeasure:toggle",{sttus:this._measuring})},_clearAllMeasurements:function(){void 0!==this._cntCircle&&0!==this._cntCircle&&this._finishPolylinePath(),this._layerPaint&&this._layerPaint.clearLayers(),this._arrPolylines=[],this._map.fire("polylinemeasure:clear")},_changeUnit:function(){"metres"==this.options.unit?(this.options.unit="landmiles",document.getElementById("unitControlId").innerHTML=this.options.unitControlLabel.landmiles,this._unitControl.title=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.landmiles+"]"):"landmiles"==this.options.unit?(this.options.unit="nauticalmiles",document.getElementById("unitControlId").innerHTML=this.options.unitControlLabel.nauticalmiles,this._unitControl.title=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.nauticalmiles+"]"):(this.options.unit="metres",document.getElementById("unitControlId").innerHTML=this.options.unitControlLabel.metres,this._unitControl.title=this.options.unitControlTitle.text+" ["+this.options.unitControlTitle.metres+"]"),this._currentLine&&this._computeDistance(this._currentLine),this._arrPolylines.map(this._computeDistance.bind(this))},_computeDistance:function(t){var e=0;t.circleCoords.map(function(i,r){if(r>=1){var n=t.circleCoords[r-1].distanceTo(t.circleCoords[r]);e+=n,this._updateTooltip(t.tooltips[r],t.tooltips[r-1],e,n,t.circleCoords[r-1],t.circleCoords[r])}}.bind(this))},_onKeyDown:function(t){if(27===t.keyCode){if(!0===this._resumeFirstpointFlag){this._resumeFirstpointFlag=!1;var e=this._lineNr;this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._layerPaint.removeLayer(this._tooltipNew),this._arrPolylines[e].circleMarkers[0].setStyle(this.options.startCircle);var i="",r=0;return!0===this.options.showBearings&&(i=this.options.bearingTextIn+":---<br>"+this.options.bearingTextOut+":---"),i+='<div class="polyline-measure-tooltip-difference">+0</div>',i+='<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[e].tooltips[0]._icon.innerHTML=i,this._arrPolylines[e].tooltips.map(function(t,i){if(i>=1){var n=this._arrPolylines[e].circleCoords[i-1].distanceTo(this._arrPolylines[e].circleCoords[i]),o=this._arrPolylines[e].circleCoords[i-1],s=this._arrPolylines[e].circleCoords[i];r+=n;var a=this._arrPolylines[e].tooltips[i-1];this._updateTooltip(t,a,r,n,o,s)}}.bind(this)),void this._map.on("mousemove",this._mouseMove,this)}this._currentLine?this._finishPolylinePath(t):this._toggleMeasure()}},_getDistance:function(t){var e,i=t;return"nauticalmiles"===this.options.unit?(e=this.options.unitControlLabel.nauticalmiles,i>=185200?i=(i/1852).toFixed(0):i>=18520?i=(i/1852).toFixed(1):i>=1852?i=(i/1852).toFixed(2):this.options.distanceShowSameUnit?i=(i/1852).toFixed(3):(i=(i/.3048).toFixed(0),e=this.options.unitControlLabel.feet)):"landmiles"===this.options.unit?(e=this.options.unitControlLabel.landmiles,i>=160934.4?i=(i/1609.344).toFixed(0):i>=16093.44?i=(i/1609.344).toFixed(1):i>=1609.344?i=(i/1609.344).toFixed(2):this.options.distanceShowSameUnit?i=(i/1609.344).toFixed(3):(i=(i/.3048).toFixed(0),e=this.options.unitControlLabel.feet)):(e=this.options.unitControlLabel.kilometres,i>=1e5?i=(i/1e3).toFixed(0):i>=1e4?i=(i/1e3).toFixed(1):i>=1e3?i=(i/1e3).toFixed(2):this.options.distanceShowSameUnit?i=(i/1e3).toFixed(3):(i=i.toFixed(0),e=this.options.unitControlLabel.metres)),{value:i,unit:e}},_polylineArc:function(t,e){function i(t){var e=Math.sin((1-t)*a)/Math.sin(a),i=Math.sin(t*a)/Math.sin(a),l=e*Math.cos(r)*Math.cos(n)+i*Math.cos(o)*Math.cos(s),c=e*Math.cos(r)*Math.sin(n)+i*Math.cos(o)*Math.sin(s),u=e*Math.sin(r)+i*Math.sin(o),h=180/Math.PI*Math.atan2(u,Math.sqrt(Math.pow(l,2)+Math.pow(c,2))),p=180/Math.PI*Math.atan2(c,l),d=p-180*n/Math.PI;function f(t){return Math[t>0?"floor":"ceil"](t)}return[h,p-=d<0?360*f((d-180)/360):360*f((d+180)/360)]}var r=t.lat,n=t.lng,o=e.lat,s=e.lng;r=r*Math.PI/180,n=n*Math.PI/180,o=o*Math.PI/180,s=s*Math.PI/180;var a=2*Math.asin(Math.sqrt(Math.pow(Math.sin((r-o)/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin((n-s)/2),2)));return 0===a?[[r,n]]:function(t){for(var e=[],r=1/(t-1),n=0;n<t;n++){var o=i(r*n);e.push(o)}return e}(this._arcpoints)},_updateTooltip:function(t,e,i,r,n,o){var s=function(t,e,i){var r=t.lat/180*Math.PI,n=e.lat/180*Math.PI,o=t.lng/180*Math.PI,s=e.lng/180*Math.PI,a=Math.sin(s-o)*Math.cos(n),l=Math.cos(r)*Math.sin(n)-Math.sin(r)*Math.cos(n)*Math.cos(s-o);if("inbound"===i)var c=(180*Math.atan2(a,l)/Math.PI+180).toFixed(0);else c=(180*Math.atan2(a,l)/Math.PI+360).toFixed(0);return c%360},a=s(o,n,"inbound"),l=s(n,o,"outbound"),c=this._getDistance(i),u=this._getDistance(r),h="";if(u.value>0&&(!0===this.options.showBearings&&(h=this.options.bearingTextIn+": "+a+"<br>"+this.options.bearingTextOut+":---"),h+='<div class="polyline-measure-tooltip-difference">+'+u.value+"&nbsp;"+u.unit+"</div>"),h+='<div class="polyline-measure-tooltip-total">'+c.value+"&nbsp;"+c.unit+"</div>",t._icon.innerHTML=h,!0===this.options.showBearings&&e){var p=e._icon.innerHTML,d=new RegExp(this.options.bearingTextOut+".*"),f=p.replace(d,this.options.bearingTextOut+": "+l+"");e._icon.innerHTML=f}},_drawArrow:function(e){var i=Math.round(e.length/2),r=e[i-1],n=e[i],o=n[1]-r[1],s=n[0]-r[0],a=[r[0]+s/2,r[1]+o/2],l=57.29578*-Math.atan2(s,o),c=t.divIcon({className:"",iconSize:[16,16],iconAnchor:[8,8],html:"<div style = 'font-size: 16px; line-height: 16px; vertical-align:top; transform: rotate("+l+"deg)'>&#x27a4;</div>"}),u=t.marker(a,{icon:c,zIndexOffset:-50}).addTo(this._layerPaint);return this._currentLine||u.bindTooltip(this.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),u.on("click",this._clickedArrow,this),u},_mouseMove:function(t){var e=t.latlng;if(this._map.on("click",this._mouseClick,this),e&&this._currentLine){var i=this._currentLine.circleCoords.last();this._rubberlinePath.setLatLngs(this._polylineArc(i,e));var r=this._currentLine.tooltips.last(),n=this._currentLine.tooltips.slice(-2,-1)[0];r.setLatLng(e);var o=e.distanceTo(i);this._updateTooltip(r,n,this._currentLine.distance+o,o,i,e)}},_startLine:function(e){var i=t.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),r=function(){return this.slice(-1)[0]};this._rubberlinePath=t.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack();var n=this;this._currentLine={id:0,circleCoords:[],circleMarkers:[],arrowMarkers:[],tooltips:[],distance:0,polylinePath:t.polyline([],{color:this.options.fixedLine.color,weight:this.options.fixedLine.weight,interactive:!1}).addTo(this._layerPaint).bringToBack(),handleMarkers:function(e){var i=this.circleMarkers.last();i&&(i.bindTooltip(n.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),i.off("click",n._finishPolylinePath,n),1===this.circleMarkers.length?i.setStyle(n.options.startCircle):i.setStyle(n.options.intermedCircle));var r=new t.CircleMarker(e,n.options.currentCircle).addTo(n._layerPaint);r.bindTooltip(n.options.tooltipTextFinish+n.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),r.cntLine=n._currentLine.id,r.cntCircle=n._cntCircle,n._cntCircle++,r.on("mousedown",n._dragCircle,n),r.on("click",n._finishPolylinePath,n),this.circleMarkers.push(r)},getNewToolTip:function(e){return t.marker(e,{icon:i,interactive:!1})},addPoint:function(t){var e=this.circleCoords.last();if(!e||!e.equals(t)){if(this.circleCoords.push(t),this.circleCoords.length>1){var i=n._polylineArc(e,t);this.circleCoords.length>2&&i.shift(),this.polylinePath.setLatLngs(this.polylinePath.getLatLngs().concat(i));var r=n._drawArrow(i);r.cntLine=n._currentLine.id,r.cntArrow=n._cntCircle-1,n._currentLine.arrowMarkers.push(r);var o=e.distanceTo(t);this.distance+=o;var s=n._currentLine.tooltips.last(),a=n._currentLine.tooltips.slice(-1,-2)[0];n._updateTooltip(s,a,this.distance,o,e,t)}s&&s.setLatLng(t);var l=this.getNewToolTip(t);l.addTo(n._layerPaint),this.tooltips.push(l),this.handleMarkers(t)}},finalize:function(){if(n._layerPaint.removeLayer(this.tooltips.last()),this.tooltips.pop(),n._layerPaint.removeLayer(n._rubberlinePath),this.circleCoords.length>1){this.tooltips.last()._icon.classList.add("polyline-measure-tooltip-end");var t=this.circleMarkers.last();t.setStyle(n.options.endCircle),t.unbindTooltip(),n._currentLine.circleMarkers.map((function(t){t.bindTooltip(n.options.tooltipTextMove+n.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})})),n._currentLine.circleMarkers[0].bindTooltip(n.options.tooltipTextMove+n.options.tooltipTextDelete+n.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),t.bindTooltip(n.options.tooltipTextMove+n.options.tooltipTextDelete+n.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),n._currentLine.arrowMarkers.map((function(t){t.bindTooltip(n.options.tooltipTextAdd,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"})})),t.off("click",n._finishPolylinePath,n),t.on("click",n._resumePolylinePath,n),n._arrPolylines.push(this)}else n._layerPaint.removeLayer(this.circleMarkers.last()),n._layerPaint.removeLayer(this.tooltips.last());n._resetPathVariables()}};var o=t.marker(e,{icon:i,interactive:!1});o.addTo(this._layerPaint);var s="";!0===this.options.showBearings&&(s=this.options.bearingTextIn+":---<br>"+this.options.bearingTextOut+":---"),s+='<div class="polyline-measure-tooltip-difference">+0</div>',s+='<div class="polyline-measure-tooltip-total">0</div>',o._icon.innerHTML=s,this._currentLine.tooltips.push(o),this._currentLine.circleCoords.last=r,this._currentLine.tooltips.last=r,this._currentLine.circleMarkers.last=r,this._currentLine.id=this._arrPolylines.length},_mouseClick:function(t){!t.latlng||this._finishCircleScreencoords&&this._finishCircleScreencoords.equals(t.containerPoint)||(this._currentLine||this._mapdragging||(this._startLine(t.latlng),this._map.fire("polylinemeasure:start",this._currentLine)),this._mapdragging?this._mapdragging=!1:(this._currentLine.addPoint(t.latlng),this._map.fire("polylinemeasure:add",t),this._map.fire("polylinemeasure:change",this._currentLine)))},_finishPolylinePath:function(t){this._map.fire("polylinemeasure:finish",this._currentLine),this._currentLine.finalize(),t&&(this._finishCircleScreencoords=t.containerPoint)},_resumePolylinePath:function(e){if(!0===e.originalEvent.ctrlKey){this._currentLine=this._arrPolylines[e.target.cntLine],this._rubberlinePath=t.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._currentLine.tooltips.last()._icon.classList.remove("polyline-measure-tooltip-end");var i=this._currentLine.getNewToolTip(e.latlng);i.addTo(this._layerPaint),this._currentLine.tooltips.push(i),this._currentLine.circleMarkers.last().unbindTooltip(),this._currentLine.circleMarkers.last().bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.last().setStyle(this.options.currentCircle),this._cntCircle=this._currentLine.circleCoords.length,this._map.fire("polylinemeasure:resume",this._currentLine)}},_resetPathVariables:function(){this._cntCircle=0,this._currentLine=null},_clickedArrow:function(e){if(e.originalEvent.ctrlKey){var i=e.target.cntLine,r=e.target.cntArrow;this._arrPolylines[i].arrowMarkers[r].removeFrom(this._layerPaint);var n=new t.CircleMarker(e.latlng,this.options.intermedCircle).addTo(this._layerPaint);n.cntLine=i,n.on("mousedown",this._dragCircle,this),n.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[i].circleMarkers.splice(r+1,0,n),this._arrPolylines[i].circleMarkers.map((function(t,e){t.cntCircle=e})),this._arrPolylines[i].circleCoords.splice(r+1,0,e.latlng),lineCoords=this._arrPolylines[i].polylinePath.getLatLngs();var o=this._polylineArc(this._arrPolylines[i].circleCoords[r],e.latlng);o.pop();var s=this._polylineArc(e.latlng,this._arrPolylines[i].circleCoords[r+2]);Array.prototype.splice.apply(lineCoords,[r*(this._arcpoints-1),this._arcpoints].concat(o,s)),this._arrPolylines[i].polylinePath.setLatLngs(lineCoords);var a=this._drawArrow(o);this._arrPolylines[i].arrowMarkers[r]=a,a=this._drawArrow(s),this._arrPolylines[i].arrowMarkers.splice(r+1,0,a),this._arrPolylines[i].arrowMarkers.map((function(t,e){t.cntLine=i,t.cntArrow=e})),this._tooltipNew=t.marker(e.latlng,{icon:t.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint),this._arrPolylines[i].tooltips.splice(r+1,0,this._tooltipNew);var l=0;this._arrPolylines[i].tooltips.map(function(t,e){if(e>=1){var r=this._arrPolylines[i].circleCoords[e-1].distanceTo(this._arrPolylines[i].circleCoords[e]),n=this._arrPolylines[i].circleCoords[e-1],o=this._arrPolylines[i].circleCoords[e];l+=r;var s=this._arrPolylines[i].tooltips[e-1];this._updateTooltip(t,s,l,r,n,o)}}.bind(this)),this._map.fire("polylinemeasure:insert",e),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])}},_dragCircleMouseup:function(){0===this._circleNr||this._circleNr===this._arrPolylines[this._lineNr].circleCoords.length-1?this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}):this._e1.target.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._resetPathVariables(),this._map.off("mousemove",this._dragCircleMousemove,this),this._map.dragging.enable(),this._map.on("mousemove",this._mouseMove,this),this._map.off("mouseup",this._dragCircleMouseup,this),this._map.fire("polylinemeasure:move",this._e1),this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])},_dragCircleMousemove:function(e){var i=e.latlng.lat,r=e.latlng.lng,n=i-this._mouseStartingLat,o=r-this._mouseStartingLng,s=t.latLng(this._circleStartingLat+n,this._circleStartingLng+o),a=this._arcpoints,l=this._e1.target.cntLine;this._lineNr=l;var c=this._e1.target.cntCircle;this._circleNr=c,this._e1.target.setLatLng(s),this._e1.target.unbindTooltip(),this._arrPolylines[l].circleCoords[c]=s;var u=this._arrPolylines[l].polylinePath.getLatLngs();if(c>=1){var h=this._polylineArc(this._arrPolylines[l].circleCoords[c-1],s);Array.prototype.splice.apply(u,[(c-1)*(a-1),a].concat(h));var p=this._drawArrow(h);p.cntLine=l,p.cntArrow=c-1,this._arrPolylines[l].arrowMarkers[c-1].removeFrom(this._layerPaint),this._arrPolylines[l].arrowMarkers[c-1]=p}if(c<this._arrPolylines[l].circleCoords.length-1){var d=this._polylineArc(s,this._arrPolylines[l].circleCoords[c+1]);Array.prototype.splice.apply(u,[c*(a-1),a].concat(d)),(p=this._drawArrow(d)).cntLine=l,p.cntArrow=c,this._arrPolylines[l].arrowMarkers[c].removeFrom(this._layerPaint),this._arrPolylines[l].arrowMarkers[c]=p}this._arrPolylines[l].polylinePath.setLatLngs(u),c>=0&&this._arrPolylines[l].tooltips[c].setLatLng(s);var f=0;this._arrPolylines[l].tooltips.map(function(t,e){if(e>=1){var i=this._arrPolylines[l].circleCoords[e-1].distanceTo(this._arrPolylines[l].circleCoords[e]),r=this._arrPolylines[l].circleCoords[e-1],n=this._arrPolylines[l].circleCoords[e];f+=i,this._arrPolylines[l].distance=f;var o=this._arrPolylines[l].tooltips[e-1];this._updateTooltip(t,o,f,i,r,n)}}.bind(this)),this._map.on("mouseup",this._dragCircleMouseup,this)},_resumeFirstpointMousemove:function(t){var e=this._lineNr;this._map.on("click",this._resumeFirstpointClick,this);var i=t.latlng;this._rubberlinePath2.setLatLngs(this._polylineArc(i,currentCircleCoords)),this._tooltipNew.setLatLng(i);var r=0,n=i.distanceTo(this._arrPolylines[e].circleCoords[0]),o=i,s=this._arrPolylines[e].circleCoords[0];r+=n;var a=this._tooltipNew,l=this._arrPolylines[e].tooltips[0];this._updateTooltip(l,a,r,n,o,s),this._arrPolylines[e].tooltips.map(function(t,i){if(i>=1){var n=this._arrPolylines[e].circleCoords[i-1].distanceTo(this._arrPolylines[e].circleCoords[i]),o=this._arrPolylines[e].circleCoords[i-1],s=this._arrPolylines[e].circleCoords[i];r+=n;var a=this._arrPolylines[e].tooltips[i-1];this._updateTooltip(t,a,r,n,o,s)}}.bind(this))},_resumeFirstpointClick:function(e){var i=this._lineNr;this._resumeFirstpointFlag=!1,this._map.off("mousemove",this._resumeFirstpointMousemove,this),this._map.off("click",this._resumeFirstpointClick,this),this._layerPaint.removeLayer(this._rubberlinePath2),this._arrPolylines[i].circleMarkers[0].setStyle(this.options.intermedCircle),this._arrPolylines[i].circleMarkers[0].unbindTooltip(),this._arrPolylines[i].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"});var r=new t.CircleMarker(e.latlng,this.options.startCircle).addTo(this._layerPaint);r.cntLine=i,r.cntCircle=0,r.on("mousedown",this._dragCircle,this),r.bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[i].circleMarkers.unshift(r),this._arrPolylines[i].circleMarkers.map((function(t,e){t.cntCircle=e})),this._arrPolylines[i].circleCoords.unshift(e.latlng);var n=this._polylineArc(e.latlng,currentCircleCoords),o=this._drawArrow(n);this._arrPolylines[i].arrowMarkers.unshift(o),this._arrPolylines[i].arrowMarkers.map((function(t,e){t.cntLine=i,t.cntArrow=e})),n.pop(),this._arrPolylines[i].polylinePath.setLatLngs(n.concat(this._arrPolylines[i].polylinePath.getLatLngs())),this._arrPolylines[i].tooltips.unshift(this._tooltipNew),this._map.on("mousemove",this._mouseMove,this)},_dragCircle:function(e){var i=this._arcpoints;if(e.originalEvent.ctrlKey){if(this._map.off("click",this._mouseClick,this),0===e.target.cntCircle){this._resumeFirstpointFlag=!0,this._lineNr=e.target.cntLine;var r=this._lineNr;this._circleNr=e.target.cntCircle,currentCircleCoords=e.latlng,this._arrPolylines[r].circleMarkers[0].setStyle(this.options.currentCircle),this._rubberlinePath2=t.polyline([],{color:this.options.tempLine.color,weight:this.options.tempLine.weight,interactive:!1,dashArray:"8,8"}).addTo(this._layerPaint).bringToBack(),this._tooltipNew=t.marker(currentCircleCoords,{icon:t.divIcon({className:"polyline-measure-tooltip",iconAnchor:[-4,-4]}),interactive:!1}),this._tooltipNew.addTo(this._layerPaint);var n="";!0===this.options.showBearings&&(n=n+this.options.bearingTextIn+":---<br>"+this.options.bearingTextOut+":---"),n+='<div class="polyline-measure-tooltip-difference">+0</div>',n+='<div class="polyline-measure-tooltip-total">0</div>',this._tooltipNew._icon.innerHTML=n,this._map.off("mousemove",this._mouseMove,this),this._map.on("mousemove",this._resumeFirstpointMousemove,this)}}else{if(e.originalEvent.shiftKey){this._lineNr=e.target.cntLine,r=this._lineNr,this._circleNr=e.target.cntCircle;var o=this._circleNr;if(this._arrPolylines[r]){if(2===this._arrPolylines[r].circleMarkers.length)return this._layerPaint.removeLayer(this._arrPolylines[r].circleMarkers[1]),this._layerPaint.removeLayer(this._arrPolylines[r].tooltips[1]),this._layerPaint.removeLayer(this._arrPolylines[r].circleMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[r].tooltips[0]),this._layerPaint.removeLayer(this._arrPolylines[r].arrowMarkers[0]),this._layerPaint.removeLayer(this._arrPolylines[r].polylinePath),this._map.fire("polylinemeasure:remove",e),void this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr]);this._arrPolylines[r].circleCoords.splice(o,1),this._arrPolylines[r].circleMarkers[o].removeFrom(this._layerPaint),this._arrPolylines[r].circleMarkers.splice(o,1),this._arrPolylines[r].circleMarkers.map((function(t,e){t.cntCircle=e}));var s=this._arrPolylines[r].polylinePath.getLatLngs();if(this._arrPolylines[r].tooltips[o].removeFrom(this._layerPaint),this._arrPolylines[r].tooltips.splice(o,1),!this._arrPolylines[r].circleMarkers.length)return this._arrPolylines.splice(r,1),void this._arrPolylines.forEach((function(t,e){t.circleMarkers.map((function(t){t.cntLine=e})),t.arrowMarkers.map((function(t){t.cntLine=e}))}));if(0===o)this._arrPolylines[r].circleMarkers[0].setStyle(this.options.startCircle),s.splice(0,i-1),this._arrPolylines[r].circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[r].arrowMarkers[o].removeFrom(this._layerPaint),this._arrPolylines[r].arrowMarkers.splice(0,1),n="",!0===this.options.showBearings&&(n=this.options.bearingTextIn+":---<br>"+this.options.bearingTextOut+":---"),n+='<div class="polyline-measure-tooltip-difference">+0</div>',n+='<div class="polyline-measure-tooltip-total">0</div>',this._arrPolylines[r].tooltips[0]._icon.innerHTML=n;else if(o===this._arrPolylines[r].circleCoords.length)this._arrPolylines[r].circleMarkers[o-1].on("click",this._resumePolylinePath,this),this._arrPolylines[r].circleMarkers[o-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._arrPolylines[r].circleMarkers.slice(-1)[0].setStyle(this.options.endCircle),this._arrPolylines[r].tooltips.slice(-1)[0]._icon.classList.add("polyline-measure-tooltip-end"),s.splice(-(i-1),i-1),this._arrPolylines[r].arrowMarkers[o-1].removeFrom(this._layerPaint),this._arrPolylines[r].arrowMarkers.splice(-1,1);else{newLineSegment=this._polylineArc(this._arrPolylines[r].circleCoords[o-1],this._arrPolylines[r].circleCoords[o]),Array.prototype.splice.apply(s,[(o-1)*(i-1),2*i-1].concat(newLineSegment)),this._arrPolylines[r].arrowMarkers[o-1].removeFrom(this._layerPaint),this._arrPolylines[r].arrowMarkers[o].removeFrom(this._layerPaint);var a=this._drawArrow(newLineSegment);this._arrPolylines[r].arrowMarkers.splice(o-1,2,a)}this._arrPolylines[r].polylinePath.setLatLngs(s),this._arrPolylines[r].arrowMarkers.map((function(t,e){t.cntLine=r,t.cntArrow=e}));var l=0;this._arrPolylines[r].tooltips.map(function(t,e){if(e>=1){var i=this._arrPolylines[r].circleCoords[e-1].distanceTo(this._arrPolylines[r].circleCoords[e]),n=this._arrPolylines[r].circleCoords[e-1],o=this._arrPolylines[r].circleCoords[e];l+=i,this._arrPolylines[r].distance=l;var s=this._arrPolylines[r].tooltips[e-1];this._updateTooltip(t,s,l,i,n,o)}}.bind(this))}else{if(this._cntCircle--,1===this._currentLine.circleMarkers.length)return void this._currentLine.finalize();this._currentLine.circleCoords.splice(o,1),this._currentLine.circleMarkers[o].removeFrom(this._layerPaint),this._currentLine.circleMarkers.splice(o,1),this._currentLine.circleMarkers.map((function(t,e){t.cntCircle=e})),s=this._currentLine.polylinePath.getLatLngs(),this._currentLine.tooltips[o].removeFrom(this._layerPaint),this._currentLine.tooltips.splice(o,1),0===o?(1===this._currentLine.circleMarkers.length?this._currentLine.circleMarkers[0].setStyle(this.options.currentCircle):this._currentLine.circleMarkers[0].setStyle(this.options.startCircle),s.splice(0,i-1),this._currentLine.circleMarkers[0].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.arrowMarkers[o].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(0,1),n="",!0===this.options.showBearings&&(n=this.options.bearingTextIn+":---<br>"+this.options.bearingTextOut+":---"),n+='<div class="polyline-measure-tooltip-difference">+0</div>',n+='<div class="polyline-measure-tooltip-total">0</div>',this._currentLine.tooltips[0]._icon.innerHTML=n):o===this._currentLine.circleCoords.length?(this._currentLine.circleMarkers[o-1].on("click",this._resumePolylinePath,this),this._currentLine.circleMarkers[o-1].bindTooltip(this.options.tooltipTextMove+this.options.tooltipTextDelete+this.options.tooltipTextResume,{direction:"top",opacity:.7,className:"polyline-measure-popupTooltip"}),this._currentLine.circleMarkers.slice(-1)[0].setStyle(this.options.currentCircle),this._currentLine.tooltips.slice(-1)[0]._icon.classList.add("polyline-measure-tooltip-end"),s.splice(-(i-1),i-1),this._currentLine.arrowMarkers[o-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers.splice(-1,1)):(newLineSegment=this._polylineArc(this._currentLine.circleCoords[o-1],this._currentLine.circleCoords[o]),Array.prototype.splice.apply(s,[(o-1)*(i-1),2*i-1].concat(newLineSegment)),this._currentLine.arrowMarkers[o-1].removeFrom(this._layerPaint),this._currentLine.arrowMarkers[o].removeFrom(this._layerPaint),a=this._drawArrow(newLineSegment),this._currentLine.arrowMarkers.splice(o-1,2,a)),this._currentLine.polylinePath.setLatLngs(s),this._currentLine.arrowMarkers.map((function(t,e){t.cntLine=r,t.cntArrow=e}));var c=0;this._currentLine.tooltips.map(function(t,i,r){if(i>=1){var n,o,s=this._currentLine.tooltips[i-1],a=this._currentLine.circleCoords[i-1];i===r.length-1?(n=this._currentLine.circleCoords[i-1].distanceTo(e.latlng),o=e.latlng,this._updateTooltip(t,s,c+n,n,a,o)):(n=this._currentLine.circleCoords[i-1].distanceTo(this._currentLine.circleCoords[i]),o=this._currentLine.circleCoords[i],c+=n,this._updateTooltip(t,s,c,n,a,o))}}.bind(this)),this._currentLine.distance=c}return this._map.fire("polylinemeasure:remove",e),void this._map.fire("polylinemeasure:change",this._arrPolylines[this._lineNr])}this._e1=e,this._measuring&&0===this._cntCircle&&(this._map.dragging.disable(),this._map.off("mousemove",this._mouseMove,this),this._map.off("click",this._mouseClick,this),this._mouseStartingLat=e.latlng.lat,this._mouseStartingLng=e.latlng.lng,this._circleStartingLat=e.target._latlng.lat,this._circleStartingLng=e.target._latlng.lng,this._map.on("mousemove",this._dragCircleMousemove,this))}},seed:function(e){e.forEach((e=>{this._toggleMeasure(),this._startLine(e[0]),e.forEach(((i,r)=>{const n=t.latLng(i);this._mouseMove({latLng:n}),this._currentLine.addPoint(n),r===e.length-1&&(this._finishPolylinePath(),this._toggleMeasure())}))}))}}),t.Map.mergeOptions({PolylineMeasureControl:!1}),t.Map.addInitHook((function(){this.options.polylineMeasureControl&&(this.PMControl=new t.Control.PolylineMeasure,this.addControl(this.PMControl))})),t.control.polylineMeasure=function(e){return new t.Control.PolylineMeasure(e)},t.Control.PolylineMeasure},"function"==typeof define&&define.amd?define(["leaflet"],r):t.exports=r(i(53481))},53481:function(t,e){!function(t){"use strict";function e(t){var e,i,r,n;for(i=1,r=arguments.length;i<r;i++)for(e in n=arguments[i])t[e]=n[e];return t}var i=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function r(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var r=i.call(arguments,2);return function(){return t.apply(e,r.length?r.concat(i.call(arguments)):arguments)}}var n=0;function o(t){return"_leaflet_id"in t||(t._leaflet_id=++n),t._leaflet_id}function s(t,e,i){var r,n,o,s;return s=function(){r=!1,n&&(o.apply(i,n),n=!1)},o=function(){r?n=arguments:(t.apply(i,arguments),setTimeout(s,e),r=!0)},o}function a(t,e,i){var r=e[1],n=e[0],o=r-n;return t===r&&i?t:((t-n)%o+o)%o+n}function l(){return!1}function c(t,e){if(!1===e)return t;var i=Math.pow(10,void 0===e?6:e);return Math.round(t*i)/i}function u(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function h(t){return u(t).split(/\s+/)}function p(t,e){for(var r in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?i(t.options):{}),e)t.options[r]=e[r];return t.options}function d(t,e,i){var r=[];for(var n in t)r.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+r.join("&")}var f=/\{ *([\w_ -]+) *\}/g;function m(t,e){return t.replace(f,(function(t,i){var r=e[i];if(void 0===r)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(e)),r}))}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function _(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}var y="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function A(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var v=0;function x(t){var e=+new Date,i=Math.max(0,16-(e-v));return v=e+i,window.setTimeout(t,i)}var b=window.requestAnimationFrame||A("RequestAnimationFrame")||x,w=window.cancelAnimationFrame||A("CancelAnimationFrame")||A("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function S(t,e,i){if(!i||b!==x)return b.call(window,r(t,e));t.call(e)}function T(t){t&&w.call(window,t)}var C={__proto__:null,extend:e,create:i,bind:r,get lastId(){return n},stamp:o,throttle:s,wrapNum:a,falseFn:l,formatNum:c,trim:u,splitWords:h,setOptions:p,getParamString:d,template:m,isArray:g,indexOf:_,emptyImageUrl:y,requestFn:b,cancelFn:w,requestAnimFrame:S,cancelAnimFrame:T};function M(){}M.extend=function(t){var r=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=r.__super__=this.prototype,o=i(n);for(var s in o.constructor=r,r.prototype=o,this)Object.prototype.hasOwnProperty.call(this,s)&&"prototype"!==s&&"__super__"!==s&&(r[s]=this[s]);return t.statics&&e(r,t.statics),t.includes&&(function(t){if("undefined"!=typeof L&&L&&L.Mixin){t=g(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(t.includes),e.apply(null,[o].concat(t.includes))),e(o,t),delete o.statics,delete o.includes,o.options&&(o.options=n.options?i(n.options):{},e(o.options,t.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},r},M.include=function(t){var i=this.prototype.options;return e(this.prototype,t),t.options&&(this.prototype.options=i,this.mergeOptions(t.options)),this},M.mergeOptions=function(t){return e(this.prototype.options,t),this},M.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var E={on:function(t,e,i){if("object"==typeof t)for(var r in t)this._on(r,t[r],e);else for(var n=0,o=(t=h(t)).length;n<o;n++)this._on(t[n],e,i);return this},off:function(t,e,i){if(arguments.length)if("object"==typeof t)for(var r in t)this._off(r,t[r],e);else{t=h(t);for(var n=1===arguments.length,o=0,s=t.length;o<s;o++)n?this._off(t[o]):this._off(t[o],e,i)}else delete this._events;return this},_on:function(t,e,i,r){if("function"==typeof e){if(!1===this._listens(t,e,i)){i===this&&(i=void 0);var n={fn:e,ctx:i};r&&(n.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(n)}}else console.warn("wrong listener type: "+typeof e)},_off:function(t,e,i){var r,n,o;if(this._events&&(r=this._events[t]))if(1!==arguments.length)if("function"==typeof e){var s=this._listens(t,e,i);if(!1!==s){var a=r[s];this._firingCount&&(a.fn=l,this._events[t]=r=r.slice()),r.splice(s,1)}}else console.warn("wrong listener type: "+typeof e);else{if(this._firingCount)for(n=0,o=r.length;n<o;n++)r[n].fn=l;delete this._events[t]}},fire:function(t,i,r){if(!this.listens(t,r))return this;var n=e({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var s=0,a=o.length;s<a;s++){var l=o[s],c=l.fn;l.once&&this.off(t,c,l.ctx),c.call(l.ctx||this,n)}this._firingCount--}}return r&&this._propagateEvent(n),this},listens:function(t,e,i,r){"string"!=typeof t&&console.warn('"string" type argument expected');var n=e;"function"!=typeof e&&(r=!!e,n=void 0,i=void 0);var o=this._events&&this._events[t];if(o&&o.length&&!1!==this._listens(t,n,i))return!0;if(r)for(var s in this._eventParents)if(this._eventParents[s].listens(t,e,i,r))return!0;return!1},_listens:function(t,e,i){if(!this._events)return!1;var r=this._events[t]||[];if(!e)return!!r.length;i===this&&(i=void 0);for(var n=0,o=r.length;n<o;n++)if(r[n].fn===e&&r[n].ctx===i)return n;return!1},once:function(t,e,i){if("object"==typeof t)for(var r in t)this._on(r,t[r],e,!0);else for(var n=0,o=(t=h(t)).length;n<o;n++)this._on(t[n],e,i,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[o(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[o(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};E.addEventListener=E.on,E.removeEventListener=E.clearAllEventListeners=E.off,E.addOneTimeEventListener=E.once,E.fireEvent=E.fire,E.hasEventListeners=E.listens;var I=M.extend(E);function P(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}var k=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function N(t,e,i){return t instanceof P?t:g(t)?new P(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new P(t.x,t.y):new P(t,e,i)}function D(t,e){if(t)for(var i=e?[t,e]:t,r=0,n=i.length;r<n;r++)this.extend(i[r])}function O(t,e){return!t||t instanceof D?t:new D(t,e)}function R(t,e){if(t)for(var i=e?[t,e]:t,r=0,n=i.length;r<n;r++)this.extend(i[r])}function F(t,e){return t instanceof R?t:new R(t,e)}function z(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function B(t,e,i){return t instanceof z?t:g(t)&&"object"!=typeof t[0]?3===t.length?new z(t[0],t[1],t[2]):2===t.length?new z(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new z(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new z(t,e,i)}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(t){return this.clone()._add(N(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(N(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new P(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new P(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=k(this.x),this.y=k(this.y),this},distanceTo:function(t){var e=(t=N(t)).x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return(t=N(t)).x===this.x&&t.y===this.y},contains:function(t){return t=N(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+c(this.x)+", "+c(this.y)+")"}},D.prototype={extend:function(t){var e,i;if(!t)return this;if(t instanceof P||"number"==typeof t[0]||"x"in t)e=i=N(t);else if(e=(t=O(t)).min,i=t.max,!e||!i)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)):(this.min=e.clone(),this.max=i.clone()),this},getCenter:function(t){return N((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return N(this.min.x,this.max.y)},getTopRight:function(){return N(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return(t="number"==typeof t[0]||t instanceof P?N(t):O(t))instanceof D?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=O(t);var e=this.min,i=this.max,r=t.min,n=t.max,o=n.x>=e.x&&r.x<=i.x,s=n.y>=e.y&&r.y<=i.y;return o&&s},overlaps:function(t){t=O(t);var e=this.min,i=this.max,r=t.min,n=t.max,o=n.x>e.x&&r.x<i.x,s=n.y>e.y&&r.y<i.y;return o&&s},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,i=this.max,r=Math.abs(e.x-i.x)*t,n=Math.abs(e.y-i.y)*t;return O(N(e.x-r,e.y-n),N(i.x+r,i.y+n))},equals:function(t){return!!t&&(t=O(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},R.prototype={extend:function(t){var e,i,r=this._southWest,n=this._northEast;if(t instanceof z)e=t,i=t;else{if(!(t instanceof R))return t?this.extend(B(t)||F(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return r||n?(r.lat=Math.min(e.lat,r.lat),r.lng=Math.min(e.lng,r.lng),n.lat=Math.max(i.lat,n.lat),n.lng=Math.max(i.lng,n.lng)):(this._southWest=new z(e.lat,e.lng),this._northEast=new z(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,r=Math.abs(e.lat-i.lat)*t,n=Math.abs(e.lng-i.lng)*t;return new R(new z(e.lat-r,e.lng-n),new z(i.lat+r,i.lng+n))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof z||"lat"in t?B(t):F(t);var e,i,r=this._southWest,n=this._northEast;return t instanceof R?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=r.lat&&i.lat<=n.lat&&e.lng>=r.lng&&i.lng<=n.lng},intersects:function(t){t=F(t);var e=this._southWest,i=this._northEast,r=t.getSouthWest(),n=t.getNorthEast(),o=n.lat>=e.lat&&r.lat<=i.lat,s=n.lng>=e.lng&&r.lng<=i.lng;return o&&s},overlaps:function(t){t=F(t);var e=this._southWest,i=this._northEast,r=t.getSouthWest(),n=t.getNorthEast(),o=n.lat>e.lat&&r.lat<i.lat,s=n.lng>e.lng&&r.lng<i.lng;return o&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=F(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},z.prototype={equals:function(t,e){return!!t&&(t=B(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+c(this.lat,t)+", "+c(this.lng,t)+")"},distanceTo:function(t){return j.distance(this,B(t))},wrap:function(){return j.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return F([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new z(this.lat,this.lng,this.alt)}};var U,V={latLngToPoint:function(t,e){var i=this.projection.project(t),r=this.scale(e);return this.transformation._transform(i,r)},pointToLatLng:function(t,e){var i=this.scale(e),r=this.transformation.untransform(t,i);return this.projection.unproject(r)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t);return new D(this.transformation.transform(e.min,i),this.transformation.transform(e.max,i))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?a(t.lng,this.wrapLng,!0):t.lng;return new z(this.wrapLat?a(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),r=e.lat-i.lat,n=e.lng-i.lng;if(0===r&&0===n)return t;var o=t.getSouthWest(),s=t.getNorthEast();return new R(new z(o.lat-r,o.lng-n),new z(s.lat-r,s.lng-n))}},j=e({},V,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,r=t.lat*i,n=e.lat*i,o=Math.sin((e.lat-t.lat)*i/2),s=Math.sin((e.lng-t.lng)*i/2),a=o*o+Math.cos(r)*Math.cos(n)*s*s,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),G=6378137,Z={R:G,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,r=Math.max(Math.min(i,t.lat),-i),n=Math.sin(r*e);return new P(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new z((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(U=G*Math.PI,new D([-U,-U],[U,U]))};function q(t,e,i,r){if(g(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=i,this._d=r}function W(t,e,i,r){return new q(t,e,i,r)}q.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new P((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var H=e({},j,{code:"EPSG:3857",projection:Z,transformation:function(){var t=.5/(Math.PI*Z.R);return W(t,.5,-t,.5)}()}),J=e({},H,{code:"EPSG:900913"});function K(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function $(t,e){var i,r,n,o,s,a,l="";for(i=0,n=t.length;i<n;i++){for(r=0,o=(s=t[i]).length;r<o;r++)l+=(r?"L":"M")+(a=s[r]).x+" "+a.y;l+=e?Dt.svg?"z":"x":""}return l||"M0 0"}var Y,X=document.documentElement.style,Q="ActiveXObject"in window,tt=Q&&!document.addEventListener,et="msLaunchUri"in navigator&&!("documentMode"in document),it=Nt("webkit"),rt=Nt("android"),nt=Nt("android 2")||Nt("android 3"),ot=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),st=rt&&Nt("Google")&&ot<537&&!("AudioNode"in window),at=!!window.opera,lt=!et&&Nt("chrome"),ct=Nt("gecko")&&!it&&!at&&!Q,ut=!lt&&Nt("safari"),ht=Nt("phantom"),pt="OTransition"in X,dt=0===navigator.platform.indexOf("Win"),ft=Q&&"transition"in X,mt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!nt,gt="MozPerspective"in X,_t=!window.L_DISABLE_3D&&(ft||mt||gt)&&!pt&&!ht,yt="undefined"!=typeof orientation||Nt("mobile"),At=yt&&it,vt=yt&&mt,xt=!window.PointerEvent&&window.MSPointerEvent,bt=!(!window.PointerEvent&&!xt),wt="ontouchstart"in window||!!window.TouchEvent,St=!window.L_NO_TOUCH&&(wt||bt),Tt=yt&&at,Ct=yt&&ct,Mt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Et=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",l,e),window.removeEventListener("testPassiveEventSupport",l,e)}catch(t){}return t}(),It=!!document.createElement("canvas").getContext,Lt=!(!document.createElementNS||!K("svg").createSVGRect),Pt=!!Lt&&((Y=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(Y.firstChild&&Y.firstChild.namespaceURI)),kt=!Lt&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(t){return!1}}();function Nt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var Dt={ie:Q,ielt9:tt,edge:et,webkit:it,android:rt,android23:nt,androidStock:st,opera:at,chrome:lt,gecko:ct,safari:ut,phantom:ht,opera12:pt,win:dt,ie3d:ft,webkit3d:mt,gecko3d:gt,any3d:_t,mobile:yt,mobileWebkit:At,mobileWebkit3d:vt,msPointer:xt,pointer:bt,touch:St,touchNative:wt,mobileOpera:Tt,mobileGecko:Ct,retina:Mt,passiveEvents:Et,canvas:It,svg:Lt,vml:kt,inlineSvg:Pt,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Ot=Dt.msPointer?"MSPointerDown":"pointerdown",Rt=Dt.msPointer?"MSPointerMove":"pointermove",Ft=Dt.msPointer?"MSPointerUp":"pointerup",zt=Dt.msPointer?"MSPointerCancel":"pointercancel",Bt={touchstart:Ot,touchmove:Rt,touchend:Ft,touchcancel:zt},Ut={touchstart:function(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&ze(e),Ht(t,e)},touchmove:Ht,touchend:Ht,touchcancel:Ht},Vt={},jt=!1;function Gt(t,e,i){return"touchstart"===e&&(jt||(document.addEventListener(Ot,Zt,!0),document.addEventListener(Rt,qt,!0),document.addEventListener(Ft,Wt,!0),document.addEventListener(zt,Wt,!0),jt=!0)),Ut[e]?(i=Ut[e].bind(this,i),t.addEventListener(Bt[e],i,!1),i):(console.warn("wrong event specified:",e),l)}function Zt(t){Vt[t.pointerId]=t}function qt(t){Vt[t.pointerId]&&(Vt[t.pointerId]=t)}function Wt(t){delete Vt[t.pointerId]}function Ht(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var i in e.touches=[],Vt)e.touches.push(Vt[i]);e.changedTouches=[e],t(e)}}var Jt=200;var Kt,$t,Yt,Xt,Qt,te=ge(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ee=ge(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ie="webkitTransition"===ee||"OTransition"===ee?ee+"End":"transitionend";function re(t){return"string"==typeof t?document.getElementById(t):t}function ne(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var r=document.defaultView.getComputedStyle(t,null);i=r?r[e]:null}return"auto"===i?null:i}function oe(t,e,i){var r=document.createElement(t);return r.className=e||"",i&&i.appendChild(r),r}function se(t){var e=t.parentNode;e&&e.removeChild(t)}function ae(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function le(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function ce(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function ue(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=fe(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function he(t,e){if(void 0!==t.classList)for(var i=h(e),r=0,n=i.length;r<n;r++)t.classList.add(i[r]);else if(!ue(t,e)){var o=fe(t);de(t,(o?o+" ":"")+e)}}function pe(t,e){void 0!==t.classList?t.classList.remove(e):de(t,u((" "+fe(t)+" ").replace(" "+e+" "," ")))}function de(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function fe(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function me(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&function(t,e){var i=!1,r="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(r)}catch(t){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+r+"(opacity="+e+")"}(t,e)}function ge(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function _e(t,e,i){var r=e||new P(0,0);t.style[te]=(Dt.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(i?" scale("+i+")":"")}function ye(t,e){t._leaflet_pos=e,Dt.any3d?_e(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Ae(t){return t._leaflet_pos||new P(0,0)}if("onselectstart"in document)Kt=function(){Ee(window,"selectstart",ze)},$t=function(){Le(window,"selectstart",ze)};else{var ve=ge(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Kt=function(){if(ve){var t=document.documentElement.style;Yt=t[ve],t[ve]="none"}},$t=function(){ve&&(document.documentElement.style[ve]=Yt,Yt=void 0)}}function xe(){Ee(window,"dragstart",ze)}function be(){Le(window,"dragstart",ze)}function we(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Se(),Xt=t,Qt=t.style.outlineStyle,t.style.outlineStyle="none",Ee(window,"keydown",Se))}function Se(){Xt&&(Xt.style.outlineStyle=Qt,Xt=void 0,Qt=void 0,Le(window,"keydown",Se))}function Te(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Ce(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var Me={__proto__:null,TRANSFORM:te,TRANSITION:ee,TRANSITION_END:ie,get:re,getStyle:ne,create:oe,remove:se,empty:ae,toFront:le,toBack:ce,hasClass:ue,addClass:he,removeClass:pe,setClass:de,getClass:fe,setOpacity:me,testProp:ge,setTransform:_e,setPosition:ye,getPosition:Ae,get disableTextSelection(){return Kt},get enableTextSelection(){return $t},disableImageDrag:xe,enableImageDrag:be,preventOutline:we,restoreOutline:Se,getSizedParentNode:Te,getScale:Ce};function Ee(t,e,i,r){if(e&&"object"==typeof e)for(var n in e)Ne(t,n,e[n],i);else for(var o=0,s=(e=h(e)).length;o<s;o++)Ne(t,e[o],i,r);return this}var Ie="_leaflet_events";function Le(t,e,i,r){if(1===arguments.length)Pe(t),delete t[Ie];else if(e&&"object"==typeof e)for(var n in e)De(t,n,e[n],i);else if(e=h(e),2===arguments.length)Pe(t,(function(t){return-1!==_(e,t)}));else for(var o=0,s=e.length;o<s;o++)De(t,e[o],i,r);return this}function Pe(t,e){for(var i in t[Ie]){var r=i.split(/\d/)[0];e&&!e(r)||De(t,r,null,null,i)}}var ke={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ne(t,e,i,r){var n=e+o(i)+(r?"_"+o(r):"");if(t[Ie]&&t[Ie][n])return this;var s=function(e){return i.call(r||t,e||window.event)},a=s;!Dt.touchNative&&Dt.pointer&&0===e.indexOf("touch")?s=Gt(t,e,s):Dt.touch&&"dblclick"===e?s=function(t,e){t.addEventListener("dblclick",e);var i,r=0;function n(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var n=Ue(t);if(!n.some((function(t){return t instanceof HTMLLabelElement&&t.attributes.for}))||n.some((function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement}))){var o=Date.now();o-r<=Jt?2==++i&&e(function(t){var e,i,r={};for(i in t)e=t[i],r[i]=e&&e.bind?e.bind(t):e;return t=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}(t)):i=1,r=o}}}else i=t.detail}return t.addEventListener("click",n),{dblclick:e,simDblclick:n}}(t,s):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(ke[e]||e,s,!!Dt.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,Ze(t,e)&&a(e)},t.addEventListener(ke[e],s,!1)):t.addEventListener(e,a,!1):t.attachEvent("on"+e,s),t[Ie]=t[Ie]||{},t[Ie][n]=s}function De(t,e,i,r,n){n=n||e+o(i)+(r?"_"+o(r):"");var s=t[Ie]&&t[Ie][n];if(!s)return this;!Dt.touchNative&&Dt.pointer&&0===e.indexOf("touch")?function(t,e,i){Bt[e]?t.removeEventListener(Bt[e],i,!1):console.warn("wrong event specified:",e)}(t,e,s):Dt.touch&&"dblclick"===e?function(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}(t,s):"removeEventListener"in t?t.removeEventListener(ke[e]||e,s,!1):t.detachEvent("on"+e,s),t[Ie][n]=null}function Oe(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Re(t){return Ne(t,"wheel",Oe),this}function Fe(t){return Ee(t,"mousedown touchstart dblclick contextmenu",Oe),t._leaflet_disable_click=!0,this}function ze(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Be(t){return ze(t),Oe(t),this}function Ue(t){if(t.composedPath)return t.composedPath();for(var e=[],i=t.target;i;)e.push(i),i=i.parentNode;return e}function Ve(t,e){if(!e)return new P(t.clientX,t.clientY);var i=Ce(e),r=i.boundingClientRect;return new P((t.clientX-r.left)/i.x-e.clientLeft,(t.clientY-r.top)/i.y-e.clientTop)}var je=Dt.linux&&Dt.chrome?window.devicePixelRatio:Dt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Ge(t){return Dt.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/je:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function Ze(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(t){return!1}return i!==t}var qe={__proto__:null,on:Ee,off:Le,stopPropagation:Oe,disableScrollPropagation:Re,disableClickPropagation:Fe,preventDefault:ze,stop:Be,getPropagationPath:Ue,getMousePosition:Ve,getWheelDelta:Ge,isExternalTarget:Ze,addListener:Ee,removeListener:Le},We=I.extend({run:function(t,e,i,r){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Ae(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=S(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),ye(this._el,i),this.fire("step")},_complete:function(){T(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),He=I.extend({options:{crs:H,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=p(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=r(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(B(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ee&&Dt.any3d&&!Dt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ee(this._proxy,ie,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,r){return i=void 0===i?this._zoom:this._limitZoom(i),t=this._limitCenter(B(t),i,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=e({animate:r.animate},r.zoom),r.pan=e({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,r.zoom):this._tryAnimatedPan(t,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,i,r.pan&&r.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(Dt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(Dt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var r=this.getZoomScale(e),n=this.getSize().divideBy(2),o=(t instanceof P?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/r),s=this.containerPointToLatLng(n.add(o));return this.setView(s,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():F(t);var i=N(e.paddingTopLeft||e.padding||[0,0]),r=N(e.paddingBottomRight||e.padding||[0,0]),n=this.getBoundsZoom(t,!1,i.add(r));if((n="number"==typeof e.maxZoom?Math.min(e.maxZoom,n):n)===1/0)return{center:t.getCenter(),zoom:n};var o=r.subtract(i).divideBy(2),s=this.project(t.getSouthWest(),n),a=this.project(t.getNorthEast(),n);return{center:this.unproject(s.add(a).divideBy(2).add(o),n),zoom:n}},fitBounds:function(t,e){if(!(t=F(t)).isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=N(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new We,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){he(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){if(!1===(i=i||{}).animate||!Dt.any3d)return this.setView(t,e,i);this._stop();var r=this.project(this.getCenter()),n=this.project(t),o=this.getSize(),s=this._zoom;t=B(t),e=void 0===e?s:e;var a=Math.max(o.x,o.y),l=a*this.getZoomScale(s,e),c=n.distanceTo(r)||1,u=1.42,h=u*u;function p(t){var e=(l*l-a*a+(t?-1:1)*h*h*c*c)/(2*(t?l:a)*h*c),i=Math.sqrt(e*e+1)-e;return i<1e-9?-18:Math.log(i)}function d(t){return(Math.exp(t)-Math.exp(-t))/2}function f(t){return(Math.exp(t)+Math.exp(-t))/2}var m=p(0);function g(t){return a*(f(m)*(d(e=m+u*t)/f(e))-d(m))/h;var e}var _=Date.now(),y=(p(1)-m)/u,A=i.duration?1e3*i.duration:1e3*y*.8;return this._moveStart(!0,i.noMoveStart),function i(){var o=(Date.now()-_)/A,l=function(t){return 1-Math.pow(1-t,1.5)}(o)*y;o<=1?(this._flyToFrame=S(i,this),this._move(this.unproject(r.add(n.subtract(r).multiplyBy(g(l)/c)),s),this.getScaleZoom(a/function(t){return a*(f(m)/f(m+u*t))}(l),s),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=F(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),r=this._limitCenter(i,this._zoom,F(t));return i.equals(r)||this.panTo(r,e),this._enforcingBounds=!1,this},panInside:function(t,e){var i=N((e=e||{}).paddingTopLeft||e.padding||[0,0]),r=N(e.paddingBottomRight||e.padding||[0,0]),n=this.project(this.getCenter()),o=this.project(t),s=this.getPixelBounds(),a=O([s.min.add(i),s.max.subtract(r)]),l=a.getSize();if(!a.contains(o)){this._enforcingBounds=!0;var c=o.subtract(a.getCenter()),u=a.extend(o).getSize().subtract(l);n.x+=c.x<0?-u.x:u.x,n.y+=c.y<0?-u.y:u.y,this.panTo(this.unproject(n),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},!0===t?{animate:!0}:t);var i=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var n=this.getSize(),o=i.divideBy(2).round(),s=n.divideBy(2).round(),a=o.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(r(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:i,newSize:n})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var i=r(this._handleGeolocationResponse,this),n=r(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(i,n,t):navigator.geolocation.getCurrentPosition(i,n,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new z(t.coords.latitude,t.coords.longitude),i=e.toBounds(2*t.coords.accuracy),r=this._locateOptions;if(r.setView){var n=this.getBoundsZoom(i);this.setView(e,r.maxZoom?Math.min(n,r.maxZoom):n)}var o={latlng:e,bounds:i,timestamp:t.timestamp};for(var s in t.coords)"number"==typeof t.coords[s]&&(o[s]=t.coords[s]);this.fire("locationfound",o)}},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),se(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(T(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)se(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i=oe("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=i),i},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new R(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=F(t),i=N(i||[0,0]);var r=this.getZoom()||0,n=this.getMinZoom(),o=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(i),c=O(this.project(a,r),this.project(s,r)).getSize(),u=Dt.any3d?this.options.zoomSnap:1,h=l.x/c.x,p=l.y/c.y,d=e?Math.max(h,p):Math.min(h,p);return r=this.getScaleZoom(d,r),u&&(r=Math.round(r/(u/100))*(u/100),r=e?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(n,Math.min(o,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new P(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new D(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var r=i.zoom(t*i.scale(e));return isNaN(r)?1/0:r},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(B(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(N(t),e)},layerPointToLatLng:function(t){var e=N(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(B(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(B(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(F(t))},distance:function(t,e){return this.options.crs.distance(B(t),B(e))},containerPointToLayerPoint:function(t){return N(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return N(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(N(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(B(t)))},mouseEventToContainerPoint:function(t){return Ve(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=re(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");Ee(e,"scroll",this._onScroll,this),this._containerId=o(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&Dt.any3d,he(t,"leaflet-container"+(Dt.touch?" leaflet-touch":"")+(Dt.retina?" leaflet-retina":"")+(Dt.ielt9?" leaflet-oldie":"")+(Dt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=ne(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ye(this._mapPane,new P(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(he(t.markerPane,"leaflet-zoom-hide"),he(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,i){ye(this._mapPane,new P(0,0));var r=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,i)._move(t,e)._moveEnd(n),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,i,r){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),r?i&&i.pinch&&this.fire("zoom",i):((n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return T(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){ye(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[o(this._container)]=this;var e=t?Le:Ee;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),Dt.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){T(this._resizeRequest),this._resizeRequest=S((function(){this.invalidateSize({debounceMoveend:!0})}),this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,r=[],n="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,a=!1;s;){if((i=this._targets[o(s)])&&("click"===e||"preclick"===e)&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(n&&!Ze(s,t))break;if(r.push(i),n)break}if(s===this._container)break;s=s.parentNode}return r.length||a||n||!this.listens(e,!0)||(r=[this]),r},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var i=t.type;"mousedown"===i&&we(e),this._fireDOMEvent(t,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,r){if("click"===t.type){var n=e({},t);n.type="preclick",this._fireDOMEvent(n,n.type,r)}var o=this._findEventTargets(t,i);if(r){for(var s=[],a=0;a<r.length;a++)r[a].listens(i,!0)&&s.push(r[a]);o=s.concat(o)}if(o.length){"contextmenu"===i&&ze(t);var l=o[0],c={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var u=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=u?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(t),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=u?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(a=0;a<o.length;a++)if(o[a].fire(i,c,!0),c.originalEvent._stopped||!1===o[a].options.bubblingMouseEvents&&-1!==_(this._mouseEvents,i))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Ae(this._mapPane)||new P(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var r=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(r)},_latLngBoundsToNewLayerBounds:function(t,e,i){var r=this._getNewPixelOrigin(i,e);return O([this.project(t.getSouthWest(),e)._subtract(r),this.project(t.getNorthWest(),e)._subtract(r),this.project(t.getSouthEast(),e)._subtract(r),this.project(t.getNorthEast(),e)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var r=this.project(t,e),n=this.getSize().divideBy(2),o=new D(r.subtract(n),r.add(n)),s=this._getBoundsOffset(o,i,e);return Math.abs(s.x)<=1&&Math.abs(s.y)<=1?t:this.unproject(r.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),r=new D(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(r,e))},_getBoundsOffset:function(t,e,i){var r=O(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),n=r.min.subtract(t.min),o=r.max.subtract(t.max);return new P(this._rebound(n.x,-o.x),this._rebound(n.y,-o.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),r=Dt.any3d?this.options.zoomSnap:1;return r&&(t=Math.round(t/r)*r),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){pe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(i)||(this.panBy(i,e),0))},_createAnimProxy:function(){var t=this._proxy=oe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",(function(t){var e=te,i=this._proxy.style[e];_e(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()}),this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){se(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();_e(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||!1===i.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/r);return!(!0!==i.animate&&!this.getSize().contains(n)||(S((function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(t,e,!0)}),this),0))},_animateZoom:function(t,e,i,n){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,he(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:n}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(r(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&pe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var Je=M.extend({options:{position:"topright"},initialize:function(t){p(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),r=t._controlCorners[i];return he(e,"leaflet-control"),-1!==i.indexOf("bottom")?r.insertBefore(e,r.firstChild):r.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(se(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Ke=function(t){return new Je(t)};He.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=oe("div",e+"control-container",this._container);function r(r,n){var o=e+r+" "+e+n;t[r+n]=oe("div",o,i)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)se(this._controlCorners[t]);se(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var $e=Je.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,r){return i<r?-1:r<i?1:0}},initialize:function(t,e,i){for(var r in p(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[r],r);for(r in e)this._addLayer(e[r],r,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Je.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(o(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){he(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(he(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):pe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return pe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=oe("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Fe(e),Re(e);var r=this._section=oe("section",t+"-list");i&&(this._map.on("click",this.collapse,this),Ee(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var n=this._layersLink=oe("a",t+"-toggle",e);n.href="#",n.title="Layers",n.setAttribute("role","button"),Ee(n,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){ze(t),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=oe("div",t+"-base",r),this._separator=oe("div",t+"-separator",r),this._overlaysList=oe("div",t+"-overlays",r),e.appendChild(r)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&o(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,i){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:i}),this.options.sortLayers&&this._layers.sort(r((function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)}),this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ae(this._baseLayersList),ae(this._overlaysList),this._layerControlInputs=[];var t,e,i,r,n=0;for(i=0;i<this._layers.length;i++)r=this._layers[i],this._addItem(r),e=e||r.overlay,t=t||!r.overlay,n+=r.overlay?0:1;return this.options.hideSingleBase&&(t=t&&n>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(o(t.target)),i=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=i,r.firstChild},_addItem:function(t){var e,i=document.createElement("label"),r=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=r):e=this._createRadioElement("leaflet-base-layers_"+o(this),r),this._layerControlInputs.push(e),e.layerId=o(t.layer),Ee(e,"click",this._onInputClick,this);var n=document.createElement("span");n.innerHTML=" "+t.name;var s=document.createElement("span");return i.appendChild(s),s.appendChild(e),s.appendChild(n),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){if(!this._preventClick){var t,e,i=this._layerControlInputs,r=[],n=[];this._handlingClick=!0;for(var o=i.length-1;o>=0;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.checked?r.push(e):t.checked||n.push(e);for(o=0;o<n.length;o++)this._map.hasLayer(n[o])&&this._map.removeLayer(n[o]);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])||this._map.addLayer(r[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,r=this._map.getZoom(),n=i.length-1;n>=0;n--)t=i[n],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&r<e.options.minZoom||void 0!==e.options.maxZoom&&r>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,Ee(t,"click",ze),this.expand();var e=this;setTimeout((function(){Le(t,"click",ze),e._preventClick=!1}))}}),Ye=Je.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=oe("div",e+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,r,n){var o=oe("a",i,r);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),Fe(o),Ee(o,"click",Be),Ee(o,"click",n,this),Ee(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";pe(this._zoomInButton,e),pe(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(he(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(he(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});He.mergeOptions({zoomControl:!0}),He.addInitHook((function(){this.options.zoomControl&&(this.zoomControl=new Ye,this.addControl(this.zoomControl))}));var Xe=Je.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=oe("div",e),r=this.options;return this._addScales(r,e+"-line",i),t.on(r.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=oe("div",e,i)),t.imperial&&(this._iScale=oe("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,r,n=3.2808399*t;n>5280?(e=n/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(r=this._getRoundNum(n),this._updateScale(this._iScale,r+" ft",r/n))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return e*(i>=10?10:i>=5?5:i>=3?3:i>=2?2:1)}}),Qe=Je.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Dt.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(t){p(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=oe("div","leaflet-control-attribution"),Fe(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",(function(){this.removeAttribution(t.layer.getAttribution())}),this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});He.mergeOptions({attributionControl:!0}),He.addInitHook((function(){this.options.attributionControl&&(new Qe).addTo(this)}));Je.Layers=$e,Je.Zoom=Ye,Je.Scale=Xe,Je.Attribution=Qe,Ke.layers=function(t,e,i){return new $e(t,e,i)},Ke.zoom=function(t){return new Ye(t)},Ke.scale=function(t){return new Xe(t)},Ke.attribution=function(t){return new Qe(t)};var ti=M.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ti.addTo=function(t,e){return t.addHandler(e,this),this};var ei={Events:E},ii=Dt.touch?"touchstart mousedown":"mousedown",ri=I.extend({options:{clickTolerance:3},initialize:function(t,e,i,r){p(this,r),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(Ee(this._dragStartTarget,ii,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ri._dragging===this&&this.finishDrag(!0),Le(this._dragStartTarget,ii,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!ue(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)ri._dragging===this&&this.finishDrag();else if(!(ri._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(ri._dragging=this,this._preventOutline&&we(this._element),xe(),Kt(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,i=Te(this._element);this._startPoint=new P(e.clientX,e.clientY),this._startPos=Ae(this._element),this._parentScale=Ce(i);var r="mousedown"===t.type;Ee(document,r?"mousemove":"touchmove",this._onMove,this),Ee(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new P(e.clientX,e.clientY)._subtract(this._startPoint);(i.x||i.y)&&(Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,ze(t),this._moved||(this.fire("dragstart"),this._moved=!0,he(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),he(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),ye(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){pe(document.body,"leaflet-dragging"),this._lastTarget&&(pe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Le(document,"mousemove touchmove",this._onMove,this),Le(document,"mouseup touchend touchcancel",this._onUp,this),be(),$t();var e=this._moved&&this._moving;this._moving=!1,ri._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function ni(t,e,i){var r,n,o,s,a,l,c,u,h,p=[1,4,2,8];for(n=0,c=t.length;n<c;n++)t[n]._code=fi(t[n],e);for(s=0;s<4;s++){for(u=p[s],r=[],n=0,o=(c=t.length)-1;n<c;o=n++)a=t[n],l=t[o],a._code&u?l._code&u||((h=di(l,a,u,e,i))._code=fi(h,e),r.push(h)):(l._code&u&&((h=di(l,a,u,e,i))._code=fi(h,e),r.push(h)),r.push(a));t=r}return t}function oi(t,e){var i,r,n,o,s,a,l,c,u;if(!t||0===t.length)throw new Error("latlngs not passed");_i(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var h=B([0,0]),p=F(t);p.getNorthWest().distanceTo(p.getSouthWest())*p.getNorthEast().distanceTo(p.getNorthWest())<1700&&(h=si(t));var d=t.length,f=[];for(i=0;i<d;i++){var m=B(t[i]);f.push(e.project(B([m.lat-h.lat,m.lng-h.lng])))}for(a=l=c=0,i=0,r=d-1;i<d;r=i++)n=f[i],o=f[r],s=n.y*o.x-o.y*n.x,l+=(n.x+o.x)*s,c+=(n.y+o.y)*s,a+=3*s;u=0===a?f[0]:[l/a,c/a];var g=e.unproject(N(u));return B([g.lat+h.lat,g.lng+h.lng])}function si(t){for(var e=0,i=0,r=0,n=0;n<t.length;n++){var o=B(t[n]);e+=o.lat,i+=o.lng,r++}return B([e/r,i/r])}var ai,li={__proto__:null,clipPolygon:ni,polygonCenter:oi,centroid:si};function ci(t,e){if(!e||!t.length)return t.slice();var i=e*e;return function(t,e){var i=t.length,r=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(i);r[0]=r[i-1]=1,hi(t,r,e,0,i-1);var n,o=[];for(n=0;n<i;n++)r[n]&&o.push(t[n]);return o}(t=function(t,e){for(var i=[t[0]],r=1,n=0,o=t.length;r<o;r++)mi(t[r],t[n])>e&&(i.push(t[r]),n=r);return n<o-1&&i.push(t[o-1]),i}(t,i),i)}function ui(t,e,i){return Math.sqrt(gi(t,e,i,!0))}function hi(t,e,i,r,n){var o,s,a,l=0;for(s=r+1;s<=n-1;s++)(a=gi(t[s],t[r],t[n],!0))>l&&(o=s,l=a);l>i&&(e[o]=1,hi(t,e,i,r,o),hi(t,e,i,o,n))}function pi(t,e,i,r,n){var o,s,a,l=r?ai:fi(t,i),c=fi(e,i);for(ai=c;;){if(!(l|c))return[t,e];if(l&c)return!1;a=fi(s=di(t,e,o=l||c,i,n),i),o===l?(t=s,l=a):(e=s,c=a)}}function di(t,e,i,r,n){var o,s,a=e.x-t.x,l=e.y-t.y,c=r.min,u=r.max;return 8&i?(o=t.x+a*(u.y-t.y)/l,s=u.y):4&i?(o=t.x+a*(c.y-t.y)/l,s=c.y):2&i?(o=u.x,s=t.y+l*(u.x-t.x)/a):1&i&&(o=c.x,s=t.y+l*(c.x-t.x)/a),new P(o,s,n)}function fi(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function mi(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function gi(t,e,i,r){var n,o=e.x,s=e.y,a=i.x-o,l=i.y-s,c=a*a+l*l;return c>0&&((n=((t.x-o)*a+(t.y-s)*l)/c)>1?(o=i.x,s=i.y):n>0&&(o+=a*n,s+=l*n)),a=t.x-o,l=t.y-s,r?a*a+l*l:new P(o,s)}function _i(t){return!g(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function yi(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),_i(t)}function Ai(t,e){var i,r,n,o,s,a,l,c;if(!t||0===t.length)throw new Error("latlngs not passed");_i(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var u=B([0,0]),h=F(t);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(u=si(t));var p=t.length,d=[];for(i=0;i<p;i++){var f=B(t[i]);d.push(e.project(B([f.lat-u.lat,f.lng-u.lng])))}for(i=0,r=0;i<p-1;i++)r+=d[i].distanceTo(d[i+1])/2;if(0===r)c=d[0];else for(i=0,o=0;i<p-1;i++)if(s=d[i],a=d[i+1],(o+=n=s.distanceTo(a))>r){l=(o-r)/n,c=[a.x-l*(a.x-s.x),a.y-l*(a.y-s.y)];break}var m=e.unproject(N(c));return B([m.lat+u.lat,m.lng+u.lng])}var vi={__proto__:null,simplify:ci,pointToSegmentDistance:ui,closestPointOnSegment:function(t,e,i){return gi(t,e,i)},clipSegment:pi,_getEdgeIntersection:di,_getBitCode:fi,_sqClosestPointOnSegment:gi,isFlat:_i,_flat:yi,polylineCenter:Ai},xi={project:function(t){return new P(t.lng,t.lat)},unproject:function(t){return new z(t.y,t.x)},bounds:new D([-180,-90],[180,90])},bi={R:6378137,R_MINOR:6356752.314245179,bounds:new D([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,r=t.lat*e,n=this.R_MINOR/i,o=Math.sqrt(1-n*n),s=o*Math.sin(r),a=Math.tan(Math.PI/4-r/2)/Math.pow((1-s)/(1+s),o/2);return r=-i*Math.log(Math.max(a,1e-10)),new P(t.lng*e*i,r)},unproject:function(t){for(var e,i=180/Math.PI,r=this.R,n=this.R_MINOR/r,o=Math.sqrt(1-n*n),s=Math.exp(-t.y/r),a=Math.PI/2-2*Math.atan(s),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)e=o*Math.sin(a),e=Math.pow((1-e)/(1+e),o/2),a+=c=Math.PI/2-2*Math.atan(s*e)-a;return new z(a*i,t.x*i/r)}},wi={__proto__:null,LonLat:xi,Mercator:bi,SphericalMercator:Z},Si=e({},j,{code:"EPSG:3395",projection:bi,transformation:function(){var t=.5/(Math.PI*bi.R);return W(t,.5,-t,.5)}()}),Ti=e({},j,{code:"EPSG:4326",projection:xi,transformation:W(1/180,1,-1/180,.5)}),Ci=e({},V,{projection:xi,transformation:W(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,r=e.lat-t.lat;return Math.sqrt(i*i+r*r)},infinite:!0});V.Earth=j,V.EPSG3395=Si,V.EPSG3857=H,V.EPSG900913=J,V.EPSG4326=Ti,V.Simple=Ci;var Mi=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[o(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[o(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",(function(){e.off(i,this)}),this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});He.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=o(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=o(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return o(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){for(var e=0,i=(t=t?g(t)?t:[t]:[]).length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[o(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=o(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,i=this._getZoomSpan();for(var r in this._zoomBoundLayers){var n=this._zoomBoundLayers[r].options;t=void 0===n.minZoom?t:Math.min(t,n.minZoom),e=void 0===n.maxZoom?e:Math.max(e,n.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ei=Mi.extend({initialize:function(t,e){var i,r;if(p(this,e),this._layers={},t)for(i=0,r=t.length;i<r;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,r=Array.prototype.slice.call(arguments,1);for(e in this._layers)(i=this._layers[e])[t]&&i[t].apply(i,r);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o(t)}}),Ii=Ei.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Ei.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Ei.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new R;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),Li=M.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){p(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(r,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(t,e){var i=this.options,r=i[e+"Size"];"number"==typeof r&&(r=[r,r]);var n=N(r),o=N("shadow"===e&&i.shadowAnchor||i.iconAnchor||n&&n.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return Dt.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});var Pi=Li.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof Pi.imagePath&&(Pi.imagePath=this._detectIconPath()),(this.options.imagePath||Pi.imagePath)+Li.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,i){var r=e.exec(t);return r&&r[i]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=oe("div","leaflet-default-icon-path",document.body),e=ne(t,"background-image")||ne(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),ki=ti.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ri(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),he(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&pe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,r=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,o=Ae(e._icon),s=i.getPixelBounds(),a=i.getPixelOrigin(),l=O(s.min._subtract(a).add(n),s.max._subtract(a).subtract(n));if(!l.contains(o)){var c=N((Math.max(l.max.x,o.x)-l.max.x)/(s.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(s.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(s.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(s.min.y-l.min.y)).multiplyBy(r);i.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),ye(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=S(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(T(this._panRequest),this._panRequest=S(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,r=Ae(e._icon),n=e._map.layerPointToLatLng(r);i&&ye(i,r),e._latlng=n,t.latlng=n,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){T(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Ni=Mi.extend({options:{icon:new Pi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){p(this,e),this._latlng=B(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=B(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),r=!1;i!==this._icon&&(this._icon&&this._removeIcon(),r=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),he(i,e),t.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ee(i,"focus",this._panOnFocus,this);var n=t.icon.createShadow(this._shadow),o=!1;n!==this._shadow&&(this._removeShadow(),o=!0),n&&(he(n,e),n.alt=""),this._shadow=n,t.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),n&&o&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Le(this._icon,"focus",this._panOnFocus,this),se(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&se(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&ye(this._icon,t),this._shadow&&ye(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(he(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ki)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ki(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&me(this._icon,t),this._shadow&&me(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,i=e.iconSize?N(e.iconSize):N(0,0),r=e.iconAnchor?N(e.iconAnchor):N(0,0);t.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:i.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var Di=Mi.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return p(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Oi=Di.extend({options:{fill:!0,radius:10},initialize:function(t,e){p(this,e),this._latlng=B(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=B(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Di.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),r=[t+i,e+i];this._pxBounds=new D(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Ri=Oi.extend({initialize:function(t,i,r){if("number"==typeof i&&(i=e({},r,{radius:i})),p(this,i),this._latlng=B(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new R(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Di.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,r=i.options.crs;if(r.distance===j.distance){var n=Math.PI/180,o=this._mRadius/j.R/n,s=i.project([e+o,t]),a=i.project([e-o,t]),l=s.add(a).divideBy(2),c=i.unproject(l).lat,u=Math.acos((Math.cos(o*n)-Math.sin(e*n)*Math.sin(c*n))/(Math.cos(e*n)*Math.cos(c*n)))/n;(isNaN(u)||0===u)&&(u=o/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-i.project([c,t-u]).x,this._radiusY=l.y-s.y}else{var h=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(h).x}this._updateBounds()}});var Fi=Di.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){p(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,r=1/0,n=null,o=gi,s=0,a=this._parts.length;s<a;s++)for(var l=this._parts[s],c=1,u=l.length;c<u;c++){var h=o(t,e=l[c-1],i=l[c],!0);h<r&&(r=h,n=o(t,e,i))}return n&&(n.distance=Math.sqrt(r)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ai(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=B(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new R,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return _i(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=_i(t),r=0,n=t.length;r<n;r++)i?(e[r]=B(t[r]),this._bounds.extend(e[r])):e[r]=this._convertLatLngs(t[r]);return e},_project:function(){var t=new D;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new P(t,t);this._rawPxBounds&&(this._pxBounds=new D([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,i){var r,n,o=t[0]instanceof z,s=t.length;if(o){for(n=[],r=0;r<s;r++)n[r]=this._map.latLngToLayerPoint(t[r]),i.extend(n[r]);e.push(n)}else for(r=0;r<s;r++)this._projectLatlngs(t[r],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,i,r,n,o,s,a,l=this._parts;for(e=0,r=0,n=this._rings.length;e<n;e++)for(i=0,o=(a=this._rings[e]).length;i<o-1;i++)(s=pi(a[i],a[i+1],t,i,!0))&&(l[r]=l[r]||[],l[r].push(s[0]),s[1]===a[i+1]&&i!==o-2||(l[r].push(s[1]),r++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,r=t.length;i<r;i++)t[i]=ci(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,r,n,o,s,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,o=this._parts.length;i<o;i++)for(r=0,n=(s=(a=this._parts[i]).length)-1;r<s;n=r++)if((e||0!==r)&&ui(t,a[n],a[r])<=l)return!0;return!1}});Fi._flat=yi;var zi=Fi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return oi(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Fi.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof z&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){Fi.prototype._setLatLngs.call(this,t),_i(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return _i(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new P(e,e);if(t=new D(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var r,n=0,o=this._rings.length;n<o;n++)(r=ni(this._rings[n],t,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,r,n,o,s,a,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,a=this._parts.length;n<a;n++)for(o=0,s=(l=(e=this._parts[n]).length)-1;o<l;s=o++)i=e[o],r=e[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(c=!c);return c||Fi.prototype._containsPoint.call(this,t,!0)}});var Bi=Ii.extend({initialize:function(t,e){p(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,r,n=g(t)?t:t.features;if(n){for(e=0,i=n.length;e<i;e++)((r=n[e]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var s=Ui(t,o);return s?(s.feature=Hi(t),s.defaultOptions=s.options,this.resetStyle(s),o.onEachFeature&&o.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer((function(e){this._setLayerStyle(e,t)}),this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function Ui(t,e){var i,r,n,o,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,l=[],c=e&&e.pointToLayer,u=e&&e.coordsToLatLng||ji;if(!a&&!s)return null;switch(s.type){case"Point":return Vi(c,t,i=u(a),e);case"MultiPoint":for(n=0,o=a.length;n<o;n++)i=u(a[n]),l.push(Vi(c,t,i,e));return new Ii(l);case"LineString":case"MultiLineString":return r=Gi(a,"LineString"===s.type?0:1,u),new Fi(r,e);case"Polygon":case"MultiPolygon":return r=Gi(a,"Polygon"===s.type?1:2,u),new zi(r,e);case"GeometryCollection":for(n=0,o=s.geometries.length;n<o;n++){var h=Ui({geometry:s.geometries[n],type:"Feature",properties:t.properties},e);h&&l.push(h)}return new Ii(l);case"FeatureCollection":for(n=0,o=s.features.length;n<o;n++){var p=Ui(s.features[n],e);p&&l.push(p)}return new Ii(l);default:throw new Error("Invalid GeoJSON object.")}}function Vi(t,e,i,r){return t?t(e,i):new Ni(i,r&&r.markersInheritOptions&&r)}function ji(t){return new z(t[1],t[0],t[2])}function Gi(t,e,i){for(var r,n=[],o=0,s=t.length;o<s;o++)r=e?Gi(t[o],e-1,i):(i||ji)(t[o]),n.push(r);return n}function Zi(t,e){return void 0!==(t=B(t)).alt?[c(t.lng,e),c(t.lat,e),c(t.alt,e)]:[c(t.lng,e),c(t.lat,e)]}function qi(t,e,i,r){for(var n=[],o=0,s=t.length;o<s;o++)n.push(e?qi(t[o],_i(t[o])?0:e-1,i,r):Zi(t[o],r));return!e&&i&&n.length>0&&n.push(n[0].slice()),n}function Wi(t,i){return t.feature?e({},t.feature,{geometry:i}):Hi(i)}function Hi(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Ji={toGeoJSON:function(t){return Wi(this,{type:"Point",coordinates:Zi(this.getLatLng(),t)})}};function Ki(t,e){return new Bi(t,e)}Ni.include(Ji),Ri.include(Ji),Oi.include(Ji),Fi.include({toGeoJSON:function(t){var e=!_i(this._latlngs);return Wi(this,{type:(e?"Multi":"")+"LineString",coordinates:qi(this._latlngs,e?1:0,!1,t)})}}),zi.include({toGeoJSON:function(t){var e=!_i(this._latlngs),i=e&&!_i(this._latlngs[0]),r=qi(this._latlngs,i?2:e?1:0,!0,t);return e||(r=[r]),Wi(this,{type:(i?"Multi":"")+"Polygon",coordinates:r})}}),Ei.include({toMultiPoint:function(t){var e=[];return this.eachLayer((function(i){e.push(i.toGeoJSON(t).geometry.coordinates)})),Wi(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var i="GeometryCollection"===e,r=[];return this.eachLayer((function(e){if(e.toGeoJSON){var n=e.toGeoJSON(t);if(i)r.push(n.geometry);else{var o=Hi(n);"FeatureCollection"===o.type?r.push.apply(r,o.features):r.push(o)}}})),i?Wi(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var $i=Ki,Yi=Mi.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=F(e),p(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(he(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){se(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&le(this._image),this},bringToBack:function(){return this._map&&ce(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=F(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:oe("img");he(e,"leaflet-image-layer"),this._zoomAnimated&&he(e,"leaflet-zoom-animated"),this.options.className&&he(e,this.options.className),e.onselectstart=l,e.onmousemove=l,e.onload=r(this.fire,this,"load"),e.onerror=r(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;_e(this._image,i,e)},_reset:function(){var t=this._image,e=new D(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();ye(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){me(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Xi=Yi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:oe("video");if(he(e,"leaflet-image-layer"),this._zoomAnimated&&he(e,"leaflet-zoom-animated"),this.options.className&&he(e,this.options.className),e.onselectstart=l,e.onmousemove=l,e.onloadeddata=r(this.fire,this,"load"),t){for(var i=e.getElementsByTagName("source"),n=[],o=0;o<i.length;o++)n.push(i[o].src);this._url=i.length>0?n:[e.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var s=0;s<this._url.length;s++){var a=oe("source");a.src=this._url[s],e.appendChild(a)}}}});var Qi=Yi.extend({_initImage:function(){var t=this._image=this._url;he(t,"leaflet-image-layer"),this._zoomAnimated&&he(t,"leaflet-zoom-animated"),this.options.className&&he(t,this.options.className),t.onselectstart=l,t.onmousemove=l}});var tr=Mi.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof z||g(t))?(this._latlng=B(t),p(this,e)):(p(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&me(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&me(this._container,1),this.bringToFront(),this.options.interactive&&(he(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(me(this._container,0),this._removeTimeout=setTimeout(r(se,void 0,this._container),200)):se(this._container),this.options.interactive&&(pe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=B(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&le(this._container),this},bringToBack:function(){return this._map&&ce(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Ii){e=null;var i=this._source._layers;for(var r in i)if(i[r]._map){e=i[r];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=N(this.options.offset),i=this._getAnchor();this._zoomAnimated?ye(this._container,t.add(i)):e=e.add(t).add(i);var r=this._containerBottom=-e.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=r+"px",this._container.style.left=n+"px"}},_getAnchor:function(){return[0,0]}});He.include({_initOverlay:function(t,e,i,r){var n=e;return n instanceof t||(n=new t(r).setContent(e)),i&&n.setLatLng(i),n}}),Mi.include({_initOverlay:function(t,e,i,r){var n=i;return n instanceof t?(p(n,r),n._source=this):(n=e&&!r?e:new t(r,this)).setContent(i),n}});var er=tr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,tr.prototype.openOn.call(this,t)},onAdd:function(t){tr.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Di||this._source.on("preclick",Oe))},onRemove:function(t){tr.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Di||this._source.off("preclick",Oe))},getEvents:function(){var t=tr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=oe("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=oe("div",t+"-content-wrapper",e);if(this._contentNode=oe("div",t+"-content",i),Fe(e),Re(this._contentNode),Ee(e,"contextmenu",Oe),this._tipContainer=oe("div",t+"-tip-container",e),this._tip=oe("div",t+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=oe("a",t+"-close-button",e);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',Ee(r,"click",(function(t){ze(t),this.close()}),this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var r=t.offsetHeight,n=this.options.maxHeight,o="leaflet-popup-scrolled";n&&r>n?(e.height=n+"px",he(t,o)):pe(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();ye(this._container,e.add(i))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(ne(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,r=this._containerWidth,n=new P(this._containerLeft,-i-this._containerBottom);n._add(Ae(this._container));var o=t.layerPointToContainerPoint(n),s=N(this.options.autoPanPadding),a=N(this.options.autoPanPaddingTopLeft||s),l=N(this.options.autoPanPaddingBottomRight||s),c=t.getSize(),u=0,h=0;o.x+r+l.x>c.x&&(u=o.x+r-c.x+l.x),o.x-u-a.x<0&&(u=o.x-a.x),o.y+i+l.y>c.y&&(h=o.y+i-c.y+l.y),o.y-h-a.y<0&&(h=o.y-a.y),(u||h)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([u,h]))}},_getAnchor:function(){return N(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});He.mergeOptions({closePopupOnClick:!0}),He.include({openPopup:function(t,e,i){return this._initOverlay(er,t,e,i).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Mi.include({bindPopup:function(t,e){return this._popup=this._initOverlay(er,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Ii||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Be(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof Di?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var ir=tr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){tr.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){tr.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=tr.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=oe("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+o(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,i,r=this._map,n=this._container,o=r.latLngToContainerPoint(r.getCenter()),s=r.layerPointToContainerPoint(t),a=this.options.direction,l=n.offsetWidth,c=n.offsetHeight,u=N(this.options.offset),h=this._getAnchor();"top"===a?(e=l/2,i=c):"bottom"===a?(e=l/2,i=0):"center"===a?(e=l/2,i=c/2):"right"===a?(e=0,i=c/2):"left"===a?(e=l,i=c/2):s.x<o.x?(a="right",e=0,i=c/2):(a="left",e=l+2*(u.x+h.x),i=c/2),t=t.subtract(N(e,i,!0)).add(u).add(h),pe(n,"leaflet-tooltip-right"),pe(n,"leaflet-tooltip-left"),pe(n,"leaflet-tooltip-top"),pe(n,"leaflet-tooltip-bottom"),he(n,"leaflet-tooltip-"+a),ye(n,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&me(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return N(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});He.include({openTooltip:function(t,e,i){return this._initOverlay(ir,t,e,i).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Mi.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ir,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Ii||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(Ee(e,"focus",(function(){this._tooltip._source=t,this.openTooltip()}),this),Ee(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",(function(){e._openOnceFlag=!1,e._openTooltip(t)}))}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,i,r=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),r=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(r)}});var rr=Li.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(i.html instanceof Element?(ae(e),e.appendChild(i.html)):e.innerHTML=!1!==i.html?i.html:"",i.bgPos){var r=N(i.bgPos);e.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});Li.Default=Pi;var nr=Mi.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Dt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){p(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),se(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(le(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ce(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof P?t:new P(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,r=-t(-1/0,1/0),n=0,o=i.length;n<o;n++)e=i[n].style.zIndex,i[n]!==this._container&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Dt.ielt9){me(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var r in this._tiles){var n=this._tiles[r];if(n.current&&n.loaded){var o=Math.min(1,(t-n.loaded)/200);me(n.el,o),o<1?e=!0:(n.active?i=!0:this._onOpaqueTile(n),n.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(T(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this))}},_onOpaqueTile:l,_initContainer:function(){this._container||(this._container=oe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(se(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var r=this._levels[t],n=this._map;return r||((r=this._levels[t]={}).el=oe("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=e,r.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),r.zoom=t,this._setZoomTransform(r,n.getCenter(),n.getZoom()),r.el.offsetWidth,this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:l,_onRemoveLevel:l,_onCreateLevel:l,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var r=e.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)se(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,r){var n=Math.floor(t/2),o=Math.floor(e/2),s=i-1,a=new P(+n,+o);a.z=+s;var l=this._tileCoordsToKey(a),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),s>r&&this._retainParent(n,o,s,r))},_retainChildren:function(t,e,i,r){for(var n=2*t;n<2*t+2;n++)for(var o=2*e;o<2*e+2;o++){var s=new P(n,o);s.z=i+1;var a=this._tileCoordsToKey(s),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<r&&this._retainChildren(n,o,i+1,r))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,r){var n=Math.round(e);n=void 0!==this.options.maxZoom&&n>this.options.maxZoom||void 0!==this.options.minZoom&&n<this.options.minZoom?void 0:this._clampZoom(n);var o=this.options.updateWhenZooming&&n!==this._tileZoom;r&&!o||(this._tileZoom=n,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==n&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var r=this._map.getZoomScale(i,t.zoom),n=t.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(e,i)).round();Dt.any3d?_e(t.el,n,r):ye(t.el,n)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),r=this._tileZoom,n=this._map.getPixelWorldBounds(this._tileZoom);n&&(this._globalTileRange=this._pxBoundsToTileRange(n)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],r).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],r).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],r).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],r).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),r=e.getZoomScale(i,this._tileZoom),n=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*r);return new D(n.subtract(o),n.add(o))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(r),o=n.getCenter(),s=[],a=this.options.keepBuffer,l=new D(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var u=this._tiles[c].coords;u.z===this._tileZoom&&l.contains(new P(u.x,u.y))||(this._tiles[c].current=!1)}if(Math.abs(i-this._tileZoom)>1)this._setView(t,i);else{for(var h=n.min.y;h<=n.max.y;h++)for(var p=n.min.x;p<=n.max.x;p++){var d=new P(p,h);if(d.z=this._tileZoom,this._isValidTile(d)){var f=this._tiles[this._tileCoordsToKey(d)];f?f.current=!0:s.push(d)}}if(s.sort((function(t,e){return t.distanceTo(o)-e.distanceTo(o)})),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(p=0;p<s.length;p++)this._addTile(s[p],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(t);return F(this.options.bounds).overlaps(r)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),r=t.scaleBy(i),n=r.add(i);return[e.unproject(r,t.z),e.unproject(n,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new R(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new P(+e[0],+e[1]);return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(se(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){he(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=l,t.onmousemove=l,Dt.ielt9&&this.options.opacity<1&&me(t,this.options.opacity)},_addTile:function(t,e){var i=this._getTilePos(t),n=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),r(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&S(r(this._tileReady,this,t,null,o)),ye(o,i),this._tiles[n]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,i){e&&this.fire("tileerror",{error:e,tile:i,coords:t});var n=this._tileCoordsToKey(t);(i=this._tiles[n])&&(i.loaded=+new Date,this._map._fadeAnimated?(me(i.el,0),T(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),e||(he(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Dt.ielt9||!this._map._fadeAnimated?S(this._pruneTiles,this):setTimeout(r(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new P(this._wrapX?a(t.x,this._wrapX):t.x,this._wrapY?a(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new D(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});var or=nr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=p(this,e)).detectRetina&&Dt.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var i=document.createElement("img");return Ee(i,"load",r(this._tileOnLoad,this,e,i)),Ee(i,"error",r(this._tileOnError,this,e,i)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(i.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(t),i},getTileUrl:function(t){var i={r:Dt.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=r),i["-y"]=r}return m(this._url,e(i,this.options))},_tileOnLoad:function(t,e){Dt.ielt9?setTimeout(r(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var r=this.options.errorTileUrl;r&&e.getAttribute("src")!==r&&(e.src=r),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=l,e.onerror=l,!e.complete)){e.src=y;var i=this._tiles[t].coords;se(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:i})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",y),nr.prototype._removeTile.call(this,t)},_tileReady:function(t,e,i){if(this._map&&(!i||i.getAttribute("src")!==y))return nr.prototype._tileReady.call(this,t,e,i)}});function sr(t,e){return new or(t,e)}var ar=or.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var r=e({},this.defaultWmsParams);for(var n in i)n in this.options||(r[n]=i[n]);var o=(i=p(this,i)).detectRetina&&Dt.retina?2:1,s=this.getTileSize();r.width=s.x*o,r.height=s.y*o,this.wmsParams=r},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,or.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,r=O(i.project(e[0]),i.project(e[1])),n=r.min,o=r.max,s=(this._wmsVersion>=1.3&&this._crs===Ti?[n.y,n.x,o.y,o.x]:[n.x,n.y,o.x,o.y]).join(","),a=or.prototype.getTileUrl.call(this,t);return a+d(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,i){return e(this.wmsParams,t),i||this.redraw(),this}});or.WMS=ar,sr.wms=function(t,e){return new ar(t,e)};var lr=Mi.extend({options:{padding:.1},initialize:function(t){p(this,t),o(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),he(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),n=this._map.project(this._center,e),o=r.multiplyBy(-i).add(n).subtract(this._map._getNewPixelOrigin(t,e));Dt.any3d?_e(this._container,o,i):ye(this._container,o)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new D(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),cr=lr.extend({options:{tolerance:0},getEvents:function(){var t=lr.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){lr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Ee(t,"mousemove",this._onMouseMove,this),Ee(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ee(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){T(this._redrawRequest),delete this._ctx,se(this._container),Le(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){lr.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),r=Dt.retina?2:1;ye(e,t.min),e.width=r*i.x,e.height=r*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",Dt.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){lr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[o(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,r=e.prev;i?i.prev=r:this._drawLast=r,r?r.next=i:this._drawFirst=i,delete t._order,delete this._layers[o(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,r=t.options.dashArray.split(/[, ]+/),n=[];for(i=0;i<r.length;i++){if(e=Number(r[i]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||S(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new D,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)t=r.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,r,n,o,s=t._parts,a=s.length,l=this._ctx;if(a){for(l.beginPath(),i=0;i<a;i++){for(r=0,n=s[i].length;r<n;r++)o=s[i][r],l[r?"lineTo":"moveTo"](o.x,o.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,r=Math.max(Math.round(t._radius),1),n=(Math.max(Math.round(t._radiusY),1)||r)/r;1!==n&&(i.save(),i.scale(1,n)),i.beginPath(),i.arc(e.x,e.y/n,r,0,2*Math.PI,!1),1!==n&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,r=this._map.mouseEventToLayerPoint(t),n=this._drawFirst;n;n=n.next)(e=n.layer).options.interactive&&e._containsPoint(r)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(i=e);this._fireEvent(!!i&&[i],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(pe(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var i,n,o=this._drawFirst;o;o=o.next)(i=o.layer).options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(he(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(r((function(){this._mouseHoverThrottled=!1}),this),32)}},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var i=e.next,r=e.prev;i&&(i.prev=r,r?r.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var i=e.next,r=e.prev;r&&(r.next=i,i?i.prev=r:r&&(this._drawLast=r),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function ur(t){return Dt.canvas?new cr(t):null}var hr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),pr={_initContainer:function(){this._container=oe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(lr.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=hr("shape");he(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=hr("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;se(e),t.removeInteractiveTarget(e),delete this._layers[o(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,r=t.options,n=t._container;n.stroked=!!r.stroke,n.filled=!!r.fill,r.stroke?(e||(e=t._stroke=hr("stroke")),n.appendChild(e),e.weight=r.weight+"px",e.color=r.color,e.opacity=r.opacity,r.dashArray?e.dashStyle=g(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=r.lineCap.replace("butt","flat"),e.joinstyle=r.lineJoin):e&&(n.removeChild(e),t._stroke=null),r.fill?(i||(i=t._fill=hr("fill")),n.appendChild(i),i.color=r.fillColor||r.color,i.opacity=r.fillOpacity):i&&(n.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),r=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+r+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){le(t._container)},_bringToBack:function(t){ce(t._container)}},dr=Dt.vml?hr:K,fr=lr.extend({_initContainer:function(){this._container=dr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=dr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){se(this._container),Le(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){lr.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),ye(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=dr("path");t.options.className&&he(e,t.options.className),t.options.interactive&&he(e,"leaflet-interactive"),this._updateStyle(t),this._layers[o(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){se(t._path),t.removeInteractiveTarget(t._path),delete this._layers[o(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,$(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),r="a"+i+","+(Math.max(Math.round(t._radiusY),1)||i)+" 0 1,0 ",n=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+r+2*i+",0 "+r+2*-i+",0 ";this._setPath(t,n)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){le(t._path)},_bringToBack:function(t){ce(t._path)}});function mr(t){return Dt.svg||Dt.vml?new fr(t):null}Dt.vml&&fr.include(pr),He.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&ur(t)||mr(t)}});var gr=zi.extend({initialize:function(t,e){zi.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=F(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});fr.create=dr,fr.pointsToPath=$,Bi.geometryToLayer=Ui,Bi.coordsToLatLng=ji,Bi.coordsToLatLngs=Gi,Bi.latLngToCoords=Zi,Bi.latLngsToCoords=qi,Bi.getFeature=Wi,Bi.asFeature=Hi,He.mergeOptions({boxZoom:!0});var _r=ti.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Ee(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Le(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){se(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),Kt(),xe(),this._startPoint=this._map.mouseEventToContainerPoint(t),Ee(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=oe("div","leaflet-zoom-box",this._container),he(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new D(this._point,this._startPoint),i=e.getSize();ye(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(se(this._box),pe(this._container,"leaflet-crosshair")),$t(),be(),Le(document,{contextmenu:Be,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(r(this._resetState,this),0);var e=new R(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});He.addInitHook("addHandler","boxZoom",_r),He.mergeOptions({doubleClickZoom:!0});var yr=ti.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),r=e.options.zoomDelta,n=t.originalEvent.shiftKey?i-r:i+r;"center"===e.options.doubleClickZoom?e.setZoom(n):e.setZoomAround(t.containerPoint,n)}});He.addInitHook("addHandler","doubleClickZoom",yr),He.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Ar=ti.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ri(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}he(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){pe(this._map._container,"leaflet-grab"),pe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=F(this._map.options.maxBounds);this._offsetLimit=O(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,r=this._draggable._newPos.x,n=(r-e+i)%t+e-i,o=(r+e+i)%t-e-i,s=Math.abs(n+i)<Math.abs(o+i)?n:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,i=e.options,r=!i.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),r)e.fire("moveend");else{this._prunePositions(+new Date);var n=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,s=i.easeLinearity,a=n.multiplyBy(s/o),l=a.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,l),u=a.multiplyBy(c/l),h=c/(i.inertiaDeceleration*s),p=u.multiplyBy(-h/2).round();p.x||p.y?(p=e._limitOffset(p,e.options.maxBounds),S((function(){e.panBy(p,{duration:h,easeLinearity:s,noMoveStart:!0,animate:!0})}))):e.fire("moveend")}}});He.addInitHook("addHandler","dragging",Ar),He.mergeOptions({keyboard:!0,keyboardPanDelta:80});var vr=ti.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Ee(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Le(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,r=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(r,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,r=this._panKeys={},n=this.keyCodes;for(e=0,i=n.left.length;e<i;e++)r[n.left[e]]=[-1*t,0];for(e=0,i=n.right.length;e<i;e++)r[n.right[e]]=[t,0];for(e=0,i=n.down.length;e<i;e++)r[n.down[e]]=[0,t];for(e=0,i=n.up.length;e<i;e++)r[n.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,r=this._zoomKeys={},n=this.keyCodes;for(e=0,i=n.zoomIn.length;e<i;e++)r[n.zoomIn[e]]=t;for(e=0,i=n.zoomOut.length;e<i;e++)r[n.zoomOut[e]]=-t},_addHooks:function(){Ee(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Le(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,r=this._map;if(i in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(e=this._panKeys[i],t.shiftKey&&(e=N(e).multiplyBy(3)),r.options.maxBounds&&(e=r._limitOffset(N(e),r.options.maxBounds)),r.options.worldCopyJump){var n=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(e)));r.panTo(n)}else r.panBy(e)}else if(i in this._zoomKeys)r.setZoom(r.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Be(t)}}});He.addInitHook("addHandler","keyboard",vr),He.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var xr=ti.extend({addHooks:function(){Ee(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Le(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Ge(t),i=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var n=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(r(this._performZoom,this),n),Be(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),n=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,o=i?Math.ceil(n/i)*i:n,s=t._limitZoom(e+(this._delta>0?o:-o))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}});He.addInitHook("addHandler","scrollWheelZoom",xr);He.mergeOptions({tapHold:Dt.touchNative&&Dt.safari&&Dt.mobile,tapTolerance:15});var br=ti.extend({addHooks:function(){Ee(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Le(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new P(e.clientX,e.clientY),this._holdTimeout=setTimeout(r((function(){this._cancel(),this._isTapValid()&&(Ee(document,"touchend",ze),Ee(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))}),this),600),Ee(document,"touchend touchcancel contextmenu",this._cancel,this),Ee(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Le(document,"touchend",ze),Le(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Le(document,"touchend touchcancel contextmenu",this._cancel,this),Le(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new P(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});i._simulated=!0,e.target.dispatchEvent(i)}});He.addInitHook("addHandler","tapHold",br),He.mergeOptions({touchZoom:Dt.touch,bounceAtZoomLimits:!0});var wr=ti.extend({addHooks:function(){he(this._map._container,"leaflet-touch-zoom"),Ee(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){pe(this._map._container,"leaflet-touch-zoom"),Le(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(r)._divideBy(2))),this._startDist=i.distanceTo(r),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),Ee(document,"touchmove",this._onTouchMove,this),Ee(document,"touchend touchcancel",this._onTouchEnd,this),ze(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]),o=i.distanceTo(n)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&o>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var s=i._add(n)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),T(this._animRequest);var a=r(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=S(a,this,!0),ze(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,T(this._animRequest),Le(document,"touchmove",this._onTouchMove,this),Le(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});He.addInitHook("addHandler","touchZoom",wr),He.BoxZoom=_r,He.DoubleClickZoom=yr,He.Drag=Ar,He.Keyboard=vr,He.ScrollWheelZoom=xr,He.TapHold=br,He.TouchZoom=wr,t.Bounds=D,t.Browser=Dt,t.CRS=V,t.Canvas=cr,t.Circle=Ri,t.CircleMarker=Oi,t.Class=M,t.Control=Je,t.DivIcon=rr,t.DivOverlay=tr,t.DomEvent=qe,t.DomUtil=Me,t.Draggable=ri,t.Evented=I,t.FeatureGroup=Ii,t.GeoJSON=Bi,t.GridLayer=nr,t.Handler=ti,t.Icon=Li,t.ImageOverlay=Yi,t.LatLng=z,t.LatLngBounds=R,t.Layer=Mi,t.LayerGroup=Ei,t.LineUtil=vi,t.Map=He,t.Marker=Ni,t.Mixin=ei,t.Path=Di,t.Point=P,t.PolyUtil=li,t.Polygon=zi,t.Polyline=Fi,t.Popup=er,t.PosAnimation=We,t.Projection=wi,t.Rectangle=gr,t.Renderer=lr,t.SVG=fr,t.SVGOverlay=Qi,t.TileLayer=or,t.Tooltip=ir,t.Transformation=q,t.Util=C,t.VideoOverlay=Xi,t.bind=r,t.bounds=O,t.canvas=ur,t.circle=function(t,e,i){return new Ri(t,e,i)},t.circleMarker=function(t,e){return new Oi(t,e)},t.control=Ke,t.divIcon=function(t){return new rr(t)},t.extend=e,t.featureGroup=function(t,e){return new Ii(t,e)},t.geoJSON=Ki,t.geoJson=$i,t.gridLayer=function(t){return new nr(t)},t.icon=function(t){return new Li(t)},t.imageOverlay=function(t,e,i){return new Yi(t,e,i)},t.latLng=B,t.latLngBounds=F,t.layerGroup=function(t,e){return new Ei(t,e)},t.map=function(t,e){return new He(t,e)},t.marker=function(t,e){return new Ni(t,e)},t.point=N,t.polygon=function(t,e){return new zi(t,e)},t.polyline=function(t,e){return new Fi(t,e)},t.popup=function(t,e){return new er(t,e)},t.rectangle=function(t,e){return new gr(t,e)},t.setOptions=p,t.stamp=o,t.svg=mr,t.svgOverlay=function(t,e,i){return new Qi(t,e,i)},t.tileLayer=sr,t.tooltip=function(t,e){return new ir(t,e)},t.transformation=W,t.version="1.9.4",t.videoOverlay=function(t,e,i){return new Xi(t,e,i)};var Sr=window.L;t.noConflict=function(){return window.L=Sr,this},window.L=t}(e)},73559:function(t,e,i){var r;r=function(t,e){t.MapboxGL=t.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(i){t.setOptions(this,i),i.accessToken&&(e.accessToken=i.accessToken),this._throttledUpdate=t.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(e){this._container||this._initContainer();var i=this.getPaneName();e.getPane(i).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),e.options.zoomAnimation&&t.DomEvent.on(e._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this),e._addZoomLimit(this)},onRemove:function(e){this._map._proxy&&this._map.options.zoomAnimation&&t.DomEvent.off(this._map._proxy,t.DomUtil.TRANSITION_END,this._transitionEnd,this);var i=this.getPaneName();e.getPane(i).removeChild(this._container)},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMapboxMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getBounds:function(){var e=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return t.latLngBounds(this._map.containerPointToLatLng(i.subtract(e)),this._map.containerPointToLatLng(i.add(e)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_initContainer:function(){var e=this._container=t.DomUtil.create("div","leaflet-gl-layer"),i=this.getSize(),r=this._map.getSize().multiplyBy(this.options.padding);e.style.width=i.x+"px",e.style.height=i.y+"px";var n=this._map.containerPointToLayerPoint([0,0]).subtract(r);t.DomUtil.setPosition(e,n)},_initGL:function(){var i=this._map.getCenter(),r=t.extend({},this.options,{container:this._container,center:[i.lng,i.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap?(this._glMap.setCenter(r.center),this._glMap.setZoom(r.zoom)):this._glMap=new e.Map(r),this._glMap.transform.latRange=null,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var n=this._glMap._actualCanvas;t.DomUtil.addClass(n,"leaflet-image-layer"),t.DomUtil.addClass(n,"leaflet-zoom-animated"),this.options.interactive&&t.DomUtil.addClass(n,"leaflet-interactive"),this.options.className&&t.DomUtil.addClass(n,this.options.className)},_update:function(e){if(this._map&&(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming)){var i=this.getSize(),r=this._container,n=this._glMap,o=this._map.getSize().multiplyBy(this.options.padding),s=this._map.containerPointToLayerPoint([0,0]).subtract(o);t.DomUtil.setPosition(r,s),this._transformGL(n);var a=Math.round(i.x),l=Math.round(i.y);Math.round(n.transform.width)!==a||Math.round(n.transform.height)!==l?(r.style.width=a+"px",r.style.height=l+"px",null!==n._resize&&void 0!==n._resize?n._resize():n.resize()):null!==n._update&&void 0!==n._update?n._update():n.update()}},_transformGL:function(t){var i=this._map.getCenter(),r=t.transform;r.center=e.LngLat.convert([i.lng,i.lat]),r.zoom=this._map.getZoom()-1},_pinchZoom:function(t){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(e){var i=this._map.getZoomScale(e.zoom),r=this._map.getSize().multiplyBy(this.options.padding*i),n=this.getSize()._divideBy(2),o=this._map.project(e.center,e.zoom)._subtract(n)._add(this._map._getMapPanePos().add(r))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),e.zoom)._subtract(o);t.DomUtil.setTransform(this._glMap._actualCanvas,s.subtract(this._offset),i)},_zoomStart:function(t){this._zooming=!0},_zoomEnd:function(){var e=this._map.getZoomScale(this._map.getZoom());t.DomUtil.setTransform(this._glMap._actualCanvas,null,e),this._zooming=!1,this._update()},_transitionEnd:function(e){t.Util.requestAnimFrame((function(){var e=this._map.getZoom(),i=this._map.getCenter(),r=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());t.DomUtil.setTransform(this._glMap._actualCanvas,r,1),this._glMap.once("moveend",t.Util.bind((function(){this._zoomEnd()}),this)),this._glMap.jumpTo({center:i,zoom:e-1})}),this)},_resize:function(t){this._transitionEnd(t)}}),t.mapboxGL=function(e){return new t.MapboxGL(e)}},"function"==typeof define&&define.amd?define(["leaflet","mapbox-gl"],r):t.exports=r(i(53481),i(60842))},60842:function(t,e,i){var r=i(40047);t.exports=function(){"use strict";var t,e,i;function n(r,n){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),i=n(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}return n(0,(function(t){var e="3.3.0";let i;const n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!=r.env.API_URL_REGEX?new RegExp(r.env.API_URL_REGEX):t}catch(e){i=t}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!n.API_URL)return null;try{const t=new URL(n.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function o(t){return n.API_URL_REGEX.test(t)}function s(t){return 0===t.indexOf("mapbox:")}function a(t){return n.API_CDN_URL_REGEX.test(t)}function l(t){return n.API_SPRITE_REGEX.test(t)}function c(t){return n.API_STYLE_REGEX.test(t)&&!l(t)}const u={create:"create",load:"load",fullLoad:"fullLoad"};function h(t){const e=t.name.split("?")[0];return a(e)&&e.includes("mapbox-gl.js")?"javascript":a(e)&&e.includes("mapbox-gl.css")?"css":function(t){return n.API_FONTS_REGEX.test(t)}(e)?"fontRange":l(e)?"sprite":c(e)?"style":function(t){return n.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=f;function f(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}f.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var m=p(d),g=_;function _(t,e){this.x=t,this.y=e}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(t){return t instanceof _?t:Array.isArray(t)?new _(t[0],t[1]):t};var y=p(g);const A=Math.PI/180,v=180/Math.PI;function x(t){return t*A}function b(t){return t*v}const w=[[0,0],[1,0],[1,1],[0,1]];function S(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function T(t,e,i,r){const n=new m(t,e,i,r);return function(t){return n.solve(t)}}const C=T(.25,.1,.25,1);function M(t,e,i){return Math.min(i,Math.max(e,t))}function E(t,e,i){return(i=M((i-t)/(e-t),0,1))*i*(3-2*i)}function I(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function L(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),n[s]=e,0==--r&&i(o,n)}))}))}function P(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let k=1;function N(){return k++}function D(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function O(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function R(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function F(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function z(t,e){return-1!==t.indexOf(e,t.length-e.length)}function B(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function U(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function V(t){return Array.isArray(t)?t.map(V):"object"==typeof t&&t?B(t,V):t}const j={};function G(t){j[t]||("undefined"!=typeof console&&console.warn(t),j[t]=!0)}function Z(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function q(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function W([t,e,i]){const r=x(e+90),n=x(i);return{x:t*Math.cos(r)*Math.sin(n),y:t*Math.sin(r)*Math.sin(n),z:t*Math.cos(n),azimuthal:e,polar:i}}function H(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function J(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let K,$,Y,X,Q,tt,et=null;function it(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function rt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function nt(t,e,i,r){for(;e<i;){const n=e+i>>1;t[n]<r?e=n+1:i=n}return e}function ot(t,e,i,r){for(;e<i;){const n=e+i>>1;t[n]<=r?e=n+1:i=n}return e}function st(){return null==K&&(K=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),K}const at={now:()=>void 0!==X?X:performance.now(),setNow(t){X=t},restoreNow(){X=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;Q||(Q=document.createElement("canvas"));const n=Q.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>Q.width||r>Q.height)&&(Q.width=i,Q.height=r),n.clearRect(-e,-e,i+2*e,r+2*e),n.drawImage(t,0,0,i,r),n.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>($||($=document.createElement("a")),$.href=t,$.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==Y&&(Y=window.matchMedia("(prefers-reduced-motion: reduce)")),Y.matches)},hasCanvasFingerprintNoise(){if(void 0!==tt)return tt;if(!st())return tt=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let r=0;r<t.width;++r)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(r,0,1,1);const r=e.getImageData(0,0,t.width,t.height);i=0;for(let t=0;t<r.data.length;++t)if(t%4!=3&&i++!==r.data[t])return tt=!0,!0;return tt=!1,!1}},lt="mapbox-tiles";let ct,ut,ht=500,pt=50;function dt(){try{return caches}catch(t){}}function ft(){const t=dt();t&&!ct&&(ct=t.open(lt))}function mt(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],r=new URLSearchParams,n=new URLSearchParams(t.slice(e));for(const t of i){const e=n.get(t);e&&r.set(t,e)}return`${t.slice(0,e)}?${r.toString()}`}function gt(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const r=new URLSearchParams(t.slice(i));for(const t in e)r.set(t,e[t]);return`${t.slice(0,i)}?${r.toString()}`}let _t=1/0;const yt={supported:!1,testSupport:function(t){!xt&&vt&&(bt?St(t):At=t)}};let At,vt,xt=!1,bt=!1;const wt="undefined"!=typeof self?self:{};function St(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,vt),t.isContextLost())return;yt.supported=!0}catch(t){}t.deleteTexture(e),xt=!0}wt.document&&(vt=wt.document.createElement("img"),vt.onload=function(){At&&St(At),At=null,bt=!0},vt.onerror=function(){xt=!0,At=null},vt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Tt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Tt);class Ct extends Error{constructor(t,e,i){401===e&&o(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Mt=H()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Et=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Mt())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const i=new AbortController,r=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Mt(),referrerPolicy:t.referrerPolicy,signal:i.signal});let n=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&o(l);var l;"json"===t.type&&r.headers.set("Accept","application/json");const c=(i,n,o)=>{if(s)return;if(i&&"SecurityError"!==i.message&&G(i.toString()),n&&o)return u(n);const l=Date.now();fetch(r).then((i=>{if(i.ok){const t=a?i.clone():null;return u(i,t,l)}return e(new Ct(i.statusText,i.status,t.url))})).catch((i=>{"AbortError"!==i.name&&e(new Error(`${i.message} ${t.url}`))}))},u=(i,o,a)=>{("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{s||(o&&a&&function(t,e,i){if(ft(),!ct)return;const r=J(e.headers.get("Cache-Control")||"");if(r["no-store"])return;const n={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>n.headers.set(e,t))),r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString());const o=n.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-i<42e4)return;let s=mt(t.url);if(206===e.status){const e=t.headers.get("Range");if(!e)return;n.status=200,s=gt(s,{range:e})}!function(t,e){if(void 0===ut)try{new Response(new ReadableStream),ut=!0}catch(t){ut=!1}ut?e(t.body):t.blob().then(e)}(e,(t=>{const e=new Response(t,n);ft(),ct&&ct.then((t=>t.put(s,e))).catch((t=>G(t.message)))}))}(r,o,a),n=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{s||e(new Error(t.message))}))};return a?function(t,e){if(ft(),!ct)return e(null);ct.then((i=>{let r=mt(t.url);const n=t.headers.get("Range");n&&(r=gt(r,{range:n})),i.match(r).then((t=>{const n=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=J(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(t);i.delete(r),n&&i.put(r,t.clone()),e(null,t,n)})).catch(e)})).catch(e)}(r,c):c(null,null),{cancel:()=>{s=!0,n||i.abort()}}}(t,e);if(H()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===t.type)try{r=JSON.parse(i.response)}catch(t){return e(t)}e(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new Ct(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},It=function(t,e){return Et(P(t,{type:"arrayBuffer"}),e)};function Lt(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const Pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let kt,Nt;kt=[],Nt=0;const Dt=function(t,e){if(yt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Nt>=n.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return kt.push(i),i}Nt++;let i=!1;const r=()=>{if(!i)for(i=!0,Nt--;kt.length&&Nt<n.MAX_PARALLEL_IMAGE_REQUESTS;){const t=kt.shift(),{requestParameters:e,callback:i,cancelled:r}=t;r||(t.cancel=Dt(e,i).cancel)}},o=It(t,((t,i,n,o)=>{r(),t?e(t):i&&(self.createImageBitmap?function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((t,i)=>e(t,i,n,o))):function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=Pt}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(r):Pt}(i,((t,i)=>e(t,i,n,o))))}));return{cancel:()=>{o.cancel(),r()}}},Ot="01",Rt="NO_ACCESS_TOKEN",Ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function zt(t){const e=t.match(Ft);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Bt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ut="mapbox.eventData";function Vt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class jt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=Vt(n.ACCESS_TOKEN);let i="";return i=e&&e.u?btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):n.ACCESS_TOKEN||"",t?`${Ut}.${t}:${i}`:`${Ut}:${i}`}fetchEventData(){const t=it("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const t=localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const r=localStorage.getItem(i);r&&(this.anonId=r)}catch(t){G("Unable to read from LocalStorage")}}saveEventData(){const t=it("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(t&&r)try{localStorage.setItem(i,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){G("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,r){if(!n.EVENTS_URL)return;const o=zt(n.EVENTS_URL);o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=e?P(s,e):s,l={url:Bt(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(t,e){return Et(P(t,{method:"POST"}),e)}(l,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const Gt=new class extends jt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){n.EVENTS_URL&&n.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>s(t)||o(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Vt(n.ACCESS_TOKEN),r=i?i.u:n.ACCESS_TOKEN;let o=r!==this.eventData.tokenU;R(this.anonId)||(this.anonId=D(),o=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(s),i=(s-this.eventData.lastSuccess)/864e5;o=o||i>=1||i<-1||t.getDate()!==e.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:Ot,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=s,this.eventData.tokenU=r)}),t):this.processRequests()}},Zt=Gt.postTurnstileEvent.bind(Gt),qt=new class extends jt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,n.EVENTS_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Rt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),R(this.anonId)||(this.anonId=D()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:Ot,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):i&&(this.success[i]=!0)}),t))}remove(){this.errorCb=null}},Wt=qt.postMapLoadEvent.bind(qt),Ht=new class extends jt{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){n.EVENTS_URL&&(t||n.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:r}=this.queue.shift(),n=function(t){const i=performance.getEntriesByType("resource"),r=performance.getEntriesByType("mark"),n=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const r of t[i]){const t=`${i}ResolveRangeMin`,n=`${i}ResolveRangeMax`,o=`${i}RequestCount`,s=`${i}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,r.startTime),e[n]=Math.max(e[n]||-1/0,r.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==r.transferSize&&0===r.transferSize&&a(s),a(o)}return e}(function(t,e){const i={};if(t)for(const r of t){const t=e(r);void 0===i[t]&&(i[t]=[]),i[t].push(r)}return i}(i,h)),o=window.devicePixelRatio,s=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=s?s.effectiveType:void 0,l={counters:[],metadata:[],attributes:[]},p=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in n)p(l.counters,t,n[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(p(l.counters,"interactionRangeMin",t.interactionRange[0]),p(l.counters,"interactionRangeMax",t.interactionRange[1])),r)for(const t of Object.keys(u)){const e=u[t],i=r.find((t=>t.name===e));i&&p(l.counters,e,i.startTime)}return p(l.counters,"visibilityHidden",t.visibilityHidden),p(l.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(c(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(i)),p(l.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),p(l.attributes,"fogEnabled",t.fogEnabled?"true":"false"),p(l.attributes,"projection",t.projection),p(l.attributes,"zoom",t.zoom),p(l.metadata,"devicePixelRatio",o),p(l.metadata,"connectionEffectiveType",a),p(l.metadata,"navigatorUserAgent",navigator.userAgent),p(l.metadata,"screenWidth",window.screen.width),p(l.metadata,"screenHeight",window.screen.height),p(l.metadata,"windowWidth",window.innerWidth),p(l.metadata,"windowHeight",window.innerHeight),p(l.metadata,"mapWidth",t.width/o),p(l.metadata,"mapHeight",t.height/o),p(l.metadata,"webglRenderer",t.renderer),p(l.metadata,"webglVendor",t.vendor),p(l.metadata,"sdkVersion",e),p(l.metadata,"sdkIdentifier","mapbox-gl-js"),l}(r);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(i,n,(()=>{}),t)}},Jt=Ht.postPerformanceEvent.bind(Ht),Kt=new class extends jt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!n.API_URL||!n.SESSION_PATH)return;const o=zt(n.API_URL+n.SESSION_PATH);o.params.push(`sku=${e||""}`),o.params.push(`access_token=${r||n.ACCESS_TOKEN||""}`);const s={url:Bt(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return Et(P(t,{method:"GET"}),e)}(s,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,n.SESSION_PATH&&n.API_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Rt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}remove(){this.errorCb=null}},$t=Kt.getSessionAPI.bind(Kt),Yt=new Set;function Xt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Qt(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class te{constructor(t,e={}){P(this,e),this.type=t}}class ee extends te{constructor(t,e={}){super("error",P({error:t},e))}}class ie{on(t,e){return this._listeners=this._listeners||{},Xt(t,e,this._listeners),this}off(t,e){return Qt(t,e,this._listeners),Qt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Xt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new te(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)Qt(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(P(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof ee&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}t.y=void 0;var re={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ne(t){return(t=Math.round(t))<0?0:t>255?255:t}function oe(t){return ne("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function se(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function ae(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{t.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in re)return re[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var o=i.substr(0,r),s=i.substr(r+1,n-(r+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=se(s.pop());case"rgb":return 3!==s.length?null:[oe(s[0]),oe(s[1]),oe(s[2]),a];case"hsla":if(4!==s.length)return null;a=se(s.pop());case"hsl":if(3!==s.length)return null;var l=(parseFloat(s[0])%360+360)%360/360,c=se(s[1]),u=se(s[2]),h=u<=.5?u*(c+1):u+c-u*c,p=2*u-h;return[ne(255*ae(p,h,l+1/3)),ne(255*ae(p,h,l)),ne(255*ae(p,h,l-1/3)),a];default:return null}}return null}}catch(t){}class le{constructor(t,e,i,r=1){this.r=t,this.g=e,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof le)return e;if("string"!=typeof e)return;const i=t.y(e);return i?new le(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,e,i,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${r})`}toArray(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*i/r,r]}toArray01(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[t/r,e/r,i/r,r]}toArray01Scaled(t){const{r:e,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[e/n*t,i/n*t,r/n*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:r}=this;return[t,e,i,r]}toArray01Linear(){const{r:t,g:e,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(t/r,2.2),Math.pow(e/r,2.2),Math.pow(i/r,2.2),r]}}le.black=new le(0,0,0,1),le.white=new le(1,1,1,1),le.transparent=new le(0,0,0,0),le.red=new le(1,0,0,1),le.blue=new le(0,0,1,1);var ce=le;function ue(t,e,i){return t*(1-i)+e*i}function he(t,e,i){return t.map(((t,r)=>ue(t,e[r],i)))}var pe=Object.freeze({__proto__:null,array:he,color:function(t,e,i){return new ce(ue(t.r,e.r,i),ue(t.g,e.g,i),ue(t.b,e.b,i),ue(t.a,e.a,i))},number:ue});function de(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class fe extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var me=fe;class ge{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new ge(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var _e=ge;const ye={kind:"null"},Ae={kind:"number"},ve={kind:"string"},xe={kind:"boolean"},be={kind:"color"},we={kind:"object"},Se={kind:"value"},Te={kind:"collator"},Ce={kind:"formatted"},Me={kind:"resolvedImage"};function Ee(t,e){return{kind:"array",itemType:t,N:e}}function Ie(t){if("array"===t.kind){const e=Ie(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Le=[ye,Ae,ve,xe,be,Ce,we,Ee(Se),Me];function Pe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Pe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Le)if(!Pe(t,e))return null}return`Expected ${Ie(t)} but found ${Ie(e)} instead.`}function ke(t,e){return e.some((e=>e.kind===t.kind))}function Ne(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class De{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oe{constructor(t,e,i,r,n){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class Re{constructor(t){this.sections=t}static fromString(t){return new Re([new Oe(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length))}static factory(t){return t instanceof Re?t:Re.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class Fe{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,e){return t?new Fe({namePrimary:t,nameSecondary:e,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ze(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Be(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ce)return!0;if(t instanceof De)return!0;if(t instanceof Re)return!0;if(t instanceof Fe)return!0;if(Array.isArray(t)){for(const e of t)if(!Be(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Be(t[e]))return!1;return!0}return!1}function Ue(t){if(null===t)return ye;if("string"==typeof t)return ve;if("boolean"==typeof t)return xe;if("number"==typeof t)return Ae;if(t instanceof ce)return be;if(t instanceof De)return Te;if(t instanceof Re)return Ce;if(t instanceof Fe)return Me;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=Ue(e);if(i){if(i===t)continue;i=Se;break}i=t}return Ee(i||Se,e)}return we}function Ve(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ce||t instanceof Re||t instanceof Fe?t.toString():JSON.stringify(t)}class je{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Be(t[1]))return e.error("invalid value");const i=t[1];let r=Ue(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new je(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ce?["rgba"].concat(this.value.toArray()):this.value instanceof Re?this.value.serialize():this.value}}var Ge=je,Ze=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const qe={string:ve,number:Ae,boolean:xe,object:we};class We{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in qe)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=qe[i],r++}else n=Se;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=Ee(n,o)}else i=qe[n];const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,Se);if(!i)return null;o.push(i)}return new We(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Pe(this.type,Ue(i)))return i;if(e===this.args.length-1)throw new Ze(`Expected value to be of type ${Ie(this.type)}, but found ${Ie(Ue(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((t=>t.serialize())))}}var He=We;class Je{constructor(t){this.type=Ce,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,Ae),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,Ee(ve)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,be),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,Se);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Je(r)}evaluate(t){return new Re(this.sections.map((e=>{const i=e.content.evaluate(t);return Ue(i)===Me?new Oe("",i,null,null,null):new Oe(Ve(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class Ke{constructor(t,e){this.type=Me,this.inputPrimary=t,this.inputSecondary=e}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");const i=e.parse(t[1],1,ve);if(!i)return e.error("No image name provided.");if(2===t.length)return new Ke(i);const r=e.parse(t[2],1,ve);return r?new Ke(i,r):e.error("Secondary image variant is not a string.")}evaluate(t){const e=Fe.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function $e(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Ye={"to-boolean":xe,"to-color":be,"to-number":Ae,"to-string":ve};class Xe{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0],r=[];let n=ye;if("to-array"===i){if(!Array.isArray(t[1]))return null;const i=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);n=Ee(e.expectedType.itemType,i)}else{if(!(i>0&&Be(t[1][0])))return null;n=Ee(Ue(t[1][0]),i)}for(let o=0;o<i;o++){const i=t[1][o];let s;if("array"===$e(i))s=e.parse(i,void 0,n.itemType);else{const t=$e(i);if(t!==n.itemType.kind)return e.error(`Expected ${n.itemType.kind} but found ${t}.`);s=e.registry.literal.parse(["literal",void 0===i?null:i],e)}if(!s)return null;r.push(s)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");n=Ye[i];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,Se);if(!n)return null;r.push(n)}}return new Xe(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof ce)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ze(e[0],e[1],e[2],e[3]),!i))return new ce(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ze(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new Ze(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Re.fromString(Ve(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Fe.fromString(Ve(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):Ve(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Je([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ke(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Qe=Xe;const ti=["Unknown","Point","LineString","Polygon"];var ei=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ce.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class ii{constructor(t,e,i,r,n){this.name=t,this.type=e,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(t){if(!this._evaluate){const t=ii.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],r=ii.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=[];let a=null,l=-1;for(const[r,c]of o){if(Array.isArray(r)&&r.length!==t.length-1)continue;s.push(r),l++,a=new xr(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const o=[];let u=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,s=a.parse(i,1+o.length,n);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=o[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new ii(i,n,c,o,l)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o.map((([t])=>t))).map(ri).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(Ie(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){ii.definitions=e;for(const i in e)t[i]=ii}}function ri(t){return Array.isArray(t)?`(${t.map(Ie).join(", ")})`:`(${Ie(t.type)}...)`}var ni=ii;class oi{constructor(t,e,i){this.type=Te,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,xe);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,xe);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ve),!o)?null:new oi(r,n,o)}evaluate(t){return new De(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var si={exports:{}};si.exports=function(){function t(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var p=i[r],d=n,f=o;for(e(i,n,r),s(i[o],p)>0&&e(i,n,o);d<f;){for(e(i,d,f),d++,f--;s(i[d],p)<0;)d++;for(;s(i[f],p)>0;)f--}0===s(i[n],p)?e(i,n,f):e(i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}return function(e,r,n,o,s){t(e,r,n||0,o||e.length-1,s||i)}}();var ai=p(si.exports);function li(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function ci(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ui(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function hi(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function pi(t,e,i=!1){let r=!1;for(let a=0,l=e.length;a<l;a++){const l=e[a];for(let e=0,a=l.length,c=a-1;e<a;c=e++){const a=l[c],u=l[e];if(hi(t,a,u))return i;(o=a)[1]>(n=t)[1]!=(s=u)[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var n,o,s;return r}function di(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function fi(t,e,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-n[1]*o[0]&&!(!di(t,e,i,r)||!di(i,r,t,e));var n,o}const mi=8192;function gi(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*mi),Math.round(r*n*mi)]}function _i(t,e){for(let i=0;i<e.length;i++)if(pi(t,e[i]))return!0;return!1}function yi(t,e,i){for(const r of i)for(let i=0,n=r.length,o=n-1;i<n;o=i++)if(fi(t,e,r[o],r[i]))return!0;return!1}function Ai(t,e){for(let i=0;i<t.length;++i)if(!pi(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(yi(t[i],t[i+1],e))return!1;return!0}function vi(t,e){for(let i=0;i<e.length;i++)if(Ai(t,e[i]))return!0;return!1}function xi(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=gi(t[n][r],i);ci(e,s),o.push(s)}r.push(o)}return r}function bi(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=xi(t[n],e,i);r.push(o)}return r}function wi(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}ci(e,t)}function Si(t,e,i,r){const n=Math.pow(2,r.z)*mi,o=[r.x*mi,r.y*mi],s=[];if(!t)return s;for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];wi(r,e,i,n),s.push(r)}return s}function Ti(t,e,i,r){const n=Math.pow(2,r.z)*mi,o=[r.x*mi,r.y*mi],s=[];if(!t)return s;for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];ci(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)wi(r,e,i,n)}var a;return s}class Ci{constructor(t,e){this.type=xe,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Be(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ci(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ci(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ci(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=xi(e.coordinates,r,n),s=Si(t.geometry(),i,r,n);if(!ui(i,r))return!1;for(const t of s)if(!pi(t,o))return!1}if("MultiPolygon"===e.type){const o=bi(e.coordinates,r,n),s=Si(t.geometry(),i,r,n);if(!ui(i,r))return!1;for(const t of s)if(!_i(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if(!n)return!1;if("Polygon"===e.type){const o=xi(e.coordinates,r,n),s=Ti(t.geometry(),i,r,n);if(!ui(i,r))return!1;for(const t of s)if(!Ai(t,o))return!1}if("MultiPolygon"===e.type){const o=bi(e.coordinates,r,n),s=Ti(t.geometry(),i,r,n);if(!ui(i,r))return!1;for(const t of s)if(!vi(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Mi=Ci,Ei={exports:{}};Ei.exports=function(){var t={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},e=1/298.257223563,i=e*(2-e),r=Math.PI/180,n=function(e,n){if(void 0===e)throw new Error("No latitude given.");if(n&&!t[n])throw new Error("Unknown unit "+n+". Use one of: "+Object.keys(t).join(", "));var o=6378.137*r*(n?t[n]:1),s=Math.cos(e*r),a=1/(1-i*(1-s*s)),l=Math.sqrt(a);this.kx=o*l*s,this.ky=o*l*a*(1-i)},o={units:{configurable:!0}};function s(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,e,i){var r=l(e[0]-t[0]);return[t[0]+r*i,t[1]+(e[1]-t[1])*i]}function l(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}return n.fromTile=function(t,e,i){var o=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),s=Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/r;return new n(s,i)},o.units.get=function(){return t},n.prototype.distance=function(t,e){var i=l(t[0]-e[0])*this.kx,r=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+r*r)},n.prototype.bearing=function(t,e){var i=l(e[0]-t[0])*this.kx;return Math.atan2(i,(e[1]-t[1])*this.ky)/r},n.prototype.destination=function(t,e,i){var n=i*r;return this.offset(t,Math.sin(n)*e,Math.cos(n)*e)},n.prototype.offset=function(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]},n.prototype.lineDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e},n.prototype.area=function(t){for(var e=0,i=0;i<t.length;i++)for(var r=t[i],n=0,o=r.length,s=o-1;n<o;s=n++)e+=l(r[n][0]-r[s][0])*(r[n][1]+r[s][1])*(i?-1:1);return Math.abs(e)/2*this.kx*this.ky},n.prototype.along=function(t,e){var i=0;if(e<=0)return t[0];for(var r=0;r<t.length-1;r++){var n=t[r],o=t[r+1],s=this.distance(n,o);if((i+=s)>e)return a(n,o,(e-(i-s))/s)}return t[t.length-1]},n.prototype.pointToSegmentDistance=function(t,e,i){var r=e[0],n=e[1],o=l(i[0]-r)*this.kx,s=(i[1]-n)*this.ky,a=0;return 0===o&&0===s||((a=(l(t[0]-r)*this.kx*o+(t[1]-n)*this.ky*s)/(o*o+s*s))>1?(r=i[0],n=i[1]):a>0&&(r+=o/this.kx*a,n+=s/this.ky*a)),o=l(t[0]-r)*this.kx,s=(t[1]-n)*this.ky,Math.sqrt(o*o+s*s)},n.prototype.pointOnLine=function(t,e){for(var i,r,n,o,s=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],h=l(t[a+1][0]-c)*this.kx,p=(t[a+1][1]-u)*this.ky,d=0;0===h&&0===p||((d=(l(e[0]-c)*this.kx*h+(e[1]-u)*this.ky*p)/(h*h+p*p))>1?(c=t[a+1][0],u=t[a+1][1]):d>0&&(c+=h/this.kx*d,u+=p/this.ky*d));var f=(h=l(e[0]-c)*this.kx)*h+(p=(e[1]-u)*this.ky)*p;f<s&&(s=f,i=c,r=u,n=a,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}},n.prototype.lineSlice=function(t,e,i){var r=this.pointOnLine(i,t),n=this.pointOnLine(i,e);if(r.index>n.index||r.index===n.index&&r.t>n.t){var o=r;r=n,n=o}var a=[r.point],l=r.index+1,c=n.index;!s(i[l],a[0])&&l<=c&&a.push(i[l]);for(var u=l+1;u<=c;u++)a.push(i[u]);return s(i[c],n.point)||a.push(n.point),a},n.prototype.lineSliceAlong=function(t,e,i){for(var r=0,n=[],o=0;o<i.length-1;o++){var s=i[o],l=i[o+1],c=this.distance(s,l);if((r+=c)>t&&0===n.length&&n.push(a(s,l,(t-(r-c))/c)),r>=e)return n.push(a(s,l,(e-(r-c))/c)),n;r>t&&n.push(l)}return n},n.prototype.bufferPoint=function(t,e){var i=e/this.ky,r=e/this.kx;return[t[0]-r,t[1]-i,t[0]+r,t[1]+i]},n.prototype.bufferBBox=function(t,e){var i=e/this.ky,r=e/this.kx;return[t[0]-r,t[1]-i,t[2]+r,t[3]+i]},n.prototype.insideBBox=function(t,e){return l(t[0]-e[0])>=0&&l(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]},Object.defineProperties(n,o),n}();var Ii=p(Ei.exports),Li={exports:{}};Li.exports=function(){var t=function(t,i){if(void 0===t&&(t=[]),void 0===i&&(i=e),this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function e(t,e){return t<e?-1:t>e?1:0}return t.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(t){for(var e=this.data,i=this.compare,r=e[t];t>0;){var n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r},t.prototype._down=function(t){for(var e=this.data,i=this.compare,r=this.length>>1,n=e[t];t<r;){var o=1+(t<<1),s=e[o],a=o+1;if(a<this.length&&i(e[a],s)<0&&(o=a,s=e[a]),i(s,n)>=0)break;e[t]=s,t=o}e[t]=n},t}();var Pi=p(Li.exports),ki=8192;function Ni(t,e){return e.dist-t.dist}const Di=100,Oi=50;function Ri(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Fi(t){return t[1]-t[0]+1}function zi(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Bi(t,e){if(t[0]>t[1])return[null,null];const i=Fi(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===i)return[t,null];const e=Math.floor(i/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function Ui(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!zi(e,t.length))return i;for(let r=e[0];r<=e[1];++r)ci(i,t[r]);return i}function Vi(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let r=0;r<t[i].length;++r)ci(e,t[i][r]);return e}function ji(t,e,i){if(Ri(t)||Ri(e))return NaN;let r=0,n=0;return t[2]<e[0]&&(r=e[0]-t[2]),t[0]>e[2]&&(r=t[0]-e[2]),t[1]>e[3]&&(n=t[1]-e[3]),t[3]<e[1]&&(n=e[1]-t[3]),i.distance([0,0],[r,n])}function Gi(t){return 360*t-180}function Zi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function qi(t,e){const i=Math.pow(2,e.z),r=(t.y/ki+e.y)/i;return[Gi((t.x/ki+e.x)/i),Zi(r)]}function Wi(t,e){const i=[];for(let r=0;r<t.length;++r)i.push(qi(t[r],e));return i}function Hi(t,e,i){const r=i.pointOnLine(e,t).point;return i.distance(t,r)}function Ji(t,e,i,r,n){const o=i.slice(r[0],r[1]+1);let s=1/0;for(let i=e[0];i<=e[1];++i)if(0===(s=Math.min(s,Hi(t[i],o,n))))return 0;return s}function Ki(t,e,i,r,n){const o=Math.min(n.pointToSegmentDistance(t,i,r),n.pointToSegmentDistance(e,i,r)),s=Math.min(n.pointToSegmentDistance(i,t,e),n.pointToSegmentDistance(r,t,e));return Math.min(o,s)}function $i(t,e,i,r,n){if(!zi(e,t.length)||!zi(r,i.length))return NaN;let o=1/0;for(let s=e[0];s<e[1];++s)for(let e=r[0];e<r[1];++e){if(fi(t[s],t[s+1],i[e],i[e+1]))return 0;o=Math.min(o,Ki(t[s],t[s+1],i[e],i[e+1],n))}return o}function Yi(t,e,i,r,n){if(!zi(e,t.length)||!zi(r,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=r[0];e<=r[1];++e)if(0===(o=Math.min(o,n.distance(t[s],i[e]))))return o;return o}function Xi(t,e,i){if(pi(t,e,!0))return 0;let r=1/0;for(const n of e){const e=n.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[e-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(t,n[e-1],n[0]))))return r;if(0===(r=Math.min(r,Hi(t,n,i))))return r}return r}function Qi(t,e,i,r){if(!zi(e,t.length))return NaN;for(let r=e[0];r<=e[1];++r)if(pi(t[r],i,!0))return 0;let n=1/0;for(let o=e[0];o<e[1];++o)for(const e of i)for(let i=0,s=e.length,a=s-1;i<s;a=i++){if(fi(t[o],t[o+1],e[a],e[i]))return 0;n=Math.min(n,Ki(t[o],t[o+1],e[a],e[i],r))}return n}function tr(t,e){for(const i of t)for(let t=0;t<=i.length-1;++t)if(pi(i[t],e,!0))return!0;return!1}function er(t,e,i,r=1/0){const n=Vi(t),o=Vi(e);if(r!==1/0&&ji(n,o,i)>=r)return r;if(ui(n,o)){if(tr(t,e))return 0}else if(tr(e,t))return 0;let s=r;for(const r of t)for(let t=0,n=r.length,o=n-1;t<n;o=t++)for(const n of e)for(let e=0,a=n.length,l=a-1;e<a;l=e++){if(fi(r[o],r[t],n[l],n[e]))return 0;s=Math.min(s,Ki(r[o],r[t],n[l],n[e],i))}return s}function ir(t,e,i,r,n,o,s){if(null===o||null===s)return;const a=ji(Ui(r,o),Ui(n,s),i);a<e&&t.push({dist:a,range1:o,range2:s})}function rr(t,e,i,r,n=1/0){let o=Math.min(r.distance(t[0],i[0][0]),n);if(0===o)return o;const s=new Pi([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Ni),a=e?Oi:Di,l=Vi(i);for(;s.length;){const n=s.pop();if(n.dist>=o)continue;const c=n.range1;if(Fi(c)<=a){if(!zi(c,t.length))return NaN;if(e){const e=Qi(t,c,i,r);if(0===(o=Math.min(o,e)))return o}else for(let e=c[0];e<=c[1];++e){const n=Xi(t[e],i,r);if(0===(o=Math.min(o,n)))return o}}else{const i=Bi(c,e);if(null!==i[0]){const e=ji(Ui(t,i[0]),l,r);e<o&&s.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=ji(Ui(t,i[1]),l,r);e<o&&s.push({dist:e,range1:i[1],range2:[0,0]})}}}return o}function nr(t,e,i,r,n,o=1/0){let s=Math.min(o,n.distance(t[0],i[0]));if(0===s)return s;const a=new Pi([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],Ni),l=e?Oi:Di,c=r?Oi:Di;for(;a.length;){const o=a.pop();if(o.dist>=s)continue;const u=o.range1,h=o.range2;if(Fi(u)<=l&&Fi(h)<=c){if(!zi(u,t.length)||!zi(h,i.length))return NaN;if(e&&r?s=Math.min(s,$i(t,u,i,h,n)):e||r?e&&!r?s=Math.min(s,Ji(i,h,t,u,n)):!e&&r&&(s=Math.min(s,Ji(t,u,i,h,n))):s=Math.min(s,Yi(t,u,i,h,n)),0===s)return s}else{const o=Bi(u,e),l=Bi(h,r);ir(a,s,n,t,i,o[0],l[0]),ir(a,s,n,t,i,o[0],l[1]),ir(a,s,n,t,i,o[1],l[0]),ir(a,s,n,t,i,o[1],l[1])}}return s}function or(t,e,i,r,n=1/0){let o=n;const s=Ui(t,[0,t.length-1]);for(const n of i)if(!(o!==1/0&&ji(s,Ui(n,[0,n.length-1]),r)>=o)&&(o=Math.min(o,nr(t,e,n,!0,r,o)),0===o))return o;return o}function sr(t,e,i,r,n=1/0){let o=n;const s=Ui(t,[0,t.length-1]);for(const n of i){if(o!==1/0&&ji(s,Vi(n),r)>=o)continue;const i=rr(t,e,n,r,o);if(isNaN(i))return i;if(0===(o=Math.min(o,i)))return o}return o}function ar(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class lr{constructor(t,e){this.type=Ae,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Be(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(ar(e.features[t].geometry.type))return new lr(e,e.features[t].geometry)}else if("Feature"===e.type){if(ar(e.geometry.type))return new lr(e,e.geometry)}else if(ar(e.type))return new lr(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),i=t.canonicalID();if(null!=e&&null!=i){if("Point"===t.geometryType())return function(t,e,i){const r=[];for(const i of t)for(const t of i)r.push(qi(t,e));const n=new Ii(r[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?nr(r,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n):"MultiLineString"===i.type?or(r,!1,i.coordinates,n):"Polygon"===i.type||"MultiPolygon"===i.type?sr(r,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,n):null}(e,i,this.geometries);if("LineString"===t.geometryType())return function(t,e,i){const r=[];for(const i of t){const t=[];for(const r of i)t.push(qi(r,e));r.push(t)}const n=new Ii(r[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return or("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=or(i.coordinates[e],!0,r,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}if("Polygon"===i.type||"MultiPolygon"===i.type){let t=1/0;for(let e=0;e<r.length;e++){const o=sr(r[e],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return null}(e,i,this.geometries);if("Polygon"===t.geometryType())return function(t,e,i){const r=[];for(const i of function(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=li(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}return n&&r.push(n),r}(t)){const t=[];for(let r=0;r<i.length;++r)t.push(Wi(i[r],e));r.push(t)}const n=new Ii(r[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return sr("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const o=sr(i.coordinates[e],!0,r,n,t);if(isNaN(o))return o;if(0===(t=Math.min(t,o)))return t}return t}return"Polygon"===i.type||"MultiPolygon"===i.type?function(t,e,i){let r=1/0;for(const n of t)for(const t of e){const e=er(n,t,i,r);if(isNaN(e))return e;if(0===(r=Math.min(r,e)))return r}return r}("Polygon"===i.type?[i.coordinates]:i.coordinates,r,n):null}(e,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var cr=lr;function ur(t,e){switch(t){case"string":return Ve(e);case"number":return+e;case"boolean":return!!e;case"color":return ce.parse(e);case"formatted":return Re.fromString(Ve(e));case"resolvedImage":return Fe.fromString(Ve(e))}return e}function hr(t,e,i,r){return void 0!==r&&(t=r*Math.round(t/r)),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t}class pr{constructor(t,e,i){this.type=t,this.key=e,this.scope=i}static parse(t,e){let i=e.expectedType;if(null==i&&(i=Se),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const r=e.parse(t[1],1);if(!(r instanceof Ge))return e.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const n=e.parse(t[2],2);return n instanceof Ge?new pr(i,Ve(r.value),Ve(n.value)):e.error("Scope of 'config' expression must be a string literal.")}return new pr(i,Ve(r.value))}evaluate(t){const e=[this.key,this.scope,t.scope].filter(Boolean).join(""),i=t.getConfig(e);if(!i)return null;const{type:r,value:n,values:o,minValue:s,maxValue:a,stepValue:l}=i,c=i.default.evaluate(t);let u=c;if(n){const e=t.scope;t.scope=(e||"").split("").slice(1).join(""),u=n.evaluate(t),t.scope=e}return r&&(u=ur(r,u)),void 0===u||void 0===s&&void 0===a&&void 0===l||("number"==typeof u?u=hr(u,s,a,l):Array.isArray(u)&&(u=u.map((t=>"number"==typeof t?hr(t,s,a,l):t)))),void 0!==n&&void 0!==u&&o&&!o.includes(u)&&(u=c,r&&(u=ur(r,u))),(r&&r!==this.type||void 0!==u&&Ue(u)!==this.type)&&(u=ur(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}var dr=pr;function fr(t){if(t instanceof ni){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Mi)return!1;if(t instanceof cr)return!1;let e=!0;return t.eachChild((t=>{e&&!fr(t)&&(e=!1)})),e}function mr(t){if(t instanceof ni&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!mr(t)&&(e=!1)})),e}function gr(t){if(t instanceof dr)return!1;let e=!0;return t.eachChild((t=>{e&&!gr(t)&&(e=!1)})),e}function _r(t,e){if(t instanceof ni&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!_r(t,e)&&(i=!1)})),i}class yr{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new yr(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ar=yr;class vr{constructor(t,e=[],i,r=new _e,n=[],o,s){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i,this._scope=o,this.options=s}parse(t,e,i,r,n={}){return e||i?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new He(e,[t]):"coerce"===i?new Qe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof t[0]?this.registry[t[0]]:void 0;if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof Ge)&&"resolvedImage"!==n.type.kind&&br(n)){const e=new ei(this._scope,this.options);try{n=new Ge(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return Qe.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new vr(this.registry,r,e||null,n,this.errors,this._scope,this.options)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new me(i,t))}checkSubtype(t,e){const i=Pe(t,e);return i&&this.error(i),i}}var xr=vr;function br(t){if(t instanceof Ar)return br(t.boundExpression);if(t instanceof ni&&"error"===t.name)return!1;if(t instanceof oi)return!1;if(t instanceof Mi)return!1;if(t instanceof cr)return!1;if(t instanceof dr)return!1;const e=t instanceof Qe||t instanceof He;let i=!0;return t.eachChild((t=>{i=e?i&&br(t):i&&t instanceof Ge})),!!i&&fr(t)&&_r(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wr(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new Ze("Input is not a number.");s=a-1}return 0}class Sr{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Ae);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new Sr(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[wr(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var Tr=Sr;const Cr=.95047,Mr=1.08883,Er=4/29,Ir=6/29,Lr=3*Ir*Ir,Pr=Ir*Ir*Ir,kr=Math.PI/180,Nr=180/Math.PI;function Dr(t){return t>Pr?Math.pow(t,1/3):t/Lr+Er}function Or(t){return t>Ir?t*t*t:Lr*(t-Er)}function Rr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Fr(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function zr(t){const e=Fr(t.r),i=Fr(t.g),r=Fr(t.b),n=Dr((.4124564*e+.3575761*i+.1804375*r)/Cr),o=Dr((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Dr((.0193339*e+.119192*i+.9503041*r)/Mr)),alpha:t.a}}function Br(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Or(e),i=Cr*Or(i),r=Mr*Or(r),new ce(Rr(3.2404542*i-1.5371385*e-.4985314*r),Rr(-.969266*i+1.8760108*e+.041556*r),Rr(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Ur(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Vr={forward:zr,reverse:Br,interpolate:function(t,e,i){return{l:ue(t.l,e.l,i),a:ue(t.a,e.a,i),b:ue(t.b,e.b,i),alpha:ue(t.alpha,e.alpha,i)}}},jr={forward:function(t){const{l:e,a:i,b:r}=zr(t),n=Math.atan2(r,i)*Nr;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*kr,i=t.c;return Br({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Ur(t.h,e.h,i),c:ue(t.c,e.c,i),l:ue(t.l,e.l,i),alpha:ue(t.alpha,e.alpha,i)}}};var Gr=Object.freeze({__proto__:null,hcl:jr,lab:Vr});class Zr{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=qr(e,t.base,i,r);else if("linear"===t.name)n=qr(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new m(o[0],o[1],o[2],o[3]).solve(qr(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,Ae),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=be:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Zr(a,i,r,n,s):e.error(`Type ${Ie(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=wr(e,r),s=Zr.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?pe[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?jr.reverse(jr.interpolate(jr.forward(a),jr.forward(l),s)):Vr.reverse(Vr.interpolate(Vr.forward(a),Vr.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function qr(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}var Wr=Zr;class Hr{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}const o=r&&n.some((t=>Pe(r,t.type)));return new Hr(o?Se:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(t),i&&i instanceof Fe&&!i.available&&(e||(e=i),i=null,r===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Jr=Hr;class Kr{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new Kr(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var $r=Kr;class Yr{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Ae),r=e.parse(t[2],2,Ee(e.expectedType||Se));return i&&r?new Yr(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Ze(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new Ze(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new Ze(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Xr=Yr;class Qr{constructor(t,e){this.type=xe,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Se),r=e.parse(t[2],2,Se);return i&&r?ke(i.type,[xe,ve,Ae,ye,Se])?new Qr(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!Ne(e,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(Ue(e))} instead.`);if(!Ne(i,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Ie(Ue(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var tn=Qr;class en{constructor(t,e,i){this.type=Ae,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Se),r=e.parse(t[2],2,Se);if(!i||!r)return null;if(!ke(i.type,[xe,ve,Ae,ye,Se]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,Ae);return n?new en(i,r,n):null}return new en(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Ne(e,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(Ue(e))} instead.`);if(!Ne(i,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Ie(Ue(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var rn=en;class nn{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Ue(t)))return null}else i=Ue(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,Se);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new nn(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(Ue(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],r={};for(const t of e){const e=r[this.cases[t]];void 0===e?(r[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const n=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,r]of i)t.push(1===r.length?n(r[0]):r.map(n)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var on=nn;class sn{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,xe);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);return n?new sn(i,r,n):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var an=sn;class ln{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Se),r=e.parse(t[2],2,Ae);if(!i||!r)return null;if(!ke(i.type,[Ee(Se),ve,Se]))return e.error(`Expected first argument to be of type array or string, but found ${Ie(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,Ae);return n?new ln(i.type,i,r,n):null}return new ln(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Ne(e,["string","array"]))throw new Ze(`Expected first argument to be of type array or string, but found ${Ie(Ue(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var cn=ln;function un(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function hn(t,e,i,r){return 0===r.compare(e,i)}function pn(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=xe,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,Se);if(!o)return null;if(!un(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Ie(o.type)}'.`);let s=e.parse(t[2],2,Se);if(!s)return null;if(!un(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Ie(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Ie(o.type)}' and '${Ie(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new He(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new He(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Te),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=Ue(o),i=Ue(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new Ze(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=Ue(o),i=Ue(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const dn=pn("==",(function(t,e,i){return e===i}),hn),fn=pn("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!hn(0,e,i,r)})),mn=pn("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),gn=pn(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),_n=pn("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),yn=pn(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class An{constructor(t,e,i,r,n,o){this.type=ve,this.number=t,this.locale=e,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=o}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Ae);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,ve),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,ve),!o))return null;let s=null;if(r.unit&&(s=e.parse(r.unit,1,ve),!s))return null;let a=null;if(r["min-fraction-digits"]&&(a=e.parse(r["min-fraction-digits"],1,Ae),!a))return null;let l=null;return r["max-fraction-digits"]&&(l=e.parse(r["max-fraction-digits"],1,Ae),!l)?null:new An(i,n,o,s,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class vn{constructor(t){this.type=Ae,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Ie(i.type)} instead.`):new vn(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Ze(`Expected value to be of type string or array, but found ${Ie(Ue(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}function xn(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const bn={"==":dn,"!=":fn,">":gn,"<":mn,">=":yn,"<=":_n,array:He,at:Xr,boolean:He,case:an,coalesce:Jr,collator:oi,format:Je,image:Ke,in:tn,"index-of":rn,interpolate:Wr,"interpolate-hcl":Wr,"interpolate-lab":Wr,length:vn,let:$r,literal:Ge,match:on,number:He,"number-format":An,object:He,slice:cn,step:Tr,string:He,"to-boolean":Qe,"to-color":Qe,"to-number":Qe,"to-string":Qe,var:Ar,within:Mi,distance:cr,config:dr};function wn(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=ze(e,i,r,o);if(s)throw new Ze(s);return new ce(e/255*o,i/255*o,r/255*o,o)}function Sn(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=function(t,e,i,r){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid hsla value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,r,o);if(s)throw new Ze(s);const a=`hsla(${e}, ${i}%, ${r}%, ${o})`,l=ce.parse(a);if(!l)throw new Ze(`Failed to parse HSLA color: ${a}`);return l}function Tn(t,e){return t in e}function Cn(t,e){const i=e[t];return void 0===i?null:i}function Mn(t){return{type:t}}ni.register(bn,{error:[{kind:"error"},[ve],(t,[e])=>{throw new Ze(e.evaluate(t))}],typeof:[ve,[Se],(t,[e])=>Ie(Ue(e.evaluate(t)))],"to-rgba":[Ee(Ae,4),[be],(t,[e])=>e.evaluate(t).toArray()],rgb:[be,[Ae,Ae,Ae],wn],rgba:[be,[Ae,Ae,Ae,Ae],wn],hsl:[be,[Ae,Ae,Ae],Sn],hsla:[be,[Ae,Ae,Ae,Ae],Sn],has:{type:xe,overloads:[[[ve],(t,[e])=>Tn(e.evaluate(t),t.properties())],[[ve,we],(t,[e,i])=>Tn(e.evaluate(t),i.evaluate(t))]]},get:{type:Se,overloads:[[[ve],(t,[e])=>Cn(e.evaluate(t),t.properties())],[[ve,we],(t,[e,i])=>Cn(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Se,[ve],(t,[e])=>Cn(e.evaluate(t),t.featureState||{})],properties:[we,[],t=>t.properties()],"geometry-type":[ve,[],t=>t.geometryType()],id:[Se,[],t=>t.id()],zoom:[Ae,[],t=>t.globals.zoom],pitch:[Ae,[],t=>t.globals.pitch||0],"distance-from-center":[Ae,[],t=>t.distanceFromCenter()],"measure-light":[Ae,[ve],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Ae,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ae,[],t=>t.globals.lineProgress||0],"raster-value":[Ae,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Ae,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ae,[],t=>t.globals.skyRadialProgress||0],accumulated:[Se,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ae,Mn(Ae),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Ae,Mn(Ae),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Ae,overloads:[[[Ae,Ae],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ae],(t,[e])=>-e.evaluate(t)]]},"/":[Ae,[Ae,Ae],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ae,[Ae,Ae],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ae,[],()=>Math.LN2],pi:[Ae,[],()=>Math.PI],e:[Ae,[],()=>Math.E],"^":[Ae,[Ae,Ae],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ae,[Ae],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ae,[Ae],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ae,[Ae],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ae,[Ae],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ae,[Ae],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ae,[Ae],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ae,[Ae],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ae,[Ae],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ae,[Ae],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ae,[Ae],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ae,Mn(Ae),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Ae,Mn(Ae),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Ae,[Ae],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ae,[Ae],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ae,[Ae],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ae,[Ae],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[xe,[ve,Se],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[xe,[Se],(t,[e])=>t.id()===e.value],"filter-type-==":[xe,[ve],(t,[e])=>t.geometryType()===e.value],"filter-<":[xe,[ve,Se],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[xe,[Se],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[xe,[ve,Se],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[xe,[Se],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[xe,[ve,Se],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[xe,[Se],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[xe,[ve,Se],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[xe,[Se],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[xe,[Se],(t,[e])=>e.value in t.properties()],"filter-has-id":[xe,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[xe,[Ee(ve)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[xe,[Ee(Se)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[xe,[ve,Ee(Se)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[xe,[ve,Ee(Se)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:xe,overloads:[[[xe,xe],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Mn(xe),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:xe,overloads:[[[xe,xe],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Mn(xe),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[xe,[xe],(t,[e])=>!e.evaluate(t)],"is-supported-script":[xe,[ve],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ve,[ve],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ve,[ve],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ve,Mn(Se),(t,e)=>e.map((e=>Ve(e.evaluate(t)))).join("")],"resolved-locale":[ve,[Te],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Ae,[Ae,Ae,Se],(t,e)=>{const[i,r,n]=e.map((e=>e.evaluate(t)));if(i>r)return i;if(i===r)return i;let o;if("string"==typeof n)o=function(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}(n);else{if("number"!=typeof n)throw new Ze(`Invalid seed input: ${n}`);o=n}return i+xn(o)()*(r-i)}]});var En=bn;function In(t){return{result:"success",value:t}}function Ln(t){return{result:"error",value:t}}function Pn(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function kn(t){return"data-driven"===t["property-type"]}function Nn(t){return Pn(t.expression,"measure-light")}function Dn(t){return Pn(t.expression,"zoom")}function On(t){return!!t.expression&&t.expression.interpolated}function Rn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Fn(t){return t}function zn(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],n=r||!(r||void 0!==t.property),o=t.type||(On(e)?"exponential":"interval");if(i&&((t=de({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],ce.parse(t[1])]))),t.default=ce.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Gr[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=jn;else if("interval"===o)s=Vn;else if("categorical"===o){s=Un,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Gn}if(r){const i={},r=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of r)n.push([i[t].zoom,zn(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Wr.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:i},r)=>jn({stops:n,base:t.base},e,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Wr.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>s(t,e,i,a,l)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?Bn(t.default,e.default):s(t,e,n,a,l)}}}function Bn(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Un(t,e,i,r,n){return Bn(typeof i===n?r[i]:void 0,t.default,e.default)}function Vn(t,e,i){if("number"!==$e(i))return Bn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=wr(t.stops.map((t=>t[0])),i);return t.stops[n][1]}function jn(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==$e(i))return Bn(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=wr(t.stops.map((t=>t[0])),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=pe[e.type]||Fn;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Gr[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,s)}}:c(a,l,s)}function Gn(t,e,i){return"color"===e.type?i=ce.parse(i):"formatted"===e.type?i=Re.fromString(i.toString()):"resolvedImage"===e.type?i=Fe.fromString(i.toString()):$e(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Bn(i,t.default,e.default)}class Zn{constructor(t,e,i,r){this.expression=t,this._warningHistory={},this._evaluator=new ei(i,r),this._defaultValue=e?function(t){return"color"===t.type&&(Rn(t.default)||Array.isArray(t.default))?new ce(0,0,0,0):"color"===t.type?ce.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Ze(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function qn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in En}function Wn(t,e,i,r){const n=new xr(En,[],e?function(t){const e={color:be,string:ve,number:Ae,enum:ve,boolean:xe,formatted:Ce,resolvedImage:Me};return"array"===t.type?Ee(e[t.value]||Se,t.length):e[t.type]}(e):void 0,void 0,void 0,i,r),o=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return o?In(new Zn(o,e,i,r)):Ln(n.errors)}class Hn{constructor(t,e,i){this.kind=t,this._styleExpression=e,this.isLightConstant=i,this.isStateDependent="constant"!==t&&!mr(e.expression),this.isConfigDependent=!gr(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class Jn{constructor(t,e,i,r,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!mr(e.expression),this.isLightConstant=n,this.isConfigDependent=!gr(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?Wr.interpolationFactor(this.interpolationType,t,e,i):0}}function Kn(t,e,i,r){if("error"===(t=Wn(t,e,i,r)).result)return t;const n=t.value.expression,o=fr(n);if(!o&&!kn(e))return Ln([new me("","data expressions not supported")]);const s=_r(n,["zoom","pitch","distance-from-center"]);if(!s&&!Dn(e))return Ln([new me("","zoom expressions not supported")]);const a=_r(n,["measure-light"]);if(!a&&!Nn(e))return Ln([new me("","measure-light expression not supported")]);const l=e.expression&&e.expression.relaxZoomRestriction,c=Yn(n);return c||s||l?c instanceof me?Ln([c]):c instanceof Wr&&!On(e)?Ln([new me("",'"interpolate" expressions cannot be used with this property')]):In(c?new Jn(o?"camera":"composite",t.value,c.labels,c instanceof Wr?c.interpolation:void 0,a):new Hn(o?"constant":"source",t.value,a)):Ln([new me("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class $n{constructor(t,e){this._parameters=t,this._specification=e,de(this,zn(this._parameters,this._specification))}static deserialize(t){return new $n(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Yn(t){let e=null;if(t instanceof $r)e=Yn(t.result);else if(t instanceof Jr){for(const i of t.args)if(e=Yn(i),e)break}else(t instanceof Tr||t instanceof Wr)&&t.input instanceof ni&&"zoom"===t.input.name&&(e=t);return e instanceof me||t.eachChild((t=>{const i=Yn(t);i instanceof me?e=i:e&&i&&e!==i&&(e=new me("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Xn=to,Qn=3;function to(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var s=n[Qn+o],a=n[Qn+o+1];r.push(s===a?null:n.subarray(s,a))}var l=n[Qn+r.length+1];this.keys=n.subarray(n[Qn+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}to.prototype.insert=function(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},to.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},to.prototype._insertCell=function(t,e,i,r,n,o){this.cells[n].push(o)},to.prototype.query=function(t,e,i,r,n){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,r,this._queryCell,a,{},n),a},to.prototype._queryCell=function(t,e,i,r,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===s[p]){var d=4*p;(a?a(u[d+0],u[d+1],u[d+2],u[d+3]):t<=u[d+2]&&e<=u[d+3]&&i>=u[d+0]&&r>=u[d+1])?(s[p]=!0,o.push(c[p])):s[p]=!1}}},to.prototype._forEachCell=function(t,e,i,r,n,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),p=l;p<=u;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&n.call(this,t,e,i,r,f,o,s,a))return}},to.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},to.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},to.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Qn+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];n[Qn+s]=o,n.set(a,o),o+=a.length}return n[Qn+t.length]=o,n.set(this.keys,o),n[Qn+t.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};var eo=p(Xn);const io={};function ro(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),io[e]={klass:t,omit:i.omit||[]}}ro(Object,"Object"),eo.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},eo.deserialize=function(t){return new eo(t.buffer)},Object.defineProperty(eo,"name",{value:"Grid"}),ro(eo,"Grid"),ro(ce,"Color"),ro(Error,"Error"),ro(Re,"Formatted"),ro(Oe,"FormattedSection"),ro(Ct,"AJAXError"),ro(Fe,"ResolvedImage"),ro($n,"StylePropertyFunction"),ro(Zn,"StyleExpression",{omit:["_evaluator"]}),ro(Jn,"ZoomDependentExpression"),ro(Hn,"ZoomConstantExpression"),ro(ni,"CompoundExpression",{omit:["_evaluate"]});for(const t in En)io[En[t]._classRegistryKey]||ro(En[t],`Expression${t}`);function no(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function oo(t){return self.ImageBitmap&&t instanceof ImageBitmap}function so(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(no(t)||oo(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(so(r,e));return i}if(t instanceof Map){const e={$name:"Map"};for(const[i,r]of t.entries())e[i]=so(r);return e}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t)t.hasOwnProperty(i)&&(io[r].omit.indexOf(i)>=0||(n[i]=so(t[i],e)));t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function ao(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||no(t)||oo(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ao);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const i of Object.keys(t))"$name"!==i&&e.set(i,ao(t[i]));return e}const{klass:i}=io[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(r[e]=ao(t[e]));return r}throw new Error("can't deserialize object of type "+typeof t)}const lo={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function co(t){for(const e of t)if(po(e.charCodeAt(0)))return!0;return!1}function uo(t){for(const e of t)if(!ho(e.charCodeAt(0)))return!1;return!0}function ho(t){return!(lo.Arabic(t)||lo["Arabic Supplement"](t)||lo["Arabic Extended-A"](t)||lo["Arabic Presentation Forms-A"](t)||lo["Arabic Presentation Forms-B"](t))}function po(t){return!(746!==t&&747!==t&&(t<4352||!(lo["Bopomofo Extended"](t)||lo.Bopomofo(t)||lo["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||lo["CJK Compatibility Ideographs"](t)||lo["CJK Compatibility"](t)||lo["CJK Radicals Supplement"](t)||lo["CJK Strokes"](t)||!(!lo["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||lo["CJK Unified Ideographs Extension A"](t)||lo["CJK Unified Ideographs"](t)||lo["Enclosed CJK Letters and Months"](t)||lo["Hangul Compatibility Jamo"](t)||lo["Hangul Jamo Extended-A"](t)||lo["Hangul Jamo Extended-B"](t)||lo["Hangul Jamo"](t)||lo["Hangul Syllables"](t)||lo.Hiragana(t)||lo["Ideographic Description Characters"](t)||lo.Kanbun(t)||lo["Kangxi Radicals"](t)||lo["Katakana Phonetic Extensions"](t)||lo.Katakana(t)&&12540!==t||!(!lo["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!lo["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||lo["Unified Canadian Aboriginal Syllabics"](t)||lo["Unified Canadian Aboriginal Syllabics Extended"](t)||lo["Vertical Forms"](t)||lo["Yijing Hexagram Symbols"](t)||lo["Yi Syllables"](t)||lo["Yi Radicals"](t))))}function fo(t){return!(po(t)||function(t){return!!(lo["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||lo["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||lo["Letterlike Symbols"](t)||lo["Number Forms"](t)||lo["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||lo["Control Pictures"](t)&&9251!==t||lo["Optical Character Recognition"](t)||lo["Enclosed Alphanumerics"](t)||lo["Geometric Shapes"](t)||lo["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||lo["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||lo["CJK Symbols and Punctuation"](t)||lo.Katakana(t)||lo["Private Use Area"](t)||lo["CJK Compatibility Forms"](t)||lo["Small Form Variants"](t)||lo["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function mo(t){return t>=1424&&t<=2303||lo["Arabic Presentation Forms-A"](t)||lo["Arabic Presentation Forms-B"](t)}function go(t,e){return!(!e&&mo(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||lo.Khmer(t))}function _o(t){for(const e of t)if(mo(e.charCodeAt(0)))return!0;return!1}const yo="deferred",Ao="loading",vo="loaded";let xo=null,bo="unavailable",wo=null;const So=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(bo="error"),xo&&xo(t)};function To(){Co.fire(new te("pluginStateChange",{pluginStatus:bo,pluginURL:wo}))}const Co=new ie,Mo=function(){return bo},Eo=function(){if(bo!==yo||!wo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");bo=Ao,To(),wo&&It({url:wo},(t=>{t?So(t):(bo=vo,To())}))},Io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>bo===vo||null!=Io.applyArabicShaping,isLoading:()=>bo===Ao,setState(t){bo=t.pluginStatus,wo=t.pluginURL},isParsed:()=>null!=Io.applyArabicShaping&&null!=Io.processBidirectionalText&&null!=Io.processStyledBidirectionalText,getPluginURL:()=>wo};class Lo{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!go(i.charCodeAt(0),e))return!1;return!0}(t,Io.isLoaded())}}class Po{constructor(t,e,i,r){this.property=t,this.value=e,this.expression=function(t,e,i,r){if(Rn(t))return new $n(t,e);if(qn(t)||Array.isArray(t)&&t.length>0){const n=Kn(t,e,i,r);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=ce.parse(t)),{kind:"constant",isConfigDependent:!1,evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification,i,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class ko{constructor(t,e,i){this.property=t,this.value=new Po(t,void 0,e,i)}transitioned(t,e){return new Do(this.property,this.value,e,P({},t.transition,this.transition),t.now)}untransitioned(){return new Do(this.property,this.value,null,{},0)}}class No{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=i,this.isConfigDependent=!1}getValue(t){return V(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ko(this._values[t].property,this._scope,this._options)),this._values[t].value=new Po(this._values[t].property,null===e?void 0:V(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,e){e&&(this._options=e);const i=this._properties.properties;if(t)for(const e in t){const r=t[e];if(z(e,"-transition")){const t=e.slice(0,-11);i[t]&&this.setTransition(t,r)}else i[e]&&this.setValue(e,r)}}getTransition(t){return V(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ko(this._values[t].property)),this._values[t].transition=V(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const i=new Oo(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new Oo(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Do{constructor(t,e,i,r,n){const o=r.delay||0,s=r.duration||0;n=n||0,this.property=t,this.value=e,this.begin=n+o,this.end=this.begin+s,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,S(s))}}return n}}class Oo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new zo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ro{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=i,this.isConfigDependent=!1}getValue(t){return V(this._values[t].value)}setValue(t,e){this._values[t]=new Po(this._values[t].property,null===e?void 0:V(e),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new zo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class Fo{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class zo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Bo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const r=pe[this.specification.type];return r?r(t,e,i):t}}class Uo{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new Fo(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Fo(this,{kind:"constant",value:void 0},t.parameters);const r=pe[this.specification.type];return r?new Fo(this,{kind:"constant",value:r(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class Vo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class jo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Lo(0,{});for(const i in t){const r=t[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new Po(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new ko(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(e)}}}function Go(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Zo(t){if(Array.isArray(t))return t.map(Zo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Zo(t[i]);return e}return Go(t)}ro(Uo,"DataDrivenProperty"),ro(Bo,"DataConstantProperty"),ro(Vo,"ColorRampProperty");var qo=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wo(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Wo(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ho(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wo(t)||(t=ts(t));const i=t;let r=!0;try{r=function(t){if(!$o(t))return t;let e=Zo(t);return Ko(e),e=Jo(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=qo[`filter_${e}`],o=Wn(r,n);let s=null;if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(r!==i){const t=Wn(i,n);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,i,r,n,o)=>t.value.evaluate(e,i,{},r,void 0,void 0,n,o),l=!fr(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:Qo(r),needFeature:!!l}}function Jo(t){if(!Array.isArray(t))return t;const e=function(t){if(Yo.has(t[0]))for(let e=1;e<t.length;e++)if($o(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>Jo(t)))}function Ko(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||$o(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||$o(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||$o(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let e=1;e<t.length;e++)Ko(t[e])}function $o(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if($o(t[e]))return!0;return!1}const Yo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Xo(t,e){return t<e?-1:t>e?1:0}function Qo(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(Qo(t[e]))return!0;return!1}function ts(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?es(t[1],t[2],"=="):"!="===e?ns(es(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?es(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(ts))):"all"===e?["all"].concat(t.slice(1).map(ts)):"none"===e?["all"].concat(t.slice(1).map(ts).map(ns)):"in"===e?is(t[1],t.slice(2)):"!in"===e?ns(is(t[1],t.slice(2))):"has"===e?rs(t[1]):"!has"!==e||ns(rs(t[1]));var i}function es(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function is(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Xo)]]:["filter-in-small",t,["literal",e]]}}function rs(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ns(t){return["!",t]}const os="";function ss(t,e){return e?`${t}${os}${e}`:t}const as="-transition";class ls extends ie{constructor(t,e,i,r){if(super(),this.id=t.id,this.fqid=ss(this.id,i),this.type=t.type,this.scope=i,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new Ro(e.layout,this.scope,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),e.paint)){this._transitionablePaint=new No(e.paint,this.scope,r);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zo(e.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const i=this._unevaluatedLayout;i._properties.properties[t]&&(i.setValue(t,e),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return z(t,as)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const i=this._transitionablePaint,r=i._properties.properties;if(z(t,as)){const n=t.slice(0,-11);return r[n]&&i.setTransition(n,e||void 0),!1}if(!r[t])return!1;const n=i._values[t],o=n.value.isDataDriven(),s=n.value;i.setValue(t,e),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const a=i._values[t].value,l=a.isDataDriven(),c=z(t,"pattern")||"line-dasharray"===t;return l||o||c||this._handleOverridablePaintPropertyUpdate(t,s,a)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return U({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Fo&&kn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ho(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const cs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class us{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ps(t,e=1){let i=0,r=0;return{members:t.map((t=>{const n=cs[t.type].BYTES_PER_ELEMENT,o=i=ds(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}})),size:ds(i,Math.max(r,e)),alignment:e}}function ds(t,e){return Math.ceil(t/e)*e}class fs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}fs.prototype.bytesPerElement=4,ro(fs,"StructArrayLayout2i4");class ms extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}ms.prototype.bytesPerElement=6,ro(ms,"StructArrayLayout3i6");class gs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}gs.prototype.bytesPerElement=8,ro(gs,"StructArrayLayout4i8");class _s extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=5*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=o,t}}_s.prototype.bytesPerElement=10,ro(_s,"StructArrayLayout5i10");class ys extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}ys.prototype.bytesPerElement=12,ro(ys,"StructArrayLayout2i4ub1f12");class As extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}As.prototype.bytesPerElement=16,ro(As,"StructArrayLayout4f16");class vs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=6*t,a=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=r,this.uint16[s+3]=n,this.float32[a+2]=o,t}}vs.prototype.bytesPerElement=12,ro(vs,"StructArrayLayout4ui1f12");class xs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,t}}xs.prototype.bytesPerElement=8,ro(xs,"StructArrayLayout4ui8");class bs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}bs.prototype.bytesPerElement=12,ro(bs,"StructArrayLayout6i12");class ws extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=r,this.int16[d+3]=n,this.uint16[d+4]=o,this.uint16[d+5]=s,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t}}ws.prototype.bytesPerElement=24,ro(ws,"StructArrayLayout4i4ui4i24");class Ss extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,t}}Ss.prototype.bytesPerElement=20,ro(Ss,"StructArrayLayout3i3f20");class Ts extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Ts.prototype.bytesPerElement=4,ro(Ts,"StructArrayLayout1ul4");class Cs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}Cs.prototype.bytesPerElement=4,ro(Cs,"StructArrayLayout2ui4");class Ms extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,r,n,o,s,a,l,c,u,h,p)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=p,this.uint16[f+19]=d,t}}Ms.prototype.bytesPerElement=40,ro(Ms,"StructArrayLayout5i4f1i1ul2ui40");class Es extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}Es.prototype.bytesPerElement=16,ro(Es,"StructArrayLayout3i2i2i16");class Is extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}Is.prototype.bytesPerElement=16,ro(Is,"StructArrayLayout2f1f2i16");class Ls extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,t}}Ls.prototype.bytesPerElement=12,ro(Ls,"StructArrayLayout2ub2f12");class Ps extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}Ps.prototype.bytesPerElement=6,ro(Ps,"StructArrayLayout3ui6");class ks extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v){const x=this.length;return this.resize(x+1),this.emplace(x,t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x){const b=30*t,w=15*t,S=60*t;return this.int16[b+0]=e,this.int16[b+1]=i,this.int16[b+2]=r,this.float32[w+2]=n,this.float32[w+3]=o,this.uint16[b+8]=s,this.uint16[b+9]=a,this.uint32[w+5]=l,this.uint32[w+6]=c,this.uint32[w+7]=u,this.uint16[b+16]=h,this.uint16[b+17]=p,this.uint16[b+18]=d,this.float32[w+10]=f,this.float32[w+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=_,this.uint8[S+50]=y,this.uint32[w+13]=A,this.int16[b+28]=v,this.uint8[S+58]=x,t}}ks.prototype.bytesPerElement=60,ro(ks,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ns extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P){const k=this.length;return this.resize(k+1),this.emplace(k,t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P,k){const N=20*t,D=40*t,O=80*t;return this.float32[N+0]=e,this.float32[N+1]=i,this.int16[D+4]=r,this.int16[D+5]=n,this.int16[D+6]=o,this.int16[D+7]=s,this.int16[D+8]=a,this.int16[D+9]=l,this.int16[D+10]=c,this.int16[D+11]=u,this.int16[D+12]=h,this.uint16[D+13]=p,this.uint16[D+14]=d,this.uint16[D+15]=f,this.uint16[D+16]=m,this.uint16[D+17]=g,this.uint16[D+18]=_,this.uint16[D+19]=y,this.uint16[D+20]=A,this.uint16[D+21]=v,this.uint16[D+22]=x,this.uint16[D+23]=b,this.uint16[D+24]=w,this.uint16[D+25]=S,this.uint16[D+26]=T,this.uint16[D+27]=C,this.uint32[N+14]=M,this.float32[N+15]=E,this.float32[N+16]=I,this.float32[N+17]=L,this.float32[N+18]=P,this.uint8[O+76]=k,t}}Ns.prototype.bytesPerElement=80,ro(Ns,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ds extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Ds.prototype.bytesPerElement=4,ro(Ds,"StructArrayLayout1f4");class Os extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.float32[s+3]=n,this.float32[s+4]=o,t}}Os.prototype.bytesPerElement=20,ro(Os,"StructArrayLayout5f20");class Rs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,t}}Rs.prototype.bytesPerElement=28,ro(Rs,"StructArrayLayout7f28");class Fs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=i,this.uint16[o+3]=r,this.uint16[o+4]=n,t}}Fs.prototype.bytesPerElement=12,ro(Fs,"StructArrayLayout1ul3ui12");class zs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}zs.prototype.bytesPerElement=2,ro(zs,"StructArrayLayout1ui2");class Bs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}Bs.prototype.bytesPerElement=12,ro(Bs,"StructArrayLayout3f12");class Us extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}Us.prototype.bytesPerElement=8,ro(Us,"StructArrayLayout2f8");class Vs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=16*t;return this.float32[_+0]=e,this.float32[_+1]=i,this.float32[_+2]=r,this.float32[_+3]=n,this.float32[_+4]=o,this.float32[_+5]=s,this.float32[_+6]=a,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=u,this.float32[_+10]=h,this.float32[_+11]=p,this.float32[_+12]=d,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,t}}Vs.prototype.bytesPerElement=64,ro(Vs,"StructArrayLayout16f64");class js extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,r,n,o,s)}emplace(t,e,i,r,n,o,s,a){const l=10*t,c=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=n,this.float32[c+2]=o,this.float32[c+3]=s,this.float32[c+4]=a,t}}js.prototype.bytesPerElement=20,ro(js,"StructArrayLayout4ui3f20");class Gs extends hs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}Gs.prototype.bytesPerElement=1,ro(Gs,"StructArrayLayout1ub1");class Zs extends us{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zs.prototype.size=40;class qs extends Ms{get(t){return new Zs(this,t)}}ro(qs,"CollisionBoxArray");class Ws extends us{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ws.prototype.size=60;class Hs extends ks{get(t){return new Ws(this,t)}}ro(Hs,"PlacedSymbolArray");class Js extends us{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Js.prototype.size=80;class Ks extends Ns{get(t){return new Js(this,t)}}ro(Ks,"SymbolInstanceArray");class $s extends Ds{getoffsetX(t){return this.float32[1*t+0]}}ro($s,"GlyphOffsetArray");class Ys extends fs{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}ro(Ys,"SymbolLineVertexArray");class Xs extends us{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xs.prototype.size=12;class Qs extends Fs{get(t){return new Xs(this,t)}}ro(Qs,"FeatureIndexArray");class ta extends Cs{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}ro(ta,"FillExtrusionCentroidArray");const ea=ps([{name:"a_pos",components:2,type:"Int16"}],4),ia=ps([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ra{constructor(t=[]){this.segments=t}_prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>ra.MAX_VERTEX_ARRAY_LENGTH&&G(`Max vertices per segment is ${ra.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>ra.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(t,e,i,r){return this._prepareSegment(t,e.length,i.length,r)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new ra([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function na(t,e){return 256*(t=M(Math.floor(t),0,255))+M(Math.floor(e),0,255)}ra.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ro(ra,"SegmentVector");const oa=ps([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sa=ps([{name:"a_dash",components:4,type:"Uint16"}]);var aa={exports:{}},la={exports:{}};!function(t){t.exports=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}}(la);var ca=la.exports,ua={exports:{}};!function(t){t.exports=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}}(ua);var ha=ca,pa=ua.exports;aa.exports=ha,aa.exports.murmur3=ha,aa.exports.murmur2=pa;var da=p(aa.exports);class fa{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(ma(t)),this.positions.push(e,i,r)}eachPosition(t,e){const i=ma(t);let r=0,n=this.ids.length-1;for(;r<n;){const t=r+n>>1;this.ids[t]>=i?n=t:r=t+1}for(;this.ids[r]===i;)e(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return ga(i,r,0,i.length-1),e&&(e.add(i.buffer),e.add(r.buffer)),{ids:i,positions:r}}static deserialize(t){const e=new fa;let i;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==i&&e.uniqueIds.push(t),i=t;return e.indexed=!0,e}}function ma(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:da(String(t))}function ga(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(t[o]<n);do{s--}while(t[s]>n);if(o>=s)break;_a(t,o,s),_a(e,3*o,3*s),_a(e,3*o+1,3*s+1),_a(e,3*o+2,3*s+2)}s-i<r-s?(ga(t,e,i,s),i=s+1):(ga(t,e,s+1,r),r=s)}}function _a(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}ro(fa,"FeaturePositionMap");class ya{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}}class Aa extends ya{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class va extends ya{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xa extends ya{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class ba extends ya{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class wa extends ya{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Sa extends ya{constructor(t){super(t),this.current=ce.transparent}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ta=new Float32Array(16);class Ca extends ya{constructor(t){super(t),this.current=Ta}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Ma=new Float32Array(9),Ea=new Float32Array(4);class Ia extends ya{constructor(t){super(t),this.current=Ea}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function La(t){return[na(255*t.r,255*t.g),na(255*t.b,255*t.a)]}class Pa{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i,r,n){e.set(t,n,r.constantOr(this.value))}getBinding(t,e){return"color"===this.type?new Sa(t):new va(t)}}class ka{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,r,n){const o="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;o&&e.set(t,n,o)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new wa(t):new va(t)}}class Na{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n,o,s){const a=this.paintVertexArray.length,l=this.expression.evaluate(new Lo(0,{brightness:o}),e,{},n,r,s);this.paintVertexArray.resize(t),this._setPaintValue(a,t,l)}updatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate({zoom:0,brightness:s},i,r,void 0,n);this._setPaintValue(t,e,a)}_setPaintValue(t,e,i){if("color"===this.type){const r=La(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate(new Lo(this.zoom,{brightness:o}),e,{},n,r,s),l=this.expression.evaluate(new Lo(this.zoom+1,{brightness:o}),e,{},n,r,s),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,a,l)}updatePaintArray(t,e,i,r,n,o,s){const a=this.expression.evaluate({zoom:this.zoom,brightness:s},i,r,void 0,n),l=this.expression.evaluate({zoom:this.zoom+1,brightness:s},i,r,void 0,n);this._setPaintValue(t,e,a,l)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=La(i),o=La(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,r,n){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,s=M(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(t,n,s)}getBinding(t,e){return new va(t)}}class Oa{constructor(t,e,i,r,n){this.expression=t,this.layerId=n,this.paintVertexAttributes=("array"===i?sa:oa).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new r}populatePaintArray(t,e,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n,o,s){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,e,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:o,br:s,pixelRatio:a}=n;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,o[0],o[1],s[0],s[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ra{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){const o=t.paint.get(n);if(!i(n))continue;if(!(o instanceof Fo&&kn(o.property.specification)))continue;const s=Ba(n,t.type),a=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===n||n.endsWith("pattern"),h="line-dasharray"===n&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const e=ja(n,l,"source");this.binders[n]=u?new Oa(a,s,l,e,t.id):new Na(a,s,l,e),r.push(`/a_${n}`)}else{const t=ja(n,l,"composite");this.binders[n]=new Da(a,s,l,c,e,t),r.push(`/z_${n}`)}else this.binders[n]=u?new ka(a.value,s):new Pa(a.value,s,l),r.push(`/u_${n}`)}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Na||e instanceof Da?e.maxValue:0}populatePaintArrays(t,e,i,r,n,o,s){for(const a in this.binders){const l=this.binders[a];(l instanceof Na||l instanceof Da||l instanceof Oa)&&l.populatePaintArray(t,e,i,r,n,o,s)}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof ka&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,r,n,o,s,a){let l=!1;const c=Object.keys(t),u=0!==c.length,h=u?c:e.uniqueIds;for(const c in this.binders){const p=this.binders[c];if((p instanceof Na||p instanceof Da||p instanceof Oa)&&(!0===p.expression.isStateDependent||!1===p.expression.isLightConstant)){const d=n.paint.get(c);p.expression=d.value;for(const i of h){const n=t[i.toString()];e.eachPosition(i,((t,e,i)=>{const l=r.feature(t);p.updatePaintArray(e,i,l,n,o,s,a)}))}if(!u)for(const e of i.uniqueIds){const n=t[e.toString()];i.eachPosition(e,((t,e,i)=>{const l=r.feature(t);p.updatePaintArray(e,i,l,n,o,s,a)}))}l=!0}}return l}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Pa||i instanceof ka)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Na||i instanceof Da||i instanceof Oa)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Pa||i instanceof ka||i instanceof Da)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Pa||r instanceof ka||r instanceof Da)for(const n of r.uniformNames)e.push({name:n,property:i,binding:r.getBinding(t,n)})}return e}setUniforms(t,e,i,r,n){for(const{name:e,property:o,binding:s}of i)this.binders[o].setUniform(t,s,n,r.get(o),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof Na||e instanceof Da||e instanceof Oa)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Na||i instanceof Da||i instanceof Oa)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Na||e instanceof Da||e instanceof Oa)&&e.destroy()}}}class Fa{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new Ra(r,e,i);this.needsUpload=!1,this._featureMap=new fa,this._featureMapWithoutIds=new fa,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,i,r,n,o,s,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o,s,a);void 0!==e.id?this._featureMap.add(e.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r,n,o){for(const s of i)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,s,r,n,o||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const za={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ba(t,e){return za[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Ua={"line-pattern":{source:vs,composite:vs},"fill-pattern":{source:vs,composite:vs},"fill-extrusion-pattern":{source:vs,composite:vs},"line-dasharray":{source:xs,composite:xs}},Va={color:{source:Us,composite:As},number:{source:Ds,composite:Us}};function ja(t,e,i){const r=Ua[t];return r&&r[i]||Va[e][i]}ro(Pa,"ConstantBinder"),ro(ka,"PatternConstantBinder"),ro(Na,"SourceExpressionBinder"),ro(Oa,"PatternCompositeBinder"),ro(Da,"CompositeExpressionBinder"),ro(Ra,"ProgramConfiguration",{omit:["_buffers"]}),ro(Fa,"ProgramConfigurationSet");const Ga=ki/Math.PI/2,Za=5,qa=6,Wa=16383,Ha=64,Ja=[Ha,32,16],Ka=-Ga,$a=Ga;function Ya(t,e,i,r=Ga){return i=x(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Xa(t,e,i){return Ya(Math.cos(x(t)),Math.sin(x(t)),e,i)}const Qa=6371008.8,tl=2*Math.PI*Qa;class el{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new el(I(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Qa*Math.acos(Math.min(n,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new il({lng:this.lng-i,lat:this.lat-e},{lng:this.lng+i,lat:this.lat+e})}toEcef(t){return Xa(this.lat,this.lng,Ga+t*Ga/Qa)}static convert(t){if(t instanceof el)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new el(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new el(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class il{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof el?new el(t.lng,t.lat):el.convert(t),this}setSouthWest(t){return this._sw=t instanceof el?new el(t.lng,t.lat):el.convert(t),this}extend(t){const e=this._sw,i=this._ne;let r,n;if(t instanceof el)r=t,n=t;else{if(!(t instanceof il))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(il.convert(t)):this.extend(el.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(el.convert(t)):this;if(r=t._sw,n=t._ne,!r||!n)return this}return e||i?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new el(r.lng,r.lat),this._ne=new el(n.lng,n.lat)),this}getCenter(){return new el((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new el(this.getWest(),this.getNorth())}getSouthEast(){return new el(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=el.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(t){return!t||t instanceof il?t:new il(t)}}var rl={};!function(t,e){!function(t){function e(t,e,r){var n=i(256*t,256*(e=Math.pow(2,r)-e-1),r),o=i(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+o[0]+","+o[1]}function i(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}t.getURL=function(t,i,r,n,o,s){return s=s||{},t+"?"+["bbox="+e(r,n,o),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,rl);var nl=rl;class ol{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=ll(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=nl.getTileBBox(this.x,this.y,this.z),r=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sl{constructor(t,e){this.wrap=t,this.canonical=e,this.key=ll(t,e.z,e.z,e.x,e.y)}}class al{constructor(t,e,i,r,n){this.overscaledZ=t,this.wrap=e,this.canonical=new ol(i,+r,+n),this.key=0===e&&t===i?this.canonical.key:ll(e,t,i,r,n)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new al(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new al(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return ll(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return ll(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new al(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new al(e,this.wrap,e,i,r),new al(e,this.wrap,e,i+1,r),new al(e,this.wrap,e,i,r+1),new al(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new al(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new al(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ll(t,e,i,r,n){const o=1<<Math.min(i,22);let s=o*(n%o)+r%o;return t&&i<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}const cl=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new al(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new al(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new al(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new al(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ro(ol,"CanonicalTileID"),ro(al,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ul=0,hl=25.5;function pl(t){return tl*Math.cos(t*Math.PI/180)}function dl(t){return(180+t)/360}function fl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ml(t,e){return t/pl(e)}function gl(t){return 360*t-180}function _l(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function yl(t,e){return t*pl(_l(e))}const Al=85.051129;function vl(t){return Math.cos(x(M(t,-Al,Al)))}function xl(t,e){const i=M(e,ul,hl),r=Math.pow(2,i);return vl(t)*tl/(512*r)}function bl(t){return 1/Math.cos(t*Math.PI/180)}function wl(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/ki)/(1<<t.z)*2));return 80150034*i/(i*i+1)/ki/(1<<t.z)}class Sl{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=el.convert(t);return new Sl(dl(i.lng),fl(i.lat),ml(e,i.lat))}toLngLat(){return new el(gl(this.x),_l(this.y))}toAltitude(){return yl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/tl*bl(_l(this.y))}}function Tl(t,e,i,r,n,o,s,a,l){const c=(e+r)/2,u=(i+n)/2,h=new y(c,u);a(h),function(t,e,i,r,n,o){const s=i-n,a=r-o;return Math.abs((r-e)*s-(i-t)*a)/Math.hypot(s,a)}(h.x,h.y,o.x,o.y,s.x,s.y)>=l?(Tl(t,e,i,c,u,o,h,a,l),Tl(t,c,u,r,n,h,s,a,l)):t.push(s)}function Cl(t,e,i){let r=t[0],n=r.x,o=r.y;e(r);const s=[r];for(let a=1;a<t.length;a++){const l=t[a],{x:c,y:u}=l;e(l),Tl(s,n,o,c,u,r,l,e,i),n=c,o=u,r=l}return s}function Ml(t,e,i,r){if(r(e,i)){const n=e.add(i)._mult(.5);Ml(t,e,n,r),Ml(t,n,i,r)}else t.push(i)}function El(t,e){let i=t[0];const r=[i];for(let n=1;n<t.length;n++){const o=t[n];Ml(r,i,o,e),i=o}return r}const Il=Math.pow(2,14)-1,Ll=-Il-1;function Pl(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=M(i,Ll,Il),t.y=M(r,Ll,Il),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&G("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function kl(t,e,i){const r=t.loadGeometry(),n=t.extent,o=ki/n;if(e&&i&&i.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:c}=i,u=t=>{const i=gl((e.x+t.x/n)/o),r=_l((e.y+t.y/n)/o),u=c.project(i,r);t.x=(u.x*s-a)*n,t.y=(u.y*s-l)*n};for(let e=0;e<r.length;e++)if(1!==t.type)r[e]=Cl(r[e],u,1);else{const t=[];for(const i of r[e])i.x<0||i.x>=n||i.y<0||i.y>=n||(u(i),t.push(i));r[e]=t}}for(const t of r)for(const e of t)Pl(e,o);return r}function Nl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?kl(t):[]}}function Dl(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}function Ol(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class Rl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new fs,this.indexArray=new Ps,this.segments=new ra,this.programConfigurations=new Fa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,r){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:e,id:n,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Nl(e,t);if(!this.layers[0]._featureFilter.filter(new Lo(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:kl(e,i,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new bs,a=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r,l=t[o].feature;this.addFeature(r,n,o,e.availableImages,i,a,e.brightness),e.featureIndex.insert(l,n,o,s,this.index)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ea.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,ia.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,r,n,o,s){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=ki||r<0||r>=ki)continue;if(o){const t=o.projectTilePoint(i,r,n),e=o.upVector(n,i,r),s=this.globeExtVertexArray;Ol(s,t,e),Ol(s,t,e),Ol(s,t,e),Ol(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;Dl(this.layoutVertexArray,i,r,-1,-1),Dl(this.layoutVertexArray,i,r,1,-1),Dl(this.layoutVertexArray,i,r,1,1),Dl(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r,n,s)}}function Fl(t,e){for(let i=0;i<t.length;i++)if(Wl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Wl(t,e[i]))return!0;return!!Vl(t,e)}function zl(t,e,i){return!!Wl(t,e)||!!Gl(e,t,i)}function Bl(t,e){if(1===t.length)return ql(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(Wl(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(ql(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Vl(t,e[i]))return!0;return!1}function Ul(t,e,i){if(t.length>1){if(Vl(t,e))return!0;for(let r=0;r<e.length;r++)if(Gl(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Gl(t[r],e,i))return!0;return!1}function Vl(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(jl(r,n,e[t],e[t+1]))return!0}return!1}function jl(t,e,i,r){return Z(t,i,r)!==Z(e,i,r)&&Z(t,e,i)!==Z(t,e,r)}function Gl(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(Zl(t,e[i-1],e[i])<r)return!0;return!1}function Zl(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function ql(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function Wl(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Hl(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new y(e,i),new y(e,n),new y(r,n),new y(r,i)];if(t.length>2)for(const e of o)if(Wl(t,e))return!0;for(let e=0;e<t.length-1;e++)if(Jl(t[e],t[e+1],o))return!0;return!1}function Jl(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=Z(t,e,i[0]);return o!==Z(t,e,i[1])||o!==Z(t,e,i[2])||o!==Z(t,e,i[3])}function Kl(t,e,i,r,n,o){let s=e.y-t.y,a=t.x-e.x;if(o=o||0){const t=s*s+a*a;if(0===t)return!0;const e=Math.sqrt(t);s/=e,a/=e}return!((i.x-t.x)*s+(i.y-t.y)*a-o<0||(r.x-t.x)*s+(r.y-t.y)*a-o<0||(n.x-t.x)*s+(n.y-t.y)*a-o<0)}function $l(t,e,i,r,n,o,s){return!(Kl(t,e,r,n,o,s)||Kl(e,i,r,n,o,s)||Kl(i,t,r,n,o,s)||Kl(r,n,t,e,i,s)||Kl(n,o,t,e,i,s)||Kl(o,r,t,e,i,s))}function Yl(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Xl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ql(t,e,i,r,n){if(!e[0]&&!e[1])return t;const o=y.convert(e)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(o));return s}function tc(t,e,i,r){const n=y.convert(t)._mult(r);return"viewport"===e&&n._rotate(-i),n}ro(Rl,"CircleBucket",{omit:["layers"]});const ec=new jo({"circle-sort-key":new Uo(qo.layout_circle["circle-sort-key"]),visibility:new Bo(qo.layout_circle.visibility)});var ic={paint:new jo({"circle-radius":new Uo(qo.paint_circle["circle-radius"]),"circle-color":new Uo(qo.paint_circle["circle-color"]),"circle-blur":new Uo(qo.paint_circle["circle-blur"]),"circle-opacity":new Uo(qo.paint_circle["circle-opacity"]),"circle-translate":new Bo(qo.paint_circle["circle-translate"]),"circle-translate-anchor":new Bo(qo.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bo(qo.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bo(qo.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Uo(qo.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Uo(qo.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Uo(qo.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Bo(qo.paint_circle["circle-emissive-strength"])}),layout:ec},rc={},nc={};Object.defineProperty(nc,"__esModule",{value:!0}),nc.setMatrixArrayType=function(t){nc.ARRAY_TYPE=sc=t},nc.toRadian=function(t){return t*lc},nc.equals=function(t,e){return Math.abs(t-e)<=oc*Math.max(1,Math.abs(t),Math.abs(e))},nc.RANDOM=nc.ARRAY_TYPE=nc.EPSILON=void 0;var oc=1e-6;nc.EPSILON=oc;var sc="undefined"!=typeof Float32Array?Float32Array:Array;nc.ARRAY_TYPE=sc;var ac=Math.random;nc.RANDOM=ac;var lc=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var cc={};function uc(t){return uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uc(t)}Object.defineProperty(cc,"__esModule",{value:!0}),cc.create=function(){var t=new hc.ARRAY_TYPE(4);return hc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},cc.clone=function(t){var e=new hc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},cc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},cc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},cc.fromValues=function(t,e,i,r){var n=new hc.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},cc.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},cc.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},cc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*o-n*r;return s?(t[0]=o*(s=1/s),t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null},cc.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},cc.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},cc.multiply=dc,cc.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l,t},cc.scale=function(t,e,i){var r=e[1],n=e[2],o=e[3],s=i[0],a=i[1];return t[0]=e[0]*s,t[1]=r*s,t[2]=n*a,t[3]=o*a,t},cc.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},cc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},cc.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},cc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},cc.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},cc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},cc.subtract=fc,cc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},cc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=hc.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=hc.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=hc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=hc.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},cc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},cc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},cc.sub=cc.mul=void 0;var hc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==uc(t)&&"function"!=typeof t)return{default:t};var i=pc(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function pc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(pc=function(t){return t?i:e})(t)}function dc(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+o*l,t[1]=n*a+s*l,t[2]=r*c+o*u,t[3]=n*c+s*u,t}function fc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}cc.mul=dc,cc.sub=fc;var mc={};function gc(t){return gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gc(t)}Object.defineProperty(mc,"__esModule",{value:!0}),mc.create=function(){var t=new _c.ARRAY_TYPE(6);return _c.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},mc.clone=function(t){var e=new _c.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},mc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},mc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},mc.fromValues=function(t,e,i,r,n,o){var s=new _c.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=r,s[4]=n,s[5]=o,s},mc.set=function(t,e,i,r,n,o,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t},mc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=i*o-r*n;return l?(t[0]=o*(l=1/l),t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-o*s)*l,t[5]=(r*s-i*a)*l,t):null},mc.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},mc.multiply=Ac,mc.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*c,t[1]=n*u+s*c,t[2]=r*-c+o*u,t[3]=n*-c+s*u,t[4]=a,t[5]=l,t},mc.scale=function(t,e,i){var r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=i[0],c=i[1];return t[0]=e[0]*l,t[1]=r*l,t[2]=n*c,t[3]=o*c,t[4]=s,t[5]=a,t},mc.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=r*c+o*u+a,t[5]=n*c+s*u+l,t},mc.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},mc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},mc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},mc.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},mc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},mc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},mc.subtract=vc,mc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},mc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},mc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},mc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],p=e[4],d=e[5];return Math.abs(i-l)<=_c.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=_c.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=_c.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-h)<=_c.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=_c.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-d)<=_c.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},mc.sub=mc.mul=void 0;var _c=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==gc(t)&&"function"!=typeof t)return{default:t};var i=yc(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function yc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(yc=function(t){return t?i:e})(t)}function Ac(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=i[0],u=i[1],h=i[2],p=i[3],d=i[4],f=i[5];return t[0]=r*c+o*u,t[1]=n*c+s*u,t[2]=r*h+o*p,t[3]=n*h+s*p,t[4]=r*d+o*f+a,t[5]=n*d+s*f+l,t}function vc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}mc.mul=Ac,mc.sub=vc;var xc={};function bc(t){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bc(t)}Object.defineProperty(xc,"__esModule",{value:!0}),xc.create=function(){var t=new wc.ARRAY_TYPE(9);return wc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},xc.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},xc.clone=function(t){var e=new wc.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},xc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},xc.fromValues=function(t,e,i,r,n,o,s,a,l){var c=new wc.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=o,c[6]=s,c[7]=a,c[8]=l,c},xc.set=function(t,e,i,r,n,o,s,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t},xc.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},xc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*s-a*c,p=-u*o+a*l,d=c*o-s*l,f=i*h+r*p+n*d;return f?(t[0]=h*(f=1/f),t[1]=(-u*r+n*c)*f,t[2]=(a*r-n*s)*f,t[3]=p*f,t[4]=(u*i-n*l)*f,t[5]=(-a*i+n*o)*f,t[6]=d*f,t[7]=(-c*i+r*l)*f,t[8]=(s*i-r*o)*f,t):null},xc.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=n*c-r*u,t[2]=r*a-n*s,t[3]=a*l-o*u,t[4]=i*u-n*l,t[5]=n*o-i*a,t[6]=o*c-s*l,t[7]=r*l-i*c,t[8]=i*s-r*o,t},xc.determinant=function(t){var e=t[3],i=t[4],r=t[5],n=t[6],o=t[7],s=t[8];return t[0]*(s*i-r*o)+t[1]*(-s*e+r*n)+t[2]*(o*e-i*n)},xc.multiply=Tc,xc.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],d=i[1];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=p*r+d*s+c,t[7]=p*n+d*a+u,t[8]=p*o+d*l+h,t},xc.rotate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=Math.sin(i),d=Math.cos(i);return t[0]=d*r+p*s,t[1]=d*n+p*a,t[2]=d*o+p*l,t[3]=d*s-p*r,t[4]=d*a-p*n,t[5]=d*l-p*o,t[6]=c,t[7]=u,t[8]=h,t},xc.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},xc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},xc.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},xc.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},xc.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,p=n*s,d=n*a,f=n*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[3]=u-_,t[6]=p+g,t[1]=u+_,t[4]=1-c-f,t[7]=d-m,t[2]=p-g,t[5]=d+m,t[8]=1-c-h,t},xc.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-r*s,A=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,S=u*m-h*f,T=u*g-p*f,C=u*_-d*f,M=h*g-p*m,E=h*_-d*m,I=p*_-d*g,L=y*I-A*E+v*M+x*C-b*T+w*S;return L?(t[0]=(a*I-l*E+c*M)*(L=1/L),t[1]=(l*C-s*I-c*T)*L,t[2]=(s*E-a*C+c*S)*L,t[3]=(n*E-r*I-o*M)*L,t[4]=(i*I-n*C+o*T)*L,t[5]=(r*C-i*E-o*S)*L,t[6]=(m*w-g*b+_*x)*L,t[7]=(g*v-f*w-_*A)*L,t[8]=(f*b-m*v+_*y)*L,t):null},xc.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},xc.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},xc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},xc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},xc.subtract=Cc,xc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},xc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},xc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},xc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],p=e[1],d=e[2],f=e[3],m=e[4],g=e[5],_=e[6],y=e[7],A=e[8];return Math.abs(i-h)<=wc.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-p)<=wc.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-d)<=wc.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-f)<=wc.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=wc.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-g)<=wc.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-_)<=wc.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=wc.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(u-A)<=wc.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))},xc.sub=xc.mul=void 0;var wc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==bc(t)&&"function"!=typeof t)return{default:t};var i=Sc(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function Sc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Sc=function(t){return t?i:e})(t)}function Tc(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],d=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],A=i[7],v=i[8];return t[0]=p*r+d*s+f*c,t[1]=p*n+d*a+f*u,t[2]=p*o+d*l+f*h,t[3]=m*r+g*s+_*c,t[4]=m*n+g*a+_*u,t[5]=m*o+g*l+_*h,t[6]=y*r+A*s+v*c,t[7]=y*n+A*a+v*u,t[8]=y*o+A*l+v*h,t}function Cc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}xc.mul=Tc,xc.sub=Cc;var Mc={};function Ec(t){return Ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ec(t)}Object.defineProperty(Mc,"__esModule",{value:!0}),Mc.create=function(){var t=new Ic.ARRAY_TYPE(16);return Ic.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Mc.clone=function(t){var e=new Ic.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Mc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.fromValues=function(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m){var g=new Ic.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=i,g[3]=r,g[4]=n,g[5]=o,g[6]=s,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=p,g[13]=d,g[14]=f,g[15]=m,g},Mc.set=function(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=p,t[12]=d,t[13]=f,t[14]=m,t[15]=g,t},Mc.identity=Pc,Mc.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=n,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Mc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-r*s,A=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,S=u*m-h*f,T=u*g-p*f,C=u*_-d*f,M=h*g-p*m,E=h*_-d*m,I=p*_-d*g,L=y*I-A*E+v*M+x*C-b*T+w*S;return L?(t[0]=(a*I-l*E+c*M)*(L=1/L),t[1]=(n*E-r*I-o*M)*L,t[2]=(m*w-g*b+_*x)*L,t[3]=(p*b-h*w-d*x)*L,t[4]=(l*C-s*I-c*T)*L,t[5]=(i*I-n*C+o*T)*L,t[6]=(g*v-f*w-_*A)*L,t[7]=(u*w-p*v+d*A)*L,t[8]=(s*E-a*C+c*S)*L,t[9]=(r*C-i*E-o*S)*L,t[10]=(f*b-m*v+_*y)*L,t[11]=(h*v-u*b-d*y)*L,t[12]=(a*T-s*M-l*S)*L,t[13]=(i*M-r*T+n*S)*L,t[14]=(m*A-f*x-g*y)*L,t[15]=(u*x-h*A+p*y)*L,t):null},Mc.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15];return t[0]=a*(p*_-d*g)-h*(l*_-c*g)+m*(l*d-c*p),t[1]=-(r*(p*_-d*g)-h*(n*_-o*g)+m*(n*d-o*p)),t[2]=r*(l*_-c*g)-a*(n*_-o*g)+m*(n*c-o*l),t[3]=-(r*(l*d-c*p)-a*(n*d-o*p)+h*(n*c-o*l)),t[4]=-(s*(p*_-d*g)-u*(l*_-c*g)+f*(l*d-c*p)),t[5]=i*(p*_-d*g)-u*(n*_-o*g)+f*(n*d-o*p),t[6]=-(i*(l*_-c*g)-s*(n*_-o*g)+f*(n*c-o*l)),t[7]=i*(l*d-c*p)-s*(n*d-o*p)+u*(n*c-o*l),t[8]=s*(h*_-d*m)-u*(a*_-c*m)+f*(a*d-c*h),t[9]=-(i*(h*_-d*m)-u*(r*_-o*m)+f*(r*d-o*h)),t[10]=i*(a*_-c*m)-s*(r*_-o*m)+f*(r*c-o*a),t[11]=-(i*(a*d-c*h)-s*(r*d-o*h)+u*(r*c-o*a)),t[12]=-(s*(h*g-p*m)-u*(a*g-l*m)+f*(a*p-l*h)),t[13]=i*(h*g-p*m)-u*(r*g-n*m)+f*(r*p-n*h),t[14]=-(i*(a*g-l*m)-s*(r*g-n*m)+f*(r*l-n*a)),t[15]=i*(a*p-l*h)-s*(r*p-n*h)+u*(r*l-n*a),t},Mc.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15];return(e*s-i*o)*(h*g-p*m)-(e*a-r*o)*(u*g-p*f)+(e*l-n*o)*(u*m-h*f)+(i*a-r*s)*(c*g-p*d)-(i*l-n*s)*(c*m-h*d)+(r*l-n*a)*(c*f-u*d)},Mc.multiply=kc,Mc.translate=function(t,e,i){var r,n,o,s,a,l,c,u,h,p,d,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*m+a*g+h*_+e[12],t[13]=n*m+l*g+p*_+e[13],t[14]=o*m+c*g+d*_+e[14],t[15]=s*m+u*g+f*_+e[15]),t},Mc.scale=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Mc.rotate=function(t,e,i,r){var n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E=r[0],I=r[1],L=r[2],P=Math.hypot(E,I,L);return P<Ic.EPSILON?null:(E*=P=1/P,I*=P,L*=P,n=Math.sin(i),o=Math.cos(i),l=e[1],c=e[2],u=e[3],p=e[5],d=e[6],f=e[7],g=e[9],_=e[10],y=e[11],A=E*E*(s=1-o)+o,b=E*I*s-L*n,w=I*I*s+o,S=L*I*s+E*n,T=E*L*s+I*n,C=I*L*s-E*n,M=L*L*s+o,t[0]=(a=e[0])*A+(h=e[4])*(v=I*E*s+L*n)+(m=e[8])*(x=L*E*s-I*n),t[1]=l*A+p*v+g*x,t[2]=c*A+d*v+_*x,t[3]=u*A+f*v+y*x,t[4]=a*b+h*w+m*S,t[5]=l*b+p*w+g*S,t[6]=c*b+d*w+_*S,t[7]=u*b+f*w+y*S,t[8]=a*T+h*C+m*M,t[9]=l*T+p*C+g*M,t[10]=c*T+d*C+_*M,t[11]=u*T+f*C+y*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Mc.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+p*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=p*n-l*r,t},Mc.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-c*r,t[1]=s*n-u*r,t[2]=a*n-h*r,t[3]=l*n-p*r,t[8]=o*r+c*n,t[9]=s*r+u*n,t[10]=a*r+h*n,t[11]=l*r+p*n,t},Mc.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+p*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=p*n-l*r,t},Mc.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Mc.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromRotation=function(t,e,i){var r,n,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<Ic.EPSILON?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),t[0]=s*s*(o=1-n)+n,t[1]=a*s*o+l*r,t[2]=l*s*o-a*r,t[3]=0,t[4]=s*a*o-l*r,t[5]=a*a*o+n,t[6]=l*a*o+s*r,t[7]=0,t[8]=s*l*o+a*r,t[9]=a*l*o-s*r,t[10]=l*l*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Mc.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.fromRotationTranslation=Nc,Mc.fromQuat2=function(t,e){var i=new Ic.ARRAY_TYPE(3),r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=r*r+n*n+o*o+s*s;return h>0?(i[0]=2*(a*s+u*r+l*o-c*n)/h,i[1]=2*(l*s+u*n+c*r-a*o)/h,i[2]=2*(c*s+u*o+a*n-l*r)/h):(i[0]=2*(a*s+u*r+l*o-c*n),i[1]=2*(l*s+u*n+c*r-a*o),i[2]=2*(c*s+u*o+a*n-l*r)),Nc(t,e,i),t},Mc.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Mc.getScaling=Dc,Mc.getRotation=function(t,e){var i=new Ic.ARRAY_TYPE(3);Dc(i,e);var r=1/i[0],n=1/i[1],o=1/i[2],s=e[0]*r,a=e[1]*n,l=e[2]*o,c=e[4]*r,u=e[5]*n,h=e[6]*o,p=e[8]*r,d=e[9]*n,f=e[10]*o,m=s+u+f,g=0;return m>0?(g=2*Math.sqrt(m+1),t[3]=.25*g,t[0]=(h-d)/g,t[1]=(p-l)/g,t[2]=(a-c)/g):s>u&&s>f?(g=2*Math.sqrt(1+s-u-f),t[3]=(h-d)/g,t[0]=.25*g,t[1]=(a+c)/g,t[2]=(p+l)/g):u>f?(g=2*Math.sqrt(1+u-s-f),t[3]=(p-l)/g,t[0]=(a+c)/g,t[1]=.25*g,t[2]=(h+d)/g):(g=2*Math.sqrt(1+f-s-u),t[3]=(a-c)/g,t[0]=(p+l)/g,t[1]=(h+d)/g,t[2]=.25*g),t},Mc.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=e[3],l=n+n,c=o+o,u=s+s,h=n*l,p=n*c,d=n*u,f=o*c,m=o*u,g=s*u,_=a*l,y=a*c,A=a*u,v=r[0],x=r[1],b=r[2];return t[0]=(1-(f+g))*v,t[1]=(p+A)*v,t[2]=(d-y)*v,t[3]=0,t[4]=(p-A)*x,t[5]=(1-(h+g))*x,t[6]=(m+_)*x,t[7]=0,t[8]=(d+y)*b,t[9]=(m-_)*b,t[10]=(1-(h+f))*b,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},Mc.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var o=e[0],s=e[1],a=e[2],l=e[3],c=o+o,u=s+s,h=a+a,p=o*c,d=o*u,f=o*h,m=s*u,g=s*h,_=a*h,y=l*c,A=l*u,v=l*h,x=r[0],b=r[1],w=r[2],S=n[0],T=n[1],C=n[2],M=(1-(m+_))*x,E=(d+v)*x,I=(f-A)*x,L=(d-v)*b,P=(1-(p+_))*b,k=(g+y)*b,N=(f+A)*w,D=(g-y)*w,O=(1-(p+m))*w;return t[0]=M,t[1]=E,t[2]=I,t[3]=0,t[4]=L,t[5]=P,t[6]=k,t[7]=0,t[8]=N,t[9]=D,t[10]=O,t[11]=0,t[12]=i[0]+S-(M*S+L*T+N*C),t[13]=i[1]+T-(E*S+P*T+D*C),t[14]=i[2]+C-(I*S+k*T+O*C),t[15]=1,t},Mc.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,p=n*s,d=n*a,f=n*l,m=o*s,g=o*a,_=o*l;return t[0]=1-h-f,t[1]=u+_,t[2]=p-g,t[3]=0,t[4]=u-_,t[5]=1-c-f,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Mc.frustum=function(t,e,i,r,n,o,s){var a=1/(i-e),l=1/(n-r),c=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(s+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*c,t[15]=0,t},Mc.perspectiveNO=Oc,Mc.perspectiveZO=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=n*(o=1/(r-n)),t[14]=n*r*o):(t[10]=-1,t[14]=-r),t},Mc.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(s+a),c=2/(n+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-a)*l*.5,t[9]=(n-o)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},Mc.orthoNO=Rc,Mc.orthoZO=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=o*c,t[15]=1,t},Mc.lookAt=function(t,e,i,r){var n,o,s,a,l,c,u,h,p,d,f=e[0],m=e[1],g=e[2],_=r[0],y=r[1],A=r[2],v=i[0],x=i[1],b=i[2];return Math.abs(f-v)<Ic.EPSILON&&Math.abs(m-x)<Ic.EPSILON&&Math.abs(g-b)<Ic.EPSILON?Pc(t):(u=f-v,h=m-x,p=g-b,n=y*(p*=d=1/Math.hypot(u,h,p))-A*(h*=d),o=A*(u*=d)-_*p,s=_*h-y*u,(d=Math.hypot(n,o,s))?(n*=d=1/d,o*=d,s*=d):(n=0,o=0,s=0),a=h*s-p*o,l=p*n-u*s,c=u*o-h*n,(d=Math.hypot(a,l,c))?(a*=d=1/d,l*=d,c*=d):(a=0,l=0,c=0),t[0]=n,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=s,t[9]=c,t[10]=p,t[11]=0,t[12]=-(n*f+o*m+s*g),t[13]=-(a*f+l*m+c*g),t[14]=-(u*f+h*m+p*g),t[15]=1,t)},Mc.targetTo=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=r[0],l=r[1],c=r[2],u=n-i[0],h=o-i[1],p=s-i[2],d=u*u+h*h+p*p;d>0&&(u*=d=1/Math.sqrt(d),h*=d,p*=d);var f=l*p-c*h,m=c*u-a*p,g=a*h-l*u;return(d=f*f+m*m+g*g)>0&&(f*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=f,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-p*m,t[5]=p*f-u*g,t[6]=u*m-h*f,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=n,t[13]=o,t[14]=s,t[15]=1,t},Mc.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Mc.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Mc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},Mc.subtract=Fc,Mc.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},Mc.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},Mc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Mc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=e[0],A=e[1],v=e[2],x=e[3],b=e[4],w=e[5],S=e[6],T=e[7],C=e[8],M=e[9],E=e[10],I=e[11],L=e[12],P=e[13],k=e[14],N=e[15];return Math.abs(i-y)<=Ic.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-A)<=Ic.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(n-v)<=Ic.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=Ic.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=Ic.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=Ic.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-S)<=Ic.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=Ic.EPSILON*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-C)<=Ic.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-M)<=Ic.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-E)<=Ic.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-I)<=Ic.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-L)<=Ic.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(m-P)<=Ic.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-k)<=Ic.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(_-N)<=Ic.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))},Mc.sub=Mc.mul=Mc.ortho=Mc.perspective=void 0;var Ic=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Ec(t)&&"function"!=typeof t)return{default:t};var i=Lc(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function Lc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Lc=function(t){return t?i:e})(t)}function Pc(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kc(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],A=i[0],v=i[1],x=i[2],b=i[3];return t[0]=A*r+v*a+x*h+b*m,t[1]=A*n+v*l+x*p+b*g,t[2]=A*o+v*c+x*d+b*_,t[3]=A*s+v*u+x*f+b*y,t[4]=(A=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*m,t[5]=A*n+v*l+x*p+b*g,t[6]=A*o+v*c+x*d+b*_,t[7]=A*s+v*u+x*f+b*y,t[8]=(A=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*m,t[9]=A*n+v*l+x*p+b*g,t[10]=A*o+v*c+x*d+b*_,t[11]=A*s+v*u+x*f+b*y,t[12]=(A=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*m,t[13]=A*n+v*l+x*p+b*g,t[14]=A*o+v*c+x*d+b*_,t[15]=A*s+v*u+x*f+b*y,t}function Nc(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=r+r,l=n+n,c=o+o,u=r*a,h=r*l,p=r*c,d=n*l,f=n*c,m=o*c,g=s*a,_=s*l,y=s*c;return t[0]=1-(d+m),t[1]=h+y,t[2]=p-_,t[3]=0,t[4]=h-y,t[5]=1-(u+m),t[6]=f+g,t[7]=0,t[8]=p+_,t[9]=f-g,t[10]=1-(u+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function Dc(t,e){var i=e[4],r=e[5],n=e[6],o=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,r,n),t[2]=Math.hypot(o,s,a),t}function Oc(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function Rc(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t}function Fc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}Mc.perspective=Oc,Mc.ortho=Rc,Mc.mul=kc,Mc.sub=Fc;var zc={},Bc={};function Uc(t){return Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uc(t)}Object.defineProperty(Bc,"__esModule",{value:!0}),Bc.create=Gc,Bc.clone=function(t){var e=new Vc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Bc.length=Zc,Bc.fromValues=function(t,e,i){var r=new Vc.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=i,r},Bc.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Bc.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},Bc.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},Bc.subtract=qc,Bc.multiply=Wc,Bc.divide=Hc,Bc.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Bc.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Bc.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},Bc.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},Bc.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Bc.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},Bc.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},Bc.distance=Jc,Bc.squaredDistance=Kc,Bc.squaredLength=$c,Bc.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Bc.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Bc.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},Bc.dot=Yc,Bc.cross=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t},Bc.lerp=function(t,e,i,r){var n=e[0],o=e[1],s=e[2];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=s+r*(i[2]-s),t},Bc.hermite=function(t,e,i,r,n,o){var s=o*o,a=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*u,t},Bc.bezier=function(t,e,i,r,n,o){var s=1-o,a=s*s,l=o*o,c=a*s,u=3*o*a,h=3*l*s,p=l*o;return t[0]=e[0]*c+i[0]*u+r[0]*h+n[0]*p,t[1]=e[1]*c+i[1]*u+r[1]*h+n[1]*p,t[2]=e[2]*c+i[2]*u+r[2]*h+n[2]*p,t},Bc.random=function(t,e){e=e||1;var i=2*Vc.RANDOM()*Math.PI,r=2*Vc.RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=r*e,t},Bc.transformMat4=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return t[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,t[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,t},Bc.transformMat3=function(t,e,i){var r=e[0],n=e[1],o=e[2];return t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8],t},Bc.transformQuat=function(t,e,i){var r=i[0],n=i[1],o=i[2],s=e[0],a=e[1],l=e[2],c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,p=n*h-o*u,d=o*c-r*h,f=r*u-n*c,m=2*i[3];return u*=m,h*=m,d*=2,f*=2,t[0]=s+(c*=m)+(p*=2),t[1]=a+u+d,t[2]=l+h+f,t},Bc.rotateX=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},Bc.rotateY=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},Bc.rotateZ=function(t,e,i,r){var n=[],o=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},Bc.angle=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2],l=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(o*o+s*s+a*a),c=l&&Yc(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Bc.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Bc.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Bc.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Bc.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=Vc.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=Vc.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=Vc.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))},Bc.forEach=Bc.sqrLen=Bc.len=Bc.sqrDist=Bc.dist=Bc.div=Bc.mul=Bc.sub=void 0;var Vc=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Uc(t)&&"function"!=typeof t)return{default:t};var i=jc(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function jc(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(jc=function(t){return t?i:e})(t)}function Gc(){var t=new Vc.ARRAY_TYPE(3);return Vc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Zc(t){return Math.hypot(t[0],t[1],t[2])}function qc(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Wc(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Hc(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Jc(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Kc(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function $c(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Yc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Bc.sub=qc,Bc.mul=Wc,Bc.div=Hc,Bc.dist=Jc,Bc.sqrDist=Kc,Bc.len=Zc,Bc.sqrLen=$c;var Xc,Qc=(Xc=Gc(),function(t,e,i,r,n,o){var s,a;for(e||(e=3),i||(i=0),a=r?Math.min(r*e+i,t.length):t.length,s=i;s<a;s+=e)Xc[0]=t[s],Xc[1]=t[s+1],Xc[2]=t[s+2],n(Xc,Xc,o),t[s]=Xc[0],t[s+1]=Xc[1],t[s+2]=Xc[2];return t});Bc.forEach=Qc;var tu={};function eu(t){return eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eu(t)}Object.defineProperty(tu,"__esModule",{value:!0}),tu.create=nu,tu.clone=function(t){var e=new iu.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},tu.fromValues=function(t,e,i,r){var n=new iu.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},tu.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},tu.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},tu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},tu.subtract=ou,tu.multiply=su,tu.divide=au,tu.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},tu.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},tu.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},tu.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},tu.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},tu.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},tu.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},tu.distance=lu,tu.squaredDistance=cu,tu.length=uu,tu.squaredLength=hu,tu.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},tu.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},tu.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=o*s,t},tu.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},tu.cross=function(t,e,i,r){var n=i[0]*r[1]-i[1]*r[0],o=i[0]*r[2]-i[2]*r[0],s=i[0]*r[3]-i[3]*r[0],a=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],u=e[0],h=e[1],p=e[2],d=e[3];return t[0]=h*c-p*l+d*a,t[1]=-u*c+p*s-d*o,t[2]=u*l-h*s+d*n,t[3]=-u*a+h*o-p*n,t},tu.lerp=function(t,e,i,r){var n=e[0],o=e[1],s=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t[2]=s+r*(i[2]-s),t[3]=a+r*(i[3]-a),t},tu.random=function(t,e){var i,r,n,o,s,a;e=e||1;do{s=(i=2*iu.RANDOM()-1)*i+(r=2*iu.RANDOM()-1)*r}while(s>=1);do{a=(n=2*iu.RANDOM()-1)*n+(o=2*iu.RANDOM()-1)*o}while(a>=1);var l=Math.sqrt((1-s)/a);return t[0]=e*i,t[1]=e*r,t[2]=e*n*l,t[3]=e*o*l,t},tu.transformMat4=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t},tu.transformQuat=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*o-l*n,h=c*n+l*r-s*o,p=c*o+s*n-a*r,d=-s*r-a*n-l*o;return t[0]=u*c+d*-s+h*-l-p*-a,t[1]=h*c+d*-a+p*-s-u*-l,t[2]=p*c+d*-l+u*-a-h*-s,t[3]=e[3],t},tu.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},tu.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},tu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},tu.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=e[0],a=e[1],l=e[2],c=e[3];return Math.abs(i-s)<=iu.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=iu.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=iu.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=iu.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},tu.forEach=tu.sqrLen=tu.len=tu.sqrDist=tu.dist=tu.div=tu.mul=tu.sub=void 0;var iu=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==eu(t)&&"function"!=typeof t)return{default:t};var i=ru(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function ru(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(ru=function(t){return t?i:e})(t)}function nu(){var t=new iu.ARRAY_TYPE(4);return iu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ou(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function su(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function au(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function lu(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function cu(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return i*i+r*r+n*n+o*o}function uu(t){return Math.hypot(t[0],t[1],t[2],t[3])}function hu(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}tu.sub=ou,tu.mul=su,tu.div=au,tu.dist=lu,tu.sqrDist=cu,tu.len=uu,tu.sqrLen=hu;var pu=function(){var t=nu();return function(e,i,r,n,o,s){var a,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,a=r;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function du(t){return du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},du(t)}tu.forEach=pu,Object.defineProperty(zc,"__esModule",{value:!0}),zc.create=vu,zc.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},zc.setAxisAngle=xu,zc.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>fu.EPSILON?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},zc.getAngle=function(t,e){var i=Eu(t,e);return Math.acos(2*i*i-1)},zc.multiply=bu,zc.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=o*l-n*a,t[3]=s*l-r*a,t},zc.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-o*a,t[1]=n*l+s*a,t[2]=o*l+r*a,t[3]=s*l-n*a,t},zc.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},zc.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},zc.exp=wu,zc.ln=Su,zc.pow=function(t,e,i){return Su(t,e),Mu(t,t,i),wu(t,t),t},zc.slerp=Tu,zc.random=function(t){var e=fu.RANDOM(),i=fu.RANDOM(),r=fu.RANDOM(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*i),t[1]=n*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t},zc.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=o*a,t},zc.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},zc.fromMat3=Cu,zc.fromEuler=function(t,e,i,r){var n=.5*Math.PI/180;e*=n,i*=n,r*=n;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=o*l*u-s*a*c,t[1]=s*a*u+o*l*c,t[2]=s*l*c-o*a*u,t[3]=s*l*u+o*a*c,t},zc.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},zc.setAxes=zc.sqlerp=zc.rotationTo=zc.equals=zc.exactEquals=zc.normalize=zc.sqrLen=zc.squaredLength=zc.len=zc.length=zc.lerp=zc.dot=zc.scale=zc.mul=zc.add=zc.set=zc.copy=zc.fromValues=zc.clone=void 0;var fu=Au(nc),mu=Au(xc),gu=Au(Bc),_u=Au(tu);function yu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(yu=function(t){return t?i:e})(t)}function Au(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==du(t)&&"function"!=typeof t)return{default:t};var i=yu(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}function vu(){var t=new fu.ARRAY_TYPE(4);return fu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function xu(t,e,i){i*=.5;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function bu(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+s*a+n*c-o*l,t[1]=n*u+s*l+o*a-r*c,t[2]=o*u+s*c+r*l-n*a,t[3]=s*u-r*a-n*l-o*c,t}function wu(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n),a=Math.exp(o),l=s>0?a*Math.sin(s)/s:0;return t[0]=i*l,t[1]=r*l,t[2]=n*l,t[3]=a*Math.cos(s),t}function Su(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n),a=s>0?Math.atan2(s,o)/s:0;return t[0]=i*a,t[1]=r*a,t[2]=n*a,t[3]=.5*Math.log(i*i+r*r+n*n+o*o),t}function Tu(t,e,i,r){var n,o,s,a,l,c=e[0],u=e[1],h=e[2],p=e[3],d=i[0],f=i[1],m=i[2],g=i[3];return(o=c*d+u*f+h*m+p*g)<0&&(o=-o,d=-d,f=-f,m=-m,g=-g),1-o>fu.EPSILON?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(a=1-r,l=r),t[0]=a*c+l*d,t[1]=a*u+l*f,t[2]=a*h+l*m,t[3]=a*p+l*g,t}function Cu(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*s+s]+1),t[n]=.5*i,t[3]=(e[3*o+s]-e[3*s+o])*(i=.5/i),t[o]=(e[3*o+n]+e[3*n+o])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t}zc.clone=_u.clone,zc.fromValues=_u.fromValues,zc.copy=_u.copy,zc.set=_u.set,zc.add=_u.add,zc.mul=bu;var Mu=_u.scale;zc.scale=Mu;var Eu=_u.dot;zc.dot=Eu,zc.lerp=_u.lerp;var Iu=_u.length;zc.length=Iu,zc.len=Iu;var Lu=_u.squaredLength;zc.squaredLength=Lu,zc.sqrLen=Lu;var Pu=_u.normalize;zc.normalize=Pu,zc.exactEquals=_u.exactEquals,zc.equals=_u.equals;var ku,Nu,Du,Ou=(ku=gu.create(),Nu=gu.fromValues(1,0,0),Du=gu.fromValues(0,1,0),function(t,e,i){var r=gu.dot(e,i);return r<-.999999?(gu.cross(ku,Nu,e),gu.len(ku)<1e-6&&gu.cross(ku,Du,e),gu.normalize(ku,ku),xu(t,ku,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(gu.cross(ku,e,i),t[0]=ku[0],t[1]=ku[1],t[2]=ku[2],t[3]=1+r,Pu(t,t))});zc.rotationTo=Ou;var Ru,Fu,zu=(Ru=vu(),Fu=vu(),function(t,e,i,r,n,o){return Tu(Ru,e,n,o),Tu(Fu,i,r,o),Tu(t,Ru,Fu,2*o*(1-o)),t});zc.sqlerp=zu;var Bu,Uu=(Bu=mu.create(),function(t,e,i,r){return Bu[0]=i[0],Bu[3]=i[1],Bu[6]=i[2],Bu[1]=r[0],Bu[4]=r[1],Bu[7]=r[2],Bu[2]=-e[0],Bu[5]=-e[1],Bu[8]=-e[2],Pu(t,Cu(t,Bu))});zc.setAxes=Uu;var Vu={};function ju(t){return ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ju(t)}Object.defineProperty(Vu,"__esModule",{value:!0}),Vu.create=function(){var t=new Gu.ARRAY_TYPE(8);return Gu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Vu.clone=function(t){var e=new Gu.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Vu.fromValues=function(t,e,i,r,n,o,s,a){var l=new Gu.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=i,l[3]=r,l[4]=n,l[5]=o,l[6]=s,l[7]=a,l},Vu.fromRotationTranslationValues=function(t,e,i,r,n,o,s){var a=new Gu.ARRAY_TYPE(8);a[0]=t,a[1]=e,a[2]=i,a[3]=r;var l=.5*n,c=.5*o,u=.5*s;return a[4]=l*r+c*i-u*e,a[5]=c*r+u*t-l*i,a[6]=u*r+l*e-c*t,a[7]=-l*t-c*e-u*i,a},Vu.fromRotationTranslation=Ju,Vu.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Vu.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Vu.fromMat4=function(t,e){var i=Zu.create();qu.getRotation(i,e);var r=new Gu.ARRAY_TYPE(3);return qu.getTranslation(r,e),Ju(t,i,r),t},Vu.copy=Ku,Vu.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Vu.set=function(t,e,i,r,n,o,s,a,l){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=l,t},Vu.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Vu.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Vu.getTranslation=function(t,e){var i=e[4],r=e[5],n=e[6],o=e[7],s=-e[0],a=-e[1],l=-e[2],c=e[3];return t[0]=2*(i*c+o*s+r*l-n*a),t[1]=2*(r*c+o*a+n*s-i*l),t[2]=2*(n*c+o*l+i*a-r*s),t},Vu.translate=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=.5*i[0],l=.5*i[1],c=.5*i[2],u=e[4],h=e[5],p=e[6],d=e[7];return t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=s*a+n*c-o*l+u,t[5]=s*l+o*a-r*c+h,t[6]=s*c+r*l-n*a+p,t[7]=-r*a-n*l-o*c+d,t},Vu.rotateX=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,p=l*s+u*n+c*r-a*o,d=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return Zu.rotateX(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+p*(o=t[2])-d*(n=t[1]),t[5]=p*s+f*n+d*r-h*o,t[6]=d*s+f*o+h*n-p*r,t[7]=f*s-h*r-p*n-d*o,t},Vu.rotateY=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,p=l*s+u*n+c*r-a*o,d=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return Zu.rotateY(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+p*(o=t[2])-d*(n=t[1]),t[5]=p*s+f*n+d*r-h*o,t[6]=d*s+f*o+h*n-p*r,t[7]=f*s-h*r-p*n-d*o,t},Vu.rotateZ=function(t,e,i){var r=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=a*s+u*r+l*o-c*n,p=l*s+u*n+c*r-a*o,d=c*s+u*o+a*n-l*r,f=u*s-a*r-l*n-c*o;return Zu.rotateZ(t,e,i),t[4]=h*(s=t[3])+f*(r=t[0])+p*(o=t[2])-d*(n=t[1]),t[5]=p*s+f*n+d*r-h*o,t[6]=d*s+f*o+h*n-p*r,t[7]=f*s-h*r-p*n-d*o,t},Vu.rotateByQuatAppend=function(t,e,i){var r=i[0],n=i[1],o=i[2],s=i[3],a=e[0],l=e[1],c=e[2],u=e[3];return t[0]=a*s+u*r+l*o-c*n,t[1]=l*s+u*n+c*r-a*o,t[2]=c*s+u*o+a*n-l*r,t[3]=u*s-a*r-l*n-c*o,t[4]=(a=e[4])*s+(u=e[7])*r+(l=e[5])*o-(c=e[6])*n,t[5]=l*s+u*n+c*r-a*o,t[6]=c*s+u*o+a*n-l*r,t[7]=u*s-a*r-l*n-c*o,t},Vu.rotateByQuatPrepend=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+s*a+n*c-o*l,t[1]=n*u+s*l+o*a-r*c,t[2]=o*u+s*c+r*l-n*a,t[3]=s*u-r*a-n*l-o*c,t[4]=r*(u=i[7])+s*(a=i[4])+n*(c=i[6])-o*(l=i[5]),t[5]=n*u+s*l+o*a-r*c,t[6]=o*u+s*c+r*l-n*a,t[7]=s*u-r*a-n*l-o*c,t},Vu.rotateAroundAxis=function(t,e,i,r){if(Math.abs(r)<Gu.EPSILON)return Ku(t,e);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var o=Math.sin(r),s=o*i[0]/n,a=o*i[1]/n,l=o*i[2]/n,c=Math.cos(r),u=e[0],h=e[1],p=e[2],d=e[3];t[0]=u*c+d*s+h*l-p*a,t[1]=h*c+d*a+p*s-u*l,t[2]=p*c+d*l+u*a-h*s,t[3]=d*c-u*s-h*a-p*l;var f=e[4],m=e[5],g=e[6],_=e[7];return t[4]=f*c+_*s+m*l-g*a,t[5]=m*c+_*a+g*s-f*l,t[6]=g*c+_*l+f*a-m*s,t[7]=_*c-f*s-m*a-g*l,t},Vu.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Vu.multiply=$u,Vu.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Vu.lerp=function(t,e,i,r){var n=1-r;return Yu(e,i)<0&&(r=-r),t[0]=e[0]*n+i[0]*r,t[1]=e[1]*n+i[1]*r,t[2]=e[2]*n+i[2]*r,t[3]=e[3]*n+i[3]*r,t[4]=e[4]*n+i[4]*r,t[5]=e[5]*n+i[5]*r,t[6]=e[6]*n+i[6]*r,t[7]=e[7]*n+i[7]*r,t},Vu.invert=function(t,e){var i=Qu(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Vu.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Vu.normalize=function(t,e){var i=Qu(e);if(i>0){i=Math.sqrt(i);var r=e[0]/i,n=e[1]/i,o=e[2]/i,s=e[3]/i,a=e[4],l=e[5],c=e[6],u=e[7],h=r*a+n*l+o*c+s*u;t[0]=r,t[1]=n,t[2]=o,t[3]=s,t[4]=(a-r*h)/i,t[5]=(l-n*h)/i,t[6]=(c-o*h)/i,t[7]=(u-s*h)/i}return t},Vu.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Vu.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Vu.equals=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=e[0],h=e[1],p=e[2],d=e[3],f=e[4],m=e[5],g=e[6],_=e[7];return Math.abs(i-u)<=Gu.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-h)<=Gu.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-p)<=Gu.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-d)<=Gu.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-f)<=Gu.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=Gu.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-g)<=Gu.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=Gu.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Vu.sqrLen=Vu.squaredLength=Vu.len=Vu.length=Vu.dot=Vu.mul=Vu.setReal=Vu.getReal=void 0;var Gu=Hu(nc),Zu=Hu(zc),qu=Hu(Mc);function Wu(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Wu=function(t){return t?i:e})(t)}function Hu(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==ju(t)&&"function"!=typeof t)return{default:t};var i=Wu(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}function Ju(t,e,i){var r=.5*i[0],n=.5*i[1],o=.5*i[2],s=e[0],a=e[1],l=e[2],c=e[3];return t[0]=s,t[1]=a,t[2]=l,t[3]=c,t[4]=r*c+n*l-o*a,t[5]=n*c+o*s-r*l,t[6]=o*c+r*a-n*s,t[7]=-r*s-n*a-o*l,t}function Ku(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function $u(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=i[4],l=i[5],c=i[6],u=i[7],h=e[4],p=e[5],d=e[6],f=e[7],m=i[0],g=i[1],_=i[2],y=i[3];return t[0]=r*y+s*m+n*_-o*g,t[1]=n*y+s*g+o*m-r*_,t[2]=o*y+s*_+r*g-n*m,t[3]=s*y-r*m-n*g-o*_,t[4]=r*u+s*a+n*c-o*l+h*y+f*m+p*_-d*g,t[5]=n*u+s*l+o*a-r*c+p*y+f*g+d*m-h*_,t[6]=o*u+s*c+r*l-n*a+d*y+f*_+h*g-p*m,t[7]=s*u-r*a-n*l-o*c+f*y-h*m-p*g-d*_,t}Vu.getReal=Zu.copy,Vu.setReal=Zu.copy,Vu.mul=$u;var Yu=Zu.dot;Vu.dot=Yu;var Xu=Zu.length;Vu.length=Xu,Vu.len=Xu;var Qu=Zu.squaredLength;Vu.squaredLength=Qu,Vu.sqrLen=Qu;var th={};function eh(t){return eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eh(t)}Object.defineProperty(th,"__esModule",{value:!0}),th.create=nh,th.clone=function(t){var e=new ih.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},th.fromValues=function(t,e){var i=new ih.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},th.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},th.set=function(t,e,i){return t[0]=e,t[1]=i,t},th.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},th.subtract=oh,th.multiply=sh,th.divide=ah,th.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},th.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},th.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},th.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},th.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},th.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},th.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},th.distance=lh,th.squaredDistance=ch,th.length=uh,th.squaredLength=hh,th.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},th.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},th.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},th.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},th.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},th.lerp=function(t,e,i,r){var n=e[0],o=e[1];return t[0]=n+r*(i[0]-n),t[1]=o+r*(i[1]-o),t},th.random=function(t,e){e=e||1;var i=2*ih.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},th.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},th.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},th.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},th.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},th.rotate=function(t,e,i,r){var n=e[0]-i[0],o=e[1]-i[1],s=Math.sin(r),a=Math.cos(r);return t[0]=n*a-o*s+i[0],t[1]=n*s+o*a+i[1],t},th.angle=function(t,e){var i=t[0],r=t[1],n=e[0],o=e[1],s=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+o*o);return Math.acos(Math.min(Math.max(s&&(i*n+r*o)/s,-1),1))},th.zero=function(t){return t[0]=0,t[1]=0,t},th.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},th.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},th.equals=function(t,e){var i=t[0],r=t[1],n=e[0],o=e[1];return Math.abs(i-n)<=ih.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=ih.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))},th.forEach=th.sqrLen=th.sqrDist=th.dist=th.div=th.mul=th.sub=th.len=void 0;var ih=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==eh(t)&&"function"!=typeof t)return{default:t};var i=rh(void 0);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}(nc);function rh(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(rh=function(t){return t?i:e})(t)}function nh(){var t=new ih.ARRAY_TYPE(2);return ih.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function oh(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function sh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function ah(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function lh(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function ch(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function uh(t){return Math.hypot(t[0],t[1])}function hh(t){var e=t[0],i=t[1];return e*e+i*i}th.len=uh,th.sub=oh,th.mul=sh,th.div=ah,th.dist=lh,th.sqrDist=ch,th.sqrLen=hh;var ph=function(){var t=nh();return function(e,i,r,n,o,s){var a,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,e.length):e.length,a=r;a<l;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}();function dh(t){return dh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dh(t)}th.forEach=ph,Object.defineProperty(rc,"__esModule",{value:!0}),t.a7=rc.vec4=t.N=rc.vec3=rc.vec2=rc.quat2=t.bi=rc.quat=t.a6=rc.mat4=t.co=rc.mat3=rc.mat2d=t.b4=rc.mat2=rc.glMatrix=void 0;var fh=Th(nc);rc.glMatrix=fh;var mh=Th(cc);t.b4=rc.mat2=mh;var gh=Th(mc);rc.mat2d=gh;var _h=Th(xc);t.co=rc.mat3=_h;var yh=Th(Mc);t.a6=rc.mat4=yh;var Ah=Th(zc);t.bi=rc.quat=Ah;var vh=Th(Vu);rc.quat2=vh;var xh=Th(th);rc.vec2=xh;var bh=Th(Bc);t.N=rc.vec3=bh;var wh=Th(tu);function Sh(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Sh=function(t){return t?i:e})(t)}function Th(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==dh(t)&&"function"!=typeof t)return{default:t};var i=Sh(e);if(i&&i.has(t))return i.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=t[o]}return r.default=t,i&&i.set(t,r),r}t.a7=rc.vec4=wh;class Ch{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,i,r){const n=t.N.dot(i,this.dir);if(Math.abs(n)<1e-6)return!1;const o=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*o,r[1]=this.pos[1]+this.dir[1]*o,r[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(e,i,r){if(t.N.equals(this.pos,e)||0===i)return r[0]=r[1]=r[2]=0,!1;const[n,o,s]=this.dir,a=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=n*n+o*o+s*s,h=2*(a*n+l*o+c*s),p=h*h-4*u*(a*a+l*l+c*c-i*i);if(p<0){const t=Math.max(-h/2,0),e=a+n*t,u=l+o*t,p=c+s*t,d=Math.hypot(e,u,p);return r[0]=e*i/d,r[1]=u*i/d,r[2]=p*i/d,!1}{const t=(-h-Math.sqrt(p))/(2*u);if(t<0){const t=Math.hypot(a,l,c);return r[0]=a*i/t,r[1]=l*i/t,r[2]=c*i/t,!1}return r[0]=a+n*t,r[1]=l+o*t,r[2]=c+s*t,!0}}}class Mh{constructor(t,e,i,r,n){this.TL=t,this.TR=e,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(e,i,r){const n=[-1,1,1],o=[1,1,1],s=[1,-1,1],a=[-1,-1,1],l=t.N.transformMat4(n,n,e),c=t.N.transformMat4(o,o,e),u=t.N.transformMat4(s,s,e),h=t.N.transformMat4(a,a,e);return new Mh(l,c,u,h,i/r)}}function Eh(e,i,r){let n=1/0,o=-1/0;const s=[];for(const a of e){t.N.sub(s,a,i);const e=t.N.dot(s,r);n=Math.min(n,e),o=Math.max(o,e)}return[n,o]}function Ih(e,i){let r=!0;for(let n=0;n<e.planes.length;n++){const o=e.planes[n];let s=0;for(let e=0;e<i.length;e++)s+=t.N.dot(o,i[e])+o[3]>=0;if(0===s)return 0;s!==i.length&&(r=!1)}return r?2:1}function Lh(t,e){for(const i of t.projections){const r=Eh(e,t.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function Ph(e,i){let r=0;const n=[0,0,0,0];for(let o=0;o<e.length;o++)n[0]=e[o][0],n[1]=e[o][1],n[2]=e[o][2],n[3]=1,t.a7.dot(n,i)>=0&&r++;return r}class kh{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Nh.fromPoints(this.points),this.projections=[],this.frustumEdges=[t.N.sub([],this.points[2],this.points[3]),t.N.sub([],this.points[0],this.points[3]),t.N.sub([],this.points[4],this.points[0]),t.N.sub([],this.points[5],this.points[1]),t.N.sub([],this.points[6],this.points[2]),t.N.sub([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],i=[t[2],0,-t[0]];this.projections.push({axis:e,projection:Eh(this.points,this.points[0],e)}),this.projections.push({axis:i,projection:Eh(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(e,i,r,n){const o=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const s=t.a7.transformMat4([],r,e),a=1/s[3]/i*o;return t.a7.mul(s,s,[a,a,n?1/s[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const i=t.N.sub([],s[e[0]],s[e[1]]),r=t.N.sub([],s[e[2]],s[e[1]]),n=t.N.normalize([],t.N.cross([],i,r)),o=-t.N.dot(n,s[e[1]]);return n.concat(o)})),l=[];for(let t=0;t<s.length;t++)l.push([s[t][0],s[t][1],s[t][2]]);return new kh(l,a)}intersectsPrecise(e,i,r){for(let t=0;t<i.length;t++)if(!Ph(e,i[t]))return 0;for(let t=0;t<this.planes.length;t++)if(!Ph(e,this.planes[t]))return 0;for(const i of r)for(const r of this.frustumEdges){const n=t.N.cross([],i,r),o=t.N.length(n);if(0===o)continue;t.N.scale(n,n,1/o);const s=Eh(this.points,this.points[0],n),a=Eh(e,this.points[0],n);if(s[0]>a[1]||a[0]>s[1])return 0}return 1}}class Nh{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)t.N.min(i,i,n),t.N.max(r,r,n);return new Nh(i,r)}static fromTileIdAndHeight(t,e,i){const r=1<<t.canonical.z,n=t.canonical.x,o=t.canonical.y;return new Nh([n/r,o/r,e],[(n+1)/r,(o+1)/r,i])}static applyTransform(e,i){const r=e.getCorners();for(let e=0;e<r.length;++e)t.N.transformMat4(r[e],r[e],i);return Nh.fromPoints(r)}static projectAabbCorners(e,i){const r=e.getCorners();for(let e=0;e<r.length;++e)t.N.transformMat4(r[e],r[e],i);return r}constructor(e,i){this.min=e,this.max=i,this.center=t.N.scale([],t.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=t.N.clone(this.min),n=t.N.clone(this.max);for(let t=0;t<i.length;t++)r[t]=i[t]?this.min[t]:this.center[t],n[t]=i[t]?this.center[t]:this.max[t];return n[2]=this.max[2],new Nh(r,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ih(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ih(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?Lh(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?Lh(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}ro(Nh,"Aabb");const Dh=ps([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Oh}=Dh,Rh=ps([{name:"a_pos_3",components:3,type:"Int16"}]);var Fh=ps([{name:"a_pos",type:"Int16",components:2}]);function zh(t){return t*Ga/Qa}const Bh=[new Nh([Ka,Ka,Ka],[$a,$a,$a]),new Nh([Ka,Ka,Ka],[0,0,$a]),new Nh([0,Ka,Ka],[$a,0,$a]),new Nh([Ka,0,Ka],[0,$a,$a]),new Nh([0,0,Ka],[$a,$a,$a])];function Uh(e,i,r,n=!0){const o=t.N.scale([],e._camera.position,e.worldSize),s=[i,r,1,1];t.a7.transformMat4(s,s,e.pixelMatrixInverse),t.a7.scale(s,s,1/s[3]);const a=t.N.sub([],s,o),l=t.N.normalize([],a),c=e.globeMatrix,u=[c[12],c[13],c[14]],h=t.N.sub([],u,o),p=t.N.length(h),d=t.N.normalize([],h),f=e.worldSize/(2*Math.PI),m=t.N.dot(d,l),g=Math.asin(f/p);if(g<Math.acos(m)){if(!n)return null;const e=[],i=[];t.N.scale(e,l,p/m),t.N.normalize(i,t.N.sub(i,e,h)),t.N.normalize(l,t.N.add(l,h,t.N.scale(l,i,Math.tan(g)*p)))}const _=[];new Ch(o,l).closestPointOnSphere(u,f,_);const y=t.N.normalize([],rt(c,0)),A=t.N.normalize([],rt(c,1)),v=t.N.normalize([],rt(c,2)),x=t.N.dot(y,_),w=t.N.dot(A,_),S=t.N.dot(v,_),T=b(Math.asin(-w/f));let C=b(Math.atan2(x,S));C=e.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(e.center.lng,C);const E=dl(C),I=M(fl(T),0,1);return new Sl(E,I)}class Vh{constructor(e,i,r){this.a=t.N.sub([],e,r),this.b=t.N.sub([],i,r),this.center=r;const n=t.N.normalize([],this.a),o=t.N.normalize([],this.b);this.angle=Math.acos(t.N.dot(n,o))}}function jh(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,r){const n=Math.sin(i);return t*(Math.sin((1-r)*i)/n)+e*(Math.sin(r*i)/n)}(t.a[e],t.b[e],t.angle,M(i,0,1))+t.center[e]}function Gh(t){if(t.z<=1)return Bh[t.z+2*t.y+t.x];const e=Jh(Hh(t));return Nh.fromPoints(e)}function Zh(e,i,r){return t.N.scale(e,e,1-r),t.N.scaleAndAdd(e,e,i,r)}function qh(e,i,r){for(const n of e)t.N.transformMat4(n,n,i),t.N.scale(n,n,r)}function Wh(e,i,r,n){const o=i/e.worldSize,s=e.globeMatrix;if(r.z<=1){const t=Gh(r).getCorners();return qh(t,s,o),Nh.fromPoints(t)}const a=Hh(r,n),l=Jh(a,Ga+zh(e._tileCoverLift));qh(l,s,o);const c=Number.MAX_VALUE,u=[-c,-c,-c],h=[c,c,c];if(a.contains(e.center)){for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);u[2]=0;const i=e.point,r=[i.x*o,i.y*o,0];return t.N.min(h,h,r),t.N.max(u,u,r),new Nh(h,u)}if(e._tileCoverLift>0){for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);return new Nh(h,u)}const p=[s[12]*o,s[13]*o,s[14]*o],d=a.getCenter(),f=M(e.center.lat,-Al,Al),m=M(d.lat,-Al,Al),g=dl(e.center.lng),_=fl(f);let y=g-dl(d.lng);const A=_-fl(m);y>.5?y-=1:y<-.5&&(y+=1);let v=0;if(Math.abs(y)>Math.abs(A))v=y>=0?1:3;else{v=A>=0?0:2;const e=[s[4]*o,s[5]*o,s[6]*o],i=-Math.sin(x(A>=0?a.getSouth():a.getNorth()))*Ga;t.N.scaleAndAdd(p,p,e,i)}const b=l[v],w=l[(v+1)%4],S=new Vh(b,w,p),T=[jh(S,0)||b[0],jh(S,1)||b[1],jh(S,2)||b[2]],C=rp(e.zoom);if(C>0){const n=function({x:t,y:e,z:i},r,n,o,s){const a=1/(1<<i);let l=t*a,c=l+a,u=e*a,h=u+a,p=0;const d=(l+c)/2-o;return d>.5?p=-1:d<-.5&&(p=1),l=((l+p)*r-(o*=r))*n+o,c=((c+p)*r-o)*n+o,u=(u*r-(s*=r))*n+s,h=(h*r-s)*n+s,[[l,h,0],[c,h,0],[c,u,0],[l,u,0]]}(r,i,e._pixelsPerMercatorPixel,g,_);for(let t=0;t<l.length;t++)Zh(l[t],n[t],C);const o=t.N.add([],n[v],n[(v+1)%4]);t.N.scale(o,o,.5),Zh(T,o,C)}for(const e of l)t.N.min(h,h,e),t.N.max(u,u,e);return h[2]=Math.min(b[2],w[2]),t.N.min(h,h,T),t.N.max(u,u,T),new Nh(h,u)}function Hh({x:t,y:e,z:i},r=!1){const n=1/(1<<i),o=new el(gl(t*n),e===(1<<i)-1&&r?-90:_l((e+1)*n)),s=new el(gl((t+1)*n),0===e&&r?90:_l(e*n));return new il(o,s)}function Jh(t,e=Ga){const i=x(t.getNorth()),r=x(t.getSouth()),n=Math.cos(i),o=Math.cos(r),s=Math.sin(i),a=Math.sin(r),l=t.getWest(),c=t.getEast();return[Ya(o,a,l,e),Ya(o,a,c,e),Ya(n,s,c,e),Ya(n,s,l,e)]}function Kh(t,e,i,r){const n=1<<i.z,o=(t/ki+i.x)/n;return Xa(_l((e/ki+i.y)/n),gl(o),r)}function $h({min:t,max:e}){return Wa/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Yh=new Float64Array(16);function Xh(e){const i=$h(e),r=t.a6.fromScaling(Yh,[i,i,i]);return t.a6.translate(r,r,t.N.negate([],e.min))}function Qh(e){const i=t.a6.fromTranslation(Yh,e.min),r=1/$h(e);return t.a6.scale(i,i,[r,r,r])}function tp(t){const e=ki/(2*Math.PI);return t/(2*Math.PI)/e}function ep(t,e){return ki/(512*Math.pow(2,t))*$h(Gh(e))}function ip(e,i,r,n,o){const s=tp(r),a=[e,i,-r/(2*Math.PI)],l=t.a6.identity(new Float64Array(16));return t.a6.translate(l,l,a),t.a6.scale(l,l,[s,s,s]),t.a6.rotateX(l,l,x(-o)),t.a6.rotateY(l,l,x(-n)),l}function rp(t){return E(Za,qa,t)}function np(e,i){const r=Xa(i.lat,i.lng),n=function(e){const i=Xa(e._center.lat,e._center.lng),r=t.N.fromValues(0,1,0);let n=t.N.cross([],r,i);const o=t.a6.fromRotation([],-e.angle,i);n=t.N.transformMat4(n,n,o),t.a6.fromRotation(o,-e._pitch,n);const s=t.N.normalize([],i);return t.N.scale(s,s,zh(e.cameraToCenterDistance/e.pixelsPerMeter)),t.N.transformMat4(s,s,o),t.N.add([],i,s)}(e),o=t.N.subtract([],n,r);return t.N.angle(o,r)}function op(t,e){return np(t,e)>Math.PI/2*1.01}const sp=x(85),ap=Math.cos(sp),lp=Math.sin(sp),cp=t.a6.create(),up=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function hp(e,i,r,n,o,s,a,l,c){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(c*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,h=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const p of i)for(const i of p){const p=i.add(l),d=o&&r.elevation?r.elevation.exaggeration()*o.getElevationAt(p.x,p.y,!0):0,f=r.projection.projectTilePoint(p.x,p.y,u);if(d>0){const t=r.projection.upVector(u,p.x,p.y);f.x+=t[0]*h*d,f.y+=t[1]*h*d,f.z+=t[2]*h*d}const m=s?p:pp(f.x,f.y,f.z,n),g=s?e.tilespaceRays.map((t=>mp(t,d))):e.queryGeometry.screenGeometry,_=t.a7.transformMat4([],[f.x,f.y,f.z,1],n);if(!a&&s?c*=_[3]/r.cameraToCenterDistance:a&&!s&&(c*=r.cameraToCenterDistance/_[3]),s){const t=_l((i.y/ki+u.y)/(1<<u.z));c/=r.projection.pixelsPerMeter(t,1)/ml(1,t)}if(zl(g,m,c))return!0}return!1}function pp(e,i,r,n){const o=t.a7.transformMat4([],[e,i,r,1],n);return new y(o[0]/o[3],o[1]/o[3])}const dp=t.N.fromValues(0,0,0),fp=t.N.fromValues(0,0,1);function mp(e,i){const r=t.N.create();return dp[2]=i,e.intersectsPlane(dp,fp,r),new y(r[0],r[1])}class gp extends Rl{}function _p(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function yp(t,e,i){const{width:r,height:n}=e;r===t.width&&n===t.height||(Ap(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,n)},i),t.width=r,t.height=n,t.data=e.data)}function Ap(t,e,i,r,n,o,s){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,l=e.data,c=4===o&&s;for(let s=0;s<n.height;s++){const u=((i.y+s)*t.width+i.x)*o,h=((r.y+s)*e.width+r.x)*o;if(c)for(let t=0;t<n.width;t++){const e=u+t*o+3,i=h+t*o;l[i+0]=255,l[i+1]=255,l[i+2]=255,l[i+3]=a[e]}else for(let t=0;t<n.width*o;t++)l[h+t]=a[u+t]}return e}ro(gp,"HeatmapBucket",{omit:["layers"]});class vp{constructor(t,e){_p(this,t,1,e)}resize(t){yp(this,new vp(t),1)}clone(){return new vp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){Ap(t,e,i,r,n,1)}}class xp{constructor(t,e){_p(this,t,4,e)}resize(t){yp(this,new xp(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new xp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n,o){Ap(t,e,i,r,n,4,o)}}class bp{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}ro(vp,"AlphaImage"),ro(xp,"RGBAImage");const wp=new jo({visibility:new Bo(qo.layout_heatmap.visibility)});var Sp={paint:new jo({"heatmap-radius":new Uo(qo.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Uo(qo.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bo(qo.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vo(qo.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bo(qo.paint_heatmap["heatmap-opacity"])}),layout:wp};function Tp(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new xp({width:i,height:r}),o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);s&&(n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a))};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}const Cp=new jo({visibility:new Bo(qo.layout_hillshade.visibility)});var Mp={paint:new jo({"hillshade-illumination-direction":new Bo(qo.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bo(qo.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bo(qo.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bo(qo.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bo(qo.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bo(qo.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Bo(qo.paint_hillshade["hillshade-emissive-strength"])}),layout:Cp};const Ep=ps([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ip}=Ep;var Lp={exports:{}};function Pp(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,p=kp(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=kp(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(Gp(s));for(a.sort(Bp),n=0;n<a.length;n++)i=Up(a[n],i);return i}(t,e,p,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?32767/c:0}return Dp(p,d,i,r,n,c,0),d}function kp(t,e,i,r,n){var o,s;if(n===id(t,e,i,r)>0)for(o=e;o<i;o+=r)s=Qp(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=Qp(o,t[o],t[o+1],s);return s&&Hp(s,s.next)&&(td(s),s=s.next),s}function Np(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!Hp(r,r.next)&&0!==Wp(r.prev,r,r.next))r=r.next;else{if(td(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Dp(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=jp(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?Rp(t,r,n,o):Op(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),td(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Dp(t=Fp(Np(t),e,i),e,i,r,n,o,2):2===s&&zp(t,e,i,r,n,o):Dp(Np(t),e,i,r,n,o,1);break}}}function Op(t){var e=t.prev,i=t,r=t.next;if(Wp(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,p=n>o?n>s?n:s:o>s?o:s,d=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=p&&f.y>=h&&f.y<=d&&Zp(n,a,o,l,s,c,f.x,f.y)&&Wp(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Rp(t,e,i,r){var n=t.prev,o=t,s=t.next;if(Wp(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,p=s.y,d=a<l?a<c?a:c:l<c?l:c,f=u<h?u<p?u:p:h<p?h:p,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>p?u:p:h>p?h:p,_=jp(d,f,e,i,r),y=jp(m,g,e,i,r),A=t.prevZ,v=t.nextZ;A&&A.z>=_&&v&&v.z<=y;){if(A.x>=d&&A.x<=m&&A.y>=f&&A.y<=g&&A!==n&&A!==s&&Zp(a,u,l,h,c,p,A.x,A.y)&&Wp(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Zp(a,u,l,h,c,p,v.x,v.y)&&Wp(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;A&&A.z>=_;){if(A.x>=d&&A.x<=m&&A.y>=f&&A.y<=g&&A!==n&&A!==s&&Zp(a,u,l,h,c,p,A.x,A.y)&&Wp(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Zp(a,u,l,h,c,p,v.x,v.y)&&Wp(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Fp(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!Hp(n,o)&&Jp(n,r,r.next,o)&&Yp(n,o)&&Yp(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),td(r),td(r.next),r=t=o),r=r.next}while(r!==t);return Np(r)}function zp(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&qp(s,a)){var l=Xp(s,a);return s=Np(s,s.next),l=Np(l,l.next),Dp(s,e,i,r,n,o,0),void Dp(l,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function Bp(t,e){return t.x-e.x}function Up(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&Zp(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),Yp(r,t)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&Vp(i,r)))&&(i=r,p=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=Xp(i,t);return Np(r,r.next),Np(i,i.next)}function Vp(t,e){return Wp(t.prev,t,e.prev)<0&&Wp(e.next,t,t.next)<0}function jp(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Gp(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Zp(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function qp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Jp(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Yp(t,e)&&Yp(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(Wp(t.prev,t,e.prev)||Wp(t,e.prev,e))||Hp(t,e)&&Wp(t.prev,t,t.next)>0&&Wp(e.prev,e,e.next)>0)}function Wp(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Hp(t,e){return t.x===e.x&&t.y===e.y}function Jp(t,e,i,r){var n=$p(Wp(t,e,i)),o=$p(Wp(t,e,r)),s=$p(Wp(i,r,t)),a=$p(Wp(i,r,e));return n!==o&&s!==a||!(0!==n||!Kp(t,i,e))||!(0!==o||!Kp(t,r,e))||!(0!==s||!Kp(i,t,r))||!(0!==a||!Kp(i,e,r))}function Kp(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function $p(t){return t>0?1:t<0?-1:0}function Yp(t,e){return Wp(t.prev,t,t.next)<0?Wp(t,e,t.next)>=0&&Wp(t,t.prev,e)>=0:Wp(t,e,t.prev)<0||Wp(t,t.next,e)<0}function Xp(t,e){var i=new ed(t.i,t.x,t.y),r=new ed(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Qp(t,e,i,r){var n=new ed(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function td(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ed(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function id(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Lp.exports=Pp,Lp.exports.default=Pp,Pp.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(id(t,0,n?e[0]*i:t.length,i));if(n)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(id(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Pp.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var rd=p(Lp.exports);function nd(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=q(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}if(n&&r.push(n),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(ai(r[t],e,1,r[t].length-1,od),r[t]=r[t].slice(0,e));return r}function od(t,e){return e.area-t.area}function sd(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o]=!0)}return n}function ad(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r},i,{},n.availableImages);t=t&&t.name?t.name:t,o[t]=!0,i.patterns[s.id]=t}}return i}class ld{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fs,this.indexArray=new Ps,this.indexArray2=new Cs,this.programConfigurations=new Fa(t.layers,t.zoom),this.segments=new ra,this.segments2=new ra,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}populate(t,e,i,r){this.hasPattern=sd("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Nl(s,t);if(!this.layers[0]._featureFilter.filter(new Lo(this.zoom),u,i))continue;const h=n?n.evaluate(u,{},i,e.availableImages):void 0,p={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:kl(s,i,r),patterns:{},sortKey:h};o.push(p)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=ad("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{},e.availableImages,e.brightness);e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(t,e,i,r,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ip),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n,o=[],s){for(const t of nd(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=rd(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,s)}}ro(ld,"FillBucket",{omit:["layers","patternFeatures"]});const cd=new jo({"fill-sort-key":new Uo(qo.layout_fill["fill-sort-key"]),visibility:new Bo(qo.layout_fill.visibility)});var ud={paint:new jo({"fill-antialias":new Bo(qo.paint_fill["fill-antialias"]),"fill-opacity":new Uo(qo.paint_fill["fill-opacity"]),"fill-color":new Uo(qo.paint_fill["fill-color"]),"fill-outline-color":new Uo(qo.paint_fill["fill-outline-color"]),"fill-translate":new Bo(qo.paint_fill["fill-translate"]),"fill-translate-anchor":new Bo(qo.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uo(qo.paint_fill["fill-pattern"]),"fill-emissive-strength":new Bo(qo.paint_fill["fill-emissive-strength"])}),layout:cd};const hd=ps([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pd=ps([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),dd=ps([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fd=ps([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),md=ps([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gd}=hd;var _d={},yd=g,Ad=vd;function vd(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(xd,this,e)}function xd(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function bd(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}vd.types=["Unknown","Point","LineString","Polygon"],vd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new yd(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},vd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},vd.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=vd.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=bd(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var wd=Ad,Sd=Td;function Td(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Cd,this,e),this.length=this._features.length}function Cd(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}Td.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new wd(this._pbf,e,this.extent,this._keys,this._values)};var Md=Sd;function Ed(t,e,i){if(3===t){var r=new Md(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Id=_d.VectorTile=function(t,e){this.layers=t.readFields(Ed,{},e)},Ld=_d.VectorTileFeature=Ad;function Pd(t,e,i,r){const n=[],o=0===r?(t,e,i,r,n,o)=>{t.push(new y(o,i+(o-e)/(r-e)*(n-i)))}:(t,e,i,r,n,o)=>{t.push(new y(e+(o-i)/(n-i)*(r-e),o))};for(const s of t){const t=[];for(const n of s){if(n.length<=2)continue;const s=[];for(let t=0;t<n.length-1;t++){const a=n[t].x,l=n[t].y,c=n[t+1].x,u=n[t+1].y,h=0===r?a:l,p=0===r?c:u;h<e?p>e&&o(s,a,l,c,u,e):h>i?p<i&&o(s,a,l,c,u,i):s.push(n[t]),p<e&&h>=e&&o(s,a,l,c,u,e),p>i&&h<=i&&o(s,a,l,c,u,i)}let a=n[n.length-1];const l=0===r?a.x:a.y;l>=e&&l<=i&&s.push(a),s.length&&(a=s[s.length-1],s[0].x===a.x&&s[0].y===a.y||s.push(s[0]),t.push(s))}t.length&&n.push(t)}return n}function kd(t,e){return t.x-e.x||t.y-e.y}function Nd(t,e){return 0===kd(t.min,e.min)&&0===kd(t.max,e.max)}function Dd(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Od(t,e,i){const r=1/ki,n=1/(1<<i.canonical.z),o=(e.x*r+i.canonical.x)*n+i.wrap,s=(e.y*r+i.canonical.y)*n;return{min:new y((t.x*r+i.canonical.x)*n+i.wrap,(t.y*r+i.canonical.y)*n),max:new y(o,s)}}function Rd(t,e,i){const r=1<<i.canonical.z,n=((e.x-i.wrap)*r-i.canonical.x)*ki,o=(e.y*r-i.canonical.y)*ki;return{min:new y(((t.x-i.wrap)*r-i.canonical.x)*ki,(t.y*r-i.canonical.y)*ki),max:new y(n,o)}}function Fd(t,e,i,r,n,o,s){const a=t.indices,l=t.vertices,c=[];for(let u=r;u<r+n;u+=3){const r=e[i[u+0]+o],n=e[i[u+1]+o],h=e[i[u+2]+o],p=Math.min(r.x,n.x,h.x),d=Math.max(r.x,n.x,h.x),f=Math.min(r.y,n.y,h.y),m=Math.max(r.y,n.y,h.y);c.length=0,t.grid.query(new y(p,f),new y(d,m),c);for(let t=0;t<c.length;t++){const e=c[t];if($l(l[a[3*e+0]],l[a[3*e+1]],l[a[3*e+2]],r,n,h,s))return!0}}return!1}function zd(t,e,i,r){if(!t||!i)return!1;let n=t.vertices;if(!e.canonical.equals(r.canonical)||e.wrap!==r.wrap){if(i.vertices.length<t.vertices.length)return zd(i,r,t,e);const o=e.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);n=t.vertices.map((t=>new y(t.x*o.x*ki*a-s.x*ki,t.y*o.y*ki*a-s.y*ki)))}return Fd(i,n,t.indices,0,t.indices.length,0,0)}_d.VectorTileLayer=Sd;class Bd{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Ud(t,e,i,r){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/r[s];let l=(t[s]-i[s])*a,c=(e[s]-i[s])*a;if(l>c){const t=l;l=c,c=t}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function Vd(t,e,i,r,n,o,s,a,l,c,u){const h=r-t,p=n-e,d=o-i,f=s-t,m=a-e,g=l-i,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,A=u[0]*m-u[1]*f,v=h*_+p*y+d*A;if(Math.abs(v)<1e-15)return null;const x=1/v,b=c[0]-t,w=c[1]-e,S=c[2]-i,T=(b*_+w*y+S*A)*x;if(T<0||T>1)return null;const C=w*d-S*p,M=S*h-b*d,E=b*p-w*h,I=(u[0]*C+u[1]*M+u[2]*E)*x;return I<0||T+I>1?null:(f*C+m*M+g*E)*x}function jd(t,e,i){return(t-e)/(i-e)}function Gd(t,e,i,r,n,o,s,a,l){const c=1<<i,u=o-r,h=s-n,p=(t+1)/c*u+r,d=(e+0)/c*h+n,f=(e+1)/c*h+n;a[0]=(t+0)/c*u+r,a[1]=d,l[0]=p,l[1]=f}class Zd{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let r=Math.ceil(Math.pow(2,e));const n=1/r,o=(t,e,i,r,n)=>{const o=r?1:0,s=(t+1)*i-o,a=e*i,l=(e+1)*i-o;n[0]=t*i,n[1]=a,n[2]=s,n[3]=l};let s=new Bd(r);const a=[];for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),n,!1,a);const i=Wd(a[0],a[1],t),l=Wd(a[2],a[1],t),c=Wd(a[2],a[3],t),u=Wd(a[0],a[3],t);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),r/=2;r>=1;r/=2){const t=i[i.length-1];s=new Bd(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,a);const i=t.getElevation(a[0],a[1]),n=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),p=t.isLeaf(a[2],a[3]),d=t.isLeaf(a[0],a[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=u&&h&&p&&d;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,r=e[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,r,n,o,s=1){return Ud([t,e,-100],[i,r,this.maximums[0]*s],n,o)}raycast(e,i,r,n,o,s,a=1){if(!this.nodeCount)return null;const l=this.raycastRoot(e,i,r,n,o,s,a);if(null==l)return null;const c=[],u=[],h=[],p=[],d=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:l,t:f,nodex:m,nodey:g,depth:_}=d.pop();if(this.leaves[l]){Gd(m,g,_,e,i,r,n,h,p);const l=1<<_,c=(m+0)/l,u=(m+1)/l,d=(g+0)/l,y=(g+1)/l,A=Wd(c,d,this.dem)*a,v=Wd(u,d,this.dem)*a,x=Wd(u,y,this.dem)*a,b=Wd(c,y,this.dem)*a,w=Vd(h[0],h[1],A,p[0],h[1],v,p[0],p[1],x,o,s),S=Vd(p[0],p[1],x,h[0],p[1],b,h[0],h[1],A,o,s),T=Math.min(null!==w?w:Number.MAX_VALUE,null!==S?S:Number.MAX_VALUE);if(T!==Number.MAX_VALUE)return T;{const e=t.N.scaleAndAdd([],o,s,f);if(qd(A,v,b,x,jd(e[0],h[0],p[0]),jd(e[1],h[1],p[1]))>=e[2])return f}continue}let y=0;for(let t=0;t<this._siblingOffset.length;t++){Gd((m<<1)+this._siblingOffset[t][0],(g<<1)+this._siblingOffset[t][1],_+1,e,i,r,n,h,p),h[2]=-100,p[2]=this.maximums[this.childOffsets[l]+t]*a;const d=Ud(h,p,o,s);if(null!=d){const e=d;c[t]=e;let i=!1;for(let r=0;r<y&&!i;r++)e>=c[u[r]]&&(u.splice(r,0,t),i=!0);i||(u[y]=t),y++}}for(let t=0;t<y;t++){const e=u[t];d.push({idx:this.childOffsets[l]+e,t:c[e],nodex:(m<<1)+this._siblingOffset[e][0],nodey:(g<<1)+this._siblingOffset[e][1],depth:_+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,r,n){if(1===t[r].isLeaf(e,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=r-1,s=t[o];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const r=2*e+this._siblingOffset[t][0],n=2*i+this._siblingOffset[t][1],o=s.getElevation(r,n),c=s.isLeaf(r,n),u=this._addNode(o.min,o.max,c);c&&(a|=1<<t),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(t,2*e+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],o,l+r)}}function qd(t,e,i,r,n,o){return ue(ue(t,i,o),ue(e,r,o),n)}function Wd(t,e,i){const r=i.dim,n=M(t*r-.5,0,r-1),o=M(e*r-.5,0,r-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return qd(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),n-s,o-a)}const Hd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Jd(t,e,i){return(256*t*256+256*e+i)/10-1e4}function Kd(t,e,i){return 256*t+e+i/256-32768}class $d{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return G(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const n=this.dim=e.height-2,o=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let t=0;t<n;t++)o[this._idx(-1,t)]=o[this._idx(0,t)],o[this._idx(n,t)]=o[this._idx(n-1,t)],o[this._idx(t,-1)]=o[this._idx(t,0)],o[this._idx(t,n)]=o[this._idx(t,n-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(n,-1)]=o[this._idx(n-1,0)],o[this._idx(-1,n)]=o[this._idx(0,n-1)],o[this._idx(n,n)]=o[this._idx(n-1,n-1)]}const s="terrarium"===i?Kd:Jd;for(let t=0;t<o.length;++t){const e=4*t;this.floatView[t]=s(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=at.now()}_buildQuadTree(){this._tree=new Zd(this)}get(t,e,i=!1){i&&(t=M(t,-1,this.dim),e=M(e,-1,this.dim));const r=this._idx(t,e);return this.floatView[r]}set(t,e,i){const r=this._idx(t,e),n=this.floatView[r];return this.floatView[r]=i,i-n}static getUnpackVector(t){return Hd[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],r=$d.getUnpackVector(e);let n=Math.floor((t+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new bp({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++){const r=4*this._idx(i,e),n=4*this._idx(i+a,e+l);this.pixels[r+0]=t.pixels[n+0],this.pixels[r+1]=t.pixels[n+1],this.pixels[r+2]=t.pixels[n+2],this.pixels[r+3]=t.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ro($d,"DEMData"),ro(Zd,"DemMinMaxQuadTree",{omit:["dem"]});class Yd{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const r=i||t.findDEMTileFor(e);if(!r||!r.dem)return;const n=r.dem,o=r.tileID,s=1<<e.canonical.z-o.canonical.z;return new Yd(r,n.dim/ki/s,[(e.canonical.x/s-o.canonical.x)*n.dim,(e.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],r=Math.floor(t*this._scale+this._offset[0]),n=Math.floor(i);return new y(r,n)}getElevationAt(t,e,i,r){const n=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return r=!!r,i?ue(ue(l.get(s,a,r),l.get(s,a+1,r),o-a),ue(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),n-s):l.get(s,a,r)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ml(1,t)*this._dem.stride}}const Xd=Ld.types,Qd=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],tf=["fill-extrusion-flood-light-ground-radius"],ef=Math.pow(2,13),rf=Math.pow(2,15)-1,nf=new y(0,1),of=2147483648;function sf(t,e,i,r,n,o,s,a){t.emplaceBack((e<<1)+s,(i<<1)+o,(Math.floor(r*ef)<<1)+n,Math.round(a))}function af(t,e,i,r,n,o){t.emplaceBack(e.x,e.y,(i.x<<1)+r,(i.y<<1)+n,o)}function lf(t,e,i){const r=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*r,i[1]*r,i[2]*r)}class cf{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class uf{constructor(){this.centroidXY=new y(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new y(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new y(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new y(this.max.x-this.min.x,this.max.y-this.min.y)}}class hf{constructor(){this.acc=new y(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,i){this.accCount++,this.acc._add(e);let r=!!this.borders;e.x<t.min.x?(t.min.x=e.x,r=!0):e.x>t.max.x&&(t.max.x=e.x,r=!0),e.y<t.min.y?(t.min.y=e.y,r=!0):e.y>t.max.y&&(t.max.y=e.y,r=!0),((0===e.x||e.x===ki)&&e.x===i.x)!=((0===e.y||e.y===ki)&&e.y===i.y)&&this.processBorderOverlap(e,i),r&&this.checkBorderIntersection(e,i)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ue(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>ki!=t.x>ki&&this.addBorderIntersection(1,ue(e.y,t.y,(ki-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ue(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>ki!=t.y>ki&&this.addBorderIntersection(3,ue(e.x,t.x,(ki-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new y(0,0):new y(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function pf(t,e){const i=t.add(e)._unit(),r=M(t.x*i.x+t.y*i.y,-1,1);var n,o,s;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*rf*((o=t).x*(s=e).y-o.y*s.x<0?-1:1)}const df=[t=>t.x<0,t=>t.x>ki,t=>t.y<0,t=>t.y>ki];function ff(t,e,i,r){const n=[4];if(0===r)return n;i._mult(r);const o=t.sub(i),s=e.sub(i),a=[t,e,o,s];for(let t=0;t<4;t++)for(const e of a)if(df[t](e)){n.push(t);break}return n}class mf{constructor(t){this.vertexArray=new _s,this.indexArray=new Ps,this.programConfigurations=new Fa(t.layers,t.zoom,(t=>tf.includes(t))),this._segments=new ra,this.hiddenByLandmarkVertexArray=new Gs,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ra}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,i,r=!1){const n=t.length;if(n>2){let o=Math.max(0,this._segments.get().length-1);const s=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let a;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const e=t[0],i=t[1];a=pf(e.sub(t[n-1])._perp()._unit(),i.sub(e)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,u=t[l],h=t[c],p=t[c===n-1?0:c+1],d=h.sub(u)._perp()._unit(),f=pf(d,p.sub(h)._perp()._unit()),m=a,g=f;if(vf(u,h,e)||r&&xf(u,e)&&xf(h,e)){a=f;continue}const _=s.vertexLength;af(this.vertexArray,u,h,1,1,m),af(this.vertexArray,u,h,1,0,m),af(this.vertexArray,u,h,0,1,g),af(this.vertexArray,u,h,0,0,g),s.vertexLength+=4;const y=ff(u,h,d,i);for(const t of y)this._segmentToGroundQuads[o].push({id:_,region:t}),this._segmentToRegionTriCounts[o][t]+=2,s.primitiveLength+=2;a=f}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort(((t,e)=>t.region-e.region));for(let i=0;i<e;i++){const e=this._segmentToGroundQuads[i],r=t[i],n=this._segmentToRegionTriCounts[i];n.reduce(((t,e)=>t+e),0);let o=0;for(let t=0;t<=4;t++){const e=n[t];if(0!==e){let i=this.regionSegments[t];i||(i=this.regionSegments[t]=new ra);const n={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+o,vertexLength:r.vertexLength,primitiveLength:e};i.get().push(n)}o+=e}for(let t=0;t<e.length;t++){const i=e[t].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,i,r,n,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,i,r,n,o)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,pd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,i,r,n,o){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,i,r,n,o)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&of?1:0;for(let r=t.groundVertexArrayOffset;r<e;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,fd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class gf{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ps,this.footprintVertices=new fs,this.footprintSegments=[],this.layoutVertexArray=new gs,this.centroidVertexArray=new ta,this.indexArray=new Ps,this.programConfigurations=new Fa(t.layers,t.zoom,(t=>Qd.includes(t))),this.segments=new ra,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new mf(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,e,i,r){this.features=[],this.hasPattern=sd("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wl(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=Nl(n,t);if(!this.layers[0]._featureFilter.filter(new Lo(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:kl(n,i,r),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(ad("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,s,i,{},e.availableImages,r,e.brightness),e.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,i,r,n,o){for(const t of this.features){const{geometry:s}=t;this.addFeature(t,s,t.index,e,i,r,n,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,i,r,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,e,s,i,r,n),this.groundEffect.update(t,e,s,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,md.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,dd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r,n,o,s,a){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new y(0,0),new y(ki,ki)],u=s.projection,h="globe"===u.name,p="Polygon"===Xd[t.type],d=new hf;d.centroidDataIndex=this.centroidData.length;const f=new uf,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},r)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},r);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bs);const _=nd(e,500);for(let t=_.length-1;t>=0;t--){const e=_[t];(0===e.length||(A=e[0]).every((t=>t.x<=0))||A.every((t=>t.x>=ki))||A.every((t=>t.y<=0))||A.every((t=>t.y>=ki)))&&_.splice(t,1)}var A;let v;if(h)v=Tf(_,c,r);else{v=[];for(const t of _)v.push({polygon:t,bounds:c})}const x=p?this.edgeRadius:0,b=x>0&&this.zoom<17,w=(t,e)=>{if(0===t.length)return!1;const i=t[t.length-1];return e.x===i.x&&e.y===i.y};for(const{polygon:t,bounds:e}of v){let i=0,n=0;for(const e of t)p&&!e[0].equals(e[e.length-1])&&e.push(e[0]),n+=p?e.length-1:e.length;const o=this.segments.prepareSegment((p?5:4)*n,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const s={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new cf;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],p){const n=[],s=[];i=o.vertexLength;for(let i=0;i<t.length;i++){const c=t[i];c.length&&0!==i&&s.push(n.length/2);const p=[];let d,f;d=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let t=1;t<c.length;t++){const e=c[t],i=c[t===c.length-1?1:t+1],s=e.clone();if(x){f=i.sub(e)._perp()._unit();const t=d.add(f)._unit(),r=x*Math.min(4,1/(d.x*t.x+d.y*t.y));s.x+=r*t.x,s.y+=r*t.y,s.x=Math.round(s.x),s.y=Math.round(s.y),d=f}!m||0!==x&&!b||w(p,s)||p.push(s),sf(this.layoutVertexArray,s.x,s.y,0,0,1,1,0),o.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),n.push(e.x,e.y),h&&lf(this.layoutVertexExtArray,u.projectTilePoint(s.x,s.y,r),u.upVector(r,s.x,s.y))}m&&(0===x||b)&&(0!==p.length&&w(p,p[0])&&p.pop(),this.groundEffect.addData(p,e,l))}const c=rd(n,s);for(let t=0;t<c.length;t+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[t+0],a.vertexOffset+c[t+1],a.vertexOffset+c[t+2]),this.indexArray.emplaceBack(i+c[t],i+c[t+2],i+c[t+1]),o.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let n=0;n<t.length;n++){const s=t[n];d.startRing(f,s[0]);let a=s.length>4&&bf(s[s.length-2],s[0],s[1]),c=x?yf(s[s.length-2],s[0],s[1],x):0;const g=[];let _,y,A;y=s[1].sub(s[0])._perp()._unit();let v=!0;for(let t=1,n=0;t<s.length;t++){let l=s[t-1],p=s[t];const b=s[t===s.length-1?1:t+1];if(d.appendEdge(f,p,l),vf(p,l,e)){x&&(y=b.sub(p)._perp()._unit(),v=!v);continue}const S=p.sub(l)._perp(),T=S.x/(Math.abs(S.x)+Math.abs(S.y)),C=S.y>0?1:0,M=l.dist(p);if(n+M>32768&&(n=0),x){A=b.sub(p)._perp()._unit();let t=Af(l,p,b,_f(y,A),x);isNaN(t)&&(t=0);const e=p.sub(l)._unit();l=l.add(e.mult(c))._round(),p=p.add(e.mult(-t))._round(),c=t,y=A,m&&this.zoom>=17&&(w(g,l)||g.push(l),w(g,p)||g.push(p))}const E=o.vertexLength,I=s.length>4&&bf(l,p,b);let L=wf(n,a,v);if(sf(this.layoutVertexArray,l.x,l.y,T,C,0,0,L),sf(this.layoutVertexArray,l.x,l.y,T,C,0,1,L),n+=M,L=wf(n,I,!v),a=I,sf(this.layoutVertexArray,p.x,p.y,T,C,0,0,L),sf(this.layoutVertexArray,p.x,p.y,T,C,0,1,L),o.vertexLength+=4,this.indexArray.emplaceBack(E+0,E+1,E+2),this.indexArray.emplaceBack(E+1,E+3,E+2),o.primitiveLength+=2,x){const r=i+(1===t?s.length-2:t-2),n=1===t?i:r+1;if(this.indexArray.emplaceBack(E+1,r,E+3),this.indexArray.emplaceBack(r,n,E+3),o.primitiveLength+=2,void 0===_&&(_=E),!vf(b,s[t],e)){const e=t===s.length-1?_:o.vertexLength;this.indexArray.emplaceBack(E+2,E+3,e),this.indexArray.emplaceBack(E+3,e+1,e),this.indexArray.emplaceBack(E+3,n,e+1),o.primitiveLength+=3}v=!v}if(h){const t=this.layoutVertexExtArray,e=u.projectTilePoint(l.x,l.y,r),i=u.projectTilePoint(p.x,p.y,r),n=u.upVector(r,l.x,l.y),o=u.upVector(r,p.x,p.y);lf(t,e,n),lf(t,e,n),lf(t,i,o),lf(t,i,o)}}p&&(i+=s.length-1),m&&x&&this.zoom>=17&&(0!==g.length&&w(g,g[0])&&g.pop(),this.groundEffect.addData(g,e,l,x>0))}this.footprintSegments.push(a),s.triangleCount=this.indexArray.length-s.triangleArrayOffset,this.polygonSegments.push(s),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=d.borders?nf:this.encodeCentroid(d,f),this.centroidData.push(f),d.borders){this.featuresOnBorder.push(d);const t=this.featuresOnBorder.length-1;for(let e=0;e<d.borders.length;e++)d.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,a),this.groundEffect.addPaintPropertiesData(t,i,n,o,r,a),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const i=this.centroidData[e],r=+(i.min.y+i.max.y>ki),n=2*r+(+(i.min.x+i.max.x>ki)^r);for(let r=0;r<i.polygonSegLen;r++){const o=i.polygonSegIdx+r;t.push({centroidIdx:e,subtile:n,polygonSegmentIdx:o,triangleSegmentIdx:this.polygonSegments[o].triangleSegIdx})}}const e=new Ps;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let i=0,r=0,n=0;for(const e of t){if(e.triangleSegmentIdx!==i)break;n++}const o=t.length;for(;r!==t.length;){i=t[r].triangleSegmentIdx;let s=0,a=r,l=r;for(let e=a;e<n&&t[e].subtile===s;e++)l++;for(;a!==n;){const r=t[a];s=r.subtile;const o=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<l;i++){const r=t[i],n=this.polygonSegments[r.polygonSegmentIdx],s=this.centroidData[r.centroidIdx].min,a=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let t=n.triangleArrayOffset;t<n.triangleArrayOffset+n.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);u.primitiveLength+=n.triangleCount,o.x=Math.min(o.x,s.x),o.y=Math.min(o.y,s.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),a=l;for(let e=a;e<n&&t[e].subtile===t[a].subtile;e++)l++}r=n;for(let e=r;e<o&&t[e].triangleSegmentIdx===t[r].triangleSegmentIdx;e++)n++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,i){let r=0,n=0;const o=1<<t.canonical.z;if(e){const i=e.getMinMaxForTile(t);i&&(r=i.min,n=i.max)}n+=this.maxHeight;const s=t.toUnwrapped();let a;const l=[s.canonical.x/o+s.wrap,s.canonical.y/o],c=[(s.canonical.x+1)/o+s.wrap,(s.canonical.y+1)/o],u=new ra,h=(t,e,i)=>[t[0]*(1-i[0])+e[0]*i[0],t[1]*(1-i[1])+e[1]*i[1]],p=[],d=[];for(const t of this.triangleSubSegments){p[0]=t.min.x/ki,p[1]=t.min.y/ki,d[0]=t.max.x/ki,d[1]=t.max.y/ki;const e=h(l,c,p),o=h(l,c,d);if(0===new Nh([e[0],e[1],r],[o[0],o[1],n]).intersectsPrecise(i)){a&&(u.segments.push(a),a=void 0);continue}const s=t.segment;a&&a.vertexOffset!==s.vertexOffset&&(u.segments.push(a),a=void 0),a?(a.vertexLength+=s.vertexLength,a.primitiveLength+=s.primitiveLength):a={vertexOffset:s.vertexOffset,primitiveLength:s.primitiveLength,vertexLength:s.vertexLength,primitiveOffset:s.primitiveOffset,sortKey:void 0,vaos:{}}}return a&&u.segments.push(a),u}encodeCentroid(t,e){const i=t.centroid(),r=e.span(),n=Math.min(7,Math.round(r.x*this.tileToMeter/10)),o=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new y(M(i.x,1,ki-1)<<3|n,M(i.y,1,ki-1)<<3|o)}encodeBorderCentroid(t){if(!t.borders)return new y(0,0);const e=t.borders,i=Number.MAX_VALUE;if(e[0][0]!==i||e[1][0]!==i){const t=e[0][0]!==i?0:1;return new y(6|(e[0][0]!==i?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==i?2:3;return new y((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==i?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=of,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,r=t.flags&of?nf:t.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==r.y||n!==r.x){for(let t=e;t<i;++t)this.centroidVertexArray.emplace(t,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped());if(function(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!Nd(t[i],e[i]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const r=[];for(const e of this.activeReplacements){const i=Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z);for(const n of this.centroidData)if(!(n.flags&of||e.min.x>n.max.x||n.min.x>e.max.x||e.min.y>n.max.y||n.min.y>e.max.y))for(let o=0;o<n.footprintSegLen;o++){const s=this.footprintSegments[n.footprintSegIdx+o];if(r.length=0,Cf(this.footprintVertices,s.vertexOffset,s.vertexCount,e.footprintTileId.canonical,t.canonical,r),Fd(e.footprint,r,this.footprintIndices.uint16,s.indexOffset,s.indexCount,-s.vertexOffset,-i)){n.flags|=of;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,i){let r=!1;for(let n=0;n<i.footprintSegLen;n++){const o=this.footprintSegments[i.footprintSegIdx+n];let s=0;for(const i of o.ringIndices){for(let n=s,a=i+s-1;n<i+s;a=n++){const i=this.footprintVertices.int16[2*(n+o.vertexOffset)+0],s=this.footprintVertices.int16[2*(n+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+o.vertexOffset)+1];s>e!=l>e&&t<(this.footprintVertices.int16[2*(a+o.vertexOffset)+0]-i)*(e-s)/(l-s)+i&&(r=!r)}s=i}}return r}getHeightAtTileCoord(t,e){let i=Number.NEGATIVE_INFINITY,r=!0;const n=4*(t+ki)*ki+(e+ki);if(this.partLookup.hasOwnProperty(n)){const t=this.partLookup[n];return t?{height:t.height,hidden:!!(t.flags&of)}:void 0}for(const o of this.centroidData)t>o.max.x||o.min.x>t||e>o.max.y||o.min.y>e||this.footprintContainsPoint(t,e,o)&&o&&o.height>i&&(i=o.height,this.partLookup[n]=o,r=!!(o.flags&of));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function _f(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function yf(t,e,i,r){const n=e.sub(t)._perp()._unit(),o=i.sub(e)._perp()._unit();return Af(t,e,i,_f(n,o),r)}function Af(t,e,i,r,n){const o=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,n*o/r)}function vf(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function xf(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function bf(t,e,i){if(t.x<0||t.x>=ki||e.x<0||e.x>=ki||i.x<0||i.x>=ki)return!1;const r=i.sub(e),n=r.perp(),o=t.sub(e);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&n.x*o.x+n.y*o.y<0}function wf(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function Sf(){const t=Math.PI/32,e=Math.tan(t),i=Qa;return i*Math.sqrt(1+2*e*e)-i}function Tf(t,e,i){const r=1<<i.z,n=gl(i.x/r),o=gl((i.x+1)/r),s=_l(i.y/r),a=_l((i.y+1)/r);return function(t,e,i,r,n=0,o){const s=[];if(!t.length||!i||!r)return s;const a=(t,e)=>{for(const i of t)s.push({polygon:i,bounds:e})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),u=l-c,h=[];for(let t=0;t<Math.abs(u);t++)h.push(u>0?0:1);for(let t=0;t<Math.min(l,c);t++)h.push(0),h.push(1);let p=t;if(p=Pd(p,e[0].y-n,e[1].y+n,1),p=Pd(p,e[0].x-n,e[1].x+n,0),!p.length)return s;const d=[];for(h.length?d.push({polygons:p,bounds:e,depth:0}):a(p,e);d.length;){const t=d.pop(),e=t.depth,i=h[e],r=t.bounds[0],s=t.bounds[1],l=0===i?r.x:r.y,c=0===i?s.x:s.y,u=o?o(i,l,c):.5*(l+c),p=Pd(t.polygons,l-n,u+n,i),f=Pd(t.polygons,u-n,c+n,i);if(p.length){const t=[r,new y(0===i?u:s.x,1===i?u:s.y)];h.length>e+1?d.push({polygons:p,bounds:t,depth:e+1}):a(p,t)}if(f.length){const t=[new y(0===i?u:r.x,1===i?u:r.y),s];h.length>e+1?d.push({polygons:f,bounds:t,depth:e+1}):a(f,t)}}return s}(t,e,Math.ceil((o-n)/11.25),Math.ceil((s-a)/11.25),1,((t,e,n)=>{if(0===t)return.5*(e+n);{const t=_l((i.y+e/ki)/r);return(fl(.5*(_l((i.y+n/ki)/r)+t))*r-i.y)*ki}}))}function Cf(t,e,i,r,n,o){const s=Math.pow(2,r.z-n.z);for(let a=0;a<i;a++){let i=t.int16[2*(a+e)+0],l=t.int16[2*(a+e)+1];i=(i+n.x*ki)*s-r.x*ki,l=(l+n.y*ki)*s-r.y*ki,o.push(new y(i,l))}}ro(gf,"FillExtrusionBucket",{omit:["layers","features"]}),ro(uf,"PartData"),ro(cf,"FootprintSegment"),ro(hf,"BorderCentroidData"),ro(mf,"GroundEffect");const Mf=new jo({visibility:new Bo(qo["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Bo(qo["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Ef={paint:new jo({"fill-extrusion-opacity":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Uo(qo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Bo(qo["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Mf};class If extends y{constructor(t,e,i){super(t,e),this.z=i}}function Lf(t,e){return t.x*e.x+t.y*e.y}function Pf(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=Lf(a,a),h=Lf(a,l),p=Lf(l,l),d=Lf(c,a),f=Lf(c,l),m=u*p-h*h,g=(p*d-h*f)/m,_=(u*f-h*d)/m,y=r.z*(1-g-_)+n.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function kf(t,e,i,r,n,o,s,a){const l=s*n.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,i){const r=Math.floor(e[0]/8),n=Math.floor(e[1]/8),o=10*(e[0]-8*r),s=10*(e[1]-8*n),a=t.getElevationAt(r,n,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(r,n),p=2*c+1,d=2*u+1,f=function(t,e,i,r,n){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+n,i,!0),t.getElevationAtPixel(e,i+n,!0),t.getElevationAtPixel(e+r,i+n,!0)]}(t,h.x-c,h.y-u,p,d),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/p),A=Math.min(.25,.5*l*_/d);return a+Math.max(y*o,A*s)}(n,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+r,l+i+2):l+r}}const Nf=ps([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Df}=Nf,Of=ps([{name:"a_packed",components:4,type:"Float32"}]),{members:Rf}=Of;class Ff{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new vp({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=O(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const p=e/i*(r+1);if(s.isDash){const t=r-Math.abs(p);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+p*p);this.image.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const i=t[0],r=t[t.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let o=0,s=t[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=t[++o]);const r=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(r,a);this.image.data[n+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const r="round"===e,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return G("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(G("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const i=this.width/s,o=this.getDashRanges(t,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===e?.5*i:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[i]=l,l}}ro(Ff,"LineAtlas");const zf=Ld.types,Bf=Math.cos(Math.PI/180*37.5);class Uf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new ys,this.layoutVertexArray2=new As,this.indexArray=new Ps,this.programConfigurations=new Fa(t.layers,t.zoom),this.segments=new ra,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,r){this.hasPattern=sd("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Nl(e,t);if(!this.layers[0]._featureFilter.filter(new Lo(this.zoom),c,i))continue;const u=n?n.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:kl(e,i,r),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:c}=r;if(l&&this.addFeatureDashes(r,s),this.hasPattern){const t=ad("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,s.positions,e.availableImages,e.brightness);a.insert(t[o].feature,n,o,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)e=!0;else{const e=n.value,i=r.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a;if("constant"===n.kind){if(s=n.value,!s)continue}else s=n.evaluate({zoom:i},t);a="constant"===o.kind?o.value:o.evaluate({zoom:i},t),e.addDash(s,a),t.patterns[r.id]=e.getKey(s,a)}}update(t,e,i,r,n){const o=0!==Object.keys(t).length;o&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,o?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(t,e,i,r,n,o){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Rf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Df),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n,o,s){const a=this.layers[0].layout,l=a.get("line-join").evaluate(t,{}),c=a.get("line-cap").evaluate(t,{}),u=a.get("line-miter-limit"),h=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,l,c,u,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,o,r,s)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===zf[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*ki/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,d,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(d=e===a-1?s?t[l+1]:void 0:t[e+1],d&&t[e].equals(d))continue;m&&(f=m),h&&(p=h),h=t[e],m=d?d.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,A=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),x=y<Bf&&p&&d,b=f.x*m.y-f.y*m.x>0;if(x&&e>l){const t=h.dist(p);if(t>2*c){const e=h.sub(h.sub(p)._mult(c/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,f,0,0,u),p=e}}const w=p&&d;let S=w?i:s?"butt":r;if(w&&"round"===S&&(A<o?S="miter":A<=2&&(S="fakeround")),"miter"===S&&A>n&&(S="bevel"),"bevel"===S&&(A>2&&(S="flipbevel"),A<n&&(S="miter")),p&&this.updateDistance(p,h),"miter"===S)g._mult(A),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(A>100)g=m.mult(-1);else{const t=A*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(b?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(A*A-1),e=b?t:0,i=b?0:t;if(p&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===S){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const r=m.sub(f)._mult(i)._add(f)._unit()._mult(b?-1:1);this.addHalfVertex(h,r.x,r.y,!1,b,0,u)}}d&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const t=p?1:-1;p||this.addCurrentVertex(h,g,t,t,u),this.addCurrentVertex(h,g,0,0,u),p&&this.addCurrentVertex(h,g,t,t,u)}else"round"===S&&(p&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),d&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(x&&e<a-1){const t=h.dist(d);if(t>2*c){const e=h.add(d.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n)}addHalfVertex({x:t,y:e},i,r,n,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}ro(Uf,"LineBucket",{omit:["layers","patternFeatures"]});const Vf=new jo({"line-cap":new Uo(qo.layout_line["line-cap"]),"line-join":new Uo(qo.layout_line["line-join"]),"line-miter-limit":new Bo(qo.layout_line["line-miter-limit"]),"line-round-limit":new Bo(qo.layout_line["line-round-limit"]),"line-sort-key":new Uo(qo.layout_line["line-sort-key"]),visibility:new Bo(qo.layout_line.visibility)});var jf={paint:new jo({"line-opacity":new Uo(qo.paint_line["line-opacity"]),"line-color":new Uo(qo.paint_line["line-color"]),"line-translate":new Bo(qo.paint_line["line-translate"]),"line-translate-anchor":new Bo(qo.paint_line["line-translate-anchor"]),"line-width":new Uo(qo.paint_line["line-width"]),"line-gap-width":new Uo(qo.paint_line["line-gap-width"]),"line-offset":new Uo(qo.paint_line["line-offset"]),"line-blur":new Uo(qo.paint_line["line-blur"]),"line-dasharray":new Uo(qo.paint_line["line-dasharray"]),"line-pattern":new Uo(qo.paint_line["line-pattern"]),"line-gradient":new Vo(qo.paint_line["line-gradient"]),"line-trim-offset":new Bo(qo.paint_line["line-trim-offset"]),"line-emissive-strength":new Bo(qo.paint_line["line-emissive-strength"]),"line-border-width":new Uo(qo.paint_line["line-border-width"]),"line-border-color":new Uo(qo.paint_line["line-border-color"])}),layout:Vf};function Gf(t,e,i){return e*(ki/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function Zf(t,e){return 1/Gf(t,1,e.tileZoom)}function qf(t,e,i,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Wf=t=>{const e=[];Hf(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return 0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER"),e};function Hf(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Jf=new class extends Uo{possiblyEvaluate(t,e){return e=new Lo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=P({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(jf.paint.properties["line-width"].specification);function Kf(t,e){return e>0?e+2*t:t}Jf.useIntegerZoom=!0;const $f=ps([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yf=ps([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Xf=ps([{name:"a_projected_pos",components:4,type:"Float32"}],4);ps([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qf=ps([{name:"a_z_offset",components:1,type:"Float32"}],4),tm=ps([{name:"a_texb",components:2,type:"Uint16"}]),em=ps([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),im=ps([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ps([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rm=ps([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nm=ps([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ps([{name:"triangle",components:3,type:"Uint16"}]),ps([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ps([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ps([{type:"Float32",name:"offsetX"}]),ps([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var om=24;const sm=128;function am(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Lo(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Lo(s)),maxSize:i.evaluate(new Lo(a)),interpolationType:r}}}function lm(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/sm:"composite"===t.kind?ue(r/sm,n/sm,i):e}function cm(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?M(Wr.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=ue(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}}var um=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:sm,evaluateSizeForFeature:lm,evaluateSizeForZoom:cm,getSizeData:am});function hm(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),Io.applyArabicShaping&&(t=Io.applyArabicShaping(t)),t}(t.text,e,i)})),t}const pm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function dm(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function fm(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}var mm={read:function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},write:function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+d]=255&a,d+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m}},gm=ym,_m=mm;function ym(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ym.Varint=0,ym.Fixed64=1,ym.Bytes=2,ym.Fixed32=5;var Am=4294967296,vm=1/Am,xm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function bm(t){return t.type===ym.Bytes?t.readVarint()+t.pos:t.pos+1}function wm(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Sm(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function Tm(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Cm(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Mm(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Em(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Im(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Lm(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Pm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function km(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Nm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Dm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Om(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Rm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}ym.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Dm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Rm(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Dm(this.buf,this.pos)+Dm(this.buf,this.pos+4)*Am;return this.pos+=8,t},readSFixed64:function(){var t=Dm(this.buf,this.pos)+Rm(this.buf,this.pos+4)*Am;return this.pos+=8,t},readFloat:function(){var t=_m.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=_m.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return wm(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return wm(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return wm(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return wm(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return wm(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return wm(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&xm?function(t,e,i){return xm.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ym.Bytes)return t.push(this.readVarint(e));var i=bm(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ym.Bytes)return t.push(this.readSVarint());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ym.Bytes)return t.push(this.readBoolean());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ym.Bytes)return t.push(this.readFloat());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ym.Bytes)return t.push(this.readDouble());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ym.Bytes)return t.push(this.readFixed32());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ym.Bytes)return t.push(this.readSFixed32());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ym.Bytes)return t.push(this.readFixed64());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ym.Bytes)return t.push(this.readSFixed64());var e=bm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ym.Varint)for(;this.buf[this.pos++]>127;);else if(e===ym.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ym.Fixed32)this.pos+=4;else{if(e!==ym.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Om(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Om(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Om(this.buf,-1&t,this.pos),Om(this.buf,Math.floor(t*vm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Om(this.buf,-1&t,this.pos),Om(this.buf,Math.floor(t*vm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Sm(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),_m.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),_m.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Sm(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,ym.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Tm,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Cm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Im,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Mm,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Em,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Lm,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Pm,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,km,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Nm,e)},writeBytesField:function(t,e){this.writeTag(t,ym.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ym.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ym.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ym.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ym.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ym.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ym.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ym.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ym.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ym.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Fm=p(gm);const zm=3;function Bm(t,e,i){e.glyphs=[],1===t&&i.readMessage(Um,e)}function Um(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(Vm,{});e.glyphs.push({id:t,bitmap:new vp({width:n+2*zm,height:o+2*zm},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function Vm(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const jm=zm,Gm={horizontal:1,vertical:2,horizontalOnly:3};class Zm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Zm;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Zm;return e.imageName=t,e}}class qm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new qm;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let r=0;r<t.length;r++){const n=t.charCodeAt(r+1)||null,o=t.charCodeAt(r-1)||null;i+=!e&&(n&&fo(n)&&!pm[t[r+1]]||o&&fo(o)&&!pm[t[r-1]])||!pm[t[r]]?t[r]:pm[t[r]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&Hm[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Hm[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new qm;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Zm.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.namePrimary:"";if(0===e.length)return void G("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Zm.forImage(e)),this.sectionIndex.push(this.sections.length-1)):G("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wm(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f){const m=qm.fromFeature(t,n);h===Gm.vertical&&m.verticalizePunctuation(p);let g=[];const _=function(t,e,i,r,n,o){if(!t)return[];const s=[],a=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=Km(t.getCodePoint(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,o),l=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),p=t.getCodePoint(i);if(Hm[p]||(c+=Km(p,h,r,n,e,o)),i<t.length()-1){const e=!((u=p)<11904||!(lo["Bopomofo Extended"](u)||lo.Bopomofo(u)||lo["CJK Compatibility Forms"](u)||lo["CJK Compatibility Ideographs"](u)||lo["CJK Compatibility"](u)||lo["CJK Radicals Supplement"](u)||lo["CJK Strokes"](u)||lo["CJK Symbols and Punctuation"](u)||lo["CJK Unified Ideographs Extension A"](u)||lo["CJK Unified Ideographs"](u)||lo["Enclosed CJK Letters and Months"](u)||lo["Halfwidth and Fullwidth Forms"](u)||lo.Hiragana(u)||lo["Ideographic Description Characters"](u)||lo["Kangxi Radicals"](u)||lo["Katakana Phonetic Extensions"](u)||lo.Katakana(u)||lo["Vertical Forms"](u)||lo["Yi Radicals"](u)||lo["Yi Syllables"](u)));(Jm[p]||e||h.imageName)&&s.push(Xm(i+1,c,a,s,Ym(p,t.getCodePoint(i+1),e&&l),!1))}}var u;return Qm(Xm(t.length(),c,a,s,0,!0))}(m,c,o,e,r,d),{processBidirectionalText:y,processStyledBidirectionalText:A}=Io;if(y&&1===m.sections.length){const t=y(m.toString(),_);for(const e of t){const t=new qm;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);g.push(t)}}else if(A){const t=A(m.text,m.sectionIndex,_);for(const e of t){const t=new qm;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,g.push(t)}}else g=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(m,_);const v=[],x={positionedLines:v,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,r,n,o,s,a,l,c,u,h){let p=0,d=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const t of n){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let _=0;for(const s of n){s.trim();const n=s.getMaxScale(),a=(n-1)*om,A={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=A;const v=A.positionedGlyphs;let x=0;if(!s.length()){d+=o,++_;continue}let b=0,w=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCodePoint(o);let _=a.scale,A=null,S=null,T=null,C=om,M=0;const E=!(l===Gm.horizontal||!u&&!po(m)||u&&(Hm[m]||(y=m,lo.Arabic(y)||lo["Arabic Supplement"](y)||lo["Arabic Extended-A"](y)||lo["Arabic Presentation Forms-A"](y)||lo["Arabic Presentation Forms-B"](y))));if(a.imageName){const e=r[a.imageName];if(!e)continue;T=a.imageName,t.iconsInText=t.iconsInText||!0,S=e.paddedRect;const i=e.displaySize;_=_*om/h,A={width:i[0],height:i[1],left:0,top:-jm,advance:E?i[1]:i[0],localGlyph:!1},M=g?-A.height*_:n*om-17-i[1]*_,C=A.advance;const o=(E?i[0]:i[1])*_-om*n;o>0&&o>x&&(x=o)}else{const t=i[a.fontStack];if(!t)continue;t[m]&&(S=t[m]);const r=e[a.fontStack];if(!r)continue;const o=r.glyphs[m];if(!o)continue;if(A=o.metrics,C=8203!==m?om:0,g){const t=void 0!==r.ascender?Math.abs(r.ascender):0,e=void 0!==r.descender?Math.abs(r.descender):0,i=(t+e)*_;b<i&&(b=i,w=(t-e)/2*_),M=-t*_}else M=(n-_)*om-17}E?(t.verticalizable=!0,v.push({glyph:m,imageName:T,x:p,y:d+M,vertical:E,scale:_,localGlyph:A.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:A,rect:S}),p+=C*_+c):(v.push({glyph:m,imageName:T,x:p,y:d+M,vertical:E,scale:_,localGlyph:A.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:A,rect:S}),p+=A.advance*_+c)}0!==v.length&&(f=Math.max(p-c,f),g?eg(v,m,x,w,o*n/2):eg(v,m,x,0,o/2)),p=0;const S=o*n+x;A.lineOffset=Math.max(x,a),d+=S,++_}var y;const A=d,{horizontalAlign:v,verticalAlign:x}=tg(s);(function(t,e,i,r,n,o){const s=(e-i)*n,a=-o*r;for(const e of t)for(const t of e.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,v,x,f,A),t.top+=-x*A,t.bottom=t.top+A,t.left+=-v*f,t.right=t.left+f,t.hasBaseline=g}(x,e,i,r,g,s,a,l,h,c,p,f),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(v)&&x}const Hm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Km(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*om/o+n:0}{const r=i[e.fontStack],o=r&&r.glyphs[t];return o?o.metrics.advance*e.scale+n:0}}function $m(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function Ym(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Xm(t,e,i,r,n,o){let s=null,a=$m(e,i,n,o);for(const t of r){const r=$m(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function Qm(t){return t?Qm(t.priorBreak).concat(t.index):[]}function tg(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function eg(t,e,i,r,n){if(!(e||i||r||n))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=o;e++)t[e].x-=a,t[e].y+=i+r+n}function ig(t,e,i,r){const{horizontalAlign:n,verticalAlign:o}=tg(r),s=i[0]-t.displaySize[0]*n,a=i[1]-t.displaySize[1]*o;return{imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:s,right:s+t.displaySize[0]}}function rg(t,e,i,r,n,o){const s=t.imagePrimary;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,p,d;"width"===i||"both"===i?(d=n[0]+l-r[3],h=n[0]+c+r[1]):(d=n[0]+(l+c-s.displaySize[0])/2,h=d+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],p=n[1]+m+r[2]):(u=n[1]+(f+m-s.displaySize[1])/2,p=u+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:u,right:h,bottom:p,left:d,collisionPadding:a}}class ng extends y{constructor(t,e,i,r,n){super(t,e),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new ng(this.x,this.y,this.z,this.angle,this.segment)}}function og(t,e,i,r,n){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function sg(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function ag(t,e,i){return t?.6*e*i:0}function lg(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function cg(t,e,i,r,n,o){const s=ag(i,n,o),a=lg(i,r)*o;let l=0;const c=sg(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=ue(r.x,n.x,u),p=ue(r.y,n.y,u),d=new ng(h,p,0,n.angleTo(r),i);return!s||og(t,d,a,s,e)?d:void 0}l+=o}}function ug(t,e,i,r,n,o,s,a,l){const c=ag(r,o,s),u=lg(r,n),h=u*s,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),hg(t,p?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,p,!1,l)}function hg(t,e,i,r,n,o,s,a,l){const c=o/2,u=sg(t);let h=0,p=e-i,d=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;p+i<h+f;){p+=i;const g=(p-h)/f,_=ue(s.x,a.x,g),y=ue(s.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&p-c>=0&&p+c<=u){const i=new ng(_,y,0,m,e);r&&!og(t,i,o,r,n)||d.push(i)}}h+=f}return a||d.length||s||(d=hg(t,h/2,i,r,n,o,s,!0,l)),d}function pg(t,e,i,r,n){const o=[];for(let s=0;s<t.length;s++){const a=t[s];let l;for(let t=0;t<a.length-1;t++){let s=a[t],c=a[t+1];s.x<e&&c.x<e||(s.x<e?s=new y(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x<e&&(c=new y(e,s.y+(e-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y<i&&c.y<i||(s.y<i?s=new y(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round():c.y<i&&(c=new y(s.x+(i-s.y)/(c.y-s.y)*(c.x-s.x),i)._round()),s.x>=r&&c.x>=r||(s.x>=r?s=new y(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round():c.x>=r&&(c=new y(r,s.y+(r-s.x)/(c.x-s.x)*(c.y-s.y))._round()),s.y>=n&&c.y>=n||(s.y>=n?s=new y(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round():c.y>=n&&(c=new y(s.x+(n-s.y)/(c.y-s.y)*(c.x-s.x),n)._round()),l&&s.equals(l[l.length-1])||(l=[s],o.push(l)),l.push(c)))))}}return o}function dg(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}ro(ng,"Anchor");const fg=1;class mg{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+fg,this.paddedRect.y+fg]}get br(){return[this.paddedRect.x+this.paddedRect.w-fg,this.paddedRect.y+this.paddedRect.h-fg]}get displaySize(){return[(this.paddedRect.w-2*fg)/this.pixelRatio,(this.paddedRect.h-2*fg)/this.pixelRatio]}}class gg{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=dg(n),a=new xp({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;xp.copy(r.data,a,{x:0,y:0},{x:n.x+fg,y:n.y+fg},r.data,r.sdf)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+fg,s=n.y+fg,l=i.data.width,c=i.data.height;xp.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),xp.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),xp.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),xp.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),xp.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2*fg,h:n.data.height+2*fg};i.push(o),e[r]=new mg(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,i))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],t.getImage(r,i),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r,i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl,o=!!Object.keys(this.patternPositions).length;i.update(e.data,{useMipmap:o},{x:r,y:n})}}ro(mg,"ImagePosition"),ro(gg,"ImageAtlas");const _g=1e20;function yg(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)Ag(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)Ag(t,c*o+e,1,r,s,a,l)}function Ag(t,e,i,r,n,o,s){o[0]=0,s[0]=-_g,s[1]=_g,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=_g}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}const vg=2,xg={none:0,ideographs:1,all:2};class bg{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,i){const r=[],o=this.urls[e]||n.GLYPHS_URL;for(const e in t)for(const i of t[e])r.push({stack:e,id:i});L(r,(({stack:t,id:e},i)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let n=r.glyphs[e];if(void 0!==n)return void i(null,{stack:t,id:e,glyph:n});if(n=this._tinySDF(r,t,e),n)return r.glyphs[e]=n,void i(null,{stack:t,id:e,glyph:n});const s=Math.floor(e/256);if(256*s>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[s])return void i(null,{stack:t,id:e,glyph:n});let a=r.requests[s];a||(a=r.requests[s]=[],bg.loadGlyphRange(t,s,o,this.requestManager,((t,e)=>{if(e){r.ascender=e.ascender,r.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e.glyphs[+t]);r.ranges[s]=!0}for(const i of a)i(t,e);delete r.requests[s]}))),a.push(((r,n)=>{r?i(r):n&&i(null,{stack:t,id:e,glyph:n.glyphs[e]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:r,glyph:n}of e)void 0===t[i]&&(t[i]={}),void 0===t[i].glyphs&&(t[i].glyphs={}),t[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},t[i].ascender=this.entries[i].ascender,t[i].descender=this.entries[i].descender;i(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==xg.none&&(this.localGlyphMode===xg.all?!!this.localFontFamily:!!this.localFontFamily&&(lo["CJK Unified Ideographs"](t)||lo["Hangul Syllables"](t)||lo.Hiragana(t)||lo.Katakana(t)||lo["CJK Symbols and Punctuation"](t)||lo["CJK Unified Ideographs Extension A"](t)||lo["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,e,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=t.tinySDF;if(!n){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),n=t.tinySDF=new bg.TinySDF({fontFamily:r,fontWeight:i,fontSize:24*vg,buffer:3*vg,radius:8*vg}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const o=String.fromCodePoint(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:p,glyphAdvance:d}=n.draw(o);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new vp({width:a,height:l},s),metrics:{width:c/vg,height:u/vg,left:h/vg,top:p/vg-27,advance:d/vg,localGlyph:!0}}}}bg.loadGlyphRange=function(t,e,i,r,n){const o=256*e,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),Tt.Glyphs);It(a,((t,e)=>{if(t)n(t);else if(e){const t={},i=function(t){return new Fm(t).readFields(Bm,{})}(e);for(const e of i.glyphs)t[e.id]=e;n(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},bg.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),p=new Uint8ClampedArray(h),d={data:p,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return d;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(_g,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=y.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+m)*c+e+m;if(1===i)_[r]=0,g[r]=_g;else{const t=.5-i;_[r]=t>0?t*t:0,g[r]=t<0?t*t:0}}yg(_,0,0,c,u,c,this.f,this.v,this.z),yg(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(_[t])-Math.sqrt(g[t]);p[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return d}};const wg=fg;function Sg(t,e,i,r){const n=[],o=t.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*wg,l=o.paddedRect.h-2*wg,c=t.right-t.left,u=t.bottom-t.top,h=o.stretchX||[[0,a]],p=o.stretchY||[[0,l]],d=(t,e)=>t+e[1]-e[0],f=h.reduce(d,0),m=p.reduce(d,0),g=a-f,_=l-m;let A=0,v=f,x=0,b=m,w=0,S=g,T=0,C=_;if(o.content&&r){const t=o.content;A=Tg(h,0,t[0]),x=Tg(p,0,t[1]),v=Tg(h,t[0],t[2]),b=Tg(p,t[1],t[3]),w=t[0]-A,T=t[1]-x,S=t[2]-t[0]-v,C=t[3]-t[1]-b}const M=(r,n,a,l)=>{const h=Mg(r.stretch-A,v,c,t.left),p=Eg(r.fixed-w,S,r.stretch,f),d=Mg(n.stretch-x,b,u,t.top),g=Eg(n.fixed-T,C,n.stretch,m),_=Mg(a.stretch-A,v,c,t.left),M=Eg(a.fixed-w,S,a.stretch,f),E=Mg(l.stretch-x,b,u,t.top),I=Eg(l.fixed-T,C,l.stretch,m),L=new y(h,d),P=new y(_,d),k=new y(_,E),N=new y(h,E),D=new y(p/s,g/s),O=new y(M/s,I/s),R=e*Math.PI/180;if(R){const t=Math.sin(R),e=Math.cos(R),i=[e,-t,t,e];L._matMult(i),P._matMult(i),N._matMult(i),k._matMult(i)}const F=r.stretch+r.fixed,z=a.stretch+a.fixed,B=n.stretch+n.fixed,U=l.stretch+l.fixed,V=t.imageSecondary;return{tl:L,tr:P,bl:N,br:k,texPrimary:{x:o.paddedRect.x+wg+F,y:o.paddedRect.y+wg+B,w:z-F,h:U-B},texSecondary:V?{x:V.paddedRect.x+wg+F,y:V.paddedRect.y+wg+B,w:z-F,h:U-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:O,minFontScaleX:S/s/c,minFontScaleY:C/s/u,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const t=Cg(h,g,f),e=Cg(p,_,m);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(M(r,e[t],o,e[t+1]))}}else n.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return n}function Tg(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function Cg(t,e,i){const r=[{fixed:-wg,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+wg,stretch:i}),r}function Mg(t,e,i,r){return t/e*i+r}function Eg(t,e,i,r){return t-e*i/r}function Ig(t,e,i,r){const n=e+t.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(e+t.positionedLines[r-1].lineOffset))/2}function Lg(t,e=1,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const l=Math.min(o-r,s-n);let c=l/2;const u=new Pi([],Pg);if(0===l)return new y(r,n);for(let e=r;e<o;e+=l)for(let i=n;i<s;i+=l)u.push(new kg(e+c,i+c,c,t));let h=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new kg(i/e,r/e,0,t)}(t),p=u.length;for(;u.length;){const r=u.pop();(r.d>h.d||!h.d)&&(h=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-h.d<=e||(c=r.h/2,u.push(new kg(r.p.x-c,r.p.y-c,c,t)),u.push(new kg(r.p.x+c,r.p.y-c,c,t)),u.push(new kg(r.p.x-c,r.p.y+c,c,t)),u.push(new kg(r.p.x+c,r.p.y+c,c,t)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${h.d}`)),h.p}function Pg(t,e){return e.max-t.max}class kg{constructor(t,e,i,r){this.p=new y(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,Zl(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const Ng=Number.POSITIVE_INFINITY,Dg=Math.sqrt(2);function Og(t,[e,i]){let r=0,n=0;if(i===Ng){e<0&&(e=0);const i=e/Dg;switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,n]}function Rg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fg(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f){let m=o.textMaxSize.evaluate(e,{},h);void 0===m&&(m=s);const g=t.layers[0].layout,_=g.get("icon-offset").evaluate(e,{},h),y=Vg(i.horizontal)||i.vertical,A="globe"===p.name,v=om,b=s/v,w=t.tilePixelRatio*m/v,S=(k=t.overscaling,t.zoom>18&&k>2&&(k>>=1),Math.max(ki/(512*k),1)*g.get("symbol-spacing")),T=g.get("text-padding")*t.tilePixelRatio,C=g.get("icon-padding")*t.tilePixelRatio,M=x(g.get("text-max-angle")),E="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),I="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),L=g.get("symbol-placement"),P=S/2;var k;const N=g.get("icon-text-fit").evaluate(e,{},h),D=g.get("icon-text-fit-padding").evaluate(e,{},h),O="none"!==N;let R;!1===t.hasAnyIconTextFit&&O&&(t.hasAnyIconTextFit=!0),r&&O&&(t.allowVerticalPlacement&&i.vertical&&(R=rg(r,i.vertical,N,D,_,b)),y&&(r=rg(r,y,N,D,_,b)));const F=(s,a,m)=>{if(a.x<0||a.x>=ki||a.y<0||a.y>=ki)return;let g=null;if(A){const{x:t,y:e,z:i}=p.projectTilePoint(a.x,a.y,m);g={anchor:new ng(t,e,i,0,void 0),up:p.upVector(m,a.x,a.y)}}!function(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C){const M=t.addToLineVertexArray(e,r);let E,I,L,P,k,N,D,O=0,R=0,F=0,z=0,B=-1,U=-1;const V={};let j=da("");const Z=i?i.anchor:e,q="none"!==l.layout.get("icon-text-fit").evaluate(v,{},S);let W=0,H=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[W,H]=l.layout.get("text-offset").evaluate(v,{},S).map((t=>t*om)):(W=l.layout.get("text-radial-offset").evaluate(v,{},S)*om,H=Ng),t.allowVerticalPlacement&&n.vertical){const t=n.vertical;if(f)N=Gg(t),a&&(D=Gg(a));else{const i=l.layout.get("text-rotate").evaluate(v,{},S)+90;L=jg(c,Z,e,u,h,p,t,d,i,m),a&&(P=jg(c,Z,e,u,h,p,a,_,i))}}if(o){const r=l.layout.get("icon-rotate").evaluate(v,{},S),n=Sg(o,r,b,q),s=a?Sg(a,r,b,q):void 0;I=jg(c,Z,e,u,h,p,o,_,r),O=4*n.length;const d=t.iconSizeData;let f=null;"source"===d.kind?(f=[sm*l.layout.get("icon-size").evaluate(v,{},S)],f[0]>Bg&&G(`${t.layerIds[0]}: Value for "icon-size" is >= ${zg}. Reduce your "icon-size".`)):"composite"===d.kind&&(f=[sm*x.compositeIconSizes[0].evaluate(v,{},S),sm*x.compositeIconSizes[1].evaluate(v,{},S)],(f[0]>Bg||f[1]>Bg)&&G(`${t.layerIds[0]}: Value for "icon-size" is >= ${zg}. Reduce your "icon-size".`)),t.addSymbols(t.icon,n,f,A,y,v,!1,i,e,M.lineStartIndex,M.lineLength,-1,w,S,T,C),B=t.icon.placedSymbolArray.length-1,s&&(R=4*s.length,t.addSymbols(t.icon,s,f,A,y,v,Gm.vertical,i,e,M.lineStartIndex,M.lineLength,-1,w,S,T,C),U=t.icon.placedSymbolArray.length-1)}for(const r in n.horizontal){const o=n.horizontal[r];E||(j=da(o.text),f?k=Gg(o):E=jg(c,Z,e,u,h,p,o,d,l.layout.get("text-rotate").evaluate(v,{},S),m));const a=1===o.positionedLines.length;if(F+=Ug(t,i,e,o,s,l,f,v,m,M,n.vertical?Gm.horizontal:Gm.horizontalOnly,a?Object.keys(n.horizontal):[r],V,B,x,w,S,T),a)break}n.vertical&&(z+=Ug(t,i,e,n.vertical,s,l,f,v,m,M,Gm.vertical,["vertical"],V,U,x,w,S,T));let J=-1;const K=(t,e)=>t?Math.max(t,e):e;J=K(k,J),J=K(N,J),J=K(D,J);const $=J>-1?1:0;t.glyphOffsetArray.length>=65535&&G("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,v.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,Z.x,Z.y,Z.z,V.right>=0?V.right:-1,V.center>=0?V.center:-1,V.left>=0?V.left:-1,V.vertical>=0?V.vertical:-1,B,U,j,void 0!==E?E:t.collisionBoxArray.length,void 0!==E?E+1:t.collisionBoxArray.length,void 0!==L?L:t.collisionBoxArray.length,void 0!==L?L+1:t.collisionBoxArray.length,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,P||t.collisionBoxArray.length,P?P+1:t.collisionBoxArray.length,u,F,z,O,R,$,0,W,H,J,0,q?1:0)}(t,a,g,s,i,r,n,R,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,T,E,l,0,C,I,_,e,o,c,u,h,d,f)};if("line"===L)for(const n of pg(e.geometry,0,0,ki,ki)){const e=ug(n,S,M,i.vertical||y,r,v,w,t.overscaling,ki);for(const i of e)y&&Zg(t,y.text,P,i)||F(n,i,h)}else if("line-center"===L){for(const t of e.geometry)if(t.length>1){const e=cg(t,M,i.vertical||y,r,v,w);e&&F(t,e,h)}}else if("Polygon"===e.type)for(const t of nd(e.geometry,0)){const e=Lg(t,16);F(t[0],new ng(e.x,e.y,0,0,void 0),h)}else if("LineString"===e.type)for(const t of e.geometry)F(t,new ng(t[0].x,t[0].y,0,0,void 0),h);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)F([e],new ng(e.x,e.y,0,0,void 0),h)}const zg=255,Bg=zg*sm;function Ug(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_){const A=function(t,e,i,r,n,o,s,a){const l=[];if(0===e.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(t){const e=t[0],i=t[1],r=e*i;return r>0?[e,-i]:r<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const p=e.positionedLines.length,d=h/p;let f=e.top-i[1];for(let t=0;t<p;++t){const r=e.positionedLines[t];f=Ig(e,d,f,t);for(const t of r.positionedGlyphs){if(!t.rect)continue;const r=t.rect||{};let o=jm+1,h=!0,p=1,d=0;if(t.imageName){const e=s[t.imageName];if(!e)continue;if(e.sdf){G("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,p=e.pixelRatio,o=fg/p}const m=(n||a)&&t.vertical,g=t.metrics.advance*t.scale/2,_=t.metrics,A=t.rect;if(null===A)continue;a&&e.verticalizable&&(d=t.imageName?g-t.metrics.width*t.scale/2:0);const v=n?[t.x+g,t.y]:[0,0];let x=[0,0],b=[0,0],w=!1;n||(m?(b=[t.x+g+u[0],t.y+u[1]-d],w=!0):x=[t.x+g+i[0],t.y+i[1]-d]);const S=A.w*t.scale/(p*(t.localGlyph?vg:1)),T=A.h*t.scale/(p*(t.localGlyph?vg:1));let C,M,E,I;if(m){const e=t.y-f,i=new y(-g,g-e),r=-Math.PI/2,n=new y(...b);C=new y(-g+x[0],x[1]),C._rotateAround(r,i)._add(n),C.x+=-e+g,C.y-=(_.left-o)*t.scale;const s=t.imageName?_.advance*t.scale:om*t.scale,a=String.fromCodePoint(t.glyph);dm(a)?C.x+=(1-o)*t.scale:fm(a)?C.x+=s-_.height*t.scale+(-o-1)*t.scale:C.x+=t.imageName||_.width+2*o===A.w&&_.height+2*o===A.h?(s-T)/2:(s-(_.height+2*o)*t.scale)/2,M=new y(C.x,C.y-S),E=new y(C.x+T,C.y),I=new y(C.x+T,C.y-S)}else{const e=(_.left-o)*t.scale-g+x[0],i=(-_.top-o)*t.scale+x[1],r=e+S,n=i+T;C=new y(e,i),M=new y(r,i),E=new y(e,n),I=new y(r,n)}if(c){let t;t=n?new y(0,0):w?new y(u[0],u[1]):new y(i[0],i[1]),C._rotateAround(c,t),M._rotateAround(c,t),E._rotateAround(c,t),I._rotateAround(c,t)}const L=new y(0,0),P=new y(0,0);l.push({tl:C,tr:M,bl:E,br:I,texPrimary:r,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:v,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:L,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,o,s,a,n,t.allowVerticalPlacement),v=t.textSizeData;let x=null;"source"===v.kind?(x=[sm*o.layout.get("text-size").evaluate(a,{},g)],x[0]>Bg&&G(`${t.layerIds[0]}: Value for "text-size" is >= ${zg}. Reduce your "text-size".`)):"composite"===v.kind&&(x=[sm*f.compositeTextSizes[0].evaluate(a,{},g),sm*f.compositeTextSizes[1].evaluate(a,{},g)],(x[0]>Bg||x[1]>Bg)&&G(`${t.layerIds[0]}: Value for "text-size" is >= ${zg}. Reduce your "text-size".`)),t.addSymbols(t.text,A,x,l,s,a,u,e,i,c.lineStartIndex,c.lineLength,d,m,g,_,!1);for(const e of h)p[e]=t.text.placedSymbolArray.length-1;return 4*A.length}function Vg(t){for(const e in t)return t[e];return null}function jg(t,e,i,r,n,o,s,a,l,c){let u=s.top,h=s.bottom,p=s.left,d=s.right;const f=s.collisionPadding;if(f&&(p-=f[0],u-=f[1],d+=f[2],h+=f[3]),l){const t=new y(p,u),e=new y(d,u),i=new y(p,h),r=new y(d,h),n=x(l);let o=new y(0,0);c&&(o=new y(c[0],c[1])),t._rotateAround(n,o),e._rotateAround(n,o),i._rotateAround(n,o),r._rotateAround(n,o),p=Math.min(t.x,e.x,i.x,r.x),d=Math.max(t.x,e.x,i.x,r.x),u=Math.min(t.y,e.y,i.y,r.y),h=Math.max(t.y,e.y,i.y,r.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,p,u,d,h,a,r,n,o),t.length-1}function Gg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Zg(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}function qg(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,n=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),o=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),s=Math.sin(t._pitch)*o+n;return Math.min(1.01*s,n*(1/t._horizonShift))}function Wg(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,n=(t.x+1)*i,o=t.y*i,s=(t.y+1)*i,a=gl(r),l=gl(n),c=_l(o),u=_l(s),h=e.project(a,c),p=e.project(l,c),d=e.project(l,u),f=e.project(a,u);let m=Math.min(h.x,p.x,d.x,f.x),g=Math.min(h.y,p.y,d.y,f.y),_=Math.max(h.x,p.x,d.x,f.x),y=Math.max(h.y,p.y,d.y,f.y);const A=i/16;function v(t,i,r,n,o,s){const a=(r+o)/2,l=(n+s)/2,c=e.project(gl(a),_l(l)),u=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),u>A&&(v(t,c,r,n,a,l),v(c,i,a,l,o,s))}v(h,p,r,o,n,o),v(p,d,n,o,n,s),v(d,f,n,s,r,s),v(f,h,r,s,r,o),m-=A,g-=A,_+=A,y+=A;const x=1/Math.max(_-m,y-g);return{scale:x,x:m*x,y:g*x,x2:_*x,y2:y*x,projection:e}}function Hg(t,{x:e,y:i},r=0){return new y(((e-r)*t.scale-t.x)*ki,(i*t.scale-t.y)*ki)}const Jg=t.a6.identity(new Float32Array(16));class Kg{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new el(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return ml(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return qg(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,r){const n=t.horizonLineFromTop(!1),o=new y(e,Math.max(n,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(o,r))}pointCoordinate3D(t,e,i){const r=new y(e,i);if(t.elevation)return t.elevation.pointCoordinate(r);{const e=this.pointCoordinate(t,r.x,r.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return Jg}createTileMatrix(e,i,r){let n,o,s;const a=r.canonical,l=t.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Wg(a,this);n=1,o=c.x+r.wrap*c.scale,s=c.y,t.a6.scale(l,l,[n/c.scale,n/c.scale,e.pixelsPerMeter/i])}else n=i/e.zoomScale(a.z),o=(a.x+Math.pow(2,a.z)*r.wrap)*n,s=a.y*n;return t.a6.translate(l,l,[o,s,0]),t.a6.scale(l,l,[n/ki,n/ki,1]),l}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class $g extends Kg{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],r=Math.sin(x(e));this.n=(r+Math.sin(x(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:r,r0:n}=this,o=x(t-this.center[0]),s=x(e),a=Math.sqrt(r-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-n,z:0}}unproject(t,e){const{n:i,c:r,r0:n}=this,o=n+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=x(this.center[0])*i;s=I(s,-Math.PI-a,Math.PI-a);const l=M(b(s/i)+this.center[0],-180,180),c=Math.asin(M((r-(t*t+o*o)*i*i)/(2*i),-1,1)),u=M(b(c),-Al,Al);return new el(l,u)}}const Yg=1.340264,Xg=-.081106,Qg=893e-6,t_=.003796,e_=Math.sqrt(3)/2;class i_ extends Kg{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(e_*Math.sin(e)),r=i*i,n=r*r*r;return{x:.5*(t*Math.cos(i)/(e_*(Yg+3*Xg*r+n*(7*Qg+9*t_*r)))/Math.PI+.5),y:1-.5*(i*(Yg+Xg*r+n*(Qg+t_*r))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=i*i,n=r*r*r;for(let t,o,s,a=0;a<12&&(o=i*(Yg+Xg*r+n*(Qg+t_*r))-e,s=Yg+3*Xg*r+n*(7*Qg+9*t_*r),t=o/s,i=M(i-t,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(t)<1e-12));++a);const o=e_*t*(Yg+3*Xg*r+n*(7*Qg+9*t_*r))/Math.cos(i),s=Math.asin(Math.sin(i)/e_),a=M(180*o/Math.PI,-180,180),l=M(180*s/Math.PI,-Al,Al);return new el(a,l)}}class r_ extends Kg{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),r=M(360*(.5-e),-Al,Al);return new el(i,r)}}const n_=Math.PI/2;function o_(t){return Math.tan((n_+t)/2)}class s_ extends Kg{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let r=x(e),n=x(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const o=Math.cos(r),s=o_(r);this.n=r===n?Math.sin(r):Math.log(o/Math.cos(n))/Math.log(o_(n)/s),this.f=o*Math.pow(o_(r),this.n)/this.n}project(t,e){e=x(e),this.southernCenter&&(e=-e),t=x(t-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?e<-n_+i&&(e=-n_+i):e>n_-i&&(e=n_-i);const o=n/Math.pow(o_(e),r);let s=o*Math.sin(r*t),a=n-o*Math.cos(r*t);return s=.5*(s/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:s,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:r}=this,n=r-e,o=Math.sign(n),s=Math.sign(i)*Math.sqrt(t*t+n*n);let a=Math.atan2(t,Math.abs(n))*o;n*i<0&&(a-=Math.PI*Math.sign(t)*o);const l=M(b(a/i)+this.center[0],-180,180),c=M(b(2*Math.atan(Math.pow(r/s,1/i))-n_),-Al,Al);return new el(l,this.southernCenter?-c:c)}}class a_ extends Kg{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:dl(t),y:fl(e),z:0}}unproject(t,e){const i=gl(t),r=_l(e);return new el(i,r)}}const l_=x(Al);class c_ extends Kg{project(t,e){const i=(e=x(e))*e,r=i*i;return{x:.5*((t=x(t))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,r=25,n=0,o=i*i;do{o=i*i;const t=o*o;n=(i*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),i=M(i-n,-l_,l_)}while(Math.abs(n)>1e-6&&--r>0);o=i*i;const s=M(b(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=b(i);return new el(s,a)}}const u_=x(Al);class h_ extends Kg{project(t,e){e=x(e),t=x(t);const i=Math.cos(e),r=2/Math.PI,n=Math.acos(i*Math.cos(t/2)),o=Math.sin(n)/n,s=.5*(t*r+2*i*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,r=e=(2*(1-e)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,u=n*n,h=Math.cos(i/2),p=Math.sin(i/2),d=2*h*p,f=p*p,m=1-u*h*h,g=m?1/m:0,_=m?Math.acos(n*h)*Math.sqrt(1/m):0,y=.5*(2*_*n*p+2*i/Math.PI)-t,A=.5*(_*o+r)-e,v=.5*g*(u*f+_*n*h*c)+1/Math.PI,x=g*(d*l/4-_*o*p),b=.125*g*(l*p-_*o*u*d),w=.5*g*(c*h+_*f*n)+.5,S=x*b-w*v;s=(A*x-y*w)/S,a=(y*b-A*v)/S,i=M(i-s,-Math.PI,Math.PI),r=M(r-a,-u_,u_)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new el(b(i),b(r))}}class p_ extends Kg{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(x(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:r}=this;return{x:x(t)*r*i+.5,y:-Math.sin(x(e))/r*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:r}=this,n=-(e-.5)/i,o=M(b((t-.5)/i)/r,-180,180),s=Math.asin(M(n*r,-1,1)),a=M(b(s),-Al,Al);return new el(o,a)}}class d_ extends a_{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const n=Kh(e,i,r),o=Xh(Gh(r));return t.N.transformMat4(n,n,o),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,i){const r=Xa(i.lat,i.lng),n=t.N.normalize([],r),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,s=ml(1,0)*ki*o;t.N.scaleAndAdd(r,r,n,s);const a=t.a6.identity(new Float64Array(16));return t.a6.multiply(a,e.pixelMatrix,e.globeMatrix),t.N.transformMat4(r,r,a),new y(r[0],r[1])}pixelsPerMeter(t,e){return ml(1,0)*e}pixelSpaceConversion(t,e,i){const r=ml(1,t)*e,n=ue(ml(1,45)*e,r,i);return this.pixelsPerMeter(t,e)/n}createTileMatrix(e,i,r){const n=Qh(Gh(r.canonical));return t.a6.multiply(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,i){const{center:r}=e,n=Xh(Gh(i));return t.a6.rotateY(n,n,x(r.lng)),t.a6.rotateX(n,n,x(r.lat)),t.a6.scale(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(t,e,i,r){return Uh(t,e,i,!0)||new Sl(0,0)}pointCoordinate3D(t,e,i){const r=this.pointCoordinate(t,e,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(t,e){return!Uh(t,e.x,e.y,!1)}farthestPixelDistance(e){const i=function(e,i){const r=e.cameraToCenterDistance,n=e._centerAltitude*i,o=e._camera,s=e._camera.forward(),a=t.N.add([],t.N.scale([],s,-r),[0,0,n]),l=e.worldSize/(2*Math.PI),c=[0,0,-l],u=e.width/e.height,h=Math.tan(e.fovAboveCenter),p=t.N.scale([],o.up(),h),d=t.N.scale([],o.right(),h*u),f=t.N.normalize([],t.N.add([],t.N.add([],s,p),d)),m=[];let g;if(new Ch(a,f).closestPointOnSphere(c,l,m)){const i=t.N.add([],m,c),r=t.N.sub([],i,a);g=Math.cos(e.fovAboveCenter)*t.N.length(r)}else{const e=t.N.sub([],a,c),i=t.N.sub([],c,a);t.N.normalize(i,i);const r=t.N.length(e)-l;g=Math.sqrt(r*(r+2*l));const n=Math.acos(g/(l+r))-Math.acos(t.N.dot(s,i));g*=Math.cos(n)}return 1.01*g}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=rp(e.zoom);if(r>0){const t=qg(e,ml(1,e.center.lat)*e.worldSize),n=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ue(i,t+n*(1-Math.cos(o)),Math.pow(r,10))}return i}upVector(t,e,i){return Kh(e,i,t,1)}upVectorScale(t){return{metersToTile:zh($h(Gh(t)))}}}function f_(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new a_(t);case"equirectangular":return new r_(t);case"naturalEarth":return new c_(t);case"equalEarth":return new i_(t);case"winkelTripel":return new h_(t);case"albers":return i?new p_(t):new $g(t);case"lambertConformalConic":return i?new p_(t):new s_(t);case"globe":return new d_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const m_=Ld.types,g_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function __(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=a?Math.min(Bg,Math.round(a[0])):0,f=a?Math.min(Bg,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function y_(t,e,i){t.emplaceBack(e,i)}function A_(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,s)}function v_(t,e,i,r,n){t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n),t.emplaceBack(e,i,r,n)}function x_(t){for(const e of t.sections)if(_o(e.text))return!0;return!1}class b_{constructor(t){this.layoutVertexArray=new ws,this.indexArray=new Ps,this.programConfigurations=t,this.segments=new ra,this.dynamicLayoutVertexArray=new As,this.opacityVertexArray=new Ts,this.placedSymbolArray=new Hs,this.iconTransitioningVertexArray=new Cs,this.globeExtVertexArray=new Ss,this.zOffsetVertexArray=new Ds}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,i,r,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$f.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Xf.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,g_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,tm.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Yf.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Qf.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ro(b_,"SymbolBuffers");class w_{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new ra,this.collisionVertexArray=new Ls,this.collisionVertexArrayExt=new As}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,em.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,im.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ro(w_,"CollisionBuffers");class S_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.a6.identity([]),this.placementViewportMatrix=t.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=am(this.zoom,i["text-size"]),this.iconSizeData=am(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((t=>Gm[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new b_(new Fa(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new b_(new Fa(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new $s,this.lineVertexArray=new Ys,this.symbolInstances=new Ks}calculateGlyphDependencies(t,e,i,r,n){for(let i=0;i<t.length;i++){const o=t.codePointAt(i);if(void 0===o)break;if(e[o]=!0,r&&n&&o<=65535){const r=pm[t.charAt(i)];r&&(e[r.charCodeAt(0)]=!0)}}}populate(e,i,r,n){const o=this.layers[0],s=o.layout,a="globe"===this.projection.name,l=s.get("text-font"),c=s.get("text-field"),u=s.get("icon-image"),h=("constant"!==c.value.kind||c.value.value instanceof Re&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),p="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,d=s.get("symbol-sort-key");if(this.features=[],!h&&!p)return;const f=i.iconDependencies,m=i.glyphDependencies,g=i.availableImages,_=new Lo(this.zoom);for(const{feature:i,id:c,index:u,sourceLayerIndex:y}of e){const e=o._featureFilter.needGeometry,A=Nl(i,e);if(!o._featureFilter.filter(_,A,r))continue;if(e||(A.geometry=kl(i,r,n)),a&&1!==i.type&&r.z<=5){const e=A.geometry,i=.98078528056,n=(e,n)=>{const o=Kh(e.x,e.y,r,1),s=Kh(n.x,n.y,r,1);return t.N.dot(o,s)<i};for(let t=0;t<e.length;t++)e[t]=El(e[t],n)}let v,x;if(h){const t=o.getValueAndResolveTokens("text-field",A,r,g),e=Re.factory(t);x_(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mo()||this.hasRTLText&&Io.isParsed())&&(v=hm(e,o,A))}if(p){const t=o.getValueAndResolveTokens("icon-image",A,r,g);x=t instanceof Fe?t:Fe.fromString(t)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?d.evaluate(A,{},r):void 0;if(this.features.push({id:c,text:v,icon:x,index:u,sourceLayerIndex:y,geometry:A.geometry,properties:i.properties,type:m_[i.type],sortKey:b}),x&&(f[x.namePrimary]=!0,x.nameSecondary&&(f[x.nameSecondary]=!0)),v){const t=l.evaluate(A,{},r).join(","),e="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gm.vertical)>=0;for(const i of v.sections)if(i.image)f[i.image.namePrimary]=!0;else{const r=co(v.toString()),n=i.fontStack||t,o=m[n]=m[n]||{};this.calculateGlyphDependencies(i.text,o,e,this.allowVerticalPlacement,r)}}}"line"===s.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(!p){o(c);continue}const d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){const t=a(d,f,h),n=s(d,f,r[t].geometry);delete e[d],delete i[f],i[l(p,r[n].geometry,!0)]=n,r[t].geometry=null}else d in i?s(d,f,h):f in e?a(d,f,h):(o(c),e[d]=n-1,i[f]=n-1)}return r.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,r,n){const o=0!==Object.keys(t).length;if(o&&!this.stateDependentLayers.length)return;const s=o?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,e,s,i,r,n),this.icon.programConfigurations.updatePaintArrays(t,e,s,i,r,n)}updateZOffset(){const t=(t,e,r)=>{i+=e,i>t.length&&t.resize(i);for(let n=-e;n<0;n++)t.emplace(n+i,r)},e=(t,e,i)=>{r+=e,r>t.length&&t.resize(r);for(let n=-e;n<0;n++)t.emplace(n+r,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,numIconVertices:s}=r,a=r.zOffset,l=s>0;if((n>0||o>0)&&(t(this.text.zOffsetVertexArray,n,a),t(this.text.zOffsetVertexArray,o,a)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:i}=r;t>=0&&e(this.icon.zOffsetVertexArray,s,a),i>=0&&e(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=f_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:i}of e)this.lineVertexArray.emplaceBack(t,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m){const g=t.indexArray,_=t.layoutVertexArray,y=t.globeExtVertexArray,A=t.segments.prepareSegment(4*e.length,_,g,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,x=A.vertexLength,b=this.allowVerticalPlacement&&s===Gm.vertical?Math.PI/2:0,w=o.text&&o.text.sections;for(let r=0;r<e.length;r++){const{tl:n,tr:s,bl:c,br:u,texPrimary:h,texSecondary:v,pixelOffsetTL:x,pixelOffsetBR:S,minFontScaleX:T,minFontScaleY:C,glyphOffset:M,isSDF:E,sectionIndex:I}=e[r],L=A.vertexLength,P=M[1];if(__(_,l.x,l.y,n.x,P+n.y,h.x,h.y,i,E,x.x,x.y,T,C),__(_,l.x,l.y,s.x,P+s.y,h.x+h.w,h.y,i,E,S.x,x.y,T,C),__(_,l.x,l.y,c.x,P+c.y,h.x,h.y+h.h,i,E,x.x,S.y,T,C),__(_,l.x,l.y,u.x,P+u.y,h.x+h.w,h.y+h.h,i,E,S.x,S.y,T,C),a){const{x:e,y:i,z:r}=a.anchor,[n,o,s]=a.up;A_(y,e,i,r,n,o,s),A_(y,e,i,r,n,o,s),A_(y,e,i,r,n,o,s),A_(y,e,i,r,n,o,s),v_(t.dynamicLayoutVertexArray,e,i,r,b)}else v_(t.dynamicLayoutVertexArray,l.x,l.y,l.z,b);if(m){const e=v||h;y_(t.iconTransitioningVertexArray,e.x,e.y),y_(t.iconTransitioningVertexArray,e.x+e.w,e.y),y_(t.iconTransitioningVertexArray,e.x,e.y+e.h),y_(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}g.emplaceBack(L,L+1,L+2),g.emplaceBack(L+1,L+2,L+3),A.vertexLength+=4,A.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(M[0]),r!==e.length-1&&I===e[r+1].sectionIndex||t.programConfigurations.populatePaintArrays(_.length,o,o.index,{},p,d,f,w&&w[I])}const S=a?a.anchor:l;t.placedSymbolArray.emplaceBack(S.x,S.y,S.z,l.x,l.y,v,this.glyphOffsetArray.length-v,x,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,r,n,o,s){t.emplaceBack(e,i,r,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,r,n,o,s){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=a.vertexLength,c=s.tileAnchorX,u=s.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,e,t.padding,s.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new y(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new y(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new y(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,o,c,u,new y(t.x1,t.y2)),a.vertexLength+=4;const h=i.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new w_(Es,rm.members,Cs),this.iconCollisionBox=new w_(Es,rm.members,Cs);const i=cm(this.iconSizeData,t),r=cm(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,i,r){const n=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:r),o=lm(this.textSizeData,t,n)/om;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){const r=this.icon.placedSymbolArray.get(i),n=lm(this.iconSizeData,t,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(t,e,i,r){t.emplaceBack(e,-i,-i,r),t.emplaceBack(e,i,-i,r),t.emplaceBack(e,i,i,r),t.emplaceBack(e,-i,i,r)}_updateTextDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(t,e,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(t,e,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding,o.zOffset)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=cm(this.iconSizeData,t),r=cm(this.textSizeData,t);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};if(e<i){const{x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(e);c.textBox={x1:i,y1:r,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p},c.textFeatureIndex=d}if(r<n){const{x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(r);c.verticalTextBox={x1:e,y1:i,x2:n,y2:o,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p},c.verticalTextFeatureIndex=d}if(o<s){const{x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(o);c.iconBox={x1:e,y1:i,x2:r,y2:n,padding:s,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p},c.iconFeatureIndex=d}if(a<l){const{x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(a);c.verticalIconBox={x1:e,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:h,tileAnchorY:p},c.verticalIconFeatureIndex=d}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.tileAnchorX+i*s.tileAnchorY)),n.push(s.featureIndex)}return o.sort(((t,e)=>r[t]-r[e]||n[e]-n[t])),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:s,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ro(S_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),S_.addDynamicAttributes=v_;const T_=new jo({"symbol-placement":new Bo(qo.layout_symbol["symbol-placement"]),"symbol-spacing":new Bo(qo.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bo(qo.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Uo(qo.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bo(qo.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Bo(qo.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Bo(qo.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Bo(qo.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bo(qo.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bo(qo.layout_symbol["icon-rotation-alignment"]),"icon-size":new Uo(qo.layout_symbol["icon-size"]),"icon-text-fit":new Uo(qo.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Uo(qo.layout_symbol["icon-text-fit-padding"]),"icon-image":new Uo(qo.layout_symbol["icon-image"]),"icon-rotate":new Uo(qo.layout_symbol["icon-rotate"]),"icon-padding":new Bo(qo.layout_symbol["icon-padding"]),"icon-keep-upright":new Bo(qo.layout_symbol["icon-keep-upright"]),"icon-offset":new Uo(qo.layout_symbol["icon-offset"]),"icon-anchor":new Uo(qo.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bo(qo.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bo(qo.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bo(qo.layout_symbol["text-rotation-alignment"]),"text-field":new Uo(qo.layout_symbol["text-field"]),"text-font":new Uo(qo.layout_symbol["text-font"]),"text-size":new Uo(qo.layout_symbol["text-size"]),"text-max-width":new Uo(qo.layout_symbol["text-max-width"]),"text-line-height":new Uo(qo.layout_symbol["text-line-height"]),"text-letter-spacing":new Uo(qo.layout_symbol["text-letter-spacing"]),"text-justify":new Uo(qo.layout_symbol["text-justify"]),"text-radial-offset":new Uo(qo.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bo(qo.layout_symbol["text-variable-anchor"]),"text-anchor":new Uo(qo.layout_symbol["text-anchor"]),"text-max-angle":new Bo(qo.layout_symbol["text-max-angle"]),"text-writing-mode":new Bo(qo.layout_symbol["text-writing-mode"]),"text-rotate":new Uo(qo.layout_symbol["text-rotate"]),"text-padding":new Bo(qo.layout_symbol["text-padding"]),"text-keep-upright":new Bo(qo.layout_symbol["text-keep-upright"]),"text-transform":new Uo(qo.layout_symbol["text-transform"]),"text-offset":new Uo(qo.layout_symbol["text-offset"]),"text-allow-overlap":new Bo(qo.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Bo(qo.layout_symbol["text-ignore-placement"]),"text-optional":new Bo(qo.layout_symbol["text-optional"]),visibility:new Bo(qo.layout_symbol.visibility)});var C_={paint:new jo({"icon-opacity":new Uo(qo.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Uo(qo.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Uo(qo.paint_symbol["text-emissive-strength"]),"icon-color":new Uo(qo.paint_symbol["icon-color"]),"icon-halo-color":new Uo(qo.paint_symbol["icon-halo-color"]),"icon-halo-width":new Uo(qo.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Uo(qo.paint_symbol["icon-halo-blur"]),"icon-translate":new Bo(qo.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bo(qo.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Uo(qo.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Uo(qo.paint_symbol["text-opacity"]),"text-color":new Uo(qo.paint_symbol["text-color"],{runtimeType:be,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Uo(qo.paint_symbol["text-halo-color"]),"text-halo-width":new Uo(qo.paint_symbol["text-halo-width"]),"text-halo-blur":new Uo(qo.paint_symbol["text-halo-blur"]),"text-translate":new Bo(qo.paint_symbol["text-translate"]),"text-translate-anchor":new Bo(qo.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Bo(qo.paint_symbol["icon-color-saturation"])}),layout:T_};class M_{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ye,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ro(M_,"FormatSectionOverride",{omit:["defaultValue"]});class E_ extends ls{constructor(t,e,i){super(t,C_,e,i)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qn(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,n)}createBucket(t){return new S_(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of C_.paint.overridableProperties){if(!E_.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new M_(e),r=new Zn(i,e.property.specification,this.scope,this.options);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new Hn("source",r):new Jn("composite",r,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new Fo(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&E_.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=C_.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Re)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof Ge&&Ue(e.value)===Ce?o(e.value.sections):e instanceof Je?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),e=0!==this.paint.get("text-opacity").constantOr(1),i=[];return t&&i.push("symbolIcon"),e&&i.push("symbolSDF"),i}getDefaultProgramParams(t,e){return{config:new Ra(this,e),overrideFog:!1}}}const I_=new jo({visibility:new Bo(qo.layout_background.visibility)});var L_={paint:new jo({"background-color":new Bo(qo.paint_background["background-color"]),"background-pattern":new Bo(qo.paint_background["background-pattern"]),"background-opacity":new Bo(qo.paint_background["background-opacity"]),"background-emissive-strength":new Bo(qo.paint_background["background-emissive-strength"])}),layout:I_};const P_=new jo({visibility:new Bo(qo.layout_raster.visibility)});var k_={paint:new jo({"raster-opacity":new Bo(qo.paint_raster["raster-opacity"]),"raster-color":new Vo(qo.paint_raster["raster-color"]),"raster-color-mix":new Bo(qo.paint_raster["raster-color-mix"]),"raster-color-range":new Bo(qo.paint_raster["raster-color-range"]),"raster-hue-rotate":new Bo(qo.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bo(qo.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bo(qo.paint_raster["raster-brightness-max"]),"raster-saturation":new Bo(qo.paint_raster["raster-saturation"]),"raster-contrast":new Bo(qo.paint_raster["raster-contrast"]),"raster-resampling":new Bo(qo.paint_raster["raster-resampling"]),"raster-fade-duration":new Bo(qo.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Bo(qo.paint_raster["raster-emissive-strength"]),"raster-array-band":new Bo(qo.paint_raster["raster-array-band"]),"raster-elevation":new Bo(qo.paint_raster["raster-elevation"])}),layout:P_},N_=ps([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class D_{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,e,i){const{width:r,height:n}=t,{context:o}=this,{gl:s}=o;if(s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),i||this.size&&this.size[0]===r&&this.size[1]===n){const{x:e,y:o}=i||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)s.texSubImage2D(s.TEXTURE_2D,0,e,o,s.RGBA,s.UNSIGNED_BYTE,t);else{let i=this.format,a=s.UNSIGNED_BYTE;this.format===s.R32F&&(i=s.RED,a=s.FLOAT),s.texSubImage2D(s.TEXTURE_2D,0,e,o,r,n,i,a,t.data)}}else if(this.size=[r,n],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let e=this.format;this.format===s.R8&&(e=s.RED),s.texImage2D(s.TEXTURE_2D,0,this.format,e,s.UNSIGNED_BYTE,t)}else{let e=this.format,i=this.format,o=s.UNSIGNED_BYTE;this.format===s.DEPTH_COMPONENT&&(e=s.DEPTH_COMPONENT16,o=s.UNSIGNED_SHORT),this.format===s.R8&&(i=s.RED),this.format===s.R32F&&(o=s.FLOAT,i=s.RED),s.texImage2D(s.TEXTURE_2D,0,e,r,n,0,i,o,t.data)}this.useMipmap=Boolean(e&&e.useMipmap),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(t,e,i=!1){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!i?t===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,i,r){const{context:n}=this,{gl:o}=n;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class O_{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrapS=e)}}function R_(e,i,r,n,o,s,a,l){const c=[e,i,1,r,n,1,o,s,1],u=[a,l,1],h=t.co.adjoint([],c),[p,d,f]=t.N.transformMat3(u,u,h);return t.co.multiply(c,c,[p,0,0,0,d,0,0,0,f])}function F_(e,i,r,n,o,s,a,l){const c=function(e,i,r,n,o,s,a,l){const c=R_(0,0,1,0,1,1,0,1),u=R_(e,i,r,n,o,s,a,l),h=t.co.adjoint([],c);return t.co.multiply(u,u,h)}(e,i,r,n,o,s,a,l);return[c[2]/c[8]/ki,c[5]/c[8]/ki]}function z_(t){return[t[0],Math.min(Math.max(t[1],-Al),Al)]}class B_ extends ie{constructor(t,e,i,r){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new te("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Dt(this.map._requestManager.transformRequest(this.url,Tt.Image),((e,i)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new ee(e)):i&&(this.image=i instanceof HTMLImageElement?at.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new O_(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new te("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof O_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],i=t[0][1];for(const r of t)r[1]>i&&(i=r[1]),r[1]<e&&(e=r[1]);const r=(i+e)/2;if(r>Al?this.onNorthPole=!0:r<-Al&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(Sl.fromLngLat);this.tileID=function(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);const o=Math.max(r-e,n-i),s=Math.max(0,Math.floor(-Math.log(o)/Math.LN2)),a=Math.pow(2,s);let l=Math.floor((e+r)/2*a);return l>1&&(l-=1),new ol(s,l,Math.floor((i+n)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new te("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Wg(new ol(0,0,0),this.map.transform.projection),r=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,i=t[1].y-t[0].y,r=t[2].x-t[1].x,n=t[2].y-t[1].y,o=t[3].x-t[2].x,s=t[3].y-t[2].y,a=t[0].x-t[3].x,l=t[0].y-t[3].y,c=e*n-r*i,u=r*s-o*n,h=o*l-a*s,p=a*i-e*l;return c>0&&u>0&&h>0&&p>0||c<0&&u<0&&h<0&&p<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=Wg(this.tileID,this.map.transform.projection),[o,s,a,l]=this.coordinates.map((t=>{const e=n.projection.project(t[0],t[1]);return Hg(n,e)._round()}));this.perspectiveTransform=F_(o.x,o.y,s.x,s.y,a.x,a.y,l.x,l.y);const c=this._boundsArray=new gs;c.emplaceBack(o.x,o.y,0,0),c.emplaceBack(s.x,s.y,ki,0),c.emplaceBack(l.x,l.y,0,ki),c.emplaceBack(a.x,a.y,ki,ki),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(c,N_.members),this.boundsSegments=ra.simpleSegment(0,0,4,2);const u=[],h=[z_((p=this.coordinates)[0]),z_(p[1]),z_(p[2]),z_(p[3])];var p;const[d,f,m,g]=function(t){let e=t[0][0],i=e,r=t[0][1],n=r;for(let o=1;o<t.length;o++)t[o][0]<e?e=t[o][0]:t[o][0]>i&&(i=t[o][0]),t[o][1]<r?r=t[o][1]:t[o][1]>n&&(n=t[o][1]);return[e,r,i-e,n-r]}(h);{const n=new gs,[o,s,a,l]=function(t){let e=t[0].x,i=e,r=t[0].y,n=r;for(let o=1;o<t.length;o++)t[o].x<e?e=t[o].x:t[o].x>i&&(i=t[o].x),t[o].y<r?r=t[o].y:t[o].y>n&&(n=t[o].y);return[e,r,i-e,n-r]}(r),c=t=>[(t.x-o)/a,(t.y-s)/l],[h,p,_,y]=r.map(c),A=function(e,i,r,n,o,s,a,l){const c=R_(0,0,1,0,1,1,0,1),u=R_(e,i,r,n,o,s,a,l),h=t.co.adjoint([],u);return t.co.multiply(c,c,h)}(h[0],h[1],p[0],p[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=F_(h[0],h[1],p[0],p[1],_[0],_[1],y[0],y[1]);const v=(e,i)=>{u.push(e.lng);const r=Math.round((e.lng-d)/m*ki),o=Math.round((e.lat-f)/g*ki),s=c(i),a=t.N.transformMat3([],[s[0],s[1],1],A),l=Math.round(a[0]/a[2]*ki),h=Math.round(a[1]/a[2]*ki);n.emplaceBack(r,o,l,h)},x=r[3].x-r[0].x,b=r[3].y-r[0].y,w=r[2].x-r[1].x,S=r[2].y-r[1].y;for(let t=0;t<65;t++){const e=t/64,n=[r[0].x+e*x,r[0].y+e*b],o=[r[1].x+e*w,r[1].y+e*S],s=o[0]-n[0],a=o[1]-n[1];for(let t=0;t<65;t++){const e=t/64,r={x:n[0]+s*e,y:n[1]+a*e,z:0};v(i.projection.unproject(r.x,r.y),r)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(n,N_.members)}{this.maxLongitudeTriangleSize=0;let t=[],i=new Ps;const r=(e,r,n)=>{i.emplaceBack(e,r,n);const o=u[e],s=u[r],a=u[n],l=Math.min(Math.min(o,s),a),c=Math.max(Math.max(o,s),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,n=i+1,o=i+65,s=o+1;r(i,o,n),r(n,o,s)}[t,i]=function(t,e){const i=Array.from({length:t.length},((t,e)=>e));i.sort(((e,i)=>t[e]-t[i]));const r=[],n=new Ps;for(let o=0;o<i.length;o++){const s=i[o];r.push(t[s]);const a=3*s,l=a+1;n.emplaceBack(e.uint16[a],e.uint16[l],e.uint16[l+1])}return[r,n]}(t,i),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(i)}this.elevatedGlobeSegments=ra.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/ki,0,g/ki,0,0,f,d,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,i=e.gl;!this._dirty||this.texture instanceof O_||(this.texture?this.texture.update(this.image):(this.texture=new D_(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let r=((t,e)=>t+360*Math.round((e-t)/360))(t+180,i[0]);const n=new ra,o=(t,i)=>{n.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-r)<=s){const t=ot(i,0,i.length,r+s);return t===i.length||o(t,nt(i,t+1,i.length,r+360-s)-t),n}r<i[0]&&(r+=360);const a=nt(i,0,i.length,r-s);if(a===i.length)return o(0,i.length),n;o(0,a-0);const l=ot(i,a+1,i.length,r+s);return l!==i.length&&o(l,i.length-l),n}}const U_=(Math.pow(256,2)-1)/16907520;class V_ extends ls{constructor(t,e,i){super(t,k_,e,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(t){return!(t&&t._source instanceof B_&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[i,r]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(r)||i===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=Tp({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,r])}}const j_=new jo({visibility:new Bo(qo["layout_raster-particle"].visibility)});var G_={paint:new jo({"raster-particle-array-band":new Bo(qo["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Bo(qo["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Vo(qo["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Bo(qo["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Bo(qo["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Bo(qo["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Bo(qo["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:j_};class Z_ extends ls{constructor(t,e,i){super(t,G_,e,i),this._updateColorRamp(),this.onRemove=t=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&t.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=at.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isLayerDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Tp({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=at.now()}}class q_ extends ls{constructor(t,e){super(t,{},e),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const W_=new jo({visibility:new Bo(qo.layout_sky.visibility)});var H_={paint:new jo({"sky-type":new Bo(qo.paint_sky["sky-type"]),"sky-atmosphere-sun":new Bo(qo.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Bo(qo.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Bo(qo.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Bo(qo.paint_sky["sky-gradient-radius"]),"sky-gradient":new Vo(qo.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Bo(qo.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Bo(qo.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Bo(qo.paint_sky["sky-opacity"])}),layout:W_};function J_(e,i,r){const n=[0,0,1],o=t.bi.identity([]);return t.bi.rotateY(o,o,r?-x(e)+Math.PI:x(e)),t.bi.rotateX(o,o,-x(i)),t.N.transformQuat(n,n,o),t.N.normalize(n,n)}var K_={paint:new jo({})};function $_(e,i){const r=X_(e.projection,e.zoom,e.width,e.height),n=function(e,i,r,n,o){const s=new el(r.lng-180*Q_,r.lat),a=new el(r.lng+180*Q_,r.lat),l=e.project(s.lng,s.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=Sl.fromLngLat(r);h.y=M(h.y,-1+Q_,1-Q_);const p=h.toLngLat(),d=e.project(p.lng,p.lat),f=Sl.fromLngLat(p);f.x+=Q_;const m=f.toLngLat(),g=e.project(m.lng,m.lat),_=ey(g.x-d.x,g.y-d.y,u),y=Sl.fromLngLat(p);y.y+=Q_;const A=y.toLngLat(),v=e.project(A.lng,A.lat),x=ey(v.x-d.x,v.y-d.y,u),b=Math.abs(_.x)/Math.abs(x.y),w=t.a6.identity([]);t.a6.rotateZ(w,w,-u*(1-(o?0:n)));const S=t.a6.identity([]);return t.a6.scale(S,S,[1,1-(1-b)*n,1]),S[4]=-x.x/x.y*n,t.a6.rotateZ(S,S,u),t.a6.multiply(S,w,S),S}(e.projection,0,e.center,r,i),o=Y_(e);return t.a6.scale(n,n,[o,o,1]),n}function Y_(t){const e=t.projection,i=X_(t.projection,t.zoom,t.width,t.height),r=ty(e,t.center),n=ty(e,el.convert(e.center));return Math.pow(2,r*i+(1-i)*n)}function X_(t,e,i,r,n=1/0){const o=t.range;if(!o)return 0;const s=Math.min(n,Math.max(i,r)),a=Math.log(s/1024)/Math.LN2;return E(o[0]+a,o[1]+a,e)}const Q_=1/4e4;function ty(t,e){const i=M(e.lat,-Al,Al),r=new el(e.lng-180*Q_,i),n=new el(e.lng+180*Q_,i),o=t.project(r.lng,i),s=t.project(n.lng,i),a=Sl.fromLngLat(r),l=Sl.fromLngLat(n),c=s.x-o.x,u=s.y-o.y,h=l.x-a.x,p=l.y-a.y,d=Math.sqrt((h*h+p*p)/(c*c+u*u));return Math.log(d)/Math.LN2}function ey(t,e,i){const r=Math.cos(i),n=Math.sin(i);return{x:t*r-e*n,y:t*n+e*r}}function iy(e,i,r){t.a6.identity(e),t.a6.rotateZ(e,e,x(i[2])),t.a6.rotateX(e,e,x(i[0])),t.a6.rotateY(e,e,x(i[1])),t.a6.scale(e,e,r),t.a6.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ry(e,i,r,n,o,s,a,l){const c=[r[0]-i[0],r[1]-i[1],0],u=[n[0]-i[0],n[1]-i[1],0];if(t.N.length(c)<1e-12||t.N.length(u)<1e-12)return t.bi.identity(e);const h=t.N.cross([],c,u);t.N.normalize(h,h),t.N.subtract(u,n,i),c[2]=(s-o)*l,u[2]=(a-o)*l;const p=c;return t.N.cross(p,c,u),t.N.normalize(p,p),t.bi.rotationTo(e,h,p)}function ny(e,i,r=!1){const n=rp(i.zoom),o=function(e,i,r){const n=i.worldSize,o=[e[12],e[13],e[14]],s=_l(o[1]/n),a=gl(o[0]/n),l=t.a6.identity([]),c=ml(1,s)*n,u=ml(1,0)*n*xl(s,i.zoom),h=1/tp(n);let p=u*h;if(r){const t=X_(i.projection,i.zoom,i.width,i.height,1024);p=h*i.projection.pixelSpaceConversion(i.center.lat,n,t)}const d=Xa(s,a);t.N.add(d,d,t.N.scale([],t.N.normalize([],d),c*p*o[2]));const f=function(e){const i=[e[0],e[1],e[2]];let r=[0,1,0];const n=t.N.cross([],r,i);return t.N.cross(r,i,n),0===t.N.squaredLength(r)&&(r=[0,1,0],t.N.cross(n,i,r)),t.N.normalize(n,n),t.N.normalize(r,r),t.N.normalize(i,i),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],1]}(d);t.a6.scale(l,l,[p,p,p*c]),t.a6.translate(l,l,[-o[0],-o[1],-o[2]]);const m=t.a6.multiply([],i.globeMatrix,f);return t.a6.multiply(m,m,l),t.a6.multiply(m,m,e),m}(e,i,r);if(n>0){const r=function(e,i){const r=i.worldSize,n=ml(1,0)*r*xl(i.center.lat,i.zoom)/tp(r),o=ml(1,i.center.lat)*r,s=t.a6.identity([]);return t.a6.rotateY(s,s,x(i.center.lng)),t.a6.rotateX(s,s,x(i.center.lat)),t.a6.translate(s,s,[0,0,Ga]),t.a6.scale(s,s,[n,n,n*o]),t.a6.translate(s,s,[i.point.x-.5*r,i.point.y-.5*r,0]),t.a6.multiply(s,s,e),t.a6.multiply(s,i.globeMatrix,s)}(e,i);return function(e,i,r){const n=(e,i,r)=>{const n=t.N.length(e),o=t.N.length(i),s=Zh(e,i,r);return t.N.scale(s,s,1/t.N.length(s)*ue(n,o,r))},o=n([e[0],e[1],e[2]],[i[0],i[1],i[2]],r),s=n([e[4],e[5],e[6]],[i[4],i[5],i[6]],r),a=n([e[8],e[9],e[10]],[i[8],i[9],i[10]],r),l=Zh([e[12],e[13],e[14]],[i[12],i[13],i[14]],r);return[o[0],o[1],o[2],0,s[0],s[1],s[2],0,a[0],a[1],a[2],0,l[0],l[1],l[2],1]}(o,r,n)}return o}function oy(t,e,i,r){const n=Nh.projectAabbCorners(r,i);let o=Number.MAX_VALUE,s=-1;for(let t=0;t<n.length;++t){const i=n[t];i[0]=(.5*i[0]+.5)*e.width,i[1]=(.5-.5*i[1])*e.height,i[2]<o&&(s=t,o=i[2])}const a=t=>new y(n[t][0],n[t][1]);let l;switch(s){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(Fl(t,l))return o}const sy=ps([{name:"a_pos_3f",components:3,type:"Float32"}]),ay=ps([{name:"a_color_3f",components:3,type:"Float32"}]),ly=ps([{name:"a_color_4f",components:4,type:"Float32"}]),cy=ps([{name:"a_uv_2f",components:2,type:"Float32"}]),uy=ps([{name:"a_normal_3f",components:3,type:"Float32"}]),hy=ps([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),py=ps([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class dy{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class fy{constructor(){this.instancedDataArray=new Vs,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class my{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,e,i,r){this.tileToMeter=wl(i);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:s,index:a,sourceLayerIndex:l}of t){const t=Nl(o,n);if(!this.layers[0]._featureFilter.filter(new Lo(this.zoom),t,i))continue;const c={id:s,sourceLayerIndex:l,index:a,geometry:n?t.geometry:kl(o,i,r),properties:o.properties,type:o.type,patterns:{}},u=this.addFeature(c,c.geometry,t);u&&e.featureIndex.insert(o,c.geometry,a,l,this.index,this.instancesPerModel[u].instancedDataArray.length,ki/32)}this.lookup=null}update(t,e,i,r){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e in t)i.idToFeaturesIndex.hasOwnProperty(e)&&this.evaluate(i.features[i.idToFeaturesIndex[e]],t[e],i,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const i of r.features){const n=this.layers[0],o=i.feature,s=this.canonical,a=n.paint.get("model-rotation").evaluate(o,{},s),l=n.paint.get("model-scale").evaluate(o,{},s),c=n.paint.get("model-translation").evaluate(o,{},s);t.N.exactEquals(i.rotation,a)&&t.N.exactEquals(i.scale,l)&&t.N.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,r,!0),e=!0)}}return e}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,hy.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}}addFeature(t,e,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!n)return G(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),n;this.instancesPerModel[n]||(this.instancesPerModel[n]=new fy);const o=this.instancesPerModel[n],s=o.instancedDataArray,a=new dy(i,s.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=ki||e.y<0||e.y>=ki)continue;const t=(this.lookupDim-1)/ki,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=s.length;s.resize(r+1),o.instancesEvaluatedElevation.push(0),s.float32[16*r]=e.x,s.float32[16*r+1]=e.y}return a.instancedDataCount=o.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(o.idToFeaturesIndex[t.id]=o.features.length),o.features.push(a),this.evaluate(a,{},o,!1)),n}evaluate(t,e,i,r){const n=this.layers[0],o=t.feature,s=this.canonical,a=t.rotation=n.paint.get("model-rotation").evaluate(o,e,s),l=t.scale=n.paint.get("model-scale").evaluate(o,e,s),c=t.translation=n.paint.get("model-translation").evaluate(o,e,s),u=n.paint.get("model-color").evaluate(o,e,s);u.a=n.paint.get("model-color-mix-intensity").evaluate(o,e,s);const h=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),iy(h,a,l);const p=Math.round(100*u.a)+u.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const n=t.instancedDataOffset+e,o=16*n,a=i.instancedDataArray.float32;let l=0;r&&(l=a[o+6]-i.instancesEvaluatedElevation[n]);const d=0|a[o+1];a[o]=(0|a[o])+u.r/1.05,a[o+1]=d+u.g/1.05,a[o+2]=p,a[o+3]=1/(s.z>10?this.tileToMeter:wl(s,d)),a[o+4]=c[0],a[o+5]=c[1],a[o+6]=c[2]+l,a[o+7]=h[0],a[o+8]=h[1],a[o+9]=h[2],a[o+10]=h[4],a[o+11]=h[5],a[o+12]=h[6],a[o+13]=h[8],a[o+14]=h[9],a[o+15]=h[10],i.instancesEvaluatedElevation[n]=c[2]}}}ro(my,"ModelBucket",{omit:["layers"]}),ro(fy,"PerModelAttributes"),ro(dy,"ModelFeature");const gy=new jo({visibility:new Bo(qo.layout_model.visibility),"model-id":new Uo(qo.layout_model["model-id"])});var _y={paint:new jo({"model-opacity":new Bo(qo.paint_model["model-opacity"]),"model-rotation":new Uo(qo.paint_model["model-rotation"]),"model-scale":new Uo(qo.paint_model["model-scale"]),"model-translation":new Uo(qo.paint_model["model-translation"]),"model-color":new Uo(qo.paint_model["model-color"]),"model-color-mix-intensity":new Uo(qo.paint_model["model-color-mix-intensity"]),"model-type":new Bo(qo.paint_model["model-type"]),"model-cast-shadows":new Bo(qo.paint_model["model-cast-shadows"]),"model-receive-shadows":new Bo(qo.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Bo(qo.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Uo(qo.paint_model["model-emissive-strength"]),"model-roughness":new Uo(qo.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Uo(qo.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Bo(qo.paint_model["model-cutoff-fade-range"])}),layout:gy};const yy=64,Ay={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function vy(e,i,r,n,o,s,a,l,c,u=!1){const h=r.zoom,p=r.project(n),d=xl(n.lat,h),f=1/d;t.a6.identity(e),t.a6.translate(e,e,[p.x+a[0]*f,p.y+a[1]*f,a[2]]);let m=1,g=1;const _=r.worldSize;if(u){if("mercator"===r.projection.name){let e=0;r.elevation&&(e=r.elevation.getAtPointOrZero(new Sl(p.x/_,p.y/_),0));const i=t.a7.transformMat4([],[p.x,p.y,e,1],r.projMatrix)[3]/r.cameraToCenterDistance;m=i,g=i*xl(r.center.lat,h)}else if("globe"===r.projection.name){const i=ny(e,r),o=t.a6.multiply([],r.projMatrix,i),s=[0,0,0,1];t.a7.transformMat4(s,s,o);const a=s[3]/r.cameraToCenterDistance,l=rp(h),c=r.projection.pixelsPerMeter(n.lat,_)*xl(n.lat,h),u=r.projection.pixelsPerMeter(r.center.lat,_)*xl(r.center.lat,h);m=a/ue(c,vl(r.center.lat),l),g=a*d/c,m*=u,g*=u}}else m=f;t.a6.scale(e,e,[m,m,g]);const y=[...e],A=i.orientation,v=[];if(iy(v,[A[0]+o[0],A[1]+o[1],A[2]+o[2]],s),t.a6.multiply(e,y,v),l&&r.elevation){let o=0;const s=[];if(c&&r.elevation){o=function(e,i,r,n,o){const s=i.elevation;if(!s)return 0;const a=Nh.projectAabbCorners(r,n),l=ml(1,o.lat)*i.worldSize,c=function(e,i){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const o of n){const n=e[o.corners[0]],s=e[o.corners[1]],a=e[o.corners[2]],l=[s[0]-n[0],s[1]-n[1],i*(s[2]-n[2])],c=t.N.cross(l,l,[a[0]-n[0],a[1]-n[1],i*(a[2]-n[2])]);t.N.normalize(c,c),o.dotProductWithUp=t.N.dot(c,r)}return n.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),n[0].corners}(a,l),u=a[c[0]],h=a[c[1]],p=a[c[2]],d=a[c[3]],f=s.getAtPointOrZero(new Sl(u[0]/i.worldSize,u[1]/i.worldSize),0),m=s.getAtPointOrZero(new Sl(h[0]/i.worldSize,h[1]/i.worldSize),0),g=s.getAtPointOrZero(new Sl(p[0]/i.worldSize,p[1]/i.worldSize),0),_=s.getAtPointOrZero(new Sl(d[0]/i.worldSize,d[1]/i.worldSize),0),y=(f+_)/2,A=(m+g)/2;return y>A?m<g?ry(e,h,d,u,m,_,f,l):ry(e,p,u,d,g,f,_,l):f<_?ry(e,u,h,p,f,m,g,l):ry(e,d,p,h,_,g,m,l),Math.max(y,A)}(s,r,i.aabb,e,n);const a=t.a6.fromQuat([],s),l=t.a6.multiply([],a,v);t.a6.multiply(e,y,l)}else o=r.elevation.getAtPointOrZero(new Sl(p.x/_,p.y/_),0);0!==o&&(e[14]+=o)}}function xy(t,e,i=!1){t.uploaded||(t.gfxTexture=new D_(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function by(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,sy.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,uy.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,cy.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?ay:ly).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,py.members,!0)),t.segments=ra.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const r=t.material;r.pbrMetallicRoughness.baseColorTexture&&xy(r.pbrMetallicRoughness.baseColorTexture,e),r.pbrMetallicRoughness.metallicRoughnessTexture&&xy(r.pbrMetallicRoughness.metallicRoughnessTexture,e),r.normalTexture&&xy(r.normalTexture,e),r.occlusionTexture&&xy(r.occlusionTexture,e,i),r.emissionTexture&&xy(r.emissionTexture,e)}function wy(t,e,i){if(t.meshes)for(const r of t.meshes)by(r,e,i);if(t.children)for(const r of t.children)wy(r,e,i)}function Sy(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Sy(e)}function Ty(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)Ty(e)}class Cy{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class My{constructor(){this.tasks={},this.taskQueue=[],F(["process"],this),this.invoker=new Cy(this.process),this.nextId=0}add(t,e){const i=this.nextId++,r=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===r){H();try{t()}finally{}return null}return this.tasks[i]={fn:t,metadata:e,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){H();try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<e&&(e=r.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class Ey{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},F(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new My}send(t,e,i,r,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=new Set;return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:so(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||H()){const t=this.callbacks[i],r=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"});r&&(this.cancelCallbacks[i]=r)}else this.processTask(i,e)}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(ao(e.error)):i(null,ao(e.data)))}else{const i=new Set,r=e.hasCallback?(e,r)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?so(e):null,data:so(r,i)},i)}:t=>{},n=ao(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,n,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],n.source,n.scope)[t[1]](n,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Iy{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=N();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const r=new Iy.Actor(i[t],e,this.id);r.name=`Worker ${t}`,this.actors.push(r)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,e,i){L(this.actors,((i,r)=>{i.send(t,e,r)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}Iy.Actor=Ey;var Ly={workerUrl:"",workerClass:null,workerParams:void 0};function Py(){return null!=Ly.workerClass?new Ly.workerClass:new self.Worker(Ly.workerUrl,Ly.workerParams)}const ky="mapboxgl_preloaded_worker_pool";class Ny{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ny.workerCount;)this.workers.push(new Py);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ky]}numActive(){return Object.keys(this.active).length}}let Dy;function Oy(){return Dy||(Dy=new Ny),Dy}Ny.workerCount=2;let Ry,Fy,zy,By,Uy,Vy=null;function jy(){return H()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Fy||n.DRACO_URL}function Gy(){if(H()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(By)return By;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return By=WebAssembly.validate(t)?n.MESHOPT_SIMD_URL:n.MESHOPT_URL,By}const Zy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qy={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Hy(t,e,i){const r=i.json.bufferViews.length,n=i.buffers.length;e.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:t.byteLength},i.buffers[n]=t}const Jy="KHR_draco_mesh_compression";function Ky(t,e){const i=t.extensions&&t.extensions[Jy];if(!i)return;const r=new zy.Decoder,n=iA(e,i.bufferView),o=new zy.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=e.json.accessors[t.indices],a=Zy[s.componentType],l=s.count*a.BYTES_PER_ELEMENT,c=zy._malloc(l);a===Uint16Array?r.GetTrianglesUInt16Array(o,l,c):r.GetTrianglesUInt32Array(o,l,c),Hy(zy.memory.buffer.slice(c,c+l),s,e),zy._free(c);for(const n of Object.keys(i.attributes)){const s=r.GetAttributeByUniqueId(o,i.attributes[n]),a=e.json.accessors[t.attributes[n]],l=qy[a.componentType],c=a.count*Wy[a.type]*Zy[a.componentType].BYTES_PER_ELEMENT,u=zy._malloc(c);r.GetAttributeDataArrayForAllPoints(o,s,zy[l],c,u),Hy(zy.memory.buffer.slice(u,u+c),a,e),zy._free(u)}r.destroy(),o.destroy(),delete t.extensions[Jy]}const $y="EXT_meshopt_compression";function Yy(t,e){if(!t.extensions||!t.extensions[$y])return;const i=t.extensions[$y],r=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),n=new Uint8Array(i.count*i.byteStride);Uy.decodeGltfBuffer(n,i.count,i.byteStride,r,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=n.buffer,delete t.extensions[$y]}const Xy=1179937895,Qy=new TextDecoder("utf8");function tA(t,e){return new URL(t,e).href}function eA(t,e,i,r){return fetch(tA(t.uri,r)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[i]=t}))}function iA(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function rA(t,e,i,r){if(t.uri){const n=tA(t.uri,r);return fetch(n).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[i]=t}))}if(void 0!==t.bufferView){const r=iA(e,t.bufferView),n=new Blob([r],{type:t.mimeType});return createImageBitmap(n).then((t=>{e.images[i]=t}))}}function nA(t,e=0,i){const r={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Xy){const i=new Uint32Array(t,e);let n=2;const o=(i[n++]>>2)-3,s=i[n++]>>2;if(n++,r.json=JSON.parse(Qy.decode(i.subarray(n,n+s))),n+=s,n<o){const o=i[n++];n++;const s=e+(n<<2);r.buffers[0]=t.slice(s,s+o)}}else r.json=JSON.parse(Qy.decode(new Uint8Array(t,e)));const{buffers:n,images:o,meshes:s,extensionsUsed:a,bufferViews:l}=r.json;let c=Promise.resolve();if(n){const t=[];for(let e=0;e<n.length;e++){const o=n[e];o.uri?t.push(eA(o,r,e,i)):r.buffers[e]||(r.buffers[e]=null)}c=Promise.all(t)}return c.then((()=>{const t=[],e=a&&a.includes(Jy),n=a&&a.includes($y);if(e&&t.push(function(){if(!zy)return Ry||(Ry=function(t){let e,i=null;function r(){e=new Uint8Array(i.buffer)}function n(){throw new Error("Unexpected Draco error.")}const o={a:{a:n,d:function(t,i,r){return e.copyWithin(t,i,i+r)},c:function(t){const n=e.length,o=Math.max(t>>>0,Math.ceil(1.2*n)),s=Math.ceil((o-n)/65536);try{return i.grow(s),r(),!0}catch(t){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,o):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,o)))).then((t=>{const{Rb:n,Qb:o,P:s,T:a,X:l,Ja:c,La:u,Qa:h,Va:p,Wa:d,eb:f,jb:m,f:g,e:_,yb:y,zb:A,Ab:v,Bb:x,Db:b,Gb:w}=t.instance.exports;i=_;const S=(()=>{let t=0,i=0,r=0,s=0;return a=>{r&&(n(s),n(t),i+=r,r=t=0),t||(i+=128,t=o(i));const l=a.length+7&-8;let c=t;l>=i&&(r=l,c=s=o(l));for(let t=0;t<a.length;t++)e[c+t]=a[t];return c}})();return r(),g(),{memory:_,_free:n,_malloc:o,Mesh:class{constructor(){this.ptr=s()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(t,e,i){const r=S(t),n=u(this.ptr,r,e,i.ptr);return!!l(n)}GetAttributeByUniqueId(t,e){return{ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,i){p(this.ptr,t.ptr,e,i)}GetTrianglesUInt32Array(t,e,i){d(this.ptr,t.ptr,e,i)}GetAttributeDataArrayForAllPoints(t,e,i,r,n){f(this.ptr,t.ptr,e.ptr,i,r,n)}},DT_INT8:y(),DT_UINT8:A(),DT_INT16:v(),DT_UINT16:x(),DT_UINT32:b(),DT_FLOAT32:w()}}))}(fetch(jy())),Ry.then((t=>{zy=t,Ry=void 0})))}()),n&&t.push(function(){if(Uy)return;const t=function(t){let e;const i=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors()})),r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(t,i,o,s,a,l){!function(t,e,i,r,n,o,s){const a=t.exports.sbrk,l=r+3&-4,c=a(l*n),u=a(o.length),h=new Uint8Array(t.exports.memory.buffer);h.set(o,u);const p=e(c,r,n,u,o.length);if(0===p&&s&&s(c,l,n),i.set(h.subarray(c,c+r*n)),a(c-a(0)),0!==p)throw new Error(`Malformed buffer data: ${p}`)}(e,e.exports[n[a]],t,i,o,s,e.exports[r[l]])}}}(fetch(Gy()));return t.ready.then((()=>{Uy=t}))}()),o)for(let e=0;e<o.length;e++)t.push(rA(o[e],r,e,i));return(t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&s)for(const{primitives:t}of s)for(const e of t)Ky(e,r);if(n&&s&&l)for(const t of l)Yy(t,r);return r}))}))}class oA{constructor(t,e,i){if(this.triangleCount=e.length/3,this.min=new y(0,0),this.max=new y(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length||0===i)return;const r=t.map((t=>t.x)),n=t.map((t=>t.y));this.min=new y(Math.min(...r),Math.min(...n)),this.max=new y(Math.max(...r),Math.max(...n));const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const a=[];for(let i=0;i<this.triangleCount;i++){const r=t[e[3*i+0]].sub(this.min),n=t[e[3*i+1]].sub(this.min),o=t[e[3*i+2]].sub(this.min),l=sA(Math.floor(Math.min(r.x,n.x,o.x)),this.xScale,this.cellsX),c=sA(Math.floor(Math.max(r.x,n.x,o.x)),this.xScale,this.cellsX),u=sA(Math.floor(Math.min(r.y,n.y,o.y)),this.yScale,this.cellsY),h=sA(Math.floor(Math.max(r.y,n.y,o.y)),this.yScale,this.cellsY),p=new y(0,0),d=new y(0,0),f=new y(0,0),m=new y(0,0);for(let t=u;t<=h;++t){p.y=d.y=t*s,f.y=m.y=(t+1)*s;for(let e=l;e<=c;++e)p.x=f.x=e*s,d.x=m.x=(e+1)*s,($l(r,n,o,p,d,m)||$l(r,n,o,p,m,f))&&a.push({cellIdx:t*this.cellsX+e,triIdx:i})}}if(0===a.length)return;a.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let l=0;for(;l<a.length;){const t=a[l].cellIdx,e={start:this.payload.length,len:0};for(;l<a.length&&a[l].cellIdx===t;)++e.len,this.payload.push(a[l++].triIdx);this.cells[t]=e}}query(t,e,i){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let t=0;t<this.lookup.length;t++)this.lookup[t]=0;const r=sA(t.x-this.min.x,this.xScale,this.cellsX),n=sA(e.x-this.min.x,this.xScale,this.cellsX),o=sA(t.y-this.min.y,this.yScale,this.cellsY),s=sA(e.y-this.min.y,this.yScale,this.cellsY);for(let t=o;t<=s;t++)for(let e=r;e<=n;e++){const r=this.cells[t*this.cellsX+e];if(r)for(let t=0;t<r.len;t++){const e=this.payload[r.start+t],n=Math.floor(e/8),o=1<<e%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,i.push(e),i.length===this.triangleCount))return}}}}function sA(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function aA(t,e){const i=t.json.bufferViews[e.bufferView],r=Zy[e.componentType];return new r(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Wy[e.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:Wy[e.type]))}function lA(t,e,i,r){const n=Zy[e.componentType],o=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),s=t.json.bufferViews[e.bufferView],a=s.byteStride?s.byteStride/n.BYTES_PER_ELEMENT:Wy[e.type],l=i.float32,c=l.length/i.capacity;for(let t=0,i=0;t<e.count*a;t+=a,i+=c)for(let e=0;e<c;e++)l[i+e]=r[t+e]*o;i._trim()}function cA(t,e,i){const r=t.indices,n=t.attributes,o={};o.indexArray=new Ps;const s=e.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const l=aA(e,s);for(let t=0;t<a;t++)o.indexArray.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);o.indexArray._trim(),o.vertexArray=new Bs;const c=e.json.accessors[n.POSITION];o.vertexArray.reserve(c.count);const u=aA(e,c);for(let t=0;t<c.count;t++)o.vertexArray.emplaceBack(u[3*t],u[3*t+1],u[3*t+2]);if(o.vertexArray._trim(),o.aabb=new Nh(c.min,c.max),o.centroid=function(t,e){const i=[0,0,0],r=t.length;if(r>0){for(let n=0;n<r;n++){const r=3*t[n];i[0]+=e[r],i[1]+=e[r+1],i[2]+=e[r+2]}i[0]/=r,i[1]/=r,i[2]/=r}return i}(l,u),void 0!==n.COLOR_0){const t=e.json.accessors[n.COLOR_0],i=Wy[t.type],r=aA(e,t);o.colorArray=3===i?new Bs:new As,o.colorArray.resize(t.count),lA(e,t,o.colorArray,r)}if(void 0!==n.NORMAL){o.normalArray=new Bs;const t=e.json.accessors[n.NORMAL];o.normalArray.resize(t.count);const i=aA(e,t);lA(e,t,o.normalArray,i)}if(void 0!==n.TEXCOORD_0&&i.length>0){o.texcoordArray=new Us;const t=e.json.accessors[n.TEXCOORD_0];o.texcoordArray.resize(t.count);const i=aA(e,t);lA(e,t,o.texcoordArray,i)}if(void 0!==n._FEATURE_ID_RGBA4444){const t=e.json.accessors[n._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=aA(e,t))}void 0!==n._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(aA(e,e.json.accessors[n._FEATURE_RGBA4444]).buffer));const h=t.material;return o.material=function(t,e){const{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:o,occlusionTexture:s,emissiveTexture:a,doubleSided:l}=t,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:h=1,baseColorTexture:p,metallicRoughnessTexture:d}=t.pbrMetallicRoughness||{},f=s?e[s.index]:void 0;if(s&&s.extensions&&s.extensions.KHR_texture_transform&&f){const t=s.extensions.KHR_texture_transform;f.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ce(...c),metallicFactor:u,roughnessFactor:h,baseColorTexture:p?e[p.index]:void 0,metallicRoughnessTexture:d?e[d.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:o?e[o.index]:void 0,occlusionTexture:f,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},i),o}function uA(e,i,r){const{matrix:n,rotation:o,translation:s,scale:a,mesh:l,extras:c,children:u}=e,h={};if(h.matrix=n||t.a6.fromRotationTranslationScale([],o||[0,0,0,1],s||[0,0,0],a||[1,1,1]),void 0!==l){h.meshes=r[l];const t=h.anchor=[0,0];for(const e of h.meshes){const{min:i,max:r}=e.aabb;t[0]+=i[0]+r[0],t[1]+=i[1]+r[1]}t[0]=Math.floor(t[0]/h.meshes.length/2),t[1]=Math.floor(t[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.codePointAt(t);return i}(t),i=[],r=e.length/24,n=new Uint16Array(e.buffer),o=new Float32Array(e.buffer);for(let t=0;t<r;t++){const e=n[2*t*6]/30,r=n[2*t*6+1]/30,s=n[2*t*6+10]/100,a=o[6*t+1],l=o[6*t+2],c=o[6*t+3],u=o[6*t+4],h=c-a,p=u-l,d=Math.hypot(h,p);i.push({pos:[a+.5*h,l+.5*p,r],normal:[p/d,-h/d,0],width:d,height:e,depth:s,points:[a,l,c,u]})}return i}(c.lights))),u){const t=[];for(const e of u)t.push(uA(i.json.nodes[e],i,r));h.children=t}return h}function hA(t){if(0===t.vertices.length||0===t.indices.length)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let r=1;r<t.vertices.length;++r){const n=t.vertices[r];e.x=Math.min(e.x,n.x),e.y=Math.min(e.y,n.y),i.x=Math.max(i.x,n.x),i.y=Math.max(i.y,n.y)}const r=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),n=Math.max(8,r),o=new oA(t.vertices,t.indices,n);return{vertices:t.vertices,indices:t.indices,grid:o,min:e,max:i}}function pA(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const i=e[0];if(!i||!Array.isArray(i)||0===i.length)return null;const r=[];for(const t of i){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],i=t[1];"number"==typeof e&&"number"==typeof i&&r.push(new y(e,i))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let t=0;t<r.length;t++){const e=r[t],i=r[(t+1)%r.length],o=r[(t+2)%r.length];n+=(e.x-i.x)*(o.y-i.y)-(o.x-i.x)*(e.y-i.y)}n>0&&r.reverse();const o=rd(r.flatMap((t=>[t.x,t.y])),[]);return 0===o.length?null:{vertices:r,indices:o}}function dA(t){const e=[],i=[];let r=0;for(const n of t){r=e.length;const t=n.vertexArray.float32,o=n.indexArray.uint16;for(let i=0;i<n.vertexArray.length;i++)e.push(new y(t[3*i+0],t[3*i+1]));for(let t=0;t<3*n.indexArray.length;t++)i.push(o[t]+r)}if(i.length%3!=0)return null;for(let t=0;t<i.length;t+=3){const r=e[i[t+0]],n=e[i[t+1]],o=e[i[t+2]];(r.x-n.x)*(o.y-n.y)-(o.x-n.x)*(r.y-n.y)>0&&([i[t+1],i[t+2]]=[i[t+2],i[t+1]])}return{vertices:e,indices:i}}function fA(t){const e=function(t,e){const i=[],r=WebGL2RenderingContext;if(t.json.textures)for(const n of t.json.textures){const o={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==n.sampler&&Object.assign(o,t.json.samplers[n.sampler]),i.push({image:e[n.source],sampler:o,uploaded:!1})}return i}(t,t.images),i=function(t,e){const i=[];for(const r of t.json.meshes){const n=[];for(const i of r.primitives)n.push(cA(i,t,e));i.push(n)}return i}(t,e),{scenes:r,scene:n,nodes:o}=t.json,s=r?r[n||0].nodes:o,a=[];for(const e of s)a.push(uA(o[e],t,i));return function(t,e,i){const r={},n=new Set;for(let o=0;o<t.length;o++){const t=i[e[o]];if(!t.extras)continue;const s=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(s||a)&&n.add(o),"1.0.0"===s&&a&&(r[a]=o)}for(let o=0;o<t.length;o++){if(n.has(o))continue;const s=t[o],a=i[e[o]];if(!a.extras)continue;let l=null;s.id in r&&(l=dA(t[r[s.id]].meshes)),l||(l=pA(a)),l&&(s.footprint=hA(l))}if(n.size>0){const e=Array.from(n.values()).sort(((t,e)=>t-e));for(let i=e.length-1;i>=0;i--)t.splice(e[i],1)}}(a,s,t.json.nodes),a}function mA(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,r=t.aabb.min[1]-1,n=yy/(t.aabb.max[0]-i+2),o=yy/(t.aabb.max[1]-r+2);for(let s=0;s<e.length;s+=3){const a=e[s+2],l=(e[s+0]-i)*n|0,c=(e[s+1]-r)*o|0;a>t.heightmap[c*yy+l]&&(t.heightmap[c*yy+l]=a)}}function gA(e,i){const r={};r.indexArray=new Ps,r.indexArray.reserve(4*e.length),r.vertexArray=new Bs,r.vertexArray.reserve(10*e.length),r.colorArray=new As,r.vertexArray.reserve(10*e.length);let n=0;for(const o of e){const e=Math.min(10,Math.max(4,1.3*o.height))*i,s=[-o.normal[1],o.normal[0],0],a=Math.min(.29,.1*o.width/o.depth),l=o.width-2*o.depth*i*(a+.01),c=t.N.scaleAndAdd([],o.pos,s,l/2),u=t.N.scaleAndAdd([],o.pos,s,-l/2),h=[c[0],c[1],c[2]+o.height],p=[u[0],u[1],u[2]+o.height],d=t.N.scaleAndAdd([],o.normal,s,a);t.N.scale(d,d,e);const f=t.N.scaleAndAdd([],o.normal,s,-a);t.N.scale(f,f,e),t.N.add(d,c,d),t.N.add(f,u,f),c[2]+=.1,u[2]+=.1,r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/e/2;r.colorArray.emplaceBack(-m-a,-1,m,.8),r.colorArray.emplaceBack(m+a,-1,m,.8),r.colorArray.emplaceBack(-m,0,m,1.3),r.colorArray.emplaceBack(m,0,m,1.3),r.colorArray.emplaceBack(m+a,-.8,m,.7),r.colorArray.emplaceBack(m+a,-.8,m,.7),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(m+a,-1.2,m,.8),r.colorArray.emplaceBack(m+a,-1.2,m,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const o={defined:!0,emissiveFactor:[0,0,0]},s={};return s.baseColorFactor=ce.white,o.pbrMetallicRoughness=s,r.material=o,r.aabb=new Nh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}ro(oA,"TriangleGridIndex");class _A{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const yA=["tile","layer","source","sourceLayer","state"];class AA{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of yA)void 0!==this[e]&&(t[e]=this[e]);return t}}class vA{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new eo(ki,16,0),this.featureIndexArray=new Qs,this.promoteId=e,this.is3DTile=!1}insert(t,e,i,r,n,o=0,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,o);const l=this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}0!==s&&(r[0]-=s,r[1]-=s,r[2]+=s,r[3]+=s),r[0]<ki&&r[1]<ki&&r[2]>=0&&r[3]>=0&&l.insert(a,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Id(new Fm(this.rawTileData)).layers,this.sourceLayerCoder=new _A(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},o=Ho(n.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,i,r)=>Hl(s.bufferedTilespaceGeometry,t,e,i,r)));c.sort(bA);let u=null;a.elevation&&c.length>0&&(u=Yd.create(a.elevation,this.tileID));const h={};let p;for(let l=0;l<c.length;l++){const d=c[l];if(d===p)continue;p=d;const f=this.featureIndexArray.get(d);let m=null;if(this.is3DTile){const t=this.bucketLayerIDs[0][0],i=e[t];if("model"!==i.type)continue;const{queryFeature:r,intersectionZ:n}=i.queryIntersectsMatchingFeature(s,f.featureIndex,o,a);r&&this.appendToResult(h,t,f.featureIndex,r,n)}else this.loadMatchingFeature(h,f,o,n.layers,n.availableImages,e,i,r,((e,i,r,n=0)=>(m||(m=kl(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(s,e,r,m,this.z,t.transform,t.pixelPosMatrix,u,n))))}return h}loadMatchingFeature(t,e,i,r,n,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:p}=e,d=this.bucketLayerIDs[u];if(r&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(r,d))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const t=Nl(m,!0);if(!i.filter(new Lo(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Lo(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let e=0;e<d.length;e++){const i=d[e];if(r&&r.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=!l||l(m,u,h,p);if(!f)continue;const _=new AA(m,this.z,this.x,this.y,g),y=P({},s[i]);y.paint=xA(y.paint,u.paint,m,h,n),y.layout=xA(y.layout,u.layout,m,h,n),_.layer=y,this.appendToResult(t,i,c,_,f)}}appendToResult(t,e,i,r,n){let o=t[e];void 0===o&&(o=t[e]=[]),o.push({featureIndex:i,feature:r,intersectionZ:n})}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Ho(n);for(const n of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:n,layoutVertexArrayOffset:0},c,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[e])return n[e];const o=this.vtLayers[r].feature(e);return n[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=r&&(i=t.properties[r]),"boolean"==typeof i&&(i=Number(i))}return i}}function xA(t,e,i,r,n){return B(t,((t,o)=>{const s=e instanceof zo?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function bA(t,e){return e-t}ro(vA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const wA=new Float32Array(262144),SA=new Uint8Array(262144);function TA(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,TA(i));return e}function CA(t,e,i){if(t.meshes)for(const r of t.meshes)r.aabb.min[0]!==1/0&&i.insert(e,r.aabb.min[0],r.aabb.min[1],r.aabb.max[0],r.aabb.max[1]);if(t.children)for(const r of t.children)CA(r,e,i)}const MA=["","wall","door","roof","window","lamp","logo"];class EA{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:TA(t)}}}getLocalBounds(){if(!this.node.meshes)return new Nh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new Nh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==t&&e.encapsulate(i.aabb),t++;this.aabb=e}return this.aabb}}class IA{constructor(t,e,i,r,n,o){this.id=e,this.modelTraits|=Ay.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=Ay.HasMapboxMeshFeatures),r&&(this.modelTraits|=Ay.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const e of t)this.nodesInfo.push(new EA(e)),CA(e,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const i of e){const e=i.node;this.uploaded?this.updatePbrBuffer(e):wy(e,t,!0)}for(const t of e)Sy(t.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),e=!0);return e}needsReEvaluation(t,e,i){const r=t.transform.projectionOptions,n=t.style.getBrightness(),o=this.brightness!==n;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||LA(i.paint.get("model-color").value,o)||LA(i.paint.get("model-color-mix-intensity").value,o)||LA(i.paint.get("model-roughness").value,o)||LA(i.paint.get("model-emissive-strength").value,o)||LA(i.paint.get("model-height-based-emissive-strength-multiplier").value,o))&&(this.projection=r,this.brightness=n,!0)}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const t of i){const i=t.feature;t.evaluatedScale=e.paint.get("model-scale").evaluate(i,{},r)}}evaluate(t){const e=this.getNodesInfo();for(const i of e){if(!i.node.meshes)continue;const e=i.feature,r=i.node.meshes&&i.node.meshes[0].featureData,n=i.evaluatedColor[2],o=i.evaluatedRMEA[2],s=this.id.canonical;if(i.hasTranslucentParts=!1,r){for(let r=0;r<MA.length;r++){const n=MA[r];n.length&&(e.properties.part=n);const o=t.paint.get("model-color").evaluate(e,{},s),a=t.paint.get("model-color-mix-intensity").evaluate(e,{},s);i.evaluatedColor[r]=[o.r,o.g,o.b,a],i.evaluatedRMEA[r][0]=t.paint.get("model-roughness").evaluate(e,{},s),i.evaluatedRMEA[r][2]=t.paint.get("model-emissive-strength").evaluate(e,{},s),i.evaluatedRMEA[r][3]=o.a,i.emissionHeightBasedParams[r]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(e,{},s),!i.hasTranslucentParts&&o.a<1&&(i.hasTranslucentParts=!0)}delete e.properties.part,kA(i,n!==i.evaluatedColor[2]||o!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(e,{},s);i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},s),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,i,r){const n=t.findDEMTileFor(i);if(n&&(n.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const e=Yd.create(t,i,n);if(!e)return;this.modelTraits&Ay.HasMapboxMeshFeatures&&this.updateDEM(t,e,i,r);for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const r=i.footprint.vertices;let n=e.getElevationAt(r[0].x,r[0].y,!0,!0);for(let t=1;t<r.length;t++)n=Math.min(n,e.getElevationAt(r[t].x,r[t].y,!0,!0));i.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,i,r){let n=e._dem._modifiedForSources[r];if(void 0===n&&(e._dem._modifiedForSources[r]=[],n=e._dem._modifiedForSources[r]),n.includes(i.canonical))return;const o=e._dem.dim;n.push(i.canonical);let s=!1;for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.grid)continue;const r=i.footprint.grid,n=e.tileCoordToPixel(r.min.x,r.min.y),a=e.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-a.y,n.x),Math.min(n.y,o-a.x));if(l<0)continue;const c=M(l,2,5);let u=Math.max(0,n.x-c),h=Math.max(0,n.y-c),p=Math.min(a.x+c,o-1),d=Math.min(a.y+c,o-1);for(let t=h;t<=d;++t)for(let e=u;e<=p;++e)SA[t*o+e]=255;let f=0,m=0;for(let t=0;t<r.cellsY;++t)for(let i=0;i<r.cellsX;++i){if(!r.cells[t*r.cellsX+i])continue;const n=e.tileCoordToPixel(r.min.x+i/r.xScale,r.min.y+t/r.yScale),s=e.tileCoordToPixel(r.min.x+(i+1)/r.xScale,r.min.y+(t+1)/r.yScale);for(let t=n.y;t<=Math.min(s.y+1,o-1);++t)for(let i=n.x;i<=Math.min(s.x+1,o-1);++i)255===SA[t*o+i]&&(SA[t*o+i]=0,f+=e.getElevationAtPixel(i,t),m++)}const g=f/m;u=Math.max(1,n.x-c),h=Math.max(1,n.y-c),p=Math.min(a.x+c,o-2),d=Math.min(a.y+c,o-2),s=!0;for(let t=h;t<=d;++t)for(let i=u;i<=p;++i)0===SA[t*o+i]&&(wA[t*o+i]=e._dem.set(i,t,g));for(let t=1;t<c;++t){u=Math.max(1,n.x-t),h=Math.max(1,n.y-t),p=Math.min(a.x+t,o-2),d=Math.min(a.y+t,o-2);for(let i=h;i<=d;++i)for(let r=u;r<=p;++r){const n=i*o+r;if(255===SA[n]){let s=0,a=0,l=-1,u=-1;for(let e=-1;e<=1;++e)for(let n=-1;n<=1;++n){const c=(i+e)*o+r+n;if(SA[c]>=t)continue;const h=wA[c],p=Math.abs(h);p>a&&(s=h,a=p,l=n,u=e)}if(a>.1){const o=1-(t+.5*Math.abs(l*u))/c;let a=e._dem.get(r,i)+s*o;const h=e._dem.get(r+l,i+u),p=e._dem.get(r-l,i-u,!0);(a-h)*(a-p)>0&&(a=(h+p)/2),wA[n]=e._dem.set(r,i,a),SA[n]=t}}}}}s&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=at.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)Sy(e.node),Ty(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped()),r=this.getNodesInfo();for(let t=0;t<this.nodesInfo.length;t++){const e=r[t].node;r[t].hiddenByReplacement=!!e.footprint&&!i.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(t,e){const i=this.getNodesInfo(),r=[];for(let n=0;n<this.nodesInfo.length;n++){const o=i[n],s=o.node.meshes[0];if(t<s.aabb.min[0]||e<s.aabb.min[1]||t>s.aabb.max[0]||e>s.aabb.max[1])continue;const a=(t-s.aabb.min[0])/(s.aabb.max[0]-s.aabb.min[0])*yy|0,l=Math.min(63,(e-s.aabb.min[1])/(s.aabb.max[1]-s.aabb.min[1])*yy|0)*yy+Math.min(63,a);if(!(s.heightmap[l]<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:s.heightmap[l],maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new y(t,e),new y(t,e),r),r.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function LA(t,e){return!t.isLightConstant&&e}function PA(t,e,i,r,n,o,s,a){let l=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,u=240&e|(240&e)>>4;i[3]>0&&(l=ue(l,255*i[0],i[3]),c=ue(c,255*i[1],i[3]),u=ue(u,255*i[2],i[3]));const h=l<<8|c,p=u<<8|Math.floor(255*r[3]),d=function(t){const e=M(t,0,2);return Math.min(Math.round(.5*e*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=M(n[0],0,1),m=M(n[1],0,1),g=M(n[2],0,1),_=M(n[3],0,1);let y,A,v,x;if(f!==m&&s!==o&&m!==f){const t=s-o;A=1/(t*(m-f)),v=-(o+t*f)/(t*(m-f));const e=M(n[4],-1,1);x=Math.pow(10,e),y=255*g<<8|255*_}else y=65535,A=0,v=1,x=1;if(t.emplaceBack(h,p,d,y,A,v,x),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(h,p,d,y,A,v,x)}}function kA(t,e,i){const r=t.node;let n=0;const o=i&Ay.HasMeshoptCompression;for(const i of r.meshes){if(r.lights&&r.lightMeshIndex===n)continue;if(!i.featureData)continue;i.featureArray=new js,i.featureArray.reserve(i.featureData.length);let s=e;for(const e of i.featureData){const n=o?65535&e:e>>16&65535,a=o?e>>16&65535:65535&e,l=(15&a)<8?15&a:0,c=t.evaluatedRMEA[l],u=t.evaluatedColor[l],h=t.emissionHeightBasedParams[l];let p;if(s&&2===l&&r.lights&&(p=new js,p.resize(10*r.lights.length)),PA(i.featureArray,n,u,c,h,i.aabb.min[2],i.aabb.max[2],p),p&&s){s=!1;const t=r.meshes[r.lightMeshIndex];t.featureArray=p,t.featureArray._trim()}}i.featureArray._trim(),n++}}function NA(t,e,i,r){const n=1<<t.z;e.lat=_l((r/ki+t.y)/n),e.lng=gl((i/ki+t.x)/n)}ro(IA,"Tiled3dModelBucket",{omit:["layers"]}),ro(EA,"Tiled3dModelFeature");const DA={circle:class extends ls{constructor(t,e,i){super(t,ic,e,i)}createBucket(t){return new Rl(t)}queryRadius(t){const e=t;return Yl("circle-radius",this,e)+Yl("circle-stroke-width",this,e)+Xl(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=tc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return hp(t,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=up(this);return{config:new Ra(this,e),defines:i,overrideFog:!1}}},heatmap:class extends ls{createBucket(t){return new gp(t)}constructor(t,e,i){super(t,Sp,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Yl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=this.paint.get("heatmap-radius").evaluate(e,i);return hp(t,r,o,s,a,!0,!0,new y(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return"heatmap"===t?{config:new Ra(this,e),overrideFog:!1}:{}}},hillshade:class extends ls{constructor(t,e,i){super(t,Mp,e,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends ls{constructor(t,e,i){super(t,ud,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new Ra(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ld(t)}queryRadius(){return Xl(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o){return!t.queryGeometry.isAboveHorizon&&Bl(Ql(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends ls{constructor(t,e,i){super(t,Ef,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new gf(t)}queryRadius(){return Xl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,i,r,n,o,s,a,l,c){const u=tc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(i,r),p=this.paint.get("fill-extrusion-base").evaluate(i,r),d=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=e.tile.getBucket(this);if(f&&g instanceof gf){const t=g.centroidVertexArray,e=c+1;e<t.length&&(d[0]=t.geta_centroid_pos0(e),d[1]=t.geta_centroid_pos1(e))}if(0===d[0]&&1===d[1])return!1;"globe"===s.projection.name&&(n=Tf([n],[new y(0,0),new y(ki,ki)],e.tileID.canonical).map((t=>t.polygon)).flat());const _=f?l:null,[A,v]=function(e,i,r,n,o,s,a,l,c,u,h){return"globe"===e.projection.name?function(e,i,r,n,o,s,a,l,c,u,h){const p=[],d=[],f=e.projection.upVectorScale(h,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(t,e,i,r)=>{t[0]=e,t[1]=i,t[2]=r,t[3]=1},y=Sf();r>0&&(r+=y),n+=y;for(const y of i){const i=[],A=[];for(const p of y){const d=p.x+o.x,y=p.y+o.y,v=e.projection.projectTilePoint(d,y,h),x=e.projection.upVector(h,p.x,p.y);let b=r,w=n;if(a){const t=kf(d,y,r,n,a,l,c,u);b+=t.base,w+=t.top}0!==r?_(m,v.x+x[0]*f*b,v.y+x[1]*f*b,v.z+x[2]*f*b):_(m,v.x,v.y,v.z),_(g,v.x+x[0]*f*w,v.y+x[1]*f*w,v.z+x[2]*f*w),t.N.transformMat4(m,m,s),t.N.transformMat4(g,g,s),i.push(new If(m[0],m[1],m[2])),A.push(new If(g[0],g[1],g[2]))}p.push(i),d.push(A)}return[p,d]}(e,i,r,n,o,s,a,l,c,u,h):a?function(e,i,r,n,o,s,a,l,c){const u=[],h=[],p=[0,0,0,1];for(const d of e){const e=[],f=[];for(const u of d){const h=u.x+n.x,d=u.y+n.y,m=kf(h,d,i,r,s,a,l,c);p[0]=h,p[1]=d,p[2]=m.base,p[3]=1,t.a7.transformMat4(p,p,o),p[3]=Math.max(p[3],1e-5);const g=new If(p[0]/p[3],p[1]/p[3],p[2]/p[3]);p[0]=h,p[1]=d,p[2]=m.top,p[3]=1,t.a7.transformMat4(p,p,o),p[3]=Math.max(p[3],1e-5);const _=new If(p[0]/p[3],p[1]/p[3],p[2]/p[3]);e.push(g),f.push(_)}u.push(e),h.push(f)}return[u,h]}(i,r,n,o,s,a,l,c,u):function(t,e,i,r,n){const o=[],s=[],a=n[8]*e,l=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,p=n[9]*i,d=n[10]*i,f=n[11]*i;for(const e of t){const t=[],i=[];for(const o of e){const e=o.x+r.x,s=o.y+r.y,m=n[0]*e+n[4]*s+n[12],g=n[1]*e+n[5]*s+n[13],_=n[2]*e+n[6]*s+n[14],y=n[3]*e+n[7]*s+n[15],A=m+a,v=g+l,x=_+c,b=Math.max(y+u,1e-5),w=m+h,S=g+p,T=_+d,C=Math.max(y+f,1e-5);t.push(new If(A/b,v/b,x/b)),i.push(new If(w/C,S/C,T/C))}o.push(t),s.push(i)}return[o,s]}(i,r,n,o,s)}(s,n,p,h,u,a,_,d,m,s.center.lat,e.tileID.canonical),x=e.queryGeometry;return function(t,e,i){let r=1/0;Bl(i,e)&&(r=Pf(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];Fl(i,n)&&(r=Math.min(r,Pf(i,n)))}}return r!==1/0&&r}(A,v,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends ls{constructor(t,e,i){super(t,jf,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Tr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Jf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Uf(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=Wf(this);return{config:new Ra(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=Kf(Yl("line-width",this,e),Yl("line-gap-width",this,e)),r=Yl("line-offset",this,e);return i/2+Math.abs(r)+Xl(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,o){if(t.queryGeometry.isAboveHorizon)return!1;const s=Ql(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*Kf(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),l=this.paint.get("line-offset").evaluate(e,i);return l&&(r=function(t,e){const i=[],r=new y(0,0);for(let n=0;n<t.length;n++){const o=t[n],s=[];for(let t=0;t<o.length;t++){const i=o[t],n=o[t+1],a=0===t?r:i.sub(o[t-1])._unit()._perp(),l=t===o.length-1?r:n.sub(i)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),s.push(c._mult(e)._add(i))}i.push(s)}return i}(r,l*t.pixelToTileUnitsFactor)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(Wl(t,n[e]))return!0;if(Ul(t,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:E_,background:class extends ls{constructor(t,e,i){super(t,L_,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:V_,"raster-particle":Z_,sky:class extends ls{constructor(t,e,i){super(t,H_,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=t.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&G("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?J_(o.azimuthal,90-o.polar,e):J_(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return J_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends ls{constructor(t,e,i){super(t,K_,e)}},model:class extends ls{constructor(t,e,i){super(t,_y,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new my(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof IA?ki-1:0}queryIntersectsFeature(e,i,r,n,o,s){if(!this.modelManager)return!1;const a=this.modelManager,l=e.tile.getBucket(this);if(!(l&&l instanceof my))return!1;const c=l;for(const r in c.instancesPerModel){const n=c.instancesPerModel[r];if(n.idToFeaturesIndex.hasOwnProperty(i.id)){const o=n.features[n.idToFeaturesIndex[i.id]],l=a.getModel(r,this.scope);if(!l)return!1;let u=t.a6.create();const h=new el(0,0),p=c.canonical;let d=Number.MAX_VALUE;for(let i=0;i<o.instancedDataCount;++i){const r=16*(o.instancedDataOffset+i),a=n.instancedDataArray.float32,c=[a[r+4],a[r+5],a[r+6]];NA(p,h,a[r],0|a[r+1]),vy(u,l,s,h,o.rotation,o.scale,c,!1,!1,!1),"globe"===s.projection.name&&(u=ny(u,s));const f=t.a6.multiply([],s.projMatrix,u),m=e.queryGeometry,g=oy(m.isPointQuery()?m.screenBounds:m.screenGeometry,s,f,l.aabb);null!=g&&(d=Math.min(g,d))}return d!==Number.MAX_VALUE&&d}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Jn}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,i,r,n){const o=e.tile,s=o.getBucket(this);let a=null,l=Number.MAX_VALUE;if(!(s&&s instanceof IA))return{queryFeature:a,intersectionZ:l};const c=s.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!r.filter(new Lo(o.tileID.overscaledZ),c.feature,o.tileID.canonical))return{queryFeature:a,intersectionZ:l};const u=c.node,h=n.calculatePosMatrix(o.tileID.toUnwrapped(),n.worldSize),p=c.evaluatedScale;let d=0;n.elevation&&u.elevation&&(d=u.elevation*n.elevation.exaggeration()),t.a6.translate(h,h,[(u.anchor?u.anchor[0]:0)*(p[0]-1),(u.anchor?u.anchor[1]:0)*(p[1]-1),d]),t.a6.scale(h,h,p),t.a6.multiply(h,h,u.matrix);const f=e.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,g=function(e){const i=t.a6.multiply([],h,e.matrix),r=t.a6.multiply(i,n.expandedFarZProjMatrix,i);for(let t=0;t<e.meshes.length;++t){const i=e.meshes[t];if(t===e.lightMeshIndex)continue;const o=oy(m,n,r,i.aabb);null!=o&&(l=Math.min(o,l))}if(e.children)for(const t of e.children)g(t)};if(g(u),l===Number.MAX_VALUE)return{queryFeature:a,intersectionZ:l};const _=new el(0,0);return NA(o.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),a={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:a,intersectionZ:l}}}},OA={read:function(t,e){return t.readFields(OA._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){1===t?e.header_length=i.readFixed32():2===t?e.x=i.readVarint():3===t?e.y=i.readVarint():4===t?e.z=i.readVarint():5===t&&e.layers.push(OA.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};OA.Filter.read=function(t,e){return t.readFields(OA.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},OA.Filter._readField=function(t,e,i){1===t?(e.delta_filter=OA.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):2===t?(e.zigzag_filter=OA.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):3===t?(e.bitshuffle_filter=OA.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):4===t&&(e.byteshuffle_filter=OA.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},OA.Filter.Delta={},OA.Filter.Delta.read=function(t,e){return t.readFields(OA.Filter.Delta._readField,{block_size:0},e)},OA.Filter.Delta._readField=function(t,e,i){1===t&&(e.block_size=i.readVarint())},OA.Filter.Zigzag={},OA.Filter.Zigzag.read=function(t,e){return t.readFields(OA.Filter.Zigzag._readField,{},e)},OA.Filter.Zigzag._readField=function(t,e,i){},OA.Filter.BitShuffle={},OA.Filter.BitShuffle.read=function(t,e){return t.readFields(OA.Filter.BitShuffle._readField,{},e)},OA.Filter.BitShuffle._readField=function(t,e,i){},OA.Filter.ByteShuffle={},OA.Filter.ByteShuffle.read=function(t,e){return t.readFields(OA.Filter.ByteShuffle._readField,{},e)},OA.Filter.ByteShuffle._readField=function(t,e,i){},OA.Codec={},OA.Codec.read=function(t,e){return t.readFields(OA.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},OA.Codec._readField=function(t,e,i){1===t?(e.gzip_data=OA.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):2===t?(e.jpeg_image=OA.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):3===t?(e.webp_image=OA.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):4===t&&(e.png_image=OA.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},OA.Codec.GzipData={},OA.Codec.GzipData.read=function(t,e){return t.readFields(OA.Codec.GzipData._readField,{},e)},OA.Codec.GzipData._readField=function(t,e,i){},OA.Codec.JpegImage={},OA.Codec.JpegImage.read=function(t,e){return t.readFields(OA.Codec.JpegImage._readField,{},e)},OA.Codec.JpegImage._readField=function(t,e,i){},OA.Codec.WebpImage={},OA.Codec.WebpImage.read=function(t,e){return t.readFields(OA.Codec.WebpImage._readField,{},e)},OA.Codec.WebpImage._readField=function(t,e,i){},OA.Codec.PngImage={},OA.Codec.PngImage.read=function(t,e){return t.readFields(OA.Codec.PngImage._readField,{},e)},OA.Codec.PngImage._readField=function(t,e,i){},OA.DataIndexEntry={},OA.DataIndexEntry.read=function(t,e){return t.readFields(OA.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},OA.DataIndexEntry._readField=function(t,e,i){1===t?e.first_byte=i.readFixed64():2===t?e.last_byte=i.readFixed64():3===t?e.filters.push(OA.Filter.read(i,i.readVarint()+i.pos)):4===t?e.codec=OA.Codec.read(i,i.readVarint()+i.pos):5===t?e.offset=i.readFloat():6===t?e.scale=i.readFloat():7===t&&e.bands.push(i.readString())},OA.Layer={},OA.Layer.read=function(t,e){return t.readFields(OA.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},OA.Layer._readField=function(t,e,i){1===t?e.version=i.readVarint():2===t?e.name=i.readString():3===t?e.units=i.readString():4===t?e.tilesize=i.readVarint():5===t?e.buffer=i.readVarint():6===t?e.pixel_format=i.readVarint():7===t&&e.data_index.push(OA.DataIndexEntry.read(i,i.readVarint()+i.pos))};const RA={read:function(t,e){return t.readFields(RA._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){2===t?(e.uint32_values=RA.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):3===t&&(e.fixed32_values=RA.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};RA.Uint32Values.read=function(t,e){return t.readFields(RA.Uint32Values._readField,{values:[]},e)},RA.Uint32Values._readField=function(t,e,i){1===t&&(e.readValuesInto=function(t){if(2!==t.type)throw new Error(`Unsupported pbf type "${t.type}"`);const e=function(t){return 2===t.type?t.readVarint()+t.pos:t.pos+1}(t),i=t.pos;return t.pos=e,function(r){t.pos=i;let n=0;for(;t.pos<e;){const e=t.readVarint();r[n++]=e}return r}}(i))},RA.Fixed32Values={},RA.Fixed32Values.read=function(t,e){return t.readFields(RA.Fixed32Values._readField,{values:[]},e)},RA.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class FA{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map((t=>[t,this.get(t)]))}evict(t=!1){if(t||this.size>0){const t=this.first;delete this.items[t.key],0==--this.size?(this.first=null,this.last=null):(this.first=t.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){let e;if(this.has(t)){const i=this.items[t];this.ttl>0&&i.expiry<=Date.now()?this.delete(t):(e=i.value,this.set(t,e,!0))}return e}has(t){return t in this.items}keys(){const t=[];let e=this.first;for(;null!==e;)t.push(e.key),e=e.next;return t}set(t,e,i=!1,r=this.resetTtl){let n;if(i||this.has(t)){if(n=this.items[t],n.value=e,!1===i&&r&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==n){const t=this.last,e=n.next,i=n.prev;this.first===n&&(this.first=n.next),n.next=null,n.prev=this.last,t.next=n,null!==i&&(i.next=e),null!==e&&(e.prev=i)}}else this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},1==++this.size?this.first=n:this.last.next=n;return this.last=n,this}values(t=this.keys()){return t.map((t=>this.get(t)))}}function zA(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let r=2;r>=1;r--){const n=1===r?1:0,o=2===r?1:0;for(let r=0;r<e[0];r++){const s=e[1]*r;for(let r=n;r<e[1];r++){const n=e[2]*(r+s);for(let r=o;r<e[2];r++){const o=e[3]*(r+n);for(let r=0;r<e[3];r++){const e=o+r;t[e]+=t[e-i]}}}}i*=e[r]}return t}function BA(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function UA(t,e){switch(e){case"uint32":return t;case"uint16":for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];t[e]=(240&i)>>4|(61440&i)>>8|(240&r)<<4|61440&r,t[e+1]=15&i|(3840&i)>>4|(15&r)<<8|(3840&r)<<4}return t;case"uint8":for(let e=0;e<t.length;e+=4){const i=t[e],r=t[e+1],n=t[e+2],o=t[e+3];t[e+0]=(192&i)>>6|(192&r)>>4|(192&n)>>2|192&o,t[e+1]=(48&i)>>4|(48&r)>>2|48&n|(48&o)<<2,t[e+2]=(12&i)>>2|12&r|(12&n)<<2|(12&o)<<4,t[e+3]=3&i|(3&r)<<2|(3&n)<<4|(3&o)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class VA extends Error{constructor(t){super(t),this.name="MRTError"}}var jA=Uint8Array,GA=Uint16Array,ZA=Int32Array,qA=new jA([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),WA=new jA([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),HA=new jA([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),JA=function(t,e){for(var i=new GA(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];var n=new ZA(i[30]);for(r=1;r<30;++r)for(var o=i[r];o<i[r+1];++o)n[o]=o-i[r]<<5|r;return{b:i,r:n}},KA=JA(qA,2),$A=KA.b,YA=KA.r;$A[28]=258,YA[258]=28;for(var XA=JA(WA,0).b,QA=new GA(32768),tv=0;tv<32768;++tv){var ev=(43690&tv)>>1|(21845&tv)<<1;QA[tv]=((65280&(ev=(61680&(ev=(52428&ev)>>2|(13107&ev)<<2))>>4|(3855&ev)<<4))>>8|(255&ev)<<8)>>1}var iv=function(t,e,i){for(var r=t.length,n=0,o=new GA(e);n<r;++n)t[n]&&++o[t[n]-1];var s,a=new GA(e);for(n=1;n<e;++n)a[n]=a[n-1]+o[n-1]<<1;if(i){s=new GA(1<<e);var l=15-e;for(n=0;n<r;++n)if(t[n])for(var c=n<<4|t[n],u=e-t[n],h=a[t[n]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)s[QA[h]>>l]=c}else for(s=new GA(r),n=0;n<r;++n)t[n]&&(s[n]=QA[a[t[n]-1]++]>>15-t[n]);return s},rv=new jA(288);for(tv=0;tv<144;++tv)rv[tv]=8;for(tv=144;tv<256;++tv)rv[tv]=9;for(tv=256;tv<280;++tv)rv[tv]=7;for(tv=280;tv<288;++tv)rv[tv]=8;var nv=new jA(32);for(tv=0;tv<32;++tv)nv[tv]=5;var ov=iv(rv,9,1),sv=iv(nv,5,1),av=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},lv=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&i},cv=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},uv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],hv=function(t,e,i){var r=new Error(e||uv[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,hv),!i)throw r;return r},pv=new jA(0),dv="undefined"!=typeof TextDecoder&&new TextDecoder;try{dv.decode(pv,{stream:!0})}catch(t){}const fv={gzip_data:"gzip"},mv={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},gv={uint32:1,uint16:2,uint8:4},_v={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class yv{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const e=new Uint8Array(t),i=new DataView(t);if(13!==e[0])throw new VA("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),i=this.getHeaderLength(t);if(e.length<i)throw new VA(`Expected header with length >= ${i} but got buffer of length ${e.length}`);const r=new Fm(e.subarray(0,i)),n=OA.read(r);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new VA(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const t of n.layers)this.layers[t.name]=new Av(t,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],i=this.getLayer(t.layerName);for(let r=0;r<i.dataIndex.length;r++){const n=i.dataIndex[r],o=n.first_byte-t.firstByte,s=n.last_byte+1-t.firstByte;if(r<t.firstBlock||r>t.lastBlock)continue;if(i._blocksInProgress.has(r))continue;const a={layerName:i.name,firstByte:o,lastByte:s,pixelFormat:i.pixelFormat,blockIndex:r,blockShape:[n.bands.length].concat(i.bandShape),buffer:i.buffer,codec:n.codec.codec,filters:n.filters.map((t=>t.filter))};i._blocksInProgress.add(r),e.push(a)}return new vv(e,(()=>{e.forEach((t=>i._blocksInProgress.delete(t.blockIndex)))}),((t,r)=>{if(e.forEach((t=>i._blocksInProgress.delete(t.blockIndex))),t)throw t;r.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t)}))}))}}class Av{constructor({version:t,name:e,units:i,tilesize:r,pixel_format:n,buffer:o,data_index:s},a){if(this.version=t,1!==this.version)throw new VA(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=e,this.units=i,this.tileSize=r,this.buffer=o,this.pixelFormat=mv[n],this.dataIndex=s,this.bandShape=[r+2*o,r+2*o,gv[this.pixelFormat]],this._decodedBlocks=function(t=1e3,e=0,i=!1){if(isNaN(t)||t<0)throw new TypeError("Invalid max value");if(isNaN(e)||e<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof i)throw new TypeError("Invalid resetTtl value");return new FA(t,e,i)}(a?a.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.set(e,t.data)}getBlockForBand(t){let e=0;switch(typeof t){case"string":for(const[i,r]of this.dataIndex.entries()){for(const[n,o]of r.bands.entries())if(o===t)return{bandIndex:e+n,blockIndex:i,blockBandIndex:n};e+=r.bands.length}break;case"number":for(const[i,r]of this.dataIndex.entries()){if(t>=e&&t<e+r.bands.length)return{bandIndex:t,blockIndex:i,blockBandIndex:t-e};e+=r.bands.length}break;default:throw new VA(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new VA(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let e=1/0,i=-1/0,r=1/0,n=-1/0;for(const o of t){const{blockIndex:t}=this.getBlockForBand(o);if(t<0)throw new VA(`Invalid band: ${JSON.stringify(o)}`);const s=this.dataIndex[t];r=Math.min(r,t),n=Math.max(n,t),e=Math.min(e,s.first_byte),i=Math.max(i,s.last_byte)}return{layerName:this.name,firstByte:e,lastByte:i,firstBlock:r,lastBlock:n}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:i}=this.getBlockForBand(t),r=this._decodedBlocks.get(e.toString());if(!r)throw new VA(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const n=this.dataIndex[e],o=this.bandShape.reduce(((t,e)=>t*e),1),s=i*o,a=r.subarray(s,s+o);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:n.offset,scale:n.scale}}}class vv{constructor(t,e,i){this.tasks=t,this._onCancel=e,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0)}}yv.performDecoding=function(t,e){return Promise.all(e.tasks.map((e=>{const{layerName:i,firstByte:r,lastByte:n,pixelFormat:o,blockShape:s,blockIndex:a,filters:l,codec:c}=e,u=new Uint8Array(t).subarray(r,n+1),h=new Uint32Array(s[0]*s[1]*s[2]);let p;if("gzip_data"!==c)throw new Error(`Unhandled codec: ${c}`);return p=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((o=function(t){31==t[0]&&139==t[1]&&8==t[2]||hv(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!t[i++]);return i+(2&e)}(n=t))+8>n.length&&hv(6,"invalid gzip data"),function(t,e,i,r){var n=t.length;if(!n||e.f&&!e.l)return i||new jA(0);var o=!i,s=o||2!=e.i,a=e.i;o&&(i=new jA(3*n));var l=function(t){var e=i.length;if(t>e){var r=new jA(Math.max(2*e,t));r.set(i),i=r}},c=e.f||0,u=e.p||0,h=e.b||0,p=e.l,d=e.d,f=e.m,m=e.n,g=8*n;do{if(!p){c=lv(t,u,1);var _=lv(t,u+1,3);if(u+=3,!_){var y=t[(I=4+((u+7)/8|0))-4]|t[I-3]<<8,A=I+y;if(A>n){a&&hv(0);break}s&&l(h+y),i.set(t.subarray(I,A),h),e.b=h+=y,e.p=u=8*A,e.f=c;continue}if(1==_)p=ov,d=sv,f=9,m=5;else if(2==_){var v=lv(t,u,31)+257,x=lv(t,u+10,15)+4,b=v+lv(t,u+5,31)+1;u+=14;for(var w=new jA(b),S=new jA(19),T=0;T<x;++T)S[HA[T]]=lv(t,u+3*T,7);u+=3*x;var C=av(S),M=(1<<C)-1,E=iv(S,C,1);for(T=0;T<b;){var I,L=E[lv(t,u,M)];if(u+=15&L,(I=L>>4)<16)w[T++]=I;else{var P=0,k=0;for(16==I?(k=3+lv(t,u,3),u+=2,P=w[T-1]):17==I?(k=3+lv(t,u,7),u+=3):18==I&&(k=11+lv(t,u,127),u+=7);k--;)w[T++]=P}}var N=w.subarray(0,v),D=w.subarray(v);f=av(N),m=av(D),p=iv(N,f,1),d=iv(D,m,1)}else hv(1);if(u>g){a&&hv(0);break}}s&&l(h+131072);for(var O=(1<<f)-1,R=(1<<m)-1,F=u;;F=u){var z=(P=p[cv(t,u)&O])>>4;if((u+=15&P)>g){a&&hv(0);break}if(P||hv(2),z<256)i[h++]=z;else{if(256==z){F=u,p=null;break}var B=z-254;z>264&&(B=lv(t,u,(1<<(j=qA[T=z-257]))-1)+$A[T],u+=j);var U=d[cv(t,u)&R],V=U>>4;if(U||hv(3),u+=15&U,D=XA[V],V>3){var j=WA[V];D+=cv(t,u)&(1<<j)-1,u+=j}if(u>g){a&&hv(0);break}s&&l(h+131072);var G=h+B;if(h<D){var Z=0-D,q=Math.min(D,G);for(Z+h<0&&hv(3);h<q;++h)i[h]=undefined[Z+h]}for(;h<G;++h)i[h]=i[h-D]}}e.l=p,e.p=F,e.b=h,e.f=c,p&&(c=1,e.m=f,e.d=d,e.n=m)}while(!c);return h!=i.length&&o?function(t,e,i){return(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length),new jA(t.subarray(e,i))}(i,0,h):i.subarray(0,h)}(n.subarray(o,-8),{i:2},new jA(((i=n)[(r=i.length)-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0))));var i,r,n,o;const s=fv[e];if(!s)throw new Error(`Unhandled codec: ${e}`);const a=new globalThis.DecompressionStream(s);return new Response(new Blob([t]).stream().pipeThrough(a)).arrayBuffer().then((t=>new Uint8Array(t)))}(u,c).then((t=>{const e=RA.read(new Fm(t));if("uint32_values"===e.values)return e.uint32_values.readValuesInto(h),new(0,_v[o])(h.buffer);throw new Error(`Unhandled numeric data "${e.values}"`)})),p.then((t=>{for(let e=l.length-1;e>=0;e--)switch(l[e]){case"delta_filter":zA(t,s);break;case"zigzag_filter":BA(t);break;case"bitshuffle_filter":UA(t,o);break;default:throw new Error(`Unhandled filter "${l[e]}"`)}return{layerName:i,blockIndex:a,data:t}})).catch((t=>{throw t}))})))},ro(vv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const xv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bv{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=xv[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new bv(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=xv.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return wv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const p=h+u>>1,d=o[2*p],f=o[2*p+1];d>=t&&d<=i&&f>=e&&f<=r&&l.push(n[p]),(0===c?t<=d:e<=f)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?i>=d:r>=f)&&(a.push(p+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)Mv(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const p=h+u>>1,d=n[2*p],f=n[2*p+1];Mv(d,f,t,e)<=l&&a.push(r[p]),(0===c?t-i<=d:e-i<=f)&&(s.push(h),s.push(p-1),s.push(1-c)),(0===c?t+i>=d:e+i>=f)&&(s.push(p+1),s.push(u),s.push(1-c))}return a}}function wv(t,e,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;Sv(t,e,s,r,n,o),wv(t,e,i,r,s-1,1-o),wv(t,e,i,s+1,n,1-o)}function Sv(t,e,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Sv(t,e,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=r,l=n;for(Tv(t,e,r,i),e[2*n+o]>s&&Tv(t,e,r,n);a<l;){for(Tv(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*r+o]===s?Tv(t,e,r,l):(l++,Tv(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function Tv(t,e,i,r){Cv(t,i,r),Cv(e,2*i,2*r),Cv(e,2*i+1,2*r+1)}function Cv(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function Mv(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}t.$=Hg,t.A=Rn,t.B=Nn,t.C=ni,t.D=qo,t.E=ie,t.F=jo,t.G=Bo,t.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return W(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ue(t.x,e.x,i),y:ue(t.y,e.y,i),z:ue(t.z,e.z,i),azimuthal:ue(t.azimuthal,e.azimuthal,i),polar:ue(t.polar,e.polar,i)}}},t.I=mg,t.J=No,t.K=Lo,t.L=Sl,t.M=class{constructor(t,e,i,r){this.id=t,this.position=null!=e?new el(e[0],e[1]):new el(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new Nh([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(t.a6.multiply(e.matrix,i,e.matrix),e.meshes)for(const t of e.meshes){const i=Nh.applyTransform(t.aabb,e.matrix);this.aabb.encapsulate(i)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=t.a6.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(t,e,i,r,n,o,s=!1){vy(this.matrix,this,t.transform,this.position,e,i,r,n,o,s)}upload(t){if(!this.uploaded){for(const e of this.nodes)wy(e,t);for(const t of this.nodes)Sy(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)Ty(t)}},t.O=E,t.P=y,t.Q=zo,t.R=Tt,t.S=rp,t.T=D_,t.U=ue,t.V=ki,t.W=he,t.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([t,e]){const i=W([1,t,e]);return{x:i.x,y:i.y,z:i.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:ue(t.x,e.x,i),y:ue(t.y,e.y,i),z:ue(t.z,e.z,i)}}},t.Y=function(t,e,i=0,r=!0){const n=new y(i,i),o=t.sub(n),s=e.add(n),a=[o,new y(s.x,o.y),s,new y(o.x,s.y)];return r&&a.push(o.clone()),a},t.Z=Jn,t._=function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=I(r-1,-1,t.length-1),o=I(r+1,-1,t.length-1),s=t[r],a=t[o],l=t[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(s.add(h))}return i},t.a=ee,t.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},t.a0=Hl,t.a1=function(e,i,r=0){return t.N.fromValues(((i.x-r)*e.scale-e.x)*ki,(i.y*e.scale-e.y)*ki,yl(i.z,i.y))},t.a2=Ch,t.a3=Gf,t.a4=function(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{min:new y(e,i),max:new y(r,n)}},t.a5=dl,t.a8=Wl,t.a9=Cl,t.aA=xn,t.aB=ra,t.aC=N,t.aD=qs,t.aE=S_,t.aF=function(){Io.isLoading()||Io.isLoaded()||"deferred"!==Mo()||Eo()},t.aG=Ho,t.aH=Nl,t.aI=AA,t.aJ=J,t.aK=Uf,t.aL=ld,t.aM=kl,t.aN=fs,t.aO=zs,t.aP=Fh,t.aQ=rd,t.aR=N_,t.aS=function(e,i){const r=rp(i.zoom);if(0===r)return Gh(e);const n=Hh(e),o=Jh(n),s=dl(n.getWest())*i.worldSize,a=dl(n.getEast())*i.worldSize,l=fl(n.getNorth())*i.worldSize,c=fl(n.getSouth())*i.worldSize,u=[s,l,0],h=[a,l,0],p=[s,c,0],d=[a,c,0],f=t.a6.invert([],i.globeMatrix);return t.N.transformMat4(u,u,f),t.N.transformMat4(h,h,f),t.N.transformMat4(p,p,f),t.N.transformMat4(d,d,f),o[0]=Zh(o[0],p,r),o[1]=Zh(o[1],d,r),o[2]=Zh(o[2],h,r),o[3]=Zh(o[3],u,r),Nh.fromPoints(o)},t.aT=Xh,t.aU=Kh,t.aV=Zh,t.aW=ms,t.aX=Rh,t.aY=F,t.aZ=yv,t.a_=It,t.aa=M,t.ab=Ga,t.ac=function(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i},t.ad=il,t.ae=fl,t.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,r){const n=this.entries[t]=this.entries[t]||{callbacks:[]};if(n.result){const[t,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(t,i)}),e):r(t,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const t of n.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,r)}),e):t(i,r);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((t=>t!==r)),n.callbacks.length||(n.cancel(),delete this.entries[t]))}}},t.ag=ss,t.ah=function(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const r=It(t.request,((t,r,n,o)=>{t?e(t):r&&e(null,{vectorTile:i?void 0:new Id(new Fm(r)),rawData:r,cacheControl:n,expires:o})}));return()=>{r.cancel(),e()}}),e)},t.ai=function(t){_t++,_t>pt&&(t.getActor().send("enforceCacheSizeLimit",ht),_t=0)},t.aj=Zt,t.ak=st,t.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.am=al,t.an=V_,t.ao=Z_,t.ap=B_,t.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){const r=document.createElement("source");Lt(t[e])||(i.crossOrigin="Anonymous"),r.src=t[e],i.appendChild(r)}return{cancel:()=>{}}},t.ar=O_,t.as=Wg,t.at=gl,t.au=_l,t.av=gs,t.aw=Ps,t.ax=ce,t.ay=ps,t.az=Bs,t.b=te,t.b$=So,t.b0=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i},t.b1=L,t.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.b3=function(e,i){const{x:r,y:n}=e.point,o=ip(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return t.a6.multiply(o,o,Qh(Gh(i)))},t.b5=cm,t.b6=Gm,t.b7=lm,t.b8=function(t,e,i,r,n){const o=5*e+2;t.float32[o+0]=i,t.float32[o+1]=r,t.float32[o+2]=n},t.b9=v_,t.bA=X_,t.bB=$_,t.bC=function(e){const i=$_(e,!0);return t.b4.invert([],[i[0],i[1],i[4],i[5]])},t.bD=Mh,t.bE=function(t){const{x:e,y:i}=t.point,{lng:r,lat:n}=t._center;return ip(e,i,t.worldSize,r,n)},t.bF=b,t.bG=Za,t.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return w[e]},t.bI=45,t.bJ=pl,t.bK=Ca,t.bL=xa,t.bM=ba,t.bN=va,t.bO=Aa,t.bP=wa,t.bQ=function(t,e,i){const r=Math.sqrt(t*t+e*e+i*i),n=r>0?Math.acos(i/r)*v:0;let o=0!==t||0!==e?Math.atan2(-e,-t)*v+90:0;return o<0&&(o+=360),[r,o,n]},t.bR=wl,t.bS=Nh,t.bT=W,t.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.bV=function(t){return t({pluginStatus:bo,pluginURL:wo}),Co.on("pluginStateChange",t),t},t.bW=Iy,t.bX=Oy,t.bY=bg,t.bZ=xg,t.b_=Mt,t.ba=pg,t.bb=Fl,t.bc=om,t.bd=Og,t.be=Rg,t.bf=tg,t.bg=bv,t.bh=I,t.bj=x,t.bk=rt,t.bl=ml,t.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.bn=el,t.bo=f_,t.bp=sl,t.bq=kh,t.br=Y_,t.bs=ol,t.bt=Wh,t.bu=function(t,e,i,r,n,o,s,a,l){if("globe"===l.name)return Wh(t,e,new ol(i,r,n),!1);const c=Wg({z:i,x:r,y:n},l);return new Nh([(o+c.x/c.scale)*e,e*(c.y/c.scale),s],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),a])},t.bv=function(t,e,i){let r=0;for(let n=0;n<2;++n){const o=i?i[n]:0;t[n]>o&&(r+=(t[n]-o)*(t[n]-o)),e[n]<o&&(r+=(o-e[n])*(o-e[n]))}return r},t.bw=Al,t.bx=qa,t.by=function(e){const i=t.a6.identity(new Float64Array(16));t.a6.multiply(i,e.pixelMatrix,e.globeMatrix);const r=[0,Ka,0],n=[0,$a,0];return t.N.transformMat4(r,r,i),t.N.transformMat4(n,n,i),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!op(e,new el(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!op(e,new el(e.center.lat,-90))]},t.bz=function(e,i){const{scale:r}=e.tileTransform,n=r*ki/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return t.b4.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[n,n])},t.c=fA,t.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.c0=s,t.c1=V,t.c2=function(t,e,i){return"custom"===t.type?new q_(t,e):new DA[t.type](t,e,i)},t.c3=function(t){const e=t.indexOf(os);return e>=0?t.slice(0,e):t},t.c4=function(t){return t.indexOf(os)>=0},t.c5=function(t){const e=t.indexOf(os);return e>=0?t.slice(e+1):""},t.c6=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.c7=U,t.c8=Co,t.c9=Et,t.cA=Wf,t.cB=(t,e,i,r,n,o)=>{const s=t.transform;return{u_matrix:qf(t,e,i,r),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Zf(e,s),u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:o}},t.cC=(t,e,i,r,n,o,s)=>{const a=t.transform,l=a.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:qf(t,e,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Hf(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Zf(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:i.paint.get("line-emissive-strength")}},t.cD=O,t.cE=Tp,t.cF=Sf,t.cG=cl,t.cH=gf,t.cI=of,t.cJ=450,t.cK=7,t.cL=U_,t.cM=256,t.cN=Qh,t.cO=Os,t.cP=Rs,t.cQ=function(t,e,i,r,n){return M((t-e)/(i-e)*(n-r)+r,r,n)},t.cR=xl,t.cS=ny,t.cT=[1,1,1],t.cU=Yd,t.cV=Ay,t.cW=Cs,t.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Od(new y(0,0),new y(ki,ki),t),i=[];for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!Dd(e,r))continue;const n=Rd(r.min,r.max,t);i.push({min:n.min,max:n.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return i}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const i of t.cache.getVisibleCoordinates()){const r=t.cache.getTile(i).buckets[t.layer];if(r)for(const t of r.getNodesInfo()){const r=t.node;r.footprint&&e.push({footprint:r.footprint,id:i.toUnwrapped()})}}return e}}))))}_addSource(t){const e=t.getFootprints();if(0!==e.length){for(const t of e){if(!t.footprint)continue;const e=Od(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||kd(t.min,e.min)||kd(t.max,e.max)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],n=this._prevRegions[i];t=r.priority!==n.priority||!Nd(r,n),++e,++i}}if(t){++this._updateTime;const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const i=e[t].priority;for(;t<e.length&&e[t].priority===i;)++t;return t};if(this._sourceIds.length>1){let e=0,i=t(e);for(;e!==i;){let r=e;const n=e;for(;r!==i;){const t=this._activeRegions[r];t.hiddenByOverlap=!1;for(let e=0;e<n;e++){const i=this._activeRegions[e];if(!i.hiddenByOverlap&&Dd(t,i)&&(t.hiddenByOverlap=zd(t.footprint,t.tileId,i.footprint,i.tileId),t.hiddenByOverlap))break}++r}e=i,i=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},t.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new fs,r=new Ps,n=[],o=t+1+2,s=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,i)=>{let r=t===o-1?t-2:0===t?t:t-1;return r+=i?24575:0,[r,e]};for(let t=0;t<o;++t)i.emplaceBack(...l(t,0,!0));for(let t=0;t<s;++t)for(let e=0;e<o;++e)i.emplaceBack(...l(e,t,(0===e||e===o-1)&&!0));for(let t=0;t<e.length;++t){const r=e[t];for(let t=0;t<o;++t)i.emplaceBack(...l(t,r,!0))}for(let t=0;t<e.length;++t){const s=r.length,l=e[t]+1+2,c=new Ps;for(let i=0;i<l-1;i++){const n=i===l-2,s=n?o*(a-e.length+t-i):o;for(let t=0;t<o-1;t++){const e=i*o+t;0===i||n||0===t||t===o-2?(c.emplaceBack(e+1,e,e+s),c.emplaceBack(e+s,e+s+1,e+1)):(r.emplaceBack(e+1,e,e+s),r.emplaceBack(e+s,e+s+1,e+1))}}const u=ra.simpleSegment(0,s,i.length,r.length-s);for(let t=0;t<c.uint16.length;t+=3)r.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const h=ra.simpleSegment(0,s,i.length,r.length-s);n.push({withoutSkirts:u,withSkirts:h})}return{vertices:i,indices:r,segments:n}}_createGrid(t){const e=this._fillGridMeshWithLods(Ha,Ja);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Fh.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Ps;for(let t=0;t<=Ha;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Os,r=new Os,n=new Os,o=new Os;this._poleSegments=[];for(let t=0,e=0;t<Za;t++){const s=360/(1<<t);i.emplaceBack(0,-Ga,0,.5,0),r.emplaceBack(0,-Ga,0,.5,1),n.emplaceBack(0,-Ga,0,.5,.5),o.emplaceBack(0,-Ga,0,.5,.5);for(let t=0;t<=Ha;t++){let e=t/Ha,a=0;const l=ue(0,s,e),[c,u,h]=Ya(ap,lp,l,Ga);i.emplaceBack(c,u,h,e,a),r.emplaceBack(c,u,h,e,1-a);const p=x(l);e=.5+.5*Math.sin(p),a=.5+.5*Math.cos(p),n.emplaceBack(c,u,h,e,a),o.emplaceBack(c,u,h,e,1-a)}this._poleSegments.push(ra.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Oh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Oh,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(n,Oh,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(o,Oh,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.cZ=function(t){return Yt.has(t)},t.c_=T,t.ca=Sa,t.cb=class extends ya{constructor(t){super(t),this.current=Ma}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},t.cc=S,t.cd=function(t,e,i){const r=rp(i.zoom),n=t.style.map._antialias,o=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!n&&!o},t.ce=function(e){const i=e.pixelsPerMeter,r=i/ml(1,e.center.lat),n=t.a6.identity(new Float64Array(16));return t.a6.translate(n,n,[e.point.x,e.point.y,0]),t.a6.scale(n,n,[r,r,i]),Float32Array.from(n)},t.cf=Hh,t.cg=function(t){const e=Al-5;t=M(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(x(t))),3);return Math.round(i*(Ja.length-1))},t.ch=function(e,i,r,n){const o=i.getNorth(),s=i.getSouth(),a=i.getWest(),l=i.getEast(),c=1<<e.z,u=l-a,h=o-s,p=u/Ha,d=-h/Ja[r],f=[0,p,0,d,0,0,o,a,0];if(e.z>0){const e=180/n;t.co.multiply(f,f,[e/u+1,0,0,0,e/h+1,0,-.5*e/p,.5*e/d,1])}return f[2]=c,f[5]=e.x,f[8]=e.y,f},t.ci=Gh,t.cj=function(e,i,r){const n=t.a6.identity(new Float64Array(16)),o=(i/(1<<e)-.5)*Math.PI*2;return t.a6.rotateY(n,r.globeMatrix,o),Float32Array.from(n)},t.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,n=Math.floor(t.x),o=Math.floor((t.x-n)*r),s=Math.floor(t.y*r),a=this.findDEMTileFor(new al(i,n,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r)return e;if(t.y<0||t.y>1)return e;const n=r.getSource().maxzoom,o=1<<n,s=Math.floor(t.x),a=t.x-s,l=new al(n,s,n,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,p=(a*h-c.tileID.canonical.x)*u.dim,d=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(p),m=Math.floor(d);return(i?this.exaggeration():1)*ue(ue(u.get(f,m),u.get(f,m+1),d-m),ue(u.get(f+1,m),u.get(f+1,m+1),d-m),p-f)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Sl(t.wrap+(t.canonical.x+e/ki)/r,(t.canonical.y+i/ki)/r))}getAtTileOffsetFunc(e,i,r,n){return o=>{const s=this.getAtTileOffset(e,o.x,o.y),a=n.upVector(e.canonical,o.x,o.y),l=n.upVectorScale(e.canonical,i,r).metersToTile;return t.N.scale(a,a,s*l),a}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const n=Yd.create(this,t,r);return!!n&&(e.forEach((t=>{t[2]=this.exaggeration()*n.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,n=1<<t.canonical.z-r.canonical.z;let o=t.canonical.x/n-r.canonical.x,s=t.canonical.y/n-r.canonical.y,a=0;for(let e=0;e<t.canonical.z-r.canonical.z&&!i.leaves[a];e++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of t){const t=this.getMinMaxForTile(n.tileID);t&&(i=Math.min(i,t.min),r=Math.max(r,t.max),e=!0)}return e?{min:i,max:r}:null}},t.cl=zh,t.cm=bp,t.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.cp=ep,t.cq=256,t.cr=function(e,i){const r=[0,0,0],n=Xh(Gh(i.canonical));return t.N.transformMat4(r,r,n),t.N.transformMat4(r,r,e),r},t.cs=t=>({u_camera_to_center_distance:new va(t),u_extrude_scale:new Ia(t),u_device_pixel_ratio:new va(t),u_matrix:new Ca(t),u_inv_rot_matrix:new Ca(t),u_merc_center:new xa(t),u_tile_id:new ba(t),u_zoom_transition:new va(t),u_up_dir:new ba(t),u_emissive_strength:new va(t)}),t.ct=t=>({u_matrix:new Ca(t),u_pixels_to_tile_units:new Ia(t),u_device_pixel_ratio:new va(t),u_units_to_pixels:new xa(t),u_dash_image:new Aa(t),u_gradient_image:new Aa(t),u_image_height:new va(t),u_texsize:new xa(t),u_tile_units_to_pixels:new va(t),u_alpha_discard_threshold:new va(t),u_trim_offset:new xa(t),u_emissive_strength:new va(t)}),t.cu=t=>({u_matrix:new Ca(t),u_texsize:new xa(t),u_pixels_to_tile_units:new Ia(t),u_device_pixel_ratio:new va(t),u_image:new Aa(t),u_units_to_pixels:new xa(t),u_tile_units_to_pixels:new va(t),u_alpha_discard_threshold:new va(t),u_trim_offset:new xa(t)}),t.cv=Is,t.cw=nm,t.cx=um,t.cy=up,t.cz=(t,e,i,r,n,o)=>{const s=t.transform,a="globe"===s.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(a){const t=ep(s.zoom,e.canonical)*s._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t])}else l=s.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(s.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:at.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:cp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=r,c.u_merc_center=n,c.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],c.u_zoom_transition=rp(s.zoom);const t=n[0]*ki,i=n[1]*ki;c.u_up_dir=s.projection.upVector(new ol(0,0,0),t,i)}return c},t.d=Dt,t.d0=C,t.d1=bl,t.d2=Xa,t.d3=function([t,e,i]){const r=Math.hypot(t,e,i),n=Math.atan2(t,i),o=.5*Math.PI-Math.acos(-e/r);return new el(b(n),b(o))},t.d4=Qa,t.d5=n,t.d6=op,t.d7=np,t.d8=function(e){const i=[0,0,0],r=t.a6.identity(new Float64Array(16));return t.a6.multiply(r,e.pixelMatrix,e.globeMatrix),t.N.transformMat4(i,i,r),new y(i[0],i[1])},t.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==et){const e=t.navigator?t.navigator.userAgent:null;et=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return et}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.dA=vg,t.dB=_A,t.dC=vA,t.dD=Ff,t.dE=B,t.dF=gg,t.dG=function(t,e,i,r,n,o,s,a,l,c,u){t.createArrays(),t.tilePixelRatio=ki/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const h=t.layers[0].layout,p=t.layers[0]._unevaluatedLayout._values,d={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;d.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Lo(e),a),p["text-size"].possiblyEvaluate(new Lo(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;d.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Lo(e),a),p["icon-size"].possiblyEvaluate(new Lo(i),a)]}d.layoutTextSize=p["text-size"].possiblyEvaluate(new Lo(l+1),a),d.layoutIconSize=p["icon-size"].possiblyEvaluate(new Lo(l+1),a),d.textMaxSize=p["text-size"].possiblyEvaluate(new Lo(18),a);const f="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),m=h.get("text-size");let g=!1;for(const e of t.features)if(e.icon&&e.icon.nameSecondary){g=!0;break}for(const o of t.features){const l=h.get("text-font").evaluate(o,{},a).join(","),p=m.evaluate(o,{},a),_=d.layoutTextSize.evaluate(o,{},a),y=(d.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),A=o.text;let v,x=[0,0];if(A){const r=A.toString(),s=h.get("text-letter-spacing").evaluate(o,{},a)*om,c=h.get("text-line-height").evaluate(o,{},a)*om,u=uo(r)?s:0,d=h.get("text-anchor").evaluate(o,{},a),m=h.get("text-variable-anchor");if(!m){const t=h.get("text-radial-offset").evaluate(o,{},a);x=t?Og(d,[t*om,Ng]):h.get("text-offset").evaluate(o,{},a).map((t=>t*om))}let g=f?"center":h.get("text-justify").evaluate(o,{},a);const v="point"===h.get("symbol-placement"),b=v?h.get("text-max-width").evaluate(o,{},a)*om:1/0,w=o=>{t.allowVerticalPlacement&&co(r)&&(y.vertical=Wm(A,e,i,n,l,b,c,d,o,u,x,Gm.vertical,!0,_,p))};if(!f&&m){const t="auto"===g?m.map((t=>Rg(t))):[g];let r=!1;for(let o=0;o<t.length;o++){const s=t[o];if(!y.horizontal[s])if(r)y.horizontal[s]=y.horizontal[0];else{const t=Wm(A,e,i,n,l,b,c,"center",s,u,x,Gm.horizontal,!1,_,p);t&&(y.horizontal[s]=t,r=1===t.positionedLines.length)}}w("left")}else{if("auto"===g&&(g=Rg(d)),v||h.get("text-writing-mode").indexOf("horizontal")>=0||!co(r)){const t=Wm(A,e,i,n,l,b,c,d,g,u,x,Gm.horizontal,!1,_,p);t&&(y.horizontal[g]=t)}w(v?"left":g)}}let b=!1;if(o.icon&&o.icon.namePrimary){const e=r[o.icon.namePrimary];e&&(v=ig(n[o.icon.namePrimary],o.icon.nameSecondary?n[o.icon.nameSecondary]:void 0,h.get("icon-offset").evaluate(o,{},a),h.get("icon-anchor").evaluate(o,{},a)),b=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&G("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const w=Vg(y.horizontal)||y.vertical;t.iconsInText||(t.iconsInText=!!w&&w.iconsInText),(w||v)&&Fg(t,o,y,v,r,d,_,0,x,b,s,a,c,u,g)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)},t.dH=Id,t.dI=Fm,t.dJ=$d,t.dK=p,t.dL=Ld,t.dM=_d,t.dN=g,t.dO=gm,t.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Xy){const i=new Uint32Array(t,0,7),[,,r,n,o,s]=i;e=i.byteLength+n+o+s+o,(r!==t.byteLength||e>=t.byteLength)&&G("Invalid b3dm header information.")}return nA(t,e)},t.dQ=function(t,e){const i=fA(t);for(const t of i){for(const e of t.meshes)mA(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(gA(t.lights,e)))}return i},t.dR=IA,t.dS=Ey,t.dT=Io,t.dU=function(t){ft(),ct&&ct.then((e=>{e.keys().then((i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])}))}))},t.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ot,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,i){if(!s(t))return t;const r=zt(t);return r.params.push(`sdk=js-${e}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(t,e){if(!s(t))return t;const i=zt(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!s(t))return t;const i=zt(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!s(t))return t;const n=zt(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push(`language=${i}`),r&&n.params.push(`worldview=${r}`),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const n=zt(t);return s(t)?(n.path=`/styles/v1${n.path}/sprite${e}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${e}${i}`,Bt(n))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s(t))return t;const r=zt(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${yt.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${n.RASTER_URL_PREFIX}${r.path}`:"rasterarrays"===r.authority?r.path=`/${n.RASTERARRAYS_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${n.TILE_URL_VERSION}${r.path}`);const o=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||n.ACCESS_TOKEN;return n.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,o)}canonicalizeTileURL(t,e){const i=zt(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${n.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${i.path.replace(`/${n.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${n.TILE_URL_VERSION}/`,"")}`;let o=i.params;return e&&(o=o.filter((t=>!t.match(/^access_token=/)))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&s(e),r=[];for(const e of t.tiles||[])o(e)?r.push(this.canonicalizeTileURL(e,i)):r.push(e);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=zt(n.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!n.REQUIRE_ACCESS_TOKEN)return Bt(t);if(e=e||n.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),Bt(t)}},t.db=function(t,e){e?Yt.add(t):Yt.delete(t)},t.dc=yt,t.dd=Jt,t.de=$t,t.df=Rt,t.dg=Wt,t.dh=function(t){Yt.delete(t)},t.di=Kt,t.dj=qt,t.dk=e,t.dl=function(t,e){ht=t,pt=e},t.dm=function(t,e,i=!1){if(bo===yo||bo===Ao||bo===vo)throw new Error("setRTLTextPlugin cannot be called multiple times.");wo=at.resolveURL(t),bo=yo,xo=e,To(),i||Eo()},t.dn=Mo,t.dp=function(){Oy().acquire(ky)},t.dq=function(){const t=Dy;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(ky),Dy=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dr=Ny,t.ds=function(t){const e=dt();if(!e)return;const i=e.delete(lt);t&&i.catch(t).then((()=>t()))},t.dt=Ly,t.du=jy,t.dv=function(t){Fy=at.resolveURL(t),Vy||(Vy=new Iy(Oy(),new ie)),Vy.broadcast("setDracoUrl",Fy)},t.dw=Gy,t.dx=function(t){By=at.resolveURL(t),Vy||(Vy=new Iy(Oy(),new ie)),Vy.broadcast("setMeshoptUrl",By)},t.dy=ro,t.dz=vp,t.e=P,t.f=at,t.g=function(t,e){return Et(P(t,{type:"json"}),e)},t.h=xp,t.i=$e,t.j=de,t.k=kn,t.l=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>nA(e,0,t)))},t.m=Dn,t.n=qn,t.o=Zo,t.p=dg,t.q=Kn,t.r=Wn,t.s=On,t.t=mr,t.u=Go,t.v=_r,t.w=G,t.x=fr,t.z=Wo})),n(0,(function(t){function e(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function i(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const r of t)e+=`${i(r)},`;return`${e}]`}let e="{";for(const r of Object.keys(t).sort())e+=`${r}:${i(t[r])},`;return`${e}}`}function r(e){let r="";for(const n of t.b2)r+=`/${i(e[n])}`;return r}class n{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,i,n){this._options=n;for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.c2(i,this.scope,this._options)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const o=function(t,e){const i={};for(let n=0;n<t.length;n++){const o=e&&e[t[n].id]||r(t[n]);e&&(e[t[n].id]=o);let s=i[o];s||(s=i[o]=[]),s.push(t[n])}const n=[];for(const t in i)n.push(i[t]);return n}(t.a$(this._layerConfigs),this.keyCache);for(const t of o){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}const o=1*t.dA;class s{constructor(e){const i={},r=[];for(const t in e){const n=e[t],s=i[t]={};for(const t in n.glyphs){const e=n.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i=e.metrics.localGlyph?o:1,a={x:0,y:0,w:e.bitmap.width+2*i,h:e.bitmap.height+2*i};r.push(a),s[t]=a}}const{w:n,h:s}=t.p(r),a=new t.dz({width:n||1,height:s||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const s=n.glyphs[+e];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const l=i[r][e],c=s.metrics.localGlyph?o:1;t.dz.copy(s.bitmap,a,{x:0,y:0},{x:l.x+c,y:l.y+c},s.bitmap)}}this.image=a,this.positions=i}}t.dy(s,"GlyphAtlas");class a{constructor(e){this.tileID=new t.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=t.as(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,i,r,n,o){this.status="parsing",this.data=e,this.collisionBoxArray=new t.aD;const a=new t.dB(Object.keys(e.layers).sort()),c=new t.dC(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h=new t.dD(256,256),p={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:r,brightness:this.brightness},d=i.familiesBySource[this.source];for(const i in d){const n=e.layers[i];if(!n)continue;let o=!1,s=!1,h=!1;for(const t of d[i])"symbol"===t[0].type?o=!0:s=!0,t[0].is3D()&&"model"!==t[0].type&&(h=!0);if(this.extraShadowCaster&&!h)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!s)continue;1===n.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const f=a.encode(i),m=[];for(let t=0;t<n.length;t++){const e=n.feature(t),r=c.getId(e,i);m.push({feature:e,id:r,index:t,sourceLayerIndex:f})}for(const t of d[i]){const e=t[0];(!this.extraShadowCaster||e.is3D()&&"model"!==e.type)&&(void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(l(t,this.zoom,p.brightness,r),(u[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,p,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(t.map((t=>t.id)))))}}let f,m,g,_;h.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},A=()=>{if(f)return this.status="done",o(f);if(this.extraShadowCaster)this.status="done",o(null,{buckets:t.a$(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:p.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){const e=new s(m),i=new t.dF(g,_);for(const n in u){const o=u[n];o instanceof t.aE?(l(o.layers,this.zoom,p.brightness,r),t.dG(o,m,e.positions,g,i.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):o.hasPattern&&(o instanceof t.aK||o instanceof t.aL||o instanceof t.cH)&&(l(o.layers,this.zoom,p.brightness,r),o.addFeatures(p,this.tileID.canonical,i.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:t.a$(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:h,imageAtlas:i,brightness:p.brightness})}};if(!this.extraShadowCaster){const e=t.dE(p.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(e).length?n.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((t,e)=>{f||(f=t,m=e,A())}),void 0,!1,y):m={};const i=Object.keys(p.iconDependencies);i.length?n.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((t,e)=>{f||(f=t,g=e,A())}),void 0,!1,y):g={};const r=Object.keys(p.patternDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((t,e)=>{f||(f=t,_=e,A())}),void 0,!1,y):_={}}A()}}function l(e,i,r,n){const o=new t.K(i,{brightness:r});for(const t of e)t.recalculate(o,n)}class c extends t.E{constructor(e,i,r,n,o,s){super(),this.actor=e,this.layerIndex=i,this.availableImages=r,this.loadVectorData=o||t.ah,this.loading={},this.loaded={},this.deduped=new t.af(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler,this.brightness=s}loadTile(i,r){const n=i.uid,o=i&&i.request,s=o&&o.collectResourceTiming,l=this.loading[n]=new a(i);l.abort=this.loadVectorData(i,((a,c)=>{const u=!this.loading[n];if(delete this.loading[n],u||a||!c)return l.status="done",u||(this.loaded[n]=l),r(a);const h=c.rawData,p={};c.expires&&(p.expires=c.expires),c.cacheControl&&(p.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new t.dH(new t.dI(h));const d=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,n)=>{if(i||!n)return r(i);const a={};if(s){const t=e(o);t.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(t)))}r(null,t.e({rawTileData:h.slice(0)},n,p,a))}))};this.isSpriteLoaded?d():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(d,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):d()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(e,i){const r=this.loaded,n=e.uid,o=this;if(r&&r[n]){const s=r[n];s.showCollisionBoxes=e.showCollisionBoxes,s.projection=e.projection,s.brightness=e.brightness,s.tileTransform=t.as(e.tileID.canonical,e.projection),s.extraShadowCaster=e.extraShadowCaster;const a=(t,e)=>{const r=s.reloadCallback;r&&(delete s.reloadCallback,s.parse(s.vectorTile,o.layerIndex,this.availableImages,o.actor,r)),i(t,e)};"parsing"===s.status?s.reloadCallback=a:"done"===s.status&&(s.vectorTile?s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}else i(null,void 0)}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}}class u{loadTile(e,i){const{uid:r,encoding:n,rawImageData:o,padding:s}=e,a=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,s):o;i(null,new t.dJ(r,a,n,s<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}class h{decodeRasterArray({task:e,buffer:i},r){t.aZ.performDecoding(i,e).then((t=>{r(null,t)}),(t=>{r(t)}))}}function p(t,e){if(0!==t.length){d(t[0],e);for(var i=1;i<t.length;i++)d(t[i],!e)}}function d(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var f=t.dK((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)p(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)p(e.coordinates[r],i);return e}));const m=t.dL.prototype.toGeoJSON;let g=class{constructor(e){this._feature=e,this.extent=t.V,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.P(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return m.call(this,t,e,i)}},_=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.V,this.length=e.length,this._features=e}feature(t){return new g(this._features[t])}};var y={exports:{}},A=t.dN,v=t.dM.VectorTileFeature,x=b;function b(t,e){this.options=e||{},this.features=t,this.length=t.length}function w(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}b.prototype.feature=function(t){return new w(this.features[t],this.options.extent)},w.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new A(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},w.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},w.prototype.toGeoJSON=v.prototype.toGeoJSON;var S=t.dO,T=x;function C(t){var e=new S;return function(t,e){for(var i in t.layers)e.writeMessage(3,M,t.layers[i])}(t,e),e.finish()}function M(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,E,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,N,o[i])}function E(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,I,t),e.writeVarintField(3,i.type),e.writeMessage(4,k,i)}function I(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,p=s[h];void 0===p&&(n.push(l),s[h]=p=n.length-1),e.writeVarint(p)}}}function L(t,e){return(e<<3)+(7&t)}function P(t){return t<<1^t>>31}function k(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(L(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(L(2,u-1));var p=l[h].x-n,d=l[h].y-o;e.writeVarint(P(p)),e.writeVarint(P(d)),n+=p,o+=d}3===r&&e.writeVarint(L(7,1))}}function N(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}y.exports=C,y.exports.fromVectorTileJs=C,y.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new T(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return C({layers:i})},y.exports.GeoJSONWrapper=T;var D=t.dK(y.exports);const O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},R=Math.fround||(F=new Float32Array(1),t=>(F[0]=+t,F[0]));var F;const z=3,B=5,U=6;class V{constructor(t){this.options=Object.assign(Object.create(O),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=R(Z(r)),a=R(q(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(Z(i),q(o),Z(n),q(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+B]>1?j(l,e,this.clusterProps):this.points[l[e+z]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+B]>1?j(o,i,this.clusterProps):this.points[o[i+z]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.bg(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+B]>1;let l,c,u;if(a)l=G(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+z]];l=i.properties;const[r,n]=i.geometry.coordinates;c=Z(r),u=q(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let p;p=a||this.options.generateId?e[t+z]:this.points[e[t+z]].id,void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),p=a[i+B];let d=p;for(const t of h){const i=t*c;a[i+2]>e&&(d+=a[i+B])}if(d>p&&d>=o){let t,o=r*p,s=u*p,f=-1;const m=(i/c<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+B];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=m,l.push(o/d,s/d,1/0,m,-1,d),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(d>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+B]>1){const r=this.clusterProps[t[e+U]];return i?Object.assign({},r):r}const r=this.points[t[e+z]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function j(t,e,i){return{type:"Feature",id:t[e+z],properties:G(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),W(t[e+1])]}};var r}function G(t,e,i){const r=t[e+B],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+U],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+z],point_count:r,point_count_abbreviated:n})}function Z(t){return t/360+.5}function q(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function W(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}var H={exports:{}};H.exports=function(){function t(i,r,n,o){for(var s,a=o,l=n-r>>1,c=n-r,u=i[r],h=i[r+1],p=i[n],d=i[n+1],f=r+3;f<n;f+=3){var m=e(i[f],i[f+1],u,h,p,d);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-l);g<c&&(s=f,c=g)}}a>o&&(s-r>3&&t(i,r,s,o),i[s+2]=a,n-s>3&&t(i,s,n,o))}function e(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function i(t,e,i,n){var o={id:void 0===t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)r(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)r(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var o=0;o<e[n].length;o++)r(t,e[n][o])}(o),o}function r(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function n(t,e,r,l){if(e.geometry){var c=e.geometry.coordinates,u=e.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),p=[],d=e.id;if(r.promoteId?d=e.properties[r.promoteId]:r.generateId&&(d=l||0),"Point"===u)o(c,p);else if("MultiPoint"===u)for(var f=0;f<c.length;f++)o(c[f],p);else if("LineString"===u)s(c,p,h,!1);else if("MultiLineString"===u){if(r.lineMetrics){for(f=0;f<c.length;f++)s(c[f],p=[],h,!1),t.push(i(d,"LineString",p,e.properties));return}a(c,p,h,!1)}else if("Polygon"===u)a(c,p,h,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(f=0;f<e.geometry.geometries.length;f++)n(t,{id:d,geometry:e.geometry.geometries[f],properties:e.properties},r,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];a(c[f],m,h,!0),p.push(m)}}t.push(i(d,u,p,e.properties))}}function o(t,e){e.push(l(t[0])),e.push(c(t[1])),e.push(0)}function s(e,i,r,n){for(var o,s,a=0,u=0;u<e.length;u++){var h=l(e[u][0]),p=c(e[u][1]);i.push(h),i.push(p),i.push(0),u>0&&(a+=n?(o*p-h*s)/2:Math.sqrt(Math.pow(h-o,2)+Math.pow(p-s,2))),o=h,s=p}var d=i.length-3;i[2]=1,t(i,0,d,r),i[d+2]=1,i.size=Math.abs(a),i.start=0,i.end=i.size}function a(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];s(t[n],o,i,r),e.push(o)}}function l(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function u(t,e,r,n,o,s,a,l){if(n/=e,s>=(r/=e)&&a<n)return t;if(a<r||s>=n)return null;for(var c=[],u=0;u<t.length;u++){var d=t[u],m=d.geometry,g=d.type,_=0===o?d.minX:d.minY,y=0===o?d.maxX:d.maxY;if(_>=r&&y<n)c.push(d);else if(!(y<r||_>=n)){var A=[];if("Point"===g||"MultiPoint"===g)h(m,A,r,n,o);else if("LineString"===g)p(m,A,r,n,o,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,A,r,n,o,!1);else if("Polygon"===g)f(m,A,r,n,o,!0);else if("MultiPolygon"===g)for(var v=0;v<m.length;v++){var x=[];f(m[v],x,r,n,o,!0),x.length&&A.push(x)}if(A.length){if(l.lineMetrics&&"LineString"===g){for(v=0;v<A.length;v++)c.push(i(d.id,g,A[v],d.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===A.length?(g="LineString",A=A[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===A.length?"Point":"MultiPoint"),c.push(i(d.id,g,A,d.tags))}}}return c.length?c:null}function h(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function p(t,e,i,r,n,o,s){for(var a,l,c=d(t),u=0===n?g:_,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],y=t[p+1],A=t[p+2],v=t[p+3],x=t[p+4],b=0===n?f:y,w=0===n?v:x,S=!1;s&&(a=Math.sqrt(Math.pow(f-v,2)+Math.pow(y-x,2))),b<i?w>i&&(l=u(c,f,y,v,x,i),s&&(c.start=h+a*l)):b>r?w<r&&(l=u(c,f,y,v,x,r),s&&(c.start=h+a*l)):m(c,f,y,A),w<i&&b>=i&&(l=u(c,f,y,v,x,i),S=!0),w>r&&b<=r&&(l=u(c,f,y,v,x,r),S=!0),!o&&S&&(s&&(c.end=h+a*l),e.push(c),c=d(t)),s&&(h+=a)}var T=t.length-3;f=t[T],y=t[T+1],A=t[T+2],(b=0===n?f:y)>=i&&b<=r&&m(c,f,y,A),T=c.length-3,o&&T>=3&&(c[T]!==c[0]||c[T+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&e.push(c)}function d(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function f(t,e,i,r,n,o){for(var s=0;s<t.length;s++)p(t[s],e,i,r,n,o,!1)}function m(t,e,i,r){t.push(e),t.push(i),t.push(r)}function g(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function _(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function y(t,e){for(var r=[],n=0;n<t.length;n++){var o,s=t[n],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=A(s.geometry,e);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var l=0;l<s.geometry.length;l++)o.push(A(s.geometry[l],e))}else if("MultiPolygon"===a)for(o=[],l=0;l<s.geometry.length;l++){for(var c=[],u=0;u<s.geometry[l].length;u++)c.push(A(s.geometry[l][u],e));o.push(c)}r.push(i(s.id,a,o,s.tags))}return r}function A(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function v(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(x(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(x(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function x(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function b(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,w(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function w(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)S(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)S(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)S(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(p.id=e.id),t.features.push(p)}}function S(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function T(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)n(i,t.features[r],e,r);else n(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var i=e.buffer/e.extent,r=t,n=u(t,1,-1-i,i,0,-1,2,e),o=u(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=u(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=y(n,1).concat(r)),o&&(r=r.concat(y(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function C(t,e,i){return 32*((1<<t)*i+e)+t}return T.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},T.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var h=1<<e,p=C(e,i,r),d=this.tiles[p];if(!d&&(c>1&&console.time("creation"),d=this.tiles[p]=b(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var m=1<<n-e;if(i!==Math.floor(o/m)||r!==Math.floor(s/m))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==t.length){c>1&&console.time("clipping");var g,_,y,A,v,x,w=.5*l.buffer/l.extent,S=.5-w,T=.5+w,M=1+w;g=_=y=A=null,v=u(t,h,i-w,i+T,0,d.minX,d.maxX,l),x=u(t,h,i+S,i+M,0,d.minX,d.maxX,l),t=null,v&&(g=u(v,h,r-w,r+T,1,d.minY,d.maxY,l),_=u(v,h,r+S,r+M,1,d.minY,d.maxY,l),v=null),x&&(y=u(x,h,r-w,r+T,1,d.minY,d.maxY,l),A=u(x,h,r+S,r+M,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(g||[],e+1,2*i,2*r),a.push(_||[],e+1,2*i,2*r+1),a.push(y||[],e+1,2*i+1,2*r),a.push(A||[],e+1,2*i+1,2*r+1)}}},T.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=C(t,e=(e%s+s)%s,i);if(this.tiles[a])return v(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[C(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?v(this.tiles[a],n):null):null},function(t,e){return new T(t,e)}}();var J=t.dK(H.exports);function K(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return e(null,null);const n=new _(r.features);let o=D(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:n,rawData:o.buffer})}class $ extends c{constructor(t,e,i,r,n,o){super(t,e,i,r,K,o),n&&(this.loadGeoJSON=n)}loadData(i,r){const n=i&&i.request,o=n&&n.collectResourceTiming;this.loadGeoJSON(i,((s,a)=>{if(s||!a)return r(s);if("object"!=typeof a)return r(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{f(a,!0);try{if(i.filter){const e=t.r(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=a.features.filter((t=>e.value.evaluate({zoom:0},t)));a={type:"FeatureCollection",features:r}}this._geoJSONIndex=i.cluster?new V(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.r(s),l=t.r("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(i)).load(a.features):J(a,i.geojsonVtOptions)}catch(s){return r(s)}this.loaded={};const l={};if(o){const t=e(n);t&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(t)))}r(null,l)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.g(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class Y{constructor(e,i){this.tileID=new t.am(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=i}parse(e,i,r,n){this.status="parsing";const o=new t.am(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),s={},a=i.familiesBySource[r.source],l=new t.dC(o,r.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,t.dP(e).then((e=>{if(!e)return n(new Error("Could not parse tile"));const i=t.dQ(e,1/t.bR(r.tileID.canonical)),c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,u=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new t.K(this.zoom,{brightness:this.brightness});for(const e in a)for(const r of a[e]){const e=r[0];l.bucketLayerIDs.push(r.map((t=>t.id))),e.recalculate(h,[]);const n=new t.dR(i,o,c,u,this.brightness,l);c||(n.needsUpload=!0),s[e.fqid]=n,n.evaluate(e)}this.status="done",n(null,{buckets:s,featureIndex:l})})).catch((t=>n(new Error(t.message))))}}class X{constructor(t,e,i,r,n,o){this.actor=t,this.layerIndex=e,this.brightness=o,this.loading={},this.loaded={}}loadTile(e,i){const r=e.uid,n=this.loading[r]=new Y(e,this.brightness);t.a_(e.request,((t,o)=>{const s=!this.loading[r];return delete this.loading[r],s||t?(n.status="done",s||(this.loaded[r]=n),i(t)):o&&0!==o.byteLength?void n.parse(o,this.layerIndex,e,((t,e)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[r]=n,t||!e?i(t):i(null,e)})):(n.status="done",this.loaded[r]=n,i())}))}reloadTile(t,e){const i=this.loaded,r=t.uid;if(i&&i[r]){const n=i[r];n.projection=t.projection,n.brightness=t.brightness;const o=(i,r)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(t,e)),e(i,r)};"parsing"===n.status?n.reloadCallback=o:"done"===n.status&&this.loadTile(t,e)}}abortTile(t,e){const i=t.uid;this.loading[i]&&delete this.loading[i],e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}}class Q{constructor(e){this.self=e,this.actor=new t.dS(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.bo({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:$,"batched-model":X},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.dT.isParsed())throw new Error("RTL text plugin already registered.");t.dT.applyArabicShaping=e.applyArabicShaping,t.dT.processBidirectionalText=e.processBidirectionalText,t.dT.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],delete this.rasterArrayWorkerSource,i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,{scope:i,isLoaded:r}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][i]=r,this.workerSources[e]&&this.workerSources[e][i])for(const n in this.workerSources[e][i]){const o=this.workerSources[e][i][n];for(const e in o)o[e]instanceof c&&(o[e].isSpriteLoaded=r,o[e].fire(new t.b("isSpriteLoaded")))}}setImages(t,{scope:e,images:i},r){if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][e]=i,this.workerSources[t]&&this.workerSources[t][e]){for(const r in this.workerSources[t][e]){const n=this.workerSources[t][e][r];for(const t in n)n[t].availableImages=i}r()}else r()}setProjection(e,i){this.projections[e]=t.bo(i)}setBrightness(t,e,i){this.brightness=e,i()}setLayers(t,e,i){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),i()}updateLayers(t,e,i){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),i()}loadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,i)}decodeRasterArray(t,e,i){this.getRasterArrayWorkerSource().decodeRasterArray(e,i)}reloadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,i)}removeSource(t,e,i){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const r=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,r){try{t.dT.setState(i);const e=t.dT.getPluginURL();if(t.dT.isLoaded()&&!t.dT.isParsed()&&null!=e){this.self.importScripts(e);const i=t.dT.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){r(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let i=this.availableImages[t][e];return i||(i=[]),i}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let i=this.layerIndexes[t][e];return i||(i=this.layerIndexes[t][e]=new n,i.scope=e),i}getWorkerSource(t,e,i,r){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][r]||(this.workerSources[t][r]={}),this.workerSources[t][r][e]||(this.workerSources[t][r][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),!this.workerSources[t][r][e][i]){const n={send:(e,i,r,n,o,s)=>{this.actor.send(e,i,r,t,o,s)},scheduler:this.actor.scheduler};this.workerSources[t][r][e][i]=new this.workerSourceTypes[e](n,this.getLayerIndex(t,r),this.getAvailableImages(t,r),this.isSpriteLoaded[t][r],void 0,this.brightness)}return this.workerSources[t][r][e][i]}getDEMWorkerSource(t,e,i){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][i]||(this.demWorkerSources[t][i]={}),this.demWorkerSources[t][i][e]||(this.demWorkerSources[t][i][e]=new u),this.demWorkerSources[t][i][e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new h),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,i){t.dU(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Q(self)),Q})),n(0,(function(t){function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],i[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const r in t)if(!e(t[r],i[r]))return!1;return!0}return t===i}var i=r;function r(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(r.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl2",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var e}(t)}var n={};function o(t,e,i){const r=document.createElement(t);return null!=e&&(r.className=e),i&&i.appendChild(r),r}function s(t,e,i){const r=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of Object.keys(e))r.setAttributeNS(null,t,String(e[t]));return i&&i.appendChild(r),r}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function p(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",p,!0)}function d(){window.addEventListener("click",p,!0),window.setTimeout((()=>{window.removeEventListener("click",p,!0)}),0)}function f(t,e){const i=t.getBoundingClientRect();return _(t,i,e)}function m(t,e){const i=t.getBoundingClientRect(),r=[];for(let n=0;n<e.length;n++)r.push(_(t,i,e[n]));return r}function g(t){return void 0!==window.InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function _(e,i,r){const n=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.P((r.clientX-i.left)*n,(r.clientY-i.top)*n)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class A extends t.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(e,i){return t.l(this.requestManager.transformRequest(i,t.R.Model).url).then((i=>{if(!i)return;const r=t.c(i),n=new t.M(e,void 0,void 0,r);return n.computeBoundsAndApplyParent(),n})).catch((r=>{this.fire(new t.a(new Error(`Could not load model ${e} from ${i}: ${r.message}`)))}))}load(e,i){this.models[i]||(this.models[i]={});const r=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const n=[];for(const t of r)n.push(this.loadModel(t,e[t]));Promise.allSettled(n).then((e=>{for(let t=0;t<e.length;t++){const{status:n,value:o}=e[t];"fulfilled"===n&&o&&(this.models[i][r[t]]=o)}this.numModelsLoading[i]-=r.length,this.fire(new t.b("data",{dataType:"style"}))})).catch((e=>{this.fire(new t.a(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]}addModel(t,e,i){this.models[i]||(this.models[i]={}),this.hasModel(t,i)&&this.removeModel(t,i),this.load({[t]:this.requestManager.normalizeModelURL(e)},i)}addModels(t,e){const i={};for(const e in t)i[e]=this.requestManager.normalizeModelURL(t[e]);this.load(i,e)}removeModel(t,e){this.models[e]||(this.models[e]={});const i=this.models[e][t];delete this.models[e][t],i.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const i in this.models[e])this.models[e][i].upload(t.context)}}class v{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},t.e(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(e,i){const r=String(i),n=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete n[e]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(e,i){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),t.e(this.state[e][r],this.stateChanges[e][r]),i[r]=this.state[e][r];r[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else if(this.state[e][t])for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}r[e]=r[e]||{},t.e(r[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,i)}}function x(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class b extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new t.h({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:i}of this.requestors)this._notify(t,e,i);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,i){this._validate(t,i)&&(this.images[e][t]=i)}_validate(e,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.a(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e,i){i.version=this.images[e][t].version+1,this.images[e][t]=i,this.updatedImages[e][t]=!0}removeImage(t,e){const i=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,i){let r=!0;const n=!!this.loaded[e];if(!n)for(const i of t)this.images[e][i]||(r=!1);n||r?this._notify(t,e,i):this.requestors.push({ids:t,scope:e,callback:i})}getUpdatedImages(t){return this.updatedImages[t]}_notify(e,i,r){const n={};for(const r of e){this.images[i][r]||this.fire(new t.b("styleimagemissing",{id:r}));const e=this.images[i][r];e?n[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,n)}getPixelSize(t){const{width:e,height:i}=this.atlasImage[t];return{width:e,height:i}}getPattern(e,i){const r=this.patterns[i][e],n=this.getImage(e,i);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const r={w:n.data.width+2,h:n.data.height+2,x:0,y:0},o=new t.I(r,n);this.patterns[i][e]={bin:r,position:o}}return this._updatePatternAtlas(i),this.patterns[i][e].position}bind(e,i){const r=e.gl;let n=this.atlasTexture[i];n?this.dirty&&(n.update(this.atlasImage[i]),this.dirty=!1):(n=new t.T(e,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(e){const i=[];for(const t in this.patterns[e])i.push(this.patterns[e][t].bin);const{w:r,h:n}=t.p(i),o=this.atlasImage[e];o.resize({width:r||1,height:n||1});for(const i in this.patterns[e]){const{bin:r}=this.patterns[e][i],n=r.x+1,s=r.y+1,a=this.images[e][i].data,l=a.width,c=a.height;t.h.copy(a,o,{x:0,y:0},{x:n,y:s},{width:l,height:c}),t.h.copy(a,o,{x:0,y:c-1},{x:n,y:s-1},{width:l,height:1}),t.h.copy(a,o,{x:0,y:0},{x:n,y:s+c},{width:l,height:1}),t.h.copy(a,o,{x:l-1,y:0},{x:n-1,y:s},{width:1,height:c}),t.h.copy(a,o,{x:0,y:0},{x:n+l,y:s},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const i of t){if(this.callbackDispatchedThisFrame[e][i])continue;this.callbackDispatchedThisFrame[e][i]=!0;const t=this.images[e][i];x(t)&&this.updateImage(i,e,t)}}}class w{constructor(t,e,i,r){this.message=(t?`${t}: `:"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}class S extends w{}function T(e){const i=e.key,r=e.value,n=e.valueSpec||{},o=e.objectElementValidators||{},s=e.style,a=e.styleSpec;let l=[];const c=t.i(r);if("object"!==c)return[new w(i,r,`object expected, ${c} found`)];for(const t in r){const e=t.split(".")[0];let c;o[e]?c=o[e]:n[e]?c=J:o["*"]?c=o["*"]:n["*"]&&(c=J),c?l=l.concat(c({key:(i?`${i}.`:i)+t,value:r[t],valueSpec:n[e]||n["*"],style:s,styleSpec:a,object:r,objectKey:t},r)):l.push(new S(i,r[t],`unknown property "${t}"`))}for(const t in n)o[t]||n[t].required&&void 0===n[t].default&&void 0===r[t]&&l.push(new w(i,r,`missing required property "${t}"`));return l}function C(e){const i=e.value,r=e.valueSpec,n=e.style,o=e.styleSpec,s=e.key,a=e.arrayElementValidator||J;if("array"!==t.i(i))return[new w(s,i,`array expected, ${t.i(i)} found`)];if(r.length&&i.length!==r.length)return[new w(s,i,`array length ${r.length} expected, length ${i.length} found`)];if(r["min-length"]&&i.length<r["min-length"])return[new w(s,i,`array length at least ${r["min-length"]} expected, length ${i.length} found`)];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};o.$version<7&&(l.function=r.function),"object"===t.i(r.value)&&(l=r.value);let c=[];for(let t=0;t<i.length;t++)c=c.concat(a({array:i,arrayIndex:t,value:i[t],valueSpec:l,style:n,styleSpec:o,key:`${s}[${t}]`},!0));return c}function M(e){const i=e.key,r=e.value,n=e.valueSpec;let o=t.i(r);if("number"===o&&r!=r&&(o="NaN"),"number"!==o)return[new w(i,r,`number expected, ${o} found`)];if("minimum"in n){let o=n.minimum;if("array"===t.i(n.minimum)&&(o=n.minimum[e.arrayIndex]),r<o)return[new w(i,r,`${r} is less than the minimum value ${o}`)]}if("maximum"in n){let o=n.maximum;if("array"===t.i(n.maximum)&&(o=n.maximum[e.arrayIndex]),r>o)return[new w(i,r,`${r} is greater than the maximum value ${o}`)]}return[]}function E(e){const i=e.valueSpec,r=t.u(e.value.type);let n,o,s,a={};const l="categorical"!==r&&void 0===e.value.property,c=!l,u="array"===t.i(e.value.stops)&&"array"===t.i(e.value.stops[0])&&"object"===t.i(e.value.stops[0][0]),h=T({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new w(e.key,e.value,'identity function may not have a "stops" property')];let i=[];const n=e.value;return i=i.concat(C({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:p})),"array"===t.i(n)&&0===n.length&&i.push(new w(e.key,n,"array must have at least one stop")),i},default:function(t){return J({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===r&&l&&h.push(new w(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||h.push(new w(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!t.s(e.valueSpec)&&h.push(new w(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!t.k(e.valueSpec)?h.push(new w(e.key,e.value,"property functions not supported")):l&&!t.m(e.valueSpec)&&h.push(new w(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!u||void 0!==e.value.property||h.push(new w(e.key,e.value,'"property" property is required')),h;function p(e){let r=[];const n=e.value,l=e.key;if("array"!==t.i(n))return[new w(l,n,`array expected, ${t.i(n)} found`)];if(2!==n.length)return[new w(l,n,`array length 2 expected, length ${n.length} found`)];if(u){if("object"!==t.i(n[0]))return[new w(l,n,`object expected, ${t.i(n[0])} found`)];if(void 0===n[0].zoom)return[new w(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new w(l,n,"object stop key must have value")];const i=t.u(n[0].zoom);if("number"!=typeof i)return[new w(l,n[0].zoom,"stop zoom values must be numbers")];if(s&&s>i)return[new w(l,n[0].zoom,"stop zoom values must appear in ascending order")];i!==s&&(s=i,o=void 0,a={}),r=r.concat(T({key:`${l}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:M,value:d}}))}else r=r.concat(d({key:`${l}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return t.n(t.o(n[1]))?r.concat([new w(`${l}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(J({key:`${l}[1]`,value:n[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function d(e,s){const l=t.i(e.value),c=t.u(e.value),u=null!==e.value?e.value:s;if(n){if(l!==n)return[new w(e.key,u,`${l} stop domain type must match previous stop domain type ${n}`)]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new w(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==r){let n=`number expected, ${l} found`;return t.k(i)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new w(e.key,u,n)]}return"categorical"!==r||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==r&&"number"===l&&"number"==typeof c&&"number"==typeof o&&void 0!==o&&c<o?[new w(e.key,u,"stop domain values must appear in ascending order")]:(o=c,"categorical"===r&&c in a?[new w(e.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new w(e.key,u,`integer expected, found ${String(c)}`)]}}function I(e){const i=("property"===e.expressionContext?t.q:t.r)(t.o(e.value),e.valueSpec);if("error"===i.result)return i.value.map((t=>new w(`${e.key}${t.key}`,e.value,t.message)));const r=i.value.expression||i.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new w(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!t.t(r))return[new w(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return L(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!t.v(r,["zoom","feature-state"]))return[new w(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!t.x(r))return[new w(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function L(e,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const t of i.valueSpec.expression.parameters)r.delete(t);if(0===r.size)return[];const n=[];return e instanceof t.C&&r.has(e.name)?[new w(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(e.eachChild((t=>{n.push(...L(t,i))})),n)}function P(e){const i=e.key,r=e.value,n=e.valueSpec,o=[];return Array.isArray(n.values)?-1===n.values.indexOf(t.u(r))&&o.push(new w(i,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(t.u(r))&&o.push(new w(i,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),o}function k(e){return t.z(t.o(e.value))?I(t.j({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):N(e)}function N(e){const i=e.value,r=e.key;if("array"!==t.i(i))return[new w(r,i,`array expected, ${t.i(i)} found`)];const n=e.styleSpec;let o,s=[];if(i.length<1)return[new w(r,i,"filter array must have at least 1 element")];switch(s=s.concat(P({key:`${r}[0]`,value:i[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),t.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===t.u(i[1])&&s.push(new w(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&s.push(new w(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(o=t.i(i[1]),"string"!==o&&s.push(new w(`${r}[1]`,i[1],`string expected, ${o} found`)));for(let a=2;a<i.length;a++)o=t.i(i[a]),"$type"===t.u(i[1])?s=s.concat(P({key:`${r}[${a}]`,value:i[a],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&s.push(new w(`${r}[${a}]`,i[a],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let t=1;t<i.length;t++)s=s.concat(N({key:`${r}[${t}]`,value:i[t],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":o=t.i(i[1]),2!==i.length?s.push(new w(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==o&&s.push(new w(`${r}[1]`,i[1],`string expected, ${o} found`))}return s}function D(e,i){const r=e.key,n=e.style,o=e.layer,s=e.styleSpec,a=e.value,l=e.objectKey,c=s[`${i}_${e.layerType}`];if(!c)return[];const u=l.match(/^(.*)-transition$/);if("paint"===i&&u&&c[u[1]]&&c[u[1]].transition)return J({key:r,value:a,valueSpec:s.transition,style:n,styleSpec:s});const h=e.valueSpec||c[l];if(!h)return[new S(r,a,`unknown property "${l}"`)];let p;if("string"===t.i(a)&&t.k(h)&&!h.tokens&&(p=/^{([^}]+)}$/.exec(a))){const t=`\`{ "type": "identity", "property": ${p?JSON.stringify(p[1]):'"_"'} }\``;return[new w(r,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const d=[];if("symbol"===e.layerType)"text-field"!==l||!n||n.glyphs||n.imports||d.push(new w(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&t.A(t.o(a))&&"identity"===t.u(a.type)&&d.push(new w(r,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===i&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&t.k(h)&&(t.B(h)||t.m(h))){const e=t.q(t.o(a),h),i=e.value.expression||e.value._styleExpression.expression;i&&!t.v(i,["measure-light"])&&("model-emissive-strength"===l&&t.x(i)&&t.t(i)||d.push(new w(r,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return d.concat(J({key:e.key,value:a,valueSpec:h,style:n,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:l}))}function O(t){return D(t,"paint")}function R(t){return D(t,"layout")}function F(e){let i=[];const r=e.value,n=e.key,o=e.style,s=e.styleSpec;r.type||r.ref||i.push(new w(n,r,'either "type" or "ref" is required'));let a=t.u(r.type);const l=t.u(r.ref);if(r.id){const s=t.u(r.id);for(let a=0;a<e.arrayIndex;a++){const e=o.layers[a];t.u(e.id)===s&&i.push(new w(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach((t=>{t in r&&i.push(new w(n,r[t],`"${t}" is prohibited for ref layers`))})),o.layers.forEach((i=>{t.u(i.id)===l&&(e=i)})),e?e.ref?i.push(new w(n,r.ref,"ref cannot reference another ref layer")):a=t.u(e.type):"string"==typeof l&&i.push(new w(n,r.ref,`ref layer "${l}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(r.source){const e=o.sources&&o.sources[r.source],s=e&&t.u(e.type);e?"vector"===s&&"raster"===a?i.push(new w(n,r.source,`layer "${r.id}" requires a raster source`)):"raster"===s&&"raster"!==a?i.push(new w(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==a?i.push(new w(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==s||["raster","raster-particle"].includes(a)?"line"!==a||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===s&&e.lineMetrics?"raster-particle"===a&&"raster-array"!==s&&i.push(new w(n,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):i.push(new w(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new w(n,r.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new w(n,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new w(n,r.source,`source "${r.source}" not found`))}else i.push(new w(n,r,'missing required property "source"'));return i=i.concat(T({key:n,value:r,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>J({key:`${n}.type`,value:r.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"}),filter:e=>k(t.j({layerType:a},e)),layout:e=>T({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>R(t.j({layerType:a},e))}}),paint:e=>T({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>O(t.j({layerType:a,layer:r},e))}})}})),i}function z(e){const i=e.value,r=e.key,n=t.i(i);return"string"!==n?[new w(r,i,`string expected, ${n} found`)]:[]}const B={promoteId:function({key:e,value:i}){if("string"===t.i(i))return z({key:e,value:i});{const t=[];for(const r in i)t.push(...z({key:`${e}.${r}`,value:i[r]}));return t}}};function U(e){const i=e.value,r=e.key,n=e.styleSpec,o=e.style;if(!i.type)return[new w(r,i,'"type" is required')];const s=t.u(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(s)&&(i.url||i.tiles||a.push(new S(r,i,'Either "url" or "tiles" is required.'))),s){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(T({key:r,value:i,valueSpec:n[`source_${s.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:B})),a;case"geojson":if(a=T({key:r,value:i,valueSpec:n.source_geojson,style:o,styleSpec:n,objectElementValidators:B}),i.cluster)for(const t in i.clusterProperties){const[e,n]=i.clusterProperties[t],o="string"==typeof e?[e,["accumulated"],["get",t]]:e;a.push(...I({key:`${r}.${t}.map`,value:n,expressionContext:"cluster-map"})),a.push(...I({key:`${r}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return T({key:r,value:i,valueSpec:n.source_video,style:o,styleSpec:n});case"image":return T({key:r,value:i,valueSpec:n.source_image,style:o,styleSpec:n});case"canvas":return[new w(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return P({key:`${r}.type`,value:i.type,valueSpec:{values:V(n)},style:o,styleSpec:n})}}function V(t){return t.source.reduce(((e,i)=>{const r=t[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e}),[])}function j(e){const i=e.value;let r=[];if(!i)return r;const n=t.i(i);return"string"!==n?(r=r.concat([new w(e.key,i,`string expected, "${n}" found`)]),r):(function(t){const e=-1===t.indexOf("://");try{return new URL(t,e?"http://example.com":void 0),!0}catch(t){return!1}}(i)||(r=r.concat([new w(e.key,i,`invalid url "${i}"`)])),r)}function G(e){const i=e.value,r=e.styleSpec,n=r.light,o=e.style;let s=[];const a=t.i(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new w("light",i,`object expected, ${a} found`)]),s;for(const t in i){const e=t.match(/^(.*)-transition$/);s=s.concat(e&&n[e[1]]&&n[e[1]].transition?J({key:t,value:i[t],valueSpec:r.transition,style:o,styleSpec:r}):n[t]?J({key:t,value:i[t],valueSpec:n[t],style:o,styleSpec:r}):[new w(t,i[t],`unknown property "${t}"`)])}return s}function Z(e){const i=e.value;let r=[];if(!i)return r;const n=t.i(i);if("object"!==n)return r=r.concat([new w("light-3d",i,`object expected, ${n} found`)]),r;const o=e.styleSpec,s=o["light-3d"],a=e.key,l=e.style,c=e.style.lights;for(const t of["type","id"])if(!(t in i))return r=r.concat([new w("light-3d",i,`missing property ${t} on light`)]),r;if(i.type&&c)for(let n=0;n<e.arrayIndex;n++){const e=t.u(i.type),o=c[n];t.u(o.type)===e&&r.push(new w(a,i.id,`duplicate light type "${i.type}", previously defined at line ${o.id.__line__}`))}const u=`properties_light_${i.type}`;if(!(u in o))return r=r.concat([new w("light-3d",i,`Invalid light type ${i.type}`)]),r;const h=o[u];for(const n in i)if("properties"===n){const s=i[n],a=t.i(s);if("object"!==a)return r=r.concat([new w("properties",s,`object expected, ${a} found`)]),r;for(const t in s)r=r.concat(h[t]?J({key:t,value:s[t],valueSpec:h[t],style:l,styleSpec:o}):[new S(e.key,s[t],`unknown property "${t}"`)])}else{const t=n.match(/^(.*)-transition$/);r=r.concat(t&&s[t[1]]&&s[t[1]].transition?J({key:n,value:i[n],valueSpec:o.transition,style:l,styleSpec:o}):s[n]?J({key:n,value:i[n],valueSpec:s[n],style:l,styleSpec:o}):[new S(n,i[n],`unknown property "${n}"`)])}return r}function q(e){const i=e.value,r=e.key,n=e.style,o=e.styleSpec,s=o.terrain;let a=[];const l=t.i(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new w("terrain",i,`object expected, ${l} found`)]),a;for(const t in i){const e=t.match(/^(.*)-transition$/);a=a.concat(e&&s[e[1]]&&s[e[1]].transition?J({key:t,value:i[t],valueSpec:o.transition,style:n,styleSpec:o}):s[t]?J({key:t,value:i[t],valueSpec:s[t],style:n,styleSpec:o}):[new S(t,i[t],`unknown property "${t}"`)])}if(i.source){const e=n.sources&&n.sources[i.source],o=e&&t.u(e.type);e?"raster-dem"!==o&&a.push(new w(r,i.source,`terrain cannot be used with a source of type ${String(o)}, it only be used with a "raster-dem" source type`)):a.push(new w(r,i.source,`source "${i.source}" not found`))}else a.push(new w(r,i,'terrain is missing required property "source"'));return a}function W(e){const i=e.value,r=e.style,n=e.styleSpec,o=n.fog;let s=[];const a=t.i(i);if(void 0===i)return s;if("object"!==a)return s=s.concat([new w("fog",i,`object expected, ${a} found`)]),s;for(const t in i){const e=t.match(/^(.*)-transition$/);s=s.concat(e&&o[e[1]]&&o[e[1]].transition?J({key:t,value:i[t],valueSpec:n.transition,style:r,styleSpec:n}):o[t]?J({key:t,value:i[t],valueSpec:o[t],style:r,styleSpec:n}):[new S(t,i[t],`unknown property "${t}"`)])}return s}const H={"*":()=>[],array:C,boolean:function(e){const i=e.value,r=e.key,n=t.i(i);return"boolean"!==n?[new w(r,i,`boolean expected, ${n} found`)]:[]},number:M,color:function(e){const i=e.key,r=e.value,n=t.i(r);return"string"!==n?[new w(i,r,`color expected, ${n} found`)]:null===t.y(r)?[new w(i,r,`color expected, "${r}" found`)]:[]},enum:P,filter:k,function:E,layer:F,object:T,source:U,model:j,light:G,"light-3d":Z,terrain:q,fog:W,string:z,formatted:function(t){return 0===z(t).length?[]:I(t)},resolvedImage:function(t){return 0===z(t).length?[]:I(t)},projection:function(e){const i=e.value,r=e.styleSpec,n=r.projection,o=e.style;let s=[];const a=t.i(i);if("object"===a)for(const t in i)s=s.concat(J({key:t,value:i[t],valueSpec:n[t],style:o,styleSpec:r}));else"string"!==a&&(s=s.concat([new w("projection",i,`object or string expected, ${a} found`)]));return s},import:function(e){const{value:i,styleSpec:r}=e,{data:n,...o}=i;Object.defineProperty(o,"__line__",{value:i.__line__,enumerable:!1});let s=T(t.j({},e,{value:o,valueSpec:r.import}));return""===t.u(o.id)&&s.push(new w(`${e.key}.id`,o,"import id can't be an empty string")),n&&(s=s.concat($(n,r,{key:`${e.key}.data`}))),s}};function J(e,i=!1){const r=e.value,n=e.valueSpec,o=e.styleSpec;if(n.expression&&t.A(t.u(r)))return E(e);if(n.expression&&t.n(t.o(r)))return I(e);if(n.type&&H[n.type]){const r=H[n.type](e);return!0===i&&r.length>0&&"array"===t.i(e.value)?I(e):r}return T(t.j({},e,{valueSpec:n.type?o[n.type]:n}))}function K(t){const e=t.value,i=t.key,r=z(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new w(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new w(i,e,'"glyphs" url must include a "{range}" token'))),r}function $(e,i=t.D,r={}){return J({key:r.key||"",value:e,valueSpec:i.$root,styleSpec:i,style:e,objectElementValidators:{glyphs:K,"*":()=>[]}})}function Y(e,i=t.D){return lt($(e,i))}const X=t=>lt(U(t)),Q=t=>lt(G(t)),tt=t=>lt(Z(t)),et=t=>lt(q(t)),it=t=>lt(W(t)),rt=t=>lt(F(t)),nt=t=>lt(k(t)),ot=t=>lt(O(t)),st=t=>lt(R(t)),at=t=>lt(j(t));function lt(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function ct(e,i){let r=!1;if(i&&i.length)for(const n of i)n instanceof S?t.w(n.message):(e.fire(new t.a(new Error(n.message))),r=!0);return r}const ut=new t.F({anchor:new t.G(t.D.light.anchor),position:new t.H(t.D.light.position),color:new t.G(t.D.light.color),intensity:new t.G(t.D.light.intensity)});class ht extends t.E{constructor(e,i="flat"){super(),this._transitionable=new t.J(ut),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e,i={}){this._validate(Q,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&ct(this,e.call(Y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.D})))}}const pt=new t.F({source:new t.G(t.D.terrain.source),exaggeration:new t.G(t.D.terrain.exaggeration)});let dt=class extends t.E{constructor(e,i,r,n){super(),this.scope=r,this._transitionable=new t.J(pt,r,n),this._transitionable.setTransitionOrValue(e,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new t.K(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof t.Z}};const ft=45,mt=65,gt=.05;function _t(e,i,r,n){const o=t.O(ft,mt,r),[s,a]=yt(e,n);let l=1-Math.min(1,Math.exp((i-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*e.alpha}function yt(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function At(e,i,r,n,o){const s=t.N.transformMat4([],[i,r,n],o.mercatorFogMatrix);return _t(e,t.N.length(s),o.pitch,o._fov)}function vt(e,i,r,n,o,s,a){const l=[[r,n,0],[o,n,0],[o,s,0],[r,s,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const e of l){const r=t.N.transformMat4([],e,i),n=t.N.length(r);c=Math.min(c,n),u=Math.max(u,n)}return[_t(e,c,a.pitch,a._fov),_t(e,u,a.pitch,a._fov)]}const xt=new t.F({range:new t.G(t.D.fog.range),color:new t.G(t.D.fog.color),"high-color":new t.G(t.D.fog["high-color"]),"space-color":new t.G(t.D.fog["space-color"]),"horizon-blend":new t.G(t.D.fog["horizon-blend"]),"star-intensity":new t.G(t.D.fog["star-intensity"]),"vertical-range":new t.G(t.D.fog["vertical-range"])});class bt extends t.E{constructor(e,i,r,n){super(),this._transitionable=new t.J(xt,r,new Map(n)),this.set(e,n),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new t.Q(xt)}get state(){const e=this._transform,i="globe"===e.projection.name,r=t.S(e.zoom),n=this.properties.get("range"),o=[.5,3];return{range:i?[t.U(o[0],n[0],r),t.U(o[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i,r={}){if(this._validate(it,e,r))return;const n=t.e({},e);for(const e of Object.keys(t.D.fog))void 0===n[e]&&(n[e]=t.D.fog[e].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.O(ft,mt,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,r){const n=t.L.fromLngLat(i),o=r.elevation?r.elevation.getAtPointOrZero(n):0;return At(e,n.x,n.y,o,r)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return vt(this.state,i,0,0,t.V,t.V,this._transform)}getOpacityForBounds(t,e,i,r,n){return this._transform.projection.supportsFog?vt(this.state,t,e,i,r,n,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?yt(this.state,t):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const i=e.points[r];let n;if(i[2]>=0)n=i;else{const o=e.points[r-4];n=t.W(o,i,o[2]/(o[2]-i[2]))}if(At(this.state,n[0],n[1],0,this._transform)>=gt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&ct(this,e.call(Y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.D})))}}class wt extends t.E{constructor(e,i,r,n){super(),this.scope=r,this._options=e,this.properties=new t.Q(i),this._transitionable=new t.J(i,r,new Map(n)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const St=new t.F({color:new t.G(t.D.properties_light_ambient.color),intensity:new t.G(t.D.properties_light_ambient.intensity)}),Tt=new t.F({direction:new t.X(t.D.properties_light_directional.direction),color:new t.G(t.D.properties_light_directional.color),intensity:new t.G(t.D.properties_light_directional.intensity),"cast-shadows":new t.G(t.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.G(t.D.properties_light_directional["shadow-intensity"])});class Ct{constructor(t,e,i,r){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(e,i){let r,n;if(e instanceof t.P||"number"==typeof e[0]){const o=t.P.convert(e);r=[o],n=i.isPointAboveHorizon(o)}else{const o=t.P.convert(e[0]),s=t.P.convert(e[1]);r=[o,s],n=t.Y(o,s).every((t=>i.isPointAboveHorizon(t)))}return new Ct(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.Y(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],n=t.Y(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),t._(n,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],n=t.Y(i,r,e),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>r.y))+((o.x>i.x)+(o.x>r.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(e,i,r,n=0){const o=e.queryPadding/i._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=e.tileID.wrap+(s.unwrapped?n:0);const l=s.polygon.map((i=>t.$(e.tileTransform,i,a)));if(!t.a0(l,0,0,t.V,t.V))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>t.a1(e.tileTransform,i,a))),u=c.map((e=>new t.P(e[0],e[1]))),h=i.getFreeCameraOptions().position||new t.L(0,0,0),p=t.a1(e.tileTransform,h,a),d=c.map((e=>{const i=t.N.sub(e,e,p);return t.N.normalize(i,i),new t.a2(p,i)})),f=t.a3(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:d,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=t.a4(l),m.min.x=t.aa(m.min.x,0,t.V),m.min.y=t.aa(m.min.y,0,t.V),m.max.x=t.aa(m.max.x,0,t.V),m.max.y=t.aa(m.max.y,0,t.V),m),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(t,e){const i=It(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(t,e){const i=It(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(e,i){const r=function(e,i){const r=t.a6.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-t.ab,0,1],o=[0,t.ab,0,1],s=[0,0,0,1];t.a7.transformMat4(n,n,r),t.a7.transformMat4(o,o,r),t.a7.transformMat4(s,s,r);const a=new t.P(n[0]/n[3],n[1]/n[3]),l=new t.P(o[0]/o[3],o[1]/o[3]),c=t.a8(e,a)&&n[3]<s[3],u=t.a8(e,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(t,e,i){for(let r=1;r<t.length;r++){const n=Et(e.pointCoordinate3D(t[r-1]).x),o=Et(e.pointCoordinate3D(t[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(e,i,c?-1:1);if(!h)return null;const{idx:p,t:d}=h;let f=p>1?Mt(e.slice(0,p),i):[],m=p<e.length?Mt(e.slice(p),i):[];f=f.map((e=>new t.P(Et(e.x),e.y))),m=m.map((e=>new t.P(Et(e.x),e.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=t.U(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,d);let y;return y=c?[new t.P(0,_),new t.P(0,0),new t.P(1,0),new t.P(1,_)]:[new t.P(1,_),new t.P(1,1),new t.P(0,1),new t.P(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((e=>new t.L(e.x,e.y))),unwrapped:!1}}(e,i);if(r)return r;const n=function(e,i){let r=!1,n=-1/0,o=0;for(let t=0;t<e.length-1;t++)e[t].x>n&&(n=e[t].x,o=t);for(let t=0;t<e.length-1;t++){const i=(o+t)%(e.length-1),n=e[i],s=e[i+1];Math.abs(n.x-s.x)>.5&&(n.x<s.x?(n.x+=1,0===i&&(e[e.length-1].x+=1)):(s.x+=1,i+1===e.length-1&&(e[0].x+=1)),r=!0)}const s=t.a5(i.center.lng);return r&&s<Math.abs(s-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:r}}(Mt(e,i).map((e=>new t.P(Et(e.x),e.y))),i);return{polygon:n.polygon.map((e=>new t.L(e.x,e.y))),unwrapped:n.unwrapped}}}function Mt(e,i){return t.a9(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function Et(t){return t<0?1+t%1:t%1}function It(t){return 100*t|0}function Lt(e,i,r,n,o){const s=function(r,n){if(r)return o(r);if(n){e.url&&n.tiles&&e.tiles&&delete e.tiles;const r=t.ac(t.e(n,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((t=>t.id))),n.raster_layers&&(r.rasterLayers=n.raster_layers,r.rasterLayerIds=r.rasterLayers.map((t=>t.id))),r.tiles=i.canonicalizeTileset(r,e.url),o(null,r)}};return e.url?t.g(i.transformRequest(i.normalizeSourceURL(e.url,null,r,n),t.R.Source),s):t.f.frame((()=>s(null,e)))}class Pt{constructor(e,i,r){this.bounds=t.ad.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.a5(this.bounds.getWest())*i),n=Math.floor(t.ae(this.bounds.getNorth())*i),o=Math.ceil(t.a5(this.bounds.getEast())*i),s=Math.ceil(t.ae(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class kt extends t.E{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.ac(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new t.af}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Lt(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new t.a(n))):o&&(t.e(this,o),o.bounds&&(this.tileBounds=new Pt(o.bounds,this.minzoom,this.maxzoom)),t.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.e({},this._options)}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",n,o.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const i=t.ah.call({deduped:this._deduped},n,((t,i)=>{t||!i?o.call(this,t):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",n,o.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function o(r,n){return delete e.request,e.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),t.ai(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Nt extends t.E{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.ac(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Lt(this._options,this.map._requestManager,null,null,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new t.a(i)):r&&(t.e(this,r),r.bounds&&(this.tileBounds=new Pt(r.bounds,this.minzoom,this.maxzoom)),t.aj(r.tiles),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.ag(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return t.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const r=t.f.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=t.d(this.map._requestManager.transformRequest(n,t.R.Tile),((r,n,o,s)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):r?(e.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s}),e.setTexture(n,this.map.painter),e.state="loaded",t.ai(this.dispatcher),void i(null)):i(null))))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(e,i){e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dt extends Nt{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-array",this.maxzoom=22,this._options=t.e({type:"raster-array"},i)}triggerRepaint(t){const e=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);e&&e.enabled&&i&&e._clearRenderCacheForTile(i.id,t.tileID),this.map.triggerRepaint()}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(r,t.R.Tile);e.requestParams=n,e.actor||(e.actor=this.dispatcher.getActor()),e.request=e.fetchHeader(void 0,((t,r,n,o)=>{if(delete e.request,e.aborted)return e.state="unloaded",i(null);if(t){if(20===t.code)return;return e.state="errored",i(t)}this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:n,expires:o}),e.state="empty",i(null)}))}unloadTile(e){const i=e.texture;i&&i instanceof t.T?(e.destroy(!0),this.map.painter.saveTileTexture(i)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(e,i,r){e._isHeaderLoaded&&("empty"!==e.state&&(e.state="reloading"),e.fetchBand(i,r,((i,r)=>{if(i)return e.state="errored",this.fire(new t.a(i)),void this.triggerRepaint(e);r&&(e.setTexture(r,this.map.painter),e.state="loaded",this.triggerRepaint(e))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const e=this.rasterLayers.find((({id:e})=>e===t)),i=e&&e.fields,r=i&&i.bands&&i.bands;return r?r[0]:0}getTextureDescriptor(e,i,r){if(!e)return;const n=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let o=null;i instanceof t.an?o=i.paint.get("raster-array-band"):i instanceof t.ao&&(o=i.paint.get("raster-particle-array-band"));const s=o||this.getInitialBand(n);if(null!=s)if(e.textureDescriptor){if(!e.updateNeeded(n,s)||r)return Object.assign({},e.textureDescriptor,{texture:e.texture})}else this.prepareTile(e,n,s)}}const Ot=32,Rt=33,Ft=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,n=0,o=0,s=0,a=0;for(1&e?n=o=s=Ot:i=r=a=Ot;(e>>=1)>1;){const t=i+n>>1,l=r+o>>1;1&e?(n=i,o=r,i=s,r=a):(i=n,r=o,n=s,o=a),s=t,a=l}const l=4*t;Ft[l+0]=i,Ft[l+1]=r,Ft[l+2]=n,Ft[l+3]=o}const zt=new Uint16Array(2178),Bt=new Uint8Array(1089),Ut=new Uint16Array(1089);function Vt(t){return 0===t?-.03125:32===t?.03125:0}class jt{constructor(t,e,i,r){this.id=jt.uniqueIdxCounter,jt.uniqueIdxCounter++,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=jt.uniqueIdxCounter,jt.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}jt.uniqueIdxCounter=0;const Gt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zt{constructor(t,e,i,r,n,o){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.instanceCount=o,this.context=t;const s=t.gl;this.buffer=s.createBuffer(),t.bindVertexBuffer.set(this.buffer),s.bufferData(s.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Gt[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=e.attributes[this.attributes[r].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(n,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Wt extends qt{getDefault(){return t.ax.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ht extends qt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jt extends qt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Kt extends qt{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $t extends qt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Yt extends qt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Xt extends qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Qt extends qt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class te extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class ee extends qt{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ie extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class re extends qt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ne extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class oe extends qt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class se extends qt{getDefault(){return t.ax.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ae extends qt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class le extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class ce extends qt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ue extends qt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let he=class extends qt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class pe extends qt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class de extends qt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fe extends qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class me extends qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ge extends qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class _e extends qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ye extends qt{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ae extends qt{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class ve extends qt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class xe extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class be extends qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class we extends qt{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Se extends we{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Te extends we{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ce extends we{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Me extends Te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ee{constructor(t,e,i,r,n){this.context=t,this.width=e,this.height=i;const o=this.framebuffer=t.gl.createFramebuffer();r&&(this.colorAttachment=new Se(t,o)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new Te(t,o):new Ce(t,o))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class Ie{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ie.ReadOnly=!1,Ie.ReadWrite=!0,Ie.disabled=new Ie(519,Ie.ReadOnly,[0,1]);const Le=7680;class Pe{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Pe.disabled=new Pe({func:519,mask:0},0,0,Le,Le,Le);const ke=771;class Ne{constructor(t,e,i,r){this.blendFunction=t,this.blendColor=e,this.mask=i,this.blendEquation=r}}Ne.Replace=[1,0,1,0],Ne.disabled=new Ne(Ne.Replace,t.ax.transparent,[!1,!1,!1,!1]),Ne.unblended=new Ne(Ne.Replace,t.ax.transparent,[!0,!0,!0,!0]),Ne.alphaBlended=new Ne([1,ke,1,ke],t.ax.transparent,[!0,!0,!0,!0]),Ne.multiply=new Ne([774,0,774,0],t.ax.transparent,[!0,!0,!0,!0]);const De=1029,Oe=2305;class Re{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}Re.disabled=new Re(!1,De,Oe),Re.backCCW=new Re(!0,De,Oe),Re.backCW=new Re(!0,De,2304),Re.frontCW=new Re(!0,1028,2304),Re.frontCCW=new Re(!0,1028,Oe);class Fe{constructor(t,e){this.gl=t,this.clearColor=new Wt(this),this.clearDepth=new Ht(this),this.clearStencil=new Jt(this),this.colorMask=new Kt(this),this.depthMask=new $t(this),this.stencilMask=new Yt(this),this.stencilFunc=new Xt(this),this.stencilOp=new Qt(this),this.stencilTest=new te(this),this.depthRange=new ee(this),this.depthTest=new ie(this),this.depthFunc=new re(this),this.blend=new ne(this),this.blendFunc=new oe(this),this.blendColor=new se(this),this.blendEquation=new ae(this),this.cullFace=new le(this),this.cullFaceSide=new ce(this),this.frontFace=new ue(this),this.program=new he(this),this.activeTexture=new pe(this),this.viewport=new de(this),this.bindFramebuffer=new fe(this),this.bindRenderbuffer=new me(this),this.bindTexture=new ge(this),this.bindVertexBuffer=new _e(this),this.bindElementBuffer=new ye(this),this.bindVertexArrayOES=new Ae(this),this.pixelStoreUnpack=new ve(this),this.pixelStoreUnpackPremultiplyAlpha=new xe(this),this.pixelStoreUnpackFlipY=new be(this),this.options=e?{...e}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e,i){return new jt(this,t,e,i)}createVertexBuffer(t,e,i,r,n){return new Zt(this,t,e,i,r,n)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i,r){return new Ee(this,t,e,i,r)}clear({color:t,depth:e,stencil:i,colorMask:r}){const n=this.gl;let o=0;t&&(o|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(r||[!0,!0,!0,!0])),void 0!==e&&(o|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(o|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(o)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e(t.blendFunction,Ne.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var ze=t.ay([{name:"a_pos",type:"Float32",components:3}]);class Be{constructor(e,i,r,n){const o={width:r[0],height:r[1],data:null},s=e.gl;this.targetColorTexture=new t.T(e,o,s.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(e,o,s.RGBA,{useMipmap:!1}),this.context=e,this.setNumParticles(i,n),this.lastInvalidatedAt=0}setNumParticles(e,i){if(this.numParticles===i)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const r=new t.az;r.reserve(Math.round(i));const n=t.aA(e.key);for(let t=0;t<i;t++)r.emplaceBack(n(),n(),n());this.particleVertices0=this.context.createVertexBuffer(r,ze.members,!0),this.particleVertices1=this.context.createVertexBuffer(r,ze.members,!0),this.particleSegment=t.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=i}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=t.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Ue={type:2,extent:t.V,loadGeometry:()=>[[new t.P(0,0),new t.P(t.V+1,0),new t.P(t.V+1,t.V+1),new t.P(0,t.V+1),new t.P(0,0)]]};class Ve{constructor(e,i,r,n,o){this.tileID=e,this.uid=t.aC(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<t.f.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=t.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.fqid]=r}}return i}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aE){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.aE&&i.hasRTLText){this.hasRTLText=!0,t.aF();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t],r=i.style.getOwnLayer(t);if(!r)continue;const n=r.queryRadius(e);this.queryPadding=Math.max(this.queryPadding,n)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new t.aD}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const i=e.gl,r=this.imageAtlas;if(r&&!r.uploaded){const n=!!Object.keys(r.patternPositions).length;this.imageAtlasTexture=new t.T(e,r.image,i.RGBA,{useMipmap:n}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(t,e,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=e.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,e)))}queryRenderedFeatures(t,e,i,r,n,o,s,a){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:n,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=t.aG(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const e=t.aH(n,!0);if(!a.filter(new t.K(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.K(this.tileID.overscaledZ),n))continue;const p=r.getId(n,o),d=new t.aI(n,l,c,u,p);d.tile=h,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aJ(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&e&&this.updateBuckets(t,e)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),n=i.style.listImages(),o=i.style.getBrightness();for(const s in this.buckets){if(!i.style.hasLayer(s))continue;const a=this.buckets[s],l=a.layers[0].sourceLayer||"_geojsonTileLayer",c=r[l];let u={};if(e&&(u=e[l],!c||!u||0===Object.keys(u).length))continue;if(a.update(u,c,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),a instanceof t.aK||a instanceof t.aL){const t=i.style.getOwnSourceCache(a.layers[0].source);i._terrain&&i._terrain.enabled&&t&&a.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(t.id,this.tileID)}const h=i&&i.style&&i.style.getOwnLayer(s);h&&(this.queryPadding=Math.max(this.queryPadding,h.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.f.now()+e}setTexture(e,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e,{useMipmap:!0}):(this.texture=new t.T(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=t.aM(Ue,this.tileID.canonical,this.tileTransform)[0],n=new t.aN,o=new t.aO;for(let t=0;t<r.length;t++){const{x:e,y:i}=r[t];n.emplaceBack(e,i),o.emplaceBack(t)}o.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(o),this._tileDebugBuffer=e.createVertexBuffer(n,t.aP.members),this._tileDebugSegments=t.aB.simpleSegment(0,0,n.length,o.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=t.aM(Ue,this.tileID.canonical,this.tileTransform)[0];let n,o;if(this.isRaster){const e=function(e,i){const r=t.as(e,i),n=Math.pow(2,e.z);for(let o=0;o<Rt;o++)for(let s=0;s<Rt;s++){const a=t.at((e.x+(s+Vt(s))/Ot)/n),l=t.au((e.y+(o+Vt(o))/Ot)/n),c=i.project(a,l),u=o*Rt+s;zt[2*u+0]=Math.round((c.x*r.scale-r.x)*t.V),zt[2*u+1]=Math.round((c.y*r.scale-r.y)*t.V)}Bt.fill(0),Ut.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=Ft[e+0],r=Ft[e+1],n=Ft[e+2],o=Ft[e+3],s=i+n>>1,a=r+o>>1,l=s+a-r,c=a+i-s,u=r*Rt+i,h=o*Rt+n,p=a*Rt+s,d=Math.hypot((zt[2*u+0]+zt[2*h+0])/2-zt[2*p+0],(zt[2*u+1]+zt[2*h+1])/2-zt[2*p+1])>=16;Bt[p]=Bt[p]||(d?1:0),t<1022&&(Bt[p]=Bt[p]||Bt[(r+c>>1)*Rt+(i+l>>1)]||Bt[(o+c>>1)*Rt+(n+l>>1)])}const o=new t.av,s=new t.aw;let a=0;function l(e,i){const r=i*Rt+e;return 0===Ut[r]&&(o.emplaceBack(zt[2*r+0],zt[2*r+1],e*t.V/Ot,i*t.V/Ot),Ut[r]=++a),Ut[r]-1}function c(t,e,i,r,n,o){const a=t+i>>1,u=e+r>>1;if(Math.abs(t-n)+Math.abs(e-o)>1&&Bt[u*Rt+a])c(n,o,t,e,a,u),c(i,r,n,o,a,u);else{const a=l(t,e),c=l(i,r),u=l(n,o);s.emplaceBack(a,c,u)}}return c(0,0,Ot,Ot,Ot,0),c(Ot,Ot,0,0,0,Ot),{vertices:o,indices:s}}(this.tileID.canonical,i);n=e.vertices,o=e.indices}else{n=new t.av,o=new t.aw;for(const{x:t,y:e}of r)n.emplaceBack(t,e,0,0);const e=t.aQ(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)o.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,t.aR.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(o),this._tileBoundsSegments=t.aB.simpleSegment(0,0,n.length,o.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const n=this.tileID.canonical,o=t.aS(n,i),s=t.aT(o),a=t.S(i.zoom);let l;a>0&&(l=t.a6.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,n,i,s,l,a),this._makeGlobeTileDebugTextBuffer(e,n,i,s,l,a)}_globePoint(e,i,r,n,o,s,a){let l=t.aU(e,i,r);if(s){const o=1<<r.z,c=t.a5(n.center.lng),u=t.ae(n.center.lat),h=(r.x+.5)/o-c;let p=0;h>.5?p=-1:h<-.5&&(p=1);let d=(e/t.V+r.x)/o+p,f=(i/t.V+r.y)/o;d=(d-c)*n._pixelsPerMercatorPixel+c,f=(f-u)*n._pixelsPerMercatorPixel+u;const m=[d*n.worldSize,f*n.worldSize,0];t.N.transformMat4(m,m,s),l=t.aV(l,m,a)}return t.N.transformMat4(l,l,o)}_makeGlobeTileDebugBorderBuffer(e,i,r,n,o,s){const a=new t.aN,l=new t.aO,c=new t.aW,u=(t,e,u,h,p)=>{const d=(u-t)/(p-1),f=(h-e)/(p-1),m=a.length;for(let u=0;u<p;u++){const h=t+u*d,p=e+u*f;a.emplaceBack(h,p);const g=this._globePoint(h,p,i,r,n,o,s);c.emplaceBack(g[0],g[1],g[2]),l.emplaceBack(m+u)}},h=t.V;u(0,0,h,0,16),u(h,0,h,h,16),u(h,h,0,h,16),u(0,h,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(a,t.aP.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(c,t.aX.members),this._tileDebugSegments=t.aB.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(e,i,r,n,o,s){const a=t.V/4,l=new t.aN,c=new t.aw,u=new t.aW,h=25;c.reserve(32),l.reserve(h),u.reserve(h);const p=(t,e)=>h*t+e;for(let t=0;t<h;t++){const e=t*a;for(let t=0;t<h;t++){const c=t*a;l.emplaceBack(c,e);const h=this._globePoint(c,e,i,r,n,o,s);u.emplaceBack(h[0],h[1],h[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=p(t,e),r=p(t,e+1),n=p(t+1,e),o=p(t+1,e+1);c.emplaceBack(i,r,n),c.emplaceBack(n,r,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(c),this._tileDebugTextBuffer=e.createVertexBuffer(l,t.aP.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,t.aX.members),this._tileDebugTextSegments=t.aB.simpleSegment(0,0,h,32)}destroy(e=!1){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const je={vector:kt,raster:Nt,"raster-dem":class extends Nt{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(t,r){t&&(e.state="errored",i(t)),r&&(e.dem=r,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.d(this.map._requestManager.transformRequest(r,t.R.Tile),function(r,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const i=ImageBitmap&&o instanceof ImageBitmap&&t.ak(),r=1-(o.width-t.al(o.width))/2;r<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?o:t.f.getImageData(o,r),c={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:r};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.am(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.am(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.am(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.am(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.am(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.am(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}},"raster-array":Dt,geojson:class extends t.E{constructor(e,i,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.V/this.tileSize;this.workerOptions=t.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.V,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.V,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.b("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.e({},this.workerOptions);e.scope=this.scope;const i=this._data;"string"==typeof i?(e.request=this.map._requestManager.transformRequest(t.f.resolveURL(i),t.R.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,i)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.a(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(e.resourceTiming=i.resourceTiming[this.id]),this.fire(new t.b("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,i){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:t.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(r,n,((t,n)=>(delete e.request,e.destroy(),e.aborted?i(null):t?i(t):(e.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.ap{constructor(t,e,i,r){super(t,e,i,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.R.Source).url);t.aq(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.a(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.a(new w(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.ap,model:class extends t.E{constructor(t,e,i,r){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const e=[];for(const i in this._options.models){const r=this._options.models[i],n=t.l(this.map._requestManager.transformRequest(r.uri,t.R.Model).url).then((e=>{if(!e)return;const n=t.c(e),o=new t.M(i,r.position,r.orientation,n);o.computeBoundsAndApplyParent(),this.models.push(o)})).catch((e=>{this.fire(new t.a(new Error(`Could not load model ${i} from ${r.uri}: ${e.message}`)))}));e.push(n)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new t.a(new Error(`Could not load models: ${e.message}`)))}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(t,e,i,r){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(t){this.map=t,this.load()}load(e){this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Lt(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new t.a(n))):o&&(t.e(this,o),o.bounds&&(this.tileBounds=new Pt(o.bounds,this.minzoom,this.maxzoom)),t.aj(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)}))}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(e,i){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=i;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",n,o.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",n,o.bind(this),void 0,!0);function o(t,r){return e.aborted?i(null):t&&404!==t.status?i(t):(r&&(r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(r),e.buckets={...e.buckets,...r.buckets},r.featureIndex&&(e.latestFeatureIndex=r.featureIndex)),e.state="loaded",void i(null))}}serialize(){return t.e({},this._options)}},canvas:class extends t.ap{constructor(e,i,r,n){super(e,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.a(new w(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.a(new w(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.a(new w(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.a(new w(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.a(new w(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof t.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.E{constructor(e,i,r,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.e(this,t.ac(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new t.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:r,z:n}=t.tileID.canonical,o=new AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:o.signal})).then(function(i){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===i?(t.state="errored",e(null)):null===i?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement}(i)?(this.loadTileData(t,i),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(t.state="errored",e(i))})),t.request.cancel=()=>o.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(e,i){if(e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:i,z:r}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:r})}i()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){const e=t.ag(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new t.b("data",{dataType:"source",sourceDataType:"content"}))}}},Ge=function(e,i,r,n){const o=new je[i.type](e,i,r,n);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.aY(["load","abort","unload","serialize","prepare"],o),o};function Ze(e,i){const r=t.a6.identity([]);return t.a6.scale(r,r,[.5*e.width,.5*-e.height,1]),t.a6.translate(r,r,[1,-1,0]),t.a6.multiply(r,r,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function qe(t,e,i,r,n,o,s,a=!1){const l=t.tilesIn(r,s,a);l.sort(He);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r,n,o,Ze(t.transform,r.tile.tileID),a)});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&"slot"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(r["source-layer"],i.id):{})}));return u}function We(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}function He(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class Je extends Ve{constructor(t,e,i,r,n){super(t,e,i,r,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof t.T?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new t.T(r,e,n.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,i){const r=this._mrt=new t.aZ(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=t.a_(n,((t,n,o,s)=>{if(t)i(t);else try{const t=r.getHeaderLength(n);if(t>e)return void(this.request=this.fetchHeader(t,i));r.parseHeader(n),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(r.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].last_byte);n.byteLength>=a&&(this.entireBuffer=n),i(null,this.entireBuffer||n,o,s)}catch(t){i(t)}})),this.request}fetchBand(e,i,r){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void r(new Error("Tile header is not ready"));const o=this.actor;if(!o)return void r(new Error("Can't fetch tile band without an actor"));let s;const a=(t,n)=>{s.complete(t,n),t?r(t):(this.updateTextureDescriptor(e,i),r(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(t,e)=>{if(t)return r(t);const i=o.send("decodeRasterArray",{buffer:e,task:s},a,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),s.cancel()}))},c=n.getLayer(e);if(!c)return void r(new Error(`Unknown sourceLayer "${e}"`));if(c.hasDataForBand(i))return this.updateTextureDescriptor(e,i),void r(null,this.textureDescriptor?this.textureDescriptor.img:null);const u=c.getDataRange([i]);if(s=n.createDecodingTask(u),!s||s.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(u.firstByte,u.lastByte+1));else{const e=Object.assign({},this.requestParams,{headers:{Range:`bytes=${u.firstByte}-${u.lastByte}`}}),i=t.a_(e,l);this._fetchQueue.push((()=>{i.cancel(),s.cancel()}))}else r(null)}updateNeeded(t,e){return(!this.textureDescriptor||this.textureDescriptor.band!==e||this.textureDescriptor.layer!==t)&&"errored"!==this.state}updateTextureDescriptor(e,i){if(!this._mrt)return;const r=this._mrt.getLayer(e);if(!r||!r.hasBand(i)||!r.hasDataForBand(i))return;const{bytes:n,tileSize:o,buffer:s,offset:a,scale:l}=r.getBandView(i),c=o+2*s,u={data:n,width:c,height:c},h=this.texture;h&&h instanceof t.T&&h.update(u,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:i,img:u,buffer:s,offset:a,tileSize:o,format:r.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Ke{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class $e extends t.E{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new Ke(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new v,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("errored"!==e.state&&("loaded"!==e.state||!e.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,(()=>{}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return t.a$(this._tiles).map((t=>t.tileID)).sort(Ye).map((t=>t.key))}getRenderableIds(e,i){const r=[];for(const t in this._tiles)this._isIdRenderable(+t,e,i)&&r.push(this._tiles[t]);return e?r.sort(((e,i)=>{const r=e.tileID,n=i.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new t.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):r.map((t=>t.tileID)).sort(Ye).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(e,i,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new t.a(n,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new t.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=t.f.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.b("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,r=Math.ceil(t.height/e)+1,n=Math.floor(i*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(e,i,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let o;if(this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.am(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)));else if(0!==this.tileCoverLift){const n=e.clone();n.tileCoverLift=this.tileCoverLift,o=n.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===e.projection.name&&(o.push(new t.am(1,0,1,0,0)),o.push(new t.am(1,0,1,1,0)),o.push(new t.am(1,0,1,0,1)),o.push(new t.am(1,0,1,1,1)))}else o=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter((t=>this._source.hasTile(t))));else o=[];if(o.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Xe(this._source.type)){const t=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),s=Math.min(t,this._source.maxzoom),a=e.extendTileCoverForShadows(o,n,s);for(const t of a)this._shadowCasterTiles[t.key]=!0,o.push(t)}const s=this._updateRetainedTiles(o);if(Xe(this._source.type)&&0!==o.length){const e={},i={},r=Object.keys(s);for(const n of r){const r=s[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=t.f.now())continue;const a=this.findLoadedParent(r,Math.max(r.overscaledZ-$e.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),e[a.tileID.key]=a.tileID),i[n]=r}const n=o[o.length-1].overscaledZ;for(const t in this._tiles){const e=this._tiles[t];if(s[t]||!e.hasData())continue;let r=e.tileID;for(;r.overscaledZ>n;){r=r.scaledTo(r.overscaledZ-1);const n=this._tiles[r.key];if(n&&n.hasData()&&i[r.key]){s[t]=e.tileID;break}}}for(const t in e)s[t]||(this._coveredTiles[t]=!0,s[t]=e[t])}for(const t in s)this._tiles[t].clearFadeHold();const a=t.b0(this._tiles,s);for(const t of a){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},r=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),n=t[0].overscaledZ,o=Math.max(n-$e.maxOverzooming,this._source.minzoom),s=Math.max(n+$e.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||r<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,r,s,e);for(const r of t){let t=this._tiles[r.key];if(t.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const t=r.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=r.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let n=t.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&n&&(t=this._addTile(o)),t&&(e[o.key]=o,n=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=Boolean(i);if(!r){const t=this.map?this.map.painter:null,r=this._source.tileSize*e.overscaleFactor();i="raster-array"===this._source.type?new Je(e,r,this.transform.tileZoom,t,this._isRaster):new Ve(e,r,this.transform.tileZoom,t,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.b("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state||"empty"===e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const n=[],o=this.transform;if(!o)return n;const s="globe"===o.projection.name,a=t.a5(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(r&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(s){const e=c.tileID.canonical;if(0===e.z){const i=[Math.abs(t.aa(a,...Qe(e,-1))-a),Math.abs(t.aa(a,...Qe(e,1))-a)];u=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(t.aa(a,...Qe(e,-1))-a),Math.abs(t.aa(a,...Qe(e,0))-a),Math.abs(t.aa(a,...Qe(e,1))-a)];u=[i.indexOf(Math.min(...i))-1]}}else u=[0];for(const t of u){const r=e.containsTile(c,o,i,t);r&&n.push(r)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const i=this.getRenderableIds(t,e).map((t=>this._tiles[t].tileID)),r="globe"===this.transform.projection.name;for(const t of i)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped()),t.expandedProjMatrix=r?this.transform.calculateProjMatrix(t.toUnwrapped(),!1,!0):t.projMatrix;return i}sortCoordinatesByDistance(t){const e=t.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const t of e){const e=1/(1<<t.canonical.z);n[t.key]=((t.canonical.x+.5)*e+t.wrap-i[0])*r[0]+((t.canonical.y+.5)*e-i[1])*r[1]-i[2]*r[2]}return e.sort(((t,e)=>n[t.key]-n[e.key])),e}hasTransition(){if(this._source.hasTransition())return!0;if(Xe(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=t.f.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(e,i){if(!this._sourceLoaded){const t=()=>{this._sourceLoaded&&(this._source.off("data",t),this._preloadTiles(e,i))};return void this._source.on("data",t)}const r=new Map,n=Array.isArray(e)?e:[e],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const t of n){const e=t.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)r.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}const a=Array.from(r.values());t.b1(a,((t,e)=>{const i=new Ve(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),i)}}function Ye(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Xe(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Qe(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}$e.maxOverzooming=10,$e.maxUnderzooming=3;class ti{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,e=!1;for(const i in this.style._mergedLayers){const r=this.style._mergedLayers[i];if("fill-extrusion"===r.type)this.layers.push({layer:r,visible:t,visibilityChanged:e});else if("model"===r.type){const i=this.style.getLayerSource(r);i&&"batched-model"===i.type&&this.layers.push({layer:r,visible:t,visibilityChanged:e})}}}onNewFrame(t){this.layersGotHidden=!1;for(const e of this.layers){const i=e.layer;let r=!1;"fill-extrusion"===i.type?r=!i.isHidden(t)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(r=!i.isHidden(t)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!r&&e.visible,e.visible=r}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(const t of this.layers){const i=t.layer,r=this.style.getLayerSourceCache(i);let n=1;"fill-extrusion"===i.type&&(n=t.visible?i.paint.get("fill-extrusion-vertical-scale"):0);let o=r?r.getTile(e):null;if(!o&&r&&e.canonical.z>r.getSource().minzoom){let t=e.scaledTo(Math.min(r.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=r.getSource().minzoom&&(o=r.getTile(t),!o&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:o?o.getBucket(i):null,tileID:o?o.tileID:e,verticalScale:n})}t.hasAnyZOffset=!1;let i=!1;for(let r=0;r<t.symbolInstances.length;r++){const n=t.symbolInstances.get(r),o=n.zOffset,s=this._getHeightAtTileOffset(e,n.tileAnchorX,n.tileAnchorY);n.zOffset=s!==Number.NEGATIVE_INFINITY?s:o,i||o===n.zOffset||(i=!0),t.hasAnyZOffset||0===n.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,r,n){let o=i,s=r;if(e.canonical.z!==n.canonical.z){const a=n.canonical,l=1/(1<<e.canonical.z-a.z);o=(i+e.canonical.x*t.V)*l-a.x*t.V|0,s=(r+e.canonical.y*t.V)*l-a.y*t.V|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(t,e,i){let r,n;for(let o=0;o<this.layers.length;++o){if("fill-extrusion"!==this.layers[o].layer.type)continue;const{bucket:s,tileID:a,verticalScale:l}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(t,e,i,a),h=s.getHeightAtTileCoord(c,u);h&&void 0!==h.height&&(h.hidden?r=h.height:n=Math.max(h.height*l,n||0))}if(void 0!==n)return n;for(let n=0;n<this.layers.length;++n){const o=this.layers[n];if("model"!==o.layer.type||!o.visible)continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[n];if(!s)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(t,e,i,a),u=s.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==r?Math.min(u.maxHeight,r)*u.verticalScale:(u.height||0)*u.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ei(e,i){const r={};for(const t in e)"ref"!==t&&(r[t]=e[t]);return t.b2.forEach((t=>{t in i&&(r[t]=i[t])})),r}function ii(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=ei(t[i],e[t[i].ref]));return t}const ri={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ni(t,e,i){i.push({command:ri.addSource,args:[t,e[t]]})}function oi(t,e,i){e.push({command:ri.removeSource,args:[t]}),i[t]=!0}function si(t,e,i,r){oi(t,i,r),ni(t,e,i)}function ai(t,i,r){let n;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!e(t[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!e(t[r][n],i[r][n]))return!1;return!0}function li(t,i,r,n,o,s){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e(t[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}))}function ci(t){return t.id}function ui(t,e){return t[e.id]=e,t}class hi{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.aa(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class pi{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o){if(i<0||t>this.width||r<0||e>this.height)return!n&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}return o?s.filter(o):s}return this._forEachCell(t,e,i,r,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(t,e,i,r,n){return this._query(t,e,i,r,!1,n)}hitTest(t,e,i,r,n){return this._query(t,e,i,r,!0,n)}hitTestCircle(t,e,i,r){return this._queryCircle(t,e,i,!0,r)}_queryCell(t,e,i,r,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=n[c+2]&&e<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],t,e,i,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=n[u],e=n[u+1],i=n[u+2];o.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,r,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+p,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,p=u-c;return h*h+p*p<=i*i}}const di={unknown:0,flipRequired:1,flipNotRequired:2},fi=Math.tan(85*Math.PI/180);function mi(e,i,r,n,o,s,a){const l=t.a6.create();if(r)if("globe"===s.name){const e=t.b3(o,i);t.a6.multiply(l,l,e)}else{const e=t.b4.invert([],a);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],n||t.a6.rotateZ(l,l,o.angle)}else t.a6.multiply(l,o.labelPlaneMatrix,e);return l}function gi(t,e,i,r,n,o,s){const a=mi(t,e,i,r,n,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function _i(e,i,r,n,o,s,a){if(r){if("globe"===s.name){const l=mi(e,i,r,n,o,s,a);return t.a6.invert(l,l),t.a6.multiply(l,e,l),l}{const i=t.a6.clone(e),r=t.a6.identity([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],t.a6.multiply(i,i,r),n||t.a6.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function yi(e,i,r,n){const o=[e,i,r,1];r?t.a7.transformMat4(o,o,n):Ii(o,o,n);const s=o[3];return o[0]/=s,o[1]/=s,o[2]/=s,o}function Ai(t,e){return Math.min(.5+t/e*.5,1.5)}function vi(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function xi(e,i,r,n,o,s,a,l,c,u){const h=r.transform,p=n?e.textSizeData:e.iconSizeData,d=t.b5(p,r.transform.zoom),f="globe"===h.projection.name,m=[256/r.width*2+1,256/r.height*2+1],g=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=n?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const y=e.lineVertexArray,A=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height;let x,b=!1;for(let n=0;n<A.length;n++){const f=A.get(n),{numGlyphs:w,writingMode:S}=f;if(S!==t.b6.vertical||b||x===t.b6.horizontal||(b=!0),x=S,(f.hidden||S===t.b6.vertical)&&!b){Ei(w,g);continue}b=!1;const T=new t.P(f.tileAnchorX,f.tileAnchorY);let{x:C,y:M,z:E}=h.projection.projectTilePoint(T.x,T.y,u.canonical);if(c){const[t,e,i]=c(T);C+=t,M+=e,E+=i}const I=[C,M,E,1];if(t.a7.transformMat4(I,I,i),!vi(I,m)){Ei(w,g);continue}const L=I[3],P=Ai(r.transform.getCameraToCenterDistance(h.projection),L),k=t.b7(p,d,f),N=a?k/P:k*P,D=yi(C,M,E,o);if(D[3]<=0){Ei(w,g);continue}let O={};const R=a?null:c,F=Si(f,N,!1,l,i,o,s,e.glyphOffsetArray,y,g,_,D,T,O,v,R,h.projection,u,a);b=F.useVertical,R&&F.needsFlipping&&(O={}),(F.notEnoughRoom||b||F.needsFlipping&&Si(f,N,!0,l,i,o,s,e.glyphOffsetArray,y,g,_,D,T,O,v,R,h.projection,u,a).notEnoughRoom)&&Ei(w,g)}n?(e.text.dynamicLayoutVertexBuffer.updateData(g),_&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(_)):(e.icon.dynamicLayoutVertexBuffer.updateData(g),_&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(_))}function bi(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=a,A=_+a.numGlyphs,v=g+a.lineLength,x=e.getoffsetX(_),b=e.getoffsetX(A-1),w=Mi(t*x,i,r,n,o,s,y,g,v,l,c,u,h,p,!0,d,f,m);if(!w)return null;const S=Mi(t*b,i,r,n,o,s,y,g,v,l,c,u,h,p,!0,d,f,m);return S?{first:w,last:S}:null}function wi(e,i,r,n){return e===t.b6.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:e===t.b6.vertical?n>0?{needsFlipping:!0}:null:i!==di.unknown&&function(t,e){return 0===t||Math.abs(e/t)>fi}(r,n)?i===di.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Si(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A){const v=i/24,x=e.lineOffsetX*v,b=e.lineOffsetY*v,{lineStartIndex:w,glyphStartIndex:S,numGlyphs:T,segment:C,writingMode:M,flipState:E}=e,I=w+e.lineLength,L=e=>{if(h){const[i,r,n]=e.up,o=u.length;t.b8(h,o+0,i,r,n),t.b8(h,o+1,i,r,n),t.b8(h,o+2,i,r,n),t.b8(h,o+3,i,r,n)}const[i,r,n]=e.point;t.b9(u,i,r,n,e.angle)};if(T>1){const t=bi(v,l,x,b,r,p,d,e,c,s,f,g,!1,_,y,A);if(!t)return{notEnoughRoom:!0};if(n&&!r){let[i,r,n]=t.first.point,[o,s,l]=t.last.point;[i,r]=yi(i,r,n,a),[o,s]=yi(o,s,l,a);const c=wi(M,E,(o-i)*m,s-r);if(e.flipState=c&&c.needsFlipping?di.flipRequired:di.flipNotRequired,c)return c}L(t.first);for(let t=S+1;t<S+T-1;t++){const e=Mi(v*l.getoffsetX(t),x,b,r,p,d,C,w,I,c,s,f,g,!1,!1,_,y,A);if(!e)return u.length-=4*(t-S),{notEnoughRoom:!0};L(e)}L(t.last)}else{if(n&&!r){const i=yi(d.x,d.y,0,o),r=w+C+1,n=new t.P(c.getx(r),c.gety(r)),s=yi(n.x,n.y,0,o),a=s[3]>0?s:Ci(d,n,i,1,o,void 0,_,y.canonical),l=wi(M,E,(a[0]-i[0])*m,a[1]-i[1]);if(e.flipState=l&&l.needsFlipping?di.flipRequired:di.flipNotRequired,l)return l}const i=Mi(v*l.getoffsetX(S),x,b,r,p,d,C,w,I,c,s,f,g,!1,!1,_,y,A);if(!i)return{notEnoughRoom:!0};L(i)}return{}}function Ti(t,e,i,r,n){const{x:o,y:s,z:a}=r.projectTilePoint(t.x,t.y,e);if(!n)return yi(o,s,a,i);const[l,c,u]=n(t);return yi(o+l,s+c,a+u,i)}function Ci(e,i,r,n,o,s,a,l){const c=Ti(e.sub(i)._unit()._add(e),l,o,a,s);return t.N.sub(c,r,c),t.N.normalize(c,c),t.N.scaleAndAdd(c,r,c,n)}function Mi(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y){const A=n?e-i:e+i;let v=A>0?1:-1,x=0;n&&(v*=-1,x=Math.PI),v<0&&(x+=Math.PI);let b=l+a+(v>0?0:1)|0,w=o,S=o,T=0,C=0;const M=Math.abs(A),E=[],I=[];let L=s,P=L;const k=()=>Ci(P,L,S,M-T+1,h,d,g,_.canonical);for(;T+C<=M;){if(b+=v,b<l||b>=c)return null;if(S=w,P=L,E.push(S),f&&I.push(P),L=new t.P(u.getx(b),u.gety(b)),w=p[b],!w){const t=Ti(L,_.canonical,h,g,d);w=t[3]>0?p[b]=t:k()}T+=C,C=t.N.distance(S,w)}m&&d&&(p[b]&&(w=k(),C=t.N.distance(S,w)),p[b]=w);const N=(M-T)/C,D=L.sub(P)._mult(N)._add(P),O=t.N.sub([],w,S),R=t.N.scaleAndAdd([],S,O,N);let F=[0,0,1],z=O[0],B=O[1];if(y&&(F=g.upVector(_.canonical,D.x,D.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],i=t.N.cross([],F,e);t.N.normalize(e,e),t.N.normalize(i,i),z=t.N.dot(O,e),B=t.N.dot(O,i)}if(r){const e=t.N.cross([],F,O);t.N.normalize(e,e),t.N.scaleAndAdd(R,R,e,r*v)}const U=x+Math.atan2(B,z);return E.push(R),f&&I.push(D),{point:R,angle:U,path:E,tilePath:I,up:F}}function Ei(t,e){const i=e.length,r=i+4*t;e.resize(r),e.float32.fill(-1/0,4*i,4*r)}function Ii(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const Li=100;class Pi{constructor(t,e,i=new pi(t.width+200,t.height+200,25),r=new pi(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Li,this.screenBottomBoundary=t.height+Li,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,r,n,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,p=i.tileID,d=t.getProjection();if(h&&p){const[t,e,r]=d.upVector(p.canonical,i.tileAnchorX,i.tileAnchorY),n=d.upVectorScale(p.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t*h*n,c+=e*h*n,u+=r*h*n}const f=this.projectAndGetPerspectiveRatio(s,l,c,u,i.tileID,"globe"===d.name||!!h||this.transform.pitch>0,d),m=o*f.perspectiveRatio,g=(i.x1*e+r.x-i.padding)*m+f.point.x,_=(i.y1*e+r.y-i.padding)*m+f.point.y,y=(i.x2*e+r.x+i.padding)*m+f.point.x,A=(i.y2*e+r.y+i.padding)*m+f.point.y,v=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,A)||!n&&this.grid.hitTest(g,_,y,A,a)||v?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,A],offscreen:this.isOffscreen(g,_,y,A),occluded:!1}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m){const g=[],_=this.transform.elevation,y=e.getProjection(),A=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,v=new t.P(r.tileAnchorX,r.tileAnchorY);let{x,y:b,z:w}=y.projectTilePoint(v.x,v.y,m.canonical);if(A){const[t,e,i]=A(v);x+=t,b+=e,w+=i}const S="globe"===y.name,T=this.projectAndGetPerspectiveRatio(a,x,b,w,m,S||!!_||this.transform.pitch>0,y),{perspectiveRatio:C}=T,M=(h?s/C:s*C)/t.bc,E=yi(x,b,w,l),I=T.signedDistanceFromCamera>0?bi(M,o,r.lineOffsetX*M,r.lineOffsetY*M,!1,E,v,r,n,l,{},_&&!h?A:null,h&&!!_,y,m,h):null;let L=!1,P=!1,k=!0;if(I&&!T.occluded){const e=.5*d*C+f,r=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new hi,{first:s,last:a}=I,l=s.path.length;let h=[];for(let t=l-1;t>=1;t--)h.push(s.path[t]);for(let t=1;t<a.path.length;t++)h.push(a.path[t]);const m=2.5*e;c&&(h=h.map((([t,e,i],r)=>(A&&!S&&(i=A(r<l-1?s.tilePath[l-1-r]:a.tilePath[r-l+2])[2]),yi(t,e,i,c)))),h.some((t=>t[3]<=0))&&(h=[]));let _=[];if(h.length>0){let e=1/0,i=-1/0,o=1/0,s=-1/0;for(const t of h)e=Math.min(e,t[0]),o=Math.min(o,t[1]),i=Math.max(i,t[0]),s=Math.max(s,t[1]);i>=r.x&&e<=n.x&&s>=r.y&&o<=n.y&&(_=[h.map((e=>new t.P(e[0],e[1])))],(e<r.x||i>n.x||o<r.y||s>n.y)&&(_=t.ba(_,r.x,r.y,n.x,n.y)))}for(const t of _){o.reset(t,.25*e);let r=0;r=o.length<=.5*e?1:Math.ceil(o.paddedLength/m)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+Li,l=s.y+Li;g.push(a,l,e,0);const c=a-e,h=l-e,d=a+e,f=l+e;if(k=k&&this.isOffscreen(c,h,d,f),P=P||this.isInsideGrid(c,h,d,f),!i&&this.grid.hitTestCircle(a,l,e,p)&&(L=!0,!u))return{circles:[],offscreen:!1,collisionDetected:L,occluded:!1}}}}return{circles:!u&&L||!P?[]:g,offscreen:k,collisionDetected:L,occluded:T.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+Li,a.y+Li);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.bb(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(t,e,i,r,n){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let e=0;e<t.length;e+=4)o.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,r,n,o,s,a){const l=[i,r,n,1];let c=!1;if(n||this.transform.pitch>0){if(t.a7.transformMat4(l,l,e),this.fogState&&o&&"globe"!==a.name){const e=function(e,i,r,n,o,s){const a=s.calculateFogTileMatrix(o),l=[i,r,n];return t.N.transformMat4(l,l,a),_t(e,t.N.length(l),s.pitch,s._fov)}(this.fogState,i,r,n,o.toUnwrapped(),this.transform);c=e>.9}}else Ii(l,l,e);const u=l[3];return{point:new t.P((l[0]/u+1)/2*this.transform.width+Li,(-l[1]/u+1)/2*this.transform.height+Li),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:s&&l[2]>u||c}}isOffscreen(t,e,i,r){return i<Li||t>=this.screenRightBoundary||r<Li||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.a6.identity([]);return t.a6.translate(e,e,[-100,-100,0]),e}}function ki(e,i,r){const n=i.createTileMatrix(e,e.worldSize,r.toUnwrapped());return t.a6.multiply(new Float32Array(16),e.projMatrix,n)}function Ni(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const r=i.clone();return r.setProjection(e.projection),ki(r,e.getProjection(),t)}function Di(t,e,i){return e.name===i.projection.name?t.projMatrix:ki(i,e,t)}class Oi{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ri{constructor(t,e,i,r,n,o=!1){this.text=new Oi(t?t.text:null,e,i,n),this.icon=new Oi(t?t.icon:null,e,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fi{constructor(t,e,i,r=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=r}}class zi{constructor(){this.invProjMatrix=t.a6.create(),this.viewportMatrix=t.a6.create(),this.circles=[]}}class Bi{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Ui{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Vi(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.bf(e),l=-(s-.5)*i,c=-(a-.5)*r,u=t.bd(e,n);return new t.P(l+u[0]*o,c+u[1]*o)}function ji(e,i,r,n,o){const s=new t.P(e,i);return r&&s._rotate(n?o:-o),s}class Gi{constructor(t,e,i,r,n,o){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Pi(this.transform,n),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Ui(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.fqid!==o.layerIds[0])return;const a=o.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.V,h=r.tileID.toUnwrapped();this.transform.setProjection(o.projection);const p=(d=r.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(d.toUnwrapped()):ki(m,f,d));var d,f,m;const g="map"===a.get("text-pitch-alignment"),_="map"===a.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),A=i.dynamicFilterNeedsFeature(),v=this.transform.calculatePixelsToTileUnitsMatrix(r),x=gi(p,r.tileID.canonical,g,_,this.transform,o.getProjection(),v);let b=null;if(g){const e=_i(p,r.tileID.canonical,g,_,this.transform,o.getProjection(),v);b=t.a6.multiply([],this.transform.labelPlaneMatrix,e)}let w=null;y&&r.latestFeatureIndex&&(w={unwrappedTileID:h,dynamicFilter:y,dynamicFilterNeedsFeature:A,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Bi(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const S={bucket:o,layout:a,posMatrix:p,textLabelPlaneMatrix:x,labelToScreenMatrix:b,clippingData:w,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.b5(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.b5(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:S})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:S})}attemptAnchorPlacement(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_){const{textOffset0:y,textOffset1:A,crossTileID:v}=h,x=[y,A],b=Vi(t,i,r,x,n),w=this.collisionIndex.placeCollisionBox(d,n,e,ji(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate);if(m){const t=d.getSymbolInstanceIconSize(_,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(d,t,m,ji(b.x,b.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)return}if(w.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[v]&&this.prevPlacement.placements[v]&&this.prevPlacement.placements[v].text&&(e=this.prevPlacement.variableOffsets[v].anchor),this.variableOffsets[v]={textOffset:x,width:i,height:r,anchor:t,textScale:n,prevAnchor:e},this.markUsedJustification(d,t,h,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,h),this.placedOrientations[v]=f),{shift:b,placedGlyphBoxes:w}}}placeLayerBucketPart(e,i,r,n){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:p,collisionBoxArray:d,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=e.parameters,_=s.get("text-optional"),y=s.get("icon-optional"),A=s.get("text-allow-overlap"),v=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="viewport-y"===s.get("symbol-z-order"),S=s.get("symbol-z-elevate");this.transform.setProjection(o.projection);let T=A&&(v||!o.hasIconData()||y),C=v&&(A||!o.hasTextData()||_);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d),r&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,d);const M=(e,n,d)=>{const{crossTileID:w,numVerticalGlyphVertices:S}=e;if(u){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(r,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.P(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[w]=new Fi(!1,!1,!1,!0),void i.add(w)}if(i.has(w))return;if(p)return void(this.placements[w]=new Fi(!1,!1,!1));let M=!1,E=!1,I=!0,L=!1,P=!1,k=null,N={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},O=null,R=null,F=null,z=0,B=0,U=0;d.textFeatureIndex?z=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(z=e.featureIndex),d.verticalTextFeatureIndex&&(B=d.verticalTextFeatureIndex);const V=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const i=this.transform.elevation;t.elevation=e.zOffset+(i?i.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},j=d.textBox;if(j){V(j);const i=i=>{let r=t.b6.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[w];t&&(this.placedOrientations[w]=t,r=t,this.markUsedOrientation(o,r,e))}return r},r=(e,i)=>{if(o.allowVerticalPlacement&&S>0&&d.verticalTextBox){for(const r of o.writingModes)if(r===t.b6.vertical?(N=i(),D=N):N=e(),N&&N.box&&N.box.length)break}else N=e()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[w]){const t=this.prevPlacement.variableOffsets[w];l.indexOf(t.anchor)>0&&(l=l.filter((e=>e!==t.anchor)),l.unshift(t.anchor))}const c=(t,i,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),c=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,p=e.hasIconTextFit&&!v?i:null;p&&V(p);let d={box:[],offscreen:!1,occluded:!1};const _=A?2*l.length:l.length;for(let i=0;i<_;++i){const _=this.attemptAnchorPlacement(l[i%l.length],t,c,u,s,x,b,h,a,g,i>=l.length,e,n,o,r,p,f,m);if(_&&(d=_.placedGlyphBoxes,d&&d.box&&d.box.length)){M=!0,k=_.shift;break}}return d};r((()=>c(j,d.iconBox,t.b6.horizontal)),(()=>{const e=d.verticalTextBox;return e&&V(e),o.allowVerticalPlacement&&!(N&&N.box&&N.box.length)&&S>0&&e?c(e,d.verticalIconBox,t.b6.vertical):{box:null,offscreen:null,occluded:null}})),N&&(M=N.box,I=N.offscreen,L=N.occluded);const u=i(!(!N||!N.box));if(!M&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[w];t&&(this.variableOffsets[w]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const s=(i,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,s,i,new t.P(0,0),A,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,r,e),this.placedOrientations[w]=r),l};r((()=>s(j,t.b6.horizontal)),(()=>{const e=d.verticalTextBox;return o.allowVerticalPlacement&&S>0&&e?(V(e),s(e,t.b6.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(N&&N.box&&N.box.length))}}if(O=N,M=O&&O.box&&O.box.length>0,I=O&&O.offscreen,L=O&&O.occluded,e.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),n=t.b7(o.textSizeData,f,i),u=s.get("text-padding");R=this.collisionIndex.placeCollisionCircles(o,A,i,o.lineVertexArray,o.glyphOffsetArray,n,a,l,c,r,b,g.predicate,e.collisionCircleDiameter*n/t.bc,u,this.retainedQueryData[o.bucketInstanceId].tileID),M=A||R.circles.length>0&&!R.collisionDetected,I=I&&R.offscreen,L=R.occluded}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const i=i=>{V(i);const r=e.hasIconTextFit&&k?ji(k.x,k.y,x,b,this.transform.angle):new t.P(0,0),n=o.getSymbolInstanceIconSize(m,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,n,i,r,v,h,a,g.predicate)};D&&D.box&&D.box.length&&d.verticalIconBox?(F=i(d.verticalIconBox),E=F.box.length>0):(F=i(d.iconBox),E=F.box.length>0),I=I&&F.offscreen,P=F.occluded}const G=_||0===e.numHorizontalGlyphVertices&&0===S,Z=y||0===e.numIconVertices;if(G||Z?Z?G||(E=E&&M):M=E&&M:E=M=E&&M,M&&O&&O.box&&this.collisionIndex.insertCollisionBox(O.box,s.get("text-ignore-placement"),o.bucketInstanceId,D&&D.box&&B?B:z,g.ID),E&&F&&this.collisionIndex.insertCollisionBox(F.box,s.get("icon-ignore-placement"),o.bucketInstanceId,U,g.ID),R&&(M&&this.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,z,g.ID),r)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new zi);for(let t=0;t<R.circles.length;t+=4)e.circles.push(R.circles[t+0]),e.circles.push(R.circles[t+1]),e.circles.push(R.circles[t+2]),e.circles.push(R.collisionDetected?1:0)}const q="globe"!==o.projection.name;T=T&&(q||!L),C=C&&(q||!P),this.placements[w]=new Fi(M||T,E||C,I||o.justReloaded),i.add(w)};if(S&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),w){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];M(o.symbolInstances.get(i),i,o.collisionArrays[i])}o.hasAnyZOffset&&t.w(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){const t=o.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const i=t[e];M(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)M(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.a6.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,i,r,n){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,u=t.be(i),h=n===t.b6.vertical?l:"left"===u?o:"center"===u?s:"right"===u?a:-1;o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=h>=0&&o!==h?0:c),s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=h>=0&&s!==h?0:c),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=h>=0&&a!==h?0:c),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=h>=0&&l!==h?0:c)}markUsedOrientation(e,i,r){const n=i===t.b6.horizontal||i===t.b6.horizontalOnly?i:0,o=i===t.b6.vertical?i:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,u=e.text.placedSymbolArray;s>=0&&(u.get(s).placedOrientation=n),a>=0&&(u.get(a).placedOrientation=n),l>=0&&(u.get(l).placedOrientation=n),c>=0&&(u.get(c).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new Ri(o,r,e.text,e.icon,null,e.clipped),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Ri(null,r,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new Ri(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i=new Set;for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,i,r.collisionBoxArray),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,r.tileID),e.updateZOffset()))}}updateBucketOpacities(e,i,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new Ri(null,0,!1,!1,!0),a=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),h="map"===n.get("text-pitch-alignment"),p=new Ri(null,0,a&&(l||!e.hasIconData()||n.get("icon-optional")),l&&(a||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const d=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i)};let f=0;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:m,numIconVertices:g}=n,_=i.has(m);let y=this.opacities[m];_?y=s:y||(y=p,this.opacities[m]=y),i.add(m);const A=a>0||l>0,v=g>0,x=this.placedOrientations[m],b=x===t.b6.vertical,w=x===t.b6.horizontal||x===t.b6.horizontalOnly;if(!A&&!v||y.isHidden()||f++,A){const t=Xi(y.text);d(e.text,a,b?Qi:t),d(e.text,l,w?Qi:t);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:c}=n,u=e.text.placedSymbolArray,h=i||b?1:0;r>=0&&(u.get(r).hidden=h),o>=0&&(u.get(o).hidden=h),s>=0&&(u.get(s).hidden=h),c>=0&&(u.get(c).hidden=i||w?1:0);const p=this.variableOffsets[m];p&&this.markUsedJustification(e,p.anchor,n,x);const f=this.placedOrientations[m];f&&(this.markUsedJustification(e,"left",n,f),this.markUsedOrientation(e,f,n))}if(v){const t=Xi(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:r}=n,o=e.icon.placedSymbolArray,s=y.icon.isHidden()?1:0;i>=0&&(d(e.icon,g,b?Qi:t),o.get(i).hidden=s),r>=0&&(d(e.icon,n.numVerticalIconVertices,w?Qi:t),o.get(r).hidden=s)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[r];if(i){let r=new t.P(0,0),s=!0;if(i.textBox||i.verticalTextBox){if(c){const t=this.variableOffsets[m];t?(r=Vi(t.anchor,t.width,t.height,t.textOffset,t.textScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):s=!1}o&&(s=!y.clipped),i.textBox&&Zi(e.textCollisionBox.collisionVertexArray,y.text.placed,!s||b,r.x,r.y),i.verticalTextBox&&Zi(e.textCollisionBox.collisionVertexArray,y.text.placed,!s||w,r.x,r.y)}const a=s&&Boolean(!w&&i.verticalIconBox);i.iconBox&&Zi(e.iconCollisionBox.collisionVertexArray,y.icon.placed,a,n.hasIconTextFit?r.x:0,n.hasIconTextFit?r.y:0),i.verticalIconBox&&Zi(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!a,n.hasIconTextFit?r.x:0,n.hasIconTextFit?r.y:0)}}}if(e.fullyClipped=0===f,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Zi(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const qi=Math.pow(2,25),Wi=Math.pow(2,24),Hi=Math.pow(2,17),Ji=Math.pow(2,16),Ki=Math.pow(2,9),$i=Math.pow(2,8),Yi=Math.pow(2,1);function Xi(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*qi+e*Wi+i*Hi+e*Ji+i*Ki+e*$i+i*Yi+e}const Qi=0;class tr{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class er{constructor(t,e,i,r,n,o,s,a,l){this.placement=new Gi(t,n,o,s,a,l),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r,n){const o=t.f.now(),s=()=>{const e=t.f.now()-o;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const o=i[e[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&(!o.minzoom||o.minzoom<=a)&&(!o.maxzoom||o.maxzoom>a)){const e=o,i=e.layout.get("symbol-z-elevate"),a=this._inProgressLayer=this._inProgressLayer||new tr(e),l=t.ag(o.source,o.scope);if(a.continuePlacement(i?n[l]:r[l],this.placement,this._showCollisionBoxes,o,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ir=512/t.V/2;class rr{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this.index=new t.bg(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=e.canonical.x*t.V,o=e.canonical.y*t.V;for(let t=0;t<i.length;t++){const{key:e,crossTileID:r,tileAnchorX:s,tileAnchorY:a}=i.get(t),l=Math.floor((n+s)*ir),c=Math.floor((o+a)*ir);this.index.add(l,c),this.keys.push(e),this.crossTileIDs.push(r)}this.index.finish()}findMatches(e,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),o=ir/Math.pow(2,i.canonical.z-this.tileID.canonical.z),s=i.canonical.x*t.V,a=i.canonical.y*t.V;for(let t=0;t<e.length;t++){const i=e.get(t);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=i,h=Math.floor((s+c)*o),p=Math.floor((a+u)*o),d=this.index.range(h-n,p-n,h+n,p+n);for(const t of d){const e=this.crossTileIDs[t];if(this.keys[t]===l&&!r.has(e)){r.add(e),i.crossTileID=e;break}}}}}class nr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class or{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r.add(n.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new rr(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class sr{constructor(){this.layerIndexes={},this.crossTileIDs=new nr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,r){let n=this.layerIndexes[t.fqid];void 0===n&&(n=this.layerIndexes[t.fqid]=new or);let o=!1;const s={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}class ar{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.U(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.U(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.U(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.U(e.right,i.right,r)),this}getCenter(e,i){const r=t.aa((this.left+e-this.right)/2,0,e),n=t.aa((this.top+i-this.bottom)/2,0,i);return new t.P(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ar(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function lr(e,i){const r=t.bk(e,3);t.a6.fromQuat(e,i),t.bm(e,3,r)}function cr(e,i){const r=t.bi.identity([]);return t.bi.rotateZ(r,r,-i),t.bi.rotateX(r,r,-e),r}function ur(e,i){const r=[e[0],e[1],0],n=[i[0],i[1],0];if(t.N.length(r)>=1e-15){const e=t.N.normalize([],r);t.N.scale(n,e,t.N.dot(n,e)),i[0]=n[0],i[1]=n[1]}const o=t.N.cross([],i,e);if(t.N.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return cr(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class hr{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t.L?e:new t.L(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.bh(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(t.L.fromLngLat(e)):0,o=t.L.fromLngLat(e,n),s=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=ur(s,i)}setPitchBearing(e,i){this.orientation=cr(t.bj(e),t.bj(-i))}}class pr{constructor(e,i){this._transform=t.a6.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t.L(e[0],e[1],e[2])}get position(){const e=t.bk(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.bm(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.bi.identity([]),e&&lr(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=cr(t,e),lr(this._transform,this._orientation)}forward(){const e=t.bk(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.bk(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.bk(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const r=new Float64Array(16);return t.a6.invert(r,this.getWorldToCamera(e,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,r){const n=this.position;t.N.scale(n,n,-e);const o=new Float64Array(16);return t.a6.fromScaling(o,[r,r,r]),t.a6.translate(o,o,n),o[10]*=i,o}getWorldToCamera(e,i){const r=new Float64Array(16),n=new Float64Array(4),o=this.position;return t.bi.conjugate(n,this._orientation),t.N.scale(o,o,-e),t.a6.fromQuat(r,n),t.a6.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(e,i,r,n){const o=new Float64Array(16);return t.a6.perspective(o,e,i,r,n),o}getCameraToClipOrthographic(e,i,r,n,o,s){const a=new Float64Array(16);return t.a6.ortho(a,e,i,r,n,o,s),a}getDistanceToElevation(e,i=!1){const r=0===e?0:t.bl(e,i?t.au(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new pr([...this.position],[...this.orientation])}}const dr=(t,e,i)=>(1-i)*t+i*e,fr=t=>t*t*t*t*t;class mr{constructor(e,i,r,n,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ar,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new pr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new mr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,e=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.ac(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=t.bo(this.projectionOptions);const n=!e(r,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.bo({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bh(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.b4.create(),t.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.aa(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.bj(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let s=0;s<i.length;s++){const a=new t.P(i[s][0]*this.width,r+i[s][1]*(this.height-r)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,r=this._mercatorZfromZoom(t),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const n=t.N.length(t.N.sub([],this._camera.position,r));return t.aa(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.bi.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];t.N.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new hr;return i.position=new t.L(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.bi.length(e))return!1;t.bi.normalize(e,e);const i=t.N.transformQuat([],[0,0,-1],e),r=t.N.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const n=ur(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=t.aa(e[2],n/r,n/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.bp(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new t.P(0,0)),n=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.bp(r,e))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,i,r){let n=[];if(0===i[0]&&0===i[1])return n;for(const r of e){const e=r.canonical,o=r.overscaledZ,s=r.wrap,a=1<<e.z,l=e.x+1<a,c=e.x>0,u=e.y+1<a,h=e.y>0,p=r.wrap-(c?0:1),d=r.wrap+(l?0:1),f=c?e.x-1:a-1,m=l?e.x+1:0;i[0]<0?(n.push(new t.am(o,d,e.z,m,e.y)),i[1]<0&&u&&(n.push(new t.am(o,s,e.z,e.x,e.y+1)),n.push(new t.am(o,d,e.z,m,e.y+1))),i[1]>0&&h&&(n.push(new t.am(o,s,e.z,e.x,e.y-1)),n.push(new t.am(o,d,e.z,m,e.y-1)))):i[0]>0?(n.push(new t.am(o,p,e.z,f,e.y)),i[1]<0&&u&&(n.push(new t.am(o,s,e.z,e.x,e.y+1)),n.push(new t.am(o,p,e.z,f,e.y+1))),i[1]>0&&h&&(n.push(new t.am(o,s,e.z,e.x,e.y-1)),n.push(new t.am(o,p,e.z,f,e.y-1)))):i[1]<0&&u?n.push(new t.am(o,s,e.z,e.x,e.y+1)):h&&n.push(new t.am(o,s,e.z,e.x,e.y-1))}if(n.length>1){n.sort(((t,e)=>t.overscaledZ-e.overscaledZ||t.wrap-e.wrap||t.canonical.z-e.canonical.z||t.canonical.x-e.canonical.x||t.canonical.y-e.canonical.y));let t=0,e=0;for(;e<n.length;)n[e].equals(n[t])?++e:n[++t]=n[e++];n.length=t+1}const o=[];for(const t of n)n.some((e=>t.isChildOf(e)))||o.push(t);return n=o.filter((t=>!e.some((e=>!!(t.overscaledZ<r&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),n}coveringTiles(e){let i=this.coveringZoomLevel(e);const r=i,n=this.elevation&&this.elevation.exaggeration(),o=n&&!e.isTerrainDEM,s="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],h="globe"===this.projection.name,p=!h,d=t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,p),f=h?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*t.bl(1,this.center.lat),g=this._camera.position[2]/t.bl(1,this.center.lat),_=[c*f.x,c*f.y,g*(p?1:m)],y=h||n,A=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),v=this.isLODDisabled(!0)?i:0;let x;if(this._elevation&&e.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();x=t?t.max:this._centerAltitude}else x=this._centerAltitude;const b=e.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,w=this.projection.isReprojectedInTileSpace?t.br(this):1,S=e=>{const i=1/4e4,r=new t.L(e.x+i,e.y,e.z),n=new t.L(e.x,e.y+i,e.z),o=e.toLngLat(),s=r.toLngLat(),a=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),p=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*p)*w/i},T=e=>{const i=x,r=b;return{aabb:t.bu(this,c,0,0,0,e,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:e,fullyVisible:!1}},C=[];let M=[];const E=i,I=e.reparseOverscaled?r:i,L=t=>t*t,P=L((g-this._centerAltitude)*m),k=t=>{if(!this._elevation||!t.tileID||!s)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=N(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},N=e=>{if(e.zoom<v)return!0;if(e.zoom===E)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(_),n=e.aabb.distanceY(_);let s=P,a=1;if(h){s=L(e.aabb.distanceZ(_));const i=Math.pow(2,e.zoom),r=t.au((e.y+1)/i),n=t.au(e.y/i),o=Math.min(Math.max(l,r),n),c=t.bJ(o)/t.bJ(l);if(a=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=t.bG&&e.zoom===E-1&&c>=.9)return!0}else if(o&&(s=L(e.aabb.distanceZ(_)*m)),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,e.zoom),r=S(new t.L((e.x+.5)/i,(e.y+.5)/i));a=r>.85?1:r}const c=i*i+n*n+s,u=L((1<<E-e.zoom)*A*a*((t,e)=>{if(e*L(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,P),c));return c<u};if(this.renderWorldCopies)for(let t=1;t<=3;t++)C.push(T(-t)),C.push(T(t));for(C.push(T(0));C.length>0;){const r=C.pop(),n=r.x,a=r.y;let l=r.fullyVisible;const p=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!l){let e=y?r.aabb.intersects(d):r.aabb.intersectsFlat(d);if(0===e&&p()){const i=new t.bs(r.zoom,n,a);e=t.bt(this,c,i,!0).intersects(d)}if(0===e)continue;l=2===e}if(r.zoom!==E&&N(r))for(let e=0;e<4;e++){const i=(n<<1)+e%2,u=(a<<1)+(e>>1),p={aabb:s?r.aabb.quadrant(e):t.bu(this,c,r.zoom+1,i,u,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:u,wrap:r.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};o&&!h&&(p.tileID=new t.am(r.zoom+1===E?I:r.zoom+1,r.wrap,r.zoom+1,i,u),k(p)),C.push(p)}else{const o=r.zoom===E?I:r.zoom;if(e.minzoom&&e.minzoom>o)continue;if(!l){let e=y?r.aabb.intersectsPrecise(d):r.aabb.intersectsPreciseFlat(d);if(0===e&&p()){const i=new t.bs(r.zoom,n,a);e=t.bt(this,c,i,!0).intersectsPrecise(d)}if(0===e)continue}const s=u[0]-(.5+n+(r.wrap<<r.zoom))*(1<<i-r.zoom),h=u[1]-.5-a,f=r.tileID?r.tileID:new t.am(o,r.wrap,r.zoom,n,a);M.push({tileID:f,distanceSq:s*s+h*h})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();M=M.filter((n=>{const o=[0,0,0,1],s=[t.V,t.V,0,1],a=this.calculateFogTileMatrix(n.tileID.toUnwrapped());t.a7.transformMat4(o,o,a),t.a7.transformMat4(s,s,a);const l=t.a7.min([],o,s),c=t.a7.max([],o,s),u=t.bv(l,c);if(0===u)return!0;let h=!1;const p=this._elevation;if(p&&u>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=p.getMinMaxForTile(n.tileID)),o||(o={min:b,max:x});const s=t.bH(this.rotation),a=[s[0]*t.V,s[1]*t.V,o.max];t.N.transformMat4(a,a,i),h=(1-a[1])*this.height*.5<r}return u<i||h}))}return M.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.aa(e.lat,-t.bw,t.bw),r=this.projection.project(e.lng,i);return new t.P(r.x*this.worldSize,r.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let r,n;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;r=(i.x-o.x)/t,n=(i.y-o.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(o);r=t.x-e.x,n=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.L(s.x-r,s.y-n))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const r=i?t.bl(i,e.lat):void 0,n=this.projection.project(e.lng,e.lat);return new t.L(n.x,n.y,r)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const r=null!=i?i:this._centerAltitude,n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.a7.transformMat4(n,n,this.pixelMatrixInverse),t.a7.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];t.a7.scale(n,n,1/n[3]),t.a7.scale(o,o,1/s);const a=n[2],l=o[2];return{p0:n,p1:o,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return t.a7.transformMat4(i,i,this.pixelMatrixInverse),t.a7.transformMat4(r,r,this.pixelMatrixInverse),t.a7.scale(i,i,1/i[3]),t.a7.scale(r,r,1/r[3]),i[2]=t.bl(i[2],this._center.lat)*this.worldSize,r[2]=t.bl(r[2],this._center.lat)*this.worldSize,t.a7.scale(i,i,1/this.worldSize),t.a7.scale(r,r,1/this.worldSize),new t.a2([i[0],i[1],i[2]],t.N.normalize([],t.N.sub([],r,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:r,t:n}=e,o=t.bl(i[2],this._center.lat),s=t.bl(r[2],this._center.lat);return new t.L(t.U(i[0],r[0],n)/this.worldSize,t.U(i[1],r[1],n)/this.worldSize,t.U(o,s,n))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t.L(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(e.y>n)return this.pointCoordinate(e);const o=.02*n,s=e.clone();for(let e=0;e<10&&n-r>o;e++){s.y=t.U(r,n,.66);const e=this.projection.pointCoordinate3D(this,s.x,s.y);e?(n=s.y,i=e):r=s.y}return i?new t.L(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.bx)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,n=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return t.a7.transformMat4(n,n,this.pixelMatrix),n[3]>0?new t.P(n[0]/n[3],n[1]/n[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,o=this.pointLocation3D(new t.P(i,e)),s=this.pointLocation3D(new t.P(n,e)),a=this.pointLocation3D(new t.P(n,r)),l=this.pointLocation3D(new t.P(i,r));let c=Math.min(o.lng,s.lng,a.lng,l.lng),u=Math.max(o.lng,s.lng,a.lng,l.lng),h=Math.min(o.lat,s.lat,a.lat,l.lat),p=Math.max(o.lat,s.lat,a.lat,l.lat);const d=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(e,i,r,n,o)=>{const s=(e+r)/2,a=(i+n)/2,l=new t.P(s,a),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,h-_,g-u,_-p);c=Math.min(c,g),u=Math.max(u,g),h=Math.min(h,_),p=Math.max(p,_),(o<f||y>d)&&(m(e,i,s,a,o+1),m(s,a,r,n,o+1))};if(m(i,e,n,e,1),m(n,e,n,r,1),m(n,r,i,r,1),m(i,r,i,e,1),"globe"===this.projection.name){const[e,i]=t.by(this);e?(p=90,u=180,c=-180):i&&(h=-90,u=180,c=-180)}return new t.ad(new t.bn(c,h),new t.bn(u,p))}_getBoundsRectangular(e,i){const{top:r,left:n}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new t.P(n,r),l=new t.P(s,r),c=new t.P(s,o),u=new t.P(n,o);let h=this.pointCoordinate(a,e),p=this.pointCoordinate(l,e);const d=this.pointCoordinate(c,i),f=this.pointCoordinate(u,i),m=(t,e)=>(e.y-t.y)/(e.x-t.x);return h.y>1&&p.y>=0?h=new t.L((1-f.y)/m(f,h)+f.x,1):h.y<0&&p.y<=1&&(h=new t.L(-f.y/m(f,h)+f.x,0)),p.y>1&&h.y>=0?p=new t.L((1-d.y)/m(d,p)+d.x,1):p.y<0&&h.y<=1&&(p=new t.L(-d.y/m(d,p)+d.x,0)),(new t.ad).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.bw,this.maxLat=t.bw,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.a5(this.minLng)*this.tileSize,this.worldMaxX=t.a5(this.maxLng)*this.tileSize,this.worldMinY=t.ae(this.maxLat)*this.tileSize,this.worldMaxY=t.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=e.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*e.wrap)*a,c=n.y*a,u=this.point;u.x*=s/this.worldSize,u.y*=s/this.worldSize;const h=this.angle,p=Math.sin(-h),d=-Math.cos(-h);return r[i]={bearing:[p,d],center:[(u.x-l)*o,(u.y-c)*o],scale:a/t.V*o},r[i]}calculateFogTileMatrix(e){const i=e.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.a6.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(e,i=!1,r=!1){const n=e.key;let o;if(o=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,o[n])return o[n];const s=this.calculatePosMatrix(e,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,t.a6.multiply(s,a,s),o[n]=new Float32Array(s),o[n]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=t.bz(e,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,i=t.a6.fromScaling([],[e,e,e]);return t.a6.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.bl(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),o=t.bl(1,this._center.lat);r[2]/=o,n[2]/=o,t.N.normalize(n,n);const s=e.raycast(r,n,e.exaggeration());if(s){const e=t.N.scaleAndAdd([],r,n,s),i=new t.L(e[0],e[1],t.bl(e[2],t.au(e[1]))),a=(i.z+t.N.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,r=t.bl(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),o=i.getAtPointOrZero(new t.L(...n)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),l=n[2]-s;if(l<=a)if(l<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[n[0],n[1],e.z-n[2]],r=t.N.length(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const o=t.N.length(i);if(0===o)return;t.N.scale(i,i,r/o*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],e.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const i=this.center;return i.lat=t.aa(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(i.lng=t.aa(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let o=0,s=r,a=n;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,h=this.worldMaxY*this.scale;if(n-c<u&&(a=u+c),n+c>h&&(a=h-c),h-u<this.height&&(o=Math.max(o,this.height/(h-u)),a=(h+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,i=this.worldSize/2-(t+e)/2;s=(r+i+this.worldSize)%this.worldSize-i,s-l<t&&(s=t+l),s+l>e&&(s=e-l),e-t<this.width&&(o=Math.max(o,this.width/(e-t)),s=(e+t)/2)}s===r&&a===n||(this.center=this.unproject(new t.P(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.bl(1,this.center.lat)/t.bl(1,t.bI));const n=t.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?r:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=t*this.aspect,r=-i,n=-t;i-=e.x,r-=e.x,t+=e.y,n+=e.y,a=this._camera.getCameraToClipOrthographic(r,i,n,t,this._nearZ,this._farZ),((t,e,i,r)=>{for(let n=0;n<16;n++)t[n]=dr(e[n],i[n],r)})(a,a,l,fr(this.pitch>=15?1:this.pitch/15))}else a=l;const c=t.a6.mul([],l,s);let u=t.a6.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.a6.identity([]);t.a6.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.a6.multiply(i,i,t.bB(this)),t.a6.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.a6.multiply(u,u,i),t.a6.multiply(c,c,i),this.inverseAdjustmentMatrix=t.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.a6.scale([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=t.a6.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-e.x/this.width,i[9]=2*e.y/this.height,this.expandedFarZProjMatrix=t.a6.mul([],i,s)}else this.expandedFarZProjMatrix=this.projMatrix;const h=t.a6.invert([],a);this.frustumCorners=t.bD.fromInvProjectionMatrix(h,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const p=new Float32Array(16);t.a6.identity(p),t.a6.scale(p,p,[1,-1,1]),t.a6.rotateX(p,p,this._pitch),t.a6.rotateZ(p,p,this.angle);const d=t.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.a6.clone(d);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-e.x/this.width,d[9]=2*(e.y+f)/this.height,this.skyboxMatrix=t.a6.multiply(p,d,p);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,A=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=g-Math.round(g)+v*y+x*A,w=_-Math.round(_)+v*A+x*y,S=new Float64Array(u);if(t.a6.translate(S,S,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=S,u=t.a6.create(),t.a6.scale(u,u,[this.width/2,-this.height/2,1]),t.a6.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.a6.create(),t.a6.scale(u,u,[1,-1,1]),t.a6.translate(u,u,[-1,-1,0]),t.a6.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=t.a6.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.bE(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.N.transformMat4(e,e,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,o=[e,e,i];t.N.scale(o,o,n),t.N.scale(r,r,-1),t.N.multiply(r,r,o);const s=t.a6.create();t.a6.translate(s,s,r),t.a6.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,n)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,t/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(o=Math.min((i-r)/n,1)),this._camera.position=t.N.scaleAndAdd([],this._camera.position,e,o),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),o=t.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.bj(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);t.N.scaleAndAdd(e,e,i,a),this._pitch=t.aa(r,t.bj(this.minPitch),t.bj(this.maxPitch)),this.angle=t.bh(n,-Math.PI,Math.PI),this._setZoom(t.aa(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.L(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,r=t.bx,n=0,o=1/0;for(;r-i>1e-6&&r>i;){const t=i+.5*(r-i),s=this.tileSize*Math.pow(2,t),a=this.getCameraToCenterDistance(this.projection,t,s),l=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(t-l);c<o&&(o=c,n=t),t<l?i=t:r=t}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const r=Math.min(e.x,i.x),n=Math.max(e.x,i.x),o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.P(r,o),new t.P(n,s),new t.P(r,s),new t.P(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(e,i){const r=t.N.length(t.N.sub([],this._camera.position,e)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,i,r],n){const o=[e,i,r,1];t.a7.transformMat4(o,o,n);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}}getCameraToCenterDistance(e,i=this.zoom,r=this.worldSize){const n=t.bA(e,i,this.width,this.height,1024),o=e.pixelSpaceConversion(this.center.lat,r,n);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=dr(1,s,fr(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.a6.multiply(e,e,this.globeMatrix),e}getFrustum(e){return t.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const gr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},_r=(e,i)=>{if(i>0&&e.terrain&&t.w("Cutoff is currently disabled on terrain"),i<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=e.transform,n=Math.max(Math.abs(r._zoom-(e.minCutoffZoom-1)),1),o=r.isLODDisabled(!1)?t.O(60,45,r.pitch):t.O(30,15,r.pitch),s=r._farZ-r._nearZ,a=i*r.height,l=((1-(c=o))*r.cameraToCenterDistance+c*(r._farZ+a))*n;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(l-r._nearZ)/s,(l-a-r._nearZ)/s]}}},yr={cascadeCount:2,shadowMapResolution:2048};class Ar{constructor(t,e){this.aabb=t,this.lastCascade=e}}class vr{add(t,e){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],e.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],e.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],e.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],e.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],e.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],e.max[2])):this.receivers[t.key]=new Ar(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(e,i,r){const n=t.bS.fromPoints(e.points);let o=0;for(const e in this.receivers){const s=this.receivers[e];if(!s)continue;if(!n.intersectsAabb(s.aabb))continue;s.aabb.min=n.closestPoint(s.aabb.min),s.aabb.max=n.closestPoint(s.aabb.max);const a=s.aabb.getCorners();for(let e=0;e<r.length;e++){let n=!0;for(const o of a){const s=[o[0]*i,o[1]*i,o[2]];if(t.N.transformMat4(s,s,r[e].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){n=!1;break}}if(s.lastCascade=e,o=Math.max(o,e),n)break}}return o+1}}class xr{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new vr,this._depthMode=new Ie(t.context.gl.LEQUAL,Ie.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,t.tp.registerParameter(yr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(yr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=r.style.order.reduce(((t,i)=>{const n=r.style._mergedLayers[i];return t+(n.hasShadowPass()&&!n.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this._enabled)return;const o=r.context,s=yr.shadowMapResolution,a=yr.shadowMapResolution;if(0===this._cascades.length||yr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<yr.cascadeCount;++e){const e=r._shadowMapDebug,i=o.gl,n=o.createFramebuffer(s,a,e,"texture"),l=new t.T(o,{width:s,height:a,data:null},i.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),e){const e=new t.T(o,{width:s,height:a,data:null},i.RGBA);n.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.bq,scale:0})}}this.shadowDirection=wr(i);let l=0;if(e.elevation){const t=e.elevation,i=[1e4,-1e4];t.visibleDemTiles.filter((t=>t.dem)).forEach((t=>{const e=t.dem.tree;i[0]=Math.min(i[0],e.minimums[0]),i[1]=Math.max(i[1],e.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*t.exaggeration())}const c=1.5*e.cameraToCenterDistance,u=3*c,h=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const r=this._cascades[i];let n=e.height/50,o=1;1===yr.cascadeCount?o=u:0===i?o=c:(n=c,o=u);const[s,a]=Tr(e,this.shadowDirection,n,o,yr.shadowMapResolution,l);r.scale=e.scale,r.matrix=s,r.boundingSphereRadius=a,t.a6.invert(h,r.matrix),r.frustum=t.bq.fromInvProjectionMatrix(h,1,0,!0),r.far=o}const p=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[p].far,this._cascades[p].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/yr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=yr.shadowMapResolution,this._uniformValues.u_shadowmap_0=gr.ShadowMap0,this._uniformValues.u_shadowmap_1=gr.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const d=r.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(d){const i=d.getMinMaxForTile(t);i&&(e=i)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(e,i){if(!this._enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,yr.shadowMapResolution,yr.shadowMapResolution]);for(let o=0;o<this._numCascadesToRender;++o){r.currentShadowCascade=o,n.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),n.clear({color:t.ax.white,depth:1});for(const t of e.order){const n=e._mergedLayers[t];if(!n.hasShadowPass()||n.isHidden(r.transform.zoom))continue;const o=e.getLayerSourceCache(n),s=o?i[o.id]:void 0;("model"===n.type||s&&s.length)&&r.renderLayer(r,o,n,s)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,e=t.style,i=t.context,r=e.directionalLight,n=e.ambientLight;if(!r||!n)return;const o=[],s=_r(t,t.longestCutoffRange);s.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const a=Sr(r,n),l=new Ie(i.gl.LEQUAL,Ie.ReadOnly,t.depthRangeFor3D);for(const e of this._groundShadowTiles){const r=e.toUnwrapped(),n=t.isTileAffectedByFog(e),c=t.getOrCreateProgram("groundShadow",{defines:o,overrideFog:n});this.setupShadows(r,c),t.uploadCommonUniforms(i,c,r,null,s);const u={u_matrix:t.transform.calculateProjMatrix(r),u_ground_shadow_factor:a};c.draw(t,i.gl.TRIANGLES,l,Pe.disabled,Ne.multiply,Re.disabled,u,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ne.unblended:Ne.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,r=i.calculatePosMatrix(e,i.worldSize);return t.a6.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(e){return t.a6.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,r,n=0){if(!this._enabled)return;const o=this.painter.transform,s=this.painter.context,a=s.gl,l=this._uniformValues,c=new Float64Array(16),u=o.calculatePosMatrix(e,o.worldSize);for(let e=0;e<this._cascades.length;e++)t.a6.multiply(c,this._cascades[e].matrix,u),l[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),s.activeTexture.set(a.TEXTURE0+gr.ShadowMap0+e),this._cascades[e].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const i=t.bR(e.canonical),s=2/o.tileSize*t.V/yr.shadowMapResolution,a=s*this._cascades[0].boundingSphereRadius,c=s*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===r?1:3)/Math.pow(2,n-e.canonical.z-(1-o.zoom+Math.floor(o.zoom)));l.u_shadow_normal_offset=[i,a*u,c*u],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,l)}setupShadowsFromMatrix(e,i,r=!1){if(!this._enabled)return;const n=this.painter.context,o=n.gl,s=this._uniformValues,a=new Float64Array(16);for(let i=0;i<yr.cascadeCount;i++)t.a6.multiply(a,this._cascades[i].matrix,e),s[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),n.activeTexture.set(o.TEXTURE0+gr.ShadowMap0+i),this._cascades[i].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);if(this.useNormalOffset=r,r){const t=5;s.u_shadow_normal_offset=[1,t,t],s.u_shadow_bias=[6e-5,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(n,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,r,n){if(n[2]>=0)return{};const o=function(e,i,r){const n=r/(1<<e.canonical.z);return new t.bS([e.canonical.x*n+e.wrap*r,e.canonical.y*n+e.wrap*r,0],[(e.canonical.x+1)*n+e.wrap*r,(e.canonical.y+1)*n+e.wrap*r,i])}(e,i,r).getCorners(),s=i/-n[2];n[0]<0?(t.N.add(o[0],o[0],[n[0]*s,0,0]),t.N.add(o[3],o[3],[n[0]*s,0,0])):n[0]>0&&(t.N.add(o[1],o[1],[n[0]*s,0,0]),t.N.add(o[2],o[2],[n[0]*s,0,0])),n[1]<0?(t.N.add(o[0],o[0],[0,n[1]*s,0]),t.N.add(o[1],o[1],[0,n[1]*s,0])):n[1]>0&&(t.N.add(o[2],o[2],[0,n[1]*s,0]),t.N.add(o[3],o[3],[0,n[1]*s,0]));const a={};return a.vertices=o,a.planes=[br(o[1],o[0],o[4]),br(o[2],o[1],o[5]),br(o[3],o[2],o[6]),br(o[0],o[3],o[7])],a}addShadowReceiver(e,i,r){this._receivers.add(e,t.bS.fromTileIdAndHeight(e,i,r))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function br(e,i,r){const n=t.N.sub([],r,i),o=t.N.sub([],e,i),s=t.N.cross([],n,o),a=t.N.length(s);return 0===a?[0,0,1,0]:(t.N.scale(s,s,1/a),[s[0],s[1],s[2],-t.N.dot(s,i)])}function wr(e){const i=e.properties.get("direction"),r=t.bQ(i.x,i.y,i.z);r[2]=t.aa(r[2],0,75);const n=t.bT([r[0],r[1],r[2]]);return t.N.fromValues(n.x,n.y,n.z)}function Sr(e,i){const r=e.properties.get("color"),n=e.properties.get("intensity"),o=e.properties.get("direction"),s=[o.x,o.y,o.z],a=i.properties.get("color"),l=i.properties.get("intensity"),c=Math.max(t.N.dot([0,0,1],s),0),u=[0,0,0];t.N.scale(u,a.toArray01Linear().slice(0,3),l);const h=[0,0,0];return t.N.scale(h,r.toArray01Linear().slice(0,3),c*n),t.bU([u[0]>0?u[0]/(u[0]+h[0]):0,u[1]>0?u[1]/(u[1]+h[1]):0,u[2]>0?u[2]/(u[2]+h[2]):0])}function Tr(e,i,r,n,o,s){const a=e.zoom,l=e.scale,c=e.worldSize,u=1/c,h=e.aspect,p=Math.sqrt(1+h*h)*Math.tan(.5*e.fovX),d=p*p,f=n-r,m=n+r;let g,_;d>f/m?(g=n,_=n*p):(g=.5*m*(1+d),_=.5*Math.sqrt(f*f+2*(n*n+r*r)*d+m*m*d*d));const y=e.projection.pixelsPerMeter(e.center.lat,c),A=e._camera.getCameraToWorldMercator(),v=[0,0,-g*u];t.N.transformMat4(v,v,A);let x=_*u;const b=e._edgeInsets;if(!(0===b.left&&0===b.top&&0===b.right&&0===b.bottom||b.left===b.right&&b.top===b.bottom)){const i=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?y:1),o=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,r,n);o[8]=2*-e.centerOffset.x/e.width,o[9]=2*e.centerOffset.y/e.height;const s=new Float64Array(16);t.a6.mul(s,o,i);const u=new Float64Array(16);t.a6.invert(u,s);const h=t.bq.fromInvProjectionMatrix(u,c,a,!0);for(const i of h.points){const r=((w=i)[0]/=l,w[1]/=l,w[2]=t.bl(w[2],e._center.lat),w);x=Math.max(x,t.N.len(t.N.subtract([],v,r)))}}var w;x*=o/(o-1);const S=Math.acos(i[2]),T=Math.atan2(-i[0],-i[1]),C=new pr;C.position=v,C.setPitchBearing(S,T);const M=C.getWorldToCamera(c,y),E=x*c,I=Math.min(e._mercatorZfromZoom(17)*c*-2,-2*E),L=C.getCameraToClipOrthographic(-E,E,-E,E,I,(E+s*y)/i[2]),P=new Float64Array(16);t.a6.multiply(P,L,M);const k=t.N.fromValues(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),N=.5*o,D=[0,0,0];t.N.transformMat4(D,k,P),t.N.scale(D,D,N);const O=[Math.floor(D[0]),Math.floor(D[1]),Math.floor(D[2])],R=[0,0,0];t.N.sub(R,D,O),t.N.scale(R,R,-1/N);const F=new Float64Array(16);return t.a6.identity(F),t.a6.translate(F,F,R),t.a6.multiply(P,F,P),[P,E]}const Cr=(t,e)=>ct(t,e&&e.filter((t=>"source.canvas"!==t.identifier))),Mr=t.ac(ri,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Er=t.ac(ri,["setCenter","setZoom","setBearing","setPitch"]),Ir={version:8,layers:[],sources:{}},Lr={duration:300,delay:0},Pr=new Set(["fill","line","background","hillshade","raster"]);class kr extends t.E{constructor(e,i={}){super(),this.map=e,this.scope=i.scope||"",this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=t.e({},Lr),this._buildingIndex=new ti(this),this.crossTileSymbolIndex=new sr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new y,this.dispatcher=i.dispatcher?i.dispatcher:new t.bW(t.bX(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new b,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new t.bY(e._requestManager,i.localFontFamily?t.bZ.all:i.localIdeographFontFamily?t.bZ.ideographs:t.bZ.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new A(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this.dispatcher.broadcast("setReferrer",t.b_());const r=this;this._rtlTextPluginCallback=kr.registerForPluginStateChange((e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.b$(e),i&&i.every((t=>t)))for(const t in r._sourceCaches){const e=r._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}))}loadURL(e,i={}){this.fire(new t.b("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!t.c0(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const n=this.importsCache.get(e);if(n)return this._load(n,r);const o=this.map._requestManager.transformRequest(e,t.R.Style);this._request=t.g(o,((i,n)=>{if(this._request=null,i)this.fire(new t.a(i));else if(n)return this.importsCache.set(e,n),this._load(n,r)}))}loadJSON(e,i={}){this.fire(new t.b("dataloading",{dataType:"style"})),this._request=t.f.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.b("dataloading",{dataType:"style"})),this._load(Ir,!1)}_loadImports(e,i,r){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const t of e){const e=this._createFragmentStyle(t),o=new Promise((t=>{e.once("style.import.load",t),e.once("error",t)})).then((()=>this.mergeAll()));if(n.push(o),this.resolvedImports.has(t.url)){e.loadEmpty();continue}const s=t.data||this.importsCache.get(t.url);s?e.loadJSON(s,{validate:i}):t.url?e.loadURL(t.url,{validate:i}):e.loadEmpty();const a={style:e,id:t.id,config:t.config};if(r){const t=this.fragments.findIndex((({id:t})=>t===r));this.fragments=this.fragments.slice(0,t).concat(a).concat(this.fragments.slice(t))}else this.fragments.push(a)}return Promise.allSettled(n)}_createFragmentStyle(e){const i=this.scope?t.ag(e.id,this.scope):e.id,r=new kr(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new t.b(e?"style.load":"style.import.load"))}_load(e,i){const r=e.schema;if(this.isRootStyle()&&(e.fragment||r&&!1!==e.fragment)){const r=t.e({},Ir,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(r,i)}if(this.setConfig(this._config,r),i&&Cr(this,Y(e)))return;this._loaded=!0,this.stylesheet=t.c1(e);for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=ii(this.stylesheet.layers);if(this._order=n.map((t=>t.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new ht(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ht(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of n){const i=t.c2(e,this.scope,this.options);i.isConfigDependent&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize();const r=this.getOwnLayerSourceCache(i),n=!!this.directionalLight&&this.directionalLight.shadowsEnabled();r&&i.canCastShadows()&&n&&(r.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=t.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.b("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,i).then((()=>this._reloadImports())):this._reloadImports()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,i,r,n,o,s,a,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{if(t.stylesheet){if(null!=t.light&&(e=t.light),t.stylesheet.lights)for(const e of t.stylesheet.lights)"ambient"===e.type&&null!=t.ambientLight&&(i=t.ambientLight),"directional"===e.type&&null!=t.directionalLight&&(r=t.directionalLight);n=this._prioritizeTerrain(n,t.terrain,t.stylesheet.terrain),t.stylesheet.fog&&null!=t.fog&&(o=t.fog),null!=t.stylesheet.camera&&(l=t.stylesheet.camera),null!=t.stylesheet.projection&&(s=t.stylesheet.projection),null!=t.stylesheet.transition&&(a=t.stylesheet.transition)}})),this.light=e,this.ambientLight=i,this.directionalLight=r,this.fog=o,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=t.e({},Lr,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=i=>{for(const t of i.fragments)e(t.style);t(i)};e(this)}_prioritizeTerrain(t,e,i){const r=t&&0===t.drapeRenderMode;return null===i?e&&0===e.drapeRenderMode?e:r?t:null:null!=e&&(!t||r||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)})),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const e={},i={},r={};this.forEachFragmentStyle((n=>{for(const i in n._sourceCaches){const r=t.ag(i,n.scope);e[r]=n._sourceCaches[i]}for(const e in n._otherSourceCaches){const r=t.ag(e,n.scope);i[r]=n._otherSourceCaches[e]}for(const e in n._symbolSourceCaches){const i=t.ag(e,n.scope);r[i]=n._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){const e={},i=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((r=>{for(const n of r._order){const o=r._layers[n];if("slot"===o.type){const i=t.c3(n);if(e[i])continue;e[i]=[]}o.slot&&e[o.slot]?e[o.slot].push(o):i.push(o)}})),this._mergedOrder=[];const n=(i=[])=>{for(const o of i)if("slot"===o.type){const i=t.c3(o.id);e[i]&&n(e[i])}else{const e=t.ag(o.id,o.scope);this._mergedOrder.push(e),r[e]=o,o.is3D()&&(this._has3DLayers=!0),"circle"===o.type&&(this._hasCircleLayers=!0),"symbol"===o.type&&(this._hasSymbolLayers=!0)}};n(i),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=t.e({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,i,r){let n,o,s;const a=t.f.devicePixelRatio>1?"@2x":"";let l=t.g(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.R.SpriteJSON),((t,e)=>{l=null,s||(s=t,n=e,u())})),c=t.d(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.R.SpriteImage),((t,e)=>{c=null,s||(s=t,o=e,u())}));function u(){if(s)r(s);else if(n&&o){const e=t.f.getImageData(o),i={};for(const r in n){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:p,content:d}=n[r],f=new t.h({width:o,height:s});t.h.copy(e,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[r]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:p,content:d}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.a(e));else if(i)for(const t in i)this.imageManager.addImage(t,this.scope,i[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.b("data",{dataType:"style"}))}))}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const r=e.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.a(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,e)=>{const i=this.fragments[e];return i&&i.style&&(t.data=i.style.serialize()),t}))}_serializeSources(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped(this.getLayerSourceCache(t)):Pr.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new t.a(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new t.a(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:i,removedIds:r}=t[e];(i||r)&&this._updateWorkerLayers(e,i,r)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const n={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];n[t]=e.used,e.used=!1,e.tileCoverLift=0}for(const t of this._mergedOrder){const i=this._mergedLayers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this.getLayerSourceCache(i);t&&(t.used=!0,t.tileCoverLift=Math.max(t.tileCoverLift,i.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let t=i.minzoom||0;t<(i.maxzoom||25.5);t++){const t=this.map.painter;if(t){const r=i.getProgramIds();if(!r)continue;for(const n of r){const r=i.getDefaultProgramParams(n,e.zoom);r&&(t.style=this,this.fog&&(t._fogVisible=!0,r.overrideFog=!0,t.getOrCreateProgram(n,r)),t._fogVisible=!1,r.overrideFog=!1,t.getOrCreateProgram(n,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,t.getOrCreateProgram(n,r)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const e in n){const i=this._mergedSourceCaches[e];n[e]!==i.used&&i.getSource().fire(new t.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new t.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,i){const r=this.getFragmentStyle(t);r&&this.dispatcher.broadcast("updateLayers",{layers:e?r._serializeLayers(e):[],scope:t,removedIds:i||[],options:r.options})}setState(i){if(this._checkLoaded(),Cr(this,Y(i)))return!1;(i=t.c1(i)).layers=ii(i.layers);const r=function(t,i){if(!t)return[{command:ri.setStyle,args:[i]}];let r=[];try{if(!e(t.version,i.version))return[{command:ri.setStyle,args:[i]}];e(t.center,i.center)||r.push({command:ri.setCenter,args:[i.center]}),e(t.zoom,i.zoom)||r.push({command:ri.setZoom,args:[i.zoom]}),e(t.bearing,i.bearing)||r.push({command:ri.setBearing,args:[i.bearing]}),e(t.pitch,i.pitch)||r.push({command:ri.setPitch,args:[i.pitch]}),e(t.sprite,i.sprite)||r.push({command:ri.setSprite,args:[i.sprite]}),e(t.glyphs,i.glyphs)||r.push({command:ri.setGlyphs,args:[i.glyphs]}),e(t.imports,i.imports)||function(t=[],i=[],r){i=i||[];const n=(t=t||[]).map(ci),o=i.map(ci),s=t.reduce(ui,{}),a=i.reduce(ui,{}),l=n.slice();let c,u,h,p;for(c=0,u=0;c<n.length;c++)h=n[c],a.hasOwnProperty(h)?u++:(r.push({command:ri.removeImport,args:[h]}),l.splice(l.indexOf(h,u),1));for(c=0,u=0;c<o.length;c++)h=o[o.length-1-c],l[l.length-1-c]!==h&&(s.hasOwnProperty(h)?(r.push({command:ri.removeImport,args:[h]}),l.splice(l.lastIndexOf(h,l.length-u),1)):u++,p=l[l.length-c],r.push({command:ri.addImport,args:[a[h],p]}),l.splice(l.length-c,0,h));for(const t of i){const i=s[t.id];i&&!e(i,t)&&r.push({command:ri.updateImport,args:[t.id,t]})}}(t.imports,i.imports,r),e(t.transition,i.transition)||r.push({command:ri.setTransition,args:[i.transition]}),e(t.light,i.light)||r.push({command:ri.setLight,args:[i.light]}),e(t.fog,i.fog)||r.push({command:ri.setFog,args:[i.fog]}),e(t.projection,i.projection)||r.push({command:ri.setProjection,args:[i.projection]}),e(t.lights,i.lights)||r.push({command:ri.setLights,args:[i.lights]}),e(t.camera,i.camera)||r.push({command:ri.setCamera,args:[i.camera]});const n={},o=[];!function(t,i,r,n){let o;for(o in i=i||{},t=t||{})t.hasOwnProperty(o)&&(i.hasOwnProperty(o)||oi(o,r,n));for(o in i){if(!i.hasOwnProperty(o))continue;const s=i[o];t.hasOwnProperty(o)?e(t[o],s)||("geojson"===t[o].type&&"geojson"===s.type&&ai(t,i,o)?r.push({command:ri.setGeoJSONSourceData,args:[o,s.data]}):si(o,i,r,n)):ni(o,i,r)}}(t.sources,i.sources,o,n);const s=[];t.layers&&t.layers.forEach((t=>{t.source&&n[t.source]?r.push({command:ri.removeLayer,args:[t.id]}):s.push(t)}));let a=t.terrain;a&&n[a.source]&&(r.push({command:ri.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),e(a,i.terrain)||r.push({command:ri.setTerrain,args:[i.terrain]}),function(t,i,r){i=i||[];const n=(t=t||[]).map(ci),o=i.map(ci),s=t.reduce(ui,{}),a=i.reduce(ui,{}),l=n.slice(),c=Object.create(null);let u,h,p,d,f,m,g;for(u=0,h=0;u<n.length;u++)p=n[u],a.hasOwnProperty(p)?h++:(r.push({command:ri.removeLayer,args:[p]}),l.splice(l.indexOf(p,h),1));for(u=0,h=0;u<o.length;u++)p=o[o.length-1-u],l[l.length-1-u]!==p&&(s.hasOwnProperty(p)?(r.push({command:ri.removeLayer,args:[p]}),l.splice(l.lastIndexOf(p,l.length-h),1)):h++,m=l[l.length-u],r.push({command:ri.addLayer,args:[a[p],m]}),l.splice(l.length-u,0,p),c[p]=!0);for(u=0;u<o.length;u++)if(p=o[u],d=s[p],f=a[p],!c[p]&&!e(d,f))if(e(d.source,f.source)&&e(d["source-layer"],f["source-layer"])&&e(d.type,f.type)){for(g in li(d.layout,f.layout,r,p,null,ri.setLayoutProperty),li(d.paint,f.paint,r,p,null,ri.setPaintProperty),e(d.slot,f.slot)||r.push({command:ri.setSlot,args:[p,f.slot]}),e(d.filter,f.filter)||r.push({command:ri.setFilter,args:[p,f.filter]}),e(d.minzoom,f.minzoom)&&e(d.maxzoom,f.maxzoom)||r.push({command:ri.setLayerZoomRange,args:[p,f.minzoom,f.maxzoom]}),d)d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(d[g],f[g],r,p,g.slice(6),ri.setPaintProperty):e(d[g],f[g])||r.push({command:ri.setLayerProperty,args:[p,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?li(d[g],f[g],r,p,g.slice(6),ri.setPaintProperty):e(d[g],f[g])||r.push({command:ri.setLayerProperty,args:[p,g,f[g]]}))}else r.push({command:ri.removeLayer,args:[p]}),m=l[l.lastIndexOf(p)+1],r.push({command:ri.addLayer,args:[f,m]})}(s,i.layers,r)}catch(t){console.warn("Unable to compute style diff:",t),r=[{command:ri.setStyle,args:[i]}]}return r}(this.serialize(),i).filter((t=>!(t.command in Er)));if(0===r.length)return!1;const n=r.filter((t=>!(t.command in Mr)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((t=>t.command)).join(", ")}.`);return r.forEach((t=>{this[t.command].apply(this,t.args)})),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,this.scope,e)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new t.a(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e,i={}){return this._checkLoaded(),this._validate(at,`models.${t}`,e,null,i)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new t.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(X,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=Ge(e,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const o=e=>{const i=(e?"symbol:":"other:")+n.id,r=t.ag(i,this.scope),o=this._sourceCaches[i]=new $e(r,n,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=o,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.a(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new t.a(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(e);for(const e of r){const i=t.c3(e.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(e.id),e.fire(new t.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const i=this.getOwnSourceCache(e);i&&t.push(i.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const t of e){if(this._validate(tt,"lights",t))return;switch(t.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(t),e.updateTransitions(i)}else this.ambientLight=new wt(t,St,this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(t),e.updateTransitions(i)}else this.directionalLight=new wt(t,Tt,this.scope,this.options)}}const r=new t.K(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const r=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),n=e.properties.get("color").toArray01(),o=e.properties.get("intensity"),s=e.properties.get("direction"),a=1-t.bQ(s.x,s.y,s.z)[2]/90,l=r(n)*o*a,c=i.properties.get("color").toArray01(),u=i.properties.get("intensity");return(l+r(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(t.c4(e)){const i=t.c5(e),r=this.fragments.find((({id:t})=>t===i));if(!r)throw new Error(`Style import not found: ${e}`);const n=t.c3(e);return r.style.getFragmentStyle(n)}{const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}}getConfigProperty(e,i){const r=this.getFragmentStyle(e);if(!r)return null;const n=t.ag(i,r.scope),o=r.options.get(n),s=o?o.value||o.default:null;return s?s.serialize():null}setConfigProperty(e,i,r){const n=t.r(r);if("success"!==n.result)return void Cr(this,n.value);const o=n.value.expression,s=this.getFragmentStyle(e);if(!s)return;const a=t.ag(i,s.scope),l=s.options.get(a);l&&(this.options.set(a,{...l,value:o}),this.updateConfigDependencies())}setConfig(e,i){if(this._config=e,e||i)if(i)for(const r in i){let n,o;const s=t.r(i[r].default);if("success"===s.result&&(n=s.value.expression),e&&void 0!==e[r]){const i=t.r(e[r]);"success"===i.result&&(o=i.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:h}=i[r];if(n){const e=t.ag(r,this.scope);this.options.set(e,{default:n,value:o,minValue:a,maxValue:l,stepValue:c,type:u,values:h})}else this.fire(new t.a(new Error(`No schema defined for config option "${r}".`)))}else this.fire(new t.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const e=this.getLayer(t);e&&(e.possiblyEvaluateVisibility(),this._updateLayer(e))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this._layers[n])return void this.fire(new t.a(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===e.type){if(Cr(this,t.c6(e)))return;o=t.c2(e,this.scope,this.options)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=t.c1(e),e=t.e(e,{source:n})),this._validate(rt,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.c2(e,this.scope,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid);let s=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.a(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?s=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const a=this.getOwnLayerSourceCache(o),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(o);if(c&&o.source&&a&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const e=t.ag(o.source,o.scope);c.type!==o.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const r=this._checkLayer(e);if(!r)return;if(e===i)return;const n=this._order.indexOf(e);this._order.splice(n,1);let o=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.a(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?o=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const r=this.getOwnLayerSourceCache(e);if(r&&r.castsShadows){let t=!1;for(const i in this._layers)if(this._layers[i].source===e.source&&this._layers[i].canCastShadows()){t=!0;break}r.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const r=this._checkLayer(t);r&&(r.minzoom===e&&r.maxzoom===i||(null!=e&&(r.minzoom=e),null!=i&&(r.maxzoom=i),this._updateLayer(r)))}setSlot(t,e){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==e&&(i.slot=e,this._updateLayer(i))}setFilter(i,r,n={}){this._checkLoaded();const o=this._checkLayer(i);if(o&&!e(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(nt,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=t.c1(r),this._updateLayer(o)))}getFilter(e){const i=this._checkLayer(e);if(i)return t.c1(i.filter)}setLayoutProperty(i,r,n,o={}){this._checkLoaded();const s=this._checkLayer(i);if(s&&!e(s.getLayoutProperty(r),n)){if(null!=n&&(!o||!1!==o.validate)&&Cr(s,st.call(Y,{key:`layers.${i}.layout.${r}`,layerType:s.type,objectKey:r,value:n,styleSpec:t.D,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(r,n),s.isConfigDependent&&this._configDependentLayers.add(s.fqid),this._updateLayer(s)}}getLayoutProperty(t,e){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(e)}setPaintProperty(i,r,n,o={}){this._checkLoaded();const s=this._checkLayer(i);if(!s)return;if(e(s.getPaintProperty(r),n))return;if(null!=n&&(!o||!1!==o.validate)&&Cr(s,ot.call(Y,{key:`layers.${i}.paint.${r}`,layerType:s.type,objectKey:r,value:n,styleSpec:t.D})))return;const a=s.setPaintProperty(r,n);s.isConfigDependent&&this._configDependentLayers.add(s.fqid),a&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(t,e){const i=this._checkLayer(t);if(i)return i.getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this._checkSource(r);if(!o)return;const s=o.type;if("geojson"===s&&n)return void this.fire(new t.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!n)return void this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.a(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(r);for(const t of a)t.setFeatureState(n,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this._checkSource(r);if(!n)return;const o=n.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.a(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(r);for(const t of a)t.removeFeatureState(s,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this._checkSource(i);if(n){if("vector"!==n.type||r)return void 0===e.id&&this.fire(new t.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,e.id);this.fire(new t.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=t.e({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return t.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return t.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),r=t.ag(e.source,e.scope),n=this._changes.getUpdatedSourceCaches();e.source&&!n[r]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(r,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._mergedLayers[t].type||"model"===this._mergedLayers[t].type,i=this.order,r={},n=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(e(s)){r[s]=o;for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e)}}}n.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const o=[];for(let s=i.length-1;s>=0;s--){const a=i[s];if(e(a))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(r[e.layer.id]<s)break;o.push(e),n.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)o.push(e.feature)}}return o}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(nt,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.a(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._mergedLayers[e];if(!i)return this.fire(new t.a(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[],s=i.serializedLayers||{},a=i&&i.layers?i.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),l=Ct.createFromScreenPoints(e,r);for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t].getSource();if(!e||e.scope!==i.scope)continue;const c=this._mergedSourceCaches[t].getSource().id;i.layers&&!n[c]||o.push(qe(this._mergedSourceCaches[t],this._mergedLayers,s,l,i,r,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(He);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort(((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in a)a[e].forEach((r=>{const n=r.feature,o=i(t[e]);if(!o)return;const s=o.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=s}));return a}(this._mergedLayers,s,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,e){e&&e.filter&&this._validate(nt,"querySourceFeatures.filter",e.filter,null,e);const i=this.getOwnSourceCaches(t);let r=[];for(const t of i)r=r.concat(We(t,e));return r}addSourceType(t,e,i){return kr.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(kr.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,r={}){this._checkLoaded();const n=this.light.getLight();let o=!1;for(const i in t)if(!e(t[i],n[i])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,i,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,r=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&0!==r||delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=i;const o=null==i.source;if(1===r){if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=t.c1(n),n=t.e(n,{source:e})}const e=t.e({},n),i={};if(this.terrain&&o){e.source=this.terrain.get().source;const t=this.terrain?this.getFragmentStyle(this.terrain.scope):null;t&&(i.style=t.serialize())}if(this._validate(et,"terrain",e,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!o||this.terrain&&r!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,r),this.fire(new t.b("data",{dataType:"style"}))}else{const r=this.terrain,o=r.get();for(const e of Object.keys(t.D.terrain))!n.hasOwnProperty(e)&&t.D.terrain[e].default&&(n[e]=t.D.terrain[e].default);for(const n in i)if(!e(i[n],o[n])){r.set(i,this.options),this.stylesheet.terrain=i;const e=this._getTransitionParameters({duration:0});r.updateTransitions(e),this.fire(new t.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new bt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!e(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:t.f.now(),transition:t.e(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?t.push(i):e.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new dt(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,r,n,o={}){if(o&&!1===o.validate)return!1;const s=t.e({},this.serialize());return Cr(this,e.call(Y,t.e({key:i,style:s,value:r,styleSpec:t.D},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const t of e)t.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const t of e)t.resume(),t.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let e;this.directionalLight&&(e=wr(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,r,n,o=!1){let s=!1,a=!1;const l={},c={};for(const i of this._mergedOrder){const r=this._mergedLayers[i];if("symbol"!==r.type)continue;const n=t.ag(r.source,r.scope);let o=l[n];if(!o){const t=this.getLayerSourceCache(r);if(!t)continue;const e=t.getRenderableIds(!0).map((e=>t.getTileByID(e)));c[n]=e.slice(),o=l[n]=e.sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(r,o,e.center.lng,e.projection);s=s||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new t.b("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.f.now(),e.zoom))&&(this.pauseablePlacement=new er(e,this._mergedOrder,o,i,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.f.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s){this._buildingIndex.onNewFrame(e.zoom);for(const e of this._mergedOrder){const i=this._mergedLayers[e];"symbol"===i.type&&this.placement.updateLayerOpacities(i,l[t.ag(i.source,i.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.f.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(e,i){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==r.findIndex((({id:t})=>t===e.id)))return this.fire(new t.a(new Error(`Import with id '${e.id}' already exists in the map's style.`)));if(!i)return r.push(e),this._loadImports([e],!0),this;const n=r.findIndex((({id:t})=>t===i));return-1===n?this.fire(new t.a(new Error(`Import with id "${i}" does not exist on this map.`))):(this.stylesheet.imports=r.slice(0,n).concat(e).concat(r.slice(n)),this._loadImports([e],!0,i),this)}updateImport(t,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(t);return-1===n?this:"string"==typeof i?(this.setImportUrl(t,i),this):(i.url&&i.url!==r[n].url&&this.setImportUrl(t,i.url),e(i.config,r[n].config)||this.setImportConfig(t,i.config),e(i.data,r[n].data)||this.setImportData(t,i.data),this)}moveImport(t,e){this._checkLoaded();let i=this.stylesheet.imports||[];const r=this.getImportIndex(t);if(-1===r)return this;const n=this.getImportIndex(e);if(-1===n)return this;const o=i[r],s=this.fragments[r];return i=i.filter((({id:e})=>e!==t)),this.fragments=this.fragments.filter((({id:e})=>e!==t)),this.stylesheet.imports=i.slice(0,n).concat(o).concat(i.slice(n)),this.fragments=this.fragments.slice(0,n).concat(s).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(t,e){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(t);if(-1===r)return this;i[r].url=e;const n=this.fragments[r];return n.style=this._createFragmentStyle(i[r]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const i=this.getImportIndex(t),r=this.stylesheet.imports||[];return-1===i?this:e?(this.fragments[i].style.setState(e),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(t,r[i].url))}setImportConfig(t,e){this._checkLoaded();const i=this.getImportIndex(t),r=this.stylesheet.imports||[];if(-1===i)return this;e?r[i].config=e:delete r[i].config;const n=this.fragments[i],o=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=e,n.style.setConfig(e,o),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i||(e.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===i&&this.fire(new t.a(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[e];i&&t.push(i.getSource())}return t}getSource(t,e){const i=this.getSourceCache(t,e);return i&&i.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(e,i){const r=t.ag(e,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(e){const i=t.ag(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const i=t[e];"reload"===i?this.reloadSource(e):"clear"===i&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const i of e){const e=this.getLayer(i);e&&e.updateTransitions(t)}}getImages(t,e,i){this.imageManager.getImages(e.icons,e.scope,i),this._updateTilesForChangedImages();const r=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};r(this._otherSourceCaches[e.source]),r(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,e.scope,i)}getResource(e,i,r){return t.c9(i,r)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return 0===i.length?(this.fire(new t.a(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}kr.getSourceType=function(t){return je[t]},kr.setSourceType=function(t,e){je[t]=e},kr.registerForPluginStateChange=t.bV;var Nr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Dr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Or="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Rr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Fr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",zr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Br="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Ur="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Vr="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\n#ifdef DATA_FORMAT_UINT32\nvec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;\n#else\nvec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));\n#endif\nreturn velocity/max(u_max_speed,length(velocity));}\n#endif",jr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Gr="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Zr=[];$r(Nr,Zr),$r(Or,Zr),$r(Dr,Zr);const qr={"_prelude_fog.vertex.glsl":zr,"_prelude_terrain.vertex.glsl":Fr,"_prelude_shadow.vertex.glsl":jr,"_prelude_fog.fragment.glsl":Br,"_prelude_shadow.fragment.glsl":Gr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Ur,"_prelude_raster_particle.glsl":Vr},Wr={};Yr("",Fr),Yr(Br,zr),Yr(Gr,jr),Yr(Ur,""),Yr(Vr,"");const Hr=Yr(Dr,Or),Jr=Nr;var Kr={background:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Yr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yr('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Yr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Yr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Yr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Yr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Yr('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Yr("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Yr("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nvec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Yr("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'precision highp float;\n#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}'),rasterParticleTexture:Yr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Yr("void main() {}",'#include "_prelude_raster_array.glsl"\n#include "_prelude_raster_particle.glsl"\nin vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);\n#ifdef DATA_FORMAT_UINT32\nvec2 dp=vec2(0);\n#else\nvec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\n#endif\nvec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(\nvec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)\n);}'),symbolIcon:Yr('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nuniform mediump float u_icon_saturation;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;\n#else\nout_color=texture(u_texture,v_tex_a)*alpha;\n#endif\n#ifdef SATURATION\nvec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Yr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Yr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Yr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Yr('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Rr),skyboxGradient:Yr('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Rr),skyboxCapture:Yr("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Yr('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Yr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=local_pos;\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Yr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Yr("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function $r(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of i)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=t.split(" ");for(const t of i)e.includes(t)||e.push(t)}}function Yr(t,e){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((t=>{const e=t.split(" ");return e[e.length-1]})),n=[...new Set(n)]);const o={},s=[],a=[];if(t=t.replace(i,((t,e)=>(a.push(e),""))),(e=e.replace(i,((t,e)=>(s.push(e),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...Zr];$r(t,l),$r(e,l);for(const t of[...s,...a])qr[t]||console.error(`Undefined include: ${t}`),Wr[t]||(Wr[t]=[],$r(qr[t],Wr[t])),l=[...l,...Wr[t]];return{fragmentSource:t=t.replace(r,((t,e,i,r,n)=>(o[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===e?"":void 0))),vertexSource:e=e.replace(r,((t,e,i,r,n)=>{const s="float"===r?"vec2":r,a=n.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\nin ${i} ${r} a_${n};\n#endif\n`:o[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize"===e?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    in ${i} ${r} a_${n};\n    out ${i} ${r} ${n};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${n} = a_${n};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"define-instanced"===e?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${n}0;\nin vec4 a_${n}1;\nin vec4 a_${n}2;\nin vec4 a_${n}3;\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${s} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${n}\n    ${i} ${r} ${n} = a_${n};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${a}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:n,usedDefines:l,vertexIncludes:s,fragmentIncludes:a}}class Xr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,r,n,o,s,a){this.context=t;let l=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!l&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==s.length;for(let t=0;!c&&t<s.length;t++)this.boundDynamicVertexBuffers[t]!==s[t]&&(c=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o)this.freshBind(e,i,r,n,o,s,a);else{t.bindVertexArrayOES.set(this.vao);for(const i of s)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(t.gl,e,a));n&&n.dynamicDraw&&n.bind()}}freshBind(t,e,i,r,n,o,s){const a=t.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=o,e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of i)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(const e of o)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n),s&&e.instanceCount&&e.setVertexAttribDivisor(c,t,s));r&&r.bind(),l.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Qr(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.L(0,n/r).toLngLat().lat,new t.L(0,(n+1)/r).toLngLat().lat]}function tn(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=r.hillshadeFBO;if(!u)return;e.prepareDrawTile();const h=e.isTileAffectedByFog(i),p=e.getOrCreateProgram("hillshade",{overrideFog:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,i,r,n)=>{const o=r.paint.get("hillshade-shadow-color"),s=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),l=r.paint.get("hillshade-emissive-strength");let c=t.bj(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))c-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const i=e.style.directionalLight.properties.get("direction"),r=t.bQ(i.x,i.y,i.z);c=t.bj(r[1])}const u=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(i.tileID.toUnwrapped(),u),u_image:0,u_latrange:Qr(0,i.tileID),u_light:[r.paint.get("hillshade-exaggeration"),c],u_shadow:o,u_highlight:s,u_emissive_strength:l,u_accent:a}})(e,r,n,e.terrain?i.projMatrix:null);e.uploadCommonUniforms(l,p,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=e.getTileBoundsBuffers(r);p.draw(e,c.TRIANGLES,o,s,a,Re.disabled,d,n.id,f,m,g)}function en(e,i,r){if(!i.needsDEMTextureUpload)return;const n=e.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(r.stride);const s=r.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new t.T(n,s,o.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function rn(e,i,r){const n=e.context,o=n.gl;if(!i.dem)return;const s=i.dem;if(n.activeTexture.set(o.TEXTURE1),en(e,i,s),!i.demTexture)return;i.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const a=s.dim;n.activeTexture.set(o.TEXTURE0);let l=i.hillshadeFBO;if(!l){const e=new t.T(n,{width:a,height:a,data:null},o.RGBA);e.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=i.hillshadeFBO=n.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(e.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:h}=e.getMercatorTileBoundsBuffers(),p=[];e.linearFloatFilteringSupported()&&p.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:p}).draw(e,o.TRIANGLES,Ie.disabled,Pe.disabled,Ne.unblended,Re.disabled,((e,i)=>{const r=i.stride,n=t.a6.create();return t.a6.ortho(n,0,t.V,-t.V,0,0,1),t.a6.translate(n,n,[0,-t.V,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ}})(i.tileID,s),r.id,c,u,h),i.needsHillshadePrepare=!1}const nn=e=>({u_matrix:new t.bK(e),u_image0:new t.bO(e),u_skirt_height:new t.bN(e),u_ground_shadow_factor:new t.bM(e)}),on=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),sn=(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:p,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:d,u_far_z_cutoff:f});function an(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const ln=new class{constructor(){this.operations={}}newMorphing(t,e,i,r,n){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:r,phase:0,duration:n,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},cn={0:null,1:"TERRAIN_VERTEX_MORPHING"};function un(t,e,i){if(0===e)return 0;const r=e<1&&514===i?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*r}function hn(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const pn=t=>({u_matrix:t});function dn(e,i,r,n,o){if(o>0){const s=t.f.now(),a=(s-e.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=r.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),p=h&&e.refreshedUponExpiration?1:t.aa(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}class fn extends $e{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},r=new t.bW(t.bX(),null),n=Ge("mock-dem",i,r,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class mn extends $e{constructor(e){const i=Ge("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new t.bW(t.bX(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,e,i){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((e,i)=>{if(e[i.key]="",!this._tiles[i.key]){const e=new Ve(i,this._source.tileSize*i.overscaleFactor(),t.tileZoom);e.state="loaded",this._tiles[i.key]=e}return e}),{});for(const t in this._tiles)t in r||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gn extends t.am{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class _n extends t.ck{constructor(e,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,o]=function(e){const i=new t.aN,r=new t.aw,n=131;i.reserve(17161),r.reserve(33800);const o=t.V/128,s=t.V+o/2,a=s+o;for(let e=-o;e<a;e+=o)for(let r=-o;r<a;r+=o){const n=r<0||r>s||e<0||e>s?24575:0,o=t.aa(Math.round(r),0,t.V),a=t.aa(Math.round(e),0,t.V);i.emplaceBack(o+n,a)}const l=(t,e)=>{const i=e*n+t;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)})),[i,r,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(r,t.aP.members),this.gridIndexBuffer=s.createIndexBuffer(n),this.gridSegments=t.aB.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=t.aB.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mn(i.map),this.orthoMatrix=t.a6.create(),t.a6.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.V,0,t.V,0,1);const a=s.gl;this._overlapStencilMode=new Pe({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fn(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,i,r){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const n=e.terrain.properties,o=0===e.terrain.drapeRenderMode,s=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.f.now();const a=e.terrain&&e.terrain.scope,l=n.get("source"),c=o?this._mockSourceCache:e.getSourceCache(l,a);if(!c)return void t.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._exaggeration=s?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&s&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){const i=this._previousCameraAltitude,r=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=r;const n=null!=i?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const o=e.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(a=.5*(o-c+a)),a*n<0&&(c+=a)),this._evaluationZoom=c;const u=s.getExaggeration(c),h=u===s.getExaggeration(Math.max(0,c-.1));if(h&&Math.abs(u-this._exaggeration)<.01)return u;let p=Math.min(.1,.00375*(this._updateTimestamp-l));return(h||u<.1||Math.abs(a)<1e-4)&&(p=Math.min(.2,4*p)),t.U(this._exaggeration,u,p)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(t.L.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=r.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new t.P(r.x,r.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const r=new t.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=n.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)}))}(n,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const t in s){const i=s[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],o),i.usedForTerrain)continue;const r=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((t=>new gn(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),en(this.painter,r,n))}}_prepareDemTileUniforms(t,e,i,r){if(!e||null==e.demTexture)return!1;const n=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-n.z),s=r||"";return i[`u_dem_tl${s}`]=[n.x*o%1,n.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const r=new t.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.T(e,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const r=i.dem.tree.minimums[0];return r>0&&t++,e+r}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,o]=(()=>{const e=new t.cm({width:1,height:1},new Float32Array([r]));return[i.R32F,e]})();this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(o,{premultiply:!1}):s=this._emptyDEMTexture=new t.T(e,o,n,{premultiply:!1}),s}setupElevationDraw(e,i,r){const n=this.painter.context,o=n.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const t=r.morphing.srcDemTile,i=r.morphing.dstDemTile;c=r.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(l=t),this._prepareDemTileUniforms(e,i,s)&&(a=i))}const u=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,h=t=>{s.u_dem_size=1===t.size[0]?1:t.size[0]-2};if(l&&a)n.activeTexture.set(o.TEXTURE2),a.demTexture.bind(u(a),o.CLAMP_TO_EDGE),n.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),a.demTexture&&h(a.demTexture),s.u_dem_lerp=c;else{a=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(o.TEXTURE2);const t=this._prepareDemTileUniforms(e,a,s)?a.demTexture:this.emptyDEMTexture;t.bind(u(a),o.CLAMP_TO_EDGE),h(t)}if(n.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*t.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,s),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,t)}}globeUniformValues(e,i,r){const n=e.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,t.V,0),u_tile_br_up:n.upVector(i,t.V,t.V),u_tile_bl_up:n.upVector(i,0,t.V),u_tile_up_scale:r?t.cl(1):n.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,r=this.painter.context;0!==e.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,r,n,o){if("globe"===e.transform.projection.name)!function(e,i,r,n,o){const s=e.context,a=s.gl;let l,c;const u=e.transform,h=t.cd(e,s,u),p=(t,i)=>{if(c===i)return;const r=[cn[i],"PROJECTION_GLOBE_VIEW"];h&&r.push("CUSTOM_ANTIALIASING");const n=e.isTileAffectedByFog(t);l=e.getOrCreateProgram("globeRaster",{defines:r,overrideFog:n}),c=i},d=e.colorModeForRenderPass(),f=new Ie(a.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D);ln.update(o);const m=t.ce(u),g=[t.a5(u.center.lng),t.ae(u.center.lat)],_=e.globeSharedBuffers,y=[u.width*t.f.devicePixelRatio,u.height*t.f.devicePixelRatio],A=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=e.transform,h=un(u.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const x=a.TRIANGLES;for(const c of n){const n=r.getTile(c),b=Pe.disabled,w=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];an(w,S)&&ln.newMorphing(c.key,w,S,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=ln.getMorphValuesForProxy(c.key),C=T?1:0;T&&t.j(v,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.cc(T.phase)}});const M=t.cf(c.canonical),E=t.cg(M.getCenter().lat),I=t.ch(c.canonical,M,E,u.worldSize/u._pixelsPerMercatorPixel),L=t.aT(t.ci(c.canonical)),P=sn(u.expandedFarZProjMatrix,A,m,L,t.S(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,h,u._farZ,I);if(p(c,C),l&&(i.setupElevationDraw(n,l,v),e.uploadCommonUniforms(s,l,c.toUnwrapped()),_)){const[t,i,r]=_.getGridBuffers(E,0!==h);l.draw(e,x,f,b,d,Re.backCCW,P,"globe_raster",t,i,r)}}}if(_&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];h&&o.push("CUSTOM_ANTIALIASING"),l=e.getOrCreateProgram("globeRaster",{defines:o});for(const o of n){const{x:n,y:c,z:h}=o.canonical,p=0===c,m=c===(1<<h)-1,[A,x,b,w]=_.getPoleBuffers(h,!1);if(w&&(p||m)){const c=r.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=t.cj(h,n,u);const S=t.aT(t.ci(o.canonical)),T=(t,i)=>t.draw(e,a.TRIANGLES,f,Pe.disabled,d,Re.disabled,sn(u.expandedFarZProjMatrix,_,_,S,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ),"globe_pole_raster",i,b,w);i.setupElevationDraw(c,l,v),e.uploadCommonUniforms(s,l,o.toUnwrapped()),p&&e.renderDefaultNorthPole&&T(l,A),m&&e.renderDefaultSouthPole&&(_=t.a6.scale(t.a6.create(),_,[1,-1,1]),T(l,x))}}}}(e,i,r,n,o);else{const s=e.context,a=s.gl;let l,c;const u=e.shadowRenderer,h=_r(e,e.longestCutoffRange),p=t=>{if(c===t)return;const i=[];i.push(cn[t]),h.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),l=e.getOrCreateProgram("terrainRaster",{defines:i}),c=t},d=e.colorModeForRenderPass(),f=new Ie(a.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D);ln.update(o);const m=e.transform,g=un(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let _=[0,0,0];if(u){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(_=Sr(t,i))}{c=-1;const y=a.TRIANGLES,[A,v]=[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),x=Pe.disabled,b=i.prevTerrainTileForTile[c.key],w=i.terrainTileForTile[c.key];an(b,w)&&ln.newMorphing(c.key,b,w,o,250),s.activeTexture.set(a.TEXTURE0),n.texture&&n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=ln.getMorphValuesForProxy(c.key),T=S?1:0;let C;S&&(C={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:t.cc(S.phase)}});const M=on(c.projMatrix,hn(c.canonical,m.renderWorldCopies)?g/10:g,_);if(p(T),!l)continue;i.setupElevationDraw(n,l,C);const E=c.toUnwrapped();u&&u.setupShadows(E,l),e.uploadCommonUniforms(s,l,E,null,h),l.draw(e,y,f,x,d,Re.backCCW,M,"terrain_raster",i.gridBuffer,A,v)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],s=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][e]:void 0,p=void 0!==h?n.renderCache[h]:this.pool[c++],d=void 0!==h;if(o.texture=p.tex,d&&!p.dirty){l.push(o.tileID);continue}let f;r.bindFramebuffer.set(p.fb.framebuffer),this.renderedToTile=!1,p.dirty&&(r.clear({color:t.ax.transparent,stencil:0}),p.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(e),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,p.fb.width,p.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(p,o,e,n),f=n?n.id:null),i.renderLayer(i,n,e,s)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(e),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,p.fb.width,p.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(p,o,e,n),f=n?n.id:null),i.renderLayer(i,n,e,s)}this.renderedToTile?(p.dirty=!0,l.push(o.tileID)):d||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let i=-1,r=e;for(let n=0;n<e;++n)this._style.isLayerDraped(t._mergedLayers[t.order[n]])?i=Math.max(i,n):r=Math.min(r,n);return r>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((t=>t.dem)).map((r=>{const n=r.tileID,o=1<<n.overscaledZ,{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:r}}));r.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,t,e,i);if(null!=r)return r}return null}_createFBO(){const e=this.painter.context,i=e.gl,r=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const n=new t.T(e,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=e.createFramebuffer(r[0],r[1],!0,null);return o.colorAttachment.set(n.texture),o.depthAttachment=new Me(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._mergedLayers[t],i=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof kt){e=!0;break}if(!e)return;const i={};for(let e=0;e<this._style.order.length;++e){const r=this._style._mergedLayers[this._style.order[e]],n=this._style.getLayerSourceCache(r);if(n&&!i[n.id]&&!r.isHidden(this.painter.transform.zoom)&&"line"===r.type&&r.widthExpression()instanceof t.Z){i[n.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e)this._clearRenderCacheForTile(n.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e]._source instanceof Nt){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._mergedLayers[this._style.order[t]],r=this._style.getLayerSourceCache(i);if(!r||e[r.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const n=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=dn(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,i=e.length;if(0===i)return;const r=[];this._pendingGroundEffectLayers=[];let n,o=0,s=this._style._mergedLayers[e[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<i;)s=this._style._mergedLayers[e[o]];for(;o<i;++o){const t=this._style._mergedLayers[e[o]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=o):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(o),void 0!==n&&(r.push({start:n,end:o-1}),n=void 0)))}if(void 0!==n&&r.push({start:n,end:o-1}),0!==r.length){const e=r[r.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const r=Object.values(t[i]);e.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],n=this.proxyToSource[o.key];let s=0;for(const t in n){const e=n[t],o=i[t];if(!o||o.length!==e.length||e.some(((e,i)=>e!==o[i]||r[t]&&r[t].hasOwnProperty(e.key)))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of n)for(const r of i){if(e.proxyCachedFBO[r.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[r.key]={},e.proxyCachedFBO[r.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Pe.disabled}_renderTileClippingMasks(t,e){const i=this.painter,r=this.painter.context,n=r.gl;i._tileClippingMaskIDs={},r.setColorMode(Ne.disabled),r.setDepthMode(Ie.disabled);const o=i.getOrCreateProgram("clippingMask");for(const r of t){const t=i._tileClippingMaskIDs[r.key]=--e;o.draw(i,n.TRIANGLES,Ie.disabled,new Pe({func:n.ALWAYS,mask:0},t,255,n.KEEP,n.KEEP,n.REPLACE),Ne.disabled,Re.disabled,pn(r.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const r=[e.x,e.y,1,1];t.a7.transformMat4(r,r,i.pixelMatrixInverse),t.a7.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,o=t.bl(1,i.center.lat),s=[n[0],n[1],n[2]/o,0],a=t.N.subtract([],r.slice(0,3),s);t.N.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.N.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,i=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=i.gl,r=i.createFramebuffer(n,o,!0,"renderbuffer");i.activeTexture.set(e.TEXTURE0);const s=new t.T(i,{width:n,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,o);r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,o]),function(t,e,i,r){if("globe"===t.transform.projection.name)return;const n=t.context,o=n.gl;n.clear({depth:1});const s=t.getOrCreateProgram("terrainDepth"),a=new Ie(o.LESS,Ie.ReadWrite,t.depthRangeFor3D);for(const n of r){const r=i.getTile(n),l=on(n.projMatrix,0,[0,0,0]);e.setupElevationDraw(r,s),s.draw(t,o.TRIANGLES,a,Pe.disabled,Ne.unblended,Re.backCCW,l,"terrain_depth",e.gridBuffer,e.gridIndexBuffer,e.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,i,r){if(e.getSource()instanceof t.ap)return this._setupProxiedCoordsForImageSource(e,i,r);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],o=this.proxyCoords;for(let t=0;t<o.length;t++){const i=o[t],s=this._findTileCoveringTileID(i,e);if(s){const t=this._createProxiedId(i,s,r[i.key]&&r[i.key][e.id]);n.push(t),this.proxyToSource[i.key][e.id]=[t]}}let s=!1;const a=new Set;for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const t=this.proxyToSource[l.tileID.key][e.id],i=this._createProxiedId(l.tileID,o,r[l.tileID.key]&&r[l.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[l.tileID.key][e.id]=[i];const c=this.proxyToSource[l.tileID.key][e.id];a.has(c)||a.add(c),n.push(i),s=!0}}if(this._sourceTilesOverlap[e.id]=s,s&&this._debugParams.sortTilesHiZFirst)for(const t of a)t.sort(((t,e)=>e.overscaledZ-t.overscaledZ))}_setupProxiedCoordsForImageSource(e,i,r){if(!e.getSource().loaded())return;const n=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=s.tileID;if(!a)return;const l=new t.P(a.x,a.y)._div(1<<a.z),c=s.coordinates.map(t.L.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-l.x),t.min.y=Math.min(t.min.y,e.y-l.y),t.max.x=Math.max(t.max.x,e.x-l.x),t.max.y=Math.max(t.max.y,e.y-l.y),t)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,i)=>{const r=e.wrap+e.canonical.x/(1<<e.canonical.z),n=e.canonical.y/(1<<e.canonical.z),o=t.V/(1<<e.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return r+o<s+c.min.x||r>s+c.max.x||n+o<a+c.min.y||n>a+c.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;if(u(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],n.push(a)}}}_createProxiedId(e,i,r){let n=this.orthoMatrix;if(r){const t=r.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const r=e.canonical.z-i.tileID.canonical.z;let o,s,a;n=t.a6.create();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;r>0?(o=t.V>>r,s=o*((i.tileID.canonical.x<<r)-e.canonical.x+l),a=o*((i.tileID.canonical.y<<r)-e.canonical.y)):(o=t.V<<-r,s=t.V*(i.tileID.canonical.x-(e.canonical.x+l<<-r)),a=t.V*(i.tileID.canonical.y-(e.canonical.y<<-r))),t.a6.ortho(n,0,o,0,o,0,1),t.a6.translate(n,n,[s,a,0])}return new gn(i.tileID,e.key,n)}_findTileCoveringTileID(e,i){let r=i.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],o=n[e.key];if(r=o?i.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:e,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const n=i.getSource().maxzoom;if(e.canonical.z>=n){const r=e.canonical.z-n;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),s=new t.am(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r)):0!==r&&(a=n,s=new t.am(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r))}s.key!==e.key&&(c.push(s.key),r=i.getTile(s))}const u=t=>{c.forEach((e=>{n[e]=t})),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const t=s.calculateScaledKey(a);if(r=i.getTileByID(t),r&&r.hasData())break;const e=n[t];if(null===e)break;void 0===e?c.push(t):r=i.getTileByID(e)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}}function yn(e,i,r){const n=function(e,i,r){const n=t.N.dot(i,e),o=t.N.dot(r,[.2126,.7152,.0722]),s=(t,e,i)=>(1-i)*t+i*e,a=s(1-.3*Math.min(o,1),1,Math.min(n+1,1));return s(.92,1,Math.asin(t.aa(i[2],-1,1))/Math.PI+.5)*a}(e,[0,0,1],i),o=[0,0,0];t.N.scale(o,r.slice(0,3),n);const s=[0,0,0];t.N.scale(s,i.slice(0,3),e[2]);const a=[0,0,0];return t.N.add(a,o,s),t.bU(a)}const An=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],vn=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class xn{static cacheKey(t,e,i,r){let n=`${e}${r?r.cacheKey:""}`;for(const e of i)t.usedDefines.includes(e)&&(n+=`/${e}`);return n}constructor(e,i,r,n,o,s,a){const l=e.gl;this.program=l.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...s];const c=n?n.getBinderAttributes():[],u=(r.staticAttributes||[]).concat(c);let h=n?n.defines():[];h=h.concat(s.map((t=>`#define ${t}`)));const p="#version 300 es\n";let d=p+h.concat("precision mediump float;",Jr,Hr.fragmentSource).join("\n");for(const t of r.fragmentIncludes)d+=`\n${qr[t]}`;d+=`\n${r.fragmentSource}`;let f=p+h.concat("precision highp float;",Jr,Hr.vertexSource).join("\n");for(const t of r.vertexIncludes)f+=`\n${qr[t]}`;f+=`\n${r.vertexSource}`;const m=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())return void(this.failedToCreate=!0);l.shaderSource(m,d),l.compileShader(m),l.attachShader(this.program,m);const g=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(g,f),l.compileShader(g),l.attachShader(this.program,g),this.attributes={},this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)if(u[t]){const e=u[t].startsWith("a_")?u[t]:`a_${u[t]}`;l.bindAttribLocation(this.program,t,e),this.attributes[e]=t}a&&a.shaderVaryings.length>0&&l.transformFeedbackVaryings(this.program,a.shaderVaryings,a.bufferMode),l.linkProgram(this.program),l.deleteShader(g),l.deleteShader(m),this.fixedUniforms=o(e),this.binderUniforms=n?n.getUniforms(e):[],s.includes("TERRAIN")&&(this.terrainUniforms=(e=>({u_dem:new t.bO(e),u_dem_prev:new t.bO(e),u_dem_tl:new t.bL(e),u_dem_scale:new t.bN(e),u_dem_tl_prev:new t.bL(e),u_dem_scale_prev:new t.bN(e),u_dem_size:new t.bN(e),u_dem_lerp:new t.bN(e),u_exaggeration:new t.bN(e),u_depth:new t.bO(e),u_depth_size_inv:new t.bL(e),u_meter_to_dem:new t.bN(e),u_label_plane_matrix_inv:new t.bK(e)}))(e)),s.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.bM(e),u_tile_tr_up:new t.bM(e),u_tile_br_up:new t.bM(e),u_tile_bl_up:new t.bM(e),u_tile_up_scale:new t.bN(e)}))(e)),s.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.bK(e),u_fog_range:new t.bL(e),u_fog_color:new t.bP(e),u_fog_horizon_blend:new t.bN(e),u_fog_vertical_limit:new t.bL(e),u_fog_temporal_offset:new t.bN(e),u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_globe_pos:new t.bM(e),u_globe_radius:new t.bN(e),u_globe_transition:new t.bN(e),u_is_globe:new t.bO(e),u_viewport:new t.bL(e)}))(e)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new t.bP(e)}))(e)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new t.bM(e),u_lighting_directional_dir:new t.bM(e),u_lighting_directional_color:new t.bM(e),u_ground_radiance:new t.bM(e)}))(e)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new t.bK(e),u_light_matrix_1:new t.bK(e),u_fade_range:new t.bL(e),u_shadow_normal_offset:new t.bM(e),u_shadow_intensity:new t.bN(e),u_shadow_texel_size:new t.bN(e),u_shadow_map_resolution:new t.bN(e),u_shadow_direction:new t.bM(e),u_shadow_bias:new t.bM(e),u_shadowmap_0:new t.bO(e),u_shadowmap_1:new t.bO(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}_drawDebugWireframe(e,i,r,n,o,s,a,l,c,u){const h=e.options.wireframe;if(!1===h.terrain&&!1===h.layers2D&&!1===h.layers3D)return;const p=e.context;if(!(()=>!(!h.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!h.layers2D||e._terrain&&e._terrain.renderingToTexture||!An.includes(this.name))||!(!h.layers3D||!vn.includes(this.name)))())return;const d=p.gl,f=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,o,p);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=e.getOrCreateProgram(this.name,{config:this.configuration,defines:m});p.program.set(g.program);const _=(t,e,i)=>{if(e[t]&&i[t])for(const r in e[t])i[t][r]&&i[t][r].set(i.program,r,e[t][r].current)};c&&c.setUniforms(g.program,p,g.binderUniforms,a,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),f.bind(),p.setColorMode(new Ne([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],t.ax.transparent,[!0,!0,!0,!1])),p.setDepthMode(new Ie(i.func===d.LESS?d.LEQUAL:i.func,Ie.ReadOnly,i.range)),p.setStencilMode(Pe.disabled);const y=3*s.primitiveLength*2,A=3*s.primitiveOffset*2*2;u&&u>1?d.drawElementsInstanced(d.LINES,y,d.UNSIGNED_SHORT,A,u):d.drawElements(d.LINES,y,d.UNSIGNED_SHORT,A),o.bind(),p.program.set(this.program),p.setDepthMode(i),p.setStencilMode(r),p.setColorMode(n)}draw(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=t.context,y=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(i),_.setStencilMode(r),_.setColorMode(n),_.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,s[t]);d&&d.setUniforms(this.program,_,this.binderUniforms,h,{zoom:p});const A={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[e],v=g&&g.length>0;if(v){for(const t of g)y.bindBufferBase(y.TRANSFORM_FEEDBACK_BUFFER,t.targetIndex,t.buffer.buffer);y.beginTransformFeedback(e)}const x=m&&m>0?1:void 0;for(const o of u.get()){const s=o.vaos||(o.vaos={});(s[a]||(s[a]=new Xr)).bind(_,this,l,d?d.getPaintVertexBuffers():[],c,o.vertexOffset,f||[],x),m&&m>1?y.drawElementsInstanced(e,o.primitiveLength*A,y.UNSIGNED_SHORT,o.primitiveOffset*A*2,m):c?y.drawElements(e,o.primitiveLength*A,y.UNSIGNED_SHORT,o.primitiveOffset*A*2):y.drawArrays(e,o.vertexOffset,o.vertexLength),e===y.TRIANGLES&&c&&this._drawDebugWireframe(t,i,r,n,c,o,h,p,d,m)}v&&y.endTransformFeedback()}}function bn(e,i){const r=Math.pow(2,i.tileID.overscaledZ),n=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,o=n*(i.tileID.canonical.x+i.tileID.wrap*r),s=n*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.a3(i,1,e.transform.tileZoom),u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}const wn=t.a6.create(),Sn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g)=>{const _=i.style.light,y=_.properties.get("position"),A=[y.x,y.y,y.z],v=t.co.create();"viewport"===_.properties.get("anchor")&&(t.co.fromRotation(v,-i.transform.angle),t.N.transformMat3(A,A,v));const x=_.properties.get("color"),b=i.transform,w={u_matrix:e,u_lightpos:A,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[x.r,x.g,x.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:o,u_edge_radius:s,u_flood_light_color:p,u_vertical_scale:d,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:g};return"globe"===b.projection.name&&(w.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],w.u_zoom_transition=c,w.u_inv_rot_matrix=h,w.u_merc_center=u,w.u_up_dir=b.projection.upVector(new t.bs(0,0,0),u[0]*t.V,u[1]*t.V),w.u_height_lift=l),w},Tn=(t,e,i)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:i}),Cn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f)=>{const m=Sn(e,i,r,n,o,s,a,c,u,h,p,d,f,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return t.e(m,bn(i,l),g)},Mn=(t,e)=>({u_matrix:t,u_emissive_strength:e}),En=(e,i,r,n)=>t.e(Mn(e,i),bn(r,n)),In=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),Ln=(e,i,r,n,o)=>t.e(En(e,i,r,n),{u_world:o}),Pn=(e,i,r,n)=>{const o=t.V/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},kn=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Nn=t.a6.create(),Dn=(e,i,r,n,o,s,a)=>{const l=e.transform,c="globe"===l.projection.name,u=c?t.cp(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:t.a3(r,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Nn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=t.S(l.zoom);const e=o[0]*t.V,r=o[1]*t.V;h.u_up_dir=l.projection.upVector(new t.bs(0,0,0),e,r)}return h};function On(t,[e,i,r,n],[o,s]){if(o===s)return[0,0,0,0];const a=255*(t-1)/(t*(s-o));return[e*a,i*a,r*a,n*a]}function Rn(t,e,[i,r]){return i===r?0:.5/t+(e-i)*(t-1)/(t*(r-i))}const Fn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x)=>{return{u_matrix:e,u_normalize_matrix:i,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:o,u_tl_parent:s,u_scale_parent:u,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(w=p.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(b=p.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:zn(p.paint.get("raster-hue-rotate")),u_perspective_transform:d,u_raster_elevation:f,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:On(t.cq,g,y),u_colorization_offset:Rn(t.cq,_,y),u_color_ramp:m,u_texture_offset:[v/(A+2*v),A/(A+2*v)],u_texture_res:[A+2*v,A+2*v],u_emissive_strength:x};var b,w};function zn(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Bn=(t,e,i,r,n,o,s,a,l,c,u,h)=>({u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:h,u_zoom_transition:s,u_merc_center:a,u_cutoff_params:l}),Un=(t,e,i,r,n,o,s,a)=>({u_tile_offset:t,u_velocity:e,u_color_ramp:r,u_velocity_res:i,u_max_speed:n,u_texture_offset:o,u_data_scale:s,u_data_offset:a}),Vn=(t,e,i,r,n,o,s,a)=>({u_velocity:t,u_velocity_res:e,u_max_speed:i,u_speed_factor:r,u_lifetime_delta:n,u_rand_seed:Math.random(),u_texture_offset:o,u_data_scale:s,u_data_offset:a}),jn=t.a6.create(),Gn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y)=>{const A=o.transform,v={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:A.getCameraToCenterDistance(g),u_rotate_symbol:+r,u_aspect_ratio:A.width/A.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:jn,u_up_vector:[0,-1,0],u_icon_transition:y||0,u_icon_saturation:_};return"globe"===g.name&&(v.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],v.u_zoom_transition=p,v.u_inv_rot_matrix=f,v.u_merc_center=d,v.u_camera_forward=A._camera.forward(),v.u_ecef_origin=t.cr(A.globeMatrix,h.toUnwrapped()),v.u_tile_matrix=Float32Array.from(A.globeMatrix),v.u_up_vector=m),v},Zn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_)=>t.e(Gn(e,i,r,n,o,s,a,l,c,u,p,d,f,m,g,_,1),{u_gamma_scale:n?o.transform.getCameraToCenterDistance(_)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:t.f.devicePixelRatio,u_is_halo:+h,undefined:void 0}),qn=(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g)=>t.e(Zn(e,i,r,n,o,s,a,l,!0,c,!0,h,p,d,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),Wn=(t,e,i,r)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:r}),Hn=(e,i,r,n,o,s,a)=>t.e(function(e,i,r,n){const o=r.imageManager.getPattern(e.toString(),i),{width:s,height:a}=r.imageManager.getPixelSize(i),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:o.tl,u_pattern_br:o.br,u_texsize:[s,a],u_pattern_size:o.displaySize,u_tile_units_to_pixels:1/t.a3(n,1,r.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(o,s,n,a),{u_matrix:e,u_emissive_strength:i,u_opacity:r}),Jn=(e,i,r,n,o,s,a,l,c,u,h,p,d=[0,0,0],f)=>{const m=n.style.light,g=m.properties.get("position"),_=[-g.x,-g.y,g.z],y=t.co.create();"viewport"===m.properties.get("anchor")&&(t.co.fromRotation(y,-n.transform.angle),t.N.transformMat3(_,_,y));const A="MASK"===u.alphaMode,v=m.properties.get("color"),x=p.paint.get("model-ambient-occlusion-intensity"),b=p.paint.get("model-color").constantOr(t.ax.white),w=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:i,u_normal_matrix:r,u_lightpos:_,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[v.r,v.g,v.b],u_camera_pos:d,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+A,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[a[0],a[1],a[2],1],u_metallicFactor:l,u_roughnessFactor:c,u_baseColorTexture:gr.BaseColor,u_metallicRoughnessTexture:gr.MetallicRoughness,u_normalTexture:gr.Normal,u_occlusionTexture:gr.Occlusion,u_emissionTexture:gr.Emission,u_color_mix:[b.r,b.g,b.b,w],u_aoIntensity:x,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Kn=new Float32Array(16),$n=(t,e=Kn,i=Kn)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),Yn={fillExtrusion:e=>({u_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_vertical_gradient:new t.bN(e),u_opacity:new t.bN(e),u_edge_radius:new t.bN(e),u_ao:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_up_dir:new t.bM(e),u_height_lift:new t.bN(e),u_flood_light_color:new t.bM(e),u_vertical_scale:new t.bN(e),u_flood_light_intensity:new t.bN(e),u_ground_shadow_factor:new t.bM(e),u_emissive_strength:new t.bN(e)}),fillExtrusionDepth:e=>({u_matrix:new t.bK(e),u_edge_radius:new t.bN(e),u_vertical_scale:new t.bN(e)}),fillExtrusionPattern:e=>({u_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_vertical_gradient:new t.bN(e),u_height_factor:new t.bN(e),u_edge_radius:new t.bN(e),u_ao:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_up_dir:new t.bM(e),u_height_lift:new t.bN(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e),u_opacity:new t.bN(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new t.bK(e),u_opacity:new t.bN(e),u_ao_pass:new t.bN(e),u_meter_to_tile:new t.bN(e),u_ao:new t.bL(e),u_flood_light_intensity:new t.bN(e),u_flood_light_color:new t.bM(e),u_attenuation:new t.bN(e),u_edge_radius:new t.bN(e),u_fb:new t.bO(e),u_fb_size:new t.bN(e)}),fill:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e)}),fillPattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),fillOutline:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_world:new t.bL(e)}),fillOutlinePattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_world:new t.bL(e),u_image:new t.bO(e),u_texsize:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),circle:t.cs,collisionBox:e=>({u_matrix:new t.bK(e),u_camera_to_center_distance:new t.bN(e),u_extrude_scale:new t.bL(e)}),collisionCircle:e=>({u_matrix:new t.bK(e),u_inv_matrix:new t.bK(e),u_camera_to_center_distance:new t.bN(e),u_viewport_size:new t.bL(e)}),debug:e=>({u_color:new t.ca(e),u_matrix:new t.bK(e),u_overlay:new t.bO(e),u_overlay_scale:new t.bN(e)}),clippingMask:e=>({u_matrix:new t.bK(e)}),heatmap:e=>({u_extrude_scale:new t.bN(e),u_intensity:new t.bN(e),u_matrix:new t.bK(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_up_dir:new t.bM(e)}),heatmapTexture:e=>({u_image:new t.bO(e),u_color_ramp:new t.bO(e),u_opacity:new t.bN(e)}),hillshade:e=>({u_matrix:new t.bK(e),u_image:new t.bO(e),u_latrange:new t.bL(e),u_light:new t.bL(e),u_shadow:new t.ca(e),u_highlight:new t.ca(e),u_emissive_strength:new t.bN(e),u_accent:new t.ca(e)}),hillshadePrepare:e=>({u_matrix:new t.bK(e),u_image:new t.bO(e),u_dimension:new t.bL(e),u_zoom:new t.bN(e)}),line:t.ct,linePattern:t.cu,raster:e=>({u_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_grid_matrix:new t.cb(e),u_tl_parent:new t.bL(e),u_scale_parent:new t.bN(e),u_fade_t:new t.bN(e),u_opacity:new t.bN(e),u_image0:new t.bO(e),u_image1:new t.bO(e),u_brightness_low:new t.bN(e),u_brightness_high:new t.bN(e),u_saturation_factor:new t.bN(e),u_contrast_factor:new t.bN(e),u_spin_weights:new t.bM(e),u_perspective_transform:new t.bL(e),u_raster_elevation:new t.bN(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_cutoff_params:new t.bP(e),u_colorization_mix:new t.bP(e),u_colorization_offset:new t.bN(e),u_color_ramp:new t.bO(e),u_texture_offset:new t.bL(e),u_texture_res:new t.bL(e),u_emissive_strength:new t.bN(e)}),rasterParticle:e=>({u_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_grid_matrix:new t.cb(e),u_tl_parent:new t.bL(e),u_scale_parent:new t.bN(e),u_fade_t:new t.bN(e),u_opacity:new t.bN(e),u_image0:new t.bO(e),u_image1:new t.bO(e),u_raster_elevation:new t.bN(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_cutoff_params:new t.bP(e)}),rasterParticleTexture:e=>({u_texture:new t.bO(e),u_opacity:new t.bN(e)}),rasterParticleDraw:e=>({u_tile_offset:new t.bL(e),u_velocity:new t.bO(e),u_color_ramp:new t.bO(e),u_velocity_res:new t.bL(e),u_max_speed:new t.bN(e),u_texture_offset:new t.bL(e),u_data_scale:new t.bP(e),u_data_offset:new t.bN(e)}),rasterParticleUpdate:e=>({u_velocity:new t.bO(e),u_velocity_res:new t.bL(e),u_max_speed:new t.bN(e),u_speed_factor:new t.bN(e),u_lifetime_delta:new t.bN(e),u_rand_seed:new t.bN(e),u_texture_offset:new t.bL(e),u_data_scale:new t.bP(e),u_data_offset:new t.bN(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_camera_forward:new t.bM(e),u_tile_matrix:new t.bK(e),u_up_vector:new t.bM(e),u_ecef_origin:new t.bM(e),u_texture:new t.bO(e),u_icon_transition:new t.bN(e),u_icon_saturation:new t.bN(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_texture:new t.bO(e),u_gamma_scale:new t.bN(e),u_device_pixel_ratio:new t.bN(e),u_tile_id:new t.bM(e),u_zoom_transition:new t.bN(e),u_inv_rot_matrix:new t.bK(e),u_merc_center:new t.bL(e),u_camera_forward:new t.bM(e),u_tile_matrix:new t.bK(e),u_up_vector:new t.bM(e),u_ecef_origin:new t.bM(e),u_is_halo:new t.bO(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new t.bO(e),u_is_size_feature_constant:new t.bO(e),u_size_t:new t.bN(e),u_size:new t.bN(e),u_camera_to_center_distance:new t.bN(e),u_rotate_symbol:new t.bO(e),u_aspect_ratio:new t.bN(e),u_fade_change:new t.bN(e),u_matrix:new t.bK(e),u_label_plane_matrix:new t.bK(e),u_coord_matrix:new t.bK(e),u_is_text:new t.bO(e),u_pitch_with_map:new t.bO(e),u_texsize:new t.bL(e),u_texsize_icon:new t.bL(e),u_texture:new t.bO(e),u_texture_icon:new t.bO(e),u_gamma_scale:new t.bN(e),u_device_pixel_ratio:new t.bN(e),u_is_halo:new t.bO(e)}),background:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_opacity:new t.bN(e),u_color:new t.ca(e)}),backgroundPattern:e=>({u_matrix:new t.bK(e),u_emissive_strength:new t.bN(e),u_opacity:new t.bN(e),u_image:new t.bO(e),u_pattern_tl:new t.bL(e),u_pattern_br:new t.bL(e),u_texsize:new t.bL(e),u_pattern_size:new t.bL(e),u_pixel_coord_upper:new t.bL(e),u_pixel_coord_lower:new t.bL(e),u_tile_units_to_pixels:new t.bN(e)}),terrainRaster:nn,terrainDepth:nn,skybox:e=>({u_matrix:new t.bK(e),u_sun_direction:new t.bM(e),u_cubemap:new t.bO(e),u_opacity:new t.bN(e),u_temporal_offset:new t.bN(e)}),skyboxGradient:e=>({u_matrix:new t.bK(e),u_color_ramp:new t.bO(e),u_center_direction:new t.bM(e),u_radius:new t.bN(e),u_opacity:new t.bN(e),u_temporal_offset:new t.bN(e)}),skyboxCapture:e=>({u_matrix_3f:new t.cb(e),u_sun_direction:new t.bM(e),u_sun_intensity:new t.bN(e),u_color_tint_r:new t.bP(e),u_color_tint_m:new t.bP(e),u_luminance:new t.bN(e)}),globeRaster:e=>({u_proj_matrix:new t.bK(e),u_globe_matrix:new t.bK(e),u_normalize_matrix:new t.bK(e),u_merc_matrix:new t.bK(e),u_zoom_transition:new t.bN(e),u_merc_center:new t.bL(e),u_image0:new t.bO(e),u_grid_matrix:new t.cb(e),u_skirt_height:new t.bN(e),u_far_z_cutoff:new t.bN(e),u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_globe_pos:new t.bM(e),u_globe_radius:new t.bN(e),u_viewport:new t.bL(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.bM(e),u_frustum_tr:new t.bM(e),u_frustum_br:new t.bM(e),u_frustum_bl:new t.bM(e),u_horizon:new t.bN(e),u_transition:new t.bN(e),u_fadeout_range:new t.bN(e),u_color:new t.bP(e),u_high_color:new t.bP(e),u_space_color:new t.bP(e),u_temporal_offset:new t.bN(e),u_horizon_angle:new t.bN(e)}),model:e=>({u_matrix:new t.bK(e),u_lighting_matrix:new t.bK(e),u_normal_matrix:new t.bK(e),u_lightpos:new t.bM(e),u_lightintensity:new t.bN(e),u_lightcolor:new t.bM(e),u_camera_pos:new t.bM(e),u_opacity:new t.bN(e),u_baseColorFactor:new t.bP(e),u_emissiveFactor:new t.bP(e),u_metallicFactor:new t.bN(e),u_roughnessFactor:new t.bN(e),u_baseTextureIsAlpha:new t.bO(e),u_alphaMask:new t.bO(e),u_alphaCutoff:new t.bN(e),u_baseColorTexture:new t.bO(e),u_metallicRoughnessTexture:new t.bO(e),u_normalTexture:new t.bO(e),u_occlusionTexture:new t.bO(e),u_emissionTexture:new t.bO(e),u_color_mix:new t.bP(e),u_aoIntensity:new t.bN(e),u_emissive_strength:new t.bN(e),u_occlusionTextureTransform:new t.bP(e)}),modelDepth:e=>({u_matrix:new t.bK(e),u_instance:new t.bK(e),u_node_matrix:new t.bK(e)}),groundShadow:e=>({u_matrix:new t.bK(e),u_ground_shadow_factor:new t.bM(e)}),stars:e=>({u_matrix:new t.bK(e),u_up:new t.bM(e),u_right:new t.bM(e),u_intensity_multiplier:new t.bN(e)})};let Xn;function Qn(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=e.getOrCreateProgram("collisionBox"),p=[];let d=0,f=0;for(let l=0;l<n.length;l++){const m=n[l],g=i.getTile(m),_=g.getBucket(r);if(!_)continue;const y=Ni(m,_,u);let A=y;0===o[0]&&0===o[1]||(A=e.translatePosMatrix(y,g,o,s));const v=a?_.textCollisionBox:_.iconCollisionBox,x=_.collisionCircleArray;if(x.length>0){const e=t.a6.create(),i=A;t.a6.mul(e,_.placementInvProjMatrix,u.glCoordMatrix),t.a6.mul(e,e,_.placementViewportMatrix),p.push({circleArray:x,circleOffset:f,transform:i,invTransform:e,projection:_.getProjection()}),d+=x.length/4,f=d}v&&(e.terrain&&e.terrain.setupElevationDraw(g,h),h.draw(e,c.LINES,Ie.disabled,Pe.disabled,e.colorModeForRenderPass(),Re.disabled,Pn(A,u,g,_.getProjection()),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,u.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!a||!p.length)return;const m=e.getOrCreateProgram("collisionCircle"),g=new t.cv;g.resize(4*d),g._trim();let _=0;for(const t of p)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];g.emplace(_++,r,n,o,s,0),g.emplace(_++,r,n,o,s,1),g.emplace(_++,r,n,o,s,2),g.emplace(_++,r,n,o,s,3)}(!Xn||Xn.length<2*d)&&(Xn=function(e){const i=2*e,r=new t.aw;r.resize(i),r._trim();for(let t=0;t<i;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(d));const y=l.createIndexBuffer(Xn,!0),A=l.createVertexBuffer(g,t.cw.members,!0);for(const i of p){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(v=u).getCameraToCenterDistance(i.projection),u_viewport_size:[v.width,v.height]};m.draw(e,c.TRIANGLES,Ie.disabled,Pe.disabled,e.colorModeForRenderPass(),Re.disabled,n,r.id,A,y,t.aB.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var v;A.destroy(),y.destroy()}const to=t.a6.create();function eo(e){const i=e._camera.getWorldToCamera(e.worldSize,1),r=t.a6.multiply([],i,e.globeMatrix);t.a6.invert(r,r);const n=[0,0,0],o=[0,1,0,0];return t.a7.transformMat4(o,o,r),n[0]=o[0],n[1]=o[1],n[2]=o[2],t.N.normalize(n,n),n}function io({width:e,height:i,anchor:r,textOffset:n,textScale:o},s){const{horizontalAlign:a,verticalAlign:l}=t.bf(r),c=-(a-.5)*e,u=-(l-.5)*i,h=t.bd(r,n);return new t.P((c/o+h[0])*s,(u/o+h[1])*s)}function ro(e,i,r,n,o,s,a,l,c,u,h){const p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={},g=e.getProjection(),_=Di(l,g,s),y=s.elevation,A=g.upVectorScale(l.canonical,s.center.lat,s.worldSize).metersToTile;d.clear();for(let f=0;f<p.length;f++){const v=p.get(f),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=v,S=v.hidden||!v.crossTileID||e.allowVerticalPlacement&&!v.placedOrientation?null:n[v.crossTileID];if(S){let n=0,p=0,f=0;if(y){const t=y?y.getAtTileOffset(l,x,b):0,[e,i,r]=g.upVector(l.canonical,x,b);n=t*e*A,p=t*i*A,f=t*r*A}let[T,C,M,E]=yi(v.projectedAnchorX+n,v.projectedAnchorY+p,v.projectedAnchorZ+f,r?_:a);const I=Ai(s.getCameraToCenterDistance(g),E);let L=o.evaluateSizeForFeature(e.textSizeData,u,v)*I/t.bc;r&&(L*=e.tilePixelRatio/c);const P=io(S,L);r?(({x:T,y:C,z:M}=g.projectTilePoint(x+P.x,b+P.y,l.canonical)),[T,C,M]=yi(T+n,C+p,M+f,a)):(i&&P._rotate(-s.angle),T+=P.x,C+=P.y,M=0);const k=e.allowVerticalPlacement&&v.placedOrientation===t.b6.vertical?Math.PI/2:0;for(let e=0;e<w;e++)t.b9(d,T,C,M,k);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={x:T,y:C,z:M,angle:k})}else Ei(w,d)}if(h){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e),{numGlyphs:n}=r,o=m[e];if(r.hidden||!o)Ei(n,f);else{const{x:e,y:i,z:r,angle:s}=o;for(let o=0;o<n;o++)t.b9(f,e,i,r,s)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function no(e,i,r,n,o,s,a={}){const l=r.paint.get("icon-translate"),c=r.paint.get("text-translate"),u=r.paint.get("icon-translate-anchor"),h=r.paint.get("text-translate-anchor"),p=r.layout.get("icon-rotation-alignment"),d=r.layout.get("text-rotation-alignment"),f=r.layout.get("icon-pitch-alignment"),m=r.layout.get("text-pitch-alignment"),g=r.layout.get("icon-keep-upright"),_=r.layout.get("text-keep-upright"),y=r.paint.get("icon-color-saturation"),A=e.context,v=A.gl,x=e.transform,b="map"===p,w="map"===d,S="map"===f,T="map"===m,C=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let M=!1;const E=e.depthModeForSublayer(0,Ie.ReadOnly),I=[t.a5(x.center.lng),t.ae(x.center.lat)],L=r.layout.get("text-variable-anchor"),P="globe"===x.projection.name,k=[],N=[0,-1,0];for(const o of n){const n=i.getTile(o),s=n.getBucket(r);if(!s)continue;if("mercator"===s.projection.name&&P)continue;if(s.fullyClipped)continue;const p="globe"===s.projection.name,d=p?t.S(x.zoom):0,f=Di(o,s.getProjection(),x),m=x.calculatePixelsToTileUnitsMatrix(n),A=L&&s.hasTextData(),E=s.hasIconTextFit()&&A&&s.hasIconData(),D=s.getProjection().createInversionMatrix(x,o.canonical),O=()=>{const i=b&&"point"!==r.layout.get("symbol-placement"),a=[],c=i||E,h=r.paint.get("icon-image-cross-fade").constantOr(0);e.terrainRenderModeElevated()&&S&&a.push("PITCH_WITH_MAP_TERRAIN"),p&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),h>0&&a.push("ICON_TRANSITION"),s.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),y<1&&a.push("SATURATION");const _=s.icon.programConfigurations.get(r.id),A=e.getOrCreateProgram(s.sdfIcons?"symbolSDF":"symbolIcon",{config:_,defines:a});let w;const T=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],C=s.iconSizeData,M=t.b5(C,x.zoom),L=S||0!==x.pitch,k=mi(f,n.tileID.canonical,S,b,x,s.getProjection(),m),O=_i(f,n.tileID.canonical,S,b,x,s.getProjection(),m),R=e.translatePosMatrix(O,n,l,u,!0),F=e.translatePosMatrix(f,n,l,u),z=c?to:k,B=b&&!S&&!i;let U=N;!P&&!x.mercatorFromTransition||b||(U=eo(x));const V=p?U:N;w=s.sdfIcons&&!s.iconsInText?Zn(C.kind,M,B,S,e,F,z,R,!1,T,!0,o,d,I,D,V,s.getProjection()):Gn(C.kind,M,B,S,e,F,z,R,!1,T,o,d,I,D,V,s.getProjection(),y,h);const j=n.imageAtlasTexture?n.imageAtlasTexture:null,G=1!==r.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,Z=s.sdfIcons||e.options.rotating||e.options.zooming||G||L?v.LINEAR:v.NEAREST,q=s.sdfIcons&&0!==r.paint.get("icon-halo-width").constantOr(1),W=e.terrain&&S&&i?t.a6.invert(t.a6.create(),k):to;if(i&&s.icon){const t=x.elevation,i=t?t.getAtTileOffsetFunc(o,x.center.lat,x.worldSize,s.getProjection()):null,r=gi(f,n.tileID.canonical,S,b,x,s.getProjection(),m);xi(s,f,e,!1,r,O,S,g,i,o)}return{program:A,buffers:s.icon,uniformValues:w,atlasTexture:j,atlasTextureIcon:null,atlasInterpolation:Z,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:q,tile:n,labelPlaneMatrixInv:W}},R=()=>{const i=w&&"point"!==r.layout.get("symbol-placement"),a=[],l=i||L||E;e.terrainRenderModeElevated()&&T&&a.push("PITCH_WITH_MAP_TERRAIN"),p&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),s.text.zOffsetVertexBuffer&&a.push("Z_OFFSET");const u=s.text.programConfigurations.get(r.id),g=e.getOrCreateProgram(s.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:a});let y,A=[0,0],b=null;const S=s.textSizeData;s.iconsInText&&(A=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],b=n.imageAtlasTexture?n.imageAtlasTexture:null,y=T||0!==x.pitch||e.options.rotating||e.options.zooming||"composite"===S.kind||"camera"===S.kind?v.LINEAR:v.NEAREST);const C=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],M=t.b5(S,x.zoom),k=mi(f,n.tileID.canonical,T,w,x,s.getProjection(),m),O=_i(f,n.tileID.canonical,T,w,x,s.getProjection(),m),R=e.translatePosMatrix(O,n,c,h,!0),F=e.translatePosMatrix(f,n,c,h),z=l?to:k,B=w&&!T&&!i;let U=N;!P&&!x.mercatorFromTransition||w||(U=eo(x));const V=p?U:N;let j;j=s.iconsInText?qn(S.kind,M,B,T,e,F,z,R,C,A,o,d,I,D,V,s.getProjection()):Zn(S.kind,M,B,T,e,F,z,R,!0,C,!0,o,d,I,D,V,s.getProjection());const G=n.glyphAtlasTexture?n.glyphAtlasTexture:null,Z=v.LINEAR,q=0!==r.paint.get("text-halo-width").constantOr(1),W=e.terrain&&T&&i?t.a6.invert(t.a6.create(),k):to;if(i&&s.text){const t=x.elevation,i=t?t.getAtTileOffsetFunc(o,x.center.lat,x.worldSize,s.getProjection()):null,r=gi(f,n.tileID.canonical,T,w,x,s.getProjection(),m);xi(s,f,e,!0,r,O,T,_,i,o)}return{program:g,buffers:s.text,uniformValues:j,atlasTexture:G,atlasTextureIcon:b,atlasInterpolation:Z,atlasInterpolationIcon:y,isSDF:!0,hasHalo:q,tile:n,labelPlaneMatrixInv:W}},F=s.icon.segments.get().length,z=s.text.segments.get().length,B=F&&!a.onlyText?O():null,U=z&&!a.onlyIcons?R():null,V=r.paint.get("icon-opacity").constantOr(1),j=r.paint.get("text-opacity").constantOr(1);if(C&&s.canOverlap){M=!0;const e=V&&!a.onlyText?s.icon.segments.get():[],i=j&&!a.onlyIcons?s.text.segments.get():[];for(const i of e)k.push({segments:new t.aB([i]),sortKey:i.sortKey,state:B});for(const e of i)k.push({segments:new t.aB([e]),sortKey:e.sortKey,state:U})}else a.onlyText||k.push({segments:V?s.icon.segments:new t.aB([]),sortKey:0,state:B}),a.onlyIcons||k.push({segments:j?s.text.segments:new t.aB([]),sortKey:0,state:U})}M&&k.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of k){const i=t.state;if(i)if(e.terrain&&e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:x.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),A.activeTexture.set(v.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,v.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(A.activeTexture.set(v.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,v.CLAMP_TO_EDGE,!0)),e.uploadCommonLightUniforms(e.context,i.program),i.hasHalo){const n=i.uniformValues;n.u_is_halo=1,oo(i.buffers,t.segments,r,e,i.program,E,o,s,n,2),n.u_is_halo=0}else{if(i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,oo(i.buffers,t.segments,r,e,i.program,E,o,s,n,1)),n.u_is_halo=0}oo(i.buffers,t.segments,r,e,i.program,E,o,s,i.uniformValues,1)}}}function oo(t,e,i,r,n,o,s,a,l,c){const u=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,o,s,a,Re.disabled,l,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),u,c)}function so(t,e,i,r,n,o,s){const a=t.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let u,h,p,d,f;s?(h=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",u=a.LINES):(h=c?"fillPattern":"fill",u=a.TRIANGLES);for(const m of r){const r=e.getTile(m);if(c&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;t.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=t.isTileAffectedByFog(m),A=t.getOrCreateProgram(h,{config:_,overrideFog:y});c&&(t.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_.updatePaintBuffers());const v=l.constantOr(null);if(v&&r.imageAtlas){const t=r.imageAtlas.patternPositions[v.toString()];t&&_.setConstantPatternPositions(t)}const x=t.translatePosMatrix(m.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),b=i.paint.get("fill-emissive-strength");if(s){d=g.indexBuffer2,f=g.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];p="fillOutlinePattern"===h&&c?Ln(x,b,t,r,e):In(x,b,e)}else d=g.indexBuffer,f=g.segments,p=c?En(x,b,t,r):Mn(x,b);t.uploadCommonUniforms(t.context,A,m.toUnwrapped()),A.draw(t,u,n,t.stencilModeForClipping(m),o,Re.disabled,p,i.id,g.layoutVertexBuffer,d,f,i.paint,t.transform.zoom,_,void 0)}}function ao(e,i,r,n,o,s,a,l){r.resetLayerRenderingStats(e);const c=e.context,u=c.gl,h=e.transform,p=r.paint.get("fill-extrusion-pattern"),d=p.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),m=e.style.enable3dLights(),g=r.paint.get(m&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=r.layout.get("fill-extrusion-edge-radius"),A=y>0&&!r.paint.get("fill-extrusion-rounded-roof"),v=A?0:y,x="globe"===h.projection.name?t.cF():0,b="globe"===h.projection.name,w=b?t.S(h.zoom):0,S=[t.a5(h.center.lng),t.ae(h.center.lat)],T=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),C=r.paint.get("fill-extrusion-flood-light-intensity"),M=r.paint.get("fill-extrusion-vertical-scale"),E=_r(e,r.paint.get("fill-extrusion-cutoff-fade-range")),I=r.paint.get("fill-extrusion-emissive-strength"),L=[];let P;b&&L.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&L.push("FAUX_AO"),A&&L.push("ZERO_ROOF_RADIUS"),l&&L.push("HAS_CENTROID"),C>0&&L.push("FLOOD_LIGHT"),E.shouldRenderCutoff&&L.push("RENDER_CUTOFF");const k="shadow"===e.renderPass,N=e.shadowRenderer,D=k&&!!N;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let O=[0,0,0];if(N){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(O=Sr(t,i)),P=L.concat(["SHADOWS_SINGLE_CASCADE"])}const R=D?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion",F=r.getLayerRenderingStats();for(const t of n){const n=i.getTile(t),m=n.getBucket(r);if(!m||m.projection.name!==h.projection.name)continue;let g=!1;N&&(g=0===N.getMaxCascadeForTile(t.toUnwrapped()));const y=e.isTileAffectedByFog(t),A=m.programConfigurations.get(r.id),D=e.getOrCreateProgram(R,{config:A,defines:g?P:L,overrideFog:y});if(e.terrain&&e.terrain.setupElevationDraw(n,D,{useMeterToDem:!0}),!m.centroidVertexBuffer){const t=D.attributes.a_centroid_pos;void 0!==t&&u.vertexAttrib2f(t,0,0)}!k&&N&&N.setupShadows(n.tileID.toUnwrapped(),D,"vector-tile",n.tileID.overscaledZ),d&&(e.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),A.updatePaintBuffers());const z=p.constantOr(null);if(z&&n.imageAtlas){const t=n.imageAtlas.patternPositions[z.toString()];t&&A.setConstantPatternPositions(t)}const B=r.paint.get("fill-extrusion-vertical-gradient");let U;if(k&&N){if(fo(n.tileID,m,e))continue;const t=N.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());U=Tn(t,v,M)}else{const i=e.translatePosMatrix(t.expandedProjMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),o=h.projection.createInversionMatrix(h,t.canonical);U=d?Cn(i,e,B,f,_,v,t,n,x,w,S,o,T,M):Sn(i,e,B,f,_,v,t,x,w,S,o,T,M,C,O,I)}e.uploadCommonUniforms(c,D,t.toUnwrapped(),null,E);let V=m.segments;if("mercator"===h.projection.name&&!k&&(V=m.getVisibleSegments(n.tileID,e.terrain,e.transform.getFrustum(0)),!V.get().length))continue;if(F)if(k)for(const t of V.get())F.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of V.get())F.numRenderedVerticesInTransparentPass+=t.primitiveLength;const j=[];(e.terrain||l)&&j.push(m.centroidVertexBuffer),b&&j.push(m.layoutVertexExtBuffer),D.draw(e,c.gl.TRIANGLES,o,s,a,Re.backCCW,U,r.id,m.layoutVertexBuffer,m.indexBuffer,V,r.paint,e.transform.zoom,A,j)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function lo(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A){const v=e.context,x=v.gl,b=e.transform,w=e.transform.zoom,S=[],T=_r(e,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(S.push("CLEAR_SUBPASS"),A&&(S.push("CLEAR_FROM_TEXTURE"),v.activeTexture.set(x.TEXTURE0),A.bind(x.LINEAR,x.CLAMP_TO_EDGE))):"sdf"===u&&S.push("SDF_SUBPASS"),_&&S.push("HAS_CENTROID"),T.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const C=r.layout.get("fill-extrusion-edge-radius"),M=(t,i,n,u,y)=>{const x=i.programConfigurations.get(r.id),b=e.isTileAffectedByFog(t),M=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:x,defines:S,overrideFog:b}),E=((t,e,i,r,n,o,s,a,l,c,u)=>({u_matrix:e,u_opacity:i,u_ao_pass:r?1:0,u_meter_to_tile:n,u_ao:o,u_flood_light_intensity:s,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,h,c,y,[p,d*y],f,m,g,w>=17?0:C*y,A?A.size[0]:0),I=[];_&&I.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(v,M,t.toUnwrapped(),null,T),M.draw(e,v.gl.TRIANGLES,o,s,a,l,E,r.id,i.vertexBuffer,i.indexBuffer,n,r.paint,w,x,I)};for(const o of n){const n=i.getTile(o),s=n.getBucket(r);if(!s||s.projection.name!==b.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;const a=s.groundEffect,l=1/s.tileToMeter;{const t=e.translatePosMatrix(o.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=a.getDefaultSegment();M(o,a,i,t,l)}if(y)for(let s=0;s<4;s++){const a=t.cG[s](o),c=i.getTile(a);if(!c)continue;const u=c.getBucket(r);if(!u||u.projection.name!==b.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const h=u.groundEffect;let p,d;0===s?(p=[-t.V,0,0],d=1):1===s?(p=[t.V,0,0],d=0):2===s?(p=[0,-t.V,0],d=3):(p=[0,t.V,0],d=2);const f=h.regionSegments[d];if(!f)continue;const m=new Float32Array(16);t.a6.translate(m,o.projMatrix,p),M(o,h,f,e.translatePosMatrix(m,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),l)}}}function co(e,i,r,n,o,s,a){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=s?s.findDEMTileFor(r):null;if(!(l&&l.dem||a))return;const c=e=>new t.P(Math.ceil((e+t.cJ)*t.cK),0),u=t=>{const e=i.getSource().minzoom,r=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},n=[0,-1,1];for(const i of n){if(t.overscaledZ+i<e)continue;const n=r(t.calculateScaledKey(t.overscaledZ+i));if(n)return n}},h=[0,0,0],p=(e,i)=>(h[0]=Math.min(e.min.y,i.min.y),h[1]=Math.max(e.max.y,i.max.y),h[2]=t.V-i.min.x>e.max.x?i.min.x-t.V:e.max.x,h),d=(e,i)=>(h[0]=Math.min(e.min.x,i.min.x),h[1]=Math.max(e.max.x,i.max.x),h[2]=t.V-i.min.y>e.max.y?i.min.y-t.V:e.max.y,h),f=[(t,e)=>p(t,e),(t,e)=>p(e,t),(t,e)=>d(t,e),(t,e)=>d(e,t)],m=(e,i,n,o,a,c,u)=>{if(!s)return 0;const h=[[c?n:e,c?e:n,0],[c?n:i,c?i:n,0]],p=u<0?t.V+u:u,d=[c?p:(e+i)/2,c?(e+i)/2:p,0];return 0===n&&u<0||0!==n&&u>0?s.getForTilePoints(a,[d],!0,o):h.push(d),s.getForTilePoints(r,h,!0,l),Math.max(h[0][2],h[1][2],d[2])/s.exaggeration()};for(let e=0;e<4;e++){const i=n.borderFeatureIndices[e];if(0===i.length)continue;const o=t.cG[e](r),l=u(o);if(!(l&&l instanceof t.cH))continue;if(n.borderDoneWithNeighborZ[e]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const h=s?s.findDEMTileFor(o):null;if(!(h&&h.dem||a))continue;const p=(e<2?1:5)-e,d=l.borderDoneWithNeighborZ[p]!==n.canonical.z,y=l.borderFeatureIndices[p];let A=0;if(n.canonical.z!==l.canonical.z){for(const t of i)n.showCentroid(n.featuresOnBorder[t]);if(d)for(const t of y)l.showCentroid(l.featuresOnBorder[t]);n.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[p]=n.canonical.z}for(const r of i){const i=n.featuresOnBorder[r],s=n.centroidData[i.centroidDataIndex],u=i.borders[e];let d;for(;A<y.length;){d=l.featuresOnBorder[y[A]];const t=d.borders[p];if(t[1]>u[0]+3||t[0]>u[0]-3)break;l.showCentroid(d),A++}if(d&&A<y.length){const r=A;let v=0;for(;!(d.borders[p][0]>u[1]-3)&&(v++,++A!==y.length);)d=l.featuresOnBorder[y[A]];if(d=l.featuresOnBorder[y[r]],v>1){const t=d.borders[p];Math.abs(u[0]-t[0])<3&&Math.abs(u[1]-t[1])<3&&(v=1,A=r+1)}else if(0===v){n.showCentroid(i);continue}const x=l.centroidData[d.centroidDataIndex];a&&1===v&&(((g=s).flags|(_=x).flags)&t.cI?(g.flags|=t.cI,_.flags|=t.cI):(g.flags&=~t.cI,_.flags&=~t.cI));const b=i.intersectsCount()>1||d.intersectsCount()>1;if(v>1)A=r,s.centroidXY=x.centroidXY=new t.P(0,0);else if(h&&h.dem&&!b){const i=f[e](s,x),r=e%2?t.V-1:0,n=m(i[0],Math.min(t.V-1,i[1]),r,h,o,e<2,i[2]);s.centroidXY=x.centroidXY=c(n)}else b?s.centroidXY=x.centroidXY=new t.P(0,0):(s.centroidXY=n.encodeBorderCentroid(i),x.centroidXY=l.encodeBorderCentroid(d));n.writeCentroidToBuffer(s),l.writeCentroidToBuffer(x)}else n.showCentroid(i)}n.borderDoneWithNeighborZ[e]=l.canonical.z,l.borderDoneWithNeighborZ[p]=n.canonical.z}var g,_;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(e)}const uo=[1,0,0],ho=[0,1,0],po=[0,0,1];function fo(e,i,r){const n=r.transform,o=r.shadowRenderer;if(!o)return!0;const s=e.toUnwrapped(),a=n.tileSize*o._cascades[r.currentShadowCascade].scale;let l=i.maxHeight;if(n.elevation){const t=n.elevation.getMinMaxForTile(e);t&&(l+=t.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(s,l,a,c);if(!u)return!1;const h=[uo,ho,po,c,[c[0],0,c[2]],[0,c[1],c[2]]],p="globe"===n.projection.name,d=n.scaleZoom(a),f=t.bq.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,d,!p),m=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,h)||0===m.intersectsPrecise(u.vertices,u.planes,h)}function mo(e){return[e[0]*t.cL,e[1]*t.cL,e[2]*t.cL,0]}function go(e,i,r,n,o,s,a,l,c){const u=n.getSource(),h=r.globeSharedBuffers;if(!h)return;let p,d,f;if(i&&(p=n.getTile(i)),u instanceof t.ap?(d=u.texture,f=t.cj(0,0,r.transform)):p&&i&&(d=p.texture,f=t.cj(i.canonical.z,i.canonical.x,r.transform)),!d||!f)return;e||(f=t.a6.scale(t.a6.create(),f,[1,-1,1]));const m=r.context,g=m.gl,_="nearest"===o.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=r.colorModeForDrapableLayerRenderPass(s),A=a.defines;A.push("GLOBE_POLES");const v=new Ie(g.LEQUAL,Ie.ReadWrite,r.depthRangeFor3D),x=Float32Array.from(r.transform.expandedFarZProjMatrix),b=Float32Array.from(t.aT(t.ci(new t.bs(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),d.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),d.bind(_,g.CLAMP_TO_EDGE),d.useMipmap&&m.extTextureFilterAnisotropic&&r.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[w,S,T,C]=i?h.getPoleBuffers(i.canonical.z,!1):h.getPoleBuffers(0,!0),M=o.paint.get("raster-elevation");let E;e?(E=w,r.renderDefaultNorthPole=0!==M):(E=S,r.renderDefaultSouthPole=0!==M);const I=mo(a.mix),L=((t,e,i,r,n,o,s,a,l,c,u,h,p)=>Fn(t,e,i,new Float32Array(16),new Float32Array(9),[0,0],r,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,a,2,c,u,h,1,0,p))(x,b,f,t.S(r.transform.zoom),0,o,0,M,0,I,a.offset,a.range,s),P=r.getOrCreateProgram("raster",{defines:A});r.uploadCommonUniforms(m,P,null),P.draw(r,g.TRIANGLES,v,c,y,l,L,o.id,E,T,C)}function _o(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),r=i-e,n=.2*t.height,o=e+n;return[e,i,(o-n-e)/r,(o-e)/r]}function yo(t,e,i,r){if(t)return e instanceof Dt&&t instanceof Je?e.getTextureDescriptor(t,i,!0):{texture:t.texture,mix:mo(r.mix),offset:r.offset,buffer:0,tileSize:1}}function Ao(e,i,r){if(!e)return null;const n=i.getTextureDescriptor(e,r,!0);if(!n)return null;let{texture:o,mix:s,offset:a,tileSize:l,buffer:c,format:u}=n;if(!o||!u)return null;let h=!1;return"uint32"===u&&(h=!0,s[3]=0,s=On(t.cM,s,[0,r.paint.get("raster-particle-max-speed")]),a=Rn(t.cM,a,[0,r.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:h,scale:s,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function vo(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),r=i-e,n=.2*t.height,o=e+n;return[e,i,(o-n-e)/r,(o-e)/r]}const xo=new t.ax(1,0,0,1),bo=new t.ax(0,1,0,1),wo=new t.ax(0,0,1,1),So=new t.ax(1,0,1,1),To=new t.ax(0,1,1,1);function Co(e,i,r,n,o,s,a){const l=e.context,c=e.transform,u=l.gl,h="globe"===c.projection.name,p=h?["PROJECTION_GLOBE_VIEW"]:[];let d=t.a6.clone(r.projMatrix);if(h&&t.S(c.zoom)>0){const e=t.aS(r.canonical,c),i=t.cN(e);d=t.a6.multiply(new Float32Array(16),c.globeMatrix,i),t.a6.multiply(d,c.projMatrix,d)}const f=t.a6.create();f[12]+=2*o/(t.f.devicePixelRatio*c.width),f[13]+=2*s/(t.f.devicePixelRatio*c.height),t.a6.multiply(d,f,d);const m=e.getOrCreateProgram("debug",{defines:p}),g=i.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(g,m);const _=Ie.disabled,y=Pe.disabled,A=e.colorModeForRenderPass(),v="$debug";l.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),h?g._makeGlobeTileDebugBuffers(e.context,c):g._makeDebugTileBoundsBuffers(e.context,c.projection);const x=g._tileDebugBuffer||e.debugBuffer,b=g._tileDebugIndexBuffer||e.debugIndexBuffer,w=g._tileDebugSegments||e.debugSegments;if(m.draw(e,u.LINE_STRIP,_,y,A,Re.disabled,kn(d,n),v,x,b,w,null,null,null,[g._globeTileDebugBorderBuffer]),a){const t=g.latestRawTileData,i=Math.floor((t&&t.byteLength||0)/1024);let n=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(n+=` => ${r.overscaledZ}`),n+=` ${g.state}`,n+=` ${i}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,n)}const S=i.getTile(r).tileSize,T=512/Math.min(S,512)*(r.overscaledZ/c.zoom)*.5,C=g._tileDebugTextBuffer||e.debugBuffer,M=g._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,E=g._tileDebugTextSegments||e.debugSegments;m.draw(e,u.TRIANGLES,_,y,Ne.alphaBlended,Re.disabled,kn(d,t.ax.transparent,T),v,C,M,E,null,null,null,[g._globeTileDebugTextBuffer])}function Mo(t,e,i,r){Io(t,0,e+i/2,t.transform.width,i,r)}function Eo(t,e,i,r){Io(t,e-i/2,0,i,t.transform.height,r)}function Io(e,i,r,n,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.f.devicePixelRatio,r*t.f.devicePixelRatio,n*t.f.devicePixelRatio,o*t.f.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}const Lo=t.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Po}=Lo;function ko(t,e,i,r){t.emplaceBack(e,i,r)}class No{constructor(e){this.vertexArray=new t.az,this.indices=new t.aw,ko(this.vertexArray,-1,-1,1),ko(this.vertexArray,1,-1,1),ko(this.vertexArray,-1,1,1),ko(this.vertexArray,1,1,1),ko(this.vertexArray,-1,-1,-1),ko(this.vertexArray,1,-1,-1),ko(this.vertexArray,-1,1,-1),ko(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Po),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.aB.simpleSegment(0,0,36,12)}}function Do(e,i,r,n,o,s){const a=e.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,r,n)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(t.co.fromMat4(t.co.create(),n),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),r.draw(e,a.TRIANGLES,Ie.disabled,Pe.disabled,Ne.unblended,Re.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Oo=t.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ro{constructor(e){const i=new t.cO;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new t.aw;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,Oo.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=t.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Fo=t.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class zo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Bo{constructor(e){this.colorModeAlphaBlendedWriteRGB=new Ne([1,ke,1,ke],t.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ne([1,0,1,0],t.ax.transparent,[!1,!1,!1,!0]),this.params=new zo,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(e){const i=e.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ro(i);const e=this.params.sizeRange,r=this.params.intensityRange,n=function(e){const i=t.aA(30),r=[];for(let n=0;n<e;++n){const e=2*Math.PI*i(),n=Math.acos(1-2*i())-.5*Math.PI;r.push(t.N.fromValues(Math.cos(n)*Math.cos(e),Math.cos(n)*Math.sin(e),Math.sin(n)))}return r}(this.params.starsCount),o=t.aA(300),s=new t.cP,a=new t.aw;let l=0;for(let i=0;i<n.length;++i){const c=t.N.scale([],n[i],200),u=Math.max(0,1+.01*e*(1*o()-.5)),h=Math.max(0,1+.01*r*(1*o()-.5));s.emplaceBack(c[0],c[1],c[2],-1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,-1,u,h),s.emplaceBack(c[0],c[1],c[2],1,1,u,h),s.emplaceBack(c[0],c[1],c[2],-1,1,u,h),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(s,Fo.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=t.aB.simpleSegment(0,0,s.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const r=e.context,n=r.gl,o=e.transform,s=new Ie(n.LEQUAL,Ie.ReadOnly,[0,1]),a=t.S(o.zoom),l=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),u=i.properties.get("space-color").toArray01PremultipliedAlpha(),h=5e-4,p=t.cQ(i.properties.get("horizon-blend"),0,1,h,.25),d=t.cd(e,r,o)&&p===h?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,f=e.frameCounter/1e3%1,m=t.N.length(o.globeCenterInViewSpace),g=Math.sqrt(Math.pow(m,2)-Math.pow(d,2)),_=Math.acos(g/m),y=t=>{const i="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];t&&i.push("ALPHA_PASS");const h=e.getOrCreateProgram("globeAtmosphere",{defines:i}),d=((t,e,i,r,n,o,s,a,l,c,u,h)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:i,u_frustum_bl:r,u_horizon:n,u_transition:o,u_fadeout_range:s,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:u,u_horizon_angle:h}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,p,l,c,u,f,_);e.uploadCommonUniforms(r,h);const m=this.atmosphereBuffer;m&&h.draw(e,n.TRIANGLES,s,Pe.disabled,t?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Re.backCW,d,t?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(e,i){const r=t.aa(i.properties.get("star-intensity"),0,1);if(0===r)return;const n=e.context,o=n.gl,s=e.transform,a=e.getOrCreateProgram("stars"),l=t.bi.identity([]);t.bi.rotateX(l,l,-s._pitch),t.bi.rotateZ(l,l,-s.angle),t.bi.rotateX(l,l,t.bj(s._center.lat)),t.bi.rotateY(l,l,-t.bj(s._center.lng));const c=t.a6.fromQuat(new Float32Array(16),l),u=t.a6.multiply([],s.starsProjMatrix,c),h=t.co.fromMat4([],c),p=t.co.invert([],h),d=[0,1,0];t.N.transformMat3(d,d,p),t.N.scale(d,d,this.params.sizeMultiplier);const f=[1,0,0];t.N.transformMat3(f,f,p),t.N.scale(f,f,this.params.sizeMultiplier);const m=(g=d,_=f,y=r,{u_matrix:Float32Array.from(u),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;e.uploadCommonUniforms(n,a),this.starsVx&&this.starsIdx&&a.draw(e,o.TRIANGLES,Ie.disabled,Pe.disabled,this.colorModeAlphaBlendedWriteRGB,Re.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Uo(e,i){const r=[...e],n=i.cameraWorldSizeForFog/i.worldSize,o=t.a6.identity([]);return t.a6.scale(o,o,[n,n,1]),t.a6.multiply(r,o,r),t.a6.multiply(r,i.worldToFogMatrix,r),r}function Vo(t,e,i,r){const n=i.material,o=r.context,{baseColorTexture:s,metallicRoughnessTexture:a}=n.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:u}=n;function h(e,i,r){if(e&&(t.push(i),o.activeTexture.set(o.gl.TEXTURE0+r),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:r,wrapT:n}=e.sampler;e.gfxTexture.bindExtraParam(t,i,r,n)}}h(s,"HAS_TEXTURE_u_baseColorTexture",gr.BaseColor),h(a,"HAS_TEXTURE_u_metallicRoughnessTexture",gr.MetallicRoughness),h(l,"HAS_TEXTURE_u_normalTexture",gr.Normal),h(c,"HAS_TEXTURE_u_occlusionTexture",gr.Occlusion),h(u,"HAS_TEXTURE_u_emissionTexture",gr.Emission),i.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(i.texcoordBuffer)),i.colorBuffer&&(t.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(i.colorBuffer)),i.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(i.normalBuffer)),i.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(i.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function jo(e,i,r,n,o,s){const a=r.paint.get("model-opacity"),l=i.context,c=new Ie(i.context.gl.LEQUAL,Ie.ReadWrite,i.depthRangeFor3D),u=i.transform,h=e.mesh,p=h.material,d=p.pbrMetallicRoughness,f=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:t.a6.multiply([],n.zScaleMatrix,e.nodeModelMatrix),t.a6.multiply(m,n.negCameraPosMatrix,m);const g=t.a6.invert([],m);t.a6.transpose(g,g);const _=r.paint.get("model-emissive-strength").constantOr(0),y=Jn(new Float32Array(e.worldViewProjection),new Float32Array(m),new Float32Array(g),i,a,d.baseColorFactor,p.emissiveFactor,d.metallicFactor,d.roughnessFactor,p,_,r),A={defines:[]},v=[];Vo(A.defines,v,h,i);const x=i.shadowRenderer;x&&(x.useNormalOffset=!1);let b=null;if(f){const t=Uo(e.nodeModelMatrix,i.transform);if(b=new Float32Array(t),"globe"!==u.projection.name){const e=h.aabb.min,i=h.aabb.max,[r,n]=f.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);A.overrideFog=r>=gt||n>=gt}}const w=_r(i,r.paint.get("model-cutoff-fade-range"));w.shouldRenderCutoff&&A.defines.push("RENDER_CUTOFF");const S=i.getOrCreateProgram("model",A);i.uploadCommonUniforms(l,S,null,b,w),"shadow"!==i.renderPass&&x&&x.setupShadowsFromMatrix(e.nodeModelMatrix,S),S.draw(i,l.gl.TRIANGLES,c,o,s,h.material.doubleSided?Re.disabled:Re.backCCW,y,r.id,h.vertexBuffer,h.indexBuffer,h.segments,r.paint,i.transform.zoom,void 0,v)}function Go(e,i,r,n,o,s,a){let l;l="globe"===e.projection.name?t.cS(r,e):[...r],t.a6.multiply(l,l,i.matrix);const c=t.a6.multiply([],n,l);if(i.meshes)for(const e of i.meshes){if("BLEND"!==e.material.alphaMode){a.push({mesh:e,depth:0,modelIndex:o,worldViewProjection:c,nodeModelMatrix:l});continue}const i=t.N.transformMat4([],e.centroid,c);i[2]>0&&s.push({mesh:e,depth:i[2],modelIndex:o,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const t of i.children)Go(e,t,r,n,o,s,a)}function Zo(t,e,i,r){const n=i.shadowRenderer;if(!n)return;const o=n.getShadowPassDepthMode(),s=n.getShadowPassColorMode(),a=n.calculateShadowPassMatrixFromMatrix(e),l=$n(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,o,Pe.disabled,s,Re.backCCW,l,r.id,t.vertexBuffer,t.indexBuffer,t.segments,r.paint,i.transform.zoom,void 0,void 0)}function qo(e,i,r){const n=i.updateZoomBasedPaintProperties(),o=function(e,i,r){let n,o,s,a=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&a>0){const i=e.terrain,o=i.findDEMTileFor(r);o&&o.dem?n=t.cU.create(i,r,o):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||n&&n._demTile&&n._demTile.tileID===i.validForDEMTile.id&&n._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const t in i.instancesPerModel){const e=i.instancesPerModel[t];for(let t=0;t<e.instancedDataArray.length;++t){const r=(n?a*n.getElevationAt(0|e.instancedDataArray.float32[16*t],0|e.instancedDataArray.float32[16*t+1],!0,!0):0)+e.instancesEvaluatedElevation[t];e.instancedDataArray.float32[16*t+6]=r,o=o?Math.min(i.terrainElevationMin,r):r,s=s?Math.max(i.terrainElevationMax,r):r}}return i.terrainElevationMin=o||0,i.terrainElevationMax=s||0,i.validForExaggeration=a,i.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,i,r);(n||o)&&(i.uploaded=!1,i.upload(e.context))}const Wo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.bS([0,0,0],[t.V,t.V,0])};function Ho(e,i){const r=1<<e.canonical.z,n=i.getFreeCameraOptions().position,o=i.elevation,s=e.canonical.x/r,a=(e.canonical.x+1)/r,l=e.canonical.y/r,c=(e.canonical.y+1)/r;let u=i._centerAltitude;if(o){const t=o.getMinMaxForTile(e);t&&t.max>u&&(u=t.max)}const h=t.aa(n.x,s,a)-n.x,p=t.aa(n.y,l,c)-n.y,d=t.bl(u,i.center.lat)-n.z;return i._zoomFromMercatorZ(Math.sqrt(h*h+p*p+d*d))}function Jo(t,e,i,r,n,o,s){const a=t.context,l="shadow"===t.renderPass,c=t.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Ie(a.gl.LEQUAL,Ie.ReadWrite,t.depthRangeFor3D),h=t.isTileAffectedByFog(o);if(i.meshes)for(const p of i.meshes){const d=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;r.instancedDataArray.length>20&&d.push("INSTANCED_ARRAYS");const y=_r(t,e.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&d.push("RENDER_CUTOFF"),l&&c)m=t.getOrCreateProgram("modelDepth",{defines:d}),g=$n(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(i.matrix)),_=c.getShadowPassColorMode();else{Vo(d,f,p,t),m=t.getOrCreateProgram("model",{defines:d,overrideFog:h});const r=p.material,l=r.pbrMetallicRoughness,u=e.paint.get("model-opacity"),A=e.paint.get("model-emissive-strength").constantOr(0);g=Jn(o.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),t,u,l.baseColorFactor,r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,A,e,n),c&&(s.shadowUniformsInitialized?m.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||u<1||"OPAQUE"!==r.alphaMode?Ne.alphaBlended:Ne.unblended}t.uploadCommonUniforms(a,m,o.toUnwrapped(),null,y);const A=p.material.doubleSided?Re.disabled:Re.backCCW;if(r.instancedDataArray.length>20)f.push(r.instancedDataBuffer),m.draw(t,a.gl.TRIANGLES,u,Pe.disabled,_,A,g,e.id,p.vertexBuffer,p.indexBuffer,p.segments,e.paint,t.transform.zoom,void 0,f,r.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let n=0;n<r.instancedDataArray.length;++n)g[i]=new Float32Array(r.instancedDataArray.arrayBuffer,64*n,16),m.draw(t,a.gl.TRIANGLES,u,Pe.disabled,_,A,g,e.id,p.vertexBuffer,p.indexBuffer,p.segments,e.paint,t.transform.zoom,void 0,f)}}if(i.children)for(const a of i.children)Jo(t,e,a,r,n,o,s)}const Ko=[1,-1,1];function $o(e,i,r,n){if(!r.modelManager)return!0;const o=r.modelManager;if(!r.shadowRenderer)return!0;const s=r.shadowRenderer,a=i.aabb;let l=!0,c=e.maxHeight;if(0===c){let t=0;for(const i in e.instancesPerModel){const e=o.getModel(i,n);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):l=!1}c=e.maxScale*t*1.41+e.maxVerticalOffset,l&&(e.maxHeight=c)}a.max[2]=c,a.min[2]+=e.terrainElevationMin,a.max[2]+=e.terrainElevationMax,t.N.transformMat4(a.min,a.min,i.tileMatrix),t.N.transformMat4(a.max,a.max,i.tileMatrix);const u=a.intersects(s.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===u),0===u}class Yo{}class Xo{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,r){{const t=this._storage.get(i.id);if(t)return t.lastUsedFrameIdx=e,t.buf}const n=r.gl,o=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const l=new t.cW;for(let t=0;t<o/2;t+=3){const e=a[t],i=a[t+1],r=a[t+2];l.emplaceBack(e,i),l.emplaceBack(i,r),l.emplaceBack(r,e)}const c=r.bindVertexArrayOES.current,u=new Yo;return u.buf=new jt(r,l),u.lastUsedFrameIdx=e,this._storage.set(i.id,u),r.bindVertexArrayOES.set(c),u.buf}update(t){for(const[e,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}class Qo{registerParameter(t,e,i,r,n){}registerButton(t,e,i){}}const ts={symbol:function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const s=Pe.disabled,a=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,i,r,n,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of e){const e=n.getTile(i),o=e.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const s=t.b5(o.textSizeData,l.zoom),h=Di(i,o.getProjection(),l),p=l.calculatePixelsToTileUnitsMatrix(e),d=mi(h,e.tileID.canonical,u,c,l,o.getProjection(),p),f=o.hasIconTextFit()&&o.hasIconData();if(s){const r=Math.pow(2,l.zoom-e.tileID.overscaledZ);ro(o,c,u,a,t.cx,l,d,i,r,s,f)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o);const l=0!==r.paint.get("icon-opacity").constantOr(1),c=0!==r.paint.get("text-opacity").constantOr(1);void 0!==r.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?no(e,i,r,n,s,a):(l&&no(e,i,r,n,s,a,{onlyIcons:!0}),c&&no(e,i,r,n,s,a,{onlyText:!0})),i.map.showCollisionBoxes&&(Qn(e,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Qn(e,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1),c=r.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const u=e.context,h=u.gl,p=e.transform,d=e.depthModeForSublayer(0,Ie.ReadOnly),f=Pe.disabled,m=e.colorModeForDrapableLayerRenderPass(c),g="globe"===p.projection.name,_=[t.a5(p.center.lng),t.ae(p.center.lat)],y=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c||c.projection.name!==p.projection.name)continue;const u=c.programConfigurations.get(r.id),h=t.cy(r),d=e.isTileAffectedByFog(s);g&&h.push("PROJECTION_GLOBE_VIEW");const f=e.getOrCreateProgram("circle",{config:u,defines:h,overrideFog:d}),m=c.layoutVertexBuffer,A=c.globeExtVertexBuffer,v=c.indexBuffer,x=p.projection.createInversionMatrix(p,s.canonical),b={programConfiguration:u,program:f,layoutVertexBuffer:m,globeExtVertexBuffer:A,indexBuffer:v,uniformValues:t.cz(e,s,a,x,_,r),tile:a};if(l){const e=c.segments.get();for(const i of e)y.push({segments:new t.aB([i]),sortKey:i.sortKey,state:b})}else y.push({segments:c.segments,sortKey:0,state:b})}l&&y.sort(((t,e)=>t.sortKey-e.sortKey));const A={useDepthForOcclusion:p.depthOcclusionForSymbolsAndCircles};for(const t of y){const{programConfiguration:i,program:n,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:l,tile:c}=t.state,g=t.segments;e.terrain&&e.terrain.setupElevationDraw(c,n,A),e.uploadCommonUniforms(u,n,c.tileID.toUnwrapped()),n.draw(e,h.TRIANGLES,d,f,m,Re.disabled,l,r.id,o,a,g,r.paint,p.zoom,i,[s])}},heatmap:function(e,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=Pe.disabled,l=new Ne([s.ONE,s.ONE,s.ONE,s.ONE],t.ax.transparent,[!0,!0,!0,!0]);!function(t,e,i,r){const n=t.gl,o=e.width*r,s=e.height*r;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=i.heatmapFbo=t.createFramebuffer(o,s,!0,null),function(t,e,i,r,n,o){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?s.RGBA16F:s.RGBA,n,o,0,s.RGBA,t.extRenderToTextureHalfFloat?s.HALF_FLOAT:s.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(t,0,e,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(o,e,r,"globe"===e.transform.projection.name?.5:.25),o.clear({color:t.ax.transparent});const c=e.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:[],p=u?Re.frontCCW:Re.disabled,d=[t.a5(c.center.lng),t.ae(c.center.lat)];for(let t=0;t<n.length;t++){const f=n[t];if(i.hasRenderableParent(f))continue;const m=i.getTile(f),g=m.getBucket(r);if(!g||g.projection.name!==c.projection.name)continue;const _=e.isTileAffectedByFog(f),y=g.programConfigurations.get(r.id),A=e.getOrCreateProgram("heatmap",{config:y,defines:h,overrideFog:_}),{zoom:v}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,A),e.uploadCommonUniforms(o,A,f.toUnwrapped());const x=c.projection.createInversionMatrix(c,f.canonical);A.draw(e,s.TRIANGLES,Ie.disabled,a,l,p,Dn(e,f,m,x,d,v,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,e.transform.zoom,y,u?[g.globeExtVertexBuffer]:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const r=e.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new t.T(r,i.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,n.TRIANGLES,Ie.disabled,Pe.disabled,e.colorModeForRenderPass(),Re.disabled,((t,e,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,r))},line:function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=r.paint.get("line-emissive-strength"),l=e.depthModeForSublayer(0,Ie.ReadOnly),c=e.colorModeForDrapableLayerRenderPass(a),u=e.terrain&&e.terrain.renderingToTexture?1:t.f.devicePixelRatio,h=r.paint.get("line-dasharray"),p=h.constantOr(1),d=r.layout.get("line-cap"),f=r.paint.get("line-pattern"),m=f.constantOr(1),g=r.paint.get("line-pattern").constantOr(1),_=1!==r.paint.get("line-opacity").constantOr(1);let y=!g&&_;const A=r.paint.get("line-gradient"),v=m?"linePattern":"line",x=e.context,b=x.gl,w=t.cA(r);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(y=!1);for(const o of n){const n=i.getTile(o);if(m&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;e.prepareDrawTile();const a=s.programConfigurations.get(r.id),g=e.isTileAffectedByFog(o),_=e.getOrCreateProgram(v,{config:a,defines:w,overrideFog:g}),S=f.constantOr(null);if(S&&n.imageAtlas){const t=n.imageAtlas.patternPositions[S.toString()];t&&a.setConstantPatternPositions(t)}const T=h.constantOr(null),C=d.constantOr(null);if(!m&&T&&C&&n.lineAtlas){const t=n.lineAtlas.getDash(T,C);t&&a.setConstantPatternPositions(t)}let[M,E]=r.paint.get("line-trim-offset");if("round"===C||"square"===C){const t=1;M!==E&&(0===M&&(M-=t),1===E&&(E+=t))}const I=e.terrain?o.projMatrix:null,L=m?t.cB(e,n,r,I,u,[M,E]):t.cC(e,n,r,I,s.lineClipsArray.length,u,[M,E]);if(A){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.aa(t.cD(s.maxLineLength/t.V*1024*n),256,x.maxTextureSize)}n.gradient=t.cE({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new t.T(x,n.gradient,b.RGBA),n.version=r.gradientVersion,a=n.texture}x.activeTexture.set(b.TEXTURE1),a.bind(r.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}p&&(x.activeTexture.set(b.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),a.updatePaintBuffers()),m&&(x.activeTexture.set(b.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),a.updatePaintBuffers()),e.uploadCommonUniforms(x,_,o.toUnwrapped());const P=t=>{_.draw(e,b.TRIANGLES,l,t,c,Re.disabled,L,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,e.transform.zoom,a,[s.layoutVertexBuffer2])};if(y){const t=e.stencilModeForClipping(o).ref;0===t&&e.terrain&&x.clear({stencil:0});const i={func:b.EQUAL,mask:255};L.u_alpha_discard_threshold=.8,P(new Pe(i,t,255,b.KEEP,b.KEEP,b.INVERT)),L.u_alpha_discard_threshold=0,P(new Pe(i,t,255,b.KEEP,b.KEEP,b.KEEP))}else P(e.stencilModeForClipping(o))}y&&(e.resetStencilClippingMasks(),e.terrain&&x.clear({stencil:0}))},fill:function(e,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=r.paint.get("fill-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=r.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(t.ax.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ie.ReadWrite:Ie.ReadOnly);so(e,i,r,n,t,l,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ie.ReadOnly);so(e,i,r,n,t,l,!0)}},"fill-extrusion":function(e,i,r,n){const o=r.paint.get("fill-extrusion-opacity"),s=e.context,a=s.gl,l=e.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u=e.conflationActive&&e.layerUsedInConflation(r,i.getSource());if(u&&function(t,e,i,r){for(const n of r){const r=e.getTile(n).getBucket(i);r&&(r.updateReplacement(n,t.replacementSource),r.uploadCentroid(t.context))}}(e,i,r,n),l||u)for(const t of n){const n=i.getTile(t).getBucket(r);n&&co(e.context,i,t,n,r,l,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const s=e.shadowRenderer;if(l&&o<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;const a=s.getShadowPassDepthMode(),c=s.getShadowPassColorMode();ao(e,i,r,n,a,Pe.disabled,c,u)}else if("translucent"===e.renderPass){const h=!r.paint.get("fill-extrusion-pattern").constantOr(1),p=r.paint.get("fill-extrusion-color").constantOr(t.ax.white);if(!c&&0!==p.a){const t=new Ie(e.context.gl.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D);1===o&&h?ao(e,i,r,n,t,Pe.disabled,Ne.unblended,u):(ao(e,i,r,n,t,Pe.disabled,Ne.disabled,u),ao(e,i,r,n,t,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&h&&(!l&&"globe"!==e.transform.projection.name||c)){const o=r.paint.get("fill-extrusion-opacity"),h=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),p=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=r.paint.get("fill-extrusion-flood-light-intensity"),f=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=h>0&&p>0,g=d>0,_=(t,e,i)=>(1-i)*t+i*e,y=s=>{const l=e.depthModeForSublayer(1,Ie.ReadOnly,a.LEQUAL,!0),c=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=_(.1,3,c),g=e._showOverdrawInspector;if(!g){const c=new Pe({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Ne([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(e,i,r,n,l,c,g,Re.disabled,s,"sdf",o,h,p,d,f,m,u,!1)}{const c=g?Pe.disabled:new Pe({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=g?e.colorModeForRenderPass():new Ne([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],t.ax.transparent,[!0,!0,!0,!0]);lo(e,i,r,n,l,c,_,Re.disabled,s,"color",o,h,p,d,f,m,u,!1)}};if(c){const c=(s,l,c)=>{const m=e.depthModeForSublayer(1,Ie.ReadOnly,a.LEQUAL,!1),g=r.paint.get(s?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new Ne([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0]);lo(e,i,r,n,m,Pe.disabled,c,Re.disabled,s,"clear",o,h,p,d,f,y,u,l)}{const c=new Pe({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),g=new Ne([a.ONE,a.ONE,a.ONE,a.ONE],t.ax.transparent,[!1,!1,!1,!0],a.MIN);lo(e,i,r,n,m,c,g,Re.disabled,s,"sdf",o,h,p,d,f,y,u,l)}{const c=s?a.ZERO:a.ONE_MINUS_DST_ALPHA,g=new Pe({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),_=new Ne([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],t.ax.transparent,[!0,!0,!0,!0]);lo(e,i,r,n,m,g,_,Re.disabled,s,"color",o,h,p,d,f,y,u,l)}{const g=new Ne([a.ONE,a.ONE,a.ONE,s?a.ZERO:a.ONE],t.ax.transparent,[!1,!1,!1,!0],s?a.FUNC_ADD:a.MAX);lo(e,i,r,n,m,Pe.disabled,g,Re.disabled,s,"clear",o,h,p,d,f,y,u,l,c)}};if(m||g){let i;if(e.prepareDrawTile(),l){const e=l.drapeBufferSize[0],r=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===e&&i.size[1]===r)||(i&&i.destroy(),i=l.framebufferCopyTexture=new t.T(s,new t.h({width:e,height:r}),a.RGBA)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,e,r,0)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1)}}},hillshade:function(t,e,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;if(t.style.disableElevatedTerrain)return;const n=t.context,o=t.terrain&&t.terrain.renderingToTexture,[s,a]="translucent"!==t.renderPass||o?[{},r]:t.stencilConfigForOverlap(r);for(const r of a){const n=e.getTile(r);if(n.needsHillshadePrepare&&"offscreen"===t.renderPass)rn(t,n,i);else if("translucent"===t.renderPass){const e=t.depthModeForSublayer(0,Ie.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=o&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):s[r.overscaledZ];tn(t,r,n,i,e,c,l)}}n.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(e,i,r,n,o,s){if("translucent"!==e.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const a="globe"===e.transform.projection.name,l=0!==r.paint.get("raster-elevation"),c=l&&a;if(e.renderElevatedRasterBackface&&!c)return;const u=e.context,h=u.gl,p=i.getSource(),d=function(e,i,r,n){const o=i.paint.get("raster-color"),s="raster-array"===e.type,a=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let u=i.paint.get("raster-color-range");const h=[c[0],c[1],c[2],0],p=c[3];let d="nearest"===l?n.NEAREST:n.LINEAR;if(s&&(a.push("RASTER_ARRAY"),o||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),d=n.NEAREST,!u&&e.rasterLayers)){const t=e.rasterLayers.find((({id:t})=>t===i.sourceLayer));t&&t.fields&&t.fields.range&&(u=t.fields.range)}if(u=u||[0,1],o){a.push("RASTER_COLOR"),r.activeTexture.set(n.TEXTURE2),i.updateColorRamp(u);let e=i.colorRampTexture;e||(e=i.colorRampTexture=new t.T(r,i.colorRamp,n.RGBA)),e.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:h,range:u,offset:p,defines:a,resampling:d}}(p,r,u,h);if(p instanceof t.ap&&!n.length&&!a)return;const f=r.paint.get("raster-emissive-strength"),m=e.colorModeForDrapableLayerRenderPass(f),g=e.terrain&&e.terrain.renderingToTexture,_=!e.options.moving,y="nearest"===r.paint.get("raster-resampling")?h.NEAREST:h.LINEAR;if(p instanceof t.ap&&!n.length&&(p.onNorthPole||p.onSouthPole)){const t=l?e.stencilModeFor3D():Pe.disabled;return void go(!!p.onNorthPole,null,e,i,r,f,d,Re.disabled,t)}if(!n.length)return;const[A,v]=p instanceof t.ap||g?[{},n]:e.stencilConfigForOverlap(n),x=v[v.length-1].overscaledZ;c&&d.defines.push("PROJECTION_GLOBE_VIEW"),l&&d.defines.push("RENDER_CUTOFF");const b=(n,o,v)=>{for(const b of n){const n=b.toUnwrapped(),w=i.getTile(b);if(g&&(!w||!w.hasData()))continue;u.activeTexture.set(h.TEXTURE0);const S=yo(w,p,r,d);if(!S||!S.texture)continue;const{texture:T,mix:C,offset:M,tileSize:E,buffer:I}=S;let L,P;g?(L=Ie.disabled,P=b.projMatrix):l?(L=new Ie(h.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D),P=a?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(n,_)):(L=e.depthModeForSublayer(b.overscaledZ-x,1===r.paint.get("raster-opacity")?Ie.ReadWrite:Ie.ReadOnly,h.LESS),P=e.transform.calculateProjMatrix(n,_));const k=e.terrain&&g?e.terrain.stencilModeForRTTOverlap(b):A[b.overscaledZ],N=s?0:r.paint.get("raster-fade-duration");w.registerFadeDuration(N);const D=i.findLoadedParent(b,0),O=dn(w,D,i,e.transform,N);let R,F;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(h.TEXTURE0),T.bind(y,h.CLAMP_TO_EDGE),u.activeTexture.set(h.TEXTURE1),D?(D.texture&&D.texture.bind(y,h.CLAMP_TO_EDGE),R=Math.pow(2,D.tileID.overscaledZ-w.tileID.overscaledZ),F=[w.tileID.canonical.x*R%1,w.tileID.canonical.y*R%1]):T.bind(y,h.CLAMP_TO_EDGE),T.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&h.texParameterf(h.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const z=e.transform;let B;const U=l?_o(z):[0,0,0,0];let V,j,G,Z,q,W=0;if(c&&p instanceof t.ap&&p.coordinates.length>3)V=Float32Array.from(t.aT(t.ci(new t.bs(0,0,0)))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.ce(z)),Z=[t.a5(z.center.lng),t.ae(z.center.lat)],B=p.elevatedGlobePerspectiveTransform,q=p.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const e=t.cf(b.canonical);W=t.cg(e.getCenter().lat),V=Float32Array.from(t.aT(t.ci(b.canonical))),j=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.ce(z)),Z=[t.a5(z.center.lng),t.ae(z.center.lat)],B=[0,0],q=Float32Array.from(t.ch(b.canonical,e,W,z.worldSize/z._pixelsPerMercatorPixel))}else B=p instanceof t.ap?p.perspectiveTransform:[0,0],V=new Float32Array(16),j=new Float32Array(9),G=new Float32Array(16),Z=[0,0],q=new Float32Array(9);const H=Fn(P,V,j,G,q,F||[0,0],t.S(e.transform.zoom),Z,U,R||1,O,r,B,l?r.paint.get("raster-elevation"):0,2,C,M,d.range,E,I,f),J=e.isTileAffectedByFog(b),K=e.getOrCreateProgram("raster",{defines:d.defines,overrideFog:J});if(e.uploadCommonUniforms(u,K,n),p instanceof t.ap){const i=p.elevatedGlobeVertexBuffer,n=p.elevatedGlobeIndexBuffer;if(g||!a)p.boundsBuffer&&p.boundsSegments&&K.draw(e,h.TRIANGLES,L,Pe.disabled,m,Re.disabled,H,r.id,p.boundsBuffer,e.quadTriangleIndexBuffer,p.boundsSegments);else if(i&&n){const s=z.zoom<=t.bG?p.elevatedGlobeSegments:p.getSegmentsForLongitude(z.center.lng);s&&K.draw(e,h.TRIANGLES,L,Pe.disabled,m,o,H,r.id,i,n,s)}}else if(c){L=new Ie(h.LEQUAL,Ie.ReadOnly,e.depthRangeFor3D);const t=e.globeSharedBuffers;if(t){const[i,n,s]=t.getGridBuffers(W,!1);K.draw(e,h.TRIANGLES,L,v||k,e.colorModeForRenderPass(),o,H,r.id,i,n,s)}}else{const{tileBoundsBuffer:t,tileBoundsIndexBuffer:i,tileBoundsSegments:n}=e.getTileBoundsBuffers(w);K.draw(e,h.TRIANGLES,L,k,m,Re.disabled,H,r.id,t,i,n)}}if(!(p instanceof t.ap)&&c)for(const t of n){const n=t.canonical.y===(1<<t.canonical.z)-1;0===t.canonical.y&&go(!0,t,e,i,r,f,d,o,v||Pe.disabled),n&&go(!1,t,e,i,r,f,d,o===Re.frontCW?Re.backCW:Re.frontCW,v||Pe.disabled)}};c?b(v,e.renderElevatedRasterBackface?Re.backCW:Re.frontCW,e.stencilModeFor3D()):b(v,Re.disabled,void 0),e.resetStencilClippingMasks()},"raster-particle":function(e,i,r,n,o,s){"offscreen"===e.renderPass&&function(e,i,r,n){if(!n.length)return;const o=e.context,s=o.gl,a=i.getSource();if(!(a instanceof Dt))return;const l=[];for(const t of n){const e=i.getTile(t);if(!(e instanceof Je))continue;const n=Ao(e,a,r);if(!n)continue;const s=[n.tileSize,n.tileSize];let c=r.tileFramebuffer;c||(c=r.tileFramebuffer=o.createFramebuffer(s[0],s[1],!0,null));let u=e.rasterParticleState;const h=r.paint.get("raster-particle-count");u||(u=e.rasterParticleState=new Be(o,t,s,h));const p=u.update(r.lastInvalidatedAt);u.numParticles!==h&&u.setNumParticles(t,h);const d=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=d;const f=u.particleVertices0;u.particleVertices0=u.particleVertices1,u.particleVertices1=f,l.push([t,n,u,p])}if(0===l.length)return;const c=t.f.now(),u=r.previousDrawTimestamp?.001*(c-r.previousDrawTimestamp):.0167;if(r.previousDrawTimestamp=c,r.hasColorMap()){o.activeTexture.set(s.TEXTURE0+2);let e=r.colorRampTexture;e||(e=r.colorRampTexture=new t.T(o,r.colorRamp,s.RGBA)),e.bind(s.LINEAR,s.CLAMP_TO_EDGE)}o.bindFramebuffer.set(r.tileFramebuffer.framebuffer),o.activeTexture.set(s.TEXTURE0),function(e,i,r){const n=e.context,o=n.gl,s=i.tileFramebuffer;n.activeTexture.set(o.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of r){const[,,r,u]=c;s.colorAttachment.set(r.targetColorTexture.texture),n.viewport.set([0,0,s.width,s.height]),n.clear({color:t.ax.transparent}),u&&(r.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(e,o.TRIANGLES,Ie.disabled,Pe.disabled,Ne.alphaBlended,Re.disabled,a,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments))}}(e,r,l),function(e,i,r,n){const o=e.context.gl,s=r.tileFramebuffer,a="globe"===e.transform.projection.name,l=r.paint.get("raster-particle-max-speed");for(const c of n){const[n,u,h]=c;u.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.colorAttachment.set(h.targetColorTexture.texture);const p=e.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1}),d=u.scalarData?[]:[0,1,2,3].map((e=>t.cG[e](n)));d.push(n);const f=n.canonical.x,m=n.canonical.y;for(const t of d){const s=i.getTile(a?t.wrapped():t);if(!s)continue;const c=s.rasterParticleState;if(!c)continue;const h=Un([t.canonical.x+(1<<t.canonical.z)*(t.wrap-n.wrap)-f,t.canonical.y-m],0,u.texture.size,2,l,u.textureOffset,u.scale,u.offset);p.draw(e,o.POINTS,Ie.disabled,Pe.disabled,Ne.alphaBlended,Re.disabled,h,r.id,c.particleVertices0,void 0,c.particleSegment)}}}(e,i,r,l),function(t,e,i,r){const n=t.context.gl;let o=e.transformFeedbackObject;o||(o=e.transformFeedbackObject=n.createTransformFeedback()),n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,e.transformFeedbackObject);const s=e.paint.get("raster-particle-max-speed"),a=r*e.paint.get("raster-particle-speed-factor")*.3,l=(c=e.paint.get("raster-particle-reset-rate-factor"),Math.pow(c,6));var c;for(const r of i){const[,i,o]=r;i.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE);const c=Vn(0,i.texture.size,s,a,l,i.textureOffset,i.scale,i.offset);t.getOrCreateProgram("rasterParticleUpdate",{defines:i.defines,transformFeedback:{bufferMode:n.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(t,n.POINTS,Ie.disabled,Pe.disabled,Ne.disabled,Re.disabled,c,e.id,o.particleVertices0,void 0,o.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:o.particleVertices1,targetIndex:0}])}n.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null)}(e,r,l,u)}(e,i,r,n),"translucent"===e.renderPass&&(function(e,i,r,n,o){const s=e.context,a=s.gl,l=!e.options.moving,c="globe"===e.transform.projection.name;if(!n.length)return;const[u,h]=e.stencilConfigForOverlap(n),p=[];c&&p.push("PROJECTION_GLOBE_VIEW");for(const n of h){const o=n.toUnwrapped(),h=i.getTile(n);if(!h.rasterParticleState)continue;const d=h.rasterParticleState,f=100;h.registerFadeDuration(f);const m=i.findLoadedParent(n,0),g=dn(h,m,i,e.transform,f);let _,y;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),m&&m.rasterParticleState?(m.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_=Math.pow(2,m.tileID.overscaledZ-h.tileID.overscaledZ),y=[h.tileID.canonical.x*_%1,h.tileID.canonical.y*_%1]):d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const A=c?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(o,l),v=e.transform,x=vo(v),b=t.cf(n.canonical),w=t.cg(b.getCenter().lat);let S,T,C,M,E;c?(S=Float32Array.from(t.aT(t.ci(n.canonical))),T=Float32Array.from(v.globeMatrix),C=Float32Array.from(t.ce(v)),M=[t.a5(v.center.lng),t.ae(v.center.lat)],E=Float32Array.from(t.ch(n.canonical,b,w,v.worldSize/v._pixelsPerMercatorPixel))):(S=new Float32Array(16),T=new Float32Array(9),C=new Float32Array(16),M=[0,0],E=new Float32Array(9));const I=Bn(A,S,T,C,E,y||[0,0],t.S(e.transform.zoom),M,x,_||1,g,250),L=e.isTileAffectedByFog(n),P=e.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:L});if(e.uploadCommonUniforms(s,P,o),c){const t=new Ie(a.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D),i=0,n=e.globeSharedBuffers;if(n){const[o,s,l]=n.getGridBuffers(w,0!==i);P.draw(e,a.TRIANGLES,t,Pe.disabled,Ne.alphaBlended,Re.backCCW,I,r.id,o,s,l)}}else{const t=e.depthModeForSublayer(0,Ie.ReadOnly),i=u[n.overscaledZ],{tileBoundsBuffer:o,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=e.getTileBoundsBuffers(h);P.draw(e,a.TRIANGLES,t,i,Ne.alphaBlended,Re.disabled,I,r.id,o,s,l)}}e.resetStencilClippingMasks()}(e,i,r,n),e.style.map.triggerRepaint())},background:function(t,e,i,r){const n=i.paint.get("background-color"),o=i.paint.get("background-opacity"),s=i.paint.get("background-emissive-strength");if(0===o)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=i.paint.get("background-pattern");if(t.isPatternMissing(h,i.scope))return;const p=!h&&1===n.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==p)return;const d=Pe.disabled,f=t.depthModeForSublayer(0,"opaque"===p?Ie.ReadWrite:Ie.ReadOnly),m=t.colorModeForDrapableLayerRenderPass(s),g=h?"backgroundPattern":"background";let _,y=r;y||(_=t.getBackgroundTiles(),y=Object.values(_).map((t=>t.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context,i.scope));for(const p of y){const y=t.isTileAffectedByFog(p),A=t.getOrCreateProgram(g,{overrideFog:y}),v=p.toUnwrapped(),x=r?p.projMatrix:t.transform.calculateProjMatrix(v);t.prepareDrawTile();const b=e?e.getTile(p):_?_[p.key]:new Ve(p,u,c.zoom,t),w=h?Hn(x,s,o,t,h,i.scope,{tileID:p,tileSize:u}):Wn(x,s,o,n);t.uploadCommonUniforms(a,A,v);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:T,tileBoundsSegments:C}=t.getTileBoundsBuffers(b);A.draw(t,l.TRIANGLES,f,d,m,Re.disabled,w,i.id,S,T,C)}},sky:function(e,i,r){const n=e._atmosphere?t.S(e.transform.zoom):1,o=r.paint.get("sky-opacity")*n;if(0===o)return;const s=e.context,a=r.paint.get("sky-type"),l=new Ie(s.gl.LEQUAL,Ie.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,i,r,n){const o=e.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new No(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(e,!0),c=e.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);t.a6.identity(u),t.a6.rotateY(u,u,.5*-Math.PI),Do(e,i,c,u,l,0),t.a6.identity(u),t.a6.rotateY(u,u,.5*Math.PI),Do(e,i,c,u,l,1),t.a6.identity(u),t.a6.rotateX(u,u,.5*-Math.PI),Do(e,i,c,u,l,2),t.a6.identity(u),t.a6.rotateX(u,u,.5*Math.PI),Do(e,i,c,u,l,3),t.a6.identity(u),Do(e,i,c,u,l,4),t.a6.identity(u),t.a6.rotateY(u,u,Math.PI),Do(e,i,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(t,e,i,r,n){const o=t.context,s=o.gl,a=t.transform,l=t.getOrCreateProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,e.skyboxTexture);const c=((t,e,i,r,n)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(a.skyboxMatrix,e.getCenter(t,!1),0,r,n);t.uploadCommonUniforms(o,l),l.draw(t,s.TRIANGLES,i,Pe.disabled,t.colorModeForRenderPass(),Re.backCW,c,"skybox",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}(e,r,l,o,c):"gradient"===a&&"sky"===e.renderPass&&function(e,i,r,n,o){const s=e.context,a=s.gl,l=e.transform,c=e.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new No(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.T(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,r,n,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.bj(r),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),n,o);e.uploadCommonUniforms(s,c),c.draw(e,a.TRIANGLES,r,Pe.disabled,e.colorModeForRenderPass(),Re.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,r,l,o,c)},debug:function(e,i,r,n,o,s){for(let a=0;a<r.length;a++)if(o){const o=1,l=.8,c=new t.ax(n.r*l,n.g*l,n.b*l,1);Co(e,i,r[a],n,-o,-o,s),Co(e,i,r[a],n,-o,o,s),Co(e,i,r[a],n,o,o,s),Co(e,i,r[a],n,o,-o,s),Co(e,i,r[a],c,0,0,s)}else Co(e,i,r[a],n,0,0,s)},custom:function(e,i,r,n){const o=e.context,s=r.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&r.isLayerDraped(i)){if("offscreen"===e.renderPass){const i=s.prerender;if(i){if(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const r=e.transform.pointMerc;i.call(s,o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.S(e.transform.zoom),[r.x,r.y],e.transform.pixelsPerMeterRatio)}else i.call(s,o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const i=s.renderToTile;if(i){const r=n[0].canonical,a=new t.L(r.x+n[0].wrap*(1<<r.z),r.y,r.z);o.setDepthMode(Ie.disabled),o.setStencilMode(Pe.disabled),o.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),i.call(s,o.gl,a),o.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Pe.disabled);const i="3d"===s.renderingMode?new Ie(e.context.gl.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Ie.ReadOnly);if(o.setDepthMode(i),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;s.render(o.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.S(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else s.render(o.gl,e.transform.customLayerMatrix());o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,i,r,n){if("opaque"===e.renderPass)return;const o=r.paint.get("model-opacity");if(0===o)return;const s=r.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!s)return;if(e.terrain&&o<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z)return}const a=e.shadowRenderer,l=r.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0))},u=i.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,i,r,n){const o=e.transform;if("mercator"!==o.projection.name)return void t.w(`Drawing 3D models for ${o.projection.name} projection is not yet implemented`);const s=o.getFreeCameraOptions().position;if(!e.modelManager)return;const a=e.modelManager;r.modelManager=a;const l=e.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const c=r._unevaluatedLayout._values["model-id"],u={...r.layout.get("model-id").parameters};for(const h of n){const n=i.getTile(h).getBucket(r);if(!n||n.projection.name!==o.projection.name)continue;const p=Ho(h,o);u.zoom=p;const d=c.possiblyEvaluate(u);if(qo(e,n,h),Wo.shadowUniformsInitialized=!1,Wo.useSingleShadowCascade=!!l&&0===l.getMaxCascadeForTile(h.toUnwrapped()),"shadow"===e.renderPass&&l){if(1===e.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const i=o.calculatePosMatrix(h.toUnwrapped(),o.worldSize);if(Wo.tileMatrix.set(i),Wo.shadowTileMatrix=Float32Array.from(l.calculateShadowPassMatrixFromMatrix(i)),Wo.aabb.min.fill(0),Wo.aabb.max[0]=Wo.aabb.max[1]=t.V,Wo.aabb.max[2]=0,$o(n,Wo,e,r.scope))continue}const f=1<<h.canonical.z,m=[((s.x-h.wrap)*f-h.canonical.x)*t.V,(s.y*f-h.canonical.y)*t.V,s.z*f*t.V];for(let t in n.instancesPerModel){const i=n.instancesPerModel[t];i.features.length>0&&(t=d.evaluate(i.features[0].feature,{}));const o=a.getModel(t,r.scope);if(o&&o.uploaded)for(const t of o.nodes)Jo(e,r,t,i,m,h,Wo)}}}(e,i,r,n),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(e,i,r,n){r.resetLayerRenderingStats(e);const o=e.context,s=e.transform,a=e.style.fog,l=e.shadowRenderer;if("mercator"!==s.projection.name)return void t.w(`Drawing 3D landmark models for ${s.projection.name} projection is not yet implemented`);const c=e.transform.getFreeCameraOptions().position,u=t.N.scale([],[c.x,c.y,c.z],e.transform.worldSize);t.N.negate(u,u);const h=t.a6.identity([]),p=t.cR(s.center.lat,s.zoom),d=t.a6.fromScaling([],[1,1,1/p]);t.a6.translate(h,h,u);const f=r.paint.get("model-opacity"),m=new Ie(o.gl.LEQUAL,Ie.ReadWrite,e.depthRangeFor3D),g=new Ie(o.gl.LEQUAL,Ie.ReadOnly,e.depthRangeFor3D),_=new t.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===e.renderPass,A=y&&l?l.getCurrentCascadeFrustum():s.getFrustum(s.scaleZoom(s.worldSize)),v=r.getLayerRenderingStats(),x=function(c,u){for(const p of n){const n=i.getTile(p).getBucket(r);if(!n||!n.uploaded)continue;let x=!1;l&&(x=0===l.getMaxCascadeForTile(p.toUnwrapped()));const b=s.calculatePosMatrix(p.toUnwrapped(),s.worldSize),w=n.modelTraits;for(const i of n.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const n=i.evaluatedScale,S=i.node;let T=0;if(e.terrain&&S.elevation&&(T=S.elevation*e.terrain.exaggeration()),n[0]<=1&&n[1]<=1&&n[2]<=1&&0===(()=>{const e=i.getLocalBounds();return _.min=[...e.min],_.max=[...e.max],_.min[2]+=T,_.max[2]+=T,t.N.transformMat4(_.min,_.min,b),t.N.transformMat4(_.max,_.max,b),_})().intersects(A))continue;const C="light-beam"===e.renderPass,M=[...b];t.a6.translate(M,M,[(S.anchor?S.anchor[0]:0)*(n[0]-1),(S.anchor?S.anchor[1]:0)*(n[1]-1),T]),t.N.exactEquals(n,t.cT)||t.a6.scale(M,M,n),t.a6.multiply(M,M,S.matrix);const E=t.a6.multiply([],d,M);t.a6.multiply(E,h,E);const I=t.a6.invert([],E);t.a6.transpose(I,I),t.a6.scale(I,I,Ko);const L=t.a6.multiply([],s.expandedFarZProjMatrix,M),P=w&t.cV.HasMapboxMeshFeatures,k=P?0:i.evaluatedRMEA[0][2];for(let t=0;t<S.meshes.length;++t){const n=S.meshes[t],h=t===S.lightMeshIndex;if(h){if(!C&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}}else if(C)continue;const d={defines:[]},_=[];if(Vo(d.defines,_,n,e),P||d.defines.push("DIFFUSE_SHADED"),x&&d.defines.push("SHADOWS_SINGLE_CASCADE"),v&&(y?v.numRenderedVerticesInShadowPass+=n.vertexArray.length:v.numRenderedVerticesInTransparentPass+=n.vertexArray.length),y){Zo(n,M,e,r);continue}let A=null;if(a){const t=Uo(M,e.transform);if(A=new Float32Array(t),"globe"!==s.projection.name){const e=n.aabb.min,i=n.aabb.max,[r,o]=a.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);d.overrideFog=r>=gt||o>=gt}}const b=n.material;let w;b.occlusionTexture&&b.occlusionTexture.offsetScale&&(w=b.occlusionTexture.offsetScale,d.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!n.normalBuffer);const T=e.getOrCreateProgram("model",d);!y&&l&&l.setupShadowsFromMatrix(M,T,l.useNormalOffset),e.uploadCommonUniforms(o,T,p.toUnwrapped(),A);const N=b.pbrMetallicRoughness;N.metallicFactor=.9,N.roughnessFactor=.5;const D=Jn(new Float32Array(L),new Float32Array(E),new Float32Array(I),e,f,N.baseColorFactor,b.emissiveFactor,N.metallicFactor,N.roughnessFactor,b,k,r,[0,0,0],w);T.draw(e,o.gl.TRIANGLES,u&&!h?m:g,Pe.disabled,c?h||f<1||i.hasTranslucentParts?Ne.alphaBlended:Ne.unblended:Ne.disabled,Re.backCCW,D,r.id,n.vertexBuffer,n.indexBuffer,n.segments,r.paint,e.transform.zoom,void 0,_)}}}};(function(t,e,i,r){const n=t.terrain?t.terrain.exaggeration():0,o=t.transform.zoom;for(const s of r){const r=e.getTile(s).getBucket(i);r&&(t.conflationActive&&r.updateReplacement(s,t.replacementSource),r.evaluateScale(t,i),t.terrain&&n>0&&r.elevationUpdate(t.terrain,n,s,i.source),r.needsReEvaluation(t,o,i)&&r.evaluate(i))}})(e,i,r,n),1===f?x(!0,!0):(x(!1,!0),x(!0,!1))}(e,i,r,n),void c();const h=u.getModels(),p=[],d=e.transform.getFreeCameraOptions().position,f=t.N.scale([],[d.x,d.y,d.z],e.transform.worldSize);t.N.negate(f,f);const m=[],g=[];let _=0;for(const i of h){const n=r.paint.get("model-rotation").constantOr(null),o=r.paint.get("model-scale").constantOr(null),s=r.paint.get("model-translation").constantOr(null);i.computeModelMatrix(e,n,o,s,!0,!0,!1);const a=t.a6.identity([]),l=t.cR(i.position.lat,e.transform.zoom),c=t.a6.fromScaling([],[1,1,1/l]);t.a6.translate(a,a,f),p.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const t of i.nodes)Go(e.transform,t,i.matrix,e.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort(((t,e)=>e.depth-t.depth)),"shadow"!==e.renderPass){if(1===o)for(const t of g)jo(t,e,r,p[t.modelIndex],Pe.disabled,e.colorModeForRenderPass());else{for(const t of g)jo(t,e,r,p[t.modelIndex],Pe.disabled,Ne.disabled);for(const t of g)jo(t,e,r,p[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const t of m)jo(t,e,r,p[t.modelIndex],Pe.disabled,e.colorModeForRenderPass());c()}else{for(const t of g)Zo(t.mesh,t.nodeModelMatrix,e,r);for(const t of m)Zo(t.mesh,t.nodeModelMatrix,e,r);c()}}},es={model:function(t,e,i){const r=t.scope,n=e.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(i.modelManager&&i.modelManager.upload(i,r));if("batched-model"===n.type)return;const o=n.getModels();for(const t of o)t.upload(i.context)},raster:function(t,e,i){const r=e.getSource();if(!(r instanceof Dt&&r.loaded()))return;const n=t.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const o=t.paint.get("raster-array-band")||r.getInitialBand(n);if(null==o)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const t of s)t.updateNeeded(n,o)&&r.prepareTile(t,n,o)},"raster-particle":function(t,e,i){const r=e.getSource();if(!(r instanceof Dt&&r.loaded()))return;const n=t.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const o=t.paint.get("raster-particle-array-band")||r.getInitialBand(n);if(null==o)return;const s=e.getIds().map((t=>e.getTileByID(t)));for(const t of s)t.updateNeeded(n,o)&&r.prepareTile(t,n,o)}};class is{constructor(e,i,r,n){this.context=new Fe(e,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._debugParams={showTerrainProxyTiles:!1},n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),this.setup(),this.numSublayers=$e.maxUnderzooming+$e.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new xr(this),this._wireframeDebugCache=new Xo,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _n(this,t));const r=this._terrain;this.transform.elevation=i?r:null,r.update(t,this.transform,e),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=e.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*t.f.devicePixelRatio,this.height=i*t.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const e=this.context,i=new t.aN;i.emplaceBack(0,0),i.emplaceBack(t.V,0),i.emplaceBack(0,t.V),i.emplaceBack(t.V,t.V),this.tileExtentBuffer=e.createVertexBuffer(i,t.aP.members),this.tileExtentSegments=t.aB.simpleSegment(0,0,4,2);const r=new t.aN;r.emplaceBack(0,0),r.emplaceBack(t.V,0),r.emplaceBack(0,t.V),r.emplaceBack(t.V,t.V),this.debugBuffer=e.createVertexBuffer(r,t.aP.members),this.debugSegments=t.aB.simpleSegment(0,0,4,5);const n=new t.aN;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(n,t.aP.members),this.viewportSegments=t.aB.simpleSegment(0,0,4,2);const o=new t.av;o.emplaceBack(0,0,0,0),o.emplaceBack(t.V,0,t.V,0),o.emplaceBack(0,t.V,0,t.V),o.emplaceBack(t.V,t.V,t.V,t.V),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.aR.members),this.mercatorBoundsSegments=t.aB.simpleSegment(0,0,4,2);const s=new t.aw;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.aO;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.T(e,new t.h({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.a6.create();const l=this.context.gl;this.stencilClearMode=new Pe({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ie.disabled,this.stencilClearMode,Ne.disabled,Re.disabled,pn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,e,i){if(!e||this.currentStencilSource===e.id||!t.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of i)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=e.id;const r=this.context,n=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(Ne.disabled),r.setDepthMode(Ie.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of i){const i=e.getTile(t),r=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);o.draw(this,n.TRIANGLES,Ie.disabled,new Pe({func:n.ALWAYS,mask:0},r,255,n.KEEP,n.KEEP,n.REPLACE),Ne.disabled,Re.disabled,pn(t.projMatrix),"$clipping",s,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Pe({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const e=this.context.gl;return new Pe({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const t={};for(let i=0;i<n;i++)t[i+r]=new Pe({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=n,[t,i]}return[{[r]:Pe.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Ne([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new t.ax(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Ne.unblended:Ne.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new Ne([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new t.ax(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,e,i,r=!1){if(!this.opaquePassEnabledForLayer()&&!r)return Ie.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ie(i||this.context.gl.LEQUAL,e,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=i;const r=this.style._mergedLayers,n=this.style.order,o=n.map((t=>r[t])),s=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.f.now()),this.imageManager.beginFrame();let a=0,l=!1;for(const t in s){const e=s[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++a)}for(const t of o)t.isHidden(this.transform.zoom)||this.prepareLayer(t);const c={},u={},h={},p={},d={};for(const t in s){const e=s[t];c[t]=e.getVisibleCoordinates(),u[t]=c[t].slice().reverse(),h[t]=e.getVisibleCoordinates(!0).reverse(),p[t]=e.getShadowCasterCoordinates(),d[t]=e.sortCoordinatesByDistance(c[t])}const f=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(a){const t=[];for(const e of o)this.layerUsedInConflation(e,f(e))&&t.push(e);if(t&&t.length>1){const e=[];for(const i of t){const t=this.style.getLayerSourceCache(i);t&&t.used&&t.getSource().usedInConflation&&e.push({layer:i.fqid,cache:t})}this.replacementSource.setSources(e),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const t of o){const e=t.cutoffRange();if(this.longestCutoffRange=Math.max(e,this.longestCutoffRange),e>0){const e=f(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(o[t].is3D()){this.opaquePassCutoff=t;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(h),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in s)for(const e of c[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),g.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Bo(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.cZ(this.context.gl))return;this.renderPass="offscreen";for(const t of o){const i=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const r=i?u[i.id]:void 0;("custom"===t.type||"raster"===t.type||"raster-particle"===t.type||t.isSky()||r&&r.length)&&this.renderLayer(this,i,t,r)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,p)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),A=(()=>{if(i.showOverdrawInspector)return t.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const e=this.style.fog.properties.get("color").toArray01();return new t.ax(...e)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const e=this.style.fog.properties.get("space-color").toArray01();return new t.ax(...e)}return t.ax.transparent})();if(this.context.clear({color:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())continue;const r=i?(t.is3D()?d:u)[i.id]:void 0;this._renderTileClippingMasks(t,i,r),this.renderLayer(this,i,t,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.S(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?u[i.id]:void 0)}function v(t,e){let i;return e&&(i=("symbol"===t.type?h:t.is3D()?d:u)[e.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<n.length;){const t=o[this.currentLayer];if("raster"===t.type){const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,v(t,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let x=0;for(g&&(x=g.getShadowCastingLayerCount());this.currentLayer<n.length;){const t=o[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())++this.currentLayer;else if(_&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(t,i,i?c[i.id]:void 0),this.renderLayer(this,i,t,v(t,i)),!_&&g&&x>0&&t.hasShadowPass()&&0==--x&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=o[this.currentLayer];if(!t.hasLightBeamPass())continue;const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,i?u[i.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;o.forEach((t=>{const r=e.getLayerSourceCache(t);r&&!t.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&ts.debug(this,i,i.getVisibleCoordinates(),t.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ts.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(t){const e=t.transform.padding;Mo(t,t.transform.height-(e.top||0),3,xo),Mo(t,e.bottom||0,3,bo),Eo(t,e.left||0,3,wo),Eo(t,t.transform.width-(e.right||0),3,So);const i=t.transform.centerPoint;!function(t,e,i,r){Io(t,e-1,i-10,2,20,r),Io(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,To)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:e}=this.transform.projection,i=!e||!e.includes(t.type);if(es[t.type]&&(i||this.terrain&&"custom"===t.type)){const e=this.style.getLayerSourceCache(t);es[t.type](t,e,this)}this.gpuTimingEnd()}renderLayer(t,e,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(i.type)||t.terrain&&"custom"===i.type)&&ts[i.type](t,e,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,i=this.context.gl;let r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(e.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,i=e.createQuery();this.deferredRenderGpuTimeQueries.push(i),e.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const r=t[i],n=this.context.extTimerQuery,o=n.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(r.query),e[i]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery,i=this.context.gl;let r=0;for(const n of t)r+=e.getQueryParameter(n,i.QUERY_RESULT)/1e6,e.deleteQueryEXT(n);return r}translatePosMatrix(e,i,r,n,o){if(!r[0]&&!r[1])return e;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:t.a3(i,r[0],this.transform.zoom),o?r[1]:t.a3(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.a6.translate(l,e,a),l}saveTileTexture(t){const e=t.size[0],i=this._tileTextures[e];i?i.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t,e){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString(),e)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,i){const r=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,n=this.terrain&&0===this.terrain.exaggeration(),o=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(o.push("LIGHTING_3D_MODE"),o.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||o.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||o.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?o.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):o.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(o.push("TERRAIN"),this.linearFloatFilteringSupported()&&o.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&o.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&o.push("GLOBE"),!this._fogVisible||r||void 0!==e&&!e||o.push("FOG","FOG_DITHERING"),r&&o.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&o.push("OVERDRAW_INSPECTOR"),o}getOrCreateProgram(t,e){this.cache=this.cache||{};const i=e&&e.defines||[],r=e&&e.config,n=e&&e.transformFeedback,o=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(i),s=xn.cacheKey(Kr[t],t,o,r);return this.cache[s]||(this.cache[s]=new xn(this.context,t,Kr[t],r,Yn[t],o,n)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const o=((e,i)=>{const r=e.properties.get("direction"),n=e.properties.get("color").toArray01(),o=e.properties.get("intensity"),s=i.properties.get("color").toArray01(),a=i.properties.get("intensity"),l=[r.x,r.y,r.z],c=t.cn(s,a),u=t.cn(n,o);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:u,u_ground_radiance:yn(l,u,c)}})(r,n);i.setLightsUniformValues(e,o)}}}uploadCommonUniforms(e,i,r,n,o){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const o=s.getOpacity(this.transform.pitch),a=((e,i,r,n,o,s,a,l,c,u,h,p)=>{const d=e.transform,f=i.properties.get("color").toArray01();f[3]=n;const m=e.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:r?d.calculateFogTileMatrix(r):p||e.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:t.S(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,s,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.f.devicePixelRatio,this.transform.height*t.f.devicePixelRatio],n);i.setFogUniformValues(e,a)}o&&i.setCutoffUniformValues(e,o.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,e=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const r of i)e[r.key]=t[r.key]||new Ve(r,512,this.transform.tileZoom,this);return e}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,e){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||"building"!==t.sourceLayer&&(!e||"batched-model"!==e.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=gt||e[1]>=gt}}function rs(t,e){let i=!1,r=null;const n=()=>{r=null,i&&(t(),r=setTimeout(n,e),i=!1)};return()=>(i=!0,r||n(),r)}class ns{constructor(e){this._hashName=e&&encodeURIComponent(e),t.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=rs(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=os(t);if(this._hashName){const t=this._hashName;let i=!1;const r=location.hash.slice(1).split("&").map((r=>{const n=r.split("=")[0];return n===t?(i=!0,`${n}=${e}`):r})).filter((t=>t));return i||r.push(`${t}=${e}`),`#${r.join("&")}`}return`#${e}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function os(t,e){const i=t.getCenter(),r=Math.round(100*t.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,n),s=Math.round(i.lng*o)/o,a=Math.round(i.lat*o)/o,l=t.getBearing(),c=t.getPitch();let u=e?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+=`/${Math.round(c)}`),u}const ss={linearity:.3,easing:t.c_(0,0,.3,1)},as=t.e({deceleration:2500,maxSpeed:1400},ss),ls=t.e({deceleration:20,maxSpeed:1400},ss),cs=t.e({deceleration:1e3,maxSpeed:360},ss),us=t.e({deceleration:1e3,maxSpeed:90},ss);class hs{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.f.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.f.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=ds(i.pan.mag(),r,t.e({},as,e||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,ps(n,o)}if(i.zoom){const t=ds(i.zoom,r,ls);n.zoom=this._map.transform.zoom+t.amount,ps(n,t)}if(i.bearing){const e=ds(i.bearing,r,cs);n.bearing=this._map.transform.bearing+t.aa(e.amount,-179,179),ps(n,e)}if(i.pitch){const t=ds(i.pitch,r,us);n.pitch=this._map.transform.pitch+t.amount,ps(n,t)}if(n.zoom||n.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function ps(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function ds(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.aa(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class fs extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){const o=f(i.getCanvasContainer(),r),s=i.unproject(o);super(e,t.e({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class ms extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n="touchend"===e?r.changedTouches:r.touches,o=m(i.getCanvasContainer(),n),s=o.map((t=>i.unproject(t))),a=o.reduce(((t,e,i,r)=>t.add(e.div(r.length))),new t.P(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class gs extends t.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class _s{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new gs(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new fs(t.type,this._map,t))}mouseup(t){this._map.fire(new fs(t.type,this._map,t))}preclick(e){const i=t.e({},e);i.type="preclick",this._map.fire(new fs(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new fs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new fs(t.type,this._map,t))}mouseover(t){this._map.fire(new fs(t.type,this._map,t))}mouseout(t){this._map.fire(new fs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ms(t.type,this._map,t))}touchmove(t){this._map.fire(new ms(t.type,this._map,t))}touchend(t){this._map.fire(new ms(t.type,this._map,t))}touchcancel(t){this._map.fire(new ms(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ys{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new fs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new fs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class As{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(r.x,i.x),a=Math.max(r.x,i.x),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${l}px)`,this._box.style.width=a-s+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(e,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&0===e.button){if(this.reset(),d(),r.x!==n.x||r.y!==n.y)return this._map.fire(new t.b("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.b(e,{originalEvent:i}))}}function vs(t,e){const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class xs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=vs(r,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=vs(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class bs{constructor(t){this.singleTap=new xs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class ws{constructor(){this._zoomIn=new bs({numTouches:1,numTaps:2}),this._zoomOut=new bs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i);return r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ss={0:1,2:2};class Ts{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=g(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=Ss[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&g(t)===this._eventButton&&(this._moved&&d(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cs extends Ts{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Ms extends Ts{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class Es extends Ts{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class Is{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(e,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!t.c$())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,r)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=vs(r,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const t in n){const e=n[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,n[t]=e)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Ls{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const r=this._firstTwoTouches;if(!r)return;t.preventDefault();const[n,o]=r,s=Ps(i,e,n),a=Ps(i,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=Ps(i,e,r),s=Ps(i,e,n);o&&s||(this._active&&d(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ps(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function ks(t,e){return Math.log(t/e)/Math.LN2}class Ns extends Ls{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ks(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ks(this._distance,i),pinchAround:e}}}function Ds(t,e){return 180*t.angleWith(e)/Math.PI}class Os extends Ls{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ds(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=Ds(t,i);return Math.abs(r)<e}}function Rs(t){return Math.abs(t.y)>Math.abs(t.x)}class Fs extends Ls{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Rs(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,i,r){const n=this._lastPoints;if(!n)return;const o=e[0].sub(n[0]),s=e[1].sub(n[1]);return this._map._cooperativeGestures&&!t.c$()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return Rs(t)&&Rs(e)&&o}}const zs={panStep:100,bearingStep:15,pitchStep:10};class Bs{constructor(){const t=zs;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Us,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Us(t){return t*(2-t)}const Vs=4.000244140625,js=1/450;class Gs{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=js,t.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.c$()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.f.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Vs==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=f(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Vs?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==r&&(r=1/r);const n=i(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&n&&o){const e=Math.min((t.f.now()-this._lastWheelEventTime)/200,1),i=o(e);s=t.U(n,r,i),e<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=s-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.d0;if(this._prevEase){const e=this._prevEase,r=(t.f.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.c_(o,s,.25,1)}return this._prevEase={start:t.f.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Zs{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ws{constructor(){this._tap=new bs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hs{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Js{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ks{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $s=t=>t.zoom||t.drag||t.pitch||t.rotate;class Ys extends t.b{}class Xs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const r=t.N.sub([],i,e);this.radius=t.N.length(r[2]<0?t.N.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){t.N.div(e,e,this.constants),t.N.normalize(e,e),t.N.mul(e,e,this.constants);const i=t.N.scale([],e,this.radius);if(i[2]>0){const e=t.N.scale([],[0,0,1],t.N.dot(i,[0,0,1])),r=t.N.scale([],t.N.normalize([],[i[0],i[1],0]),this.radius),n=t.N.add([],i,t.N.scale([],t.N.sub([],t.N.add([],r,e),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Qs(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class ta{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hs(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Xs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.aY(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners){const r=t===document?this.handleWindowEvent:this.handleEvent;t.addEventListener(e,r,i)}}destroy(){for(const[t,e,i]of this._listeners){const r=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(e,r,i)}}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new _s(e,t));const r=e.boxZoom=new As(e,t);this._add("boxZoom",r);const n=new ws,o=new qs;e.doubleClickZoom=new Zs(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new Ws;this._add("tapDragZoom",s);const a=e.touchPitch=new Fs(e);this._add("touchPitch",a);const l=new Ms(t),c=new Es(t);e.dragRotate=new Js(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Cs(t),h=new Is(e,t);e.dragPan=new Hs(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const p=new Os,d=new Ns;e.touchZoomRotate=new Ks(i,d,p,s),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ys(e));const f=e.scrollZoom=new Gs(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new Bs;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$s(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,r=i?void 0:t,n={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,a),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=r);this._previousActiveHandlers=s,(Object.keys(c).length||Qs(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Qs(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.e(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.aroundCoord&&(e.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.e(i,o),t.e(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,i,r){const n=this._map,o=n.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Qs(e)){const t=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),t!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&n._stop(!0),!Qs(e))return void this._fireEvents(i,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:p,pinchAround:d}=e;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==d&&(h=d),(l||(t=>i[t]&&!this._eventsInProgress[t])("drag"))&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a)if("mercator"===o.projection.name){const t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h).dir),e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(h.sub(a)).dir);f[0]=e[0]-t[0],f[1]=e[1]-t[1]}else{const e=o.pointCoordinate(h);if("globe"===o.projection.name){a=a.rotate(-o.angle);const i=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-a.x*t.d1(t.au(e.y))*i,f[1]=-a.y*t.d1(o.center.lat)*i}else{const t=o.pointCoordinate(h.sub(a));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const m=o.zoom,g=[0,0,0];if(l){const e=s(p||o.pointCoordinate3D(h)),i={dir:t.N.normalize([],t.N.sub([],e,o._camera.position))};if(i.dir[2]<0){const r=o.zoomDeltaToMovement(e,l);t.N.scale(g,i.dir,r)}}const _=t.N.add(f,f,g);o._translateCameraConstrained(_),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,r,!0)}_fireEvents(e,i,r){const n=$s(this._eventsInProgress),o=$s(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||r,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=$s(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.b("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.b(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Ys("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ea="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ia extends t.E{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,t.aY(["_renderFrameCallback"],this)}getCenter(){return new t.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.e({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,r){return this.easeTo(t.e({zoom:e},i),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,r){return this.easeTo(t.e({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.ad.convert(e);const r=i&&i.bearing||0,n=i&&i.pitch||0,o=e.getNorthWest(),s=e.getSouthEast();return this._cameraForBounds(this.transform,o,s,r,n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.e({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.e(i,e.padding),e}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],r=e.max[1]-e.min[1];return i/r>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):r/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,i,r,n,o,s){const a=e.clone(),l=this._extendCameraOptions(s);a.bearing=n,a.pitch=o;const c=t.bn.convert(i),u=t.bn.convert(r),h=.5*(c.lat+u.lat),p=.5*(c.lng+u.lng),d=t.d2(h,p),f=t.N.normalize([],d),m=t.N.normalize([],t.N.cross([],f,[0,1,0])),g=t.N.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[d,t.d2(c.lat,c.lng),t.d2(u.lat,c.lng),t.d2(u.lat,u.lng),t.d2(c.lat,u.lng),t.d2(h,c.lng),t.d2(h,u.lng),t.d2(c.lat,p),t.d2(u.lat,p)];let A=t.bS.fromPoints(y.map((e=>[t.N.dot(m,e),t.N.dot(g,e),t.N.dot(f,e)])));const v=t.N.transformMat4([],A.center,_);0===t.N.squaredLength(v)&&t.N.set(v,0,0,1),t.N.normalize(v,v),t.N.scale(v,v,t.ab),a.center=t.d3(v);const x=a.getWorldToCameraMatrix(),b=t.a6.invert(new Float64Array(16),x);A=t.bS.applyTransform(A,t.a6.multiply([],x,_)),t.N.transformMat4(v,v,x);const w=.5*(A.max[2]-A.min[2]),S=this._minimumAABBFrustumDistance(a,A),T=t.N.scale([],[0,0,1],w),C=t.N.add(T,v,T),M=S+(0===a.pitch?0:t.N.distance(v,C)),E=a.globeCenterInViewSpace,I=t.N.sub([],v,[E[0],E[1],E[2]]);t.N.normalize(I,I),t.N.scale(I,I,M);const L=t.N.add([],v,I);t.N.transformMat4(L,L,b);const P=t.d4/t.ab,k=t.N.length(L),N=t.bl(Math.max(k*P-t.d4,Number.EPSILON),0),D=Math.min(a.zoomFromMercatorZAdjusted(N),l.maxZoom);return D>.5*(t.bG+t.bx)?(a.setProjection({name:"mercator"}),a.zoom=D,this._cameraForBounds(a,i,r,n,o,s)):{center:a.center,zoom:D,bearing:n,pitch:o}}queryTerrainElevation(e,i){const r=this.transform.elevation;return r?(i=t.e({},{exaggerated:!0},i),r.getAtPoint(t.L.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,r,n,o,s){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,i,r,n,o,s);const a=e.clone(),l=this._extendCameraOptions(s),c=a.padding;a.bearing=n,a.pitch=o;const u=t.bn.convert(i),h=t.bn.convert(r),p=new t.bn(u.lng,h.lat),d=new t.bn(h.lng,u.lat),f=a.project(u),m=a.project(h),g=this.queryTerrainElevation(u),_=this.queryTerrainElevation(h),y=this.queryTerrainElevation(p),A=this.queryTerrainElevation(d),v=[[f.x,f.y,Math.min(g||0,_||0,y||0,A||0)],[m.x,m.y,Math.max(g||0,_||0,y||0,A||0)]];let x=t.bS.fromPoints(v);const b=a.getWorldToCameraMatrix(),w=t.a6.invert(new Float64Array(16),b);x=t.bS.applyTransform(x,b);const S=t.N.sub([],x.max,x.min),T=c.left||0,C=c.right||0,M=c.bottom||0,E=c.top||0,{left:I,right:L,top:P,bottom:k}=l.padding,N=.5*(T+C),D=.5*(E+M),O=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(T+C+I+L))/S[0],(a.height-(M+E+k+P))/S[1])),l.maxZoom),R=a.scale/a.zoomScale(O);x=new t.bS([x.min[0]-(I+N)*R,x.min[1]-(k+D)*R,x.min[2]],[x.max[0]+(L+N)*R,x.max[1]+(P+D)*R,x.max[2]]);const F=.5*S[2],z=this._minimumAABBFrustumDistance(a,x),B=[0,0,1,0];t.a7.transformMat4(B,B,b),t.a7.normalize(B,B);const U=t.N.scale([],B,z+F),V=t.N.add([],x.center,U),j=("number"==typeof l.offset.x&&"number"==typeof l.offset.y?new t.P(l.offset.x,l.offset.y):t.P.convert(l.offset)).rotate(-t.bj(n));x.center[0]-=j.x*R,x.center[1]+=j.y*R,t.N.transformMat4(x.center,x.center,w),t.N.transformMat4(V,V,w);const G=[x.center[0],x.center[1],V[2]*a.pixelsPerMeter];t.N.scale(G,G,1/a.worldSize);const Z=t.at(G[0]),q=t.au(G[1]),W=Math.min(a._zoomFromMercatorZ(G[2]),l.maxZoom),H=new t.bn(Z,q);return a.mercatorFromTransition&&W<.5*(t.bG+t.bx)?(a.setProjection({name:"globe"}),a.zoom=W,this._cameraForBounds(a,i,r,n,o,s)):{center:H,zoom:W,bearing:n,pitch:o}}fitBounds(t,e,i){const r=this.cameraForBounds(t,e);return this._fitInternal(r,e,i)}fitScreenCoordinates(e,i,r,n,o){const s=t.P.convert(e),a=t.P.convert(i),l=new t.P(Math.min(s.x,a.x),Math.min(s.y,a.y)),c=new t.P(Math.max(s.x,a.x),Math.max(s.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(s,a))return this;const u=this.transform.pointLocation3D(l),h=this.transform.pointLocation3D(c),p=this.transform.pointLocation3D(new t.P(l.x,c.y)),d=this.transform.pointLocation3D(new t.P(c.x,l.y)),f=[Math.min(u.lng,h.lng,p.lng,d.lng),Math.min(u.lat,h.lat,p.lat,d.lat)],m=[Math.max(u.lng,h.lng,p.lng,d.lng),Math.max(u.lat,h.lat,p.lat,d.lat)],g=n&&n.pitch?n.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,r,g,n);return this._fitInternal(_,n,o)}_fitInternal(e,i,r){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,s=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.bn.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(s=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new t.b("movestart",i)).fire(new t.b("move",i)),n&&this.fire(new t.b("zoomstart",i)).fire(new t.b("zoom",i)).fire(new t.b("zoomend",i)),o&&this.fire(new t.b("rotatestart",i)).fire(new t.b("rotate",i)).fire(new t.b("rotateend",i)),s&&this.fire(new t.b("pitchstart",i)).fire(new t.b("pitch",i)).fire(new t.b("pitchend",i)),this.fire(new t.b("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(ea),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return t.w(ea),this;this.stop();const n=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(e);const a=n!==r.zoom,l=o!==r.pitch,c=s!==r.bearing;return this.fire(new t.b("movestart",i)).fire(new t.b("move",i)),a&&this.fire(new t.b("zoomstart",i)).fire(new t.b("zoom",i)).fire(new t.b("zoomend",i)),c&&this.fire(new t.b("rotatestart",i)).fire(new t.b("rotate",i)).fire(new t.b("rotateend",i)),l&&this.fire(new t.b("pitchstart",i)).fire(new t.b("pitch",i)).fire(new t.b("pitchend",i)),this.fire(new t.b("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.d0},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let d,f,m;if("globe"===r.projection.name){const i=t.L.fromLngLat(r.center),n=p.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const o=i.toLngLat(),s=t.bn.convert(e.center||o);this._normalizeCenter(s),d=r.centerPoint.add(n),f=new t.P(i.x,i.y).mult(r.worldSize),m=new t.P(t.a5(s.lng),t.ae(s.lat)).mult(r.worldSize).sub(f)}else{d=r.centerPoint.add(p);const i=r.pointLocation(d),n=t.bn.convert(e.center||i);this._normalizeCenter(n),f=r.project(i),m=r.project(n).sub(f)}const g=r.zoomScale(l-n);let _,y;e.around&&(_=t.bn.convert(e.around),y=r.locationPoint(_));const A=this._zooming||l!==n,v=this._rotating||o!==c,x=this._pitching||u!==s,b=!r.isPaddingEqual(h),w=r=>w=>{if(A&&(r.zoom=t.U(n,l,w)),v&&(r.bearing=t.U(o,c,w)),x&&(r.pitch=t.U(s,u,w)),b&&(r.interpolatePadding(a,h,w),d=r.centerPoint.add(p)),_)r.setLocationAtPoint(_,y);else{const t=r.zoomScale(r.zoom-n),e=l>n?Math.min(2,g):Math.max(.5,g),i=Math.pow(e,1-w),o=r.unproject(f.add(m.mult(w*i)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,d)}return e.preloadOnly||this._fireMoveEvents(i),r};if(e.preloadOnly){const t=this._emulate(w,e.duration,r);return this._preloadTiles(t),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=A,this._rotating=v,this._pitching=x,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,S),this._ease(w(r),(t=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new t.b("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.b("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.b("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.b("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.b("move",e)),this._zooming&&this.fire(new t.b("zoom",e)),this._rotating&&this.fire(new t.b("rotate",e)),this._pitching&&this.fire(new t.b("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,r&&this.fire(new t.b("zoomend",e)),n&&this.fire(new t.b("rotateend",e)),o&&this.fire(new t.b("pitchend",e)),this.fire(new t.b("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const r=t.ac(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.d0},e);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a="zoom"in e?t.aa(+e.zoom,r.minZoom,r.maxZoom):n,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,u=r.zoomScale(a-n),h=t.P.convert(e.offset),p=r.centerPoint.add(h),d=r.pointLocation(p);let f=e.center;if(f&&e.padding){const t=this._cameraForBounds(this.transform,f,f,l,c,e);t&&(f=t.center)}f=t.bn.convert(f||d),this._normalizeCenter(f);const m=r.project(d),g=r.project(f).sub(m);let _=e.curve;const y=Math.max(r.width,r.height),A=y/u,v=g.mag();if("minZoom"in e){const i=t.aa(Math.min(e.minZoom,n,a),r.minZoom,r.maxZoom),o=y/r.zoomScale(i-n);_=Math.sqrt(o/v*2)}const x=_*_;function b(t){const e=(A*A-y*y+(t?-1:1)*x*x*v*v)/(2*(t?A:y)*x*v);return Math.log(Math.sqrt(e*e+1)-e)}function w(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}const T=b(0);let C=function(t){return S(T)/S(T+_*t)},M=function(t){return y*((S(T)*(w(e=T+_*t)/S(e))-w(T))/x)/v;var e},E=(b(1)-T)/_;if(Math.abs(v)<1e-6||!isFinite(E)){if(Math.abs(y-A)<1e-6)return this.easeTo(e,i);const t=A<y?-1:1;E=Math.abs(Math.log(A/y))/_,M=function(){return 0},C=function(e){return Math.exp(t*_*e)}}e.duration="duration"in e?+e.duration:1e3*E/("screenSpeed"in e?+e.screenSpeed/_:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const I=o!==l,L=c!==s,P=r=>u=>{const h=u*E,d=1/C(h);r.zoom=1===u?a:n+r.scaleZoom(d),I&&(r.bearing=t.U(o,l,u)),L&&(r.pitch=t.U(s,c,u));const _=1===u?f:r.unproject(m.add(g.mult(M(h))).mult(d));return r.setLocationAtPoint(r.renderWorldCopies?_.wrap():_,p),r._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),r};if(e.preloadOnly){const t=this._emulate(P,e.duration,r);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=I,this._pitching=L,this._prepareEase(i,!1),this._ease(P(r),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,r){!1===r.animate||0===r.duration?(e(1),i()):(this._easeStart=t.f.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.f.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.bh(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.f.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,i){const r=Math.ceil(15*e/1e3),n=[],o=t(i.clone());for(let t=0;t<=r;t++){const e=o(t/r);n.push(e.clone())}return n}}class ra{constructor(e={}){this.options=e,t.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.d5.ACCESS_TOKEN}];if(e){const r=i.reduce(((t,e,r)=>(e.value&&(t+=`${e.key}=${e.value}${r<i.length-1?"&":""}`),t)),"?");e.href=`${t.d5.FEEDBACK_URL}/${r}#${os(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const i in e){const r=e[i];if(r.used){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class na{constructor(){t.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class oa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function sa(e,i,r){if(e=new t.bn(e.lng,e.lat),i){const n=new t.bn(e.lng-360,e.lat),o=new t.bn(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),a=r.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<a&&(l||Math.abs(n.lng-r.center.lng)<s)?e=n:r.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-r.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class la extends t.E{constructor(e,i){if(super(),(e instanceof HTMLElement||i)&&(e=t.e({element:e},i)),t.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,r=27,n=s("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},n));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=t.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const r=this._element.classList;for(const t in aa)r.remove(`mapboxgl-marker-anchor-${t}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const n=e&&e.className?e.className.trim().split(/\s+/):[];r.add(...n),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.bn.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),r=t.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const r=e.unproject(i);let n;e._showingGlobe()&&t.d6(e.transform,this._lngLat)?n=0:(n=1-e._queryFogOpacity(r),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${aa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!e||"map"!==r)return"";if(!i._showingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const n=t.bF(t.d7(i.transform,this._lngLat)),o=e.sub(t.d8(i.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(0===s)return"";const a=n/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(i._showingGlobe()){const e=i.project(new t.bn(this._lngLat.lng,this._lngLat.lat+.001)),n=i.project(new t.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);r=t.bF(Math.atan2(n.y,n.x))-90}else r=-i.getBearing();else if("horizon"===n){const n=t.O(4,6,i.getZoom()),o=t.d8(i.transform);o.y+=n*i.transform.height;const s=e.sub(o),a=t.bF(Math.atan2(s.y,s.x));r=(a>90?a-270:a+90)*(1-n)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=sa(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),e._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(e){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;if(e.point.dist(r)<t)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.b("dragstart"))),this.fire(new t.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.b("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ca={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ua=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ha(e=new t.P(0,0),i="bottom"){if("number"==typeof e){const r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.P(0,e);case"top-left":return new t.P(r,r);case"top-right":return new t.P(-r,r);case"bottom":return new t.P(0,-e);case"bottom-left":return new t.P(r,-r);case"bottom-right":return new t.P(-r,-r);case"left":return new t.P(e,0);case"right":return new t.P(-e,0)}return new t.P(0,0)}return e instanceof t.P||Array.isArray(e)?t.P.convert(e):t.P.convert(e[i]||[0,0])}class pa{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.cc((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const da={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class ma{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const ga={showCompass:!0,showZoom:!0,visualizePitch:!1};class _a{constructor(e,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Ms({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new Es({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const i=this.map,r=this.mouseRotate.mousemoveWindow(t,e),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(t,e),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,f(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=m(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ya={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Aa={maxWidth:100,unit:"metric"},va={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},xa={version:t.dk,supported:i,setRTLTextPlugin:t.dm,getRTLTextPluginStatus:t.dn,Map:class extends ia{constructor(e){const i=e;if(null!=(e=t.e({},fa,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.d9(window)&&(e.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new mr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!1,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new oa,this._domRenderTaskQueue=new oa,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.aC(),this._locale=t.e({},da,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new pa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new t.da(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){const t=document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=t}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new ma,this._tp=e.devtools?new Qo(this):new Qo,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,(t=>{this.repaint=t})),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,(t=>{this.showTileAABBs=t})),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,(t=>{this.showPadding=t})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,(()=>{this._update()})),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,(()=>{this._update()})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ta(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||t.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new ns("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const r=e.bounds;r&&(this.resize(),this.fitBounds(r,t.e({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new ra({customAttribution:e.customAttribution})),this._logoControl=new na,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.b(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.b(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.b("movestart",e)).fire(new t.b("move",e)),this.fire(new t.b("resize",e)),i&&this.fire(new t.b("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.ad.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.b("zoomstart")).fire(new t.b("zoom")).fire(new t.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.b("zoomstart")).fire(new t.b("zoom")).fire(new t.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.b("pitchstart")).fire(new t.b("pitch")).fire(new t.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.b("pitchstart")).fire(new t.b("pitch")).fire(new t.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?navigator.language:t)):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,i=e.projection.name;let r;"globe"===i&&e.zoom>=t.bx?(e.setMercatorFromTransition(),r=!0):"mercator"===i&&e.zoom<t.bx&&(e.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let i;return i="globe"===e.name&&this.transform.zoom>=t.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(t.bn.convert(e))}unproject(e){return this.transform.pointLocation3D(t.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t))),s=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new fs(t,this,n.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{const o=e.filter((t=>this.getLayer(t)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new fs(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new fs(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=e.filter((t=>this.getLayer(t))),n=r.length?this.queryRenderedFeatures(t.point,{layers:r}):[];n.length&&(t.features=n,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:r}}}}on(t,e,i){if(void 0===i)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const r=this._createDelegatedListener(t,e,i);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){if(void 0===i)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(const t of e)if(!this._isValidId(t))return this;const r=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[t]:void 0;return n&&(t=>{for(let n=0;n<t.length;n++){const o=t[n];if(o.listener===i&&r(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(n,1),this}}})(n),this}queryRenderedFeatures(e,i){if(!this.style)return[];if(void 0!==i||void 0===e||e instanceof t.P||Array.isArray(e)||(i=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const t of i.layers)if(!this._isValidId(t))return[];return this.style.queryRenderedFeatures(e,i,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(e){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&t.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(e))}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new kr(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),n=this._requestManager.transformRequest(r,t.R.Style);t.g(n,((e,r)=>{e?this.fire(new t.a(e)):r&&this._updateDiff(r,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new t.a(new Error("IDs can't be empty."))),!1):!t.c4(e)||(this.fire(new t.a(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(e,i,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:c,data:u}=t.f.getImageData(i);this.style.addImage(e,{data:new t.h({width:l,height:c},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new t.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(e,{data:new t.h({width:l,height:c},new Uint8Array(u.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,i){this._lazyInitEmptyStyle();const r=this.style.getImage(e);if(!r)return void this.fire(new t.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?t.f.getImageData(i):i,{width:o,height:s}=n,a=n.data;if(void 0===o||void 0===s)return void this.fire(new t.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||s!==r.data.height)return void this.fire(new t.a(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`)));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);r.data.replace(a,l),this.style.updateImage(e,r)}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new t.a(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.d(this._requestManager.transformRequest(e,t.R.Image),((e,r)=>{i(e,r instanceof HTMLImageElement?t.f.getImageData(r):r)}))}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new t.a(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}getSlot(t){const e=this.getLayer(t);return e&&e.slot||null}setSlot(t,e){return this.style.setSlot(t,e),this.style.mergeLayers(),this._update(!0)}addImport(t,e){return this.style.addImport(t,e),this}updateImport(t,e){return"string"!=typeof e&&e.id!==t?(this.removeImport(t),this.addImport(e)):(this.style.updateImport(t,e),this._update(!0))}removeImport(t){return this.style.removeImport(t),this}moveImport(t,e){return this.style.moveImport(t,e),this._update(!0)}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,r),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,r={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,r),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.bn.convert(e),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,r,n,o=this._container;for(;o&&(!r||!n);){const t=window.getComputedStyle(o).transform;t&&"none"!==t&&(i=t.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(n=i[3])),o=o.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=n?Math.abs(e/n):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._canvas=o("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{r[t]=o("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const r=t.f.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const e=t.e({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",e);r?(t.db(r,!0),this.painter=new is(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.dc.testSupport(r)):this.fire(new t.a(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.b("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.b("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;this.fire(new t.b("renderstart"));const r=this.painter.context.extTimerQuery,n=t.f.now(),o=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=o.createQuery(),o.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,r=t.f.now(),n=new t.K(e,{now:r,fadeDuration:s,pitch:i,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const e=t.f.now()-n;o.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const r=o.getQueryParameter(i,o.QUERY_RESULT)/1e6;o.deleteQuery(i),this.fire(new t.b("gpu-timing-frame",{cpuTime:e,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.b("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.b("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(n,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.b("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&t.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.df||401===e.status)){const e=this.painter.context.gl;t.db(e,!1),this._logoControl instanceof na&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(t),e.canvasCopies.map(n),e.timeStamps)}_canvasPixelComparison(t,e,i){let r=i[1]-i[0];const n=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);r+=(i[o+2]-i[o+1])*(1-a/n)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.dh(this.painter.context.gl),t.di.remove(),t.dj.remove(),this._removed=!0,this.fire(new t.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.f.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?Object.values(this.style._sourceCaches):[];return t.b1(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(t){this._showParseStatus!==t&&(this._showParseStatus=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(e,i){t.dl(e,i)}get version(){return t.dk}},NavigationControl:class{constructor(e){this.options=t.e({},ga,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _a(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=o("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.E{constructor(e){super();const i=navigator.geolocation;this.options=t.e({geolocation:i},ya,e),t.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=rs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((t=>e("denied"!==t.state))).catch((()=>e())):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.b("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.b("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.bn(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.e({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.bn(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.bl(1,e._center.lat)*e.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.b("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new la({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new la({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.b("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ra,ScaleControl:class{constructor(e){this.options=t.e({},Aa,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(t){return!1}}(),t.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,r=e._containerWidth/2-t/2,n=e.unproject([r,i]),o=e.unproject([r+t,i]),s=n.distanceTo(o);if("imperial"===this.options.unit){const e=3.2808*s;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,s/1852,"nautical-mile"):s>=1e3?this._setScale(t,s/1e3,"kilometer"):this._setScale(t,s,"meter")}_setScale(t,e,i){this._map._requestDomTask((()=>{const r=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),n=r/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):`${r}&nbsp;${va[i]}`,this._container.style.width=t*n+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),t.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(e){super(),this.options=t.e(Object.create(ca),e),t.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.b("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.bn.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,r=this._pos;if(!e||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,s=r.x<n/2,a=r.x>e.transform.width-n/2;if(r.y+t<o)return s?"top-left":a?"top-right":"top";if(r.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=sa(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const t=this._pos=this._trackPointer&&e?e:i.project(this._lngLat),r=ha(this.options.offset),n=this._anchor=this._getAnchor(r.y),o=ha(this.options.offset,n),s=t.add(o).round();i._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${aa[n]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const e=t.d6(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(ua);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:la,Style:kr,LngLat:t.bn,LngLatBounds:t.ad,Point:t.P,MercatorCoordinate:t.L,FreeCameraOptions:hr,Evented:t.E,config:t.d5,prewarm:t.dp,clearPrewarmedResources:t.dq,get accessToken(){return t.d5.ACCESS_TOKEN},set accessToken(e){t.d5.ACCESS_TOKEN=e},get baseApiUrl(){return t.d5.API_URL},set baseApiUrl(e){t.d5.API_URL=e},get workerCount(){return t.dr.workerCount},set workerCount(e){t.dr.workerCount=e},get maxParallelImageRequests(){return t.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.d5.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.ds(e)},get workerUrl(){return t.dt.workerUrl},set workerUrl(e){t.dt.workerUrl=e},get workerClass(){return t.dt.workerClass},set workerClass(e){t.dt.workerClass=e},get workerParams(){return t.dt.workerParams},set workerParams(e){t.dt.workerParams=e},get dracoUrl(){return t.du()},set dracoUrl(e){t.dv(e)},get meshoptUrl(){return t.dw()},set meshoptUrl(e){t.dx(e)},setNow:t.f.setNow,restoreNow:t.f.restoreNow};return xa})),i}()},73367:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>h,gK:()=>d,sY:()=>p});var r=6,n="AJSAJS",o="AFAFAF",s=65,a=73,l=79,c=86,u=90;const h={forward:p,inverse:function(t){var e=g(y(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:d};function p(t,e){return e=e||5,function(t,e){var i,r,h,p,d,f,m,g,y,A,v,x="00000"+t.easting,b="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(y=t.easting,A=t.northing,v=_(t.zoneNumber),i=Math.floor(y/1e5),r=Math.floor(A/1e5)%20,h=v-1,p=n.charCodeAt(h),d=o.charCodeAt(h),g=!1,(f=p+i-1)>u&&(f=f-u+s-1,g=!0),(f===a||p<a&&f>a||(f>a||p<a)&&g)&&f++,(f===l||p<l&&f>l||(f>l||p<l)&&g)&&++f===a&&f++,f>u&&(f=f-u+s-1),(m=d+r)>c?(m=m-c+s-1,g=!0):g=!1,(m===a||d<a&&m>a||(m>a||d<a)&&g)&&m++,(m===l||d<l&&m>l||(m>l||d<l)&&g)&&++m===a&&m++,m>c&&(m=m-c+s-1),String.fromCharCode(f)+String.fromCharCode(m))+x.substr(x.length-5,e)+b.substr(b.length-5,e)}(function(t){var e,i,r,n,o,s,a,l=t.lat,c=t.lon,u=6378137,h=.00669438,p=.9996,d=f(l),m=f(c);a=Math.floor((c+180)/6)+1,180===c&&(a=60),l>=56&&l<64&&c>=3&&c<12&&(a=32),l>=72&&l<84&&(c>=0&&c<9?a=31:c>=9&&c<21?a=33:c>=21&&c<33?a=35:c>=33&&c<42&&(a=37)),s=f(6*(a-1)-180+3),e=.006739496752268451,i=u/Math.sqrt(1-h*Math.sin(d)*Math.sin(d)),r=Math.tan(d)*Math.tan(d),n=e*Math.cos(d)*Math.cos(d);var g,_,y=p*i*((o=Math.cos(d)*(m-s))+(1-r+n)*o*o*o/6+(5-18*r+r*r+72*n-58*e)*o*o*o*o*o/120)+5e5,A=p*(u*(.9983242984503243*d-.002514607064228144*Math.sin(2*d)+2639046602129982e-21*Math.sin(4*d)-3.418046101696858e-9*Math.sin(6*d))+i*Math.tan(d)*(o*o/2+(5-r+9*n+4*n*n)*o*o*o*o/24+(61-58*r+r*r+600*n-2.2240339282485886)*o*o*o*o*o*o/720));return l<0&&(A+=1e7),{northing:Math.round(A),easting:Math.round(y),zoneNumber:a,zoneLetter:(g=l,_="Z",84>=g&&g>=72?_="X":72>g&&g>=64?_="W":64>g&&g>=56?_="V":56>g&&g>=48?_="U":48>g&&g>=40?_="T":40>g&&g>=32?_="S":32>g&&g>=24?_="R":24>g&&g>=16?_="Q":16>g&&g>=8?_="P":8>g&&g>=0?_="N":0>g&&g>=-8?_="M":-8>g&&g>=-16?_="L":-16>g&&g>=-24?_="K":-24>g&&g>=-32?_="J":-32>g&&g>=-40?_="H":-40>g&&g>=-48?_="G":-48>g&&g>=-56?_="F":-56>g&&g>=-64?_="E":-64>g&&g>=-72?_="D":-72>g&&g>=-80&&(_="C"),_)}}({lat:t[1],lon:t[0]}),e)}function d(t){var e=g(y(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function f(t){return t*(Math.PI/180)}function m(t){return t/Math.PI*180}function g(t){var e=t.northing,i=t.easting,r=t.zoneLetter,n=t.zoneNumber;if(n<0||n>60)return null;var o,s,a,l,c,u,h,p,d,f=.9996,_=6378137,y=.00669438,A=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),v=i-5e5,x=e;r<"N"&&(x-=1e7),h=6*(n-1)-180+3,o=.006739496752268451,d=(p=x/f/6367449.145945056)+(3*A/2-27*A*A*A/32)*Math.sin(2*p)+(21*A*A/16-55*A*A*A*A/32)*Math.sin(4*p)+151*A*A*A/96*Math.sin(6*p),s=_/Math.sqrt(1-y*Math.sin(d)*Math.sin(d)),a=Math.tan(d)*Math.tan(d),l=o*Math.cos(d)*Math.cos(d),c=.99330562*_/Math.pow(1-y*Math.sin(d)*Math.sin(d),1.5),u=v/(s*f);var b=d-s*Math.tan(d)/c*(u*u/2-(5+3*a+10*l-4*l*l-9*o)*u*u*u*u/24+(61+90*a+298*l+45*a*a-1.6983531815716497-3*l*l)*u*u*u*u*u*u/720);b=m(b);var w,S=(u-(1+2*a+l)*u*u*u/6+(5-2*l+28*a-3*l*l+8*o+24*a*a)*u*u*u*u*u/120)/Math.cos(d);if(S=h+m(S),t.accuracy){var T=g({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:T.lat,right:T.lon,bottom:b,left:S}}else w={lat:b,lon:S};return w}function _(t){var e=t%r;return 0===e&&(e=r),e}function y(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,r=null,h="",p=0;!/[A-Z]/.test(e=t.charAt(p));){if(p>=2)throw"MGRSPoint bad conversion from: "+t;h+=e,p++}var d=parseInt(h,10);if(0===p||p+3>i)throw"MGRSPoint bad conversion from: "+t;var f=t.charAt(p++);if(f<="A"||"B"===f||"Y"===f||f>="Z"||"I"===f||"O"===f)throw"MGRSPoint zone letter "+f+" not handled: "+t;r=t.substring(p,p+=2);for(var m=_(d),g=function(t,e){for(var i=n.charCodeAt(e-1),r=1e5,o=!1;i!==t.charCodeAt(0);){if(++i===a&&i++,i===l&&i++,i>u){if(o)throw"Bad character: "+t;i=s,o=!0}r+=1e5}return r}(r.charAt(0),m),y=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=o.charCodeAt(e-1),r=0,n=!1;i!==t.charCodeAt(0);){if(++i===a&&i++,i===l&&i++,i>c){if(n)throw"Bad character: "+t;i=s,n=!0}r+=1e5}return r}(r.charAt(1),m);y<A(f);)y+=2e6;var v=i-p;if(v%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var x,b,w,S=v/2,T=0,C=0;return S>0&&(x=1e5/Math.pow(10,S),b=t.substring(p,p+S),T=parseFloat(b)*x,w=t.substring(p+S),C=parseFloat(w)*x),{easting:T+g,northing:C+y,zoneLetter:f,zoneNumber:d,accuracy:x}}function A(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}},45228:t=>{"use strict";var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,n){for(var o,s,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))i.call(o,c)&&(a[c]=o[c]);if(e){s=e(o);for(var u=0;u<s.length;u++)r.call(o,s[u])&&(a[s[u]]=o[s[u]])}}return a}},58859:(t,e,i)=>{var r="function"==typeof Map&&Map.prototype,n=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=r&&n&&"function"==typeof n.get?n.get:null,s=r&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,p="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,d="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,A=String.prototype.replace,v=String.prototype.toUpperCase,x=String.prototype.toLowerCase,b=RegExp.prototype.test,w=Array.prototype.concat,S=Array.prototype.join,T=Array.prototype.slice,C=Math.floor,M="function"==typeof BigInt?BigInt.prototype.valueOf:null,E=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,L="function"==typeof Symbol&&"object"==typeof Symbol.iterator,P="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,k=Object.prototype.propertyIsEnumerable,N=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function D(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||b.call(/e/,e))return e;var i=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-C(-t):C(t);if(r!==t){var n=String(r),o=y.call(e,n.length+1);return A.call(n,i,"$&_")+"."+A.call(A.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return A.call(e,i,"$&_")}var O=i(42634),R=O.custom,F=j(R)?R:null;function z(t,e,i){var r="double"===(i.quoteStyle||e)?'"':"'";return r+t+r}function B(t){return A.call(String(t),/"/g,"&quot;")}function U(t){return!("[object Array]"!==q(t)||P&&"object"==typeof t&&P in t)}function V(t){return!("[object RegExp]"!==q(t)||P&&"object"==typeof t&&P in t)}function j(t){if(L)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!I)return!1;try{return I.call(t),!0}catch(t){}return!1}t.exports=function t(e,i,r,n){var a=i||{};if(Z(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Z(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!Z(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Z(a,"indent")&&null!==a.indent&&"\t"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Z(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var m=a.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return H(e,a);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var v=String(e);return m?D(e,v):v}if("bigint"==typeof e){var b=String(e)+"n";return m?D(e,b):b}var C=void 0===a.depth?5:a.depth;if(void 0===r&&(r=0),r>=C&&C>0&&"object"==typeof e)return U(e)?"[Array]":"[Object]";var E=function(t,e){var i;if("\t"===t.indent)i="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;i=S.call(Array(t.indent+1)," ")}return{base:i,prev:S.call(Array(e+1),i)}}(a,r);if(void 0===n)n=[];else if(W(n,e)>=0)return"[Circular]";function R(e,i,o){if(i&&(n=T.call(n)).push(i),o){var s={depth:a.depth};return Z(a,"quoteStyle")&&(s.quoteStyle=a.quoteStyle),t(e,s,r+1,n)}return t(e,a,r+1,n)}if("function"==typeof e&&!V(e)){var G=function(t){if(t.name)return t.name;var e=_.call(g.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}(e),J=Q(e,R);return"[Function"+(G?": "+G:" (anonymous)")+"]"+(J.length>0?" { "+S.call(J,", ")+" }":"")}if(j(e)){var tt=L?A.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(e);return"object"!=typeof e||L?tt:K(tt)}if(function(t){return!(!t||"object"!=typeof t)&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)}(e)){for(var et="<"+x.call(String(e.nodeName)),it=e.attributes||[],rt=0;rt<it.length;rt++)et+=" "+it[rt].name+"="+z(B(it[rt].value),"double",a);return et+=">",e.childNodes&&e.childNodes.length&&(et+="..."),et+"</"+x.call(String(e.nodeName))+">"}if(U(e)){if(0===e.length)return"[]";var nt=Q(e,R);return E&&!function(t){for(var e=0;e<t.length;e++)if(W(t[e],"\n")>=0)return!1;return!0}(nt)?"["+X(nt,E)+"]":"[ "+S.call(nt,", ")+" ]"}if(function(t){return!("[object Error]"!==q(t)||P&&"object"==typeof t&&P in t)}(e)){var ot=Q(e,R);return"cause"in Error.prototype||!("cause"in e)||k.call(e,"cause")?0===ot.length?"["+String(e)+"]":"{ ["+String(e)+"] "+S.call(ot,", ")+" }":"{ ["+String(e)+"] "+S.call(w.call("[cause]: "+R(e.cause),ot),", ")+" }"}if("object"==typeof e&&l){if(F&&"function"==typeof e[F]&&O)return O(e,{depth:C-r});if("symbol"!==l&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!o||!t||"object"!=typeof t)return!1;try{o.call(t);try{c.call(t)}catch(t){return!0}return t instanceof Map}catch(t){}return!1}(e)){var st=[];return s&&s.call(e,(function(t,i){st.push(R(i,e,!0)+" => "+R(t,e))})),Y("Map",o.call(e),st,E)}if(function(t){if(!c||!t||"object"!=typeof t)return!1;try{c.call(t);try{o.call(t)}catch(t){return!0}return t instanceof Set}catch(t){}return!1}(e)){var at=[];return u&&u.call(e,(function(t){at.push(R(t,e))})),Y("Set",c.call(e),at,E)}if(function(t){if(!h||!t||"object"!=typeof t)return!1;try{h.call(t,h);try{p.call(t,p)}catch(t){return!0}return t instanceof WeakMap}catch(t){}return!1}(e))return $("WeakMap");if(function(t){if(!p||!t||"object"!=typeof t)return!1;try{p.call(t,p);try{h.call(t,h)}catch(t){return!0}return t instanceof WeakSet}catch(t){}return!1}(e))return $("WeakSet");if(function(t){if(!d||!t||"object"!=typeof t)return!1;try{return d.call(t),!0}catch(t){}return!1}(e))return $("WeakRef");if(function(t){return!("[object Number]"!==q(t)||P&&"object"==typeof t&&P in t)}(e))return K(R(Number(e)));if(function(t){if(!t||"object"!=typeof t||!M)return!1;try{return M.call(t),!0}catch(t){}return!1}(e))return K(R(M.call(e)));if(function(t){return!("[object Boolean]"!==q(t)||P&&"object"==typeof t&&P in t)}(e))return K(f.call(e));if(function(t){return!("[object String]"!==q(t)||P&&"object"==typeof t&&P in t)}(e))return K(R(String(e)));if("undefined"!=typeof window&&e===window)return"{ [object Window] }";if(e===global)return"{ [object globalThis] }";if(!function(t){return!("[object Date]"!==q(t)||P&&"object"==typeof t&&P in t)}(e)&&!V(e)){var lt=Q(e,R),ct=N?N(e)===Object.prototype:e instanceof Object||e.constructor===Object,ut=e instanceof Object?"":"null prototype",ht=!ct&&P&&Object(e)===e&&P in e?y.call(q(e),8,-1):ut?"Object":"",pt=(ct||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(ht||ut?"["+S.call(w.call([],ht||[],ut||[]),": ")+"] ":"");return 0===lt.length?pt+"{}":E?pt+"{"+X(lt,E)+"}":pt+"{ "+S.call(lt,", ")+" }"}return String(e)};var G=Object.prototype.hasOwnProperty||function(t){return t in this};function Z(t,e){return G.call(t,e)}function q(t){return m.call(t)}function W(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1}function H(t,e){if(t.length>e.maxStringLength){var i=t.length-e.maxStringLength,r="... "+i+" more character"+(i>1?"s":"");return H(y.call(t,0,e.maxStringLength),e)+r}return z(A.call(A.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,J),"single",e)}function J(t){var e=t.charCodeAt(0),i={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return i?"\\"+i:"\\x"+(e<16?"0":"")+v.call(e.toString(16))}function K(t){return"Object("+t+")"}function $(t){return t+" { ? }"}function Y(t,e,i,r){return t+" ("+e+") {"+(r?X(i,r):S.call(i,", "))+"}"}function X(t,e){if(0===t.length)return"";var i="\n"+e.prev+e.base;return i+S.call(t,","+i)+"\n"+e.prev}function Q(t,e){var i=U(t),r=[];if(i){r.length=t.length;for(var n=0;n<t.length;n++)r[n]=Z(t,n)?e(t[n],t):""}var o,s="function"==typeof E?E(t):[];if(L){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in t)Z(t,l)&&(i&&String(Number(l))===l&&l<t.length||L&&o["$"+l]instanceof Symbol||(b.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof E)for(var c=0;c<s.length;c++)k.call(t,s[c])&&r.push("["+e(s[c])+"]: "+e(t[s[c]],t));return r}},89211:t=>{"use strict";var e=function(t){return t!=t};t.exports=function(t,i){return 0===t&&0===i?1/t==1/i:t===i||!(!e(t)||!e(i))}},37653:(t,e,i)=>{"use strict";var r=i(38452),n=i(10487),o=i(89211),s=i(9394),a=i(36576),l=n(s(),Object);r(l,{getPolyfill:s,implementation:o,shim:a}),t.exports=l},9394:(t,e,i)=>{"use strict";var r=i(89211);t.exports=function(){return"function"==typeof Object.is?Object.is:r}},36576:(t,e,i)=>{"use strict";var r=i(9394),n=i(38452);t.exports=function(){var t=r();return n(Object,{is:t},{is:function(){return Object.is!==t}}),t}},28875:(t,e,i)=>{"use strict";var r;if(!Object.keys){var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=i(1093),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(t){var e=t.constructor;return e&&e.prototype===t},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},d=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!p["$"+t]&&n.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{h(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();r=function(t){var e=null!==t&&"object"==typeof t,i="[object Function]"===o.call(t),r=s(t),a=e&&"[object String]"===o.call(t),p=[];if(!e&&!i&&!r)throw new TypeError("Object.keys called on a non-object");var f=c&&i;if(a&&t.length>0&&!n.call(t,0))for(var m=0;m<t.length;++m)p.push(String(m));if(r&&t.length>0)for(var g=0;g<t.length;++g)p.push(String(g));else for(var _ in t)f&&"prototype"===_||!n.call(t,_)||p.push(String(_));if(l)for(var y=function(t){if("undefined"==typeof window||!d)return h(t);try{return h(t)}catch(t){return!1}}(t),A=0;A<u.length;++A)y&&"constructor"===u[A]||!n.call(t,u[A])||p.push(u[A]);return p}}t.exports=r},1189:(t,e,i)=>{"use strict";var r=Array.prototype.slice,n=i(1093),o=Object.keys,s=o?function(t){return o(t)}:i(28875),a=Object.keys;s.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return n(t)?a(r.call(t)):a(t)})}else Object.keys=s;return Object.keys||s},t.exports=s},1093:t=>{"use strict";var e=Object.prototype.toString;t.exports=function(t){var i=e.call(t),r="[object Arguments]"===i;return r||(r="[object Array]"!==i&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),r}},36940:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(87892);function n(t){return fetch(t).then((function(t){return t.body&&t.body.getReader?t.body.getReader():t.arrayBuffer().then(r.A)}))}},74772:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(36940),n=i(30073);function o(t){return("function"==typeof fetch?r.A:n.A)(t)}},30073:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(87892);function n(t){return new Promise((function(e,i){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.onload=function(){e((0,r.A)(n.response))},n.onerror=i,n.ontimeout=i,n.open("GET",t,!0),n.send()}))}},3841:t=>{t.exports=function(t,e,i,r){var n=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===r&&(r=e.length);for(var a=(r-i)/2,l=0,c=a-1;l<a;c=l++){var u=e[i+2*l+0],h=e[i+2*l+1],p=e[i+2*c+0],d=e[i+2*c+1];h>o!=d>o&&n<(p-u)*(o-h)/(d-h)+u&&(s=!s)}return s}},51476:(t,e,i)=>{var r=i(3841),n=i(61137);t.exports=function(t,e,i,o){return e.length>0&&Array.isArray(e[0])?n(t,e,i,o):r(t,e,i,o)},t.exports.nested=n,t.exports.flat=r},61137:t=>{t.exports=function(t,e,i,r){var n=t[0],o=t[1],s=!1;void 0===i&&(i=0),void 0===r&&(r=e.length);for(var a=r-i,l=0,c=a-1;l<a;c=l++){var u=e[l+i][0],h=e[l+i][1],p=e[c+i][0],d=e[c+i][1];h>o!=d>o&&n<(p-u)*(o-h)/(d-h)+u&&(s=!s)}return s}},59004:function(t,e,i){var r=i(40047);t.exports=function(){"use strict";function t(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var e=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function i(t,e){return t>e?1:t<e?-1:0}function n(t,i,r){for(var n=new e(null,null),o=n,s=n;;){var a=r(t,i.key);if(a<0){if(null===i.left)break;if(r(t,i.left.key)<0){var l=i.left;if(i.left=l.right,l.right=i,null===(i=l).left)break}s.left=i,s=i,i=i.left}else{if(!(a>0))break;if(null===i.right)break;if(r(t,i.right.key)>0&&(l=i.right,i.right=l.left,l.left=i,null===(i=l).right))break;o.right=i,o=i,i=i.right}}return o.right=i.left,s.left=i.right,i.left=n.right,i.right=n.left,i}function o(t,i,r,o){var s=new e(t,i);if(null===r)return s.left=s.right=null,s;var a=o(t,(r=n(t,r,o)).key);return a<0?(s.left=r.left,s.right=r,r.left=null):a>=0&&(s.right=r.right,s.left=r,r.right=null),s}function s(t,e,i){var r=null,o=null;if(e){var s=i((e=n(t,e,i)).key,t);0===s?(r=e.left,o=e.right):s<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}function a(t,e,i,r,n){if(t){r(e+(i?" ":" ")+n(t)+"\n");var o=e+(i?"    ":"   ");t.left&&a(t.left,o,!1,r,n),t.right&&a(t.right,o,!0,r,n)}}var l=function(){function r(t){void 0===t&&(t=i),this._root=null,this._size=0,this._comparator=t}return r.prototype.insert=function(t,e){return this._size++,this._root=o(t,e,this._root,this._comparator)},r.prototype.add=function(t,i){var r=new e(t,i);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var o=this._comparator,s=n(t,this._root,o),a=o(t,s.key);return 0===a?this._root=s:(a<0?(r.left=s.left,r.right=s,s.left=null):a>0&&(r.right=s.right,r.left=s,s.right=null),this._size++,this._root=r),this._root},r.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},r.prototype._remove=function(t,e,i){var r;return null===e?null:0===i(t,(e=n(t,e,i)).key)?(null===e.left?r=e.right:(r=n(t,e.left,i)).right=e.right,this._size--,r):e},r.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=n(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},r.prototype.findStatic=function(t){for(var e=this._root,i=this._comparator;e;){var r=i(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},r.prototype.find=function(t){return this._root&&(this._root=n(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},r.prototype.contains=function(t){for(var e=this._root,i=this._comparator;e;){var r=i(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},r.prototype.forEach=function(t,e){for(var i=this._root,r=[],n=!1;!n;)null!==i?(r.push(i),i=i.left):0!==r.length?(i=r.pop(),t.call(e,i),i=i.right):n=!0;return this},r.prototype.range=function(t,e,i,r){for(var n=[],o=this._comparator,s=this._root;0!==n.length||s;)if(s)n.push(s),s=s.left;else{if(o((s=n.pop()).key,e)>0)break;if(o(s.key,t)>=0&&i.call(r,s))return this;s=s.right}return this},r.prototype.keys=function(){var t=[];return this.forEach((function(e){var i=e.key;return t.push(i)})),t},r.prototype.values=function(){var t=[];return this.forEach((function(e){var i=e.data;return t.push(i)})),t},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},r.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},r.prototype.at=function(t){for(var e=this._root,i=!1,r=0,n=[];!i;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),r===t)return e;r++,e=e.right}else i=!0;return null},r.prototype.next=function(t){var e=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var r=this._comparator;e;){var n=r(t.key,e.key);if(0===n)break;n<0?(i=e,e=e.left):e=e.right}return i},r.prototype.prev=function(t){var e=this._root,i=null;if(null!==t.left){for(i=t.left;i.right;)i=i.right;return i}for(var r=this._comparator;e;){var n=r(t.key,e.key);if(0===n)break;n<0?e=e.left:(i=e,e=e.right)}return i},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return function(t){for(var i=t,r=[],n=!1,o=new e(null,null),s=o;!n;)i?(r.push(i),i=i.left):r.length>0?i=(i=s=s.next=r.pop()).right:n=!0;return s.next=null,o.next}(this._root)},r.prototype.load=function(t,i,r){void 0===i&&(i=[]),void 0===r&&(r=!1);var n=t.length,o=this._comparator;if(r&&h(t,i,0,n-1,o),null===this._root)this._root=c(t,i,0,n),this._size=n;else{var s=function(t,i,r){for(var n=new e(null,null),o=n,s=t,a=i;null!==s&&null!==a;)r(s.key,a.key)<0?(o.next=s,s=s.next):(o.next=a,a=a.next),o=o.next;return null!==s?o.next=s:null!==a&&(o.next=a),n.next}(this.toList(),function(t,i){for(var r=new e(null,null),n=r,o=0;o<t.length;o++)n=n.next=new e(t[o],i[o]);return n.next=null,r.next}(t,i),o);n=this._size+n,this._root=u({head:s},0,n)}return this},r.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return a(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},r.prototype.update=function(t,e,i){var r=this._comparator,a=s(t,this._root,r),l=a.left,c=a.right;r(t,e)<0?c=o(e,i,c,r):l=o(e,i,l,r),this._root=function(t,e,i){return null===e?t:(null===t||((e=n(t.key,e,i)).left=t),e)}(l,c,r)},r.prototype.split=function(t){return s(t,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,i,r;return t(this,(function(t){switch(t.label){case 0:e=this._root,i=[],r=!1,t.label=1;case 1:return r?[3,6]:null===e?[3,2]:(i.push(e),e=e.left,[3,5]);case 2:return 0===i.length?[3,4]:[4,e=i.pop()];case 3:return t.sent(),e=e.right,[3,5];case 4:r=!0,t.label=5;case 5:return[3,1];case 6:return[2]}}))},r}();function c(t,i,r,n){var o=n-r;if(o>0){var s=r+Math.floor(o/2),a=t[s],l=i[s],u=new e(a,l);return u.left=c(t,i,r,s),u.right=c(t,i,s+1,n),u}return null}function u(t,e,i){var r=i-e;if(r>0){var n=e+Math.floor(r/2),o=u(t,e,n),s=t.head;return s.left=o,t.head=t.head.next,s.right=u(t,n+1,i),s}return null}function h(t,e,i,r,n){if(!(i>=r)){for(var o=t[i+r>>1],s=i-1,a=r+1;;){do{s++}while(n(t[s],o)<0);do{a--}while(n(t[a],o)>0);if(s>=a)break;var l=t[s];t[s]=t[a],t[a]=l,l=e[s],e[s]=e[a],e[a]=l}h(t,e,i,a,n),h(t,e,a+1,r,n)}}const p=(t,e)=>t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y,d=(t,e)=>{if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;const i=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:i,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}};let f=Number.EPSILON;void 0===f&&(f=Math.pow(2,-52));const m=f*f,g=(t,e)=>{if(-f<t&&t<f&&-f<e&&e<f)return 0;const i=t-e;return i*i<m*t*e?0:t<e?-1:1};class _{constructor(){this.tree=new l,this.round(0)}round(t){const e=this.tree.add(t),i=this.tree.prev(e);if(null!==i&&0===g(e.key,i.key))return this.tree.remove(t),i.key;const r=this.tree.next(e);return null!==r&&0===g(e.key,r.key)?(this.tree.remove(t),r.key):t}}const y=new class{constructor(){this.reset()}reset(){this.xRounder=new _,this.yRounder=new _}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}},A=11102230246251565e-32,v=134217729,x=(3+8*A)*A;function b(t,e,i,r,n){let o,s,a,l,c=e[0],u=r[0],h=0,p=0;u>c==u>-c?(o=c,c=e[++h]):(o=u,u=r[++p]);let d=0;if(h<t&&p<i)for(u>c==u>-c?(s=c+o,a=o-(s-c),c=e[++h]):(s=u+o,a=o-(s-u),u=r[++p]),o=s,0!==a&&(n[d++]=a);h<t&&p<i;)u>c==u>-c?(s=o+c,l=s-o,a=o-(s-l)+(c-l),c=e[++h]):(s=o+u,l=s-o,a=o-(s-l)+(u-l),u=r[++p]),o=s,0!==a&&(n[d++]=a);for(;h<t;)s=o+c,l=s-o,a=o-(s-l)+(c-l),c=e[++h],o=s,0!==a&&(n[d++]=a);for(;p<i;)s=o+u,l=s-o,a=o-(s-l)+(u-l),u=r[++p],o=s,0!==a&&(n[d++]=a);return 0===o&&0!==d||(n[d++]=o),d}function w(t){return new Float64Array(t)}const S=22204460492503146e-32,T=11093356479670487e-47,C=w(4),M=w(8),E=w(12),I=w(16),L=w(4);function P(t,e,i,r,n,o){const s=(e-o)*(i-n),a=(t-n)*(r-o),l=s-a,c=Math.abs(s+a);return Math.abs(l)>=33306690738754716e-32*c?l:-function(t,e,i,r,n,o,s){let a,l,c,u,h,p,d,f,m,g,_,y,A,w,P,k,N,D;const O=t-n,R=i-n,F=e-o,z=r-o;w=O*z,p=v*O,d=p-(p-O),f=O-d,p=v*z,m=p-(p-z),g=z-m,P=f*g-(w-d*m-f*m-d*g),k=F*R,p=v*F,d=p-(p-F),f=F-d,p=v*R,m=p-(p-R),g=R-m,N=f*g-(k-d*m-f*m-d*g),_=P-N,h=P-_,C[0]=P-(_+h)+(h-N),y=w+_,h=y-w,A=w-(y-h)+(_-h),_=A-k,h=A-_,C[1]=A-(_+h)+(h-k),D=y+_,h=D-y,C[2]=y-(D-h)+(_-h),C[3]=D;let B=function(t,e){let i=e[0];for(let r=1;r<t;r++)i+=e[r];return i}(4,C),U=S*s;if(B>=U||-B>=U)return B;if(h=t-O,a=t-(O+h)+(h-n),h=i-R,c=i-(R+h)+(h-n),h=e-F,l=e-(F+h)+(h-o),h=r-z,u=r-(z+h)+(h-o),0===a&&0===l&&0===c&&0===u)return B;if(U=T*s+x*Math.abs(B),B+=O*u+z*a-(F*c+R*l),B>=U||-B>=U)return B;w=a*z,p=v*a,d=p-(p-a),f=a-d,p=v*z,m=p-(p-z),g=z-m,P=f*g-(w-d*m-f*m-d*g),k=l*R,p=v*l,d=p-(p-l),f=l-d,p=v*R,m=p-(p-R),g=R-m,N=f*g-(k-d*m-f*m-d*g),_=P-N,h=P-_,L[0]=P-(_+h)+(h-N),y=w+_,h=y-w,A=w-(y-h)+(_-h),_=A-k,h=A-_,L[1]=A-(_+h)+(h-k),D=y+_,h=D-y,L[2]=y-(D-h)+(_-h),L[3]=D;const V=b(4,C,4,L,M);w=O*u,p=v*O,d=p-(p-O),f=O-d,p=v*u,m=p-(p-u),g=u-m,P=f*g-(w-d*m-f*m-d*g),k=F*c,p=v*F,d=p-(p-F),f=F-d,p=v*c,m=p-(p-c),g=c-m,N=f*g-(k-d*m-f*m-d*g),_=P-N,h=P-_,L[0]=P-(_+h)+(h-N),y=w+_,h=y-w,A=w-(y-h)+(_-h),_=A-k,h=A-_,L[1]=A-(_+h)+(h-k),D=y+_,h=D-y,L[2]=y-(D-h)+(_-h),L[3]=D;const j=b(V,M,4,L,E);w=a*u,p=v*a,d=p-(p-a),f=a-d,p=v*u,m=p-(p-u),g=u-m,P=f*g-(w-d*m-f*m-d*g),k=l*c,p=v*l,d=p-(p-l),f=l-d,p=v*c,m=p-(p-c),g=c-m,N=f*g-(k-d*m-f*m-d*g),_=P-N,h=P-_,L[0]=P-(_+h)+(h-N),y=w+_,h=y-w,A=w-(y-h)+(_-h),_=A-k,h=A-_,L[1]=A-(_+h)+(h-k),D=y+_,h=D-y,L[2]=y-(D-h)+(_-h),L[3]=D;const G=b(j,E,4,L,I);return I[G-1]}(t,e,i,r,n,o,c)}const k=(t,e)=>t.x*e.y-t.y*e.x,N=(t,e)=>t.x*e.x+t.y*e.y,D=(t,e,i)=>{const r=P(t.x,t.y,e.x,e.y,i.x,i.y);return r>0?-1:r<0?1:0},O=t=>Math.sqrt(N(t,t)),R=(t,e,i)=>{const r={x:e.x-t.x,y:e.y-t.y},n={x:i.x-t.x,y:i.y-t.y};return k(n,r)/O(n)/O(r)},F=(t,e,i)=>{const r={x:e.x-t.x,y:e.y-t.y},n={x:i.x-t.x,y:i.y-t.y};return N(n,r)/O(n)/O(r)},z=(t,e,i)=>0===e.y?null:{x:t.x+e.x/e.y*(i-t.y),y:i},B=(t,e,i)=>0===e.x?null:{x:i,y:t.y+e.y/e.x*(i-t.x)};class U{static compare(t,e){const i=U.comparePoints(t.point,e.point);return 0!==i?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:j.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(void 0===i.segment.consumedBy)for(let r=e+1;r<t;r++){const t=this.point.events[r];void 0===t.consumedBy&&i.otherSE.point.events===t.otherSE.point.events&&i.segment.consume(t.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const e=new Map,i=i=>{const r=i.otherSE;e.set(i,{sine:R(this.point,t.point,r.point),cosine:F(this.point,t.point,r.point)})};return(t,r)=>{e.has(t)||i(t),e.has(r)||i(r);const{sine:n,cosine:o}=e.get(t),{sine:s,cosine:a}=e.get(r);return n>=0&&s>=0?o<a?1:o>a?-1:0:n<0&&s<0?o<a?-1:o>a?1:0:s<n?-1:s>n?1:0}}}let V=0;class j{static compare(t,e){const i=t.leftSE.point.x,r=e.leftSE.point.x,n=t.rightSE.point.x,o=e.rightSE.point.x;if(o<i)return 1;if(n<r)return-1;const s=t.leftSE.point.y,a=e.leftSE.point.y,l=t.rightSE.point.y,c=e.rightSE.point.y;if(i<r){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;const i=t.comparePoint(e.leftSE.point);if(i<0)return 1;if(i>0)return-1;const r=e.comparePoint(t.rightSE.point);return 0!==r?r:-1}if(i>r){if(s<a&&s<c)return-1;if(s>a&&s>c)return 1;const i=e.comparePoint(t.leftSE.point);if(0!==i)return i;const r=t.comparePoint(e.rightSE.point);return r<0?1:r>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(n<o){const i=e.comparePoint(t.rightSE.point);if(0!==i)return i}if(n>o){const i=t.comparePoint(e.rightSE.point);if(i<0)return 1;if(i>0)return-1}if(n!==o){const t=l-s,e=n-i,u=c-a,h=o-r;if(t>e&&u<h)return 1;if(t<e&&u>h)return-1}return n>o?1:n<o||l<c?-1:l>c?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,i,r){this.id=++V,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=r}static fromRing(t,e,i){let r,n,o;const s=U.comparePoints(t,e);if(s<0)r=t,n=e,o=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);r=e,n=t,o=-1}const a=new U(r,!0),l=new U(n,!1);return new j(a,l,[i],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(e.x===i.x)return t.x===e.x?0:t.x<e.x?1:-1;const n=(t.y-e.y)/r.y,o=e.x+n*r.x;if(t.x===o)return 0;const s=(t.x-e.x)/r.x,a=e.y+s*r.y;return t.y===a?0:t.y<a?-1:1}getIntersection(t){const e=this.bbox(),i=t.bbox(),r=d(e,i);if(null===r)return null;const n=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,l=p(e,s)&&0===this.comparePoint(s),c=p(i,n)&&0===t.comparePoint(n),u=p(e,a)&&0===this.comparePoint(a),h=p(i,o)&&0===t.comparePoint(o);if(c&&l)return h&&!u?o:!h&&u?a:null;if(c)return u&&n.x===a.x&&n.y===a.y?null:n;if(l)return h&&o.x===s.x&&o.y===s.y?null:s;if(h&&u)return null;if(h)return o;if(u)return a;const f=((t,e,i,r)=>{if(0===e.x)return B(i,r,t.x);if(0===r.x)return B(t,e,i.x);if(0===e.y)return z(i,r,t.y);if(0===r.y)return z(t,e,i.y);const n=k(e,r);if(0==n)return null;const o={x:i.x-t.x,y:i.y-t.y},s=k(o,e)/n,a=k(o,r)/n;return{x:(t.x+a*e.x+(i.x+s*r.x))/2,y:(t.y+a*e.y+(i.y+s*r.y))/2}})(n,this.vector(),s,t.vector());return null===f?null:p(r,f)?y.round(f.x,f.y):null}split(t){const e=[],i=void 0!==t.events,r=new U(t,!0),n=new U(t,!1),o=this.rightSE;this.replaceRightSE(n),e.push(n),e.push(r);const s=new j(r,o,this.rings.slice(),this.windings.slice());return U.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),U.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),n.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,e=this.windings.length;t<e;t++)this.windings[t]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const r=j.compare(e,i);if(0!==r){if(r>0){const t=e;e=i,i=t}if(e.prev===i){const t=e;e=i,i=t}for(let t=0,r=i.rings.length;t<r;t++){const r=i.rings[t],n=i.windings[t],o=e.rings.indexOf(r);-1===o?(e.rings.push(r),e.windings.push(n)):e.windings[o]+=n}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys;for(let t=0,r=this.rings.length;t<r;t++){const r=this.rings[t],n=this.windings[t],o=e.indexOf(r);-1===o?(e.push(r),i.push(n)):i[o]+=n}const n=[],o=[];for(let t=0,r=e.length;t<r;t++){if(0===i[t])continue;const r=e[t],s=r.poly;if(-1===o.indexOf(s))if(r.isExterior)n.push(s);else{-1===o.indexOf(s)&&o.push(s);const t=n.indexOf(r.poly);-1!==t&&n.splice(t,1)}}for(let t=0,e=n.length;t<e;t++){const e=n[t].multiPoly;-1===r.indexOf(e)&&r.push(e)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(X.type){case"union":{const i=0===t.length,r=0===e.length;this._isInResult=i!==r;break}case"intersection":{let i,r;t.length<e.length?(i=t.length,r=e.length):(i=e.length,r=t.length),this._isInResult=r===X.numMultiPolys&&i<r;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2==1;break}case"difference":{const i=t=>1===t.length&&t[0].isSubject;this._isInResult=i(t)!==i(e);break}default:throw new Error(`Unrecognized operation type found ${X.type}`)}return this._isInResult}}class G{constructor(t,e,i){if(!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=y.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let n=r;for(let e=1,i=t.length;e<i;e++){if("number"!=typeof t[e][0]||"number"!=typeof t[e][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=y.round(t[e][0],t[e][1]);i.x===n.x&&i.y===n.y||(this.segments.push(j.fromRing(n,i,this)),i.x<this.bbox.ll.x&&(this.bbox.ll.x=i.x),i.y<this.bbox.ll.y&&(this.bbox.ll.y=i.y),i.x>this.bbox.ur.x&&(this.bbox.ur.x=i.x),i.y>this.bbox.ur.y&&(this.bbox.ur.y=i.y),n=i)}r.x===n.x&&r.y===n.y||this.segments.push(j.fromRing(n,r,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}}class Z{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new G(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,i=t.length;e<i;e++){const i=new G(t[e],this,!1);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const i=this.interiorRings[e].getSweepEvents();for(let e=0,r=i.length;e<r;e++)t.push(i[e])}return t}}class q{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let e=0,i=t.length;e<i;e++){const i=new Z(t[e],this);i.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const i=this.polys[e].getSweepEvents();for(let e=0,r=i.length;e<r;e++)t.push(i[e])}return t}}class W{static factory(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let n=null,o=r.leftSE,s=r.rightSE;const a=[o],l=o.point,c=[];for(;n=o,o=s,a.push(o),o.point!==l;)for(;;){const t=o.getAvailableLinkedEvents();if(0===t.length){const t=a[0].point,e=a[a.length-1].point;throw new Error(`Unable to complete output ring starting at [${t.x}, ${t.y}]. Last matching segment found ends at [${e.x}, ${e.y}].`)}if(1===t.length){s=t[0].otherSE;break}let i=null;for(let t=0,e=c.length;t<e;t++)if(c[t].point===o.point){i=t;break}if(null!==i){const t=c.splice(i)[0],r=a.splice(t.index);r.unshift(r[0].otherSE),e.push(new W(r.reverse()));continue}c.push({index:a.length,point:o.point});const r=o.getLeftmostComparator(n);s=t.sort(r)[0].otherSE;break}e.push(new W(a))}return e}constructor(t){this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let i=1,r=this.events.length-1;i<r;i++){const r=this.events[i].point,n=this.events[i+1].point;0!==D(r,t,n)&&(e.push(r),t=r)}if(1===e.length)return null;const i=e[0],r=e[1];0===D(i,t,r)&&e.shift(),e.push(e[0]);const n=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,s=this.isExteriorRing()?e.length:-1,a=[];for(let t=o;t!=s;t+=n)a.push([e[t].x,e[t].y]);return a}isExteriorRing(){if(void 0===this._isExteriorRing){const t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let e=1,i=this.events.length;e<i;e++){const i=this.events[e];U.compare(t,i)>0&&(t=i)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return i.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class H{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(let e=0,i=this.interiorRings.length;e<i;e++){const i=this.interiorRings[e].getGeom();null!==i&&t.push(i)}return t}}class J{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const i=this.polys[e].getGeom();null!==i&&t.push(i)}return t}_composePolys(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];if(!r.poly)if(r.isExteriorRing())e.push(new H(r));else{const t=r.enclosingRing();t.poly||e.push(new H(t)),t.poly.addInterior(r)}}return e}}class K{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.compare;this.queue=t,this.tree=new l(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),i;const r=t.isLeft?this.tree.add(e):this.tree.find(e);if(!r)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let n,o,s=r,a=r;for(;void 0===n;)s=this.tree.prev(s),null===s?n=null:void 0===s.key.consumedBy&&(n=s.key);for(;void 0===o;)a=this.tree.next(a),null===a?o=null:void 0===a.key.consumedBy&&(o=a.key);if(t.isLeft){let r=null;if(n){const t=n.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(r=t),!n.isAnEndpoint(t))){const e=this._splitSafely(n,t);for(let t=0,r=e.length;t<r;t++)i.push(e[t])}}let s=null;if(o){const t=o.getIntersection(e);if(null!==t&&(e.isAnEndpoint(t)||(s=t),!o.isAnEndpoint(t))){const e=this._splitSafely(o,t);for(let t=0,r=e.length;t<r;t++)i.push(e[t])}}if(null!==r||null!==s){let t=null;t=null===r?s:null===s||U.comparePoints(r,s)<=0?r:s,this.queue.remove(e.rightSE),i.push(e.rightSE);const n=e.split(t);for(let t=0,e=n.length;t<e;t++)i.push(n[t])}i.length>0?(this.tree.remove(e),i.push(t)):(this.segments.push(e),e.prev=n)}else{if(n&&o){const t=n.getIntersection(o);if(null!==t){if(!n.isAnEndpoint(t)){const e=this._splitSafely(n,t);for(let t=0,r=e.length;t<r;t++)i.push(e[t])}if(!o.isAnEndpoint(t)){const e=this._splitSafely(o,t);for(let t=0,r=e.length;t<r;t++)i.push(e[t])}}}this.tree.remove(e)}return i}_splitSafely(t,e){this.tree.remove(t);const i=t.rightSE;this.queue.remove(i);const r=t.split(e);return r.push(i),void 0===t.consumedBy&&this.tree.add(t),r}}const $=void 0!==r&&r.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Y=void 0!==r&&r.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;const X=new class{run(t,e,i){X.type=t,y.reset();const r=[new q(e,!0)];for(let t=0,e=i.length;t<e;t++)r.push(new q(i[t],!1));if(X.numMultiPolys=r.length,"difference"===X.type){const t=r[0];let e=1;for(;e<r.length;)null!==d(r[e].bbox,t.bbox)?e++:r.splice(e,1)}if("intersection"===X.type)for(let t=0,e=r.length;t<e;t++){const e=r[t];for(let i=t+1,n=r.length;i<n;i++)if(null===d(e.bbox,r[i].bbox))return[]}const n=new l(U.compare);for(let t=0,e=r.length;t<e;t++){const e=r[t].getSweepEvents();for(let t=0,i=e.length;t<i;t++)if(n.insert(e[t]),n.size>$)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new K(n);let s=n.size,a=n.pop();for(;a;){const t=a.key;if(n.size===s){const e=t.segment;throw new Error(`Unable to pop() ${t.isLeft?"left":"right"} SweepEvent [${t.point.x}, ${t.point.y}] from segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] from queue.`)}if(n.size>$)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>Y)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const e=o.process(t);for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0===i.consumedBy&&n.insert(i)}s=n.size,a=n.pop()}y.reset();const c=W.factory(o.segments);return new J(c).getGeom()}};return{union:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return X.run("union",t,i)},intersection:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return X.run("intersection",t,i)},xor:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return X.run("xor",t,i)},difference:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return X.run("difference",t,i)}}}()},14708:(t,e,i)=>{"use strict";i.d(e,{$e:()=>f,Bt:()=>y,IO:()=>a,KY:()=>g,ND:()=>n,NN:()=>o,Zb:()=>s,e$:()=>u,j$:()=>d,lp:()=>m,p8:()=>h,xq:()=>A,zO:()=>p});var r=i(85442);function n(t,e){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,i,r){return e+e+i+i+r+r}));const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),r=i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null;return null===r?"":e||0===e?"rgba("+r.r+","+r.g+","+r.b+","+e+")":"rgb("+r.r+","+r.g+","+r.b+")"}function o(t,e){if(0===e)return t;const i=function(t,e){const i=t.H+e;return{H:i>1?i-1:i,S:t.S,V:t.V}}(l(a(t)),e);return p(c(i))}function s(t){return p(a(t))}function a(t){if(t.indexOf("#")>=0){if(7===t.length){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(null==e||e.length<4)return;return{R:parseInt(e[1],16),G:parseInt(e[2],16),B:parseInt(e[3],16)}}if(4===t.length){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(t);if(null==e||e.length<4)return;return{R:parseInt(e[1]+e[1],16),G:parseInt(e[2]+e[2],16),B:parseInt(e[3]+e[3],16)}}}else{if(t.indexOf("rgb(")>=0){const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);if(null==e||e.length<4)return;return{R:parseInt(e[1],10),G:parseInt(e[2],10),B:parseInt(e[3],10)}}if(t.indexOf("rgba(")>=0){const e=/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/.exec(t);if(null==e||e.length<5)return;return{R:parseInt(e[1],10),G:parseInt(e[2],10),B:parseInt(e[3],10),A:parseFloat(e[4])}}}}function l(t){let e,i;const r=t.R/255,n=t.G/255,o=t.B/255,s=Math.min(r,Math.min(n,o)),a=Math.max(r,Math.max(n,o)),l=a-s;return 0===a||0===l?(e=0,i=0):(e=l/a,i=r===a?(n-o)/l:n===a?2+(o-r)/l:4+(r-n)/l),i/=6,i<0&&(i+=1),{H:i,S:e,V:a}}function c(t){let e,i,r;const n=t.H,o=t.S,s=t.V;if(0===o)e=s,i=s,r=s;else{const t=6*n,a=Math.floor(t),l=t-a,c=s*(1-o),u=s*(1-o*l),h=s*(1-o*(1-l));switch(a){case 0:e=s,i=h,r=c;break;case 1:e=u,i=s,r=c;break;case 2:e=c,i=s,r=h;break;case 3:e=c,i=u,r=s;break;case 4:e=h,i=c,r=s;break;case 5:e=s,i=c,r=u}}return{R:Math.floor(255*e),G:Math.floor(255*i),B:Math.floor(255*r)}}function u(t,e){const i=Math.floor(e);return{R:Math.max(0,t.R-i),G:Math.max(0,t.G-i),B:Math.max(0,t.B-i)}}function h(t){return null==t.A?"rgb("+t.R+","+t.G+","+t.B+")":"rgba("+t.R+","+t.G+","+t.B+","+t.A+")"}function p(t){return"#"+_(t.R)+_(t.G)+_(t.B)}function d(t,e,i){return p(f(a(t),e,a(i)))}function f(t,e,i){return e=r.ensureInRange(e,0,1),{R:m(t.R,e,i.R),G:m(t.G,e,i.G),B:m(t.B,e,i.B)}}function m(t,e,i){return e=r.ensureInRange(e,0,1),t=r.ensureInRange(t,0,255),i=r.ensureInRange(i,0,255),Math.round(e*t+(1-e)*i)}function g(t,e,i){const r=l(t);return(e+i>1||e<=0||i<=0)&&(e=.8,i=.2),r.V<e?r.V=r.V+i:r.V=r.V-i,p(c(r))}function _(t){const e=r.ensureInRange(t,0,255).toString(16).toUpperCase();return 1===e.length?"0"+e:e}function y(t,e,i){const r=e.map((t=>a(t)));return n=>{if(null==n&&(n=0),isNaN(n))return;if(i){if(n>=t[t.length-1])return e[e.length-1];if(n<=t[0])return e[0]}let o,s,a,l;for(let i=1,c=t.length;i<c;i++){if(o=t[i-1],s=t[i],s===n)return e[i];if(n>=o&&n<=s){a=r[i-1],l=r[i];break}}return p({R:Math.round((n-o)*(l.R-a.R)/(s-o)+a.R),G:Math.round((n-o)*(l.G-a.G)/(s-o)+a.G),B:Math.round((n-o)*(l.B-a.B)/(s-o)+a.B)})}}function A(t,e){const i=parseInt(t.slice(1),16),r=e<0?0:255,n=e<0?-1*e:e,o=i>>16,s=i>>8&255,a=255&i;return"#"+(16777216+65536*(Math.round((r-o)*n)+o)+256*(Math.round((r-s)*n)+s)+(Math.round((r-a)*n)+a)).toString(16).slice(1)}},86986:(t,e,i)=>{"use strict";i.d(e,{ND:()=>n});var r=i(14708),n=(r.KY,r.lp,r.Bt,r.e$,r.j$,r.zO,r.ND);r.Zb,r.IO,r.$e,r.p8,r.NN,r.xq},94916:(t,e,i)=>{"use strict";i.r(e),i.d(e,{categoryIsAlsoSeriesRole:()=>n,getMiscellaneousTypeDescriptor:()=>l,getSeriesName:()=>o,hasImageUrlColumn:()=>c,isImageUrlColumn:()=>s,isWebUrlColumn:()=>a});var r=i(34806);function n(t,e,i){if(t.categories&&t.categories.length>0){const n=t.categories[0];return n.source&&r.hasRole(n.source,e)&&r.hasRole(n.source,i)}return!1}function o(t){return void 0!==t.groupName?t.groupName:t.queryName}function s(t){const e=l(t);return null!=e&&!0===e.imageUrl}function a(t){const e=l(t);return null!=e&&!0===e.webUrl}function l(t){return t&&t.type&&t.type.misc}function c(t){return!!(t&&t.metadata&&t.metadata.columns&&t.metadata.columns.length)&&t.metadata.columns.some((t=>!0===s(t)))}},34806:(t,e,i)=>{"use strict";function r(t,e){if(!t||!t.length)return-1;const i=t[0];if(i.values&&i.values.length>0)for(let t=0,r=i.values.length;t<r;++t){const r=i.values[t];if(r&&r.source&&o(r.source,e))return t}return-1}function n(t,e){if(t&&t.length)for(let i=0,r=t.length;i<r;i++)if(o(t[i].source,e))return i;return-1}function o(t,e){const i=t.roles;return i&&i[e]}function s(t,e){return null!=t&&null!=t.metadata&&t.metadata.columns&&t.metadata.columns.some((t=>t.roles&&void 0!==t.roles[e]))}function a(t,e){return t&&t.source&&t.source.roles&&!0===t.source.roles[e]}i.r(e),i.d(e,{getCategoryIndexOfRole:()=>n,getMeasureIndexOfRole:()=>r,hasRole:()=>o,hasRoleInDataView:()=>s,hasRoleInValueColumn:()=>a})},91888:(t,e,i)=>{"use strict";function r(t,e,i){if(!t)return i;const r=t[e];return void 0===r?i:r}function n(t,e,i){const n=r(t,e);return n&&n.solid?n.solid.color:i}i.r(e),i.d(e,{getFillColorByPropertyName:()=>n,getValue:()=>r})},36271:(t,e,i)=>{"use strict";i.r(e),i.d(e,{getCommonValue:()=>a,getFillColor:()=>s,getObject:()=>o,getValue:()=>n});var r=i(91888);function n(t,e,i){return t?r.getValue(t[e.objectName],e.propertyName,i):i}function o(t,e,i){return t&&t[e]?t[e]:i}function s(t,e,i){const r=n(t,e);return r&&r.solid?r.solid.color:i}function a(t,e,i){const r=n(t,e,i);return r&&r.solid?r.solid.color:null==r||"object"==typeof r&&!r.solid?i:r}},93116:(t,e,i)=>{"use strict";i.r(e),i.d(e,{DataViewObjectsParser:()=>n});var r=i(36271);class n{static getDefault(){return new this}static createPropertyIdentifier(t,e){return{objectName:t,propertyName:e}}static parse(t){const e=this.getDefault();if(!t||!t.metadata||!t.metadata.objects)return e;const i=e.getProperties();for(const n in i)for(const o in i[n]){const s=e[n][o];e[n][o]=r.getCommonValue(t.metadata.objects,i[n][o],s)}return e}static isPropertyEnumerable(t){return!n.InnumerablePropertyPrefix.test(t)}static enumerateObjectInstances(t,e){const i=t&&t[e.objectName];if(!i)return[];const r={objectName:e.objectName,selector:null,properties:{}};for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(r.properties[t]=i[t]);return{instances:[r]}}getProperties(){const t={};return Object.keys(this).forEach((e=>{if(n.isPropertyEnumerable(e)){const i=Object.keys(this[e]);t[e]={},i.forEach((i=>{n.isPropertyEnumerable(e)&&(t[e][i]=n.createPropertyIdentifier(e,i))}))}})),t}}n.InnumerablePropertyPrefix=/^_/},11247:(t,e,i)=>{"use strict";function r(t=[],e,i){const r=t;return n(r),e&&(r.identityFields=e),i&&(r.source=i),r}function n(t,e){t.grouped=e?()=>e:()=>o(t)}function o(t){const e=[];let i;for(let r=0,n=t.length;r<n;r++){const n=t[r];if(!i||i.identity!==n.identity){if(i={values:[]},n.identity){i.identity=n.identity;const t=n.source;void 0!==t.groupName?i.name=t.groupName:t.displayName&&(i.name=t.displayName)}e.push(i)}i.values.push(n)}return e}i.r(e),i.d(e,{createValueColumns:()=>r,groupValues:()=>o,setGrouped:()=>n})},889:(t,e,i)=>{"use strict";function r(t){return null==t&&(t=0),{data:[{dataViewWildcard:{matchingOption:t}}]}}i.r(e),i.d(e,{createDataViewWildcardSelector:()=>r})},40724:(t,e,i)=>{"use strict";i.r(e),i.d(e,{converterHelper:()=>r,dataRoleHelper:()=>n,dataViewObject:()=>o,dataViewObjects:()=>s,dataViewObjectsParser:()=>a,dataViewTransform:()=>l,dataViewWildcard:()=>c,validationHelper:()=>u});var r=i(94916),n=i(34806),o=i(91888),s=i(36271),a=i(93116),l=i(11247),c=i(889),u=i(41565)},41565:(t,e,i)=>{"use strict";function r(t){return/^https?:\/\/.+\.(gif|jpg|png|svg)$/i.test(t)||/^data:image\/(gif|jpeg|png|svg\+xml);base64,/i.test(t)}function n(t,e){const i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState!==this.HEADERS_RECEIVED)return;const t=i.getResponseHeader("Content-Type");return["image/png","image/jpeg","image/gif","image/svg+xml"].indexOf(t)>-1?e(!0,t):e(!1,t)},i.open("HEAD",t,!0),i.send()}i.r(e),i.d(e,{isFileImage:()=>n,isImageUrlAllowed:()=>r})},90980:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(18053);e.default=function(t){Object.keys(r.locales).forEach((function(e){return t.addCultureInfo.apply(t,r.locales[e])}))}},77717:(t,e)=>{"use strict";var i,r,n,o,s,a,l,c;Object.defineProperty(e,"__esModule",{value:!0}),e.parseNegativePattern=e.parseExact=e.getEraYear=e.getEra=e.getTokenRegExp=e.formatNumber=e.formatDate=e.expandFormat=e.appendPreOrPostMatch=e.zeroPad=e.trim=e.startsWith=e.isObject=e.isFunction=e.isArray=e.extend=e.endsWith=e.arrayIndexOf=e.regexTrim=e.regexParseFloat=e.regexInfinity=e.regexHex=e.Globalize=void 0,e.Globalize=function(t){return new e.Globalize.prototype.init(t)},e.Globalize.cultures={},e.Globalize.prototype={constructor:e.Globalize,init:function(t){return this.cultures=e.Globalize.cultures,this.cultureSelector=t,this}},e.Globalize.prototype.init.prototype=e.Globalize.prototype,e.Globalize.cultures.default={name:"en",englishName:"English",nativeName:"English",isRTL:!1,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}},messages:{}},e.Globalize.cultures.default.calendar=e.Globalize.cultures.default.calendars.standard,e.Globalize.cultures.en=e.Globalize.cultures.default,e.Globalize.cultureSelector="en",e.regexHex=/^0x[a-f0-9]+$/i,e.regexInfinity=/^[+-]?infinity$/i,e.regexParseFloat=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,e.regexTrim=/^\s+|\s+$/g,e.arrayIndexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},e.endsWith=function(t,e){return t.substring(t.length-e.length)===e},e.extend=function(t){var i,r,n,o,s,a,l=arguments[0]||{},c=1,u=arguments.length;for(t=!1,"boolean"==typeof l&&(t=l,l=arguments[1]||{},c=2),"object"==typeof l||(0,e.isFunction)(l)||(l={});c<u;c++)if(null!=(i=arguments[c]))for(r in i)n=l[r],l!==(o=i[r])&&(t&&o&&((0,e.isObject)(o)||(s=(0,e.isArray)(o)))?(s?(s=!1,a=n&&(0,e.isArray)(n)?n:[]):a=n&&(0,e.isObject)(n)?n:{},l[r]=(0,e.extend)(t,a,o)):void 0!==o&&(l[r]=o));return l},e.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},e.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},e.startsWith=function(t,e){return 0===t.indexOf(e)},e.trim=function(t){return(t+"").replace(e.regexTrim,"")},e.zeroPad=function(t,e,i){var r;for(r=t.length;r<e;r+=1)t=i?"0"+t:t+"0";return t},e.appendPreOrPostMatch=function(t,e){for(var i=0,r=!1,n=0,o=t.length;n<o;n++){var s=t.charAt(n);switch(s){case"'":r?e.push("'"):i++,r=!1;break;case"\\":r&&e.push("\\"),r=!r;break;default:e.push(s),r=!1}}return i},e.expandFormat=function(t,e){e=e||"F";var i,r=t.patterns,n=e.length;if(1===n){if(!(i=r[e]))throw"Invalid date format string '"+e+"'.";e=i}else 2===n&&"%"===e.charAt(0)&&(e=e.charAt(1));return e},e.formatDate=function(t,i,r){var n=r.calendar,o=n.convert;if(!i||!i.length||"i"===i){var s;if(r&&r.name.length)if(o)s=(0,e.formatDate)(t,n.patterns.F,r);else{var a=new Date(t.getTime()),l=(0,e.getEra)(t,n.eras);a.setFullYear((0,e.getEraYear)(t,n,l)),s=a.toLocaleString()}else s=t.toString();return s}var c=n.eras,u="s"===i;i=(0,e.expandFormat)(n,i),s=[];var h,p,d,f,m=["0","00","000"],g=/([^d]|^)(d|dd)([^d]|$)/g,_=0,y=(0,e.getTokenRegExp)();function A(t,e){var i,r=t+"";return e>1&&r.length<e?(i=m[e-2]+r).substring(i.length-e,i.length):i=r}function v(t,e){if(f)return f[e];switch(e){case 0:return t.getFullYear();case 1:return t.getMonth();case 2:return t.getDate()}}for(!u&&o&&(f=o.fromGregorian(t));;){var x=y.lastIndex,b=y.exec(i),w=i.slice(x,b?b.index:i.length);if(_+=(0,e.appendPreOrPostMatch)(w,s),!b)break;if(_%2)s.push(b[0]);else{var S=b[0],T=S.length;switch(S){case"ddd":case"dddd":var C=3===T?n.days.namesAbbr:n.days.names;s.push(C[t.getDay()]);break;case"d":case"dd":p=!0,s.push(A(v(t,2),T));break;case"MMM":case"MMMM":var M=v(t,1);s.push(n.monthsGenitive&&(p||d||(p=g.test(i),d=!0),p)?n.monthsGenitive[3===T?"namesAbbr":"names"][M]:n.months[3===T?"namesAbbr":"names"][M]);break;case"M":case"MM":s.push(A(v(t,1)+1,T));break;case"y":case"yy":case"yyyy":M=f?f[0]:(0,e.getEraYear)(t,n,(0,e.getEra)(t,c),u),T<4&&(M%=100),s.push(A(M,T));break;case"h":case"hh":0==(h=t.getHours()%12)&&(h=12),s.push(A(h,T));break;case"H":case"HH":s.push(A(t.getHours(),T));break;case"m":case"mm":s.push(A(t.getMinutes(),T));break;case"s":case"ss":s.push(A(t.getSeconds(),T));break;case"t":case"tt":M=t.getHours()<12?n.AM?n.AM[0]:" ":n.PM?n.PM[0]:" ",s.push(1===T?M.charAt(0):M);break;case"f":case"ff":case"fff":s.push(A(t.getMilliseconds(),3).substring(0,T));break;case"z":case"zz":h=t.getTimezoneOffset()/60,s.push((h<=0?"+":"-")+A(Math.floor(Math.abs(h)),T));break;case"zzz":h=t.getTimezoneOffset()/60,s.push((h<=0?"+":"-")+A(Math.floor(Math.abs(h)),2)+":"+A(Math.abs(t.getTimezoneOffset()%60),2));break;case"g":case"gg":n.eras&&s.push(n.eras[(0,e.getEra)(t,c)].name);break;case"/":s.push(n["/"]);break;default:throw"Invalid date format pattern '"+S+"'."}}}return s.join("")},i=function(t,i,r){var n=r.groupSizes,o=n[0],s=1,a=Math.pow(10,i),l=Math.round(t*a)/a;isFinite(l)||(l=t);var c=(t=l)+"",u="",h=c.split(/e/i),p=h.length>1?parseInt(h[1],10):0;h=(c=h[0]).split("."),c=h[0],u=h.length>1?h[1]:"",p>0?(c+=(u=(0,e.zeroPad)(u,p,!1)).slice(0,p),u=u.substring(p)):p<0&&(p=-p,u=(c=(0,e.zeroPad)(c,p+1)).slice(-p,c.length)+u,c=c.slice(0,-p)),u=i>0?r["."]+(u.length>i?u.slice(0,i):(0,e.zeroPad)(u,i)):"";for(var d=c.length-1,f=r[","],m="";d>=0;){if(0===o||o>d)return c.slice(0,d+1)+(m.length?f+m+u:u);m=c.slice(d-o+1,d+1)+(m.length?f+m:""),d-=o,s<n.length&&(o=n[s],s++)}return c.slice(0,d+1)+f+m+u},e.formatNumber=function(t,r,n){if(!r||"i"===r)return n.name.length?t.toLocaleString():t.toString();r=r||"D";var o,s=n.numberFormat,a=Math.abs(t),l=-1;r.length>1&&(l=parseInt(r.slice(1),10));var c,u=r.charAt(0).toUpperCase();switch(u){case"D":o="n",-1!==l&&(a=(0,e.zeroPad)(""+a,l,!0)),t<0&&(a=-a);break;case"N":c=s;case"C":c=c||s.currency;case"P":c=c||s.percent,o=t<0?c.pattern[0]:c.pattern[1]||"n",-1===l&&(l=c.decimals),a=i(a*("P"===u?100:1),l,c);break;default:throw"Bad number format specifier: "+u}for(var h=/n|\$|-|%/g,p="";;){var d=h.lastIndex,f=h.exec(o);if(p+=o.slice(d,f?f.index:o.length),!f)break;switch(f[0]){case"n":p+=a;break;case"$":p+=s.currency.symbol;break;case"-":/[1-9]/.test(a.toString())&&(p+=s["-"]);break;case"%":p+=s.percent.symbol}}return p},e.getTokenRegExp=function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g},e.getEra=function(t,e){if(!e)return 0;for(var i,r=t.getTime(),n=0,o=e.length;n<o;n++)if(null===(i=e[n].start)||r>=i)return n;return 0},e.getEraYear=function(t,e,i,r){var n=t.getFullYear();return!r&&e.eras&&(n-=e.eras[i].offset),n},r=function(t,i){var r=new Date,n=(0,e.getEra)(r);if(i<100){var o=t.twoDigitYearMax;o="string"==typeof o?(new Date).getFullYear()%100+parseInt(o,10):o;var s=(0,e.getEraYear)(r,t,n);(i+=s-s%100)>o&&(i-=100)}return i},n=function(t,i,r){var n,o=t.days,s=t._upperDays;return s||(t._upperDays=s=[c(o.names),c(o.namesAbbr),c(o.namesShort)]),i=l(i),r?-1===(n=(0,e.arrayIndexOf)(s[1],i))&&(n=(0,e.arrayIndexOf)(s[2],i)):n=(0,e.arrayIndexOf)(s[0],i),n},o=function(t,i,r){var n=t.months,o=t.monthsGenitive||t.months,s=t._upperMonths,a=t._upperMonthsGen;s||(t._upperMonths=s=[c(n.names),c(n.namesAbbr)],t._upperMonthsGen=a=[c(o.names),c(o.namesAbbr)]),i=l(i);var u=(0,e.arrayIndexOf)(r?s[1]:s[0],i);return u<0&&(u=(0,e.arrayIndexOf)(r?a[1]:a[0],i)),u},s=function(t,i){var r=t._parseRegExp;if(r){var n=r[i];if(n)return n}else t._parseRegExp=r={};for(var o,s=(0,e.expandFormat)(t,i).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1"),a=["^"],l=[],c=0,u=0,h=(0,e.getTokenRegExp)();null!==(o=h.exec(s));){var p=s.slice(c,o.index);if(c=h.lastIndex,(u+=(0,e.appendPreOrPostMatch)(p,a))%2)a.push(o[0]);else{var d,f=o[0],m=f.length;switch(f){case"dddd":case"ddd":case"MMMM":case"MMM":case"gg":case"g":d="(\\D+)";break;case"tt":case"t":d="(\\D*)";break;case"yyyy":case"fff":case"ff":case"f":d="(\\d{"+m+"})";break;case"dd":case"d":case"MM":case"M":case"yy":case"y":case"HH":case"H":case"hh":case"h":case"mm":case"m":case"ss":case"s":d="(\\d\\d?)";break;case"zzz":d="([+-]?\\d\\d?:\\d{2})";break;case"zz":case"z":d="([+-]?\\d\\d?)";break;case"/":d="(\\"+t["/"]+")";break;default:throw"Invalid date format pattern '"+f+"'."}d&&a.push(d),l.push(o[0])}}(0,e.appendPreOrPostMatch)(s.slice(c),a),a.push("$");var g={regExp:a.join("").replace(/\s+/g,"\\s+"),groups:l};return r[i]=g},a=function(t,e,i){return t<e||t>i},l=function(t){return t.split("").join(" ").toUpperCase()},c=function(t){for(var e=[],i=0,r=t.length;i<r;i++)e[i]=l(t[i]);return e},e.parseExact=function(t,i,l){t=(0,e.trim)(t);var c=l.calendar,u=s(c,i),h=new RegExp(u.regExp).exec(t);if(null===h)return null;for(var p,d=u.groups,f=null,m=null,g=null,_=null,y=null,A=0,v=0,x=0,b=0,w=null,S=!1,T=0,C=d.length;T<C;T++){var M=h[T+1];if(M){var E=d[T],I=E.length,L=parseInt(M,10);switch(E){case"dd":case"d":if(a(_=L,1,31))return null;break;case"MMM":case"MMMM":if(g=o(c,M,3===I),a(g,0,11))return null;break;case"M":case"MM":if(a(g=L-1,0,11))return null;break;case"y":case"yy":case"yyyy":if(m=I<4?r(c,L):L,a(m,0,9999))return null;break;case"h":case"hh":if(12===(A=L)&&(A=0),a(A,0,11))return null;break;case"H":case"HH":if(a(A=L,0,23))return null;break;case"m":case"mm":if(a(v=L,0,59))return null;break;case"s":case"ss":if(a(x=L,0,59))return null;break;case"tt":case"t":if(!(S=c.PM&&(M===c.PM[0]||M===c.PM[1]||M===c.PM[2]))&&(!c.AM||M!==c.AM[0]&&M!==c.AM[1]&&M!==c.AM[2]))return null;break;case"f":case"ff":case"fff":if(b=L*Math.pow(10,3-I),a(b,0,999))return null;break;case"ddd":case"dddd":if(y=n(c,M,3===I),a(y,0,6))return null;break;case"zzz":var P=M.split(/:/);if(2!==P.length)return null;if(p=parseInt(P[0],10),a(p,-12,13))return null;var k=parseInt(P[1],10);if(a(k,0,59))return null;w=60*p+((0,e.startsWith)(M,"-")?-k:k);break;case"z":case"zz":if(a(p=L,-12,13))return null;w=60*p;break;case"g":case"gg":var N=M;if(!N||!c.eras)return null;N=(0,e.trim)(N.toLowerCase());for(var D=0,O=c.eras.length;D<O;D++)if(N===c.eras[D].name.toLowerCase()){f=D;break}if(null===f)return null}}}var R,F=new Date,z=c.convert;if(R=z?z.fromGregorian(F)[0]:F.getFullYear(),null===m?m=R:c.eras&&(m+=c.eras[f||0].offset),null===g&&(g=0),null===_&&(_=1),z){if(null===(F=z.toGregorian(m,g,_)))return null}else{if(F.setFullYear(m,g,_),F.getDate()!==_)return null;if(null!==y&&F.getDay()!==y)return null}if(S&&A<12&&(A+=12),F.setHours(A,v,x,b),null!==w){var B=F.getMinutes()-(w+F.getTimezoneOffset());F.setHours(F.getHours()+parseInt((B/60).toString(),10),B%60)}return F},e.parseNegativePattern=function(t,i,r){var n,o=i["-"],s=i["+"];switch(r){case"n -":o=" "+o,s=" "+s;case"n-":(0,e.endsWith)(t,o)?n=["-",t.substring(0,t.length-o.length)]:(0,e.endsWith)(t,s)&&(n=["+",t.substring(0,t.length-s.length)]);break;case"- n":o+=" ",s+=" ";case"-n":(0,e.startsWith)(t,o)?n=["-",t.substring(o.length)]:(0,e.startsWith)(t,s)&&(n=["+",t.substring(s.length)]);break;case"(n)":(0,e.startsWith)(t,"(")&&(0,e.endsWith)(t,")")&&(n=["-",t.substring(1,t.length-1)])}return n||["",t]},e.Globalize.prototype.findClosestCulture=function(t){return e.Globalize.findClosestCulture.call(this,t)},e.Globalize.prototype.format=function(t,i,r){return e.Globalize.format.call(this,t,i,r)},e.Globalize.prototype.localize=function(t,i){return e.Globalize.localize.call(this,t,i)},e.Globalize.prototype.parseInt=function(t,i,r){return e.Globalize.parseInt.call(this,t,i,r)},e.Globalize.prototype.parseFloat=function(t,i,r){return e.Globalize.parseFloat.call(this,t,i,r)},e.Globalize.prototype.culture=function(t){return e.Globalize.culture.call(this,t)},e.Globalize.addCultureInfo=function(t,i,r){var n={},o=!1;"string"!=typeof t?(r=t,t=this.culture().name,n=this.cultures[t]):"string"!=typeof i?(r=i,o=null==this.cultures[t],n=this.cultures[t]||this.cultures.default):(o=!0,n=this.cultures[i]),this.cultures[t]=(0,e.extend)(!0,{},n,r),o&&(this.cultures[t].calendar=this.cultures[t].calendars.standard)},e.Globalize.findClosestCulture=function(t){var i;if(!t)return this.cultures[this.cultureSelector]||this.cultures.default;if("string"==typeof t&&(t=t.split(",")),(0,e.isArray)(t)){var r,n,o=this.cultures,s=t,a=s.length,l=[];for(n=0;n<a;n++){var c,u=(t=(0,e.trim)(s[n])).split(";");r=(0,e.trim)(u[0]),1===u.length?c=1:0===(t=(0,e.trim)(u[1])).indexOf("q=")?(t=t.substring(2),c=parseFloat(t),c=isNaN(c)?0:c):c=1,l.push({lang:r,pri:c})}for(l.sort((function(t,e){return t.pri<e.pri?1:-1})),n=0;n<a;n++)if(i=o[r=l[n].lang])return i;for(n=0;n<a;n++)for(r=l[n].lang;;){var h=r.lastIndexOf("-");if(-1===h)break;if(i=o[r=r.substring(0,h)])return i}for(n=0;n<a;n++)for(var p in r=l[n].lang,o){var d=o[p];if(d.language==r)return d}}else if("object"==typeof t)return t;return i||null},e.Globalize.format=function(t,i,r){var n=this.findClosestCulture(r);return t instanceof Date?t=(0,e.formatDate)(t,i,n):"number"==typeof t&&(t=(0,e.formatNumber)(t,i,n)),t},e.Globalize.localize=function(t,e){return this.findClosestCulture(e).messages[t]||this.cultures.default.messages.key},e.Globalize.parseDate=function(t,i,r){var n,o,s;if(r=this.findClosestCulture(r),i){if("string"==typeof i&&(i=[i]),i.length)for(var a=0,l=i.length;a<l;a++){var c=i[a];if(c&&(n=(0,e.parseExact)(t,c,r)))break}}else for(o in s=r.calendar.patterns)if(n=(0,e.parseExact)(t,s[o],r))break;return n||null},e.Globalize.parseInt=function(t,i,r){return Math.floor(e.Globalize.parseFloat(t,i,r))},e.Globalize.parseFloat=function(t,i,r){"number"!=typeof i&&(r=i,i=10);var n=this.findClosestCulture(r),o=NaN,s=n.numberFormat;if(t.indexOf(n.numberFormat.currency.symbol)>-1&&(t=(t=t.replace(n.numberFormat.currency.symbol,"")).replace(n.numberFormat.currency["."],n.numberFormat["."])),t=(0,e.trim)(t),e.regexInfinity.test(t))o=parseFloat(t);else if(!i&&e.regexHex.test(t))o=parseInt(t,16);else{var a=(0,e.parseNegativePattern)(t,s,s.pattern[0]),l=a[0],c=a[1];""===l&&"-n"!==s.pattern[0]&&(l=(a=(0,e.parseNegativePattern)(t,s,"-n"))[0],c=a[1]),l=l||"+";var u,h,p=c.indexOf("e");p<0&&(p=c.indexOf("E")),p<0?(h=c,u=null):(h=c.substring(0,p),u=c.substring(p+1));var d,f,m=s["."],g=h.indexOf(m);g<0?(d=h,f=null):(d=h.substring(0,g),f=h.substring(g+m.length));var _=s[","];d=d.split(_).join("");var y=_.replace(/\u00A0/g," ");_!==y&&(d=d.split(y).join(""));var A=l+d;if(null!==f&&(A+="."+f),null!==u){var v=(0,e.parseNegativePattern)(u,s,"-n");A+="e"+(v[0]||"+")+v[1]}e.regexParseFloat.test(A)&&(o=parseFloat(A))}return o},e.Globalize.culture=function(t){return void 0!==t&&(this.cultureSelector=t),this.findClosestCulture(t)||this.culture.default}},67630:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DateTimeSequence=void 0;var r=i(47925),n=i(52087),o=n.numericSequence.NumericSequence,s=n.numericSequenceRange.NumericSequenceRange,a=i(83351),l=function(){function t(t){this.unit=t,this.sequence=[],this.min=new Date("9999-12-31T23:59:59.999"),this.max=new Date("0001-01-01T00:00:00.000")}return t.prototype.add=function(t){t<this.min&&(this.min=t),t>this.max&&(this.max=t),this.sequence.push(t)},t.prototype.extendToCover=function(e,i){for(var r=this.min;e<r;)r=t.ADD_INTERVAL(r,-this.interval,this.unit),this.sequence.splice(0,0,r);for(this.min=r,r=this.max;r<i;)r=t.ADD_INTERVAL(r,this.interval,this.unit),this.sequence.push(r);this.max=r},t.prototype.moveToCover=function(e,i){var r=t.getDelta(e,i,this.unit),n=Math.floor(r/this.interval);for(this.min=t.ADD_INTERVAL(this.min,n*this.interval,this.unit),this.sequence=[],this.sequence.push(this.min),this.max=this.min;this.max<i;)this.max=t.ADD_INTERVAL(this.max,this.interval,this.unit),this.sequence.push(this.max)},t.CALCULATE=function(e,i,r,n){switch(n||(n=t.GET_INTERVAL_UNIT(e,i,r)),n){case a.DateTimeUnit.Year:return t.CALCULATE_YEARS(e,i,r);case a.DateTimeUnit.Month:return t.CALCULATE_MONTHS(e,i,r);case a.DateTimeUnit.Week:return t.CALCULATE_WEEKS(e,i,r);case a.DateTimeUnit.Day:return t.CALCULATE_DAYS(e,i,r);case a.DateTimeUnit.Hour:return t.CALCULATE_HOURS(e,i,r);case a.DateTimeUnit.Minute:return t.CALCULATE_MINUTES(e,i,r);case a.DateTimeUnit.Second:return t.CALCULATE_SECONDS(e,i,r);case a.DateTimeUnit.Millisecond:return t.CALCULATE_MILLISECONDS(e,i,r)}},t.CALCULATE_YEARS=function(e,i,r){var n=s.calculateDataRange(e.getFullYear(),i.getFullYear(),!1),l=o.calculate(s.calculate(0,n.max-n.min),r,0,null,null,[1,2,5]),c=Math.floor(n.min/l.interval)*l.interval,u=new Date(c,0,1);return t.fromNumericSequence(u,l,a.DateTimeUnit.Year)},t.CALCULATE_MONTHS=function(e,i,r){var n=e.getFullYear(),s=i.getFullYear(),l=e.getMonth(),c=12*(s-n)+i.getMonth(),u=new Date(n,0,1),h=o.calculateUnits(l,c,r,[1,2,3,6,12]);return t.fromNumericSequence(u,h,a.DateTimeUnit.Month)},t.CALCULATE_WEEKS=function(e,i,r){var s=(e.getDay()-0+7)%7,l=e.getDate()-s,c=new Date(e.getFullYear(),e.getMonth(),l),u=n.double.ceilWithPrecision(t.getDelta(c,i,a.DateTimeUnit.Week)),h=o.calculateUnits(0,u,r,[1,2,4,8]);return t.fromNumericSequence(c,h,a.DateTimeUnit.Week)},t.CALCULATE_DAYS=function(e,i,r){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),l=n.double.ceilWithPrecision(t.getDelta(e,i,a.DateTimeUnit.Day)),c=o.calculateUnits(0,l,r,[1,2,7,14]);return t.fromNumericSequence(s,c,a.DateTimeUnit.Day)},t.CALCULATE_HOURS=function(e,i,r){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),l=n.double.floorWithPrecision(t.getDelta(s,e,a.DateTimeUnit.Hour)),c=n.double.ceilWithPrecision(t.getDelta(s,i,a.DateTimeUnit.Hour)),u=o.calculateUnits(l,c,r,[1,2,3,6,12,24]);return t.fromNumericSequence(s,u,a.DateTimeUnit.Hour)},t.CALCULATE_MINUTES=function(e,i,r){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),l=n.double.floorWithPrecision(t.getDelta(s,e,a.DateTimeUnit.Minute)),c=n.double.ceilWithPrecision(t.getDelta(s,i,a.DateTimeUnit.Minute)),u=o.calculateUnits(l,c,r,[1,2,5,10,15,30,60,120,180,360,720,1440]);return t.fromNumericSequence(s,u,a.DateTimeUnit.Minute)},t.CALCULATE_SECONDS=function(e,i,r){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()),l=n.double.floorWithPrecision(t.getDelta(s,e,a.DateTimeUnit.Second)),c=n.double.ceilWithPrecision(t.getDelta(s,i,a.DateTimeUnit.Second)),u=o.calculateUnits(l,c,r,[1,2,5,10,15,30,60,120,300,600,900,1800,3600]);return t.fromNumericSequence(s,u,a.DateTimeUnit.Second)},t.CALCULATE_MILLISECONDS=function(e,i,r){var n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),l=t.getDelta(n,e,a.DateTimeUnit.Millisecond),c=t.getDelta(n,i,a.DateTimeUnit.Millisecond),u=o.calculate(s.calculate(l,c),r,0);return t.fromNumericSequence(n,u,a.DateTimeUnit.Millisecond)},t.ADD_INTERVAL=function(t,e,i){switch(e=Math.round(e),i){case a.DateTimeUnit.Year:return r.addYears(t,e);case a.DateTimeUnit.Month:return r.addMonths(t,e);case a.DateTimeUnit.Week:return r.addWeeks(t,e);case a.DateTimeUnit.Day:return r.addDays(t,e);case a.DateTimeUnit.Hour:return r.addHours(t,e);case a.DateTimeUnit.Minute:return r.addMinutes(t,e);case a.DateTimeUnit.Second:return r.addSeconds(t,e);case a.DateTimeUnit.Millisecond:return r.addMilliseconds(t,e)}},t.fromNumericSequence=function(e,i,r){for(var n=new t(r),o=0;o<i.sequence.length;o++){var s=i.sequence[o],a=t.ADD_INTERVAL(e,s,r);n.add(a)}return n.interval=i.interval,n.intervalOffset=i.intervalOffset,n},t.getDelta=function(t,e,i){var r=0;switch(i){case a.DateTimeUnit.Year:r=e.getFullYear()-t.getFullYear();break;case a.DateTimeUnit.Month:r=12*(e.getFullYear()-t.getFullYear())+e.getMonth()-t.getMonth();break;case a.DateTimeUnit.Week:r=(e.getTime()-t.getTime())/6048e5;break;case a.DateTimeUnit.Day:r=(e.getTime()-t.getTime())/864e5;break;case a.DateTimeUnit.Hour:r=(e.getTime()-t.getTime())/36e5;break;case a.DateTimeUnit.Minute:r=(e.getTime()-t.getTime())/6e4;break;case a.DateTimeUnit.Second:r=(e.getTime()-t.getTime())/1e3;break;case a.DateTimeUnit.Millisecond:r=e.getTime()-t.getTime()}return r},t.GET_INTERVAL_UNIT=function(e,i,r){r=Math.max(r,2);var n=t.getDelta(e,i,a.DateTimeUnit.Day);if(n>356&&n>=180*r)return a.DateTimeUnit.Year;if(n>60&&n>7*r)return a.DateTimeUnit.Month;if(n>14&&n>2*r)return a.DateTimeUnit.Week;var o=t.getDelta(e,i,a.DateTimeUnit.Hour);if(n>2&&o>12*r)return a.DateTimeUnit.Day;if(o>=24&&o>=r)return a.DateTimeUnit.Hour;var s=t.getDelta(e,i,a.DateTimeUnit.Minute);if(s>2&&s>=r)return a.DateTimeUnit.Minute;var l=t.getDelta(e,i,a.DateTimeUnit.Second);if(l>2&&l>=.8*r)return a.DateTimeUnit.Second;if(t.getDelta(e,i,a.DateTimeUnit.Millisecond)>0)return a.DateTimeUnit.Millisecond;var c=e;return 0!==c.getMilliseconds()?a.DateTimeUnit.Millisecond:0!==c.getSeconds()?a.DateTimeUnit.Second:0!==c.getMinutes()?a.DateTimeUnit.Minute:0!==c.getHours()?a.DateTimeUnit.Hour:1!==c.getDate()?a.DateTimeUnit.Day:0!==c.getMonth()?a.DateTimeUnit.Month:a.DateTimeUnit.Year},t.MIN_COUNT=1,t.MAX_COUNT=1e3,t}();e.DateTimeSequence=l},47925:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.addMilliseconds=e.addSeconds=e.addMinutes=e.addHours=e.addDays=e.addWeeks=e.addMonths=e.addYears=void 0;var i=[31,28,31,30,31,30,31,31,30,31,30,31],r=[31,29,31,30,31,30,31,31,30,31,30,31];function n(t){return t%4==0&&t%100!=0||t%400==0}function o(t,e){var i=t.getFullYear(),r=t.getMonth(),n=t.getDate(),o=new Date(t.getTime());return o.setFullYear(i,r,n+e),o}e.addYears=function(t,e){var i=t.getFullYear(),r=t.getMonth(),o=t.getDate(),s=2===r&&29===o,a=new Date(t.getTime());return i+=e,s&&!n(i)&&(o=28),a.setFullYear(i,r,o),a},e.addMonths=function(t,e){var o=t.getFullYear(),s=t.getMonth(),a=t.getDate(),l=new Date(t.getTime());return o+=(e-e%12)/12,(s+=e%12)>11&&(s%=12,o++),a=Math.min(a,function(t,e){return n(t)?r[e]:i[e]}(o,s)),l.setFullYear(o,s,a),l},e.addWeeks=function(t,e){return o(t,7*e)},e.addDays=o,e.addHours=function(t,e){return new Date(t.getTime()+36e5*e)},e.addMinutes=function(t,e){return new Date(t.getTime()+6e4*e)},e.addSeconds=function(t,e){return new Date(t.getTime()+1e3*e)},e.addMilliseconds=function(t,e){return new Date(t.getTime()+e)}},23224:function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.DataLabelsDisplayUnitSystem=e.WholeUnitsDisplayUnitSystem=e.DefaultDisplayUnitSystem=e.NoDisplayUnitSystem=e.DisplayUnitSystem=e.DisplayUnit=void 0;var o=i(63100),s=i(52087),a=/^([0\#,]*\.[0\#]+|[0\#,]+|g)$/i,l=function(){function t(){}return t.prototype.project=function(t){return this.value?s.double.removeDecimalNoise(t/this.value):t},t.prototype.reverseProject=function(t){return this.value?t*this.value:t},t.prototype.isApplicableTo=function(t){t=Math.abs(t);var e=s.double.getPrecision(t,3);return s.double.greaterOrEqualWithPrecision(t,this.applicableRangeMin,e)&&s.double.lessWithPrecision(t,this.applicableRangeMax,e)},t.prototype.isScaling=function(){return this.value>1},t}();e.DisplayUnit=l;var c=function(){function t(t){this.units=t||[]}return Object.defineProperty(t.prototype,"title",{get:function(){return this.displayUnit?this.displayUnit.title:void 0},enumerable:!1,configurable:!0}),t.prototype.update=function(t){void 0!==t&&(this.unitBaseValue=t,this.displayUnit=this.findApplicableDisplayUnit(t))},t.prototype.findApplicableDisplayUnit=function(t){for(var e=0,i=this.units;e<i.length;e++){var r=i[e];if(r.isApplicableTo(t))return r}},t.prototype.format=function(t,e,i,r,n){i=this.getNumberOfDecimalsForFormatting(e,i);var o="";return this.isFormatSupported(e)&&!this.hasScientitifcFormat(e)&&this.isScalingUnit()&&this.shouldRespectScalingUnit(e)&&(t=this.displayUnit.project(t),o=this.displayUnit.labelFormat),this.formatHelper({value:t,nonScientificFormat:o,format:e,decimals:i,trailingZeros:r,cultureSelector:n})},t.prototype.isFormatSupported=function(e){return!t.UNSUPPORTED_FORMATS.test(e)},t.prototype.isPercentageFormat=function(t){return t&&t.indexOf("%")>=0},t.prototype.shouldRespectScalingUnit=function(t){return!0},t.prototype.getNumberOfDecimalsForFormatting=function(t,e){return e},t.prototype.isScalingUnit=function(){return this.displayUnit&&this.displayUnit.isScaling()},t.prototype.formatHelper=function(t){var e=t.value,i=t.cultureSelector,r=t.decimals,n=t.trailingZeros,s=t.nonScientificFormat,a=t.format;if("g"!==a&&"G"!==a||null==r||(a="#,0.00"),(a=o.numberFormat.addDecimalsToFormat(a,r,n))&&!o.formattingService.isStandardNumberFormat(a))return o.formattingService.formatNumberWithCustomOverride(e,a,s,i);a||(a="G"),s||(s="{0}");var l=o.formattingService.formatValue(e,a,i);return o.formattingService.format(s,[l])},t.prototype.formatSingleValue=function(t,e,i,r,n){return this.update(this.shouldUseValuePrecision(t)?s.double.getPrecision(t,8):t),this.format(t,e,i,r,n)},t.prototype.shouldUseValuePrecision=function(t){if(0===this.units.length)return!0;for(var e=0,i=0;i<this.units.length;i++)if(this.units[i].isScaling()){e=this.units[i].applicableRangeMin;break}return Math.abs(t)<e},t.prototype.isScientific=function(t){return t<-1e15||t>1e15||-1e-4<t&&t<1e-4&&0!==t},t.prototype.hasScientitifcFormat=function(t){return t&&-1!==t.toUpperCase().indexOf("E")},t.prototype.supportsScientificFormat=function(t){return!t||a.test(t)},t.prototype.shouldFallbackToScientific=function(t,e){return!this.hasScientitifcFormat(e)&&this.supportsScientificFormat(e)&&this.isScientific(t)},t.prototype.getScientificFormat=function(t,e,i,r){if(this.isFormatSupported(e)&&this.shouldFallbackToScientific(t,e)){var n=o.numberFormat.getNumericFormat(t,e);return i&&(n=o.numberFormat.addDecimalsToFormat(n||"0",Math.abs(i),r)),n?n+"E+0":"0.##E+0"}return e},t.UNSUPPORTED_FORMATS=/^(p\d*)|(e\d*)$/i,t}();e.DisplayUnitSystem=c;var u=function(t){function e(){return t.call(this,[])||this}return n(e,t),e}(c);e.NoDisplayUnitSystem=u;var h=function(t){function e(i){return t.call(this,e.getUnits(i))||this}return n(e,t),e.prototype.format=function(e,i,r,n,o){return i=this.getScientificFormat(e,i,r,n),t.prototype.format.call(this,e,i,r,n,o)},e.RESET=function(){e.units=null},e.getUnits=function(t){return e.units||(e.units=f(t,(function(t,e,i){return t-e>=1e3?t/10:i})),e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e}(c);e.DefaultDisplayUnitSystem=h;var p=function(t){function e(i){return t.call(this,e.getUnits(i))||this}return n(e,t),e.RESET=function(){e.units=null},e.getUnits=function(t){return e.units||(e.units=f(t),e.units[e.units.length-1].applicableRangeMax=1/0),e.units},e.prototype.format=function(e,i,r,n,o){return i=this.getScientificFormat(e,i,r,n),t.prototype.format.call(this,e,i,r,n,o)},e}(c);e.WholeUnitsDisplayUnitSystem=p;var d=function(t){function e(i){return t.call(this,e.getUnits(i))||this}return n(e,t),e.prototype.isFormatSupported=function(t){return!e.UNSUPPORTED_FORMATS.test(t)},e.getUnits=function(t){if(!e.units){var i=[],r=function(t,e,i){return-1===t&&t-e>=1e3?t/10:i},n=t(-1);m(i,e.AUTO_DISPLAYUNIT_VALUE,n.title,n.format,r),n=t(0),m(i,e.NONE_DISPLAYUNIT_VALUE,n.title,n.format,r),e.units=i.concat(f(t,r)),e.units[e.units.length-1].applicableRangeMax=1/0}return e.units},e.prototype.format=function(e,i,r,n,o){return i=this.getScientificFormat(e,i,r,n),t.prototype.format.call(this,e,i,r,n,o)},e.AUTO_DISPLAYUNIT_VALUE=0,e.NONE_DISPLAYUNIT_VALUE=1,e.UNSUPPORTED_FORMATS=/^(e\d*)$/i,e}(c);function f(t,e){for(var i=[],r=3;r<24;r++){var n=t(r);n&&m(i,s.double.pow10(r),n.title,n.format,e)}return i}function m(t,e,i,r,n){if(i||r){var o=e;if(t.length>0){var s=t[t.length-1];n&&(o=n(e,s.value,o)),s.applicableRangeMax=o}var a=new l;a.value=e,a.applicableRangeMin=o,a.applicableRangeMax=1e3*o,a.title=i,a.labelFormat=r,t.push(a)}}e.DataLabelsDisplayUnitSystem=d},31520:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.DisplayUnitSystemType=void 0,(i=e.DisplayUnitSystemType||(e.DisplayUnitSystemType={}))[i.Default=0]="Default",i[i.Verbose=1]="Verbose",i[i.WholeUnits=2]="WholeUnits",i[i.DataLabels=3]="DataLabels"},83801:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Family=e.fallbackFonts=void 0;var r=i(6721);e.fallbackFonts=["helvetica","arial","sans-serif"],e.Family={light:new r.FamilyInfo(e.fallbackFonts),semilight:new r.FamilyInfo(e.fallbackFonts),regular:new r.FamilyInfo(e.fallbackFonts),semibold:new r.FamilyInfo(e.fallbackFonts),bold:new r.FamilyInfo(e.fallbackFonts),lightSecondary:new r.FamilyInfo(e.fallbackFonts),regularSecondary:new r.FamilyInfo(e.fallbackFonts),boldSecondary:new r.FamilyInfo(e.fallbackFonts)}},6721:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FamilyInfo=void 0;var i=function(){function t(t){this.families=t}return Object.defineProperty(t.prototype,"family",{get:function(){return this.getFamily()},enumerable:!1,configurable:!0}),t.prototype.getFamily=function(t){if(void 0===t&&(t=/^wf_/),!this.families)return null;if(t)for(var e=0,i=this.families;e<i.length;e++){var r=i[e];if(t.test(r))return r}return this.families[0]},Object.defineProperty(t.prototype,"css",{get:function(){return this.getCSS()},enumerable:!1,configurable:!0}),t.prototype.getCSS=function(){return this.families?this.families.map((function(t){return t.indexOf(" ")>0?"'"+t+"'":t})).join(", "):null},t}();e.FamilyInfo=i},44932:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.fixDateTimeFormat=e.findDateFormat=void 0,e.findDateFormat=function(t,e,i){switch(e){case"m":e="M";break;case"O":case"o":e="yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'fff'0000'";break;case"R":case"r":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="ddd, dd MMM yyyy HH':'mm':'ss 'GMT'";break;case"s":e="S";break;case"u":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="yyyy'-'MM'-'dd HH':'mm':'ss'Z'";break;case"U":t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()),e="F";break;case"y":case"Y":switch(i){case"default":case"en":case"en-US":e="MMMM, yyyy";break;default:e="Y"}}return{value:t,format:e}},e.fixDateTimeFormat=function(t){if(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/%K/g,"zzz")).replace(/K/g,"zzz")).replace(/fffffff/g,"fff0000")).replace(/ffffff/g,"fff000")).replace(/fffff/g,"fff00")).replace(/ffff/g,"fff0")).replace(/yyyyy/g,"0yyyy")).replace(/(^y|^)yyy(^y|$)/g,"yyyy"),i||(i=["d","f","F","g","h","H","K","m","M","s","t","y","z",":","/"].map((function(t){return{r:new RegExp("%"+t+"(?!"+t+")","g"),s:t}}))),-1!==t.indexOf("%")&&t.length>2)for(var e=0;e<i.length;e++)t=t.replace(i[e].r,i[e].s);return t}},36394:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.format=e.canFormat=void 0;var r,n,o=i(44932),s=i(36459),a=i(51248),l=i(77717);function c(t,e,i){var r=i.calendar.patterns;!function(t){var e=t.patterns;void 0===e.g&&(e.g=e.f.replace(e.D,e.d),e.G=e.F.replace(e.D,e.d))}(i.calendar);var n=(0,o.findDateFormat)(t,e,i.name);return e=1===n.format.length?r[n.format]:n.format,i||(i=this.getCurrentCulture()),l.Globalize.format(n.value,e,i)}e.canFormat=function(t){return t instanceof Date},e.format=function(t,e,i){var u=1===(e=e||"G").length;try{return u?c(t,e,i):function(t,e,i){var c,u=[];if((e=s.preserveLiterals(e,u)).indexOf("F")>-1){e=a.replaceAll(e,"FFFF","FFF");var h=t.getMilliseconds();if(h%10>=1&&(e=a.replaceAll(e,"FFF","fff")),e=a.replaceAll(e,"FFF","FF"),h%100/10>=1&&(e=a.replaceAll(e,"FF","ff")),e=a.replaceAll(e,"FF","F"),h%1e3/100>=1&&(e=a.replaceAll(e,"F","f")),""===(e=a.replaceAll(e,"F",""))||"%"===e)return""}return e=function(t){return t===r?n:(r=t,t=(0,o.fixDateTimeFormat)(t),n=t,t)}(e),c=function(t,e){var i=e[":"];if(":"===i)return t;for(var r="",n=t.length,o=0;o<n;o++){var s=t.charAt(o);r+=":"===s?i:s}return r}(c=l.Globalize.format(t,e,i),i.calendar),s.restoreLiterals(c,u,!1)}(t,e,i)}catch(e){return c(t,"G",i)}}},36459:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.restoreLiterals=e.preserveLiterals=e.removeLiterals=void 0;var i=new RegExp(["'[^']*'",'"[^"]*"',"\\\\.","'[^']*$",'"[^"]*$',"\\\\$"].join("|"),"g");e.removeLiterals=function(t){return i.lastIndex=0,t.replace(i,"")},e.preserveLiterals=function(t,e){for(i.lastIndex=0;;){var r=i.exec(t);if(!r)break;var n=r[0],o=i.lastIndex-n.length,s=String.fromCharCode(57600+e.length);e.push(n),t=t.substring(0,o)+s+t.substring(i.lastIndex),i.lastIndex=o+1}return t},e.restoreLiterals=function(t,e,i){void 0===i&&(i=!0);for(var r=e.length,n=0;n<r;n++){var o=String.fromCharCode(57600+n),s=e[n];if(!i){var a=s[0];s="\\"===a||1===s.length||s[s.length-1]!==a?s.substring(1):s.substring(1,s.length-1)}t=t.replace(o,s)}return t}},63100:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.formattingEncoder=e.dateTimeFormat=e.numberFormat=e.formattingService=e.FormattingService=void 0;var r=i(77717);(0,i(90980).default)(r.Globalize);var n=i(36394);e.dateTimeFormat=n;var o=i(87534);e.numberFormat=o;var s=i(36459);e.formattingEncoder=s;var a=i(83351),l=/({{)|(}})|{(\d+[^}]*)}/g,c=function(){function t(){}return t.prototype.formatValue=function(t,e,i){if(null==t)return"";var r=this.getCulture(i);return n.canFormat(t)?n.format(t,e,r):o.canFormat(t)?o.format(t,e,r):t.toString()},t.prototype.format=function(t,e,i){var r=this;return t?t.replace(l,(function(t,n,o,s){if(n)return"{";if(o)return"}";var a=s.split(":"),l=parseInt(a[0],10),c=a[1];return r.formatValue(e[l],c,i)})):""},t.prototype.isStandardNumberFormat=function(t){return o.isStandardFormat(t)},t.prototype.formatNumberWithCustomOverride=function(t,e,i,r){var n=this.getCulture(r);return o.formatWithCustomOverride(t,e,i,n)},t.prototype.dateFormatString=function(t){return this._dateTimeScaleFormatInfo||this.initialize(),this._dateTimeScaleFormatInfo.getFormatString(t)},t.prototype.setCurrentCulture=function(t){this._currentCultureSelector!==t&&(this._currentCulture=this.getCulture(t),this._currentCultureSelector=t,this._dateTimeScaleFormatInfo=new u(this._currentCulture))},t.prototype.getCulture=function(t){if(null==t)return null==this._currentCulture&&this.initialize(),this._currentCulture;var e=r.Globalize.findClosestCulture(t);return e||(e=r.Globalize.culture("en-US")),e},t.prototype.initialize=function(){var t=this.getCurrentCulture();this.setCurrentCulture(t);var e=this.getUrlParam("calendar");if(e){var i=this._currentCulture,r=i.calendars[e];r&&(i.calendar=r)}},t.prototype.getCurrentCulture=function(){return(null===window||void 0===window?void 0:window.navigator)?window.navigator.userLanguage||window.navigator.language:"en-US"},t.prototype.getUrlParam=function(t){var e=window.location.search.match(RegExp("[?&]"+t+"=([^&]*)"));return e?e[1]:void 0},t}();e.FormattingService=c;var u=function(){function t(t){var e=t.calendar,i=e.patterns,r=e.months.namesAbbr,n=r&&r[0],o=i.Y,s=i.M,a=i.f,l=i.T,c=i.t,u=a.indexOf(",")>-1?", ":" ",h=0===o.indexOf("yyyy'")&&o.length>6&&"'"===o[6];this.YearPattern=h?o.substring(0,7):"yyyy";var p=a.indexOf("yy"),d=a.indexOf("MMMM");this.MonthPattern=n&&d>-1?p>d?"MMM yyyy":"yyyy MMM":o,this.DayPattern=n?s.replace("MMMM","MMM"):s;var f=a.indexOf("mm"),m=a.indexOf("tt")>-1?c.replace(":mm ",""):c;this.HourPattern=p<f?this.DayPattern+u+m:m+u+this.DayPattern,this.MinutePattern=c,this.SecondPattern=l,this.MillisecondPattern=l.replace("ss","ss.fff"),"fi-FI"===t.name&&(this.DayPattern=this.DayPattern.replace("'ta'",""),this.HourPattern=this.HourPattern.replace("'ta'",""))}return t.prototype.getFormatString=function(t){switch(t){case a.DateTimeUnit.Year:return this.YearPattern;case a.DateTimeUnit.Month:return this.MonthPattern;case a.DateTimeUnit.Week:case a.DateTimeUnit.Day:return this.DayPattern;case a.DateTimeUnit.Hour:return this.HourPattern;case a.DateTimeUnit.Minute:return this.MinutePattern;case a.DateTimeUnit.Second:return this.SecondPattern;case a.DateTimeUnit.Millisecond:return this.MillisecondPattern}},t}(),h=new c;e.formattingService=h},83351:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.DateTimeUnit=void 0,(i=e.DateTimeUnit||(e.DateTimeUnit={}))[i.Year=0]="Year",i[i.Month=1]="Month",i[i.Week=2]="Week",i[i.Day=3]="Day",i[i.Hour=4]="Hour",i[i.Minute=5]="Minute",i[i.Second=6]="Second",i[i.Millisecond=7]="Millisecond"},87534:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getCustomFormatMetadata=e.formatWithCustomOverride=e.format=e.isStandardFormat=e.canFormat=e.getComponents=e.hasFormatComponents=e.addDecimalsToFormat=e.getNumericFormat=e.NumberFormatComponentsDelimeter=void 0;var r,n=i(77717),o=i(52087),s=i(51248),a=i(36459),l=i(63100),c=/\{.+\}/,u=/e[+-]*[0#]+/i,h=/^[a-z]\d{0,2}$/i,p=/0+$/,d=/\.([0#]*)/g,f=/[0#,\.]+[0,#]*/g,m=/([0#])(?=[^0#]*$)/,g="0",_="#",y="E",A=new RegExp([g,_].join("|"),"g");function v(t,e){if(null==e)return e;if(w(e)){var i=S(e),r=i.positive,n=i.negative,o=i.zero;return x(0,t>0?r:0===t?o:n)}return x(0,e)}function x(t,e){var i=o.regExpExtensions.run(f,e);return i?i[0]:e}function b(t,e,i){if((e=Math.abs(e))>=0){var r=[];t=a.preserveLiterals(t,r);var n=i?g:_,l=s.repeat(n,Math.abs(e)),c=o.regExpExtensions.run(d,t);if(c){var u=t.substring(0,c.index),h=t.substring(c.index+1,c[1].length+c.index+1),p=t.substring(c.index+c[0].length);if(i)h=l;else{var f=l.length-h.length;f>0?h+=l.slice(-f):f<0&&(h=h.slice(0,f))}h.length>0&&(h="."+h),t=u+h+p}else l.length>0&&(t=t.replace(m,"$1."+l));0!==r.length&&(t=a.restoreLiterals(t,r))}return t}function w(t){return-1!==a.removeLiterals(t).indexOf(e.NumberFormatComponentsDelimeter)}function S(t){var i={hasNegative:!1,positive:t,negative:t,zero:t},r=[],n=(t=a.preserveLiterals(t,r)).split(e.NumberFormatComponentsDelimeter),o=n.length;return o>1&&(0!==r.length&&(n=n.map((function(t){return a.restoreLiterals(t,r)}))),i.hasNegative=!0,i.positive=i.zero=n[0],i.negative=n[1],o>2&&(i.zero=n[2])),i}function T(t){return h.test(t)}function C(t,e,i,s){var c,h=i.numberFormat;if(!isFinite(t))return n.Globalize.format(t,void 0);var p=S(e);e=t>0?p.positive:0===t?p.zero:p.negative,p.hasNegative&&(t=Math.abs(t));var d=E(e,!0),f=[];if(d.hasLiterals&&(e=a.preserveLiterals(e,f)),d.hasE&&!s){var m=o.regExpExtensions.run(u,e);if(m){var g=e.substring(0,m.index),_=e.substring(m.index+2),y=I(g,d);if(1!==(L=P(g,d))&&(t*=L),"number"!=typeof t)return String(t);var A=t.toExponential(y),x=A.indexOf("e"),b=A.substring(0,x),w=A.substring(x+1),T=k(b,g,h),C=k(w,_,h);"+"===C.charAt(0)&&"+"!==m[0].charAt(1)&&(C=C.substring(1)),c=T+m[0].charAt(0)+C}}if(void 0===c){var L,N=void 0,D=!1;if(y=I(e,d),1!==(L=P(e,d))&&(t*=L),t=parseFloat(M(t,y)),!isFinite(t))return n.Globalize.format(t,void 0);s?(s=function(t,e){if(!e||void 0===t)return t;var i="{0:"+e+"}";return t.replace("{0}",i)}(s,v(t,e)),N=l.formattingService.format(s,[t],i.name),D=!0):N=M(t,y),c=k(N,e,h,s,D)}return d.hasLiterals&&(c=a.restoreLiterals(c,f,!1)),r=d,c}function M(t,e){var i="",r=0;e>16&&(r=e-16,e=16);var n=o.double.log10(Math.abs(t));if(n<16){if(n>0){var a=16-n;e>a&&(r+=e-a,e=a)}i=t.toFixed(e)}else if(16===n)i=t.toFixed(0),(r+=e)>0&&(i+=".");else{if("number"!=typeof t)return String(t);var l=(i=t.toExponential(15)).indexOf("e");if(l>0){var c=i.indexOf("."),u=i.substring(0,l),h=i.substring(l+1),p=parseInt(h,10)-(u.length-c-1);i=u.replace(".","")+s.repeat("0",p),e>0&&(i=i+"."+s.repeat("0",e))}}return r>0&&(i+=s.repeat("0",r)),i}function E(t,e,i,n){if(void 0!==r&&t===r.format)return r;for(var o=[],s=a.preserveLiterals(t,o),l={format:t,hasLiterals:0!==o.length,hasE:!1,hasCommas:!1,hasDots:!1,hasPercent:!1,hasPermile:!1,precision:void 0,scale:void 0,partsPerScale:void 0},c=0,u=s.length;c<u;c++)switch(s.charAt(c)){case"e":case"E":l.hasE=!0;break;case",":l.hasCommas=!0;break;case".":l.hasDots=!0;break;case"%":l.hasPercent=!0;break;case"":l.hasPermile=!0}var h=S(t);return e&&(l.precision=I(h.positive,l)),n&&(l.partsPerScale=L(h.positive,l)),i&&(l.scale=P(h.positive,l)),l}function I(t,e){if(e.precision>-1)return e.precision;var i=0;if(e.hasDots){e.hasLiterals&&(t=a.removeLiterals(t));var r=t.indexOf(".");if(r>-1){for(var n=t.length,o=r;o<n;o++){var s=t.charAt(o);if(s.match(A)&&i++,s===y)break}i=Math.min(19,i)}}return e.precision=i,i}function L(t,e){if(null!=e.partsPerScale)return e.partsPerScale;var i=1;return e.hasPercent&&t.indexOf("%")>-1&&(i*=100),e.hasPermile&&t.indexOf("")>-1&&(i*=1e3),e.partsPerScale=i,i}function P(t,e){if(e.scale>-1)return e.scale;var i=L(t,e);if(e.hasCommas){var r=t.indexOf(".");-1===r&&(r=t.length);for(var n=r-1;n>-1&&","===t.charAt(n);n--)i/=1e3}return e.scale=i,i}function k(t,e,i,r,n){var o=!!r,s=e.split(".",2);if(2===s.length){var a=s[0],l=s[1],u="";r&&(u=r.replace(c,""),t=t.replace(u,""));var h=i["."],d=n?h:".",f=t.split(d,2),m=1===f.length?f[0]+u:f[0],y=2===f.length?f[1]+u:"";y=y.replace(p,"");var v=N(m,a,i,o),x=function(t,e,i){var r=e.length,n=t.length;if(i){var o=e.charAt(r-1);return o.match(A)?{value:t,fmtOnly:""===t}:{value:t+o,fmtOnly:""===t}}for(var s="",a=!0,l=0,c=0;c<r;c++){var u=e.charAt(c);if(l<n)switch(u){case g:case _:s+=t[l++],a=!1;break;default:s+=u}else u!==_&&(s+=u,a=a&&u!==g)}return{value:s,fmtOnly:a}}(y,l,o);return x.fmtOnly||""===x.value?v+x.value:v+h+x.value}return N(t,e,i,o)}function N(t,e,i,r){var n=e.indexOf(","),o=n>-1&&n<Math.max(e.lastIndexOf("0"),e.lastIndexOf("#"))&&i[","],s=0,a=0,l=i.groupSizes||[3],c=l[0],u=i[","],h="",p=t.charAt(0);"+"!==p&&"-"!==p||(h=i[p],t=t.substring(1));for(var d="0"===t,f="",m="",y=t.length-1,A=!0,v=e.length-1;v>-1;v--){var x=e.charAt(v);switch(x){case g:case _:A=!1,""!==m&&(f=m+f,m=""),r||((y>-1||x===g)&&o&&(s===c?(f=u+f,++a<l.length&&(c=l[a]),s=1):s++),y>-1?(d&&x===_||(f=t.charAt(y)+f),y--):x!==_&&(f=x+f));break;case",":break;default:m=x+m}}if(!r){if(y>-1&&""!==f)if(o)for(;y>-1;)s===c?(f=u+f,++a<l.length&&(c=l[a]),s=1):s++,f=t.charAt(y)+f,y--;else f=t.substring(0,y+1)+f;return h+m+f}return A?h+m+f:h+m+t+f}function D(t,e){var i=e["+"],r=e["-"],n=e["."],o=e[","];if("+"===i&&"-"===r&&"."===n&&","===o)return t;for(var s=t.length,a="",l=0;l<s;l++){var c=t.charAt(l);switch(c){case"+":a+=i;break;case"-":a+=r;break;case".":a+=n;break;case",":a+=o;break;default:a+=c}}return a}e.NumberFormatComponentsDelimeter=";",e.getNumericFormat=v,e.addDecimalsToFormat=function(t,i,r){if(null==i)return t;if(null==t&&(t=g),w(t)){for(var n=S(t),o=[n.positive,n.negative,n.zero],s=0;s<o.length;s++)o[s]=b(o[s],i,r);return o.join(e.NumberFormatComponentsDelimeter)}return b(t,i,r)},e.hasFormatComponents=w,e.getComponents=S,e.canFormat=function(t){return"number"==typeof t},e.isStandardFormat=T,e.format=function(t,e,i){e=e||"G";try{return T(e)?function(t,e,i){var r,o=e.length>1?parseInt(e.substring(1,e.length),10):void 0,a=i.numberFormat,l=e.charAt(0),c=Math.abs(t);switch(l){case"e":case"E":void 0===o&&(o=6),r=C(t,e="0."+s.repeat("0",o)+l+"+000",i);break;case"f":case"F":r=D(r=void 0!==o?t.toFixed(o):t.toFixed(a.decimals),a);break;case"g":case"G":if(0===c||1e-4<=c&&c<1e15)r=void 0!==o?t.toPrecision(o):t.toString();else{if("number"!=typeof t)return String(t);r=(r=void 0!==o?t.toExponential(o):t.toExponential()).replace("e","E")}r=D(r,a);break;case"r":case"R":r=D(r=t.toString(),a);break;case"x":case"X":if(r=t.toString(16),"X"===l&&(r=r.toUpperCase()),void 0!==o){var u=r.length,h=t<0;h&&u--;var p=o-u,d=void 0;p>0&&(d=s.repeat("0",p)),r=h?"-"+d+r.substring(1):d+r}r=D(r,a);break;default:r=n.Globalize.format(t,e,i)}return r}(t,e,i):C(t,e,i)}catch(e){return n.Globalize.format(t,void 0,i)}},e.formatWithCustomOverride=function(t,e,i,r){return C(t,e,r,i)},e.getCustomFormatMetadata=E},11847:(t,e,i)=>{"use strict";e.Tf=e.G2=void 0,i(44932);var r=i(5062);e.G2=r,i(51248);var n=i(32391);e.Tf=n,i(31107),i(83801),i(6721),i(60604),i(47925),i(67630),i(23224),i(31520),i(63100),i(15807)},31107:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},70167:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ephemeralStorageService=e.EphemeralStorageService=void 0;var i=function(){function t(e){this.cache={},this.clearCacheInterval=null!=e?e:t.defaultClearCacheInterval,this.clearCache()}return t.prototype.getData=function(t){return this.cache[t]},t.prototype.setData=function(t,e){var i=this;this.cache[t]=e,null==this.clearCacheTimerId&&(this.clearCacheTimerId=setTimeout((function(){return i.clearCache()}),this.clearCacheInterval))},t.prototype.clearCache=function(){this.cache={},this.clearCacheTimerId=void 0},t.defaultClearCacheInterval=864e5,t}();e.EphemeralStorageService=i,e.ephemeralStorageService=new i},51248:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stripTagDelimiters=e.deriveClsCompliantName=e.stringifyAsPrettyJSON=e.normalizeFileName=e.escapeStringForRegex=e.constructNameFromList=e.findUniqueName=e.ensureUniqueNames=e.replaceAll=e.repeat=e.getLengthDifference=e.trimWhitespace=e.trimTrailingWhitespace=e.isWhitespace=e.containsWhitespace=e.isNullOrUndefinedOrWhiteSpaceString=e.isNullOrEmpty=e.stringToArrayBuffer=e.normalizeCase=e.containsIgnoreCase=e.contains=e.startsWith=e.startsWithIgnoreCase=e.equalIgnoreCase=e.format=e.endsWith=void 0;var i=new RegExp("[<>]","g");function r(t,e){return null!=t&&-1!==t.indexOf(e)}function n(t){return t.toUpperCase()}function o(t){return null==t||0===t.length}function s(t){return o(t)||o(t.trim())}function a(t){return t.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}e.endsWith=function(t,e){return-1!==t.indexOf(e,t.length-e.length)},e.format=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];if(s(i))return i;for(var r=0;r<t.length-1;r++){var n=new RegExp("\\{"+r+"\\}","gm");i=i.replace(n,t[r+1])}return i},e.equalIgnoreCase=function(t,e){return n(t)===n(e)},e.startsWithIgnoreCase=function(t,e){var i=n(e);return 0===n(t).indexOf(i)},e.startsWith=function(t,e){return 0===t.indexOf(e)},e.contains=r,e.containsIgnoreCase=function(t,e){return null!=t&&r(n(t),n(e))},e.normalizeCase=n,e.stringToArrayBuffer=function(t){if(o(t))return null;for(var e=new ArrayBuffer(t.length),i=new Uint8Array(e),r=0,n=t.length;r<n;r++)i[r]=t.charCodeAt(r);return i},e.isNullOrEmpty=o,e.isNullOrUndefinedOrWhiteSpaceString=s,e.containsWhitespace=function(t){return/\s/.test(t)},e.isWhitespace=function(t){return""===t.trim()},e.trimTrailingWhitespace=function(t){return t.replace(/\s+$/,"")},e.trimWhitespace=function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")},e.getLengthDifference=function(t,e){return Math.abs(t.length-e.length)},e.repeat=function(t,e){for(var i="",r=0;r<e;r++)i+=t;return i},e.replaceAll=function(t,e,i){if(!e)return t;var r=a(e);return t.replace(new RegExp(r,"gi"),i)},e.ensureUniqueNames=function(t){for(var e={},i=0,r=t;i<r.length;i++)e[r[i]]=!1;for(var n=[],o=0,s=t;o<s.length;o++){var a=s[o],l=a;if(e[l])for(var c=0;void 0!==e[l];)l=a+"."+ ++c;n.push(l),e[l]=!0}return n},e.findUniqueName=function(t,e){for(var i=0,r=e;t[r];)r=e+ ++i;return r},e.constructNameFromList=function(t,e,i){for(var r,n=[],o=0,s=0,a=t;s<a.length;s++){var l=a[s];if(o+l.length>i&&n.length>0){r=!0;break}n.push(l),o+=l.length}var c=" "+e+" ",u=n.join(c);return r&&(u+=c+"..."),u},e.escapeStringForRegex=a,e.normalizeFileName=function(t){return t.replace(/[\<\>\:"\/\\\|\?*]/g,"")},e.stringifyAsPrettyJSON=function(t){return JSON.stringify(t)},e.deriveClsCompliantName=function(t,e){var i=t.replace(/^[^A-Za-z]*/g,"").replace(/[ :\.\/\\\-\u00a0\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000]/g,"_").replace(/[\W]/g,"");return i.length>0?i:e},e.stripTagDelimiters=function(t){return t.replace(i,"")}},32391:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.wordBreakOverflowingText=e.wordBreak=e.svgEllipsis=e.getTailoredTextOrDefault=e.getDivElementWidth=e.getSvgMeasurementProperties=e.getMeasurementProperties=e.measureSvgTextElementWidth=e.estimateSvgTextHeight=e.estimateSvgTextBaselineDelta=e.measureSvgTextHeight=e.measureSvgTextRect=e.measureSvgTextWidth=e.removeSpanElement=void 0;var r,n,o,s,a=i(52087),l=i(15807),c=i(70167),u="...";function h(){if(!r){r=document.createElement("span"),document.body.appendChild(r);var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("height","0"),t.setAttribute("width","0"),t.setAttribute("position","absolute"),t.style.top="0px",t.style.left="0px",t.style.position="absolute",t.style.height="0px",t.style.width="0px",n=document.createElementNS("http://www.w3.org/2000/svg","text"),t.appendChild(n),document.body.appendChild(t);var e=document.createElement("canvas");o=e.getContext("2d");var i=window.getComputedStyle(n);s=i?i.fontFamily:""}}function p(t,e){return h(),o.font=(t.fontStyle||"")+" "+(t.fontVariant||"")+" "+(t.fontWeight||"")+" "+t.fontSize+" "+(t.fontFamily||s),o.measureText(e||t.text).width}function d(t,e){for(h();n.firstChild;)n.removeChild(n.firstChild);return n.setAttribute("style",null),n.style.visibility="hidden",n.style.fontFamily=t.fontFamily||s,n.style.fontVariant=t.fontVariant,n.style.fontSize=t.fontSize,n.style.fontWeight=t.fontWeight,n.style.fontStyle=t.fontStyle,n.style.whiteSpace=t.whiteSpace||"nowrap",n.appendChild(document.createTextNode(e||t.text)),n.getBBox()}function f(t){var i=t.fontFamily+t.fontSize,r=c.ephemeralStorageService.getData(i);if(null==r){var n={fontFamily:t.fontFamily,fontSize:t.fontSize,text:"M"};(r=e.measureSvgTextRect(n)).height>0&&c.ephemeralStorageService.setData(i,r)}return r}function m(t,e){void 0===e&&(e=!1);var i=f(t).height;return e&&(i*=.7),i}function g(t){var e=window.getComputedStyle(t);return e?{text:t.textContent,fontFamily:e.fontFamily,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontVariant:e.fontVariant,whiteSpace:e.whiteSpace}:{text:t.textContent,fontFamily:"",fontSize:"0"}}function _(t,e){if(h(),0===t.text.length)return t.text;var i=p(t);if(i<e)return t.text;if(p(t,u)>=i)return t.text;for(var r=a.prototype.inherit(t),n=r.text=u+r.text,o=1,s=n.length,l=3;o<=s;)if(l=(o+s)/2|0,r.text=n.substring(0,l),e>(i=p(r)))o=l+1;else{if(!(e<i))break;s=l-1}return r.text=n.substring(0,l),(i=p(r))>e&&l--,t.text.substring(0,l-3)+u}e.removeSpanElement=function(){r&&r.remove&&r.remove(),r=null},e.measureSvgTextWidth=p,e.measureSvgTextRect=d,e.measureSvgTextHeight=function(t,e){return d(t,e).height},e.estimateSvgTextBaselineDelta=function(t){var e=f(t);return e.y+e.height},e.estimateSvgTextHeight=m,e.measureSvgTextElementWidth=function(t){return p(g(t))},e.getMeasurementProperties=function(t){var e=window.getComputedStyle(t);return{text:t.value||t.textContent,fontFamily:e.fontFamily,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontVariant:e.fontVariant,whiteSpace:e.whiteSpace}},e.getSvgMeasurementProperties=g,e.getDivElementWidth=function(t){var e=window.getComputedStyle(t);return e?e.width:"0"},e.getTailoredTextOrDefault=_,e.svgEllipsis=function(t,e){var i=g(t),r=i.text,n=_(i,e);r!==n&&(t.textContent=n)},e.wordBreak=function(t,e,i,r){void 0===r&&(r=0);var n=g(t),o=m(n)+r,s=Math.max(1,Math.floor(i/o)),a=t?t.getAttribute("y"):null,c=t?t.textContent:null;t.textContent=null;for(var u=l.splitByWidth(c,n,p,e,s),h=document.createDocumentFragment(),d=0,f=u.length;d<f;d++){var y=0===d?a:o;n.text=u[d];var A=document.createElementNS("http://www.w3.org/2000/svg","tspan");A.setAttribute("x","0"),A.setAttribute("dy",y?y.toString():null),A.appendChild(document.createTextNode(_(n,e))),h.appendChild(A)}t.appendChild(h)},e.wordBreakOverflowingText=function(t,e,i,r){void 0===r&&(r=0);var n=g(t),o=m(n)+r,s=Math.max(1,Math.floor(i/o)),c=t.textContent;t.textContent=null;for(var u=l.splitByWidth(c,n,p,e,s),h=document.createDocumentFragment(),d=0;d<u.length;d++){var f=document.createElement("span");f.style.overflow="hidden",f.style.whiteSpace="nowrap",f.style.textOverflow="ellipsis",f.style.display="block",f.style.width=a.pixelConverter.toString(e),f.appendChild(document.createTextNode(u[d])),f.appendChild(document.createTextNode(_(n,e))),h.appendChild(f)}t.appendChild(h)}},60604:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.replaceSpaceWithNBSP=e.removeEllipses=e.removeBreakingSpaces=void 0,e.removeBreakingSpaces=function(t){return t.toString().replace(new RegExp(" ","g"),"&nbsp")},e.removeEllipses=function(t){return t.replace(/()|(\.\.\.)/g,"")},e.replaceSpaceWithNBSP=function(t){if(null!=t)return t.replace(/ /g,"")}},5062:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateExactDigitsPrecision=e.getDisplayUnits=e.formatListOr=e.formatListAnd=e.getFormatStringByColumn=e.getFormatString=e.createDisplayUnitSystem=e.formatVariantMeasureValue=e.format=e.create=e.checkValueInBounds=e.createDefaultFormatter=e.setLocaleOptions=e.getFormatMetadata=e.getLocalizedString=e.DefaultDateFormat=e.DefaultNumericFormat=e.DefaultIntegerFormat=void 0;var r=i(23224),n=i(31520),o=i(51248),s=i(63100),a=i(67630),l=i(52087),c=i(40724),u=l.valueType.ValueType,h=l.valueType.PrimitiveType,p=o,d={"0.00 %;-0.00 %;0.00 %":"Percentage","0.0 %;-0.0 %;0.0 %":"Percentage1"};e.DefaultIntegerFormat="g",e.DefaultNumericFormat="#,0.00",e.DefaultDateFormat="d";var f={NullValue:"(Blank)",BooleanTrue:"True",BooleanFalse:"False",NaNValue:"NaN",InfinityValue:"+Infinity",NegativeInfinityValue:"-Infinity",RestatementComma:"{0}, {1}",RestatementCompoundAnd:"{0} and {1}",RestatementCompoundOr:"{0} or {1}",DisplayUnitSystem_EAuto_Title:"Auto",DisplayUnitSystem_E0_Title:"None",DisplayUnitSystem_E3_LabelFormat:"{0}K",DisplayUnitSystem_E3_Title:"Thousands",DisplayUnitSystem_E6_LabelFormat:"{0}M",DisplayUnitSystem_E6_Title:"Millions",DisplayUnitSystem_E9_LabelFormat:"{0}bn",DisplayUnitSystem_E9_Title:"Billions",DisplayUnitSystem_E12_LabelFormat:"{0}T",DisplayUnitSystem_E12_Title:"Trillions",Percentage:"#,0.##%",Percentage1:"#,0.#%",TableTotalLabel:"Total",Tooltip_HighlightedValueDisplayName:"Highlighted",Funnel_PercentOfFirst:"Percent of first",Funnel_PercentOfPrevious:"Percent of previous",Funnel_PercentOfFirst_Highlight:"Percent of first (highlighted)",Funnel_PercentOfPrevious_Highlight:"Percent of previous (highlighted)",GeotaggingString_Continent:"continent",GeotaggingString_Continents:"continents",GeotaggingString_Country:"country",GeotaggingString_Countries:"countries",GeotaggingString_State:"state",GeotaggingString_States:"states",GeotaggingString_City:"city",GeotaggingString_Cities:"cities",GeotaggingString_Town:"town",GeotaggingString_Towns:"towns",GeotaggingString_Province:"province",GeotaggingString_Provinces:"provinces",GeotaggingString_County:"county",GeotaggingString_Counties:"counties",GeotaggingString_Village:"village",GeotaggingString_Villages:"villages",GeotaggingString_Post:"post",GeotaggingString_Zip:"zip",GeotaggingString_Code:"code",GeotaggingString_Place:"place",GeotaggingString_Places:"places",GeotaggingString_Address:"address",GeotaggingString_Addresses:"addresses",GeotaggingString_Street:"street",GeotaggingString_Streets:"streets",GeotaggingString_Longitude:"longitude",GeotaggingString_Longitude_Short:"lon",GeotaggingString_Longitude_Short2:"long",GeotaggingString_Latitude:"latitude",GeotaggingString_Latitude_Short:"lat",GeotaggingString_PostalCode:"postal code",GeotaggingString_PostalCodes:"postal codes",GeotaggingString_ZipCode:"zip code",GeotaggingString_ZipCodes:"zip codes",GeotaggingString_Territory:"territory",GeotaggingString_Territories:"territories"};e.getLocalizedString=function(t){return f[t]};var m={nullValue:f.NullValue,trueValue:f.BooleanTrue,falseValue:f.BooleanFalse,NaN:f.NaNValue,infinity:f.InfinityValue,negativeInfinity:f.NegativeInfinityValue,beautify:function(t){return function(t){var e=d[t];return e&&f[e]||t}(t)},describe:function(t){return function(t){var e=-1===t?"Auto":t.toString(),i=f["DisplayUnitSystem_E"+e+"_Title"],r=t<=0?"{0}":f["DisplayUnitSystem_E"+e+"_LabelFormat"];if(i||r)return{title:i,format:r}}(t)},restatementComma:f.RestatementComma,restatementCompoundAnd:f.RestatementCompoundAnd,restatementCompoundOr:f.RestatementCompoundOr},g={displayName:"",type:u.fromPrimitiveTypeAndCategory(h.DateTime)};function _(t,e,i){var r=e?m.beautify(t):t;return{format:function(t){return null==t?m.nullValue:x({value:t,cultureSelector:i,format:r})}}}function y(t){if(null==t)return new r.DefaultDisplayUnitSystem(m.describe);switch(t){case n.DisplayUnitSystemType.Default:return new r.DefaultDisplayUnitSystem(m.describe);case n.DisplayUnitSystemType.WholeUnits:return new r.WholeUnitsDisplayUnitSystem(m.describe);case n.DisplayUnitSystemType.Verbose:return new r.NoDisplayUnitSystem;case n.DisplayUnitSystemType.DataLabels:return new r.DataLabelsDisplayUnitSystem(m.describe);default:return new r.DefaultDisplayUnitSystem(m.describe)}}function A(t,i,r){if(t){if(i){var n=c.dataViewObjects.getValue(t.objects,i);if(n)return n}if(!r){var o=t.type;if(o){if(o.dateTime)return e.DefaultDateFormat;if(o.integer)return o.temporal&&o.temporal.year?"0":e.DefaultIntegerFormat;if(o.numeric)return e.DefaultNumericFormat}}}}function v(t,e){var i;if(!t)return null;var r=t.length;if(r>0){i=t[0];for(var n=r-1,o=1,s=n;o<s;o++){var a=t[o];i=p.format(m.restatementComma,i,a)}r>1&&(a=t[n],i=p.format(e,i,a))}else i=null;return i}function x(t){var e=t.value,i=t.format,r=t.nullsAreBlank,n=t.cultureSelector,o=b(e,r||!1);return p.isNullOrUndefinedOrWhiteSpaceString(o)?s.formattingService.formatValue(e,i,n):o}function b(t,e){return null==t&&e?m.nullValue:!0===t?m.trueValue:!1===t?m.falseValue:"number"==typeof t&&isNaN(t)?m.NaN:t===Number.NEGATIVE_INFINITY?m.negativeInfinity:t===Number.POSITIVE_INFINITY?m.infinity:""}e.getFormatMetadata=function(t){return s.numberFormat.getCustomFormatMetadata(t)},e.setLocaleOptions=function(t){m=t,r.DefaultDisplayUnitSystem.RESET(),r.WholeUnitsDisplayUnitSystem.RESET()},e.createDefaultFormatter=_,e.checkValueInBounds=function(t,e,i,r,n){return void 0===r&&(r=e),void 0===n&&(n=i),null!=i&&(t=t<=i?t:n),null!=e&&(t=t>e?t:r),t},e.create=function(t){var e,i,r,n=t.allowFormatBeautification?m.beautify(t.format):t.format,o=t.cultureSelector;if(function(t){var e=t.value,i=t.value2,r=t.format;if(t.formatSingleValues&&r&&Math.abs(e)<1e4)if(s.numberFormat.isStandardFormat(r)){if(l.double.isInteger(e))return!1}else if(s.numberFormat.getCustomFormatMetadata(r,!0).precision<2)return!1;if("number"==typeof e||"number"==typeof i)return!0}(t)){var c=y(t.displayUnitSystemType),u=!!t.formatSingleValues;c.update(Math.max(Math.abs(t.value||0),Math.abs(t.value2||0)));var h,d=null!=t.precision;return d?h=-t.precision:c.displayUnit&&c.displayUnit.value>1&&(h=-2),{format:function(t){var e=b(t,!0);return p.isNullOrUndefinedOrWhiteSpaceString(e)?(t&&!c.isScalingUnit()&&Math.abs(t)<1e3&&!d&&(t=l.double.roundToPrecision(t)),u?c.formatSingleValue(t,n,h,d,o):c.format(t,n,h,d,o)):e},displayUnit:c.displayUnit,options:t}}if(e=t.value,i=t.value2,r=t.tickCount,e instanceof Date&&i instanceof Date&&null!=r){var f=a.DateTimeSequence.GET_INTERVAL_UNIT(t.value,t.value2,t.tickCount);return{format:function(t){if(null==t)return m.nullValue;var e=s.formattingService.dateFormatString(f);return x({value:t,cultureSelector:o,format:e})},options:t}}return _(n,!1,o)},e.format=function(t,e,i,r){return null==t?m.nullValue:x({value:t,cultureSelector:r,format:i?m.beautify(e):e})},e.formatVariantMeasureValue=function(t,e,i,r,n){return!(e&&e.type&&e.type.dateTime)&&t instanceof Date?x({value:t,nullsAreBlank:r,cultureSelector:n,format:A(g,null,!1)}):x({value:t,nullsAreBlank:r,cultureSelector:n,format:A(e,i)})},e.createDisplayUnitSystem=y,e.getFormatString=A,e.getFormatStringByColumn=function(t,i){if(t){if(t.format)return t.format;if(!i){var r=t.type;if(r){if(r.dateTime)return e.DefaultDateFormat;if(r.integer)return r.temporal&&r.temporal.year?"0":e.DefaultIntegerFormat;if(r.numeric)return e.DefaultNumericFormat}}}},e.formatListAnd=function(t){return v(t,m.restatementCompoundAnd)},e.formatListOr=function(t){return v(t,m.restatementCompoundOr)},e.getDisplayUnits=function(t){return y(t).units},e.calculateExactDigitsPrecision=function(t,e,i,r){if(!t&&0!==t)return 0;var n=e&&-1!==e.indexOf("%"),o=n?100*t:t;o=i>0?o/i:o;var s=parseInt(o).toString().length;if((n||i>0)&&s>=r)return 0;if(0===i){var a=Math.floor(s/3);a=s%3==0?a-1:a;var l=Math.pow(1e3,a);l>0&&(o/=l)}var c=(s=parseInt(o).toString().length)%r;return 0===c?0:r-c}},15807:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.splitByWidth=e.getMaxWordWidth=e.wordCount=e.hasBreakers=e.find=void 0;var i=/[\s\n]+/g;function r(t,e,i){if(i){for(var r=t-1;r>-1;r--)if(n(e[r]))return r+1}else{r=t;for(var o=e.length;r<o;r++)if(n(e[r]))return r}return i?0:e.length}function n(t){return i.lastIndex=0,i.test(t)}function o(t){return t.split(i)}function s(t,e,i){return e.text=t,i(e)}function a(t,e,i,r){return e.text=t,i(e,r)}e.find=function(t,e){var i={start:0,end:0};return 0===e.length||(i.start=r(t,e,!0),i.end=r(t,e,!1)),i},e.hasBreakers=n,e.wordCount=function(t){var e=1;for(i.lastIndex=0,i.exec(t);0!==i.lastIndex;)e++,i.exec(t);return e},e.getMaxWordWidth=function(t,e,i){for(var r=0,n=0,s=o(t);n<s.length;n++){var a=s[n];i.text=a,r=Math.max(r,e(i))}return r},e.splitByWidth=function(t,e,i,r,n,l){l=l||function(t,e){return t.text};for(var c=[],u=0,h=[],p=0,d=o(t);p<d.length;p++){var f=d[p];if(n>0&&c.length>=n-1)h.push(f);else{var m=0===h.length?s(f,e,i):s(" "+f,e,i);if(u+m>r){if(0===h.length){c.push(a(f,e,l,r)),u=0,h=[];continue}c.push(a(h.join(" "),e,l,r)),u=0,h=[]}h.push(f),u+=m}}return h&&h.length&&c.push(a(h.join(" "),e,l,r)),c}},85442:(t,e,i)=>{"use strict";i.r(e),i.d(e,{DEFAULT_PRECISION:()=>l,DEFAULT_PRECISION_IN_DECIMAL_DIGITS:()=>c,EPSILON:()=>a,LOG_E_10:()=>u,MAX_EXP:()=>s,MAX_VALUE:()=>n,MIN_EXP:()=>o,MIN_VALUE:()=>r,NEGATIVE_POWERS:()=>p,POSITIVE_POWERS:()=>h,ceilToPrecision:()=>S,ceilWithPrecision:()=>b,detectPrecision:()=>k,ensureInRange:()=>C,equalWithPrecision:()=>g,floorToPrecision:()=>w,floorWithPrecision:()=>x,getPrecision:()=>m,greaterOrEqualWithPrecision:()=>v,greaterWithPrecision:()=>A,isInteger:()=>L,lessOrEqualWithPrecision:()=>y,lessWithPrecision:()=>_,log10:()=>f,pow10:()=>d,project:()=>E,removeDecimalNoise:()=>I,round:()=>M,roundToPrecision:()=>T,toIncrement:()=>P});const r=-Number.MAX_VALUE,n=Number.MAX_VALUE,o=-308,s=308,a=1e-323,l=1e-4,c=12,u=Math.log(10),h=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13,1e14,1e15,1e16,1e17,1e18,1e19,1e20,1e21,1e22,1e23,1e24,1e25,1e26,1e27,1e28,1e29,1e30,1e31,1e32,1e33,1e34,1e35,1e36,1e37,1e38,1e39,1e40,1e41,1e42,1e43,1e44,1e45,1e46,1e47,1e48,1e49,1e50,1e51,1e52,1e53,1e54,1e55,1e56,1e57,1e58,1e59,1e60,1e61,1e62,1e63,1e64,1e65,1e66,1e67,1e68,1e69,1e70,1e71,1e72,1e73,1e74,1e75,1e76,1e77,1e78,1e79,1e80,1e81,1e82,1e83,1e84,1e85,1e86,1e87,1e88,1e89,1e90,1e91,1e92,1e93,1e94,1e95,1e96,1e97,1e98,1e99,1e100,1e101,1e102,1e103,1e104,1e105,1e106,1e107,1e108,1e109,1e110,1e111,1e112,1e113,1e114,1e115,1e116,1e117,1e118,1e119,1e120,1e121,1e122,1e123,1e124,1e125,1e126,1e127,1e128,1e129,1e130,1e131,1e132,1e133,1e134,1e135,1e136,1e137,1e138,1e139,1e140,1e141,1e142,1e143,1e144,1e145,1e146,1e147,1e148,1e149,1e150,1e151,1e152,1e153,1e154,1e155,1e156,1e157,1e158,1e159,1e160,1e161,1e162,1e163,1e164,1e165,1e166,1e167,1e168,1e169,1e170,1e171,1e172,1e173,1e174,1e175,1e176,1e177,1e178,1e179,1e180,1e181,1e182,1e183,1e184,1e185,1e186,1e187,1e188,1e189,1e190,1e191,1e192,1e193,1e194,1e195,1e196,1e197,1e198,1e199,1e200,1e201,1e202,1e203,1e204,1e205,1e206,1e207,1e208,1e209,1e210,1e211,1e212,1e213,1e214,1e215,1e216,1e217,1e218,1e219,1e220,1e221,1e222,1e223,1e224,1e225,1e226,1e227,1e228,1e229,1e230,1e231,1e232,1e233,1e234,1e235,1e236,1e237,1e238,1e239,1e240,1e241,1e242,1e243,1e244,1e245,1e246,1e247,1e248,1e249,1e250,1e251,1e252,1e253,1e254,1e255,1e256,1e257,1e258,1e259,1e260,1e261,1e262,1e263,1e264,1e265,1e266,1e267,1e268,1e269,1e270,1e271,1e272,1e273,1e274,1e275,1e276,1e277,1e278,1e279,1e280,1e281,1e282,1e283,1e284,1e285,1e286,1e287,1e288,1e289,1e290,1e291,1e292,1e293,1e294,1e295,1e296,1e297,1e298,1e299,1e300,1e301,1e302,1e303,1e304,1e305,1e306,1e307,1e308],p=[1,.1,.01,.001,1e-4,1e-5,1e-6,1e-7,1e-8,1e-9,1e-10,1e-11,1e-12,1e-13,1e-14,1e-15,1e-16,1e-17,1e-18,1e-19,1e-20,1e-21,1e-22,1e-23,1e-24,1e-25,1e-26,1e-27,1e-28,1e-29,1e-30,1e-31,1e-32,1e-33,1e-34,1e-35,1e-36,1e-37,1e-38,1e-39,1e-40,1e-41,1e-42,1e-43,1e-44,1e-45,1e-46,1e-47,1e-48,1e-49,1e-50,1e-51,1e-52,1e-53,1e-54,1e-55,1e-56,1e-57,1e-58,1e-59,1e-60,1e-61,1e-62,1e-63,1e-64,1e-65,1e-66,1e-67,1e-68,1e-69,1e-70,1e-71,1e-72,1e-73,1e-74,1e-75,1e-76,1e-77,1e-78,1e-79,1e-80,1e-81,1e-82,1e-83,1e-84,1e-85,1e-86,1e-87,1e-88,1e-89,1e-90,1e-91,1e-92,1e-93,1e-94,1e-95,1e-96,1e-97,1e-98,1e-99,1e-100,1e-101,1e-102,1e-103,1e-104,1e-105,1e-106,1e-107,1e-108,1e-109,1e-110,1e-111,1e-112,1e-113,1e-114,1e-115,1e-116,1e-117,1e-118,1e-119,1e-120,1e-121,1e-122,1e-123,1e-124,1e-125,1e-126,1e-127,1e-128,1e-129,1e-130,1e-131,1e-132,1e-133,1e-134,1e-135,1e-136,1e-137,1e-138,1e-139,1e-140,1e-141,1e-142,1e-143,1e-144,1e-145,1e-146,1e-147,1e-148,1e-149,1e-150,1e-151,1e-152,1e-153,1e-154,1e-155,1e-156,1e-157,1e-158,1e-159,1e-160,1e-161,1e-162,1e-163,1e-164,1e-165,1e-166,1e-167,1e-168,1e-169,1e-170,1e-171,1e-172,1e-173,1e-174,1e-175,1e-176,1e-177,1e-178,1e-179,1e-180,1e-181,1e-182,1e-183,1e-184,1e-185,1e-186,1e-187,1e-188,1e-189,1e-190,1e-191,1e-192,1e-193,1e-194,1e-195,1e-196,1e-197,1e-198,1e-199,1e-200,1e-201,1e-202,1e-203,1e-204,1e-205,1e-206,1e-207,1e-208,1e-209,1e-210,1e-211,1e-212,1e-213,1e-214,1e-215,1e-216,1e-217,1e-218,1e-219,1e-220,1e-221,1e-222,1e-223,1e-224,1e-225,1e-226,1e-227,1e-228,1e-229,1e-230,1e-231,1e-232,1e-233,1e-234,1e-235,1e-236,1e-237,1e-238,1e-239,1e-240,1e-241,1e-242,1e-243,1e-244,1e-245,1e-246,1e-247,1e-248,1e-249,1e-250,1e-251,1e-252,1e-253,1e-254,1e-255,1e-256,1e-257,1e-258,1e-259,1e-260,1e-261,1e-262,1e-263,1e-264,1e-265,1e-266,1e-267,1e-268,1e-269,1e-270,1e-271,1e-272,1e-273,1e-274,1e-275,1e-276,1e-277,1e-278,1e-279,1e-280,1e-281,1e-282,1e-283,1e-284,1e-285,1e-286,1e-287,1e-288,1e-289,1e-290,1e-291,1e-292,1e-293,1e-294,1e-295,1e-296,1e-297,1e-298,1e-299,1e-300,1e-301,1e-302,1e-303,1e-304,1e-305,1e-306,1e-307,1e-308,1e-309,1e-310,1e-311,1e-312,1e-313,1e-314,1e-315,1e-316,1e-317,1e-318,1e-319,1e-320,1e-321,1e-322,1e-323,0];function d(t){return t>=0?t<h.length?h[t]:1/0:(t=-t)>0&&t<p.length?p[t]:0}function f(t){return t>1&&t<1e16?t<1e8?t<1e4?t<100?t<10?0:1:t<1e3?2:3:t<1e6?t<1e5?4:5:t<1e7?6:7:t<1e12?t<1e10?t<1e9?8:9:t<1e11?10:11:t<1e14?t<1e13?12:13:t<1e15?14:15:t>1e-16&&t<1?t<1e-8?t<1e-12?t<1e-14?t<1e-15?-16:-15:t<1e-13?-14:-13:t<1e-10?t<1e-11?-12:-11:t<1e-9?-10:-9:t<1e-4?t<1e-6?t<1e-7?-8:-7:t<1e-5?-6:-5:t<.01?t<.001?-4:-3:t<.1?-2:-1:x(Math.log(t)/u)}function m(t,e){if(void 0===e&&(e=c),!t||!isFinite(t))return;const i=f(Math.abs(t));return i<o?0:d(Math.max(i-e,1-p.length))}function g(t,e,i){return i=k(i,t,e),t===e||Math.abs(t-e)<i}function _(t,e,i){return i=k(i,t,e),t<e&&Math.abs(t-e)>i}function y(t,e,i){return i=k(i,t,e),t<e||Math.abs(t-e)<i}function A(t,e,i){return i=k(i,t,e),t>e&&Math.abs(t-e)>i}function v(t,e,i){return i=k(i,t,e),t>e||Math.abs(t-e)<i}function x(t,e){e=null!=e?e:l;const i=Math.round(t);return Math.abs(t-i)<e?i:Math.floor(t)}function b(t,e){e=k(e,l);const i=Math.round(t);return Math.abs(t-i)<e?i:Math.ceil(t)}function w(t,e){return 0===(e=k(e,l))||0===t?t:Math.floor(t/e)*e}function S(t,e){return 0===(e=k(e,l))||0===t?t:Math.ceil(t/e)*e}function T(t,e){if(0===(e=k(e,l))||0===t)return t;let i=Math.round(t/e)*e;const r=Math.round(f(Math.abs(t))-f(e))+1;return r>0&&r<16&&(i=parseFloat(i.toPrecision(r))),i}function C(t,e,i){return null==t?t:t<e?e:t>i?i:t}function M(t){return.5+t|0}function E(t,e,i,r,n){return 0===i||0===n?e<=t&&t<=e+i?r:NaN:r+(t-e)/i*n}function I(t){return T(t,m(t))}function L(t){return null!==t&&t%1==0}function P(t,e){return Math.round(t/e)*e}function k(t,e,i){if(void 0!==t)return t;let r;return r=m(i?e?Math.min(Math.abs(e),Math.abs(i)):i:e),r||l}},94341:(t,e,i)=>{"use strict";function r(t,e){const i=[];for(let r=t.length-1;r>=0;--r)-1!==e.indexOf(t[r])&&i.push(t[r]);return i}function n(t,e){const i=[];for(let r=t.length-1;r>=0;--r){const n=t[r];-1===e.indexOf(n)&&i.push(n)}return i}function o(t){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];-1===e.indexOf(r)&&e.push(r)}return e}function s(t,e){for(let i=0,r=e.length;i<r;++i)a(t,e[i])}function a(t,e){t.indexOf(e)<0&&t.push(e)}function l(t,e,i){const r=[];for(let n=e;n<=i;++n)r.push(t[n]);return r}function c(t,e){const i=[];for(let r=0;r<e;++r)i.push(t[r]);return i}function u(t){return c(t,t.length)}function h(t,e,i){if(t||(t=null),e||(e=null),t===e)return!0;if(!!t!=!!e)return!1;const r=t.length;if(r!==e.length)return!1;let n=0;for(;n<r&&i(t[n],e[n]);)++n;return n===r}function p(t){return t&&0===t.length?null:t}function d(t,e){for(let i=0,r=t.length;i<r;++i)if(e(t[i]))return i;return-1}function f(t,e){if(0===e)return t.slice();const i=t.slice(e);return Array.prototype.push.apply(i,t.slice(0,e)),i}function m(){return g([])}function g(t){const e=t;return e.withId=y,e}function _(t,e){for(let i=0,r=t.length;i<r;i++){const r=t[i];if(r.id===e)return r}}function y(t){return _(this,t)}function A(){return v([])}function v(t){const e=t;return e.withName=T,e}function x(t,e){const i=b(t,e);if(i>=0)return t[i]}function b(t,e){for(let i=0,r=t.length;i<r;i++)if(t[i].name===e)return i;return-1}function w(t,e){for(let i=t.length-1;i>=0;i--){const r=t[i]-e;if(0===r)return!1;if(!(r>0))return t.splice(i+1,0,e),!0}return t.unshift(e),!0}function S(t,e){const i=t.indexOf(e);return!(i<0||(t.splice(i,1),0))}function T(t){return x(this,t)}function C(t){if(t)for(;t.length>0;)t.pop()}function M(t){return!t||0===t.length}function E(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function I(t,e,i){return t.some((t=>i(t,e)))}function L(t){let e=t;for(;null!=e;){if(Array.isArray(e))return!0;e=Object.getPrototypeOf(e)}return!1}function P(t,e){const i=t.length;if(i>=2)for(let r=1;r<i;r++)if(e(t[r-1],t[r])>0)return!1;return!0}function k(t,e){return P(t,e?(t,e)=>e-t:(t,e)=>t-e)}function N(t){return Array.isArray(t)?t:[t]}i.r(e),i.d(e,{clear:()=>C,copy:()=>u,createWithId:()=>m,createWithName:()=>A,diff:()=>n,distinct:()=>o,emptyToNull:()=>p,ensureArray:()=>N,extendWithId:()=>g,extendWithName:()=>v,findItemWithName:()=>x,findWithId:()=>_,indexOf:()=>d,indexWithName:()=>b,insertSorted:()=>w,intersect:()=>r,isArrayOrInheritedArray:()=>L,isInArray:()=>I,isSorted:()=>P,isSortedNumeric:()=>k,isUndefinedOrEmpty:()=>M,range:()=>l,removeFirst:()=>S,rotate:()=>f,sequenceEqual:()=>h,swap:()=>E,take:()=>c,union:()=>s,unionSingle:()=>a})},2879:(t,e,i)=>{"use strict";i.r(e),i.d(e,{getBitCount:()=>l,hasFlag:()=>n,resetFlag:()=>s,setFlag:()=>o,toString:()=>a});var r=i(85442);function n(t,e){return(t&e)===e}function o(t,e){return t|e}function s(t,e){return t&~e}function a(t,e){return t[e]}function l(t){if(!(0,r.isInteger)(t))return 0;let e=0,i=t;for(;0!==i;)1&~i||e++,i>>>=1;return e}},54298:(t,e,i)=>{"use strict";function r(t,e){return(t||e)&&!(t&&e)}i.r(e),i.d(e,{XOR:()=>r})},93051:(t,e,i)=>{"use strict";function r(t,e,i){return t.lastIndex=i||0,t.exec(e)}i.r(e),i.d(e,{run:()=>r})},70539:(t,e,i)=>{"use strict";function r(t,e){return-1!==t.indexOf(e,t.length-e.length)}i.r(e),i.d(e,{endsWith:()=>r})},52087:(t,e,i)=>{"use strict";i.r(e),i.d(e,{arrayExtensions:()=>r,double:()=>u,enumExtensions:()=>n,jsonComparer:()=>h,logicExtensions:()=>o,numericSequence:()=>l,numericSequenceRange:()=>c,pixelConverter:()=>p,prototype:()=>d,regExpExtensions:()=>s,stringExtensions:()=>a,textSizeDefaults:()=>f,valueType:()=>m});var r=i(94341),n=i(2879),o=i(54298),s=i(93051),a=i(70539),l=i(80372),c=i(20067),u=i(85442),h=i(15038),p=i(55079),d=i(90421),f=i(35939),m=i(64182)},15038:(t,e,i)=>{"use strict";function r(t,e){return t===e||JSON.stringify(t)===JSON.stringify(e)}i.r(e),i.d(e,{equals:()=>r})},80372:(t,e,i)=>{"use strict";i.r(e),i.d(e,{NumericSequence:()=>o});var r=i(85442),n=i(20067);class o{static calculate(t,e,i,s,a,l){const c=new o;if(e=void 0===e?10:r.ensureInRange(e,o.MIN_COUNT,o.MAX_COUNT),void 0===s&&(s=r.MIN_EXP),void 0===a&&(a=!1),void 0===i&&(i=1),void 0===l&&(l=[1,2,5]),t.forcedSingleStop)return c.interval=t.getSize(),c.intervalOffset=c.interval-(t.forcedSingleStop-t.min),c.min=t.min,c.max=t.max,c.sequence=[t.forcedSingleStop],c;let u=0,h=0,p=9;const d=i>0&&!t.hasFixedMin,f=i>0&&!t.hasFixedMax,m=t.getSize();let g=r.log10(m);const _=r.log10(l[0]);let y;if(g-=_,g-=r.log10(e),g=Math.max(g,s-_+1),0!==u){const e=r.pow10(g),i=r.floorToPrecision(t.min,e),o=r.ceilToPrecision(t.max,e),s=n.NumericSequenceRange.calculateFixedRange(i,o);s.shrinkByStep(t,u),h=s.min,p=s.max,y=Math.floor(s.getSize()/u)}else{let o;for(o=0;o<3;o++){const s=g+o,c=r.pow10(s),m=r.floorToPrecision(t.min,c),_=r.ceilToPrecision(t.max,c),A=l.length,v=r.pow10(s-1);for(let s=0;s<A;s++){const c=l[s]*v,g=n.NumericSequenceRange.calculateFixedRange(m,_,a);if(g.shrinkByStep(t,c),d&&t.min===g.min&&i>=1&&(g.min-=c),f&&t.max===g.max&&i>=1&&(g.max+=c),y=r.ceilWithPrecision(g.getSize()/c,r.DEFAULT_PRECISION),y<=e||2===o&&s===A-1||1===e&&2===y&&(c>t.getSize()||t.min<0&&t.max>0&&2*c>=t.getSize())){u=c,h=g.min,p=g.max;break}}if(0!==u)break}}(y>32*e||y>o.MAX_COUNT)&&(y=Math.min(32*e,o.MAX_COUNT),u=(p-h)/y),c.min=h,c.max=p,c.interval=u,c.intervalOffset=h-t.min,c.maxAllowedMargin=i,c.canExtendMin=d,c.canExtendMax=f;const A=r.getPrecision(u,0);c.precision=A;const v=[];let x=r.roundToPrecision(h,A);v.push(x);for(let t=0;t<y;t++)x=r.roundToPrecision(x+u,A),v.push(x);return c.sequence=v,c.trimMinMax(t.min,t.max),c}static calculateUnits(t,e,i,n){i=r.ensureInRange(i,o.MIN_COUNT,o.MAX_COUNT),t===e&&(e=t+1);let s=0,a=0;for(let o=0;o<n.length&&(a=n[o],s=r.ceilWithPrecision(e/a)-r.floorWithPrecision(t/a),!(s<=i));o++);let l=-t;l%=a;const c=new o;c.sequence=[];for(let i=t+l;c.sequence.push(i),!(i>=e);i+=a);return c.interval=a,c.intervalOffset=l,c.min=c.sequence[0],c.max=c.sequence[c.sequence.length-1],c}trimMinMax(t,e){const i=(t-this.min)/this.interval,r=(this.max-e)/this.interval;(!this.canExtendMin||i>this.maxAllowedMargin&&i>.001)&&(this.min=t),(!this.canExtendMax||r>this.maxAllowedMargin&&r>.001)&&(this.max=e)}}o.MIN_COUNT=1,o.MAX_COUNT=1e3},20067:(t,e,i)=>{"use strict";i.r(e),i.d(e,{NumericSequenceRange:()=>n,hasValue:()=>o});var r=i(85442);class n{_ensureIncludeZero(){this.includeZero&&(this.min>0&&!this.hasFixedMin&&(this.min=0),this.max<0&&!this.hasFixedMax&&(this.max=0))}_ensureNotEmpty(){if(this.min===this.max)if(this.min){const t=this.min,e=r.log10(Math.abs(t));let i;e>=0&&e<4?(i=.5,this.forcedSingleStop=t):(i=r.pow10(e)/2,this.forcedSingleStop=null),this.min=t-i,this.max=t+i}else this.min=0,this.max=n.DEFAULT_MAX,this.hasFixedMin=!0,this.hasFixedMax=!0}_ensureDirection(){if(this.min>this.max){const t=this.min;this.min=this.max,this.max=t}}getSize(){return this.max-this.min}shrinkByStep(t,e){let i=this.min/e,r=t.min/e,n=Math.floor(r-i);this.min+=n*e,i=this.max/e,r=t.max/e,n=Math.ceil(r-i),this.max+=n*e}static calculate(t,e,i,s,a){const l=new n;return l.includeZero=!!a,l.hasDataRange=o(t)&&o(e),l.hasFixedMin=o(i),l.hasFixedMax=o(s),t=r.ensureInRange(t,n.MIN_SUPPORTED_DOUBLE,n.MAX_SUPPORTED_DOUBLE),e=r.ensureInRange(e,n.MIN_SUPPORTED_DOUBLE,n.MAX_SUPPORTED_DOUBLE),l.hasFixedMin&&l.hasFixedMax?(l.min=i,l.max=s):l.hasFixedMin?(l.min=i,l.max=e>i?e:i):l.hasFixedMax?(l.min=t<s?t:s,l.max=s):l.hasDataRange?(l.min=t,l.max=e):(l.min=0,l.max=0),l._ensureIncludeZero(),l._ensureNotEmpty(),l._ensureDirection(),0===l.min?l.hasFixedMin=!0:0===l.max&&(l.hasFixedMax=!0),l}static calculateDataRange(t,e,i){return o(t)&&o(e)?n.calculate(t,e,null,null,i):n.calculateFixedRange(0,n.DEFAULT_MAX)}static calculateFixedRange(t,e,i){const r=new n;return r.hasDataRange=!1,r.includeZero=i,r.min=t,r.max=e,r._ensureIncludeZero(),r._ensureNotEmpty(),r._ensureDirection(),r.hasFixedMin=!0,r.hasFixedMax=!0,r}}function o(t){return null!=t}n.DEFAULT_MAX=10,n.MIN_SUPPORTED_DOUBLE=-1e307,n.MAX_SUPPORTED_DOUBLE=1e307},55079:(t,e,i)=>{"use strict";i.r(e),i.d(e,{fromPoint:()=>s,fromPointToPixel:()=>a,toPoint:()=>l,toString:()=>o});const r=4/3,n="px";function o(t){return t+n}function s(t){return o(a(t))}function a(t){return r*t}function l(t){return t/r}},90421:(t,e,i)=>{"use strict";function r(t,e){function i(){}i.prototype=t;const r=new i;return e&&e(r),r}function n(t){const e=Object.getPrototypeOf(t);return e!==Object.prototype&&e!==Array.prototype||(t=r(t)),t}function o(t,e){if(!t)return;let i;for(let n=0,o=t.length;n<o;n++){const o=e(t[n]);o&&(i||(i=r(t)),i[n]=o)}return i}i.r(e),i.d(e,{inherit:()=>r,inheritSingle:()=>n,overrideArray:()=>o})},35939:(t,e,i)=>{"use strict";i.r(e),i.d(e,{TextSizeMax:()=>n,TextSizeMin:()=>r,getScale:()=>s});const r=8,n=40,o=n-r;function s(t){return(t-r)/o}},64182:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ExtendedType:()=>o,FormattingType:()=>f,GeographyType:()=>p,MiscellaneousType:()=>d,PrimitiveType:()=>r,ScriptType:()=>u,TemporalType:()=>h,ValueType:()=>c});var r,n,o,s,a=i(2879),l=i(15038);class c{constructor(t,e,i,r){this.underlyingType=t,this.category=e,a.hasFlag(t,o.Temporal)&&(this.temporalType=new h(t)),a.hasFlag(t,o.Geography)&&(this.geographyType=new p(t)),a.hasFlag(t,o.Miscellaneous)&&(this.miscType=new d(t)),a.hasFlag(t,o.Formatting)&&(this.formattingType=new f(t)),a.hasFlag(t,o.Enumeration)&&(this.enumType=i),a.hasFlag(t,o.Scripting)&&(this.scriptingType=new u(t)),a.hasFlag(t,o.Variant)&&(this.variationTypes=r)}static fromDescriptor(t){if((t=t||{}).text)return c.fromExtendedType(o.Text);if(t.integer)return c.fromExtendedType(o.Integer);if(t.numeric)return c.fromExtendedType(o.Double);if(t.bool)return c.fromExtendedType(o.Boolean);if(t.dateTime)return c.fromExtendedType(o.DateTime);if(t.duration)return c.fromExtendedType(o.Duration);if(t.binary)return c.fromExtendedType(o.Binary);if(t.none)return c.fromExtendedType(o.None);if(t.scripting&&t.scripting.source)return c.fromExtendedType(o.ScriptSource);if(t.enumeration)return c.fromEnum(t.enumeration);if(t.temporal){if(t.temporal.year)return c.fromExtendedType(o.Years_Integer);if(t.temporal.quarter)return c.fromExtendedType(o.Quarters_Integer);if(t.temporal.month)return c.fromExtendedType(o.Months_Integer);if(t.temporal.day)return c.fromExtendedType(o.DayOfMonth_Integer);if(t.temporal.paddedDateTableDate)return c.fromExtendedType(o.PaddedDateTableDates)}if(t.geography){if(t.geography.address)return c.fromExtendedType(o.Address);if(t.geography.city)return c.fromExtendedType(o.City);if(t.geography.continent)return c.fromExtendedType(o.Continent);if(t.geography.country)return c.fromExtendedType(o.Country);if(t.geography.county)return c.fromExtendedType(o.County);if(t.geography.region)return c.fromExtendedType(o.Region);if(t.geography.postalCode)return c.fromExtendedType(o.PostalCode_Text);if(t.geography.stateOrProvince)return c.fromExtendedType(o.StateOrProvince);if(t.geography.place)return c.fromExtendedType(o.Place);if(t.geography.latitude)return c.fromExtendedType(o.Latitude_Double);if(t.geography.longitude)return c.fromExtendedType(o.Longitude_Double)}if(t.misc){if(t.misc.image)return c.fromExtendedType(o.Image);if(t.misc.imageUrl)return c.fromExtendedType(o.ImageUrl);if(t.misc.webUrl)return c.fromExtendedType(o.WebUrl);if(t.misc.barcode)return c.fromExtendedType(o.Barcode_Text)}if(t.formatting){if(t.formatting.color)return c.fromExtendedType(o.Color);if(t.formatting.formatString)return c.fromExtendedType(o.FormatString);if(t.formatting.alignment)return c.fromExtendedType(o.Alignment);if(t.formatting.labelDisplayUnits)return c.fromExtendedType(o.LabelDisplayUnits);if(t.formatting.fontSize)return c.fromExtendedType(o.FontSize);if(t.formatting.labelDensity)return c.fromExtendedType(o.LabelDensity)}if(t.extendedType)return c.fromExtendedType(t.extendedType);if(t.operations&&t.operations.searchEnabled)return c.fromExtendedType(o.SearchEnabled);if(t.variant){const e=t.variant.map((t=>c.fromDescriptor(t)));return c.fromVariant(e)}return c.fromExtendedType(o.Null)}static fromExtendedType(t){const e=y(t=t||o.Null),i=function(t){if(function(t){return(t&g)===t}(t))return null;let e=s[t];if(e){const t=e.lastIndexOf("_");if(t>0){const i=e.slice(0,t);s[i]&&(e=i)}}return e||null}(t);return c.fromPrimitiveTypeAndCategory(e,i)}static fromPrimitiveTypeAndCategory(t,e){e=e||null;let i=(t=t||r.Null).toString();return e&&(i+="|"+e),c.typeCache[i]||(c.typeCache[i]=new c(function(t,e){const i=n[t];let a=s[i];if(null==a&&(a=o.Null),t&&e){let i=s[e];if(i){const e=y(i);e===r.Null?(i|=a,s[i]&&(a=i)):e===t&&(a=i)}}return a}(t,e),e))}static fromEnum(t){return new c(o.Enumeration,null,t)}static fromVariant(t){return new c(o.Variant,null,null,t)}static isCompatibleTo(t,e){const i=c.fromDescriptor(t);for(const t of e)if(c.fromDescriptor(t).isCompatibleFrom(i))return!0;return!1}isCompatibleFrom(t){const e=t.primitiveType;return!!(this===t||this.primitiveType===e||e===r.Null||this.numeric&&t.numeric)}equals(t){return(0,l.equals)(this,t)}get primitiveType(){return y(this.underlyingType)}get extendedType(){return this.underlyingType}get categoryString(){return this.category}get text(){return this.primitiveType===r.Text}get numeric(){return a.hasFlag(this.underlyingType,o.Numeric)}get integer(){return this.primitiveType===r.Integer}get bool(){return this.primitiveType===r.Boolean}get dateTime(){return this.primitiveType===r.DateTime||this.primitiveType===r.Date||this.primitiveType===r.Time}get duration(){return this.primitiveType===r.Duration}get binary(){return this.primitiveType===r.Binary}get none(){return this.primitiveType===r.None}get temporal(){return this.temporalType}get geography(){return this.geographyType}get misc(){return this.miscType}get formatting(){return this.formattingType}get enumeration(){return this.enumType}get scripting(){return this.scriptingType}get variant(){return this.variationTypes}}c.typeCache={};class u{constructor(t){this.underlyingType=t}get source(){return A(this.underlyingType,o.ScriptSource)}}class h{constructor(t){this.underlyingType=t}get year(){return A(this.underlyingType,o.Years)}get quarter(){return A(this.underlyingType,o.Quarters)}get month(){return A(this.underlyingType,o.Months)}get day(){return A(this.underlyingType,o.DayOfMonth)}get paddedDateTableDate(){return A(this.underlyingType,o.PaddedDateTableDates)}}class p{constructor(t){this.underlyingType=t}get address(){return A(this.underlyingType,o.Address)}get city(){return A(this.underlyingType,o.City)}get continent(){return A(this.underlyingType,o.Continent)}get country(){return A(this.underlyingType,o.Country)}get county(){return A(this.underlyingType,o.County)}get region(){return A(this.underlyingType,o.Region)}get postalCode(){return A(this.underlyingType,o.PostalCode)}get stateOrProvince(){return A(this.underlyingType,o.StateOrProvince)}get place(){return A(this.underlyingType,o.Place)}get latitude(){return A(this.underlyingType,o.Latitude)}get longitude(){return A(this.underlyingType,o.Longitude)}}class d{constructor(t){this.underlyingType=t}get image(){return A(this.underlyingType,o.Image)}get imageUrl(){return A(this.underlyingType,o.ImageUrl)}get webUrl(){return A(this.underlyingType,o.WebUrl)}get barcode(){return A(this.underlyingType,o.Barcode)}}class f{constructor(t){this.underlyingType=t}get color(){return A(this.underlyingType,o.Color)}get formatString(){return A(this.underlyingType,o.FormatString)}get alignment(){return A(this.underlyingType,o.Alignment)}get labelDisplayUnits(){return A(this.underlyingType,o.LabelDisplayUnits)}get fontSize(){return A(this.underlyingType,o.FontSize)}get labelDensity(){return A(this.underlyingType,o.LabelDensity)}}!function(t){t[t.Null=0]="Null",t[t.Text=1]="Text",t[t.Decimal=2]="Decimal",t[t.Double=3]="Double",t[t.Integer=4]="Integer",t[t.Boolean=5]="Boolean",t[t.Date=6]="Date",t[t.DateTime=7]="DateTime",t[t.DateTimeZone=8]="DateTimeZone",t[t.Time=9]="Time",t[t.Duration=10]="Duration",t[t.Binary=11]="Binary",t[t.None=12]="None",t[t.Variant=13]="Variant"}(r||(r={})),function(t){t[t.Null=0]="Null",t[t.Text=1]="Text",t[t.Decimal=2]="Decimal",t[t.Double=3]="Double",t[t.Integer=4]="Integer",t[t.Boolean=5]="Boolean",t[t.Date=6]="Date",t[t.DateTime=7]="DateTime",t[t.DateTimeZone=8]="DateTimeZone",t[t.Time=9]="Time",t[t.Duration=10]="Duration",t[t.Binary=11]="Binary",t[t.None=12]="None",t[t.Variant=13]="Variant"}(n||(n={})),function(t){t[t.Numeric=256]="Numeric",t[t.Temporal=512]="Temporal",t[t.Geography=1024]="Geography",t[t.Miscellaneous=2048]="Miscellaneous",t[t.Formatting=4096]="Formatting",t[t.Scripting=8192]="Scripting",t[t.Null=0]="Null",t[t.Text=1]="Text",t[t.Decimal=258]="Decimal",t[t.Double=259]="Double",t[t.Integer=260]="Integer",t[t.Boolean=5]="Boolean",t[t.Date=518]="Date",t[t.DateTime=519]="DateTime",t[t.DateTimeZone=520]="DateTimeZone",t[t.Time=521]="Time",t[t.Duration=10]="Duration",t[t.Binary=11]="Binary",t[t.None=12]="None",t[t.Variant=13]="Variant",t[t.Years=66048]="Years",t[t.Years_Text=66049]="Years_Text",t[t.Years_Integer=66308]="Years_Integer",t[t.Years_Date=66054]="Years_Date",t[t.Years_DateTime=66055]="Years_DateTime",t[t.Months=131584]="Months",t[t.Months_Text=131585]="Months_Text",t[t.Months_Integer=131844]="Months_Integer",t[t.Months_Date=131590]="Months_Date",t[t.Months_DateTime=131591]="Months_DateTime",t[t.PaddedDateTableDates=197127]="PaddedDateTableDates",t[t.Quarters=262656]="Quarters",t[t.Quarters_Text=262657]="Quarters_Text",t[t.Quarters_Integer=262916]="Quarters_Integer",t[t.Quarters_Date=262662]="Quarters_Date",t[t.Quarters_DateTime=262663]="Quarters_DateTime",t[t.DayOfMonth=328192]="DayOfMonth",t[t.DayOfMonth_Text=328193]="DayOfMonth_Text",t[t.DayOfMonth_Integer=328452]="DayOfMonth_Integer",t[t.DayOfMonth_Date=328198]="DayOfMonth_Date",t[t.DayOfMonth_DateTime=328199]="DayOfMonth_DateTime",t[t.Address=6554625]="Address",t[t.City=6620161]="City",t[t.Continent=6685697]="Continent",t[t.Country=6751233]="Country",t[t.County=6816769]="County",t[t.Region=6882305]="Region",t[t.PostalCode=6947840]="PostalCode",t[t.PostalCode_Text=6947841]="PostalCode_Text",t[t.PostalCode_Integer=6948100]="PostalCode_Integer",t[t.StateOrProvince=7013377]="StateOrProvince",t[t.Place=7078913]="Place",t[t.Latitude=7144448]="Latitude",t[t.Latitude_Decimal=7144706]="Latitude_Decimal",t[t.Latitude_Double=7144707]="Latitude_Double",t[t.Longitude=7209984]="Longitude",t[t.Longitude_Decimal=7210242]="Longitude_Decimal",t[t.Longitude_Double=7210243]="Longitude_Double",t[t.Image=13109259]="Image",t[t.ImageUrl=13174785]="ImageUrl",t[t.WebUrl=13240321]="WebUrl",t[t.Barcode=13305856]="Barcode",t[t.Barcode_Text=13305857]="Barcode_Text",t[t.Barcode_Integer=13306116]="Barcode_Integer",t[t.Color=19664897]="Color",t[t.FormatString=19730433]="FormatString",t[t.Alignment=20058113]="Alignment",t[t.LabelDisplayUnits=20123649]="LabelDisplayUnits",t[t.FontSize=20189443]="FontSize",t[t.LabelDensity=20254979]="LabelDensity",t[t.Enumeration=26214401]="Enumeration",t[t.ScriptSource=32776193]="ScriptSource",t[t.SearchEnabled=65541]="SearchEnabled"}(o||(o={})),function(t){t[t.Numeric=256]="Numeric",t[t.Temporal=512]="Temporal",t[t.Geography=1024]="Geography",t[t.Miscellaneous=2048]="Miscellaneous",t[t.Formatting=4096]="Formatting",t[t.Scripting=8192]="Scripting",t[t.Null=0]="Null",t[t.Text=1]="Text",t[t.Decimal=258]="Decimal",t[t.Double=259]="Double",t[t.Integer=260]="Integer",t[t.Boolean=5]="Boolean",t[t.Date=518]="Date",t[t.DateTime=519]="DateTime",t[t.DateTimeZone=520]="DateTimeZone",t[t.Time=521]="Time",t[t.Duration=10]="Duration",t[t.Binary=11]="Binary",t[t.None=12]="None",t[t.Variant=13]="Variant",t[t.Years=66048]="Years",t[t.Years_Text=66049]="Years_Text",t[t.Years_Integer=66308]="Years_Integer",t[t.Years_Date=66054]="Years_Date",t[t.Years_DateTime=66055]="Years_DateTime",t[t.Months=131584]="Months",t[t.Months_Text=131585]="Months_Text",t[t.Months_Integer=131844]="Months_Integer",t[t.Months_Date=131590]="Months_Date",t[t.Months_DateTime=131591]="Months_DateTime",t[t.PaddedDateTableDates=197127]="PaddedDateTableDates",t[t.Quarters=262656]="Quarters",t[t.Quarters_Text=262657]="Quarters_Text",t[t.Quarters_Integer=262916]="Quarters_Integer",t[t.Quarters_Date=262662]="Quarters_Date",t[t.Quarters_DateTime=262663]="Quarters_DateTime",t[t.DayOfMonth=328192]="DayOfMonth",t[t.DayOfMonth_Text=328193]="DayOfMonth_Text",t[t.DayOfMonth_Integer=328452]="DayOfMonth_Integer",t[t.DayOfMonth_Date=328198]="DayOfMonth_Date",t[t.DayOfMonth_DateTime=328199]="DayOfMonth_DateTime",t[t.Address=6554625]="Address",t[t.City=6620161]="City",t[t.Continent=6685697]="Continent",t[t.Country=6751233]="Country",t[t.County=6816769]="County",t[t.Region=6882305]="Region",t[t.PostalCode=6947840]="PostalCode",t[t.PostalCode_Text=6947841]="PostalCode_Text",t[t.PostalCode_Integer=6948100]="PostalCode_Integer",t[t.StateOrProvince=7013377]="StateOrProvince",t[t.Place=7078913]="Place",t[t.Latitude=7144448]="Latitude",t[t.Latitude_Decimal=7144706]="Latitude_Decimal",t[t.Latitude_Double=7144707]="Latitude_Double",t[t.Longitude=7209984]="Longitude",t[t.Longitude_Decimal=7210242]="Longitude_Decimal",t[t.Longitude_Double=7210243]="Longitude_Double",t[t.Image=13109259]="Image",t[t.ImageUrl=13174785]="ImageUrl",t[t.WebUrl=13240321]="WebUrl",t[t.Barcode=13305856]="Barcode",t[t.Barcode_Text=13305857]="Barcode_Text",t[t.Barcode_Integer=13306116]="Barcode_Integer",t[t.Color=19664897]="Color",t[t.FormatString=19730433]="FormatString",t[t.Alignment=20058113]="Alignment",t[t.LabelDisplayUnits=20123649]="LabelDisplayUnits",t[t.FontSize=20189443]="FontSize",t[t.LabelDensity=20254979]="LabelDensity",t[t.Enumeration=26214401]="Enumeration",t[t.ScriptSource=32776193]="ScriptSource",t[t.SearchEnabled=65541]="SearchEnabled"}(s||(s={}));const m=255,g=65535,_=4294901760;function y(t){return t&m}function A(t,e){return(t&_)==(e&_)}},96812:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(73367);function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var r=t.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}n.fromMGRS=function(t){return new n((0,r.gK)(t))},n.prototype.toMGRS=function(t){return(0,r.sY)([this.x,this.y],t)};const o=n},29499:(t,e,i)=>{"use strict";i.d(e,{A:()=>p});var r=i(37900),n=i(37404),o=i(22776),s=i(79334),a=i(98371),l=i(48277),c=i(44999),u=i(28025);function h(t,e){if(!(this instanceof h))return new h(t);e=e||function(t){if(t)throw t};var i=(0,r.A)(t);if("object"==typeof i){var o=h.projections.get(i.projName);if(o){if(i.datumCode&&"none"!==i.datumCode){var p=(0,c.A)(a.A,i.datumCode);p&&(i.datum_params=i.datum_params||(p.towgs84?p.towgs84.split(","):null),i.ellps=p.ellipse,i.datumName=p.datumName?p.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84",i.lat1=i.lat1||i.lat0;var d=(0,s.K)(i.a,i.b,i.rf,i.ellps,i.sphere),f=(0,s.P)(d.a,d.b,d.rf,i.R_A),m=(0,u.f)(i.nadgrids),g=i.datum||(0,l.A)(i.datumCode,i.datum_params,d.a,d.b,f.es,f.ep2,m);(0,n.A)(this,i),(0,n.A)(this,o),this.a=d.a,this.b=d.b,this.rf=d.rf,this.sphere=d.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=g,this.init(),e(null,this)}else e(t)}else e(t)}h.projections=o.Ay,h.projections.start();const p=h},61603:(t,e,i)=>{"use strict";function r(t,e,i){var r,n,o,s=i.x,a=i.y,l=i.z||0,c={};for(o=0;o<3;o++)if(!e||2!==o||void 0!==i.z)switch(0===o?(r=s,n=-1!=="ew".indexOf(t.axis[o])?"x":"y"):1===o?(r=a,n=-1!=="ns".indexOf(t.axis[o])?"y":"x"):(r=l,n="z"),t.axis[o]){case"e":case"n":c[n]=r;break;case"w":case"s":c[n]=-r;break;case"u":void 0!==i[n]&&(c.z=r);break;case"d":void 0!==i[n]&&(c.z=-r);break;default:return null}return c}i.d(e,{A:()=>r})},85852:(t,e,i)=>{"use strict";function r(t){n(t.x),n(t.y)}function n(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}i.d(e,{A:()=>r})},89013:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(98248),n=i(11393);function o(t){return Math.abs(t)<r.sK?t:t-(0,n.A)(t)*Math.PI}},47037:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(98248),n=i(11393);function o(t){return Math.abs(t)<=r.DF?t:t-(0,n.A)(t)*r.JM}},75280:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(47037);function n(t,e){if(void 0===t){if((t=Math.floor(30*((0,r.A)(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}},56356:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(46344),n=i(30714);function o(t){var e=Math.abs(t);return e=(0,n.A)(e*(1+e/((0,r.A)(1,e)+1))),t<0?-e:e}},88213:(t,e,i)=>{"use strict";function r(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}i.d(e,{A:()=>r})},68539:(t,e,i)=>{"use strict";function r(t,e){for(var i,r=2*Math.cos(e),n=t.length-1,o=t[n],s=0;--n>=0;)i=r*o-s+t[n],s=o,o=i;return Math.sin(e)*i}i.d(e,{A:()=>r})},33748:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(21782),n=i(11777);function o(t,e,i){for(var o,s,a=Math.sin(e),l=Math.cos(e),c=(0,r.A)(i),u=(0,n.A)(i),h=2*l*u,p=-2*a*c,d=t.length-1,f=t[d],m=0,g=0,_=0;--d>=0;)o=g,s=m,f=h*(g=f)-o-p*(m=_)+t[d],_=p*g-s+h*m;return[(h=a*u)*f-(p=l*c)*_,h*_+p*f]}},11777:(t,e,i)=>{"use strict";function r(t){var e=Math.exp(t);return(e+1/e)/2}i.d(e,{A:()=>r})},14733:(t,e,i)=>{"use strict";function r(t){return 1-.25*t*(1+t/16*(3+1.25*t))}i.d(e,{A:()=>r})},8834:(t,e,i)=>{"use strict";function r(t){return.375*t*(1+.25*t*(1+.46875*t))}i.d(e,{A:()=>r})},9195:(t,e,i)=>{"use strict";function r(t){return.05859375*t*t*(1+.75*t)}i.d(e,{A:()=>r})},9624:(t,e,i)=>{"use strict";function r(t){return t*t*t*(35/3072)}i.d(e,{A:()=>r})},15433:(t,e,i)=>{"use strict";function r(t,e,i){var r=e*i;return t/Math.sqrt(1-r*r)}i.d(e,{A:()=>r})},81069:(t,e,i)=>{"use strict";function r(t,e){for(var i,r=2*Math.cos(2*e),n=t.length-1,o=t[n],s=0;--n>=0;)i=r*o-s+t[n],s=o,o=i;return e+i*Math.sin(2*e)}i.d(e,{A:()=>r})},46344:(t,e,i)=>{"use strict";function r(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),r=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(r,2))}i.d(e,{A:()=>r})},364:(t,e,i)=>{"use strict";function r(t,e,i,r,n){var o,s;o=t/e;for(var a=0;a<15;a++)if(o+=s=(t-(e*o-i*Math.sin(2*o)+r*Math.sin(4*o)-n*Math.sin(6*o)))/(e-2*i*Math.cos(2*o)+4*r*Math.cos(4*o)-6*n*Math.cos(6*o)),Math.abs(s)<=1e-10)return o;return NaN}i.d(e,{A:()=>r})},23851:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(98248);function n(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*r.sK:r.sK;for(var n,o,s,a,l=Math.asin(.5*e),c=0;c<30;c++)if(o=Math.sin(l),s=Math.cos(l),a=t*o,l+=n=Math.pow(1-a*a,2)/(2*s)*(e/(1-t*t)-o/(1-a*a)+.5/t*Math.log((1-a)/(1+a))),Math.abs(n)<=1e-10)return l;return NaN}},30714:(t,e,i)=>{"use strict";function r(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}i.d(e,{A:()=>r})},12537:(t,e,i)=>{"use strict";function r(t,e,i,r,n){return t*n-e*Math.sin(2*n)+i*Math.sin(4*n)-r*Math.sin(6*n)}i.d(e,{A:()=>r})},23824:(t,e,i)=>{"use strict";function r(t,e,i){var r=t*e;return i/Math.sqrt(1-r*r)}i.d(e,{A:()=>r})},58557:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(98248);function n(t,e){for(var i,n,o=.5*t,s=r.sK-2*Math.atan(e),a=0;a<=15;a++)if(i=t*Math.sin(s),s+=n=r.sK-2*Math.atan(e*Math.pow((1-i)/(1+i),o))-s,Math.abs(n)<=1e-10)return s;return-9999}},56882:(t,e,i)=>{"use strict";i.d(e,{A:()=>m});var r=1,n=.25,o=.046875,s=.01953125,a=.01068115234375,l=.75,c=.46875,u=.013020833333333334,h=.007120768229166667,p=.3645833333333333,d=.005696614583333333,f=.3076171875;function m(t){var e=[];e[0]=r-t*(n+t*(o+t*(s+t*a))),e[1]=t*(l-t*(o+t*(s+t*a)));var i=t*t;return e[2]=i*(c-t*(u+t*h)),i*=t,e[3]=i*(p-t*d),e[4]=i*t*f,e}},46048:(t,e,i)=>{"use strict";i.d(e,{A:()=>s});var r=i(80688),n=i(98248),o=20;function s(t,e,i){for(var s=1/(1-e),a=t,l=o;l;--l){var c=Math.sin(a),u=1-e*c*c;if(a-=u=((0,r.A)(a,c,Math.cos(a),i)-t)*(u*Math.sqrt(u))*s,Math.abs(u)<n.H0)return a}return a}},80688:(t,e,i)=>{"use strict";function r(t,e,i,r){return i*=e,e*=e,r[0]*t-i*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}i.d(e,{A:()=>r})},68300:(t,e,i)=>{"use strict";function r(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}i.d(e,{A:()=>r})},11393:(t,e,i)=>{"use strict";function r(t){return t<0?-1:1}i.d(e,{A:()=>r})},21782:(t,e,i)=>{"use strict";function r(t){var e=Math.exp(t);return(e-1/e)/2}i.d(e,{A:()=>r})},39640:(t,e,i)=>{"use strict";function r(t,e){return Math.pow((1-t)/(1+t),e)}i.d(e,{A:()=>r})},10247:(t,e,i)=>{"use strict";function r(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}i.d(e,{A:()=>r})},45683:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(98248);function n(t,e,i){var n=t*i,o=.5*t;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(r.sK-e))/n}},98371:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var r={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},militargeographische_institut:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}}},71057:(t,e,i)=>{"use strict";i.d(e,{A:()=>r,w:()=>n});var r={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},n=r.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};r.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},19052:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});var r={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667}},8619:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});const r={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}}},98248:(t,e,i)=>{"use strict";i.d(e,{A1:()=>a,DF:()=>x,G9:()=>o,H0:()=>g,JM:()=>v,Q1:()=>f,Vj:()=>A,Y$:()=>n,_3:()=>h,a8:()=>r,bA:()=>d,bv:()=>l,dX:()=>y,ej:()=>m,gS:()=>u,sK:()=>p,xK:()=>s,zp:()=>c,zq:()=>_});var r=1,n=2,o=3,s=4,a=5,l=6378137,c=6356752.314,u=.0066943799901413165,h=484813681109536e-20,p=Math.PI/2,d=.16666666666666666,f=.04722222222222222,m=.022156084656084655,g=1e-10,_=.017453292519943295,y=57.29577951308232,A=Math.PI/4,v=2*Math.PI,x=3.14159265359},68131:(t,e,i)=>{"use strict";i.d(e,{A:()=>l});var r=i(29499),n=i(81314),o=(0,r.A)("WGS84");function s(t,e,i,r){var o,s,a;return Array.isArray(i)?(o=(0,n.A)(t,e,i,r)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof o.z?[o.x,o.y,o.z].concat(i.splice(3)):[o.x,o.y,i[2]].concat(i.splice(3)):[o.x,o.y].concat(i.splice(2)):[o.x,o.y]):(s=(0,n.A)(t,e,i,r),2===(a=Object.keys(i)).length||a.forEach((function(r){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===r||"y"===r||"z"===r)return}else if("x"===r||"y"===r)return;s[r]=i[r]})),s)}function a(t){return t instanceof r.A?t:t.oProj?t.oProj:(0,r.A)(t)}const l=function(t,e,i){t=a(t);var r,n=!1;return void 0===e?(e=t,t=o,n=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=o,n=!0),e=a(e),i?s(t,e,i):(r={forward:function(i,r){return s(t,e,i,r)},inverse:function(i,r){return s(e,t,i,r)}},n&&(r.oProj=e),r)}},48277:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(98248);const n=function(t,e,i,n,o,s,a){var l={};return l.datum_type=void 0===t||"none"===t?r.A1:r.xK,e&&(l.datum_params=e.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=r.a8),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=r.Y$,l.datum_params[3]*=r._3,l.datum_params[4]*=r._3,l.datum_params[5]*=r._3,l.datum_params[6]=l.datum_params[6]/1e6+1))),a&&(l.datum_type=r.G9,l.grids=a),l.a=i,l.b=n,l.es=o,l.ep2=s,l}},25468:(t,e,i)=>{"use strict";i.d(e,{Fs:()=>l,OI:()=>n,Rw:()=>s,jX:()=>o,mj:()=>a});var r=i(98248);function n(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===r.a8?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==r.Y$||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}function o(t,e,i){var n,o,s,a,l=t.x,c=t.y,u=t.z?t.z:0;if(c<-r.sK&&c>-1.001*r.sK)c=-r.sK;else if(c>r.sK&&c<1.001*r.sK)c=r.sK;else{if(c<-r.sK)return{x:-1/0,y:-1/0,z:t.z};if(c>r.sK)return{x:1/0,y:1/0,z:t.z}}return l>Math.PI&&(l-=2*Math.PI),o=Math.sin(c),a=Math.cos(c),s=o*o,{x:((n=i/Math.sqrt(1-e*s))+u)*a*Math.cos(l),y:(n+u)*a*Math.sin(l),z:(n*(1-e)+u)*o}}function s(t,e,i,n){var o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v=t.x,x=t.y,b=t.z?t.z:0;if(o=Math.sqrt(v*v+x*x),s=Math.sqrt(v*v+x*x+b*b),o/i<1e-12){if(y=0,s/i<1e-12)return r.sK,A=-n,{x:t.x,y:t.y,z:t.z}}else y=Math.atan2(x,v);a=b/s,p=(l=o/s)*(1-e)*(c=1/Math.sqrt(1-e*(2-e)*l*l)),d=a*c,_=0;do{_++,u=e*(h=i/Math.sqrt(1-e*d*d))/(h+(A=o*p+b*d-h*(1-e*d*d))),g=(m=a*(c=1/Math.sqrt(1-u*(2-u)*l*l)))*p-(f=l*(1-u)*c)*d,p=f,d=m}while(g*g>1e-24&&_<30);return{x:y,y:Math.atan(m/Math.abs(f)),z:A}}function a(t,e,i){if(e===r.a8)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===r.Y$){var n=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6];return{x:u*(t.x-c*t.y+l*t.z)+n,y:u*(c*t.x+t.y-a*t.z)+o,z:u*(-l*t.x+a*t.y+t.z)+s}}}function l(t,e,i){if(e===r.a8)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===r.Y$){var n=i[0],o=i[1],s=i[2],a=i[3],l=i[4],c=i[5],u=i[6],h=(t.x-n)/u,p=(t.y-o)/u,d=(t.z-s)/u;return{x:h+c*p-l*d,y:-c*h+p+a*d,z:l*h-a*p+d}}}},42738:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(98248),n=i(25468),o=i(47037);function s(t){return t===r.a8||t===r.Y$}function a(t,e,i){if((0,n.OI)(t,e))return i;if(t.datum_type===r.A1||e.datum_type===r.A1)return i;var o=t.a,a=t.es;if(t.datum_type===r.G9){if(0!==l(t,!1,i))return;o=r.bv,a=r.gS}var c=e.a,u=e.b,h=e.es;return e.datum_type===r.G9&&(c=r.bv,u=r.zp,h=r.gS),a!==h||o!==c||s(t.datum_type)||s(e.datum_type)?(i=(0,n.jX)(i,a,o),s(t.datum_type)&&(i=(0,n.mj)(i,t.datum_type,t.datum_params)),s(e.datum_type)&&(i=(0,n.Fs)(i,e.datum_type,e.datum_params)),i=(0,n.Rw)(i,h,c,u),e.datum_type!==r.G9||0===l(e,!0,i)?i:void 0):i}function l(t,e,i){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;var n={x:-i.x,y:i.y},o={x:Number.NaN,y:Number.NaN},s=[];t:for(var a=0;a<t.grids.length;a++){var l=t.grids[a];if(s.push(l.name),l.isNull){o=n;break}if(l.mandatory,null!==l.grid)for(var u=l.grid.subgrids,h=0,p=u.length;h<p;h++){var d=u[h],f=(Math.abs(d.del[1])+Math.abs(d.del[0]))/1e4,m=d.ll[0]-f,g=d.ll[1]-f,_=d.ll[0]+(d.lim[0]-1)*d.del[0]+f,y=d.ll[1]+(d.lim[1]-1)*d.del[1]+f;if(!(g>n.y||m>n.x||y<n.y||_<n.x||(o=c(n,e,d),isNaN(o.x))))break t}else if(l.mandatory)return console.log("Unable to find mandatory grid '"+l.name+"'"),-1}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*r.dX+" "+n.y*r.dX+" tried: '"+s+"'"),-1):(i.x=-o.x,i.y=o.y,0)}function c(t,e,i){var r={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return r;var n={x:t.x,y:t.y};n.x-=i.ll[0],n.y-=i.ll[1],n.x=(0,o.A)(n.x-Math.PI)+Math.PI;var s=u(n,i);if(e){if(isNaN(s.x))return r;s.x=n.x-s.x,s.y=n.y-s.y;var a,l,c=9;do{if(l=u(s,i),isNaN(l.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:n.x-(l.x+s.x),y:n.y-(l.y+s.y)},s.x+=a.x,s.y+=a.y}while(c--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(c<0)return console.log("Inverse grid shift iterator failed to converge."),r;r.x=(0,o.A)(s.x+i.ll[0]),r.y=s.y+i.ll[1]}else isNaN(s.x)||(r.x=t.x+s.x,r.y=t.y+s.y);return r}function u(t,e){var i,r={x:t.x/e.del[0],y:t.y/e.del[1]},n=Math.floor(r.x),o=Math.floor(r.y),s=r.x-1*n,a=r.y-1*o,l={x:Number.NaN,y:Number.NaN};if(n<0||n>=e.lim[0])return l;if(o<0||o>=e.lim[1])return l;i=o*e.lim[0]+n;var c=e.cvs[i][0],u=e.cvs[i][1];i++;var h=e.cvs[i][0],p=e.cvs[i][1];i+=e.lim[0];var d=e.cvs[i][0],f=e.cvs[i][1];i--;var m=e.cvs[i][0],g=e.cvs[i][1],_=s*a,y=s*(1-a),A=(1-s)*(1-a),v=(1-s)*a;return l.x=A*c+y*h+v*m+_*d,l.y=A*u+y*p+v*g+_*f,l}},61076:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(85939),n=i(77358),o=i(51119);function s(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?s[t]=(0,n.A)(arguments[1]):s[t]=(0,o.A)(arguments[1]):s[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?s.apply(e,t):s(t)}));if("string"==typeof t){if(t in s)return s[t]}else"EPSG"in t?s["EPSG:"+t.EPSG]=t:"ESRI"in t?s["ESRI:"+t.ESRI]=t:"IAU2000"in t?s["IAU2000:"+t.IAU2000]=t:console.log(t);return}}(0,r.A)(s);const a=s},79334:(t,e,i)=>{"use strict";i.d(e,{K:()=>a,P:()=>s});var r=i(98248),n=i(71057),o=i(44999);function s(t,e,i,n){var o=t*t,s=e*e,a=(o-s)/o,l=0;return n?(o=(t*=1-a*(r.bA+a*(r.Q1+a*r.ej)))*t,a=0):l=Math.sqrt(a),{es:a,e:l,ep2:(o-s)/s}}function a(t,e,i,s,a){if(!t){var l=(0,o.A)(n.A,s);l||(l=n.w),t=l.a,e=l.b,i=l.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<r.H0)&&(a=!0,e=t),{a:t,b:e,rf:i,sphere:a}}},37404:(t,e,i)=>{"use strict";function r(t,e){var i,r;if(t=t||{},!e)return t;for(r in e)void 0!==(i=e[r])&&(t[r]=i);return t}i.d(e,{A:()=>r})},85939:(t,e,i)=>{"use strict";function r(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}i.d(e,{A:()=>r})},80190:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>p});var r=i(68131),n=i(29499),o=i(96812),s=i(10247),a=i(61076),l=i(28025),c=i(81314),u=i(73367),h=i(85002);r.A.defaultDatum="WGS84",r.A.Proj=n.A,r.A.WGS84=new r.A.Proj("WGS84"),r.A.Point=o.A,r.A.toPoint=s.A,r.A.defs=a.A,r.A.nadgrid=l.A,r.A.transform=c.A,r.A.mgrs=u.Ay,r.A.version="__VERSION__",(0,h.A)(r.A);const p=r.A},44999:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=/[\s_\-\/\(\)]/g;function n(t,e){if(t[e])return t[e];for(var i,n=Object.keys(t),o=e.toLowerCase().replace(r,""),s=-1;++s<n.length;)if((i=n[s]).toLowerCase().replace(r,"")===o)return t[i]}},28025:(t,e,i)=>{"use strict";i.d(e,{A:()=>n,f:()=>o});var r={};function n(t,e){var i=new DataView(e),n=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(i),o=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:l(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(i,n),s=function(t,e,i){for(var r=176,n=[],o=0;o<e.nSubgrids;o++){var s=u(t,r,i),l=h(t,r,s,i),p=Math.round(1+(s.upperLongitude-s.lowerLongitude)/s.longitudeInterval),d=Math.round(1+(s.upperLatitude-s.lowerLatitude)/s.latitudeInterval);n.push({ll:[a(s.lowerLongitude),a(s.lowerLatitude)],del:[a(s.longitudeInterval),a(s.latitudeInterval)],lim:[p,d],count:s.gridNodeCount,cvs:c(l)}),r+=176+16*s.gridNodeCount}return n}(i,o,n),p={header:o,subgrids:s};return r[t]=p,p}function o(t){return void 0===t?null:t.split(",").map(s)}function s(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:r[t]||null,isNull:!1}}function a(t){return t/3600*Math.PI/180}function l(t,e,i){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,i)))}function c(t){return t.map((function(t){return[a(t.longitudeShift),a(t.latitudeShift)]}))}function u(t,e,i){return{name:l(t,e+8,e+16).trim(),parent:l(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,i),upperLatitude:t.getFloat64(e+88,i),lowerLongitude:t.getFloat64(e+104,i),upperLongitude:t.getFloat64(e+120,i),latitudeInterval:t.getFloat64(e+136,i),longitudeInterval:t.getFloat64(e+152,i),gridNodeCount:t.getInt32(e+168,i)}}function h(t,e,i,r){for(var n=e+176,o=[],s=0;s<i.gridNodeCount;s++){var a={latitudeShift:t.getFloat32(n+16*s,r),longitudeShift:t.getFloat32(n+16*s+4,r),latitudeAccuracy:t.getFloat32(n+16*s+8,r),longitudeAccuracy:t.getFloat32(n+16*s+12,r)};o.push(a)}return o}},37900:(t,e,i)=>{"use strict";i.d(e,{A:()=>c});var r=i(61076),n=i(51119),o=i(77358),s=i(44999),a=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],l=["3857","900913","3785","102113"];const c=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in r.A}(t))return r.A[t];if(function(t){return a.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=(0,n.A)(t);if(function(t){var e=(0,s.A)(t,"authority");if(e){var i=(0,s.A)(e,"epsg");return i&&l.indexOf(i)>-1}}(e))return r.A["EPSG:3857"];var i=function(t){var e=(0,s.A)(t,"extension");if(e)return(0,s.A)(e,"proj4")}(e);return i?(0,o.A)(i):e}return function(t){return"+"===t[0]}(t)?(0,o.A)(t):void 0}},77358:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(98248),n=i(19052),o=i(8619),s=i(44999);function a(t){var e,i,a,l={},c=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t}),{}),u={proj:"projName",datum:"datumCode",rf:function(t){l.rf=parseFloat(t)},lat_0:function(t){l.lat0=t*r.zq},lat_1:function(t){l.lat1=t*r.zq},lat_2:function(t){l.lat2=t*r.zq},lat_ts:function(t){l.lat_ts=t*r.zq},lon_0:function(t){l.long0=t*r.zq},lon_1:function(t){l.long1=t*r.zq},lon_2:function(t){l.long2=t*r.zq},alpha:function(t){l.alpha=parseFloat(t)*r.zq},gamma:function(t){l.rectified_grid_angle=parseFloat(t)},lonc:function(t){l.longc=t*r.zq},x_0:function(t){l.x0=parseFloat(t)},y_0:function(t){l.y0=parseFloat(t)},k_0:function(t){l.k0=parseFloat(t)},k:function(t){l.k0=parseFloat(t)},a:function(t){l.a=parseFloat(t)},b:function(t){l.b=parseFloat(t)},r:function(t){l.a=l.b=parseFloat(t)},r_a:function(){l.R_A=!0},zone:function(t){l.zone=parseInt(t,10)},south:function(){l.utmSouth=!0},towgs84:function(t){l.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){l.to_meter=parseFloat(t)},units:function(t){l.units=t;var e=(0,s.A)(o.A,t);e&&(l.to_meter=e.to_meter)},from_greenwich:function(t){l.from_greenwich=t*r.zq},pm:function(t){var e=(0,s.A)(n.A,t);l.from_greenwich=(e||parseFloat(t))*r.zq},nadgrids:function(t){"@null"===t?l.datumCode="none":l.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(l.axis=t)},approx:function(){l.approx=!0}};for(e in c)i=c[e],e in u?"function"==typeof(a=u[e])?a(i):l[a]=i:l[e]=i;return"string"==typeof l.datumCode&&"WGS84"!==l.datumCode&&(l.datumCode=l.datumCode.toLowerCase()),l}},22776:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c});var r=i(14954),n=i(72948),o=[r.Ay,n.Ay],s={},a=[];function l(t,e){var i=a.length;return t.names?(a[i]=t,t.names.forEach((function(t){s[t.toLowerCase()]=i})),this):(console.log(e),!0)}const c={start:function(){o.forEach(l)},add:l,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==s[e]&&a[s[e]]?a[s[e]]:void 0}}},5566:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l});var r=i(23824),n=i(68300),o=i(47037),s=i(88213),a=i(98248);const l={init:function(){Math.abs(this.lat1+this.lat2)<a.H0||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=(0,r.A)(this.e3,this.sin_po,this.cos_po),this.qs1=(0,n.A)(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=(0,r.A)(this.e3,this.sin_po,this.cos_po),this.qs2=(0,n.A)(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=(0,n.A)(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>a.H0?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var r=(0,n.A)(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*(0,o.A)(e-this.long0),l=s*Math.sin(a)+this.x0,c=this.rh-s*Math.cos(a)+this.y0;return t.x=l,t.y=c,t},inverse:function(t){var e,i,r,n,s,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),n=0,0!==e&&(n=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(i=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,i)),s=(0,o.A)(n/this.ns0+this.long0),t.x=s,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,r,n,o,l=(0,s.A)(.5*e);if(t<a.H0)return l;for(var c=t*t,u=1;u<=25;u++)if(l+=o=.5*(n=1-(r=t*(i=Math.sin(l)))*r)*n/Math.cos(l)*(e/(1-c)-i/n+.5/t*Math.log((1-r)/(1+r))),Math.abs(o)<=1e-7)return l;return null}}},89344:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>d});var r=i(47037),n=i(98248),o=i(12537),s=i(14733),a=i(8834),l=i(9195),c=i(9624),u=i(15433),h=i(88213),p=i(364);const d={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P=t.x,k=t.y,N=Math.sin(t.y),D=Math.cos(t.y),O=(0,r.A)(P-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=n.H0?(t.x=this.x0+this.a*(n.sK-k)*Math.sin(O),t.y=this.y0-this.a*(n.sK-k)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=n.H0?(t.x=this.x0+this.a*(n.sK+k)*Math.sin(O),t.y=this.y0+this.a*(n.sK+k)*Math.cos(O),t):(C=this.sin_p12*N+this.cos_p12*D*Math.cos(O),T=(S=Math.acos(C))?S/Math.sin(S):1,t.x=this.x0+this.a*T*D*Math.sin(O),t.y=this.y0+this.a*T*(this.cos_p12*N-this.sin_p12*D*Math.cos(O)),t):(e=(0,s.A)(this.es),i=(0,a.A)(this.es),h=(0,l.A)(this.es),p=(0,c.A)(this.es),Math.abs(this.sin_p12-1)<=n.H0?(d=this.a*(0,o.A)(e,i,h,p,n.sK),f=this.a*(0,o.A)(e,i,h,p,k),t.x=this.x0+(d-f)*Math.sin(O),t.y=this.y0-(d-f)*Math.cos(O),t):Math.abs(this.sin_p12+1)<=n.H0?(d=this.a*(0,o.A)(e,i,h,p,n.sK),f=this.a*(0,o.A)(e,i,h,p,k),t.x=this.x0+(d+f)*Math.sin(O),t.y=this.y0+(d+f)*Math.cos(O),t):(m=N/D,g=(0,u.A)(this.a,this.e,this.sin_p12),_=(0,u.A)(this.a,this.e,N),y=Math.atan((1-this.es)*m+this.es*g*this.sin_p12/(_*D)),M=0===(A=Math.atan2(Math.sin(O),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(O)))?Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(A)-Math.PI)<=n.H0?-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.asin(Math.sin(O)*Math.cos(y)/Math.sin(A)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),S=g*M*(1-(E=M*M)*(w=(x=this.e*this.cos_p12*Math.cos(A)/Math.sqrt(1-this.es))*x)*(1-w)/6+(I=E*M)/8*(b=v*x)*(1-2*w)+(L=I*M)/120*(w*(4-7*w)-3*v*v*(1-7*w))-L*M/48*b),t.x=this.x0+S*Math.sin(A),t.y=this.y0+S*Math.cos(A),t))},inverse:function(t){var e,i,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P,k,N,D;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*n.sK*this.a)return;return i=e/this.a,d=Math.sin(i),f=Math.cos(i),m=this.long0,Math.abs(e)<=n.H0?g=this.lat0:(g=(0,h.A)(f*this.sin_p12+t.y*d*this.cos_p12/e),_=Math.abs(this.lat0)-n.sK,m=Math.abs(_)<=n.H0?this.lat0>=0?(0,r.A)(this.long0+Math.atan2(t.x,-t.y)):(0,r.A)(this.long0-Math.atan2(-t.x,t.y)):(0,r.A)(this.long0+Math.atan2(t.x*d,e*this.cos_p12*f-t.y*this.sin_p12*d))),t.x=m,t.y=g,t}return y=(0,s.A)(this.es),A=(0,a.A)(this.es),v=(0,l.A)(this.es),x=(0,c.A)(this.es),Math.abs(this.sin_p12-1)<=n.H0?(w=(b=this.a*(0,o.A)(y,A,v,x,n.sK))-(e=Math.sqrt(t.x*t.x+t.y*t.y)),g=(0,p.A)(w/this.a,y,A,v,x),m=(0,r.A)(this.long0+Math.atan2(t.x,-1*t.y)),t.x=m,t.y=g,t):Math.abs(this.sin_p12+1)<=n.H0?(b=this.a*(0,o.A)(y,A,v,x,n.sK),w=(e=Math.sqrt(t.x*t.x+t.y*t.y))-b,g=(0,p.A)(w/this.a,y,A,v,x),m=(0,r.A)(this.long0+Math.atan2(t.x,t.y)),t.x=m,t.y=g,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),C=Math.atan2(t.x,t.y),S=(0,u.A)(this.a,this.e,this.sin_p12),M=Math.cos(C),I=-(E=this.e*this.cos_p12*M)*E/(1-this.es),L=3*this.es*(1-I)*this.sin_p12*this.cos_p12*M/(1-this.es),N=1-I*(k=(P=e/S)-I*(1+I)*Math.pow(P,3)/6-L*(1+3*I)*Math.pow(P,4)/24)*k/2-P*k*k*k/6,T=Math.asin(this.sin_p12*Math.cos(k)+this.cos_p12*Math.sin(k)*M),m=(0,r.A)(this.long0+Math.asin(Math.sin(C)*Math.sin(k)/Math.cos(T))),D=Math.sin(T),g=Math.atan2((D-this.es*N*this.sin_p12)*Math.tan(T),D*(1-this.es)),t.x=m,t.y=g,t)},names:["Azimuthal_Equidistant","aeqd"]}},47213:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>d});var r=i(12537),n=i(14733),o=i(8834),s=i(9195),a=i(9624),l=i(15433),c=i(47037),u=i(89013),h=i(364),p=i(98248);const d={init:function(){this.sphere||(this.e0=(0,n.A)(this.es),this.e1=(0,o.A)(this.es),this.e2=(0,s.A)(this.es),this.e3=(0,a.A)(this.es),this.ml0=this.a*(0,r.A)(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,n=t.x,o=t.y;if(n=(0,c.A)(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var s=Math.sin(o),a=Math.cos(o),u=(0,l.A)(this.a,this.e,s),h=Math.tan(o)*Math.tan(o),p=n*Math.cos(o),d=p*p,f=this.es*a*a/(1-this.es);e=u*p*(1-d*h*(1/6-(8-h+8*f)*d/120)),i=this.a*(0,r.A)(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+u*s/a*d*(.5+(5-h+6*f)*d/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,r=t.x/this.a,n=t.y/this.a;if(this.sphere){var o=n+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(r)),i=Math.atan2(Math.tan(r),Math.cos(o))}else{var s=this.ml0/this.a+n,a=(0,h.A)(s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(a)-p.sK)<=p.H0)return t.x=this.long0,t.y=p.sK,n<0&&(t.y*=-1),t;var d=(0,l.A)(this.a,this.e,Math.sin(a)),f=d*d*d/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(a),2),g=r*this.a/d,_=g*g;e=a-d*Math.tan(a)/f*g*g*(.5-(1+3*m)*g*g/24),i=g*(1-_*(m/3+(1+3*m)*m*_/15))/Math.cos(a)}return t.x=(0,c.A)(i+this.long0),t.y=(0,u.A)(e),t},names:["Cassini","Cassini_Soldner","cass"]}},45912:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>a});var r=i(47037),n=i(68300),o=i(23824),s=i(23851);const a={init:function(){this.sphere||(this.k0=(0,o.A)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,o=t.x,s=t.y,a=(0,r.A)(o-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var l=(0,n.A)(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,i=this.y0+this.a*l*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=(0,r.A)(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=(0,s.A)(this.e,2*t.y*this.k0/this.a),e=(0,r.A)(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]}},42316:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>o});var r=i(47037),n=i(89013);const o={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,o=(0,r.A)(e-this.long0),s=(0,n.A)(i-this.lat0);return t.x=this.x0+this.a*o*this.rc,t.y=this.y0+this.a*s,t},inverse:function(t){var e=t.x,i=t.y;return t.x=(0,r.A)(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=(0,n.A)(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]}},46316:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>d});var r=i(14733),n=i(8834),o=i(9195),s=i(9624),a=i(23824),l=i(12537),c=i(47037),u=i(89013),h=i(364),p=i(98248);const d={init:function(){Math.abs(this.lat1+this.lat2)<p.H0||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=(0,r.A)(this.es),this.e1=(0,n.A)(this.es),this.e2=(0,o.A)(this.es),this.e3=(0,s.A)(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=(0,a.A)(this.e,this.sinphi,this.cosphi),this.ml1=(0,l.A)(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<p.H0?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=(0,a.A)(this.e,this.sinphi,this.cosphi),this.ml2=(0,l.A)(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=(0,l.A)(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,r=t.y;if(this.sphere)e=this.a*(this.g-r);else{var n=(0,l.A)(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-n)}var o=this.ns*(0,c.A)(i-this.long0),s=this.x0+e*Math.sin(o),a=this.y0+this.rh-e*Math.cos(o);return t.x=s,t.y=a,t},inverse:function(t){var e,i,r,n;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==i&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return n=(0,c.A)(this.long0+o/this.ns),r=(0,u.A)(this.g-i/this.a),t.x=n,t.y=r,t;var s=this.g-i/this.a;return r=(0,h.A)(s,this.e0,this.e1,this.e2,this.e3),n=(0,c.A)(this.long0+o/this.ns),t.x=n,t.y=r,t},names:["Equidistant_Conic","eqdc"]}},71557:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c});var r=i(47037),n=1.340264,o=-.081106,s=893e-6,a=.003796,l=Math.sqrt(3)/2;const c={init:function(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function(t){var e=(0,r.A)(t.x-this.long0),i=t.y,c=Math.asin(l*Math.sin(i)),u=c*c,h=u*u*u;return t.x=e*Math.cos(c)/(l*(n+3*o*u+h*(7*s+9*a*u))),t.y=c*(n+o*u+h*(s+a*u)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var e,i,c,u,h=t.y;for(u=0;u<12&&(h-=c=(h*(n+o*(e=h*h)+(i=e*e*e)*(s+a*e))-t.y)/(n+3*o*e+i*(7*s+9*a*e)),!(Math.abs(c)<1e-9));++u);return i=(e=h*h)*e*e,t.x=l*t.x*(n+3*o*e+i*(7*s+9*a*e))/Math.cos(h),t.y=Math.asin(Math.sin(h)/l),t.x=(0,r.A)(t.x+this.long0),t},names:["eqearth","Equal Earth","Equal_Earth"]}},27483:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>h});var r=i(72766),n=i(21782),o=i(46344),s=i(56356),a=i(81069),l=i(68539),c=i(33748),u=i(47037);const h={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(r.Ay.init.apply(this),this.forward=r.Ay.forward,this.inverse=r.Ay.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(1/4+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=i*(-20648693/638668800),this.gtu[5]=.6650675310896665*i;var n=(0,a.A)(this.cbg,this.lat0);this.Zb=-this.Qn*(n+(0,l.A)(this.gtu,2*n))},forward:function(t){var e=(0,u.A)(t.x-this.long0),i=t.y;i=(0,a.A)(this.cbg,i);var r=Math.sin(i),n=Math.cos(i),l=Math.sin(e),h=Math.cos(e);i=Math.atan2(r,h*n),e=Math.atan2(l*n,(0,o.A)(r,n*h)),e=(0,s.A)(Math.tan(e));var p,d,f=(0,c.A)(this.gtu,2*i,2*e);return i+=f[0],e+=f[1],Math.abs(e)<=2.623395162778?(p=this.a*(this.Qn*e)+this.x0,d=this.a*(this.Qn*i+this.Zb)+this.y0):(p=1/0,d=1/0),t.x=p,t.y=d,t},inverse:function(t){var e,i,r=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var l=(0,c.A)(this.utg,2*s,2*r);s+=l[0],r+=l[1],r=Math.atan((0,n.A)(r));var h=Math.sin(s),p=Math.cos(s),d=Math.sin(r),f=Math.cos(r);s=Math.atan2(h*f,(0,o.A)(d,f*p)),r=Math.atan2(d,f*p),e=(0,u.A)(r+this.long0),i=(0,a.A)(this.cgb,s)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]}},72246:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>o});var r=i(39640),n=i(98248);const o={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+n.Vj)/(Math.pow(Math.tan(.5*this.lat0+n.Vj),this.C)*(0,r.A)(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+n.Vj),this.C)*(0,r.A)(this.e*Math.sin(i),this.ratexp))-n.sK,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,o=Math.pow(Math.tan(.5*i+n.Vj)/this.K,1/this.C),s=20;s>0&&(i=2*Math.atan(o*(0,r.A)(this.e*Math.sin(t.y),-.5*this.e))-n.sK,!(Math.abs(i-t.y)<1e-14));--s)t.y=i;return s?(t.x=e,t.y=i,t):null},names:["gauss"]}},89056:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>n});var r=i(25468);const n={init:function(){this.name="geocent"},forward:function(t){return(0,r.jX)(t,this.es,this.a)},inverse:function(t){return(0,r.Rw)(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]}},2873:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>n});var r=i(46344);const n={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,i,n,o,s=t.x,a=t.y;if(s-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var l=this.radius_p/(0,r.A)(this.radius_p*Math.cos(a),Math.sin(a));if(i=l*Math.cos(s)*Math.cos(a),n=l*Math.sin(s)*Math.cos(a),o=l*Math.sin(a),(this.radius_g-i)*i-n*n-o*o*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/(0,r.A)(o,e)),t.y=this.radius_g_1*Math.atan(o/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(o/(0,r.A)(n,e)))}else"sphere"===this.shape&&(e=Math.cos(a),i=Math.cos(s)*e,n=Math.sin(s)*e,o=Math.sin(a),e=this.radius_g-i,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/(0,r.A)(o,e)),t.y=this.radius_g_1*Math.atan(o/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(o/(0,r.A)(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,i,n,o,s=-1,a=0,l=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(l=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*(0,r.A)(1,l)):(a=Math.tan(t.x/this.radius_g_1),l=Math.tan(t.y/this.radius_g_1)*(0,r.A)(1,a));var c=l/this.radius_p;if(e=a*a+c*c+s*s,(n=(i=2*this.radius_g*s)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-i-Math.sqrt(n))/(2*e),s=this.radius_g+o*s,a*=o,l*=o,t.x=Math.atan2(a,s),t.y=Math.atan(l*Math.cos(t.x)/s),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(l=Math.tan(t.y/this.radius_g_1),a=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+l*l)):(a=Math.tan(t.x/this.radius_g_1),l=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+a*a)),e=a*a+l*l+s*s,(n=(i=2*this.radius_g*s)*i-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;o=(-i-Math.sqrt(n))/(2*e),s=this.radius_g+o*s,a*=o,l*=o,t.x=Math.atan2(a,s),t.y=Math.atan(l*Math.cos(t.x)/s)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]}},54562:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(47037),n=i(88213),o=i(98248);const s={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,n,s,a,l,c,u=t.x,h=t.y;return n=(0,r.A)(u-this.long0),e=Math.sin(h),i=Math.cos(h),s=Math.cos(n),(a=this.sin_p14*e+this.cos_p14*i*s)>0||Math.abs(a)<=o.H0?(l=this.x0+1*this.a*i*Math.sin(n)/a,c=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*s)/a):(l=this.x0+this.infinity_dist*i*Math.sin(n),c=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*s)),t.x=l,t.y=c,t},inverse:function(t){var e,i,o,s,a,l;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(s=Math.atan2(e,this.rc),i=Math.sin(s),o=Math.cos(s),l=(0,n.A)(o*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.atan2(t.x*i,e*this.cos_p14*o-t.y*this.sin_p14*i),a=(0,r.A)(this.long0+a)):(l=this.phic0,a=0),t.x=a,t.y=l,t},names:["gnom"]}},22615:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>n});var r=i(47037);const n={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,n,o,s,a,l,c=t.x,u=t.y,h=(0,r.A)(c-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-h*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),s=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(o)),a=this.n*s,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=l*Math.cos(a)/1,t.x=l*Math.sin(a)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,r,n,o,s,a,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),o=Math.sqrt(t.x*t.x+t.y*t.y),n=Math.atan2(t.y,t.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),i=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,a=0;var c=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(a=1),s=t.y,c+=1}while(0===a&&c<15);return c>=15?null:t},names:["Krovak","krovak"]}},82218:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(98248),n=i(68300),o=i(47037);const s={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-r.sK)<r.H0?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<r.H0?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=(0,n.A)(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=.3333333333333333*t,e=t*t,i[0]+=.17222222222222222*e,i[1]=.06388888888888888*e,e*=t,i[0]+=.10257936507936508*e,i[1]+=.0664021164021164*e,i[2]=.016415012942191543*e,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=(0,n.A)(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,s,a,l,c,u,h,p,d,f=t.x,m=t.y;if(f=(0,o.A)(f-this.long0),this.sphere){if(l=Math.sin(m),d=Math.cos(m),s=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+d*s:1+this.sinph0*l+this.cosph0*d*s)<=r.H0)return null;e=(i=Math.sqrt(2/i))*d*Math.sin(f),i*=this.mode===this.EQUIT?l:this.cosph0*l-this.sinph0*d*s}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(s=-s),Math.abs(m+this.lat0)<r.H0)return null;i=r.Vj-.5*m,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(f),i*=s}}else{switch(u=0,h=0,p=0,s=Math.cos(f),a=Math.sin(f),l=Math.sin(m),c=(0,n.A)(this.e,l),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(u=c/this.qp,h=Math.sqrt(1-u*u)),this.mode){case this.OBLIQ:p=1+this.sinb1*u+this.cosb1*h*s;break;case this.EQUIT:p=1+h*s;break;case this.N_POLE:p=r.sK+m,c=this.qp-c;break;case this.S_POLE:p=m-r.sK,c=this.qp+c}if(Math.abs(p)<r.H0)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),i=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*u-this.sinb1*h*s):(p=Math.sqrt(2/(1+h*s)))*u*this.ymf,e=this.xmf*p*h*a;break;case this.N_POLE:case this.S_POLE:c>=0?(e=(p=Math.sqrt(c))*a,i=s*(this.mode===this.S_POLE?p:-p)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,s,a,l,c,u,h,p,d=t.x/this.a,f=t.y/this.a;if(this.sphere){var m,g=0,_=0;if((i=.5*(m=Math.sqrt(d*d+f*f)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(_=Math.sin(i),g=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(m)<=r.H0?0:Math.asin(f*_/m),d*=_,f=g*m;break;case this.OBLIQ:i=Math.abs(m)<=r.H0?this.lat0:Math.asin(g*this.sinph0+f*_*this.cosph0/m),d*=_*this.cosph0,f=(g-Math.sin(i)*this.sinph0)*m;break;case this.N_POLE:f=-f,i=r.sK-i;break;case this.S_POLE:i-=r.sK}e=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,f):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,f*=this.dd,(l=Math.sqrt(d*d+f*f))<r.H0)return t.x=this.long0,t.y=this.lat0,t;s=2*Math.asin(.5*l/this.rq),n=Math.cos(s),d*=s=Math.sin(s),this.mode===this.OBLIQ?(c=n*this.sinb1+f*s*this.cosb1/l,a=this.qp*c,f=l*this.cosb1*n-f*this.sinb1*s):(c=f*s/l,a=this.qp*c,f=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(a=d*d+f*f))return t.x=this.long0,t.y=this.lat0,t;c=1-a/this.qp,this.mode===this.S_POLE&&(c=-c)}e=Math.atan2(d,f),p=(u=Math.asin(c))+u,i=u+(h=this.apa)[0]*Math.sin(p)+h[1]*Math.sin(p+p)+h[2]*Math.sin(p+p+p)}return t.x=(0,o.A)(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4}},49857:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c});var r=i(23824),n=i(45683),o=i(11393),s=i(47037),a=i(58557),l=i(98248);const c={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<l.H0)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),o=(0,r.A)(this.e,e,i),s=(0,n.A)(this.e,this.lat1,e),a=Math.sin(this.lat2),c=Math.cos(this.lat2),u=(0,r.A)(this.e,a,c),h=(0,n.A)(this.e,this.lat2,a),p=(0,n.A)(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>l.H0?this.ns=Math.log(o/u)/Math.log(s/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=o/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=l.H0&&(i=(0,o.A)(i)*(l.sK-2*l.H0));var r,a,c=Math.abs(Math.abs(i)-l.sK);if(c>l.H0)r=(0,n.A)(this.e,i,Math.sin(i)),a=this.a*this.f0*Math.pow(r,this.ns);else{if((c=i*this.ns)<=0)return null;a=0}var u=this.ns*(0,s.A)(e-this.long0);return t.x=this.k0*(a*Math.sin(u))+this.x0,t.y=this.k0*(this.rh-a*Math.cos(u))+this.y0,t},inverse:function(t){var e,i,r,n,o,c=(t.x-this.x0)/this.k0,u=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(c*c+u*u),i=1):(e=-Math.sqrt(c*c+u*u),i=-1);var h=0;if(0!==e&&(h=Math.atan2(i*c,i*u)),0!==e||this.ns>0){if(i=1/this.ns,r=Math.pow(e/(this.a*this.f0),i),-9999===(n=(0,a.A)(this.e,r)))return null}else n=-l.sK;return o=(0,s.A)(h/this.ns+this.long0),t.x=o,t.y=n,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]}},72948:(t,e,i)=>{"use strict";function r(t){return t}i.d(e,{Ay:()=>n});const n={init:function(){},forward:r,inverse:r,names:["longlat","identity"]}},14954:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l});var r=i(23824),n=i(47037),o=i(45683),s=i(58557),a=i(98248);const l={init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=(0,r.A)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,r=t.x,s=t.y;if(s*a.dX>90&&s*a.dX<-90&&r*a.dX>180&&r*a.dX<-180)return null;if(Math.abs(Math.abs(s)-a.sK)<=a.H0)return null;if(this.sphere)e=this.x0+this.a*this.k0*(0,n.A)(r-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(a.Vj+.5*s));else{var l=Math.sin(s),c=(0,o.A)(this.e,s,l);e=this.x0+this.a*this.k0*(0,n.A)(r-this.long0),i=this.y0-this.a*this.k0*Math.log(c)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,r=t.x-this.x0,o=t.y-this.y0;if(this.sphere)i=a.sK-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var l=Math.exp(-o/(this.a*this.k0));if(-9999===(i=(0,s.A)(this.e,l)))return null}return e=(0,n.A)(this.long0+r/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]}},99993:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>n});var r=i(47037);const n={init:function(){},forward:function(t){var e=t.x,i=t.y,n=(0,r.A)(e-this.long0),o=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=o,t.y=s,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=(0,r.A)(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]}},46203:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>o});var r=i(47037),n=i(98248);const o={init:function(){},forward:function(t){for(var e=t.x,i=t.y,o=(0,r.A)(e-this.long0),s=i,a=Math.PI*Math.sin(i);;){var l=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=l,Math.abs(l)<n.H0)break}s/=2,Math.PI/2-Math.abs(i)<n.H0&&(o=0);var c=.900316316158*this.a*o*Math.cos(s)+this.x0,u=1.4142135623731*this.a*Math.sin(s)+this.y0;return t.x=c,t.y=u,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=(0,r.A)(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var o=Math.asin(i);return t.x=n,t.y=o,t},names:["Mollweide","moll"]}},79931:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>n});var r=i(98248);const n={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,n=t.y-this.lat0,o=i-this.long0,s=n/r._3*1e-5,a=o,l=1,c=0;for(e=1;e<=10;e++)l*=s,c+=this.A[e]*l;var u,h=c,p=a,d=1,f=0,m=0,g=0;for(e=1;e<=6;e++)u=f*h+d*p,d=d*h-f*p,f=u,m=m+this.B_re[e]*d-this.B_im[e]*f,g=g+this.B_im[e]*d+this.B_re[e]*f;return t.x=g*this.a+this.x0,t.y=m*this.a+this.y0,t},inverse:function(t){var e,i,n=t.x,o=t.y,s=n-this.x0,a=(o-this.y0)/this.a,l=s/this.a,c=1,u=0,h=0,p=0;for(e=1;e<=6;e++)i=u*a+c*l,c=c*a-u*l,u=i,h=h+this.C_re[e]*c-this.C_im[e]*u,p=p+this.C_im[e]*c+this.C_re[e]*u;for(var d=0;d<this.iterations;d++){var f,m=h,g=p,_=a,y=l;for(e=2;e<=6;e++)f=g*h+m*p,m=m*h-g*p,g=f,_+=(e-1)*(this.B_re[e]*m-this.B_im[e]*g),y+=(e-1)*(this.B_im[e]*m+this.B_re[e]*g);m=1,g=0;var A=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)f=g*h+m*p,m=m*h-g*p,g=f,A+=e*(this.B_re[e]*m-this.B_im[e]*g),v+=e*(this.B_im[e]*m+this.B_re[e]*g);var x=A*A+v*v;h=(_*A+y*v)/x,p=(y*A-_*v)/x}var b=h,w=p,S=1,T=0;for(e=1;e<=9;e++)S*=b,T+=this.D[e]*S;var C=this.lat0+T*r._3*1e5,M=this.long0+w;return t.x=M,t.y=C,t},names:["New_Zealand_Map_Grid","nzmg"]}},6207:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>l});var r=i(45683),n=i(47037),o=i(58557),s=i(98248),a=1e-7;const l={init:function(){var t,e,i,o,l,c,u,h,p,d,f,m,g,_=0,y=0,A=0,v=0,x=0,b=0,w=0;this.no_off=(g="object"==typeof(m=this).PROJECTION?Object.keys(m.PROJECTION)[0]:m.PROJECTION,"no_uoff"in m||"no_off"in m||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(g)),this.no_rot="no_rot"in this;var S=!1;"alpha"in this&&(S=!0);var T=!1;if("rectified_grid_angle"in this&&(T=!0),S&&(w=this.alpha),T&&(_=this.rectified_grid_angle*s.zq),S||T)y=this.longc;else if(A=this.long1,x=this.lat1,v=this.long2,b=this.lat2,Math.abs(x-b)<=a||(t=Math.abs(x))<=a||Math.abs(t-s.sK)<=a||Math.abs(Math.abs(this.lat0)-s.sK)<=a||Math.abs(Math.abs(b)-s.sK)<=a)throw new Error;var C=1-this.es;e=Math.sqrt(C),Math.abs(this.lat0)>s.H0?(h=Math.sin(this.lat0),i=Math.cos(this.lat0),t=1-this.es*h*h,this.B=i*i,this.B=Math.sqrt(1+this.es*this.B*this.B/C),this.A=this.B*this.k0*e/t,(l=(o=this.B*e/(i*Math.sqrt(t)))*o-1)<=0?l=0:(l=Math.sqrt(l),this.lat0<0&&(l=-l)),this.E=l+=o,this.E*=Math.pow((0,r.A)(this.e,this.lat0,h),this.B)):(this.B=1/e,this.A=this.k0,this.E=o=l=1),S||T?(S?(f=Math.asin(Math.sin(w)/o),T||(_=w)):(f=_,w=Math.asin(o*Math.sin(f))),this.lam0=y-Math.asin(.5*(l-1/l)*Math.tan(f))/this.B):(c=Math.pow((0,r.A)(this.e,x,Math.sin(x)),this.B),u=Math.pow((0,r.A)(this.e,b,Math.sin(b)),this.B),l=this.E/c,p=(u-c)/(u+c),d=((d=this.E*this.E)-u*c)/(d+u*c),(t=A-v)<-Math.pi?v-=s.JM:t>Math.pi&&(v+=s.JM),this.lam0=(0,n.A)(.5*(A+v)-Math.atan(d*Math.tan(.5*this.B*(A-v))/p)/this.B),f=Math.atan(2*Math.sin(this.B*(0,n.A)(A-this.lam0))/(l-1/l)),_=w=Math.asin(o*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(_),this.cosrot=Math.cos(_),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(o*o-1)/Math.cos(w))),this.lat0<0&&(this.u_0=-this.u_0)),l=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(s.Vj-l)),this.v_pole_s=this.ArB*Math.log(Math.tan(s.Vj+l))},forward:function(t){var e,i,n,o,l,c,u,h,p={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-s.sK)>s.H0){if(e=.5*((l=this.E/Math.pow((0,r.A)(this.e,t.y,Math.sin(t.y)),this.B))-(c=1/l)),i=.5*(l+c),o=Math.sin(this.B*t.x),n=(e*this.singam-o*this.cosgam)/i,Math.abs(Math.abs(n)-1)<s.H0)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),c=Math.cos(this.B*t.x),u=Math.abs(c)<a?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+o*this.singam,c)}else h=t.y>0?this.v_pole_n:this.v_pole_s,u=this.ArB*t.y;return this.no_rot?(p.x=u,p.y=h):(u-=this.u_0,p.x=h*this.cosrot+u*this.sinrot,p.y=u*this.cosrot-h*this.sinrot),p.x=this.a*p.x+this.x0,p.y=this.a*p.y+this.y0,p},inverse:function(t){var e,i,r,n,a,l,c,u={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(i=t.y,e=t.x):(i=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),n=.5*((r=Math.exp(-this.BrA*i))-1/r),a=.5*(r+1/r),c=((l=Math.sin(this.BrA*e))*this.cosgam+n*this.singam)/a,Math.abs(Math.abs(c)-1)<s.H0)u.x=0,u.y=c<0?-s.sK:s.sK;else{if(u.y=this.E/Math.sqrt((1+c)/(1-c)),u.y=(0,o.A)(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(n*this.cosgam-l*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]}},69105:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(47037),n=i(88213),o=i(98248);const s={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,n,s,a,l,c,u=t.x,h=t.y;return n=(0,r.A)(u-this.long0),e=Math.sin(h),i=Math.cos(h),s=Math.cos(n),((a=this.sin_p14*e+this.cos_p14*i*s)>0||Math.abs(a)<=o.H0)&&(l=1*this.a*i*Math.sin(n),c=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*s)),t.x=l,t.y=c,t},inverse:function(t){var e,i,s,a,l,c,u;return t.x-=this.x0,t.y-=this.y0,e=Math.sqrt(t.x*t.x+t.y*t.y),i=(0,n.A)(e/this.a),s=Math.sin(i),a=Math.cos(i),c=this.long0,Math.abs(e)<=o.H0?(u=this.lat0,t.x=c,t.y=u,t):(u=(0,n.A)(a*this.sin_p14+t.y*s*this.cos_p14/e),l=Math.abs(this.lat0)-o.sK,Math.abs(l)<=o.H0?(c=this.lat0>=0?(0,r.A)(this.long0+Math.atan2(t.x,-t.y)):(0,r.A)(this.long0-Math.atan2(-t.x,t.y)),t.x=c,t.y=u,t):(c=(0,r.A)(this.long0+Math.atan2(t.x*s,e*this.cos_p14*a-t.y*this.sin_p14*s)),t.x=c,t.y=u,t))},names:["ortho"]}},58325:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>p});var r=i(14733),n=i(8834),o=i(9195),s=i(9624),a=i(47037),l=i(89013),c=i(12537),u=i(98248),h=i(15433);const p={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=(0,r.A)(this.es),this.e1=(0,n.A)(this.es),this.e2=(0,o.A)(this.es),this.e3=(0,s.A)(this.es),this.ml0=this.a*(0,c.A)(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,r,n=t.x,o=t.y,s=(0,a.A)(n-this.long0);if(r=s*Math.sin(o),this.sphere)Math.abs(o)<=u.H0?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(o),i=this.a*((0,l.A)(o-this.lat0)+(1-Math.cos(r))/Math.tan(o)));else if(Math.abs(o)<=u.H0)e=this.a*s,i=-1*this.ml0;else{var p=(0,h.A)(this.a,this.e,Math.sin(o))/Math.tan(o);e=p*Math.sin(r),i=this.a*(0,c.A)(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+p*(1-Math.cos(r))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,r,n,o,s,l,h,p;if(r=t.x-this.x0,n=t.y-this.y0,this.sphere)if(Math.abs(n+this.a*this.lat0)<=u.H0)e=(0,a.A)(r/this.a+this.long0),i=0;else{var d;for(s=this.lat0+n/this.a,l=r*r/this.a/this.a+s*s,h=s,o=20;o;--o)if(h+=p=-1*(s*(h*(d=Math.tan(h))+1)-h-.5*(h*h+l)*d)/((h-s)/d-1),Math.abs(p)<=u.H0){i=h;break}e=(0,a.A)(this.long0+Math.asin(r*Math.tan(h)/this.a)/Math.sin(i))}else if(Math.abs(n+this.ml0)<=u.H0)i=0,e=(0,a.A)(this.long0+r/this.a);else{var f,m,g,_,y;for(s=(this.ml0+n)/this.a,l=r*r/this.a/this.a+s*s,h=s,o=20;o;--o)if(y=this.e*Math.sin(h),f=Math.sqrt(1-y*y)*Math.tan(h),m=this.a*(0,c.A)(this.e0,this.e1,this.e2,this.e3,h),g=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=p=(s*(f*(_=m/this.a)+1)-_-.5*f*(_*_+l))/(this.es*Math.sin(2*h)*(_*_+l-2*s*_)/(4*f)+(s-_)*(f*g-2/Math.sin(2*h))-g),Math.abs(p)<=u.H0){i=h;break}f=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=(0,a.A)(this.long0+Math.asin(r*f/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]}},47630:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>u});var r=i(98248),n=1,o=2,s=3,a=4;function l(t,e,i,l){var c;return t<r.H0?(l.value=n,c=0):(c=Math.atan2(e,i),Math.abs(c)<=r.Vj?l.value=n:c>r.Vj&&c<=r.sK+r.Vj?(l.value=o,c-=r.sK):c>r.sK+r.Vj||c<=-(r.sK+r.Vj)?(l.value=s,c=c>=0?c-r.DF:c+r.DF):(l.value=a,c+=r.sK)),c}function c(t,e){var i=t+e;return i<-r.DF?i+=r.JM:i>+r.DF&&(i-=r.JM),i}const u={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=r.sK-r.Vj/2?this.face=5:this.lat0<=-(r.sK-r.Vj/2)?this.face=6:Math.abs(this.long0)<=r.Vj?this.face=1:Math.abs(this.long0)<=r.sK+r.Vj?this.face=this.long0>0?2:4:this.face=3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,u,h,p,d,f={x:0,y:0},m={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,5===this.face)h=r.sK-e,i>=r.Vj&&i<=r.sK+r.Vj?(m.value=n,u=i-r.sK):i>r.sK+r.Vj||i<=-(r.sK+r.Vj)?(m.value=o,u=i>0?i-r.DF:i+r.DF):i>-(r.sK+r.Vj)&&i<=-r.Vj?(m.value=s,u=i+r.sK):(m.value=a,u=i);else if(6===this.face)h=r.sK+e,i>=r.Vj&&i<=r.sK+r.Vj?(m.value=n,u=-i+r.sK):i<r.Vj&&i>=-r.Vj?(m.value=o,u=-i):i<-r.Vj&&i>=-(r.sK+r.Vj)?(m.value=s,u=-i-r.sK):(m.value=a,u=i>0?-i+r.DF:-i-r.DF);else{var g,_,y,A,v,x;2===this.face?i=c(i,+r.sK):3===this.face?i=c(i,+r.DF):4===this.face&&(i=c(i,-r.sK)),A=Math.sin(e),v=Math.cos(e),x=Math.sin(i),g=v*Math.cos(i),_=v*x,y=A,1===this.face?u=l(h=Math.acos(g),y,_,m):2===this.face?u=l(h=Math.acos(_),y,-g,m):3===this.face?u=l(h=Math.acos(-g),y,-_,m):4===this.face?u=l(h=Math.acos(-_),y,g,m):(h=u=0,m.value=n)}return d=Math.atan(12/r.DF*(u+Math.acos(Math.sin(u)*Math.cos(r.Vj))-r.sK)),p=Math.sqrt((1-Math.cos(h))/(Math.cos(d)*Math.cos(d))/(1-Math.cos(Math.atan(1/Math.cos(u))))),m.value===o?d+=r.sK:m.value===s?d+=r.DF:m.value===a&&(d+=1.5*r.DF),f.x=p*Math.cos(d),f.y=p*Math.sin(d),f.x=f.x*this.a+this.x0,f.y=f.y*this.a+this.y0,t.x=f.x,t.y=f.y,t},inverse:function(t){var e,i,l,u,h,p,d,f,m,g,_,y,A={lam:0,phi:0},v={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?v.value=n:t.y>=0&&t.y>=Math.abs(t.x)?(v.value=o,e-=r.sK):t.x<0&&-t.x>=Math.abs(t.y)?(v.value=s,e=e<0?e+r.DF:e-r.DF):(v.value=a,e+=r.sK),m=r.DF/12*Math.tan(e),h=Math.sin(m)/(Math.cos(m)-1/Math.sqrt(2)),p=Math.atan(h),(d=1-(l=Math.cos(e))*l*(u=Math.tan(i))*u*(1-Math.cos(Math.atan(1/Math.cos(p)))))<-1?d=-1:d>1&&(d=1),5===this.face)f=Math.acos(d),A.phi=r.sK-f,v.value===n?A.lam=p+r.sK:v.value===o?A.lam=p<0?p+r.DF:p-r.DF:v.value===s?A.lam=p-r.sK:A.lam=p;else if(6===this.face)f=Math.acos(d),A.phi=f-r.sK,v.value===n?A.lam=-p+r.sK:v.value===o?A.lam=-p:v.value===s?A.lam=-p-r.sK:A.lam=p<0?-p-r.DF:-p+r.DF;else{var x,b,w;m=(x=d)*x,b=(m+=(w=m>=1?0:Math.sqrt(1-m)*Math.sin(p))*w)>=1?0:Math.sqrt(1-m),v.value===o?(m=b,b=-w,w=m):v.value===s?(b=-b,w=-w):v.value===a&&(m=b,b=w,w=-m),2===this.face?(m=x,x=-b,b=m):3===this.face?(x=-x,b=-b):4===this.face&&(m=x,x=b,b=-m),A.phi=Math.acos(-w)-r.sK,A.lam=Math.atan2(b,x),2===this.face?A.lam=c(A.lam,-r.sK):3===this.face?A.lam=c(A.lam,-r.DF):4===this.face&&(A.lam=c(A.lam,+r.sK))}return 0!==this.es&&(g=A.phi<0?1:0,_=Math.tan(A.phi),y=this.b/Math.sqrt(_*_+this.one_minus_f_squared),A.phi=Math.atan(Math.sqrt(this.a*this.a-y*y)/(this.one_minus_f*y)),g&&(A.phi=-A.phi)),A.lam+=this.long0,t.x=A.lam,t.y=A.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]}},49475:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>p});var r=i(98248),n=i(47037),o=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],s=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],a=.8487,l=1.3523,c=r.dX/5,u=1/c,h=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};const p={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=(0,n.A)(t.x-this.long0),i=Math.abs(t.y),p=Math.floor(i*c);p<0?p=0:p>=18&&(p=17),i=r.dX*(i-u*p);var d={x:h(o[p],i)*e,y:h(s[p],i)};return t.y<0&&(d.y=-d.y),d.x=d.x*this.a*a+this.x0,d.y=d.y*this.a*l+this.y0,d},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*a),y:Math.abs(t.y-this.y0)/(this.a*l)};if(e.y>=1)e.x/=o[18][0],e.y=t.y<0?-r.sK:r.sK;else{var i=Math.floor(18*e.y);for(i<0?i=0:i>=18&&(i=17);;)if(s[i][0]>e.y)--i;else{if(!(s[i+1][0]<=e.y))break;++i}var c=s[i],u=5*(e.y-c[0])/(s[i+1][0]-c[0]);u=function(t,e,i,r){for(var n=e;r;--r){var o=t(n);if(n-=o,Math.abs(o)<i)break}return n}((function(t){return(h(c,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(c,t)}),u,r.H0,100),e.x/=h(o[i],u),e.y=(5*i+u)*r.zq,t.y<0&&(e.y=-e.y)}return e.x=(0,n.A)(e.x+this.long0),e},names:["Robinson","robin"]}},61786:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>u});var r=i(47037),n=i(89013),o=i(56882),s=i(80688),a=i(46048),l=i(98248),c=i(88213);const u={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=(0,o.A)(this.es)},forward:function(t){var e,i,n=t.x,o=t.y;if(n=(0,r.A)(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(o),c=20;c;--c){var u=(this.m*o+Math.sin(o)-a)/(this.m+Math.cos(o));if(o-=u,Math.abs(u)<l.H0)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*n*(this.m+Math.cos(o)),i=this.a*this.C_y*o}else{var h=Math.sin(o),p=Math.cos(o);i=this.a*(0,s.A)(o,h,p,this.en),e=this.a*n*p/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,o,s;return t.x-=this.x0,o=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,o/=this.C_x*(this.m+Math.cos(e)),this.m?e=(0,c.A)((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=(0,c.A)(Math.sin(e)/this.n)),o=(0,r.A)(o+this.long0),e=(0,n.A)(e)):(e=(0,a.A)(t.y/this.a,this.es,this.en),(s=Math.abs(e))<l.sK?(s=Math.sin(e),i=this.long0+t.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(e)),o=(0,r.A)(i)):s-l.H0<l.sK&&(o=this.long0)),t.x=o,t.y=e,t},names:["Sinusoidal","sinu"]}},80496:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>r});const r={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,r=1/this.rf,n=2*r-Math.pow(r,2),o=this.e=Math.sqrt(n);this.R=this.k0*i*Math.sqrt(1-n)/(1-n*Math.pow(e,2)),this.alpha=Math.sqrt(1+n/(1-n)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+o*e)/(1-o*e));this.K=s-this.alpha*a+this.alpha*o/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),r=-this.alpha*(e+i)+this.K,n=2*(Math.atan(Math.exp(r))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(o))),a=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,t.x=this.R*s+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,r=e/this.R,n=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(n)+Math.sin(this.b0)*Math.cos(n)*Math.cos(r)),s=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(n))),a=this.lambda0+s/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=a,t.y=c,t},names:["somerc"]}},57084:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c});var r=i(98248),n=i(11393),o=i(23824),s=i(45683),a=i(58557),l=i(47037);const c={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r.H0&&(this.k0=.5*(1+(0,n.A)(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=r.H0&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=r.H0&&Math.abs(Math.cos(this.lat_ts))>r.H0&&(this.k0=.5*this.cons*(0,o.A)(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/(0,s.A)(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=(0,o.A)(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-r.sK,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,n,o,a,c,u=t.x,h=t.y,p=Math.sin(h),d=Math.cos(h),f=(0,l.A)(u-this.long0);return Math.abs(Math.abs(u-this.long0)-Math.PI)<=r.H0&&Math.abs(h+this.lat0)<=r.H0?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*p+this.coslat0*d*Math.cos(f)),t.x=this.a*e*d*Math.sin(f)+this.x0,t.y=this.a*e*(this.coslat0*p-this.sinlat0*d*Math.cos(f))+this.y0,t):(i=2*Math.atan(this.ssfn_(h,p,this.e))-r.sK,o=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=r.H0?(a=(0,s.A)(this.e,h*this.con,this.con*p),c=2*this.a*this.k0*a/this.cons,t.x=this.x0+c*Math.sin(u-this.long0),t.y=this.y0-this.con*c*Math.cos(u-this.long0),t):(Math.abs(this.sinlat0)<r.H0?(e=2*this.a*this.k0/(1+o*Math.cos(f)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*o*Math.cos(f))),t.y=e*(this.cosX0*n-this.sinX0*o*Math.cos(f))+this.y0),t.x=e*o*Math.sin(f)+this.x0,t))},inverse:function(t){var e,i,n,o,s;t.x-=this.x0,t.y-=this.y0;var c=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var u=2*Math.atan(c/(2*this.a*this.k0));return e=this.long0,i=this.lat0,c<=r.H0?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(u)*this.sinlat0+t.y*Math.sin(u)*this.coslat0/c),e=Math.abs(this.coslat0)<r.H0?this.lat0>0?(0,l.A)(this.long0+Math.atan2(t.x,-1*t.y)):(0,l.A)(this.long0+Math.atan2(t.x,t.y)):(0,l.A)(this.long0+Math.atan2(t.x*Math.sin(u),c*this.coslat0*Math.cos(u)-t.y*this.sinlat0*Math.sin(u))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=r.H0){if(c<=r.H0)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=c*this.cons/(2*this.a*this.k0),i=this.con*(0,a.A)(this.e,n),e=this.con*(0,l.A)(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else o=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,c<=r.H0?s=this.X0:(s=Math.asin(Math.cos(o)*this.sinX0+t.y*Math.sin(o)*this.cosX0/c),e=(0,l.A)(this.long0+Math.atan2(t.x*Math.sin(o),c*this.cosX0*Math.cos(o)-t.y*this.sinX0*Math.sin(o)))),i=-1*(0,a.A)(this.e,Math.tan(.5*(r.sK+s)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(r.sK+t))*Math.pow((1-e)/(1+e),.5*i)}}},16581:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(72246),n=i(47037),o=i(46344);const s={init:function(){r.Ay.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,o,s;return t.x=(0,n.A)(t.x-this.long0),r.Ay.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),o=Math.cos(t.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*o),t.x=s*i*Math.sin(t.x),t.y=s*(this.cosc0*e-this.sinc0*i*o),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,s,a,l;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,l=(0,o.A)(t.x,t.y)){var c=2*Math.atan2(l,this.R2);e=Math.sin(c),i=Math.cos(c),a=Math.asin(i*this.sinc0+t.y*e*this.cosc0/l),s=Math.atan2(t.x*e,l*this.cosc0*i-t.y*this.sinc0*e)}else a=this.phic0,s=0;return t.x=s,t.y=a,r.Ay.inverse.apply(this,[t]),t.x=(0,n.A)(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]}},72766:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>c});var r=i(56882),n=i(80688),o=i(46048),s=i(47037),a=i(98248),l=i(11393);const c={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=(0,r.A)(this.es),this.ml0=(0,n.A)(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,r,o=t.x,l=t.y,c=(0,s.A)(o-this.long0),u=Math.sin(l),h=Math.cos(l);if(this.es){var p=h*c,d=Math.pow(p,2),f=this.ep2*Math.pow(h,2),m=Math.pow(f,2),g=Math.abs(h)>a.H0?Math.tan(l):0,_=Math.pow(g,2),y=Math.pow(_,2);e=1-this.es*Math.pow(u,2),p/=Math.sqrt(e);var A=(0,n.A)(l,u,h,this.en);i=this.a*(this.k0*p*(1+d/6*(1-_+f+d/20*(5-18*_+y+14*f-58*_*f+d/42*(61+179*y-y*_-479*_)))))+this.x0,r=this.a*(this.k0*(A-this.ml0+u*c*p/2*(1+d/12*(5-_+9*f+4*m+d/30*(61+y-58*_+270*f-330*_*f+d/56*(1385+543*y-y*_-3111*_))))))+this.y0}else{var v=h*Math.sin(c);if(Math.abs(Math.abs(v)-1)<a.H0)return 93;if(i=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,r=h*Math.cos(c)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(r))>=1){if(v-1>a.H0)return 93;r=0}else r=Math.acos(r);l<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return t.x=i,t.y=r,t},inverse:function(t){var e,i,r,n,c=(t.x-this.x0)*(1/this.a),u=(t.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+u/this.k0,i=(0,o.A)(e,this.es,this.en),Math.abs(i)<a.sK){var h=Math.sin(i),p=Math.cos(i),d=Math.abs(p)>a.H0?Math.tan(i):0,f=this.ep2*Math.pow(p,2),m=Math.pow(f,2),g=Math.pow(d,2),_=Math.pow(g,2);e=1-this.es*Math.pow(h,2);var y=c*Math.sqrt(e)/this.k0,A=Math.pow(y,2);r=i-(e*=d)*A/(1-this.es)*.5*(1-A/12*(5+3*g-9*f*g+f-4*m-A/30*(61+90*g-252*f*g+45*_+46*f-A/56*(1385+3633*g+4095*_+1574*_*g)))),n=(0,s.A)(this.long0+y*(1-A/6*(1+2*g+f-A/20*(5+28*g+24*_+8*f*g+6*f-A/42*(61+662*g+1320*_+720*_*g))))/p)}else r=a.sK*(0,l.A)(u),n=0;else{var v=Math.exp(c/this.k0),x=.5*(v-1/v),b=this.lat0+u/this.k0,w=Math.cos(b);e=Math.sqrt((1-Math.pow(w,2))/(1+Math.pow(x,2))),r=Math.asin(e),u<0&&(r=-r),n=0===x&&0===w?0:(0,s.A)(Math.atan2(x,w)+this.long0)}return t.x=n,t.y=r,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]}},61659:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(98248),n=i(46344),o={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const s={init:function(){if(Object.keys(o).forEach(function(t){if(void 0===this[t])this[t]=o[t].def;else{if(o[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);o[t].num&&(this[t]=parseFloat(this[t]))}o[t].degrees&&(this[t]=this[t]*r.zq)}.bind(this)),Math.abs(Math.abs(this.lat0)-r.sK)<r.H0?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<r.H0?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,i,r,n,o=Math.sin(t.y),s=Math.cos(t.y),a=Math.cos(t.x);switch(this.mode){case 3:i=this.sinph0*o+this.cosph0*s*a;break;case 2:i=s*a;break;case 1:i=-o;break;case 0:i=o}switch(e=(i=this.pn1/(this.p-i))*s*Math.sin(t.x),this.mode){case 3:i*=this.cosph0*o-this.sinph0*s*a;break;case 2:i*=o;break;case 0:i*=-s*a;break;case 1:i*=s*a}return n=1/((r=i*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-i*this.sg)*this.cw*n,i=r*n,t.x=e*this.a,t.y=i*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,i,o,s={x:t.x,y:t.y};o=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*o,i=this.pn1*t.y*this.cw*o,t.x=e*this.cg+i*this.sg,t.y=i*this.cg-e*this.sg;var a=(0,n.A)(t.x,t.y);if(Math.abs(a)<r.H0)s.x=0,s.y=t.y;else{var l,c;switch(c=1-a*a*this.pfact,c=(this.p-Math.sqrt(c))/(this.pn1/a+a/this.pn1),l=Math.sqrt(1-c*c),this.mode){case 3:s.y=Math.asin(l*this.sinph0+t.y*c*this.cosph0/a),t.y=(l-this.sinph0*Math.sin(s.y))*a,t.x*=c*this.cosph0;break;case 2:s.y=Math.asin(t.y*c/a),t.y=l*a,t.x*=c;break;case 0:s.y=Math.asin(l),t.y=-t.y;break;case 1:s.y=-Math.asin(l)}s.x=Math.atan2(t.x,t.y)}return t.x=s.x+this.long0,t.y=s.y,t},names:["Tilted_Perspective","tpers"]}},97623:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(75280),n=i(27483),o=i(98248);const s={init:function(){var t=(0,r.A)(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*o.zq,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,n.Ay.init.apply(this),this.forward=n.Ay.forward,this.inverse=n.Ay.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"}},66271:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>s});var r=i(47037),n=i(98248),o=i(88213);const s={init:function(){this.R=this.a},forward:function(t){var e,i,s=t.x,a=t.y,l=(0,r.A)(s-this.long0);Math.abs(a)<=n.H0&&(e=this.x0+this.R*l,i=this.y0);var c=(0,o.A)(2*Math.abs(a/Math.PI));(Math.abs(l)<=n.H0||Math.abs(Math.abs(a)-n.sK)<=n.H0)&&(e=this.x0,i=a>=0?this.y0+Math.PI*this.R*Math.tan(.5*c):this.y0+Math.PI*this.R*-Math.tan(.5*c));var u=.5*Math.abs(Math.PI/l-l/Math.PI),h=u*u,p=Math.sin(c),d=Math.cos(c),f=d/(p+d-1),m=f*f,g=f*(2/p-1),_=g*g,y=Math.PI*this.R*(u*(f-_)+Math.sqrt(h*(f-_)*(f-_)-(_+h)*(m-_)))/(_+h);l<0&&(y=-y),e=this.x0+y;var A=h+f;return y=Math.PI*this.R*(g*A-u*Math.sqrt((_+h)*(h+1)-A*A))/(_+h),i=a>=0?this.y0+y:this.y0-y,t.x=e,t.y=i,t},inverse:function(t){var e,i,o,s,a,l,c,u,h,p,d,f;return t.x-=this.x0,t.y-=this.y0,d=Math.PI*this.R,a=(o=t.x/d)*o+(s=t.y/d)*s,d=3*(s*s/(u=-2*(l=-Math.abs(s)*(1+a))+1+2*s*s+a*a)+(2*(c=l-2*s*s+o*o)*c*c/u/u/u-9*l*c/u/u)/27)/(h=(l-c*c/3/u)/u)/(p=2*Math.sqrt(-h/3)),Math.abs(d)>1&&(d=d>=0?1:-1),f=Math.acos(d)/3,i=t.y>=0?(-p*Math.cos(f+Math.PI/3)-c/3/u)*Math.PI:-(-p*Math.cos(f+Math.PI/3)-c/3/u)*Math.PI,e=Math.abs(o)<n.H0?this.long0:(0,r.A)(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(o*o-s*s)+a*a))/2/o),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]}},81314:(t,e,i)=>{"use strict";i.d(e,{A:()=>c});var r=i(98248),n=i(42738),o=i(61603),s=i(29499),a=i(10247),l=i(85852);function c(t,e,i,u){var h,p=void 0!==(i=Array.isArray(i)?(0,a.A)(i):{x:i.x,y:i.y,z:i.z,m:i.m}).z;if((0,l.A)(i),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===r.a8||t.datum.datum_type===r.Y$||t.datum.datum_type===r.G9)&&"WGS84"!==e.datumCode||(e.datum.datum_type===r.a8||e.datum.datum_type===r.Y$||e.datum.datum_type===r.G9)&&"WGS84"!==t.datumCode}(t,e)&&(i=c(t,h=new s.A("WGS84"),i,u),t=h),u&&"enu"!==t.axis&&(i=(0,o.A)(t,!1,i)),"longlat"===t.projName)i={x:i.x*r.zq,y:i.y*r.zq,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;if(t.from_greenwich&&(i.x+=t.from_greenwich),i=(0,n.A)(t.datum,e.datum,i))return e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*r.dX,y:i.y*r.dX,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),u&&"enu"!==e.axis?(0,o.A)(e,!0,i):(i&&!p&&delete i.z,i)}},85002:(t,e,i)=>{"use strict";i.d(e,{A:()=>N});var r=i(72766),n=i(27483),o=i(97623),s=i(16581),a=i(57084),l=i(80496),c=i(6207),u=i(49857),h=i(22615),p=i(47213),d=i(82218),f=i(5566),m=i(54562),g=i(45912),_=i(42316),y=i(58325),A=i(79931),v=i(99993),x=i(61786),b=i(46203),w=i(46316),S=i(66271),T=i(89344),C=i(69105),M=i(47630),E=i(49475),I=i(89056),L=i(61659),P=i(2873),k=i(71557);function N(t){t.Proj.projections.add(r.Ay),t.Proj.projections.add(n.Ay),t.Proj.projections.add(o.Ay),t.Proj.projections.add(s.Ay),t.Proj.projections.add(a.Ay),t.Proj.projections.add(l.Ay),t.Proj.projections.add(c.Ay),t.Proj.projections.add(u.Ay),t.Proj.projections.add(h.Ay),t.Proj.projections.add(p.Ay),t.Proj.projections.add(d.Ay),t.Proj.projections.add(f.Ay),t.Proj.projections.add(m.Ay),t.Proj.projections.add(g.Ay),t.Proj.projections.add(_.Ay),t.Proj.projections.add(y.Ay),t.Proj.projections.add(A.Ay),t.Proj.projections.add(v.Ay),t.Proj.projections.add(x.Ay),t.Proj.projections.add(b.Ay),t.Proj.projections.add(w.Ay),t.Proj.projections.add(S.Ay),t.Proj.projections.add(T.Ay),t.Proj.projections.add(C.Ay),t.Proj.projections.add(M.Ay),t.Proj.projections.add(E.Ay),t.Proj.projections.add(I.Ay),t.Proj.projections.add(L.Ay),t.Proj.projections.add(P.Ay),t.Proj.projections.add(k.Ay)}},37142:(t,e,i)=>{!function(e){var r,n;if("function"==typeof define&&define.amd)define(["leaflet","proj4"],e);else if("object"==typeof t.exports)r=i(53481),n=i(80190),t.exports=e(r,n);else{if(void 0===window.L||void 0===window.proj4)throw"Leaflet and proj4 must be loaded first";e(window.L,window.proj4)}}((function(t,e){return e.__esModule&&e.default&&(e=e.default),t.Proj={},t.Proj._isProj4Obj=function(t){return void 0!==t.inverse&&void 0!==t.forward},t.Proj.Projection=t.Class.extend({initialize:function(e,i,r){var n=t.Proj._isProj4Obj(e);this._proj=n?e:this._projFromCodeDef(e,i),this.bounds=n?i:r},project:function(e){var i=this._proj.forward([e.lng,e.lat]);return new t.Point(i[0],i[1])},unproject:function(e,i){var r=this._proj.inverse([e.x,e.y]);return new t.LatLng(r[1],r[0],i)},_projFromCodeDef:function(t,i){if(i)e.defs(t,i);else if(void 0===e.defs[t]){var r=t.split(":");if(r.length>3&&(t=r[r.length-3]+":"+r[r.length-1]),void 0===e.defs[t])throw"No projection definition for code "+t}return e(t)}}),t.Proj.CRS=t.Class.extend({includes:t.CRS,options:{transformation:new t.Transformation(1,0,-1,0)},initialize:function(e,i,r){var n,o,s,a;if(t.Proj._isProj4Obj(e)?(n=(o=e).srsCode,a=i||{},this.projection=new t.Proj.Projection(o,a.bounds)):(n=e,s=i,a=r||{},this.projection=new t.Proj.Projection(n,s,a.bounds)),t.Util.setOptions(this,a),this.code=n,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new t.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var l=this.options.resolutions.length-1;l>=0;l--)this.options.resolutions[l]&&(this._scales[l]=1/this.options.resolutions[l])}this.infinite=!this.options.bounds},scale:function(t){var e,i=Math.floor(t);return t===i?this._scales[t]:(e=this._scales[i])+(this._scales[i+1]-e)*(t-i)},zoom:function(t){var e,i,r=this._closestElement(this._scales,t),n=this._scales.indexOf(r);return t===r?n:void 0===r?-1/0:(i=n+1,void 0===(e=this._scales[i])?1/0:(t-r)/(e-r)+n)},distance:t.CRS.Earth.distance,R:t.CRS.Earth.R,_closestElement:function(t,e){for(var i,r=t.length;r--;)t[r]<=e&&(void 0===i||i<t[r])&&(i=t[r]);return i}}),t.Proj.GeoJSON=t.GeoJSON.extend({initialize:function(e,i){this._callLevel=0,t.GeoJSON.prototype.initialize.call(this,e,i)},addData:function(e){var i;e&&(e.crs&&"name"===e.crs.type?i=new t.Proj.CRS(e.crs.properties.name):e.crs&&e.crs.type&&(i=new t.Proj.CRS(e.crs.type+":"+e.crs.properties.code)),void 0!==i&&(this.options.coordsToLatLng=function(e){var r=t.point(e[0],e[1]);return i.projection.unproject(r)})),this._callLevel++;try{t.GeoJSON.prototype.addData.call(this,e)}finally{this._callLevel--,0===this._callLevel&&delete this.options.coordsToLatLng}}}),t.Proj.geoJson=function(e,i){return new t.Proj.GeoJSON(e,i)},t.Proj.ImageOverlay=t.ImageOverlay.extend({initialize:function(e,i,r){t.ImageOverlay.prototype.initialize.call(this,e,null,r),this._projectedBounds=i},_animateZoom:function(e){var i=this._map.getZoomScale(e.zoom),r=t.point(this._projectedBounds.min.x,this._projectedBounds.max.y),n=this._projectedToNewLayerPoint(r,e.zoom,e.center);t.DomUtil.setTransform(this._image,n,i)},_reset:function(){var e=this._map.getZoom(),i=this._map.getPixelOrigin(),r=t.bounds(this._transform(this._projectedBounds.min,e)._subtract(i),this._transform(this._projectedBounds.max,e)._subtract(i)),n=r.getSize();t.DomUtil.setPosition(this._image,r.min),this._image.style.width=n.x+"px",this._image.style.height=n.y+"px"},_projectedToNewLayerPoint:function(t,e,i){var r=this._map.getSize()._divideBy(2),n=this._map.project(i,e)._subtract(r)._round().add(this._map._getMapPanePos());return this._transform(t,e)._subtract(n)},_transform:function(t,e){var i=this._map.options.crs,r=i.transformation,n=i.scale(e);return r.transform(t,n)}}),t.Proj.imageOverlay=function(e,i,r){return new t.Proj.ImageOverlay(e,i,r)},t.Proj}))},10918:(t,e,i)=>{"use strict";t.exports=i(67706)},29551:(t,e,i)=>{"use strict";var r=i(79795);function n(){}var o=null,s={};function a(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("Promise constructor's argument is not a function");this._x=0,this._y=0,this._z=null,this._A=null,t!==n&&d(t,this)}function l(t,e){for(;3===t._y;)t=t._z;if(a._B&&a._B(t),0===t._y)return 0===t._x?(t._x=1,void(t._A=e)):1===t._x?(t._x=2,void(t._A=[t._A,e])):void t._A.push(e);!function(t,e){r((function(){var i=1===t._y?e.onFulfilled:e.onRejected;if(null!==i){var r=function(t,e){try{return t(e)}catch(t){return o=t,s}}(i,t._z);r===s?u(e.promise,o):c(e.promise,r)}else 1===t._y?c(e.promise,t._z):u(e.promise,t._z)}))}(t,e)}function c(t,e){if(e===t)return u(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var i=function(t){try{return t.then}catch(t){return o=t,s}}(e);if(i===s)return u(t,o);if(i===t.then&&e instanceof a)return t._y=3,t._z=e,void h(t);if("function"==typeof i)return void d(i.bind(e),t)}t._y=1,t._z=e,h(t)}function u(t,e){t._y=2,t._z=e,a._C&&a._C(t,e),h(t)}function h(t){if(1===t._x&&(l(t,t._A),t._A=null),2===t._x){for(var e=0;e<t._A.length;e++)l(t,t._A[e]);t._A=null}}function p(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function d(t,e){var i=!1,r=function(t,r,n){try{t((function(t){i||(i=!0,c(e,t))}),(function(t){i||(i=!0,u(e,t))}))}catch(t){return o=t,s}}(t);i||r!==s||(i=!0,u(e,o))}t.exports=a,a._B=null,a._C=null,a._D=n,a.prototype.then=function(t,e){if(this.constructor!==a)return function(t,e,i){return new t.constructor((function(r,o){var s=new a(n);s.then(r,o),l(t,new p(e,i,s))}))}(this,t,e);var i=new a(n);return l(this,new p(t,e,i)),i}},25556:(t,e,i)=>{"use strict";var r=i(29551);t.exports=r,r.prototype.done=function(t,e){(arguments.length?this.then.apply(this,arguments):this).then(null,(function(t){setTimeout((function(){throw t}),0)}))}},88635:(t,e,i)=>{"use strict";var r=i(29551);t.exports=r;var n=u(!0),o=u(!1),s=u(null),a=u(void 0),l=u(0),c=u("");function u(t){var e=new r(r._D);return e._y=1,e._z=t,e}r.resolve=function(t){if(t instanceof r)return t;if(null===t)return s;if(void 0===t)return a;if(!0===t)return n;if(!1===t)return o;if(0===t)return l;if(""===t)return c;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new r(e.bind(t))}catch(t){return new r((function(e,i){i(t)}))}return u(t)};var h=function(t){return"function"==typeof Array.from?(h=Array.from,Array.from(t)):(h=function(t){return Array.prototype.slice.call(t)},Array.prototype.slice.call(t))};function p(t){return{status:"fulfilled",value:t}}function d(t){return{status:"rejected",reason:t}}function f(t){if(t&&("object"==typeof t||"function"==typeof t)){if(t instanceof r&&t.then===r.prototype.then)return t.then(p,d);var e=t.then;if("function"==typeof e)return new r(e.bind(t)).then(p,d)}return p(t)}function m(t){if("function"==typeof AggregateError)return new AggregateError(t,"All promises were rejected");var e=new Error("All promises were rejected");return e.name="AggregateError",e.errors=t,e}r.all=function(t){var e=h(t);return new r((function(t,i){if(0===e.length)return t([]);var n=e.length;function o(s,a){if(a&&("object"==typeof a||"function"==typeof a)){if(a instanceof r&&a.then===r.prototype.then){for(;3===a._y;)a=a._z;return 1===a._y?o(s,a._z):(2===a._y&&i(a._z),void a.then((function(t){o(s,t)}),i))}var l=a.then;if("function"==typeof l)return void new r(l.bind(a)).then((function(t){o(s,t)}),i)}e[s]=a,0==--n&&t(e)}for(var s=0;s<e.length;s++)o(s,e[s])}))},r.allSettled=function(t){return r.all(h(t).map(f))},r.reject=function(t){return new r((function(e,i){i(t)}))},r.race=function(t){return new r((function(e,i){h(t).forEach((function(t){r.resolve(t).then(e,i)}))}))},r.prototype.catch=function(t){return this.then(null,t)},r.any=function(t){return new r((function(e,i){var n=h(t),o=!1,s=[];function a(t){o||(o=!0,e(t))}function l(t){s.push(t),s.length===n.length&&i(m(s))}0===n.length?i(m(s)):n.forEach((function(t){r.resolve(t).then(a,l)}))}))}},14293:(t,e,i)=>{"use strict";var r=i(29551);t.exports=r,r.prototype.finally=function(t){return this.then((function(e){return r.resolve(t()).then((function(){return e}))}),(function(e){return r.resolve(t()).then((function(){throw e}))}))}},67706:(t,e,i)=>{"use strict";t.exports=i(29551),i(25556),i(14293),i(88635),i(59791),i(51727)},59791:(t,e,i)=>{"use strict";var r=i(29551),n=i(95236);t.exports=r,r.denodeify=function(t,e){return"number"==typeof e&&e!==1/0?function(t,e){for(var i=[],n=0;n<e;n++)i.push("a"+n);var s=["return function ("+i.join(",")+") {","var self = this;","return new Promise(function (rs, rj) {","var res = fn.call(",["self"].concat(i).concat([o]).join(","),");","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],s)(r,t)}(t,e):function(t){for(var e=Math.max(t.length-1,3),i=[],n=0;n<e;n++)i.push("a"+n);var s=["return function ("+i.join(",")+") {","var self = this;","var args;","var argLength = arguments.length;","if (arguments.length > "+e+") {","args = new Array(arguments.length + 1);","for (var i = 0; i < arguments.length; i++) {","args[i] = arguments[i];","}","}","return new Promise(function (rs, rj) {","var cb = "+o+";","var res;","switch (argLength) {",i.concat(["extra"]).map((function(t,e){return"case "+e+":res = fn.call("+["self"].concat(i.slice(0,e)).concat("cb").join(",")+");break;"})).join(""),"default:","args[argLength] = cb;","res = fn.apply(self, args);","}","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],s)(r,t)}(t)};var o="function (err, res) {if (err) { rj(err); } else { rs(res); }}";r.nodeify=function(t){return function(){var e=Array.prototype.slice.call(arguments),i="function"==typeof e[e.length-1]?e.pop():null,o=this;try{return t.apply(this,arguments).nodeify(i,o)}catch(t){if(null==i)return new r((function(e,i){i(t)}));n((function(){i.call(o,t)}))}}},r.prototype.nodeify=function(t,e){if("function"!=typeof t)return this;this.then((function(i){n((function(){t.call(e,null,i)}))}),(function(i){n((function(){t.call(e,i)}))}))}},51727:(t,e,i)=>{"use strict";var r=i(29551);t.exports=r,r.enableSynchronous=function(){r.prototype.isPending=function(){return 0==this.getState()},r.prototype.isFulfilled=function(){return 1==this.getState()},r.prototype.isRejected=function(){return 2==this.getState()},r.prototype.getValue=function(){if(3===this._y)return this._z.getValue();if(!this.isFulfilled())throw new Error("Cannot get a value of an unfulfilled promise.");return this._z},r.prototype.getReason=function(){if(3===this._y)return this._z.getReason();if(!this.isRejected())throw new Error("Cannot get a rejection reason of a non-rejected promise.");return this._z},r.prototype.getState=function(){return 3===this._y?this._z.getState():-1===this._y||-2===this._y?0:this._y}},r.disableSynchronous=function(){r.prototype.isPending=void 0,r.prototype.isFulfilled=void 0,r.prototype.isRejected=void 0,r.prototype.getValue=void 0,r.prototype.getReason=void 0,r.prototype.getState=void 0}},74765:t=>{"use strict";var e=String.prototype.replace,i=/%20/g,r="RFC3986";t.exports={default:r,formatters:{RFC1738:function(t){return e.call(t,i,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:r}},55373:(t,e,i)=>{"use strict";var r=i(98636),n=i(62642),o=i(74765);t.exports={formats:o,parse:n,stringify:r}},62642:(t,e,i)=>{"use strict";var r=i(37720),n=Object.prototype.hasOwnProperty,o=Array.isArray,s={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},l=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},c=function(t,e,i,r){if(t){var o=i.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,s=/(\[[^[\]]*])/g,a=i.depth>0&&/(\[[^[\]]*])/.exec(o),c=a?o.slice(0,a.index):o,u=[];if(c){if(!i.plainObjects&&n.call(Object.prototype,c)&&!i.allowPrototypes)return;u.push(c)}for(var h=0;i.depth>0&&null!==(a=s.exec(o))&&h<i.depth;){if(h+=1,!i.plainObjects&&n.call(Object.prototype,a[1].slice(1,-1))&&!i.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+o.slice(a.index)+"]"),function(t,e,i,r){for(var n=r?e:l(e,i),o=t.length-1;o>=0;--o){var s,a=t[o];if("[]"===a&&i.parseArrays)s=i.allowEmptyArrays&&""===n?[]:[].concat(n);else{s=i.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=i.decodeDotInKeys?c.replace(/%2E/g,"."):c,h=parseInt(u,10);i.parseArrays||""!==u?!isNaN(h)&&a!==u&&String(h)===u&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(s=[])[h]=n:"__proto__"!==u&&(s[u]=n):s={0:n}}n=s}return n}(u,e,i,r)}};t.exports=function(t,e){var i=function(t){if(!t)return s;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.decodeDotInKeys&&"boolean"!=typeof t.decodeDotInKeys)throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?s.charset:t.charset,i=void 0===t.duplicates?s.duplicates:t.duplicates;if("combine"!==i&&"first"!==i&&"last"!==i)throw new TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===t.allowDots?!0===t.decodeDotInKeys||s.allowDots:!!t.allowDots,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:s.allowEmptyArrays,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:s.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:s.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:s.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:s.comma,decodeDotInKeys:"boolean"==typeof t.decodeDotInKeys?t.decodeDotInKeys:s.decodeDotInKeys,decoder:"function"==typeof t.decoder?t.decoder:s.decoder,delimiter:"string"==typeof t.delimiter||r.isRegExp(t.delimiter)?t.delimiter:s.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:s.depth,duplicates:i,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:s.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:s.strictNullHandling}}(e);if(""===t||null==t)return i.plainObjects?Object.create(null):{};for(var u="string"==typeof t?function(t,e){var i,c={__proto__:null},u=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,h=e.parameterLimit===1/0?void 0:e.parameterLimit,p=u.split(e.delimiter,h),d=-1,f=e.charset;if(e.charsetSentinel)for(i=0;i<p.length;++i)0===p[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[i]?f="utf-8":"utf8=%26%2310003%3B"===p[i]&&(f="iso-8859-1"),d=i,i=p.length);for(i=0;i<p.length;++i)if(i!==d){var m,g,_=p[i],y=_.indexOf("]="),A=-1===y?_.indexOf("="):y+1;-1===A?(m=e.decoder(_,s.decoder,f,"key"),g=e.strictNullHandling?null:""):(m=e.decoder(_.slice(0,A),s.decoder,f,"key"),g=r.maybeMap(l(_.slice(A+1),e),(function(t){return e.decoder(t,s.decoder,f,"value")}))),g&&e.interpretNumericEntities&&"iso-8859-1"===f&&(g=a(g)),_.indexOf("[]=")>-1&&(g=o(g)?[g]:g);var v=n.call(c,m);v&&"combine"===e.duplicates?c[m]=r.combine(c[m],g):v&&"last"!==e.duplicates||(c[m]=g)}return c}(t,i):t,h=i.plainObjects?Object.create(null):{},p=Object.keys(u),d=0;d<p.length;++d){var f=p[d],m=c(f,u[f],i,"string"==typeof t);h=r.merge(h,m,i)}return!0===i.allowSparse?h:r.compact(h)}},98636:(t,e,i)=>{"use strict";var r=i(920),n=i(37720),o=i(74765),s=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},l=Array.isArray,c=Array.prototype.push,u=function(t,e){c.apply(t,l(e)?e:[e])},h=Date.prototype.toISOString,p=o.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:n.encode,encodeValuesOnly:!1,format:p,formatter:o.formatters[p],indices:!1,serializeDate:function(t){return h.call(t)},skipNulls:!1,strictNullHandling:!1},f={},m=function t(e,i,o,s,a,c,h,p,m,g,_,y,A,v,x,b,w,S){for(var T,C=e,M=S,E=0,I=!1;void 0!==(M=M.get(f))&&!I;){var L=M.get(e);if(E+=1,void 0!==L){if(L===E)throw new RangeError("Cyclic object value");I=!0}void 0===M.get(f)&&(E=0)}if("function"==typeof g?C=g(i,C):C instanceof Date?C=A(C):"comma"===o&&l(C)&&(C=n.maybeMap(C,(function(t){return t instanceof Date?A(t):t}))),null===C){if(c)return m&&!b?m(i,d.encoder,w,"key",v):i;C=""}if("string"==typeof(T=C)||"number"==typeof T||"boolean"==typeof T||"symbol"==typeof T||"bigint"==typeof T||n.isBuffer(C))return m?[x(b?i:m(i,d.encoder,w,"key",v))+"="+x(m(C,d.encoder,w,"value",v))]:[x(i)+"="+x(String(C))];var P,k=[];if(void 0===C)return k;if("comma"===o&&l(C))b&&m&&(C=n.maybeMap(C,m)),P=[{value:C.length>0?C.join(",")||null:void 0}];else if(l(g))P=g;else{var N=Object.keys(C);P=_?N.sort(_):N}var D=p?i.replace(/\./g,"%2E"):i,O=s&&l(C)&&1===C.length?D+"[]":D;if(a&&l(C)&&0===C.length)return O+"[]";for(var R=0;R<P.length;++R){var F=P[R],z="object"==typeof F&&void 0!==F.value?F.value:C[F];if(!h||null!==z){var B=y&&p?F.replace(/\./g,"%2E"):F,U=l(C)?"function"==typeof o?o(O,B):O:O+(y?"."+B:"["+B+"]");S.set(e,E);var V=r();V.set(f,S),u(k,t(z,U,o,s,a,c,h,p,"comma"===o&&b&&l(C)?null:m,g,_,y,A,v,x,b,w,V))}}return k};t.exports=function(t,e){var i,n=t,c=function(t){if(!t)return d;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||d.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=o.default;if(void 0!==t.format){if(!s.call(o.formatters,t.format))throw new TypeError("Unknown format option provided.");i=t.format}var r,n=o.formatters[i],c=d.filter;if(("function"==typeof t.filter||l(t.filter))&&(c=t.filter),r=t.arrayFormat in a?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===t.allowDots?!0===t.encodeDotInKeys||d.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:d.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:d.charsetSentinel,commaRoundTrip:t.commaRoundTrip,delimiter:void 0===t.delimiter?d.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:d.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:d.encodeValuesOnly,filter:c,format:i,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:d.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:d.strictNullHandling}}(e);"function"==typeof c.filter?n=(0,c.filter)("",n):l(c.filter)&&(i=c.filter);var h=[];if("object"!=typeof n||null===n)return"";var p=a[c.arrayFormat],f="comma"===p&&c.commaRoundTrip;i||(i=Object.keys(n)),c.sort&&i.sort(c.sort);for(var g=r(),_=0;_<i.length;++_){var y=i[_];c.skipNulls&&null===n[y]||u(h,m(n[y],y,p,f,c.allowEmptyArrays,c.strictNullHandling,c.skipNulls,c.encodeDotInKeys,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,g))}var A=h.join(c.delimiter),v=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),A.length>0?v+A:""}},37720:(t,e,i)=>{"use strict";var r=i(74765),n=Object.prototype.hasOwnProperty,o=Array.isArray,s=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var i=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(i[r]=t[r]);return i},l=1024;t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,i){return t[i]=e[i],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],i=[],r=0;r<e.length;++r)for(var n=e[r],s=n.obj[n.prop],a=Object.keys(s),l=0;l<a.length;++l){var c=a[l],u=s[c];"object"==typeof u&&null!==u&&-1===i.indexOf(u)&&(e.push({obj:s,prop:c}),i.push(u))}return function(t){for(;t.length>1;){var e=t.pop(),i=e.obj[e.prop];if(o(i)){for(var r=[],n=0;n<i.length;++n)void 0!==i[n]&&r.push(i[n]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,i){var r=t.replace(/\+/g," ");if("iso-8859-1"===i)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(t){return r}},encode:function(t,e,i,n,o){if(0===t.length)return t;var a=t;if("symbol"==typeof t?a=Symbol.prototype.toString.call(t):"string"!=typeof t&&(a=String(t)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var c="",u=0;u<a.length;u+=l){for(var h=a.length>=l?a.slice(u,u+l):a,p=[],d=0;d<h.length;++d){var f=h.charCodeAt(d);45===f||46===f||95===f||126===f||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||o===r.RFC1738&&(40===f||41===f)?p[p.length]=h.charAt(d):f<128?p[p.length]=s[f]:f<2048?p[p.length]=s[192|f>>6]+s[128|63&f]:f<55296||f>=57344?p[p.length]=s[224|f>>12]+s[128|f>>6&63]+s[128|63&f]:(d+=1,f=65536+((1023&f)<<10|1023&h.charCodeAt(d)),p[p.length]=s[240|f>>18]+s[128|f>>12&63]+s[128|f>>6&63]+s[128|63&f])}c+=p.join("")}return c},isBuffer:function(t){return!(!t||"object"!=typeof t||!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t)))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(o(t)){for(var i=[],r=0;r<t.length;r+=1)i.push(e(t[r]));return i}return e(t)},merge:function t(e,i,r){if(!i)return e;if("object"!=typeof i){if(o(e))e.push(i);else{if(!e||"object"!=typeof e)return[e,i];(r&&(r.plainObjects||r.allowPrototypes)||!n.call(Object.prototype,i))&&(e[i]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(i);var s=e;return o(e)&&!o(i)&&(s=a(e,r)),o(e)&&o(i)?(i.forEach((function(i,o){if(n.call(e,o)){var s=e[o];s&&"object"==typeof s&&i&&"object"==typeof i?e[o]=t(s,i,r):e.push(i)}else e[o]=i})),e):Object.keys(i).reduce((function(e,o){var s=i[o];return n.call(e,o)?e[o]=t(e[o],s,r):e[o]=s,e}),s)}}},72519:(t,e,i)=>{"use strict";t.exports=n,t.exports.default=n;var r=i(10261);function n(t,e){if(!(this instanceof n))return new n(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function s(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,r,n){n||(n=m(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o,s=e;s<i;s++)o=t.children[s],l(n,t.leaf?r(o):o);return n}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function c(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function p(t){return t.maxX-t.minX+(t.maxY-t.minY)}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function f(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,i,n,o){for(var s,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=n||(s=e+Math.ceil((i-e)/n/2)*n,r(t,s,e,i,o),a.push(e,s,s,i))}n.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!f(t,e))return i;for(var n,o,s,a,l=[];e;){for(n=0,o=e.children.length;n<o;n++)s=e.children[n],f(t,a=e.leaf?r(s):s)&&(e.leaf?i.push(s):d(t,a)?this._all(s,i):l.push(s));e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!f(t,e))return!1;for(var r,n,o,s,a=[];e;){for(r=0,n=e.children.length;r<n;r++)if(o=e.children[r],f(t,s=e.leaf?i(o):o)){if(e.leaf||d(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var i,r,n,s,a=this.data,l=this.toBBox(t),c=[],u=[];a||c.length;){if(a||(a=c.pop(),r=c[c.length-1],i=u.pop(),s=!0),a.leaf&&-1!==(n=o(t,a.children,e)))return a.children.splice(n,1),c.push(a),this._condense(c),this;s||a.leaf||!d(a,l)?r?(i++,a=r.children[i],s=!1):a=null:(c.push(a),u.push(i),i=0,r=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:c,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,r){var n,o=i-e+1,a=this._maxEntries;if(o<=a)return s(n=m(t.slice(e,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(n=m([])).leaf=!1,n.height=r;var l,c,u,h,p=Math.ceil(o/a),d=p*Math.ceil(Math.sqrt(a));for(g(t,e,i,d,this.compareMinX),l=e;l<=i;l+=d)for(g(t,l,u=Math.min(l+d-1,i),p,this.compareMinY),c=l;c<=u;c+=p)h=Math.min(c+p-1,u),n.children.push(this._build(t,c,h,r-1));return s(n,this.toBBox),n},_chooseSubtree:function(t,e,i,r){for(var n,o,s,a,l,c,u,p,d,f;r.push(e),!e.leaf&&r.length-1!==i;){for(u=p=1/0,n=0,o=e.children.length;n<o;n++)l=h(s=e.children[n]),d=t,f=s,(c=(Math.max(f.maxX,d.maxX)-Math.min(f.minX,d.minX))*(Math.max(f.maxY,d.maxY)-Math.min(f.minY,d.minY))-l)<p?(p=c,u=l<u?l:u,a=s):c===p&&l<u&&(u=l,a=s);e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,n=i?t:r(t),o=[],s=this._chooseSubtree(n,this.data,e,o);for(s.children.push(t),l(s,n);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(n,o,e)},_split:function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),a=m(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,n,o,s,l,c,u,p,d,f,m,g,_,y;for(c=u=1/0,r=e;r<=i-e;r++)d=n=a(t,0,r,this.toBBox),f=o=a(t,r,i,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(d.minX,f.minX),g=Math.max(d.minY,f.minY),_=Math.min(d.maxX,f.maxX),y=Math.min(d.maxY,f.maxY),s=Math.max(0,_-m)*Math.max(0,y-g),l=h(n)+h(o),s<c?(c=s,p=r,u=l<u?l:u):s===c&&l<u&&(u=l,p=r);return p},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:c,n=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var n,o,s=this.toBBox,c=a(t,0,e,s),u=a(t,i-e,i,s),h=p(c)+p(u);for(n=e;n<i-e;n++)o=t.children[n],l(c,t.leaf?s(o):o),h+=p(c);for(n=i-e-1;n>=e;n--)o=t.children[n],l(u,t.leaf?s(o):o),h+=p(u);return h},_adjustParentBBoxes:function(t,e,i){for(var r=i;r>=0;r--)l(e[r],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():s(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},10261:function(t){t.exports=function(){"use strict";function t(i,r,n,o,s){for(;o>n;){if(o-n>600){var a=o-n+1,l=r-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(i,r,Math.max(n,Math.floor(r-l*u/a+h)),Math.min(o,Math.floor(r+(a-l)*u/a+h)),s)}var p=i[r],d=n,f=o;for(e(i,n,r),s(i[o],p)>0&&e(i,n,o);d<f;){for(e(i,d,f),d++,f--;s(i[d],p)<0;)d++;for(;s(i[f],p)>0;)f--}0===s(i[n],p)?e(i,n,f):e(i,++f,o),f<=r&&(n=f+1),r<=f&&(o=f-1)}}function e(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function i(t,e){return t<e?-1:t>e?1:0}return function(e,r,n,o,s){t(e,r,n||0,o||e.length-1,s||i)}}()},77675:(t,e,i)=>{"use strict";var r=i(43206),n=i(69675),o=Object;t.exports=r((function(){if(null==this||this!==o(this))throw new n("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t}),"get flags",!0)},71589:(t,e,i)=>{"use strict";var r=i(38452),n=i(10487),o=i(77675),s=i(15330),a=i(43984),l=n(s());r(l,{getPolyfill:s,implementation:o,shim:a}),t.exports=l},15330:(t,e,i)=>{"use strict";var r=i(77675),n=i(38452).supportsDescriptors,o=Object.getOwnPropertyDescriptor;t.exports=function(){if(n&&"gim"===/a/gim.flags){var t=o(RegExp.prototype,"flags");if(t&&"function"==typeof t.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var e="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(i,"sticky",{get:function(){e+="y"}}),"dy"===e)return t.get}}return r}},43984:(t,e,i)=>{"use strict";var r=i(38452).supportsDescriptors,n=i(15330),o=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=TypeError,l=Object.getPrototypeOf,c=/a/;t.exports=function(){if(!r||!l)throw new a("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=n(),e=l(c),i=o(e,"flags");return i&&i.get===t||s(e,"flags",{configurable:!0,enumerable:!1,get:t}),t}},53467:function(t,e){!function(t){"use strict";const e=134217729;function i(t,e,i,r,n){let o,s,a,l,c=e[0],u=r[0],h=0,p=0;u>c==u>-c?(o=c,c=e[++h]):(o=u,u=r[++p]);let d=0;if(h<t&&p<i)for(u>c==u>-c?(a=o-((s=c+o)-c),c=e[++h]):(a=o-((s=u+o)-u),u=r[++p]),o=s,0!==a&&(n[d++]=a);h<t&&p<i;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=e[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++p]),o=s,0!==a&&(n[d++]=a);for(;h<t;)a=o-((s=o+c)-(l=s-o))+(c-l),c=e[++h],o=s,0!==a&&(n[d++]=a);for(;p<i;)a=o-((s=o+u)-(l=s-o))+(u-l),u=r[++p],o=s,0!==a&&(n[d++]=a);return 0===o&&0!==d||(n[d++]=o),d}function r(t){return new Float64Array(t)}const n=r(4),o=r(8),s=r(12),a=r(16),l=r(4);t.orient2d=function(t,r,c,u,h,p){const d=(r-p)*(c-h),f=(t-h)*(u-p),m=d-f;if(0===d||0===f||d>0!=f>0)return m;const g=Math.abs(d+f);return Math.abs(m)>=33306690738754716e-32*g?m:-function(t,r,c,u,h,p,d){let f,m,g,_,y,A,v,x,b,w,S,T,C,M,E,I,L,P;const k=t-h,N=c-h,D=r-p,O=u-p;y=(E=(x=k-(v=(A=e*k)-(A-k)))*(w=O-(b=(A=e*O)-(A-O)))-((M=k*O)-v*b-x*b-v*w))-(S=E-(L=(x=D-(v=(A=e*D)-(A-D)))*(w=N-(b=(A=e*N)-(A-N)))-((I=D*N)-v*b-x*b-v*w))),n[0]=E-(S+y)+(y-L),y=(C=M-((T=M+S)-(y=T-M))+(S-y))-(S=C-I),n[1]=C-(S+y)+(y-I),y=(P=T+S)-T,n[2]=T-(P-y)+(S-y),n[3]=P;let R=function(t,e){let i=e[0];for(let t=1;t<4;t++)i+=e[t];return i}(0,n),F=22204460492503146e-32*d;if(R>=F||-R>=F)return R;if(f=t-(k+(y=t-k))+(y-h),g=c-(N+(y=c-N))+(y-h),m=r-(D+(y=r-D))+(y-p),_=u-(O+(y=u-O))+(y-p),0===f&&0===m&&0===g&&0===_)return R;if(F=11093356479670487e-47*d+33306690738754706e-32*Math.abs(R),(R+=k*_+O*f-(D*g+N*m))>=F||-R>=F)return R;y=(E=(x=f-(v=(A=e*f)-(A-f)))*(w=O-(b=(A=e*O)-(A-O)))-((M=f*O)-v*b-x*b-v*w))-(S=E-(L=(x=m-(v=(A=e*m)-(A-m)))*(w=N-(b=(A=e*N)-(A-N)))-((I=m*N)-v*b-x*b-v*w))),l[0]=E-(S+y)+(y-L),y=(C=M-((T=M+S)-(y=T-M))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(P=T+S)-T,l[2]=T-(P-y)+(S-y),l[3]=P;const z=i(4,n,4,l,o);y=(E=(x=k-(v=(A=e*k)-(A-k)))*(w=_-(b=(A=e*_)-(A-_)))-((M=k*_)-v*b-x*b-v*w))-(S=E-(L=(x=D-(v=(A=e*D)-(A-D)))*(w=g-(b=(A=e*g)-(A-g)))-((I=D*g)-v*b-x*b-v*w))),l[0]=E-(S+y)+(y-L),y=(C=M-((T=M+S)-(y=T-M))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(P=T+S)-T,l[2]=T-(P-y)+(S-y),l[3]=P;const B=i(z,o,4,l,s);y=(E=(x=f-(v=(A=e*f)-(A-f)))*(w=_-(b=(A=e*_)-(A-_)))-((M=f*_)-v*b-x*b-v*w))-(S=E-(L=(x=m-(v=(A=e*m)-(A-m)))*(w=g-(b=(A=e*g)-(A-g)))-((I=m*g)-v*b-x*b-v*w))),l[0]=E-(S+y)+(y-L),y=(C=M-((T=M+S)-(y=T-M))+(S-y))-(S=C-I),l[1]=C-(S+y)+(y-I),y=(P=T+S)-T,l[2]=T-(P-y)+(S-y),l[3]=P;const U=i(B,s,4,l,a);return a[U-1]}(t,r,c,u,h,p,g)},t.orient2dfast=function(t,e,i,r,n,o){return(e-o)*(i-n)-(t-n)*(r-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)},96897:(t,e,i)=>{"use strict";var r=i(70453),n=i(30041),o=i(30592)(),s=i(75795),a=i(69675),l=r("%Math.floor%");t.exports=function(t,e){if("function"!=typeof t)throw new a("`fn` is not a function");if("number"!=typeof e||e<0||e>4294967295||l(e)!==e)throw new a("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],r=!0,c=!0;if("length"in t&&s){var u=s(t,"length");u&&!u.configurable&&(r=!1),u&&!u.writable&&(c=!1)}return(r||c||!i)&&(o?n(t,"length",e,!0,!0):n(t,"length",e)),t}},43206:(t,e,i)=>{"use strict";var r=i(30041),n=i(30592)(),o=i(74462).functionsHaveConfigurableNames(),s=i(69675);t.exports=function(t,e){if("function"!=typeof t)throw new s("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!o||(n?r(t,"name",e,!0,!0):r(t,"name",e)),t}},56627:(t,e,i)=>{"use strict";function r(t){return!/^[nf]$/i.test(t)&&(!!/^[yt]$/i.test(t)||null)}i.d(e,{A:()=>r})},32485:(t,e,i)=>{"use strict";function r(){return this._source.cancel()}i.d(e,{A:()=>r})},34211:(t,e,i)=>{"use strict";function r(t){return new Date(+t.substring(0,4),t.substring(4,6)-1,+t.substring(6,8))}i.d(e,{A:()=>r})},97251:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(81905),n=i(32485),o=i(91387),s=i(36103);function a(t,e){return(t=(0,r.A)(t)).slice(32).then((function(i){var r=(0,s.A)(i);return t.slice(r.getUint16(8,!0)-32).then((function(i){return new l(t,e,r,(0,s.A)(i))}))}))}function l(t,e,i,r){this._source=t,this._decode=e.decode.bind(e),this._recordLength=i.getUint16(10,!0),this._fields=[];for(var n=0;13!==r.getUint8(n);n+=32){for(var o=0;o<11&&0!==r.getUint8(n+o);++o);this._fields.push({name:this._decode(new Uint8Array(r.buffer,r.byteOffset+n,o)),type:String.fromCharCode(r.getUint8(n+11)),length:r.getUint8(n+16)})}}var c=l.prototype;c.read=o.A,c.cancel=n.A},78698:(t,e,i)=>{"use strict";function r(t){return!(t=t.trim())||isNaN(t=+t)?null:t}i.d(e,{A:()=>r})},91387:(t,e,i)=>{"use strict";i.d(e,{A:()=>l});var r=i(56627),n=i(34211),o=i(78698),s=i(19514),a={B:o.A,C:s.A,D:n.A,F:o.A,L:r.A,M:o.A,N:o.A};function l(){var t=this,e=1;return t._source.slice(t._recordLength).then((function(i){return i&&26!==i[0]?{done:!1,value:t._fields.reduce((function(r,n){return r[n.name]=a[n.type](t._decode(i.subarray(e,e+=n.length))),r}),{})}:{done:!0,value:void 0}}))}},19514:(t,e,i)=>{"use strict";function r(t){return t.trim()||null}i.d(e,{A:()=>r})},48168:(t,e,i)=>{"use strict";i.d(e,{LF:()=>a});var r=i(74772),n=i(87892),o=i(30021),s=(i(97251),i(29480));function a(t,e,i){return function(t,e,i){return"string"==typeof e?(/\.dbf$/.test(e)||(e+=".dbf"),e=(0,r.A)(e,i)):e instanceof ArrayBuffer||e instanceof Uint8Array?e=(0,n.A)(e):null!=e&&(e=(0,o.A)(e)),"string"==typeof t?(/\.shp$/.test(t)||(t+=".shp"),void 0===e&&(e=(0,r.A)(t.substring(0,t.length-4)+".dbf",i).catch((function(){}))),t=(0,r.A)(t,i)):t=t instanceof ArrayBuffer||t instanceof Uint8Array?(0,n.A)(t):(0,o.A)(t),Promise.all([t,e]).then((function(t){var e=t[0],r=t[1],n="windows-1252";return i&&null!=i.encoding&&(n=i.encoding),(0,s.A)(e,r,r&&new TextDecoder(n))}))}(t,e,i).then((function(t){var e=[],i={type:"FeatureCollection",features:e,bbox:t.bbox};return t.read().then((function r(n){return n.done?i:(e.push(n.value),t.read().then(r))}))}))}i(98886)},36944:(t,e,i)=>{"use strict";function r(){}function n(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(r)}i.d(e,{A:()=>n})},29480:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(97251),n=i(98886),o=i(36944),s=i(24590);function a(t,e,i){return Promise.all([(0,n.A)(t),e&&(0,r.A)(e,i)]).then((function(t){return new l(t[0],t[1])}))}function l(t,e){this._shp=t,this._dbf=e,this.bbox=t.bbox}var c=l.prototype;c.read=s.A,c.cancel=o.A},24590:(t,e,i)=>{"use strict";function r(){var t=this;return Promise.all([t._dbf?t._dbf.read():{value:{}},t._shp.read()]).then((function(t){var e=t[0],i=t[1];return i.done?i:{done:!1,value:{type:"Feature",properties:e.value,geometry:i.value}}}))}i.d(e,{A:()=>r})},89434:(t,e,i)=>{"use strict";function r(){return this._source.cancel()}i.d(e,{A:()=>r})},17156:(t,e,i)=>{"use strict";function r(t,e){var i=new Uint8Array(t.length+e.length);return i.set(t,0),i.set(e,t.length),i}i.d(e,{A:()=>r})},98886:(t,e,i)=>{"use strict";i.d(e,{A:()=>d});var r=i(81905),n=i(36103),o=i(89434),s=i(87729),a=i(77285),l=i(31668),c=i(65308),u=i(13132),h=i(59208),p={0:a.A,1:l.A,3:u.A,5:c.A,8:s.A,11:l.A,13:u.A,15:c.A,18:s.A,21:l.A,23:u.A,25:c.A,28:s.A};function d(t){return(t=(0,r.A)(t)).slice(100).then((function(e){return new f(t,(0,n.A)(e))}))}function f(t,e){var i=e.getInt32(32,!0);if(!(i in p))throw new Error("unsupported shape type: "+i);this._source=t,this._type=i,this._index=0,this._parse=p[i],this.bbox=[e.getFloat64(36,!0),e.getFloat64(44,!0),e.getFloat64(52,!0),e.getFloat64(60,!0)]}var m=f.prototype;m.read=h.A,m.cancel=o.A},87729:(t,e,i)=>{"use strict";function r(t){var e,i=40,r=t.getInt32(36,!0),n=new Array(r);for(e=0;e<r;++e,i+=16)n[e]=[t.getFloat64(i,!0),t.getFloat64(i+8,!0)];return{type:"MultiPoint",coordinates:n}}i.d(e,{A:()=>r})},77285:(t,e,i)=>{"use strict";function r(){return null}i.d(e,{A:()=>r})},31668:(t,e,i)=>{"use strict";function r(t){return{type:"Point",coordinates:[t.getFloat64(4,!0),t.getFloat64(12,!0)]}}i.d(e,{A:()=>r})},65308:(t,e,i)=>{"use strict";function r(t){var e,i=44,r=t.getInt32(36,!0),o=t.getInt32(40,!0),s=new Array(r),a=new Array(o),l=[],c=[];for(e=0;e<r;++e,i+=4)s[e]=t.getInt32(i,!0);for(e=0;e<o;++e,i+=16)a[e]=[t.getFloat64(i,!0),t.getFloat64(i+8,!0)];return s.forEach((function(t,e){var i=a.slice(t,s[e+1]);!function(t){if((e=t.length)<4)return!1;for(var e,i=0,r=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++i<e;)r+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return r>=0}(i)?c.push(i):l.push([i])})),c.forEach((function(t){l.some((function(e){if(function(t,e){for(var i,r=-1,o=e.length;++r<o;)if(i=n(t,e[r]))return i>0;return!1}(e[0],t))return e.push(t),!0}))||l.push([t])})),1===l.length?{type:"Polygon",coordinates:l[0]}:{type:"MultiPolygon",coordinates:l}}function n(t,e){for(var i=e[0],r=e[1],n=-1,s=0,a=t.length,l=a-1;s<a;l=s++){var c=t[s],u=c[0],h=c[1],p=t[l],d=p[0],f=p[1];if(o(c,p,e))return 0;h>r!=f>r&&i<(d-u)*(r-h)/(f-h)+u&&(n=-n)}return n}function o(t,e,i){var r=i[0]-t[0],n=i[1]-t[1];if(0===r&&0===n)return!0;var o=e[0]-t[0],s=e[1]-t[1];if(0===o&&0===s)return!1;var a=(r*o+n*s)/(o*o+s*s);return!(a<0||a>1)&&(0===a||1===a||a*o===r&&a*s===n)}i.d(e,{A:()=>r})},13132:(t,e,i)=>{"use strict";function r(t){var e,i=44,r=t.getInt32(36,!0),n=t.getInt32(40,!0),o=new Array(r),s=new Array(n);for(e=0;e<r;++e,i+=4)o[e]=t.getInt32(i,!0);for(e=0;e<n;++e,i+=16)s[e]=[t.getFloat64(i,!0),t.getFloat64(i+8,!0)];return 1===r?{type:"LineString",coordinates:s}:{type:"MultiLineString",coordinates:o.map((function(t,e){return s.slice(t,o[e+1])}))}}i.d(e,{A:()=>r})},59208:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(17156),n=i(36103);function o(){var t=this;return++t._index,t._source.slice(12).then((function(e){if(null==e)return{done:!0,value:void 0};var i=(0,n.A)(e);function o(){return t._source.slice(4).then((function(a){return null==a?{done:!0,value:void 0}:(i=(0,n.A)(e=(0,r.A)(e.slice(4),a))).getInt32(0,!1)!==t._index?o():s()}))}function s(){var s=2*i.getInt32(4,!1)-4,a=i.getInt32(8,!0);return s<0||a&&a!==t._type?o():t._source.slice(s).then((function(i){return{done:!1,value:a?t._parse((0,n.A)((0,r.A)(e.slice(8),i))):null}}))}return s()}))}},36103:(t,e,i)=>{"use strict";function r(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}i.d(e,{A:()=>r})},920:(t,e,i)=>{"use strict";var r=i(70453),n=i(38075),o=i(58859),s=i(69675),a=r("%WeakMap%",!0),l=r("%Map%",!0),c=n("WeakMap.prototype.get",!0),u=n("WeakMap.prototype.set",!0),h=n("WeakMap.prototype.has",!0),p=n("Map.prototype.get",!0),d=n("Map.prototype.set",!0),f=n("Map.prototype.has",!0),m=function(t,e){for(var i,r=t;null!==(i=r.next);r=i)if(i.key===e)return r.next=i.next,i.next=t.next,t.next=i,i};t.exports=function(){var t,e,i,r={assert:function(t){if(!r.has(t))throw new s("Side channel does not contain "+o(t))},get:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return c(t,r)}else if(l){if(e)return p(e,r)}else if(i)return function(t,e){var i=m(t,e);return i&&i.value}(i,r)},has:function(r){if(a&&r&&("object"==typeof r||"function"==typeof r)){if(t)return h(t,r)}else if(l){if(e)return f(e,r)}else if(i)return function(t,e){return!!m(t,e)}(i,r);return!1},set:function(r,n){a&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new a),u(t,r,n)):l?(e||(e=new l),d(e,r,n)):(i||(i={key:{},next:null}),function(t,e,i){var r=m(t,e);r?r.value=i:t.next={key:e,next:t.next,value:i}}(i,r,n))}};return r}},64028:(t,e,i)=>{var r=i(50833);function n(e,i){var r=e.geometry,n=r.type;if("LineString"===n)r.coordinates=t.exports.simplify(r.coordinates,i);else if("Polygon"===n||"MultiLineString"===n)for(var o=0;o<r.coordinates.length;o++)r.coordinates[o]=t.exports.simplify(r.coordinates[o],i);else if("MultiPolygon"===n)for(var s=0;s<r.coordinates.length;s++)for(var a=0;a<r.coordinates[s].length;a++)r.coordinates[s][a]=t.exports.simplify(r.coordinates[s][a],i);return e}t.exports=function(t,e,i){return i||(t=JSON.parse(JSON.stringify(t))),t.features?function(t,e){for(var i=0;i<t.features.length;i++)t.features[i]=n(t.features[i],e);return t}(t,e):t.type&&"Feature"===t.type?n(t,e):new Error("FeatureCollection or individual Feature required")},t.exports.simplify=function(t,e){return r(t,e)}},50833:(t,e,i)=>{var r=i(1447),n=function(t,e){for(var i=0,o=0,s=1;s<=t.length-2;s++){var a=new r(t[0],t[t.length-1]).perpendicularDistance(t[s]);a>i&&(o=s,i=a)}if(i>e)var l=n(t.slice(0,o),e),c=n(t.slice(o,t.length),e),u=l.concat(c);else u=t.length>1?[t[0],t[t.length-1]]:[t[0]];return u};t.exports=n},1447:t=>{var e=function(t,e){this.p1=t,this.p2=e};e.prototype.rise=function(){return this.p2[1]-this.p1[1]},e.prototype.run=function(){return this.p2[0]-this.p1[0]},e.prototype.slope=function(){return this.rise()/this.run()},e.prototype.yIntercept=function(){return this.p1[1]-this.p1[0]*this.slope(this.p1,this.p2)},e.prototype.isVertical=function(){return!isFinite(this.slope())},e.prototype.isHorizontal=function(){return this.p1[1]==this.p2[1]},e.prototype._perpendicularDistanceHorizontal=function(t){return Math.abs(this.p1[1]-t[1])},e.prototype._perpendicularDistanceVertical=function(t){return Math.abs(this.p1[0]-t[0])},e.prototype._perpendicularDistanceHasSlope=function(t){var e=this.slope(),i=this.yIntercept();return Math.abs(e*t[0]-t[1]+i)/Math.sqrt(Math.pow(e,2)+1)},e.prototype.perpendicularDistance=function(t){return this.isVertical()?this._perpendicularDistanceVertical(t):this.isHorizontal()?this._perpendicularDistanceHorizontal(t):this._perpendicularDistanceHasSlope(t)},t.exports=e},96766:t=>{"use strict";t.exports={eudist:function(t,e,i){for(var r=t.length,n=0,o=0;o<r;o++){var s=(t[o]||0)-(e[o]||0);n+=s*s}return i?Math.sqrt(n):n},mandist:function(t,e,i){for(var r=t.length,n=0,o=0;o<r;o++)n+=Math.abs((t[o]||0)-(e[o]||0));return i?Math.sqrt(n):n},dist:function(t,e,i){var r=Math.abs(t-e);return i?r:r*r}}},5810:(t,e,i)=>{"use strict";var r=i(96766),n=r.eudist,o=r.dist;t.exports={kmrand:function(t,e){for(var i={},r=[],n=e<<2,o=t.length,s=t[0].length>0;r.length<e&&n-- >0;){var a=t[Math.floor(Math.random()*o)],l=s?a.join("_"):""+a;i[l]||(i[l]=!0,r.push(a))}if(r.length<e)throw new Error("Error initializating clusters");return r},kmpp:function(t,e){var i=t[0].length?n:o,r=[],s=t.length,a=t[0].length>0,l=t[Math.floor(Math.random()*s)];for(a&&l.join("_"),r.push(l);r.length<e;){for(var c=[],u=r.length,h=0,p=[],d=0;d<s;d++){for(var f=1/0,m=0;m<u;m++){var g=i(t[d],r[m]);g<=f&&(f=g)}c[d]=f}for(var _=0;_<s;_++)h+=c[_];for(var y=0;y<s;y++)p[y]={i:y,v:t[y],pr:c[y]/h,cs:0};p.sort((function(t,e){return t.pr-e.pr})),p[0].cs=p[0].pr;for(var A=1;A<s;A++)p[A].cs=p[A-1].cs+p[A].pr;for(var v=Math.random(),x=0;x<s-1&&p[x++].cs<v;);r.push(p[x-1].v)}return r}}},61756:(t,e,i)=>{"use strict";var r=i(96766),n=i(5810),o=r.eudist,s=(r.mandist,r.dist,n.kmrand),a=n.kmpp;function l(t,e,i){i=i||[];for(var r=0;r<t;r++)i[r]=e;return i}t.exports=function(t,e,i,r){var n=[],c=[],u=[],h=[],p=!1,d=r||1e4,f=t.length,m=t[0].length,g=m>0,_=[];if(i)n="kmrand"==i?s(t,e):"kmpp"==i?a(t,e):i;else for(var y={};n.length<e;){var A=Math.floor(Math.random()*f);y[A]||(y[A]=!0,n.push(t[A]))}do{l(e,0,_);for(var v=0;v<f;v++){for(var x=1/0,b=0,w=0;w<e;w++)(h=g?o(t[v],n[w]):Math.abs(t[v]-n[w]))<=x&&(x=h,b=w);u[v]=b,_[b]++}for(var S=[],T=(c=[],0);T<e;T++)S[T]=g?l(m,0,S[T]):0,c[T]=n[T];if(g){for(var C=0;C<e;C++)n[C]=[];for(var M=0;M<f;M++)for(var E=S[u[M]],I=t[M],L=0;L<m;L++)E[L]+=I[L];p=!0;for(var P=0;P<e;P++){for(var k=n[P],N=S[P],D=c[P],O=_[P],R=0;R<m;R++)k[R]=N[R]/O||0;if(p)for(var F=0;F<m;F++)if(D[F]!=k[F]){p=!1;break}}}else{for(var z=0;z<f;z++)S[u[z]]+=t[z];for(var B=0;B<e;B++)n[B]=S[B]/_[B]||0;p=!0;for(var U=0;U<e;U++)if(c[U]!=n[U]){p=!1;break}}p=p||--d<=0}while(!p);return{it:1e4-d,k:e,idxs:u,centroids:n}}},71783:(t,e,i)=>{"use strict";function r(){return this._source.cancel()}i.d(e,{A:()=>r})},43165:(t,e,i)=>{"use strict";function r(t,e){if(!t.length)return e;if(!e.length)return t;var i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}i.d(e,{A:()=>r})},26324:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});const r=new Uint8Array(0)},81905:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(26324),n=i(71783),o=i(18765),s=i(31359);function a(t){return"function"==typeof t.slice?t:new l("function"==typeof t.read?t:t.getReader())}function l(t){this._source=t,this._array=r.A,this._index=0}l.prototype.read=o.A,l.prototype.slice=s.A,l.prototype.cancel=n.A},18765:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(43165),n=i(26324);function o(){var t=this,e=t._array.subarray(t._index);return t._source.read().then((function(i){return t._array=n.A,t._index=0,i.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:(0,r.A)(e,i.value)}}))}},31359:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(26324);function n(t){if((t|=0)<0)throw new Error("invalid length");var e=this,i=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var n=new Uint8Array(t);return n.set(this._array.subarray(this._index)),function o(){return e._source.read().then((function(s){return s.done?(e._array=r.A,e._index=0,i>0?n.subarray(0,i):null):i+s.value.length>=t?(e._array=s.value,e._index=t-i,n.set(s.value.subarray(0,t-i),i),n):(n.set(s.value,i),i+=s.value.length,o())}))}()}},30021:(t,e,i)=>{"use strict";function r(t){return"function"==typeof t.read?t:t.getReader()}i.d(e,{A:()=>r})},38170:(t,e,i)=>{"use strict";e.__esModule=!0;var r=i(9755),n=i(11781),o=FormData;function s(t,e,i){var o,s=new XMLHttpRequest;if("string"!=typeof t)throw new TypeError("The method must be a string.");if(e&&"object"==typeof e&&(e=e.href),"string"!=typeof e)throw new TypeError("The URL/path must be a string.");if(null==i&&(i={}),"object"!=typeof i)throw new TypeError("Options must be an object (or null).");t=t.toUpperCase(),i.headers=i.headers||{};var a=!(!(o=/^([\w-]+:)?\/\/([^\/]+)/.exec(e))||o[2]==location.host);for(var l in a||(i.headers["X-Requested-With"]="XMLHttpRequest"),i.qs&&(e=r.default(e,i.qs)),i.json&&(i.body=JSON.stringify(i.json),i.headers["content-type"]="application/json"),i.form&&(i.body=i.form),s.open(t,e,!1),i.headers)s.setRequestHeader(l.toLowerCase(),""+i.headers[l]);s.send(i.body?i.body:null);var c={};return s.getAllResponseHeaders().split("\r\n").forEach((function(t){var e=t.split(":");e.length>1&&(c[e[0].toLowerCase()]=e.slice(1).join(":").trim())})),new n(s.status,c,s.responseText,e)}e.FormData=o,e.default=s,t.exports=s,t.exports.default=s,t.exports.FormData=o},43238:(t,e,i)=>{"use strict";function r(t){return t?"utf8"===t?this.then(o):this.then(function(t){return function(e){return e.getBody(t)}}(t)):this.then(n)}function n(t){return t.getBody()}function o(t){return t.getBody("utf8")}e.__esModule=!0,i(10918),e.default=function(t){return t.getBody=r,t},e.ResponsePromise=void 0},46614:function(t,e,i){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t};e.__esModule=!0;var n=i(11781),o=i(10918),s=i(43238);e.ResponsePromise=s.ResponsePromise;var a=i(9755);function l(t,e,i){return s.default(new o((function(o,s){var c=new XMLHttpRequest;if("string"!=typeof t)throw new TypeError("The method must be a string.");if("string"!=typeof e)throw new TypeError("The URL/path must be a string.");if(null==i&&(i={}),"object"!=typeof i)throw new TypeError("Options must be an object (or null).");if(t=t.toUpperCase(),i.retry&&"GET"===t)return function i(r,n){l(t,e,{qs:n.qs,headers:n.headers,timeout:n.timeout}).nodeify((function(t,e){var a=!!(t||e.statusCode>=400);if("function"==typeof n.retry&&(a=n.retry(t,e,r+1)),r>=(n.maxRetries||5)&&(a=!1),a){var l=n.retryDelay;"function"==typeof n.retryDelay&&(l=n.retryDelay(t,e,r+1)),l=l||200,setTimeout((function(){i(r+1,n)}),l)}else t?s(t):o(e)}))}(0,i);var u,h=i.headers||{};if(!(!(u=/^([\w-]+:)?\/\/([^\/]+)/.exec(e))||u[2]==location.host)||(h=r({},h,{"X-Requested-With":"XMLHttpRequest"})),i.qs&&(e=a.default(e,i.qs)),i.json&&(i.body=JSON.stringify(i.json),h=r({},h,{"Content-Type":"application/json"})),i.form&&(i.body=i.form),i.timeout){c.timeout=i.timeout;var p=Date.now();c.ontimeout=function(){var t=Date.now()-p,e=new Error("Request timed out after "+t+"ms");e.timeout=!0,e.duration=t,s(e)}}for(var d in c.onreadystatechange=function(){if(4===c.readyState){var t={};c.getAllResponseHeaders().split("\r\n").forEach((function(e){var i=e.split(":");i.length>1&&(t[i[0].toLowerCase()]=i.slice(1).join(":").trim())}));var i=new n(c.status,t,c.responseText,e);o(i)}},c.open(t,e,!0),h)c.setRequestHeader(d,h[d]);c.send(i.body?i.body:null)})))}var c=FormData;e.FormData=c,e.default=l,t.exports=l,t.exports.default=l,t.exports.FormData=c},9755:(t,e,i)=>{"use strict";e.__esModule=!0;var r=i(55373);e.default=function(t,e){var i=t.split("?"),n=i[0],o=i[1],s=(o||"").split("#")[0],a=o&&o.split("#").length>1?"#"+o.split("#")[1]:"",l=r.parse(s);for(var c in e)l[c]=e[c];return""!==(s=r.stringify(l))&&(s="?"+s),n+s+a}},54742:(t,e,i)=>{"use strict";function r(t){this.values=[].concat(t||[])}i.d(e,{A:()=>n}),r.prototype.query=function(t){var e=this.getIndex(t);return this.values[e]},r.prototype.getIndex=function(t){this.dirty&&this.sort();for(var e,i,r=0,n=this.values.length-1;r<=n;)if(e=(r+n)/2|0,+(i=this.values[Math.round(e)]).value<+t)r=e+1;else{if(!(+i.value>+t))return e;n=e-1}return Math.abs(~n)},r.prototype.between=function(t,e){var i=this.getIndex(t),r=this.getIndex(e);if(0===i&&0===r)return[];for(;this.values[i-1]&&this.values[i-1].value===t;)i--;for(;this.values[r+1]&&this.values[r+1].value===e;)r++;return this.values[r]&&this.values[r].value===e&&this.values[r+1]&&r++,this.values.slice(i,r)},r.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this},r.prototype.bulkAdd=function(t,e){return this.values=this.values.concat([].concat(t||[])),e?this.sort():this.dirty=!0,this},r.prototype.sort=function(){return this.values.sort((function(t,e){return+e.value-+t.value})).reverse(),this.dirty=!1,this};const n=r},44262:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>r});class r{constructor(t=[],e=n){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&i(e[s],o)<0&&(r=s,o=e[s]),i(o,n)>=0)break;e[t]=o,t=r}e[t]=n}}function n(t,e){return t<e?-1:t>e?1:0}},63407:(t,e,i)=>{"use strict";i(26317)},72856:(t,e,i)=>{"use strict";i(31082)},15900:(t,e,i)=>{"use strict";i(20352)},31105:(t,e,i)=>{"use strict";i(26317)},20352:()=>{"use strict";var t=new ArrayBuffer(16);new Float64Array(t),new Uint32Array(t)},88184:(t,e,i)=>{"use strict";i(4531)},31082:(t,e,i)=>{"use strict";i(20352)},26317:(t,e,i)=>{"use strict";Object.prototype.hasOwnProperty},39522:(t,e,i)=>{"use strict";i(26317)},4531:(t,e,i)=>{"use strict";i(63407),i(72856),i(15900),i(31105),i(26317),i(39522)},50039:function(t,e){!function(t){"use strict";function e(){}function i(t){this.message=t||""}function r(t){this.message=t||""}function n(t){this.message=t||""}function o(){}function s(t){return null===t?Dt:t.color}function a(t){return null===t?null:t.parent}function l(t,e){null!==t&&(t.color=e)}function c(t){return null===t?null:t.left}function u(t){return null===t?null:t.right}function h(){this.root_=null,this.size_=0}function p(){}function d(){this.array_=[],arguments[0]instanceof vt&&this.addAll(arguments[0])}function f(){}function m(t){this.message=t||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),i=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(i+r,0):Math.min(r,i);var n=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(n=n<0?Math.max(i+arguments[2],0):Math.min(n,i);r<n;)e[r]=t,++r;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var _=function(){};_.prototype.interfaces_=function(){return[]},_.prototype.getClass=function(){return _},_.prototype.equalsWithTolerance=function(t,e,i){return Math.abs(t-e)<=i};var y=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),A=function(){},v={MAX_VALUE:{configurable:!0}};A.isNaN=function(t){return Number.isNaN(t)},A.doubleToLongBits=function(t){return t},A.longBitsToDouble=function(t){return t},A.isInfinite=function(t){return!Number.isFinite(t)},v.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(A,v);var x=function(){},b=function(){},w=function(){},S=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},T={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};S.prototype.setOrdinate=function(t,e){switch(t){case S.X:this.x=e;break;case S.Y:this.y=e;break;case S.Z:this.z=e;break;default:throw new y("Invalid ordinate index: "+t)}},S.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!_.equalsWithTolerance(this.x,e.x,i)&&!!_.equalsWithTolerance(this.y,e.y,i)}},S.prototype.getOrdinate=function(t){switch(t){case S.X:return this.x;case S.Y:return this.y;case S.Z:return this.z}throw new y("Invalid ordinate index: "+t)},S.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||A.isNaN(this.z))&&A.isNaN(t.z)},S.prototype.equals=function(t){return t instanceof S&&this.equals2D(t)},S.prototype.equalInZ=function(t,e){return _.equalsWithTolerance(this.z,t.z,e)},S.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},S.prototype.clone=function(){},S.prototype.copy=function(){return new S(this)},S.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},S.prototype.distance3D=function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+i*i+r*r)},S.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},S.prototype.hashCode=function(){var t=17;return 37*(t=37*t+S.hashCode(this.x))+S.hashCode(this.y)},S.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},S.prototype.interfaces_=function(){return[x,b,e]},S.prototype.getClass=function(){return S},S.hashCode=function(){if(1===arguments.length)return A.doubleToLongBits(arguments[0]),Math.trunc(0)},T.DimensionalComparator.get=function(){return C},T.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},T.NULL_ORDINATE.get=function(){return A.NaN},T.X.get=function(){return 0},T.Y.get=function(){return 1},T.Z.get=function(){return 2},Object.defineProperties(S,T);var C=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new y("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};C.prototype.compare=function(t,e){var i=t,r=e,n=C.compare(i.x,r.x);if(0!==n)return n;var o=C.compare(i.y,r.y);return 0!==o?o:this._dimensionsToTest<=2?0:C.compare(i.z,r.z)},C.prototype.interfaces_=function(){return[w]},C.prototype.getClass=function(){return C},C.compare=function(t,e){return t<e?-1:t>e?1:A.isNaN(t)?A.isNaN(e)?0:-1:A.isNaN(e)?1:0};var M=function(){};M.prototype.create=function(){},M.prototype.interfaces_=function(){return[]},M.prototype.getClass=function(){return M};var E=function(){},I={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};E.prototype.interfaces_=function(){return[]},E.prototype.getClass=function(){return E},E.toLocationSymbol=function(t){switch(t){case E.EXTERIOR:return"e";case E.BOUNDARY:return"b";case E.INTERIOR:return"i";case E.NONE:return"-"}throw new y("Unknown location value: "+t)},I.INTERIOR.get=function(){return 0},I.BOUNDARY.get=function(){return 1},I.EXTERIOR.get=function(){return 2},I.NONE.get=function(){return-1},Object.defineProperties(E,I);var L=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},P=function(){},k={LOG_10:{configurable:!0}};P.prototype.interfaces_=function(){return[]},P.prototype.getClass=function(){return P},P.log10=function(t){var e=Math.log(t);return A.isInfinite(e)||A.isNaN(e)?e:e/P.LOG_10},P.min=function(t,e,i,r){var n=t;return e<n&&(n=e),i<n&&(n=i),r<n&&(n=r),n},P.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],n=arguments[1],o=arguments[2];return r<n?n:r>o?o:r}},P.wrap=function(t,e){return t<0?e- -t%e:t%e},P.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[0];return t>i&&(i=t),e>i&&(i=e),i}if(4===arguments.length){var r=arguments[1],n=arguments[2],o=arguments[3],s=arguments[0];return r>s&&(s=r),n>s&&(s=n),o>s&&(s=o),s}},P.average=function(t,e){return(t+e)/2},k.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(P,k);var N=function(t){this.str=t};N.prototype.append=function(t){this.str+=t},N.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},N.prototype.toString=function(t){return this.str};var D=function(t){this.value=t};D.prototype.intValue=function(){return this.value},D.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},D.isNaN=function(t){return Number.isNaN(t)};var O=function(){};O.isWhitespace=function(t){return t<=32&&t>=0||127===t},O.toUpperCase=function(t){return t.toUpperCase()};var R=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}else"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0]));else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r,n)}},F={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};R.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},R.prototype.extractSignificantDigits=function(t,e){var i=this.abs(),r=R.magnitude(i._hi),n=R.TEN.pow(r);(i=i.divide(n)).gt(R.TEN)?(i=i.divide(R.TEN),r+=1):i.lt(R.ONE)&&(i=i.multiply(R.TEN),r-=1);for(var o=r+1,s=new N,a=R.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){t&&l===o&&s.append(".");var c=Math.trunc(i._hi);if(c<0)break;var u=!1,h=0;c>9?(u=!0,h="9"):h="0"+c,s.append(h),i=i.subtract(R.valueOf(c)).multiply(R.TEN),u&&i.selfAdd(R.TEN);var p=!0,d=R.magnitude(i._hi);if(d<0&&Math.abs(d)>=a-l&&(p=!1),!p)break}return e[0]=r,s.toString()},R.prototype.sqr=function(){return this.multiply(this)},R.prototype.doubleValue=function(){return this._hi+this._lo},R.prototype.subtract=function(){if(arguments[0]instanceof R){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},R.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},R.prototype.isZero=function(){return 0===this._hi&&0===this._lo},R.prototype.selfSubtract=function(){if(arguments[0]instanceof R){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},R.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},R.prototype.min=function(t){return this.le(t)?this:t},R.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof R){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var i,r,n,o,s=arguments[0],a=arguments[1],l=null,c=null,u=null,h=null;return n=this._hi/s,h=(l=(u=R.SPLIT*n)-(l=u-n))*(c=(h=R.SPLIT*s)-(c=h-s))-(o=n*s)+l*(r=s-c)+(i=n-l)*c+i*r,h=n+(u=(this._hi-o-h+this._lo-n*a)/s),this._hi=h,this._lo=n-h+u,this}},R.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},R.prototype.divide=function(){if(arguments[0]instanceof R){var t,e,i,r,n=arguments[0],o=null,s=null,a=null,l=null;return t=(i=this._hi/n._hi)-(o=(a=R.SPLIT*i)-(o=a-i)),l=o*(s=(l=R.SPLIT*n._hi)-(s=l-n._hi))-(r=i*n._hi)+o*(e=n._hi-s)+t*s+t*e,a=(this._hi-r-l+this._lo-i*n._lo)/n._hi,new R(l=i+a,i-l+a)}if("number"==typeof arguments[0]){var c=arguments[0];return A.isNaN(c)?R.createNaN():R.copy(this).selfDivide(c,0)}},R.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},R.prototype.pow=function(t){if(0===t)return R.valueOf(1);var e=new R(this),i=R.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2==1&&i.selfMultiply(e),(r/=2)>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i},R.prototype.ceil=function(){if(this.isNaN())return R.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new R(t,e)},R.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},R.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},R.prototype.setValue=function(){if(arguments[0]instanceof R){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},R.prototype.max=function(t){return this.ge(t)?this:t},R.prototype.sqrt=function(){if(this.isZero())return R.valueOf(0);if(this.isNegative())return R.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,i=R.valueOf(e),r=this.subtract(i.sqr())._hi*(.5*t);return i.add(r)},R.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof R){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e,i,r,n,o,s=arguments[0],a=null;return a=(r=this._hi+s)-(n=r-this._hi),i=(o=(a=s-n+(this._hi-a))+this._lo)+(r-(e=r+o)),this._hi=e+i,this._lo=i+(e-this._hi),this}}else if(2===arguments.length){var l,c,u,h,p=arguments[0],d=arguments[1],f=null,m=null,g=null;u=this._hi+p,c=this._lo+d,m=u-(g=u-this._hi),f=c-(h=c-this._lo);var _=(l=u+(g=(m=p-g+(this._hi-m))+c))+(g=(f=d-h+(this._lo-f))+(g+(u-l))),y=g+(l-_);return this._hi=_,this._lo=y,this}},R.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof R){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var i,r,n=arguments[0],o=arguments[1],s=null,a=null,l=null,c=null;s=(l=R.SPLIT*this._hi)-this._hi,c=R.SPLIT*n,s=l-s,i=this._hi-s,a=c-n;var u=(l=this._hi*n)+(c=s*(a=c-a)-l+s*(r=n-a)+i*a+i*r+(this._hi*o+this._lo*n)),h=c+(s=l-u);return this._hi=u,this._lo=h,this}},R.prototype.selfSqr=function(){return this.selfMultiply(this)},R.prototype.floor=function(){if(this.isNaN())return R.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new R(t,e)},R.prototype.negate=function(){return this.isNaN()?this:new R(-this._hi,-this._lo)},R.prototype.clone=function(){},R.prototype.multiply=function(){if(arguments[0]instanceof R){var t=arguments[0];return t.isNaN()?R.createNaN():R.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return A.isNaN(e)?R.createNaN():R.copy(this).selfMultiply(e,0)}},R.prototype.isNaN=function(){return A.isNaN(this._hi)},R.prototype.intValue=function(){return Math.trunc(this._hi)},R.prototype.toString=function(){var t=R.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},R.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),r=e[0]+1,n=i;if("."===i.charAt(0))n="0"+i;else if(r<0)n="0."+R.stringOfChar("0",-r)+i;else if(-1===i.indexOf(".")){var o=r-i.length;n=i+R.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+n:n},R.prototype.reciprocal=function(){var t,e,i,r,n=null,o=null,s=null,a=null;t=(i=1/this._hi)-(n=(s=R.SPLIT*i)-(n=s-i)),o=(a=R.SPLIT*this._hi)-this._hi;var l=i+(s=(1-(r=i*this._hi)-(a=n*(o=a-o)-r+n*(e=this._hi-o)+t*o+t*e)-i*this._lo)/this._hi);return new R(l,i-l+s)},R.prototype.toSciNotation=function(){if(this.isZero())return R.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),r=R.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var n="";i.length>1&&(n=i.substring(1));var o=i.charAt(0)+"."+n;return this.isNegative()?"-"+o+r:o+r},R.prototype.abs=function(){return this.isNaN()?R.NaN:this.isNegative()?this.negate():new R(this)},R.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},R.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},R.prototype.add=function(){if(arguments[0]instanceof R){var t=arguments[0];return R.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return R.copy(this).selfAdd(e)}},R.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof R){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._hi=i,this._lo=r}},R.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},R.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},R.prototype.trunc=function(){return this.isNaN()?R.NaN:this.isPositive()?this.floor():this.ceil()},R.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},R.prototype.interfaces_=function(){return[e,x,b]},R.prototype.getClass=function(){return R},R.sqr=function(t){return R.valueOf(t).selfMultiply(t)},R.valueOf=function(){return"string"==typeof arguments[0]?R.parse(arguments[0]):"number"==typeof arguments[0]?new R(arguments[0]):void 0},R.sqrt=function(t){return R.valueOf(t).sqrt()},R.parse=function(t){for(var e=0,i=t.length;O.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<i){var n=t.charAt(e);"-"!==n&&"+"!==n||(e++,"-"===n&&(r=!0))}for(var o=new R,s=0,a=0,l=0;!(e>=i);){var c=t.charAt(e);if(e++,O.isDigit(c)){var u=c-"0";o.selfMultiply(R.TEN),o.selfAdd(u),s++}else{if("."!==c){if("e"===c||"E"===c){var h=t.substring(e);try{l=D.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}a=s}}var p=o,d=s-a-l;if(0===d)p=o;else if(d>0){var f=R.TEN.pow(d);p=o.divide(f)}else if(d<0){var m=R.TEN.pow(-d);p=o.multiply(m)}return r?p.negate():p},R.createNaN=function(){return new R(A.NaN,A.NaN)},R.copy=function(t){return new R(t)},R.magnitude=function(t){var e=Math.abs(t),i=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(i));return 10*Math.pow(10,r)<=e&&(r+=1),r},R.stringOfChar=function(t,e){for(var i=new N,r=0;r<e;r++)i.append(t);return i.toString()},F.PI.get=function(){return new R(3.141592653589793,12246467991473532e-32)},F.TWO_PI.get=function(){return new R(6.283185307179586,24492935982947064e-32)},F.PI_2.get=function(){return new R(1.5707963267948966,6123233995736766e-32)},F.E.get=function(){return new R(2.718281828459045,14456468917292502e-32)},F.NaN.get=function(){return new R(A.NaN,A.NaN)},F.EPS.get=function(){return 123259516440783e-46},F.SPLIT.get=function(){return 134217729},F.MAX_PRINT_DIGITS.get=function(){return 32},F.TEN.get=function(){return R.valueOf(10)},F.ONE.get=function(){return R.valueOf(1)},F.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},F.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(R,F);var z=function(){},B={DP_SAFE_EPSILON:{configurable:!0}};z.prototype.interfaces_=function(){return[]},z.prototype.getClass=function(){return z},z.orientationIndex=function(t,e,i){var r=z.orientationIndexFilter(t,e,i);if(r<=1)return r;var n=R.valueOf(e.x).selfAdd(-t.x),o=R.valueOf(e.y).selfAdd(-t.y),s=R.valueOf(i.x).selfAdd(-e.x),a=R.valueOf(i.y).selfAdd(-e.y);return n.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},z.signOfDet2x2=function(t,e,i,r){return t.multiply(r).selfSubtract(e.multiply(i)).signum()},z.intersection=function(t,e,i,r){var n=R.valueOf(r.y).selfSubtract(i.y).selfMultiply(R.valueOf(e.x).selfSubtract(t.x)),o=R.valueOf(r.x).selfSubtract(i.x).selfMultiply(R.valueOf(e.y).selfSubtract(t.y)),s=n.subtract(o),a=R.valueOf(r.x).selfSubtract(i.x).selfMultiply(R.valueOf(t.y).selfSubtract(i.y)),l=R.valueOf(r.y).selfSubtract(i.y).selfMultiply(R.valueOf(t.x).selfSubtract(i.x)),c=a.subtract(l).selfDivide(s).doubleValue(),u=R.valueOf(t.x).selfAdd(R.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),h=R.valueOf(e.x).selfSubtract(t.x).selfMultiply(R.valueOf(t.y).selfSubtract(i.y)),p=R.valueOf(e.y).selfSubtract(t.y).selfMultiply(R.valueOf(t.x).selfSubtract(i.x)),d=h.subtract(p).selfDivide(s).doubleValue(),f=R.valueOf(i.y).selfAdd(R.valueOf(r.y).selfSubtract(i.y).selfMultiply(d)).doubleValue();return new S(u,f)},z.orientationIndexFilter=function(t,e,i){var r=null,n=(t.x-i.x)*(e.y-i.y),o=(t.y-i.y)*(e.x-i.x),s=n-o;if(n>0){if(o<=0)return z.signum(s);r=n+o}else{if(!(n<0))return z.signum(s);if(o>=0)return z.signum(s);r=-n-o}var a=z.DP_SAFE_EPSILON*r;return s>=a||-s>=a?z.signum(s):2},z.signum=function(t){return t>0?1:t<0?-1:0},B.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(z,B);var U=function(){},V={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};V.X.get=function(){return 0},V.Y.get=function(){return 1},V.Z.get=function(){return 2},V.M.get=function(){return 3},U.prototype.setOrdinate=function(t,e,i){},U.prototype.size=function(){},U.prototype.getOrdinate=function(t,e){},U.prototype.getCoordinate=function(){},U.prototype.getCoordinateCopy=function(t){},U.prototype.getDimension=function(){},U.prototype.getX=function(t){},U.prototype.clone=function(){},U.prototype.expandEnvelope=function(t){},U.prototype.copy=function(){},U.prototype.getY=function(t){},U.prototype.toCoordinateArray=function(){},U.prototype.interfaces_=function(){return[b]},U.prototype.getClass=function(){return U},Object.defineProperties(U,V);var j=function(){},G=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(j),Z=function(){};Z.arraycopy=function(t,e,i,r,n){for(var o=0,s=e;s<e+n;s++)i[r+o]=t[s],o++},Z.getProperty=function(t){return{"line.separator":"\n"}[t]};var q=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.x=i,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var n=arguments[0],o=arguments[1];this.x=n.y*o.w-o.y*n.w,this.y=o.x*n.w-n.x*o.w,this.w=n.x*o.y-o.x*n.y}else if(arguments[0]instanceof S&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3],m=h.y-p.y,g=p.x-h.x,_=h.x*p.y-p.x*h.y,y=d.y-f.y,A=f.x-d.x,v=d.x*f.y-f.x*d.y;this.x=g*v-A*_,this.y=y*_-m*v,this.w=m*A-y*g}};q.prototype.getY=function(){var t=this.y/this.w;if(A.isNaN(t)||A.isInfinite(t))throw new G;return t},q.prototype.getX=function(){var t=this.x/this.w;if(A.isNaN(t)||A.isInfinite(t))throw new G;return t},q.prototype.getCoordinate=function(){var t=new S;return t.x=this.getX(),t.y=this.getY(),t},q.prototype.interfaces_=function(){return[]},q.prototype.getClass=function(){return q},q.intersection=function(t,e,i,r){var n=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=i.y-r.y,l=r.x-i.x,c=i.x*r.y-r.x*i.y,u=n*l-a*o,h=(o*c-l*s)/u,p=(a*s-n*c)/u;if(A.isNaN(h)||A.isInfinite(h)||A.isNaN(p)||A.isInfinite(p))throw new G;return new S(h,p)};var W=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof S){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}},H={serialVersionUID:{configurable:!0}};W.prototype.getArea=function(){return this.getWidth()*this.getHeight()},W.prototype.equals=function(t){if(!(t instanceof W))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},W.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new W;var e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,n=this._maxy<t._maxy?this._maxy:t._maxy;return new W(e,r,i,n)},W.prototype.isNull=function(){return this._maxx<this._minx},W.prototype.getMaxX=function(){return this._maxx},W.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof W){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&i>=this._minx&&i<=this._maxx&&r>=this._miny&&r<=this._maxy}},W.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof W){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof S){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||r>this._maxy||r<this._miny)}},W.prototype.getMinY=function(){return this._miny},W.prototype.getMinX=function(){return this._minx},W.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=r,this._maxy=r):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}},W.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},W.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},W.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},W.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},W.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},W.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},W.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},W.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},W.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},W.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof W){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof S){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.covers(i,r)}},W.prototype.centre=function(){return this.isNull()?null:new S((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},W.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];n<o?(this._minx=n,this._maxx=o):(this._minx=o,this._maxx=n),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},W.prototype.getMaxY=function(){return this._maxy},W.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),0===e?i:0===i?e:Math.sqrt(e*e+i*i)},W.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+S.hashCode(this._minx))+S.hashCode(this._maxx))+S.hashCode(this._miny))+S.hashCode(this._maxy)},W.prototype.interfaces_=function(){return[x,e]},W.prototype.getClass=function(){return W},W.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),c=Math.min(r.x,n.x),u=Math.max(r.x,n.x);return!(c>l||u<a||(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),c=Math.min(r.y,n.y),u=Math.max(r.y,n.y),c>l||u<a))}},H.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(W,H);var J={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},K=function(t){this.geometryFactory=t||new _e};K.prototype.read=function(t){var e,i,r;t=t.replace(/[\n\r]/g," ");var n=J.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((n=J.emptyTypeStr.exec(t))[2]=void 0),n&&(i=n[1].toLowerCase(),r=n[2],Y[i]&&(e=Y[i].apply(this,[r]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},K.prototype.write=function(t){return this.extractGeometry(t)},K.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!$[e])return null;var i=e.toUpperCase();return t.isEmpty()?i+" EMPTY":i+"("+$[e].apply(this,[t])+")"};var $={coordinate:function(t){return t.x+" "+t.y},point:function(t){return $.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],i=0,r=t._geometries.length;i<r;++i)e.push("("+$.point.apply(this,[t._geometries[i]])+")");return e.join(",")},linestring:function(t){for(var e=[],i=0,r=t._points._coordinates.length;i<r;++i)e.push($.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},linearring:function(t){for(var e=[],i=0,r=t._points._coordinates.length;i<r;++i)e.push($.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},multilinestring:function(t){for(var e=[],i=0,r=t._geometries.length;i<r;++i)e.push("("+$.linestring.apply(this,[t._geometries[i]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+$.linestring.apply(this,[t._shell])+")");for(var i=0,r=t._holes.length;i<r;++i)e.push("("+$.linestring.apply(this,[t._holes[i]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],i=0,r=t._geometries.length;i<r;++i)e.push("("+$.polygon.apply(this,[t._geometries[i]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],i=0,r=t._geometries.length;i<r;++i)e.push(this.extractGeometry(t._geometries[i]));return e.join(",")}},Y={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(J.spaces);return this.geometryFactory.createPoint(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,i=t.trim().split(","),r=[],n=0,o=i.length;n<o;++n)e=i[n].replace(J.trimParens,"$1"),r.push(Y.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(r)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,i=t.trim().split(","),r=[],n=0,o=i.length;n<o;++n)e=i[n].trim().split(J.spaces),r.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,i=t.trim().split(","),r=[],n=0,o=i.length;n<o;++n)e=i[n].trim().split(J.spaces),r.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,i=t.trim().split(J.parenComma),r=[],n=0,o=i.length;n<o;++n)e=i[n].replace(J.trimParens,"$1"),r.push(Y.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(r)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,i,r,n,o=t.trim().split(J.parenComma),s=[],a=0,l=o.length;a<l;++a)e=o[a].replace(J.trimParens,"$1"),i=Y.linestring.apply(this,[e]),r=this.geometryFactory.createLinearRing(i._points),0===a?n=r:s.push(r);return this.geometryFactory.createPolygon(n,s)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,i=t.trim().split(J.doubleParenComma),r=[],n=0,o=i.length;n<o;++n)e=i[n].replace(J.trimParens,"$1"),r.push(Y.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],r=0,n=e.length;r<n;++r)i.push(this.read(e[r]));return this.geometryFactory.createGeometryCollection(i)}},X=function(t){this.parser=new K(t)};X.prototype.write=function(t){return this.parser.write(t)},X.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Q=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Q),et=function(){};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.shouldNeverReachHere=function(){if(0===arguments.length)et.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new tt("Should never reach here"+(null!==t?": "+t:""))}},et.isTrue=function(){var t;if(1===arguments.length)et.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new tt:new tt(t)},et.equals=function(){var t,e,i;if(2===arguments.length)et.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(t=arguments[0],i=arguments[2],!(e=arguments[1]).equals(t)))throw new tt("Expected "+t+" but encountered "+e+(null!==i?": "+i:""))};var it=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new S,this._intPt[1]=new S,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},rt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};it.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},it.prototype.getTopologySummary=function(){var t=new N;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},it.prototype.computeIntersection=function(t,e,i,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,i,r)},it.prototype.getIntersectionNum=function(){return this._result},it.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},it.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},it.prototype.setPrecisionModel=function(t){this._precisionModel=t},it.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},it.prototype.getIntersection=function(t){return this._intPt[t]},it.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},it.prototype.hasIntersection=function(){return this._result!==it.NO_INTERSECTION},it.prototype.getEdgeDistance=function(t,e){return it.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},it.prototype.isCollinear=function(){return this._result===it.COLLINEAR_INTERSECTION},it.prototype.toString=function(){return X.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+X.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},it.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},it.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},it.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},it.prototype.interfaces_=function(){return[]},it.prototype.getClass=function(){return it},it.computeEdgeDistance=function(t,e,i){var r=Math.abs(i.x-e.x),n=Math.abs(i.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(i))o=r>n?r:n;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=r>n?s:a)||t.equals(e)||(o=Math.max(s,a))}return et.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},it.nonRobustComputeEdgeDistance=function(t,e,i){var r=t.x-e.x,n=t.y-e.y,o=Math.sqrt(r*r+n*n);return et.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},rt.DONT_INTERSECT.get=function(){return 0},rt.DO_INTERSECT.get=function(){return 1},rt.COLLINEAR.get=function(){return 2},rt.NO_INTERSECTION.get=function(){return 0},rt.POINT_INTERSECTION.get=function(){return 1},rt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(it,rt);var nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new W(this._inputLines[0][0],this._inputLines[0][1]),i=new W(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],i=arguments[1],r=arguments[2];if(this._isProper=!1,W.intersects(i,r,e)&&0===at.orientationIndex(i,r,e)&&0===at.orientationIndex(r,i,e))return this._isProper=!0,(e.equals(i)||e.equals(r))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,i,r,n){n.x=this.smallestInAbsValue(t.x,e.x,i.x,r.x),n.y=this.smallestInAbsValue(t.y,e.y,i.y,r.y),t.x-=n.x,t.y-=n.y,e.x-=n.x,e.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},e.prototype.safeHCoordinateIntersection=function(t,i,r,n){var o=null;try{o=q.intersection(t,i,r,n)}catch(s){if(!(s instanceof G))throw s;o=e.nearestEndpoint(t,i,r,n)}return o},e.prototype.intersection=function(t,i,r,n){var o=this.intersectionWithNormalization(t,i,r,n);return this.isInSegmentEnvelopes(o)||(o=new S(e.nearestEndpoint(t,i,r,n))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,i,r){var n=t,o=Math.abs(n);return Math.abs(e)<o&&(n=e,o=Math.abs(e)),Math.abs(i)<o&&(n=i,o=Math.abs(i)),Math.abs(r)<o&&(n=r),n},e.prototype.checkDD=function(t,e,i,r,n){var o=z.intersection(t,e,i,r),s=this.isInSegmentEnvelopes(o);Z.out.println("DD in env = "+s+"  --------------------- "+o),n.distance(o)>1e-4&&Z.out.println("Distance = "+n.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,i,r){var n=new S(t),o=new S(e),s=new S(i),a=new S(r),l=new S;this.normalizeToEnvCentre(n,o,s,a,l);var c=this.safeHCoordinateIntersection(n,o,s,a);return c.x+=l.x,c.y+=l.y,c},e.prototype.computeCollinearIntersection=function(e,i,r,n){var o=W.intersects(e,i,r),s=W.intersects(e,i,n),a=W.intersects(r,n,e),l=W.intersects(r,n,i);return o&&s?(this._intPt[0]=r,this._intPt[1]=n,t.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=e,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||s||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&l?(this._intPt[0]=r,this._intPt[1]=i,!r.equals(i)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||o||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&l?(this._intPt[0]=n,this._intPt[1]=i,!n.equals(i)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,i,r,n){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,c=i.x<r.x?i.x:r.x,u=i.y<r.y?i.y:r.y,h=i.x>r.x?i.x:r.x,p=i.y>r.y?i.y:r.y,d=((o>c?o:c)+(a<h?a:h))/2,f=((s>u?s:u)+(l<p?l:p))/2;n.x=d,n.y=f,t.x-=n.x,t.y-=n.y,e.x-=n.x,e.y-=n.y,i.x-=n.x,i.y-=n.y,r.x-=n.x,r.y-=n.y},e.prototype.computeIntersect=function(e,i,r,n){if(this._isProper=!1,!W.intersects(e,i,r,n))return t.NO_INTERSECTION;var o=at.orientationIndex(e,i,r),s=at.orientationIndex(e,i,n);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=at.orientationIndex(r,n,e),l=at.orientationIndex(r,n,i);return a>0&&l>0||a<0&&l<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===l?this.computeCollinearIntersection(e,i,r,n):(0===o||0===s||0===a||0===l?(this._isProper=!1,e.equals2D(r)||e.equals2D(n)?this._intPt[0]=e:i.equals2D(r)||i.equals2D(n)?this._intPt[0]=i:0===o?this._intPt[0]=new S(r):0===s?this._intPt[0]=new S(n):0===a?this._intPt[0]=new S(e):0===l&&(this._intPt[0]=new S(i))):(this._isProper=!0,this._intPt[0]=this.intersection(e,i,r,n)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,i,r){var n=t,o=at.distancePointLine(t,i,r),s=at.distancePointLine(e,i,r);return s<o&&(o=s,n=e),(s=at.distancePointLine(i,t,e))<o&&(o=s,n=i),(s=at.distancePointLine(r,t,e))<o&&(o=s,n=r),n},e}(it),ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.orientationIndex=function(t,e,i){var r=e.x-t.x,n=e.y-t.y,o=i.x-e.x,s=i.y-e.y;return ot.signOfDet2x2(r,n,o,s)},ot.signOfDet2x2=function(t,e,i,r){var n=null,o=null,s=null;if(n=1,0===t||0===r)return 0===e||0===i?0:e>0?i>0?-n:n:i>0?n:-n;if(0===e||0===i)return r>0?t>0?n:-n:t>0?-n:n;if(e>0?r>0?e<=r||(n=-n,o=t,t=i,i=o,o=e,e=r,r=o):e<=-r?(n=-n,i=-i,r=-r):(o=t,t=-i,i=o,o=e,e=-r,r=o):r>0?-e<=r?(n=-n,t=-t,e=-e):(o=-t,t=i,i=o,o=-e,e=r,r=o):e>=r?(t=-t,e=-e,i=-i,r=-r):(n=-n,o=-t,t=-i,i=o,o=-e,e=-r,r=o),t>0){if(!(i>0))return n;if(!(t<=i))return n}else{if(i>0)return-n;if(!(t>=i))return-n;n=-n,t=-t,i=-i}for(;;){if((r-=(s=Math.floor(i/t))*e)<0)return-n;if(r>e)return n;if(t>(i-=s*t)+i){if(e<r+r)return n}else{if(e>r+r)return-n;i=t-i,r=e-r,n=-n}if(0===r)return 0===i?0:-n;if(0===i)return n;if((e-=(s=Math.floor(t/i))*r)<0)return n;if(e>r)return-n;if(i>(t-=s*i)+t){if(r<e+e)return-n}else{if(r>e+e)return n;t=i-t,e=r-e,n=-n}if(0===e)return 0===t?0:n;if(0===t)return-n}};var st=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};st.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var i=t.x,r=e.x;return i>r&&(i=e.x,r=t.x),this._p.x>=i&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var n=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,l=ot.signOfDet2x2(n,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},st.prototype.isPointInPolygon=function(){return this.getLocation()!==E.EXTERIOR},st.prototype.getLocation=function(){return this._isPointOnSegment?E.BOUNDARY:this._crossingCount%2==1?E.INTERIOR:E.EXTERIOR},st.prototype.isOnSegment=function(){return this._isPointOnSegment},st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.locatePointInRing=function(){if(arguments[0]instanceof S&&L(arguments[1],U)){for(var t=arguments[1],e=new st(arguments[0]),i=new S,r=new S,n=1;n<t.size();n++)if(t.getCoordinate(n,i),t.getCoordinate(n-1,r),e.countSegment(i,r),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof S&&arguments[1]instanceof Array){for(var o=arguments[1],s=new st(arguments[0]),a=1;a<o.length;a++){var l=o[a],c=o[a-1];if(s.countSegment(l,c),s.isOnSegment())return s.getLocation()}return s.getLocation()}};var at=function(){},lt={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},at.orientationIndex=function(t,e,i){return z.orientationIndex(t,e,i)},at.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,i=t[0].x,r=1;r<t.length-1;r++){var n=t[r].x-i,o=t[r+1].y;e+=n*(t[r-1].y-o)}return e/2}if(L(arguments[0],U)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new S,c=new S,u=new S;s.getCoordinate(0,c),s.getCoordinate(1,u);var h=c.x;u.x-=h;for(var p=0,d=1;d<a-1;d++)l.y=c.y,c.x=u.x,c.y=u.y,s.getCoordinate(d+1,u),u.x-=h,p+=c.x*(l.y-u.y);return p/2}},at.distanceLineLine=function(t,e,i,r){if(t.equals(e))return at.distancePointLine(t,i,r);if(i.equals(r))return at.distancePointLine(r,t,e);var n=!1;if(W.intersects(t,e,i,r)){var o=(e.x-t.x)*(r.y-i.y)-(e.y-t.y)*(r.x-i.x);if(0===o)n=!0;else{var s=(t.y-i.y)*(r.x-i.x)-(t.x-i.x)*(r.y-i.y),a=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(n=!0)}}else n=!0;return n?P.min(at.distancePointLine(t,i,r),at.distancePointLine(e,i,r),at.distancePointLine(i,t,e),at.distancePointLine(r,t,e)):0},at.isPointInRing=function(t,e){return at.locatePointInRing(t,e)!==E.EXTERIOR},at.computeLength=function(t){var e=t.size();if(e<=1)return 0;var i=0,r=new S;t.getCoordinate(0,r);for(var n=r.x,o=r.y,s=1;s<e;s++){t.getCoordinate(s,r);var a=r.x,l=r.y,c=a-n,u=l-o;i+=Math.sqrt(c*c+u*u),n=a,o=l}return i},at.isCCW=function(t){var e=t.length-1;if(e<3)throw new y("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],r=0,n=1;n<=e;n++){var o=t[n];o.y>i.y&&(i=o,r=n)}var s=r;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(i)&&s!==r);var a=r;do{a=(a+1)%e}while(t[a].equals2D(i)&&a!==r);var l=t[s],c=t[a];if(l.equals2D(i)||c.equals2D(i)||l.equals2D(c))return!1;var u=at.computeOrientation(l,i,c);return 0===u?l.x>c.x:u>0},at.locatePointInRing=function(t,e){return st.locatePointInRing(t,e)},at.distancePointLinePerpendicular=function(t,e,i){var r=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/r;return Math.abs(n)*Math.sqrt(r)},at.computeOrientation=function(t,e,i){return at.orientationIndex(t,e,i)},at.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new y("Line array must contain at least one vertex");for(var i=t.distance(e[0]),r=0;r<e.length-1;r++){var n=at.distancePointLine(t,e[r],e[r+1]);n<i&&(i=n)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var u=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(u)*Math.sqrt(l)}},at.isOnLine=function(t,e){for(var i=new nt,r=1;r<e.length;r++){var n=e[r-1],o=e[r];if(i.computeIntersection(t,n,o),i.hasIntersection())return!0}return!1},lt.CLOCKWISE.get=function(){return-1},lt.RIGHT.get=function(){return at.CLOCKWISE},lt.COUNTERCLOCKWISE.get=function(){return 1},lt.LEFT.get=function(){return at.COUNTERCLOCKWISE},lt.COLLINEAR.get=function(){return 0},lt.STRAIGHT.get=function(){return at.COLLINEAR},Object.defineProperties(at,lt);var ct=function(){};ct.prototype.filter=function(t){},ct.prototype.interfaces_=function(){return[]},ct.prototype.getClass=function(){return ct};var ut=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},ht={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ut.prototype.isGeometryCollection=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION},ut.prototype.getFactory=function(){return this._factory},ut.prototype.getGeometryN=function(t){return this},ut.prototype.getArea=function(){return 0},ut.prototype.isRectangle=function(){return!1},ut.prototype.equals=function(){if(arguments[0]instanceof ut){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof ut))return!1;var i=e;return this.equalsExact(i)}},ut.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},ut.prototype.geometryChanged=function(){this.apply(ut.geometryChangedFilter)},ut.prototype.geometryChangedAction=function(){this._envelope=null},ut.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},ut.prototype.getLength=function(){return 0},ut.prototype.getNumGeometries=function(){return 1},ut.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,r)}},ut.prototype.getUserData=function(){return this._userData},ut.prototype.getSRID=function(){return this._SRID},ut.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ut.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION)throw new y("This method does not support GeometryCollection arguments")},ut.prototype.equal=function(t,e,i){return 0===i?t.equals(e):t.distance(e)<=i},ut.prototype.norm=function(){var t=this.copy();return t.normalize(),t},ut.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ut.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new W(this._envelope)},ut.prototype.setSRID=function(t){this._SRID=t},ut.prototype.setUserData=function(t){this._userData=t},ut.prototype.compare=function(t,e){for(var i=t.iterator(),r=e.iterator();i.hasNext()&&r.hasNext();){var n=i.next(),o=r.next(),s=n.compareTo(o);if(0!==s)return s}return i.hasNext()?1:r.hasNext()?-1:0},ut.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ut.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ut.SORTINDEX_MULTIPOINT||this.getSortIndex()===ut.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ut.SORTINDEX_MULTIPOLYGON},ut.prototype.interfaces_=function(){return[b,x,e]},ut.prototype.getClass=function(){return ut},ut.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},ut.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},ht.serialVersionUID.get=function(){return 0x799ea46522854c00},ht.SORTINDEX_POINT.get=function(){return 0},ht.SORTINDEX_MULTIPOINT.get=function(){return 1},ht.SORTINDEX_LINESTRING.get=function(){return 2},ht.SORTINDEX_LINEARRING.get=function(){return 3},ht.SORTINDEX_MULTILINESTRING.get=function(){return 4},ht.SORTINDEX_POLYGON.get=function(){return 5},ht.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ht.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ht.geometryChangedFilter.get=function(){return pt},Object.defineProperties(ut,ht);var pt=function(){};pt.interfaces_=function(){return[ct]},pt.filter=function(t){t.geometryChangedAction()};var dt=function(){};dt.prototype.filter=function(t){},dt.prototype.interfaces_=function(){return[]},dt.prototype.getClass=function(){return dt};var ft=function(){},mt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ft.prototype.isInBoundary=function(t){},ft.prototype.interfaces_=function(){return[]},ft.prototype.getClass=function(){return ft},mt.Mod2BoundaryNodeRule.get=function(){return gt},mt.EndPointBoundaryNodeRule.get=function(){return _t},mt.MultiValentEndPointBoundaryNodeRule.get=function(){return yt},mt.MonoValentEndPointBoundaryNodeRule.get=function(){return At},mt.MOD2_BOUNDARY_RULE.get=function(){return new gt},mt.ENDPOINT_BOUNDARY_RULE.get=function(){return new _t},mt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new yt},mt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new At},mt.OGC_SFS_BOUNDARY_RULE.get=function(){return ft.MOD2_BOUNDARY_RULE},Object.defineProperties(ft,mt);var gt=function(){};gt.prototype.isInBoundary=function(t){return t%2==1},gt.prototype.interfaces_=function(){return[ft]},gt.prototype.getClass=function(){return gt};var _t=function(){};_t.prototype.isInBoundary=function(t){return t>0},_t.prototype.interfaces_=function(){return[ft]},_t.prototype.getClass=function(){return _t};var yt=function(){};yt.prototype.isInBoundary=function(t){return t>1},yt.prototype.interfaces_=function(){return[ft]},yt.prototype.getClass=function(){return yt};var At=function(){};At.prototype.isInBoundary=function(t){return 1===t},At.prototype.interfaces_=function(){return[ft]},At.prototype.getClass=function(){return At};var vt=function(){};vt.prototype.add=function(){},vt.prototype.addAll=function(){},vt.prototype.isEmpty=function(){},vt.prototype.iterator=function(){},vt.prototype.size=function(){},vt.prototype.toArray=function(){},vt.prototype.remove=function(){},(i.prototype=new Error).name="IndexOutOfBoundsException";var xt=function(){};xt.prototype.hasNext=function(){},xt.prototype.next=function(){},xt.prototype.remove=function(){};var bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(vt);(r.prototype=new Error).name="NoSuchElementException";var wt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof vt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,vt]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var i=this.array_[t];return this.array_[t]=e,i},e.prototype.iterator=function(){return new St(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new i;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,i=0,r=this.array_.length;i<r;i++)if(this.array_[i]===t){this.array_.splice(i,1),e=!0;break}return e},e}(bt),St=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new r;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(xt),Tt=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.ensureCapacity(i.length),this.add(i,r)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={coordArrayType:{configurable:!0}};return i.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],i=!1,r=arguments[0].iterator();r.hasNext();)this.add(r.next(),e),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),i=0;i<this.size();i++)e.add(i,this.get(i).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];return this.add(i,r,!0),!0}if(arguments[0]instanceof S&&"boolean"==typeof arguments[1]){var n=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(n))return null;t.prototype.add.call(this,n)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return this.add(o,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],l);else for(var u=a.length-1;u>=0;u--)this.add(a[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof S){var h=arguments[0],p=arguments[1];if(!arguments[2]){var d=this.size();if(d>0){if(h>0&&this.get(h-1).equals2D(p))return null;if(h<d&&this.get(h).equals2D(p))return null}}t.prototype.add.call(this,h,p)}}else if(4===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],_=arguments[3],y=1;g>_&&(y=-1);for(var A=g;A!==_;A+=y)this.add(f[A],m);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new S(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,i),e}(wt),Ct=function(){},Mt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Mt.ForwardComparator.get=function(){return Et},Mt.BidirectionalComparator.get=function(){return It},Mt.coordArrayType.get=function(){return new Array(0).fill(null)},Ct.prototype.interfaces_=function(){return[]},Ct.prototype.getClass=function(){return Ct},Ct.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},Ct.ptNotInList=function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(Ct.indexOf(r,e)<0)return r}return null},Ct.scroll=function(t,e){var i=Ct.indexOf(e,t);if(i<0)return null;var r=new Array(t.length).fill(null);Z.arraycopy(t,i,r,0,t.length-i),Z.arraycopy(t,0,r,t.length-i,i),Z.arraycopy(r,0,t,0,t.length)},Ct.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];if(r===n)return!0;if(null===r||null===n)return!1;if(r.length!==n.length)return!1;for(var s=0;s<r.length;s++)if(0!==o.compare(r[s],n[s]))return!1;return!0}},Ct.intersection=function(t,e){for(var i=new Tt,r=0;r<t.length;r++)e.intersects(t[r])&&i.add(t[r],!0);return i.toCoordinateArray()},Ct.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Ct.removeRepeatedPoints=function(t){return Ct.hasRepeatedPoints(t)?new Tt(t,!1).toCoordinateArray():t},Ct.reverse=function(t){for(var e=t.length-1,i=Math.trunc(e/2),r=0;r<=i;r++){var n=t[r];t[r]=t[e-r],t[e-r]=n}},Ct.removeNull=function(t){for(var e=0,i=0;i<t.length;i++)null!==t[i]&&e++;var r=new Array(e).fill(null);if(0===e)return r;for(var n=0,o=0;o<t.length;o++)null!==t[o]&&(r[n++]=t[o]);return r},Ct.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),i=0;i<t.length;i++)e[i]=new S(t[i]);return e}if(5===arguments.length)for(var r=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new S(r[n+l])},Ct.isEqualReversed=function(t,e){for(var i=0;i<t.length;i++){var r=t[i],n=e[t.length-i-1];if(0!==r.compareTo(n))return!1}return!0},Ct.envelope=function(t){for(var e=new W,i=0;i<t.length;i++)e.expandToInclude(t[i]);return e},Ct.toCoordinateArray=function(t){return t.toArray(Ct.coordArrayType)},Ct.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Ct.indexOf=function(t,e){for(var i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1},Ct.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var i=t.length-1-e,r=t[e].compareTo(t[i]);if(0!==r)return r}return 1},Ct.compare=function(t,e){for(var i=0;i<t.length&&i<e.length;){var r=t[i].compareTo(e[i]);if(0!==r)return r;i++}return i<e.length?-1:i<t.length?1:0},Ct.minCoordinate=function(t){for(var e=null,i=0;i<t.length;i++)(null===e||e.compareTo(t[i])>0)&&(e=t[i]);return e},Ct.extract=function(t,e,i){e=P.clamp(e,0,t.length);var r=(i=P.clamp(i,-1,t.length))-e+1;i<0&&(r=0),e>=t.length&&(r=0),i<e&&(r=0);var n=new Array(r).fill(null);if(0===r)return n;for(var o=0,s=e;s<=i;s++)n[o++]=t[s];return n},Object.defineProperties(Ct,Mt);var Et=function(){};Et.prototype.compare=function(t,e){return Ct.compare(t,e)},Et.prototype.interfaces_=function(){return[w]},Et.prototype.getClass=function(){return Et};var It=function(){};It.prototype.compare=function(t,e){var i=t,r=e;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;var n=Ct.compare(i,r);return Ct.isEqualReversed(i,r)?0:n},It.prototype.OLDcompare=function(t,e){var i=t,r=e;if(i.length<r.length)return-1;if(i.length>r.length)return 1;if(0===i.length)return 0;for(var n=Ct.increasingDirection(i),o=Ct.increasingDirection(r),s=n>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var c=i[s].compareTo(r[a]);if(0!==c)return c;s+=n,a+=o}return 0},It.prototype.interfaces_=function(){return[w]},It.prototype.getClass=function(){return It};var Lt=function(){};Lt.prototype.get=function(){},Lt.prototype.put=function(){},Lt.prototype.size=function(){},Lt.prototype.values=function(){},Lt.prototype.entrySet=function(){};var Pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Lt);(n.prototype=new Error).name="OperationNotSupported",(o.prototype=new vt).contains=function(){};var kt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof vt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new Nt(this)},e}(o),Nt=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new r;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new n},e}(xt),Dt=0;(h.prototype=new Pt).get=function(t){for(var e=this.root_;null!==e;){var i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return e.value;e=e.right}}return null},h.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Dt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,r,n=this.root_;do{if(i=n,(r=t.compareTo(n.key))<0)n=n.left;else{if(!(r>0)){var o=n.value;return n.value=e,o}n=n.right}}while(null!==n);var s={key:t,left:null,right:null,value:e,parent:i,color:Dt,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},h.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(a(t)===c(a(a(t)))){var e=u(a(a(t)));1===s(e)?(l(a(t),Dt),l(e,Dt),l(a(a(t)),1),t=a(a(t))):(t===u(a(t))&&(t=a(t),this.rotateLeft(t)),l(a(t),Dt),l(a(a(t)),1),this.rotateRight(a(a(t))))}else{var i=c(a(a(t)));1===s(i)?(l(a(t),Dt),l(i,Dt),l(a(a(t)),1),t=a(a(t))):(t===c(a(t))&&(t=a(t),this.rotateRight(t)),l(a(t),Dt),l(a(a(t)),1),this.rotateLeft(a(a(t))))}this.root_.color=Dt},h.prototype.values=function(){var t=new wt,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=h.successor(e));)t.add(e.value);return t},h.prototype.entrySet=function(){var t=new kt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=h.successor(e));)t.add(e);return t},h.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},h.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},h.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},h.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var i=t.parent,r=t;null!==i&&r===i.right;)r=i,i=i.parent;return i},h.prototype.size=function(){return this.size_};var Ot=function(){};Ot.prototype.interfaces_=function(){return[]},Ot.prototype.getClass=function(){return Ot},p.prototype=new o,(d.prototype=new p).contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},d.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,i=this.array_.length;e<i;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},d.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},d.prototype.remove=function(t){throw new n},d.prototype.size=function(){return this.array_.length},d.prototype.isEmpty=function(){return 0===this.array_.length},d.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},d.prototype.iterator=function(){return new Rt(this)};var Rt=function(t){this.treeSet_=t,this.position_=0};Rt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new r;return this.treeSet_.array_[this.position_++]},Rt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Rt.prototype.remove=function(){throw new n};var Ft=function(){};Ft.sort=function(){var t,e,i,r,n=arguments[0];if(1===arguments.length)r=function(t,e){return t.compareTo(e)},n.sort(r);else if(2===arguments.length)i=arguments[1],r=function(t,e){return i.compare(t,e)},n.sort(r);else if(3===arguments.length){(e=n.slice(arguments[1],arguments[2])).sort();var o=n.slice(0,arguments[1]).concat(e,n.slice(arguments[2],n.length));for(n.splice(0,n.length),t=0;t<o.length;t++)n.push(o[t])}else if(4===arguments.length)for(e=n.slice(arguments[1],arguments[2]),i=arguments[3],r=function(t,e){return i.compare(t,e)},e.sort(r),o=n.slice(0,arguments[1]).concat(e,n.slice(arguments[2],n.length)),n.splice(0,n.length),t=0;t<o.length;t++)n.push(o[t])},Ft.asList=function(t){for(var e=new wt,i=0,r=t.length;i<r;i++)e.add(t[i]);return e};var zt=function(){},Bt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bt.P.get=function(){return 0},Bt.L.get=function(){return 1},Bt.A.get=function(){return 2},Bt.FALSE.get=function(){return-1},Bt.TRUE.get=function(){return-2},Bt.DONTCARE.get=function(){return-3},Bt.SYM_FALSE.get=function(){return"F"},Bt.SYM_TRUE.get=function(){return"T"},Bt.SYM_DONTCARE.get=function(){return"*"},Bt.SYM_P.get=function(){return"0"},Bt.SYM_L.get=function(){return"1"},Bt.SYM_A.get=function(){return"2"},zt.prototype.interfaces_=function(){return[]},zt.prototype.getClass=function(){return zt},zt.toDimensionSymbol=function(t){switch(t){case zt.FALSE:return zt.SYM_FALSE;case zt.TRUE:return zt.SYM_TRUE;case zt.DONTCARE:return zt.SYM_DONTCARE;case zt.P:return zt.SYM_P;case zt.L:return zt.SYM_L;case zt.A:return zt.SYM_A}throw new y("Unknown dimension value: "+t)},zt.toDimensionValue=function(t){switch(O.toUpperCase(t)){case zt.SYM_FALSE:return zt.FALSE;case zt.SYM_TRUE:return zt.TRUE;case zt.SYM_DONTCARE:return zt.DONTCARE;case zt.SYM_P:return zt.P;case zt.SYM_L:return zt.L;case zt.SYM_A:return zt.A}throw new y("Unknown dimension symbol: "+t)},Object.defineProperties(zt,Bt);var Ut=function(){};Ut.prototype.filter=function(t){},Ut.prototype.interfaces_=function(){return[]},Ut.prototype.getClass=function(){return Ut};var Vt=function(){};Vt.prototype.filter=function(t,e){},Vt.prototype.isDone=function(){},Vt.prototype.isGeometryChanged=function(){},Vt.prototype.interfaces_=function(){return[]},Vt.prototype.getClass=function(){return Vt};var jt=function(t){function e(e,i){if(t.call(this,i),this._geometries=e||[],t.hasNullElements(this._geometries))throw new y("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new W,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=0;i<this._geometries.length;i++)for(var r=this._geometries[i].getCoordinates(),n=0;n<r.length;n++)t[++e]=r[n];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._geometries.length!==r._geometries.length)return!1;for(var n=0;n<this._geometries.length;n++)if(!this._geometries[n].equalsExact(r._geometries[n],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ft.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=zt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new d(Ft.asList(this._geometries)),i=new d(Ft.asList(t._geometries));return this.compare(e,i)}if(2===arguments.length){for(var r=arguments[1],n=arguments[0],o=this.getNumGeometries(),s=n.getNumGeometries(),a=0;a<o&&a<s;){var l=this.getGeometryN(a),c=n.getGeometryN(a),u=l.compareToSameClass(c,r);if(0!==u)return u;a++}return a<o?1:a<s?-1:0}},e.prototype.apply=function(){if(L(arguments[0],dt))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(L(arguments[0],Vt)){var i=arguments[0];if(0===this._geometries.length)return null;for(var r=0;r<this._geometries.length&&(this._geometries[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(L(arguments[0],Ut)){var n=arguments[0];n.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(n)}else if(L(arguments[0],ct)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var i=0;i<this._geometries.length;i++)e._geometries[i]=this._geometries[i].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,i),e}(ut),Gt=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[t-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Zt(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Ot]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,i),e}(jt),Zt=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=ft.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=r}};Zt.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Zt.prototype.getBoundary=function(){return this._geom instanceof Kt?this.boundaryLineString(this._geom):this._geom instanceof Gt?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Zt.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Zt.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Zt.prototype.computeBoundaryCoordinates=function(t){var e=new wt;this._endpointMap=new h;for(var i=0;i<t.getNumGeometries();i++){var r=t.getGeometryN(i);0!==r.getNumPoints()&&(this.addEndpoint(r.getCoordinateN(0)),this.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var n=this._endpointMap.entrySet().iterator();n.hasNext();){var o=n.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&e.add(o.getKey())}return Ct.toCoordinateArray(e)},Zt.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new qt,this._endpointMap.put(t,e)),e.count++},Zt.prototype.interfaces_=function(){return[]},Zt.prototype.getClass=function(){return Zt},Zt.getBoundary=function(){return 1===arguments.length?new Zt(arguments[0]).getBoundary():2===arguments.length?new Zt(arguments[0],arguments[1]).getBoundary():void 0};var qt=function(){this.count=null};qt.prototype.interfaces_=function(){return[]},qt.prototype.getClass=function(){return qt};var Wt=function(){},Ht={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Wt.prototype.interfaces_=function(){return[]},Wt.prototype.getClass=function(){return Wt},Wt.chars=function(t,e){for(var i=new Array(e).fill(null),r=0;r<e;r++)i[r]=t;return String(i)},Wt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},i=new function(){}(e);return t.printStackTrace(i),e.toString()}if(2===arguments.length){for(var r=arguments[1],n="",o=new function(){}(new function(){}(Wt.getStackTrace(arguments[0]))),s=0;s<r;s++)try{n+=o.readLine()+Wt.NEWLINE}catch(t){if(!(t instanceof f))throw t;et.shouldNeverReachHere()}return n}},Wt.split=function(t,e){for(var i=e.length,r=new wt,n=""+t,o=n.indexOf(e);o>=0;){var s=n.substring(0,o);r.add(s),o=(n=n.substring(o+i)).indexOf(e)}n.length>0&&r.add(n);for(var a=new Array(r.size()).fill(null),l=0;l<a.length;l++)a[l]=r.get(l);return a},Wt.toString=function(){if(1===arguments.length){var t=arguments[0];return Wt.SIMPLE_ORDINATE_FORMAT.format(t)}},Wt.spaces=function(t){return Wt.chars(" ",t)},Ht.NEWLINE.get=function(){return Z.getProperty("line.separator")},Ht.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Wt,Ht);var Jt=function(){};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt},Jt.copyCoord=function(t,e,i,r){for(var n=Math.min(t.getDimension(),i.getDimension()),o=0;o<n;o++)i.setOrdinate(r,o,t.getOrdinate(e,o))},Jt.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,U.X)===t.getOrdinate(e-1,U.X)&&t.getOrdinate(0,U.Y)===t.getOrdinate(e-1,U.Y)},Jt.isEqual=function(t,e){var i=t.size();if(i!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),n=0;n<i;n++)for(var o=0;o<r;o++){var s=t.getOrdinate(n,o),a=e.getOrdinate(n,o);if(!(t.getOrdinate(n,o)===e.getOrdinate(n,o)||A.isNaN(s)&&A.isNaN(a)))return!1}return!0},Jt.extend=function(t,e,i){var r=t.create(i,e.getDimension()),n=e.size();if(Jt.copy(e,0,r,0,n),n>0)for(var o=n;o<i;o++)Jt.copy(e,n-1,r,o,1);return r},Jt.reverse=function(t){for(var e=t.size()-1,i=Math.trunc(e/2),r=0;r<=i;r++)Jt.swap(t,r,e-r)},Jt.swap=function(t,e,i){if(e===i)return null;for(var r=0;r<t.getDimension();r++){var n=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(i,r)),t.setOrdinate(i,r,n)}},Jt.copy=function(t,e,i,r,n){for(var o=0;o<n;o++)Jt.copyCoord(t,e+o,i,r+o)},Jt.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var i=t.getDimension(),r=new N;r.append("(");for(var n=0;n<e;n++){n>0&&r.append(" ");for(var o=0;o<i;o++)o>0&&r.append(","),r.append(Wt.toString(t.getOrdinate(n,o)))}return r.append(")"),r.toString()}},Jt.ensureValidRing=function(t,e){var i=e.size();return 0===i?e:i<=3?Jt.createClosedRing(t,e,4):e.getOrdinate(0,U.X)===e.getOrdinate(i-1,U.X)&&e.getOrdinate(0,U.Y)===e.getOrdinate(i-1,U.Y)?e:Jt.createClosedRing(t,e,i+1)},Jt.createClosedRing=function(t,e,i){var r=t.create(i,e.getDimension()),n=e.size();Jt.copy(e,0,r,0,n);for(var o=n;o<i;o++)Jt.copy(e,0,r,o,1);return r};var Kt=function(t){function e(e,i){t.call(this,i),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new W:this._points.expandEnvelope(new W)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e;if(this._points.size()!==r._points.size())return!1;for(var n=0;n<this._points.size();n++)if(!this.equal(this._points.getCoordinate(n),r._points.getCoordinate(n),i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&Jt.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?zt.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return at.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Jt.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,i=0;e<this._points.size()&&i<t._points.size();){var r=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(i));if(0!==r)return r;e++,i++}return e<this._points.size()?1:i<t._points.size()?-1:0}if(2===arguments.length){var n=arguments[0];return arguments[1].compare(this._points,n._points)}},e.prototype.apply=function(){if(L(arguments[0],dt))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(L(arguments[0],Vt)){var i=arguments[0];if(0===this._points.size())return null;for(var r=0;r<this._points.size()&&(i.filter(this._points,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else(L(arguments[0],Ut)||L(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Zt(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new y("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Ot]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,i),e}(ut),$t=function(){};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t};var Yt=function(t){function e(e,i){t.call(this,i),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new W;var t=new W;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),i))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(L(arguments[0],dt)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(L(arguments[0],Vt)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(L(arguments[0],Ut)||L(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[$t]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,i),e}(ut),Xt=function(){};Xt.prototype.interfaces_=function(){return[]},Xt.prototype.getClass=function(){return Xt};var Qt=function(t){function e(e,i,r){if(t.call(this,r),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===i&&(i=[]),t.hasNullElements(i))throw new y("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(i))throw new y("shell is empty but holes are not");this._shell=e,this._holes=i}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=this._shell.getCoordinates(),r=0;r<i.length;r++)t[++e]=i[r];for(var n=0;n<this._holes.length;n++)for(var o=this._holes[n].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(at.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(at.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),i=0;i<5;i++){var r=t.getX(i);if(r!==e.getMinX()&&r!==e.getMaxX())return!1;var n=t.getY(i);if(n!==e.getMinY()&&n!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var l=t.getX(a),c=t.getY(a);if(l!==o==(c!==s))return!1;o=l,s=c}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var r=e,n=this._shell,o=r._shell;if(!n.equalsExact(o,i))return!1;if(this._holes.length!==r._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(r._holes[s],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Ft.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(e.isEmpty())return null;var r=new Array(e.getCoordinates().length-1).fill(null);Z.arraycopy(e.getCoordinates(),0,r,0,r.length);var n=Ct.minCoordinate(e.getCoordinates());Ct.scroll(r,n),Z.arraycopy(r,0,e.getCoordinates(),0,r.length),e.getCoordinates()[r.length]=r[0],at.isCCW(e.getCoordinates())===i&&Ct.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,i=t._shell;return e.compareToSameClass(i)}if(2===arguments.length){var r=arguments[1],n=arguments[0],o=this._shell,s=n._shell,a=o.compareToSameClass(s,r);if(0!==a)return a;for(var l=this.getNumInteriorRing(),c=n.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),p=n.getInteriorRingN(u),d=h.compareToSameClass(p,r);if(0!==d)return d;u++}return u<l?1:u<c?-1:0}},e.prototype.apply=function(t){if(L(t,dt)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(L(t,Vt)){if(this._shell.apply(t),!t.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(t),!t.isDone());i++);t.isGeometryChanged()&&this.geometryChanged()}else if(L(t,Ut))t.filter(this);else if(L(t,ct)){t.filter(this),this._shell.apply(t);for(var r=0;r<this._holes.length;r++)this._holes[r].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)e._holes[i]=this._holes[i].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),i=new Array(this._holes.length).fill(null),r=0;r<i.length;r++)i[r]=this._holes[r].copy();return new e(t,i,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Xt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,i),e}(ut),te=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[$t]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,i),e}(jt),ee=function(t){function e(e,i){e instanceof S&&i instanceof _e&&(e=i.getCoordinateSequenceFactory().create(e)),t.call(this,e,i),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return zt.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Jt.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new y("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new y("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.MINIMUM_VALID_SIZE.get=function(){return 4},i.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,i),e}(Kt),ie=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new wt,e=0;e<this._geometries.length;e++)for(var i=this._geometries[e].getBoundary(),r=0;r<i.getNumGeometries();r++)t.add(i.getGeometryN(r));var n=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(n))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Xt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,i),e}(jt),re=function(t){this._factory=t||null,this._isUserDataCopied=!1},ne={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};re.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},re.prototype.edit=function(t,e){if(null===t)return null;var i=this.editInternal(t,e);return this._isUserDataCopied&&i.setUserData(t.getUserData()),i},re.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof jt?this.editGeometryCollection(t,e):t instanceof Qt?this.editPolygon(t,e):t instanceof Yt||t instanceof Kt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},re.prototype.editGeometryCollection=function(t,e){for(var i=e.edit(t,this._factory),r=new wt,n=0;n<i.getNumGeometries();n++){var o=this.edit(i.getGeometryN(n),e);null===o||o.isEmpty()||r.add(o)}return i.getClass()===te?this._factory.createMultiPoint(r.toArray([])):i.getClass()===Gt?this._factory.createMultiLineString(r.toArray([])):i.getClass()===ie?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))},re.prototype.editPolygon=function(t,e){var i=e.edit(t,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),e);if(null===r||r.isEmpty())return this._factory.createPolygon();for(var n=new wt,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),e);null===s||s.isEmpty()||n.add(s)}return this._factory.createPolygon(r,n.toArray([]))},re.prototype.interfaces_=function(){return[]},re.prototype.getClass=function(){return re},re.GeometryEditorOperation=function(){},ne.NoOpGeometryOperation.get=function(){return oe},ne.CoordinateOperation.get=function(){return se},ne.CoordinateSequenceOperation.get=function(){return ae},Object.defineProperties(re,ne);var oe=function(){};oe.prototype.edit=function(t,e){return t},oe.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},oe.prototype.getClass=function(){return oe};var se=function(){};se.prototype.edit=function(t,e){var i=this.editCoordinates(t.getCoordinates(),t);return null===i?t:t instanceof ee?e.createLinearRing(i):t instanceof Kt?e.createLineString(i):t instanceof Yt?i.length>0?e.createPoint(i[0]):e.createPoint():t},se.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},se.prototype.getClass=function(){return se};var ae=function(){};ae.prototype.edit=function(t,e){return t instanceof ee?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Kt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Yt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},ae.prototype.interfaces_=function(){return[re.GeometryEditorOperation]},ae.prototype.getClass=function(){return ae};var le=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new S}else if(L(arguments[0],U)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)this._coordinates[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var n=arguments[0],o=arguments[1];this._coordinates=n,this._dimension=o,null===n&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new S}},ce={serialVersionUID:{configurable:!0}};le.prototype.setOrdinate=function(t,e,i){switch(e){case U.X:this._coordinates[t].x=i;break;case U.Y:this._coordinates[t].y=i;break;case U.Z:this._coordinates[t].z=i;break;default:throw new y("invalid ordinateIndex")}},le.prototype.size=function(){return this._coordinates.length},le.prototype.getOrdinate=function(t,e){switch(e){case U.X:return this._coordinates[t].x;case U.Y:return this._coordinates[t].y;case U.Z:return this._coordinates[t].z}return A.NaN},le.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],i=arguments[1];i.x=this._coordinates[e].x,i.y=this._coordinates[e].y,i.z=this._coordinates[e].z}},le.prototype.getCoordinateCopy=function(t){return new S(this._coordinates[t])},le.prototype.getDimension=function(){return this._dimension},le.prototype.getX=function(t){return this._coordinates[t].x},le.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new le(t,this._dimension)},le.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},le.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new le(t,this._dimension)},le.prototype.toString=function(){if(this._coordinates.length>0){var t=new N(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},le.prototype.getY=function(t){return this._coordinates[t].y},le.prototype.toCoordinateArray=function(){return this._coordinates},le.prototype.interfaces_=function(){return[U,e]},le.prototype.getClass=function(){return le},ce.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(le,ce);var ue=function(){},he={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ue.prototype.readResolve=function(){return ue.instance()},ue.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new le(arguments[0]);if(L(arguments[0],U))return new le(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new le(t):new le(t,e)}},ue.prototype.interfaces_=function(){return[M,e]},ue.prototype.getClass=function(){return ue},ue.instance=function(){return ue.instanceObject},he.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},he.instanceObject.get=function(){return new ue},Object.defineProperties(ue,he);var pe=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new wt,e=this.map_.values(),i=e.next();!i.done;)t.add(i.value),i=e.next();return t},e.prototype.entrySet=function(){var t=new kt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(Lt),de=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof me){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=t.FIXED,this.setScale(i)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}},fe={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};de.prototype.equals=function(t){if(!(t instanceof de))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},de.prototype.compareTo=function(t){var e=t,i=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new D(i).compareTo(new D(r))},de.prototype.getScale=function(){return this._scale},de.prototype.isFloating=function(){return this._modelType===de.FLOATING||this._modelType===de.FLOATING_SINGLE},de.prototype.getType=function(){return this._modelType},de.prototype.toString=function(){var t="UNKNOWN";return this._modelType===de.FLOATING?t="Floating":this._modelType===de.FLOATING_SINGLE?t="Floating-Single":this._modelType===de.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},de.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return A.isNaN(t)||this._modelType===de.FLOATING_SINGLE?t:this._modelType===de.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof S){var e=arguments[0];if(this._modelType===de.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},de.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===de.FLOATING?t=16:this._modelType===de.FLOATING_SINGLE?t=6:this._modelType===de.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},de.prototype.setScale=function(t){this._scale=Math.abs(t)},de.prototype.interfaces_=function(){return[e,x]},de.prototype.getClass=function(){return de},de.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},fe.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},fe.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(de,fe);var me=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ge={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};me.prototype.readResolve=function(){return me.nameToTypeMap.get(this._name)},me.prototype.toString=function(){return this._name},me.prototype.interfaces_=function(){return[e]},me.prototype.getClass=function(){return me},ge.serialVersionUID.get=function(){return-552860263173159e4},ge.nameToTypeMap.get=function(){return new pe},Object.defineProperties(me,ge),de.Type=me,de.FIXED=new me("FIXED"),de.FLOATING=new me("FLOATING"),de.FLOATING_SINGLE=new me("FLOATING SINGLE");var _e=function t(){this._precisionModel=new de,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?L(arguments[0],M)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof de&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ye={serialVersionUID:{configurable:!0}};_e.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new S(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new S(t.getMinX(),t.getMinY()),new S(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new S(t.getMinX(),t.getMinY()),new S(t.getMinX(),t.getMaxY()),new S(t.getMaxX(),t.getMaxY()),new S(t.getMaxX(),t.getMinY()),new S(t.getMinX(),t.getMinY())]),null)},_e.prototype.createLineString=function(t){return t?t instanceof Array?new Kt(this.getCoordinateSequenceFactory().create(t),this):L(t,U)?new Kt(t,this):void 0:new Kt(this.getCoordinateSequenceFactory().create([]),this)},_e.prototype.createMultiLineString=function(){return 0===arguments.length?new Gt(null,this):1===arguments.length?new Gt(arguments[0],this):void 0},_e.prototype.buildGeometry=function(t){for(var e=null,i=!1,r=!1,n=t.iterator();n.hasNext();){var o=n.next(),s=o.getClass();null===e&&(e=s),s!==e&&(i=!0),o.isGeometryCollectionOrDerived()&&(r=!0)}if(null===e)return this.createGeometryCollection();if(i||r)return this.createGeometryCollection(_e.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Qt)return this.createMultiPolygon(_e.toPolygonArray(t));if(a instanceof Kt)return this.createMultiLineString(_e.toLineStringArray(t));if(a instanceof Yt)return this.createMultiPoint(_e.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},_e.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},_e.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(L(arguments[0],U))return new Yt(arguments[0],this)}},_e.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},_e.prototype.createPolygon=function(){if(0===arguments.length)return new Qt(null,null,this);if(1===arguments.length){if(L(arguments[0],U)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof ee){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length)return new Qt(arguments[0],arguments[1],this)},_e.prototype.getSRID=function(){return this._SRID},_e.prototype.createGeometryCollection=function(){return 0===arguments.length?new jt(null,this):1===arguments.length?new jt(arguments[0],this):void 0},_e.prototype.createGeometry=function(t){return new re(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},_e.prototype.getPrecisionModel=function(){return this._precisionModel},_e.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(L(arguments[0],U))return new ee(arguments[0],this)}},_e.prototype.createMultiPolygon=function(){return 0===arguments.length?new ie(null,this):1===arguments.length?new ie(arguments[0],this):void 0},_e.prototype.createMultiPoint=function(){if(0===arguments.length)return new te(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new te(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(L(arguments[0],U)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(e.size()).fill(null),r=0;r<e.size();r++){var n=this.getCoordinateSequenceFactory().create(1,e.getDimension());Jt.copy(e,r,n,0,1),i[r]=this.createPoint(n)}return this.createMultiPoint(i)}}},_e.prototype.interfaces_=function(){return[e]},_e.prototype.getClass=function(){return _e},_e.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.getDefaultCoordinateSequenceFactory=function(){return ue.instance()},_e.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},_e.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ye.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(_e,ye);var Ae=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],ve=function(t){this.geometryFactory=t||new _e};ve.prototype.read=function(t){var e,i=(e="string"==typeof t?JSON.parse(t):t).type;if(!xe[i])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==Ae.indexOf(i)?xe[i].apply(this,[e.coordinates]):"GeometryCollection"===i?xe[i].apply(this,[e.geometries]):xe[i].apply(this,[e])},ve.prototype.write=function(t){var e=t.getGeometryType();if(!be[e])throw new Error("Geometry is not supported");return be[e].apply(this,[t])};var xe={Feature:function(t){var e={};for(var i in t)e[i]=t[i];if(t.geometry){var r=t.geometry.type;if(!xe[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=xe.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var i=0;i<t.features.length;++i)e.features.push(this.read(t.features[i]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],i=0;i<t.length;++i){var r=t[i];e.push(new S(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new S(t[0],t[1]),new S(t[2],t[1]),new S(t[2],t[3]),new S(t[0],t[3]),new S(t[0],t[1])])},Point:function(t){var e=new S(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],i=0;i<t.length;++i)e.push(xe.Point.apply(this,[t[i]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=xe.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],i=0;i<t.length;++i)e.push(xe.LineString.apply(this,[t[i]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=xe.coordinates.apply(this,[t[0]]),i=this.geometryFactory.createLinearRing(e),r=[],n=1;n<t.length;++n){var o=t[n],s=xe.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);r.push(a)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(t){for(var e=[],i=0;i<t.length;++i){var r=t[i];e.push(xe.Polygon.apply(this,[r]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],i=0;i<t.length;++i){var r=t[i];e.push(this.read(r))}return this.geometryFactory.createGeometryCollection(e)}},be={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:be.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var r=t._geometries[i],n=be.Point.apply(this,[r]);e.push(n.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],i=t.getCoordinates(),r=0;r<i.length;++r){var n=i[r];e.push(be.coordinate.apply(this,[n]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var r=t._geometries[i],n=be.LineString.apply(this,[r]);e.push(n.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],i=be.LineString.apply(this,[t._shell]);e.push(i.coordinates);for(var r=0;r<t._holes.length;++r){var n=t._holes[r],o=be.LineString.apply(this,[n]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var r=t._geometries[i],n=be.Polygon.apply(this,[r]);e.push(n.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var r=t._geometries[i],n=r.getGeometryType();e.push(be[n].apply(this,[r]))}return{type:"GeometryCollection",geometries:e}}},we=function(t){this.geometryFactory=t||new _e,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new ve(this.geometryFactory)};we.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===de.FIXED&&this.reducePrecision(e),e},we.prototype.reducePrecision=function(t){var e,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,i=t.points.length;e<i;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,i=t.geometries.length;e<i;e++)this.reducePrecision(t.geometries[e])};var Se=function(){this.parser=new ve(this.geometryFactory)};Se.prototype.write=function(t){return this.parser.write(t)};var Te=function(){},Ce={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te},Te.opposite=function(t){return t===Te.LEFT?Te.RIGHT:t===Te.RIGHT?Te.LEFT:t},Ce.ON.get=function(){return 0},Ce.LEFT.get=function(){return 1},Ce.RIGHT.get=function(){return 2},Object.defineProperties(Te,Ce),(m.prototype=new Error).name="EmptyStackException",(g.prototype=new bt).add=function(t){return this.array_.push(t),!0},g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},g.prototype.push=function(t){return this.array_.push(t),t},g.prototype.pop=function(t){if(0===this.array_.length)throw new m;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new m;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(t){return this.array_.indexOf(t)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t};var Me=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Me.prototype.getCoordinate=function(){return this._minCoord},Me.prototype.getRightmostSide=function(t,e){var i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i},Me.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],i=t[this._minIndex+1],r=at.computeOrientation(this._minCoord,i,e),n=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&r===at.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&r===at.CLOCKWISE)&&(n=!0),n&&(this._minIndex=this._minIndex-1)},Me.prototype.getRightmostSideOfSegment=function(t,e){var i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var r=Te.LEFT;return i[e].y<i[e+1].y&&(r=Te.RIGHT),r},Me.prototype.getEdge=function(){return this._orientedDe},Me.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),i=0;i<e.length-1;i++)(null===this._minCoord||e[i].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=i,this._minCoord=e[i])},Me.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Me.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();i.isForward()&&this.checkForRightmostCoordinate(i)}et.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Te.LEFT&&(this._orientedDe=this._minDe.getSym())},Me.prototype.interfaces_=function(){return[]},Me.prototype.getClass=function(){return Me};var Ee=function(t){function e(i,r){t.call(this,e.msgWithCoord(i,r)),this.pt=r?new S(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Q),Ie=function(){this.array_=[]};Ie.prototype.addLast=function(t){this.array_.push(t)},Ie.prototype.removeFirst=function(){return this.array_.shift()},Ie.prototype.isEmpty=function(){return 0===this.array_.length};var Le=function(){this._finder=null,this._dirEdgeList=new wt,this._nodes=new wt,this._rightMostCoord=null,this._env=null,this._finder=new Me};Le.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},Le.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Le.prototype.computeNodeDepth=function(t){for(var e=null,i=t.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){e=r;break}}if(null===e)throw new Ee("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var n=t.getEdges().iterator();n.hasNext();){var o=n.next();o.setVisited(!0),this.copySymDepths(o)}},Le.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Te.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Le.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Le.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Te.RIGHT)>=1&&e.getDepth(Te.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Le.prototype.computeDepths=function(t){var e=new kt,i=new Ie,r=t.getNode();for(i.addLast(r),e.add(r),t.setVisited(!0);!i.isEmpty();){var n=i.removeFirst();e.add(n),this.computeNodeDepth(n);for(var o=n.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(i.addLast(a),e.add(a))}}}},Le.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},Le.prototype.getEnvelope=function(){if(null===this._env){for(var t=new W,e=this._dirEdgeList.iterator();e.hasNext();)for(var i=e.next().getEdge().getCoordinates(),r=0;r<i.length-1;r++)t.expandToInclude(i[r]);this._env=t}return this._env},Le.prototype.addReachable=function(t){var e=new g;for(e.add(t);!e.empty();){var i=e.pop();this.add(i,e)}},Le.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Te.LEFT,t.getDepth(Te.RIGHT)),e.setDepth(Te.RIGHT,t.getDepth(Te.LEFT))},Le.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var r=i.next();this._dirEdgeList.add(r);var n=r.getSym().getNode();n.isVisited()||e.push(n)}},Le.prototype.getNodes=function(){return this._nodes},Le.prototype.getDirectedEdges=function(){return this._dirEdgeList},Le.prototype.interfaces_=function(){return[x]},Le.prototype.getClass=function(){return Le};var Pe=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[Te.ON]=i}else if(arguments[0]instanceof t){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var n=0;n<this.location.length;n++)this.location[n]=r.location[n]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[Te.ON]=o,this.location[Te.LEFT]=s,this.location[Te.RIGHT]=a}};Pe.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Pe.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==E.NONE)return!1;return!0},Pe.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===E.NONE&&(this.location[e]=t)},Pe.prototype.isLine=function(){return 1===this.location.length},Pe.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Te.ON]=this.location[Te.ON],e[Te.LEFT]=E.NONE,e[Te.RIGHT]=E.NONE,this.location=e}for(var i=0;i<this.location.length;i++)this.location[i]===E.NONE&&i<t.location.length&&(this.location[i]=t.location[i])},Pe.prototype.getLocations=function(){return this.location},Pe.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Te.LEFT];this.location[Te.LEFT]=this.location[Te.RIGHT],this.location[Te.RIGHT]=t},Pe.prototype.toString=function(){var t=new N;return this.location.length>1&&t.append(E.toLocationSymbol(this.location[Te.LEFT])),t.append(E.toLocationSymbol(this.location[Te.ON])),this.location.length>1&&t.append(E.toLocationSymbol(this.location[Te.RIGHT])),t.toString()},Pe.prototype.setLocations=function(t,e,i){this.location[Te.ON]=t,this.location[Te.LEFT]=e,this.location[Te.RIGHT]=i},Pe.prototype.get=function(t){return t<this.location.length?this.location[t]:E.NONE},Pe.prototype.isArea=function(){return this.location.length>1},Pe.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===E.NONE)return!0;return!1},Pe.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Te.ON,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.location[e]=i}},Pe.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(E.NONE)},Pe.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Pe.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe};var ke=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Pe(e),this.elt[1]=new Pe(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.elt[0]=new Pe(i.elt[0]),this.elt[1]=new Pe(i.elt[1])}}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.elt[0]=new Pe(E.NONE),this.elt[1]=new Pe(E.NONE),this.elt[r].setLocation(n)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Pe(o,s,a),this.elt[1]=new Pe(o,s,a)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Pe(E.NONE,E.NONE,E.NONE),this.elt[1]=new Pe(E.NONE,E.NONE,E.NONE),this.elt[l].setLocations(c,u,h)}};ke.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},ke.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},ke.prototype.isNull=function(t){return this.elt[t].isNull()},ke.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.elt[e].setAllLocationsIfNull(i)}},ke.prototype.isLine=function(t){return this.elt[t].isLine()},ke.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Pe(t.elt[e]):this.elt[e].merge(t.elt[e])},ke.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},ke.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Te.ON)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return this.elt[e].get(i)}},ke.prototype.toString=function(){var t=new N;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},ke.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},ke.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},ke.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Te.ON,e)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this.elt[i].setLocation(r,n)}},ke.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},ke.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},ke.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Pe(this.elt[t].location[0]))},ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke},ke.toLineLabel=function(t){for(var e=new ke(E.NONE),i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e};var Ne=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new wt,this._pts=new wt,this._label=new ke(E.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new wt,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Ne.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=at.isCCW(this._ring.getCoordinates())},Ne.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Ne.prototype.computePoints=function(t){this._startDe=t;var e=t,i=!0;do{if(null===e)throw new Ee("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Ee("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var r=e.getLabel();et.isTrue(r.isArea()),this.mergeLabel(r),this.addPoints(e.getEdge(),e.isForward(),i),i=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},Ne.prototype.getLinearRing=function(){return this._ring},Ne.prototype.getCoordinate=function(t){return this._pts.get(t)},Ne.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},Ne.prototype.addPoints=function(t,e,i){var r=t.getCoordinates();if(e){var n=1;i&&(n=0);for(var o=n;o<r.length;o++)this._pts.add(r[o])}else{var s=r.length-2;i&&(s=r.length-1);for(var a=s;a>=0;a--)this._pts.add(r[a])}},Ne.prototype.isHole=function(){return this._isHole},Ne.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},Ne.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!at.isPointInRing(t,e.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(t))return!1;return!0},Ne.prototype.addHole=function(t){this._holes.add(t)},Ne.prototype.isShell=function(){return null===this._shell},Ne.prototype.getLabel=function(){return this._label},Ne.prototype.getEdges=function(){return this._edges},Ne.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Ne.prototype.getShell=function(){return this._shell},Ne.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],i=arguments[0].getLocation(e,Te.RIGHT);if(i===E.NONE)return null;if(this._label.getLocation(e)===E.NONE)return this._label.setLocation(e,i),null}},Ne.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},Ne.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)e[i]=this._holes.get(i).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne};var De=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ne),Oe=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new wt,e=this._startDe;do{if(null===e.getMinEdgeRing()){var i=new De(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ne),Re=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Re.prototype.setVisited=function(t){this._isVisited=t},Re.prototype.setInResult=function(t){this._isInResult=t},Re.prototype.isCovered=function(){return this._isCovered},Re.prototype.isCoveredSet=function(){return this._isCoveredSet},Re.prototype.setLabel=function(t){this._label=t},Re.prototype.getLabel=function(){return this._label},Re.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Re.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Re.prototype.isInResult=function(){return this._isInResult},Re.prototype.isVisited=function(){return this._isVisited},Re.prototype.interfaces_=function(){return[]},Re.prototype.getClass=function(){return Re};var Fe=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],i=arguments[1];this._coord=e,this._edges=i,this._label=new ke(0,E.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var i=E.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){var r=t.getLocation(e);i!==E.BOUNDARY&&(i=r)}return i},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],i=arguments[1];null===this._label?this._label=new ke(e,i):this._label.setLocation(e,i)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof ke)for(var i=arguments[0],r=0;r<2;r++){var n=this.computeMergedLocation(i,r);this._label.getLocation(r)===E.NONE&&this._label.setLocation(r,n)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=E.NONE;null!==this._label&&(e=this._label.getLocation(t));var i=null;if(e===E.BOUNDARY)i=E.INTERIOR;else i=E.BOUNDARY;this._label.setLocation(t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Re),ze=function(){this.nodeMap=new h,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};ze.prototype.find=function(t){return this.nodeMap.get(t)},ze.prototype.addNode=function(){if(arguments[0]instanceof S){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Fe){var i=arguments[0],r=this.nodeMap.get(i.getCoordinate());return null===r?(this.nodeMap.put(i.getCoordinate(),i),i):(r.mergeLabel(i),r)}},ze.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},ze.prototype.iterator=function(){return this.nodeMap.values().iterator()},ze.prototype.values=function(){return this.nodeMap.values()},ze.prototype.getBoundaryNodes=function(t){for(var e=new wt,i=this.iterator();i.hasNext();){var r=i.next();r.getLabel().getLocation(t)===E.BOUNDARY&&e.add(r)}return e},ze.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze};var Be=function(){},Ue={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Be.prototype.interfaces_=function(){return[]},Be.prototype.getClass=function(){return Be},Be.isNorthern=function(t){return t===Be.NE||t===Be.NW},Be.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Be.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var i=t<e?t:e;return 0===i&&3===(t>e?t:e)?3:i},Be.isInHalfPlane=function(t,e){return e===Be.SE?t===Be.SE||t===Be.SW:t===e||t===e+1},Be.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new y("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Be.NE:Be.SE:e>=0?Be.NW:Be.SW}if(arguments[0]instanceof S&&arguments[1]instanceof S){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new y("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?Be.NE:Be.SE:r.y>=i.y?Be.NW:Be.SW}},Ue.NE.get=function(){return 0},Ue.NW.get=function(){return 1},Ue.SW.get=function(){return 2},Ue.SE.get=function(){return 3},Object.defineProperties(Be,Ue);var Ve=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],i=arguments[1],r=arguments[2];this._edge=e,this.init(i,r),this._label=null}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=n,this.init(o,s),this._label=a}};Ve.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:at.computeOrientation(t._p0,t._p1,this._p1)},Ve.prototype.getDy=function(){return this._dy},Ve.prototype.getCoordinate=function(){return this._p0},Ve.prototype.setNode=function(t){this._node=t},Ve.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),r=i.lastIndexOf("."),n=i.substring(r+1);t.print("  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},Ve.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},Ve.prototype.getDirectedCoordinate=function(){return this._p1},Ve.prototype.getDx=function(){return this._dx},Ve.prototype.getLabel=function(){return this._label},Ve.prototype.getEdge=function(){return this._edge},Ve.prototype.getQuadrant=function(){return this._quadrant},Ve.prototype.getNode=function(){return this._node},Ve.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},Ve.prototype.computeLabel=function(t){},Ve.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Be.quadrant(this._dx,this._dy),et.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Ve.prototype.interfaces_=function(){return[x]},Ve.prototype.getClass=function(){return Ve};var je=function(t){function e(){var e=arguments[0],i=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var r=e.getNumPoints()-1;this.init(e.getCoordinate(r),e.getCoordinate(r-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new ke(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Ee("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Te.LEFT)===E.INTERIOR&&this._label.getLocation(e,Te.RIGHT)===E.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Te.LEFT]+"/"+this._depth[Te.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,E.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,E.EXTERIOR);return t&&e&&i},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var r=1;t===Te.LEFT&&(r=-1);var n=Te.opposite(t),o=e+i*r;this.setDepth(t,e),this.setDepth(n,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===E.EXTERIOR&&e===E.INTERIOR?1:t===E.INTERIOR&&e===E.EXTERIOR?-1:0},e}(Ve),Ge=function(){};Ge.prototype.createNode=function(t){return new Fe(t,null)},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge};var Ze=function(){if(this._edges=new wt,this._nodes=null,this._edgeEndList=new wt,0===arguments.length)this._nodes=new ze(new Ge);else if(1===arguments.length){var t=arguments[0];this._nodes=new ze(t)}};Ze.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var i=this._edges.get(e);i.print(t),i.eiList.print(t)}},Ze.prototype.find=function(t){return this._nodes.find(t)},Ze.prototype.addNode=function(){if(arguments[0]instanceof Fe){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof S){var e=arguments[0];return this._nodes.addNode(e)}},Ze.prototype.getNodeIterator=function(){return this._nodes.iterator()},Ze.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Ze.prototype.debugPrintln=function(t){Z.out.println(t)},Ze.prototype.isBoundaryNode=function(t,e){var i=this._nodes.find(e);if(null===i)return!1;var r=i.getLabel();return null!==r&&r.getLocation(t)===E.BOUNDARY},Ze.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Ze.prototype.matchInSameDirection=function(t,e,i,r){return!!t.equals(i)&&at.computeOrientation(t,e,r)===at.COLLINEAR&&Be.quadrant(t,e)===Be.quadrant(i,r)},Ze.prototype.getEdgeEnds=function(){return this._edgeEndList},Ze.prototype.debugPrint=function(t){Z.out.print(t)},Ze.prototype.getEdgeIterator=function(){return this._edges.iterator()},Ze.prototype.findEdgeInSameDirection=function(t,e){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(this.matchInSameDirection(t,e,n[0],n[1]))return r;if(this.matchInSameDirection(t,e,n[n.length-1],n[n.length-2]))return r}return null},Ze.prototype.insertEdge=function(t){this._edges.add(t)},Ze.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var i=e.next();if(i.getEdge()===t)return i}return null},Ze.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this._edges.add(i);var r=new je(i,!0),n=new je(i,!1);r.setSym(n),n.setSym(r),this.add(r),this.add(n)}},Ze.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Ze.prototype.getNodes=function(){return this._nodes.values()},Ze.prototype.findEdge=function(t,e){for(var i=0;i<this._edges.size();i++){var r=this._edges.get(i),n=r.getCoordinates();if(t.equals(n[0])&&e.equals(n[1]))return r}return null},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze},Ze.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var qe=function(){this._geometryFactory=null,this._shellList=new wt;var t=arguments[0];this._geometryFactory=t};qe.prototype.sortShellsAndHoles=function(t,e,i){for(var r=t.iterator();r.hasNext();){var n=r.next();n.isHole()?i.add(n):e.add(n)}},qe.prototype.computePolygons=function(t){for(var e=new wt,i=t.iterator();i.hasNext();){var r=i.next().toPolygon(this._geometryFactory);e.add(r)}return e},qe.prototype.placeFreeHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var r=i.next();if(null===r.getShell()){var n=this.findEdgeRingContaining(r,t);if(null===n)throw new Ee("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(n)}}},qe.prototype.buildMinimalEdgeRings=function(t,e,i){for(var r=new wt,n=t.iterator();n.hasNext();){var o=n.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):i.addAll(s)}else r.add(o)}return r},qe.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},qe.prototype.buildMaximalEdgeRings=function(t){for(var e=new wt,i=t.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()){var n=new Oe(r,this._geometryFactory);e.add(n),n.setInResult()}}return e},qe.prototype.placePolygonHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()&&r.setShell(t)}},qe.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},qe.prototype.findEdgeRingContaining=function(t,e){for(var i=t.getLinearRing(),r=i.getEnvelopeInternal(),n=i.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var l=a.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;u.contains(r)&&at.isPointInRing(n,c.getCoordinates())&&(h=!0),h&&(null===o||s.contains(u))&&(o=l)}return o},qe.prototype.findShell=function(t){for(var e=0,i=null,r=t.iterator();r.hasNext();){var n=r.next();n.isHole()||(i=n,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i},qe.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0];Ze.linkResultDirectedEdges(arguments[1]);var i=this.buildMaximalEdgeRings(e),r=new wt,n=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(n,this._shellList,r),this.placeFreeHoles(this._shellList,r)}},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe};var We=function(){};We.prototype.getBounds=function(){},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We};var He=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};He.prototype.getItem=function(){return this._item},He.prototype.getBounds=function(){return this._bounds},He.prototype.interfaces_=function(){return[We,e]},He.prototype.getClass=function(){return He};var Je=function(){this._size=null,this._items=null,this._size=0,this._items=new wt,this._items.add(null)};Je.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},Je.prototype.size=function(){return this._size},Je.prototype.reorder=function(t){for(var e=null,i=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(i)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,i)},Je.prototype.clear=function(){this._size=0,this._items.clear()},Je.prototype.isEmpty=function(){return 0===this._size},Je.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},Je.prototype.interfaces_=function(){return[]},Je.prototype.getClass=function(){return Je};var Ke=function(){};Ke.prototype.visitItem=function(t){},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke};var $e=function(){};$e.prototype.insert=function(t,e){},$e.prototype.remove=function(t,e){},$e.prototype.query=function(){},$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e};var Ye=function(){if(this._childBoundables=new wt,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Xe={serialVersionUID:{configurable:!0}};Ye.prototype.getLevel=function(){return this._level},Ye.prototype.size=function(){return this._childBoundables.size()},Ye.prototype.getChildBoundables=function(){return this._childBoundables},Ye.prototype.addChildBoundable=function(t){et.isTrue(null===this._bounds),this._childBoundables.add(t)},Ye.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Ye.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Ye.prototype.interfaces_=function(){return[We,e]},Ye.prototype.getClass=function(){return Ye},Xe.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Ye,Xe);var Qe=function(){};Qe.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Qe.min=function(t){return Qe.sort(t),t.get(0)},Qe.sort=function(t,e){var i=t.toArray();e?Ft.sort(i,e):Ft.sort(i);for(var r=t.iterator(),n=0,o=i.length;n<o;n++)r.next(),r.set(i[n])},Qe.singletonList=function(t){var e=new wt;return e.add(t),e};var ti=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()};ti.prototype.expandToQueue=function(t,e){var i=ti.isComposite(this._boundable1),r=ti.isComposite(this._boundable2);if(i&&r)return ti.area(this._boundable1)>ti.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new y("neither boundable is composite")},ti.prototype.isLeaves=function(){return!(ti.isComposite(this._boundable1)||ti.isComposite(this._boundable2))},ti.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ti.prototype.expand=function(t,e,i,r){for(var n=t.getChildBoundables().iterator();n.hasNext();){var o=n.next(),s=new ti(o,e,this._itemDistance);s.getDistance()<r&&i.add(s)}},ti.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ti.prototype.getDistance=function(){return this._distance},ti.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ti.prototype.interfaces_=function(){return[x]},ti.prototype.getClass=function(){return ti},ti.area=function(t){return t.getBounds().getArea()},ti.isComposite=function(t){return t instanceof Ye};var ei=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new wt,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var i=arguments[0];et.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}},ii={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ei.prototype.getNodeCapacity=function(){return this._nodeCapacity},ei.prototype.lastNode=function(t){return t.get(t.size()-1)},ei.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();i instanceof Ye?t+=this.size(i):i instanceof He&&(t+=1)}return t}},ei.prototype.removeItem=function(t,e){for(var i=null,r=t.getChildBoundables().iterator();r.hasNext();){var n=r.next();n instanceof He&&n.getItem()===e&&(i=n)}return null!==i&&(t.getChildBoundables().remove(i),!0)},ei.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new wt:t}if(1===arguments.length){for(var e=arguments[0],i=new wt,r=e.getChildBoundables().iterator();r.hasNext();){var n=r.next();if(n instanceof Ye){var o=this.itemsTree(n);null!==o&&i.add(o)}else n instanceof He?i.add(n.getItem()):et.shouldNeverReachHere()}return i.size()<=0?null:i}},ei.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new He(t,e))},ei.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new wt;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];if(et.isTrue(i>-2),r.getLevel()===i)return n.add(r),null;for(var o=r.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Ye?this.boundablesAtLevel(i,s,n):(et.isTrue(s instanceof He),-1===i&&n.add(s))}return null}},ei.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new wt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(3===arguments.length)if(L(arguments[2],Ke)&&arguments[0]instanceof Object&&arguments[1]instanceof Ye)for(var n=arguments[0],o=arguments[2],s=arguments[1].getChildBoundables(),a=0;a<s.size();a++){var l=s.get(a);this.getIntersectsOp().intersects(l.getBounds(),n)&&(l instanceof Ye?this.query(n,l,o):l instanceof He?o.visitItem(l.getItem()):et.shouldNeverReachHere())}else if(L(arguments[2],bt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ye)for(var c=arguments[0],u=arguments[2],h=arguments[1].getChildBoundables(),p=0;p<h.size();p++){var d=h.get(p);this.getIntersectsOp().intersects(d.getBounds(),c)&&(d instanceof Ye?this.query(c,d,u):d instanceof He?u.add(d.getItem()):et.shouldNeverReachHere())}},ei.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},ei.prototype.getRoot=function(){return this.build(),this._root},ei.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=this.removeItem(r,n);if(o)return!0;for(var s=null,a=r.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),i)&&l instanceof Ye&&(o=this.remove(i,l,n))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(s),o}},ei.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var i=this.createParentBoundables(t,e+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,e+1)},ei.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();if(i instanceof Ye){var r=this.depth(i);r>t&&(t=r)}}return t+1}},ei.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var i=new wt;i.add(this.createNode(e));var r=new wt(t);Qe.sort(r,this.getComparator());for(var n=r.iterator();n.hasNext();){var o=n.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(e)),this.lastNode(i).addChildBoundable(o)}return i},ei.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},ei.prototype.interfaces_=function(){return[e]},ei.prototype.getClass=function(){return ei},ei.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},ii.IntersectsOp.get=function(){return ri},ii.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ii.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(ei,ii);var ri=function(){},ni=function(){};ni.prototype.distance=function(t,e){},ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni};var oi=function(t){function i(e){e=e||i.DEFAULT_NODE_CAPACITY,t.call(this,e)}t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return i.prototype.createParentBoundablesFromVerticalSlices=function(t,e){et.isTrue(t.length>0);for(var i=new wt,r=0;r<t.length;r++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[r],e));return i},i.prototype.createNode=function(t){return new si(t)},i.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},i.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],i=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,i)},i.prototype.getIntersectsOp=function(){return i.intersectsOp},i.prototype.verticalSlices=function(t,e){for(var i=Math.trunc(Math.ceil(t.size()/e)),r=new Array(e).fill(null),n=t.iterator(),o=0;o<e;o++){r[o]=new wt;for(var s=0;n.hasNext()&&s<i;){var a=n.next();r[o].add(a),s++}}return r},i.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var i=arguments[0],r=arguments[1];t.prototype.query.call(this,i,r)}else if(3===arguments.length)if(L(arguments[2],Ke)&&arguments[0]instanceof Object&&arguments[1]instanceof Ye){var n=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,n,o,s)}else if(L(arguments[2],bt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ye){var a=arguments[0],l=arguments[1],c=arguments[2];t.prototype.query.call(this,a,l,c)}},i.prototype.getComparator=function(){return i.yComparator},i.prototype.createParentBoundablesFromVerticalSlice=function(e,i){return t.prototype.createParentBoundables.call(this,e,i)},i.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return t.prototype.remove.call(this,e,i)}return t.prototype.remove.apply(this,arguments)},i.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},i.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var r=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),n=new wt(t);Qe.sort(n,i.xComparator);var o=this.verticalSlices(n,Math.trunc(Math.ceil(Math.sqrt(r))));return this.createParentBoundablesFromVerticalSlices(o,e)},i.prototype.nearestNeighbour=function(){if(1===arguments.length){if(L(arguments[0],ni)){var t=arguments[0],e=new ti(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof ti){var r=arguments[0];return this.nearestNeighbour(r,A.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof i&&L(arguments[1],ni)){var n=arguments[0],o=arguments[1],s=new ti(this.getRoot(),n.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof ti&&"number"==typeof arguments[1]){var a=arguments[0],l=arguments[1],c=null,u=new Je;for(u.add(a);!u.isEmpty()&&l>0;){var h=u.poll(),p=h.getDistance();if(p>=l)break;h.isLeaves()?(l=p,c=h):h.expandToQueue(u,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=arguments[2],f=new He(arguments[0],arguments[1]),m=new ti(this.getRoot(),f,d);return this.nearestNeighbour(m)[0]}},i.prototype.interfaces_=function(){return[$e,e]},i.prototype.getClass=function(){return i},i.centreX=function(t){return i.avg(t.getMinX(),t.getMaxX())},i.avg=function(t,e){return(t+e)/2},i.centreY=function(t){return i.avg(t.getMinY(),t.getMaxY())},r.STRtreeNode.get=function(){return si},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[w]},compare:function(e,r){return t.compareDoubles(i.centreX(e.getBounds()),i.centreX(r.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[w]},compare:function(e,r){return t.compareDoubles(i.centreY(e.getBounds()),i.centreY(r.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(i,r),i}(ei),si=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var i=e.next();null===t?t=new W(i.getBounds()):t.expandToInclude(i.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ye),ai=function(){};ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai},ai.relativeSign=function(t,e){return t<e?-1:t>e?1:0},ai.compare=function(t,e,i){if(e.equals2D(i))return 0;var r=ai.relativeSign(e.x,i.x),n=ai.relativeSign(e.y,i.y);switch(t){case 0:return ai.compareValue(r,n);case 1:return ai.compareValue(n,r);case 2:return ai.compareValue(n,-r);case 3:return ai.compareValue(-r,n);case 4:return ai.compareValue(-r,-n);case 5:return ai.compareValue(-n,-r);case 6:return ai.compareValue(-n,r);case 7:return ai.compareValue(r,-n)}return et.shouldNeverReachHere("invalid octant value"),0},ai.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var li=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this._segString=t,this.coord=new S(e),this.segmentIndex=i,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(i))};li.prototype.getCoordinate=function(){return this.coord},li.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},li.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ai.compare(this._segmentOctant,this.coord,e.coord)},li.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},li.prototype.isInterior=function(){return this._isInterior},li.prototype.interfaces_=function(){return[x]},li.prototype.getClass=function(){return li};var ci=function(){this._nodeMap=new h,this._edge=null;var t=arguments[0];this._edge=t};ci.prototype.getSplitCoordinates=function(){var t=new Tt;this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var r=e.next();this.addEdgeCoordinates(i,r,t),i=r}return t.toCoordinateArray()},ci.prototype.addCollapsedNodes=function(){var t=new wt;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var i=e.next().intValue();this.add(this._edge.getCoordinate(i),i)}},ci.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},ci.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var i=this._edge.getCoordinate(e),r=this._edge.getCoordinate(e+2);i.equals2D(r)&&t.add(new D(e+1))}},ci.prototype.addEdgeCoordinates=function(t,e,i){var r=this._edge.getCoordinate(e.segmentIndex),n=e.isInterior()||!e.coord.equals2D(r);i.add(new S(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)i.add(this._edge.getCoordinate(o));n&&i.add(new S(e.coord))},ci.prototype.iterator=function(){return this._nodeMap.values().iterator()},ci.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),i=e.next();e.hasNext();){var r=e.next(),n=this.createSplitEdge(i,r);t.add(n),i=r}},ci.prototype.findCollapseIndex=function(t,e,i){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,1===r&&(i[0]=t.segmentIndex+1,!0)},ci.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var n=i.next();this.findCollapseIndex(r,n,e)&&t.add(new D(e[0])),r=n}},ci.prototype.getEdge=function(){return this._edge},ci.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},ci.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,r=this._edge.getCoordinate(e.segmentIndex),n=e.isInterior()||!e.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return n&&(o[s]=new S(e.coord)),new di(o,this._edge.getData())},ci.prototype.add=function(t,e){var i=new li(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(i);return null!==r?(et.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(i,i),i)},ci.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new Q("bad split edge start point at "+i);var r=t.get(t.size()-1).getCoordinates(),n=r[r.length-1];if(!n.equals2D(e[e.length-1]))throw new Q("bad split edge end point at "+n)},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var ui=function(){};ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new y("Cannot compute the octant for point ( "+t+", "+e+" )");var i=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?i>=r?0:1:i>=r?7:6:e>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof S&&arguments[1]instanceof S){var n=arguments[0],o=arguments[1],s=o.x-n.x,a=o.y-n.y;if(0===s&&0===a)throw new y("Cannot compute the octant for two identical points "+n);return ui.octant(s,a)}};var hi=function(){};hi.prototype.getCoordinates=function(){},hi.prototype.size=function(){},hi.prototype.getCoordinate=function(t){},hi.prototype.isClosed=function(){},hi.prototype.setData=function(t){},hi.prototype.getData=function(){},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi};var pi=function(){};pi.prototype.addIntersection=function(t,e){},pi.prototype.interfaces_=function(){return[hi]},pi.prototype.getClass=function(){return pi};var di=function(){this._nodeList=new ci(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};di.prototype.getCoordinates=function(){return this._pts},di.prototype.size=function(){return this._pts.length},di.prototype.getCoordinate=function(t){return this._pts[t]},di.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},di.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},di.prototype.setData=function(t){this._data=t},di.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ui.octant(t,e)},di.prototype.getData=function(){return this._data},di.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var i=arguments[1],r=arguments[3],n=new S(arguments[0].getIntersection(r));this.addIntersection(n,i)}},di.prototype.toString=function(){return X.toLineString(new le(this._pts))},di.prototype.getNodeList=function(){return this._nodeList},di.prototype.addIntersectionNode=function(t,e){var i=e,r=i+1;if(r<this._pts.length){var n=this._pts[r];t.equals2D(n)&&(i=r)}return this._nodeList.add(t,i)},di.prototype.addIntersections=function(t,e,i){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,i,r)},di.prototype.interfaces_=function(){return[pi]},di.prototype.getClass=function(){return di},di.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new wt;return di.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var i=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(i)};var fi=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new S,this.p1=new S;else if(1===arguments.length){var t=arguments[0];this.p0=new S(t.p0),this.p1=new S(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];this.p0=new S(e,i),this.p1=new S(r,n)}},mi={serialVersionUID:{configurable:!0}};fi.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},fi.prototype.orientationIndex=function(){if(arguments[0]instanceof fi){var t=arguments[0],e=at.orientationIndex(this.p0,this.p1,t.p0),i=at.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}if(arguments[0]instanceof S){var r=arguments[0];return at.orientationIndex(this.p0,this.p1,r)}},fi.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},fi.prototype.isVertical=function(){return this.p0.x===this.p1.x},fi.prototype.equals=function(t){if(!(t instanceof fi))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},fi.prototype.intersection=function(t){var e=new nt;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},fi.prototype.project=function(){if(arguments[0]instanceof S){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new S(t);var e=this.projectionFactor(t),i=new S;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof fi){var r=arguments[0],n=this.projectionFactor(r.p0),o=this.projectionFactor(r.p1);if(n>=1&&o>=1)return null;if(n<=0&&o<=0)return null;var s=this.project(r.p0);n<0&&(s=this.p0),n>1&&(s=this.p1);var a=this.project(r.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new fi(s,a)}},fi.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},fi.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},fi.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},fi.prototype.distancePerpendicular=function(t){return at.distancePointLinePerpendicular(t,this.p0,this.p1)},fi.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},fi.prototype.midPoint=function(){return fi.midPoint(this.p0,this.p1)},fi.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,r=e*e+i*i;return r<=0?A.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/r},fi.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var i=new Array(2).fill(null),r=A.MAX_VALUE,n=null,o=this.closestPoint(t.p0);r=o.distance(t.p0),i[0]=o,i[1]=t.p0;var s=this.closestPoint(t.p1);(n=s.distance(t.p1))<r&&(r=n,i[0]=s,i[1]=t.p1);var a=t.closestPoint(this.p0);(n=a.distance(this.p0))<r&&(r=n,i[0]=this.p0,i[1]=a);var l=t.closestPoint(this.p1);return(n=l.distance(this.p1))<r&&(r=n,i[0]=this.p1,i[1]=l),i},fi.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},fi.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},fi.prototype.getLength=function(){return this.p0.distance(this.p1)},fi.prototype.compareTo=function(t){var e=t,i=this.p0.compareTo(e.p0);return 0!==i?i:this.p1.compareTo(e.p1)},fi.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},fi.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},fi.prototype.lineIntersection=function(t){try{return q.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof G))throw t}return null},fi.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},fi.prototype.pointAlongOffset=function(t,e){var i=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),n=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(n*n+o*o),a=0,l=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*n/s,l=e*o/s}return new S(i-l,r+a)},fi.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=i.x,this.p1.y=i.y}},fi.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||A.isNaN(e))&&(e=1),e},fi.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},fi.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},fi.prototype.distance=function(){if(arguments[0]instanceof fi){var t=arguments[0];return at.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof S){var e=arguments[0];return at.distancePointLine(e,this.p0,this.p1)}},fi.prototype.pointAlong=function(t){var e=new S;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},fi.prototype.hashCode=function(){var t=A.doubleToLongBits(this.p0.x);t^=31*A.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),i=A.doubleToLongBits(this.p1.x);return i^=31*A.doubleToLongBits(this.p1.y),e^Math.trunc(i)^Math.trunc(i>>32)},fi.prototype.interfaces_=function(){return[x,e]},fi.prototype.getClass=function(){return fi},fi.midPoint=function(t,e){return new S((t.x+e.x)/2,(t.y+e.y)/2)},mi.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(fi,mi);var gi=function(){this.tempEnv1=new W,this.tempEnv2=new W,this._overlapSeg1=new fi,this._overlapSeg2=new fi};gi.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi};var _i=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=r};_i.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},_i.prototype.computeSelect=function(t,e,i,r){var n=this._pts[e],o=this._pts[i];if(r.tempEnv1.init(n,o),i-e==1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var s=Math.trunc((e+i)/2);e<s&&this.computeSelect(t,e,s,r),s<i&&this.computeSelect(t,s,i,r)},_i.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t},_i.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},_i.prototype.setId=function(t){this._id=t},_i.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},_i.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new W(t,e)}return this._env},_i.prototype.getEndIndex=function(){return this._end},_i.prototype.getStartIndex=function(){return this._start},_i.prototype.getContext=function(){return this._context},_i.prototype.getId=function(){return this._id},_i.prototype.computeOverlapsInternal=function(t,e,i,r,n,o){var s=this._pts[t],a=this._pts[e],l=i._pts[r],c=i._pts[n];if(e-t==1&&n-r==1)return o.overlap(this,t,i,r),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((t+e)/2),h=Math.trunc((r+n)/2);t<u&&(r<h&&this.computeOverlapsInternal(t,u,i,r,h,o),h<n&&this.computeOverlapsInternal(t,u,i,h,n,o)),u<e&&(r<h&&this.computeOverlapsInternal(u,e,i,r,h,o),h<n&&this.computeOverlapsInternal(u,e,i,h,n,o))},_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i};var yi=function(){};yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi},yi.getChainStartIndices=function(t){var e=0,i=new wt;i.add(new D(e));do{var r=yi.findChainEnd(t,e);i.add(new D(r)),e=r}while(e<t.length-1);return yi.toIntArray(i)},yi.findChainEnd=function(t,e){for(var i=e;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;for(var r=Be.quadrant(t[i],t[i+1]),n=e+1;n<t.length&&(t[n-1].equals2D(t[n])||Be.quadrant(t[n-1],t[n])===r);)n++;return n-1},yi.getChains=function(){if(1===arguments.length)return yi.getChains(arguments[0],null);if(2===arguments.length){for(var t=arguments[0],e=arguments[1],i=new wt,r=yi.getChainStartIndices(t),n=0;n<r.length-1;n++){var o=new _i(t,r[n],r[n+1],e);i.add(o)}return i}},yi.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var Ai=function(){};Ai.prototype.computeNodes=function(t){},Ai.prototype.getNodedSubstrings=function(){},Ai.prototype.interfaces_=function(){return[]},Ai.prototype.getClass=function(){return Ai};var vi=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};vi.prototype.setSegmentIntersector=function(t){this._segInt=t},vi.prototype.interfaces_=function(){return[Ai]},vi.prototype.getClass=function(){return vi};var xi=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new wt,this._index=new oi,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return di.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=yi.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var i=e.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new bi(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var i=e.next(),r=this._index.query(i.getEnvelope()).iterator();r.hasNext();){var n=r.next();if(n.getId()>i.getId()&&(i.computeOverlaps(n,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return bi},Object.defineProperties(e,i),e}(vi),bi=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],i=arguments[2],r=arguments[3],n=arguments[0].getContext(),o=i.getContext();this._si.processIntersections(n,e,o,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gi),wi=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(r)}else if(4===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(n),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Si={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};wi.prototype.getEndCapStyle=function(){return this._endCapStyle},wi.prototype.isSingleSided=function(){return this._isSingleSided},wi.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=wi.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=wi.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==wi.JOIN_ROUND&&(this._quadrantSegments=wi.DEFAULT_QUADRANT_SEGMENTS)},wi.prototype.getJoinStyle=function(){return this._joinStyle},wi.prototype.setJoinStyle=function(t){this._joinStyle=t},wi.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},wi.prototype.getSimplifyFactor=function(){return this._simplifyFactor},wi.prototype.getQuadrantSegments=function(){return this._quadrantSegments},wi.prototype.setEndCapStyle=function(t){this._endCapStyle=t},wi.prototype.getMitreLimit=function(){return this._mitreLimit},wi.prototype.setMitreLimit=function(t){this._mitreLimit=t},wi.prototype.setSingleSided=function(t){this._isSingleSided=t},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi},wi.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Si.CAP_ROUND.get=function(){return 1},Si.CAP_FLAT.get=function(){return 2},Si.CAP_SQUARE.get=function(){return 3},Si.JOIN_ROUND.get=function(){return 1},Si.JOIN_MITRE.get=function(){return 2},Si.JOIN_BEVEL.get=function(){return 3},Si.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Si.DEFAULT_MITRE_LIMIT.get=function(){return 5},Si.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(wi,Si);var Ti=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=at.COUNTERCLOCKWISE,this._inputLine=t||null},Ci={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ti.prototype.isDeletable=function(t,e,i,r){var n=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[i];return!!this.isConcave(n,o,s)&&!!this.isShallow(n,o,s,r)&&this.isShallowSampled(n,o,t,i,r)},Ti.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e),r=!1;i<this._inputLine.length;){var n=!1;this.isDeletable(t,e,i,this._distanceTol)&&(this._isDeleted[e]=Ti.DELETE,n=!0,r=!0),t=n?i:e,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e)}return r},Ti.prototype.isShallowConcavity=function(t,e,i,r){return at.computeOrientation(t,e,i)===this._angleOrientation&&at.distancePointLine(e,t,i)<r},Ti.prototype.isShallowSampled=function(t,e,i,r,n){var o=Math.trunc((r-i)/Ti.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<r;s+=o)if(!this.isShallow(t,e,this._inputLine[s],n))return!1;return!0},Ti.prototype.isConcave=function(t,e,i){return at.computeOrientation(t,e,i)===this._angleOrientation},Ti.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=at.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Ti.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ti.DELETE;)e++;return e},Ti.prototype.isShallow=function(t,e,i,r){return at.distancePointLine(e,t,i)<r},Ti.prototype.collapseLine=function(){for(var t=new Tt,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ti.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti},Ti.simplify=function(t,e){return new Ti(t).simplify(e)},Ci.INIT.get=function(){return 0},Ci.DELETE.get=function(){return 1},Ci.KEEP.get=function(){return 1},Ci.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ti,Ci);var Mi=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new wt},Ei={COORDINATE_ARRAY_TYPE:{configurable:!0}};Mi.prototype.getCoordinates=function(){return this._ptList.toArray(Mi.COORDINATE_ARRAY_TYPE)},Mi.prototype.setPrecisionModel=function(t){this._precisionModel=t},Mi.prototype.addPt=function(t){var e=new S(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Mi.prototype.revere=function(){},Mi.prototype.addPts=function(t,e){if(e)for(var i=0;i<t.length;i++)this.addPt(t[i]);else for(var r=t.length-1;r>=0;r--)this.addPt(t[r])},Mi.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Mi.prototype.toString=function(){return(new _e).createLineString(this.getCoordinates()).toString()},Mi.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new S(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Mi.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi},Ei.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Mi,Ei);var Ii=function(){},Li={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.toDegrees=function(t){return 180*t/Math.PI},Ii.normalize=function(t){for(;t>Math.PI;)t-=Ii.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ii.PI_TIMES_2;return t},Ii.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],i=arguments[1],r=i.x-e.x,n=i.y-e.y;return Math.atan2(n,r)}},Ii.isAcute=function(t,e,i){var r=t.x-e.x,n=t.y-e.y;return r*(i.x-e.x)+n*(i.y-e.y)>0},Ii.isObtuse=function(t,e,i){var r=t.x-e.x,n=t.y-e.y;return r*(i.x-e.x)+n*(i.y-e.y)<0},Ii.interiorAngle=function(t,e,i){var r=Ii.angle(e,t),n=Ii.angle(e,i);return Math.abs(n-r)},Ii.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ii.PI_TIMES_2;t>=Ii.PI_TIMES_2&&(t=0)}else{for(;t>=Ii.PI_TIMES_2;)t-=Ii.PI_TIMES_2;t<0&&(t=0)}return t},Ii.angleBetween=function(t,e,i){var r=Ii.angle(e,t),n=Ii.angle(e,i);return Ii.diff(r,n)},Ii.diff=function(t,e){var i=null;return(i=t<e?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},Ii.toRadians=function(t){return t*Math.PI/180},Ii.getTurn=function(t,e){var i=Math.sin(e-t);return i>0?Ii.COUNTERCLOCKWISE:i<0?Ii.CLOCKWISE:Ii.NONE},Ii.angleBetweenOriented=function(t,e,i){var r=Ii.angle(e,t),n=Ii.angle(e,i)-r;return n<=-Math.PI?n+Ii.PI_TIMES_2:n>Math.PI?n-Ii.PI_TIMES_2:n},Li.PI_TIMES_2.get=function(){return 2*Math.PI},Li.PI_OVER_2.get=function(){return Math.PI/2},Li.PI_OVER_4.get=function(){return Math.PI/4},Li.COUNTERCLOCKWISE.get=function(){return at.COUNTERCLOCKWISE},Li.CLOCKWISE.get=function(){return at.CLOCKWISE},Li.NONE.get=function(){return at.COLLINEAR},Object.defineProperties(Ii,Li);var Pi=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new fi,this._seg1=new fi,this._offset0=new fi,this._offset1=new fi,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],i=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=i,this._li=new nt,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===wi.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},ki={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Pi.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=at.computeOrientation(this._s0,this._s1,this._s2),r=i===at.CLOCKWISE&&this._side===Te.LEFT||i===at.COUNTERCLOCKWISE&&this._side===Te.RIGHT;0===i?this.addCollinear(e):r?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)},Pi.prototype.addLineEndCap=function(t,e){var i=new fi(t,e),r=new fi;this.computeOffsetSegment(i,Te.LEFT,this._distance,r);var n=new fi;this.computeOffsetSegment(i,Te.RIGHT,this._distance,n);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case wi.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,at.CLOCKWISE,this._distance),this._segList.addPt(n.p1);break;case wi.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(n.p1);break;case wi.CAP_SQUARE:var l=new S;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var c=new S(r.p1.x+l.x,r.p1.y+l.y),u=new S(n.p1.x+l.x,n.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}},Pi.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Pi.prototype.addMitreJoin=function(t,e,i,r){var n=!0,o=null;try{o=q.intersection(e.p0,e.p1,i.p0,i.p1),(r<=0?1:o.distance(t)/Math.abs(r))>this._bufParams.getMitreLimit()&&(n=!1)}catch(t){if(!(t instanceof G))throw t;o=new S(0,0),n=!1}n?this._segList.addPt(o):this.addLimitedMitreJoin(e,i,r,this._bufParams.getMitreLimit())},Pi.prototype.addFilletCorner=function(t,e,i,r,n){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),l=i.x-t.x,c=i.y-t.y,u=Math.atan2(c,l);r===at.CLOCKWISE?a<=u&&(a+=2*Math.PI):a>=u&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,u,r,n),this._segList.addPt(i)},Pi.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Pi.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===wi.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===wi.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Pi.prototype.createSquare=function(t){this._segList.addPt(new S(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new S(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Pi.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Pi.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Pi.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Pi.prototype.initSideSegments=function(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},Pi.prototype.addLimitedMitreJoin=function(t,e,i,r){var n=this._seg0.p1,o=Ii.angle(n,this._seg0.p0),s=Ii.angleBetweenOriented(this._seg0.p0,n,this._seg1.p1)/2,a=Ii.normalize(o+s),l=Ii.normalize(a+Math.PI),c=r*i,u=i-c*Math.abs(Math.sin(s)),h=n.x+c*Math.cos(l),p=n.y+c*Math.sin(l),d=new S(h,p),f=new fi(n,d),m=f.pointAlongOffset(1,u),g=f.pointAlongOffset(1,-u);this._side===Te.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Pi.prototype.computeOffsetSegment=function(t,e,i,r){var n=e===Te.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),l=n*i*o/a,c=n*i*s/a;r.p0.x=t.p0.x-c,r.p0.y=t.p0.y+l,r.p1.x=t.p1.x-c,r.p1.y=t.p1.y+l},Pi.prototype.addFilletArc=function(t,e,i,r,n){var o=r===at.CLOCKWISE?-1:1,s=Math.abs(e-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,c=0,u=new S;c<s;){var h=e+o*c;u.x=t.x+n*Math.cos(h),u.y=t.y+n*Math.sin(h),this._segList.addPt(u),c+=l}},Pi.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Pi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new S((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var r=new S((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Pi.prototype.createCircle=function(t){var e=new S(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Pi.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Pi.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Mi,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Pi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Pi.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===wi.JOIN_BEVEL||this._bufParams.getJoinStyle()===wi.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,at.CLOCKWISE,this._distance))},Pi.prototype.closeRing=function(){this._segList.closeRing()},Pi.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},ki.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},ki.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},ki.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},ki.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Pi,ki);var Ni=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Ni.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var i=e<0,r=Math.abs(e),n=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],n):this.computeOffsetCurve(t,i,n);var o=n.getCoordinates();return i&&Ct.reverse(o),o},Ni.prototype.computeSingleSidedBufferCurve=function(t,e,i){var r=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);var n=Ti.simplify(t,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],Te.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{i.addSegments(t,!1);var a=Ti.simplify(t,r),l=a.length-1;i.initSideSegments(a[0],a[1],Te.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment(),i.closeRing()},Ni.prototype.computeRingBufferCurve=function(t,e,i){var r=this.simplifyTolerance(this._distance);e===Te.RIGHT&&(r=-r);var n=Ti.simplify(t,r),o=n.length-1;i.initSideSegments(n[o-1],n[0],e);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(n[s],a)}i.closeRing()},Ni.prototype.computeLineBufferCurve=function(t,e){var i=this.simplifyTolerance(this._distance),r=Ti.simplify(t,i),n=r.length-1;e.initSideSegments(r[0],r[1],Te.LEFT);for(var o=2;o<=n;o++)e.addNextSegment(r[o],!0);e.addLastSegment(),e.addLineEndCap(r[n-1],r[n]);var s=Ti.simplify(t,-i),a=s.length-1;e.initSideSegments(s[a],s[a-1],Te.LEFT);for(var l=a-2;l>=0;l--)e.addNextSegment(s[l],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Ni.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case wi.CAP_ROUND:e.createCircle(t);break;case wi.CAP_SQUARE:e.createSquare(t)}},Ni.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var i=Math.abs(e),r=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var n=e<0;this.computeSingleSidedBufferCurve(t,n,r)}else this.computeLineBufferCurve(t,r);return r.getCoordinates()},Ni.prototype.getBufferParameters=function(){return this._bufParams},Ni.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},Ni.prototype.getRingCurve=function(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return Ni.copyCoordinates(t);var r=this.getSegGen(i);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()},Ni.prototype.computeOffsetCurve=function(t,e,i){var r=this.simplifyTolerance(this._distance);if(e){var n=Ti.simplify(t,-r),o=n.length-1;i.initSideSegments(n[o],n[o-1],Te.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(n[s],!0)}else{var a=Ti.simplify(t,r),l=a.length-1;i.initSideSegments(a[0],a[1],Te.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment()},Ni.prototype.getSegGen=function(t){return new Pi(this._precisionModel,this._bufParams,t)},Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni},Ni.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),i=0;i<e.length;i++)e[i]=new S(t[i]);return e};var Di=function(){this._subgraphs=null,this._seg=new fi,this._cga=new at;var t=arguments[0];this._subgraphs=t},Oi={DepthSegment:{configurable:!0}};Di.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new wt,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),n=r.getEnvelope();t.y<n.getMinY()||t.y>n.getMaxY()||this.findStabbedSegments(t,r.getDirectedEdges(),e)}return e}if(3===arguments.length)if(L(arguments[2],bt)&&arguments[0]instanceof S&&arguments[1]instanceof je){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||at.computeOrientation(this._seg.p0,this._seg.p1,o)===at.RIGHT)){var u=s.getDepth(Te.LEFT);this._seg.p0.equals(l[c])||(u=s.getDepth(Te.RIGHT));var h=new Ri(this._seg,u);a.add(h)}}else if(L(arguments[2],bt)&&arguments[0]instanceof S&&L(arguments[1],bt))for(var p=arguments[0],d=arguments[2],f=arguments[1].iterator();f.hasNext();){var m=f.next();m.isForward()&&this.findStabbedSegments(p,m,d)}},Di.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Qe.min(e)._leftDepth},Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Oi.DepthSegment.get=function(){return Ri},Object.defineProperties(Di,Oi);var Ri=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new fi(t),this._leftDepth=e};Ri.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==i||0!=(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(e._upwardSeg)},Ri.prototype.compareX=function(t,e){var i=t.p0.compareTo(e.p0);return 0!==i?i:t.p1.compareTo(e.p1)},Ri.prototype.toString=function(){return this._upwardSeg.toString()},Ri.prototype.interfaces_=function(){return[x]},Ri.prototype.getClass=function(){return Ri};var Fi=function(t,e,i){this.p0=t||null,this.p1=e||null,this.p2=i||null};Fi.prototype.area=function(){return Fi.area(this.p0,this.p1,this.p2)},Fi.prototype.signedArea=function(){return Fi.signedArea(this.p0,this.p1,this.p2)},Fi.prototype.interpolateZ=function(t){if(null===t)throw new y("Supplied point is null.");return Fi.interpolateZ(t,this.p0,this.p1,this.p2)},Fi.prototype.longestSideLength=function(){return Fi.longestSideLength(this.p0,this.p1,this.p2)},Fi.prototype.isAcute=function(){return Fi.isAcute(this.p0,this.p1,this.p2)},Fi.prototype.circumcentre=function(){return Fi.circumcentre(this.p0,this.p1,this.p2)},Fi.prototype.area3D=function(){return Fi.area3D(this.p0,this.p1,this.p2)},Fi.prototype.centroid=function(){return Fi.centroid(this.p0,this.p1,this.p2)},Fi.prototype.inCentre=function(){return Fi.inCentre(this.p0,this.p1,this.p2)},Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Fi.area=function(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)},Fi.signedArea=function(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2},Fi.det=function(t,e,i,r){return t*r-e*i},Fi.interpolateZ=function(t,e,i,r){var n=e.x,o=e.y,s=i.x-n,a=r.x-n,l=i.y-o,c=r.y-o,u=s*c-a*l,h=t.x-n,p=t.y-o,d=(c*h-a*p)/u,f=(-l*h+s*p)/u;return e.z+d*(i.z-e.z)+f*(r.z-e.z)},Fi.longestSideLength=function(t,e,i){var r=t.distance(e),n=e.distance(i),o=i.distance(t),s=r;return n>s&&(s=n),o>s&&(s=o),s},Fi.isAcute=function(t,e,i){return!!Ii.isAcute(t,e,i)&&!!Ii.isAcute(e,i,t)&&!!Ii.isAcute(i,t,e)},Fi.circumcentre=function(t,e,i){var r=i.x,n=i.y,o=t.x-r,s=t.y-n,a=e.x-r,l=e.y-n,c=2*Fi.det(o,s,a,l),u=Fi.det(s,o*o+s*s,l,a*a+l*l),h=Fi.det(o,o*o+s*s,a,a*a+l*l);return new S(r-u/c,n+h/c)},Fi.perpendicularBisector=function(t,e){var i=e.x-t.x,r=e.y-t.y,n=new q(t.x+i/2,t.y+r/2,1),o=new q(t.x-r+i/2,t.y+i+r/2,1);return new q(n,o)},Fi.angleBisector=function(t,e,i){var r=e.distance(t),n=r/(r+e.distance(i)),o=i.x-t.x,s=i.y-t.y;return new S(t.x+n*o,t.y+n*s)},Fi.area3D=function(t,e,i){var r=e.x-t.x,n=e.y-t.y,o=e.z-t.z,s=i.x-t.x,a=i.y-t.y,l=i.z-t.z,c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,p=c*c+u*u+h*h;return Math.sqrt(p)/2},Fi.centroid=function(t,e,i){var r=(t.x+e.x+i.x)/3,n=(t.y+e.y+i.y)/3;return new S(r,n)},Fi.inCentre=function(t,e,i){var r=e.distance(i),n=t.distance(i),o=t.distance(e),s=r+n+o,a=(r*t.x+n*e.x+o*i.x)/s,l=(r*t.y+n*e.y+o*i.y)/s;return new S(a,l)};var zi=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new wt;var t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i};zi.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,E.EXTERIOR,E.INTERIOR)},zi.prototype.addPolygon=function(t){var e=this._distance,i=Te.LEFT;this._distance<0&&(e=-this._distance,i=Te.RIGHT);var r=t.getExteriorRing(),n=Ct.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance))return null;if(this._distance<=0&&n.length<3)return null;this.addPolygonRing(n,e,i,E.EXTERIOR,E.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var s=t.getInteriorRingN(o),a=Ct.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,e,Te.opposite(i),E.INTERIOR,E.EXTERIOR)}},zi.prototype.isTriangleErodedCompletely=function(t,e){var i=new Fi(t[0],t[1],t[2]),r=i.inCentre();return at.distancePointLine(r,i.p0,i.p1)<Math.abs(e)},zi.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Ct.removeRepeatedPoints(t.getCoordinates()),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,E.EXTERIOR,E.INTERIOR)},zi.prototype.addCurve=function(t,e,i){if(null===t||t.length<2)return null;var r=new di(t,new ke(0,E.BOUNDARY,e,i));this._curveList.add(r)},zi.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},zi.prototype.addPolygonRing=function(t,e,i,r,n){if(0===e&&t.length<ee.MINIMUM_VALID_SIZE)return null;var o=r,s=n;t.length>=ee.MINIMUM_VALID_SIZE&&at.isCCW(t)&&(o=n,s=r,i=Te.opposite(i));var a=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(a,o,s)},zi.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Qt?this.addPolygon(t):t instanceof Kt?this.addLineString(t):t instanceof Yt?this.addPoint(t):(t instanceof te||t instanceof Gt||t instanceof ie||t instanceof jt)&&this.addCollection(t)},zi.prototype.isErodedCompletely=function(t,e){var i=t.getCoordinates();if(i.length<4)return e<0;if(4===i.length)return this.isTriangleErodedCompletely(i,e);var r=t.getEnvelopeInternal(),n=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>n},zi.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi};var Bi=function(){};Bi.prototype.locate=function(t){},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi};var Ui=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Ui.prototype.next=function(){if(this._atStart)return this._atStart=!1,Ui.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new r;var t=this._parent.getGeometryN(this._index++);return t instanceof jt?(this._subcollectionIterator=new Ui(t),this._subcollectionIterator.next()):t},Ui.prototype.remove=function(){throw new Error(this.getClass().getName())},Ui.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Ui.prototype.interfaces_=function(){return[xt]},Ui.prototype.getClass=function(){return Ui},Ui.isAtomic=function(t){return!(t instanceof jt)};var Vi=function(){this._geom=null;var t=arguments[0];this._geom=t};Vi.prototype.locate=function(t){return Vi.locate(t,this._geom)},Vi.prototype.interfaces_=function(){return[Bi]},Vi.prototype.getClass=function(){return Vi},Vi.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&at.isPointInRing(t,e.getCoordinates())},Vi.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var i=e.getExteriorRing();if(!Vi.isPointInRing(t,i))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var n=e.getInteriorRingN(r);if(Vi.isPointInRing(t,n))return!1}return!0},Vi.containsPoint=function(t,e){if(e instanceof Qt)return Vi.containsPointInPolygon(t,e);if(e instanceof jt)for(var i=new Ui(e);i.hasNext();){var r=i.next();if(r!==e&&Vi.containsPoint(t,r))return!0}return!1},Vi.locate=function(t,e){return e.isEmpty()?E.EXTERIOR:Vi.containsPoint(t,e)?E.INTERIOR:E.EXTERIOR};var ji=function(){this._edgeMap=new h,this._edgeList=null,this._ptInAreaLocation=[E.NONE,E.NONE]};ji.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),i=e-1;return 0===e&&(i=this._edgeList.size()-1),this._edgeList.get(i)},ji.prototype.propagateSideLabels=function(t){for(var e=E.NONE,i=this.iterator();i.hasNext();){var r=i.next().getLabel();r.isArea(t)&&r.getLocation(t,Te.LEFT)!==E.NONE&&(e=r.getLocation(t,Te.LEFT))}if(e===E.NONE)return null;for(var n=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Te.ON)===E.NONE&&a.setLocation(t,Te.ON,n),a.isArea(t)){var l=a.getLocation(t,Te.LEFT),c=a.getLocation(t,Te.RIGHT);if(c!==E.NONE){if(c!==n)throw new Ee("side location conflict",s.getCoordinate());l===E.NONE&&et.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),n=l}else et.isTrue(a.getLocation(t,Te.LEFT)===E.NONE,"found single null side"),a.setLocation(t,Te.RIGHT,n),a.setLocation(t,Te.LEFT,n)}}},ji.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},ji.prototype.print=function(t){Z.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},ji.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ji.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var i=e.size()-1,r=e.get(i).getLabel().getLocation(t,Te.LEFT);et.isTrue(r!==E.NONE,"Found unlabelled area edge");for(var n=r,o=this.iterator();o.hasNext();){var s=o.next().getLabel();et.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Te.LEFT),l=s.getLocation(t,Te.RIGHT);if(a===l)return!1;if(l!==n)return!1;n=a}return!0},ji.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},ji.prototype.iterator=function(){return this.getEdges().iterator()},ji.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new wt(this._edgeMap.values())),this._edgeList},ji.prototype.getLocation=function(t,e,i){return this._ptInAreaLocation[t]===E.NONE&&(this._ptInAreaLocation[t]=Vi.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]},ji.prototype.toString=function(){var t=new N;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var i=e.next();t.append(i),t.append("\n")}return t.toString()},ji.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},ji.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next().getLabel(),n=0;n<2;n++)r.isLine(n)&&r.getLocation(n)===E.BOUNDARY&&(e[n]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var c=E.NONE;if(e[l])c=E.EXTERIOR;else{var u=s.getCoordinate();c=this.getLocation(l,u,t)}a.setAllLocationsIfNull(l,c)}},ji.prototype.getDegree=function(){return this._edgeMap.size()},ji.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji};var Gi=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,i=this._SCANNING_FOR_INCOMING,r=0;r<this._resultAreaEdgeList.size();r++){var n=this._resultAreaEdgeList.get(r),o=n.getSym();if(n.getLabel().isArea())switch(null===t&&n.isInResult()&&(t=n),i){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!n.isInResult())continue;e.setNext(n),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===t)throw new Ee("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var i=t.get(0);if(1===e)return i;var r=t.get(e-1),n=i.getQuadrant(),o=r.getQuadrant();return Be.isNorthern(n)&&Be.isNorthern(o)?i:Be.isNorthern(n)||Be.isNorthern(o)?0!==i.getDy()?i:0!==r.getDy()?r:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null):r},e.prototype.print=function(t){Z.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new wt;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,i=this._edgeList.size()-1;i>=0;i--){var r=this._edgeList.get(i),n=r.getSym();null===e&&(e=n),null!==t&&n.setNext(t),t=r}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),i=t.getDepth(Te.LEFT),r=t.getDepth(Te.RIGHT),n=this.computeDepths(e+1,this._edgeList.size(),i);if(this.computeDepths(0,e,n)!==r)throw new Ee("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var l=this._edgeList.get(a);l.setEdgeDepths(Te.RIGHT,s),s=l.getDepth(Te.LEFT)}return s}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,i=null,r=this._SCANNING_FOR_INCOMING,n=this._resultAreaEdgeList.size()-1;n>=0;n--){var o=this._resultAreaEdgeList.get(n),s=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),r){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==t)continue;i=s,r=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;i.setNextMin(o),r=this._SCANNING_FOR_INCOMING}}r===this._LINKING_TO_OUTGOING&&(et.isTrue(null!==e,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var i=arguments[0],r=0,n=this.iterator();n.hasNext();)n.next().getEdgeRing()===i&&r++;return r}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=E.NONE,e=this.iterator();e.hasNext();){var i=e.next(),r=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=E.INTERIOR;break}if(r.isInResult()){t=E.EXTERIOR;break}}}if(t===E.NONE)return null;for(var n=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(n===E.INTERIOR):(s.isInResult()&&(n=E.EXTERIOR),a.isInResult()&&(n=E.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new ke(E.NONE);for(var i=this.iterator();i.hasNext();)for(var r=i.next().getEdge().getLabel(),n=0;n<2;n++){var o=r.getLocation(n);o!==E.INTERIOR&&o!==E.BOUNDARY||this._label.setLocation(n,E.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ji),Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Fe(t,new Gi)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ge),qi=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};qi.prototype.compareTo=function(t){var e=t;return qi.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},qi.prototype.interfaces_=function(){return[x]},qi.prototype.getClass=function(){return qi},qi.orientation=function(t){return 1===Ct.increasingDirection(t)},qi.compareOriented=function(t,e,i,r){for(var n=e?1:-1,o=r?1:-1,s=e?t.length:-1,a=r?i.length:-1,l=e?0:t.length-1,c=r?0:i.length-1;;){var u=t[l].compareTo(i[c]);if(0!==u)return u;var h=(l+=n)===s,p=(c+=o)===a;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var Wi=function(){this._edges=new wt,this._ocaMap=new h};Wi.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var i=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var r=i.getCoordinates(),n=0;n<r.length;n++)n>0&&t.print(","),t.print(r[n].x+" "+r[n].y);t.println(")")}t.print(")  ")},Wi.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Wi.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Wi.prototype.iterator=function(){return this._edges.iterator()},Wi.prototype.getEdges=function(){return this._edges},Wi.prototype.get=function(t){return this._edges.get(t)},Wi.prototype.findEqualEdge=function(t){var e=new qi(t.getCoordinates());return this._ocaMap.get(e)},Wi.prototype.add=function(t){this._edges.add(t);var e=new qi(t.getCoordinates());this._ocaMap.put(e,t)},Wi.prototype.interfaces_=function(){return[]},Wi.prototype.getClass=function(){return Wi};var Hi=function(){};Hi.prototype.processIntersections=function(t,e,i,r){},Hi.prototype.isDone=function(){},Hi.prototype.interfaces_=function(){return[]},Hi.prototype.getClass=function(){return Hi};var Ji=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Ji.prototype.isTrivialIntersection=function(t,e,i,r){if(t===i&&1===this._li.getIntersectionNum()){if(Ji.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var n=t.size()-1;if(0===e&&r===n||0===r&&e===n)return!0}}return!1},Ji.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Ji.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Ji.prototype.getLineIntersector=function(){return this._li},Ji.prototype.hasProperIntersection=function(){return this._hasProper},Ji.prototype.processIntersections=function(t,e,i,r){if(t===i&&e===r)return null;this.numTests++;var n=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Ji.prototype.hasIntersection=function(){return this._hasIntersection},Ji.prototype.isDone=function(){return!1},Ji.prototype.hasInteriorIntersection=function(){return this._hasInterior},Ji.prototype.interfaces_=function(){return[Hi]},Ji.prototype.getClass=function(){return Ji},Ji.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Ki=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new S(t),this.segmentIndex=e,this.dist=i};Ki.prototype.getSegmentIndex=function(){return this.segmentIndex},Ki.prototype.getCoordinate=function(){return this.coord},Ki.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Ki.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Ki.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Ki.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Ki.prototype.getDistance=function(){return this.dist},Ki.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Ki.prototype.interfaces_=function(){return[x]},Ki.prototype.getClass=function(){return Ki};var $i=function(){this._nodeMap=new h,this.edge=null;var t=arguments[0];this.edge=t};$i.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},$i.prototype.iterator=function(){return this._nodeMap.values().iterator()},$i.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var r=e.next(),n=this.createSplitEdge(i,r);t.add(n),i=r}},$i.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},$i.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,r=this.edge.pts[e.segmentIndex],n=e.dist>0||!e.coord.equals2D(r);n||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return n&&(o[s]=e.coord),new er(o,new ke(this.edge._label))},$i.prototype.add=function(t,e,i){var r=new Ki(t,e,i),n=this._nodeMap.get(r);return null!==n?n:(this._nodeMap.put(r,r),r)},$i.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i};var Yi=function(){};Yi.prototype.getChainStartIndices=function(t){var e=0,i=new wt;i.add(new D(e));do{var r=this.findChainEnd(t,e);i.add(new D(r)),e=r}while(e<t.length-1);return Yi.toIntArray(i)},Yi.prototype.findChainEnd=function(t,e){for(var i=Be.quadrant(t[e],t[e+1]),r=e+1;r<t.length&&Be.quadrant(t[r-1],t[r])===i;)r++;return r-1},Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi},Yi.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var Xi=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new W,this.env2=new W;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Yi;this.startIndex=e.getChainStartIndices(this.pts)};Xi.prototype.getCoordinates=function(){return this.pts},Xi.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i},Xi.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i},Xi.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],r)}else if(6===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],c=arguments[5],u=this.pts[n],h=this.pts[o],p=s.pts[a],d=s.pts[l];if(o-n==1&&l-a==1)return c.addIntersections(this.e,n,s.e,a),null;if(this.env1.init(u,h),this.env2.init(p,d),!this.env1.intersects(this.env2))return null;var f=Math.trunc((n+o)/2),m=Math.trunc((a+l)/2);n<f&&(a<m&&this.computeIntersectsForChain(n,f,s,a,m,c),m<l&&this.computeIntersectsForChain(n,f,s,m,l,c)),f<o&&(a<m&&this.computeIntersectsForChain(f,o,s,a,m,c),m<l&&this.computeIntersectsForChain(f,o,s,m,l,c))}},Xi.prototype.getStartIndexes=function(){return this.startIndex},Xi.prototype.computeIntersects=function(t,e){for(var i=0;i<this.startIndex.length-1;i++)for(var r=0;r<t.startIndex.length-1;r++)this.computeIntersectsForChain(i,t,r,e)},Xi.prototype.interfaces_=function(){return[]},Xi.prototype.getClass=function(){return Xi};var Qi=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var i=0;i<3;i++)this._depth[e][i]=t.NULL_VALUE},tr={NULL_VALUE:{configurable:!0}};Qi.prototype.getDepth=function(t,e){return this._depth[t][e]},Qi.prototype.setDepth=function(t,e,i){this._depth[t][e]=i},Qi.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==Qi.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===Qi.NULL_VALUE}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._depth[r][n]===Qi.NULL_VALUE}},Qi.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var i=1;i<3;i++){var r=0;this._depth[t][i]>e&&(r=1),this._depth[t][i]=r}}},Qi.prototype.getDelta=function(t){return this._depth[t][Te.RIGHT]-this._depth[t][Te.LEFT]},Qi.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?E.EXTERIOR:E.INTERIOR},Qi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Qi.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var i=1;i<3;i++){var r=t.getLocation(e,i);r!==E.EXTERIOR&&r!==E.INTERIOR||(this.isNull(e,i)?this._depth[e][i]=Qi.depthAtLocation(r):this._depth[e][i]+=Qi.depthAtLocation(r))}else if(3===arguments.length){var n=arguments[0],o=arguments[1];arguments[2]===E.INTERIOR&&this._depth[n][o]++}},Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi},Qi.depthAtLocation=function(t){return t===E.EXTERIOR?0:t===E.INTERIOR?1:Qi.NULL_VALUE},tr.NULL_VALUE.get=function(){return-1},Object.defineProperties(Qi,tr);var er=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new $i(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Qi,this._depthDelta=0,1===arguments.length){var i=arguments[0];e.call(this,i,null)}else if(2===arguments.length){var r=arguments[0],n=arguments[1];this.pts=r,this._label=n}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,ke.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var i=t;if(this.pts.length!==i.pts.length)return!1;for(var r=!0,n=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(i.pts[s])||(r=!1),this.pts[s].equals2D(i.pts[--o])||(n=!1),!r&&!n)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Xi(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new W;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,i,r){var n=new S(t.getIntersection(r)),o=e,s=t.getEdgeDistance(i,r),a=o+1;if(a<this.pts.length){var l=this.pts[a];n.equals2D(l)&&(o=a,s=0)}this.eiList.add(n,o,s)},e.prototype.toString=function(){var t=new N;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,i){for(var r=0;r<t.getIntersectionNum();r++)this.addIntersection(t,e,i,r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],i=arguments[1];i.setAtLeastIfValid(e.getLocation(0,Te.ON),e.getLocation(1,Te.ON),1),e.isArea()&&(i.setAtLeastIfValid(e.getLocation(0,Te.LEFT),e.getLocation(1,Te.LEFT),2),i.setAtLeastIfValid(e.getLocation(0,Te.RIGHT),e.getLocation(1,Te.RIGHT),2))},e}(Re),ir=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wi,this._bufParams=t||null};ir.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},ir.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new ke(t.getLabel())).flip(),i.merge(r);var n=ir.depthDelta(r),o=e.getDepthDelta()+n;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(ir.depthDelta(t.getLabel()))},ir.prototype.buildSubgraphs=function(t,e){for(var i=new wt,r=t.iterator();r.hasNext();){var n=r.next(),o=n.getRightmostCoordinate(),s=new Di(i).getDepth(o);n.computeDepth(s),n.findResultEdges(),i.add(n),e.add(n.getDirectedEdges(),n.getNodes())}},ir.prototype.createSubgraphs=function(t){for(var e=new wt,i=t.getNodes().iterator();i.hasNext();){var r=i.next();if(!r.isVisited()){var n=new Le;n.create(r),e.add(n)}}return Qe.sort(e,Qe.reverseOrder()),e},ir.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},ir.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new xi,i=new nt;return i.setPrecisionModel(t),e.setSegmentIntersector(new Ji(i)),e},ir.prototype.buffer=function(t,e){var i=this._workingPrecisionModel;null===i&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Ni(i,this._bufParams),n=new zi(t,e,r).getCurves();if(n.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(n,i),this._graph=new Ze(new Zi),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new qe(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},ir.prototype.computeNodedEdges=function(t,e){var i=this.getNoder(e);i.computeNodes(t);for(var r=i.getNodedSubstrings().iterator();r.hasNext();){var n=r.next(),o=n.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=n.getData(),a=new er(n.getCoordinates(),new ke(s));this.insertUniqueEdge(a)}}},ir.prototype.setNoder=function(t){this._workingNoder=t},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir},ir.depthDelta=function(t){var e=t.getLocation(0,Te.LEFT),i=t.getLocation(0,Te.RIGHT);return e===E.INTERIOR&&i===E.EXTERIOR?1:e===E.EXTERIOR&&i===E.INTERIOR?-1:0},ir.convertSegStrings=function(t){for(var e=new _e,i=new wt;t.hasNext();){var r=t.next(),n=e.createLineString(r.getCoordinates());i.add(n)}return e.buildGeometry(i)};var rr=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=r,this._offsetX=n,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};rr.prototype.rescale=function(){if(L(arguments[0],vt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],r=0;r<i.length;r++)i[r].x=i[r].x/this._scaleFactor+this._offsetX,i[r].y=i[r].y/this._scaleFactor+this._offsetY;2===i.length&&i[0].equals2D(i[1])&&Z.out.println(i)}},rr.prototype.scale=function(){if(L(arguments[0],vt)){for(var t=arguments[0],e=new wt,i=t.iterator();i.hasNext();){var r=i.next();e.add(new di(this.scale(r.getCoordinates()),r.getData()))}return e}if(arguments[0]instanceof Array){for(var n=arguments[0],o=new Array(n.length).fill(null),s=0;s<n.length;s++)o[s]=new S(Math.round((n[s].x-this._offsetX)*this._scaleFactor),Math.round((n[s].y-this._offsetY)*this._scaleFactor),n[s].z);return Ct.removeRepeatedPoints(o)}},rr.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},rr.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},rr.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},rr.prototype.interfaces_=function(){return[Ai]},rr.prototype.getClass=function(){return rr};var nr=function(){this._li=new nt,this._segStrings=null;var t=arguments[0];this._segStrings=t},or={fact:{configurable:!0}};nr.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var n=r.next().getCoordinates(),o=1;o<n.length-1;o++)if(n[o].equals(i))throw new Q("found endpt/interior pt intersection at index "+o+" :pt "+i)},nr.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();this.checkInteriorIntersections(e,r)}else if(2===arguments.length)for(var n=arguments[0],o=arguments[1],s=n.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(n,l,o,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],p=arguments[2],d=arguments[3];if(u===p&&h===d)return null;var f=u.getCoordinates()[h],m=u.getCoordinates()[h+1],g=p.getCoordinates()[d],_=p.getCoordinates()[d+1];if(this._li.computeIntersection(f,m,g,_),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,m)||this.hasInteriorIntersection(this._li,g,_)))throw new Q("found non-noded intersection at "+f+"-"+m+" and "+g+"-"+_)}},nr.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},nr.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),r=0;r<i.length-2;r++)this.checkCollapse(i[r],i[r+1],i[r+2])},nr.prototype.hasInteriorIntersection=function(t,e,i){for(var r=0;r<t.getIntersectionNum();r++){var n=t.getIntersection(r);if(!n.equals(e)&&!n.equals(i))return!0}return!1},nr.prototype.checkCollapse=function(t,e,i){if(t.equals(i))throw new Q("found non-noded collapse at "+nr.fact.createLineString([t,e,i]))},nr.prototype.interfaces_=function(){return[]},nr.prototype.getClass=function(){return nr},or.fact.get=function(){return new _e},Object.defineProperties(nr,or);var sr=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new y("Scale factor must be non-zero");1!==e&&(this._pt=new S(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new S,this._p1Scaled=new S),this.initCorners(this._pt)},ar={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};sr.prototype.intersectsScaled=function(t,e){var i=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<i||this._minx>r||this._maxy<n||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return et.isTrue(!(s&&a),"Found bad envelope test"),a},sr.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new S(this._maxx,this._maxy),this._corner[1]=new S(this._minx,this._maxy),this._corner[2]=new S(this._minx,this._miny),this._corner[3]=new S(this._maxx,this._miny)},sr.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},sr.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},sr.prototype.getCoordinate=function(){return this._originalPt},sr.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},sr.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=sr.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new W(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},sr.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},sr.prototype.intersectsToleranceSquare=function(t,e){var i=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||i&&r||t.equals(this._pt)||e.equals(this._pt)))))},sr.prototype.addSnappedNode=function(t,e){var i=t.getCoordinate(e),r=t.getCoordinate(e+1);return!!this.intersects(i,r)&&(t.addIntersection(this.getCoordinate(),e),!0)},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr},ar.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(sr,ar);var lr=function(){this.tempEnv1=new W,this.selectedSegment=new fi};lr.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr};var cr=function(){this._index=null;var t=arguments[0];this._index=t},ur={HotPixelSnapAction:{configurable:!0}};cr.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],i=arguments[1],r=arguments[2],n=e.getSafeEnvelope(),o=new hr(e,i,r);return this._index.query(n,{interfaces_:function(){return[Ke]},visitItem:function(t){t.select(n,o)}}),o.isNodeAdded()}},cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},ur.HotPixelSnapAction.get=function(){return hr},Object.defineProperties(cr,ur);var hr=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],i=arguments[1],r=arguments[2];this._hotPixel=e,this._parentEdge=i,this._hotPixelVertexIndex=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],i=arguments[0].getContext();if(null!==this._parentEdge&&i===this._parentEdge&&e===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(lr),pr=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new wt};pr.prototype.processIntersections=function(t,e,i,r){if(t===i&&e===r)return null;var n=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];if(this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),i.addIntersections(this._li,r,1)}},pr.prototype.isDone=function(){return!1},pr.prototype.getInteriorIntersections=function(){return this._interiorIntersections},pr.prototype.interfaces_=function(){return[Hi]},pr.prototype.getClass=function(){return pr};var dr=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new nt,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};dr.prototype.checkCorrectness=function(t){var e=di.getNodedSubstrings(t),i=new nr(e);try{i.checkValid()}catch(t){if(!(t instanceof j))throw t;t.printStackTrace()}},dr.prototype.getNodedSubstrings=function(){return di.getNodedSubstrings(this._nodedSegStrings)},dr.prototype.snapRound=function(t,e){var i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)},dr.prototype.findInteriorIntersections=function(t,e){var i=new pr(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()},dr.prototype.computeVertexSnaps=function(){if(L(arguments[0],vt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof di)for(var i=arguments[0],r=i.getCoordinates(),n=0;n<r.length;n++){var o=new sr(r[n],this._scaleFactor,this._li);this._pointSnapper.snap(o,i,n)&&i.addIntersection(r[n],n)}},dr.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new xi,this._pointSnapper=new cr(this._noder.getIndex()),this.snapRound(t,this._li)},dr.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),r=new sr(i,this._scaleFactor,this._li);this._pointSnapper.snap(r)}},dr.prototype.interfaces_=function(){return[Ai]},dr.prototype.getClass=function(){return dr};var fr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new wi,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._argGeom=e,this._bufParams=i}},mr={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};fr.prototype.bufferFixedPrecision=function(t){var e=new rr(new dr(new de(1)),t.getScale()),i=new ir(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)},fr.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=fr.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Ee))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],r=fr.precisionScaleFactor(this._argGeom,this._distance,i),n=new de(r);this.bufferFixedPrecision(n)}},fr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===de.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},fr.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},fr.prototype.bufferOriginalPrecision=function(){try{var t=new ir(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Q))throw t;this._saveException=t}},fr.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},fr.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},fr.prototype.interfaces_=function(){return[]},fr.prototype.getClass=function(){return fr},fr.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new fr(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var e=arguments[1],i=arguments[2],r=new fr(arguments[0]);return r.setQuadrantSegments(i),r.getResultGeometry(e)}if(arguments[2]instanceof wi&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var n=arguments[1];return new fr(arguments[0],arguments[2]).getResultGeometry(n)}}else if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],l=new fr(arguments[0]);return l.setQuadrantSegments(s),l.setEndCapStyle(a),l.getResultGeometry(o)}},fr.precisionScaleFactor=function(t,e,i){var r=t.getEnvelopeInternal(),n=P.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY()))+2*(e>0?e:0),o=i-Math.trunc(Math.log(n)/Math.log(10)+1);return Math.pow(10,o)},mr.CAP_ROUND.get=function(){return wi.CAP_ROUND},mr.CAP_BUTT.get=function(){return wi.CAP_FLAT},mr.CAP_FLAT.get=function(){return wi.CAP_FLAT},mr.CAP_SQUARE.get=function(){return wi.CAP_SQUARE},mr.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(fr,mr);var gr=function(){this._pt=[new S,new S],this._distance=A.NaN,this._isNull=!0};gr.prototype.getCoordinates=function(){return this._pt},gr.prototype.getCoordinate=function(t){return this._pt[t]},gr.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var r=e.distance(i);r<this._distance&&this.initialize(e,i,r)}},gr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},gr.prototype.getDistance=function(){return this._distance},gr.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var r=e.distance(i);r>this._distance&&this.initialize(e,i,r)}},gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr};var _r=function(){};_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},_r.computeDistance=function(){if(arguments[2]instanceof gr&&arguments[0]instanceof Kt&&arguments[1]instanceof S)for(var t=arguments[1],e=arguments[2],i=arguments[0].getCoordinates(),r=new fi,n=0;n<i.length-1;n++){r.setCoordinates(i[n],i[n+1]);var o=r.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof gr&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1],l=arguments[2];_r.computeDistance(s.getExteriorRing(),a,l);for(var c=0;c<s.getNumInteriorRing();c++)_r.computeDistance(s.getInteriorRingN(c),a,l)}else if(arguments[2]instanceof gr&&arguments[0]instanceof ut&&arguments[1]instanceof S){var u=arguments[0],h=arguments[1],p=arguments[2];if(u instanceof Kt)_r.computeDistance(u,h,p);else if(u instanceof Qt)_r.computeDistance(u,h,p);else if(u instanceof jt)for(var d=u,f=0;f<d.getNumGeometries();f++){var m=d.getGeometryN(f);_r.computeDistance(m,h,p)}else p.setMinimum(u.getCoordinate(),h)}else if(arguments[2]instanceof gr&&arguments[0]instanceof fi&&arguments[1]instanceof S){var g=arguments[1],_=arguments[2],y=arguments[0].closestPoint(g);_.setMinimum(y,g)}};var yr=function(t){this._maxPtDist=new gr,this._inputGeom=t||null},Ar={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};yr.prototype.computeMaxMidpointDistance=function(t){var e=new xr(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},yr.prototype.computeMaxVertexDistance=function(t){var e=new vr(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},yr.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},yr.prototype.getDistancePoints=function(){return this._maxPtDist},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr},Ar.MaxPointDistanceFilter.get=function(){return vr},Ar.MaxMidpointDistanceFilter.get=function(){return xr},Object.defineProperties(yr,Ar);var vr=function(t){this._maxPtDist=new gr,this._minPtDist=new gr,this._geom=t||null};vr.prototype.filter=function(t){this._minPtDist.initialize(),_r.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},vr.prototype.getMaxPointDistance=function(){return this._maxPtDist},vr.prototype.interfaces_=function(){return[dt]},vr.prototype.getClass=function(){return vr};var xr=function(t){this._maxPtDist=new gr,this._minPtDist=new gr,this._geom=t||null};xr.prototype.filter=function(t,e){if(0===e)return null;var i=t.getCoordinate(e-1),r=t.getCoordinate(e),n=new S((i.x+r.x)/2,(i.y+r.y)/2);this._minPtDist.initialize(),_r.computeDistance(this._geom,n,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},xr.prototype.isDone=function(){return!1},xr.prototype.isGeometryChanged=function(){return!1},xr.prototype.getMaxPointDistance=function(){return this._maxPtDist},xr.prototype.interfaces_=function(){return[Vt]},xr.prototype.getClass=function(){return xr};var br=function(t){this._comps=t||null};br.prototype.filter=function(t){t instanceof Qt&&this._comps.add(t)},br.prototype.interfaces_=function(){return[Ut]},br.prototype.getClass=function(){return br},br.getPolygons=function(){if(1===arguments.length)return br.getPolygons(arguments[0],new wt);if(2===arguments.length){var t=arguments[0],e=arguments[1];return t instanceof Qt?e.add(t):t instanceof jt&&t.apply(new br(e)),e}};var wr=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._lines=e,this._isForcedToLineString=i}};wr.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ee){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Kt&&this._lines.add(t)},wr.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},wr.prototype.interfaces_=function(){return[ct]},wr.prototype.getClass=function(){return wr},wr.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(wr.getLines(t))}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().buildGeometry(wr.getLines(e,i))}},wr.getLines=function(){if(1===arguments.length)return wr.getLines(arguments[0],!1);if(2===arguments.length){if(L(arguments[0],vt)&&L(arguments[1],vt)){for(var t=arguments[1],e=arguments[0].iterator();e.hasNext();){var i=e.next();wr.getLines(i,t)}return t}if(arguments[0]instanceof ut&&"boolean"==typeof arguments[1]){var r=arguments[0],n=arguments[1],o=new wt;return r.apply(new wr(o,n)),o}if(arguments[0]instanceof ut&&L(arguments[1],vt)){var s=arguments[0],a=arguments[1];return s instanceof Kt?a.add(s):s.apply(new wr(a)),a}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&L(arguments[0],vt)&&L(arguments[1],vt)){for(var l=arguments[1],c=arguments[2],u=arguments[0].iterator();u.hasNext();){var h=u.next();wr.getLines(h,l,c)}return l}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ut&&L(arguments[1],vt)){var p=arguments[1],d=arguments[2];return arguments[0].apply(new wr(p,d)),p}}};var Sr=function(){if(this._boundaryRule=ft.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new y("Rule must be non-null");this._boundaryRule=t}};Sr.prototype.locateInternal=function(){if(arguments[0]instanceof S&&arguments[1]instanceof Qt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return E.EXTERIOR;var i=e.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===E.EXTERIOR)return E.EXTERIOR;if(r===E.BOUNDARY)return E.BOUNDARY;for(var n=0;n<e.getNumInteriorRing();n++){var o=e.getInteriorRingN(n),s=this.locateInPolygonRing(t,o);if(s===E.INTERIOR)return E.EXTERIOR;if(s===E.BOUNDARY)return E.BOUNDARY}return E.INTERIOR}if(arguments[0]instanceof S&&arguments[1]instanceof Kt){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return E.EXTERIOR;var c=l.getCoordinates();return l.isClosed()||!a.equals(c[0])&&!a.equals(c[c.length-1])?at.isOnLine(a,c)?E.INTERIOR:E.EXTERIOR:E.BOUNDARY}if(arguments[0]instanceof S&&arguments[1]instanceof Yt){var u=arguments[0];return arguments[1].getCoordinate().equals2D(u)?E.INTERIOR:E.EXTERIOR}},Sr.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?at.locatePointInRing(t,e.getCoordinates()):E.EXTERIOR},Sr.prototype.intersects=function(t,e){return this.locate(t,e)!==E.EXTERIOR},Sr.prototype.updateLocationInfo=function(t){t===E.INTERIOR&&(this._isIn=!0),t===E.BOUNDARY&&this._numBoundaries++},Sr.prototype.computeLocation=function(t,e){if(e instanceof Yt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Kt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Qt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Gt)for(var i=e,r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.updateLocationInfo(this.locateInternal(t,n))}else if(e instanceof ie)for(var o=e,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(t,a))}else if(e instanceof jt)for(var l=new Ui(e);l.hasNext();){var c=l.next();c!==e&&this.computeLocation(t,c)}},Sr.prototype.locate=function(t,e){return e.isEmpty()?E.EXTERIOR:e instanceof Kt||e instanceof Qt?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?E.BOUNDARY:this._numBoundaries>0||this._isIn?E.INTERIOR:E.EXTERIOR)},Sr.prototype.interfaces_=function(){return[]},Sr.prototype.getClass=function(){return Sr};var Tr=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[0],i=arguments[1],r=arguments[2];this._component=e,this._segIndex=i,this._pt=r}},Cr={INSIDE_AREA:{configurable:!0}};Tr.prototype.isInsideArea=function(){return this._segIndex===Tr.INSIDE_AREA},Tr.prototype.getCoordinate=function(){return this._pt},Tr.prototype.getGeometryComponent=function(){return this._component},Tr.prototype.getSegmentIndex=function(){return this._segIndex},Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},Cr.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Tr,Cr);var Mr=function(t){this._pts=t||null};Mr.prototype.filter=function(t){t instanceof Yt&&this._pts.add(t)},Mr.prototype.interfaces_=function(){return[Ut]},Mr.prototype.getClass=function(){return Mr},Mr.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Yt?Qe.singletonList(t):Mr.getPoints(t,new wt)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof Yt?i.add(e):e instanceof jt&&e.apply(new Mr(i)),i}};var Er=function(){this._locations=null;var t=arguments[0];this._locations=t};Er.prototype.filter=function(t){(t instanceof Yt||t instanceof Kt||t instanceof Qt)&&this._locations.add(new Tr(t,0,t.getCoordinate()))},Er.prototype.interfaces_=function(){return[Ut]},Er.prototype.getClass=function(){return Er},Er.getLocations=function(t){var e=new wt;return t.apply(new Er(e)),e};var Ir=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Sr,this._minDistanceLocation=null,this._minDistance=A.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=r,this._terminateDistance=n}};Ir.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],r=1-e,n=br.getPolygons(this._geom[e]);if(n.size()>0){var o=Er.getLocations(this._geom[r]);if(this.computeContainmentDistance(o,n,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[e]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&L(arguments[0],bt)&&L(arguments[1],bt)){for(var s=arguments[0],a=arguments[1],l=arguments[2],c=0;c<s.size();c++)for(var u=s.get(c),h=0;h<a.size();h++)if(this.computeContainmentDistance(u,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Tr&&arguments[1]instanceof Qt){var p=arguments[0],d=arguments[1],f=arguments[2],m=p.getCoordinate();if(E.EXTERIOR!==this._ptLocator.locate(m,d))return this._minDistance=0,f[0]=p,f[1]=new Tr(d,m),null}},Ir.prototype.computeMinDistanceLinesPoints=function(t,e,i){for(var r=0;r<t.size();r++)for(var n=t.get(r),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},Ir.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=wr.getLines(this._geom[0]),i=wr.getLines(this._geom[1]),r=Mr.getPoints(this._geom[0]),n=Mr.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(i,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(r,n,t),void this.updateMinDistance(t,!1))))},Ir.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Ir.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},Ir.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Ir.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Kt&&arguments[1]instanceof Yt){var t=arguments[0],e=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),n=e.getCoordinate(),o=0;o<r.length-1;o++){var s=at.distancePointLine(n,r[o],r[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new fi(r[o],r[o+1]).closestPoint(n);i[0]=new Tr(t,o,a),i[1]=new Tr(e,0,n)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Kt&&arguments[1]instanceof Kt){var l=arguments[0],c=arguments[1],u=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),p=c.getCoordinates(),d=0;d<h.length-1;d++)for(var f=0;f<p.length-1;f++){var m=at.distanceLineLine(h[d],h[d+1],p[f],p[f+1]);if(m<this._minDistance){this._minDistance=m;var g=new fi(h[d],h[d+1]),_=new fi(p[f],p[f+1]),y=g.closestPoints(_);u[0]=new Tr(l,d,y[0]),u[1]=new Tr(c,f,y[1])}if(this._minDistance<=this._terminateDistance)return null}}},Ir.prototype.computeMinDistancePoints=function(t,e,i){for(var r=0;r<t.size();r++)for(var n=t.get(r),o=0;o<e.size();o++){var s=e.get(o),a=n.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,i[0]=new Tr(n,0,n.getCoordinate()),i[1]=new Tr(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Ir.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new y("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Ir.prototype.computeMinDistanceLines=function(t,e,i){for(var r=0;r<t.size();r++)for(var n=t.get(r),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(n,s,i),this._minDistance<=this._terminateDistance)return null}},Ir.prototype.interfaces_=function(){return[]},Ir.prototype.getClass=function(){return Ir},Ir.distance=function(t,e){return new Ir(t,e).distance()},Ir.isWithinDistance=function(t,e,i){return new Ir(t,e,i).distance()<=i},Ir.nearestPoints=function(t,e){return new Ir(t,e).nearestPoints()};var Lr=function(){this._pt=[new S,new S],this._distance=A.NaN,this._isNull=!0};Lr.prototype.getCoordinates=function(){return this._pt},Lr.prototype.getCoordinate=function(t){return this._pt[t]},Lr.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var r=e.distance(i);r<this._distance&&this.initialize(e,i,r)}},Lr.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],r=arguments[1],n=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(r),this._distance=n,this._isNull=!1}},Lr.prototype.toString=function(){return X.toLineString(this._pt[0],this._pt[1])},Lr.prototype.getDistance=function(){return this._distance},Lr.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var r=e.distance(i);r>this._distance&&this.initialize(e,i,r)}},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr};var Pr=function(){};Pr.prototype.interfaces_=function(){return[]},Pr.prototype.getClass=function(){return Pr},Pr.computeDistance=function(){if(arguments[2]instanceof Lr&&arguments[0]instanceof Kt&&arguments[1]instanceof S)for(var t=arguments[0],e=arguments[1],i=arguments[2],r=new fi,n=t.getCoordinates(),o=0;o<n.length-1;o++){r.setCoordinates(n[o],n[o+1]);var s=r.closestPoint(e);i.setMinimum(s,e)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var a=arguments[0],l=arguments[1],c=arguments[2];Pr.computeDistance(a.getExteriorRing(),l,c);for(var u=0;u<a.getNumInteriorRing();u++)Pr.computeDistance(a.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof ut&&arguments[1]instanceof S){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Kt)Pr.computeDistance(h,p,d);else if(h instanceof Qt)Pr.computeDistance(h,p,d);else if(h instanceof jt)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);Pr.computeDistance(g,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Lr&&arguments[0]instanceof fi&&arguments[1]instanceof S){var _=arguments[1],y=arguments[2],A=arguments[0].closestPoint(_);y.setMinimum(A,_)}};var kr=function(){this._g0=null,this._g1=null,this._ptDist=new Lr,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Nr={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};kr.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},kr.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new y("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},kr.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},kr.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},kr.prototype.computeOrientedDistance=function(t,e,i){var r=new Dr(e);if(t.apply(r),i.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var n=new Or(e,this._densifyFrac);t.apply(n),i.setMaximum(n.getMaxPointDistance())}},kr.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},kr.prototype.interfaces_=function(){return[]},kr.prototype.getClass=function(){return kr},kr.distance=function(){if(2===arguments.length)return new kr(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new kr(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},Nr.MaxPointDistanceFilter.get=function(){return Dr},Nr.MaxDensifiedByFractionDistanceFilter.get=function(){return Or},Object.defineProperties(kr,Nr);var Dr=function(){this._maxPtDist=new Lr,this._minPtDist=new Lr,this._euclideanDist=new Pr,this._geom=null;var t=arguments[0];this._geom=t};Dr.prototype.filter=function(t){this._minPtDist.initialize(),Pr.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Dr.prototype.getMaxPointDistance=function(){return this._maxPtDist},Dr.prototype.interfaces_=function(){return[dt]},Dr.prototype.getClass=function(){return Dr};var Or=function(){this._maxPtDist=new Lr,this._minPtDist=new Lr,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Or.prototype.filter=function(t,e){if(0===e)return null;for(var i=t.getCoordinate(e-1),r=t.getCoordinate(e),n=(r.x-i.x)/this._numSubSegs,o=(r.y-i.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=i.x+s*n,l=i.y+s*o,c=new S(a,l);this._minPtDist.initialize(),Pr.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Or.prototype.isDone=function(){return!1},Or.prototype.isGeometryChanged=function(){return!1},Or.prototype.getMaxPointDistance=function(){return this._maxPtDist},Or.prototype.interfaces_=function(){return[Vt]},Or.prototype.getClass=function(){return Or};var Rr=function(t,e,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=i||null},Fr={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Rr.prototype.checkMaximumDistance=function(t,e,i){var r=new kr(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var n=r.getCoordinates();this._errorLocation=n[1],this._errorIndicator=t.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+X.toLineString(n[0],n[1])+")"}},Rr.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Rr.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Rr.VERBOSE&&Z.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Rr.prototype.checkNegativeValid=function(){if(!(this._input instanceof Qt||this._input instanceof ie||this._input instanceof jt))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Rr.prototype.getErrorIndicator=function(){return this._errorIndicator},Rr.prototype.checkMinimumDistance=function(t,e,i){var r=new Ir(t,e,i);if(this._minDistanceFound=r.distance(),this._minDistanceFound<i){this._isValid=!1;var n=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(n),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+X.toLineString(n[0],n[1])+" )"}},Rr.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Rr.prototype.getErrorLocation=function(){return this._errorLocation},Rr.prototype.getPolygonLines=function(t){for(var e=new wt,i=new wr(e),r=br.getPolygons(t).iterator();r.hasNext();)r.next().apply(i);return t.getFactory().buildGeometry(e)},Rr.prototype.getErrorMessage=function(){return this._errMsg},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr},Fr.VERBOSE.get=function(){return!1},Fr.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Rr,Fr);var zr=function(t,e,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=i||null},Br={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};zr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},zr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*zr.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new W(this._input.getEnvelopeInternal());e.expandBy(this._distance);var i=new W(this._result.getEnvelopeInternal());i.expandBy(t),i.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},zr.prototype.checkDistance=function(){var t=new Rr(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},zr.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},zr.prototype.checkPolygonal=function(){this._result instanceof Qt||this._result instanceof ie||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},zr.prototype.getErrorIndicator=function(){return this._errorIndicator},zr.prototype.getErrorLocation=function(){return this._errorLocation},zr.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},zr.prototype.report=function(t){if(!zr.VERBOSE)return null;Z.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},zr.prototype.getErrorMessage=function(){return this._errorMsg},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr},zr.isValidMsg=function(t,e,i){var r=new zr(t,e,i);return r.isValid()?null:r.getErrorMessage()},zr.isValid=function(t,e,i){return!!new zr(t,e,i).isValid()},Br.VERBOSE.get=function(){return!1},Br.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(zr,Br);var Ur=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Ur.prototype.getCoordinates=function(){return this._pts},Ur.prototype.size=function(){return this._pts.length},Ur.prototype.getCoordinate=function(t){return this._pts[t]},Ur.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Ur.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:ui.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Ur.prototype.setData=function(t){this._data=t},Ur.prototype.getData=function(){return this._data},Ur.prototype.toString=function(){return X.toLineString(new le(this._pts))},Ur.prototype.interfaces_=function(){return[hi]},Ur.prototype.getClass=function(){return Ur};var Vr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new wt,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Vr.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Vr.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Vr.prototype.getIntersectionSegments=function(){return this._intSegments},Vr.prototype.count=function(){return this._intersectionCount},Vr.prototype.getIntersections=function(){return this._intersections},Vr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Vr.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Vr.prototype.processIntersections=function(t,e,i,r){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===i&&e===r)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(i,r))return null;var n=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=n,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Vr.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Vr.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Vr.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Vr.prototype.interfaces_=function(){return[Hi]},Vr.prototype.getClass=function(){return Vr},Vr.createAllIntersectionsFinder=function(t){var e=new Vr(t);return e.setFindAllIntersections(!0),e},Vr.createAnyIntersectionFinder=function(t){return new Vr(t)},Vr.createIntersectionCounter=function(t){var e=new Vr(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var jr=function(){this._li=new nt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};jr.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},jr.prototype.getIntersections=function(){return this._segInt.getIntersections()},jr.prototype.isValid=function(){return this.execute(),this._isValid},jr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},jr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Vr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new xi;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},jr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ee(this.getErrorMessage(),this._segInt.getInteriorIntersection())},jr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+X.toLineString(t[0],t[1])+" and "+X.toLineString(t[2],t[3])},jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr},jr.computeIntersections=function(t){var e=new jr(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Gr=function t(){this._nv=null;var e=arguments[0];this._nv=new jr(t.toSegmentStrings(e))};Gr.prototype.checkValid=function(){this._nv.checkValid()},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr},Gr.toSegmentStrings=function(t){for(var e=new wt,i=t.iterator();i.hasNext();){var r=i.next();e.add(new Ur(r.getCoordinates(),r))}return e},Gr.checkValid=function(t){new Gr(t).checkValid()};var Zr=function(t){this._mapOp=t};Zr.prototype.map=function(t){for(var e=new wt,i=0;i<t.getNumGeometries();i++){var r=this._mapOp.map(t.getGeometryN(i));r.isEmpty()||e.add(r)}return t.getFactory().createGeometryCollection(_e.toGeometryArray(e))},Zr.prototype.interfaces_=function(){return[]},Zr.prototype.getClass=function(){return Zr},Zr.map=function(t,e){return new Zr(e).map(t)};var qr=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new wt,this._resultLineList=new wt;var t=arguments[0],e=arguments[1],i=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=i};qr.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next();this.collectLineEdge(i,t,this._lineEdgesList),this.collectBoundaryTouchEdge(i,t,this._lineEdgesList)}},qr.prototype.labelIsolatedLine=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,i)},qr.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},qr.prototype.collectLineEdge=function(t,e,i){var r=t.getLabel(),n=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Cn.isResultOfOp(r,e)||n.isCovered()||(i.add(n),t.setVisitedEdge(!0)))},qr.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next(),r=i.getEdge();if(i.isLineEdge()&&!r.isCoveredSet()){var n=this._op.isCoveredByA(i.getCoordinate());r.setCovered(n)}}},qr.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},qr.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var i=e.next(),r=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(r),i.setInResult(!0)}},qr.prototype.collectBoundaryTouchEdge=function(t,e,i){var r=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Cn.isResultOfOp(r,e)&&e===Cn.INTERSECTION&&(i.add(t.getEdge()),t.setVisitedEdge(!0))))},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr};var Wr=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new wt;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Wr.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var i=this._geometryFactory.createPoint(e);this._resultPointList.add(i)}},Wr.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var i=e.next();if(!(i.isInResult()||i.isIncidentEdgeInResult()||0!==i.getEdges().getDegree()&&t!==Cn.INTERSECTION)){var r=i.getLabel();Cn.isResultOfOp(r,t)&&this.filterCoveredNodeToPoint(i)}}},Wr.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var Hr=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Hr.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Hr.prototype.transformPolygon=function(t,e){var i=!0,r=this.transformLinearRing(t.getExteriorRing(),t);null!==r&&r instanceof ee&&!r.isEmpty()||(i=!1);for(var n=new wt,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof ee||(i=!1),n.add(s))}if(i)return this._factory.createPolygon(r,n.toArray([]));var a=new wt;return null!==r&&a.add(r),a.addAll(n),this._factory.buildGeometry(a)},Hr.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Hr.prototype.getInputGeometry=function(){return this._inputGeom},Hr.prototype.transformMultiLineString=function(t,e){for(var i=new wt,r=0;r<t.getNumGeometries();r++){var n=this.transformLineString(t.getGeometryN(r),t);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Hr.prototype.transformCoordinates=function(t,e){return this.copy(t)},Hr.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Hr.prototype.transformMultiPoint=function(t,e){for(var i=new wt,r=0;r<t.getNumGeometries();r++){var n=this.transformPoint(t.getGeometryN(r),t);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Hr.prototype.transformMultiPolygon=function(t,e){for(var i=new wt,r=0;r<t.getNumGeometries();r++){var n=this.transformPolygon(t.getGeometryN(r),t);null!==n&&(n.isEmpty()||i.add(n))}return this._factory.buildGeometry(i)},Hr.prototype.copy=function(t){return t.copy()},Hr.prototype.transformGeometryCollection=function(t,e){for(var i=new wt,r=0;r<t.getNumGeometries();r++){var n=this.transform(t.getGeometryN(r));null!==n&&(this._pruneEmptyGeometry&&n.isEmpty()||i.add(n))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(_e.toGeometryArray(i)):this._factory.buildGeometry(i)},Hr.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Yt)return this.transformPoint(t,null);if(t instanceof te)return this.transformMultiPoint(t,null);if(t instanceof ee)return this.transformLinearRing(t,null);if(t instanceof Kt)return this.transformLineString(t,null);if(t instanceof Gt)return this.transformMultiLineString(t,null);if(t instanceof Qt)return this.transformPolygon(t,null);if(t instanceof ie)return this.transformMultiPolygon(t,null);if(t instanceof jt)return this.transformGeometryCollection(t,null);throw new y("Unknown Geometry subtype: "+t.getClass().getName())},Hr.prototype.transformLinearRing=function(t,e){var i=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===i)return this._factory.createLinearRing(null);var r=i.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr};var Jr=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new fi,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Kt&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this._srcPts=i,this._isClosed=t.isClosed(i),this._snapTolerance=r}};Jr.prototype.snapVertices=function(t,e){for(var i=this._isClosed?t.size()-1:t.size(),r=0;r<i;r++){var n=t.get(r),o=this.findSnapForVertex(n,e);null!==o&&(t.set(r,new S(o)),0===r&&this._isClosed&&t.set(t.size()-1,new S(o)))}},Jr.prototype.findSnapForVertex=function(t,e){for(var i=0;i<e.length;i++){if(t.equals2D(e[i]))return null;if(t.distance(e[i])<this._snapTolerance)return e[i]}return null},Jr.prototype.snapTo=function(t){var e=new Tt(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Jr.prototype.snapSegments=function(t,e){if(0===e.length)return null;var i=e.length;e[0].equals2D(e[e.length-1])&&(i=e.length-1);for(var r=0;r<i;r++){var n=e[r],o=this.findSegmentIndexToSnap(n,t);o>=0&&t.add(o+1,new S(n),!1)}},Jr.prototype.findSegmentIndexToSnap=function(t,e){for(var i=A.MAX_VALUE,r=-1,n=0;n<e.size()-1;n++){if(this._seg.p0=e.get(n),this._seg.p1=e.get(n+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<i&&(i=o,r=n)}return r},Jr.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr},Jr.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Kr=function(t){this._srcGeom=t||null},$r={SNAP_PRECISION_FACTOR:{configurable:!0}};Kr.prototype.snapTo=function(t,e){var i=this.extractTargetCoordinates(t);return new Yr(e,i).transform(this._srcGeom)},Kr.prototype.snapToSelf=function(t,e){var i=this.extractTargetCoordinates(this._srcGeom),r=new Yr(t,i,!0).transform(this._srcGeom),n=r;return e&&L(n,Xt)&&(n=r.buffer(0)),n},Kr.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Kr.prototype.extractTargetCoordinates=function(t){for(var e=new d,i=t.getCoordinates(),r=0;r<i.length;r++)e.add(i[r]);return e.toArray(new Array(0).fill(null))},Kr.prototype.computeMinimumSegmentLength=function(t){for(var e=A.MAX_VALUE,i=0;i<t.length-1;i++){var r=t[i].distance(t[i+1]);r<e&&(e=r)}return e},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr},Kr.snap=function(t,e,i){var r=new Array(2).fill(null),n=new Kr(t);r[0]=n.snapTo(e,i);var o=new Kr(e);return r[1]=o.snapTo(r[0],i),r},Kr.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Kr.computeSizeBasedSnapTolerance(t),i=t.getPrecisionModel();if(i.getType()===de.FIXED){var r=1/i.getScale()*2/1.415;r>e&&(e=r)}return e}if(2===arguments.length){var n=arguments[0],o=arguments[1];return Math.min(Kr.computeOverlaySnapTolerance(n),Kr.computeOverlaySnapTolerance(o))}},Kr.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Kr.SNAP_PRECISION_FACTOR},Kr.snapToSelf=function(t,e,i){return new Kr(t).snapToSelf(e,i)},$r.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Kr,$r);var Yr=function(t){function e(e,i,r){t.call(this),this._snapTolerance=e||null,this._snapPts=i||null,this._isSelfSnap=void 0!==r&&r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var i=new Jr(t,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var i=t.toCoordinateArray(),r=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(r)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hr),Xr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Xr.prototype.getCommon=function(){return A.longBitsToDouble(this._commonBits)},Xr.prototype.add=function(t){var e=A.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=Xr.signExpBits(this._commonBits),this._isFirst=!1,null):Xr.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Xr.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=Xr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Xr.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=A.longBitsToDouble(t),i="0000000000000000000000000000000000000000000000000000000000000000"+A.toBinaryString(t),r=i.substring(i.length-64);return r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+e+" ]"}},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr},Xr.getBit=function(t,e){return t&1<<e?1:0},Xr.signExpBits=function(t){return t>>52},Xr.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Xr.numCommonMostSigMantissaBits=function(t,e){for(var i=0,r=52;r>=0;r--){if(Xr.getBit(t,r)!==Xr.getBit(e,r))return i;i++}return 52};var Qr=function(){this._commonCoord=null,this._ccFilter=new en},tn={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Qr.prototype.addCommonBits=function(t){var e=new rn(this._commonCoord);t.apply(e),t.geometryChanged()},Qr.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new S(this._commonCoord);e.x=-e.x,e.y=-e.y;var i=new rn(e);return t.apply(i),t.geometryChanged(),t},Qr.prototype.getCommonCoordinate=function(){return this._commonCoord},Qr.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},tn.CommonCoordinateFilter.get=function(){return en},tn.Translater.get=function(){return rn},Object.defineProperties(Qr,tn);var en=function(){this._commonBitsX=new Xr,this._commonBitsY=new Xr};en.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},en.prototype.getCommonCoordinate=function(){return new S(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},en.prototype.interfaces_=function(){return[dt]},en.prototype.getClass=function(){return en};var rn=function(){this.trans=null;var t=arguments[0];this.trans=t};rn.prototype.filter=function(t,e){var i=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,i),t.setOrdinate(e,1,r)},rn.prototype.isDone=function(){return!1},rn.prototype.isGeometryChanged=function(){return!0},rn.prototype.interfaces_=function(){return[Vt]},rn.prototype.getClass=function(){return rn};var nn=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};nn.prototype.selfSnap=function(t){return new Kr(t).snapTo(t,this._snapTolerance)},nn.prototype.removeCommonBits=function(t){this._cbr=new Qr,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},nn.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},nn.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),i=Cn.overlayOp(e[0],e[1],t);return this.prepareResult(i)},nn.prototype.checkValid=function(t){t.isValid()||Z.out.println("Snapped geometry is invalid")},nn.prototype.computeSnapTolerance=function(){this._snapTolerance=Kr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},nn.prototype.snap=function(t){var e=this.removeCommonBits(t);return Kr.snap(e[0],e[1],this._snapTolerance)},nn.prototype.interfaces_=function(){return[]},nn.prototype.getClass=function(){return nn},nn.overlayOp=function(t,e,i){return new nn(t,e).getResultGeometry(i)},nn.union=function(t,e){return nn.overlayOp(t,e,Cn.UNION)},nn.intersection=function(t,e){return nn.overlayOp(t,e,Cn.INTERSECTION)},nn.symDifference=function(t,e){return nn.overlayOp(t,e,Cn.SYMDIFFERENCE)},nn.difference=function(t,e){return nn.overlayOp(t,e,Cn.DIFFERENCE)};var on=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};on.prototype.getResultGeometry=function(t){var e=null,i=!1,r=null;try{e=Cn.overlayOp(this._geom[0],this._geom[1],t),i=!0}catch(t){if(!(t instanceof Q))throw t;r=t}if(!i)try{e=nn.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Q?r:t}return e},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},on.overlayOp=function(t,e,i){return new on(t,e).getResultGeometry(i)},on.union=function(t,e){return on.overlayOp(t,e,Cn.UNION)},on.intersection=function(t,e){return on.overlayOp(t,e,Cn.INTERSECTION)},on.symDifference=function(t,e){return on.overlayOp(t,e,Cn.SYMDIFFERENCE)},on.difference=function(t,e){return on.overlayOp(t,e,Cn.DIFFERENCE)};var sn=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};sn.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},sn.prototype.interfaces_=function(){return[]},sn.prototype.getClass=function(){return sn};var an=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],i=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=i}else if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=n,this._obj=o}},ln={INSERT:{configurable:!0},DELETE:{configurable:!0}};an.prototype.isDelete=function(){return this._eventType===an.DELETE},an.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},an.prototype.getObject=function(){return this._obj},an.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},an.prototype.getInsertEvent=function(){return this._insertEvent},an.prototype.isInsert=function(){return this._eventType===an.INSERT},an.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},an.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},an.prototype.interfaces_=function(){return[x]},an.prototype.getClass=function(){return an},ln.INSERT.get=function(){return 1},ln.DELETE.get=function(){return 2},Object.defineProperties(an,ln);var cn=function(){};cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn};var un=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],i=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=i};un.prototype.isTrivialIntersection=function(t,e,i,r){if(t===i&&1===this._li.getIntersectionNum()){if(un.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var n=t.getNumPoints()-1;if(0===e&&r===n||0===r&&e===n)return!0}}return!1},un.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},un.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},un.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},un.prototype.isBoundaryPointInternal=function(t,e){for(var i=e.iterator();i.hasNext();){var r=i.next().getCoordinate();if(t.isIntersection(r))return!0}return!1},un.prototype.hasProperIntersection=function(){return this._hasProper},un.prototype.hasIntersection=function(){return this._hasIntersection},un.prototype.isDone=function(){return this._isDone},un.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},un.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},un.prototype.addIntersections=function(t,e,i,r){if(t===i&&e===r)return null;this.numTests++;var n=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[r],a=i.getCoordinates()[r+1];this._li.computeIntersection(n,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,i,r)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),i.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},un.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var hn=function(t){function e(){t.call(this),this.events=new wt,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){Qe.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var i=this.events.get(e);if(i.isInsert()&&this.processOverlaps(e,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof un&&L(arguments[0],bt)&&L(arguments[1],bt)){var r=arguments[0],n=arguments[1],o=arguments[2];this.addEdges(r,r),this.addEdges(n,n),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&L(arguments[0],bt)&&arguments[1]instanceof un){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},e.prototype.addEdge=function(t,e){for(var i=t.getMonotoneChainEdge(),r=i.getStartIndexes(),n=0;n<r.length-1;n++){var o=new sn(i,n),s=new an(e,i.getMinX(n),o);this.events.add(s),this.events.add(new an(i.getMaxX(n),s))}},e.prototype.processOverlaps=function(t,e,i,r){for(var n=i.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(n.computeIntersections(a,r),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var i=arguments[1],r=arguments[0].iterator();r.hasNext();){var n=r.next();this.addEdge(n,i)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cn),pn=function(){this._min=A.POSITIVE_INFINITY,this._max=A.NEGATIVE_INFINITY},dn={NodeComparator:{configurable:!0}};pn.prototype.getMin=function(){return this._min},pn.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},pn.prototype.getMax=function(){return this._max},pn.prototype.toString=function(){return X.toLineString(new S(this._min,0),new S(this._max,0))},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},dn.NodeComparator.get=function(){return fn},Object.defineProperties(pn,dn);var fn=function(){};fn.prototype.compare=function(t,e){var i=t,r=e,n=(i._min+i._max)/2,o=(r._min+r._max)/2;return n<o?-1:n>o?1:0},fn.prototype.interfaces_=function(){return[w]},fn.prototype.getClass=function(){return fn};var mn=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],i=arguments[1],r=arguments[2];this._min=e,this._max=i,this._item=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pn),gn=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],i=arguments[1];this._node1=e,this._node2=i,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,i),null!==this._node2&&this._node2.query(t,e,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pn),_n=function(){this._leaves=new wt,this._root=null,this._level=0};_n.prototype.buildTree=function(){Qe.sort(this._leaves,new pn.NodeComparator);for(var t=this._leaves,e=null,i=new wt;;){if(this.buildLevel(t,i),1===i.size())return i.get(0);e=t,t=i,i=e}},_n.prototype.insert=function(t,e,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new mn(t,e,i))},_n.prototype.query=function(t,e,i){this.init(),this._root.query(t,e,i)},_n.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},_n.prototype.printNode=function(t){Z.out.println(X.toLineString(new S(t._min,this._level),new S(t._max,this._level)))},_n.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},_n.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var i=0;i<t.size();i+=2){var r=t.get(i);if(null===(i+1<t.size()?t.get(i):null))e.add(r);else{var n=new gn(t.get(i),t.get(i+1));e.add(n)}}},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n};var yn=function(){this._items=new wt};yn.prototype.visitItem=function(t){this._items.add(t)},yn.prototype.getItems=function(){return this._items},yn.prototype.interfaces_=function(){return[Ke]},yn.prototype.getClass=function(){return yn};var An=function(){this._index=null;var t=arguments[0];if(!L(t,Xt))throw new y("Argument must be Polygonal");this._index=new bn(t)},vn={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};An.prototype.locate=function(t){var e=new st(t),i=new xn(e);return this._index.query(t.y,t.y,i),e.getLocation()},An.prototype.interfaces_=function(){return[Bi]},An.prototype.getClass=function(){return An},vn.SegmentVisitor.get=function(){return xn},vn.IntervalIndexedGeometry.get=function(){return bn},Object.defineProperties(An,vn);var xn=function(){this._counter=null;var t=arguments[0];this._counter=t};xn.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},xn.prototype.interfaces_=function(){return[Ke]},xn.prototype.getClass=function(){return xn};var bn=function(){this._index=new _n;var t=arguments[0];this.init(t)};bn.prototype.init=function(t){for(var e=wr.getLines(t).iterator();e.hasNext();){var i=e.next().getCoordinates();this.addLine(i)}},bn.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var i=new fi(t[e-1],t[e]),r=Math.min(i.p0.y,i.p1.y),n=Math.max(i.p0.y,i.p1.y);this._index.insert(r,n,i)}},bn.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new yn;return this._index.query(t,e,i),i.getItems()}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2];this._index.query(r,n,o)}},bn.prototype.interfaces_=function(){return[]},bn.prototype.getClass=function(){return bn};var wn=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new pe,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Sr,2===arguments.length){var e=arguments[0],i=arguments[1],r=ft.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=i,this._boundaryNodeRule=r,null!==i&&this.add(i)}else if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=n,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,i){var r=this._nodes.addNode(i).getLabel(),n=1;r.getLocation(t,Te.ON)===E.BOUNDARY&&n++;var o=e.determineBoundary(this._boundaryNodeRule,n);r.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var i=arguments[1],r=arguments[2],n=new un(arguments[0],!0,!1);n.setIsDoneIfProperInt(r);var o=this.createEdgeSetIntersector(),s=this._parentGeom instanceof ee||this._parentGeom instanceof Qt||this._parentGeom instanceof ie,a=i||!s;return o.computeIntersections(this._edges,n,a),this.addSelfIntersectionNodes(this._argIndex),n}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,i){var r=new un(e,i,!0);return r.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,r),r},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Yt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,E.INTERIOR)}else if(arguments[0]instanceof S){var e=arguments[0];this.insertPoint(this._argIndex,e,E.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),E.EXTERIOR,E.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var i=t.getInteriorRingN(e);this.addPolygonRing(i,E.INTERIOR,E.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],E.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],E.BOUNDARY)},e.prototype.addLineString=function(t){var e=Ct.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var i=new er(e,new ke(this._argIndex,E.INTERIOR));this._lineEdgeMap.put(t,i),this.insertEdge(i),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),i=0,r=t.iterator();r.hasNext();){var n=r.next();e[i++]=n.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,i){if(this.isBoundaryNode(t,e))return null;i===E.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,i)},e.prototype.addPolygonRing=function(t,e,i){if(t.isEmpty())return null;var r=Ct.removeRepeatedPoints(t.getCoordinates());if(r.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var n=e,o=i;at.isCCW(r)&&(n=i,o=e);var s=new er(r,new ke(this._argIndex,E.BOUNDARY,n,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,r[0],E.BOUNDARY)},e.prototype.insertPoint=function(t,e,i){var r=this._nodes.addNode(e),n=r.getLabel();null===n?r._label=new ke(t,i):n.setLocation(t,i)},e.prototype.createEdgeSetIntersector=function(){return new hn},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var i=e.next(),r=i.getLabel().getLocation(t),n=i.eiList.iterator();n.hasNext();){var o=n.next();this.addSelfIntersectionNode(t,o.coord,r)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ie&&(this._useBoundaryDeterminationRule=!1),e instanceof Qt)this.addPolygon(e);else if(e instanceof Kt)this.addLineString(e);else if(e instanceof Yt)this.addPoint(e);else if(e instanceof te)this.addCollection(e);else if(e instanceof Gt)this.addCollection(e);else if(e instanceof ie)this.addCollection(e);else{if(!(e instanceof jt))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},e.prototype.locate=function(t){return L(this._parentGeom,Xt)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new An(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?E.BOUNDARY:E.INTERIOR},e}(Ze),Sn=function(){if(this._li=new nt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new wn(0,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],r=ft.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new wn(0,e,r),this._arg[1]=new wn(1,i,r)}else if(3===arguments.length){var n=arguments[0],o=arguments[1],s=arguments[2];n.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new wn(0,n,s),this._arg[1]=new wn(1,o,s)}};Sn.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Sn.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn};var Tn=function(){};Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Tn.map=function(){if(arguments[0]instanceof ut&&L(arguments[1],Tn.MapOp)){for(var t=arguments[0],e=arguments[1],i=new wt,r=0;r<t.getNumGeometries();r++){var n=e.map(t.getGeometryN(r));null!==n&&i.add(n)}return t.getFactory().buildGeometry(i)}if(L(arguments[0],vt)&&L(arguments[1],Tn.MapOp)){for(var o=arguments[0],s=arguments[1],a=new wt,l=o.iterator();l.hasNext();){var c=l.next(),u=s.map(c);null!==u&&a.add(u)}return a}},Tn.MapOp=function(){};var Cn=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i),this._ptLocator=new Sr,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Wi,this._resultPolyList=new wt,this._resultLineList=new wt,this._resultPointList=new wt,this._graph=new Ze(new Zi),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new ke(t.getLabel())).flip();var n=e.getDepth();n.isNull()&&n.add(i),n.add(r),i.merge(r)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),i=e.getSym();e.isInResult()&&i.isInResult()&&(e.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,i,r,n){var o=new wt;return o.addAll(t),o.addAll(i),o.addAll(r),o.isEmpty()?e.createEmptyResult(n,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var i=e.iterator();i.hasNext();){var r=i.next();if(this._ptLocator.locate(t,r)!==E.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new wt,e=this._edgeList.iterator();e.hasNext();){var i=e.next();i.isCollapsed()&&(e.remove(),t.add(i.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getEdges().getLabel();e.getLabel().merge(i)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this.insertUniqueEdge(i)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new wt;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var i=new qe(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var r=new qr(this,this._geomFact,this._ptLocator);this._resultLineList=r.build(t);var n=new Wr(this,this._geomFact,this._ptLocator);this._resultPointList=n.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,i)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var i=e.next();this._graph.addNode(i.getCoordinate()).setLabel(t,i.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var r=i.next(),n=r.getLabel();n.isArea()&&!r.isInteriorAreaEdge()&&e.isResultOfOp(n.getLocation(0,Te.RIGHT),n.getLocation(1,Te.RIGHT),t)&&r.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),i=e.getLabel(),r=e.getDepth();if(!r.isNull()){r.normalize();for(var n=0;n<2;n++)i.isNull(n)||!i.isArea()||r.isNull(n)||(0===r.getDelta(n)?i.toLine(n):(et.isTrue(!r.isNull(n,Te.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(n,Te.LEFT,r.getLocation(n,Te.LEFT)),et.isTrue(!r.isNull(n,Te.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(n,Te.RIGHT,r.getLocation(n,Te.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getLabel();e.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(i)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Sn);Cn.overlayOp=function(t,e,i){return new Cn(t,e).getResultGeometry(i)},Cn.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Cn.createEmptyResult(Cn.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var i=e;return Zr.map(t,{interfaces_:function(){return[Tn.MapOp]},map:function(t){return t.intersection(i)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),on.overlayOp(t,e,Cn.INTERSECTION)},Cn.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Cn.createEmptyResult(Cn.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),on.overlayOp(t,e,Cn.SYMDIFFERENCE)},Cn.resultDimension=function(t,e,i){var r=e.getDimension(),n=i.getDimension(),o=-1;switch(t){case Cn.INTERSECTION:o=Math.min(r,n);break;case Cn.UNION:o=Math.max(r,n);break;case Cn.DIFFERENCE:o=r;break;case Cn.SYMDIFFERENCE:o=Math.max(r,n)}return o},Cn.createEmptyResult=function(t,e,i,r){var n=null;switch(Cn.resultDimension(t,e,i)){case-1:n=r.createGeometryCollection(new Array(0).fill(null));break;case 0:n=r.createPoint();break;case 1:n=r.createLineString();break;case 2:n=r.createPolygon()}return n},Cn.difference=function(t,e){return t.isEmpty()?Cn.createEmptyResult(Cn.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),on.overlayOp(t,e,Cn.DIFFERENCE))},Cn.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=t.getLocation(0),r=t.getLocation(1);return Cn.isResultOfOp(i,r,e)}if(3===arguments.length){var n=arguments[0],o=arguments[1];switch(n===E.BOUNDARY&&(n=E.INTERIOR),o===E.BOUNDARY&&(o=E.INTERIOR),arguments[2]){case Cn.INTERSECTION:return n===E.INTERIOR&&o===E.INTERIOR;case Cn.UNION:return n===E.INTERIOR||o===E.INTERIOR;case Cn.DIFFERENCE:return n===E.INTERIOR&&o!==E.INTERIOR;case Cn.SYMDIFFERENCE:return n===E.INTERIOR&&o!==E.INTERIOR||n!==E.INTERIOR&&o===E.INTERIOR}return!1}},Cn.INTERSECTION=1,Cn.UNION=2,Cn.DIFFERENCE=3,Cn.SYMDIFFERENCE=4;var Mn=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Sr,this._seg=new fi;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Mn.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var i=this._linework.getGeometryN(e).getCoordinateSequence(),r=0;r<i.size()-1;r++)if(i.getCoordinate(r,this._seg.p0),i.getCoordinate(r+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Mn.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?E.BOUNDARY:this._ptLocator.locate(t,this._g)},Mn.prototype.extractLinework=function(t){var e=new En;t.apply(e);var i=e.getLinework(),r=_e.toLineStringArray(i);return t.getFactory().createMultiLineString(r)},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn};var En=function(){this._linework=null,this._linework=new wt};En.prototype.getLinework=function(){return this._linework},En.prototype.filter=function(t){if(t instanceof Qt){var e=t;this._linework.add(e.getExteriorRing());for(var i=0;i<e.getNumInteriorRing();i++)this._linework.add(e.getInteriorRingN(i))}},En.prototype.interfaces_=function(){return[Ut]},En.prototype.getClass=function(){return En};var In=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};In.prototype.extractPoints=function(t,e,i){for(var r=t.getCoordinates(),n=0;n<r.length-1;n++)this.computeOffsetPoints(r[n],r[n+1],e,i)},In.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},In.prototype.getPoints=function(t){for(var e=new wt,i=wr.getLines(this._g).iterator();i.hasNext();){var r=i.next();this.extractPoints(r,t,e)}return e},In.prototype.computeOffsetPoints=function(t,e,i,r){var n=e.x-t.x,o=e.y-t.y,s=Math.sqrt(n*n+o*o),a=i*n/s,l=i*o/s,c=(e.x+t.x)/2,u=(e.y+t.y)/2;if(this._doLeft){var h=new S(c-l,u+a);r.add(h)}if(this._doRight){var p=new S(c+l,u-a);r.add(p)}},In.prototype.interfaces_=function(){return[]},In.prototype.getClass=function(){return In};var Ln=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new wt;var e=arguments[0],i=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,i),this._geom=[e,i,r],this._locFinder=[new Mn(this._geom[0],this._boundaryDistanceTolerance),new Mn(this._geom[1],this._boundaryDistanceTolerance),new Mn(this._geom[2],this._boundaryDistanceTolerance)]},Pn={TOLERANCE:{configurable:!0}};Ln.prototype.reportResult=function(t,e,i){Z.out.println("Overlay result invalid - A:"+E.toLocationSymbol(e[0])+" B:"+E.toLocationSymbol(e[1])+" expected:"+(i?"i":"e")+" actual:"+E.toLocationSymbol(e[2]))},Ln.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},Ln.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var i=this._testCoords.get(e);if(!this.checkValid(t,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var r=arguments[0],n=arguments[1];return this._location[0]=this._locFinder[0].getLocation(n),this._location[1]=this._locFinder[1].getLocation(n),this._location[2]=this._locFinder[2].getLocation(n),!!Ln.hasLocation(this._location,E.BOUNDARY)||this.isValidResult(r,this._location)}},Ln.prototype.addTestPts=function(t){var e=new In(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},Ln.prototype.isValidResult=function(t,e){var i=Cn.isResultOfOp(e[0],e[1],t),r=!(i^e[2]===E.INTERIOR);return r||this.reportResult(t,e,i),r},Ln.prototype.getInvalidLocation=function(){return this._invalidLocation},Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Ln.hasLocation=function(t,e){for(var i=0;i<3;i++)if(t[i]===e)return!0;return!1},Ln.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Kr.computeSizeBasedSnapTolerance(t),Kr.computeSizeBasedSnapTolerance(e))},Ln.isValid=function(t,e,i,r){return new Ln(t,e,r).isValid(i)},Pn.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Ln,Pn);var kn=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};kn.prototype.extractElements=function(t,e){if(null===t)return null;for(var i=0;i<t.getNumGeometries();i++){var r=t.getGeometryN(i);this._skipEmpty&&r.isEmpty()||e.add(r)}},kn.prototype.combine=function(){for(var t=new wt,e=this._inputGeoms.iterator();e.hasNext();){var i=e.next();this.extractElements(i,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},kn.prototype.interfaces_=function(){return[]},kn.prototype.getClass=function(){return kn},kn.combine=function(){return 1===arguments.length?new kn(arguments[0]).combine():2===arguments.length?new kn(kn.createList(arguments[0],arguments[1])).combine():3===arguments.length?new kn(kn.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},kn.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},kn.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new wt;return i.add(t),i.add(e),i}if(3===arguments.length){var r=arguments[0],n=arguments[1],o=arguments[2],s=new wt;return s.add(r),s.add(n),s.add(o),s}};var Nn=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new wt)},Dn={STRTREE_NODE_CAPACITY:{configurable:!0}};Nn.prototype.reduceToGeometries=function(t){for(var e=new wt,i=t.iterator();i.hasNext();){var r=i.next(),n=null;L(r,bt)?n=this.unionTree(r):r instanceof ut&&(n=r),e.add(n)}return e},Nn.prototype.extractByEnvelope=function(t,e,i){for(var r=new wt,n=0;n<e.getNumGeometries();n++){var o=e.getGeometryN(n);o.getEnvelopeInternal().intersects(t)?r.add(o):i.add(o)}return this._geomFactory.buildGeometry(r)},Nn.prototype.unionOptimized=function(t,e){var i=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!i.intersects(r))return kn.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var n=i.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,n)},Nn.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new oi(Nn.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var i=e.next();t.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var r=t.itemsTree();return this.unionTree(r)},Nn.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],i=arguments[1],r=arguments[2];if(r-i<=1){var n=Nn.getGeometry(e,i);return this.unionSafe(n,null)}if(r-i==2)return this.unionSafe(Nn.getGeometry(e,i),Nn.getGeometry(e,i+1));var o=Math.trunc((r+i)/2),s=this.binaryUnion(e,i,o),a=this.binaryUnion(e,o,r);return this.unionSafe(s,a)}},Nn.prototype.repeatedUnion=function(t){for(var e=null,i=t.iterator();i.hasNext();){var r=i.next();e=null===e?r.copy():e.union(r)}return e},Nn.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Nn.prototype.unionActual=function(t,e){return Nn.restrictToPolygons(t.union(e))},Nn.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Nn.prototype.unionUsingEnvelopeIntersection=function(t,e,i){var r=new wt,n=this.extractByEnvelope(i,t,r),o=this.extractByEnvelope(i,e,r),s=this.unionActual(n,o);return r.add(s),kn.combine(r)},Nn.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().createGeometryCollection([e,i]).buffer(0)}},Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},Nn.restrictToPolygons=function(t){if(L(t,Xt))return t;var e=br.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(_e.toPolygonArray(e))},Nn.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Nn.union=function(t){return new Nn(t).union()},Dn.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Nn,Dn);var On=function(){};On.prototype.interfaces_=function(){return[]},On.prototype.getClass=function(){return On},On.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Cn.createEmptyResult(Cn.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),on.overlayOp(t,e,Cn.UNION)},t.GeoJSONReader=we,t.GeoJSONWriter=Se,t.OverlayOp=Cn,t.UnionOp=On,t.BufferOp=fr,Object.defineProperty(t,"__esModule",{value:!0})}(e)},91943:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});const r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)}},43407:(t,e,i)=>{"use strict";let r;i.d(e,{A:()=>o});const n=new Uint8Array(16);function o(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(n)}},38823:(t,e,i)=>{"use strict";i.d(e,{k:()=>n});const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function n(t,e=0){return r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]}},18562:(t,e,i)=>{"use strict";i.d(e,{A:()=>s});var r=i(91943),n=i(43407),o=i(38823);const s=function(t,e,i){if(r.A.randomUUID&&!e&&!t)return r.A.randomUUID();const s=(t=t||{}).random||(t.rng||n.A)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=s[t];return e}return(0,o.k)(s)}},40080:t=>{t.exports=r,t.exports.parse=r,t.exports.stringify=function t(e){function i(t){return t.join(" ")}function r(t){return t.map(i).join(", ")}function n(t){return t.map(r).map(o).join(", ")}function o(t){return"("+t+")"}switch("Feature"===e.type&&(e=e.geometry),e.type){case"Point":return"POINT ("+i(e.coordinates)+")";case"LineString":return"LINESTRING ("+r(e.coordinates)+")";case"Polygon":return"POLYGON ("+n(e.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+r(e.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+e.coordinates.map(n).map(o).join(", ")+")";case"MultiLineString":return"MULTILINESTRING ("+n(e.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+e.geometries.map(t).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};var e=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,i=new RegExp("^"+e.source+"(\\s"+e.source+"){1,}");function r(t){var e,r=t.split(";"),n=r.pop(),o=(r.shift()||"").split("=").pop(),s=0;function a(t){var e=n.substring(s).match(t);return e?(s+=e[0].length,e[0]):null}function l(){a(/^\s*/)}function c(){l();for(var t,e=0,r=[],n=[r],o=r;t=a(/^(\()/)||a(/^(\))/)||a(/^(,)/)||a(i);){if("("===t)n.push(o),o=[],n[n.length-1].push(o),e++;else if(")"===t){if(0===o.length)return null;if(!(o=n.pop()))return null;if(0==--e)break}else if(","===t)o=[],n[n.length-1].push(o);else{if(t.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(o,t.split(/\s/g).map(parseFloat))}l()}return 0!==e?null:r}function u(){for(var t,e,r=[];e=a(i)||a(/^(,)/);)","===e?(r.push(t),t=[]):e.split(/\s/g).some(isNaN)||(t||(t=[]),Array.prototype.push.apply(t,e.split(/\s/g).map(parseFloat))),l();return t?(r.push(t),r.length?r:null):null}return(e=function t(){return function(){if(!a(/^(point(\sz)?)/i))return null;if(l(),!a(/^(\()/))return null;var t=u();return t?(l(),a(/^(\))/)?{type:"Point",coordinates:t[0]}:null):null}()||function(){if(!a(/^(linestring(\sz)?)/i))return null;if(l(),!a(/^(\()/))return null;var t=u();return t&&a(/^(\))/)?{type:"LineString",coordinates:t}:null}()||function(){if(!a(/^(polygon(\sz)?)/i))return null;l();var t=c();return t?{type:"Polygon",coordinates:t}:null}()||function(){if(!a(/^(multipoint)/i))return null;l();var t=n.substring(n.indexOf("(")+1,n.length-1).replace(/\(/g,"").replace(/\)/g,"");n="MULTIPOINT ("+t+")";var e=c();return e?(l(),{type:"MultiPoint",coordinates:e}):null}()||function(){if(!a(/^(multilinestring)/i))return null;l();var t=c();return t?(l(),{type:"MultiLineString",coordinates:t}):null}()||function(){if(!a(/^(multipolygon)/i))return null;l();var t=c();return t?{type:"MultiPolygon",coordinates:t}:null}()||function(){var e,i=[];if(!a(/^(geometrycollection)/i))return null;if(l(),!a(/^(\()/))return null;for(;e=t();)i.push(e),l(),a(/^(,)/),l();return a(/^(\))/)?{type:"GeometryCollection",geometries:i}:null}()}())&&o.match(/\d+/)&&(e.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+o}}),e}},51119:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(81328),n=i(95114),o=.017453292519943295;function s(t){return t*o}function a(t){var e=(0,r.A)(t),i=e.shift(),o=e.shift();e.unshift(["name",o]),e.unshift(["type",i]);var a={};return(0,n.J)(e,a),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,r=t.AXIS.length;i<r;++i){var n=[t.AXIS[i][0].toLowerCase(),t.AXIS[i][1].toLowerCase()];-1!==n[0].indexOf("north")||("y"===n[0]||"lat"===n[0])&&"north"===n[1]?e+="n":-1!==n[0].indexOf("south")||("y"===n[0]||"lat"===n[0])&&"south"===n[1]?e+="s":-1!==n[0].indexOf("east")||("x"===n[0]||"lon"===n[0])&&"east"===n[1]?e+="e":-1===n[0].indexOf("west")&&("x"!==n[0]&&"lon"!==n[0]||"west"!==n[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var o=t.GEOGCS;function a(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(o=t),o&&(o.DATUM?t.datumCode=o.DATUM.name.toLowerCase():t.datumCode=o.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(t.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=o.DATUM.SPHEROID.a,t.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(t.datum_params=o.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",s],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",s],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",s],["lat0","latitude_of_origin",s],["lat0","standard_parallel_1",s],["lat1","standard_parallel_1",s],["lat2","standard_parallel_2",s],["azimuth","Azimuth"],["alpha","azimuth",s],["srsCode","name"]].forEach((function(e){return i=t,n=(r=e)[0],o=r[1],void(!(n in i)&&o in i&&(i[n]=i[o],3===r.length&&(i[n]=r[2](i[n]))));var i,r,n,o})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName?!t.lat_ts&&t.lat0&&"Polar_Stereographic"===t.projName&&(t.lat_ts=t.lat0,t.lat0=s(t.lat0>0?90:-90)):(t.lat0=s(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(a),a}},81328:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});const r=function(t){return new u(t).output()};var n=1,o=/\s/,s=/[A-Za-z]/,a=/[A-Za-z84_]/,l=/[,\]]/,c=/[\d\.E\-\+]/;function u(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=n}u.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;o.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case n:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},u.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(l.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},u.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=n)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=n,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},u.prototype.number=function(t){if(!c.test(t)){if(l.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},u.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},u.prototype.keyword=function(t){if(a.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=n)}if(!l.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},u.prototype.neutral=function(t){if(s.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(c.test(t))return this.word=t,void(this.state=3);if(!l.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},u.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)}},95114:(t,e,i)=>{"use strict";function r(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var r=e?{}:t,o=i.reduce((function(t,e){return n(e,t),t}),r);e&&(t[e]=o)}function n(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void n(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var o;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&n(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&n(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void r(e,i,t);default:for(o=-1;++o<t.length;)if(!Array.isArray(t[o]))return n(t,e[i]);return r(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}i.d(e,{J:()=>n})},72489:()=>{!function(t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var e,i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},i(t,e)},r=function(t,e){return function(t){var e=(e=function(t){if(this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"},this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"},this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600},e.prototype._singletonInstance)return e.prototype._singletonInstance;if(e.prototype._singletonInstance=this,this.instance="https://login.microsoftonline.com/",this.config={},this.callback=null,this.popUp=!1,this.isAngular=!1,this._user=null,this._activeRenewals={},this._loginInProgress=!1,this._acquireTokenInProgress=!1,this._renewStates=[],this._callBackMappedToRenewStates={},this._callBacksMappedToRenewStates={},this._openedWindows=[],this._requestType=this.REQUEST_TYPE.LOGIN,window._adalInstance=this,t.displayCall&&"function"!=typeof t.displayCall)throw new Error("displayCall is not a function");if(!t.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(t),void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0),this.config.popUp&&(this.popUp=!0),this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback),this.config.instance&&(this.instance=this.config.instance),this.config.loginResource||(this.config.loginResource=this.config.clientId),this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]),this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]),this.config.isAngular&&(this.isAngular=this.config.isAngular),this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)},"undefined"!=typeof window&&(window.Logging={piiLoggingEnabled:!1,level:0,log:function(t){}}),e.prototype.login=function(){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var t=this._guid();this.config.state=t,this._idTokenNonce=this._guid();var e=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);e&&""!==e?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):e=window.location.href,this.verbose("Expected state: "+t+" startPage:"+e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,e),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,t,!0),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var i=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);this.config.displayCall?this.config.displayCall(i):this.popUp?(this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._renewStates.push(t),this.registerCallback(t,this.config.clientId,this.callback),this._loginPopup(i)):this.promptUser(i)}},e.prototype._openPopup=function(t,e,i,r){try{var n=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=s/2-i/2+n,c=a/2-r/2+o,u=window.open(t,e,"width="+i+", height="+r+", top="+c+", left="+l);return u.focus&&u.focus(),u}catch(t){return this.warn("Error opening popup, "+t.message),this._loginInProgress=!1,this._acquireTokenInProgress=!1,null}},e.prototype._handlePopupError=function(t,e,i,r,n){this.warn(r),this._saveItem(this.CONSTANTS.STORAGE.ERROR,i),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,r),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,n),e&&this._activeRenewals[e]&&(this._activeRenewals[e]=null),this._loginInProgress=!1,this._acquireTokenInProgress=!1,t&&t(r,null,i)},e.prototype._loginPopup=function(t,e,i){var r=this._openPopup(t,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),n=i||this.callback;if(null!=r){if(this._openedWindows.push(r),-1!=this.config.redirectUri.indexOf("#"))var o=this.config.redirectUri.split("#")[0];else o=this.config.redirectUri;var s=this,a=window.setInterval((function(){if(!r||r.closed||void 0===r.closed){var t="Popup Window closed",i="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";return s.isAngular&&s._broadcast("adal:popUpClosed",i+s.CONSTANTS.RESOURCE_DELIMETER+t),s._handlePopupError(n,e,t,i,i),void window.clearInterval(a)}try{var l=r.location;if(-1!=encodeURI(l.href).indexOf(encodeURI(o)))return s.isAngular?s._broadcast("adal:popUpHashChanged",l.hash):s.handleWindowCallback(l.hash),window.clearInterval(a),s._loginInProgress=!1,s._acquireTokenInProgress=!1,s.info("Closing popup window"),s._openedWindows=[],void r.close()}catch(t){}}),1)}else{var l="Popup Window is null. This can happen if you are using IE";this._handlePopupError(n,e,"Error opening popup",l,l)}},e.prototype._broadcast=function(t,e){!function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}t.prototype=window.Event.prototype,window.CustomEvent=t}();var i=new CustomEvent(t,{detail:e});window.dispatchEvent(i)},e.prototype.loginInProgress=function(){return this._loginInProgress},e.prototype._hasResource=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return e&&!this._isEmpty(e)&&e.indexOf(t+this.CONSTANTS.RESOURCE_DELIMETER)>-1},e.prototype.getCachedToken=function(t){if(!this._hasResource(t))return null;var e=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t),i=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t),r=this.config.expireOffsetSeconds||300;return i&&i>this._now()+r?e:(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0),null)},e.prototype.getCachedUser=function(){if(this._user)return this._user;var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);return this._user=this._createUser(t),this._user},e.prototype.registerCallback=function(t,e,i){this._activeRenewals[e]=t,this._callBacksMappedToRenewStates[t]||(this._callBacksMappedToRenewStates[t]=[]);var r=this;this._callBacksMappedToRenewStates[t].push(i),this._callBackMappedToRenewStates[t]||(this._callBackMappedToRenewStates[t]=function(i,n,o,s){r._activeRenewals[e]=null;for(var a=0;a<r._callBacksMappedToRenewStates[t].length;++a)try{r._callBacksMappedToRenewStates[t][a](i,n,o,s)}catch(o){r.warn(o)}r._callBacksMappedToRenewStates[t]=null,r._callBackMappedToRenewStates[t]=null})},e.prototype._renewToken=function(t,e,i){this.info("renewToken is called for resource:"+t);var r=this._addAdalFrame("adalRenewFrame"+t),n=this._guid()+"|"+t;this.config.state=n,this._renewStates.push(n),this.verbose("Renew token Expected state: "+n),i=i||"token";var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl(i,t),"prompt");i===this.RESPONSE_TYPE.ID_TOKEN_TOKEN&&(this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),o+="&nonce="+encodeURIComponent(this._idTokenNonce)),o+="&prompt=none",o=this._addHintParameters(o),this.registerCallback(n,t,e),this.verbosePii("Navigate to:"+o),r.src="about:blank",this._loadFrameTimeout(o,"adalRenewFrame"+t,t)},e.prototype._renewIdToken=function(t,e){this.info("renewIdToken is called");var i=this._addAdalFrame("adalIdTokenFrame"),r=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid(),this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0),this.config.state=r,this._renewStates.push(r),this.verbose("Renew Idtoken Expected state: "+r);var n=null==e?null:this.config.clientId,o=(e=e||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(e,n),"prompt"));o+="&prompt=none",o=this._addHintParameters(o),o+="&nonce="+encodeURIComponent(this._idTokenNonce),this.registerCallback(r,this.config.clientId,t),this.verbosePii("Navigate to:"+o),i.src="about:blank",this._loadFrameTimeout(o,"adalIdTokenFrame",this.config.clientId)},e.prototype._urlContainsQueryStringParameter=function(t,e){return new RegExp("[\\?&]"+t+"=").test(e)},e.prototype._urlRemoveQueryStringParameter=function(t,e){var i=new RegExp("(\\&"+e+"=)[^&]+");return t=t.replace(i,""),i=new RegExp("("+e+"=)[^&]+&"),t=t.replace(i,""),i=new RegExp("("+e+"=)[^&]+"),t.replace(i,"")},e.prototype._loadFrameTimeout=function(t,e,i){this.verbose("Set loading state to pending for: "+i),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS),this._loadFrame(t,e);var r=this;setTimeout((function(){if(r._getItem(r.CONSTANTS.STORAGE.RENEW_STATUS+i)===r.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){r.verbose("Loading frame has timed out after: "+r.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+i);var t=r._activeRenewals[i];t&&r._callBackMappedToRenewStates[t]&&r._callBackMappedToRenewStates[t]("Token renewal operation failed due to timeout",null,"Token Renewal Failed"),r._saveItem(r.CONSTANTS.STORAGE.RENEW_STATUS+i,r.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}}),r.CONSTANTS.LOADFRAME_TIMEOUT)},e.prototype._loadFrame=function(t,e){var i=this;i.info("LoadFrame: "+e);var r=e;setTimeout((function(){var e=i._addAdalFrame(r);""!==e.src&&"about:blank"!==e.src||(e.src=t,i._loadFrame(t,r))}),500)},e.prototype.acquireToken=function(t,e){if(this._isEmpty(t))return this.warn("resource is required"),void e("resource is required",null,"resource is required");var i=this.getCachedToken(t);return i?(this.info("Token is already in cache for resource:"+t),void e(null,i,null)):this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint")?void(this._activeRenewals[t]?this.registerCallback(this._activeRenewals[t],t,e):(this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,t===this.config.clientId?this._user?(this.verbose("renewing idtoken"),this._renewIdToken(e)):(this.verbose("renewing idtoken and access_token"),this._renewIdToken(e,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)):this._user?(this.verbose("renewing access_token"),this._renewToken(t,e)):(this.verbose("renewing idtoken and access_token"),this._renewToken(t,e,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)))):(this.warn("User login is required"),void e("User login is required",null,"login required"))},e.prototype.acquireTokenPopup=function(t,e,i,r){if(this._isEmpty(t))return this.warn("resource is required"),void r("resource is required",null,"resource is required");if(!this._user)return this.warn("User login is required"),void r("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+t;this.config.state=n,this._renewStates.push(n),this._requestType=this.REQUEST_TYPE.RENEW_TOKEN,this.verbose("Renew token Expected state: "+n);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",t),"prompt");if(o+="&prompt=select_account",e&&(o+=e),i&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(i);else if(i&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+t),this.registerCallback(n,t,r),this._loginPopup(o,t,r)},e.prototype.acquireTokenRedirect=function(t,e,i){if(this._isEmpty(t))return this.warn("resource is required"),void r("resource is required",null,"resource is required");var r=this.callback;if(!this._user)return this.warn("User login is required"),void r("User login is required",null,"login required");if(this._acquireTokenInProgress)return this.warn("Acquire token interactive is already in progress"),void r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress");var n=this._guid()+"|"+t;this.config.state=n,this.verbose("Renew token Expected state: "+n);var o=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",t),"prompt");if(o+="&prompt=select_account",e&&(o+=e),i&&-1===o.indexOf("&claims"))o+="&claims="+encodeURIComponent(i);else if(i&&-1!==o.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");o=this._addHintParameters(o),this._acquireTokenInProgress=!0,this.info("acquireToken interactive is called for the resource "+t),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,n,!0),this.promptUser(o)},e.prototype.promptUser=function(t){t?(this.infoPii("Navigate to:"+t),window.location.replace(t)):this.info("Navigate url is empty")},e.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""),this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,""),this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._renewStates=[],this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(t)){t=t.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var e=0;e<t.length&&""!==t[e];e++)this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t[e],""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t[e],0)}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")},e.prototype.clearCacheForResource=function(t){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,""),this._hasResource(t)&&(this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,""),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,0))},e.prototype.logOut=function(){var t;if(this.clearCache(),this._user=null,this.config.logOutUri)t=this.config.logOutUri;else{var e="common",i="";this.config.tenant&&(e=this.config.tenant),this.config.postLogoutRedirectUri&&(i="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri)),t=this.instance+e+"/oauth2/logout?"+i}this.infoPii("Logout navigate to: "+t),this.promptUser(t)},e.prototype._isEmpty=function(t){return void 0===t||!t||0===t.length},e.prototype.getUser=function(t){if("function"!=typeof t)throw new Error("callback is not a function");if(this._user)t(null,this._user);else{var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._isEmpty(e)?(this.warn("User information is not available"),t("User information is not available",null)):(this.info("User exists in cache: "),this._user=this._createUser(e),t(null,this._user))}},e.prototype._addHintParameters=function(t){if(this._user&&this._user.profile)if(this._user.profile.sid&&-1!==t.indexOf("&prompt=none"))this._urlContainsQueryStringParameter("sid",t)||(t+="&sid="+encodeURIComponent(this._user.profile.sid));else if(this._user.profile.upn&&(this._urlContainsQueryStringParameter("login_hint",t)||(t+="&login_hint="+encodeURIComponent(this._user.profile.upn)),!this._urlContainsQueryStringParameter("domain_hint",t)&&this._user.profile.upn.indexOf("@")>-1)){var e=this._user.profile.upn.split("@");t+="&domain_hint="+encodeURIComponent(e[e.length-1])}return t},e.prototype._createUser=function(t){var e=null,i=this._extractIdToken(t);return i&&i.hasOwnProperty("aud")&&(i.aud.toLowerCase()===this.config.clientId.toLowerCase()?(e={userName:"",profile:i},i.hasOwnProperty("upn")?e.userName=i.upn:i.hasOwnProperty("email")&&(e.userName=i.email)):this.warn("IdToken has invalid aud field")),e},e.prototype._getHash=function(t){return t.indexOf("#/")>-1?t=t.substring(t.indexOf("#/")+2):t.indexOf("#")>-1&&(t=t.substring(1)),t},e.prototype.isCallback=function(t){t=this._getHash(t);var e=this._deserialize(t);return e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN)},e.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)},e.prototype.getRequestInfo=function(t){t=this._getHash(t);var e=this._deserialize(t),i={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(e&&(i.parameters=e,e.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||e.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||e.hasOwnProperty(this.CONSTANTS.ID_TOKEN))){i.valid=!0;var r="";if(!e.hasOwnProperty("state"))return this.warn("No state returned"),i;if(this.verbose("State: "+e.state),r=e.state,i.stateResponse=r,this._matchState(i))return i;if(!i.stateMatch&&window.parent){i.requestType=this._requestType;for(var n=this._renewStates,o=0;o<n.length;o++)if(n[o]===i.stateResponse){i.stateMatch=!0;break}}}return i},e.prototype._matchNonce=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(e){e=e.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<e.length;i++)if(e[i]&&e[i]===t.profile.nonce)return!0}return!1},e.prototype._matchState=function(t){var e=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(e){e=e.split(this.CONSTANTS.CACHE_DELIMETER);for(var i=0;i<e.length;i++)if(e[i]&&e[i]===t.stateResponse)return t.requestType=this.REQUEST_TYPE.LOGIN,t.stateMatch=!0,!0}var r=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(r)for(r=r.split(this.CONSTANTS.CACHE_DELIMETER),i=0;i<r.length;i++)if(r[i]&&r[i]===t.stateResponse)return t.requestType=this.REQUEST_TYPE.RENEW_TOKEN,t.stateMatch=!0,!0;return!1},e.prototype._getResourceFromState=function(t){if(t){var e=t.indexOf("|");if(e>-1&&e+1<t.length)return t.substring(e+1)}return""},e.prototype.saveTokenFromHash=function(t){this.info("State status:"+t.stateMatch+"; Request type:"+t.requestType),this._saveItem(this.CONSTANTS.STORAGE.ERROR,""),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var e,i=this._getResourceFromState(t.stateResponse);t.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)?(this.infoPii("Error :"+t.parameters.error+"; Error description:"+t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),this._saveItem(this.CONSTANTS.STORAGE.ERROR,t.parameters.error),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,t.parameters[this.CONSTANTS.ERROR_DESCRIPTION]),t.requestType===this.REQUEST_TYPE.LOGIN&&(this._loginInProgress=!1,this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,t.parameters.error_description))):t.stateMatch?(this.info("State is right"),t.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,t.parameters[this.CONSTANTS.SESSION_STATE]),t.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)&&(this.info("Fragment has access token"),this._hasResource(i)||(e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,e+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,t.parameters[this.CONSTANTS.ACCESS_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._expiresIn(t.parameters[this.CONSTANTS.EXPIRES_IN]))),t.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)&&(this.info("Fragment has id token"),this._loginInProgress=!1,this._user=this._createUser(t.parameters[this.CONSTANTS.ID_TOKEN]),this._user&&this._user.profile?this._matchNonce(this._user)?(this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,t.parameters[this.CONSTANTS.ID_TOKEN]),i=this.config.loginResource?this.config.loginResource:this.config.clientId,this._hasResource(i)||(e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"",this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,e+i+this.CONSTANTS.RESOURCE_DELIMETER)),this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+i,t.parameters[this.CONSTANTS.ID_TOKEN]),this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+i,this._user.profile.exp)):(this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN)),this._user=null):(t.parameters.error="invalid id_token",t.parameters.error_description="Invalid id_token. id_token: "+t.parameters[this.CONSTANTS.ID_TOKEN],this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+t.parameters[this.CONSTANTS.ID_TOKEN])))):(t.parameters.error="Invalid_state",t.parameters.error_description="Invalid_state. state: "+t.stateResponse,this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state"),this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+t.stateResponse)),this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+i,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)},e.prototype.getResourceForEndpoint=function(t){if(this.config&&this.config.anonymousEndpoints)for(var e=0;e<this.config.anonymousEndpoints.length;e++)if(t.indexOf(this.config.anonymousEndpoints[e])>-1)return null;if(this.config&&this.config.endpoints)for(var i in this.config.endpoints)if(t.indexOf(i)>-1)return this.config.endpoints[i];return t.indexOf("http://")>-1||t.indexOf("https://")>-1?this._getHostFromUri(t)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource},e.prototype._getHostFromUri=function(t){var e=String(t).replace(/^(https?:)\/\//,"");return e.split("/")[0]},e.prototype.handleWindowCallback=function(t){if(null==t&&(t=window.location.hash),this.isCallback(t)){var e=null,i=!1;this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance?(e=this._openedWindows[this._openedWindows.length-1].opener._adalInstance,i=!0):window.parent&&window.parent._adalInstance&&(e=window.parent._adalInstance);var r,n,o=e.getRequestInfo(t),s=null;n=i||window.parent!==window?e._callBackMappedToRenewStates[o.stateResponse]:e.callback,e.info("Returned from redirect url"),e.saveTokenFromHash(o),o.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent?(window.parent!==window?e.verbose("Window is in iframe, acquiring token silently"):e.verbose("acquiring token interactive in progress"),r=o.parameters[e.CONSTANTS.ACCESS_TOKEN]||o.parameters[e.CONSTANTS.ID_TOKEN],s=e.CONSTANTS.ACCESS_TOKEN):o.requestType===this.REQUEST_TYPE.LOGIN&&(r=o.parameters[e.CONSTANTS.ID_TOKEN],s=e.CONSTANTS.ID_TOKEN);var a=o.parameters[e.CONSTANTS.ERROR_DESCRIPTION],l=o.parameters[e.CONSTANTS.ERROR];try{n&&n(a,r,l,s)}catch(t){e.error("Error occurred in user defined callback function: "+t)}window.parent!==window||i||(e.config.navigateToLoginRequestUrl?window.location.href=e._getItem(e.CONSTANTS.STORAGE.LOGIN_REQUEST):window.location.hash="")}},e.prototype._getNavigateUrl=function(t,e){var i="common";this.config.tenant&&(i=this.config.tenant);var r=this.instance+i+"/oauth2/authorize"+this._serialize(t,this.config,e)+this._addLibMetadata();return this.info("Navigate url:"+r),r},e.prototype._extractIdToken=function(t){var e=this._decodeJwt(t);if(!e)return null;try{var i=e.JWSPayload,r=this._base64DecodeStringUrlSafe(i);return r?JSON.parse(r):(this.info("The returned id_token could not be base64 url safe decoded."),null)}catch(t){this.error("The returned id_token could not be decoded",t)}return null},e.prototype._base64DecodeStringUrlSafe=function(t){return t=t.replace(/-/g,"+").replace(/_/g,"/"),window.atob?decodeURIComponent(escape(window.atob(t))):decodeURIComponent(escape(this._decode(t)))},e.prototype._decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=(t=String(t).replace(/=+$/,"")).length;if(i%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var r,n,o,s,a,l,c,u,h="",p=0;p<i;p+=4){if(r=e.indexOf(t.charAt(p)),n=e.indexOf(t.charAt(p+1)),o=e.indexOf(t.charAt(p+2)),s=e.indexOf(t.charAt(p+3)),p+2===i-1){l=(a=r<<18|n<<12|o<<6)>>16&255,c=a>>8&255,h+=String.fromCharCode(l,c);break}if(p+1===i-1){l=(a=r<<18|n<<12)>>16&255,h+=String.fromCharCode(l);break}l=(a=r<<18|n<<12|o<<6|s)>>16&255,c=a>>8&255,u=255&a,h+=String.fromCharCode(l,c,u)}return h},e.prototype._decodeJwt=function(t){if(this._isEmpty(t))return null;var e=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(t);return!e||e.length<4?(this.warn("The returned id_token is not parseable."),null):{header:e[1],JWSPayload:e[2],JWSSig:e[3]}},e.prototype._convertUrlSafeToRegularBase64EncodedString=function(t){return t.replace("-","+").replace("_","/")},e.prototype._serialize=function(t,e,i){var r=[];if(null!==e){r.push("?response_type="+t),r.push("client_id="+encodeURIComponent(e.clientId)),i&&r.push("resource="+encodeURIComponent(i)),r.push("redirect_uri="+encodeURIComponent(e.redirectUri)),r.push("state="+encodeURIComponent(e.state)),e.hasOwnProperty("slice")&&r.push("slice="+encodeURIComponent(e.slice)),e.hasOwnProperty("extraQueryParameter")&&r.push(e.extraQueryParameter);var n=e.correlationId?e.correlationId:this._guid();r.push("client-request-id="+encodeURIComponent(n))}return r.join("&")},e.prototype._deserialize=function(t){var e,i=/\+/g,r=/([^&=]+)=([^&]*)/g,n=function(t){return decodeURIComponent(t.replace(i," "))},o={};for(e=r.exec(t);e;)o[n(e[1])]=n(e[2]),e=r.exec(t);return o},e.prototype._decimalToHex=function(t){for(var e=t.toString(16);e.length<2;)e="0"+e;return e},e.prototype._guid=function(){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues){var e=new Uint8Array(16);return t.getRandomValues(e),e[6]|=64,e[6]&=79,e[8]|=128,e[8]&=191,this._decimalToHex(e[0])+this._decimalToHex(e[1])+this._decimalToHex(e[2])+this._decimalToHex(e[3])+"-"+this._decimalToHex(e[4])+this._decimalToHex(e[5])+"-"+this._decimalToHex(e[6])+this._decimalToHex(e[7])+"-"+this._decimalToHex(e[8])+this._decimalToHex(e[9])+"-"+this._decimalToHex(e[10])+this._decimalToHex(e[11])+this._decimalToHex(e[12])+this._decimalToHex(e[13])+this._decimalToHex(e[14])+this._decimalToHex(e[15])}for(var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",n=0,o="",s=0;s<36;s++)"-"!==i[s]&&"4"!==i[s]&&(n=16*Math.random()|0),"x"===i[s]?o+=r[n]:"y"===i[s]?(n&=3,o+=r[n|=8]):o+=i[s];return o},e.prototype._expiresIn=function(t){return t||(t=3599),this._now()+parseInt(t,10)},e.prototype._now=function(){return Math.round((new Date).getTime()/1e3)},e.prototype._addAdalFrame=function(t){if(void 0!==t){this.info("Add adal frame to document:"+t);var e=document.getElementById(t);if(!e){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var i=document.createElement("iframe");i.setAttribute("id",t),i.setAttribute("aria-hidden","true"),i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height=i.borderWidth="0px",e=document.getElementsByTagName("body")[0].appendChild(i)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+t+'" id="'+t+'" style="display:none"></iframe>');window.frames&&window.frames[t]&&(e=window.frames[t])}return e}},e.prototype._saveItem=function(t,e,i){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage())return this.info("Local storage is not supported"),!1;if(i){var r=this._getItem(t)||"";localStorage.setItem(t,r+e+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(t,e);return!0}return this._supportsSessionStorage()?(sessionStorage.setItem(t,e),!0):(this.info("Session storage is not supported"),!1)},e.prototype._getItem=function(t){return this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation?this._supportsLocalStorage()?localStorage.getItem(t):(this.info("Local storage is not supported"),null):this._supportsSessionStorage()?sessionStorage.getItem(t):(this.info("Session storage is not supported"),null)},e.prototype._supportsLocalStorage=function(){try{return!!window.localStorage&&(window.localStorage.setItem("storageTest","A"),"A"==window.localStorage.getItem("storageTest")&&(window.localStorage.removeItem("storageTest"),!window.localStorage.getItem("storageTest")))}catch(t){return!1}},e.prototype._supportsSessionStorage=function(){try{return!!window.sessionStorage&&(window.sessionStorage.setItem("storageTest","A"),"A"==window.sessionStorage.getItem("storageTest")&&(window.sessionStorage.removeItem("storageTest"),!window.sessionStorage.getItem("storageTest")))}catch(t){return!1}},e.prototype._cloneConfig=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},e.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()},e.prototype.log=function(t,e,i,r){if(t<=Logging.level){if(!Logging.piiLoggingEnabled&&r)return;var n=(new Date).toUTCString(),o="";o=this.config.correlationId?n+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[t]+" "+e:n+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[t]+" "+e,i&&(o+="\nstack:\n"+i.stack),Logging.log(o)}},e.prototype.error=function(t,e){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,t,e)},e.prototype.warn=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,t,null)},e.prototype.info=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,t,null)},e.prototype.verbose=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,t,null)},e.prototype.errorPii=function(t,e){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,t,e,!0)},e.prototype.warnPii=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,t,null,!0)},e.prototype.infoPii=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,t,null,!0)},e.prototype.verbosePii=function(t){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,t,null,!0)},e.prototype._libVersion=function(){return"1.0.18"},t.exports&&(t.exports=e,t.exports.inject=function(t){return new e(t)}),e)}(e={exports:{}}),e.exports}();r.inject,function(t){t.subscriptionKey="subscriptionKey",t.aad="aad",t.anonymous="anonymous"}(e||(e={}));var n={preferredCacheLocation:"localStorage",storage:{accessTokenKey:"access.token.key",testStorageKey:"testStorage"},events:{tokenAcquired:"tokenacquired"},tokenExpiresIn:3599,tokenRefreshClockSkew:300,errors:{tokenExpired:"Token Expired, Try again"},AUTHORIZATION:"authorization",AUTHORIZATION_SCHEME:"Bearer",MAP_AGENT:"Map-Agent",MS_AM_REQUEST_ORIGIN:"Ms-Am-Request-Origin",MS_AM_REQUEST_ORIGIN_VALUE:"MapControl",X_MS_CLIENT_ID:"x-ms-client-id",SESSION_ID:"Session-Id",SHORT_DOMAIN:"atlas.microsoft.com",DEFAULT_DOMAIN:"https://atlas.microsoft.com/",SDK_VERSION:"0.0.1",TARGET_SDK:"Leaflet",RENDERV2_VERSION:"2.1"},o=function(){function t(){}return t.uuid=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))},t}(),s=function(){function t(){}return t.clearTimeout=function(e){var i=t._workerTable[e];i&&(i.worker.terminate(),delete t._workerTable[e])},t.setTimeout=function(e,i){var r=Math.round(1e9*Math.random()),n=new Blob(["onmessage = function (event) {\n    var delay = event.data.time; // milliseconds\n    var before = Date.now();\n    while (Date.now() < before + delay) { };\n    postMessage({id: event.data.id});\n};"]),o=window.URL.createObjectURL(n),s=new Worker(o);return s.addEventListener("message",t._receivedSetTimeoutMessage),t._workerTable[r]={callback:e,worker:s},s.postMessage({id:r,time:i}),r},t._receivedSetTimeoutMessage=function(e){var i=t._workerTable[e.data.id];i&&(i.callback(),i.worker.terminate(),delete t._workerTable[e.data.id])},t._workerTable={},t}(),a=function(){function t(t){var e=this;this._initialized=!1,this._triggerTokenFetch=function(){var t=e;return new Promise((function(e,i){t.options.getToken((function(r){try{var o=t._getTokenExpiry(r)-n.tokenRefreshClockSkew;t._storeAccessToken(r),s.clearTimeout(t.tokenTimeOutHandle),t.tokenTimeOutHandle=s.setTimeout(t._triggerTokenFetch,o),e()}catch(t){i(new Error("Invalid token returned by getToken function"))}}),(function(t){i(t)}))}))},this.options=t}return t.getInstance=function(e){if(e&&e.authType){var i=e.azMapsDomain;if(i&&/^\w+:\/\//.test(i)&&(e.azMapsDomain=i.replace(/^\w+:\/\//,"")),t.instance&&t.instance.compareOptions(e))return t.instance;var r=new t(e);return t.instance||(t.instance=r),r}if(t.instance)return t.instance;throw"Azure Maps credentials not specified."},t.prototype.compareOptions=function(t){var e=this.options;return t.azMapsDomain===e.azMapsDomain&&t.aadAppId===e.aadAppId&&t.aadInstance===e.aadInstance&&t.aadTenant===e.aadTenant&&t.authType===e.authType&&t.clientId===e.clientId&&t.getToken===e.getToken&&t.subscriptionKey===e.subscriptionKey},t.prototype.isInitialized=function(){return this._initialized},t.prototype.initialize=function(){var i=this,r=i.options;return i.initPromise||(i.initPromise=new Promise((function(n,o){if(r.authType===e.subscriptionKey)i._initialized=!0,n();else if(r.authType===e.aad){if(r.authContext=r.authContext||t.getDefaultAuthContext(r),r.authContext.handleWindowCallback(),r.authContext.getLoginError())return void o(new Error("Error logging in the AAD users: "+r.authContext.getLoginError()));if(r.authContext.isCallback(window.location.hash))return;s.setTimeout((function(){return i._loginAndAcquire(n,o)}),0)}else r.authType===e.anonymous?(i._initialized=!0,n(i._triggerTokenFetch())):o(new Error("An invalid authentication type was specified."))}))),this.initPromise},t.getDefaultAuthContext=function(t){var e=this;if(!t.aadAppId)throw new Error("No AAD app ID was specified.");if(!t.aadTenant)throw new Error("No AAD tenant was specified.");return e.defaultAuthContext||(e.defaultAuthContext=new r({instance:t.aadInstance||"https://login.windows-ppe.net/",tenant:t.aadTenant,clientId:t.aadAppId,cacheLocation:n.preferredCacheLocation})),e.defaultAuthContext},t.prototype._loginAndAcquire=function(t,e){var i=this,r=i.options,o=function(){r.authContext.acquireToken(n.DEFAULT_DOMAIN,(function(r){r?e(new Error(r)):(i._initialized=!0,t())}))},s=r.authContext.getCachedToken(r.aadAppId),a=r.authContext.getCachedUser();if(s&&a)o();else{r.authContext.loginInProgress()||r.authContext.login();var l=setInterval((function(){r.authContext.loginInProgress()||(clearInterval(l),r.authContext.getCachedToken(r.aadAppId)?o():e(new Error(r.authContext.getLoginError()||"The AAD authentication context is not logged-in for the specified app ID: "+r.aadAppId)))}),25)}},t.prototype.getAuthType=function(){return this.options.authType},t.prototype.getClientId=function(){return this.options.clientId},t.prototype.getToken=function(){var t=this,i=t.options;if(i.authType===e.aad){var r=i.authContext.getCachedToken(n.DEFAULT_DOMAIN);return r||(i.authContext.getCachedUser()||i.authContext.login(),i.authContext.acquireToken(n.DEFAULT_DOMAIN,(function(t,e){t||(r=e)}))),r}if(i.authType===e.anonymous){var o=t._getItem(n.storage.accessTokenKey);if(o){var s=t._getTokenExpiry(o);if(s<300&&s>0)t._triggerTokenFetch();else if(s<=0)throw t._saveItem(n.storage.accessTokenKey,""),new Error(n.errors.tokenExpired)}else t._triggerTokenFetch();return o}if(i.authType===e.subscriptionKey)return i.subscriptionKey},t.prototype._getTokenExpiry=function(t){var e=atob(t.split(".")[1]);return 1e3*JSON.parse(e).exp-Date.now()-3e5},t.prototype._storeAccessToken=function(t){this._saveItem(n.storage.accessTokenKey,t)},t.prototype._saveItem=function(e,i){return this._supportsLocalStorage()?(localStorage.setItem(e,i),!0):this._supportsSessionStorage()?(sessionStorage.setItem(e,i),!0):(t.fallbackStorage[e]=i,!0)},t.prototype._getItem=function(e){return this._supportsLocalStorage()?localStorage.getItem(e):this._supportsSessionStorage()?sessionStorage.getItem(e):t.fallbackStorage[e]},t.prototype._supportsLocalStorage=function(){try{var t=window.localStorage,e=n.storage.testStorageKey;return!!t&&(t.setItem(e,"A"),"A"===t.getItem(e)&&(t.removeItem(e),!t.getItem(e)))}catch(t){return!1}},t.prototype._supportsSessionStorage=function(){try{var t=window.sessionStorage,e=n.storage.testStorageKey;return!!t&&(t.setItem(e,"A"),"A"===t.getItem(e)&&(t.removeItem(e),!t.getItem(e)))}catch(t){return!1}},t.prototype.signRequest=function(i){var r=this.options,o=n;i.url=i.url.replace("{azMapsDomain}",r.azMapsDomain);var s=i.headers||{};s[o.SESSION_ID]=t.sessionId,s[o.MS_AM_REQUEST_ORIGIN]=o.MS_AM_REQUEST_ORIGIN_VALUE,s[o.MAP_AGENT]="MapControl/"+o.SDK_VERSION+" ("+o.TARGET_SDK+")";var a=this.getToken();switch(r.authType){case e.aad:case e.anonymous:s[o.X_MS_CLIENT_ID]=r.clientId,s[o.AUTHORIZATION]=o.AUTHORIZATION_SCHEME+" "+a;break;case e.subscriptionKey:if(!("url"in i))throw new Error("No URL specified in request.");var l="?";-1!==i.url.indexOf("?")&&(l="&"),i.url+=l+"subscription-key="+a;break;default:throw new Error("An invalid authentication type was specified")}return i.headers=s,i},t.prototype.getRequest=function(t){var e=this.signRequest({url:t});return fetch(e.url,{method:"GET",mode:"cors",headers:new Headers(e.headers)})},t.fallbackStorage={},t.sessionId=o.uuid(),t}(),l="https://{azMapsDomain}/map/tile?api-version="+n.RENDERV2_VERSION+"&tilesetId={tilesetId}&zoom={z}&x={x}&y={y}&tileSize={tileSize}&language={language}&view={view}",c=function(t){function e(e){var i=t.call(this,l,Object.assign({tileSize:256,language:"en-US",view:"Auto",tilesetId:"microsoft.base.road",trafficFlowThickness:5},e))||this;i._baseUrl=l;var r=i,o=r.options,s=o.authOptions||{};s.azMapsDomain||(s.azMapsDomain=n.SHORT_DOMAIN);var c=a.getInstance(s);return r._authManager=c,c.isInitialized()?r.setTilesetId(o.tilesetId):c.initialize().then((function(){r.setTilesetId(o.tilesetId)})),i}return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.getAttribution=function(){var t,e=this.options.tilesetId,i=this.options.attribution;if(e){if(e.startsWith("microsoft.base.")||e.startsWith("microsoft.traffic.")?t="TomTom":e.startsWith("microsoft.weather.")?t="AccuWeather":"microsoft.imagery"===e&&(t="Airbus"),t)return" "+(new Date).getFullYear()+" "+t+", Microsoft";if(!i)return" "+(new Date).getFullYear()+" Microsoft"}return i},e.prototype.getTileUrl=function(t){return this._getFormattedUrl().replace("{x}",t.x.toString()).replace("{y}",t.y.toString()).replace("{z}",this._getZoomForUrl().toString())},e.prototype.createTile=function(t,e){var i=this,r=document.createElement("img");return r.setAttribute("role","presentation"),i.options.tilesetId&&i._authManager.getRequest(i.getTileUrl(t)).then((function(t){t.blob().then((function(t){var i=new FileReader;i.onload=function(){r.src=i.result,r.style.visibility="visible",e()},i.readAsDataURL(t)}))})),r},e.prototype.getView=function(){return this.options.view},e.prototype.setView=function(t){this.options.view=t},e.prototype.getLanguage=function(){return this.options.language},e.prototype.setLanguage=function(t){this.options.language=t,this._refresh()},e.prototype.getTilesetId=function(){return this.options.tilesetId},e.prototype.setTilesetId=function(t){var e=this;e.options.tilesetId=t,e._baseUrl=l,t&&(t.startsWith("microsoft.traffic.flow")?e._baseUrl="https://{azMapsDomain}/traffic/flow/tile/png?api-version=1.0&style={style}&zoom={z}&x={x}&y={y}":t.startsWith("microsoft.traffic.incident")&&(e._baseUrl="https://{azMapsDomain}/traffic/incident/tile/png?api-version=1.0&style={style}&zoom={z}&x={x}&y={y}")),e._refresh()},e.prototype.getTimeStamp=function(){return this.options.timeStamp},e.prototype.setTimeStamp=function(t){this.options.timeStamp=t,this._refresh()},e.prototype.getTrafficFlowThickness=function(){return this.options.trafficFlowThickness},e.prototype.setTrafficFlowThickness=function(t){this.options.trafficFlowThickness=t,this._refresh()},e.prototype._refresh=function(){t.prototype.setUrl.call(this,this._getFormattedUrl())},e.prototype._getFormattedUrl=function(){var t=this,e=t.options,i=t._baseUrl.replace("{tileSize}",t._getTileSize().toString()).replace("{language}",e.language).replace("{view}",e.view).replace("{tilesetId}",e.tilesetId);if(e.tilesetId&&e.tilesetId.startsWith("microsoft.traffic")&&(i=i.replace("{style}",t._getTrafficStyle()),e.tilesetId.indexOf("flow")>0&&(i+="&thickness="+e.trafficFlowThickness)),e.timeStamp){var r=e.timeStamp;e.timeStamp instanceof Date&&(r=e.timeStamp.toISOString().slice(0,19)),i=i.replace("{timeStamp}",r)}return i},e.prototype._getTileSize=function(){var t=this.options.tileSize;return("number"==typeof t?t:t.x)+""},e.prototype._getTrafficStyle=function(){var t=this.options.tilesetId;return t&&t.indexOf("microsoft.traffic.")>-1?t.replace("microsoft.traffic.incident.","").replace("microsoft.traffic.flow.",""):null},e}(t.TileLayer),u=function(t){return new c(t)};t.TileLayer.azureMaps=u,t.TileLayer.AzureMaps=c,t.tileLayer.azureMaps=u}(L)},23612:()=>{!function(t,e,i){L.Pattern=L.Class.extend({includes:[L.Evented.prototype||L.Mixin.Events],options:{x:0,y:0,width:8,height:8,patternUnits:"userSpaceOnUse",patternContentUnits:"userSpaceOnUse"},_addShapes:L.Util.falseFn,_update:L.Util.falseFn,initialize:function(t){this._shapes={},L.setOptions(this,t)},onAdd:function(t){for(var e in this._map=t.target?t.target:t,this._map._initDefRoot(),this._initDom(),this._shapes)this._shapes[e].onAdd(this);this._addShapes(),this._addDom(),this.redraw(),this.getEvents&&this._map.on(this.getEvents(),this),this.fire("add"),this._map.fire("patternadd",{pattern:this})},onRemove:function(){this._removeDom()},redraw:function(){if(this._map)for(var t in this._update(),this._shapes)this._shapes[t].redraw();return this},setStyle:function(t){return L.setOptions(this,t),this._map&&(this._updateStyle(),this.redraw()),this},addTo:function(t){return t.addPattern(this),this},remove:function(){return this.removeFrom(this._map)},removeFrom:function(t){return t&&t.removePattern(this),this}}),L.Map.addInitHook((function(){this._patterns={}})),L.Map.include({addPattern:function(t){var e=L.stamp(t);return this._patterns[e]?t:(this._patterns[e]=t,this.whenReady(t.onAdd,t),this)},removePattern:function(t){var e=L.stamp(t);return this._patterns[e]?(this._loaded&&t.onRemove(this),t.getEvents&&this.off(t.getEvents(),t),delete this._patterns[e],this._loaded&&(this.fire("patternremove",{pattern:t}),t.fire("remove")),t._map=null,this):this},hasPattern:function(t){return!!t&&L.stamp(t)in this._patterns}}),L.Pattern.SVG_NS="http://www.w3.org/2000/svg",L.Pattern=L.Pattern.extend({_createElement:function(t){return e.createElementNS(L.Pattern.SVG_NS,t)},_initDom:function(){this._dom=this._createElement("pattern"),this.options.className&&L.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()},_addDom:function(){this._map._defRoot.appendChild(this._dom)},_removeDom:function(){L.DomUtil.remove(this._dom)},_updateStyle:function(){var t=this._dom,e=this.options;if(t){if(t.setAttribute("id",L.stamp(this)),t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("patternUnits",e.patternUnits),t.setAttribute("patternContentUnits",e.patternContentUnits),e.patternTransform||e.angle){var i=e.patternTransform?e.patternTransform+" ":"";i+=e.angle?"rotate("+e.angle+") ":"",t.setAttribute("patternTransform",i)}else t.removeAttribute("patternTransform");for(var r in this._shapes)this._shapes[r]._updateStyle()}}}),L.Map.include({_initDefRoot:function(){if(!this._defRoot)if("function"==typeof this.getRenderer){var t=this.getRenderer(this);this._defRoot=L.Pattern.prototype._createElement("defs"),t._container.appendChild(this._defRoot)}else this._pathRoot||this._initPathRoot(),this._defRoot=L.Pattern.prototype._createElement("defs"),this._pathRoot.appendChild(this._defRoot)}}),L.SVG?L.SVG.include({_superUpdateStyle:L.SVG.prototype._updateStyle,_updateStyle:function(t){this._superUpdateStyle(t),t.options.fill&&t.options.fillPattern&&t._path.setAttribute("fill","url(#"+L.stamp(t.options.fillPattern)+")")}}):L.Path.include({_superUpdateStyle:L.Path.prototype._updateStyle,_updateStyle:function(){this._superUpdateStyle(),this.options.fill&&this.options.fillPattern&&this._path.setAttribute("fill","url(#"+L.stamp(this.options.fillPattern)+")")}}),L.StripePattern=L.Pattern.extend({options:{weight:4,spaceWeight:4,color:"#000000",spaceColor:"#ffffff",opacity:1,spaceOpacity:0},_addShapes:function(){this._stripe=new L.PatternPath({stroke:!0,weight:this.options.weight,color:this.options.color,opacity:this.options.opacity}),this._space=new L.PatternPath({stroke:!0,weight:this.options.spaceWeight,color:this.options.spaceColor,opacity:this.options.spaceOpacity}),this.addShape(this._stripe),this.addShape(this._space),this._update()},_update:function(){this._stripe.options.d="M0 "+this._stripe.options.weight/2+" H "+this.options.width,this._space.options.d="M0 "+(this._stripe.options.weight+this._space.options.weight/2)+" H "+this.options.width},setStyle:L.Pattern.prototype.setStyle}),L.stripePattern=function(t){return new L.StripePattern(t)},L.PatternShape=L.Class.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,fillRule:"evenodd"},initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._pattern=t,this._pattern._dom&&(this._initDom(),this._addDom())},addTo:function(t){return t.addShape(this),this},redraw:function(){return this._pattern&&this._updateShape(),this},setStyle:function(t){return L.setOptions(this,t),this._pattern&&this._updateStyle(),this},setShape:function(t){this.options=L.extend({},this.options,t),this._updateShape()}}),L.Pattern.include({addShape:function(t){var e=L.stamp(t);if(this._shapes[e])return t;this._shapes[e]=t,t.onAdd(this)}}),L.PatternShape.SVG_NS="http://www.w3.org/2000/svg",L.PatternShape=L.PatternShape.extend({_createElement:function(t){return e.createElementNS(L.PatternShape.SVG_NS,t)},_initDom:L.Util.falseFn,_updateShape:L.Util.falseFn,_initDomElement:function(t){this._dom=this._createElement(t),this.options.className&&L.DomUtil.addClass(this._dom,this.options.className),this._updateStyle()},_addDom:function(){this._pattern._dom.appendChild(this._dom)},_updateStyle:function(){var t=this._dom,e=this.options;t&&(e.stroke?(t.setAttribute("stroke",e.color),t.setAttribute("stroke-opacity",e.opacity),t.setAttribute("stroke-width",e.weight),t.setAttribute("stroke-linecap",e.lineCap),t.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?t.setAttribute("stroke-dasharray",e.dashArray):t.removeAttribute("stroke-dasharray"),e.dashOffset?t.setAttribute("stroke-dashoffset",e.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),e.fill?(e.fillPattern?t.setAttribute("fill","url(#"+L.stamp(e.fillPattern)+")"):t.setAttribute("fill",e.fillColor||e.color),t.setAttribute("fill-opacity",e.fillOpacity),t.setAttribute("fill-rule",e.fillRule||"evenodd")):t.setAttribute("fill","none"),t.setAttribute("pointer-events",e.pointerEvents||(e.interactive?"visiblePainted":"none")))}}),L.PatternPath=L.PatternShape.extend({_initDom:function(){this._initDomElement("path")},_updateShape:function(){this._dom&&this._dom.setAttribute("d",this.options.d)}}),L.PatternCircle=L.PatternShape.extend({options:{x:0,y:0,radius:0},_initDom:function(){this._initDomElement("circle")},_updateShape:function(){this._dom&&(this._dom.setAttribute("cx",this.options.x),this._dom.setAttribute("cy",this.options.y),this._dom.setAttribute("r",this.options.radius))}}),L.PatternRect=L.PatternShape.extend({options:{x:0,y:0,width:10,height:10},_initDom:function(){this._initDomElement("rect")},_updateShape:function(){this._dom&&(this._dom.setAttribute("x",this.options.x),this._dom.setAttribute("y",this.options.y),this._dom.setAttribute("width",this.options.width),this._dom.setAttribute("height",this.options.height),this.options.rx&&this._dom.setAttribute("rx",this.options.rx),this.options.ry&&this._dom.setAttribute("ry",this.options.ry))}})}(window,document)},84132:()=>{L.Control.ScaleNautic=L.Control.Scale.extend({options:{nautic:!1},_addScales:function(t,e,i){L.Control.Scale.prototype._addScales.call(this,t,e,i),L.setOptions(t),this.options.nautic&&(this._nScale=L.DomUtil.create("div",e,i))},_updateScales:function(t){L.Control.Scale.prototype._updateScales.call(this,t),this.options.nautic&&t&&this._updateNautic(t)},_updateNautic:function(t){var e,i=this._nScale,r=t/1852;e=t>=1852?L.Control.Scale.prototype._getRoundNum.call(this,r):r>.1?Math.round(10*r)/10:Math.round(100*r)/100,i.style.width=Math.round(this.options.maxWidth*(e/r))-10+"px",i.innerHTML=e+" nm"}}),L.control.scalenautic=function(t){return new L.Control.ScaleNautic(t)}},44002:function(){(function(){var t,e,i,r,n,o,s,a,l,c,u,h,p,d=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};a=function(){var t,e,i,r,n,o,s,a,l,c,u,h,p,f;if((n=function(){var t,e,i;return(t=document.createElement("canvas")).width=2,t.height=2,(i=(e=t.getContext("2d")).getImageData(0,0,2,2)).data.set(new Uint8ClampedArray([0,0,0,0,255,255,255,255,0,0,0,0,255,255,255,255])),e.putImageData(i,0,0),t})(),e=function(t,e){var i,r,o,s,a,l,c,u,h,p,d,f,m,g;if(l=t.createProgram(),m=t.createShader(t.VERTEX_SHADER),t.attachShader(l,m),t.shaderSource(m,"attribute vec2 position;\nvoid main(){\n    gl_Position = vec4(position, 0.0, 1.0);\n}"),t.compileShader(m),!t.getShaderParameter(m,t.COMPILE_STATUS))throw t.getShaderInfoLog(m);if(o=t.createShader(t.FRAGMENT_SHADER),t.attachShader(l,o),t.shaderSource(o,"uniform sampler2D source;\nvoid main(){\n    gl_FragColor = texture2D(source, vec2(1.0, 1.0));\n}"),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw t.getShaderInfoLog(o);if(t.linkProgram(l),!t.getProgramParameter(l,t.LINK_STATUS))throw t.getProgramInfoLog(l);return t.useProgram(l),r=function(){return t.deleteShader(o),t.deleteShader(m),t.deleteProgram(l),t.deleteBuffer(i),t.deleteTexture(h),t.deleteTexture(f),t.deleteFramebuffer(s),t.bindBuffer(t.ARRAY_BUFFER,null),t.useProgram(null),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),s=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,f,0),p=n(),h=t.createTexture(),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,e,p),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),g=new Float32Array([1,1,-1,1,-1,-1,1,1,-1,-1,1,-1]),i=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,g,t.STATIC_DRAW),a=t.getAttribLocation(l,"position"),d=t.getUniformLocation(l,"source"),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.uniform1i(d,0),t.drawArrays(t.TRIANGLES,0,6),c=new Uint8Array(16),t.readPixels(0,0,2,2,t.RGBA,t.UNSIGNED_BYTE,c),u=Math.abs(c[0]-127)<10,r(),u},r=function(t,e){var i;return i=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),0===t.getError()?(t.deleteTexture(i),!0):(t.deleteTexture(i),!1)},t=function(t,e){var i,r,n;return n=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),r=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),i=t.checkFramebufferStatus(t.FRAMEBUFFER),t.deleteTexture(n),t.deleteFramebuffer(r),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),i===t.FRAMEBUFFER_COMPLETE},l=[],c={},u=[],i=function(){var i,n,o,s,a;i=document.createElement("canvas"),n=null;try{null===(n=i.getContext("experimental-webgl"))&&(n=i.getContext("webgl"))}catch(t){}if(null!=n&&(null===n.getExtension("OES_texture_float")?r(n,n.FLOAT)?(a=!0,l.push("OES_texture_float"),c.OES_texture_float={shim:!0}):(a=!1,u.push("OES_texture_float")):r(n,n.FLOAT)?(a=!0,l.push("OES_texture_float")):(a=!1,u.push("OES_texture_float")),a&&(null===n.getExtension("WEBGL_color_buffer_float")?t(n,n.FLOAT)?(l.push("WEBGL_color_buffer_float"),c.WEBGL_color_buffer_float={shim:!0,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):u.push("WEBGL_color_buffer_float"):t(n,n.FLOAT)?l.push("WEBGL_color_buffer_float"):u.push("WEBGL_color_buffer_float"),null===n.getExtension("OES_texture_float_linear")?e(n,n.FLOAT)?(l.push("OES_texture_float_linear"),c.OES_texture_float_linear={shim:!0}):u.push("OES_texture_float_linear"):e(n,n.FLOAT)?l.push("OES_texture_float_linear"):u.push("OES_texture_float_linear")),null===(o=n.getExtension("OES_texture_half_float"))?r(n,36193)?(s=!0,l.push("OES_texture_half_float"),o=c.OES_texture_half_float={HALF_FLOAT_OES:36193,shim:!0}):(s=!1,u.push("OES_texture_half_float")):r(n,o.HALF_FLOAT_OES)?(s=!0,l.push("OES_texture_half_float")):(s=!1,u.push("OES_texture_half_float")),s))return null===n.getExtension("EXT_color_buffer_half_float")?t(n,o.HALF_FLOAT_OES)?(l.push("EXT_color_buffer_half_float"),c.EXT_color_buffer_half_float={shim:!0,RGBA16F_EXT:34842,RGB16F_EXT:34843,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863}):u.push("EXT_color_buffer_half_float"):t(n,o.HALF_FLOAT_OES)?l.push("EXT_color_buffer_half_float"):u.push("EXT_color_buffer_half_float"),null===n.getExtension("OES_texture_half_float_linear")?e(n,o.HALF_FLOAT_OES)?(l.push("OES_texture_half_float_linear"),c.OES_texture_half_float_linear={shim:!0}):u.push("OES_texture_half_float_linear"):e(n,o.HALF_FLOAT_OES)?l.push("OES_texture_half_float_linear"):u.push("OES_texture_half_float_linear")},null!=window.WebGLRenderingContext){for(i(),h={},p=0,f=u.length;p<f;p++)a=u[p],h[a]=!0;return o=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(t){var e;return void 0===(e=c[t])?h[t]?null:o.call(this,t):e},s=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var t,e,i,r,n,o,a;for(e=[],r=0,o=(i=s.call(this)).length;r<o;r++)t=i[r],void 0===h[t]&&e.push(t);for(n=0,a=l.length;n<a;n++)t=l[n],d.call(e,t)<0&&e.push(t);return e},WebGLRenderingContext.prototype.getFloatExtension=function(t){var e,i,r,n,o,s,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M;for(null==t.prefer&&(t.prefer=["half"]),null==t.require&&(t.require=[]),null==t.throws&&(t.throws=!0),m=this.getExtension("OES_texture_float"),s=this.getExtension("OES_texture_half_float"),d=this.getExtension("WEBGL_color_buffer_float"),n=this.getExtension("EXT_color_buffer_half_float"),f=this.getExtension("OES_texture_float_linear"),o=this.getExtension("OES_texture_half_float_linear"),p={texture:null!==m,filterable:null!==f,renderable:null!==d,score:0,precision:"single",half:!1,single:!0,type:this.FLOAT},r={texture:null!==s,filterable:null!==o,renderable:null!==n,score:0,precision:"half",half:!0,single:!1,type:null!=(T=null!=s?s.HALF_FLOAT_OES:void 0)?T:null},i=[],p.texture&&i.push(p),r.texture&&i.push(r),h=[],_=0,v=i.length;_<v;_++){for(e=i[_],g=!0,y=0,x=(C=t.require).length;y<x;y++)!1===e[a=C[y]]&&(g=!1);g&&h.push(e)}for(A=0,b=h.length;A<b;A++)for(e=h[A],l=S=0,w=(M=t.prefer).length;S<w;l=++S)u=M[l],c=Math.pow(2,t.prefer.length-l-1),e[u]&&(e.score+=c);if(h.sort((function(t,e){return t.score===e.score?0:t.score<e.score?1:t.score>e.score?-1:void 0})),0===h.length){if(t.throws)throw"No floating point texture support that is "+t.require.join(", ");return null}return{filterable:(h=h[0]).filterable,renderable:h.renderable,type:h.type,precision:h.precision}}}},null!=window.WebGLRenderingContext&&(p=["WEBKIT","MOZ","MS","O"],h=/^WEBKIT_(.*)|MOZ_(.*)|MS_(.*)|O_(.*)/,c=WebGLRenderingContext.prototype.getExtension,WebGLRenderingContext.prototype.getExtension=function(t){var e,i,r,n,o;if(null!==(i=t.match(h))&&(t=i[1]),null===(e=c.call(this,t))){for(n=0,o=p.length;n<o;n++)if(r=p[n],null!==(e=c.call(this,r+"_"+t)))return e;return null}return e},u=WebGLRenderingContext.prototype.getSupportedExtensions,WebGLRenderingContext.prototype.getSupportedExtensions=function(){var t,e,i,r,n,o;for(i=[],n=0,o=(r=u.call(this)).length;n<o;n++)null!==(e=(t=r[n]).match(h))&&(t=e[1]),d.call(i,t)<0&&i.push(t);return i}),a(),r=function(){function t(t,e){var i,r;this.gl=t,r=e.vertex,i=e.fragment,this.program=this.gl.createProgram(),this.vs=this.gl.createShader(this.gl.VERTEX_SHADER),this.fs=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vs),this.gl.attachShader(this.program,this.fs),this.compileShader(this.vs,r),this.compileShader(this.fs,i),this.link(),this.value_cache={},this.uniform_cache={},this.attribCache={}}return t.prototype.attribLocation=function(t){var e;return void 0===(e=this.attribCache[t])&&(e=this.attribCache[t]=this.gl.getAttribLocation(this.program,t)),e},t.prototype.compileShader=function(t,e){if(this.gl.shaderSource(t,e),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS))throw"Shader Compile Error: "+this.gl.getShaderInfoLog(t)},t.prototype.link=function(){if(this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw"Shader Link Error: "+this.gl.getProgramInfoLog(this.program)},t.prototype.use=function(){return this.gl.useProgram(this.program),this},t.prototype.uniformLoc=function(t){var e;return void 0===(e=this.uniform_cache[t])&&(e=this.uniform_cache[t]=this.gl.getUniformLocation(this.program,t)),e},t.prototype.int=function(t,e){var i;return this.value_cache[t]!==e&&(this.value_cache[t]=e,(i=this.uniformLoc(t))&&this.gl.uniform1i(i,e)),this},t.prototype.vec2=function(t,e,i){var r;return(r=this.uniformLoc(t))&&this.gl.uniform2f(r,e,i),this},t.prototype.float=function(t,e){var i;return this.value_cache[t]!==e&&(this.value_cache[t]=e,(i=this.uniformLoc(t))&&this.gl.uniform1f(i,e)),this},t}(),t=function(){function t(t){this.gl=t,this.buffer=this.gl.createFramebuffer()}return t.prototype.destroy=function(){return this.gl.deleteFRamebuffer(this.buffer)},t.prototype.bind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.buffer),this},t.prototype.unbind=function(){return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this},t.prototype.check=function(){switch(this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER)){case this.gl.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}return this},t.prototype.color=function(t){return this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,t.target,t.handle,0),this.check(),this},t.prototype.depth=function(t){return this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,t.id),this.check(),this},t.prototype.destroy=function(){return this.gl.deleteFramebuffer(this.buffer)},t}(),n=function(){function t(t,e){var i,r;switch(this.gl=t,null==e&&(e={}),this.channels=this.gl[(null!=(i=e.channels)?i:"rgba").toUpperCase()],"number"==typeof e.type?this.type=e.type:this.type=this.gl[(null!=(r=e.type)?r:"unsigned_byte").toUpperCase()],this.channels){case this.gl.RGBA:this.chancount=4;break;case this.gl.RGB:this.chancount=3;break;case this.gl.LUMINANCE_ALPHA:this.chancount=2;break;default:this.chancount=1}this.target=this.gl.TEXTURE_2D,this.handle=this.gl.createTexture()}return t.prototype.destroy=function(){return this.gl.deleteTexture(this.handle)},t.prototype.bind=function(t){if(null==t&&(t=0),t>15)throw"Texture unit too large: "+t;return this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.target,this.handle),this},t.prototype.setSize=function(t,e){return this.width=t,this.height=e,this.gl.texImage2D(this.target,0,this.channels,this.width,this.height,0,this.channels,this.type,null),this},t.prototype.upload=function(t){return this.width=t.width,this.height=t.height,this.gl.texImage2D(this.target,0,this.channels,this.channels,this.type,t),this},t.prototype.linear=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this},t.prototype.nearest=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this},t.prototype.clampToEdge=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this},t.prototype.repeat=function(){return this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this},t}(),i=function(){function e(e,i,r){var o;this.gl=e,this.width=i,this.height=r,o=this.gl.getFloatExtension({require:["renderable"]}),this.texture=new n(this.gl,{type:o.type}).bind(0).setSize(this.width,this.height).nearest().clampToEdge(),this.fbo=new t(this.gl).bind().color(this.texture).unbind()}return e.prototype.use=function(){return this.fbo.bind()},e.prototype.bind=function(t){return this.texture.bind(t)},e.prototype.end=function(){return this.fbo.unbind()},e.prototype.resize=function(t,e){return this.width=t,this.height=e,this.texture.bind(0).setSize(this.width,this.height)},e}(),l="attribute vec4 position;\nvarying vec2 texcoord;\nvoid main(){\n    texcoord = position.xy*0.5+0.5;\n    gl_Position = position;\n}",s="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\nuniform sampler2D source;\nvarying vec2 texcoord;",e=function(){function t(t,e,n,o){var a,c,u;for(this.heatmap=t,this.gl=e,this.width=n,this.height=o,this.shader=new r(this.gl,{vertex:"attribute vec4 position, intensity;\nvarying vec2 off, dim;\nvarying float vIntensity;\nuniform vec2 viewport;\n\nvoid main(){\n    dim = abs(position.zw);\n    off = position.zw;\n    vec2 pos = position.xy + position.zw;\n    vIntensity = intensity.x;\n    gl_Position = vec4((pos/viewport)*2.0-1.0, 0.0, 1.0);\n}",fragment:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp int;\n    precision highp float;\n#else\n    precision mediump int;\n    precision mediump float;\n#endif\nvarying vec2 off, dim;\nvarying float vIntensity;\nvoid main(){\n    float falloff = (1.0 - smoothstep(0.0, 1.0, length(off/dim)));\n    float intensity = falloff*vIntensity;\n    gl_FragColor = vec4(intensity);\n}"}),this.clampShader=new r(this.gl,{vertex:l,fragment:s+"uniform float low, high;\nvoid main(){\n    gl_FragColor = vec4(clamp(texture2D(source, texcoord).rgb, low, high), 1.0);\n}"}),this.multiplyShader=new r(this.gl,{vertex:l,fragment:s+"uniform float value;\nvoid main(){\n    gl_FragColor = vec4(texture2D(source, texcoord).rgb*value, 1.0);\n}"}),this.blurShader=new r(this.gl,{vertex:l,fragment:s+"uniform vec2 viewport;\nvoid main(){\n    vec4 result = vec4(0.0);\n    for(int x=-1; x<=1; x++){\n        for(int y=-1; y<=1; y++){\n            vec2 off = vec2(x,y)/viewport;\n            //float factor = 1.0 - smoothstep(0.0, 1.5, length(off));\n            float factor = 1.0;\n            result += vec4(texture2D(source, texcoord+off).rgb*factor, factor);\n        }\n    }\n    gl_FragColor = vec4(result.rgb/result.w, 1.0);\n}"}),this.nodeBack=new i(this.gl,this.width,this.height),this.nodeFront=new i(this.gl,this.width,this.height),this.vertexBuffer=this.gl.createBuffer(),this.vertexSize=8,this.maxPointCount=10240,this.vertexBufferData=new Float32Array(this.maxPointCount*this.vertexSize*6),this.vertexBufferViews=[],a=c=0,u=this.maxPointCount;0<=u?c<u:c>u;a=0<=u?++c:--c)this.vertexBufferViews.push(new Float32Array(this.vertexBufferData.buffer,0,a*this.vertexSize*6));this.bufferIndex=0,this.pointCount=0}return t.prototype.resize=function(t,e){return this.width=t,this.height=e,this.nodeBack.resize(this.width,this.height),this.nodeFront.resize(this.width,this.height)},t.prototype.update=function(){var t,e;if(this.pointCount>0)return this.gl.enable(this.gl.BLEND),this.nodeFront.use(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertexBufferViews[this.pointCount],this.gl.STREAM_DRAW),e=this.shader.attribLocation("position"),t=this.shader.attribLocation("intensity"),this.gl.enableVertexAttribArray(1),this.gl.vertexAttribPointer(e,4,this.gl.FLOAT,!1,32,0),this.gl.vertexAttribPointer(t,4,this.gl.FLOAT,!1,32,16),this.shader.use().vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6*this.pointCount),this.gl.disableVertexAttribArray(1),this.pointCount=0,this.bufferIndex=0,this.nodeFront.end(),this.gl.disable(this.gl.BLEND)},t.prototype.clear=function(){return this.nodeFront.use(),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.nodeFront.end()},t.prototype.clamp=function(t,e){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.clampShader.use().int("source",0).float("low",t).float("high",e),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},t.prototype.multiply=function(t){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.multiplyShader.use().int("source",0).float("value",t),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},t.prototype.blur=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.heatmap.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.nodeFront.bind(0),this.nodeBack.use(),this.blurShader.use().int("source",0).vec2("viewport",this.width,this.height),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.nodeBack.end(),this.swap()},t.prototype.swap=function(){var t;return t=this.nodeFront,this.nodeFront=this.nodeBack,this.nodeBack=t},t.prototype.addVertex=function(t,e,i,r,n){return this.vertexBufferData[this.bufferIndex++]=t,this.vertexBufferData[this.bufferIndex++]=e,this.vertexBufferData[this.bufferIndex++]=i,this.vertexBufferData[this.bufferIndex++]=r,this.vertexBufferData[this.bufferIndex++]=n,this.vertexBufferData[this.bufferIndex++]=n,this.vertexBufferData[this.bufferIndex++]=n,this.vertexBufferData[this.bufferIndex++]=n},t.prototype.addPoint=function(t,e,i,r){var n;return null==i&&(i=50),null==r&&(r=.2),this.pointCount>=this.maxPointCount-1&&this.update(),e=this.height-e,n=i/2,this.addVertex(t,e,-n,-n,r),this.addVertex(t,e,+n,-n,r),this.addVertex(t,e,-n,+n,r),this.addVertex(t,e,-n,+n,r),this.addVertex(t,e,+n,-n,r),this.addVertex(t,e,+n,+n,r),this.pointCount+=1},t}(),o=function(){function t(t){var i,o,a,c,u,h,p,d,f,m,g,_;g=null!=t?t:{},this.canvas=g.canvas,this.width=g.width,this.height=g.height,p=g.intensityToAlpha,u=g.gradientTexture,o=g.alphaRange,this.canvas||(this.canvas=document.createElement("canvas"));try{if(this.gl=this.canvas.getContext("experimental-webgl",{depth:!1,antialias:!1}),null===this.gl&&(this.gl=this.canvas.getContext("webgl",{depth:!1,antialias:!1}),null===this.gl))throw"WebGL not supported"}catch(t){throw"WebGL not supported"}null!=window.WebGLDebugUtils&&(console.log("debugging mode"),this.gl=WebGLDebugUtils.makeDebugContext(this.gl,(function(t,e,i){throw WebGLDebugUtils.glEnumToString(t)+" was caused by call to: "+e}))),this.gl.enableVertexAttribArray(0),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),u?(m=this.gradientTexture=new n(this.gl,{channels:"rgba"}).bind(0).setSize(2,2).nearest().clampToEdge(),"string"==typeof u?((h=new Image).onload=function(){return m.bind().upload(h)},h.src=u):u.width>0&&u.height>0?m.upload(u):u.onload=function(){return m.upload(u)},c="uniform sampler2D gradientTexture;\nvec3 getColor(float intensity){\n    return texture2D(gradientTexture, vec2(intensity, 0.0)).rgb;\n}"):(m=null,c="vec3 getColor(float intensity){\n    vec3 blue = vec3(0.0, 0.0, 1.0);\n    vec3 cyan = vec3(0.0, 1.0, 1.0);\n    vec3 green = vec3(0.0, 1.0, 0.0);\n    vec3 yellow = vec3(1.0, 1.0, 0.0);\n    vec3 red = vec3(1.0, 0.0, 0.0);\n\n    vec3 color = (\n        fade(-0.25, 0.25, intensity)*blue +\n        fade(0.0, 0.5, intensity)*cyan +\n        fade(0.25, 0.75, intensity)*green +\n        fade(0.5, 1.0, intensity)*yellow +\n        smoothstep(0.75, 1.0, intensity)*red\n    );\n    return color;\n}"),null==p&&(p=!0),p?(a=(_=null!=o?o:[0,1])[0],i=_[1],d="vec4 alphaFun(vec3 color, float intensity){\n    float alpha = smoothstep("+a.toFixed(8)+", "+i.toFixed(8)+", intensity);\n    return vec4(color*alpha, alpha);\n}"):d="vec4 alphaFun(vec3 color, float intensity){\n    return vec4(color, 1.0);\n}",this.shader=new r(this.gl,{vertex:l,fragment:s+"float linstep(float low, float high, float value){\n    return clamp((value-low)/(high-low), 0.0, 1.0);\n}\n\nfloat fade(float low, float high, float value){\n    float mid = (low+high)*0.5;\n    float range = (high-low)*0.5;\n    float x = 1.0 - clamp(abs(mid-value)/range, 0.0, 1.0);\n    return smoothstep(0.0, 1.0, x);\n}\n\n"+c+"\n"+d+"\n\nvoid main(){\n    float intensity = smoothstep(0.0, 1.0, texture2D(source, texcoord).r);\n    vec3 color = getColor(intensity);\n    gl_FragColor = alphaFun(color, intensity);\n}"}),null==this.width&&(this.width=this.canvas.offsetWidth||2),null==this.height&&(this.height=this.canvas.offsetHeight||2),this.canvas.width=this.width,this.canvas.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.quad=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),f=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,-1,1,0,1,1,-1,0,1,1,1,0,1]),this.gl.bufferData(this.gl.ARRAY_BUFFER,f,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.heights=new e(this,this.gl,this.width,this.height)}return t.prototype.adjustSize=function(){var t,e;if(e=this.canvas.offsetWidth||2,t=this.canvas.offsetHeight||2,this.width!==e||this.height!==t)return this.gl.viewport(0,0,e,t),this.canvas.width=e,this.canvas.height=t,this.width=e,this.height=t,this.heights.resize(this.width,this.height)},t.prototype.display=function(){return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.quad),this.gl.vertexAttribPointer(0,4,this.gl.FLOAT,!1,0,0),this.heights.nodeFront.bind(0),this.gradientTexture&&this.gradientTexture.bind(1),this.shader.use().int("source",0).int("gradientTexture",1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},t.prototype.update=function(){return this.heights.update()},t.prototype.clear=function(){return this.heights.clear()},t.prototype.clamp=function(t,e){return null==t&&(t=0),null==e&&(e=1),this.heights.clamp(t,e)},t.prototype.multiply=function(t){return null==t&&(t=.95),this.heights.multiply(t)},t.prototype.blur=function(){return this.heights.blur()},t.prototype.addPoint=function(t,e,i,r){return this.heights.addPoint(t,e,i,r)},t.prototype.addPoints=function(t){var e,i,r,n;for(n=[],i=0,r=t.length;i<r;i++)e=t[i],n.push(this.addPoint(e.x,e.y,e.size,e.intensity));return n},t}(),window.createWebGLHeatmap=function(t){return new o(t)}}).call(this)},15891:(t,e)=>{"use strict";e.byteLength=function(t){var e=a(t),i=e[0],r=e[1];return 3*(i+r)/4-r},e.toByteArray=function(t){var e,i,o=a(t),s=o[0],l=o[1],c=new n(function(t,e,i){return 3*(e+i)/4-i}(0,s,l)),u=0,h=l>0?s-4:s;for(i=0;i<h;i+=4)e=r[t.charCodeAt(i)]<<18|r[t.charCodeAt(i+1)]<<12|r[t.charCodeAt(i+2)]<<6|r[t.charCodeAt(i+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;return 2===l&&(e=r[t.charCodeAt(i)]<<2|r[t.charCodeAt(i+1)]>>4,c[u++]=255&e),1===l&&(e=r[t.charCodeAt(i)]<<10|r[t.charCodeAt(i+1)]<<4|r[t.charCodeAt(i+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e),c},e.fromByteArray=function(t){for(var e,r=t.length,n=r%3,o=[],s=16383,a=0,c=r-n;a<c;a+=s)o.push(l(t,a,a+s>c?c:a+s));return 1===n?(e=t[r-1],o.push(i[e>>2]+i[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],o.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"=")),o.join("")};for(var i=[],r=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)i[s]=o[s],r[o.charCodeAt(s)]=s;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function l(t,e,r){for(var n,o,s=[],a=e;a<r;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(i[(o=n)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},50252:(t,e,i)=>{"use strict";const r=i(15891),n=i(76690),o="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.hp=l,e.IS=50;const s=2147483647;function a(t){if(t>s)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,l.prototype),e}function l(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return h(t)}return c(t,e,i)}function c(t,e,i){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const i=0|m(t,e);let r=a(i);const n=r.write(t,e);return n!==i&&(r=r.slice(0,n)),r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(K(t,Uint8Array)){const e=new Uint8Array(t);return d(e.buffer,e.byteOffset,e.byteLength)}return p(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return d(t,e,i);if("undefined"!=typeof SharedArrayBuffer&&(K(t,SharedArrayBuffer)||t&&K(t.buffer,SharedArrayBuffer)))return d(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return l.from(r,e,i);const n=function(t){if(l.isBuffer(t)){const e=0|f(t.length),i=a(e);return 0===i.length||t.copy(i,0,0,e),i}return void 0!==t.length?"number"!=typeof t.length||$(t.length)?a(0):p(t):"Buffer"===t.type&&Array.isArray(t.data)?p(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function h(t){return u(t),a(t<0?0:0|f(t))}function p(t){const e=t.length<0?0:0|f(t.length),i=a(e);for(let r=0;r<e;r+=1)i[r]=255&t[r];return i}function d(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i),Object.setPrototypeOf(r,l.prototype),r}function f(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function m(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const i=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===i)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return H(t).length;default:if(n)return r?-1:W(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,i){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return L(this,e,i);case"utf8":case"utf-8":return C(this,e,i);case"ascii":return E(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return T(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,i);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function _(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function y(t,e,i,r,n){if(0===t.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),$(i=+i)&&(i=n?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(n)return-1;i=t.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:A(t,e,i,r,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):A(t,[e],i,r,n);throw new TypeError("val must be string, number or Buffer")}function A(t,e,i,r,n){let o,s=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,l/=2,i/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(n){let r=-1;for(o=i;o<a;o++)if(c(t,o)===c(e,-1===r?0:o-r)){if(-1===r&&(r=o),o-r+1===l)return r*s}else-1!==r&&(o-=o-r),r=-1}else for(i+l>a&&(i=a-l),o=i;o>=0;o--){let i=!0;for(let r=0;r<l;r++)if(c(t,o+r)!==c(e,r)){i=!1;break}if(i)return o}return-1}function v(t,e,i,r){i=Number(i)||0;const n=t.length-i;r?(r=Number(r))>n&&(r=n):r=n;const o=e.length;let s;for(r>o/2&&(r=o/2),s=0;s<r;++s){const r=parseInt(e.substr(2*s,2),16);if($(r))return s;t[i+s]=r}return s}function x(t,e,i,r){return J(W(e,t.length-i),t,i,r)}function b(t,e,i,r){return J(function(t){const e=[];for(let i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,r)}function w(t,e,i,r){return J(H(e),t,i,r)}function S(t,e,i,r){return J(function(t,e){let i,r,n;const o=[];for(let s=0;s<t.length&&!((e-=2)<0);++s)i=t.charCodeAt(s),r=i>>8,n=i%256,o.push(n),o.push(r);return o}(e,t.length-i),t,i,r)}function T(t,e,i){return 0===e&&i===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,i))}function C(t,e,i){i=Math.min(t.length,i);const r=[];let n=e;for(;n<i;){const e=t[n];let o=null,s=e>239?4:e>223?3:e>191?2:1;if(n+s<=i){let i,r,a,l;switch(s){case 1:e<128&&(o=e);break;case 2:i=t[n+1],128==(192&i)&&(l=(31&e)<<6|63&i,l>127&&(o=l));break;case 3:i=t[n+1],r=t[n+2],128==(192&i)&&128==(192&r)&&(l=(15&e)<<12|(63&i)<<6|63&r,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:i=t[n+1],r=t[n+2],a=t[n+3],128==(192&i)&&128==(192&r)&&128==(192&a)&&(l=(15&e)<<18|(63&i)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),n+=s}return function(t){const e=t.length;if(e<=M)return String.fromCharCode.apply(String,t);let i="",r=0;for(;r<e;)i+=String.fromCharCode.apply(String,t.slice(r,r+=M));return i}(r)}l.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(t,e,i){return c(t,e,i)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(t,e,i){return function(t,e,i){return u(t),t<=0?a(t):void 0!==e?"string"==typeof i?a(t).fill(e,i):a(t).fill(e):a(t)}(t,e,i)},l.allocUnsafe=function(t){return h(t)},l.allocUnsafeSlow=function(t){return h(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),K(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let i=t.length,r=e.length;for(let n=0,o=Math.min(i,r);n<o;++n)if(t[n]!==e[n]){i=t[n],r=e[n];break}return i<r?-1:r<i?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);let i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;const r=l.allocUnsafe(e);let n=0;for(i=0;i<t.length;++i){let e=t[i];if(K(e,Uint8Array))n+e.length>r.length?(l.isBuffer(e)||(e=l.from(e)),e.copy(r,n)):Uint8Array.prototype.set.call(r,e,n);else{if(!l.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,n)}n+=e.length}return r},l.byteLength=m,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)_(this,e,e+1);return this},l.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)_(this,e,e+3),_(this,e+1,e+2);return this},l.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)_(this,e,e+7),_(this,e+1,e+6),_(this,e+2,e+5),_(this,e+3,e+4);return this},l.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?C(this,0,t):g.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){let t="";const i=e.IS;return t=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(t+=" ... "),"<Buffer "+t+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(t,e,i,r,n){if(K(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||i>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=i)return 0;if(r>=n)return-1;if(e>=i)return 1;if(this===t)return 0;let o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(e>>>=0);const a=Math.min(o,s),c=this.slice(r,n),u=t.slice(e,i);for(let t=0;t<a;++t)if(c[t]!==u[t]){o=c[t],s=u[t];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},l.prototype.indexOf=function(t,e,i){return y(this,t,e,i,!0)},l.prototype.lastIndexOf=function(t,e,i){return y(this,t,e,i,!1)},l.prototype.write=function(t,e,i,r){if(void 0===e)r="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)r=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}const n=this.length-e;if((void 0===i||i>n)&&(i=n),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let o=!1;for(;;)switch(r){case"hex":return v(this,t,e,i);case"utf8":case"utf-8":return x(this,t,e,i);case"ascii":case"latin1":case"binary":return b(this,t,e,i);case"base64":return w(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,i);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const M=4096;function E(t,e,i){let r="";i=Math.min(t.length,i);for(let n=e;n<i;++n)r+=String.fromCharCode(127&t[n]);return r}function I(t,e,i){let r="";i=Math.min(t.length,i);for(let n=e;n<i;++n)r+=String.fromCharCode(t[n]);return r}function L(t,e,i){const r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);let n="";for(let r=e;r<i;++r)n+=Y[t[r]];return n}function P(t,e,i){const r=t.slice(e,i);let n="";for(let t=0;t<r.length-1;t+=2)n+=String.fromCharCode(r[t]+256*r[t+1]);return n}function k(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function N(t,e,i,r,n,o){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(i+r>t.length)throw new RangeError("Index out of range")}function D(t,e,i,r,n){j(e,r,n,t,i,7);let o=Number(e&BigInt(4294967295));t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[i++]=s,s>>=8,t[i++]=s,s>>=8,t[i++]=s,s>>=8,t[i++]=s,i}function O(t,e,i,r,n){j(e,r,n,t,i,7);let o=Number(e&BigInt(4294967295));t[i+7]=o,o>>=8,t[i+6]=o,o>>=8,t[i+5]=o,o>>=8,t[i+4]=o;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[i+3]=s,s>>=8,t[i+2]=s,s>>=8,t[i+1]=s,s>>=8,t[i]=s,i+8}function R(t,e,i,r,n,o){if(i+r>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function F(t,e,i,r,o){return e=+e,i>>>=0,o||R(t,0,i,4),n.write(t,e,i,r,23,4),i+4}function z(t,e,i,r,o){return e=+e,i>>>=0,o||R(t,0,i,8),n.write(t,e,i,r,52,8),i+8}l.prototype.slice=function(t,e){const i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||k(t,e,this.length);let r=this[t],n=1,o=0;for(;++o<e&&(n*=256);)r+=this[t+o]*n;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||k(t,e,this.length);let r=this[t+--e],n=1;for(;e>0&&(n*=256);)r+=this[t+--e]*n;return r},l.prototype.readUint8=l.prototype.readUInt8=function(t,e){return t>>>=0,e||k(t,1,this.length),this[t]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||k(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||k(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||k(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||k(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readBigUInt64LE=X((function(t){G(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||Z(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,n=this[++t]+256*this[++t]+65536*this[++t]+i*2**24;return BigInt(r)+(BigInt(n)<<BigInt(32))})),l.prototype.readBigUInt64BE=X((function(t){G(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||Z(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],n=this[++t]*2**24+65536*this[++t]+256*this[++t]+i;return(BigInt(r)<<BigInt(32))+BigInt(n)})),l.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||k(t,e,this.length);let r=this[t],n=1,o=0;for(;++o<e&&(n*=256);)r+=this[t+o]*n;return n*=128,r>=n&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||k(t,e,this.length);let r=e,n=1,o=this[t+--r];for(;r>0&&(n*=256);)o+=this[t+--r]*n;return n*=128,o>=n&&(o-=Math.pow(2,8*e)),o},l.prototype.readInt8=function(t,e){return t>>>=0,e||k(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||k(t,2,this.length);const i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt16BE=function(t,e){t>>>=0,e||k(t,2,this.length);const i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||k(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||k(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readBigInt64LE=X((function(t){G(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||Z(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(i<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),l.prototype.readBigInt64BE=X((function(t){G(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||Z(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+i)})),l.prototype.readFloatLE=function(t,e){return t>>>=0,e||k(t,4,this.length),n.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||k(t,4,this.length),n.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||k(t,8,this.length),n.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||k(t,8,this.length),n.read(this,t,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(t,e,i,r){t=+t,e>>>=0,i>>>=0,r||N(this,t,e,i,Math.pow(2,8*i)-1,0);let n=1,o=0;for(this[e]=255&t;++o<i&&(n*=256);)this[e+o]=t/n&255;return e+i},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(t,e,i,r){t=+t,e>>>=0,i>>>=0,r||N(this,t,e,i,Math.pow(2,8*i)-1,0);let n=i-1,o=1;for(this[e+n]=255&t;--n>=0&&(o*=256);)this[e+n]=t/o&255;return e+i},l.prototype.writeUint8=l.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigUInt64LE=X((function(t,e=0){return D(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=X((function(t,e=0){return O(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(t,e,i,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*i-1);N(this,t,e,i,r-1,-r)}let n=0,o=1,s=0;for(this[e]=255&t;++n<i&&(o*=256);)t<0&&0===s&&0!==this[e+n-1]&&(s=1),this[e+n]=(t/o|0)-s&255;return e+i},l.prototype.writeIntBE=function(t,e,i,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*i-1);N(this,t,e,i,r-1,-r)}let n=i-1,o=1,s=0;for(this[e+n]=255&t;--n>=0&&(o*=256);)t<0&&0===s&&0!==this[e+n+1]&&(s=1),this[e+n]=(t/o|0)-s&255;return e+i},l.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||N(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigInt64LE=X((function(t,e=0){return D(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=X((function(t,e=0){return O(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(t,e,i){return F(this,t,e,!0,i)},l.prototype.writeFloatBE=function(t,e,i){return F(this,t,e,!1,i)},l.prototype.writeDoubleLE=function(t,e,i){return z(this,t,e,!0,i)},l.prototype.writeDoubleBE=function(t,e,i){return z(this,t,e,!1,i)},l.prototype.copy=function(t,e,i,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-i&&(r=t.length-e+i);const n=r-i;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,i,r):Uint8Array.prototype.set.call(t,this.subarray(i,r),e),n},l.prototype.fill=function(t,e,i,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;let n;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(n=e;n<i;++n)this[n]=t;else{const o=l.isBuffer(t)?t:l.from(t,r),s=o.length;if(0===s)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<i-e;++n)this[n+e]=o[n%s]}return this};const B={};function U(t,e,i){B[t]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function V(t){let e="",i=t.length;const r="-"===t[0]?1:0;for(;i>=r+4;i-=3)e=`_${t.slice(i-3,i)}${e}`;return`${t.slice(0,i)}${e}`}function j(t,e,i,r,n,o){if(t>i||t<e){const r="bigint"==typeof e?"n":"";let n;throw n=o>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(o+1)}${r}`:`>= -(2${r} ** ${8*(o+1)-1}${r}) and < 2 ** ${8*(o+1)-1}${r}`:`>= ${e}${r} and <= ${i}${r}`,new B.ERR_OUT_OF_RANGE("value",n,t)}!function(t,e,i){G(e,"offset"),void 0!==t[e]&&void 0!==t[e+i]||Z(e,t.length-(i+1))}(r,n,o)}function G(t,e){if("number"!=typeof t)throw new B.ERR_INVALID_ARG_TYPE(e,"number",t)}function Z(t,e,i){if(Math.floor(t)!==t)throw G(t,i),new B.ERR_OUT_OF_RANGE(i||"offset","an integer",t);if(e<0)throw new B.ERR_BUFFER_OUT_OF_BOUNDS;throw new B.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${e}`,t)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(t,e,i){let r=`The value of "${t}" is out of range.`,n=i;return Number.isInteger(i)&&Math.abs(i)>2**32?n=V(String(i)):"bigint"==typeof i&&(n=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(n=V(n)),n+="n"),r+=` It must be ${e}. Received ${n}`,r}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function W(t,e){let i;e=e||1/0;const r=t.length;let n=null;const o=[];for(let s=0;s<r;++s){if(i=t.charCodeAt(s),i>55295&&i<57344){if(!n){if(i>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(e-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(e-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((e-=1)<0)break;o.push(i)}else if(i<2048){if((e-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function H(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function J(t,e,i,r){let n;for(n=0;n<r&&!(n+i>=e.length||n>=t.length);++n)e[n+i]=t[n];return n}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function $(t){return t!=t}const Y=function(){const t="0123456789abcdef",e=new Array(256);for(let i=0;i<16;++i){const r=16*i;for(let n=0;n<16;++n)e[r+n]=t[i]+t[n]}return e}();function X(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},76690:(t,e)=>{e.read=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},e.write=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+d]=255&a,d+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m}},28481:t=>{t.exports={name:"esri-leaflet",description:"Leaflet plugins for consuming ArcGIS Online and ArcGIS Server services.",version:"3.0.12",author:"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)",bugs:{url:"https://github.com/esri/esri-leaflet/issues"},contributors:["Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)","John Gravois (https://johngravois.com)","Gavin Rehkemper <grehkemper@esri.com> (https://gavinr.com)","Jacob Wasilkowski (https://jwasilgeo.github.io)"],dependencies:{"@terraformer/arcgis":"^2.1.0","tiny-binary-search":"^1.0.3"},devDependencies:{"@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.1","@rollup/plugin-terser":"^0.3.0",chai:"4.3.7","chokidar-cli":"^3.0.0","gh-release":"^7.0.1","highlight.js":"^11.7.0","http-server":"^14.1.1",husky:"^1.1.1",karma:"^6.4.1","karma-chrome-launcher":"^3.1.1","karma-coverage":"^2.2.0","karma-edgium-launcher":"github:matracey/karma-edgium-launcher","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-safari-launcher":"~1.0.0","karma-sinon-chai":"^2.0.2","karma-sourcemap-loader":"^0.3.8",leaflet:"^1.6.0",mkdirp:"^1.0.4",mocha:"^10.2.0","npm-run-all":"^4.1.5",rollup:"^2.79.1",semistandard:"^14.2.3",sinon:"^15.0.1","sinon-chai":"3.7.0",snazzy:"^9.0.0"},files:["src/**/*.js","dist/esri-leaflet.js","dist/esri-leaflet.js.map","dist/esri-leaflet-debug.js.map","dist/siteData.json","profiles/*.js"],homepage:"https://developers.arcgis.com/esri-leaflet/",module:"src/EsriLeaflet.js","jsnext:main":"src/EsriLeaflet.js",jspm:{registry:"npm",format:"es6",main:"src/EsriLeaflet.js"},keywords:["arcgis","esri","esri leaflet","gis","leaflet plugin","mapping"],license:"Apache-2.0",main:"dist/esri-leaflet-debug.js",peerDependencies:{leaflet:"^1.0.0"},readmeFilename:"README.md",repository:{type:"git",url:"git@github.com:Esri/esri-leaflet.git"},scripts:{build:"rollup -c profiles/debug.js & rollup -c profiles/production.js",lint:"semistandard | snazzy",prebuild:"mkdirp dist",pretest:"npm run build",fix:"semistandard --fix",release:"./scripts/release.sh","start-watch":'chokidar src -c "npm run build"',start:"run-p start-watch serve",serve:"http-server -p 5000 -c-1 -o",test:"npm run lint && karma start"},semistandard:{globals:["expect","L","XMLHttpRequest","sinon","xhr","proj4"]},unpkg:"dist/esri-leaflet-debug.js",husky:{hooks:{"pre-commit":"npm run lint"}}}},18053:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.locales=void 0,e.locales={"en-US":["en-US","default",{englishName:"English (United States)"}]}},40047:t=>{var e,i,r=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var a,l=[],c=!1,u=-1;function h(){c&&a&&(c=!1,a.length?l=a.concat(l):u=-1,l.length&&p())}function p(){if(!c){var t=s(h);c=!0;for(var e=l.length;e;){for(a=l,l=[];++u<e;)a&&a[u].run();u=-1,e=l.length}a=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function f(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];l.push(new d(t,e)),1!==l.length||c||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},84862:(t,e,i)=>{"use strict";i.d(e,{s:()=>f});var r=i(14263),n=i(5020),o=i(51300),s=i(26525),a=i(32191),l=i(76170),c=i(36990),u=i(26249),h=i(3828),p=i(52982),d=i(44997);class f{resetErrorMessages(t){t.removeErrorMessageByCategory("background")}getConditionalSetting(t,e,i,r){return function(t,e,i,r,n){const o=t.objects;if(o){const t=o[0];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}(t.dataViews[0].categorical.categories[0],0,e,i,r)}setupBackground(t,e,i){if(this.resetErrorMessages(e),"mapbox"!=t.background.mapSource){const t=e.map.getContainer().querySelector("#mapboxlogo");t&&(t.style.display="none")}if("ordnanceSurvey"!=t.background.mapSource){const t=e.map.getContainer().querySelector("#OSLogo");t&&(t.style.display="none")}switch(t.background.mapSource){case"openStreetMap":e=(new r.P).setupOpenStreetMap(t,e);break;case"azureMaps":e=(new n.o).setupAzureMaps(t,e);break;case"ordnanceSurvey":e=(new o.s).setupOrdnanceSurvey(t,e);break;case"googleMaps":e=(new l.o).setupGoogleMaps(t,e);break;case"mapTiler":e=(new c.u).setupMapTiler(t,e);break;case"mapbox":e=(new s.X).setupMapbox(t,e);break;case"esri":e=(new a.F).setupESRI(t,e);break;case"wms":e=(new u.T).setupWMS(t,e);break;case"vector":{const r=this.getConditionalSetting(i,"background","vectorTilesURL",t.background.vectorTilesURL);e=(new h.G).setupVectorTileLayer(t,e,r);break}case"raster":{const r=this.getConditionalSetting(i,"background","rasterTilesURL",t.background.rasterTilesURL);e=(new p.k).setupRasterTileLayer(t,e,r);break}case"iconMap":e=(new d.X).setupIconMapLayer(t,e);break;case"none":void 0!==e.backgroundLayerGroup&&(e.map.removeLayer(e.backgroundLayerGroup),e.backgroundLayerGroup=void 0)}return e}}},5020:(t,e,i)=>{"use strict";i.d(e,{o:()=>n});var r=i(53481);i(72489);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="azureMaps_";return e+=t.apiKeys.azureMaps+"_",e+=t.background.azureMapsAuthenticationType+"_",e+=t.background.azureMapsClientID+"_",e+=t.background.azureMapsHillShade+"_",e+=t.background.azureMapsLabels+"_",e+=t.background.azureMapsLanguage+"_",e+=t.background.azureMapsStyle,e=this.generateHash(e),e}setupAuthentication(t){const e=t.background.azureMapsAuthenticationType,i=t.apiKeys.azureMaps,r=t.background.azureMapsClientID;return"subscriptionKey"==e?{authType:"subscriptionKey",subscriptionKey:i}:{authType:"anonymous",clientId:r,getToken:function(t){fetch("https://azuremapscodesamples.azurewebsites.net/Common/TokenService.ashx").then((t=>t.text())).then((e=>t(e)))}}}setupAzureMaps(t,e){const i=this.currentBackroundLayerId(t);let n,o;if(""==t.apiKeys.azureMaps&&"subscriptionKey"==t.background.azureMapsAuthenticationType&&e.addErrorMessage("background","AzureMapsKeyMissing","Please enter an Azure Maps API Key in the Format section."),""==t.background.azureMapsClientID&&"anonymous"==t.background.azureMapsAuthenticationType&&e.addErrorMessage("background","AzureMapsClientIDMissing","Please enter the Azure AD Client ID in the formatting section."),e.backgroundSettingsChanged||e.backgroundSettingsHash!=i||void 0===e.backgroundLayerGroup){const s=this.setupAuthentication(t);if(e.setupMap(t),void 0!==e.backgroundLayerGroup&&e.map.removeLayer(e.backgroundLayerGroup),n=new r.TileLayer.AzureMaps({id:i,authOptions:s,tilesetId:t.background.azureMapsStyle,className:"IconMapBackgroundLayer",language:t.background.azureMapsLanguage,zIndex:-20}),o=r.layerGroup([n]),t.background.azureMapsHillShade){const e=new r.TileLayer.AzureMaps({id:"azureMapsHillShade",authOptions:s,tilesetId:"microsoft.terra.main",language:t.background.azureMapsLanguage,className:"IconMapBackgroundLayer",zIndex:-19});o.addLayer(e)}if("none"!=t.background.azureMapsLabels){const e=new r.TileLayer.AzureMaps({id:"azureMapsLabels",authOptions:s,className:"IconMapBackgroundLayer",tilesetId:t.background.azureMapsLabels,language:t.background.azureMapsLanguage,zIndex:-18});o.addLayer(e)}e.map.addLayer(o)}else o=e.backgroundLayerGroup;return document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString()),e.backgroundLayerGroup=o,e.backgroundSettingsHash=i,e}}},32191:(t,e,i)=>{"use strict";i.d(e,{F:()=>s});var r=i(53481),n=(i(19619),i(88524)),o=i(395);class s{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="esri_";return e+=t.background.esriSource+"_",e+=t.background.esriOSMStyle+"_",e+=t.apiKeys.esri+"_",e+=t.background.esriLanguage+"_",e+=t.background.esriArcGISStyle+"_",e+=t.background.esriCustomStyleURL,e=this.generateHash(e),e}setupArcGISLayer(t,e){""==t.apiKeys.esri&&e.addErrorMessage("background","EsriAPIKeyMissing","Please enter an ArcGIS API Key in the formatting settings.");const i=t.apiKeys.esri;let s="arcgis/outdoor";switch(t.background.esriSource){case"arcGIS":s=t.background.esriArcGISStyle;break;case"osm":s=t.background.esriOSMStyle;break;case"custom":""==t.background.esriCustomStyleURL&&e.addErrorMessage("background","OSItemIdMissing","Please enter the Item ID for the custom layer from the ArcGIS portal."),s=t.background.esriCustomStyleURL}const a=(0,n.vectorBasemapLayer)(s,{apiKey:i,language:t.background.esriLanguage});e.setupMap(t);const l=this.currentBackroundLayerId(t);return e.backgroundLayerGroup=r.layerGroup([a]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=l,setTimeout((()=>{(new o.m).activateAttributionLinks(e)}),1500),e}setupESRI(t,e){document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const i=this.currentBackroundLayerId(t);return e.backgroundSettingsChanged||void 0===e.backgroundSettingsHash||e.backgroundSettingsHash!=i||void 0===e.backgroundLayerGroup?(void 0!==e.backgroundLayerGroup&&void 0!==e.map&&e.map.removeLayer(e.backgroundLayerGroup),e=this.setupArcGISLayer(t,e)):e}}},76170:(t,e,i)=>{"use strict";i.d(e,{o:()=>o});var r=i(53481),n=(i(37769),i(54869));class o{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="googleMaps_";return e+=t.background.googleMapsSource+"_",e+=t.apiKeys.googleMaps,e=this.generateHash(e),e}setupGooleMapsLayer(t,e){new n.aH({apiKey:t.apiKeys.googleMaps,version:"quarterly",libraries:["maps"]}).load();const i=this.currentBackroundLayerId(t);let o;switch(t.background.googleMapsSource){case"satellite":o=r.gridLayer.googleMutant({type:"satellite",accessToken:t.apiKeys.googleMaps});break;case"hybrid":o=r.gridLayer.googleMutant({type:"hybrid",accessToken:t.apiKeys.googleMaps});break;case"terrain":o=r.gridLayer.googleMutant({type:"terrain",accessToken:t.apiKeys.googleMaps});break;default:o=r.gridLayer.googleMutant({type:"roadmap",maxZoom:24,accessToken:t.apiKeys.googleMaps})}return e.backgroundLayerGroup=r.layerGroup([o]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=i,e}setupGoogleMaps(t,e){""==t.apiKeys.googleMaps&&e.addErrorMessage("background","GoolgeMapsAPIKeyMissing","Please enter a Google Maps access token in the formatting settings."),document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const i=this.currentBackroundLayerId(t);return e.backgroundSettingsChanged||void 0===e.backgroundSettingsHash||e.backgroundSettingsHash!=i||void 0===e.backgroundLayerGroup?(void 0!==e.backgroundLayerGroup&&void 0!==e.map&&e.map.removeLayer(e.backgroundLayerGroup),e=this.setupGooleMapsLayer(t,e)):e}}},44997:(t,e,i)=>{"use strict";i.d(e,{X:()=>s});var r=i(53481),n=(i(77600),i(16443)),o=i.n(n);class s{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackgroundLayerId(t){let e="iconMap_";return e+=t.background.iconMapStyle+"_",e=this.generateHash(e),e}setupIconMapLayer(t,e){document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const i=this.currentBackgroundLayerId(t);if(!e.backgroundSettingsChanged&&void 0!==e.backgroundSettingsHash&&e.backgroundSettingsHash==i&&void 0!==e.backgroundLayerGroup)return e;if(void 0!==e.backgroundLayerGroup&&void 0!==e.map&&e.map.removeLayer(e.backgroundLayerGroup),""==t.background.iconMapStyle)return e;let n=t.background.iconMapStyle+"?v="+e.visualGUID+"&i="+e.instanceID,s='&copy; <a href="https://www.tekantis.com">Tekantis</a> &copy; <a href="http://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>';if(!t.background.iconMapStyle.startsWith("{")&&e.iconMapStyles){const i=0,r=e.iconMapStyles.filter((t=>"background"===t.type));t.background.iconMapStyle='{"url":"'+r[i].url+'", "attribution":"'+r[i].attribution+'", "thumbnail":"'+r[i].thumbnail+'"}'}if(t.background.iconMapStyle.startsWith("{")){const i=JSON.parse(t.background.iconMapStyle);n=i.url+"?v="+e.visualGUID+"&i="+e.instanceID,s=i.attribution}const a={style:n,attribution:s},l=r.maplibreGL(a);e.setupMap(t),e.backgroundLayerGroup=r.layerGroup([l]),e.map.addLayer(e.backgroundLayerGroup);try{o().setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",null,!0)}catch(t){}return e.backgroundSettingsHash=i,e}}},36990:(t,e,i)=>{"use strict";i.d(e,{u:()=>s});var r=i(53481),n=i(95436),o=i(26494);class s{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="mapTiler_";return e+=t.background.mapTilerSource+"_",e+=t.apiKeys.mapTiler+"_",e+=t.background.mapTilerTileset+"_",e+=t.background.mapTilerTilesetId,e=this.generateHash(e),e}setupMapTiler(t,e){const i=this.currentBackroundLayerId(t),s=t.apiKeys.mapTiler;e.setupMap(t);let a,l=e.backgroundSettingsHash;if(void 0===l&&(l=""),!e.backgroundSettingsChanged&&""!=l&&l==i&&void 0!==e.backgroundLayerGroup)return e;if(void 0!==e.backgroundLayerGroup&&e.map.hasLayer(e.backgroundLayerGroup)&&e.map.removeLayer(e.backgroundLayerGroup),"customTiles"==t.background.mapTilerSource)a=t.background.mapTilerTilesetId;else switch(t.background.mapTilerTileset){case"basic":a=o.Gj.BASIC;break;case"backdrop":a=o.Gj.BACKDROP;break;case"bright":a=o.Gj.BRIGHT;break;case"dataviz":a=o.Gj.DATAVIZ;break;case"ocean":a=o.Gj.OCEAN;break;case"hybrid":a=o.Gj.HYBRID;break;case"openStreetMap":a=o.Gj.OPENSTREETMAP;break;case"outdoor":a=o.Gj.OUTDOOR;break;case"satellite":a=o.Gj.SATELLITE;break;case"streets":default:a=o.Gj.STREETS;break;case"toner":a=o.Gj.TONER;break;case"topo":a=o.Gj.TOPO;break;case"winter":a=o.Gj.WINTER}const c={apiKey:s,style:a},u=new n.gw(c),h=r.layerGroup([u]);return e.backgroundLayerGroup=h,e.map.addLayer(h),e.backgroundSettingsHash=i,e}}},26525:(t,e,i)=>{"use strict";i.d(e,{X:()=>n});var r=i(53481);i(73559);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="mapbox_";return e+=t.background.mapboxSource+"_",e+=t.background.mapboxStyle+"_",e+=t.apiKeys.mapbox+"_",e+=t.background.mapboxStyleURL,e=this.generateHash(e),e}setupVectorLayer(t,e){const i=this.currentBackroundLayerId(t),n=t.apiKeys.mapbox;let o="";switch(t.background.mapboxStyle){case"streets":o="mapbox://styles/mapbox/streets-v12";break;case"outdoors":o="mapbox://styles/mapbox/outdoors-v12";break;case"light":o="mapbox://styles/mapbox/light-v11";break;case"dark":o="mapbox://styles/mapbox/dark-v11";break;case"satellite":o="mapbox://styles/mapbox/satellite-v9";break;case"satelliteStreets":o="mapbox://styles/mapbox/satellite-streets-v12";break;case"navigationDay":o="mapbox://styles/mapbox/navigation-day-v1";break;case"navigationNight":o="mapbox://styles/mapbox/navigation-night-v1"}const s=r.mapboxGL({accessToken:n,style:o});e.backgroundLayerGroup=r.layerGroup([s]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=i;const a=e.map.getContainer().querySelector("#mapboxlogo");return a&&(a.style.display="block"),e.map.attributionControl.addAttribution('Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>'),e}setupMapboxStudioLayer(t,e){""==t.apiKeys.mapbox&&e.addErrorMessage("background","MapboxURLMissing","Please enter a mapbox:// style address for the style in the formatting settings.");const i=this.currentBackroundLayerId(t),n=t.apiKeys.mapbox;let o="";o=t.background.mapboxStyleURL;const s=r.mapboxGL({accessToken:n,style:o});e.setupMap(t),e.backgroundLayerGroup=r.layerGroup([s]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=i;const a=e.map.getContainer().querySelector("#mapboxlogo");return a&&(a.style.display="block"),e}setupRasterLayer(t,e){let i;const n=this.currentBackroundLayerId(t),o=t.apiKeys.mapbox;switch(t.background.mapboxStyle){case"streets":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v12/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"outdoors":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/outdoors-v12/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"light":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/light-v11/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"dark":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"satellite":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"satelliteStreets":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v12/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"navigationDay":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/navigation-day-v1/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"});break;case"navigationNight":i=r.tileLayer("https://api.mapbox.com/styles/v1/mapbox/navigation-night-v1/tiles/256/{z}/{x}/{y}@2x?access_token="+o,{attribution:'Tiles &copy; <a href="https://www.mapbox.com/about/maps/">Mapbox</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <a href="https://www.mapbox.com/map-feedback/#/-74.5/40/10">Improve this map</a>',zIndex:0,id:n,className:"IconMapBackgroundLayer"})}e.backgroundLayerGroup=r.layerGroup([i]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=n;const s=e.map.getContainer().querySelector("#mapboxlogo");return s&&(s.style.display="block"),e}setupMapbox(t,e){""==t.apiKeys.mapbox&&e.addErrorMessage("background","MapboxAPIKeyMissing","Please enter a Mapbox API Key in the formatting settings."),document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const i=this.currentBackroundLayerId(t);if(!e.backgroundSettingsChanged&&void 0!==e.backgroundSettingsHash&&e.backgroundSettingsHash==i&&void 0!==e.backgroundLayerGroup)return e;if(void 0!==e.backgroundLayerGroup&&void 0!==e.map){e.map.removeLayer(e.backgroundLayerGroup);const t=e.map.getContainer().querySelector("#mapboxlogo");t&&(t.style.display="none")}switch(t.background.mapboxSource){case"vector":e=this.setupVectorLayer(t,e);break;case"mapboxStudio":e=this.setupMapboxStudioLayer(t,e);break;default:e=this.setupRasterLayer(t,e)}return e}}},14263:(t,e,i)=>{"use strict";i.d(e,{P:()=>n});var r=i(53481);class n{setupOpenStreetMap(t,e){let i;switch(t.background.openStreetMapSource){case"humanitarian":i=new r.TileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>',maxZoom:19,zIndex:0,className:"IconMapBackgroundLayer",id:"openstreetmap-humanitarian"});break;case"opentopomap":i=new r.TileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{maxZoom:17,zIndex:0,id:"openstreetmap-opentopomap",className:"IconMapBackgroundLayer",attribution:'Map data: &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'});break;default:i=new r.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',maxZoom:19,zIndex:0,id:"openstreetmap-standard",className:"IconMapBackgroundLayer"})}e.setupMap(t);const n=i.options.id;let o=e.backgroundSettingsHash;if(void 0===o&&(o=""),document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString()),!e.backgroundSettingsChanged&&""!=o&&o==n&&void 0!==e.backgroundLayerGroup)return e;void 0!==e.backgroundLayerGroup&&e.map.hasLayer(e.backgroundLayerGroup)&&e.map.removeLayer(e.backgroundLayerGroup);const s=r.layerGroup([i]);return e.backgroundLayerGroup=s,e.map.addLayer(s),e.backgroundSettingsHash=n,e}}},51300:(t,e,i)=>{"use strict";i.d(e,{s:()=>n});var r=i(53481);i(37142),i(77600);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="os_";return e+=t.apiKeys.ordnanceSurvey+"_",e+=t.background.ordnanceSurveyProjection+"_",e+=t.background.ordnanceSurveySource,e=this.generateHash(e),e}vectorLayer(t){const e={container:"map",minZoom:6,maxZoom:18,style:"https://api.os.uk/maps/vector/v1/vts/resources/styles?key="+t.apiKeys.ordnanceSurvey,maxBounds:[[-10.76418,49.528423],[1.9134116,61.331151]],center:[-2.968,54.425],zoom:13,transformRequest:e=>(/[?&]key=/.test(e)||(e+="?key="+t.apiKeys.ordnanceSurvey),{url:e+"&srs=3857"})};return r.maplibreGL(e)}setupOrdnanceSurvey(t,e){let i;""==t.apiKeys.ordnanceSurvey&&e.addErrorMessage("background","OSAPIKeyMissing","Please enter an Ordnance Survey API Key in the formatting settings.");const n=e.map,o=this.currentBackroundLayerId(t);if(document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString()),e.backgroundSettingsChanged||e.backgroundSettingsHash!=o||void 0===e.backgroundLayerGroup){void 0!==e.backgroundLayerGroup&&n.removeLayer(e.backgroundLayerGroup);let s="Contains OS data &copy; Crown copyright and database rights YYYY";s=s.replace("YYYY",(new Date).getFullYear().toString());let a="";switch(t.background.ordnanceSurveyProjection){case"EPSG27700":{let n=[896,448,224,112,56,28,14,7,3.5,1.75,.875,.4375,.21875,.109375];switch(t.background.ordnanceSurveySource){case"leisure":a="https://api.os.uk/maps/raster/v1/zxy/Leisure_27700/{z}/{x}/{y}.png?key=",n=[896,448,224,112,56,28,14,7,3.5,1.75];break;case"light":a="https://api.os.uk/maps/raster/v1/zxy/Light_27700/{z}/{x}/{y}.png?key=",n=[896,448,224,112,56,28,14,7,3.5,1.75,.875,.4375,.21875,.109375];break;case"road":a="https://api.os.uk/maps/raster/v1/zxy/Road_27700/{z}/{x}/{y}.png?key=",n=[896,448,224,112,56,28,14,7,3.5,1.75,.875,.4375,.21875,.109375];break;case"outdoor":a="https://api.os.uk/maps/raster/v1/zxy/Outdoor_27700/{z}/{x}/{y}.png?key=",n=[896,448,224,112,56,28,14,7,3.5,1.75,.875,.4375,.21875,.109375]}a+=t.apiKeys.ordnanceSurvey;const o=new r.Proj.CRS("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs",{resolutions:n,origin:[-238375,1376256]});e.setupMap(t,o),i=new r.TileLayer(a,{attribution:s,className:"IconMapBackgroundLayer",id:"ordnanceSurvey"+t.background.ordnanceSurveySource});break}default:{switch(t.background.ordnanceSurveySource){case"light":a="https://api.os.uk/maps/raster/v1/zxy/Light_3857/{z}/{x}/{y}.png?key=";break;case"road":a="https://api.os.uk/maps/raster/v1/zxy/Road_3857/{z}/{x}/{y}.png?key=";break;case"outdoor":a="https://api.os.uk/maps/raster/v1/zxy/Outdoor_3857/{z}/{x}/{y}.png?key="}a+=t.apiKeys.ordnanceSurvey;const n={attribution:s,minZoom:7,maxZoom:20,center:[54.425,-2.968],zoom:14,className:"IconMapBackgroundLayer",id:"ordnanceSurvey"+t.background.ordnanceSurveySource};e.setupMap(t,void 0),i="vector"==t.background.ordnanceSurveySource?this.vectorLayer(t):new r.TileLayer(a,n);break}}const l=r.layerGroup([i]);return e.map.addLayer(l),this.configureLogo(t,e),e.backgroundLayerGroup=l,e.backgroundSettingsHash=o,e}return e}configureLogo(t,e){const i=e.map.getContainer().querySelector("#OSLogo");i&&(i.style.display="block",(t.controls.metricScale||t.controls.imperialScale||t.controls.nauticScale)&&(i.style.marginLeft="100px"))}}},52982:(t,e,i)=>{"use strict";i.d(e,{k:()=>n});var r=i(53481);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="rasterTiles_";return e+=t+"_",e=this.generateHash(e),e}setupRasterTileLayer(t,e,i){document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const n=this.currentBackroundLayerId(i);if(!e.backgroundSettingsChanged&&void 0!==e.backgroundSettingsHash&&e.backgroundSettingsHash==n&&void 0!==e.backgroundLayerGroup)return e;if(void 0!==e.backgroundLayerGroup&&void 0!==e.map&&e.map.removeLayer(e.backgroundLayerGroup),""==i)return e;const o=new r.TileLayer(i,{maxZoom:t.zoom.maxZoom,minZoom:t.zoom.minZoom,className:"IconMapBackgroundLayer"});return e.setupMap(t),e.backgroundLayerGroup=r.layerGroup([o]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=n,e}}},3828:(t,e,i)=>{"use strict";i.d(e,{G:()=>n});var r=i(53481);i(77600);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="vectorTiles_";return e+=t+"_",e=this.generateHash(e),e}setupVectorTileLayer(t,e,i){document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString());const n=this.currentBackroundLayerId(i);if(!e.backgroundSettingsChanged&&void 0!==e.backgroundSettingsHash&&e.backgroundSettingsHash==n&&void 0!==e.backgroundLayerGroup)return e;if(void 0!==e.backgroundLayerGroup&&void 0!==e.map&&e.map.removeLayer(e.backgroundLayerGroup),""==i)return e;const o={style:i},s=r.maplibreGL(o);return e.setupMap(t),e.backgroundLayerGroup=r.layerGroup([s]),e.map.addLayer(e.backgroundLayerGroup),e.backgroundSettingsHash=n,e}}},26249:(t,e,i)=>{"use strict";i.d(e,{T:()=>n});var r=i(53481);i(37142);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}currentBackroundLayerId(t){let e="os_";return e+=t.background.wmsURL+"_",e+=t.background.wmsFormat+"_",e+=t.background.wmsLayer+"_",e+=t.background.wmsCRS,e=this.generateHash(e),e}setupWMS(t,e){let i;""==t.background.wmsURL&&e.addErrorMessage("background","WMSURLMissing","Please enter a URL for the WMS service in the formatting settings.");let n=e.map;const o=this.currentBackroundLayerId(t);if(document.documentElement.style.setProperty("--GrayScaleAmount",(t.background.grayscale/100).toString()),document.documentElement.style.setProperty("--BackGroundOpacity",((100-t.background.transparency)/100).toString()),e.backgroundSettingsChanged||e.backgroundSettingsHash!=o||void 0===e.backgroundLayerGroup){void 0!==e.backgroundLayerGroup&&n.removeLayer(e.backgroundLayerGroup),e.setupMap(t,void 0),n=e.map;const s=new URL(t.background.wmsURL),a=s.searchParams;a.delete("request"),a.delete("service"),a.delete("version");const l=s.toString();i=r.tileLayer.wms(l,{layers:t.background.wmsLayer,format:t.background.wmsFormat,className:"IconMapBackgroundLayer"});const c=r.layerGroup([i]);return n.addLayer(c),e.backgroundLayerGroup=c,e.backgroundSettingsHash=o,e.map=n,e}return e}}},395:(t,e,i)=>{"use strict";i.d(e,{m:()=>r});class r{activateAttributionLinks(t){const e=t.map,i=t.host,r=e.attributionControl;if(r&&r.getContainer()){r.setPrefix(" ");const e=r.getContainer(),n=document.createElement("span"),o=document.createElement("a");if(o.textContent="Icon Map Pro ",o.href="https://iconmappro.com/",n.appendChild(o),Array.from(e.childNodes).some((t=>t.textContent.includes("Icon Map Pro")))||e.insertBefore(n,e.childNodes[1]),""!=t.productAttributionMessage){const i=document.createElement("span");i.id="productAttributionMessage";let r=t.productAttributionMessage;r.startsWith("!")?(r=r.substring(1),i.style.color="red"):i.style.color="",i.textContent=" | "+r,e.appendChild(i)}const s=e.querySelector("#additionalAttribution");if(s&&e.removeChild(s),""!=t.settings.controls.additionalAttribution){const i=document.createElement("span");i.id="additionalAttribution",i.textContent=" | "+t.settings.controls.additionalAttribution,e.appendChild(i)}for(let t=0;t<e.childNodes.length;t++)e.childNodes[t].textContent.includes("| ,")&&(e.childNodes[t].textContent=e.childNodes[t].textContent.replace("| ,","| "));const a=e.getElementsByTagName("a");for(let t=0;t<a.length;t++)a[t].addEventListener("click",(e=>{e.preventDefault(),i.launchUrl(a[t].getAttribute("href"))}))}}}},23087:(t,e,i)=>{"use strict";i.d(e,{H:()=>o});var r=i(395),n=(i(17423),i(87375),i(84132),i(53481));class o{lassoSettingsHash="";generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}autoZoomOverride(t,e){if(e.controls.zoomLock){if(null==t.zoomLockControl){const e=n.Control.extend({onAdd:function(){const e=n.DomUtil.create("div","leaflet-bar leaflet-control"),i=n.DomUtil.create("a","leaflet-control-zoomlock",e);return i.title="Prevent auto zoom to data points",i.setAttribute("role","button"),i.setAttribute("aria-label",i.title),n.DomEvent.addListener(i,"click",(function(){i.classList.contains("active")?(i.classList.remove("active"),i.title="Prevent auto zoom to data points",t.zoomLocked=!1):(i.classList.add("active"),t.zoomLocked=!0,i.title="Re-enable auto zoom to data points")})),e}});t.zoomLockControl=new e({position:"topleft"}),t.map.addControl(t.zoomLockControl)}}else null!=t.zoomLockControl&&t.map.removeControl(t.zoomLockControl),t.zoomLockControl=null}measureControl(t,e){if(e.controls.measureTool){if(null==t.measureControl){const e={position:"topleft",unit:"metres",clearMeasurementsOnStop:!0,showBearings:!1,bearingTextIn:"In",bearingTextOut:"Out",tooltipTextFinish:"Click to <b>finish line</b><br>",tooltipTextDelete:"Press SHIFT-key and click to <b>delete point</b>",tooltipTextMove:"Click and drag to <b>move point</b><br>",tooltipTextResume:"<br>Press CTRL-key and click to <b>resume line</b>",tooltipTextAdd:"Press CTRL-key and click to <b>add point</b>",measureControlTitleOn:"Turn on Measure Tool",measureControlTitleOff:"Turn off Measure Tool",measureControlLabel:"&#8614;",measureControlClasses:[],showClearControl:!1,clearControlTitle:"Clear Measurements",clearControlLabel:"&times",clearControlClasses:[],showUnitControl:!0,distanceShowSameUnit:!1,unitControlTitle:{text:"Change Units",metres:"metres",landmiles:"land miles",nauticalmiles:"nautical miles"},unitControlLabel:{metres:"m",kilometres:"km",feet:"ft",landmiles:"mi",nauticalmiles:"nm"},tempLine:{color:"#00f",weight:2},fixedLine:{color:"#006",weight:2},startCircle:{color:"#000",weight:1,fillColor:"#0f0",fillOpacity:1,radius:3},intermedCircle:{color:"#000",weight:1,fillColor:"#ff0",fillOpacity:1,radius:3},currentCircle:{color:"#000",weight:1,fillColor:"#f0f",fillOpacity:1,radius:3},endCircle:{color:"#000",weight:1,fillColor:"#f00",fillOpacity:1,radius:3}};t.measureControl=n.control.polylineMeasure(e),t.map.addControl(t.measureControl)}}else null!=t.measureControl&&t.map.removeControl(t.measureControl),t.measureControl=null}zoomControl(t,e){e.controls.zoom?null==t.zoomControl&&(t.zoomControl=n.control.zoom({position:"topleft"}),t.map.addControl(t.zoomControl)):(null!=t.zoomControl&&t.map.removeControl(t.zoomControl),t.zoomControl=null)}nauticScaleControl(t,e){null!=t.nauticScaleControl&&(t.map.removeControl(t.nauticScaleControl),t.nauticScaleControl=null),(e.controls.nauticScale||e.controls.metricScale||e.controls.imperialScale)&&null==t.nauticScaleControl&&(t.nauticScaleControl=new n.Control.ScaleNautic({nautic:e.controls.nauticScale,imperial:e.controls.imperialScale,metric:e.controls.metricScale}),t.map.addControl(t.nauticScaleControl))}lassoControl(t,e){e.controls.lasso?(this.generateHash(JSON.stringify(e.controls))!=this.lassoSettingsHash&&(null!=t.lassoControl&&t.map.removeControl(t.lassoControl),t.lassoControl=null),null==t.lassoControl&&(t.lassoControl=n.control.lasso({position:"topleft",polygon:{color:e.controls.lassoOutline,weight:1.5,fillColor:e.controls.lassoFill,fillOpacity:.5,dashArray:"3 3"}}),t.map.addControl(t.lassoControl),t.map.on("lasso.finished",(e=>{const i=[];let r=e.layers;if(0==e.layers.length){const t=e;null!=t.target&&null!=t.target._layers&&t.target._layers.length>0&&(r=t.target._layers)}for(let t=0;t<r.length;t++){const e=r[t];null!=e.options.selectionId?i.push(e.options.selectionId):(null!=e.feature&&null!=e.feature.properties&&null!=e.feature.properties.selectionId&&i.push(e.feature.properties.selectionId),null!=e.feature&&null!=e.feature.properties&&null!=e.feature.properties.selectionIds&&i.push(...e.feature.properties.selectionIds))}t.clickEvents.clickHandler(i,!1,t,e.originalEvent.ctrlKey||e.originalEvent.shiftKey)})))):(null!=t.lassoControl&&t.map.removeControl(t.lassoControl),t.lassoControl=null),this.lassoSettingsHash=this.generateHash(JSON.stringify(e.controls))}setupControls(t,e){this.zoomControl(e,t),this.nauticScaleControl(e,t),this.autoZoomOverride(e,t),this.measureControl(e,t),this.lassoControl(e,t),document.documentElement.style.setProperty("--ControlSize",t.controls.controlSize.toString()+"px"),(new r.m).activateAttributionLinks(e)}}},62239:(t,e,i)=>{"use strict";i.d(e,{p:()=>d});var r=i(34806),n=i(22748),o=i(79839),s=i(6649),a=i(2712),l=i(83034),c=i(89751),u=i(28764),h=i(13009),p=i(70935);class d{resetErrorMessages(t){t.removeErrorMessageByCategory("dataLayers")}determineFields(t){const e=t.dataViews[0].categorical,i=e.values;if(null==i)return;const n=i.grouped(),o=r.getMeasureIndexOfRole(n,"Longitude"),s=r.getMeasureIndexOfRole(n,"Latitude"),a=r.getMeasureIndexOfRole(n,"DestinationLongitude"),l=r.getMeasureIndexOfRole(n,"DestinationLatitude"),c=r.getMeasureIndexOfRole(n,"Size"),u=r.getMeasureIndexOfRole(n,"H3Weight"),h=r.getMeasureIndexOfRole(n,"Time"),p=r.getMeasureIndexOfRole(n,"imageWKT"),d=r.getMeasureIndexOfRole(n,"featureRef");return{Longitudes:t.dataViews[0].categorical.values[o],Latitudes:t.dataViews[0].categorical.values[s],DestinationLongitudes:t.dataViews[0].categorical.values[a],DestinationLatitudes:t.dataViews[0].categorical.values[l],Sizes:t.dataViews[0].categorical.values[c],H3Weight:t.dataViews[0].categorical.values[u],Times:t.dataViews[0].categorical.values[h],WKTImage:t.dataViews[0].categorical.values[p],values:t.dataViews[0].categorical.categories[t.dataViews[0].categorical.categories.length-1].values,category:e.categories[0],featureRef:t.dataViews[0].categorical.values[d],tooltipColumns:e.values.filter((t=>t.source.roles.tooltip))}}clearLayers(t){void 0!==t.circleLayerGroup&&(t.map.removeLayer(t.circleLayerGroup),t.circleLayerGroup=void 0),void 0!==t.imageLayerGroup&&(t.map.removeLayer(t.imageLayerGroup),t.imageLayerGroup=void 0),void 0!==t.lineLayerGroup&&(t.map.removeLayer(t.lineLayerGroup),t.lineLayerGroup=void 0),void 0!==t.heatmapLayerGroup&&(t.map.removeLayer(t.heatmapLayerGroup),t.heatmapLayerGroup=void 0),void 0!==t.wktLayerGroup&&(t.map.removeLayer(t.wktLayerGroup),t.wktLayerGroup=void 0),void 0!==t.geoJSONLayerGroup&&(t.map.removeLayer(t.geoJSONLayerGroup),t.geoJSONLayerGroup=void 0),void 0!==t.h3LayerGroup&&(t.map.removeLayer(t.h3LayerGroup),t.h3LayerGroup=void 0),void 0!==t.esriFeatureLayerGroup&&(t.map.removeLayer(t.esriFeatureLayerGroup),t.esriFeatureLayerGroup=void 0),void 0!==t.vectorTilesLayerGroup&&(t.map.removeLayer(t.vectorTilesLayerGroup),t.vectorTilesLayerGroup=void 0)}removeLayer(t,e){void 0!==e&&(t.map.removeLayer(e),e=void 0)}setupDataLayers(t,e,i,r=!1){if(this.resetErrorMessages(e),e.autoZoomBounds=null,e.noOfZoomableItems=0,null==i.dataViews[0].categorical.categories[0].values||0==i.dataViews[0].categorical.categories[0].values.length)return this.clearLayers(e),e;const d=e.map.getZoom(),f=this.determineFields(i);if(null==f)return this.clearLayers(e),e;t.heatmapConfiguration.includeHeatmapLayer?(new n.i).setupHeatmapLayer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.featureRef):this.removeLayer(e,e.heatmapLayerGroup),t.h3Configuration.includeH3Layer?(new o.V).setupH3Layer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.featureRef,f.H3Weight):this.removeLayer(e,e.h3LayerGroup),t.vectorTileConfiguration.includeVectorTileLayer?(new u.G).setupVectorTilesLayer(t,e,i,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.WKTImage,f.featureRef,f.tooltipColumns):this.removeLayer(e,e.vectorTilesLayerGroup),t.geoJsonConfiguration.includeGeoJsonLayer?(new p.D).setupGeoJSON(t,e,i,f):this.removeLayer(e,e.geoJSONLayerGroup),t.wktConfiguration.includeWktLayer?(new l.U).setupWktLayer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.WKTImage,f.tooltipColumns):this.removeLayer(e,e.wktLayerGroup),t.linesConfiguration.includeLinesLayer?(new c.r).setupLinesLayer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.WKTImage,f.tooltipColumns):this.removeLayer(e,e.lineLayerGroup),t.esriFeatureConfiguration.includeEsriFeatureLayer?(new h.p).setupEsriFeatureLayer(t,e,i,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.WKTImage,f.featureRef,f.tooltipColumns):this.removeLayer(e,e.esriFeatureLayerGroup);const m=d>1&&d<24;return t.circlesConfiguration.includeCircleLayer&&m?(r&&void 0===e.circleLayerGroup||!r)&&(new s.a).setupCircleLayer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.tooltipColumns):(this.removeLayer(e,e.circleLayerGroup),e.circleLayerGroup=void 0),t.imageConfiguration.includeImageLayer?(new a.P).setupImageLayer(t,e,i,f.values,f.category,f.Longitudes,f.Latitudes,f.DestinationLongitudes,f.DestinationLatitudes,f.Sizes,f.WKTImage,f.tooltipColumns):this.removeLayer(e,e.imageLayerGroup),e}}},6649:(t,e,i)=>{"use strict";i.d(e,{a:()=>s});var r=i(53481),n=(i(23612),i(39389),i(86986));function o(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}class s{configureMarkers(t){const e=.6;document.documentElement.style.setProperty("--MarkerClusterTextColor",t.circlesConfiguration.clusterFontColor),document.documentElement.style.setProperty("--MarkerClusterFontFamily",t.circlesConfiguration.clusterFontFamily),document.documentElement.style.setProperty("--MarkerClusterSmallInsideColor",(0,n.ND)(t.circlesConfiguration.clusterSmallOutsideColor,e)),document.documentElement.style.setProperty("--MarkerClusterSmallOutsideColor",(0,n.ND)(t.circlesConfiguration.clusterSmallInsideColor,e)),document.documentElement.style.setProperty("--MarkerClusterMediumInsideColor",(0,n.ND)(t.circlesConfiguration.clusterMediumOutsideColor,e)),document.documentElement.style.setProperty("--MarkerClusterMediumOutsideColor",(0,n.ND)(t.circlesConfiguration.clusterMediumInsideColor,e)),document.documentElement.style.setProperty("--MarkerClusterLargeInsideColor",(0,n.ND)(t.circlesConfiguration.clusterLargeOutsideColor,e)),document.documentElement.style.setProperty("--MarkerClusterLargeOutsideColor",(0,n.ND)(t.circlesConfiguration.clusterLargeInsideColor,e))}returnFormatting(t,e,i){const r={solid:{color:t.circlesFormatting.fillColor}},n={solid:{color:t.circlesFormatting.outlineColor}},s=t.circlesFormatting.outlineTransparency,a=t.circlesFormatting.fillTransparency,l=t.circlesFormatting.dashArray,c=t.circlesConfiguration.includeInZoom,u=t.circlesFormatting.outlineWidth,h=t.circlesFormatting.fillStyle,p=t.circlesFormatting.hatchAngle,d=t.circlesFormatting.hatchWidth,f=o(e,i,"circlesFormatting","fillColor",r).solid.color,m=o(e,i,"circlesFormatting","outlineColor",n).solid.color;let g=o(e,i,"circlesFormatting","fillTransparency",a),_=o(e,i,"circlesFormatting","outlineTransparency",s);const y=o(e,i,"circlesFormatting","dashArray",l),A=o(e,i,"circlesConfiguration","includeInZoom",c);return _=(100-_)/100,g=(100-g)/100,{fillColor:f,fillTransparency:g,outlineColor:m,outlineTransparency:_,outlineWidth:o(e,i,"circlesFormatting","outlineWidth",u),dashArray:y,includeInZoom:A,fillStyle:o(e,i,"circlesFormatting","fillStyle",h),hatchAngle:o(e,i,"circlesFormatting","hatchAngle",p),hatchWidth:o(e,i,"circlesFormatting","hatchWidth",d)}}returnPoints(t,e,i,r,n,o,s){const a=t.circlesConfiguration.minSize,l=t.circlesConfiguration.maxSize;let c,u,h,p,d;return null!=i&&null!=i.values[s]&&(c=parseFloat(i.values[s].toString())),null!=e&&null!=e.values[s]&&(u=parseFloat(e.values[s].toString())),null!=o&&(null!=o.values[s]?h=parseFloat(o.values[s].toString()):t.circlesConfiguration.displayNull&&(h=a)),null!=n&&null!=n.values[s]&&(p=parseFloat(n.values[s].toString())),null!=r&&null!=r.values[s]&&(d=parseFloat(r.values[s].toString())),{latitude:c,longitude:u,size:h,endLatitude:p,endLongitude:d,minSizeSetting:a,maxSizeSetting:l}}addtoBounds(t,e,i,n,o){return"TRUE"!=o.toUpperCase()&&"YES"!=o.toUpperCase()||(null==n.feature&&(n.feature={type:void 0,properties:{},geometry:void 0}),n.feature.properties.bounds=r.latLngBounds([e,i],[e,i]),null==t.autoZoomBounds?t.autoZoomBounds=r.latLngBounds([e,i],[e,i]):t.autoZoomBounds.extend([e,i]),t.noOfZoomableItems++),t}renderCircleLayer(t,e,i,n,s,a,l,c,u,h){const p=i.length,d=[],f=e.labels;let m,g;if(null!=u&&null!=u.maxLocal&&(m=parseFloat(u.maxLocal.toString())),null!=u&&null!=u.minLocal&&(g=parseFloat(u.minLocal.toString())),null!=u&&null==u.maxLocal&&null!=u.max&&(m=parseFloat(u.max.toString())),null!=u&&null==u.minLocal&&null!=u.min&&(g=parseFloat(u.min.toString())),null!=m)if(m==g&&(m=g+1),null!=a&&null!=s&&null!=u){for(let i=0;i<p;i++){const p=this.returnPoints(t,s,a,l,c,u,i),_=p.latitude,y=p.longitude,A=p.size,v=p.endLatitude,x=p.endLongitude;if(null!=_&&null!=y&&null!=A&&null==v&&null==x&&!Number.isNaN(_)&&!Number.isNaN(y)&&!Number.isNaN(A)){const s=this.returnFormatting(t,n,i);let a,l,c,v=A;if("relative"==t.circlesConfiguration.sizeBehaviour.toLowerCase()&&(v=(A-g)/(m-g)*(p.maxSizeSetting-p.minSizeSetting)+p.minSizeSetting),"HATCHED"==s.fillStyle.toUpperCase()){const t={weight:s.hatchWidth,color:s.fillColor,angle:s.hatchAngle};c=new r.StripePattern(t),c.addTo(e.map),l={pane:"circles",radius:v,dashArray:s.dashArray,weight:s.outlineWidth,color:s.outlineColor,fillOpacity:s.fillTransparency,opacity:s.outlineTransparency,fillPattern:c,keyboard:!0}}else l={pane:"circles",radius:v,dashArray:s.dashArray,weight:s.outlineWidth,color:s.outlineColor,fillColor:s.fillColor,fillOpacity:s.fillTransparency,opacity:s.outlineTransparency,keyboard:!0};a="meters"==t.circlesConfiguration.sizeBehaviour.toLowerCase()?r.circle([_,y],l):r.circleMarker([_,y],l);const x=(e=this.addtoBounds(e,_,y,a,s.includeInZoom)).host.createSelectionIdBuilder().withCategory(n,i).createSelectionId();a.feature.properties.selectionId=x;const b=o(n,i,"circlesConfiguration","allowSelection",e.settings.circlesConfiguration.allowSelection);null==b||"TRUE"!=b.toUpperCase()&&"YES"!=b.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(x,a,e);const w=o(n,i,"circlesConfiguration","showTooltip",e.settings.circlesConfiguration.includeTooltip);null==w||"TRUE"!=w.toUpperCase()&&"YES"!=w.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.tooltips.generateTooltip(n,u,i,a,h,e);const S=f.createLabel(n,i,a,x,t);null!=S&&void 0!==S&&(d.push(S),null==b||"TRUE"!=b.toUpperCase()&&"YES"!=b.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(x,S,e)),d.push(a)}}null!=e.circleLayerGroup&&e.map.removeLayer(e.circleLayerGroup),t.circlesConfiguration.cluster?(this.configureMarkers(t),e.circleLayerGroup=r.markerClusterGroup({pane:"circles",showCoverageOnHover:t.circlesConfiguration.clusterShowPolygon,polygonOptions:{fillColor:t.circlesConfiguration.clusterPolygonColor,color:t.circlesConfiguration.clusterPolygonColor,weight:t.circlesConfiguration.clusterPolygonLineWidth}}),e.circleLayerGroup.addLayer(r.featureGroup(d))):e.circleLayerGroup=r.featureGroup(d,{pane:"circles"}),e.map.getPane("circles").style.zIndex=t.circlesConfiguration.zIndex.toString(),e.map.addLayer(e.circleLayerGroup)}else null!=e.circleLayerGroup&&e.map.removeLayer(e.circleLayerGroup)}setupCircleLayer(t,e,i,r,n,o,s,a,l,c,u){this.renderCircleLayer(t,e,r,n,o,s,a,l,c,u)}}},13009:(t,e,i)=>{"use strict";i.d(e,{p:()=>a});var r=i(53481),n=(i(23612),i(19619)),o=i(11847);function s(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}class a{determineFormatting(t,e,i){const r={solid:{color:t.esriFeatureFormatting.fillColor}},n={solid:{color:t.esriFeatureFormatting.outlineColor}},o=t.esriFeatureFormatting.outlineTransparency,a=t.esriFeatureFormatting.fillTransparency,l=t.esriFeatureFormatting.dashArray,c=t.esriFeatureFormatting.outlineWidth;return{fillColor:s(e,i,"esriFeatureFormatting","fillColor",r).solid.color,outlineColor:s(e,i,"esriFeatureFormatting","outlineColor",n).solid.color,fillTransparency:s(e,i,"esriFeatureFormatting","fillTransparency",a),outlineTransparency:s(e,i,"esriFeatureFormatting","outlineTransparency",o),dashArray:s(e,i,"esriFeatureFormatting","dashArray",l),outlineWidth:s(e,i,"esriFeatureFormatting","outlineWidth",c)}}updateTransparency(t,e,i,r,n,o){if(n&&(null!=e&&e.highlighted?(i=t.interactivity.selectedTransparency,r=t.interactivity.selectedTransparency):(i=t.interactivity.unSelectedTransparency,r=t.interactivity.unSelectedTransparency)),null!=o&&o.length>0){const n=e.selectionId.dataMap,s=o.some((t=>JSON.stringify(t.dataMap)===JSON.stringify(n)));i=s?t.interactivity.selectedTransparency:t.interactivity.unSelectedTransparency,r=s?t.interactivity.selectedTransparency:t.interactivity.unSelectedTransparency}return{fillTransparency:i=(100-i)/100,outlineTransparency:r=(100-r)/100}}returnDataPoints(t,e,i,r,n,o,a,l){if(null==l)return[];const c=[],u=l.values.length;for(let r=0;r<u;r++){const n=l?.values[r].toString(),o=l.highlights?.[r]===l.values[r],a=s(i,r,"esriFeatureConfiguration","allowSelection",e.esriFeatureConfiguration.allowSelection),u={point:r,reference:n,bounds:null,highlighted:o,selectionId:t.host.createSelectionIdBuilder().withCategory(i,r).createSelectionId(),selectable:"TRUE"===a.toUpperCase()||"YES"===a.toUpperCase()};c.push(u)}return c}generateTooltip(t,e,i,r,n){const s=[];if(null!=e&&null!=r&&r.length>0){r.sort(((t,e)=>{const i=t.source.rolesIndex.tooltip[0],r=e.source.rolesIndex.tooltip[0];return i<r?-1:i>r?1:0}));for(let t=0;t<r.length;t++){const i=r[t],n=o.G2.create({format:i.source.format}).format(i.values[e.point]);s.push({displayName:i.source.displayName,value:n})}}else if(null!=e&&null!=t.values[e.point]){const i=t.values[e.point].toString();s.push({displayName:t.source.displayName,value:i})}null!=e&&n.esriFeatureConfiguration.addPropertyToTooltip&&!n.esriFeatureConfiguration.addAllPropertiesToTooltip&&s.push({displayName:n.esriFeatureConfiguration.propertyToMatch,value:e.reference}),n.esriFeatureConfiguration.addAllPropertiesToTooltip&&Object.keys(i.properties).forEach((function(t){if(null!=i.properties[t]){const e=i.properties[t].toString();s.some((i=>i.displayName===t&&i.value===e))||s.push({displayName:t,value:e})}})),i.properties.tooltipData=s}addTooltipEvents(t){const e=function(e){const i=e.originalEvent;void 0!==e.layer.feature.properties.tooltipData&&t.host.tooltipService.show({coordinates:[i.clientX,i.clientY],isTouchEvent:"touchstart"===e.type,dataItems:e.layer.feature.properties.tooltipData,identities:[e.layer.feature.properties.selectionId]})};t.esriFeatureLayerGroup.on("mouseover",e),t.esriFeatureLayerGroup.on("mousemove",e),t.esriFeatureLayerGroup.on("touchstart",e);const i=function(e){t.host.tooltipService.hide({isTouchEvent:"touchend"===e.type,immediately:!1})};t.esriFeatureLayerGroup.on("mouseout",i),t.esriFeatureLayerGroup.on("touchend",i)}processFeatureCollectionBounds(t,e,i,n,o,a){let l=null;const c=!e.esriFeatureConfiguration.matchSpecificProperty,u=e.esriFeatureConfiguration.propertyToMatch,h=o.highlights?.some((t=>null!==t));let p=!1;e.zoom.zoomToHighlighted&&h&&(p=!0);for(const h of t.features){let t=!1,d=null;if(c&&h.properties&&i.forEach((e=>{Object.values(h.properties).map(String).includes(e.reference.toString())&&(t=!0,d=e)})),c||""==u||h.properties&&null!=h.properties[u]&&i.forEach((e=>{e.reference.toString()==h.properties[u].toString()&&(t=!0,d=e)})),t){const t=d.point,c=s(n,t,"esriFeatureConfiguration","includeInZoom",e.esriFeatureConfiguration.includeInZoom),u=o.highlights?.[t]===o.values[t];if(("TRUE"===c.toUpperCase()||"YES"===c.toUpperCase())&&(!p||p&&u)){const t=r.geoJSON(h.geometry);l=i[d.point].bounds=t.getBounds(),null==a.autoZoomBounds?a.autoZoomBounds=l:a.autoZoomBounds.extend(l)}}}if(e.zoom.autoZoom&&!a.zoomLocked&&!a.settings.zoom.lockZoom){let t={};1==a.noOfZoomableItems&&(t={maxZoom:e.zoom.zoomLevelForSingle}),null!=a.autoZoomBounds&&a.map.fitBounds(a.autoZoomBounds,t)}}processBounds(t,e,i,r,n,o){const s=this.processFeatureCollectionBounds;let a=!0;const l=t.options,c=l.url+l.apikey;void 0!==o.ESRIFeatureCollection&&o.ESRIFeatureCollection.esriHash==c&&null!=o.ESRIFeatureCollection.featureCollection&&(a=!1,s(o.ESRIFeatureCollection.featureCollection,i,e,r,n,o)),a&&t.query().run((function(t,a){t||(o.ESRIFeatureCollection={esriHash:c,featureCollection:a},s(a,i,e,r,n,o))}))}renderEsriFeatureLayer(t,e,i,r,o,a,l,c,u,h,p){const d=s(r,0,"esriFeatureConfiguration","esriFeatureLayerURL",e.esriFeatureConfiguration.esriFeatureLayerURL);if(!e.esriFeatureConfiguration.includeEsriFeatureLayer||null==d||""==d)return void(null!=t.esriFeatureLayerGroup&&(t.map.removeLayer(t.esriFeatureLayerGroup),t.esriFeatureLayerGroup=null));const f=this.returnDataPoints(t,e,r,o,a,l,c,u),m=!e.esriFeatureConfiguration.matchSpecificProperty,g=this.updateTransparency,_=e.esriFeatureConfiguration.propertyToMatch,y=e.esriFeatureConfiguration.tooltipForUnmatched,A=this.generateTooltip,v=this.determineFormatting,x=t.selectionManager.getSelectionIds(),b={url:d,apikey:e.apiKeys.esri,style:function(t){let i=!1,n=null;m&&t.properties&&f.forEach((e=>{Object.values(t.properties).map(String).includes(e.reference.toString())&&(i=!0,n=e)})),m||""==_||t.properties&&null!=t.properties[_]&&f.forEach((e=>{e.reference.toString()==t.properties[_].toString()&&(i=!0,n=e)}));let o=e.esriFeatureFormatting.unmatched_fillColor,a=e.esriFeatureFormatting.unmatched_outlineColor,l=e.esriFeatureFormatting.unmatched_fillTransparency,c=1-e.esriFeatureFormatting.unmatched_outlineTransparency/100,u=e.esriFeatureFormatting.unmatched_dashArray,d=e.esriFeatureFormatting.unmatched_outlineWidth;if(i){const i=v(e,r,n.point);({fillColor:o,outlineColor:a,fillTransparency:l,outlineTransparency:c,dashArray:u,outlineWidth:d}=i);const h=s(r,n.point,"esriFeatureConfiguration","includeTooltip",e.esriFeatureConfiguration.includeTooltip);"TRUE"!==h.toUpperCase()&&"YES"!==h.toUpperCase()||A(r,n,t,p,e),t.properties.selectionId=n.selectionId}else y&&A(r,null,t,p,e);const b=g(e,n,l,c,h,x);return{fillColor:o,fillOpacity:b.fillTransparency,color:a,opacity:b.outlineTransparency,weight:d,dashArray:u}}};null!=t.esriFeatureLayerGroup&&(t.map.removeLayer(t.esriFeatureLayerGroup),t.esriFeatureLayerGroup=null);const w=(0,n.featureLayer)(b);t.esriFeatureLayerGroup=w,t.map.addLayer(t.esriFeatureLayerGroup),this.processBounds(w,f,e,r,u,t),this.addTooltipEvents(t),this.addClickEvents(t,e,i,r,o,a,l,c,u,p)}addClickEvents(t,e,i,r,n,o,s,l,c,u){function h(t,e){if(t instanceof Function)return e instanceof Function&&t.toString()===e.toString();if(null==t||null==e)return t===e;if(t===e||t.valueOf()===e.valueOf())return!0;if(t instanceof Date)return!1;if(e instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(e instanceof Object))return!1;const i=Object.keys(t);return!!Object.keys(e).every((function(t){return-1!==i.indexOf(t)}))&&i.every((function(i){return h(t[i],e[i])}))}t.esriFeatureLayerGroup.on("click",(function(p){if(null!=p.layer.feature.properties.selectionId){let d=!1,f=[p.layer.feature.properties.selectionId];const m=p.layer.feature.properties.selectionId;null!=t.selectedIds&&t.selectedIds.length>0&&h(m,t.selectedIds[0])?(t.selectionManager.clear(),f=[],d=!0):((p.originalEvent.ctrlKey||p.originalEvent.shiftKey)&&(f=t.selectedIds.concat(f)),f=function(t){t.concat();for(let e=0;e<t.length;++e)for(let i=e+1;i<t.length;++i)t[e]===t[i]&&t.splice(i--,1);return t}(f),t.selectionManager.select(f,p.originalEvent.ctrlKey||p.originalEvent.shiftKey)),t.clickEvents.clickHandler(f,!0,t,!1),0==f.length&&(f=null),t.selectedIds=f,d&&(new a).renderEsriFeatureLayer(t,e,i,r,n,o,s,l,c,!1,u)}})),t.esriFeatureLayerGroup.on("contextmenu",(function(e){null!=e.layer.feature.properties.selectionId&&t.selectionManager.showContextMenu(e.layer.feature.properties.selectionId,{x:e.originalEvent.clientX,y:e.originalEvent.clientY})}))}checkCrossHighlighting(t,e,i){let r=!1;null!=e&&(r=e.highlights?.some((t=>null!==t)));let n=!1;null!=t&&(n=t.highlights?.some((t=>null!==t)));let o=!1;return null!=i&&(o=i.highlights?.some((t=>null!==t))),!!(r||n||o)}setupEsriFeatureLayer(t,e,i,r,n,o,s,a,l,c,u,h){const p=this.checkCrossHighlighting(l,u,c);this.renderEsriFeatureLayer(e,t,i.dataViews[0].categorical.categories[0].values,i.dataViews[0].categorical.categories[0],n,o,s,a,u,p,h)}}},70935:(t,e,i)=>{"use strict";i.d(e,{D:()=>s});var r=i(53481),n=(i(23612),i(3075));function o(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}class s{returnDataPoints(t,e,i,r){if(null==r)return[];const n=[],s=r.values.length,{allowSelection:a,includeTooltip:l,includeInZoom:c}=e.geoJsonConfiguration;for(let e=0;e<s;e++){const s=r.values[e]?.toString();if(void 0!==s&&""!==s){const r=o(i,e,"geoJsonConfiguration","allowSelection",a).toUpperCase(),u=o(i,e,"geoJsonConfiguration","includeTooltip",l).toUpperCase(),h=o(i,e,"geoJsonConfiguration","includeInZoom",c).toUpperCase(),p={point:e,reference:s,includeInZoom:"TRUE"===h||"YES"===h,selectionId:t.host.createSelectionIdBuilder().withCategory(i,e).createSelectionId(),includeTooltip:"TRUE"===u||"YES"===u,selectable:"TRUE"===r||"YES"===r};n.push(p)}}return n}returnPropertyKey(t,e){let i;switch(e){case 0:default:i=t.geoJsonConfiguration.propertyToMatch1;break;case 1:i=t.geoJsonConfiguration.propertyToMatch2;break;case 2:i=t.geoJsonConfiguration.propertyToMatch3;break;case 3:i=t.geoJsonConfiguration.propertyToMatch4;break;case 4:i=t.geoJsonConfiguration.propertyToMatch5}return i}returnGeoJSONURL(t,e){let i;switch(e){case 0:default:i=t.geoJsonConfiguration.geoJSONFileURL1;break;case 1:i=t.geoJsonConfiguration.geoJSONFileURL2;break;case 2:i=t.geoJsonConfiguration.geoJSONFileURL3;break;case 3:i=t.geoJsonConfiguration.geoJSONFileURL4;break;case 4:i=t.geoJsonConfiguration.geoJSONFileURL5}return""==i&&0!=e&&(i=t.geoJsonConfiguration.geoJSONFileURL1),i}setupGeoJSONLayer(t,e,i,r){const n=this.returnGeoJSONURL(t,r),s=o(i.category,0,"geoJsonConfiguration","geoJSONFileURL",n);if(""==s&&"url"==t.geoJsonConfiguration.geoJSONFileSource)return e;let a=this.getFile(e,t,s,r);null==a||null==a.file?a=e.geoJSONLoader.loadGeoJSONFile(s,s,this.setupMap,e,t,t.overlays.geoJSONFileSimplification,i,this):this.setupMap(e,t,s,i,this,r)}determineFormatting(t,e,i){const r={solid:{color:t.geoJsonFormatting.fillColor}},n={solid:{color:t.geoJsonFormatting.outlineColor}},s=t.geoJsonFormatting.outlineTransparency,a=t.geoJsonFormatting.fillTransparency,l=t.geoJsonFormatting.dashArray,c=t.geoJsonFormatting.outlineWidth,u=t.geoJsonFormatting.fillStyle,h=t.geoJsonFormatting.hatchAngle,p=t.geoJsonFormatting.hatchWidth;return{fillColor:o(e,i,"geoJsonFormatting","fillColor",r).solid.color,outlineColor:o(e,i,"geoJsonFormatting","outlineColor",n).solid.color,fillTransparency:o(e,i,"geoJsonFormatting","fillTransparency",a),outlineTransparency:o(e,i,"geoJsonFormatting","outlineTransparency",s),dashArray:o(e,i,"geoJsonFormatting","dashArray",l),fillStyle:o(e,i,"geoJsonFormatting","fillStyle",u),hatchAngle:o(e,i,"geoJsonFormatting","hatchAngle",h),hatchWidth:o(e,i,"geoJsonFormatting","hatchWidth",p),outlineWidth:o(e,i,"geoJsonFormatting","outlineWidth",c)}}onEachFeature(t,e,i,n,o,s,a,l){let c=null;const u=t.properties,h=i&&u?n.some((t=>{const e=new Set(Object.values(u)).has(t.reference);return e&&(c=t),e})):!(!o||!u||null==u[o]||!(c=n.find((t=>t.reference==u[o])))),p=l.geoJsonConfiguration.addAllPropertiesToTooltip?Object.keys(u).reduce(((t,e)=>{if(null!=u[e]){const i=u[e].toString();t.some((t=>t.displayName===e&&t.value===i))||t.push({displayName:e,value:i})}return t}),[]):l.geoJsonConfiguration.addPropertyToTooltip&&null!=u[o]?[{displayName:o,value:u[o].toString()}]:[];if(h){u.selectionId=c.selectionId,s.clickEvents.addClickEvent(c.selectionId,e,s),c.includeTooltip&&s.tooltips.generateTooltip(a.category,null,c.point,e,a.tooltipColumns,s,p);const t=s.labels.createLabel(a.category,c.point,e,null,l);t&&s.geoJSONLayerGroup.addLayer(t)}else l.geoJsonConfiguration.tooltipForUnmatched&&s.tooltips.generateTooltip(a.category,null,null,e,a.tooltipColumns,s,p);if(l.geoJsonConfiguration.includeUnmatchedInZoom||h&&c.includeInZoom){let e,i;if(null!=t.geometry?i=t.geometry.coordinates:null!=t.geometries?(i=t.coordinates,i="Point"===t.geometries[0].type?t.geometries[0].coordinates:t.geometries[0].coordinates[0]):i=t.coordinates,null==r.latLngBounds(i).getSouthWest()){const t={lng:i[0],lat:i[1]};e=r.latLngBounds(t,t)}else{const t={lng:r.latLngBounds(i).getSouthWest().lat,lat:r.latLngBounds(i).getSouthWest().lng},n={lng:r.latLngBounds(i).getNorthEast().lat,lat:r.latLngBounds(i).getNorthEast().lng};e=r.latLngBounds(t,n)}u.bounds=e,null==s.autoZoomBounds?s.autoZoomBounds=e:s.autoZoomBounds.extend(e),s.noOfZoomableItems++}}isMatched(t,e,i,r){let n=!1,o=null;if(t.properties)if(e){const e=new Set(Object.values(t.properties));for(const t of i)if(e.has(t.reference)){n=!0,o=t;break}}else r&&null!=t.properties[r]&&(o=i.find((e=>e.reference==t.properties[r])),n=null!=o);return n}getFile(t,e,i,r){let o;if("url"==e.geoJsonConfiguration.geoJSONFileSource)o=t.geoJSONLoader.geoJSONFiles.find((t=>t.reference===i));else{const t="UploadedData"+(r+1);let i;switch(r){case 0:default:i=e.geoJSONFileDataLayers.geoJSONFileStore1;break;case 1:i=e.geoJSONFileDataLayers.geoJSONFileStore2;break;case 2:i=e.geoJSONFileDataLayers.geoJSONFileStore3;break;case 3:i=e.geoJSONFileDataLayers.geoJSONFileStore4;break;case 4:i=e.geoJSONFileDataLayers.geoJSONFileStore5}const s=atob(i.toString()),a=Array.from(s,(t=>t.charCodeAt(0))),l=new Uint8Array(a),c=n.UD(l,{to:"string"});o={reference:t,url:t,file:JSON.parse(c)}}return o}setupMap(t,e,i,n,o,s){let a;if(a=void 0===o?this.getFile(t,e,i,s):o.getFile(t,e,i,s),void 0===a||null==a.file)return;const l=o.returnDataPoints(t,e,n.category,n.featureRef),c=!e.geoJsonConfiguration.matchSpecificProperty,u=o.returnPropertyKey(e,s),h=o.determineFormatting,p={onEachFeature:function(i,r){o.onEachFeature(i,r,c,l,u,t,n,e)},filter:function(t){return!e.geoJsonConfiguration.removeUnmatched||o.isMatched(t,c,l,u)},style:function(i){const o=i.properties,s=e.geoJsonFormatting;let a=!1,p=null;if(c&&o){const t=new Set(Object.values(o));a=l.some((e=>{const i=t.has(e.reference);return i&&(p=e),i}))}else u&&o&&null!=o[u]&&(p=l.find((t=>t.reference==o[u])),a=null!=p);let{unmatched_fillColor:d,unmatched_outlineColor:f,unmatched_fillTransparency:m,unmatched_outlineTransparency:g,unmatched_dashArray:_,unmatched_outlineWidth:y,unmatched_fillStyle:A,unmatched_hatchAngle:v,unmatched_hatchWidth:x}=s;if(a){const t=h(e,n.category,p.point);({fillColor:d,outlineColor:f,fillTransparency:m,outlineTransparency:g,dashArray:_,outlineWidth:y,fillStyle:A,hatchAngle:v,hatchWidth:x}=t)}else!s.overrideStyle&&o&&(d=o.colour||o.color||o.fill||d,f=o.stroke||f,y=o.strokeWidth||y,g=o.strokeOpacity||g,m=o.fillOpacity||m);g=(100-g)/100,m=(100-m)/100;const b={weight:y,color:f,fillColor:d,fillOpacity:m,opacity:g,dashArray:_};if("HATCHED"===A||"hatched"===A){const e={weight:x,color:d,angle:v},i=new r.StripePattern(e);i.addTo(t.map),b.fillPattern=i}return b}};t.geoJSONLayerGroup=new r.LayerGroup;const d=r.geoJSON(a.file,p);t.geoJSONLayerGroup.addLayer(d),t.geoJSONLayerGroup.addTo(t.map),t.zoomToBounds(e)}determineDrilldownLevel(t){const e=t.dataViews[0].categorical;let i=0;if(null!=e.categories)for(let t=0;t<e.categories.length;t++)1==e.categories[t].source.roles.category&&(i=t);return i}getFeatureRefIndices(t){return t.dataViews[0].categorical.values.reduce(((t,e,i)=>(e&&e.source&&e.source.roles&&e.source.roles.featureRef&&t.push(i),t)),[])}getReferenceField(t,e){let i;const r=this.getFeatureRefIndices(t);return 1==r.length?i=t.dataViews[0].categorical.values[r[0]]:r.length>1&&null!=r[e]&&(i=t.dataViews[0].categorical.values[r[e]]),i}setupGeoJSON(t,e,i,r){const n=this.determineDrilldownLevel(i);r.featureRef=this.getReferenceField(i,n),null!=e.geoJSONLayerGroup&&(e.map.removeLayer(e.geoJSONLayerGroup),e.geoJSONLayerGroup),t.geoJsonConfiguration.includeGeoJsonLayer&&(this.setupGeoJSONLayer(t,e,r,n),e.map.getPane("geoJSONLayer").style.zIndex=t.geoJsonConfiguration.geoJSONFileZIndex.toString())}}},79839:(t,e,i)=>{"use strict";i.d(e,{V:()=>l});var r=i(53481),n=i(54923);function o(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}function s(t,e,i){const r=t=>t.toString(16).padStart(2,"0"),n=(t,e)=>parseInt(t.substring(e,e+2),16),o=Math.min(255,Math.ceil(n(i,0)*t+n(e,0)*(1-t))),s=Math.min(255,Math.ceil(n(i,2)*t+n(e,2)*(1-t))),a=Math.min(255,Math.ceil(n(i,4)*t+n(e,4)*(1-t)));return`#${r(o)}${r(s)}${r(a)}`}function a(t,e,i,r){const n=t=>t.toString(16).padStart(2,"0"),o=(t,e)=>parseInt(t.substring(e,e+2),16);let s,a;t<.5?(t*=2,s=e,a=i):(t=2*(t-.5),s=i,a=r);const l=Math.min(255,Math.ceil(o(a,0)*t+o(s,0)*(1-t))),c=Math.min(255,Math.ceil(o(a,2)*t+o(s,2)*(1-t))),u=Math.min(255,Math.ceil(o(a,4)*t+o(s,4)*(1-t)));return`#${n(l)}${n(c)}${n(u)}`}class l{configureForH3PointsAsCoordinates(t,e,i,l,c,u,h,p,d,f,m){let g=!1,_=!1;"points"===e.h3Configuration.zoomBy.toLowerCase()&&(g=!0),"polygons"===e.h3Configuration.zoomBy.toLowerCase()&&(_=!0);const y=e.h3Configuration.includeInZoom,A=[];let v,x,b;i.forEach(((e,i)=>{const n=o(l,i,"h3Configuration","includeInZoom",y),s=u?.values?.[i],a=c?.values?.[i],_=d?.values?.[i],w=p?.values?.[i],S=h?.values?.[i],T=f?.values?.[i],C=m?.values?.[i];null==s||null==a||null!=_||null==C||null!=T||null!=w||null!=S||Number.isNaN(s)||Number.isNaN(a)||Number.isNaN(C)||(x=[s,a],b=[s,a,C],A.push(b),g&&(v=n.toUpperCase(),"TRUE"!=v&&"YES"!=v||(null==t.autoZoomBounds?t.autoZoomBounds=r.latLngBounds(x,x):t.autoZoomBounds.extend(x),t.noOfZoomableItems++)))}));const w=e.h3Configuration.outlineWidth,S=1-e.h3Configuration.fillTransparency/100,T=e.h3Configuration.outlineColor,C=1-e.h3Configuration.outlineTransparency/100,M=o(l,0,"h3Configuration","resolution",t.settings.h3Configuration.resolution),E=e.h3Configuration.startColor.replace("#",""),I=e.h3Configuration.endColor.replace("#",""),L=e.h3Configuration.midColor.replace("#",""),P=e.h3Configuration.useMidColor;if(A.length>0){const e=A.map((([t,e])=>n.Sg(t,e,M))),i=new Map;e.forEach(((e,r)=>{let n=(i.get(e)?.count||0)+1;const s=i.get(e)?.indexes||[],a=o(l,r,"h3Configuration","allowSelection",t.settings.h3Configuration.allowSelection);null==a||"TRUE"!=a.toUpperCase()&&"YES"!=a.toUpperCase()||!t.host.hostCapabilities.allowInteractions||s.push(r);const c=m?.values?.[r];null!=c&&(n+=c),i.set(e,{count:n,indexes:s})}));const c=Array.from(i.values()).map((t=>t.count)),u=Math.max(...c),h=Math.min(...c),p=[];i.forEach(((e,i)=>{let o=1;const c=e.count,d=e.indexes;u!==h&&(o=(c-h)/(u-h));const f=n.u$(i),m=P?a(o,E,L,I):s(o,E,I),g=r.polygon(f,{color:T,fillColor:m,fillOpacity:S,weight:w,opacity:C,pane:"h3"}),y=d.map((e=>t.host.createSelectionIdBuilder().withCategory(l,e).createSelectionId()));y.length>0&&t.clickEvents.addH3ClickEvent(y,g,t),p.push(g),_&&(null==t.autoZoomBounds?t.autoZoomBounds=g.getBounds():t.autoZoomBounds.extend(g.getBounds()),t.noOfZoomableItems++)})),t.h3LayerGroup=r.layerGroup(p),t.map.addLayer(t.h3LayerGroup)}}configureForH3Indexes(t,e,i,l,c,u,h,p,d,f,m){let g;const _=[];i.forEach(((t,e)=>{const r=u?.values?.[e],n=c?.values?.[e],o=d?.values?.[e],s=p?.values?.[e],a=h?.values?.[e],l=f?.values?.[e],y=m?.values?.[e];null!=r||null!=n||null!=o||null!=l||null!=s||null!=a||null==y||Number.isNaN(y)||(g=[i[e],y,e],_.push(g))}));const y=e.h3Configuration.outlineWidth,A=1-e.h3Configuration.fillTransparency/100,v=e.h3Configuration.outlineColor,x=1-e.h3Configuration.outlineTransparency/100,b=e.h3Configuration.startColor.replace("#",""),w=e.h3Configuration.endColor.replace("#",""),S=e.h3Configuration.midColor.replace("#",""),T=e.h3Configuration.useMidColor;if(_.length>0){const e=Math.min(..._.map((t=>t[1]))),i=Math.max(..._.map((t=>t[1]))),c=[];for(let u=0;u<_.length;u++){let h=1;const p=_[u][1],d=_[u][2];i!==e&&(h=(p-e)/(i-e));const f=_[u][0],m=n.u$(f),g=T?a(h,b,S,w):s(h,b,w),C=r.polygon(m,{color:v,fillColor:g,fillOpacity:A,weight:y,opacity:x,pane:"h3"}),M=t.host.createSelectionIdBuilder().withCategory(l,d).createSelectionId(),E=o(l,d,"h3Configuration","allowSelection",t.settings.h3Configuration.allowSelection);null==E||"TRUE"!=E.toUpperCase()&&"YES"!=E.toUpperCase()||!t.host.hostCapabilities.allowInteractions||t.clickEvents.addClickEvent(M,C,t),c.push(C),null==t.autoZoomBounds?t.autoZoomBounds=C.getBounds():t.autoZoomBounds.extend(C.getBounds()),t.noOfZoomableItems++}t.h3LayerGroup=r.layerGroup(c),t.map.addLayer(t.h3LayerGroup)}}setupH3Layer(t,e,i,r,n,o,s,a,l,c,u,h){null!=e.h3LayerGroup&&e.map.removeLayer(e.h3LayerGroup),(s&&o||"coordinates"!=t.h3Configuration.h3Source)&&("coordinates"===t.h3Configuration.h3Source.toLowerCase()?this.configureForH3PointsAsCoordinates(e,t,r,n,o,s,a,l,c,u,h):this.configureForH3Indexes(e,t,r,n,o,s,a,l,c,u,h))}}},22748:(t,e,i)=>{"use strict";i.d(e,{i:()=>n});var r=i(53481);i(23612),i(38886),i(44002);class n{renderHeatmapLayer(t,e,i,n,o,s,a,l,c,u){const h=t.circlesConfiguration.includeInZoom,p=[];if(null!=e.heatmapLayerGroup&&e.map.removeLayer(e.heatmapLayerGroup),s&&o&&(i.forEach(((i,d)=>{const f=function(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t.heatmapConfiguration;if(e){const t=e.includeInZoom;if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}(n,d,0,0,h),m=s.values?.[d],g=o.values?.[d],_=c?.values?.[d],y=l?.values?.[d],A=a?.values?.[d],v=u?.values?.[d];if(null!=m&&null!=g&&null==_&&null==v&&null==y&&null==A&&!Number.isNaN(m)&&!Number.isNaN(g)){let i=t.heatmapConfiguration.multiplier/100;i=i<0?1-Math.abs(i):1+i;const n=[m,g,1*i];p.push(n),"TRUE"!=f.toUpperCase()&&"YES"!=f.toUpperCase()||(null==e.autoZoomBounds?e.autoZoomBounds=r.latLngBounds([m,g],[m,g]):e.autoZoomBounds.extend([m,g]),e.noOfZoomableItems++)}})),p.length>0)){const i=(100-t.heatmapConfiguration.transparency)/100,n=new r.WebGLHeatMap({size:t.heatmapConfiguration.size,opacity:i,alphaRange:t.heatmapConfiguration.alphaRange/100,units:t.heatmapConfiguration.units});n.setData(p),e.heatmapLayerGroup=r.layerGroup([n]),e.map.addLayer(e.heatmapLayerGroup)}}setupHeatmapLayer(t,e,i,r,n,o,s,a,l,c,u){this.renderHeatmapLayer(t,e,r,n,o,s,a,l,c,u)}}},2712:(t,e,i)=>{"use strict";i.d(e,{P:()=>o});var r=i(53481);function n(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}i(23612);class o{returnFormatting(t,e,i){const r=t.imageConfiguration.transparency,o=t.imageConfiguration.includeInZoom,s=t.imageConfiguration.allowSelection,a=t.imageConfiguration.imageRotation,l=t.imageConfiguration.imageWidth,c=t.imageConfiguration.imageHeight,u=t.imageConfiguration.includeTooltip;let h=n(e,i,"imageConfiguration","transparency",r);return h=(100-h)/100,{transparency:h,includeInZoom:n(e,i,"imageConfiguration","includeInZoom",o),allowSelection:n(e,i,"imageConfiguration","allowSelection",s),rotation:n(e,i,"imageConfiguration","imageRotation",a),imageWidth:n(e,i,"imageConfiguration","imageWidth",l),imageHeight:n(e,i,"imageConfiguration","imageHeight",c),includeTooltip:n(e,i,"imageConfiguration","includeTooltip",u)}}returnPoints(t,e,i,r,n,o,s,a){let l,c,u,h,p,d;return null!=i&&null!=i.values[a]&&(l=parseFloat(i.values[a].toString())),null!=e&&null!=e.values[a]&&(c=parseFloat(e.values[a].toString())),null!=o&&null!=o.values[a]&&(u=parseFloat(o.values[a].toString())),null!=n&&null!=n.values[a]&&(h=parseFloat(n.values[a].toString())),null!=r&&null!=r.values[a]&&(p=parseFloat(r.values[a].toString())),null!=s&&null!=s.values[a]&&(d=s.values[a].toString()),{latitude:l,longitude:c,size:u,endLatitude:h,endLongitude:p,imageURL:d}}addtoBounds(t,e,i,n,o){return"TRUE"!=o.toUpperCase()&&"YES"!=o.toUpperCase()||(null==n.feature&&(n.feature={type:void 0,properties:{},geometry:void 0}),n.feature.properties.bounds=r.latLngBounds([e,i],[e,i]),null==t.autoZoomBounds?t.autoZoomBounds=r.latLngBounds([e,i],[e,i]):t.autoZoomBounds.extend([e,i]),t.noOfZoomableItems++),t}isAnImage(t){return!(null==t||null==t||""==t||!t.toLowerCase().startsWith("data:image")&&!t.toLowerCase().startsWith("https://")&&!t.toLowerCase().startsWith("<svg")&&!t.toLowerCase().startsWith("<?xml"))}renderimageLayer(t,e,i,n,o,s,a,l,c,u,h){const p=i.length,d=[],f=e.labels;if(null!=s&&null!=o&&null!=u){for(let i=0;i<p;i++){const p=this.returnPoints(t,o,s,a,l,c,u,i),m=p.latitude,g=p.longitude,_=p.size,y=p.endLatitude,A=p.endLongitude,v=p.imageURL;if(null!=m&&null!=g&&null==_&&null==y&&null==A&&null!=v&&!Number.isNaN(m)&&!Number.isNaN(g)&&!Number.isNaN(_)&&this.isAnImage(v)){const o=this.returnFormatting(t,n,i);let s=v;"<svg"!=v.substring(0,4).toLowerCase()&&"<?xml"!=v.substring(0,5).toLowerCase()||(s="data:image/svg+xml;utf8,"+encodeURIComponent(v));const a=0,l=r.icon({iconUrl:s,iconSize:[o.imageWidth,o.imageHeight],iconAnchor:[+o.imageWidth/2+a,+o.imageHeight/2]}),u=new r.Marker([m,g],{icon:l,rotationAngle:o.rotation,opacity:o.transparency,riseOnHover:!0}),p=(e=this.addtoBounds(e,m,g,u,o.includeInZoom)).host.createSelectionIdBuilder().withCategory(n,i).createSelectionId();u.feature.properties.selectionId=p;const _=o.allowSelection;null==_||"TRUE"!=_.toUpperCase()&&"YES"!=_.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(p,u,e);const y=o.includeTooltip;null==y||"TRUE"!=y.toUpperCase()&&"YES"!=y.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.tooltips.generateTooltip(n,c,i,u,h,e);const A=f.createLabel(n,i,u,p,t);null!=A&&void 0!==A&&(d.push(A),null==_||"TRUE"!=_.toUpperCase()&&"YES"!=_.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(p,A,e)),d.push(u)}}null!=e.imageLayerGroup&&e.map.removeLayer(e.imageLayerGroup),e.imageLayerGroup=r.featureGroup(d),e.map.addLayer(e.imageLayerGroup)}else null!=e.imageLayerGroup&&e.map.removeLayer(e.imageLayerGroup)}setupImageLayer(t,e,i,r,n,o,s,a,l,c,u,h){this.renderimageLayer(t,e,r,n,o,s,a,l,c,u,h)}}},89751:(t,e,i)=>{"use strict";i.d(e,{r:()=>s});var r=i(53481);function n(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}function o(t,e){function i(t){const e=Math.sin((1-t)*a)/Math.sin(a),i=Math.sin(t*a)/Math.sin(a),l=e*Math.cos(r)*Math.cos(n)+i*Math.cos(o)*Math.cos(s),c=e*Math.cos(r)*Math.sin(n)+i*Math.cos(o)*Math.sin(s),u=e*Math.sin(r)+i*Math.sin(o),h=180/Math.PI*Math.atan2(u,Math.sqrt(Math.pow(l,2)+Math.pow(c,2)));let p=180/Math.PI*Math.atan2(c,l);const d=p-180*n/Math.PI;function f(t){return Math[t>0?"floor":"ceil"](t)}return p-=d<0?360*f((d-180)/360):360*f((d+180)/360),[h,p]}let r=t[0],n=t[1],o=e[0],s=e[1];r=r*Math.PI/180,n=n*Math.PI/180,o=o*Math.PI/180,s=s*Math.PI/180;const a=2*Math.asin(Math.sqrt(Math.pow(Math.sin((r-o)/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin((n-s)/2),2)));let l;return l=0===a?[[r,n]]:function(t){const e=[],r=1/98;for(let t=0;t<99;t++){const n=i(r*t);e.push(n)}return e}(),l}i(23612),i(86680);class s{returnFormatting(t,e,i){const r={solid:{color:t.linesFormatting.color}},o=t.linesFormatting.transparency,s=t.linesFormatting.dashArray,a=t.linesConfiguration.includeInZoom,l=t.linesConfiguration.allowSelection,c=t.linesFormatting.width,u=t.linesConfiguration.imageAtDestination,h=t.linesConfiguration.destinationImageRotation,p=t.linesConfiguration.destinationImageWidth,d=t.linesConfiguration.destinationImageHeight,f=t.linesConfiguration.imageAtOrigin,m=t.linesConfiguration.originImageRotation,g=t.linesConfiguration.originImageWidth,_=t.linesConfiguration.originImageHeight,y=t.linesConfiguration.linesBehavior,A=t.linesConfiguration.includeTooltip,v=t.linesConfiguration.destinationImageTransparency,x=t.linesConfiguration.originImageTransparency,b=n(e,i,"linesFormatting","color",r).solid.color;let w=n(e,i,"linesFormatting","transparency",o);const S=n(e,i,"linesFormatting","dashArray",s),T=n(e,i,"linesConfiguration","includeInZoom",a);return w=(100-w)/100,{color:b,transparency:w,width:n(e,i,"linesFormatting","outlineWidth",c),dashArray:S,includeInZoom:T,allowSelection:n(e,i,"linesConfiguration","allowSelection",l),imageAtDestination:n(e,i,"linesConfiguration","imageAtDestination",u),destinationImageRotation:n(e,i,"linesConfiguration","destinationImageRotation",h),destinationImageWidth:n(e,i,"linesConfiguration","destinationImageWidth",p),destinationImageHeight:n(e,i,"linesConfiguration","destinationImageHeight",d),imageAtOrigin:n(e,i,"linesConfiguration","imageAtOrigin",f),originImageRotation:n(e,i,"linesConfiguration","originImageRotation",m),originImageWidth:n(e,i,"linesConfiguration","originImageWidth",g),originImageHeight:n(e,i,"linesConfiguration","originImageHeight",_),linesBehavior:n(e,i,"linesConfiguration","linesBehavior",y),showTooltip:n(e,i,"linesConfiguration","showTooltip",A),destinationImageTransparency:n(e,i,"linesConfiguration","destinationImageTransparency",v),originImageTransparency:n(e,i,"linesConfiguration","originImageTransparency",x)}}returnPoints(t,e,i,r,n,o){let s,a,l,c;return null!=i&&null!=i.values[o]&&(s=parseFloat(i.values[o].toString())),null!=e&&null!=e.values[o]&&(a=parseFloat(e.values[o].toString())),null!=n&&null!=n.values[o]&&(l=parseFloat(n.values[o].toString())),null!=r&&null!=r.values[o]&&(c=parseFloat(r.values[o].toString())),{latitude:s,longitude:a,endLatitude:l,endLongitude:c}}addtoBounds(t,e,i){if("TRUE"==i.toUpperCase()||"YES"==i.toUpperCase()){null==e.feature&&(e.feature={type:void 0,properties:{},geometry:void 0});const i=e.getBounds();e.feature.properties.bounds=i,null==t.autoZoomBounds?t.autoZoomBounds=i:t.autoZoomBounds.extend(i),t.noOfZoomableItems++}return t}addImageAtPoint(t,e,i,n,o,s,a,l,c,u,h,p,d){const f=r.icon({iconUrl:i,iconSize:[n,o],iconAnchor:[+n/2+0,+o/2]}),m=new r.Marker(e,{icon:f,rotationAngle:s,opacity:a,riseOnHover:!0});if("yes"==p.toLocaleLowerCase()){const t=l.host.createSelectionIdBuilder().withCategory(u,c).createSelectionId();l.clickEvents.addClickEvent(t,m,l)}return"TRUE"!==d.toUpperCase()&&"YES"!==d.toUpperCase()||l.tooltips.generateTooltip(u,null,c,m,h,l),m}renderLinesLayer(t,e,i,n,s,a,l,c,u,h){const p=i.length,d=[],f=e.labels;if(null!=a&&null!=s&&null!=c&&null!=l){for(let i=0;i<p;i++){const p=this.returnPoints(t,s,a,l,c,i);if(null!=p.latitude&&null!=p.longitude&&null!=p.endLatitude&&null!=p.endLongitude&&!(Number.isNaN(p.latitude)||Number.isNaN(p.longitude)||Number.isNaN(p.endLatitude)||Number.isNaN(p.endLongitude))){const s=this.returnFormatting(t,n,i),a=r.latLng(p.latitude,p.longitude),l=r.latLng(p.endLatitude,p.endLongitude),c=[a,l];let m;if("straight"==s.linesBehavior.toLowerCase())m=r.polyline(c,{color:s.color,weight:s.width,opacity:s.transparency,smoothFactor:1,dashArray:s.dashArray});else if(a.toString()!=l.toString()){const t=[],e=[p.latitude,p.longitude],i=[p.endLatitude,p.endLongitude],n={weight:s.width,opacity:s.transparency,color:s.color,dashArray:s.dashArray};if("curved"==s.linesBehavior.toLowerCase()){const o=i[1]-e[1],s=i[0]-e[0],a=Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),l=Math.atan2(s,o),c=.314,u=a/2/Math.cos(c),h=l+c,p=u*Math.cos(h)+e[1],d=[u*Math.sin(h)+e[0],p];t.push(e,d,i),m=r.curve(["M",e,"Q",d,i],n)}else m=r.polyline(o(e,i),n)}if(null!=m){const r=(e=this.addtoBounds(e,m,s.includeInZoom)).host.createSelectionIdBuilder().withCategory(n,i).createSelectionId();if(m.feature.properties.selectionId=r,"YES"==s.imageAtDestination.toUpperCase()){const t=this.addImageAtPoint(m,l,s.imageAtDestination,s.destinationImageWidth,s.destinationImageHeight,s.destinationImageRotation,s.destinationImageTransparency,e,i,n,h,s.allowSelection,s.showTooltip);d.push(t)}if("YES"==s.imageAtOrigin.toUpperCase()){const t=this.addImageAtPoint(m,l,s.imageAtOrigin,s.originImageWidth,s.originImageHeight,s.originImageRotation,s.originImageTransparency,e,i,n,h,s.allowSelection,s.showTooltip);d.push(t)}null==s.allowSelection||"TRUE"!=s.allowSelection.toUpperCase()&&"YES"!=s.allowSelection.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(r,m,e),null==s.showTooltip||"TRUE"!=s.showTooltip.toUpperCase()&&"YES"!=s.showTooltip.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.tooltips.generateTooltip(n,u,i,m,h,e),d.push(m);const o=f.createLabel(n,i,m,r,t);null!=o&&void 0!==o&&(d.push(o),null==s.allowSelection||"TRUE"!=s.allowSelection.toUpperCase()&&"YES"!=s.allowSelection.toUpperCase()||!e.host.hostCapabilities.allowInteractions||e.clickEvents.addClickEvent(r,o,e))}}}null!=e.lineLayerGroup&&e.map.removeLayer(e.lineLayerGroup),e.lineLayerGroup=r.featureGroup(d),e.map.addLayer(e.lineLayerGroup)}else null!=e.lineLayerGroup&&e.map.removeLayer(e.lineLayerGroup)}setupLinesLayer(t,e,i,r,n,o,s,a,l,c,u){this.renderLinesLayer(t,e,r,n,o,s,a,l,c,u)}}},28764:(t,e,i)=>{"use strict";i.d(e,{G:()=>a});var r=i(11847),n=i(53481),o=(i(23612),i(77135));function s(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}class a{generateTooltip(t,e,i,n,o){const s=[];if(null!=e&&null!=n&&n.length>0){n.sort(((t,e)=>{const i=t.source.rolesIndex.tooltip[0],r=e.source.rolesIndex.tooltip[0];return i<r?-1:i>r?1:0}));for(let t=0;t<n.length;t++){const i=n[t],o=r.G2.create({format:i.source.format}).format(i.values[e.point]);s.push({displayName:i.source.displayName,value:o})}}else if(null!=e&&null!=t.values[e.point]){const i=t.values[e.point].toString();s.push({displayName:t.source.displayName,value:i})}null!=e&&o.vectorTileConfiguration.addPropertyToTooltip&&!o.vectorTileConfiguration.addAllPropertiesToTooltip&&s.push({displayName:o.vectorTileConfiguration.propertyToMatch1,value:e.reference}),o.vectorTileConfiguration.addAllPropertiesToTooltip&&Object.keys(i.properties).forEach((function(t){if(null!=i.properties[t]){const e=i.properties[t].toString();s.some((i=>i.displayName===t&&i.value===e))||s.push({displayName:t,value:e})}})),i.properties.tooltipData=s}addTooltipEvents(t){t.vectorTilesLayerGroup.on("mouseover",(function(e){const i=e.originalEvent;void 0!==e.layer.feature.properties.tooltipData&&t.host.tooltipService.show({coordinates:[i.clientX,i.clientY],isTouchEvent:!1,dataItems:e.layer.feature.properties.tooltipData,identities:[e.layer.feature.properties.selectionId]})})),t.vectorTilesLayerGroup.on("mouseout",(function(){t.host.tooltipService.hide({isTouchEvent:!1,immediately:!1})}))}determineFormatting(t,e,i){const r={solid:{color:t.vectorTileFormatting.fillColor}},n={solid:{color:t.vectorTileFormatting.outlineColor}},o=t.vectorTileFormatting.outlineTransparency,a=t.vectorTileFormatting.fillTransparency,l=t.vectorTileFormatting.dashArray,c=t.vectorTileFormatting.outlineWidth,u=t.vectorTileFormatting.fillStyle,h=t.vectorTileFormatting.hatchAngle,p=t.vectorTileFormatting.hatchWidth;return{fillColor:s(e,i,"vectorTileFormatting","fillColor",r).solid.color,outlineColor:s(e,i,"vectorTileFormatting","outlineColor",n).solid.color,fillTransparency:s(e,i,"vectorTileFormatting","fillTransparency",a),outlineTransparency:s(e,i,"vectorTileFormatting","outlineTransparency",o),dashArray:s(e,i,"vectorTileFormatting","dashArray",l),fillStyle:s(e,i,"vectorTileFormatting","fillStyle",u),hatchAngle:s(e,i,"vectorTileFormatting","hatchAngle",h),hatchWidth:s(e,i,"vectorTileFormatting","hatchWidth",p),outlineWidth:s(e,i,"vectorTileFormatting","outlineWidth",c)}}returnVectorDataPoints(t,e,i,r,o,a,l,c){const u=[],h=c.values.length;for(let p=0;p<h;p++){let h=null,d=!1;const f=c?.values[p].toString(),m=o?.values[p]&&parseFloat(o.values[p].toString()),g=r?.values[p]&&parseFloat(r.values[p].toString()),_=c.highlights?.[p]===c.values[p],y=c.highlights?.some((t=>null!==t));let A=!1;if(e.zoom.zoomToHighlighted&&y&&(A=!0),m&&g){h=n.latLngBounds([m,g],[m,g]),d=!0;const r=l?.values[p]&&parseFloat(l.values[p].toString()),o=a?.values[p]&&parseFloat(a.values[p].toString());r&&o&&(h=n.latLngBounds([m,g],[r,o]));const c=s(i,p,"vectorTileConfiguration","includeInZoom",e.vectorTileConfiguration.includeInZoom);"TRUE"!==c.toUpperCase()&&"YES"!==c.toUpperCase()||(!A||A&&_)&&(null==t.autoZoomBounds?t.autoZoomBounds=h:t.autoZoomBounds.extend(h))}const v=s(i,p,"vectorTileConfiguration","allowSelection",e.vectorTileConfiguration.allowSelection),x={point:p,reference:f,bounds:h,highlighted:_,zoomable:d,selectionId:t.host.createSelectionIdBuilder().withCategory(i,p).createSelectionId(),selectable:"TRUE"===v.toUpperCase()||"YES"===v.toUpperCase()};u.push(x)}return u}createLabel(t,e,i,o,a,l){if("yes"==s(e,i,"labels","show",a.labels.show).toLowerCase()){const c=s(e,i,"labels","labelText",a.labels.labelText);if(null!=c&&""!=c){const s=t.labels.determineFormatting(a,e,i),u=l.bounds.getCenter();if(null==u)return;const h={text:c,fontFamily:s.fontFamily,fontSize:s.fontSize+"pt"},p=r.Tf.measureSvgTextWidth(h);let d="margin-left: -"+p/2+"px;";d+="margin-top: -"+(r.Tf.measureSvgTextHeight(h)/2-500)+"px;";const f="background-color: "+s.fillColor+";",m=s.paddingTop.toString()+"px "+s.paddingRight.toString()+"px "+s.paddingBottom.toString()+"px "+s.paddingLeft.toString()+"px",g=s.borderRadius;document.documentElement.style.setProperty("--LabelFont",s.fontFamily),document.documentElement.style.setProperty("--LabelFontSize",s.fontSize+"pt"),document.documentElement.style.setProperty("--LabelBorderWidth",s.borderWidth.toString()+"px"),document.documentElement.style.setProperty("--LabelPadding",m),document.documentElement.style.setProperty("--LabelOpacity",s.opacity.toString()),document.documentElement.style.setProperty("--LabelBorderRadius",g.toString()+"px");let _='<div class="iconmap-label" style="width:'+p+"px;"+f+";"+d+";border-color: "+s.borderColor+"; color: "+s.textColor+'">';_+=function(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""}(c),_+="</div>";const y=n.divIcon({html:_}),A=n.marker(u,{icon:y});return null==A.feature&&(A.feature={type:void 0,properties:{},geometry:void 0}),A.feature.properties.isLabel=!0,null!=o&&(A.feature.properties.relatedSelectionId=o),A}}}addClickEvents(t,e,i,r,n,o,s,l,c,u,h){function p(t,e){if(t instanceof Function)return e instanceof Function&&t.toString()===e.toString();if(null==t||null==e)return t===e;if(t===e||t.valueOf()===e.valueOf())return!0;if(t instanceof Date)return!1;if(e instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(e instanceof Object))return!1;const i=Object.keys(t);return!!Object.keys(e).every((function(t){return-1!==i.indexOf(t)}))&&i.every((function(i){return p(t[i],e[i])}))}t.vectorTilesLayerGroup.on("click",(function(d){if(null!=d.layer.feature.properties.selectionId){t.selectionManager.clear();let f=[d.layer.feature.properties.selectionId];const m=d.layer.feature.properties.selectionId;null!=t.selectedIds&&t.selectedIds.length>0&&p(m,t.selectedIds[0])?(t.selectionManager.clear(),f=[]):((d.originalEvent.ctrlKey||d.originalEvent.shiftKey)&&(f=t.selectedIds.concat(f)),f=function(t){t.concat();for(let e=0;e<t.length;++e)for(let i=e+1;i<t.length;++i)t[e]===t[i]&&t.splice(i--,1);return t}(f),t.selectionManager.select(f,d.originalEvent.ctrlKey||d.originalEvent.shiftKey)),t.clickEvents.clickHandler(f,!0,t,!1),0==f.length&&(f=null),t.selectedIds=f,(new a).renderVectorTileLayer(t,e,i,r,n,o,s,l,c,!1,u,h)}})),t.vectorTilesLayerGroup.on("contextmenu",(function(e){null!=e.layer.feature.properties.selectionId&&t.selectionManager.showContextMenu(e.layer.feature.properties.selectionId,{x:e.originalEvent.clientX,y:e.originalEvent.clientY})}))}updateTransparency(t,e,i,r,n,o){if(n&&(null!=e&&e.highlighted?(i=t.interactivity.selectedTransparency,r=t.interactivity.selectedTransparency):(i=t.interactivity.unSelectedTransparency,r=t.interactivity.unSelectedTransparency)),null!=o&&o.length>0){const n=new Set(o.map((t=>JSON.stringify(t)))),s=!!e&&n.has(JSON.stringify(e.selectionId));i=s?t.interactivity.selectedTransparency:t.interactivity.unSelectedTransparency,r=s?t.interactivity.selectedTransparency:t.interactivity.unSelectedTransparency}return{fillTransparency:i=(100-i)/100,outlineTransparency:r=(100-r)/100}}returnVectorTileURL(t,e){let i;switch(e){case 0:default:i=t.vectorTileConfiguration.vectorTileURL1;break;case 1:i=t.vectorTileConfiguration.vectorTileURL2;break;case 2:i=t.vectorTileConfiguration.vectorTileURL3;break;case 3:i=t.vectorTileConfiguration.vectorTileURL4;break;case 4:i=t.vectorTileConfiguration.vectorTileURL5}return i}returnPropertyKey(t,e){let i;switch(e){case 0:default:i=t.vectorTileConfiguration.propertyToMatch1;break;case 1:i=t.vectorTileConfiguration.propertyToMatch2;break;case 2:i=t.vectorTileConfiguration.propertyToMatch3;break;case 3:i=t.vectorTileConfiguration.propertyToMatch4;break;case 4:i=t.vectorTileConfiguration.propertyToMatch5}return i}renderVectorTileLayer(t,e,i,r,a,l,c,u,h,p,d,f){const m=this.returnVectorTileURL(e,f);if(!e.vectorTileConfiguration.includeVectorTileLayer||null==m||""==m)return void(null!=t.vectorTilesLayerGroup&&(t.map.removeLayer(t.vectorTilesLayerGroup),t.map.removeLayer(t.vectorTilesLabelLayerGroup),t.vectorTilesLayerGroup=null,t.vectorTilesLabelLayerGroup=null));const g=this.returnVectorDataPoints(t,e,r,a,l,c,u,h),_=!e.vectorTileConfiguration.matchSpecificProperty,y=this.returnPropertyKey(e,f),A=e.vectorTileConfiguration.tooltipForUnmatched,v=this.determineFormatting,x=this.generateTooltip,b=this.createLabel,w=[],S=this.updateTransparency,T=t.selectionManager.getSelectionIds(),C={style:function(t){let i=!1,n=null;if(_&&t.properties){const e=new Set(Object.values(t.properties));for(const t of g)if(e.has(t.reference)){i=!0,n=t;break}}!_&&""!=y&&t.properties&&null!=t.properties[y]&&(n=g.find((e=>e.reference==t.properties[y])),i=null!=n);let o=e.vectorTileFormatting.unmatched_fillColor,a=e.vectorTileFormatting.unmatched_outlineColor,l=e.vectorTileFormatting.unmatched_fillTransparency,c=e.vectorTileFormatting.unmatched_outlineTransparency,u=e.vectorTileFormatting.unmatched_dashArray,h=e.vectorTileFormatting.unmatched_outlineWidth;if(i){const i=v(e,r,n.point);({fillColor:o,outlineColor:a,fillTransparency:l,outlineTransparency:c,dashArray:u,outlineWidth:h}=i);const p=s(r,n.point,"vectorTileConfiguration","includeTooltip",e.vectorTileConfiguration.includeTooltip);"TRUE"!==p.toUpperCase()&&"YES"!==p.toUpperCase()||x(r,n,t,d,e),t.properties.selectionId=n.selectionId}else A&&x(r,null,t,d,e);const f=S(e,n,l,c,p,T);return{fillColor:o,fillOpacity:f.fillTransparency,color:a,opacity:f.outlineTransparency,weight:h,dashArray:u,radius:2}}};for(const i of g)null!=b(t,r,i.point,i.selectionId,e,i)&&w.push();null!=t.vectorTilesLayerGroup&&(t.map.removeLayer(t.vectorTilesLayerGroup),t.map.removeLayer(t.vectorTilesLabelLayerGroup),t.vectorTilesLayerGroup=null,t.vectorTilesLabelLayerGroup=null);const M=(0,o.Ay)(m,C);t.vectorTilesLayerGroup=M,t.map.addLayer(t.vectorTilesLayerGroup);const E=n.layerGroup(w);t.vectorTilesLabelLayerGroup=E,t.map.addLayer(t.vectorTilesLabelLayerGroup),this.addTooltipEvents(t),this.addClickEvents(t,e,i,r,a,l,c,u,h,d,f)}checkCrossHighlighting(t,e,i){let r=!1;null!=e&&(r=e.highlights?.some((t=>null!==t)));let n=!1;null!=t&&(n=t.highlights?.some((t=>null!==t)));let o=!1;return null!=i&&(o=i.highlights?.some((t=>null!==t))),!!(r||n||o)}determineDrilldownLevel(t){const e=t.dataViews[0].categorical;let i=0;if(null!=e.categories)for(let t=0;t<e.categories.length;t++)1==e.categories[t].source.roles.category&&(i=t);return i}getFeatureRefIndices(t){return t.dataViews[0].categorical.values.reduce(((t,e,i)=>(e&&e.source&&e.source.roles&&e.source.roles.featureRef&&t.push(i),t)),[])}getReferenceField(t,e){let i;const r=this.getFeatureRefIndices(t);return 1==r.length?i=t.dataViews[0].categorical.values[r[0]]:r.length>1&&null!=r[e]&&(i=t.dataViews[0].categorical.values[r[e]]),i}setupVectorTilesLayer(t,e,i,r,n,o,s,a,l,c,u,h){const p=this.determineDrilldownLevel(i);u=this.getReferenceField(i,p);const d=this.checkCrossHighlighting(l,u,c);this.renderVectorTileLayer(e,t,i.dataViews[0].categorical.categories[0].values,i.dataViews[0].categorical.categories[0],n,o,s,a,u,d,h,p)}}},83034:(t,e,i)=>{"use strict";i.d(e,{U:()=>s});var r=i(53481),n=(i(23612),i(40080));function o(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}i(41180);class s{determineConfiguration(t,e,i){const r=t.wktConfiguration.includeInZoom,n=t.wktConfiguration.imageAtDestination,s=t.wktConfiguration.imageRotation,a=t.wktConfiguration.includeTooltip,l=t.wktConfiguration.allowSelection,c=t.wktConfiguration.imageWidth,u=t.wktConfiguration.imageHeight,h=t.wktConfiguration.pointSize,p=o(e,i,"wktConfiguration","imageAtDestination",n),d=o(e,i,"wktConfiguration","imageRotation",s),f=o(e,i,"wktConfiguration","includeInZoom",r),m=o(e,i,"wktConfiguration","includeTooltip",a),g=o(e,i,"wktConfiguration","allowSelection",l);return{includeInZoom:f,includeTooltip:m,imageAtDestination:p,imageRotation:d,imageWidth:o(e,i,"wktConfiguration","imageWidth",c),imageHeight:o(e,i,"wktConfiguration","imageHeight",u),allowSelection:g,pointSize:o(e,i,"wktConfiguration","pointSize",h)}}determineFormatting(t,e,i){const r={solid:{color:t.wktFormatting.fillColor}},n={solid:{color:t.wktFormatting.outlineColor}},s=t.wktFormatting.outlineTransparency,a=t.wktFormatting.fillTransparency,l=t.wktFormatting.dashArray,c=t.wktFormatting.outlineWidth,u=t.wktFormatting.fillStyle,h=t.wktFormatting.hatchAngle,p=t.wktFormatting.hatchWidth,d=o(e,i,"wktFormatting","fillColor",r).solid.color,f=o(e,i,"wktFormatting","outlineColor",n).solid.color;let m=o(e,i,"wktFormatting","fillTransparency",a),g=o(e,i,"wktFormatting","outlineTransparency",s);return g=(100-g)/100,m=(100-m)/100,{fillColor:d,outlineColor:f,fillTransparency:m,borderTransparency:g,dashArray:o(e,i,"wktFormatting","dashArray",l),fillStyle:o(e,i,"wktFormatting","fillStyle",u),hatchAngle:o(e,i,"wktFormatting","hatchAngle",h),hatchWidth:o(e,i,"wktFormatting","hatchWidth",p),borderWidth:o(e,i,"wktFormatting","outlineWidth",c)}}isWKTRow(t,e,i,r){return!(null!=t&&null!=t.values[r]||null!=e&&null!=e.values[r]||null==i||null==i.values[r])}isWKT(t){return t.length>=18&&"GEOMETRYCOLLECTION"==t.substring(0,18)||t.length>=8&&"TRIANGLE"==t.substring(0,8)||t.length>=5&&"POINT"==t.substring(0,5)||t.length>=10&&"MULTIPOINT"==t.substring(0,10)||t.length>=7&&"POLYGON"==t.substring(0,7)||t.length>=15&&"MULTILINESTRING"==t.substring(0,15)||t.length>=10&&"LINESTRING"==t.substring(0,10)||t.length>=12&&"MULTIPOLYGON"==t.substring(0,12)}fixWKT(t){let e=t.toUpperCase();return e=e.replace("\n","").replace("\r","").replace("\t",""),e=e.replace(/POLYGON\(/g,"POLYGON ("),e=e.replace(/TRIANGLE\(/g,"TRIANGLE ("),e=e.replace(/POINT\(/g,"POINT ("),e=e.replace(/MULTIPOINT\(/g,"MULTIPOINT ("),e=e.replace(/GEOMETRYCOLLECTION\(/g,"GEOMETRYCOLLECTION ("),e=e.replace(/MULTILINESTRING\(/g,"MULTILINESTRING ("),e=e.replace(/LINESTRING\(/g,"LINESTRING ("),e=e.replace(/MULTIPOLYGON\(/g,"MULTIPOLYGON ("),e=e.replace(/\( /g,"("),e}processWKTStyle(t,e,i,n,o){let s;const a=i.pointSize;if("HATCHED"==e.fillStyle.toUpperCase()){const t={weight:e.hatchWidth,color:e.fillColor,angle:e.hatchAngle};s=new r.StripePattern(t),s.addTo(n.map)}return t.properties.selectionId=null,t.properties.pointId=o,"point"==t.geometry.type.toLowerCase()||"multipoint"==t.geometry.type.toLowerCase()?"HATCHED"==e.fillStyle.toUpperCase()?{fillPattern:s,radius:a,dashArray:e.dashArray,weight:e.borderWidth,color:e.outlineColor,fillColor:e.fillColor,fillOpacity:e.fillTransparency,opacity:e.borderTransparency}:{radius:a,dashArray:e.dashArray,weight:e.borderWidth,color:e.outlineColor,fillColor:e.fillColor,fillOpacity:e.fillTransparency,opacity:e.borderTransparency}:"HATCHED"==e.fillStyle.toUpperCase()?{fillPattern:s,dashArray:e.dashArray,weight:e.borderWidth,color:e.outlineColor,fillColor:e.fillColor,fillOpacity:e.fillTransparency,opacity:e.borderTransparency}:{dashArray:e.dashArray,weight:e.borderWidth,color:e.outlineColor,fillColor:e.fillColor,fillOpacity:e.fillTransparency,opacity:e.borderTransparency}}addImageAtLastPoint(t,e,i,n,o,s,a){const l="MultiLineString"===t.type?new r.LatLng(t.coordinates[0][t.coordinates[0].length-1][1],t.coordinates[0][t.coordinates[0].length-1][0]):new r.LatLng(t.coordinates[t.coordinates.length-1][1],t.coordinates[t.coordinates.length-1][0]),c=r.icon({iconUrl:e.imageAtDestination,iconSize:[e.imageWidth,e.imageHeight],iconAnchor:[+e.imageWidth/2+0,+e.imageHeight/2]}),u=new r.Marker([l.lat,l.lng],{icon:c,rotationAngle:e.imageRotation,opacity:i.fillTransparency,riseOnHover:!0}),h=n.host.createSelectionIdBuilder().withCategory(s,o).createSelectionId();return n.clickEvents.addClickEvent(h,u,n),"TRUE"!==e.includeTooltip.toUpperCase()&&"YES"!==e.includeTooltip.toUpperCase()||n.tooltips.generateTooltip(s,null,o,u,a,n),u}processWKT(t,e,i,n,o,s,a,l,c){const u=this.processWKTStyle,h=this.addImageAtLastPoint,p={pointToLayer:function(t,e){return r.circleMarker(e)},style:function(t){return u(t,i,n,o,s)},onEachFeature:function(e,u){const p=o.host.createSelectionIdBuilder().withCategory(a,s).createSelectionId(),d=n.allowSelection.toUpperCase(),f=n.includeTooltip.toUpperCase(),m=n.includeInZoom.toUpperCase(),g="TRUE"===d||"YES"===d,_="TRUE"===f||"YES"===f,y="TRUE"===m||"YES"===m;if(null==e.properties&&(e.properties={}),e.properties.selectionId=p,""!==n.imageAtDestination&&("MultiLineString"===e.type||"LineString"===e.type)&&null!==e.coordinates&&e.coordinates.length>0){const r=h(e,n,i,o,s,a,l);t.push(r)}if(g&&o.clickEvents.addClickEvent(p,u,o),_&&o.tooltips.generateTooltip(a,null,s,u,l,o),y){let i,n;if(null!=e.geometry?n=e.geometry.coordinates:null!=e.geometries?(n=e.coordinates,n="Point"===e.geometries[0].type?e.geometries[0].coordinates:e.geometries[0].coordinates[0]):n=e.coordinates,null==r.latLngBounds(n).getSouthWest()){const t={lng:n[0],lat:n[1]};i=r.latLngBounds(t,t)}else{const t={lng:r.latLngBounds(n).getSouthWest().lat,lat:r.latLngBounds(n).getSouthWest().lng},e={lng:r.latLngBounds(n).getNorthEast().lat,lat:r.latLngBounds(n).getNorthEast().lng};i=r.latLngBounds(t,e)}e.properties.bounds=i,null==o.autoZoomBounds?o.autoZoomBounds=i:o.autoZoomBounds.extend(i);const l=o.labels.createLabel(a,s,u,null,c);null!=l&&void 0!==l&&t.push(l),o.noOfZoomableItems++}}};return t.push(r.geoJSON(e,p))}renderWktLayer(t,e,i,o,s,a,l,c){const u=t.length,h=[];for(let t=0;t<u;t++){let r=!1;if(this.isWKTRow(o,i,s,t)){let i,o="";null!=s&&null!=s.values[t]&&(o=s.values[t].toString()),null==o&&(o=""),""!=o&&(this.isWKT(o.toUpperCase())&&(o=o.toUpperCase()),"{"==o.charAt(0)&&(r=!0)),r?i=JSON.parse(o):(o=this.fixWKT(o),i=n(o));const u=this.determineFormatting(l,e,t),p=this.determineConfiguration(l,e,t);this.processWKT(h,i,u,p,c,t,e,a,l)}}null!=c.wktLayerGroup&&c.map.removeLayer(c.wktLayerGroup),c.wktLayerGroup=r.featureGroup(h),c.map.addLayer(c.wktLayerGroup)}setupWktLayer(t,e,i,r,n,o,s,a,l){this.renderWktLayer(r,n,o,s,a,l,t,e)}}},55584:(t,e,i)=>{"use strict";i.d(e,{L:()=>r}),i(91210);class r{getSlice_googleMaps_apiKey(t){return{uid:"googleMaps_apiKey",displayName:"Google Maps",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"googleMaps"},value:t.apiKeys.googleMaps,placeholder:""}}}}getSlice_mapTiler_apiKey(t){return{uid:"mapTiler_apiKey",displayName:"Map Tiler",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"mapTiler"},value:t.apiKeys.mapTiler,placeholder:""}}}}getSlice_mapbox_apiKey(t){return{uid:"mapbox_apiKey",displayName:"Mapbox",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"mapbox"},value:t.apiKeys.mapbox,placeholder:""}}}}getSlice_azureMaps_apiKey(t){return{uid:"azureMaps_apiKey",displayName:"Azure Maps",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"azureMaps"},value:t.apiKeys.azureMaps,placeholder:""}}}}getSlice_esri_apiKey(t){return{uid:"esri_apiKey",displayName:"ArcGIS Online",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"esri"},value:t.apiKeys.esri,placeholder:""}}}}getSlice_openWeatherMap_apiKey(t){return{uid:"openWeatherMap_apiKey",displayName:"Open Weather Map",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"openWeatherMap"},value:t.apiKeys.openWeatherMap,placeholder:""}}}}getSlice_ordnanceSurvey_apiKey(t){return{uid:"ordnanceSurvey_apiKey",displayName:"Ordnance Survey",control:{type:"TextInput",properties:{descriptor:{objectName:"apiKeys",propertyName:"ordnanceSurvey"},value:t.apiKeys.ordnanceSurvey,placeholder:""}}}}getSlice_apiKey_note(){return{uid:"apiKeys_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"apiKeys",propertyName:"note"},value:"Enabling certain map features requires third party API Keys to be entered. When such a feature is enabled, the required keys can be entered here."}}}}getGroup_apiKeys(t){const e={displayName:"API Keys",uid:"group_apikeys",slices:[]};return e.slices.push(this.getSlice_esri_apiKey(t)),e.slices.push(this.getSlice_azureMaps_apiKey(t)),e.slices.push(this.getSlice_mapbox_apiKey(t)),e.slices.push(this.getSlice_googleMaps_apiKey(t)),e.slices.push(this.getSlice_mapTiler_apiKey(t)),e.slices.push(this.getSlice_ordnanceSurvey_apiKey(t)),e.slices.push(this.getSlice_openWeatherMap_apiKey(t)),e}getCard_apiKeys(t){const e={displayName:"API Keys",suppressDisplayName:!0,uid:"apikeys_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_apiKeys(t);return e.groups.push(i),e}}},61790:(t,e,i)=>{"use strict";i.d(e,{V:()=>m}),i(91210);var r=i(581),n=i(50480),o=i(85645),s=i(24220),a=i(57986),l=i(22105),c=i(93814),u=i(77567),h=i(62576),p=i(44401),d=i(14447),f=i(89276);class m{createReadOnlyTextSlice(t,e){return{uid:t,displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"background",propertyName:t},value:e}}}}getSlice_background_mapSource_dropdown(t){return{uid:"background_mapSource_dropdown",displayName:"Background map source",control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"mapSource"},value:t.background.mapSource}}}}getGroup_background_mapSource(t){return{displayName:"Map Source",uid:"group_background_mapSource",slices:[this.getSlice_background_mapSource_dropdown(t)]}}getSlice_background_grayscale_slider(t){return{uid:"background_grayscale_slider",displayName:"Grayscale",control:{type:"Slider",properties:{descriptor:{objectName:"background",propertyName:"grayscale"},value:t.background.grayscale}}}}getSlice_background_transparency_slider(t){return{uid:"background_transparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"background",propertyName:"transparency"},value:t.background.transparency}}}}getGroup_background_tileFormatting(t){const e=this.getSlice_background_grayscale_slider(t),i=this.getSlice_background_transparency_slider(t),r={displayName:"Tile Formatting",uid:"group_background_tileFormatting",slices:[]};return("openStreetMap"==t.background.mapSource||"ordnanceSurvey"==t.background.mapSource||"azureMaps"==t.background.mapSource||"wms"==t.background.mapSource||"raster"==t.background.mapSource||"mapbox"==t.background.mapSource&&"raster"==t.background.mapboxSource)&&r.slices.push(e),r.slices.push(i),r}getCard_background(t,e){const i={description:"Background Layer",displayName:"Background Layer",suppressDisplayName:!0,uid:"background_uid",groups:[],revertToDefaultDescriptors:[{objectName:"background",propertyName:"grayscale"},{objectName:"background",propertyName:"transparency"},{objectName:"background",propertyName:"mapSource"}]},m=this.getGroup_background_mapSource(t);if(i.groups.push(m),"openStreetMap"===t.background.mapSource){const e=(new c.Q).getGroup_background_openStreetMapSource(t),r=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(r)}if("ordnanceSurvey"===t.background.mapSource){const e=(new u.j).getGroup_background_ordnanceSurveySource(t),r=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(r)}if("mapbox"===t.background.mapSource){const e=(new a.U).getGroup_background_mapboxSource(t),r=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(r)}if("azureMaps"===t.background.mapSource){const e=(new r.p).getGroup_background_azureMaps(t),n=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(n)}if("googleMaps"===t.background.mapSource){const e=(new o.h).getGroup_background_googleMapsSource(t),r=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(r)}if("esri"===t.background.mapSource){const e=(new n.s).getGroup_background_ESRI(t),r=this.getGroup_background_tileFormatting(t);i.groups.push(e),i.groups.push(r)}if("mapTiler"===t.background.mapSource){const e=(new l.p).getGroup_background_mapTiler(t);i.groups.push(e)}if("vector"===t.background.mapSource){const e=(new p.R).getGroup_background_vectorTiles(t);i.groups.push(e),i.groups.push(this.getGroup_background_tileFormatting(t))}if("raster"===t.background.mapSource){const e=(new d.P).getGroup_background_rasterTiles(t);i.groups.push(e),i.groups.push(this.getGroup_background_tileFormatting(t))}if("image"===t.background.mapSource){const e=(new s._).getGroup_background_image(t);i.groups.push(e)}if("wms"===t.background.mapSource){const e=new h.C,r=this.getGroup_background_tileFormatting(t),n=e.getGroup_background_wms(t);i.groups.push(n),i.groups.push(r)}if("iconMap"===t.background.mapSource){const r=new f.N;i.groups.push(r.getGroup_background_iconMap(t,e)),i.groups.push(this.getGroup_background_tileFormatting(t))}return i}}},581:(t,e,i)=>{"use strict";i.d(e,{p:()=>r}),i(91210);class r{getSlice_background_azureMapsStyle_dropdown(t){return{uid:"background_azureMapsStyle_dropdown",displayName:"Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"azureMapsStyle"},value:t.background.azureMapsStyle}}}}getSlice_background_azureMapsLanguage_dropdown(t){return{uid:"background_azureMapsLanguage_dropdown",displayName:"Language",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"azureMapsLanguage"},value:t.background.azureMapsLanguage}}}}getSlice_background_azureMapsAuthenticationType_dropdown(t){return{uid:"background_azureMapsAuthenticationType_dropdown",displayName:"Authentication Method",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"azureMapsAuthenticationType"},value:t.background.azureMapsAuthenticationType}}}}getSlice_background_azureMapsLabels_dropdown(t){return{uid:"background_azureMapsLabels_dropdown",displayName:"Labels",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"azureMapsLabels"},value:t.background.azureMapsLabels}}}}getSlice_background_azureMapsAPIKey_text(t){return{uid:"background_azureMapsAPIKey_text",displayName:"API Key",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"azureMapsAPIKey"},placeholder:"",value:t.background.azureMapsAPIKey}}}}getSlice_background_azureMapsHillShade_bool(t){return{uid:"background_azureMapsHillShade_bool",displayName:"Hill Shading",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"background",propertyName:"azureMapsHillShade"},value:t.background.azureMapsHillShade}}}}getSlice_background_azureMapsClientID_text(t){return{uid:"background_azureMapsClientID_text",displayName:"Azure AD Client ID",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"azureMapsClientID"},placeholder:"",value:t.background.azureMapsClientID}}}}getGroup_background_azureMaps(t){const e=this.getSlice_background_azureMapsStyle_dropdown(t),i=this.getSlice_background_azureMapsLanguage_dropdown(t),r=this.getSlice_background_azureMapsHillShade_bool(t),n=this.getSlice_background_azureMapsAuthenticationType_dropdown(t),o=this.getSlice_background_azureMapsLabels_dropdown(t),s={displayName:"Azure Maps Configuration",uid:"group_backgroundazureMapsStyle",slices:[e]};if("microsoft.base.road"==t.background.azureMapsStyle&&s.slices.push(r),"microsoft.imagery"==t.background.azureMapsStyle&&s.slices.push(o),s.slices.push(i),s.slices.push(n),"subscriptionKey"===t.background.azureMapsAuthenticationType);else{const e=this.getSlice_background_azureMapsClientID_text(t);s.slices.push(e)}return s}}},50480:(t,e,i)=>{"use strict";i.d(e,{s:()=>r}),i(91210);class r{getSlice_background_esriSource_dropdown(t){return{uid:"background_esriSource_dropdown",displayName:"ArcGIS Tiles Type",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"esriSource"},value:t.background.esriSource}}}}getSlice_background_esriLanguage_dropdown(t){return{uid:"background_esriLanguage_dropdown",displayName:"Language",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"esriLanguage"},value:t.background.esriLanguage}}}}getSlice_background_esriArcGISStyle_dropdown(t){return{uid:"background_esriArcGISStyle_dropdown",displayName:"ArcGIS Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"esriArcGISStyle"},value:t.background.esriArcGISStyle}}}}getSlice_background_esriOSMStyle_dropdown(t){return{uid:"background_esriOSMStyle_dropdown",displayName:"OSM Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"esriOSMStyle"},value:t.background.esriOSMStyle}}}}getSlice_background_esriCustomStyleURL_text(t){return{uid:"background_esriCustomStyleURL_text",displayName:"ArcGIS Item ID",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"esriCustomStyleURL"},placeholder:"",value:t.background.esriCustomStyleURL}}}}getSlice_esri_note(){return{uid:"esri_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"esri",propertyName:"note"},value:"Enter the ArcGIS API Key in the API Keys section."}}}}getGroup_background_ESRI(t){const e=this.getSlice_background_esriSource_dropdown(t),i=this.getSlice_background_esriArcGISStyle_dropdown(t),r=this.getSlice_background_esriOSMStyle_dropdown(t),n=this.getSlice_background_esriLanguage_dropdown(t),o=this.getSlice_background_esriCustomStyleURL_text(t),s={displayName:"ESRI Configuration",uid:"group_background_esriConfiguration",slices:[]};switch(""==t.apiKeys.esri&&s.slices.push(this.getSlice_esri_note()),s.slices.push(e),t.background.esriSource){case"osm":s.slices.push(r);break;case"custom":s.slices.push(o);break;default:s.slices.push(i)}return s.slices.push(n),s}}},85645:(t,e,i)=>{"use strict";i.d(e,{h:()=>r}),i(91210);class r{getSlice_background_googleMapsSource_dropdown(t){return{uid:"background_googleMapsSource_dropdown",displayName:"Google Maps Configuration",suppressDisplayName:!0,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"googleMapsSource"},value:t.background.googleMapsSource}}}}getSlice_background_googleMapsAPIKey_text(t){return{uid:"overlays_traffic_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"overlays",propertyName:"note"},value:t}}}}getGroup_background_googleMapsSource(t){const e={displayName:"Google Maps Configuration",uid:"group_background_googleMapsSource",slices:[this.getSlice_background_googleMapsSource_dropdown(t)]};return""===t.apiKeys.googleMaps&&e.slices.push(this.getSlice_background_googleMapsAPIKey_text("Please configure the Google Maps API key in the API Keys section of the formatting pane.")),e}}},89276:(t,e,i)=>{"use strict";i.d(e,{N:()=>o}),i(91210);var r=i(38170),n=i.n(r);class o{getSlice_background_iconMapTilesStyle(t,e){const i=[];try{if(!e.iconMapStyles){const t="https://api.iconmappro.com/api/styles.json?v="+e.visualGUID+"&i="+e.instanceID,i=n()("GET",t),r=JSON.parse(i.getBody("utf8"));e.iconMapStyles=r.styles}const t=e.iconMapStyles.filter((t=>"background"===t.type));for(let e=0;e<t.length;e++)i.push({value:'{"url":"'+t[e].url+'", "attribution":"'+t[e].attribution+'", "thumbnail":"'+t[e].thumbnail+'"}',displayName:t[e].name})}catch(t){console.error(t)}let r=i.findIndex((e=>e.value===t.background.iconMapStyle));return-1===r&&(r=0),{uid:"background_wmsLayer_dropdown",displayName:"Layer",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"iconMapStyle"},value:i[r],items:i}}}}getGroup_background_iconMap(t,e){return{displayName:"Icon Map Tiles Configuration",uid:"group_background_iconMapTiles",slices:[this.getSlice_background_iconMapTilesStyle(t,e)]}}}},24220:(t,e,i)=>{"use strict";i.d(e,{_:()=>r}),i(91210);class r{getSlice_background_imageURL_text(t){return{uid:"background_imageURL_text",displayName:"ImageURL",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"imageURL"},value:t.background.imageURL,placeholder:""}}}}getGroup_background_image(t){const e=this.getSlice_background_imageURL_text(t),i={displayName:"Image Configuration",uid:"group_background_imageConfiguration",slices:[]};return i.slices.push(e),i}}},22105:(t,e,i)=>{"use strict";i.d(e,{p:()=>r}),i(91210);class r{getSlice_background_mapTilerSource_dropdown(t){return{uid:"background_mapTilerSource_dropdown",displayName:"Map Source",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"mapTilerSource"},value:t.background.mapTilerSource}}}}getSlice_background_mapTilerTileset_dropdown(t){return{uid:"background_mapTilerTileset_dropdown",displayName:"Map",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"mapTilerTileset"},value:t.background.mapTilerTileset}}}}getSlice_background_mapTilerAPIKey_text(t){return{uid:"background_googleMapsAPIKey_text",displayName:"API Key",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"mapTilerAPIKey"},placeholder:"",value:t.background.mapTilerAPIKey}}}}getSlice_background_mapTilerTilesetId_text(t){return{uid:"background_mapTilerTilesetId_text",displayName:"Custom Tileset ID",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"mapTilerTilesetId"},placeholder:"",value:t.background.mapTilerTilesetId}}}}getGroup_background_mapTiler(t){const e={displayName:"Map Tiler Configuration",uid:"group_background_mapTiler",slices:[this.getSlice_background_mapTilerSource_dropdown(t)]};if("standard"===t.background.mapTilerSource){const i=this.getSlice_background_mapTilerTileset_dropdown(t);e.slices.push(i)}if("customTiles"===t.background.mapTilerSource){const i=this.getSlice_background_mapTilerTilesetId_text(t);e.slices.push(i)}return e}}},57986:(t,e,i)=>{"use strict";i.d(e,{U:()=>n});var r=i(91431);class n{formattingHelpers;mapboxStyles(t){const e=[];return"vector"==t.background.mapboxSource&&e.push({value:"standard",displayName:"Standard"}),e.push({value:"streets",displayName:"Streets"}),e.push({value:"outdoors",displayName:"Outdoors"}),e.push({value:"light",displayName:"Light"}),e.push({value:"dark",displayName:"Dark"}),e.push({value:"satellite",displayName:"Satellite"}),e.push({value:"satelliteStreets",displayName:"Satellite Streets"}),e.push({value:"navigationDay",displayName:"Navigation Day"}),e.push({value:"navigationNight",displayName:"Navigation Night"}),e}getGroup_background_mapboxSource(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"Mapbox Configuration",uid:"group_background_mapboxSource",slices:[this.formattingHelpers.createDropdownSlice("background_mapboxSource_dropdown","Tiles type","background","mapboxSource",t.background.mapboxSource,!1)]};return"mapboxStudio"!==t.background.mapboxSource?e.slices.push(this.formattingHelpers.createDropdownSliceFromList("background_mapboxStyle_dropdown","Style","background","mapboxStyle",t.background.mapboxStyle,this.mapboxStyles(t),!1)):e.slices.push(this.formattingHelpers.createTextInputSlice("background_mapboxStyleURL_text","Style URL","background","mapboxStyleURL",t.background.mapboxStyleURL,!1)),e}}},93814:(t,e,i)=>{"use strict";i.d(e,{Q:()=>r}),i(91210);class r{getSlice_background_openStreetMapSource_dropdown(t){return{uid:"background_openStreetMapSource_dropdown",displayName:"OpenStreetMap Configuration",suppressDisplayName:!0,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"openStreetMapSource"},value:t.background.openStreetMapSource}}}}getSlice_background_note_note(){return{uid:"background_osm_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"background",propertyName:"note"},value:"Please refer to the Icon Map Pro documentation for usage policies"}}}}getGroup_background_openStreetMapSource(t){return{displayName:"OpenStreetMap Configuration",uid:"group_background_openStreetMapSource",slices:[this.getSlice_background_openStreetMapSource_dropdown(t),this.getSlice_background_note_note()]}}}},77567:(t,e,i)=>{"use strict";i.d(e,{j:()=>r}),i(91210);class r{getSlice_background_ordnanceSurveyProjection_dropdown(t){return{uid:"background_ordnanceSurveyProjection_dropdown",displayName:"Projection",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"ordnanceSurveyProjection"},value:t.background.ordnanceSurveyProjection}}}}getSlice_background_ordnanceSurveySource_dropdown(t){return{uid:"background_ordnanceSurveySource_dropdown",displayName:"Map Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"ordnanceSurveySource"},value:t.background.ordnanceSurveySource}}}}getSlice_background_ordnanceSurveyNote_note(){return{uid:"background_ordnanceSurveyNote_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"background",propertyName:"ordnanceSurveyNote"},value:"*(1) Map style not available in EPSG:3857"}}}}getSlice_background_ordnanceSurveyNote_note2(){return{uid:"background_ordnanceSurveyNote_note2",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"background",propertyName:"ordnanceSurveyNote"},value:"*(2) Map style not available in EPSG:27700"}}}}getSlice_background_ordnanceSurveyAPIKey_text(t){return{uid:"background_ordnanceSurveyAPIKey_text",displayName:"API Key",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"ordnanceSurveyAPIKey"},placeholder:"",value:t.background.ordnanceSurveyAPIKey}}}}getGroup_background_ordnanceSurveySource(t){return{displayName:"Ordnance Survey Configuration",uid:"group_background_ordnanceSurveySource",slices:[this.getSlice_background_ordnanceSurveySource_dropdown(t)]}}}},14447:(t,e,i)=>{"use strict";i.d(e,{P:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_background_rasterTiles(t){return null==this.formattingHelpers&&(this.formattingHelpers=new r.t),{displayName:"Raster Tiles Configuration",uid:"group_background_rasterTiles",slices:[this.formattingHelpers.createTextInputSlice("background_rasterTilesURL_text","URL template for tile server","background","rasterTilesURL",t.background.rasterTilesURL,!0)]}}}},44401:(t,e,i)=>{"use strict";i.d(e,{R:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_background_vectorTiles(t){return null==this.formattingHelpers&&(this.formattingHelpers=new r.t),{displayName:"Vector Tiles Configuration",uid:"group_background_vectorTiles",slices:[this.formattingHelpers.createTextInputSlice("background_vectorTilesURL_text","URL of the style JSON file","background","vectorTilesURL",t.background.vectorTilesURL,!0)]}}}},62576:(t,e,i)=>{"use strict";i.d(e,{C:()=>r}),i(91210);class r{wmsGetCapabilities="";createReadOnlyTextSlice(t,e){return{uid:t,displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"background",propertyName:t},value:e}}}}getSlice_background_wmsURL_text(t){return{uid:"background_wmsURL_text",displayName:"WMS Server URL",control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"wmsURL"},placeholder:"",value:t.background.wmsURL}}}}getSlice_background_wmsLayer_dropdown(t){function e(t){const e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}const i=[];try{this.wmsGetCapabilities=function(i){let r=e(i);const n=new DOMParser;let o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer");if(0==s.length){const i=new URL(t.background.wmsURL),a=i.searchParams;a.delete("request"),a.append("request","GetCapabilities");const l=i.toString();if(r=e(l),o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer"),0==s.length){a.delete("service"),a.append("service","wms");const l=i.toString();r=e(l),o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer"),s.length>0&&(t.background.wmsURL=l)}else t.background.wmsURL=l}return r}(t.background.wmsURL);!function t(e,r){const n=e.querySelector("Name"),o=e.querySelector("Title");if(n){const t="".repeat(r);o?i.push({value:n.textContent,displayName:`${t}${o.textContent}`}):i.push({value:n.textContent,displayName:`${t}${n.textContent}`})}e.querySelectorAll(":scope > Layer").forEach((e=>t(e,r+1)))}((new DOMParser).parseFromString(this.wmsGetCapabilities,"text/xml").getElementsByTagName("Layer")[0],0)}catch(t){console.error(t)}const r=i.findIndex((e=>e.value===t.background.wmsLayer));return{uid:"background_wmsLayer_dropdown",displayName:"Layer",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"wmsLayer"},value:i[r],items:i}}}}getSlice_background_wmsLayer_text(t){return{uid:"background_wmsLayer_text",displayName:"Layer",suppressDisplayName:!1,control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"wmsLayer"},value:t.background.wmsLayer,placeholder:""}}}}getSlice_background_wmsCRS_dropdown(t){const e=t.background.wmsLayer,i=[],r=(new DOMParser).parseFromString(this.wmsGetCapabilities,"text/xml").getElementsByTagName("Layer");function n(t){const e=t.getElementsByTagName("CRS");return e.length>0?Array.from(e):t.parentNode&&t.parentNode.nodeType===Node.ELEMENT_NODE?n(t.parentNode):null}for(let t=0;t<r.length;t++){let o=null;for(let e=0;e<r[t].childNodes.length;e++)"Name"===r[t].childNodes[e].nodeName&&(o=r[t].childNodes[e]);if(o&&o.textContent===e){const e=n(r[t]);if(e)for(let t=0;t<e.length;t++)i.push({displayName:e[t].textContent,value:e[t].textContent});break}}const o=i.findIndex((e=>e.value===t.background.wmsCRS));return{uid:"background_wmsCRS_dropdown",displayName:"CRS",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"wmsCRS"},value:i[o],items:i}}}}getSlice_background_wmsCRS_manual(t){return{uid:"background_wmsCRS_dropdown",displayName:"CRS",suppressDisplayName:!1,control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"wmsCRS"},value:t.background.wmsCRS,placeholder:"EPSG:3857"}}}}getSlice_background_wmsFormat_text(t){return{uid:"background_wmsFormaty_text",displayName:"Format",suppressDisplayName:!1,control:{type:"TextInput",properties:{descriptor:{objectName:"background",propertyName:"wmsFormat"},value:t.background.wmsFormat,placeholder:"image/png"}}}}getSlice_background_wmsFormat_dropdown(t){const e=[];try{const t=(new DOMParser).parseFromString(this.wmsGetCapabilities,"text/xml").getElementsByTagName("GetMap")[0];if(t){const i=t.getElementsByTagName("Format");for(let t=0;t<i.length;t++)"image/png"!=i[t].textContent&&"image/jpeg"!=i[t].textContent&&"image/svg+xml"!=i[t].textContent&&"image/vnd.jpeg-png"!=i[t].textContent||e.push({value:i[t].textContent,displayName:i[t].textContent})}}catch(t){console.error(t)}const i=e.findIndex((e=>e.value===t.background.wmsFormat));return{uid:"background_wmsFormaty_dropdown",displayName:"Format",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"background",propertyName:"wmsFormat"},value:e[i],items:e}}}}getSlice_background_wmsBoundingBox_toggle(t){return{uid:"background_wmsPushToBounds_toggle",displayName:"Update Map Bounds",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"map",propertyName:"wmsPushToBounds"},value:t.map.wmsPushToBounds}}}}getSlice_background_wmsManual_toggle(t){return{uid:"background_wmsManual_toggle",displayName:"Manual configuration",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"background",propertyName:"wmsManual"},value:t.background.wmsManual}}}}getGroup_background_wms(t){const e={displayName:"WMS Configuration",uid:"group_background_wmsConfiguration",slices:[]},i=this.getSlice_background_wmsURL_text(t);e.slices.push(i);const r=this.getSlice_background_wmsManual_toggle(t);if(e.slices.push(r),t.background.wmsManual){const i=this.getSlice_background_wmsLayer_text(t);e.slices.push(i);const r=this.getSlice_background_wmsCRS_manual(t);e.slices.push(r);const n=this.getSlice_background_wmsFormat_text(t);e.slices.push(n)}else{if(""!=t.background.wmsURL){const i=this.getSlice_background_wmsLayer_dropdown(t);e.slices.push(i)}else{const t=this.createReadOnlyTextSlice("wms_need_url","Enter a valid WMS URL. The URL should start https:// and contain a GetCapabilities request.");e.slices.push(t)}if(""!=t.background.wmsURL&&""!=t.background.wmsLayer){const i=this.getSlice_background_wmsFormat_dropdown(t);e.slices.push(i);const r=this.getSlice_background_wmsBoundingBox_toggle(t);e.slices.push(r)}}return e}}},76564:(t,e,i)=>{"use strict";i.d(e,{H:()=>r}),i(91210);class r{getSlice_zoom_toggle(t){return{uid:"zoom_toggle",displayName:"Zoom",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"zoom"},value:t.controls.zoom}}}}getSlice_nauticScale_toggle(t){return{uid:"nauticScale_toggle",displayName:"Nautical Miles Scale",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"nauticScale"},value:t.controls.nauticScale}}}}getSlice_imperialscale_toggle(t){return{uid:"scale_toggle",displayName:"Imperial Scale",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"imperialScale"},value:t.controls.imperialScale}}}}getSlice_metricscale_toggle(t){return{uid:"metricscale_toggle",displayName:"Metric Scale",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"metricScale"},value:t.controls.metricScale}}}}getSlice_measureTool_toggle(t){return{uid:"measureTool_toggle",displayName:"Distance Tool",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"measureTool"},value:t.controls.measureTool}}}}getSlice_zoomLock_toggle(t){return{uid:"zoomLock_toggle",displayName:"Zoom Lock",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"zoomLock"},value:t.controls.zoomLock}}}}getSlice_lasso_toggle(t){return{uid:"lasso_toggle",displayName:"Lasso",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"controls",propertyName:"lasso"},value:t.controls.lasso}}}}getSlice_lasso_mode(t){return{uid:"lasso_mode",displayName:"Lasso Mode",control:{type:"Dropdown",properties:{descriptor:{objectName:"controls",propertyName:"lassoMode"},value:t.controls.lassoMode}}}}getSlice_lasso_fill(t){return{uid:"lasso_fill",displayName:"Lasso Fill",control:{type:"ColorPicker",properties:{descriptor:{objectName:"controls",propertyName:"lassoFill"},value:{value:t.controls.lassoFill}}}}}getSlice_lasso_outline(t){return{uid:"lasso_outline",displayName:"Lasso Outline",control:{type:"ColorPicker",properties:{descriptor:{objectName:"controls",propertyName:"lassoOutline"},value:{value:t.controls.lassoOutline}}}}}getSlice_controlSize_slider(t){return{uid:"controlSize_slider",displayName:"Control Size",control:{type:"Slider",properties:{descriptor:{objectName:"controls",propertyName:"controlSize"},options:{minValue:{type:0,value:1},maxValue:{type:1,value:100}},value:t.controls.controlSize}}}}getSlice_additionalAttribution_textbox(t){return{uid:"additionalAttribution_textbox",displayName:"Additional Attribution",control:{type:"TextInput",properties:{descriptor:{objectName:"controls",propertyName:"additionalAttribution"},value:t.controls.additionalAttribution,placeholder:""}}}}getGroup_controls(t){const e=this.getSlice_zoom_toggle(t),i=this.getSlice_imperialscale_toggle(t),r=this.getSlice_metricscale_toggle(t),n=this.getSlice_nauticScale_toggle(t),o=this.getSlice_measureTool_toggle(t),s=this.getSlice_zoomLock_toggle(t),a=this.getSlice_lasso_toggle(t),l=this.getSlice_controlSize_slider(t),c=this.getSlice_additionalAttribution_textbox(t),u=this.getSlice_lasso_fill(t),h=this.getSlice_lasso_outline(t),p={displayName:"Controls",uid:"group_controls",slices:[e,r,i,n,o,s,a]};return t.controls.lasso&&p.slices.push(u,h),p.slices.push(l,c),p}getCard_controls(t){const e={displayName:"Controls",suppressDisplayName:!0,uid:"controls_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_controls(t);return e.groups.push(i),e}}},34388:(t,e,i)=>{"use strict";i.d(e,{p:()=>p}),i(91210);var r=i(89438),n=i(90799),o=i(34821),s=i(95513),a=i(38004),l=i(1471),c=i(8037),u=i(20882),h=i(49756);class p{getSlice_circles_includeCircleLayer_boolean(t){return{uid:"circles_includeCircleLayer_boolean",displayName:"Circles",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"includeCircleLayer"},value:t.circlesConfiguration.includeCircleLayer}}}}getSlice_vectorTiles_includeVectorTilesLayer_boolean(t){return{uid:"vectorTiles_includeVectorTilesLayer_boolean",displayName:"Vector Tiles",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"includeVectorTileLayer"},value:t.vectorTileConfiguration.includeVectorTileLayer}}}}getSlice_geoJSON_includeGeoJsonLayer_boolean(t){return{uid:"geoJSON_includegeoJSONLayer_boolean",displayName:"GeoJSON / Shape / KML (from file)",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"includeGeoJsonLayer"},value:t.geoJsonConfiguration.includeGeoJsonLayer}}}}getSlice_wkt_includeWktLayer_boolean(t){return{uid:"wkt_includeWktLayer_boolean",displayName:"WKT / GeoJSON (from data)",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"includeWktLayer"},value:t.wktConfiguration.includeWktLayer}}}}getSlice_lines_includeLineLayer_boolean(t){return{uid:"lines_includeLineLayer_boolean",displayName:"Lines",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"includeLinesLayer"},value:t.linesConfiguration.includeLinesLayer}}}}getSlice_images_includeImageLayer_boolean(t){return{uid:"images_includeImageLayer_boolean",displayName:"Images",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"includeImageLayer"},value:t.imageConfiguration.includeImageLayer}}}}getSlice_heatmap_includeHeatmapLayer_boolean(t){return{uid:"heatmap_includeHeatmapLayer_boolean",displayName:"Heatmap",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"includeHeatmapLayer"},value:t.heatmapConfiguration.includeHeatmapLayer}}}}getSlice_heatmap_includeH3Layer_boolean(t){return{uid:"h3_includeH3_boolean",displayName:"H3",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"h3Configuration",propertyName:"includeH3Layer"},value:t.h3Configuration.includeH3Layer}}}}getSlice_esriFeature_includeEsriFeature_boolean(t){return{uid:"esriFeature_includeEsriFeatureLayer_boolean",displayName:"ESRI Feature",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"includeEsriFeatureLayer"},value:t.esriFeatureConfiguration.includeEsriFeatureLayer}}}}getSlice_data_maxRows_slider(t){return{uid:"data_maxRows_slider",displayName:"Maximum data rows",control:{type:"NumUpDown",properties:{descriptor:{objectName:"map",propertyName:"dataMaxRows"},options:{minValue:{type:0,value:3e4},maxValue:{type:1,value:18e4}},value:t.map.dataMaxRows}}}}getSlice_data_maxRows_note(t){return{uid:"data_maxRows_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"map",propertyName:"datanote"},value:t}}}}getGroup_dataLayers_layers(t){const e=this.getSlice_circles_includeCircleLayer_boolean(t),i=this.getSlice_wkt_includeWktLayer_boolean(t),r=this.getSlice_images_includeImageLayer_boolean(t),n=this.getSlice_heatmap_includeHeatmapLayer_boolean(t),o=this.getSlice_lines_includeLineLayer_boolean(t),s=this.getSlice_vectorTiles_includeVectorTilesLayer_boolean(t),a=this.getSlice_geoJSON_includeGeoJsonLayer_boolean(t),l=this.getSlice_esriFeature_includeEsriFeature_boolean(t),c=this.getSlice_heatmap_includeH3Layer_boolean(t),u={displayName:"Data Layers",uid:"group_dataLayers_dataLayers",expanded:!0,slices:[]};return u.slices.push(e),u.slices.push(n),u.slices.push(c),u.slices.push(r),u.slices.push(o),u.slices.push(i),u.slices.push(a),u.slices.push(s),u.slices.push(l),u}getGroup_dataRows(t){const e=this.getSlice_data_maxRows_slider(t),i=this.getSlice_data_maxRows_note("Increasing the maximum number of rows of data may cause performance issues. Data is loaded in increments of 30000 rows."),r={displayName:"Data Rows",uid:"group_dataLayers_dataRows",expanded:!0,slices:[]};return r.slices.push(e),r.slices.push(i),r}getCard_dataLayers(t){const e={description:"Data Layers",displayName:"Data Layers",suppressDisplayName:!0,uid:"datalayers_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_dataLayers_layers(t);if(e.groups.push(i),t.circlesConfiguration.includeCircleLayer){const i=new r._,n=i.getGroup_dataLayers_circlesConfiguration(t);e.groups.push(n);const o=i.getGroup_dataLayers_circlesFormatting(t);if(e.groups.push(o),t.circlesConfiguration.cluster){const r=i.getGroup_dataLayers_circlesClusters(t);e.groups.push(r)}}if(t.heatmapConfiguration.includeHeatmapLayer){const i=(new n.R).getGroup_dataLayers_heatmapConfiguration(t);e.groups.push(i)}if(t.h3Configuration.includeH3Layer){const i=new u.H3,r=i.getGroup_dataLayers_h3Configuration(t);e.groups.push(r);const n=i.getGroup_dataLayers_h3Formatting(t);e.groups.push(n)}if(t.imageConfiguration.includeImageLayer){const i=(new s.T).getGroup_dataLayers_imageConfiguration(t);e.groups.push(i)}if(t.linesConfiguration.includeLinesLayer){const i=new a.q,r=i.getGroup_dataLayers_linesConfiguration(t);e.groups.push(r);const n=i.getGroup_dataLayers_linesFormatting(t);e.groups.push(n)}if(t.wktConfiguration.includeWktLayer){const i=new o.L,r=i.getGroup_dataLayers_wktConfiguration(t);e.groups.push(r);const n=i.getGroup_dataLayers_wktFormatting(t);e.groups.push(n)}if(t.vectorTileConfiguration.includeVectorTileLayer){const i=new l.R,r=i.getGroup_dataLayers_vectorTilesConfiguration(t);e.groups.push(r);const n=i.getGroup_dataLayers_vectorTilesFormatting(t);e.groups.push(n)}if(t.geoJsonConfiguration.includeGeoJsonLayer){const i=new h.k,r=i.getGroup_dataLayers_geoJSONConfiguration(t);e.groups.push(r);const n=i.getGroup_dataLayers_geoJSONFormatting(t);e.groups.push(n)}if(t.esriFeatureConfiguration.includeEsriFeatureLayer){const i=new c.U,r=i.getGroup_dataLayers_esriFeaturesConfiguration(t);e.groups.push(r);const n=i.getGroup_dataLayers_esriFeaturesFormatting(t);e.groups.push(n)}return e.groups.push(this.getGroup_dataRows(t)),e}}},89438:(t,e,i)=>{"use strict";i.d(e,{_:()=>n}),i(91210);var r=i(889);class n{getSlice_circles_sizeBehaviour_dropdown(t){return{uid:"circles_sizeBehaviour_dropdown",displayName:"Size Behaviour",description:"Size is based on the measure value starting at 0 pixels (explicit) or between a min and max value. If all values are the same the min value will be used.",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"sizeBehaviour"},value:t.circlesConfiguration.sizeBehaviour}}}}getSlice_circles_includeTooltip_dropdown(t){return{uid:"circles_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.circlesConfiguration.includeTooltip}}}}getSlice_circles_allowSelection_dropdown(t){return{uid:"circles_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.circlesConfiguration.allowSelection}}}}getSlice_circles_includeInZoom_dropdown(t){return{uid:"circles_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.circlesConfiguration.includeInZoom}}}}getSlice_circles_minSize_numUpDown(t){return{uid:"circles_minSize_numUpDown",displayName:"Minimum Size",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"minSize"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesConfiguration.minSize}}}}getSlice_circles_maxSize_numUpDown(t){return{uid:"circles_maxSize_numUpDown",displayName:"Maximum Size",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"maxSize"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesConfiguration.maxSize}}}}getSlice_circles_displayNull_boolean(t){return{uid:"circles_displayNull_boolean",displayName:"Include rows with null sizes",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"displayNull"},value:t.circlesConfiguration.displayNull}}}}getSlice_circles_cluster_boolean(t){return{uid:"circles_cluster_boolean",displayName:"Cluster circles",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"cluster"},value:t.circlesConfiguration.cluster}}}}getSlice_circles_clusterPolygon_boolean(t){return{uid:"circles_clusterShowPolygon_boolean",displayName:"Include Polygon",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterShowPolygon"},value:t.circlesConfiguration.clusterShowPolygon}}}}getSlice_circles_dashArray_textBox(t){return{uid:"circles_dashArray_textBox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"dashArray",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.circlesFormatting.dashArray,placeholder:"2 4 4"}}}}getSlice_circles_outlineColor_colorPicker(t){return{uid:"circles_outlineColor_colorPicker",displayName:"Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"outlineColor",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.circlesFormatting.outlineColor}}}}}getSlice_zIndex(t){return{uid:"circles_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"zIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.circlesConfiguration.zIndex}}}}getSlice_circles_outlineTransparency_slider(t){return{uid:"circles_outlineTransparency_slider",displayName:"Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"outlineTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesFormatting.outlineTransparency}}}}getSlice_circles_outlineWidth_numUpDown(t){return{uid:"circles_outlineWidth_numUpDown",displayName:"Outline Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"outlineWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesFormatting.outlineWidth}}}}getSlice_circles_fillColor_colorPicker(t){return{uid:"circles_fillColor_colorPicker",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"fillColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.circlesFormatting.fillColor}}}}}getSlice_circles_fillTransparency_slider(t){return{uid:"circles_fillTransparency_slider",displayName:"Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"fillTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesFormatting.fillTransparency}}}}getSlice_circles_fillStyle_dropdown(t){return{uid:"circles_fillStyle_dropdown",displayName:"Fill Style",description:"Choose the fill style for the circle.",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"fillStyle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.circlesFormatting.fillStyle}}}}getSlice_circles_hatchAngle_numUpDown(t){return{uid:"circles_hatchAngle_numUpDown",displayName:"Hatch Angle",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"hatchAngle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.circlesFormatting.hatchAngle}}}}getSlice_clusterSmallInsideColor(t){return{uid:"clusterSmallInsideColor",displayName:"Small Cluster Inside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterSmallInsideColor"},value:{value:t.circlesConfiguration.clusterSmallInsideColor}}}}}getSlice_clusterSmallOutsideColor(t){return{uid:"clusterSmallOutsideColor",displayName:"Small Cluster Outside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterSmallOutsideColor"},value:{value:t.circlesConfiguration.clusterSmallOutsideColor}}}}}getSlice_clusterMediumInsideColor(t){return{uid:"clusterMediumInsideColor",displayName:"Medium Cluster Inside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterMediumInsideColor"},value:{value:t.circlesConfiguration.clusterMediumInsideColor}}}}}getSlice_clusterMediumOutsideColor(t){return{uid:"clusterMediumOutsideColor",displayName:"Medium Cluster Outside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterMediumOutsideColor"},value:{value:t.circlesConfiguration.clusterMediumOutsideColor}}}}}getSlice_clusterLargeInsideColor(t){return{uid:"clusterLargeInsideColor",displayName:"Large Cluster Inside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterLargeInsideColor"},value:{value:t.circlesConfiguration.clusterLargeInsideColor}}}}}getSlice_clusterLargeOutsideColor(t){return{uid:"clusterLargeOutsideColor",displayName:"Large Cluster Outside Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterLargeOutsideColor"},value:{value:t.circlesConfiguration.clusterLargeOutsideColor}}}}}getSlice_clusterTextColor(t){return{uid:"clusterTextColor",displayName:"Text Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterFontColor"},value:{value:t.circlesConfiguration.clusterFontColor}}}}}getSlice_clusterPolygonColor(t){return{uid:"clusterPolygonColor",displayName:"Polygon Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterPolygonColor"},value:{value:t.circlesConfiguration.clusterPolygonColor}}}}}getSlice_cluster_PolygonLineWidth(t){return{uid:"cluster_PolygonLineWidth",displayName:"Polygon Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"circlesConfiguration",propertyName:"clusterPolygonLineWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:10}},value:t.circlesConfiguration.clusterPolygonLineWidth}}}}getSlice_circles_hatchWidth_numUpDown(t){return{uid:"circles_hatchWidth_numUpDown",displayName:"Hatch Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"circlesFormatting",propertyName:"hatchWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.circlesFormatting.hatchWidth}}}}getGroup_dataLayers_circlesClusters(t){const e=this.getSlice_clusterSmallInsideColor(t),i=this.getSlice_clusterSmallOutsideColor(t),r=this.getSlice_clusterMediumInsideColor(t),n=this.getSlice_clusterMediumOutsideColor(t),o=this.getSlice_clusterLargeInsideColor(t),s=this.getSlice_clusterLargeOutsideColor(t),a=this.getSlice_clusterTextColor(t),l=this.getSlice_clusterPolygonColor(t),c=this.getSlice_cluster_PolygonLineWidth(t),u=this.getSlice_circles_clusterPolygon_boolean(t),h={displayName:"Circles - Clusters",uid:"group_dataLayers_circlesClusters",expanded:!1,slices:[]};return h.slices.push(a),h.slices.push(e),h.slices.push(i),h.slices.push(r),h.slices.push(n),h.slices.push(o),h.slices.push(s),h.slices.push(u),t.circlesConfiguration.clusterShowPolygon&&(h.slices.push(l),h.slices.push(c)),h}getGroup_dataLayers_circlesConfiguration(t){const e=this.getSlice_circles_sizeBehaviour_dropdown(t),i=this.getSlice_circles_minSize_numUpDown(t),r=this.getSlice_circles_maxSize_numUpDown(t),n=this.getSlice_circles_displayNull_boolean(t),o=this.getSlice_circles_includeInZoom_dropdown(t),s=this.getSlice_circles_includeTooltip_dropdown(t),a=this.getSlice_circles_allowSelection_dropdown(t),l=this.getSlice_circles_cluster_boolean(t),c={displayName:"Circles - Configuration",uid:"group_dataLayers_circlesConfiguration",expanded:!1,slices:[]};return c.slices.push(e),"relative"==t.circlesConfiguration.sizeBehaviour.toLowerCase()&&(c.slices.push(i),c.slices.push(r)),c.slices.push(n),c.slices.push(l),c.slices.push(o),c.slices.push(s),c.slices.push(a),c.slices.push(this.getSlice_zIndex(t)),c}getGroup_dataLayers_circlesFormatting(t){const e=this.getSlice_circles_outlineColor_colorPicker(t),i=this.getSlice_circles_outlineTransparency_slider(t),r=this.getSlice_circles_outlineWidth_numUpDown(t),n=this.getSlice_circles_fillColor_colorPicker(t),o=this.getSlice_circles_dashArray_textBox(t),s=this.getSlice_circles_fillTransparency_slider(t),a=this.getSlice_circles_fillStyle_dropdown(t),l=this.getSlice_circles_hatchAngle_numUpDown(t),c=this.getSlice_circles_hatchWidth_numUpDown(t),u={displayName:"Circles - Formatting",uid:"group_dataLayers_circles",expanded:!1,slices:[]};return u.slices.push(e),u.slices.push(i),u.slices.push(r),u.slices.push(o),u.slices.push({uid:"circles_fillColor_gap",displayName:"",control:{type:"EmptyControl",properties:{}}}),u.slices.push(n),u.slices.push(s),u.slices.push(a),"hatched"==t.circlesFormatting.fillStyle&&(u.slices.push(l),u.slices.push(c)),u}}},8037:(t,e,i)=>{"use strict";i.d(e,{U:()=>n}),i(91210);var r=i(889);class n{getSlice_esriFeatures_allowSelection_dropdown(t){return{uid:"esriFeatures_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.esriFeatureConfiguration.allowSelection}}}}getSlice_esriFeatures_includeTooltip_dropdown(t){return{uid:"esriFeatures_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.esriFeatureConfiguration.includeTooltip}}}}getSlice_esriFeatures_includeInZoom_dropdown(t){return{uid:"esriFeatures_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.esriFeatureConfiguration.includeInZoom}}}}getSlice_esriFeatures_matchSpecificProperty_boolean(t){return{uid:"esriFeatures_matchSpecificProperty_boolean",displayName:"Match a Specific Tile Property",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"matchSpecificProperty"},value:t.esriFeatureConfiguration.matchSpecificProperty}}}}getSlice_esriFeatures_propertyToMatch_textbox(t){return{uid:"esriFeatures_propertyToMatch_textbox",displayName:"Property to Match",control:{type:"TextInput",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"propertyToMatch"},placeholder:"",value:t.esriFeatureConfiguration.propertyToMatch}}}}getSlice_esriFeatures_addPropertyToTooltip_boolean(t){return{uid:"esriFeatures_addPropertyToTooltip_boolean",displayName:"Add Property to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"addPropertyToTooltip"},value:t.esriFeatureConfiguration.addPropertyToTooltip}}}}getSlice_esriFeatures_addAllPropertiesToTooltip_boolean(t){return{uid:"esriFeatures_addAllPropertiesToTooltip_boolean",displayName:"Add All Properties to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"addAllPropertiesToTooltip"},value:t.esriFeatureConfiguration.addAllPropertiesToTooltip}}}}getSlice_esriFeatures_tooltipForUnmatched_boolean(t){return{uid:"esriFeatures_tooltipForUnmatched_boolean",displayName:"Add Tooltips to Unmatched Shapes",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"tooltipForUnmatched"},value:t.esriFeatureConfiguration.tooltipForUnmatched}}}}getSlice_esriFeatures_esriFeatureURL_textbox(t){return{uid:"esriFeatures_esriFeatureURL_textbox",displayName:"Esri ArcGIS Feature Layer URL",control:{type:"TextInput",properties:{descriptor:{objectName:"esriFeatureConfiguration",propertyName:"esriFeatureLayerURL",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},placeholder:"",value:t.esriFeatureConfiguration.esriFeatureLayerURL}}}}getGroup_dataLayers_esriFeaturesConfiguration(t){const e=this.getSlice_esriFeatures_esriFeatureURL_textbox(t),i=this.getSlice_esriFeatures_includeInZoom_dropdown(t),r=this.getSlice_esriFeatures_allowSelection_dropdown(t),n=this.getSlice_esriFeatures_includeTooltip_dropdown(t),o=this.getSlice_esriFeatures_matchSpecificProperty_boolean(t),s=this.getSlice_esriFeatures_propertyToMatch_textbox(t),a=this.getSlice_esriFeatures_addPropertyToTooltip_boolean(t),l=this.getSlice_esriFeatures_addAllPropertiesToTooltip_boolean(t),c=this.getSlice_esriFeatures_tooltipForUnmatched_boolean(t),u={displayName:"Esri Feature Layer - Configuration",uid:"group_dataLayers_esriFeaturesConfiguration",expanded:!1,slices:[]};return u.slices.push(e),u.slices.push(o),t.esriFeatureConfiguration.matchSpecificProperty&&u.slices.push(s),u.slices.push(a),u.slices.push(l),u.slices.push(c),u.slices.push(n),u.slices.push(i),u.slices.push(r),u}getSlice_esriFeatures_fillColor_colorPicker(t){return{uid:"esriFeatures_fillColor_colorPicker",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"fillColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.esriFeatureFormatting.fillColor}}}}}getSlice_esriFeatures_outlineColor_colorPicker(t){return{uid:"esriFeatures_outlineColor_colorPicker",displayName:"Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"outlineColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.esriFeatureFormatting.outlineColor}}}}}getSlice_esriFeatures_fillTransparency_slider(t){return{uid:"esriFeatures_fillTransparency_slider",displayName:"Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"fillTransparency",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.fillTransparency}}}}getSlice_esriFeatures_outlineTransparency_slider(t){return{uid:"esriFeatures_outlineTransparency_slider",displayName:"Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"outlineTransparency",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.outlineTransparency}}}}getSlice_esriFeatures_dashArray_textbox(t){return{uid:"esriFeatures_dashArray_textbox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"dashArray",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},placeholder:"",value:t.esriFeatureFormatting.dashArray}}}}getSlice_esriFeatures_outlineWidth_slider(t){return{uid:"esriFeatures_outlineWidth_slider",displayName:"Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"outlineWidth",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.outlineWidth}}}}getSlice_esriFeatures_fillStyle_dropdown(t){return{uid:"esriFeatures_fillStyle_dropdown",displayName:"Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"fillStyle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.esriFeatureFormatting.fillStyle}}}}getSlice_esriFeatures_hatchAngle_slider(t){return{uid:"esriFeatures_hatchAngle_slider",displayName:"Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"hatchAngle",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.esriFeatureFormatting.hatchAngle}}}}getSlice_esriFeatures_hatchWidth_slider(t){return{uid:"esriFeatures_hatchWidth_slider",displayName:"Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"hatchWidth",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.hatchWidth}}}}getSlice_esriFeatures_unmatched_fillColor_colorPicker(t){return{uid:"esriFeatures_unmatched_fillColor_colorPicker",displayName:"Unmatched Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_fillColor"},value:{value:t.esriFeatureFormatting.unmatched_fillColor}}}}}getSlice_esriFeatures_unmatched_outlineColor_colorPicker(t){return{uid:"esriFeatures_unmatched_outlineColor_colorPicker",displayName:"Unmatched Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_outlineColor"},value:{value:t.esriFeatureFormatting.unmatched_outlineColor}}}}}getSlice_esriFeatures_unmatched_fillTransparency_slider(t){return{uid:"esriFeatures_unmatched_fillTransparency_slider",displayName:"Unmatched Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_fillTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.unmatched_fillTransparency}}}}getSlice_esriFeatures_unmatched_outlineTransparency_slider(t){return{uid:"esriFeatures_unmatched_outlineTransparency_slider",displayName:"Unmatched Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_outlineTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.unmatched_outlineTransparency}}}}getSlice_esriFeatures_unmatched_dashArray_textbox(t){return{uid:"esriFeatures_unmatched_dashArray_textbox",displayName:"Unmatched Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_dashArray"},placeholder:"",value:t.esriFeatureFormatting.unmatched_dashArray}}}}getSlice_esriFeatures_unmatched_outlineWidth_slider(t){return{uid:"esriFeatures_unmatched_outlineWidth_slider",displayName:"Unmatched Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_outlineWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.unmatched_outlineWidth}}}}getSlice_esriFeatures_unmatched_fillStyle_dropdown(t){return{uid:"esriFeatures_unmatched_fillStyle_dropdown",displayName:"Unmatched Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_fillStyle"},value:t.esriFeatureFormatting.unmatched_fillStyle}}}}getSlice_esriFeatures_unmatched_hatchAngle_slider(t){return{uid:"esriFeatures_unmatched_hatchAngle_slider",displayName:"Unmatched Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_hatchAngle"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.esriFeatureFormatting.unmatched_hatchAngle}}}}getSlice_esriFeatures_unmatched_hatchWidth_slider(t){return{uid:"esriFeatures_unmatched_hatchWidth_slider",displayName:"Unmatched Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"esriFeatureFormatting",propertyName:"unmatched_hatchWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.esriFeatureFormatting.unmatched_hatchWidth}}}}getGroup_dataLayers_esriFeaturesFormatting(t){const e=this.getSlice_esriFeatures_fillColor_colorPicker(t),i=this.getSlice_esriFeatures_outlineColor_colorPicker(t),r=this.getSlice_esriFeatures_fillTransparency_slider(t),n=this.getSlice_esriFeatures_outlineTransparency_slider(t),o=this.getSlice_esriFeatures_dashArray_textbox(t),s=this.getSlice_esriFeatures_outlineWidth_slider(t),a=this.getSlice_esriFeatures_unmatched_fillColor_colorPicker(t),l=this.getSlice_esriFeatures_unmatched_outlineColor_colorPicker(t),c=this.getSlice_esriFeatures_unmatched_fillTransparency_slider(t),u=this.getSlice_esriFeatures_unmatched_outlineTransparency_slider(t),h=this.getSlice_esriFeatures_unmatched_dashArray_textbox(t),p=this.getSlice_esriFeatures_unmatched_outlineWidth_slider(t),d={displayName:"Esri Feature Layer - Formatting",uid:"group_dataLayers_esriFeaturesFormatting",expanded:!1,slices:[]};return d.slices.push(e),d.slices.push(i),d.slices.push(r),d.slices.push(n),d.slices.push(o),d.slices.push(s),d.slices.push(a),d.slices.push(l),d.slices.push(c),d.slices.push(u),d.slices.push(h),d.slices.push(p),d}}},49756:(t,e,i)=>{"use strict";i.d(e,{k:()=>o}),i(91210);var r=i(889),n=i(91431);class o{getSlice_geoJSON_allowSelection_dropdown(t){return{uid:"geoJSON_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.geoJsonConfiguration.allowSelection}}}}getSlice_geoJSON_includeTooltip_dropdown(t){return{uid:"geoJSON_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.geoJsonConfiguration.includeTooltip}}}}getSlice_geoJSON_includeUnmatchedInZoom_boolean(t){return{uid:"geoJSON_includeUnmatchedInZoom_boolean",displayName:"Include unmatched in auto zoom",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"includeUnmatchedInZoom"},value:t.geoJsonConfiguration.includeUnmatchedInZoom}}}}getSlice_geoJSON_includeInZoom_dropdown(t){return{uid:"geoJSON_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.geoJsonConfiguration.includeInZoom}}}}getSlice_geoJSON_matchSpecificProperty_boolean(t){return{uid:"geoJSON_matchSpecificProperty_boolean",displayName:"Match a Specific Property",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"matchSpecificProperty"},value:t.geoJsonConfiguration.matchSpecificProperty}}}}getSlice_geoJSON_addPropertyToTooltip_boolean(t){return{uid:"geoJSON_addPropertyToTooltip_boolean",displayName:"Add Property to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"addPropertyToTooltip"},value:t.geoJsonConfiguration.addPropertyToTooltip}}}}getSlice_geoJSON_addAllPropertiesToTooltip_boolean(t){return{uid:"geoJSON_addAllPropertiesToTooltip_boolean",displayName:"Add All Properties to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"addAllPropertiesToTooltip"},value:t.geoJsonConfiguration.addAllPropertiesToTooltip}}}}getSlice_geoJSON_tooltipForUnmatched_boolean(t){return{uid:"geoJSON_tooltipForUnmatched_boolean",displayName:"Add Tooltips to Unmatched Shapes",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonConfiguration",propertyName:"tooltipForUnmatched"},value:t.geoJsonConfiguration.tooltipForUnmatched}}}}formattingHelpers;getGroup_dataLayers_geoJSONConfiguration(t){null==this.formattingHelpers&&(this.formattingHelpers=new n.t);const e=this.getSlice_geoJSON_includeInZoom_dropdown(t),i=this.getSlice_geoJSON_allowSelection_dropdown(t),r=this.getSlice_geoJSON_includeTooltip_dropdown(t),o=this.getSlice_geoJSON_matchSpecificProperty_boolean(t),s=this.getSlice_geoJSON_addPropertyToTooltip_boolean(t),a=this.getSlice_geoJSON_addAllPropertiesToTooltip_boolean(t),l=this.getSlice_geoJSON_tooltipForUnmatched_boolean(t),c={displayName:"GeoJSON / Shape / KML - Configuration",uid:"group_dataLayers_geoJSONConfiguration",expanded:!1,slices:[]},u=[];return u.push({value:"url",displayName:"URL"}),u.push({value:"file",displayName:"Uploaded File"}),c.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_geojson_numOfLevels","Number of Drill-down Levels","geoJsonConfiguration","numberOfLevels",t.geoJsonConfiguration.numberOfLevels,1,5,!1)),c.slices.push(this.formattingHelpers.createDropdownSliceFromList("slice_geojson_source","Source","geoJsonConfiguration","geoJSONFileSource",t.geoJsonConfiguration.geoJSONFileSource,u,!1)),"url"==t.geoJsonConfiguration.geoJSONFileSource?(c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_tileURL","GeoJSON / KML File URL (Level 1)","geoJsonConfiguration","geoJSONFileURL1",t.geoJsonConfiguration.geoJSONFileURL1,!0)),t.geoJsonConfiguration.numberOfLevels>1&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_tileURL2","GeoJSON / KML File URL (Level 2)","geoJsonConfiguration","geoJSONFileURL2",t.geoJsonConfiguration.geoJSONFileURL2,!1)),t.geoJsonConfiguration.numberOfLevels>2&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_tileURL3","GeoJSON / KML File URL (Level 3)","geoJsonConfiguration","geoJSONFileURL3",t.geoJsonConfiguration.geoJSONFileURL3,!1)),t.geoJsonConfiguration.numberOfLevels>3&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_tileURL4","GeoJSON / KML File URL (Level 4)","geoJsonConfiguration","geoJSONFileURL4",t.geoJsonConfiguration.geoJSONFileURL4,!1)),t.geoJsonConfiguration.numberOfLevels>4&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojsons_tileURL5","GeoJSON / KML File URL (Level 5)","geoJsonConfiguration","geoJSONFileURL5",t.geoJsonConfiguration.geoJSONFileURL5,!1))):(c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_uploadFile1","Level 1 - Display File Upload Button","geoJSONFileDataLayers","geoJSONFileUpload1",t.geoJSONFileDataLayers.geoJSONFileUpload1,!1)),t.geoJsonConfiguration.numberOfLevels>1&&c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_uploadFile2","Level 2 - Display File Upload Button","geoJSONFileDataLayers","geoJSONFileUpload2",t.geoJSONFileDataLayers.geoJSONFileUpload2,!1)),t.geoJsonConfiguration.numberOfLevels>2&&c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_uploadFile3","Level 3 - Display File Upload Button","geoJSONFileDataLayers","geoJSONFileUpload3",t.geoJSONFileDataLayers.geoJSONFileUpload3,!1)),t.geoJsonConfiguration.numberOfLevels>3&&c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_uploadFile4","Level 4 - Display File Upload Button","geoJSONFileDataLayers","geoJSONFileUpload4",t.geoJSONFileDataLayers.geoJSONFileUpload4,!1)),t.geoJsonConfiguration.numberOfLevels>4&&c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_uploadFile5","Level 5 - Display File Upload Button","geoJSONFileDataLayers","geoJSONFileUpload5",t.geoJSONFileDataLayers.geoJSONFileUpload5,!1))),c.slices.push(o),t.geoJsonConfiguration.matchSpecificProperty&&(c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_propertyToMatch1","Property to Match (Level 1)","geoJsonConfiguration","propertyToMatch1",t.geoJsonConfiguration.propertyToMatch1,!1)),t.geoJsonConfiguration.numberOfLevels>1&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_propertyToMatch2","Property to Match (Level 2)","geoJsonConfiguration","propertyToMatch2",t.geoJsonConfiguration.propertyToMatch2,!1)),t.geoJsonConfiguration.numberOfLevels>2&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_propertyToMatch3","Property to Match (Level 3)","geoJsonConfiguration","propertyToMatch3",t.geoJsonConfiguration.propertyToMatch3,!1)),t.geoJsonConfiguration.numberOfLevels>3&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_propertyToMatch4","Property to Match (Level 4)","geoJsonConfiguration","propertyToMatch4",t.geoJsonConfiguration.propertyToMatch4,!1)),t.geoJsonConfiguration.numberOfLevels>4&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_geojson_propertyToMatch5","Property to Match (Level 5)","geoJsonConfiguration","propertyToMatch5",t.geoJsonConfiguration.propertyToMatch5,!1))),c.slices.push(this.formattingHelpers.createToggleSlice("slice_geojson_removeUnmatched","Remove Unmatched Shapes","geoJsonConfiguration","removeUnmatched",t.geoJsonConfiguration.removeUnmatched,!1)),c.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_geojson_simplificationLevel","Degrees of Simplification","geoJsonConfiguration","geoJSONFileSimplification",t.geoJsonConfiguration.geoJSONFileSimplification,0,1,!1)),"file"==t.geoJsonConfiguration.geoJSONFileSource&&c.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_geojson_geoJSONFilePrecision","Max Precision of Coordinates","geoJsonConfiguration","geoJSONFilePrecision",t.geoJsonConfiguration.geoJSONFilePrecision,0,10,!1)),c.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_geojson_zIndex","Z-Index","geoJsonConfiguration","geoJSONFileZIndex",t.geoJsonConfiguration.geoJSONFileZIndex,0,1e3,!1)),c.slices.push(s),c.slices.push(a),c.slices.push(l),c.slices.push(r),c.slices.push(e),c.slices.push(i),c}getSlice_geoJSON_fillColor_colorPicker(t){return{uid:"geoJSON_fillColor_colorPicker",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"fillColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.geoJsonFormatting.fillColor}}}}}getSlice_geoJSON_outlineColor_colorPicker(t){return{uid:"geoJSON_outlineColor_colorPicker",displayName:"Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"outlineColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.geoJsonFormatting.outlineColor}}}}}getSlice_geoJSON_fillTransparency_slider(t){return{uid:"geoJSON_fillTransparency_slider",displayName:"Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"fillTransparency",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.fillTransparency}}}}getSlice_geoJSON_outlineTransparency_slider(t){return{uid:"geoJSON_outlineTransparency_slider",displayName:"Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"outlineTransparency",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.outlineTransparency}}}}getSlice_geoJSON_dashArray_textbox(t){return{uid:"geoJSON_dashArray_textbox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"dashArray",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},placeholder:"",value:t.geoJsonFormatting.dashArray}}}}getSlice_geoJSON_outlineWidth_slider(t){return{uid:"geoJSON_outlineWidth_slider",displayName:"Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"outlineWidth",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.outlineWidth}}}}getSlice_geoJSON_fillStyle_dropdown(t){return{uid:"geoJSON_fillStyle_dropdown",displayName:"Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"fillStyle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.geoJsonFormatting.fillStyle}}}}getSlice_geoJSON_hatchAngle_slider(t){return{uid:"geoJSON_hatchAngle_slider",displayName:"Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"hatchAngle",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.geoJsonFormatting.hatchAngle}}}}getSlice_geoJSON_hatchWidth_slider(t){return{uid:"geoJSON_hatchWidth_slider",displayName:"Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"hatchWidth",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.hatchWidth}}}}getSlice_geoJSON_overrideUnmatchedFormatting_boolean(t){return{uid:"geoJSON_overrideUnmatchedFormatting_boolean",displayName:"Override formatting for unmatched",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"overrideStyle"},value:t.geoJsonFormatting.overrideStyle}}}}getSlice_geoJSON_unmatched_fillColor_colorPicker(t){return{uid:"geoJSON_unmatched_fillColor_colorPicker",displayName:"Unmatched Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_fillColor"},value:{value:t.geoJsonFormatting.unmatched_fillColor}}}}}getSlice_geoJSON_unmatched_outlineColor_colorPicker(t){return{uid:"geoJSON_unmatched_outlineColor_colorPicker",displayName:"Unmatched Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_outlineColor"},value:{value:t.geoJsonFormatting.unmatched_outlineColor}}}}}getSlice_geoJSON_unmatched_fillTransparency_slider(t){return{uid:"geoJSON_unmatched_fillTransparency_slider",displayName:"Unmatched Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_fillTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.unmatched_fillTransparency}}}}getSlice_geoJSON_unmatched_outlineTransparency_slider(t){return{uid:"geoJSON_unmatched_outlineTransparency_slider",displayName:"Unmatched Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_outlineTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.unmatched_outlineTransparency}}}}getSlice_geoJSON_unmatched_dashArray_textbox(t){return{uid:"geoJSON_unmatched_dashArray_textbox",displayName:"Unmatched Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_dashArray"},placeholder:"",value:t.geoJsonFormatting.unmatched_dashArray}}}}getSlice_geoJSON_unmatched_outlineWidth_slider(t){return{uid:"geoJSON_unmatched_outlineWidth_slider",displayName:"Unmatched Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_outlineWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.unmatched_outlineWidth}}}}getSlice_geoJSON_unmatched_fillStyle_dropdown(t){return{uid:"geoJSON_unmatched_fillStyle_dropdown",displayName:"Unmatched Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_fillStyle"},value:t.geoJsonFormatting.unmatched_fillStyle}}}}getSlice_geoJSON_unmatched_hatchAngle_slider(t){return{uid:"geoJSON_unmatched_hatchAngle_slider",displayName:"Unmatched Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_hatchAngle"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.geoJsonFormatting.unmatched_hatchAngle}}}}getSlice_geoJSON_unmatched_hatchWidth_slider(t){return{uid:"geoJSON_unmatched_hatchWidth_slider",displayName:"Unmatched Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"geoJsonFormatting",propertyName:"unmatched_hatchWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.geoJsonFormatting.unmatched_hatchWidth}}}}getGroup_dataLayers_geoJSONFormatting(t){null==this.formattingHelpers&&(this.formattingHelpers=new n.t);const e=this.getSlice_geoJSON_fillColor_colorPicker(t),i=this.getSlice_geoJSON_outlineColor_colorPicker(t),r=this.getSlice_geoJSON_fillTransparency_slider(t),o=this.getSlice_geoJSON_outlineTransparency_slider(t),s=this.getSlice_geoJSON_dashArray_textbox(t),a=this.getSlice_geoJSON_outlineWidth_slider(t),l=this.getSlice_geoJSON_fillStyle_dropdown(t),c=this.getSlice_geoJSON_hatchAngle_slider(t),u=this.getSlice_geoJSON_hatchWidth_slider(t),h=this.getSlice_geoJSON_overrideUnmatchedFormatting_boolean(t),p=this.getSlice_geoJSON_unmatched_fillColor_colorPicker(t),d=this.getSlice_geoJSON_unmatched_outlineColor_colorPicker(t),f=this.getSlice_geoJSON_unmatched_fillTransparency_slider(t),m=this.getSlice_geoJSON_unmatched_outlineTransparency_slider(t),g=this.getSlice_geoJSON_unmatched_dashArray_textbox(t),_=this.getSlice_geoJSON_unmatched_outlineWidth_slider(t),y=this.getSlice_geoJSON_unmatched_fillStyle_dropdown(t),A=this.getSlice_geoJSON_unmatched_hatchAngle_slider(t),v=this.getSlice_geoJSON_unmatched_hatchWidth_slider(t),x={displayName:"GeoJSON / Shape / KML - Formatting",uid:"group_dataLayers_geoJSONFormatting",expanded:!1,slices:[]};return x.slices.push(e),x.slices.push(i),x.slices.push(r),x.slices.push(o),x.slices.push(s),x.slices.push(a),x.slices.push(l),x.slices.push(c),x.slices.push(u),x.slices.push(h),x.slices.push(p),x.slices.push(d),x.slices.push(f),x.slices.push(m),x.slices.push(g),x.slices.push(_),x.slices.push(y),x.slices.push(A),x.slices.push(v),x}}},20882:(t,e,i)=>{"use strict";i.d(e,{H3:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_dataLayers_h3Configuration(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"H3 - Configuration",uid:"group_dataLayers_h3Configuration",expanded:!1,slices:[]},i=[];return i.push({value:"coordinates",displayName:"Longitude and latitude coordinates"}),i.push({value:"indexes",displayName:"H3 Indexes as ID"}),e.slices.push(this.formattingHelpers.createDropdownSliceFromList("slice_h3_source_dropdown","Source","h3Configuration","h3Source",t.h3Configuration.h3Source,i,!1)),"coordinates"===t.h3Configuration.h3Source.toLowerCase()&&(e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_h3_resolution_numUpDown","Resolution","h3Configuration","resolution",t.h3Configuration.resolution,0,15,!0)),e.slices.push(this.formattingHelpers.createDropdownSlice("slice_h3_zoomBy_dropdown","Zoom By","h3Configuration","zoomBy",t.h3Configuration.zoomBy,!1)),"points"===t.h3Configuration.zoomBy.toLowerCase()&&e.slices.push(this.formattingHelpers.createDropdownSlice("slice_h3_includeInZoom_dropdown","Include in Zoom","h3Configuration","includeInZoom",t.h3Configuration.includeInZoom,!0))),e.slices.push(this.formattingHelpers.createDropdownSlice("slice_h3_allowSelection_boolean","Selectable","h3Configuration","allowSelection",t.h3Configuration.allowSelection,!0)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_h3_zIndex_numUpDown","Z-Index","h3Configuration","zIndex",t.h3Configuration.zIndex,0,1e3,!1)),e}getGroup_dataLayers_h3Formatting(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"H3 - Formatting",uid:"group_dataLayers_h3Formatting",expanded:!1,slices:[]};return e.slices.push(this.formattingHelpers.createColorSlice("slice_h3_outlineColor_colorPicker","Outline Color","h3Configuration","outlineColor",t.h3Configuration.outlineColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("slice_h3_outlineTransparency_slider","Outline Transparency","h3Configuration","outlineTransparency",t.h3Configuration.outlineTransparency,0,100,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_h3_outlineWidth_numUpDown","Outline Width","h3Configuration","outlineWidth",t.h3Configuration.outlineWidth,0,100,!1)),e.slices.push(this.formattingHelpers.createColorSlice("slice_h3_startColor_colorPicker","Start Color","h3Configuration","startColor",t.h3Configuration.startColor,!1)),e.slices.push(this.formattingHelpers.createToggleSlice("slice_h3_useMidColor_toggle","Use Mid Color","h3Configuration","useMidColor",t.h3Configuration.useMidColor,!1)),t.h3Configuration.useMidColor&&e.slices.push(this.formattingHelpers.createColorSlice("slice_h3_midColor_colorPicker","Mid Color","h3Configuration","midColor",t.h3Configuration.midColor,!1)),e.slices.push(this.formattingHelpers.createColorSlice("slice_h3_endColor_colorPicker","End Color","h3Configuration","endColor",t.h3Configuration.endColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("slice_h3_fillTransparency_slider","Fill Transparency","h3Configuration","fillTransparency",t.h3Configuration.fillTransparency,0,100,!1)),e}}},90799:(t,e,i)=>{"use strict";i.d(e,{R:()=>n}),i(91210);var r=i(889);class n{getSlice_heatmap_sizeBehaviour_dropdown(t){return{uid:"heatmap_units_dropdown",displayName:"Units",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"units"},value:t.heatmapConfiguration.units}}}}getSlice_heatmap_includeInZoom_dropdown(t){return{uid:"heatmap_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.heatmapConfiguration.includeInZoom}}}}getSlice_heatmap_transparency_slider(t){return{uid:"heatmap_transparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"transparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.heatmapConfiguration.transparency}}}}getSlice_heatmap_multiplier_slider(t){return{uid:"heatmap_multiplier_slider",displayName:"Multiplier",control:{type:"Slider",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"multiplier"},options:{minValue:{type:0,value:-100},maxValue:{type:1,value:100}},value:t.heatmapConfiguration.multiplier}}}}getSlice_heatmap_size_slider(t){let e=1e3;return"px"==t.heatmapConfiguration.units&&(e=100),{uid:"heatmap_size_slider",displayName:"Size",control:{type:"Slider",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"size"},options:{minValue:{type:0,value:1},maxValue:{type:1,value:e}},value:t.heatmapConfiguration.size}}}}getSlice_heatmap_alphaRange_slider(t){return{uid:"heatmap_alphaRange_slider",displayName:"Alpha Range",control:{type:"Slider",properties:{descriptor:{objectName:"heatmapConfiguration",propertyName:"alphaRange"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.heatmapConfiguration.alphaRange}}}}getGroup_dataLayers_heatmapConfiguration(t){const e=this.getSlice_heatmap_sizeBehaviour_dropdown(t),i=this.getSlice_heatmap_includeInZoom_dropdown(t),r=this.getSlice_heatmap_size_slider(t),n=this.getSlice_heatmap_transparency_slider(t),o=this.getSlice_heatmap_multiplier_slider(t),s=this.getSlice_heatmap_alphaRange_slider(t),a={displayName:"Heatmap - Configuration",uid:"group_dataLayers_heatmapConfiguration",expanded:!1,slices:[]};return a.slices.push(i),a.slices.push(e),a.slices.push(r),a.slices.push(o),a.slices.push(s),a.slices.push(n),a}}},95513:(t,e,i)=>{"use strict";i.d(e,{T:()=>n}),i(91210);var r=i(889);class n{getSlice_images_includeTooltip_dropdown(t){return{uid:"images_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.imageConfiguration.includeTooltip}}}}getSlice_images_allowSelection_dropdown(t){return{uid:"images_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.imageConfiguration.allowSelection}}}}getSlice_images_includeInZoom_dropdown(t){return{uid:"images_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.imageConfiguration.includeInZoom}}}}getSlice_images_imageRotation_numUpDown(t){return{uid:"images_imageRotation_numUpDown",displayName:"Image Rotation",control:{type:"NumUpDown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"imageRotation",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.imageConfiguration.imageRotation}}}}getSlice_images_imageWidth_numUpDown(t){return{uid:"images_imageWidth_numUpDown",displayName:"Image Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"imageWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.imageConfiguration.imageWidth}}}}getSlice_images_imageHeight_numUpDown(t){return{uid:"images_imageHeight_numUpDown",displayName:"Image Height",control:{type:"NumUpDown",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"imageHeight",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.imageConfiguration.imageHeight}}}}getSlice_images_transparency_slider(t){return{uid:"images_transparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"imageConfiguration",propertyName:"transparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.imageConfiguration.transparency}}}}getGroup_dataLayers_imageConfiguration(t){const e=this.getSlice_images_includeInZoom_dropdown(t),i=this.getSlice_images_includeTooltip_dropdown(t),r=this.getSlice_images_allowSelection_dropdown(t),n=this.getSlice_images_imageRotation_numUpDown(t),o=this.getSlice_images_imageWidth_numUpDown(t),s=this.getSlice_images_imageHeight_numUpDown(t),a=this.getSlice_images_transparency_slider(t),l={displayName:"Images - Configuration",uid:"group_dataLayers_imageConfiguration",expanded:!1,slices:[]};return l.slices.push(n),l.slices.push(o),l.slices.push(s),l.slices.push(a),l.slices.push(e),l.slices.push(i),l.slices.push(r),l}}},38004:(t,e,i)=>{"use strict";i.d(e,{q:()=>n}),i(91210);var r=i(889);class n{getSlice_lines_includeTooltip_dropdown(t){return{uid:"lines_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.linesConfiguration.includeTooltip}}}}getSlice_lines_allowSelection_dropdown(t){return{uid:"lines_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.linesConfiguration.allowSelection}}}}getSlice_lines_includeInZoom_dropdown(t){return{uid:"lines_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.linesConfiguration.includeInZoom}}}}getSlice_lines_linesBehavior_dropdown(t){return{uid:"lines_linesBehavior_dropdown",displayName:"Line Shape",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"linesBehavior",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.linesConfiguration.linesBehavior}}}}getSlice_lines_dashArray_textBox(t){return{uid:"lines_dashArray_textBox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"dashArray",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.linesFormatting.dashArray,placeholder:"2 4 4"}}}}getSlice_lines_color_colorPicker(t){return{uid:"lines_outlineColor_colorPicker",displayName:"Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"color",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.linesFormatting.color}}}}}getSlice_lines_outlineTransparency_slider(t){return{uid:"lines_outlineTransparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"transparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.linesFormatting.transparency}}}}getSlice_lines_originImageTransparency_slider(t){return{uid:"lines_originImage_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"originImageTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.linesConfiguration.originImageTransparency}}}}getSlice_lines_destinationImageTransparency_slider(t){return{uid:"lines_destinationImage_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"destinationImageTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.linesConfiguration.destinationImageTransparency}}}}getSlice_lines_outlineWidth_numUpDown(t){return{uid:"lines_outlineWidth_numUpDown",displayName:"Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"width",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.linesFormatting.width}}}}getSlice_line_destinationImageRotation_numUpDown(t){return{uid:"line_imageRotation_numUpDown",displayName:"Image Rotation",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"destinationImageRotation",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.linesConfiguration.destinationImageRotation}}}}getSlice_line_destinationImageWidth_numUpDown(t){return{uid:"line_imageWidth_numUpDown",displayName:"Image Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"destinationImageWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.linesConfiguration.destinationImageWidth}}}}getSlice_line_destinationImageHeight_numUpDown(t){return{uid:"line_imageHeight_numUpDown",displayName:"Image Height",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"destinationImageHeight",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.linesConfiguration.destinationImageHeight}}}}getSlice_line_imageURL_text(t){return{uid:"line_imageURL_text",displayName:"Image URL at end",control:{type:"TextInput",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"imageAtDestination",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},placeholder:"",value:t.linesConfiguration.imageAtDestination}}}}getSlice_line_originImageRotation_numUpDown(t){return{uid:"line_imageRotation_numUpDown_origin",displayName:"Image Rotation",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"originImageRotation",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.linesConfiguration.originImageRotation}}}}getSlice_line_originImageWidth_numUpDown(t){return{uid:"line_imageWidth_numUpDown_origin",displayName:"Image Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"originImageWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.linesConfiguration.originImageWidth}}}}getSlice_line_originImageHeight_numUpDown(t){return{uid:"line_imageHeight_numUpDown_origin",displayName:"Image Height",control:{type:"NumUpDown",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"originImageHeight",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.linesConfiguration.originImageHeight}}}}getSlice_line_originImageURL_text(t){return{uid:"line_imageURL_text_origin",displayName:"Image URL at start",control:{type:"TextInput",properties:{descriptor:{objectName:"linesConfiguration",propertyName:"imageAtOrigin",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},placeholder:"",value:t.linesConfiguration.imageAtOrigin}}}}getGroup_dataLayers_linesConfiguration(t){const e=this.getSlice_lines_includeInZoom_dropdown(t),i=this.getSlice_lines_includeTooltip_dropdown(t),r=this.getSlice_lines_allowSelection_dropdown(t),n=this.getSlice_line_destinationImageHeight_numUpDown(t),o=this.getSlice_line_destinationImageWidth_numUpDown(t),s=this.getSlice_line_destinationImageRotation_numUpDown(t),a=this.getSlice_line_imageURL_text(t),l=this.getSlice_line_originImageHeight_numUpDown(t),c=this.getSlice_line_originImageWidth_numUpDown(t),u=this.getSlice_line_originImageRotation_numUpDown(t),h=this.getSlice_line_originImageURL_text(t),p=this.getSlice_lines_originImageTransparency_slider(t),d=this.getSlice_lines_destinationImageTransparency_slider(t),f={displayName:"Lines - Configuration",uid:"group_dataLayers_linesConfiguration",expanded:!1,slices:[]};return f.slices.push(e),f.slices.push(i),f.slices.push(r),f.slices.push({uid:"lines_fillColor_gap1",displayName:"",control:{type:"EmptyControl",properties:{}}}),f.slices.push(h),f.slices.push(l),f.slices.push(c),f.slices.push(u),f.slices.push(p),f.slices.push({uid:"lines_fillColor_gap2",displayName:"",control:{type:"EmptyControl",properties:{}}}),f.slices.push(a),f.slices.push(n),f.slices.push(o),f.slices.push(s),f.slices.push(d),f}getGroup_dataLayers_linesFormatting(t){const e=this.getSlice_lines_color_colorPicker(t),i=this.getSlice_lines_outlineTransparency_slider(t),r=this.getSlice_lines_outlineWidth_numUpDown(t),n=this.getSlice_lines_dashArray_textBox(t),o=this.getSlice_lines_linesBehavior_dropdown(t),s={displayName:"Lines - Formatting",uid:"group_dataLayers_lines",expanded:!1,slices:[]};return s.slices.push(e),s.slices.push(i),s.slices.push(r),s.slices.push(o),s.slices.push(n),s}}},1471:(t,e,i)=>{"use strict";i.d(e,{R:()=>o}),i(91210);var r=i(91431),n=i(889);class o{getSlice_vectorTiles_allowSelection_dropdown(t){return{uid:"vectorTiles_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"allowSelection",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.vectorTileConfiguration.allowSelection}}}}getSlice_vectorTiles_includeTooltip_dropdown(t){return{uid:"vectorTiles_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"includeTooltip",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.vectorTileConfiguration.includeTooltip}}}}getSlice_vectorTiles_includeInZoom_dropdown(t){return{uid:"vectorTiles_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"includeInZoom",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.vectorTileConfiguration.includeInZoom}}}}getSlice_vectorTiles_matchSpecificProperty_boolean(t){return{uid:"vectorTiles_matchSpecificProperty_boolean",displayName:"Match a Specific Tile Property",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"matchSpecificProperty"},value:t.vectorTileConfiguration.matchSpecificProperty}}}}getSlice_vectorTiles_addPropertyToTooltip_boolean(t){return{uid:"vectorTiles_addPropertyToTooltip_boolean",displayName:"Add Property to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"addPropertyToTooltip"},value:t.vectorTileConfiguration.addPropertyToTooltip}}}}getSlice_vectorTiles_addAllPropertiesToTooltip_boolean(t){return{uid:"vectorTiles_addAllPropertiesToTooltip_boolean",displayName:"Add All Properties to Tooltip",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"addAllPropertiesToTooltip"},value:t.vectorTileConfiguration.addAllPropertiesToTooltip}}}}getSlice_vectorTiles_tooltipForUnmatched_boolean(t){return{uid:"vectorTiles_tooltipForUnmatched_boolean",displayName:"Add Tooltips to Unmatched Shapes",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"vectorTileConfiguration",propertyName:"tooltipForUnmatched"},value:t.vectorTileConfiguration.tooltipForUnmatched}}}}formattingHelpers;getGroup_dataLayers_vectorTilesConfiguration(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e=this.getSlice_vectorTiles_includeInZoom_dropdown(t),i=this.getSlice_vectorTiles_allowSelection_dropdown(t),n=this.getSlice_vectorTiles_includeTooltip_dropdown(t),o=this.getSlice_vectorTiles_matchSpecificProperty_boolean(t),s=this.getSlice_vectorTiles_addPropertyToTooltip_boolean(t),a=this.getSlice_vectorTiles_addAllPropertiesToTooltip_boolean(t),l=this.getSlice_vectorTiles_tooltipForUnmatched_boolean(t),c={displayName:"Vector Tiles - Configuration",uid:"group_dataLayers_vectorTilesConfiguration",expanded:!1,slices:[]};return c.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_vectorTiles_numOfLevels","Number of Drill-down Levels","vectorTileConfiguration","numberOfLevels",t.vectorTileConfiguration.numberOfLevels,1,5,!1)),c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_tileURL","Vector Tile XYZ URL (Level 1)","vectorTileConfiguration","vectorTileURL1",t.vectorTileConfiguration.vectorTileURL1,!1)),t.vectorTileConfiguration.numberOfLevels>1&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_tileURL2","Vector Tile XYZ URL (Level 2)","vectorTileConfiguration","vectorTileURL2",t.vectorTileConfiguration.vectorTileURL2,!1)),t.vectorTileConfiguration.numberOfLevels>2&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_tileURL3","Vector Tile XYZ URL (Level 3)","vectorTileConfiguration","vectorTileURL3",t.vectorTileConfiguration.vectorTileURL3,!1)),t.vectorTileConfiguration.numberOfLevels>3&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_tileURL4","Vector Tile XYZ URL (Level 4)","vectorTileConfiguration","vectorTileURL4",t.vectorTileConfiguration.vectorTileURL4,!1)),t.vectorTileConfiguration.numberOfLevels>4&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_tileURL5","Vector Tile XYZ URL (Level 5)","vectorTileConfiguration","vectorTileURL5",t.vectorTileConfiguration.vectorTileURL5,!1)),c.slices.push(o),t.vectorTileConfiguration.matchSpecificProperty&&(c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_propertyToMatch1","Property to Match (Level 1)","vectorTileConfiguration","propertyToMatch1",t.vectorTileConfiguration.propertyToMatch1,!1)),t.vectorTileConfiguration.numberOfLevels>1&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_propertyToMatch2","Property to Match (Level 2)","vectorTileConfiguration","propertyToMatch2",t.vectorTileConfiguration.propertyToMatch2,!1)),t.vectorTileConfiguration.numberOfLevels>2&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_propertyToMatch3","Property to Match (Level 3)","vectorTileConfiguration","propertyToMatch3",t.vectorTileConfiguration.propertyToMatch3,!1)),t.vectorTileConfiguration.numberOfLevels>3&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_propertyToMatch4","Property to Match (Level 4)","vectorTileConfiguration","propertyToMatch4",t.vectorTileConfiguration.propertyToMatch4,!1)),t.vectorTileConfiguration.numberOfLevels>4&&c.slices.push(this.formattingHelpers.createTextInputSlice("slice_vectorTiles_propertyToMatch5","Property to Match (Level 5)","vectorTileConfiguration","propertyToMatch5",t.vectorTileConfiguration.propertyToMatch5,!1))),c.slices.push(s),c.slices.push(a),c.slices.push(l),c.slices.push(n),c.slices.push(e),c.slices.push(i),c}getSlice_vectorTiles_fillColor_colorPicker(t){return{uid:"vectorTiles_fillColor_colorPicker",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"fillColor",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.vectorTileFormatting.fillColor}}}}}getSlice_vectorTiles_outlineColor_colorPicker(t){return{uid:"vectorTiles_outlineColor_colorPicker",displayName:"Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"outlineColor",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.vectorTileFormatting.outlineColor}}}}}getSlice_vectorTiles_fillTransparency_slider(t){return{uid:"vectorTiles_fillTransparency_slider",displayName:"Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"fillTransparency",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.fillTransparency}}}}getSlice_vectorTiles_outlineTransparency_slider(t){return{uid:"vectorTiles_outlineTransparency_slider",displayName:"Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"outlineTransparency",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.outlineTransparency}}}}getSlice_vectorTiles_dashArray_textbox(t){return{uid:"vectorTiles_dashArray_textbox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"dashArray",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},placeholder:"",value:t.vectorTileFormatting.dashArray}}}}getSlice_vectorTiles_outlineWidth_slider(t){return{uid:"vectorTiles_outlineWidth_slider",displayName:"Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"outlineWidth",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.outlineWidth}}}}getSlice_vectorTiles_fillStyle_dropdown(t){return{uid:"vectorTiles_fillStyle_dropdown",displayName:"Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"fillStyle",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.vectorTileFormatting.fillStyle}}}}getSlice_vectorTiles_hatchAngle_slider(t){return{uid:"vectorTiles_hatchAngle_slider",displayName:"Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"hatchAngle",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.vectorTileFormatting.hatchAngle}}}}getSlice_vectorTiles_hatchWidth_slider(t){return{uid:"vectorTiles_hatchWidth_slider",displayName:"Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"hatchWidth",instanceKind:3,selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.hatchWidth}}}}getSlice_vectorTiles_unmatched_fillColor_colorPicker(t){return{uid:"vectorTiles_unmatched_fillColor_colorPicker",displayName:"Unmatched Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_fillColor"},value:{value:t.vectorTileFormatting.unmatched_fillColor}}}}}getSlice_vectorTiles_unmatched_outlineColor_colorPicker(t){return{uid:"vectorTiles_unmatched_outlineColor_colorPicker",displayName:"Unmatched Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_outlineColor"},value:{value:t.vectorTileFormatting.unmatched_outlineColor}}}}}getSlice_vectorTiles_unmatched_fillTransparency_slider(t){return{uid:"vectorTiles_unmatched_fillTransparency_slider",displayName:"Unmatched Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_fillTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.unmatched_fillTransparency}}}}getSlice_vectorTiles_unmatched_outlineTransparency_slider(t){return{uid:"vectorTiles_unmatched_outlineTransparency_slider",displayName:"Unmatched Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_outlineTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.unmatched_outlineTransparency}}}}getSlice_vectorTiles_unmatched_dashArray_textbox(t){return{uid:"vectorTiles_unmatched_dashArray_textbox",displayName:"Unmatched Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_dashArray"},placeholder:"",value:t.vectorTileFormatting.unmatched_dashArray}}}}getSlice_vectorTiles_unmatched_outlineWidth_slider(t){return{uid:"vectorTiles_unmatched_outlineWidth_slider",displayName:"Unmatched Outline Width",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_outlineWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.unmatched_outlineWidth}}}}getSlice_vectorTiles_unmatched_fillStyle_dropdown(t){return{uid:"vectorTiles_unmatched_fillStyle_dropdown",displayName:"Unmatched Fill Style",control:{type:"Dropdown",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_fillStyle"},value:t.vectorTileFormatting.unmatched_fillStyle}}}}getSlice_vectorTiles_unmatched_hatchAngle_slider(t){return{uid:"vectorTiles_unmatched_hatchAngle_slider",displayName:"Unmatched Hatch Angle",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_hatchAngle"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.vectorTileFormatting.unmatched_hatchAngle}}}}getSlice_vectorTiles_unmatched_hatchWidth_slider(t){return{uid:"vectorTiles_unmatched_hatchWidth_slider",displayName:"Unmatched Hatch Width",control:{type:"Slider",properties:{descriptor:{objectName:"vectorTileFormatting",propertyName:"unmatched_hatchWidth"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.vectorTileFormatting.unmatched_hatchWidth}}}}getGroup_dataLayers_vectorTilesFormatting(t){const e=this.getSlice_vectorTiles_fillColor_colorPicker(t),i=this.getSlice_vectorTiles_outlineColor_colorPicker(t),r=this.getSlice_vectorTiles_fillTransparency_slider(t),n=this.getSlice_vectorTiles_outlineTransparency_slider(t),o=this.getSlice_vectorTiles_dashArray_textbox(t),s=this.getSlice_vectorTiles_outlineWidth_slider(t),a=this.getSlice_vectorTiles_unmatched_fillColor_colorPicker(t),l=this.getSlice_vectorTiles_unmatched_outlineColor_colorPicker(t),c=this.getSlice_vectorTiles_unmatched_fillTransparency_slider(t),u=this.getSlice_vectorTiles_unmatched_outlineTransparency_slider(t),h=this.getSlice_vectorTiles_unmatched_dashArray_textbox(t),p=this.getSlice_vectorTiles_unmatched_outlineWidth_slider(t),d={displayName:"Vector Tiles - Formatting",uid:"group_dataLayers_vectorTilesFormatting",expanded:!1,slices:[]};return d.slices.push(e),d.slices.push(i),d.slices.push(r),d.slices.push(n),d.slices.push(o),d.slices.push(s),d.slices.push(a),d.slices.push(l),d.slices.push(c),d.slices.push(u),d.slices.push(h),d.slices.push(p),d}}},34821:(t,e,i)=>{"use strict";i.d(e,{L:()=>n}),i(91210);var r=i(889);class n{getSlice_wkt_includeTooltip_dropdown(t){return{uid:"wkt_includeTooltip_dropdown",displayName:"Include Tooltip",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"includeTooltip",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.wktConfiguration.includeTooltip}}}}getSlice_wkt_allowSelection_dropdown(t){return{uid:"wkt_allowSelection_dropdown",displayName:"Selectable",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"allowSelection",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.wktConfiguration.allowSelection}}}}getSlice_wkt_includeInZoom_dropdown(t){return{uid:"wkt_includeInZoom_dropdown",displayName:"Include in Auto Zoom",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"includeInZoom",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.wktConfiguration.includeInZoom}}}}getSlice_wkt_imageRotation_numUpDown(t){return{uid:"wkt_imageRotation_numUpDown",displayName:"Image Rotation",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"imageRotation",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.wktConfiguration.imageRotation}}}}getSlice_wkt_pointSize_numUpDown(t){return{uid:"wkt_pointSize_numUpDown",displayName:"Point Size",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"pointSize",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:500}},value:t.wktConfiguration.pointSize}}}}getSlice_wkt_imageWidth_numUpDown(t){return{uid:"wkt_imageWidth_numUpDown",displayName:"Image Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"imageWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.wktConfiguration.imageWidth}}}}getSlice_wkt_imageHeight_numUpDown(t){return{uid:"wkt_imageHeight_numUpDown",displayName:"Image Height",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"imageHeight",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.wktConfiguration.imageHeight}}}}getSlice_wkt_imageURL_text(t){return{uid:"wkt_imageURL_text",displayName:"Image URL at linestring end",control:{type:"TextInput",properties:{descriptor:{objectName:"wktConfiguration",propertyName:"imageAtDestination",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},placeholder:"",value:t.wktConfiguration.imageAtDestination}}}}getSlice_wkt_dashArray_textBox(t){return{uid:"wkt_dashArray_textBox",displayName:"Dash Array",control:{type:"TextInput",properties:{descriptor:{objectName:"wktFormatting",propertyName:"dashArray",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.wktFormatting.dashArray,placeholder:"2 4 4"}}}}getSlice_wkt_outlineColor_colorPicker(t){return{uid:"wkt_outlineColor_colorPicker",displayName:"Outline Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"wktFormatting",propertyName:"outlineColor",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.wktFormatting.outlineColor}}}}}getSlice_wkt_outlineTransparency_slider(t){return{uid:"wkt_outlineTransparency_slider",displayName:"Outline Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"wktFormatting",propertyName:"outlineTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.wktFormatting.outlineTransparency}}}}getSlice_wkt_outlineWidth_numUpDown(t){return{uid:"wkt_outlineWidth_numUpDown",displayName:"Outline Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktFormatting",propertyName:"outlineWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.wktFormatting.outlineWidth}}}}getSlice_wkt_fillColor_colorPicker(t){return{uid:"wkt_fillColor_colorPicker",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"wktFormatting",propertyName:"fillColor",instanceKind:3,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null},value:{value:t.wktFormatting.fillColor}}}}}getSlice_wkt_fillTransparency_slider(t){return{uid:"wkt_fillTransparency_slider",displayName:"Fill Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"wktFormatting",propertyName:"fillTransparency",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.wktFormatting.fillTransparency}}}}getSlice_wkt_fillStyle_dropdown(t){return{uid:"wkt_fillStyle_dropdown",displayName:"Fill Style",description:"Choose the fill style for the circle.",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"wktFormatting",propertyName:"fillStyle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.wktFormatting.fillStyle}}}}getSlice_wkt_hatchAngle_numUpDown(t){return{uid:"wkt_hatchAngle_numUpDown",displayName:"Hatch Angle",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktFormatting",propertyName:"hatchAngle",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:360}},value:t.wktFormatting.hatchAngle}}}}getSlice_wkt_hatchWidth_numUpDown(t){return{uid:"wkt_hatchWidth_numUpDown",displayName:"Hatch Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"wktFormatting",propertyName:"hatchWidth",selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.wktFormatting.hatchWidth}}}}getGroup_dataLayers_wktConfiguration(t){const e=this.getSlice_wkt_includeInZoom_dropdown(t),i=this.getSlice_wkt_includeTooltip_dropdown(t),r=this.getSlice_wkt_allowSelection_dropdown(t),n=this.getSlice_wkt_imageURL_text(t),o=this.getSlice_wkt_imageRotation_numUpDown(t),s=this.getSlice_wkt_imageWidth_numUpDown(t),a=this.getSlice_wkt_imageHeight_numUpDown(t),l=this.getSlice_wkt_pointSize_numUpDown(t),c={displayName:"WKT / GeoJSON - Configuration",uid:"group_dataLayers_wktConfiguration",expanded:!1,slices:[]};return c.slices.push(e),c.slices.push(i),c.slices.push(r),c.slices.push(l),c.slices.push(n),c.slices.push(o),c.slices.push(s),c.slices.push(a),c}getGroup_dataLayers_wktFormatting(t){const e=this.getSlice_wkt_outlineColor_colorPicker(t),i=this.getSlice_wkt_outlineTransparency_slider(t),r=this.getSlice_wkt_outlineWidth_numUpDown(t),n=this.getSlice_wkt_fillColor_colorPicker(t),o=this.getSlice_wkt_dashArray_textBox(t),s=this.getSlice_wkt_fillTransparency_slider(t),a=this.getSlice_wkt_fillStyle_dropdown(t),l=this.getSlice_wkt_hatchAngle_numUpDown(t),c=this.getSlice_wkt_hatchWidth_numUpDown(t),u={displayName:"WKT / GeoJSON - Formatting",uid:"group_dataLayers_wkt",expanded:!1,slices:[]};return u.slices.push(e),u.slices.push(i),u.slices.push(r),u.slices.push(o),u.slices.push({uid:"wkt_fillColor_gap",displayName:"",control:{type:"EmptyControl",properties:{}}}),u.slices.push(n),u.slices.push(s),u.slices.push(a),"hatched"==t.wktFormatting.fillStyle&&(u.slices.push(l),u.slices.push(c)),u}}},67859:(t,e,i)=>{"use strict";i.d(e,{k:()=>r}),i(91210);class r{getSlice_highlightedTransparency_slider(t){return{uid:"highlightedTransparency_slider",displayName:"Cross-Highlighted Items Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"interactivity",propertyName:"highlightedTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.interactivity.highlightedTransparency}}}}getSlice_unHighlightedTransparency_slider(t){return{uid:"unHighlightedTransparency_slider",displayName:"Unhighlighted Items Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"interactivity",propertyName:"unHighlightedTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.interactivity.unHighlightedTransparency}}}}getSlice_selectedTransparency_slider(t){return{uid:"selectedTransparency_slider",displayName:"Selected Items Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"interactivity",propertyName:"selectedTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.interactivity.selectedTransparency}}}}getSlice_unSelectedTransparency_slider(t){return{uid:"unSelectedTransparency_slider",displayName:"Unselected Items Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"interactivity",propertyName:"unSelectedTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.interactivity.unSelectedTransparency}}}}getSlice_includeLabels(t){return{uid:"include_labels",displayName:"Include Labels",description:"Set transparency for related labels",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"interactivity",propertyName:"includeLabels"},value:t.interactivity.includeLabels}}}}getGroup_interactivity_selection(t){const e=this.getSlice_unSelectedTransparency_slider(t);return{displayName:"Item selection",uid:"group_interactivity__selection",slices:[this.getSlice_selectedTransparency_slider(t),e,this.getSlice_includeLabels(t)]}}getGroup_interactivity_highlighting(t){const e=this.getSlice_unHighlightedTransparency_slider(t);return{displayName:"Cross Highlighted Items",uid:"group_interactivity__highlighting",slices:[this.getSlice_highlightedTransparency_slider(t),e]}}getCard_interactivity(t){const e={description:"Interactivity Configuration",displayName:"Interactivity",suppressDisplayName:!0,uid:"interactivity_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_interactivity_selection(t);e.groups.push(i);const r=this.getGroup_interactivity_highlighting(t);return e.groups.push(r),e}}},64993:(t,e,i)=>{"use strict";i.d(e,{g:()=>o}),i(91210);var r=i(91431),n=i(889);class o{formattingHelpers;getControl_fontControl(t){return{type:"FontControl",properties:{fontFamily:{descriptor:{objectName:"labels",propertyName:"fontFamily"},value:t.labels.fontFamily},fontSize:{descriptor:{objectName:"labels",propertyName:"fontSize"},value:t.labels.fontSize},bold:{descriptor:{objectName:"labels",propertyName:"fontBold"},value:t.labels.fontBold},italic:{descriptor:{objectName:"labels",propertyName:"fontItalic"},value:t.labels.fontItalic},underline:{descriptor:{objectName:"labels",propertyName:"fontUnderline"},value:t.labels.fontUnderline}}}}getSlice_font(t){return{uid:"label_font",displayName:"Font",control:this.getControl_fontControl(t)}}getSlice_labelText(t){return{uid:"label_labelText",displayName:"Label Text",control:{type:"TextInput",properties:{descriptor:{objectName:"labels",propertyName:"labelText",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},placeholder:"",value:t.labels.labelText}}}}getAlignmentGroup(t){return null==this.formattingHelpers&&(this.formattingHelpers=new r.t),{displayName:"Alignment",uid:"container_container_group_uid",slices:[this.formattingHelpers.createDropdownSliceFromList("container_position_slice_uid","Position (circles & images)","labels","position",t.labels.position,[{value:"above",displayName:"Above"},{value:"below",displayName:"Below"},{value:"left",displayName:"Left"},{value:"right",displayName:"Right"},{value:"center",displayName:"Center"}],!0),{uid:"container_marginPadding_slice_uid",displayName:"Margins",control:{type:"MarginPadding",properties:{left:{descriptor:{objectName:"labels",propertyName:"paddingLeft"},value:t.labels.paddingLeft},right:{descriptor:{objectName:"labels",propertyName:"paddingRight"},value:t.labels.paddingRight},top:{descriptor:{objectName:"labels",propertyName:"paddingTop"},value:t.labels.paddingTop},bottom:{descriptor:{objectName:"labels",propertyName:"paddingBottom"},value:t.labels.paddingBottom}}}}]}}getSlice_labels_show(t){return{uid:"labels_show",displayName:"Display Label",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"labels",propertyName:"show",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.labels.show}}}}getSlice_labels_displayContainer(t){return{uid:"labels_displayContainer",displayName:"Display Container",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"labels",propertyName:"displayContainer",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:t.labels.displayContainer}}}}getSlice_fontColor(t){return{uid:"label_font_Color",displayName:"Text Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"labels",propertyName:"fontColor",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.labels.fontColor}}}}}getSlice_outlineColor(t){return{uid:"label_border_Color",displayName:"Border Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"labels",propertyName:"outlineColor",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.labels.outlineColor}}}}}getSlice_fillColor(t){return{uid:"label_fill_Color",displayName:"Fill Color",control:{type:"ColorPicker",properties:{descriptor:{objectName:"labels",propertyName:"fillColor",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},value:{value:t.labels.fillColor}}}}}getSlice_outlineWidth_numUpDown(t){return{uid:"labels_outlineWidth_numUpDown",displayName:"Border Width",control:{type:"NumUpDown",properties:{descriptor:{objectName:"labels",propertyName:"outlineWidth",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:20}},value:t.labels.outlineWidth}}}}getSlice_borderRadius(t){return{uid:"labels_borderRadius",displayName:"Border Radius",control:{type:"NumUpDown",properties:{descriptor:{objectName:"labels",propertyName:"borderRadius",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:90}},value:t.labels.outlineWidth}}}}getSlice_labels_transparency_slider(t){return{uid:"labels_transparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"labels",propertyName:"transparency",selector:n.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.labels.transparency}}}}getGroup_label_font(t){const e=this.getSlice_labels_show(t),i=this.getSlice_font(t),r=this.getSlice_fontColor(t);return{displayName:"Text",uid:"group_label_formatting",slices:[e,this.getSlice_labelText(t),i,r]}}getGroup_label_container(t){const e=this.getSlice_labels_displayContainer(t),i=this.getSlice_outlineColor(t),r=this.getSlice_outlineWidth_numUpDown(t),n=this.getSlice_fillColor(t),o=this.getSlice_labels_transparency_slider(t);return{displayName:"Container",uid:"group_label_container",slices:[e,i,r,this.getSlice_borderRadius(t),n,o]}}getCard_labels(t){const e={displayName:"Labels",suppressDisplayName:!1,uid:"label_formatting_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_label_font(t);e.groups.push(i);const r=this.getAlignmentGroup(t);e.groups.push(r);const n=this.getGroup_label_container(t);return e.groups.push(n),e}}},66722:(t,e,i)=>{"use strict";i.d(e,{T:()=>r}),i(91210);class r{getSlice_map_limitMap_toggle(t){return{uid:"map_limitMap_toggle",displayName:"Limit Map to Bounding Box",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"map",propertyName:"limitMap"},value:t.map.limitMap}},disabled:!1}}createReadOnlyTextSlice(t,e){return{uid:t,displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"map",propertyName:t},value:e}}}}getSlice_map_westBoundLongitude(t){return{uid:"map_westBoundLongitude",displayName:"West Bound Longitude",control:{type:"TextInput",properties:{descriptor:{objectName:"map",propertyName:"westBoundLongitude"},value:t.map.westBoundLongitude.toString(),placeholder:""}}}}getSlice_map_eastBoundLongitude(t){return{uid:"map_eastBoundLongitude",displayName:"East Bound Longitude",control:{type:"TextInput",properties:{descriptor:{objectName:"map",propertyName:"eastBoundLongitude"},value:t.map.eastBoundLongitude.toString(),placeholder:""}}}}getSlice_map_northBoundLatitude(t){return{uid:"map_northBoundLatitude",displayName:"North Bound Latitude",control:{type:"TextInput",properties:{descriptor:{objectName:"map",propertyName:"northBoundLatitude"},value:t.map.northBoundLatitude.toString(),placeholder:""}}}}getSlice_map_southBoundLatitude(t){return{uid:"map_southBoundLatitude",displayName:"South Bound Latitude",control:{type:"TextInput",properties:{descriptor:{objectName:"map",propertyName:"southBoundLatitude"},value:t.map.southBoundLatitude.toString(),placeholder:""}}}}getGroup_map_mapBounds(t){const e={displayName:"Map Bounds",uid:"group_map_mapBounds",slices:[this.getSlice_map_limitMap_toggle(t)]};if("ordnanceSurvey"===t.background.mapSource){const t=this.createReadOnlyTextSlice("os_map","Ordnance Survey background limits bounds to United Kingdom");e.slices.push(t)}if(t.map.limitMap){const i=this.getSlice_map_westBoundLongitude(t);e.slices.push(i);const r=this.getSlice_map_eastBoundLongitude(t);e.slices.push(r);const n=this.getSlice_map_northBoundLatitude(t);e.slices.push(n);const o=this.getSlice_map_southBoundLatitude(t);e.slices.push(o)}return e}getSlice_map_minZoom(t){return{uid:"map_minZoom",displayName:"Min Zoom Level",control:{type:"NumUpDown",properties:{descriptor:{objectName:"zoom",propertyName:"minZoom"},value:t.zoom.minZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:22}}}}}}getSlice_map_defaultLong(t){return{uid:"map_defaultlong",displayName:"Default Longitude",control:{type:"NumUpDown",properties:{descriptor:{objectName:"defaultZoom",propertyName:"defaultLong"},value:t.zoom.defaultLong}}}}getSlice_map_defaultLat(t){return{uid:"map_defaultlat",displayName:"Default Latitude",control:{type:"NumUpDown",properties:{descriptor:{objectName:"defaultZoom",propertyName:"defaultLat"},value:t.zoom.defaultLat}}}}getSlice_map_defaultZoom(t){return{uid:"map_defaultzoom",displayName:"Default Zoom Level",control:{type:"NumUpDown",properties:{descriptor:{objectName:"defaultZoom",propertyName:"defaultZoom"},value:t.zoom.defaultZoom}}}}getSlice_map_maxZoom(t){return{uid:"map_maxZoom",displayName:"Max Zoom Level",control:{type:"NumUpDown",properties:{descriptor:{objectName:"zoom",propertyName:"maxZoom"},value:t.zoom.maxZoom,options:{minValue:{type:0,value:0},maxValue:{type:1,value:22}}}}}}getSlice_zoom_increment(t){return{uid:"zoom_increment",displayName:"Zoom Increment",control:{type:"NumUpDown",properties:{descriptor:{objectName:"zoom",propertyName:"zoomIncrement"},value:t.zoom.zoomIncrement,options:{minValue:{type:0,value:0},maxValue:{type:1,value:4}}}}}}getSlice_zoom_level_for_single(t){return{uid:"zoom_level_for_single",displayName:"Zoom Level When Single Item",control:{type:"NumUpDown",properties:{descriptor:{objectName:"zoom",propertyName:"zoomLevelForSingle"},value:t.zoom.zoomLevelForSingle,options:{minValue:{type:0,value:t.zoom.minZoom},maxValue:{type:1,value:t.zoom.maxZoom}}}}}}getSlice_auto_zoom(t){return{uid:"auto_zoom",displayName:"Auto Zoom",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"zoom",propertyName:"autoZoom"},value:t.zoom.autoZoom}}}}getSlice_lock_zoom(t){return{uid:"lock_zoom",displayName:"Lock Zoom",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"zoom",propertyName:"lockZoom"},value:t.zoom.lockZoom}}}}getSlice_zoom_to_selected(t){return{uid:"zoom_to_selected",displayName:"Zoom to Selected Items",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"zoom",propertyName:"zoomToSelected"},value:t.zoom.zoomToSelected}}}}getSlice_zoom_after_unselect(t){return{uid:"zoom_after_unselect",displayName:"Reset zoom after unselect",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"zoom",propertyName:"zoomAfterUnSelect"},value:t.zoom.zoomAfterUnSelect}}}}getSlice_zoom_to_highlighted(t){return{uid:"zoom_to_highlighted",displayName:"Zoom to Cross-Highlighted Items",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"zoom",propertyName:"zoomToHighlighted"},value:t.zoom.zoomToHighlighted}}}}getGroup_map_zoom(t){const e=this.getSlice_map_minZoom(t),i=this.getSlice_map_maxZoom(t),r=this.getSlice_zoom_increment(t),n=this.getSlice_auto_zoom(t),o=this.getSlice_lock_zoom(t),s=this.getSlice_zoom_to_selected(t),a=this.getSlice_zoom_after_unselect(t),l=this.getSlice_zoom_to_highlighted(t);return{displayName:"Zoom",uid:"group_map_zoom",slices:[e,i,this.getSlice_zoom_level_for_single(t),r,n,o,s,a,l,this.getSlice_map_defaultLat(t),this.getSlice_map_defaultLong(t),this.getSlice_map_defaultZoom(t)]}}getCard_map(t){const e={description:"Map Configuration",displayName:"Map",suppressDisplayName:!0,uid:"map_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_map_mapBounds(t);e.groups.push(i);const r=this.getGroup_map_zoom(t);return e.groups.push(r),e}}},72007:(t,e,i)=>{"use strict";i.d(e,{a:()=>p}),i(91210);var r=i(46012),n=i(53649),o=i(58105),s=i(13377),a=i(79367),l=i(36311),c=i(39159),u=i(50547),h=i(47313);class p{getSlice_overlays_mapLabels_boolean(t){return{uid:"overlays_mapLabels_boolean",displayName:"Map Labels",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"mapLabels"},value:t.overlays.mapLabels}}}}getSlice_overlays_traffic_boolean(t){return{uid:"overlays_traffic_boolean",displayName:"Traffic",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"traffic"},value:t.overlays.traffic}}}}getSlice_overlays_weather_boolean(t){return{uid:"overlays_weather_boolean",displayName:"Weather",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"weather"},value:t.overlays.weather}}}}getSlice_overlays_daylightTerminator_boolean(t){return{uid:"overlays_daylightTerminator_boolean",displayName:"Daylight Terminator",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"daylightTerminator"},value:t.overlays.daylightTerminator}}}}getSlice_overlays_geoJSONFile_boolean(t){return{uid:"overlays_geoJSONFile_boolean",displayName:"GeoJSON / Shape / KML File",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"geoJSONFile"},value:t.overlays.geoJSONFile}}}}getSlice_overlays_esriLayer_boolean(t){return{uid:"overlays_esriLayer_boolean",displayName:"Esri Layer",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"esriLayer"},value:t.overlays.esriLayer}}}}getSlice_overlays_rasterLayer_boolean(t){return{uid:"overlays_rasterLayer_boolean",displayName:"Raster Layer",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"rasterLayer"},value:t.overlays.rasterLayer}}}}getSlice_overlays_openSeaMap_boolean(t){return{uid:"overlays_openSeaMap_boolean",displayName:"OpenSeaMap",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"openSeaMap"},value:t.overlays.openSeaMap}}}}getSlice_overlays_openRailMap_boolean(t){return{uid:"overlays_openRailMap_boolean",displayName:"OpenRailMap",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"openRailMap"},value:t.overlays.openRailMap}}}}getSlice_overlays_wms_boolean(t){return{uid:"overlays_wms_boolean",displayName:"WMS Layer",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"wms"},value:t.overlays.wms}}}}getSlice_overlays_vector_boolean(t){return{uid:"overlays_vector_boolean",displayName:"Vector Layer",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"vector"},value:t.overlays.vector}}}}getGroup_overlays(t){const e={displayName:"Layer Selection",uid:"group_overlays",slices:[]},i=this.getSlice_overlays_mapLabels_boolean(t);e.slices.push(i);const r=this.getSlice_overlays_traffic_boolean(t);e.slices.push(r);const n=this.getSlice_overlays_weather_boolean(t);e.slices.push(n);const o=this.getSlice_overlays_daylightTerminator_boolean(t);e.slices.push(o);const s=this.getSlice_overlays_geoJSONFile_boolean(t);e.slices.push(s);const a=this.getSlice_overlays_esriLayer_boolean(t);e.slices.push(a);const l=this.getSlice_overlays_wms_boolean(t);e.slices.push(l);const c=this.getSlice_overlays_rasterLayer_boolean(t);e.slices.push(c);const u=this.getSlice_overlays_vector_boolean(t);return e.slices.push(u),e}getCard_overlays(t){const e={displayName:"Overlays / Reference Layers",suppressDisplayName:!0,uid:"overlays_uid",groups:[],revertToDefaultDescriptors:[]},i=this.getGroup_overlays(t);if(e.groups.push(i),t.overlays.mapLabels){const i=(new o.g).getGroup_overlay_labels(t);e.groups.push(i)}if(t.overlays.weather){const i=(new r.V).getGroup_overlay_weather(t);e.groups.push(i)}if(t.overlays.traffic){const i=(new n.e).getGroup_overlay_traffic(t);e.groups.push(i)}if(t.overlays.vector){const i=(new s.M).getGroup_overlay_vector(t);e.groups.push(i)}if(t.overlays.daylightTerminator){const i=(new a.m).getGroup_overlay_terminator(t);e.groups.push(i)}if(t.overlays.esriLayer){const i=(new c.s).getGroup_overlays_esriFeaturesConfiguration(t);e.groups.push(i)}if(t.overlays.geoJSONFile){const i=(new l.k).getGroup_overlays_geoJSONConfiguration(t);e.groups.push(i)}if(t.overlays.rasterLayer){const i=(new u.u).getGroup_overlay_raster(t);e.groups.push(i)}if(t.overlays.wms){const i=(new h.C).getGroup_overlay_wms(t);e.groups.push(i)}return e}}},39159:(t,e,i)=>{"use strict";i.d(e,{s:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_overlays_esriFeaturesConfiguration(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"Esri Layer - Configuration",uid:"group_overlays_esriFeaturesConfiguration",expanded:!1,slices:[]};return e.slices.push(this.formattingHelpers.createTextInputSlice("esriOverlay_esriFeatureLayerURL_text","Esri ArcGIS Feature Layer URL","overlays","esriLayerURL",t.overlays.esriLayerURL,!0)),e.slices.push(this.formattingHelpers.createColorSlice("esriOverlay_outlineColor_colorPicker","Outline Color","overlays","esriOutlineColor",t.overlays.esriOutlineColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("esriOverlay_outlineTransparency_slider","Outline Transparency","overlays","esriOutlineTransparency",t.overlays.esriOutlineTransparency,0,100,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("esriOverlay_outlineWidth_numUpDown","Outline Width","overlays","esriOutlineWidth",t.overlays.esriOutlineWidth,0,100,!1)),e.slices.push(this.formattingHelpers.createTextInputSlice("esriOverlay_outline_dashArray_text","Outline Dash Array","overlays","esriOutlineDashArray",t.overlays.esriOutlineDashArray,!1)),e.slices.push(this.formattingHelpers.createColorSlice("esriOverlay_fillColor_colorPicker","Fill Color","overlays","esriFillColor",t.overlays.esriFillColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("esriOverlay_fillTransparency_slider","Fill Transparency","overlays","esriFillTransparency",t.overlays.esriFillTransparency,0,100,!1)),e.slices.push(this.formattingHelpers.createToggleSlice("esriOverlay_includeTooltips_toggle","Include Tooltips","overlays","esriIncludeTooltips",t.overlays.esriIncludeTooltips,!1)),e.slices.push(this.formattingHelpers.createToggleSlice("esriOverlay_includeInAutoZoom_toggle","Include in Auto Zoom","overlays","esriIncludeInAutoZoom",t.overlays.esriIncludeInAutoZoom,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("esriOverlay_zIndex_numUpDown","Z-Index","overlays","esriZIndex",t.overlays.esriZIndex,0,1e3,!1)),e}}},36311:(t,e,i)=>{"use strict";i.d(e,{k:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_overlays_geoJSONConfiguration(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"GeoJSON / Shape / KML Configuration",uid:"group_overlays_geoJSONConfiguration",expanded:!1,slices:[]},i=[];return i.push({value:"url",displayName:"URL"}),i.push({value:"file",displayName:"Uploaded File"}),e.slices.push(this.formattingHelpers.createDropdownSliceFromList("slice_overlays_geojson_source","Source","overlays","geoJSONFileSource",t.overlays.geoJSONFileSource,i,!1)),"url"==t.overlays.geoJSONFileSource?e.slices.push(this.formattingHelpers.createTextInputSlice("slice_overlays_geojson_url","URL","overlays","geoJSONFileURL",t.overlays.geoJSONFileURL,!0)):(e.slices.push(this.formattingHelpers.createToggleSlice("slice_overlays_geojson_uploadFile","Display File Upload Button","geoJSONFileOverlay","geoJSONFileUpload",t.geoJSONFileOverlay.geoJSONFileUpload,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_overlays_geojson_precision","Max Coordinate Precision","overlays","geoJSONFilePrecision",t.overlays.geoJSONFilePrecision,0,12,!1))),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_overlays_geojson_simplificationLevel","Degrees of Simplification","overlays","geoJSONFileSimplification",t.overlays.geoJSONFileSimplification,0,1,!1)),e.slices.push(this.formattingHelpers.createToggleSlice("slice_overlays_geojson_showTooltips","Show Tooltips","overlays","geoJSONShowTooltips",t.overlays.geoJSONShowTooltips,!1)),e.slices.push(this.formattingHelpers.createToggleSlice("slice_overlays_geojson_overrideStyle","Override Style","overlays","geoJSONFileOverrideStyle",t.overlays.geoJSONFileOverrideStyle,!1)),e.slices.push(this.formattingHelpers.createColorSlice("slice_overlays_geojson_fillColor","Fill Color","overlays","geoJSONFileFillColor",t.overlays.geoJSONFileFillColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("slice_overlays_geojson_fillOpacity","Fill Transparency","overlays","geoJSONFileFillTransparency",t.overlays.geoJSONFileFillTransparency,0,100,!1)),e.slices.push(this.formattingHelpers.createColorSlice("slice_overlays_geojson_outlineColor","Outline Color","overlays","geoJSONFileOutlineColor",t.overlays.geoJSONFileOutlineColor,!1)),e.slices.push(this.formattingHelpers.createSliderSlice("slice_overlays_geojson_outlineOpacity","Outline Transparency","overlays","geoJSONFileOutlineTransparency",t.overlays.geoJSONFileOutlineTransparency,0,100,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_overlays_geojson_outlineWidth","Outline Width","overlays","geoJSONFileOutlineWidth",t.overlays.geoJSONFileOutlineWidth,0,100,!1)),e.slices.push(this.formattingHelpers.createTextInputSlice("slice_overlays_geojson_outline_dashArray","Outline Dash Array","overlays","geoJSONFileOutlineDashArray",t.overlays.geoJSONFileOutlineDashArray,!1)),e.slices.push(this.formattingHelpers.createNumUpDownSlice("slice_overlays_zIndex_numUpDown","Z-Index","overlays","geoJSONFileZIndex",t.overlays.geoJSONFileZIndex,0,1e3,!1)),e}}},58105:(t,e,i)=>{"use strict";i.d(e,{g:()=>o}),i(91210);var r=i(38170),n=i.n(r);class o{getSlice_minZoom(t){return{uid:"labels_minzoom_slider",displayName:"Minimum Zoom Level",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"labelsMinZoom"},options:{minValue:{type:0,value:t.zoom.minZoom},maxValue:{type:1,value:t.zoom.maxZoom}},value:t.overlays.labelsMinZoom}}}}getSlice_maxZoom(t){return{uid:"labels_maxzoom_slider",displayName:"Maximum Zoom Level",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"labelsMaxZoom"},options:{minValue:{type:0,value:t.zoom.minZoom},maxValue:{type:1,value:t.zoom.maxZoom}},value:t.overlays.labelsMaxZoom}}}}getSlice_zIndex(t){return{uid:"labels_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"overlays",propertyName:"labelsZIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.overlays.labelsZIndex}}}}getSlice_overlays_labelsource(t){return{uid:"slice_overlays_labelsource",displayName:"Labels Source",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"labelSource"},value:t.overlays.labelSource}}}}getSlice_overlays_labels_note(t){return{uid:"overlays_labels_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"overlays",propertyName:"labelsnote"},value:t}}}}getSlice_overlays_esriLanguage_dropdown(t){let e=!0;return t.overlays.esriLabelStyle.indexOf("osm")>-1&&(e=!1),{uid:"overlays_esriLanguage_dropdown",displayName:"Language",suppressDisplayName:!1,disabled:e,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"esriLanguage"},value:t.overlays.esriLanguage}}}}getSlice_overlays_esrilabelstyle(t){const e=[];e.push({value:"arcgis/light-gray/labels",displayName:"Esri - Light Gray"}),e.push({value:"arcgis/dark-gray/labels",displayName:"Esri - Dark Gray"}),e.push({value:"arcgis/human-geography/labels",displayName:"Esri - Human Geography"}),e.push({value:"arcgis/human-geography-dark/labels",displayName:"Esri - Human Geography Dark"}),e.push({value:"osm/light-gray/labels",displayName:"OSM - Light Gray Labels"}),e.push({value:"osm/dark-gray/labels",displayName:"OSM - Dark Gray Labels"});const i=e.findIndex((e=>e.value===t.overlays.esriLabelStyle));return{uid:"slice_overlays_esrilabelstyle",displayName:"Label Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"esriLabelStyle"},value:e[i],items:e}}}}getSlice_overlays_iconMapLabelstyle(t){const e=[];try{const t=n()("GET","https://api.iconmappro.com/api/styles.json"),i=JSON.parse(t.getBody("utf8")).styles.filter((t=>"labels"===t.type));for(let t=0;t<i.length;t++)e.push({value:i[t].url,displayName:i[t].name})}catch(t){console.error(t)}const i=e.findIndex((e=>e.value===t.overlays.iconMapLabelStyle));return{uid:"slice_overlays_iconMapLabelstyle",displayName:"Label Style",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"iconMapLabelStyle"},value:e[i],items:e}}}}getGroup_overlay_labels(t){const e={displayName:"Labels Configuration",uid:"group_overlay_labels",slices:[this.getSlice_overlays_labelsource(t)]};return"azureMaps"===t.overlays.labelSource&&""===t.apiKeys.azureMaps&&e.slices.push(this.getSlice_overlays_labels_note("Please configure the Azure Maps API key in the API Keys section of the formatting pane.")),"esri"===t.overlays.labelSource&&""===t.apiKeys.esri&&e.slices.push(this.getSlice_overlays_labels_note("Please configure the Esri Arc GIS API key in the API Keys section of the formatting pane.")),"esri"===t.overlays.labelSource&&(e.slices.push(this.getSlice_overlays_esrilabelstyle(t)),e.slices.push(this.getSlice_overlays_esriLanguage_dropdown(t))),"iconMap"===t.overlays.labelSource&&e.slices.push(this.getSlice_overlays_iconMapLabelstyle(t)),e.slices.push(this.getSlice_zIndex(t)),e}}},50547:(t,e,i)=>{"use strict";i.d(e,{u:()=>n});var r=i(91431);class n{formattingHelpers;getGroup_overlay_raster(t){return null==this.formattingHelpers&&(this.formattingHelpers=new r.t),{displayName:"Raster Configuration",uid:"group_overlay_raster",slices:[this.formattingHelpers.createTextInputSlice("slice_overlay_raster_url","URL template for tile server","overlays","rasterURL",t.overlays.rasterURL,!0),this.formattingHelpers.createSliderSlice("slice_overlay_raster_transparency","Transparency","overlays","rasterTransparency",t.overlays.rasterTransparency,0,100,!1),this.formattingHelpers.createNumUpDownSlice("slice_overlay_raster_minZoom","Min Zoom","overlays","rasterMinZoom",t.overlays.rasterMinZoom,0,1e3,!1),this.formattingHelpers.createNumUpDownSlice("slice_overlay_raster_maxZoom","Max Zoom","overlays","rasterMaxZoom",t.overlays.rasterMaxZoom,0,1e3,!1),this.formattingHelpers.createNumUpDownSlice("slice_overlay_raster_zIndex","Z-Index","overlays","rasterZIndex",t.overlays.rasterZIndex,0,1e3,!1)]}}}},79367:(t,e,i)=>{"use strict";i.d(e,{m:()=>r}),i(91210);class r{getSlice_transparency(t){return{uid:"terminator_transparency_slider",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"terminatorTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.overlays.terminatorTransparency}}}}getSlice_zIndex(t){return{uid:"terminator_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"overlays",propertyName:"terminatorZIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.overlays.terminatorZIndex}}}}getGroup_overlay_terminator(t){return{displayName:"Daylight Terminator Configuration",uid:"group_overlay_terminator",slices:[this.getSlice_transparency(t),this.getSlice_zIndex(t)]}}}},53649:(t,e,i)=>{"use strict";i.d(e,{e:()=>r}),i(91210);class r{getSlice_overlays_trafficlayer(t){const e=[];"azureMaps"===t.overlays.trafficSource&&(e.push({value:"microsoft.traffic.flow.absolute",displayName:"Traffic Flow - absolute"}),e.push({value:"microsoft.traffic.flow.reduced-sensitivity",displayName:"Traffic Flow - reduced sensitivity"}),e.push({value:"microsoft.traffic.flow.relative",displayName:"Traffic Flow - relative"}),e.push({value:"microsoft.traffic.flow.relative-delay",displayName:"Traffic Flow - relative delay"}),e.push({value:"microsoft.traffic.incident.night",displayName:"Traffic Incident - Night"}),e.push({value:"microsoft.traffic.incident.s1",displayName:"Traffic Incident - S1"}),e.push({value:"microsoft.traffic.incident.s2",displayName:"Traffic Incident - S2"}),e.push({value:"microsoft.traffic.incident.s3",displayName:"Traffic Incident - S3"}));const i=e.findIndex((e=>e.value===t.overlays.trafficLayer));return{uid:"slice_overlays_trafficlayer",displayName:"Traffic Layer",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"trafficLayer"},value:e[i],items:e}}}}getSlice_zIndex(t){return{uid:"traffic_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"overlays",propertyName:"trafficZIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.overlays.trafficZIndex}}}}getSlice_overlays_trafficsource(t){return{uid:"slice_overlays_trafficsource",displayName:"Traffic Source",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"trafficSource"},value:t.overlays.trafficSource}}}}getSlice_overlays_traffic_note(t){return{uid:"overlays_traffic_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"overlays",propertyName:"note"},value:t}}}}getGroup_overlay_traffic(t){const e={displayName:"Traffic Configuration",uid:"group_overlay_traffic",slices:[this.getSlice_overlays_trafficsource(t)]};if("azureMaps"==t.overlays.trafficSource&&(e.slices.push(this.getSlice_overlays_trafficlayer(t)),""===t.apiKeys.azureMaps&&e.slices.push(this.getSlice_overlays_traffic_note("Please configure the Azure Maps API key in the API Keys section of the formatting pane.")),e.slices.push(this.getSlice_zIndex(t))),"googleMaps"==t.overlays.trafficSource){let i="";""==t.apiKeys.googleMaps&&(i+="Please configure the Google Maps API key in the API Keys section of the formatting pane. "),"googleMaps"!=t.background.mapSource&&(i+="Google Maps must be used as a background map in order to use Google Maps traffic. "),""!=i&&e.slices.push(this.getSlice_overlays_traffic_note(i))}return e}}},13377:(t,e,i)=>{"use strict";i.d(e,{M:()=>n}),i(91210);var r=i(91431);class n{getSlice_minZoom(t){return{uid:"vectoroverlay_minzoom_slider",displayName:"Minimum Zoom Level",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"vectorMinZoom"},options:{minValue:{type:0,value:t.zoom.minZoom},maxValue:{type:1,value:t.zoom.maxZoom}},value:t.overlays.vectorMinZoom}}}}getSlice_maxZoom(t){return{uid:"vectoroverlay_maxzoom_slider",displayName:"Maximum Zoom Level",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"vectorMaxZoom"},options:{minValue:{type:0,value:t.zoom.minZoom},maxValue:{type:1,value:t.zoom.maxZoom}},value:t.overlays.vectorMaxZoom}}}}getSlice_zIndex(t){return{uid:"vectoroverlay_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"overlays",propertyName:"vectorZIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.overlays.vectorZIndex}}}}formattingHelpers;getGroup_overlay_vector(t){return null==this.formattingHelpers&&(this.formattingHelpers=new r.t),{displayName:"Vector Configuration",uid:"group_overlay_vector",slices:[this.formattingHelpers.createTextInputSlice("slice_overlay_vector_url","URL of the style JSON file","overlays","vectorURL",t.overlays.vectorURL,!0),this.getSlice_minZoom(t),this.getSlice_maxZoom(t),this.getSlice_zIndex(t)]}}}},46012:(t,e,i)=>{"use strict";i.d(e,{V:()=>r}),i(91210);class r{getSlice_overlays_weathersource(t){return{uid:"slice_overlays_weathersource",displayName:"Weather Source",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"weatherSource"},value:t.overlays.weatherSource}}}}getSlice_overlays_weatherTransparency(t){return{uid:"overlays_weatherTransparency",displayName:"Transparency",control:{type:"Slider",properties:{descriptor:{objectName:"overlays",propertyName:"weatherTransparency"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:100}},value:t.overlays.weatherTransparency}}}}getSlice_overlays_weatherlayer(t){const e=[];"openWeatherMap"===t.overlays.weatherSource&&(e.push({value:"clouds_new",displayName:"Clouds"}),e.push({value:"precipitation_new",displayName:"Precipitation"}),e.push({value:"pressure_new",displayName:"Sea level pressure"}),e.push({value:"wind_new",displayName:"Wind Speed"}),e.push({value:"temp_new",displayName:"Temperature"})),"openWeatherMap2"===t.overlays.weatherSource&&(e.push({value:"PAC0",displayName:"Convective precipitation"}),e.push({value:"PR0",displayName:"Precipitation intensity"}),e.push({value:"PA0",displayName:"Accumulated precipitation"}),e.push({value:"PAR0",displayName:"Accumulated precipitation - rain"}),e.push({value:"PAS0",displayName:"Accumulated precipitation - snow"}),e.push({value:"SD0",displayName:"Depth of snow"}),e.push({value:"WS10",displayName:"Wind speed at an altitude of 10 meters"}),e.push({value:"WND",displayName:"Joint display of speed wind (color) and wind direction (arrows)"}),e.push({value:"APM",displayName:"Atmospheric pressure on mean sea level"}),e.push({value:"TA2",displayName:"Air temperature at a height of 2 meters"}),e.push({value:"TD2",displayName:"Temperature of a dew point"}),e.push({value:"TS0",displayName:"Soil temperature 0-10 m"}),e.push({value:"TS10",displayName:"Soil temperature >10 m"}),e.push({value:"HRD0",displayName:"Relative humidity"}),e.push({value:"CL",displayName:"Cloudiness"})),"mapTiler"===t.overlays.weatherSource&&(e.push({value:"temperature",displayName:"Temperature"}),e.push({value:"wind",displayName:"Wind"}),e.push({value:"radar",displayName:"Radar"}),e.push({value:"rainAndSnow",displayName:"Rain & Snow"}),e.push({value:"cloudCover",displayName:"Cloud Cover"}),e.push({value:"pressure",displayName:"Pressure"})),"azureMaps"===t.overlays.weatherSource&&(e.push({value:"microsoft.weather.radar.main",displayName:"Radar"}),e.push({value:"microsoft.weather.infrared.main",displayName:"Infrared"}));const i=e.findIndex((e=>e.value===t.overlays.weatherLayer));return{uid:"slice_overlays_weatherlayer",displayName:"Weather Layer",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"weatherLayer"},value:e[i],items:e}}}}getSlice_overlays_weather_note(){return{uid:"overlays_weather_note",displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"overlays",propertyName:"note"},value:"Please configure the OpenWeatherMap API key in the API Keys section of the formatting pane. A Developer / Professional or Enterprise API Key is required for Advanced Weather Layers."}}}}getSlice_zIndex(t){return{uid:"weather_zIndex",displayName:"Z Index",control:{type:"NumUpDown",properties:{descriptor:{objectName:"overlays",propertyName:"weatherZIndex"},options:{minValue:{type:0,value:0},maxValue:{type:1,value:1e3}},value:t.overlays.weatherZIndex}}}}getGroup_overlay_weather(t){const e={displayName:"Weather Configuration",uid:"group_overlay_weather",slices:[this.getSlice_overlays_weathersource(t)]};return""===t.apiKeys.openWeatherMap&&e.slices.push(this.getSlice_overlays_weather_note()),e.slices.push(this.getSlice_overlays_weatherlayer(t)),e.slices.push(this.getSlice_overlays_weatherTransparency(t)),e.slices.push(this.getSlice_zIndex(t)),e}}},47313:(t,e,i)=>{"use strict";i.d(e,{C:()=>n}),i(91210);var r=i(91431);class n{formattingHelpers;wmsGetCapabilities="";createReadOnlyTextSlice(t,e){return{uid:t,displayName:"Note",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:"overlays",propertyName:t},value:e}}}}getSlice_overlays_wmsURL_text(t){return{uid:"overlays_wmsURL_text",displayName:"WMS Server URL",control:{type:"TextInput",properties:{descriptor:{objectName:"overlays",propertyName:"wmsURL"},placeholder:"",value:t.overlays.wmsURL}}}}getSlice_overlays_wmsLayer_dropdown(t){function e(t){const e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}const i=[];try{this.wmsGetCapabilities=function(i){let r=e(i);const n=new DOMParser;let o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer");if(0==s.length){const i=new URL(t.overlays.wmsURL),a=i.searchParams;a.delete("request"),a.append("request","GetCapabilities");const l=i.toString();if(r=e(l),o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer"),0==s.length){a.delete("service"),a.append("service","wms");const l=i.toString();r=e(l),o=n.parseFromString(r,"text/xml"),s=o.getElementsByTagName("Layer"),s.length>0&&(t.overlays.wmsURL=l)}else t.overlays.wmsURL=l}return r}(t.overlays.wmsURL);!function t(e,r){const n=e.querySelector("Name"),o=e.querySelector("Title");if(n){const t="".repeat(r);o?i.push({value:n.textContent,displayName:`${t}${o.textContent}`}):i.push({value:n.textContent,displayName:`${t}${n.textContent}`})}e.querySelectorAll(":scope > Layer").forEach((e=>t(e,r+1)))}((new DOMParser).parseFromString(this.wmsGetCapabilities,"text/xml").getElementsByTagName("Layer")[0],0)}catch(t){console.error(t)}const r=i.findIndex((e=>e.value===t.overlays.wmsLayer));return{uid:"overlays_wmsLayer_dropdown",displayName:"Layer",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"wmsLayer"},value:i[r],items:i}}}}getSlice_overlays_wmsLayer_text(t){return{uid:"overlays_wmsLayer_text",displayName:"Layer",suppressDisplayName:!1,control:{type:"TextInput",properties:{descriptor:{objectName:"overlays",propertyName:"wmsLayer"},value:t.overlays.wmsLayer,placeholder:""}}}}getSlice_overlays_wmsFormat_text(t){return{uid:"overlays_wmsFormaty_text",displayName:"Format",suppressDisplayName:!1,control:{type:"TextInput",properties:{descriptor:{objectName:"overlays",propertyName:"wmsFormat"},value:t.overlays.wmsFormat,placeholder:"image/png"}}}}getSlice_overlays_wmsFormat_dropdown(t){const e=[];try{const t=(new DOMParser).parseFromString(this.wmsGetCapabilities,"text/xml").getElementsByTagName("GetMap")[0];if(t){const i=t.getElementsByTagName("Format");for(let t=0;t<i.length;t++)"image/png"!=i[t].textContent&&"image/jpeg"!=i[t].textContent&&"image/svg+xml"!=i[t].textContent&&"image/vnd.jpeg-png"!=i[t].textContent||e.push({value:i[t].textContent,displayName:i[t].textContent})}}catch(t){console.error(t)}const i=e.findIndex((e=>e.value===t.overlays.wmsFormat));return{uid:"overlays_wmsFormaty_dropdown",displayName:"Format",suppressDisplayName:!1,control:{type:"Dropdown",properties:{descriptor:{objectName:"overlays",propertyName:"wmsFormat"},value:e[i],items:e}}}}getSlice_overlays_wmsBoundingBox_toggle(t){return{uid:"overlays_wmsPushToBounds_toggle",displayName:"Update Map Bounds",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"map",propertyName:"wmsPushToBounds"},value:t.map.wmsPushToBounds}}}}getSlice_overlays_wmsManual_toggle(t){return{uid:"overlays_wmsManual_toggle",displayName:"Manual configuration",control:{type:"ToggleSwitch",properties:{descriptor:{objectName:"overlays",propertyName:"wmsManual"},value:t.overlays.wmsManual}}}}getGroup_overlay_wms(t){null==this.formattingHelpers&&(this.formattingHelpers=new r.t);const e={displayName:"WMS Configuration",uid:"group_overlays_wmsConfiguration",slices:[]},i=this.getSlice_overlays_wmsURL_text(t);e.slices.push(i);const n=this.getSlice_overlays_wmsManual_toggle(t);if(e.slices.push(n),t.overlays.wmsManual){const i=this.getSlice_overlays_wmsLayer_text(t);e.slices.push(i);const r=this.getSlice_overlays_wmsFormat_text(t);e.slices.push(r),e.slices.push(this.formattingHelpers.createSliderSlice("slice_overlay_wms_transparency","Transparency","overlays","wmsTransparency",t.overlays.wmsTransparency,0,100,!1))}else{if(""!=t.overlays.wmsURL){const i=this.getSlice_overlays_wmsLayer_dropdown(t);e.slices.push(i)}else{const t=this.createReadOnlyTextSlice("wms_need_url","Enter a valid WMS URL. The URL should start https:// and contain a GetCapabilities request.");e.slices.push(t)}if(""!=t.overlays.wmsURL&&""!=t.overlays.wmsLayer){const i=this.getSlice_overlays_wmsFormat_dropdown(t);e.slices.push(i),this.formattingHelpers.createNumUpDownSlice("slice_overlay_wms_zIndex","Z-Index","overlays","wmsZIndex",t.overlays.wmsZIndex,0,1e3,!1),e.slices.push(this.formattingHelpers.createSliderSlice("slice_overlay_wms_transparency","Transparency","overlays","wmsTransparency",t.overlays.wmsTransparency,0,100,!1))}}return e}}},91431:(t,e,i)=>{"use strict";i.d(e,{t:()=>n});var r=i(889);class n{getDescriptor(t,e,i){let n={objectName:t,propertyName:e};return i&&(n={objectName:t,propertyName:e,selector:r.createDataViewWildcardSelector(0),altConstantValueSelector:null,instanceKind:3}),n}createNumUpDownSlice(t,e,i,r,n,o,s,a){return{uid:t,displayName:e,control:{type:"NumUpDown",properties:{descriptor:this.getDescriptor(i,r,a),options:{minValue:{type:0,value:o},maxValue:{type:1,value:s}},value:n}}}}createSliderSlice(t,e,i,r,n,o,s,a){return{uid:t,displayName:e,control:{type:"Slider",properties:{descriptor:this.getDescriptor(i,r,a),options:{minValue:{type:0,value:o},maxValue:{type:1,value:s}},value:n}}}}createColorSlice(t,e,i,r,n,o){return{uid:t,displayName:e,control:{type:"ColorPicker",properties:{descriptor:this.getDescriptor(i,r,o),value:{value:n}}}}}createDropdownSlice(t,e,i,r,n,o){return{uid:t,displayName:e,control:{type:"Dropdown",properties:{descriptor:this.getDescriptor(i,r,o),value:n}}}}createDropdownSliceFromList(t,e,i,r,n,o,s){const a=this.getDescriptor(i,r,s),l=o.findIndex((t=>t.value===n));return{uid:t,displayName:e,control:{type:"Dropdown",properties:{descriptor:a,value:o[l],items:o}}}}createToggleSlice(t,e,i,r,n,o){return{uid:t,displayName:e,control:{type:"ToggleSwitch",properties:{descriptor:this.getDescriptor(i,r,o),value:n}}}}createTextInputSlice(t,e,i,r,n,o){return{uid:t,displayName:e,control:{type:"TextInput",properties:{descriptor:this.getDescriptor(i,r,o),placeholder:"",value:n}}}}createReadOnlyTextSlice(t,e,i,r){return{uid:t,displayName:"",suppressDisplayName:!0,control:{type:"ReadOnlyText",properties:{descriptor:{objectName:e,propertyName:i},value:r}}}}}},49776:(t,e,i)=>{"use strict";i.d(e,{H:()=>r});class r{labelsDefaults(){return{horizontalAlignment:"left",verticalAlignment:"top",wordWrap:!0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,fontSize:16,fontFamily:"Segoe UI",fontBold:!1,fontUnderline:!1,fontItalic:!1,fontColor:"#000000",outlineColor:"#000000",outlineWidth:1,transparency:20,fillColor:"#FFFFFF",labelText:"",displayContainer:"yes",show:"no",borderRadius:0,position:"center"}}backgroundDefaults(){return{mapSource:"iconMap",openStreetMapSource:"standard",ordnanceSurveySource:"road",ordnanceSurveyProjection:"EPSG3857",ordnanceSurveyAPIKey:"",mapboxSource:"raster",mapboxStyle:"streets",mapboxAPIKey:"",mapboxStyleURL:"",azureMapsStyle:"microsoft.base.road",azureMapsLanguage:"en-US",azureMapsAuthenticationType:"subscriptionKey",azureMapsAPIKey:"",azureMapsClientID:"",azureMapsHillShade:!1,azureMapsLabels:"none",grayscale:0,transparency:0,esriAPIKey:"",esriArcGISStyle:"arcgis/outdoor",esriOSMStyle:"osm/standard",esriSource:"arcGIS",esriCustomStyleURL:"",esriLanguage:"global",imageURL:"",wmsURL:"",wmsLayer:"",wmsCRS:"EPSG:3857",wmsFormat:"image/png",wmsManual:!1,googleMapsSource:"roadmap",googleMapsAPIKey:"",mapTilerAPIKey:"",mapTilerSource:"standard",mapTilerTileset:"basic",mapTilerTilesetId:"",vectorTilesURL:"",rasterTilesURL:"",iconMapStyle:"https://styles.iconmappro.com/styles/standard.json"}}wktFormattingDefaults(t){return{fillColor:t.getColor("mapPushpin").value,outlineColor:t.getColor("shapeStroke").value,fillTransparency:20,outlineTransparency:0,dashArray:"",outlineWidth:2,fillStyle:"solid",hatchAngle:45,hatchWidth:2}}wktConfigurationDefaults(){return{includeWktLayer:!1,includeInZoom:"yes",includeTooltip:"yes",allowSelection:"yes",imageAtDestination:"",imageRotation:0,imageWidth:30,imageHeight:30,pointSize:5}}imageConfigurationDefaults(){return{includeImageLayer:!1,includeInZoom:"yes",includeTooltip:"yes",imageRotation:0,allowSelection:"yes",imageWidth:30,imageHeight:30,transparency:0}}circlesFormattingDefaults(t){return{fillColor:t.getColor("mapPushpin").value,outlineColor:t.getColor("shapeStroke").value,fillTransparency:20,outlineTransparency:0,dashArray:"",outlineWidth:2,fillStyle:"solid",hatchAngle:45,hatchWidth:2}}circlesConfigurationDefaults(){return{includeInZoom:"yes",minSize:5,maxSize:30,displayNull:!1,sizeBehaviour:"relative",includeTooltip:"yes",includeCircleLayer:!0,allowSelection:"yes",cluster:!1,clusterSmallInsideColor:"#6ECC39",clusterSmallOutsideColor:"#B5E28C",clusterMediumInsideColor:"#F0C20C",clusterMediumOutsideColor:"#F1D357",clusterLargeInsideColor:"#F18017",clusterLargeOutsideColor:"#FD9C73",clusterFontColor:"#000000",clusterFontFamily:"Segoe UI",clusterShowPolygon:!0,clusterPolygonColor:"#555555",clusterPolygonLineWidth:2,zIndex:400}}geoJSONConfigurationDefaults(){return{geoJSONFileSource:"url",includeGeoJsonLayer:!1,removeUnmatched:!1,allowSelection:"yes",includeTooltip:"yes",includeInZoom:"yes",matchSpecificProperty:!1,propertyToMatch1:"",propertyToMatch2:"",propertyToMatch3:"",propertyToMatch4:"",propertyToMatch5:"",addPropertyToTooltip:!1,addAllPropertiesToTooltip:!1,includeUnmatchedInZoom:!1,tooltipForUnmatched:!1,numberOfLevels:1,geoJSONFileZIndex:360,geoJSONFileURL1:"",geoJSONFileURL2:"",geoJSONFileURL3:"",geoJSONFileURL4:"",geoJSONFileURL5:"",geoJSONFileMaxZoom:22,geoJSONFileMinZoom:0,geoJSONFileSimplification:1e-4,geoJSONFilePrecision:5}}geoJsonFormatting(t){return{fillColor:t.getColor("mapPushpin").value,outlineColor:t.getColor("shapeStroke").value,fillTransparency:1,outlineTransparency:1,dashArray:"0",outlineWidth:1,fillStyle:"solid",hatchAngle:0,hatchWidth:1,unmatched_fillColor:"#CCCCCC",unmatched_outlineColor:"#555555",unmatched_fillTransparency:1,unmatched_outlineTransparency:1,unmatched_dashArray:"",unmatched_outlineWidth:1,unmatched_fillStyle:"solid",unmatched_hatchAngle:0,unmatched_hatchWidth:1,overrideStyle:!0}}vectorTileConfigurationDefaults(){return{includeVectorTileLayer:!1,allowSelection:"yes",includeTooltip:"yes",includeInZoom:"yes",matchSpecificProperty:!1,propertyToMatch1:"",propertyToMatch2:"",propertyToMatch3:"",propertyToMatch4:"",propertyToMatch5:"",addPropertyToTooltip:!1,addAllPropertiesToTooltip:!1,tooltipForUnmatched:!1,numberOfLevels:1,vectorTileURL1:"",vectorTileURL2:"",vectorTileURL3:"",vectorTileURL4:"",vectorTileURL5:""}}vectorTileFormattingDefaults(t){return{fillColor:t.getColor("mapPushpin").value,outlineColor:t.getColor("shapeStroke").value,fillTransparency:1,outlineTransparency:1,dashArray:"0",outlineWidth:1,fillStyle:"solid",hatchAngle:0,hatchWidth:1,unmatched_fillColor:"#CCCCCC",unmatched_outlineColor:"#555555",unmatched_fillTransparency:1,unmatched_outlineTransparency:1,unmatched_dashArray:"",unmatched_outlineWidth:1,unmatched_fillStyle:"solid",unmatched_hatchAngle:0,unmatched_hatchWidth:1}}esriFeatureConfigurationDefaults(){return{includeEsriFeatureLayer:!1,allowSelection:"yes",includeTooltip:"yes",includeInZoom:"yes",matchSpecificProperty:!1,propertyToMatch:"",addPropertyToTooltip:!1,addAllPropertiesToTooltip:!1,tooltipForUnmatched:!1,esriFeatureLayerURL:""}}apiKeysDefaults(){return{googleMaps:"",mapTiler:"",mapbox:"",azureMaps:"",esri:"",openWeatherMap:"",ordnanceSurvey:""}}esriFeatureFormattingDefaults(t){return{fillColor:t.getColor("mapPushpin").value,outlineColor:t.getColor("shapeStroke").value,fillTransparency:1,outlineTransparency:1,dashArray:"0",outlineWidth:1,fillStyle:"solid",hatchAngle:0,hatchWidth:1,unmatched_fillColor:"#CCCCCC",unmatched_outlineColor:"#555555",unmatched_fillTransparency:1,unmatched_outlineTransparency:1,unmatched_dashArray:"",unmatched_outlineWidth:1,unmatched_fillStyle:"solid",unmatched_hatchAngle:0,unmatched_hatchWidth:1}}mapDefaults(){return{wmsPushToBounds:!1,westBoundLongitude:-180,eastBoundLongitude:180,northBoundLatitude:90,southBoundLatitude:-90,limitMap:!1,dataMaxRows:3e4}}zoomDefaults(){return{minZoom:0,maxZoom:22,zoomIncrement:.25,defaultLong:-.1276,defaultLat:51.5072,defaultZoom:10,autoZoom:!0,lockZoom:!1,zoomToSelected:!1,zoomAfterUnSelect:!1,zoomToHighlighted:!0,zoomLevelForSingle:15}}interactivityDefaults(){return{selectedTransparency:20,unSelectedTransparency:80,includeLabels:!0,highlightedTransparency:20,unHighlightedTransparency:80}}heatmapConfigurationDefaults(){return{includeHeatmapLayer:!1,multiplier:1,includeInZoom:"yes",units:"px",size:10,alphaRange:50,transparency:20}}h3ConfigurationDefaults(t){return{h3Source:"coordinates",includeH3Layer:!1,resolution:3,startColor:t.getColor("minimum").value,midColor:t.getColor("center").value,endColor:t.getColor("maximum").value,useMidColor:!0,fillTransparency:10,outlineTransparency:10,outlineWidth:1,outlineColor:t.getColor("shapeStroke").value,allowSelection:"yes",includeInZoom:"yes",zoomBy:"polygons",zIndex:400,includeTooltips:!0}}linesFormattingDefaults(t){return{color:t.getColor("shapeStroke").value,transparency:20,dashArray:"",width:2}}linesConfigurationDefaults(){return{includeLinesLayer:!1,includeInZoom:"yes",includeTooltip:"yes",allowSelection:"yes",imageAtDestination:"",destinationImageWidth:30,destinationImageHeight:30,destinationImageRotation:0,imageAtOrigin:"",originImageWidth:30,originImageHeight:30,originImageRotation:0,linesBehavior:"straight",destinationImageTransparency:0,originImageTransparency:0}}geoJSONFileOverlayDefaults(){return{geoJSONFileUpload:!1,geoJSONFileStore:""}}overlaysDefaults(){return{wmsZIndex:255,wmsURL:"",wmsLayer:"",wmsCRS:"EPSG:4326",wmsFormat:"image/png",wmsManual:!1,mapLabels:!1,wmsTransparency:10,traffic:!1,weather:!1,daylightTerminator:!1,geoJSONFile:!1,geoJSONFileUpload:!1,esriLayer:!1,rasterLayer:!1,openSeaMap:!1,openRailMap:!1,wms:!1,weatherSource:"openWeatherMap",weatherLayer:"CL",weatherTransparency:10,trafficSource:"azureMaps",trafficLayer:"microsoft.traffic.trafficFlow",labelSource:"iconMap",iconMapLabelStyle:"standard",esriLabelStyle:"arcgis/light-gray/labels",esriLanguage:"global",esriLayerURL:"",esriOutlineColor:"#000000",esriOutlineTransparency:20,esriOutlineWidth:1,esriOutlineDashArray:"",esriFillTransparency:30,esriFillColor:"#555555",esriIncludeTooltips:!1,esriIncludeInAutoZoom:!1,labelsMinZoom:0,labelsMaxZoom:22,trafficZIndex:350,labelsZIndex:440,weatherZIndex:360,terminatorZIndex:450,terminatorTransparency:70,geoJSONFileZIndex:340,esriZIndex:345,vector:!1,vectorURL:"",vectorMinZoom:0,vectorMaxZoom:22,vectorZIndex:355,rasterURL:"",rasterMinZoom:0,rasterMaxZoom:22,rasterZIndex:354,rasterTransparency:20,geoJSONFileURL:"",geoJSONMinZoom:0,geoJSONMaxZoom:22,geoJSONFileSimplification:1e-4,geoJSONShowTooltips:!1,geoJSONFileOverrideStyle:!1,geoJSONFileOutlineTransparency:20,geoJSONFileFillTransparency:30,geoJSONFileOutlineColor:"#000000",geoJSONFileFillColor:"#555555",geoJSONFileOutlineWidth:1,geoJSONFileOutlineDashArray:"",geoJSONFileSource:"url",geoJSONFilePrecision:5}}geoJSONFileDataLayersDefaults(){return{geoJSONFileUpload1:!1,geoJSONFileStore1:"",geoJSONFileUpload2:!1,geoJSONFileStore2:"",geoJSONFileUpload3:!1,geoJSONFileStore3:"",geoJSONFileUpload4:!1,geoJSONFileStore4:"",geoJSONFileUpload5:!1,geoJSONFileStore5:""}}controlsDefaults(){return{zoom:!0,metricScale:!1,imperialScale:!0,nauticScale:!1,measureTool:!1,zoomLock:!1,lasso:!1,controlSize:30,additionalAttribution:"",lassoMode:"intersect",lassoFill:"#AAAAAA",lassoOutline:"#000000"}}}},73043:(t,e,i)=>{"use strict";i.d(e,{w:()=>y});var r=i(49776),n=i(61790),o=i(34388),s=i(66722),a=i(64993),l=i(67859),c=i(72007),u=i(76564),h=i(55584),p=i(46614),d=i.n(p);function f(t,e,i,r){if(t){const r=t[e];if(r){const t=r[i];if(void 0!==t)return t}}return r}function m(t,e,i,r){if(t){const r=t[e];if(r){const t=r[i];if(void 0!==t)return t.solid.color}}return r}function g(t){const e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText}function _(t){return Array.from(t.childNodes).find((t=>"ex_geographicboundingbox"===t.nodeName.toLowerCase()))||(t.parentNode&&t.parentNode.nodeType===Node.ELEMENT_NODE?_(t.parentNode):null)}class y{settings;iconMapVisual;configureDefaultSettings(t){const e=t.colorPalette,i=new r.H,n={background:i.backgroundDefaults(),circlesFormatting:i.circlesFormattingDefaults(e),circlesConfiguration:i.circlesConfigurationDefaults(),map:i.mapDefaults(),zoom:i.zoomDefaults(),interactivity:i.interactivityDefaults(),labels:i.labelsDefaults(),wktConfiguration:i.wktConfigurationDefaults(),wktFormatting:i.wktFormattingDefaults(e),imageConfiguration:i.imageConfigurationDefaults(),heatmapConfiguration:i.heatmapConfigurationDefaults(),h3Configuration:i.h3ConfigurationDefaults(e),vectorTileConfiguration:i.vectorTileConfigurationDefaults(),vectorTileFormatting:i.vectorTileFormattingDefaults(e),geoJsonConfiguration:i.geoJSONConfigurationDefaults(),geoJsonFormatting:i.geoJsonFormatting(e),linesConfiguration:i.linesConfigurationDefaults(),linesFormatting:i.linesFormattingDefaults(e),esriFeatureConfiguration:i.esriFeatureConfigurationDefaults(),esriFeatureFormatting:i.esriFeatureFormattingDefaults(e),overlays:i.overlaysDefaults(),controls:i.controlsDefaults(),apiKeys:i.apiKeysDefaults(),geoJSONFileOverlay:i.geoJSONFileOverlayDefaults(),geoJSONFileDataLayers:i.geoJSONFileDataLayersDefaults()};this.settings=n}configureOrdnanceSurveyBoundingBox(){this.settings.map.southBoundLatitude=49.528423,this.settings.map.westBoundLongitude=1.9134116,this.settings.map.northBoundLatitude=61.331151,this.settings.map.eastBoundLongitude=-10.76418,this.settings.map.wmsPushToBounds=!1;const t={merge:[{objectName:"map",properties:{wmsPushToBounds:this.settings.map.wmsPushToBounds,westBoundLongitude:this.settings.map.westBoundLongitude,eastBoundLongitude:this.settings.map.eastBoundLongitude,northBoundLatitude:this.settings.map.northBoundLatitude,southBoundLatitude:this.settings.map.southBoundLatitude,limitMap:this.settings.map.limitMap},selector:null}]};this.iconMapVisual.host.persistProperties(t)}configureWMSBoundingBox(){if(""==this.settings.background.wmsURL)return;const t=function(t){let e=g(t);const i=new DOMParser;let r=i.parseFromString(e,"text/xml"),n=r.getElementsByTagName("Layer");if(0==n.length){const o=new URL(t),s=o.searchParams;s.delete("request"),s.append("request","GetCapabilities"),e=g(o.toString()),r=i.parseFromString(e,"text/xml"),n=r.getElementsByTagName("Layer"),0==n.length&&(s.delete("service"),s.append("service","wms"),e=g(o.toString()))}return e}(this.settings.background.wmsURL),e=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("Layer");if(0==e.length)return;const i=[];for(let t=0;t<e.length;t++){let r=null,n=null,o="";for(let i=0;i<e[t].childNodes.length;i++)"Name"===e[t].childNodes[i].nodeName&&(r=e[t].childNodes[i]),"Title"===e[t].childNodes[i].nodeName&&(n=e[t].childNodes[i]);r&&(o=r.textContent,null!=n&&(o+=" - "+n.textContent),i.push({value:r.textContent,displayName:o}))}const r=i.findIndex((t=>t.value===this.settings.background.wmsLayer));if(-1==r)return;const n=_(e[r]);if(n)for(let t=0;t<n.childNodes.length;t++)"westboundlongitude"==n.childNodes[t].nodeName.toLowerCase()&&(this.settings.map.westBoundLongitude=parseFloat(n.childNodes[t].textContent)),"eastboundlongitude"==n.childNodes[t].nodeName.toLowerCase()&&(this.settings.map.eastBoundLongitude=parseFloat(n.childNodes[t].textContent)),"northboundlatitude"==n.childNodes[t].nodeName.toLowerCase()&&(this.settings.map.northBoundLatitude=parseFloat(n.childNodes[t].textContent)),"southboundlatitude"==n.childNodes[t].nodeName.toLowerCase()&&(this.settings.map.southBoundLatitude=parseFloat(n.childNodes[t].textContent)),this.settings.map.limitMap=!0;this.settings.map.wmsPushToBounds=!1;const o={merge:[{objectName:"map",properties:{wmsPushToBounds:this.settings.map.wmsPushToBounds,westBoundLongitude:this.settings.map.westBoundLongitude,eastBoundLongitude:this.settings.map.eastBoundLongitude,northBoundLatitude:this.settings.map.northBoundLatitude,southBoundLatitude:this.settings.map.southBoundLatitude,limitMap:this.settings.map.limitMap},selector:null}]};this.iconMapVisual.host.persistProperties(o)}configureFormattingCard(t,e){const i=new n.V,r=new o.p,p=new s.T,f=new l.k,m=new a.g;if("iconMap"==t.background.mapSource&&!e.iconMapStyles){const t="https://api.iconmappro.com/api/styles.json?v="+e.visualGUID+"&i="+e.instanceID;try{d()("GET",t).done((t=>{const i=JSON.parse(t.getBody("utf8"));e.iconMapStyles=i.styles}))}catch(t){console.error(t)}}const g=i.getCard_background(t,e),_=r.getCard_dataLayers(t),y=m.getCard_labels(t),A=p.getCard_map(t),v=f.getCard_interactivity(t),x=(new c.a).getCard_overlays(t),b=(new u.H).getCard_controls(t),w=(new h.L).getCard_apiKeys(t),S={cards:[g,x,_]};return(t.circlesConfiguration.includeCircleLayer||t.imageConfiguration.includeImageLayer||t.wktConfiguration.includeWktLayer||t.geoJsonConfiguration.includeGeoJsonLayer||t.vectorTileConfiguration.includeVectorTileLayer||t.linesConfiguration.includeLinesLayer)&&S.cards.push(y),S.cards.push(b),S.cards.push(A),S.cards.push(v),S.cards.push(w),S}updateMinMaxZoomLevels(){let t=!1;if("openStreetMap"==this.settings.background.mapSource&&(this.settings.zoom.minZoom=0,"opentopomap"==this.settings.background.openStreetMapSource?this.settings.zoom.maxZoom=17:this.settings.zoom.maxZoom=19,t=!0),"azureMaps"==this.settings.background.mapSource&&(this.settings.zoom.minZoom=0,this.settings.zoom.maxZoom=18,t=!0),"esri"==this.settings.background.mapSource&&(this.settings.zoom.minZoom=0,this.settings.zoom.maxZoom=24,t=!0),"mapbox"==this.settings.background.mapSource&&(t=!0,this.settings.zoom.minZoom=0,"raster"==this.settings.background.mapboxSource?this.settings.zoom.maxZoom=22:this.settings.zoom.maxZoom=24),"googleMaps"==this.settings.background.mapSource&&(t=!0,this.settings.zoom.minZoom=0,this.settings.zoom.maxZoom=23,"roadmap"==this.settings.background.googleMapsSource&&(this.settings.zoom.maxZoom=24)),"ordnanceSurvey"==this.settings.background.mapSource&&(t=!0,"EPSG27700"==this.settings.background.ordnanceSurveyProjection?(this.settings.zoom.minZoom=0,this.settings.zoom.maxZoom=13):(this.settings.zoom.minZoom=7,this.settings.zoom.maxZoom=20)),t){const t={merge:[{objectName:"zoom",properties:{autoZoom:this.settings.zoom.autoZoom,minZoom:this.settings.zoom.minZoom,maxZoom:this.settings.zoom.maxZoom,defaultLong:this.settings.zoom.defaultLong,defaultLat:this.settings.zoom.defaultLat,defaultZoom:this.settings.zoom.defaultZoom,zoomIncrement:this.settings.zoom.zoomIncrement},selector:null}]};this.iconMapVisual.host.persistProperties(t)}}mapSettings(t){return{wmsPushToBounds:f(t.dataViews[0].metadata.objects,"map","wmsPushToBounds",this.settings.map.wmsPushToBounds),limitMap:f(t.dataViews[0].metadata.objects,"map","limitMap",this.settings.map.limitMap),westBoundLongitude:f(t.dataViews[0].metadata.objects,"map","westBoundLongitude",this.settings.map.westBoundLongitude),eastBoundLongitude:f(t.dataViews[0].metadata.objects,"map","eastBoundLongitude",this.settings.map.eastBoundLongitude),northBoundLatitude:f(t.dataViews[0].metadata.objects,"map","northBoundLatitude",this.settings.map.northBoundLatitude),southBoundLatitude:f(t.dataViews[0].metadata.objects,"map","southBoundLatitude",this.settings.map.southBoundLatitude),dataMaxRows:f(t.dataViews[0].metadata.objects,"map","dataMaxRows",this.settings.map.dataMaxRows)}}zoomSettings(t){return{minZoom:f(t.dataViews[0].metadata.objects,"zoom","minZoom",this.settings.zoom.minZoom),maxZoom:f(t.dataViews[0].metadata.objects,"zoom","maxZoom",this.settings.zoom.maxZoom),zoomIncrement:f(t.dataViews[0].metadata.objects,"zoom","zoomIncrement",this.settings.zoom.zoomIncrement),defaultLong:f(t.dataViews[0].metadata.objects,"defaultZoom","defaultLong",this.settings.zoom.defaultLong),defaultLat:f(t.dataViews[0].metadata.objects,"defaultZoom","defaultLat",this.settings.zoom.defaultLat),defaultZoom:f(t.dataViews[0].metadata.objects,"defaultZoom","defaultZoom",this.settings.zoom.defaultZoom),autoZoom:f(t.dataViews[0].metadata.objects,"zoom","autoZoom",this.settings.zoom.autoZoom),zoomToSelected:f(t.dataViews[0].metadata.objects,"zoom","zoomToSelected",this.settings.zoom.zoomToSelected),zoomAfterUnSelect:f(t.dataViews[0].metadata.objects,"zoom","zoomAfterUnSelect",this.settings.zoom.zoomAfterUnSelect),zoomToHighlighted:f(t.dataViews[0].metadata.objects,"zoom","zoomToHighlighted",this.settings.zoom.zoomToHighlighted),lockZoom:f(t.dataViews[0].metadata.objects,"zoom","lockZoom",this.settings.zoom.lockZoom),zoomLevelForSingle:f(t.dataViews[0].metadata.objects,"zoom","zoomLevelForSingle",this.settings.zoom.zoomLevelForSingle)}}interactivitySettings(t){return{selectedTransparency:f(t.dataViews[0].metadata.objects,"interactivity","selectedTransparency",this.settings.interactivity.selectedTransparency),unSelectedTransparency:f(t.dataViews[0].metadata.objects,"interactivity","unSelectedTransparency",this.settings.interactivity.unSelectedTransparency),includeLabels:f(t.dataViews[0].metadata.objects,"interactivity","includeLabels",this.settings.interactivity.includeLabels),highlightedTransparency:f(t.dataViews[0].metadata.objects,"interactivity","highlightedTransparency",this.settings.interactivity.highlightedTransparency),unHighlightedTransparency:f(t.dataViews[0].metadata.objects,"interactivity","unHighlightedTransparency",this.settings.interactivity.unHighlightedTransparency)}}circlesConfiugrationSettings(t){return{includeCircleLayer:f(t.dataViews[0].metadata.objects,"circlesConfiguration","includeCircleLayer",this.settings.circlesConfiguration.includeCircleLayer),includeInZoom:f(t.dataViews[0].metadata.objects,"circlesConfiguration","includeInZoom",this.settings.circlesConfiguration.includeInZoom),minSize:f(t.dataViews[0].metadata.objects,"circlesConfiguration","minSize",this.settings.circlesConfiguration.minSize),maxSize:f(t.dataViews[0].metadata.objects,"circlesConfiguration","maxSize",this.settings.circlesConfiguration.maxSize),displayNull:f(t.dataViews[0].metadata.objects,"circlesConfiguration","displayNull",this.settings.circlesConfiguration.displayNull),sizeBehaviour:f(t.dataViews[0].metadata.objects,"circlesConfiguration","sizeBehaviour",this.settings.circlesConfiguration.sizeBehaviour),includeTooltip:f(t.dataViews[0].metadata.objects,"circlesConfiguration","includeTooltip",this.settings.circlesConfiguration.includeTooltip),allowSelection:f(t.dataViews[0].metadata.objects,"circlesConfiguration","allowSelection",this.settings.circlesConfiguration.allowSelection),cluster:f(t.dataViews[0].metadata.objects,"circlesConfiguration","cluster",this.settings.circlesConfiguration.cluster),clusterSmallInsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterSmallInsideColor",this.settings.circlesConfiguration.clusterSmallInsideColor),clusterSmallOutsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterSmallOutsideColor",this.settings.circlesConfiguration.clusterSmallOutsideColor),clusterMediumInsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterMediumInsideColor",this.settings.circlesConfiguration.clusterMediumInsideColor),clusterMediumOutsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterMediumOutsideColor",this.settings.circlesConfiguration.clusterMediumOutsideColor),clusterLargeInsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterLargeInsideColor",this.settings.circlesConfiguration.clusterLargeInsideColor),clusterLargeOutsideColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterLargeOutsideColor",this.settings.circlesConfiguration.clusterLargeOutsideColor),clusterFontColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterFontColor",this.settings.circlesConfiguration.clusterFontColor),clusterFontFamily:f(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterFontFamily",this.settings.circlesConfiguration.clusterFontFamily),clusterShowPolygon:f(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterShowPolygon",this.settings.circlesConfiguration.clusterShowPolygon),clusterPolygonColor:m(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterPolygonColor",this.settings.circlesConfiguration.clusterPolygonColor),clusterPolygonLineWidth:f(t.dataViews[0].metadata.objects,"circlesConfiguration","clusterPolygonLineWidth",this.settings.circlesConfiguration.clusterPolygonLineWidth),zIndex:f(t.dataViews[0].metadata.objects,"circlesConfiguration","zIndex",this.settings.circlesConfiguration.zIndex)}}circlesFormattingSettings(t){return{fillColor:m(t.dataViews[0].metadata.objects,"circlesFormatting","fillColor",this.settings.circlesFormatting.fillColor),outlineColor:m(t.dataViews[0].metadata.objects,"circlesFormatting","outlineColor",this.settings.circlesFormatting.outlineColor),fillTransparency:f(t.dataViews[0].metadata.objects,"circlesFormatting","fillTransparency",this.settings.circlesFormatting.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"circlesFormatting","outlineTransparency",this.settings.circlesFormatting.outlineTransparency),dashArray:f(t.dataViews[0].metadata.objects,"circlesFormatting","dashArray",this.settings.circlesFormatting.dashArray),outlineWidth:f(t.dataViews[0].metadata.objects,"circlesFormatting","outlineWidth",this.settings.circlesFormatting.outlineWidth),fillStyle:f(t.dataViews[0].metadata.objects,"circlesFormatting","fillStyle",this.settings.circlesFormatting.fillStyle),hatchAngle:f(t.dataViews[0].metadata.objects,"circlesFormatting","hatchAngle",this.settings.circlesFormatting.hatchAngle),hatchWidth:f(t.dataViews[0].metadata.objects,"circlesFormatting","hatchWidth",this.settings.circlesFormatting.hatchWidth)}}wktConfiugrationSettings(t){return{includeWktLayer:f(t.dataViews[0].metadata.objects,"wktConfiguration","includeWktLayer",this.settings.wktConfiguration.includeWktLayer),includeInZoom:f(t.dataViews[0].metadata.objects,"wktConfiguration","includeInZoom",this.settings.wktConfiguration.includeInZoom),includeTooltip:f(t.dataViews[0].metadata.objects,"wktConfiguration","includeTooltip",this.settings.wktConfiguration.includeTooltip),allowSelection:f(t.dataViews[0].metadata.objects,"wktConfiguration","allowSelection",this.settings.wktConfiguration.allowSelection),imageAtDestination:f(t.dataViews[0].metadata.objects,"wktConfiguration","imageAtDestination",this.settings.wktConfiguration.imageAtDestination),imageRotation:f(t.dataViews[0].metadata.objects,"wktConfiguration","imageRotation",this.settings.wktConfiguration.imageRotation),imageWidth:f(t.dataViews[0].metadata.objects,"wktConfiguration","imageWidth",this.settings.wktConfiguration.imageWidth),imageHeight:f(t.dataViews[0].metadata.objects,"wktConfiguration","imageHeight",this.settings.wktConfiguration.imageHeight),pointSize:f(t.dataViews[0].metadata.objects,"wktConfiguration","pointSize",this.settings.wktConfiguration.pointSize)}}imageConfigurationSettings(t){return{includeImageLayer:f(t.dataViews[0].metadata.objects,"imageConfiguration","includeImageLayer",this.settings.imageConfiguration.includeImageLayer),includeInZoom:f(t.dataViews[0].metadata.objects,"imageConfiguration","includeInZoom",this.settings.imageConfiguration.includeInZoom),includeTooltip:f(t.dataViews[0].metadata.objects,"imageConfiguration","includeTooltip",this.settings.imageConfiguration.includeTooltip),imageRotation:f(t.dataViews[0].metadata.objects,"imageConfiguration","imageRotation",this.settings.imageConfiguration.imageRotation),allowSelection:f(t.dataViews[0].metadata.objects,"imageConfiguration","allowSelection",this.settings.imageConfiguration.allowSelection),imageWidth:f(t.dataViews[0].metadata.objects,"imageConfiguration","imageWidth",this.settings.imageConfiguration.imageWidth),imageHeight:f(t.dataViews[0].metadata.objects,"imageConfiguration","imageHeight",this.settings.imageConfiguration.imageHeight),transparency:f(t.dataViews[0].metadata.objects,"imageConfiguration","transparency",this.settings.imageConfiguration.transparency)}}geoJSONFileDataLayersSettings(t){return{geoJSONFileUpload1:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileUpload1",this.settings.geoJSONFileDataLayers.geoJSONFileUpload1),geoJSONFileStore1:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileStore1",this.settings.geoJSONFileDataLayers.geoJSONFileStore1),geoJSONFileUpload2:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileUpload2",this.settings.geoJSONFileDataLayers.geoJSONFileUpload2),geoJSONFileStore2:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileStore2",this.settings.geoJSONFileDataLayers.geoJSONFileStore2),geoJSONFileUpload3:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileUpload3",this.settings.geoJSONFileDataLayers.geoJSONFileUpload3),geoJSONFileStore3:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileStore3",this.settings.geoJSONFileDataLayers.geoJSONFileStore3),geoJSONFileUpload4:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileUpload4",this.settings.geoJSONFileDataLayers.geoJSONFileUpload4),geoJSONFileStore4:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileStore4",this.settings.geoJSONFileDataLayers.geoJSONFileStore4),geoJSONFileUpload5:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileUpload5",this.settings.geoJSONFileDataLayers.geoJSONFileUpload5),geoJSONFileStore5:f(t.dataViews[0].metadata.objects,"geoJSONFileDataLayers","geoJSONFileStore5",this.settings.geoJSONFileDataLayers.geoJSONFileStore5)}}geoJsonConfigurationSettings(t){return{geoJSONFileSource:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileSource",this.settings.geoJsonConfiguration.geoJSONFileSource),includeGeoJsonLayer:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","includeGeoJsonLayer",this.settings.geoJsonConfiguration.includeGeoJsonLayer),removeUnmatched:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","removeUnmatched",this.settings.geoJsonConfiguration.removeUnmatched),allowSelection:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","allowSelection",this.settings.geoJsonConfiguration.allowSelection),includeTooltip:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","includeTooltip",this.settings.geoJsonConfiguration.includeTooltip),includeInZoom:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","includeInZoom",this.settings.geoJsonConfiguration.includeInZoom),matchSpecificProperty:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","matchSpecificProperty",this.settings.geoJsonConfiguration.matchSpecificProperty),numberOfLevels:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","numberOfLevels",this.settings.geoJsonConfiguration.numberOfLevels),propertyToMatch1:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","propertyToMatch1",this.settings.geoJsonConfiguration.propertyToMatch1),propertyToMatch2:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","propertyToMatch2",this.settings.geoJsonConfiguration.propertyToMatch2),propertyToMatch3:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","propertyToMatch3",this.settings.geoJsonConfiguration.propertyToMatch3),propertyToMatch4:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","propertyToMatch4",this.settings.geoJsonConfiguration.propertyToMatch4),propertyToMatch5:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","propertyToMatch5",this.settings.geoJsonConfiguration.propertyToMatch5),addPropertyToTooltip:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","addPropertyToTooltip",this.settings.geoJsonConfiguration.addPropertyToTooltip),addAllPropertiesToTooltip:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","addAllPropertiesToTooltip",this.settings.geoJsonConfiguration.addAllPropertiesToTooltip),tooltipForUnmatched:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","tooltipForUnmatched",this.settings.geoJsonConfiguration.tooltipForUnmatched),geoJSONFileURL1:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileURL1",this.settings.geoJsonConfiguration.geoJSONFileURL1),geoJSONFileURL2:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileURL2",this.settings.geoJsonConfiguration.geoJSONFileURL2),geoJSONFileURL3:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileURL3",this.settings.geoJsonConfiguration.geoJSONFileURL3),geoJSONFileURL4:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileURL4",this.settings.geoJsonConfiguration.geoJSONFileURL4),geoJSONFileURL5:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileURL5",this.settings.geoJsonConfiguration.geoJSONFileURL5),geoJSONFileZIndex:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileZIndex",this.settings.geoJsonConfiguration.geoJSONFileZIndex),geoJSONFileMaxZoom:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileMaxZoom",this.settings.geoJsonConfiguration.geoJSONFileMaxZoom),geoJSONFileMinZoom:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileMinZoom",this.settings.geoJsonConfiguration.geoJSONFileMinZoom),geoJSONFileSimplification:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFileSimplification",this.settings.geoJsonConfiguration.geoJSONFileSimplification),includeUnmatchedInZoom:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","includeUnmatchedInZoom",this.settings.geoJsonConfiguration.includeUnmatchedInZoom),geoJSONFilePrecision:f(t.dataViews[0].metadata.objects,"geoJsonConfiguration","geoJSONFilePrecision",this.settings.geoJsonConfiguration.geoJSONFilePrecision)}}geoJsonFormattingSettings(t){return{fillColor:m(t.dataViews[0].metadata.objects,"geoJsonFormatting","fillColor",this.settings.geoJsonFormatting.fillColor),outlineColor:m(t.dataViews[0].metadata.objects,"geoJsonFormatting","outlineColor",this.settings.geoJsonFormatting.outlineColor),fillTransparency:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","fillTransparency",this.settings.geoJsonFormatting.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","outlineTransparency",this.settings.geoJsonFormatting.outlineTransparency),dashArray:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","dashArray",this.settings.geoJsonFormatting.dashArray),outlineWidth:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","outlineWidth",this.settings.geoJsonFormatting.outlineWidth),fillStyle:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","fillStyle",this.settings.geoJsonFormatting.fillStyle),hatchAngle:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","hatchAngle",this.settings.geoJsonFormatting.hatchAngle),hatchWidth:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","hatchWidth",this.settings.geoJsonFormatting.hatchWidth),unmatched_fillColor:m(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_fillColor",this.settings.geoJsonFormatting.unmatched_fillColor),unmatched_outlineColor:m(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_outlineColor",this.settings.geoJsonFormatting.unmatched_outlineColor),unmatched_fillTransparency:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_fillTransparency",this.settings.geoJsonFormatting.unmatched_fillTransparency),unmatched_outlineTransparency:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_outlineTransparency",this.settings.geoJsonFormatting.unmatched_outlineTransparency),unmatched_dashArray:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_dashArray",this.settings.geoJsonFormatting.unmatched_dashArray),unmatched_outlineWidth:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_outlineWidth",this.settings.geoJsonFormatting.unmatched_outlineWidth),unmatched_fillStyle:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_fillStyle",this.settings.geoJsonFormatting.unmatched_fillStyle),unmatched_hatchAngle:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_hatchAngle",this.settings.geoJsonFormatting.unmatched_hatchAngle),unmatched_hatchWidth:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","unmatched_hatchWidth",this.settings.geoJsonFormatting.unmatched_hatchWidth),overrideStyle:f(t.dataViews[0].metadata.objects,"geoJsonFormatting","overrideStyle",this.settings.geoJsonFormatting.overrideStyle)}}vectorTileConfigurationSettings(t){return{includeVectorTileLayer:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","includeVectorTileLayer",this.settings.vectorTileConfiguration.includeVectorTileLayer),allowSelection:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","allowSelection",this.settings.vectorTileConfiguration.allowSelection),includeTooltip:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","includeTooltip",this.settings.vectorTileConfiguration.includeTooltip),includeInZoom:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","includeInZoom",this.settings.vectorTileConfiguration.includeInZoom),matchSpecificProperty:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","matchSpecificProperty",this.settings.vectorTileConfiguration.matchSpecificProperty),propertyToMatch1:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","propertyToMatch1",this.settings.vectorTileConfiguration.propertyToMatch1),propertyToMatch2:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","propertyToMatch2",this.settings.vectorTileConfiguration.propertyToMatch2),propertyToMatch3:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","propertyToMatch3",this.settings.vectorTileConfiguration.propertyToMatch3),propertyToMatch4:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","propertyToMatch4",this.settings.vectorTileConfiguration.propertyToMatch4),propertyToMatch5:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","propertyToMatch5",this.settings.vectorTileConfiguration.propertyToMatch5),addPropertyToTooltip:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","addPropertyToTooltip",this.settings.vectorTileConfiguration.addPropertyToTooltip),addAllPropertiesToTooltip:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","addAllPropertiesToTooltip",this.settings.vectorTileConfiguration.addAllPropertiesToTooltip),tooltipForUnmatched:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","tooltipForUnmatched",this.settings.vectorTileConfiguration.tooltipForUnmatched),numberOfLevels:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","numberOfLevels",this.settings.vectorTileConfiguration.numberOfLevels),vectorTileURL1:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","vectorTileURL1",this.settings.vectorTileConfiguration.vectorTileURL1),vectorTileURL2:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","vectorTileURL2",this.settings.vectorTileConfiguration.vectorTileURL2),vectorTileURL3:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","vectorTileURL3",this.settings.vectorTileConfiguration.vectorTileURL3),vectorTileURL4:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","vectorTileURL4",this.settings.vectorTileConfiguration.vectorTileURL4),vectorTileURL5:f(t.dataViews[0].metadata.objects,"vectorTileConfiguration","vectorTileURL5",this.settings.vectorTileConfiguration.vectorTileURL5)}}vectorTileFormattingSettings(t){return{fillColor:m(t.dataViews[0].metadata.objects,"vectorTileFormatting","fillColor",this.settings.vectorTileFormatting.fillColor),outlineColor:m(t.dataViews[0].metadata.objects,"vectorTileFormatting","outlineColor",this.settings.vectorTileFormatting.outlineColor),fillTransparency:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","fillTransparency",this.settings.vectorTileFormatting.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","outlineTransparency",this.settings.vectorTileFormatting.outlineTransparency),dashArray:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","dashArray",this.settings.vectorTileFormatting.dashArray),outlineWidth:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","outlineWidth",this.settings.vectorTileFormatting.outlineWidth),fillStyle:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","fillStyle",this.settings.vectorTileFormatting.fillStyle),hatchAngle:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","hatchAngle",this.settings.vectorTileFormatting.hatchAngle),hatchWidth:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","hatchWidth",this.settings.vectorTileFormatting.hatchWidth),unmatched_fillColor:m(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_fillColor",this.settings.vectorTileFormatting.unmatched_fillColor),unmatched_outlineColor:m(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_outlineColor",this.settings.vectorTileFormatting.unmatched_outlineColor),unmatched_fillTransparency:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_fillTransparency",this.settings.vectorTileFormatting.unmatched_fillTransparency),unmatched_outlineTransparency:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_outlineTransparency",this.settings.vectorTileFormatting.unmatched_outlineTransparency),unmatched_dashArray:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_dashArray",this.settings.vectorTileFormatting.unmatched_dashArray),unmatched_outlineWidth:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_outlineWidth",this.settings.vectorTileFormatting.unmatched_outlineWidth),unmatched_fillStyle:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_fillStyle",this.settings.vectorTileFormatting.unmatched_fillStyle),unmatched_hatchAngle:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_hatchAngle",this.settings.vectorTileFormatting.unmatched_hatchAngle),unmatched_hatchWidth:f(t.dataViews[0].metadata.objects,"vectorTileFormatting","unmatched_hatchWidth",this.settings.vectorTileFormatting.unmatched_hatchWidth)}}esriFeatureConfigurationSettings(t){return{includeEsriFeatureLayer:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","includeEsriFeatureLayer",this.settings.esriFeatureConfiguration.includeEsriFeatureLayer),allowSelection:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","allowSelection",this.settings.esriFeatureConfiguration.allowSelection),includeTooltip:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","includeTooltip",this.settings.esriFeatureConfiguration.includeTooltip),includeInZoom:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","includeInZoom",this.settings.esriFeatureConfiguration.includeInZoom),matchSpecificProperty:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","matchSpecificProperty",this.settings.esriFeatureConfiguration.matchSpecificProperty),propertyToMatch:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","propertyToMatch",this.settings.esriFeatureConfiguration.propertyToMatch),addPropertyToTooltip:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","addPropertyToTooltip",this.settings.esriFeatureConfiguration.addPropertyToTooltip),addAllPropertiesToTooltip:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","addAllPropertiesToTooltip",this.settings.esriFeatureConfiguration.addAllPropertiesToTooltip),tooltipForUnmatched:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","tooltipForUnmatched",this.settings.esriFeatureConfiguration.tooltipForUnmatched),esriFeatureLayerURL:f(t.dataViews[0].metadata.objects,"esriFeatureConfiguration","esriFeatureLayerURL",this.settings.esriFeatureConfiguration.esriFeatureLayerURL)}}esriFeatureFormattingSettings(t){return{fillColor:m(t.dataViews[0].metadata.objects,"esriFeatureFormatting","fillColor",this.settings.esriFeatureFormatting.fillColor),outlineColor:m(t.dataViews[0].metadata.objects,"esriFeatureFormatting","outlineColor",this.settings.esriFeatureFormatting.outlineColor),fillTransparency:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","fillTransparency",this.settings.esriFeatureFormatting.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","outlineTransparency",this.settings.esriFeatureFormatting.outlineTransparency),dashArray:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","dashArray",this.settings.esriFeatureFormatting.dashArray),outlineWidth:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","outlineWidth",this.settings.esriFeatureFormatting.outlineWidth),fillStyle:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","fillStyle",this.settings.esriFeatureFormatting.fillStyle),hatchAngle:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","hatchAngle",this.settings.esriFeatureFormatting.hatchAngle),hatchWidth:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","hatchWidth",this.settings.esriFeatureFormatting.hatchWidth),unmatched_fillColor:m(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_fillColor",this.settings.esriFeatureFormatting.unmatched_fillColor),unmatched_outlineColor:m(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_outlineColor",this.settings.esriFeatureFormatting.unmatched_outlineColor),unmatched_fillTransparency:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_fillTransparency",this.settings.esriFeatureFormatting.unmatched_fillTransparency),unmatched_outlineTransparency:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_outlineTransparency",this.settings.esriFeatureFormatting.unmatched_outlineTransparency),unmatched_dashArray:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_dashArray",this.settings.esriFeatureFormatting.unmatched_dashArray),unmatched_outlineWidth:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_outlineWidth",this.settings.esriFeatureFormatting.unmatched_outlineWidth),unmatched_fillStyle:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_fillStyle",this.settings.esriFeatureFormatting.unmatched_fillStyle),unmatched_hatchAngle:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_hatchAngle",this.settings.esriFeatureFormatting.unmatched_hatchAngle),unmatched_hatchWidth:f(t.dataViews[0].metadata.objects,"esriFeatureFormatting","unmatched_hatchWidth",this.settings.esriFeatureFormatting.unmatched_hatchWidth)}}heatmapConfigurationSettings(t){return{includeHeatmapLayer:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","includeHeatmapLayer",this.settings.heatmapConfiguration.includeHeatmapLayer),multiplier:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","multiplier",this.settings.heatmapConfiguration.multiplier),includeInZoom:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","includeInZoom",this.settings.heatmapConfiguration.includeInZoom),units:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","units",this.settings.heatmapConfiguration.units),alphaRange:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","alphaRange",this.settings.heatmapConfiguration.alphaRange),size:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","size",this.settings.heatmapConfiguration.size),transparency:f(t.dataViews[0].metadata.objects,"heatmapConfiguration","transparency",this.settings.heatmapConfiguration.transparency)}}h3ConfigurationSettings(t){return{h3Source:f(t.dataViews[0].metadata.objects,"h3Configuration","h3Source",this.settings.h3Configuration.h3Source),includeH3Layer:f(t.dataViews[0].metadata.objects,"h3Configuration","includeH3Layer",this.settings.h3Configuration.includeH3Layer),resolution:f(t.dataViews[0].metadata.objects,"h3Configuration","resolution",this.settings.h3Configuration.resolution),startColor:m(t.dataViews[0].metadata.objects,"h3Configuration","startColor",this.settings.h3Configuration.startColor),midColor:m(t.dataViews[0].metadata.objects,"h3Configuration","midColor",this.settings.h3Configuration.midColor),endColor:m(t.dataViews[0].metadata.objects,"h3Configuration","endColor",this.settings.h3Configuration.endColor),useMidColor:f(t.dataViews[0].metadata.objects,"h3Configuration","useMidColor",this.settings.h3Configuration.useMidColor),fillTransparency:f(t.dataViews[0].metadata.objects,"h3Configuration","fillTransparency",this.settings.h3Configuration.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"h3Configuration","outlineTransparency",this.settings.h3Configuration.outlineTransparency),outlineWidth:f(t.dataViews[0].metadata.objects,"h3Configuration","outlineWidth",this.settings.h3Configuration.outlineWidth),outlineColor:m(t.dataViews[0].metadata.objects,"h3Configuration","outlineColor",this.settings.h3Configuration.outlineColor),allowSelection:f(t.dataViews[0].metadata.objects,"h3Configuration","allowSelection",this.settings.h3Configuration.allowSelection),includeInZoom:f(t.dataViews[0].metadata.objects,"h3Configuration","includeInZoom",this.settings.h3Configuration.includeInZoom),zoomBy:f(t.dataViews[0].metadata.objects,"h3Configuration","zoomBy",this.settings.h3Configuration.zoomBy),zIndex:f(t.dataViews[0].metadata.objects,"h3Configuration","zIndex",this.settings.h3Configuration.zIndex),includeTooltips:f(t.dataViews[0].metadata.objects,"h3Configuration","includeTooltips",this.settings.h3Configuration.includeTooltips)}}wktFormattingSettings(t){return{fillColor:m(t.dataViews[0].metadata.objects,"wktFormatting","fillColor",this.settings.wktFormatting.fillColor),outlineColor:m(t.dataViews[0].metadata.objects,"wktFormatting","outlineColor",this.settings.wktFormatting.outlineColor),fillTransparency:f(t.dataViews[0].metadata.objects,"wktFormatting","fillTransparency",this.settings.wktFormatting.fillTransparency),outlineTransparency:f(t.dataViews[0].metadata.objects,"wktFormatting","outlineTransparency",this.settings.wktFormatting.outlineTransparency),dashArray:f(t.dataViews[0].metadata.objects,"wktFormatting","dashArray",this.settings.wktFormatting.dashArray),outlineWidth:f(t.dataViews[0].metadata.objects,"wktFormatting","outlineWidth",this.settings.wktFormatting.outlineWidth),fillStyle:f(t.dataViews[0].metadata.objects,"wktFormatting","fillStyle",this.settings.wktFormatting.fillStyle),hatchAngle:f(t.dataViews[0].metadata.objects,"wktFormatting","hatchAngle",this.settings.wktFormatting.hatchAngle),hatchWidth:f(t.dataViews[0].metadata.objects,"wktFormatting","hatchWidth",this.settings.wktFormatting.hatchWidth)}}labelsSettings(t){return{horizontalAlignment:f(t.dataViews[0].metadata.objects,"labels","horizontalAlignment",this.settings.labels.horizontalAlignment),verticalAlignment:f(t.dataViews[0].metadata.objects,"labels","verticalAlignment",this.settings.labels.verticalAlignment),wordWrap:f(t.dataViews[0].metadata.objects,"labels","wordWrap",this.settings.labels.wordWrap),paddingLeft:f(t.dataViews[0].metadata.objects,"labels","paddingLeft",this.settings.labels.paddingLeft),paddingRight:f(t.dataViews[0].metadata.objects,"labels","paddingRight",this.settings.labels.paddingRight),paddingTop:f(t.dataViews[0].metadata.objects,"labels","paddingTop",this.settings.labels.paddingTop),paddingBottom:f(t.dataViews[0].metadata.objects,"labels","paddingBottom",this.settings.labels.paddingBottom),fontSize:f(t.dataViews[0].metadata.objects,"labels","fontSize",this.settings.labels.fontSize),fontFamily:f(t.dataViews[0].metadata.objects,"labels","fontFamily",this.settings.labels.fontFamily),fontBold:f(t.dataViews[0].metadata.objects,"labels","fontBold",this.settings.labels.fontBold),fontUnderline:f(t.dataViews[0].metadata.objects,"labels","fontUnderline",this.settings.labels.fontUnderline),fontItalic:f(t.dataViews[0].metadata.objects,"labels","fontItalic",this.settings.labels.fontItalic),fontColor:m(t.dataViews[0].metadata.objects,"labels","fontColor",this.settings.labels.fontColor),outlineColor:m(t.dataViews[0].metadata.objects,"labels","outlineColor",this.settings.labels.outlineColor),outlineWidth:f(t.dataViews[0].metadata.objects,"labels","outlineWidth",this.settings.labels.outlineWidth),transparency:f(t.dataViews[0].metadata.objects,"labels","transparency",this.settings.labels.transparency),fillColor:m(t.dataViews[0].metadata.objects,"labels","fillColor",this.settings.labels.fillColor),labelText:f(t.dataViews[0].metadata.objects,"labels","labelText",this.settings.labels.labelText),show:f(t.dataViews[0].metadata.objects,"labels","show",this.settings.labels.show),displayContainer:f(t.dataViews[0].metadata.objects,"labels","displayContainer",this.settings.labels.displayContainer),borderRadius:f(t.dataViews[0].metadata.objects,"labels","borderRadius",this.settings.labels.borderRadius),position:f(t.dataViews[0].metadata.objects,"labels","position",this.settings.labels.position)}}backgroundSettings(t){return{mapSource:f(t.dataViews[0].metadata.objects,"background","mapSource",this.settings.background.mapSource),openStreetMapSource:f(t.dataViews[0].metadata.objects,"background","openStreetMapSource",this.settings.background.openStreetMapSource),ordnanceSurveySource:f(t.dataViews[0].metadata.objects,"background","ordnanceSurveySource",this.settings.background.ordnanceSurveySource),ordnanceSurveyProjection:f(t.dataViews[0].metadata.objects,"background","ordnanceSurveyProjection",this.settings.background.ordnanceSurveyProjection),ordnanceSurveyAPIKey:f(t.dataViews[0].metadata.objects,"background","ordnanceSurveyAPIKey",this.settings.background.ordnanceSurveyAPIKey),mapboxSource:f(t.dataViews[0].metadata.objects,"background","mapboxSource",this.settings.background.mapboxSource),mapboxStyle:f(t.dataViews[0].metadata.objects,"background","mapboxStyle",this.settings.background.mapboxStyle),mapboxAPIKey:f(t.dataViews[0].metadata.objects,"background","mapboxAPIKey",this.settings.background.mapboxAPIKey),mapboxStyleURL:f(t.dataViews[0].metadata.objects,"background","mapboxStyleURL",this.settings.background.mapboxStyleURL),azureMapsStyle:f(t.dataViews[0].metadata.objects,"background","azureMapsStyle",this.settings.background.azureMapsStyle),azureMapsHillShade:f(t.dataViews[0].metadata.objects,"background","azureMapsHillShade",this.settings.background.azureMapsHillShade),azureMapsLanguage:f(t.dataViews[0].metadata.objects,"background","azureMapsLanguage",this.settings.background.azureMapsLanguage),azureMapsAuthenticationType:f(t.dataViews[0].metadata.objects,"background","azureMapsAuthenticationType",this.settings.background.azureMapsAuthenticationType),azureMapsAPIKey:f(t.dataViews[0].metadata.objects,"background","azureMapsAPIKey",this.settings.background.azureMapsAPIKey),azureMapsClientID:f(t.dataViews[0].metadata.objects,"background","azureMapsClientID",this.settings.background.azureMapsClientID),azureMapsLabels:f(t.dataViews[0].metadata.objects,"background","azureMapsLabels",this.settings.background.azureMapsLabels),grayscale:f(t.dataViews[0].metadata.objects,"background","grayscale",this.settings.background.grayscale),transparency:f(t.dataViews[0].metadata.objects,"background","transparency",this.settings.background.transparency),esriSource:f(t.dataViews[0].metadata.objects,"background","esriSource",this.settings.background.esriSource),esriAPIKey:f(t.dataViews[0].metadata.objects,"background","esriAPIKey",this.settings.background.esriAPIKey),esriArcGISStyle:f(t.dataViews[0].metadata.objects,"background","esriArcGISStyle",this.settings.background.esriArcGISStyle),esriOSMStyle:f(t.dataViews[0].metadata.objects,"background","esriOSMStyle",this.settings.background.esriOSMStyle),esriCustomStyleURL:f(t.dataViews[0].metadata.objects,"background","esriCustomStyleURL",this.settings.background.esriCustomStyleURL),esriLanguage:f(t.dataViews[0].metadata.objects,"background","esriLanguage",this.settings.background.esriLanguage),wmsURL:f(t.dataViews[0].metadata.objects,"background","wmsURL",this.settings.background.wmsURL),imageURL:f(t.dataViews[0].metadata.objects,"background","imageURL",this.settings.background.imageURL),wmsLayer:f(t.dataViews[0].metadata.objects,"background","wmsLayer",this.settings.background.wmsLayer),wmsCRS:f(t.dataViews[0].metadata.objects,"background","wmsCRS",this.settings.background.wmsCRS),wmsFormat:f(t.dataViews[0].metadata.objects,"background","wmsFormat",this.settings.background.wmsFormat),wmsManual:f(t.dataViews[0].metadata.objects,"background","wmsManual",this.settings.background.wmsManual),googleMapsSource:f(t.dataViews[0].metadata.objects,"background","googleMapsSource",this.settings.background.googleMapsSource),googleMapsAPIKey:f(t.dataViews[0].metadata.objects,"background","googleMapsAPIKey",this.settings.background.googleMapsAPIKey),mapTilerSource:f(t.dataViews[0].metadata.objects,"background","mapTilerSource",this.settings.background.mapTilerSource),mapTilerTileset:f(t.dataViews[0].metadata.objects,"background","mapTilerTileset",this.settings.background.mapTilerTileset),mapTilerAPIKey:f(t.dataViews[0].metadata.objects,"background","mapTilerAPIKey",this.settings.background.mapTilerAPIKey),mapTilerTilesetId:f(t.dataViews[0].metadata.objects,"background","mapTilerTilesetId",this.settings.background.mapTilerTilesetId),vectorTilesURL:f(t.dataViews[0].metadata.objects,"background","vectorTilesURL",this.settings.background.vectorTilesURL),rasterTilesURL:f(t.dataViews[0].metadata.objects,"background","rasterTilesURL",this.settings.background.rasterTilesURL),iconMapStyle:f(t.dataViews[0].metadata.objects,"background","iconMapStyle",this.settings.background.iconMapStyle)}}linesConfigurationSettings(t){return{includeLinesLayer:f(t.dataViews[0].metadata.objects,"linesConfiguration","includeLinesLayer",this.settings.linesConfiguration.includeLinesLayer),includeInZoom:f(t.dataViews[0].metadata.objects,"linesConfiguration","includeInZoom",this.settings.linesConfiguration.includeInZoom),includeTooltip:f(t.dataViews[0].metadata.objects,"linesConfiguration","includeTooltip",this.settings.linesConfiguration.includeTooltip),allowSelection:f(t.dataViews[0].metadata.objects,"linesConfiguration","allowSelection",this.settings.linesConfiguration.allowSelection),destinationImageWidth:f(t.dataViews[0].metadata.objects,"linesConfiguration","destinationImageWidth",this.settings.linesConfiguration.destinationImageWidth),destinationImageHeight:f(t.dataViews[0].metadata.objects,"linesConfiguration","destinationImageHeight",this.settings.linesConfiguration.destinationImageHeight),imageAtDestination:f(t.dataViews[0].metadata.objects,"linesConfiguration","imageAtDestination",this.settings.linesConfiguration.imageAtDestination),destinationImageRotation:f(t.dataViews[0].metadata.objects,"linesConfiguration","destinationImageRotation",this.settings.linesConfiguration.destinationImageRotation),originImageWidth:f(t.dataViews[0].metadata.objects,"linesConfiguration","originImageWidth",this.settings.linesConfiguration.originImageWidth),originImageHeight:f(t.dataViews[0].metadata.objects,"linesConfiguration","originImageHeight",this.settings.linesConfiguration.originImageHeight),imageAtOrigin:f(t.dataViews[0].metadata.objects,"linesConfiguration","imageAtOrigin",this.settings.linesConfiguration.imageAtOrigin),originImageRotation:f(t.dataViews[0].metadata.objects,"linesConfiguration","originImageRotation",this.settings.linesConfiguration.originImageRotation),linesBehavior:f(t.dataViews[0].metadata.objects,"linesConfiguration","linesBehavior",this.settings.linesConfiguration.linesBehavior),destinationImageTransparency:f(t.dataViews[0].metadata.objects,"linesConfiguration","destinationImageTransparency",this.settings.linesConfiguration.destinationImageTransparency),originImageTransparency:f(t.dataViews[0].metadata.objects,"linesConfiguration","originImageTransparency",this.settings.linesConfiguration.originImageTransparency)}}linesFormattingSettings(t){return{color:m(t.dataViews[0].metadata.objects,"linesConfiguration","color",this.settings.linesFormatting.color),transparency:f(t.dataViews[0].metadata.objects,"linesConfiguration","transparency",this.settings.linesFormatting.transparency),dashArray:f(t.dataViews[0].metadata.objects,"linesConfiguration","dashArray",this.settings.linesFormatting.dashArray),width:f(t.dataViews[0].metadata.objects,"linesConfiguration","width",this.settings.linesFormatting.width)}}overlaysSettings(t){return{mapLabels:f(t.dataViews[0].metadata.objects,"overlays","mapLabels",this.settings.overlays.mapLabels),traffic:f(t.dataViews[0].metadata.objects,"overlays","traffic",this.settings.overlays.traffic),weather:f(t.dataViews[0].metadata.objects,"overlays","weather",this.settings.overlays.weather),daylightTerminator:f(t.dataViews[0].metadata.objects,"overlays","daylightTerminator",this.settings.overlays.daylightTerminator),geoJSONFile:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFile",this.settings.overlays.geoJSONFile),geoJSONFileUpload:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileUpload",this.settings.overlays.geoJSONFileUpload),esriLayer:f(t.dataViews[0].metadata.objects,"overlays","esriLayer",this.settings.overlays.esriLayer),rasterLayer:f(t.dataViews[0].metadata.objects,"overlays","rasterLayer",this.settings.overlays.rasterLayer),openSeaMap:f(t.dataViews[0].metadata.objects,"overlays","openSeaMap",this.settings.overlays.openSeaMap),openRailMap:f(t.dataViews[0].metadata.objects,"overlays","openRailMap",this.settings.overlays.openRailMap),wms:f(t.dataViews[0].metadata.objects,"overlays","wms",this.settings.overlays.wms),weatherLayer:f(t.dataViews[0].metadata.objects,"overlays","weatherLayer",this.settings.overlays.weatherLayer),weatherTransparency:f(t.dataViews[0].metadata.objects,"overlays","weatherTransparency",this.settings.overlays.weatherTransparency),weatherSource:f(t.dataViews[0].metadata.objects,"overlays","weatherSource",this.settings.overlays.weatherSource),trafficSource:f(t.dataViews[0].metadata.objects,"overlays","trafficSource",this.settings.overlays.trafficSource),trafficLayer:f(t.dataViews[0].metadata.objects,"overlays","trafficLayer",this.settings.overlays.trafficLayer),labelSource:f(t.dataViews[0].metadata.objects,"overlays","labelSource",this.settings.overlays.labelSource),esriLabelStyle:f(t.dataViews[0].metadata.objects,"overlays","esriLabelStyle",this.settings.overlays.esriLabelStyle),iconMapLabelStyle:f(t.dataViews[0].metadata.objects,"overlays","iconMapLabelStyle",this.settings.overlays.iconMapLabelStyle),esriLanguage:f(t.dataViews[0].metadata.objects,"overlays","esriLanguage",this.settings.overlays.esriLanguage),labelsMinZoom:f(t.dataViews[0].metadata.objects,"overlays","labelsMinZoom",this.settings.overlays.labelsMinZoom),labelsMaxZoom:f(t.dataViews[0].metadata.objects,"overlays","labelsMaxZoom",this.settings.overlays.labelsMaxZoom),trafficZIndex:f(t.dataViews[0].metadata.objects,"overlays","trafficZIndex",this.settings.overlays.trafficZIndex),labelsZIndex:f(t.dataViews[0].metadata.objects,"overlays","labelsZIndex",this.settings.overlays.labelsZIndex),weatherZIndex:f(t.dataViews[0].metadata.objects,"overlays","weatherZIndex",this.settings.overlays.weatherZIndex),terminatorZIndex:f(t.dataViews[0].metadata.objects,"overlays","terminatorZIndex",this.settings.overlays.terminatorZIndex),terminatorTransparency:f(t.dataViews[0].metadata.objects,"overlays","terminatorTransparency",this.settings.overlays.terminatorTransparency),geoJSONFileZIndex:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileZIndex",this.settings.overlays.geoJSONFileZIndex),esriZIndex:f(t.dataViews[0].metadata.objects,"overlays","esriZIndex",this.settings.overlays.esriZIndex),esriLayerURL:f(t.dataViews[0].metadata.objects,"overlays","esriLayerURL",this.settings.overlays.esriLayerURL),esriOutlineColor:m(t.dataViews[0].metadata.objects,"overlays","esriOutlineColor",this.settings.overlays.esriOutlineColor),esriOutlineTransparency:f(t.dataViews[0].metadata.objects,"overlays","esriOutlineTransparency",this.settings.overlays.esriOutlineTransparency),esriOutlineWidth:f(t.dataViews[0].metadata.objects,"overlays","esriOutlineWidth",this.settings.overlays.esriOutlineWidth),esriOutlineDashArray:f(t.dataViews[0].metadata.objects,"overlays","esriOutlineDashArray",this.settings.overlays.esriOutlineDashArray),esriFillTransparency:f(t.dataViews[0].metadata.objects,"overlays","esriFillTransparency",this.settings.overlays.esriFillTransparency),esriFillColor:m(t.dataViews[0].metadata.objects,"overlays","esriFillColor",this.settings.overlays.esriFillColor),esriIncludeTooltips:f(t.dataViews[0].metadata.objects,"overlays","esriIncludeTooltips",this.settings.overlays.esriIncludeTooltips),esriIncludeInAutoZoom:f(t.dataViews[0].metadata.objects,"overlays","esriIncludeInAutoZoom",this.settings.overlays.esriIncludeInAutoZoom),vector:f(t.dataViews[0].metadata.objects,"overlays","vector",this.settings.overlays.vector),vectorZIndex:f(t.dataViews[0].metadata.objects,"overlays","vectorZIndex",this.settings.overlays.vectorZIndex),vectorMinZoom:f(t.dataViews[0].metadata.objects,"overlays","vectorMinZoom",this.settings.overlays.vectorMinZoom),vectorMaxZoom:f(t.dataViews[0].metadata.objects,"overlays","vectorMaxZoom",this.settings.overlays.vectorMaxZoom),vectorURL:f(t.dataViews[0].metadata.objects,"overlays","vectorURL",this.settings.overlays.vectorURL),geoJSONFileURL:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileURL",this.settings.overlays.geoJSONFileURL),geoJSONMinZoom:f(t.dataViews[0].metadata.objects,"overlays","geoJSONMinZoom",this.settings.overlays.geoJSONMinZoom),geoJSONMaxZoom:f(t.dataViews[0].metadata.objects,"overlays","geoJSONMaxZoom",this.settings.overlays.geoJSONMaxZoom),geoJSONShowTooltips:f(t.dataViews[0].metadata.objects,"overlays","geoJSONShowTooltips",this.settings.overlays.geoJSONShowTooltips),geoJSONFileOverrideStyle:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileOverrideStyle",this.settings.overlays.geoJSONFileOverrideStyle),geoJSONFileOutlineTransparency:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileOutlineTransparency",this.settings.overlays.geoJSONFileOutlineTransparency),geoJSONFileFillTransparency:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileFillTransparency",this.settings.overlays.geoJSONFileFillTransparency),geoJSONFileOutlineColor:m(t.dataViews[0].metadata.objects,"overlays","geoJSONFileOutlineColor",this.settings.overlays.geoJSONFileOutlineColor),geoJSONFileFillColor:m(t.dataViews[0].metadata.objects,"overlays","geoJSONFileFillColor",this.settings.overlays.geoJSONFileFillColor),geoJSONFileOutlineWidth:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileOutlineWidth",this.settings.overlays.geoJSONFileOutlineWidth),geoJSONFileOutlineDashArray:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileOutlineDashArray",this.settings.overlays.geoJSONFileOutlineDashArray),geoJSONFileSimplification:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileSimplification",this.settings.overlays.geoJSONFileSimplification),geoJSONFileSource:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFileSource",this.settings.overlays.geoJSONFileSource),geoJSONFilePrecision:f(t.dataViews[0].metadata.objects,"overlays","geoJSONFilePrecision",this.settings.overlays.geoJSONFilePrecision),rasterURL:f(t.dataViews[0].metadata.objects,"overlays","rasterURL",this.settings.overlays.rasterURL),rasterMinZoom:f(t.dataViews[0].metadata.objects,"overlays","rasterMinZoom",this.settings.overlays.rasterMinZoom),rasterMaxZoom:f(t.dataViews[0].metadata.objects,"overlays","rasterMaxZoom",this.settings.overlays.rasterMaxZoom),rasterZIndex:f(t.dataViews[0].metadata.objects,"overlays","rasterZIndex",this.settings.overlays.rasterZIndex),rasterTransparency:f(t.dataViews[0].metadata.objects,"overlays","rasterTransparency",this.settings.overlays.rasterTransparency),wmsURL:f(t.dataViews[0].metadata.objects,"overlays","wmsURL",this.settings.overlays.wmsURL),wmsLayer:f(t.dataViews[0].metadata.objects,"overlays","wmsLayer",this.settings.overlays.wmsLayer),wmsCRS:f(t.dataViews[0].metadata.objects,"overlays","wmsCRS",this.settings.overlays.wmsCRS),wmsFormat:f(t.dataViews[0].metadata.objects,"overlays","wmsFormat",this.settings.overlays.wmsFormat),wmsManual:f(t.dataViews[0].metadata.objects,"overlays","wmsManual",this.settings.overlays.wmsManual),wmsZIndex:f(t.dataViews[0].metadata.objects,"overlays","wmsZIndex",this.settings.overlays.wmsZIndex),wmsTransparency:f(t.dataViews[0].metadata.objects,"overlays","wmsTransparency",this.settings.overlays.wmsTransparency)}}apiKeysSettings(t){return{googleMaps:f(t.dataViews[0].metadata.objects,"apiKeys","googleMaps",this.settings.apiKeys.googleMaps),mapTiler:f(t.dataViews[0].metadata.objects,"apiKeys","mapTiler",this.settings.apiKeys.mapTiler),mapbox:f(t.dataViews[0].metadata.objects,"apiKeys","mapbox",this.settings.apiKeys.mapbox),azureMaps:f(t.dataViews[0].metadata.objects,"apiKeys","azureMaps",this.settings.apiKeys.azureMaps),esri:f(t.dataViews[0].metadata.objects,"apiKeys","esri",this.settings.apiKeys.esri),openWeatherMap:f(t.dataViews[0].metadata.objects,"apiKeys","openWeatherMap",this.settings.apiKeys.openWeatherMap),ordnanceSurvey:f(t.dataViews[0].metadata.objects,"apiKeys","ordnanceSurvey",this.settings.apiKeys.ordnanceSurvey)}}geoJSONFileOverlaySettings(t){return{geoJSONFileUpload:f(t.dataViews[0].metadata.objects,"geoJSONFileOverlay","geoJSONFileUpload",this.settings.geoJSONFileOverlay.geoJSONFileUpload),geoJSONFileStore:f(t.dataViews[0].metadata.objects,"geoJSONFileOverlay","geoJSONFileStore",this.settings.geoJSONFileOverlay.geoJSONFileStore)}}controlsSettings(t){return{zoom:f(t.dataViews[0].metadata.objects,"controls","zoom",this.settings.controls.zoom),imperialScale:f(t.dataViews[0].metadata.objects,"controls","imperialScale",this.settings.controls.imperialScale),metricScale:f(t.dataViews[0].metadata.objects,"controls","metricScale",this.settings.controls.metricScale),nauticScale:f(t.dataViews[0].metadata.objects,"controls","nauticScale",this.settings.controls.nauticScale),measureTool:f(t.dataViews[0].metadata.objects,"controls","measureTool",this.settings.controls.measureTool),zoomLock:f(t.dataViews[0].metadata.objects,"controls","zoomLock",this.settings.controls.zoomLock),lasso:f(t.dataViews[0].metadata.objects,"controls","lasso",this.settings.controls.lasso),lassoMode:f(t.dataViews[0].metadata.objects,"controls","lassoMode",this.settings.controls.lassoMode),lassoFill:m(t.dataViews[0].metadata.objects,"controls","lassoFill",this.settings.controls.lassoFill),lassoOutline:m(t.dataViews[0].metadata.objects,"controls","lassoOutline",this.settings.controls.lassoOutline),controlSize:f(t.dataViews[0].metadata.objects,"controls","controlSize",this.settings.controls.controlSize),additionalAttribution:f(t.dataViews[0].metadata.objects,"controls","additionalAttribution",this.settings.controls.additionalAttribution)}}generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}processGeoJSONDataFileUpload(t){if(t.geoJSONFileDataLayers.geoJSONFileUpload1||t.geoJSONFileDataLayers.geoJSONFileUpload2||t.geoJSONFileDataLayers.geoJSONFileUpload3||t.geoJSONFileDataLayers.geoJSONFileUpload4||t.geoJSONFileDataLayers.geoJSONFileUpload5){t.geoJSONFileDataLayers.geoJSONFileUpload1&&(document.getElementById("uploadButton1").style.display="block",t.geoJSONFileDataLayers.geoJSONFileUpload1=!1),t.geoJSONFileDataLayers.geoJSONFileUpload2&&(document.getElementById("uploadButton2").style.display="block",t.geoJSONFileDataLayers.geoJSONFileUpload2=!1),t.geoJSONFileDataLayers.geoJSONFileUpload3&&(document.getElementById("uploadButton3").style.display="block",t.geoJSONFileDataLayers.geoJSONFileUpload3=!1),t.geoJSONFileDataLayers.geoJSONFileUpload4&&(document.getElementById("uploadButton4").style.display="block",t.geoJSONFileDataLayers.geoJSONFileUpload4=!1),t.geoJSONFileDataLayers.geoJSONFileUpload5&&(document.getElementById("uploadButton5").style.display="block",t.geoJSONFileDataLayers.geoJSONFileUpload5=!1);const e={merge:[{objectName:"geoJSONFileDataLayers",properties:{geoJSONFileUpload1:!1,geoJSONFileUpload2:!1,geoJSONFileUpload3:!1,geoJSONFileUpload4:!1,geoJSONFileUpload5:!1,geoJSONFileStore1:this.settings.geoJSONFileDataLayers.geoJSONFileStore1,geoJSONFileStore2:this.settings.geoJSONFileDataLayers.geoJSONFileStore2,geoJSONFileStore3:this.settings.geoJSONFileDataLayers.geoJSONFileStore3,geoJSONFileStore4:this.settings.geoJSONFileDataLayers.geoJSONFileStore4,geoJSONFileStore5:this.settings.geoJSONFileDataLayers.geoJSONFileStore5},selector:null}]};this.iconMapVisual.host.persistProperties(e)}}processGeoJSONOverlayFileUpload(t){if(1==t.geoJSONFileOverlay.geoJSONFileUpload){document.getElementById("uploadButton").style.display="block",t.geoJSONFileOverlay.geoJSONFileUpload=!1;const e={merge:[{objectName:"geoJSONFileOverlay",properties:{geoJSONFileUpload:!1,geoJSONFileStore:""},selector:null}]};this.iconMapVisual.host.persistProperties(e)}}updateSettings(t,e){this.iconMapVisual=e,void 0===this.settings&&this.configureDefaultSettings(e.host);const i=this.settings.map.wmsPushToBounds,r=this.settings.background.mapSource,n=this.settings.background.openStreetMapSource,o=this.settings.background.mapboxSource,s=this.settings.background.googleMapsSource,a=this.settings.background.ordnanceSurveyProjection,l=this.generateHash(JSON.stringify(this.settings.overlays)),c=this.generateHash(JSON.stringify(this.settings.background)),u=this.settings.overlays.geoJSONFileSimplification,h={geoJSONFileDataLayers:this.geoJSONFileDataLayersSettings(t),background:this.backgroundSettings(t),circlesFormatting:this.circlesFormattingSettings(t),circlesConfiguration:this.circlesConfiugrationSettings(t),heatmapConfiguration:this.heatmapConfigurationSettings(t),h3Configuration:this.h3ConfigurationSettings(t),wktFormatting:this.wktFormattingSettings(t),wktConfiguration:this.wktConfiugrationSettings(t),imageConfiguration:this.imageConfigurationSettings(t),map:this.mapSettings(t),zoom:this.zoomSettings(t),interactivity:this.interactivitySettings(t),labels:this.labelsSettings(t),geoJsonConfiguration:this.geoJsonConfigurationSettings(t),geoJsonFormatting:this.geoJsonFormattingSettings(t),vectorTileConfiguration:this.vectorTileConfigurationSettings(t),vectorTileFormatting:this.vectorTileFormattingSettings(t),linesConfiguration:this.linesConfigurationSettings(t),linesFormatting:this.linesFormattingSettings(t),esriFeatureConfiguration:this.esriFeatureConfigurationSettings(t),esriFeatureFormatting:this.esriFeatureFormattingSettings(t),overlays:this.overlaysSettings(t),controls:this.controlsSettings(t),apiKeys:this.apiKeysSettings(t),geoJSONFileOverlay:this.geoJSONFileOverlaySettings(t)};return this.processGeoJSONOverlayFileUpload(h),this.processGeoJSONDataFileUpload(h),u!=h.overlays.geoJSONFileSimplification&&"url"==h.overlays.geoJSONFileSource&&(e.geoJSONLoader.geoJSONFiles=e.geoJSONLoader.geoJSONFiles.filter((t=>t.reference!==h.overlays.geoJSONFileURL))),"ordnanceSurvey"==h.background.mapSource&&"EPSG3857"==h.background.ordnanceSurveyProjection&&"leisure"==h.background.ordnanceSurveySource&&(h.background.ordnanceSurveySource="road"),"azureMaps"==h.background.mapSource&&"microsoft.imagery"!=h.background.azureMapsStyle&&(h.background.azureMapsLabels="none"),"azureMaps"==h.background.mapSource&&"microsoft.base.road"!=h.background.azureMapsStyle&&(h.background.azureMapsHillShade=!1),this.settings=h,"wms"==h.background.mapSource&&i!=h.map.wmsPushToBounds&&h.map.wmsPushToBounds&&this.configureWMSBoundingBox(),"ordnanceSurvey"==h.background.mapSource&&this.configureOrdnanceSurveyBoundingBox(),r==this.settings.background.mapSource&&o==this.settings.background.mapboxSource&&n==this.settings.background.openStreetMapSource&&s==this.settings.background.googleMapsSource&&a==this.settings.background.ordnanceSurveyProjection||this.updateMinMaxZoomLevels(),l!=this.generateHash(JSON.stringify(this.settings.overlays))?e.overlaySettingsChanged=!0:e.overlaySettingsChanged=!1,c!=this.generateHash(JSON.stringify(this.settings.background))?e.backgroundSettingsChanged=!0:e.backgroundSettingsChanged=!1,this.settings}}},65809:(t,e,i)=>{"use strict";i.d(e,{ib:()=>a});var r=i(53481);function n(t,e){return t.item<e.item?-1:t.item>e.item?1:0}function o(t,e){if(t instanceof Function)return e instanceof Function&&t.toString()===e.toString();if(null==t||null==e)return t===e;if(t===e||t.valueOf()===e.valueOf())return!0;if(t instanceof Date)return!1;if(e instanceof Date)return!1;if(!(t instanceof Object))return!1;if(!(e instanceof Object))return!1;const i=Object.keys(t);return!!Object.keys(e).every((function(t){return-1!==i.indexOf(t)}))&&i.every((function(i){return o(t[i],e[i])}))}function s(t,e){if(0==e.length)return!1;for(let i=0;i<e.length;i++)if(e[i].key===t.key)return!0;return!1}class a{addClickEvent(t,e,i){if(i.host.hostCapabilities.allowInteractions){const r=i.selectionManager;e.on("click",(function(t){const e=t.originalEvent||t.data.originalEvent;r.clear(),(new a).clickHandler([t.target.feature.properties.selectionId],!1,i,e.ctrlKey||e.shiftKey)})),e.on("contextmenu",(function(t){r.showContextMenu(t.target.feature.properties.selectionId,{x:t.originalEvent.clientX,y:t.originalEvent.clientY})})),null==e.feature&&(e.feature={type:void 0,properties:{},geometry:void 0}),e.feature.properties.selectionId=t}}addH3ClickEvent(t,e,i){if(i.host.hostCapabilities.allowInteractions){const r=i.selectionManager;e.on("click",(function(t){const e=t.originalEvent||t.data.originalEvent;r.clear(),(new a).clickHandler(t.target.feature.properties.selectionIds,!1,i,e.ctrlKey||e.shiftKey)})),null==e.feature&&(e.feature={type:void 0,properties:{},geometry:void 0}),e.feature.properties.selectionIds=t}}processLayers(t,e,i,n,o){const a=r.latLngBounds([]);return t.eachLayer((function(r){let l,c,u,h=!1;if(null!=r.feature&&null!=r.feature.properties&&(null!=r.feature.properties.selectionId||null!=r.feature.properties.selectionIds)&&(l=r.feature.properties.selectionId,u=r.feature.properties.selectionIds,e.settings.interactivity.includeLabels&&null!=r.feature&&null!=r.feature.properties&&null!=r.feature.properties.isLabel&&r.feature.properties.isLabel&&(h=!0,null!=r.feature.properties.relatedSelectionId&&(c=r.feature.properties.relatedSelectionId)),void 0!==l||h||void 0!==u)){if(null==r.feature.properties.originalOpacity&&(r.feature.properties.originalOpacity=r.options.opacity,r.feature.properties.originalFillOpacity=r.options.fillOpacity),t.removeLayer(r),0==i.length)null!=r.options.icon?r.options.opacity=r.feature.properties.originalOpacity:(r.options.opacity=r.feature.properties.originalOpacity,r.options.fillOpacity=r.feature.properties.originalFillOpacity);else{let t=!1;null!=l&&(t=s(l,i)),null!=u&&(p=u,t=0!=(d=i).length&&p.some((t=>d.some((e=>e.key===t.key))))),void 0!==c&&(t=s(c,i)),t?(null==r.options.icon&&(r.options.fillOpacity=n/100),r.options.opacity=n/100,null!=r.feature&&null!=r.feature.properties&&null!=r.feature.properties.bounds?a.extend(r.feature.properties.bounds):null!=r.feature&&null!=r.feature.properties&&null!=r._bounds&&a.extend(r._bounds)):(r.options.opacity=o/100,null==r.options.icon&&(r.options.fillOpacity=o/100))}t.addLayer(r)}var p,d})),a}clickHandler(t,e,i,s){const a=i.selectionManager;if(e||(function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;t.sort(n),e.sort(n);for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}(t,i.selectedIds)?(a.clear(),t=[]):(s&&(t=i.selectedIds.concat(t)),t=function(t){t.concat();for(let e=0;e<t.length;++e)for(let i=e+1;i<t.length;++i)t[e]===t[i]&&t.splice(i--,1);return t}(t),a.select(t,s))),0==t.length&&0==i.selectedIds.length)return!1;const l=i.map;let c=90,u=30;null!=i.settings&&(e?(c=100-i.settings.interactivity.highlightedTransparency,u=100-i.settings.interactivity.unHighlightedTransparency):(c=100-i.settings.interactivity.selectedTransparency,u=100-i.settings.interactivity.unSelectedTransparency));const h=this.processLayers(l,i,t,c,u);if(0==t.length)null==i.autoZoomBounds||i.settings.zoom.lockZoom||i.zoomLocked||!i.settings.zoom.zoomAfterUnSelect||i.map.fitBounds(i.autoZoomBounds);else if(!o(h,new r.LatLngBounds([]))){if(i.settings.zoom.zoomToSelected&&!e&&!i.settings.zoom.lockZoom&&!i.zoomLocked){let e={};1==t.length&&(e={maxZoom:i.settings.zoom.zoomLevelForSingle}),i.map.fitBounds(h,e)}if(i.settings.zoom.zoomToHighlighted&&e&&!i.settings.zoom.lockZoom&&!i.zoomLocked){let e={};1==t.length&&(e={maxZoom:i.settings.zoom.zoomLevelForSingle}),i.map.fitBounds(h,e)}}i.selectedIds=t}}},56084:(t,e,i)=>{"use strict";i.d(e,{x:()=>u});var r=i(20992),n=i(3075),o=i(14945),s=i(71710),a=i(48168),l=i(80190),c=i(50252).hp;class u{loading=!1;geoJSONFiles=new Array;noOfFiles=0;readTextFile(t,e,i){const r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",t,!0),r.onerror=function(){i(e,null)},r.onreadystatechange=function(){4===r.readyState&&200==r.status&&i(r.responseText,e),4!==r.readyState||"4"!=r.status.toString().substring(0,1)&&"5"!=r.status.toString().substring(0,1)||i(e,null)},r.send(null)}processUploadedGeoJSON(t,e,r,s){const a=i(64028);let l=t.settings.overlays.geoJSONFileSimplification,c=t.settings.overlays.geoJSONFilePrecision;null!=s&&(l=t.settings.geoJsonConfiguration.geoJSONFileSimplification,c=t.settings.geoJsonConfiguration.geoJSONFilePrecision),e=a(e,l,!0),o.Fh1(e,(function(t){t[0]=parseFloat(t[0].toFixed(c)),t[1]=parseFloat(t[1].toFixed(c))}));const u=JSON.stringify(e),h=n.Kc(u);let p="";for(let t=0;t<h.length;t+=5e4)p+=String.fromCharCode.apply(null,h.subarray(t,t+5e4));if(p=btoa(p),null!=s){const e={merge:[{objectName:"geoJSONFileDataLayers",properties:{geoJSONFileUpload1:!1,geoJSONFileUpload2:!1,geoJSONFileUpload3:!1,geoJSONFileUpload4:!1,geoJSONFileUpload5:!1,geoJSONFileStore1:1==s?p:t.settings.geoJSONFileDataLayers.geoJSONFileStore1,geoJSONFileStore2:2==s?p:t.settings.geoJSONFileDataLayers.geoJSONFileStore2,geoJSONFileStore3:3==s?p:t.settings.geoJSONFileDataLayers.geoJSONFileStore3,geoJSONFileStore4:4==s?p:t.settings.geoJSONFileDataLayers.geoJSONFileStore4,geoJSONFileStore5:5==s?p:t.settings.geoJSONFileDataLayers.geoJSONFileStore5},selector:null}]};t.host.persistProperties(e);const i="UploadedData"+s,n={reference:i,url:i,file:i};r=r.filter((t=>t.reference!==i)),r.push(n)}else{const e={merge:[{objectName:"geoJSONFileOverlay",properties:{geoJSONFileUpload:!1,geoJSONFileStore:p},selector:null}]};t.host.persistProperties(e);const i={reference:"UploadedOverlay",url:"UploadedOverlay",file:"UploadedOverlay"};r=r.filter((t=>"UploadedOverlay"!==t.reference)),r.push(i),t.overlaySettingsHash="UploadedGoeJSONFile"}}uploadGeoJSONFile(t,e,i){const n=new FileReader,u=this.geoJSONFiles;n.onload=n=>{let h;if(e.name.toLowerCase().includes(".zip"))(new s).loadAsync(n.target.result).then((e=>{const r=Object.keys(e.files),n=r.find((t=>t.toLowerCase().endsWith(".shp"))),s=e.files[n],h=r.find((t=>t.toLowerCase().endsWith(".dbf"))),p=e.files[h],d=r.find((t=>t.toLowerCase().endsWith(".prj"))),f=e.files[d];s&&p&&f&&Promise.all([f.async("text"),s.async("arraybuffer"),p.async("arraybuffer")]).then((([e,r,n])=>{const s=new c(r),h=new c(n),p=e;a.LF(s,h).then((e=>{const r=l.default.Proj(p),n=l.default.Proj("WGS84");o.Fh1(e,(function(t){const e=l.default.transform(r,n,{x:t[0],y:t[1]});t[0]=e.x,t[1]=e.y})),this.processUploadedGeoJSON(t,e,u,i)})).catch((t=>{console.error(t)}))}))}));else{const e=n.target.result.toString();if(e.substring(0,100).toLowerCase().includes("<kml")){const t=(new DOMParser).parseFromString(e,"text/xml");h=(0,r.bW)(t)}else h=JSON.parse(e);this.processUploadedGeoJSON(t,h,u,i)}},e.name.toLowerCase().includes(".zip")?n.readAsBinaryString(e):n.readAsText(e)}loadGeoJSONFile(t,e,n,o,s,a,l,c){let u;const h=this.geoJSONFiles;return this.readTextFile(t,e,(function(p){let d;if(p.substring(0,100).toLowerCase().includes("<kml")){const t=(new DOMParser).parseFromString(p,"text/xml");d=(0,r.bW)(t)}else d=JSON.parse(p);const f=i(64028)(d,a);u={reference:e,url:t,file:f},h.push(u),null==l?n(o,s,t):n(o,s,t,l,c)})),u}isLoading(){return this.noOfFiles>0}}},56801:(t,e,i)=>{"use strict";i.d(e,{Oz:()=>l});var r=i(53481),n=(i(37142),i(80190),i(34806)),o=(i(87375),i(65809)),s=i(56084);function a(t,e){return t.item<e.item?-1:t.item>e.item?1:0}class l{host;errorMessages=[];map;crsName;crs;backgroundLayerGroup;circleLayerGroup;heatmapLayerGroup;h3LayerGroup;lineLayerGroup;wktLayerGroup;vectorTilesLayerGroup;vectorTilesLabelLayerGroup;vectorOverlayLayerGroup;rasterOverlayLayerGroup;wmsOverlayLayerGroup;terminatorOverlay;terminatorTimer;imageLayerGroup;selectionManager;settings;clickEvents;selectedIds=[];tooltips;labels;aADToken;previousZoomLevel=-1;visualHost;esriFeatureLayerGroup;weatherLayerGroup;trafficLayerGroup;mapLabelsLayerGroup;geoJSONReferenceLayerGroup;esriReferenceLayerGroup;mapboxDataLayerGroup;geoJSONLayerGroup;zoomControl;scaleControl;nauticScaleControl;attributionControl;zoomLockControl;measureControl;lassoControl;GeoJSONOverlay;zoomLocked=!1;backgroundSettingsHash;errorMessageHolder;autoZoomBounds;noOfZoomableItems;ESRIFeatureCollection;zoomSettingsHash="";mapSettingsHash="";overlaySettingsHash="";geoJSONLoader;overlaySettingsChanged=!1;backgroundSettingsChanged=!1;productAttributionMessage="";visualGUID="";instanceID="";iconMapStyles;generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupSelectionManager(){this.selectionManager=this.host.createSelectionManager()}setupClickEvents(){this.clickEvents=new o.ib}setupErrorMessageHolder(t){const e=document.createElement("div");e.id="errorMessageHolder",e.className="errorMessageHolder",this.errorMessageHolder=e,t.appendChild(this.errorMessageHolder)}updateErrorMessages(){this.errorMessageHolder.textContent="";const t=document.createElement("h3");if(t.textContent="Icon Map Pro is currently unable to display correctly due to the following issues with the configuration:",this.errorMessageHolder.appendChild(t),this.errorMessages.length>0){const t=document.createElement("ul");this.errorMessages.forEach((e=>{const i=document.createElement("li");i.textContent=e.message,t.appendChild(i)})),this.errorMessageHolder.appendChild(t),this.errorMessageHolder.style.display="block"}else this.errorMessageHolder.style.display="none"}addErrorMessage(t,e,i){const r={category:t,id:e,message:i};this.errorMessages.find((t=>t.id===r.id))||this.errorMessages.push(r),this.updateErrorMessages()}removeErrorMessage(t){this.errorMessages=this.errorMessages.filter((e=>e.id!==t)),this.updateErrorMessages()}removeErrorMessageByCategory(t){this.errorMessages=this.errorMessages.filter((e=>e.category!==t)),this.updateErrorMessages()}zoomToBounds(t){if(void 0!==this.map&&void 0!==this.autoZoomBounds&&t.zoom.autoZoom&&!this.zoomLocked&&!this.settings.zoom.lockZoom){let e={};1==this.noOfZoomableItems&&(e={maxZoom:t.zoom.zoomLevelForSingle}),null!=this.autoZoomBounds&&this.map.fitBounds(this.autoZoomBounds,e)}}highlightItems(t){const e=t.dataViews[0].categorical,i=e.values.grouped();let r=0,o=0;null!=e.values&&(r=n.getMeasureIndexOfRole(i,"Size"),o=n.getMeasureIndexOfRole(i,"imageWKT"));let s=e.values[0].highlights;null!=s&&s.length>0&&s.every(((t,e,i)=>t===i[0]))&&null!=e.values&&(s=e.values[r].highlights,s.concat(e.values[o].highlights));const a=[];if(null!=s&&s.length>0)for(let t=0;t<s.length;t++)if(null!=s[t]){const i=this.host.createSelectionIdBuilder().withCategory(e.categories[0],t).createSelectionId();a.push(i)}a.length>0?this.clickEvents.clickHandler(a,!0,this,!1):this.settings.esriFeatureConfiguration.includeEsriFeatureLayer||this.selectionManager.clear()}setupPanes(t){this.map.createPane("labels"),this.map.getPane("labels").style.zIndex=t.overlays.labelsZIndex.toString(),this.map.getPane("labels").style.pointerEvents="none",this.map.createPane("weather"),this.map.getPane("weather").style.zIndex=t.overlays.weatherZIndex.toString(),this.map.getPane("weather").style.pointerEvents="none",this.map.createPane("traffic"),this.map.getPane("traffic").style.zIndex=t.overlays.trafficZIndex.toString(),this.map.getPane("traffic").style.pointerEvents="none",this.map.createPane("vectorOverlay"),this.map.getPane("vectorOverlay").style.zIndex=t.overlays.vectorZIndex.toString(),this.map.getPane("vectorOverlay").style.pointerEvents="none",this.map.createPane("rasterOverlay"),this.map.getPane("rasterOverlay").style.zIndex=t.overlays.rasterZIndex.toString(),this.map.getPane("rasterOverlay").style.pointerEvents="none",this.map.createPane("wmsOverlay"),this.map.getPane("wmsOverlay").style.zIndex=t.overlays.wmsZIndex.toString(),this.map.getPane("wmsOverlay").style.pointerEvents="none",this.map.createPane("circles"),this.map.getPane("circles").style.zIndex=t.circlesConfiguration.zIndex.toString(),this.map.createPane("h3"),this.map.getPane("h3").style.zIndex=t.h3Configuration.zIndex.toString(),this.map.createPane("terminator"),this.map.getPane("terminator").style.zIndex=t.overlays.terminatorZIndex.toString(),this.map.getPane("terminator").style.pointerEvents="none",this.map.createPane("geoJSONReference"),this.map.getPane("geoJSONReference").style.zIndex=t.overlays.geoJSONFileZIndex.toString(),this.map.getPane("geoJSONReference").style.pointerEvents="none",this.map.createPane("geoJSONLayer"),this.map.getPane("geoJSONLayer").style.zIndex=t.geoJsonConfiguration.geoJSONFileZIndex.toString(),this.map.createPane("esriReference"),this.map.getPane("esriReference").style.zIndex=t.overlays.geoJSONFileZIndex.toString(),this.map.getPane("esriReference").style.pointerEvents="none"}setupMap(t,e){void 0===this.geoJSONLoader&&(this.geoJSONLoader=new s.x);const i=this.generateHash(t.zoom.minZoom.toString()+t.zoom.maxZoom.toString()+t.zoom.zoomIncrement.toString()),n=this.generateHash(t.map.limitMap.toString()+t.map.eastBoundLongitude.toString()+t.map.northBoundLatitude.toString()+t.map.southBoundLatitude.toString()+t.map.westBoundLongitude.toString()),o=t.zoom.minZoom,l=t.zoom.maxZoom;if(void 0!==this.map){if(void 0===e&&void 0===this.crs&&i==this.zoomSettingsHash&&n==this.mapSettingsHash)return;if(i==this.zoomSettingsHash&&n==this.mapSettingsHash&&void 0!==e&&void 0!==this.crs&&e.code===this.crs.code){if(void 0===e.options)return;if(void 0!==e.options&&void 0!==this.crs.options&&function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;t.sort(a),e.sort(a);for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}(e.options.resolutions,this.crs.options.resolutions))return}this.map.remove(),this.backgroundLayerGroup=void 0}const c=new r.LatLng(t.zoom.defaultLat,t.zoom.defaultLong),u=t.zoom.defaultZoom;let h;if(this.crs=e,t.map.limitMap){const e=r.latLng(t.map.southBoundLatitude,t.map.westBoundLongitude),i=r.latLng(t.map.northBoundLatitude,t.map.eastBoundLongitude);h=r.latLngBounds(e,i)}if(void 0===e){const e={center:c,zoom:u,minZoom:o,maxZoom:l,zoomSnap:t.zoom.zoomIncrement,zoomAnimation:!0,zoomDelta:t.zoom.zoomIncrement,zoomControl:!1,keyboard:!0};t.map.limitMap&&(e.maxBounds=h),this.map=new r.Map("map",e)}else{const i={crs:e,minZoom:o,maxZoom:l,center:c,zoomSnap:t.zoom.zoomIncrement,attributionControl:!0,zoomControl:!1,keyboard:!0};t.map.limitMap&&(i.maxBounds=h),this.map=new r.Map("map",i)}this.setupPanes(t),r.Icon.Default.prototype.options.iconUrl="data:image/svg+xml,%3Csvg width='346' height='580' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xml:space='preserve' overflow='hidden'%3E%3Cg transform='translate(-2011 -950)'%3E%3Cpath d='M2264.5 1259.5 2184.5 1439.5 2104.5 1259.5Z' stroke='%23F2F2F2' stroke-width='73.3333' stroke-miterlimit='8' fill='%23F2F2F2' fill-rule='evenodd'/%3E%3Cpath d='M2047.5 1123C2047.5 1047.61 2108.61 986.5 2184 986.5 2259.39 986.5 2320.5 1047.61 2320.5 1123 2320.5 1198.39 2259.39 1259.5 2184 1259.5 2108.61 1259.5 2047.5 1198.39 2047.5 1123Z' stroke='%23F2F2F2' stroke-width='73.3333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/%3E%3Cpath d='M2252.5 1238.5 2184.5 1390.5 2116.5 1238.5Z' stroke='%23172C51' stroke-width='73.3333' stroke-miterlimit='8' fill='%23172C51' fill-rule='evenodd'/%3E%3Cpath d='M2068.5 1122C2068.5 1057.66 2120.43 1005.5 2184.5 1005.5 2248.56 1005.5 2300.5 1057.66 2300.5 1122 2300.5 1186.34 2248.56 1238.5 2184.5 1238.5 2120.43 1238.5 2068.5 1186.34 2068.5 1122Z' stroke='%23172C51' stroke-width='73.3333' stroke-miterlimit='8' fill='none' fill-rule='evenodd'/%3E%3C/g%3E%3C/svg%3E",r.Icon.Default.prototype.options.shadowUrl='"data:image/svg+xml,',r.Icon.Default.prototype.options.iconSize=[19,32],r.Icon.Default.prototype.options.shadowSize=[0,0],this.zoomSettingsHash=this.generateHash(t.zoom.minZoom.toString()+t.zoom.maxZoom.toString()+t.zoom.zoomIncrement.toString()),this.mapSettingsHash=this.generateHash(t.map.limitMap.toString()+t.map.eastBoundLongitude.toString()+t.map.northBoundLatitude.toString()+t.map.southBoundLatitude.toString()+t.map.westBoundLongitude.toString()),this.backgroundLayerGroup=void 0}}},88805:(t,e,i)=>{"use strict";i.d(e,{gC:()=>s});var r=i(53481),n=i(11847);function o(t,e,i,r,n){const o=t.objects;if(o){const t=o[e];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}class s{returnCenterPoint(t){let e;if("function"==typeof t.getBounds)if(null!=t._latlng)e=t._latlng;else if(null!==t.feature&&null!==t.feature.geometry&&("MultiLineString"==t.feature.geometry.type||"LineString"==t.feature.geometry.type)&&null!==t.feature.geometry.coordinates&&t.feature.geometry.coordinates.length>0)if("MultiLineString"==t.feature.geometry.type){const i=t.feature.geometry.coordinates[0].length,n=Math.floor(i/2);e=new r.LatLng(t.feature.geometry.coordinates[0][n][1],t.feature.geometry.coordinates[0][n][0])}else{const i=t.feature.geometry.coordinates.length,n=Math.floor(i/2);e=new r.LatLng(t.feature.geometry.coordinates[n][1],t.feature.geometry.coordinates[n][0])}else e=t.getBounds().getCenter();else null!=t._latlng?e=t._latlng:null!=t.properties&&null!=t.properties.lat&&null!=t.properties.long&&(e=new r.LatLng(t.properties.lat,t.properties.lng));return e}stripHTML(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""}determineFormatting(t,e,i){let r=o(e,i,"labels","fontColor",t.labels.fontColor),n=o(e,i,"labels","fillColor",t.labels.fillColor),s=o(e,i,"labels","outlineColor",t.labels.outlineColor),a=o(e,i,"labels","outlineWidth",t.labels.outlineWidth);const l=o(e,i,"labels","position",t.labels.position),c=o(e,i,"labels","borderRadius",t.labels.borderRadius),u=o(e,i,"labels","transparency",t.labels.transparency),h=o(e,i,"labels","displayContainer",t.labels.displayContainer),p=1-u/100;return"object"==typeof n&&null!=n&&(n=n.solid.color),"object"==typeof r&&null!=r&&(r=r.solid.color),"object"==typeof s&&null!=s&&(s=s.solid.color),null==n&&(n="transparent"),null==r&&(r="transparent"),null==s&&(s="transparent"),"no"==h.toLowerCase()&&(s="transparent",a=0,n="transparent"),{fontSize:t.labels.fontSize,fontFamily:t.labels.fontFamily,fontBold:t.labels.fontBold,fontUnderline:t.labels.fontUnderline,fontItalic:t.labels.fontItalic,textColor:r,horizontalAlignment:t.labels.horizontalAlignment,verticalAlignment:t.labels.verticalAlignment,wordWrap:t.labels.wordWrap,paddingLeft:t.labels.paddingLeft,paddingRight:t.labels.paddingRight,paddingTop:t.labels.paddingTop,paddingBottom:t.labels.paddingBottom,borderColor:s,borderWidth:a,opacity:p,fillColor:n,displayContainer:h,borderRadius:c,position:l}}createLabel(t,e,i,s,a){if("yes"==o(t,e,"labels","show",a.labels.show).toLowerCase()){const l=o(t,e,"labels","labelText",a.labels.labelText);if(null!=l&&""!=l&&null!=i){const o=this.determineFormatting(a,t,e),c=this.returnCenterPoint(i);if(null==c)return;const u={text:l,fontFamily:o.fontFamily,fontSize:o.fontSize+"pt"},h=n.Tf.measureSvgTextWidth(u),p=n.Tf.measureSvgTextHeight(u);let d=(p+o.paddingTop+o.paddingBottom)/2*-1-1,f=(h+o.paddingLeft+o.paddingRight)/2*-1-1;if(void 0!==i.options&&void 0!==i.options.radius&&"center"!=o.position){const t=i.getRadius();"below"==o.position&&(d=p/2+t-4),"above"==o.position&&(d=-1*(p+o.paddingTop+o.paddingBottom+t+6)),"left"==o.position&&(f=-1*(h+o.paddingLeft+o.paddingRight+t+6)),"right"==o.position&&(f=t+3)}if(void 0!==i.options&&void 0!==i.options.icon&&"center"!=o.position){const t=i.options.icon.options.iconSize[0]/2,e=i.options.icon.options.iconSize[1]/2;"below"==o.position&&(d=p/2+e-4),"above"==o.position&&(d=-1*(p+o.paddingTop+o.paddingBottom+e+6)),"left"==o.position&&(f=-1*(h+o.paddingLeft+o.paddingRight+t+6)),"right"==o.position&&(f=t+3)}let m="margin-left: "+f+"px;";m+="margin-top: "+d+"px;";const g="background-color: "+o.fillColor+";",_=o.paddingTop.toString()+"px "+o.paddingRight.toString()+"px "+o.paddingBottom.toString()+"px "+o.paddingLeft.toString()+"px",y=o.borderRadius;document.documentElement.style.setProperty("--LabelFont",o.fontFamily),document.documentElement.style.setProperty("--LabelFontSize",o.fontSize+"pt"),document.documentElement.style.setProperty("--LabelBorderWidth",o.borderWidth.toString()+"px"),document.documentElement.style.setProperty("--LabelPadding",_),document.documentElement.style.setProperty("--LabelOpacity",o.opacity.toString()),document.documentElement.style.setProperty("--LabelBorderRadius",y.toString()+"px");let A="pointer-events: none; ";a.interactivity.includeLabels&&(A="pointer-events: auto; ");let v='<div class="iconmap-label" style="'+A+"width:"+h+"px;"+g+";"+m+";border-color: "+o.borderColor+"; color: "+o.textColor+'">';v+=this.stripHTML(l),v+="</div>";const x=r.divIcon({html:v,iconSize:[0,0]}),b=r.marker(c,{icon:x});return null==b.feature&&(b.feature={type:void 0,properties:{},geometry:void 0}),b.feature.properties.isLabel=!0,null!=s&&(b.feature.properties.selectionId=s,b.feature.properties.relatedSelectionId=s),b}}}}},19220:(t,e,i)=>{"use strict";i.d(e,{n:()=>r});class r{logo='<svg width="100" height="100" viewBox="0 0 2475 2475" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" overflow="hidden"> <g transform="translate(-962 0)"> <path d="M1110.08 136.787 3287.08 136.787 3287.08 2313.79 1110.08 2313.79Z" fill="#E4E9F0" fill-rule="evenodd"/>        <path d="M1015.58 54.287 3385.58 54.287 3385.58 2421.29 1015.58 2421.29Z" stroke="#FFFFFF" stroke-width="106.614" stroke-miterlimit="8" stroke-opacity="0" fill="none" fill-rule="evenodd"/>        <path d="M1103.08 127.787 2087.88 143.808 1759.62 592.419 1751.61 920.867 2320.07 1289.37 2328.08 1473.62 1927.75 2306.75 1111.09 2330.79 1103.08 127.787Z" fill="#83BEEC" fill-rule="evenodd"/>        <path d="M3276.75 425.5 2021.5 1031.09 2379.93 1369.5 3276.72 916.105C3271.47 838.891 3279.97 595.512 3276.75 425.5Z" stroke="#3B3B38" stroke-width="55" stroke-linecap="square" stroke-miterlimit="8" fill="#5D6775" fill-rule="evenodd"/>        <path d="M2032.34 195.787C1849.76 423.114 1667.18 650.444 1720.49 845.678 1773.8 1040.9 2316.2 1131.83 2352.19 1367.19 2388.17 1602.55 1899.07 2243.08 1936.38 2257.79" stroke="#107BC1" stroke-width="137.5" stroke-linecap="round" stroke-miterlimit="8" fill="none" fill-rule="evenodd"/>        <path d="M3276.5 929.5 2726.5 1204.28 3275.48 2005.5C3274.45 1645.37 3274.08 1287.43 3276.5 929.5Z" stroke="#3B3B38" stroke-width="55" stroke-linecap="square" stroke-miterlimit="8" fill="#AEB6C2" fill-rule="evenodd"/>        <path d="M1865.5 916 2004.25 638.5 2369.75 638.5 2508.5 916 2369.75 1193.5 2004.25 1193.5Z" stroke="#045498" stroke-width="85.2915" stroke-miterlimit="8" fill="#32C9F4" fill-rule="evenodd"/>        <path d="M2368.5 1203.01 2507.26 925.5 2871.74 925.5 3010.5 1203.01 2871.74 1480.53 2507.26 1480.53Z" stroke="#045498" stroke-width="85.2915" stroke-miterlimit="8" fill="#1599D9" fill-rule="evenodd"/>        <path d="M1853.5 1470 1992.25 1192.5 2357.75 1192.5 2496.5 1470 2357.75 1747.5 1992.25 1747.5Z" stroke="#045498" stroke-width="85.2915" stroke-miterlimit="8" fill="#FFFFFF" fill-rule="evenodd"/>        <path d="M1356.5 1786.5 1495.5 1508.5 1860.5 1508.5 1999.5 1786.5 1860.5 2064.5 1495.5 2064.5Z" stroke="#045498" stroke-width="85.2915" stroke-miterlimit="8" fill="#107BC1" fill-rule="evenodd"/>        <path d="M1099.58 137.287 3276.58 137.287 3276.58 2314.29 1099.58 2314.29Z" stroke="#000000" stroke-width="55" stroke-miterlimit="8" fill="none" fill-rule="evenodd"/>        <path d="M2369.5 656.013 2508.26 378.5 2872.74 378.5 3011.5 656.013 2872.74 933.527 2508.26 933.527Z" stroke="#045498" stroke-width="85.2915" stroke-miterlimit="8" fill="#FFFFFF" fill-rule="evenodd"/>    </g></svg>';tekantisLogo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG0AAAAnCAMAAAAy5TZuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKyUExURf////7+/v39/dTU1IqKio+Pj7Gxsenp6cbGxnx8fLy8vPr6+sLCwre3t7m5uaWlpcjIyK+vr4yMjImJiZKSkvPz866urouLi5OTk8DAwPj4+JGRkY2Njaenp8XFxff397u7u5CQkL6+vvHx8aamprS0tLa2trq6ugAAADs7O2xsbKioqKGhoZmZmbCwsPT09Pn5+UlJSUBAQOTk5MPDw2hoaF1dXaCgoKSkpPX19WVlZVpaWoSEhLOzs2lpaVNTU8fHx3t7e/b29n19fYiIiKOjoyoqKuPj48TExERERMvLyxwcHA0NDc7Ozi0tLdXV1dzc3OXl5czMzO7u7mNjY6mpqWFhYaurq2pqap6entjY2Ovr69LS0n5+flhYWJubm+/v7xQUFPv7+ycnJ8rKyo6OjldXV7W1tR0dHWZmZq2trSsrK5WVlTw8PG1tbXNzczU1NTQ0NGtra4aGhgYGBtra2tDQ0N/f3/Ly8j8/P6ysrJ2dnUVFRWJiYnh4eG9vbyUlJc/Pz/z8/JqamoODg4WFhe3t7TExMXp6ejo6OuDg4L+/v9nZ2dHR0eLi4qKioujo6Dc3N/Dw8HZ2dri4uKqqqhgYGEhISFZWVnl5eXd3d+rq6mdnZ1JSUpycnJSUlN7e3s3NzcHBwdfX17Kystvb29bW1t3d3cnJyezs7HR0dIeHh0ZGRmRkZObm5oGBgSgoKCQkJNPT0xsbGzIyMiAgIDAwMEFBQTY2NgEBAQ8PDzg4OCkpKVFRUUJCQlxcXCEhIYKCglBQUJaWlpeXl1tbW01NTRcXF1lZWXFxcW5ubp+fnz4+PlRUVL29vQQEBB8fHy8vL05OTiYmJn9/fwICAgkJCU9PT0NDQ4CAgBkZGQMDA3JycnBwcAcHB0xMTJiYmAgICF9fX0pKSmBgYF5eXgJTr54AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAYXSURBVFhH7Zf7V1RVFMf3DIrIIAIC2qAzA4O6FYRpQFBQBERnwBABFeQlDiOWiaBWgIYIvhWQRi0SREdNQUvNNK20ssw0w7LMHmYP0v+jvc+5PGa1dK3px/K7WMw+++xzP/fsu88598J/XCqV/FGLH0Uq9sqeQSar3/hX8hgy1HMYqL2GDPfW+HiqYYQvqEb6+QeMCgwKHj3mGS0EB4wa4xEydpxOz+GG0aFhxnAvgPETxHA3NRFDJ03WRGBIJE6JwmjTs2ZTDMZOjYufNj0hcQbOhKRZ8RHJGJCCKakUPtuchsFz5kZb0CrHuydDOmTM0z0XBpCJI+dnLUDMzsHchYuoa3EeLAyB/CUABVgIRUgxUJwWVLK0dFlUSL5NDHdT3mX25eUrno8G0KbnvbDSd9aLnquKbUkV+aHa1ZXTqmKhcs3awAyiwepACl/3UhW+DBGIr8jhbioMq8qrvbAGQF87Yn15et6Gylc9oW6jwaqpr9g0VQv19YbkBqI11m2m8C1x3glb1du272iUw92U985cG+yi5wO7MdsDsakZsQUS11NXXYQFDZC/hzPZSreVRb7iIRD/mgP2LhWD3da+eSb6vx+H78V4CKp6PbUQ39BD25o3D7QnRsIizK7ftKN4BXYcxGAOT8F87ATV2kPccF+HvTknKueeaXZ67ladGo44AY74B/uX+hyFmmNv+fn7Rx0/dmxfkwh3+kd56UFlLRKtp/p/SHWiy66oq0AFLTmZUs5ugPYc5wIRZOmyJ8cIq9rPnsk1THtBQ5cfLXkymp3Neojx40s4eWSWGtRZfjm0X5AaLQ3WrOnCJNlOYr8StHBKMZHrfT1iEm/FlrcRa1s5Wv8O9RSwBafJOsPnRisZTTCHx0jtbAfjWcRmjmrasYk8JSO03ADQTJYhLKKtU0zE/QB5RKOd2NiBeFYiGrhnqDCz2eTti2kFEMlNqapWcLwr+869p/hSKFWkxrTz5tpliBdqze+n2XhuZRfNZvOleb6Clk+0oRRNRwxrK4+8IKZJc/sAV9M9S5pnmfniXMQPK8wfxXWD47Kg1Vyhvo+v0PQ+EUkHMBmNpcQY7TA6UkFFVojR6HC0d9NSl7QwGrFSxsYsw8ufIu5jmzOJGNtH0zgc0RMQZ2XXOGpUfbQu6tpTY7Nc/ey0GC+1GfFzYTDtmrBYTNPEXELcqpGOKMSrweTkOpG0L4IUGisZMVEWhEKbiXidn5hJ5lHRFMRV8q2AaFOEi0W0+tyNNEIJjk5E9Cn8EvE4NUQmuZgGaDrEG7ISFRpNdq7XP85BF9pNK4trkWhf3UI878FdJDuV5jaYQcmmBs8tAfHrbYWDaT1GYSm0aurCk7djXIEDtC34DUcgVlOLVsC3ZM5WXnxUZwSH8nWnXdK8qaCXuNC+yxWWQlMq9fvJXYNfsQZod/EHEYAnqDWec0V/t7kLoOUeIm39XGhUJ0xroLNwvm7+INqPpcLqo9k8f5KXi1fumDWYhnd6enoOtmVTawWF8bMRxyjASMQOzgkt5CStoGXAzzSdXx5PA+hOHkN7A92YaAm50DptWhI3xyPNtHIS1fUwatUcRFy722AIowrGo4JWJJ/Mk2ik1NvbEUMHJudCixQuFmfypn4iXe0kFY1OzlPqmqCdA+gUqX8srVRclkptsbKISC60W8LFormVHebVeB871bZfBUbR9kIufKJ1V3DzcbTMneG0GRU+QBw+8NbkQruxIXzcuPCV9OCIxrvydN5Ktyy/j/d8m/l4aMikjfPAKZop0ejtlybXT3OtyaLfaP0vOfQ7ZUXsP1J/IB4SNHVK3wpAT0F7wOvudK103eUQllWJYpqe0AO0dFobJIV2tD/3JQ7hF7qGGChplUovYpSkiaMiQ7rsbLOiy6VDvAoVkcGbC0CsOG1Yjj9lFR6vk4G9LcItZb3+l/INMaG3Q6qXLp3V1rZUptuX3AvH8neAVOyNhw8f9iZa2FbPaXskL7arruSUjElNSXzEKxb0uoC6uFE+QcKrSKXVKotdZTJpWCYNzZUafc+W3KbB+4FJSOSDwjiYZTL17VG2vk6+iMu32lM91RME8DfP4fBOVG1EmgAAAABJRU5ErkJggg==";versionNumber="1.0.0.0";createElement(t,e,...i){const r=document.createElement(t);return Object.assign(r,e),i.forEach((t=>{"string"==typeof t&&(t=document.createTextNode(t)),r.appendChild(t)})),r}drawLandingPage(t,e){const i=this.createElement("div",{className:"landingPage"}),r=this.createElement("div",{className:"landingPageLogo"}),n=this.createElement("div",{className:"landingPageTekantisLogo"});n.appendChild(this.createElement("img",{src:this.tekantisLogo,alt:"Powered By Tekantis",style:"cursor:pointer",onclick:e=>{e.preventDefault(),t.launchUrl("https://www.tekantis.com/")}}));const o=(new DOMParser).parseFromString(this.logo,"image/svg+xml").documentElement;r.appendChild(o);const s=this.createElement("div",{className:"landingPageText"},this.createElement("h1",{textContent:"Icon Map Pro"}),this.createElement("p",{textContent:`Version: ${this.versionNumber}`,className:"version"}),this.createElement("p",{textContent:"Icon Map Pro allows you to integrate your data onto an interactive map within Power BI."}),this.createElement("p",{textContent:"Icon Map Pro is designed to be versatile, supporting a variety of mapping providers, allowing you to take advantage of your existing assets, or use Icon Map's own map backgrounds. With Icon Map Pro, you can bring your data to life in numerous compelling formats. Whether you're looking to depict data through circles, generate insightful heatmaps, cluster data using H3 technology, or portray information via custom images, lines, and shapes, Icon Map Pro has you covered. Furthermore, we accommodate a wide range of shape inputs. You can upload shapes as Shapefiles, GeoJSON or KML files, reference external files,  connect to external GIS platforms such as GeoServer or ArcGIS, or directly source WKT or GeoJSON formats from your Power BI data."}));return e&&s.appendChild(this.createElement("p",{textContent:"To purchase a licence, or to start a free trial, please visit the Microsoft AppSource marketplace using the icon at the top right of the visual, or to use with Publish to Web or Power BI Embedded, please contact us."})),s.appendChild(this.createElement("p",{},"For more information, instructions and support visit ",this.createElement("a",{href:"https://www.iconmappro.com/",textContent:"www.IconMapPro.com",target:"_blank",onclick:e=>{e.preventDefault(),t.launchUrl(e.target.href)}}))),i.appendChild(r),i.style.display="flex",i.appendChild(s),n.style.float="right",n.style.paddingRight="10px",s.appendChild(n),i}}},38470:(t,e,i)=>{"use strict";i.d(e,{z:()=>n});var r=i(11847);class n{generateTooltip(t,e,i,n,o,s,a){let l=[];if(null!=o&&o.length>0){if(o.sort(((t,e)=>{const i=t.source.rolesIndex.tooltip[0],r=e.source.rolesIndex.tooltip[0];return i<r?-1:i>r?1:0})),null!=i)for(let t=0;t<o.length;t++){const e=o[t],n=r.G2.create({format:e.source.format}).format(e.values[i]);l.push({displayName:e.source.displayName,value:n})}}else{let n="";if(null!=t.values[i]&&(n=t.values[i].toString()),l.push({displayName:t.source.displayName,value:n}),null!=e){const t=r.G2.create({format:e.source.format}).format(e.values[i]);l.push({displayName:e.source.displayName,value:t})}}null!=a&&(l=l.concat(a)),l=l.filter((t=>"selectionId"!==t.displayName)),l=l.filter((t=>"tooltipData"!==t.displayName)),["mouseover","touchstart","mousemove"].forEach((t=>{n.on(t,(function(e){const i=e.originalEvent||e.data.originalEvent;s.host.tooltipService.show({coordinates:[i.clientX,i.clientY],isTouchEvent:"touchstart"===t,dataItems:e.target.feature.properties.tooltipData,identities:[e.target.feature.properties.selectionId]})}))})),["mouseout","touchend"].forEach((t=>{n.on(t,(function(){s.host.tooltipService.hide({isTouchEvent:"touchend"===t,immediately:!0})}))})),null==n.feature&&(n.feature={type:void 0,properties:{},geometry:void 0}),n.feature.properties.tooltipData=l}}},31029:(t,e,i)=>{"use strict";i.d(e,{a:()=>p});var r=i(24227),n=i(92014),o=i(97072),s=i(90504),a=i(31758),l=i(18192),c=i(8154),u=i(90634),h=i(6894);class p{resetErrorMessages(t){t.removeErrorMessageByCategory("overlays")}getConditionalSetting(t,e,i,r){return function(t,e,i,r,n){const o=t.objects;if(o){const t=o[0];if(t){const e=t[i];if(e){const t=e[r];if(void 0!==t)return"string"==typeof t&&""==t.toString()?n:t}}}return n}(t.dataViews[0].categorical.categories[0],0,e,i,r)}setupOverlays(t,e,i,p){const d=this.getConditionalSetting(p,"overlays","vectorURL",t.overlays.vectorURL),f=this.getConditionalSetting(p,"overlays","esriLayerURL",t.overlays.esriLayerURL),m=this.getConditionalSetting(p,"overlays","rasterURL",t.overlays.rasterURL),g=this.getConditionalSetting(p,"overlays","geoJSONFileURL",t.overlays.geoJSONFileURL),_=d+f+m+g;return(new r.V).setupWeatherLayer(t,e,_),(new n.e).setupTrafficLayer(t,e,_),(new o.g).setupLabelsLayer(t,e,_),(new s.M).setupVectorOverlay(t,e,d,_),(new a.m).setupTerminator(t,e,i),(new l.k).setupGeoJSON(t,e,g,_),(new c.s).setupEsri(t,e,f,_),(new u.u).setupRasterOverlay(t,e,m,_),(new h.C).setupWmsOverlay(t,e,_),e}}},8154:(t,e,i)=>{"use strict";i.d(e,{s:()=>o});var r=i(53481),n=i(19619);class o{generateTooltip(t){const e=[];Object.keys(t.properties).forEach((function(i){if(null!=t.properties[i]){const r=t.properties[i].toString();e.some((t=>t.displayName===i&&t.value===r))||e.push({displayName:i,value:r})}})),t.properties.tooltipData=e}addTooltipEvents(t){t.esriReferenceLayerGroup.on("mouseover",(function(e){const i=e.originalEvent;void 0!==e.layer.feature.properties.tooltipData&&t.host.tooltipService.show({coordinates:[i.clientX,i.clientY],isTouchEvent:!1,dataItems:e.layer.feature.properties.tooltipData,identities:[e.layer.feature.properties.selectionId]})})),t.esriReferenceLayerGroup.on("mouseout",(function(){t.host.tooltipService.hide({isTouchEvent:!1,immediately:!1})}))}processBounds(t,e,i){let n=null;t.query().run((function(t,o){if(!t){for(const t of o.features){const e=r.geoJSON(t.geometry);n=e.getBounds(),null==i.autoZoomBounds?i.autoZoomBounds=n:i.autoZoomBounds.extend(n)}if(e.zoom.autoZoom&&!i.zoomLocked&&!i.settings.zoom.lockZoom){let t={};1==i.noOfZoomableItems&&(t={maxZoom:e.zoom.zoomLevelForSingle}),null!=i.autoZoomBounds&&i.map.fitBounds(i.autoZoomBounds,t)}}}))}generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupEsriLayer(t,e,i){if(""==i)return e;if(!t.overlays.esriLayer||null==i||""==i)return void(null!=e.esriReferenceLayerGroup&&(e.map.removeLayer(e.esriReferenceLayerGroup),e.esriReferenceLayerGroup=null));const r=this.generateTooltip,o=t.overlays.esriFillColor,s=t.overlays.esriOutlineColor,a=1-t.overlays.esriFillTransparency/100,l=1-t.overlays.esriOutlineTransparency/100,c=t.overlays.esriOutlineDashArray,u=t.overlays.esriOutlineWidth,h={url:i,apikey:t.apiKeys.esri,pane:"esriReference",style:function(e){return t.overlays.esriIncludeTooltips&&r(e),{fillColor:o,fillOpacity:a,color:s,opacity:l,weight:u,dashArray:c}}};null!=e.esriReferenceLayerGroup&&(e.map.removeLayer(e.esriReferenceLayerGroup),e.esriReferenceLayerGroup=null);const p=(0,n.featureLayer)(h);e.esriReferenceLayerGroup=p,e.map.addLayer(e.esriReferenceLayerGroup),t.overlays.esriIncludeInAutoZoom&&this.processBounds(p,t,e),t.overlays.esriIncludeTooltips&&this.addTooltipEvents(e)}setupEsri(t,e,i,r){return e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+JSON.stringify(r))&&(null!=e.esriReferenceLayerGroup&&(e.map.removeLayer(e.esriReferenceLayerGroup),e.esriReferenceLayerGroup),t.overlays.esriLayer&&(this.setupEsriLayer(t,e,i),e.map.getPane("esriReference").style.zIndex=t.overlays.esriZIndex.toString())),e.overlaySettingsHash=this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+JSON.stringify(r)),e}}},18192:(t,e,i)=>{"use strict";i.d(e,{k:()=>o});var r=i(53481),n=i(3075);class o{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupGeoJSONLayer(t,e,i){if(e.GeoJSONOverlay=this,""==i&&"url"==t.overlays.geoJSONFileSource||"file"==t.overlays.geoJSONFileSource&&""==t.geoJSONFileOverlay.geoJSONFileStore)return e;const r=i;if("url"==t.overlays.geoJSONFileSource){let n=e.geoJSONLoader.geoJSONFiles.find((t=>t.reference===r));null==n||null==n.file?n=e.geoJSONLoader.loadGeoJSONFile(i,i,this.setupMap,e,t,t.overlays.geoJSONFileSimplification):this.setupMap(e,t,i)}else this.setupMap(e,t,"UploadedOverlay")}setupMap(t,e,i){const o=i;let s;if("UploadedOverlay"==o){const t=atob(e.geoJSONFileOverlay.geoJSONFileStore.toString()),i=Array.from(t,(t=>t.charCodeAt(0))),r=new Uint8Array(i),a=n.UD(r,{to:"string"});s={reference:o,url:o,file:JSON.parse(a)}}else s=t.geoJSONLoader.geoJSONFiles.find((t=>t.reference===o));if(void 0===s||null==s.file)return;const a=e.overlays.geoJSONShowTooltips;let l=e.overlays.geoJSONFileFillColor,c=e.overlays.geoJSONFileOutlineColor;const u=e.overlays.geoJSONFileOutlineTransparency,h=e.overlays.geoJSONFileFillTransparency;let p=e.overlays.geoJSONFileOutlineWidth;const d=e.overlays.geoJSONFileOverrideStyle;let f=(100-u)/100,m=(100-h)/100;const g=e.overlays.geoJSONFileOutlineDashArray,_={style:function(t){return d||null!=t.properties&&(null!=t.properties.colour&&(l=t.properties.colour),null!=t.properties.color&&(l=t.properties.color),null!=t.properties.fill&&(l=t.properties.fill),null!=t.properties.stroke&&(c=t.properties.stroke),null!=t.properties.strokeWidth&&(p=t.properties.strokeWidth),null!=t.properties.strokeOpacity&&(f=t.properties.strokeOpacity),null!=t.properties.fillOpacity&&(m=t.properties.fillOpacity)),{weight:p,color:c,fillColor:l,fillOpacity:m,opacity:f,dashArray:g}},onEachFeature:function(t){a&&(t.properties.tooltipData=function(t){const e=[];return Object.keys(t.properties).forEach((function(i){if(null!=t.properties[i]){const r=t.properties[i].toString();e.some((t=>t.displayName===i&&t.value===r))||e.push({displayName:i,value:r})}})),e}(t))},pane:"geoJSONReference"},y=r.geoJSON(s.file,_);t.geoJSONReferenceLayerGroup=r.layerGroup([y]),a&&function(t,e){e.on("mouseover",(function(e){const i=e.originalEvent;void 0!==e.layer.feature.properties.tooltipData&&t.host.tooltipService.show({coordinates:[i.clientX,i.clientY],isTouchEvent:!1,dataItems:e.layer.feature.properties.tooltipData,identities:[e.layer.feature.properties.selectionId]})})),t.geoJSONReferenceLayerGroup.on("mouseout",(function(){t.host.tooltipService.hide({isTouchEvent:!1,immediately:!1})}))}(t,y),t.geoJSONReferenceLayerGroup.addTo(t.map)}setupGeoJSON(t,e,i,r){e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+r)&&(null!=e.geoJSONReferenceLayerGroup&&(e.map.removeLayer(e.geoJSONReferenceLayerGroup),e.geoJSONReferenceLayerGroup),t.overlays.geoJSONFile&&(this.setupGeoJSONLayer(t,e,i),e.map.getPane("geoJSONReference").style.zIndex=t.overlays.geoJSONFileZIndex.toString())),e.overlaySettingsHash=this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+r)}}},97072:(t,e,i)=>{"use strict";i.d(e,{g:()=>s});var r=i(53481),n=(i(72489),i(5020)),o=i(88524);i(77600);class s{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupAzureMaps(t,e){if(""==t.apiKeys.azureMaps)return e;const i=(new n.o).setupAuthentication(t),o=new r.TileLayer.AzureMaps({authOptions:i,tilesetId:"microsoft.base.labels.road",className:"LabelsOverlay",pane:"labels"});return e.mapLabelsLayerGroup=r.layerGroup([o]),e.mapLabelsLayerGroup.addTo(e.map),e}setupIconMap(t,e){const i={style:"https://styles.iconmappro.com/styles/labels-"+t.overlays.iconMapLabelStyle+".json",className:"LabelsOverlay",pane:"labels",attribution:'&copy; <a href="https://www.tekantis.com">Tekantis</a> &copy; <a href="http://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>'},n=r.maplibreGL(i);return e.mapLabelsLayerGroup=r.layerGroup([n]),e.mapLabelsLayerGroup.addTo(e.map),e}setupEsri(t,e){if(""==t.apiKeys.esri)return e;const i=t.overlays.esriLabelStyle,n=(0,o.vectorBasemapLayer)(i,{apiKey:t.apiKeys.esri,language:t.overlays.esriLanguage,pane:"labels"});return e.mapLabelsLayerGroup=r.layerGroup([n]),e.mapLabelsLayerGroup.addTo(e.map),e}setupLabelsLayer(t,e,i){e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+i)&&(null!=e.mapLabelsLayerGroup&&(e.map.removeLayer(e.mapLabelsLayerGroup),e.mapLabelsLayerGroup),t.overlays.mapLabels&&("azureMaps"===t.overlays.labelSource&&this.setupAzureMaps(t,e),"esri"===t.overlays.labelSource&&this.setupEsri(t,e),"iconMap"===t.overlays.labelSource&&this.setupIconMap(t,e),e.map.getPane("labels").style.zIndex=t.overlays.labelsZIndex.toString()))}}},90634:(t,e,i)=>{"use strict";i.d(e,{u:()=>n});var r=i(53481);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupRaster(t,e,i){if(""==i)return e;const n={maxZoom:t.overlays.rasterMaxZoom,minZoom:t.overlays.rasterMinZoom,opacity:1-t.overlays.rasterTransparency/100,pane:"rasterOverlay"},o=r.tileLayer(i,n);return e.rasterOverlayLayerGroup=r.layerGroup([o]),e.rasterOverlayLayerGroup.addTo(e.map),e}setupRasterOverlay(t,e,i,r){if(e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+r)&&(null!=e.rasterOverlayLayerGroup&&(e.map.removeLayer(e.rasterOverlayLayerGroup),e.rasterOverlayLayerGroup),t.overlays.rasterLayer)){this.setupRaster(t,e,i);const r=e.map.getPane("rasterOverlay");r&&(r.style.zIndex=t.overlays.rasterZIndex.toString())}}}},31758:(t,e,i)=>{"use strict";i.d(e,{m:()=>o});var r=i(46838),n=i.n(r);class o{setupTerminator(t,e,i){if(t.overlays.daylightTerminator&&!e.overlaySettingsChanged||null!=e.terminatorOverlay&&(e.map.removeLayer(e.terminatorOverlay),null!=e.terminatorTimer&&(clearInterval(e.terminatorTimer),e.terminatorOverlay=null)),t.overlays.daylightTerminator){let r;null!=i&&(null!=i.max?r=i.max:null!=i.maxLocal?r=i.maxLocal:i.values.length>0&&(r=i.values[0])),null==e.terminatorOverlay&&(e.terminatorOverlay=n()({fillOpacity:1-t.overlays.terminatorTransparency/100,pane:"terminator"}),e.map.addLayer(e.terminatorOverlay),null==r&&(e.terminatorTimer=window.setInterval((function(){!function(t){null!=t.terminatorOverlay&&t.terminatorOverlay.setTime()}(e)}),1e3))),null!=r&&e.terminatorOverlay.setTime(r)}return e}}},92014:(t,e,i)=>{"use strict";i.d(e,{e:()=>o});var r=i(53481),n=(i(72489),i(5020));i(37769);class o{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupAzureMaps(t,e){if(""==t.apiKeys.azureMaps||""==t.overlays.trafficLayer)return e;const i=(new n.o).setupAuthentication(t),o=new r.TileLayer.AzureMaps({authOptions:i,tilesetId:t.overlays.trafficLayer,className:"IconMapOverlay",pane:"traffic"});return e.trafficLayerGroup=r.layerGroup([o]),e.trafficLayerGroup.addTo(e.map),e}setupGoogleMaps(t,e){if(""!=t.apiKeys.googleMaps||"googleMaps"!=t.background.mapSource){const t=e.backgroundLayerGroup.getLayers()[0];null!=t&&(t.removeGoogleLayer("TrafficLayer"),t.addGoogleLayer("TrafficLayer")),e.trafficLayerGroup=null}}setupTrafficLayer(t,e,i){e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+i)&&(null!=e.trafficLayerGroup&&(e.map.removeLayer(e.trafficLayerGroup),e.trafficLayerGroup),t.overlays.traffic&&("googleMaps"===t.overlays.trafficSource&&this.setupGoogleMaps(t,e),"azureMaps"===t.overlays.trafficSource&&(this.setupAzureMaps(t,e),e.map.getPane("traffic").style.zIndex=t.overlays.trafficZIndex.toString())))}}},90504:(t,e,i)=>{"use strict";i.d(e,{M:()=>n});var r=i(53481);i(72489),i(77600);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupVector(t,e,i){if(""==i)return e;const n={style:i,maxZoom:t.overlays.vectorMaxZoom,minZoom:t.overlays.vectorMinZoom,pane:"vectorOverlay"},o=r.maplibreGL(n);return e.vectorOverlayLayerGroup=r.layerGroup([o]),e.vectorOverlayLayerGroup.addTo(e.map),e}setupVectorOverlay(t,e,i,r){e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+r)&&(null!=e.vectorOverlayLayerGroup&&(e.map.removeLayer(e.vectorOverlayLayerGroup),e.vectorOverlayLayerGroup),t.overlays.vector&&(this.setupVector(t,e,i),e.map.getPane("vectorOverlay").style.zIndex=t.overlays.vectorZIndex.toString()))}}},24227:(t,e,i)=>{"use strict";i.d(e,{V:()=>o});var r=i(53481),n=(i(72489),i(5020));class o{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupAzureMaps(t,e){if(""==t.apiKeys.azureMaps||""==t.overlays.weatherLayer)return e;const i=(new n.o).setupAuthentication(t),o=new r.TileLayer.AzureMaps({authOptions:i,tilesetId:t.overlays.weatherLayer,className:"IconMapOverlay",opacity:1-t.overlays.weatherTransparency/100,pane:"weather"});return e.weatherLayerGroup=r.layerGroup([o]),e.weatherLayerGroup.addTo(e.map),e}setupOpenWeatherMap(t,e){if(""!=t.apiKeys.openWeatherMap){const i=t.apiKeys.openWeatherMap,n=`https://tile.openweathermap.org/map/${t.overlays.weatherLayer}/{z}/{x}/{y}.png?appid=${i}`,o=r.tileLayer(n,{opacity:1-t.overlays.weatherTransparency/100,pane:"weather",attribution:'Weather data provided by <a href="https://openweathermap.org/">OpenWeather</a>'});e.weatherLayerGroup=r.layerGroup([o]),e.weatherLayerGroup.addTo(e.map)}}setupOpenWeatherMapAdvanced(t,e){if(""!=t.apiKeys.openWeatherMap){const i=t.apiKeys.openWeatherMap,n=`https://maps.openweathermap.org/maps/2.0/weather/${t.overlays.weatherLayer}/{z}/{x}/{y}?appid=${i}`,o=r.tileLayer(n,{opacity:1-t.overlays.weatherTransparency/100,pane:"weather",attribution:'Weather data provided by <a href="https://openweathermap.org/">OpenWeather</a>'});e.weatherLayerGroup=r.layerGroup([o]),e.weatherLayerGroup.addTo(e.map)}}setupWeatherLayer(t,e,i){if(e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+i)){if(null!=e.weatherLayerGroup){e.map.removeLayer(e.weatherLayerGroup),e.weatherLayerGroup;const t=e.map.getContainer().querySelector("#openweatherlogo");t&&(t.style.display="none")}if(t.overlays.weather){if("openWeatherMap"===t.overlays.weatherSource){this.setupOpenWeatherMap(t,e);const i=e.map.getContainer().querySelector("#openweatherlogo");i&&(i.style.display="block")}if("openWeatherMap2"===t.overlays.weatherSource){this.setupOpenWeatherMapAdvanced(t,e);const i=e.map.getContainer().querySelector("#openweatherlogo");i&&(i.style.display="block")}"azureMaps"===t.overlays.weatherSource&&this.setupAzureMaps(t,e),e.map.getPane("weather").style.zIndex=t.overlays.weatherZIndex.toString()}}}}},6894:(t,e,i)=>{"use strict";i.d(e,{C:()=>n});var r=i(53481);i(37142);class n{generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupWMS(t,e,i){if(""==i)return e;const n=new URL(t.overlays.wmsURL),o=n.searchParams;o.delete("request"),o.delete("service"),o.delete("version");const s=n.toString(),a=1-t.overlays.wmsTransparency/100,l=r.tileLayer.wms(s,{opacity:a,layers:t.overlays.wmsLayer,format:t.overlays.wmsFormat,transparent:!0});return e.wmsOverlayLayerGroup=r.layerGroup([l]),e.wmsOverlayLayerGroup.addTo(e.map),e}setupWmsOverlay(t,e,i){if(e.overlaySettingsHash!==this.generateHash(JSON.stringify(e.settings.overlays)+JSON.stringify(e.settings.apiKeys)+JSON.stringify(e.settings.background)+i)&&(null!=e.wmsOverlayLayerGroup&&(e.map.removeLayer(e.wmsOverlayLayerGroup),e.wmsOverlayLayerGroup),t.overlays.wms)){this.setupWMS(t,e,t.overlays.wmsURL);const i=e.map.getPane("wmsOverlay");i&&(i.style.zIndex=t.overlays.wmsZIndex.toString())}}}},24388:(t,e,i)=>{"use strict";i.d(e,{b:()=>f});var r=i(34806),n=i(73043),o=i(84862),s=i(62239),a=i(23087),l=i(56801),c=i(65809),u=i(38470),h=i(88805),p=i(31029),d=i(19220);class f{enterprise=!1;demo=!1;trialEndDate=null;element;iconMapVisual;formatting;background;dataLayers;controls;overlays;licenseManager;events;isLandingPageOn;LandingPageRemoved;landingPage;initialiseMap(){this.iconMapVisual.setupMap(this.formatting.settings)}generateHash(t){let e,i,r=0;if(0===t.length)return r.toString();for(e=0;e<t.length;e++)i=t.charCodeAt(e),r=(r<<5)-r+i,r|=0;return r.toString()}setupOverlayUploadButtons(t){const e=document.createElement("input");e.type="file",e.accept=".zip,.geojson,.json,.kml",e.id="fileUpload",e.style.display="none";const i=document.createElement("button");i.id="uploadButton",i.className="uploadButton",i.textContent="Upload GeoJSON / KML File",i.onclick=()=>{e.click(),document.getElementById("uploadButton").style.display="none"};const r=this.iconMapVisual;e.onchange=()=>{const t=e.files[0];r.geoJSONLoader.uploadGeoJSONFile(r,t),e.value=""},t.element.appendChild(e),t.element.appendChild(i)}configureUploadButton(t,e){e.type="file",e.accept=".zip,.geojson,.json,.kml",e.id=t,e.style.display="none"}configureVisibleButton(t,e,i){e.id=t,e.className="uploadButton",e.textContent="Upload GeoJSON / KML File",e.onclick=()=>{i.click(),document.getElementById(t).style.display="none"}}setupUploadButtons(t){const e=this.iconMapVisual;for(let i=1;i<=5;i++){const r=document.createElement("input");this.configureUploadButton(`fileUpload${i}`,r);const n=document.createElement("button");this.configureVisibleButton(`uploadButton${i}`,n,r),r.onchange=()=>{const t=r.files[0];e.geoJSONLoader.uploadGeoJSONFile(e,t,i),r.value=""},t.element.appendChild(r),t.element.appendChild(n)}}validateLicence(t,e){t?this.licenseRequired=!1:this.licenseManager.getAvailableServicePlans().then((t=>{const i=t.isLicenseUnsupportedEnv?1:0;1==i&&(e?this.iconMapVisual.addErrorMessage("licensing","trialExpired","Your trial has expired, please visit Microsoft AppSource or the Icon Map Pro website to purchase a license."):this.iconMapVisual.addErrorMessage("licensing","unsupportedEnvironment","To purchase a license for Power BI Embedded, Publish to Web, Regional Clouds or Power BI Report Server, please visit the Icon Map Pro website.")),t.plans&&t.plans.length&&t.plans[0].spIdentifier.startsWith("tekantislimited1706613112857.iconmap_pro.")&&(1==t.plans[0].state||2==t.plans[0].state)||1==i||this.licenseManager.notifyLicenseRequired(i).then((t=>{e?this.iconMapVisual.addErrorMessage("licensing","trialExpired","Your trial has expired, please visit the App Source or the Icon Map Pro website to purchase a license."):(this.iconMapVisual.addErrorMessage("licensing","unlicensed","This visual is currently unlicensed. To purchase a license, please visit Microsoft AppSource or the Icon Map Pro website."),this.iconMapVisual.productAttributionMessage="!UNLICENSED"),this.licenseRequired=t})).catch((t=>{console.log("ERROR",t)}))})).catch((t=>{console.log("err",t)}))}constructor(t){this.element=t.element,this.events=t.host.eventService,this.iconMapVisual=new l.Oz;let e=this.enterprise,i=!1;if(this.demo&&(this.iconMapVisual.productAttributionMessage+="!Demo use only",e=!0),null!=this.trialEndDate){const t=new Date;if(t>this.trialEndDate)this.iconMapVisual.productAttributionMessage+="!Trial expired",i=!0,e=!1;else{const i=Math.floor((this.trialEndDate.getTime()-t.getTime())/864e5);this.iconMapVisual.productAttributionMessage+="!Trial expires in "+i+" days",e=!0}}const r=t.element.classList.toString().split(" ").find((t=>t.startsWith("visual-iconMapPro")));if(this.iconMapVisual.visualGUID=r?r.substring(7):void 0,null==this.iconMapVisual.visualGUID&&(this.iconMapVisual.visualGUID="x"),this.iconMapVisual.instanceID=t.host.instanceId,null==this.iconMapVisual.instanceID&&(this.iconMapVisual.instanceID="x"),this.iconMapVisual.host=t.host,this.iconMapVisual.visualHost=this,this.formatting=new n.w,this.formatting.configureDefaultSettings(t.host),this.licenseManager=t.host.licenseManager,this.background=new o.s,this.dataLayers=new s.p,this.controls=new a.H,this.overlays=new p.a,document){const r=document.createElement("div"),n=document.createAttribute("data-tap-disable");n.value="true",r.attributes.setNamedItem(n),r.style.width="100%",r.style.height="100%",r.id="map",t.element.appendChild(r),this.setupOverlayUploadButtons(t),this.setupUploadButtons(t);const o=document.createElement("a");o.href="https://www.mapbox.com/about/maps/",o.target="_blank",o.text="Mapbox",o.id="mapboxlogo",o.className="mapbox-logo",r.appendChild(o);const s=document.createElement("div");s.id="OSLogo",s.className="OSLogo",r.appendChild(s),this.iconMapVisual.host=t.host;const a=document.createElement("div");a.id="openweatherlogo",a.className="openweatherlogo",r.appendChild(a),this.iconMapVisual.host=t.host,this.iconMapVisual.setupErrorMessageHolder(t.element),this.iconMapVisual.setupSelectionManager(),this.iconMapVisual.clickEvents=new c.ib,this.iconMapVisual.tooltips=new u.z,this.iconMapVisual.labels=new h.gC,this.validateLicence(e,i)}}HandleLandingPage(t,e){if(t.dataViews&&t.dataViews[0]?.metadata?.columns?.length)this.isLandingPageOn&&!this.LandingPageRemoved&&(this.LandingPageRemoved=!0,this.landingPage.remove());else if(!this.isLandingPageOn){this.isLandingPageOn=!0;const t=(new d.n).drawLandingPage(this.iconMapVisual.host,e);t.className="landingPage",this.element.appendChild(t),this.landingPage=t}}licenseRequired=!0;persistingZoom=!1;update(t){if(this.events.renderingStarted(t),void 0===this.iconMapVisual)return;if(this.HandleLandingPage(t,this.licenseRequired),this.iconMapVisual.settings=this.formatting.updateSettings(t,this.iconMapVisual),this.persistingZoom)return void(this.persistingZoom=!1);if(this.iconMapVisual.settings.map.dataMaxRows>3e4&&t.dataViews[0].categorical.categories[0].values.length<this.iconMapVisual.settings.map.dataMaxRows&&t.dataViews[0].metadata.segment&&this.iconMapVisual.host.fetchMoreData(!0))return;void 0===this.iconMapVisual.map&&this.initialiseMap(),this.iconMapVisual=this.background.setupBackground(this.formatting.settings,this.iconMapVisual,t),this.controls.setupControls(this.formatting.settings,this.iconMapVisual);const e=t.dataViews[0].categorical.values;let i;null!=e&&(i=e.grouped());const n=r.getMeasureIndexOfRole(i,"Time");let o;null!=t.dataViews[0].categorical&&null!=t.dataViews[0].categorical.values&&(o=t.dataViews[0].categorical.values[n]),this.iconMapVisual=this.overlays.setupOverlays(this.formatting.settings,this.iconMapVisual,o,t),this.iconMapVisual=this.dataLayers.setupDataLayers(this.formatting.settings,this.iconMapVisual,t),null!=this.iconMapVisual?(this.iconMapVisual.zoomToBounds(this.formatting.settings),this.iconMapVisual.highlightItems(t),0==t.viewMode||this.iconMapVisual.settings.zoom.autoZoom||this.iconMapVisual.map.on("moveend",(()=>{this.persistingZoom=!0;const t={defaultLat:this.iconMapVisual.map.getCenter().lat,defaultLong:this.iconMapVisual.map.getCenter().lng,defaultZoom:this.iconMapVisual.map.getZoom()},e={merge:[{objectName:"defaultZoom",properties:t,selector:null}]};this.iconMapVisual.host.persistProperties(e),this.iconMapVisual.settings.zoom.defaultLat=t.defaultLat,this.iconMapVisual.settings.zoom.defaultLong=t.defaultLong,this.iconMapVisual.settings.zoom.defaultZoom=t.defaultZoom})),this.events.renderingFinished(t),this.iconMapVisual.overlaySettingsHash=this.generateHash(JSON.stringify(this.iconMapVisual.settings.overlays)+JSON.stringify(this.iconMapVisual.settings.apiKeys)+JSON.stringify(this.iconMapVisual.settings.background))):this.events.renderingFinished(t)}getFormattingModel(){return(new n.w).configureFormattingCard(this.formatting.settings,this.iconMapVisual)}}},91210:t=>{"use strict";t.exports=null},42634:()=>{},16443:function(t){t.exports=function(){"use strict";var t,e,i;function r(r,n){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",s={};t(s),i=n(s),"undefined"!=typeof window&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=n;else t=n}return r(0,(function(t){function e(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}"function"==typeof SuppressedError&&SuppressedError;var r=n;function n(t,e){this.x=t,this.y=e}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t};var o=i(r),s=a;function a(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var n=this.sampleCurveX(i)-t;if(Math.abs(n)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=t,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-t)<e));r++)t>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var l=i(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function p(){if(null==u&&(u=!1,h())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const r=4*i;e.fillStyle=`rgb(${r},${r+1},${r+2})`,e.fillRect(i%t,Math.floor(i/t),1,1)}const i=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&i[e]!==e){u=!0;break}}}return u||!1}function d(t,e,i,r){const n=new l(t,e,i,r);return function(t){return n.solve(t)}}const f=d(.25,.1,.25,1);function m(t,e,i){return Math.min(i,Math.max(e,t))}function g(t,e,i){const r=i-e,n=((t-e)%r+r)%r+e;return n===e?i:n}function _(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let y=1;function A(t,e,i){const r={};for(const n in t)r[n]=e.call(i||this,t[n],n,t);return r}function v(t,e,i){const r={};for(const n in t)e.call(i||this,t[n],n,t)&&(r[n]=t[n]);return r}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?A(t,x):t}const b={};function w(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function S(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function T(t){let e=0;for(let i,r,n=0,o=t.length,s=o-1;n<o;s=n++)i=t[n],r=t[s],e+=(r.x-i.x)*(i.y+r.y);return e}function C(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}let M=null;function E(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const I="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function L(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const s=null==e?void 0:e.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(n*o*4);if(yield e.copyTo(l,function(t,e,i,r,n){const o=4*Math.max(-e,0),s=(Math.max(0,i)-i)*r*4+o,a=4*r,l=Math.max(0,e),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(t.width,e+r)-l,height:Math.min(t.height,i+n)-c},layout:[{offset:s,stride:a}]}}(t,i,r,n,o)),a)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}}))}let P,k,N,D;const O={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i},resolveURL:t=>(N||(N=document.createElement("a")),N.href=t,N.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==D&&(D=matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}},R={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class F extends Error{constructor(t,e,i,r){super(`AJAXError: ${e} (${t}): ${i}`),this.status=t,this.statusText=e,this.url=i,this.body=r}}const z=C()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href,B=t=>R.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))];function U(t,e){const i=new AbortController,r=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:z(),signal:i.signal});let n=!1,o=!1;return"json"===t.type&&r.headers.set("Accept","application/json"),o||fetch(r).then((i=>i.ok?(i=>{("arrayBuffer"===t.type||"image"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{o||(n=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{o||e(new Error(t.message))}))})(i):i.blob().then((r=>e(new F(i.status,i.statusText,t.url,r)))))).catch((t=>{20!==t.code&&e(new Error(t.message))})),{cancel:()=>{o=!0,n||i.abort()}}}const V=function(t,e){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){if(C()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e);if(!C())return(B(t.url)||U)(t,e)}if(!(/^file:/.test(i=t.url)||/^file:/.test(z())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return U(t,e);if(C()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(i.responseType="arraybuffer");for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===t.type)try{r=JSON.parse(i.response)}catch(t){return e(t)}e(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else{const r=new Blob([i.response],{type:i.getResponseHeader("Content-Type")});e(new F(i.status,i.statusText,t.url,r))}},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},j=function(t,e){return V(_(t,{type:"arrayBuffer"}),e)};function G(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function Z(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function q(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class W{constructor(t,e={}){_(this,e),this.type=t}}class H extends W{constructor(t,e={}){super("error",_({error:t},e))}}class J{on(t,e){return this._listeners=this._listeners||{},Z(t,e,this._listeners),this}off(t,e){return q(t,e,this._listeners),q(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Z(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new W(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of r)q(i,e,this._oneTimeListeners),e.call(this,t);const n=this._eventedParent;n&&(_(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(t))}else t instanceof H&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var K={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Y(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return $.forEach((t=>{t in e&&(i[t]=e[t])})),i}function X(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!X(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!X(t[i],e[i]))return!1;return!0}return t===e}const Q={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function tt(t,e,i){i.push({command:Q.addSource,args:[t,e[t]]})}function et(t,e,i){e.push({command:Q.removeSource,args:[t]}),i[t]=!0}function it(t,e,i,r){et(t,i,r),tt(t,e,i)}function rt(t,e,i){let r;for(r in t[i])if(Object.prototype.hasOwnProperty.call(t[i],r)&&"data"!==r&&!X(t[i][r],e[i][r]))return!1;for(r in e[i])if(Object.prototype.hasOwnProperty.call(e[i],r)&&"data"!==r&&!X(t[i][r],e[i][r]))return!1;return!0}function nt(t,e,i,r,n,o){let s;for(s in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,s)&&(X(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}));for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&!Object.prototype.hasOwnProperty.call(t,s)&&(X(t[s],e[s])||i.push({command:o,args:[r,s,e[s],n]}))}function ot(t){return t.id}function st(t,e){return t[e.id]=e,t}class at{constructor(t,e,i,r){this.message=(t?`${t}: `:"")+i,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function lt(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class ct extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class ut{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new ut(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ht={kind:"null"},pt={kind:"number"},dt={kind:"string"},ft={kind:"boolean"},mt={kind:"color"},gt={kind:"object"},_t={kind:"value"},yt={kind:"collator"},At={kind:"formatted"},vt={kind:"padding"},xt={kind:"resolvedImage"},bt={kind:"variableAnchorOffsetCollection"};function wt(t,e){return{kind:"array",itemType:t,N:e}}function St(t){if("array"===t.kind){const e=St(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Tt=[ht,pt,dt,ft,mt,At,gt,wt(_t),vt,xt,bt];function Ct(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ct(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Tt)if(!Ct(t,e))return null}return`Expected ${St(t)} but found ${St(e)} instead.`}function Mt(t,e){return e.some((e=>e.kind===t.kind))}function Et(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function It(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const Lt=.96422,Pt=.82521,kt=4/29,Nt=6/29,Dt=3*Nt*Nt,Ot=Nt*Nt*Nt,Rt=Math.PI/180,Ft=180/Math.PI;function zt(t){return(t%=360)<0&&(t+=360),t}function Bt([t,e,i,r]){let n,o;const s=Vt((.2225045*(t=Ut(t))+.7168786*(e=Ut(e))+.0606169*(i=Ut(i)))/1);t===e&&e===i?n=o=s:(n=Vt((.4360747*t+.3850649*e+.1430804*i)/Lt),o=Vt((.0139322*t+.0971045*e+.7141733*i)/Pt));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function Ut(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Vt(t){return t>Ot?Math.pow(t,1/3):t/Dt+kt}function jt([t,e,i,r]){let n=(t+16)/116,o=isNaN(e)?n:n+e/500,s=isNaN(i)?n:n-i/200;return n=1*Zt(n),o=Lt*Zt(o),s=Pt*Zt(s),[Gt(3.1338561*o-1.6168667*n-.4906146*s),Gt(-.9787684*o+1.9161415*n+.033454*s),Gt(.0719453*o-.2289914*n+1.4052427*s),r]}function Gt(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function Zt(t){return t>Nt?t*t*t:Dt*(t-kt)}function qt(t){return parseInt(t.padEnd(2,t),16)/255}function Wt(t,e){return Ht(e?t/100:t,0,1)}function Ht(t,e,i){return Math.min(Math.max(e,t),i)}function Jt(t){return!t.some(Number.isNaN)}const Kt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $t{constructor(t,e,i,r=1,n=!0){this.r=t,this.g=e,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[t,e,i,r]))}static parse(t){if(t instanceof $t)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=Kt[t];if(e){const[t,i,r]=e;return[t/255,i/255,r/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let i=1;return[qt(t.slice(i,i+=e)),qt(t.slice(i,i+=e)),qt(t.slice(i,i+=e)),qt(t.slice(i,i+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,i,r,n,o,s,a,l,c,u,h,p]=e,d=[n||" ",a||" ",u].join("");if("  "===d||"  /"===d||",,"===d||",,,"===d){const t=[r,s,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[Ht(+i/e,0,1),Ht(+o/e,0,1),Ht(+l/e,0,1),h?Wt(+h,p):1];if(Jt(t))return t}}return}}const i=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[t,e,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,Ht(+n,0,100),Ht(+s,0,100),l?Wt(+l,c):1];if(Jt(t))return function([t,e,i,r]){function n(r){const n=(r+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return t=zt(t),e/=100,i/=100,[n(0),n(8),n(4),r]}(t)}}}(t);return e?new $t(...e,!1):void 0}get rgb(){const{r:t,g:e,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[t/n,e/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,i,r,n]=Bt(t),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?zt(Math.atan2(r,i)*Ft):NaN,o,e,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Bt(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,i,r]=this.rgb;return`rgba(${[t,e,i].map((t=>Math.round(255*t))).join(",")},${r})`}}$t.black=new $t(0,0,0,1),$t.white=new $t(1,1,1,1),$t.transparent=new $t(0,0,0,0),$t.red=new $t(1,0,0,1);class Yt{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xt{constructor(t,e,i,r,n){this.text=t,this.image=e,this.scale=i,this.fontStack=r,this.textColor=n}}class Qt{constructor(t){this.sections=t}static fromString(t){return new Qt([new Xt(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Qt?t:Qt.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}}class te{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof te)return t;if("number"==typeof t)return new te([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new te(t)}}toString(){return JSON.stringify(this.values)}}const ee=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ie{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ie)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const i=t[e],r=t[e+1];if("string"!=typeof i||!ee.has(i))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new ie(t)}}toString(){return JSON.stringify(this.values)}}class re{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new re({name:t,available:!1}):null}}function ne(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oe(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof $t||t instanceof Yt||t instanceof Qt||t instanceof te||t instanceof ie||t instanceof re)return!0;if(Array.isArray(t)){for(const e of t)if(!oe(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!oe(t[e]))return!1;return!0}return!1}function se(t){if(null===t)return ht;if("string"==typeof t)return dt;if("boolean"==typeof t)return ft;if("number"==typeof t)return pt;if(t instanceof $t)return mt;if(t instanceof Yt)return yt;if(t instanceof Qt)return At;if(t instanceof te)return vt;if(t instanceof ie)return bt;if(t instanceof re)return xt;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=se(e);if(i){if(i===t)continue;i=_t;break}i=t}return wt(i||_t,e)}return gt}function ae(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof $t||t instanceof Qt||t instanceof te||t instanceof ie||t instanceof re?t.toString():JSON.stringify(t)}class le{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!oe(t[1]))return e.error("invalid value");const i=t[1];let r=se(i);const n=e.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new le(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ce{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ue={string:dt,number:pt,boolean:ft,object:gt};class he{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,r=1;const n=t[0];if("array"===n){let n,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in ue)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);n=ue[i],r++}else n=_t;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}i=wt(n,o)}else{if(!ue[n])throw new Error(`Types doesn't contain name = ${n}`);i=ue[n]}const o=[];for(;r<t.length;r++){const i=e.parse(t[r],r,_t);if(!i)return null;o.push(i)}return new he(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Ct(this.type,se(i)))return i;if(e===this.args.length-1)throw new ce(`Expected value to be of type ${St(this.type)}, but found ${St(se(i))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const pe={"to-boolean":ft,"to-color":mt,"to-number":pt,"to-string":dt};class de{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(!pe[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const r=pe[i],n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],i,_t);if(!r)return null;n.push(r)}return new de(r,n)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,i;for(const r of this.args){if(e=r.evaluate(t),i=null,e instanceof $t)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:ne(e[0],e[1],e[2],e[3]),!i))return new $t(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ce(i||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const i of this.args){e=i.evaluate(t);const r=te.parse(e);if(r)return r}throw new ce(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const i of this.args){e=i.evaluate(t);const r=ie.parse(e);if(r)return r}throw new ce(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new ce(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return Qt.fromString(ae(this.args[0].evaluate(t)));case"resolvedImage":return re.fromString(ae(this.args[0].evaluate(t)));default:return ae(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const fe=["Unknown","Point","LineString","Polygon"];class me{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?fe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=$t.parse(t)),e}}class ge{constructor(t,e,i=[],r,n=new ut,o=[]){this.registry=t,this.path=i,this.key=i.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=e}parse(t,e,i,r,n={}){return e?this.concat(e,i,r)._parse(t,n):this._parse(t,n)}_parse(t,e){function i(t,e,i){return"assert"===i?new he(e,[t]):"coerce"===i?new de(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,n=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind)if("padding"!==t.kind||"value"!==n.kind&&"number"!==n.kind&&"array"!==n.kind)if("variableAnchorOffsetCollection"!==t.kind||"value"!==n.kind&&"array"!==n.kind){if(this.checkSubtype(t,n))return null}else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"coerce");else r=i(r,t,e.typeAnnotation||"assert")}if(!(r instanceof le)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const e=new me;try{r=new le(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const r="number"==typeof t?this.path.concat(t):this.path,n=i?this.scope.concat(i):this.scope;return new ge(this.registry,this._isConstant,r,e||null,n,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new ct(i,t))}checkSubtype(t,e){const i=Ct(t,e);return i&&this.error(i),i}}class _e{constructor(t,e,i){this.type=yt,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ft);if(!r)return null;const n=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ft);if(!n)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,dt),!o)?null:new _e(r,n,o)}evaluate(t){return new Yt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const ye=8192;function Ae(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ve(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function xe(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,n=Math.pow(2,e.z);return[Math.round(i*n*ye),Math.round(r*n*ye)]}function be(t,e,i){const r=t[0]-e[0],n=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function we(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(be(t,a[e],a[e+1]))return!1;(n=a[e])[1]>(r=t)[1]!=(o=a[e+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function Se(t,e){for(let i=0;i<e.length;i++)if(we(t,e[i]))return!0;return!1}function Te(t,e,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(t[0]-i[0])*o-n*(t[1]-i[1]),a=(e[0]-i[0])*o-n*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ce(t,e,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(n=e)[0]-(r=t)[0],n[1]-r[1]])[1]-a[1]*l[0]&&Te(r,n,o,s)&&Te(o,s,r,n))return!0;var r,n,o,s,a,l;return!1}function Me(t,e){for(let i=0;i<t.length;++i)if(!we(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ce(t[i],t[i+1],e))return!1;return!0}function Ee(t,e){for(let i=0;i<e.length;i++)if(Me(t,e[i]))return!0;return!1}function Ie(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=[];for(let r=0;r<t[n].length;r++){const s=xe(t[n][r],i);Ae(e,s),o.push(s)}r.push(o)}return r}function Le(t,e,i){const r=[];for(let n=0;n<t.length;n++){const o=Ie(t[n],e,i);r.push(o)}return r}function Pe(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const e=.5*r;let n=t[0]-i[0]>e?-r:i[0]-t[0]>e?r:0;0===n&&(n=t[0]-i[2]>e?-r:i[2]-t[0]>e?r:0),t[0]+=n}Ae(e,t)}function ke(t,e,i,r){const n=Math.pow(2,r.z)*ye,o=[r.x*ye,r.y*ye],s=[];for(const r of t)for(const t of r){const r=[t.x+o[0],t.y+o[1]];Pe(r,e,i,n),s.push(r)}return s}function Ne(t,e,i,r){const n=Math.pow(2,r.z)*ye,o=[r.x*ye,r.y*ye],s=[];for(const i of t){const t=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Ae(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=n/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)Pe(r,e,i,n)}var a;return s}class De{constructor(t,e){this.type=ft,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(oe(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new De(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new De(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new De(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=Ie(e.coordinates,r,n),s=ke(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!we(t,o))return!1}if("MultiPolygon"===e.type){const o=Le(e.coordinates,r,n),s=ke(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Se(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=t.canonicalID();if("Polygon"===e.type){const o=Ie(e.coordinates,r,n),s=Ne(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Me(t,o))return!1}if("MultiPolygon"===e.type){const o=Le(e.coordinates,r,n),s=Ne(t.geometry(),i,r,n);if(!ve(i,r))return!1;for(const t of s)if(!Ee(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Oe{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Oe(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Re{constructor(t,e,i,r){this.name=t,this.type=e,this._evaluate=i,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const i=t[0],r=Re.definitions[i];if(!r)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[r,o]of s){a=new ge(e.registry,Fe,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],n=Array.isArray(r)?r[e-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(r)?r[t]:r.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Re(i,n,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(St).join(", ")})`:`(${St(e.type)}...)`;var e})).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(St(n.type))}e.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){Re.definitions=e;for(const i in e)t[i]=Re}}function Fe(t){if(t instanceof Oe)return Fe(t.boundExpression);if(t instanceof Re&&"error"===t.name)return!1;if(t instanceof _e)return!1;if(t instanceof De)return!1;const e=t instanceof de||t instanceof he;let i=!0;return t.eachChild((t=>{i=e?i&&Fe(t):i&&t instanceof le})),!!i&&ze(t)&&Ue(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ze(t){if(t instanceof Re){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof De)return!1;let e=!0;return t.eachChild((t=>{e&&!ze(t)&&(e=!1)})),e}function Be(t){if(t instanceof Re&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Be(t)&&(e=!1)})),e}function Ue(t,e){if(t instanceof Re&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Ue(t,e)&&(i=!1)})),i}function Ve(t,e){const i=t.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],n=t[a+1],r<=e){if(a===i||e<n)return a;o=a+1}else{if(!(r>e))throw new ce("Input is not a number.");s=a-1}return 0}class je{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,pt);if(!i)return null;const r=[];let n=null;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new je(n,i,r)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;return r>=e[n-1]?i[n-1].evaluate(t):i[Ve(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Ge(t,e,i){return t+i*(e-t)}function Ze(t,e,i){return t.map(((t,r)=>Ge(t,e[r],i)))}const qe={number:Ge,color:function(t,e,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=Ze(t.rgb,e.rgb,i);return new $t(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=t.hcl,[a,l,c,u]=e.hcl;let h,p;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(p=l)):(h=r,1!==c&&0!==c||(p=n));else{let t=a-r;a>r&&t>180?t-=360:a<r&&r-a>180&&(t+=360),h=r+i*t}const[d,f,m,g]=function([t,e,i,r]){return t=isNaN(t)?0:t*Rt,jt([i,Math.cos(t)*e,Math.sin(t)*e,r])}([h,null!=p?p:Ge(n,l,i),Ge(o,c,i),Ge(s,u,i)]);return new $t(d,f,m,g,!1)}case"lab":{const[r,n,o,s]=jt(Ze(t.lab,e.lab,i));return new $t(r,n,o,s,!1)}}},array:Ze,padding:function(t,e,i){return new te(Ze(t.values,e.values,i))},variableAnchorOffsetCollection:function(t,e,i){const r=t.values,n=e.values;if(r.length!==n.length)throw new ce(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let t=0;t<r.length;t+=2){if(r[t]!==n[t])throw new ce(`Cannot interpolate values containing mismatched anchors. from[${t}]: ${r[t]}, to[${t}]: ${n[t]}`);o.push(r[t]);const[e,s]=r[t+1],[a,l]=n[t+1];o.push([Ge(e,a,i),Ge(s,l,i)])}return new ie(o)}};class We{constructor(t,e,i,r,n){this.type=t,this.operator=e,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,r){let n=0;if("exponential"===t.name)n=He(e,t.base,i,r);else if("linear"===t.name)n=He(e,1,i,r);else if("cubic-bezier"===t.name){const o=t.controlPoints;n=new l(o[0],o[1],o[2],o[3]).solve(He(e,1,i,r))}return n}static parse(t,e){let[i,r,n,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(n=e.parse(n,2,pt),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=mt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],r=o[t+1],n=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=e.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return It(a,pt)||It(a,mt)||It(a,vt)||It(a,bt)||It(a,wt(pt))?new We(a,i,r,n,s):e.error(`Type ${St(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return i[0].evaluate(t);const n=e.length;if(r>=e[n-1])return i[n-1].evaluate(t);const o=Ve(e,r),s=We.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);switch(this.operator){case"interpolate":return qe[this.type.kind](a,l,s);case"interpolate-hcl":return qe.color(a,l,s,"hcl");case"interpolate-lab":return qe.color(a,l,s,"lab")}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function He(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}class Je{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const r=e.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of t.slice(1)){const t=e.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,n.push(t)}if(!i)throw new Error("No output type");const o=r&&n.some((t=>Ct(r,t.type)));return new Je(o?_t:i,n)}evaluate(t){let e,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(t),i&&i instanceof re&&!i.available&&(e||(e=i.name),i=null,r===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}class Ke{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let r=1;r<t.length-1;r+=2){const n=t[r];if("string"!=typeof n)return e.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=e.parse(t[r+1],r+1);if(!o)return null;i.push([n,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return r?new Ke(i,r):null}outputDefined(){return this.result.outputDefined()}}class $e{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,pt),r=e.parse(t[2],2,wt(e.expectedType||_t));return i&&r?new $e(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ce(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ce(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ce(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ye{constructor(t,e){this.type=ft,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,_t),r=e.parse(t[2],2,_t);return i&&r?Mt(i.type,[ft,dt,pt,ht,_t])?new Ye(i,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!Et(e,["boolean","string","number","null"]))throw new ce(`Expected first argument to be of type boolean, string, number or null, but found ${St(se(e))} instead.`);if(!Et(i,["string","array"]))throw new ce(`Expected second argument to be of type array or string, but found ${St(se(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Xe{constructor(t,e,i){this.type=pt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,_t),r=e.parse(t[2],2,_t);if(!i||!r)return null;if(!Mt(i.type,[ft,dt,pt,ht,_t]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${St(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,pt);return n?new Xe(i,r,n):null}return new Xe(i,r)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Et(e,["boolean","string","number","null"]))throw new ce(`Expected first argument to be of type boolean, string, number or null, but found ${St(se(e))} instead.`);if(!Et(i,["string","array"]))throw new ce(`Expected second argument to be of type array or string, but found ${St(se(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return i.indexOf(e,r)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Qe{constructor(t,e,i,r,n,o){this.inputType=t,this.type=e,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,se(t)))return null}else i=se(t);if(void 0!==n[String(t)])return c.error("Branch labels must be unique.");n[String(t)]=o.length}const u=e.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,_t);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new Qe(i,r,s,n,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ti{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const r=[];for(let n=1;n<t.length-1;n+=2){const o=e.parse(t[n],n,ft);if(!o)return null;const s=e.parse(t[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=e.parse(t[t.length-1],t.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new ti(i,r,n)}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ei{constructor(t,e,i,r){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,_t),r=e.parse(t[2],2,pt);if(!i||!r)return null;if(!Mt(i.type,[wt(_t),dt,_t]))return e.error(`Expected first argument to be of type array or string, but found ${St(i.type)} instead`);if(4===t.length){const n=e.parse(t[3],3,pt);return n?new ei(i.type,i,r,n):null}return new ei(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Et(e,["string","array"]))throw new ce(`Expected first argument to be of type array or string, but found ${St(se(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(i,r)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ii(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ri(t,e,i,r){return 0===r.compare(e,i)}function ni(t,e,i){const r="=="!==t&&"!="!==t;return class n{constructor(t,e,i){this.type=ft,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,_t);if(!o)return null;if(!ii(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${St(o.type)}'.`);let s=e.parse(t[2],2,_t);if(!s)return null;if(!ii(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${St(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${St(o.type)}' and '${St(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new he(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new he(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,yt),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const e=se(o),i=se(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ce(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=se(o),i=se(s);if("string"!==t.kind||"string"!==i.kind)return e(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):e(n,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const oi=ni("==",(function(t,e,i){return e===i}),ri),si=ni("!=",(function(t,e,i){return e!==i}),(function(t,e,i,r){return!ri(0,e,i,r)})),ai=ni("<",(function(t,e,i){return e<i}),(function(t,e,i,r){return r.compare(e,i)<0})),li=ni(">",(function(t,e,i){return e>i}),(function(t,e,i,r){return r.compare(e,i)>0})),ci=ni("<=",(function(t,e,i){return e<=i}),(function(t,e,i,r){return r.compare(e,i)<=0})),ui=ni(">=",(function(t,e,i){return e>=i}),(function(t,e,i,r){return r.compare(e,i)>=0}));class hi{constructor(t,e,i,r,n){this.type=dt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,pt);if(!i)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=e.parse(r.locale,1,dt),!n))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,dt),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=e.parse(r["min-fraction-digits"],1,pt),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=e.parse(r["max-fraction-digits"],1,pt),!a)?null:new hi(i,n,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class pi{constructor(t){this.type=At,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,pt),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,wt(dt)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,mt),!s))return null;const a=r[r.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,_t);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new pi(r)}evaluate(t){return new Qt(this.sections.map((e=>{const i=e.content.evaluate(t);return se(i)===xt?new Xt("",i,null,null,null):new Xt(ae(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}}class di{constructor(t){this.type=xt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,dt);return i?new di(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=re.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}}class fi{constructor(t){this.type=pt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${St(i.type)} instead.`):new fi(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ce(`Expected value to be of type string or array, but found ${St(se(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const mi={"==":oi,"!=":si,">":li,"<":ai,">=":ui,"<=":ci,array:he,at:$e,boolean:he,case:ti,coalesce:Je,collator:_e,format:pi,image:di,in:Ye,"index-of":Xe,interpolate:We,"interpolate-hcl":We,"interpolate-lab":We,length:fi,let:Ke,literal:le,match:Qe,number:he,"number-format":hi,object:he,slice:ei,step:je,string:he,"to-boolean":de,"to-color":de,"to-number":de,"to-string":de,var:Oe,within:De};function gi(t,[e,i,r,n]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const o=n?n.evaluate(t):1,s=ne(e,i,r,o);if(s)throw new ce(s);return new $t(e/255,i/255,r/255,o,!1)}function _i(t,e){return t in e}function yi(t,e){const i=e[t];return void 0===i?null:i}function Ai(t){return{type:t}}function vi(t){return{result:"success",value:t}}function xi(t){return{result:"error",value:t}}function bi(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function wi(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Si(t){return!!t.expression&&t.expression.interpolated}function Ti(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ci(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Mi(t){return t}function Ei(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],n=r||!(r||void 0!==t.property),o=t.type||(Si(e)?"exponential":"interval");if(i||"padding"===e.type){const r=i?$t.parse:te.parse;(t=lt({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],r(t[1])]))),t.default=r(t.default?t.default:e.default)}if(t.colorSpace&&"rgb"!==(s=t.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${t.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=ki;else if("interval"===o)a=Pi;else if("categorical"===o){a=Li,l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Ni}if(r){const i={},r=[];for(let e=0;e<t.stops.length;e++){const n=t.stops[e],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const t of r)n.push([i[t].zoom,Ei(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:We.interpolationFactor.bind(void 0,o),zoomStops:n.map((t=>t[0])),evaluate:({zoom:i},r)=>ki({stops:n,base:t.base},e,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:We.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>a(t,e,i,l,c)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[t.property]:void 0;return void 0===n?Ii(t.default,e.default):a(t,e,n,l,c)}}}function Ii(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Li(t,e,i,r,n){return Ii(typeof i===n?r[i]:void 0,t.default,e.default)}function Pi(t,e,i){if("number"!==Ti(i))return Ii(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const n=Ve(t.stops.map((t=>t[0])),i);return t.stops[n][1]}function ki(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Ti(i))return Ii(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const o=Ve(t.stops.map((t=>t[0])),i),s=function(t,e,i,r){const n=r-i,o=t-i;return 0===n?0:1===e?o/n:(Math.pow(e,o)-1)/(Math.pow(e,n)-1)}(i,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],c=qe[e.type]||Mi;return"function"==typeof a.evaluate?{evaluate(...e){const i=a.evaluate.apply(void 0,e),r=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==r)return c(i,r,s,t.colorSpace)}}:c(a,l,s,t.colorSpace)}function Ni(t,e,i){switch(e.type){case"color":i=$t.parse(i);break;case"formatted":i=Qt.fromString(i.toString());break;case"resolvedImage":i=re.fromString(i.toString());break;case"padding":i=te.parse(i);break;default:Ti(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0)}return Ii(i,t.default,e.default)}Re.register(mi,{error:[{kind:"error"},[dt],(t,[e])=>{throw new ce(e.evaluate(t))}],typeof:[dt,[_t],(t,[e])=>St(se(e.evaluate(t)))],"to-rgba":[wt(pt,4),[mt],(t,[e])=>{const[i,r,n,o]=e.evaluate(t).rgb;return[255*i,255*r,255*n,o]}],rgb:[mt,[pt,pt,pt],gi],rgba:[mt,[pt,pt,pt,pt],gi],has:{type:ft,overloads:[[[dt],(t,[e])=>_i(e.evaluate(t),t.properties())],[[dt,gt],(t,[e,i])=>_i(e.evaluate(t),i.evaluate(t))]]},get:{type:_t,overloads:[[[dt],(t,[e])=>yi(e.evaluate(t),t.properties())],[[dt,gt],(t,[e,i])=>yi(e.evaluate(t),i.evaluate(t))]]},"feature-state":[_t,[dt],(t,[e])=>yi(e.evaluate(t),t.featureState||{})],properties:[gt,[],t=>t.properties()],"geometry-type":[dt,[],t=>t.geometryType()],id:[_t,[],t=>t.id()],zoom:[pt,[],t=>t.globals.zoom],"heatmap-density":[pt,[],t=>t.globals.heatmapDensity||0],"line-progress":[pt,[],t=>t.globals.lineProgress||0],accumulated:[_t,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[pt,Ai(pt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[pt,Ai(pt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:pt,overloads:[[[pt,pt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[pt],(t,[e])=>-e.evaluate(t)]]},"/":[pt,[pt,pt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[pt,[pt,pt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[pt,[pt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))],log2:[pt,[pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[pt,[pt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[pt,[pt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[pt,[pt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[pt,[pt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[pt,[pt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[pt,[pt],(t,[e])=>Math.atan(e.evaluate(t))],min:[pt,Ai(pt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[pt,Ai(pt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[pt,[pt],(t,[e])=>Math.abs(e.evaluate(t))],round:[pt,[pt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[pt,[pt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[pt,[pt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ft,[dt,_t],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ft,[_t],(t,[e])=>t.id()===e.value],"filter-type-==":[ft,[dt],(t,[e])=>t.geometryType()===e.value],"filter-<":[ft,[dt,_t],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[ft,[_t],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[ft,[dt,_t],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[ft,[_t],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[ft,[dt,_t],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[ft,[_t],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[ft,[dt,_t],(t,[e,i])=>{const r=t.properties()[e.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[ft,[_t],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[ft,[_t],(t,[e])=>e.value in t.properties()],"filter-has-id":[ft,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ft,[wt(dt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ft,[wt(_t)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ft,[dt,wt(_t)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ft,[dt,wt(_t)],(t,[e,i])=>function(t,e,i,r){for(;i<=r;){const n=i+r>>1;if(e[n]===t)return!0;e[n]>t?r=n-1:i=n+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Ai(ft),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Ai(ft),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ft,[ft],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ft,[dt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[dt,[dt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[dt,[dt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[dt,Ai(_t),(t,e)=>e.map((e=>ae(e.evaluate(t)))).join("")],"resolved-locale":[dt,[yt],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Di{constructor(t,e){var i;this.expression=t,this._warningHistory={},this._evaluator=new me,this._defaultValue=e?"color"===(i=e).type&&Ci(i.default)?new $t(0,0,0,0):"color"===i.type?$t.parse(i.default)||null:"padding"===i.type?te.parse(i.default)||null:"variableAnchorOffsetCollection"===i.type?ie.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,r,n,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ce(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Oi(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in mi}function Ri(t,e){const i=new ge(mi,Fe,[],e?function(t){const e={color:mt,string:dt,number:pt,enum:dt,boolean:ft,formatted:At,padding:vt,resolvedImage:xt,variableAnchorOffsetCollection:bt};return"array"===t.type?wt(e[t.value]||_t,t.length):e[t.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?vi(new Di(r,e)):xi(i.errors)}class Fi{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Be(e.expression)}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}}class zi{constructor(t,e,i,r){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Be(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,r,n,o)}evaluate(t,e,i,r,n,o){return this._styleExpression.evaluate(t,e,i,r,n,o)}interpolationFactor(t,e,i){return this.interpolationType?We.interpolationFactor(this.interpolationType,t,e,i):0}}function Bi(t,e){const i=Ri(t,e);if("error"===i.result)return i;const r=i.value.expression,n=ze(r);if(!n&&!bi(e))return xi([new ct("","data expressions not supported")]);const o=Ue(r,["zoom"]);if(!o&&!wi(e))return xi([new ct("","zoom expressions not supported")]);const s=Vi(r);return s||o?s instanceof ct?xi([s]):s instanceof We&&!Si(e)?xi([new ct("",'"interpolate" expressions cannot be used with this property')]):vi(s?new zi(n?"camera":"composite",i.value,s.labels,s instanceof We?s.interpolation:void 0):new Fi(n?"constant":"source",i.value)):xi([new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ui{constructor(t,e){this._parameters=t,this._specification=e,lt(this,Ei(this._parameters,this._specification))}static deserialize(t){return new Ui(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Vi(t){let e=null;if(t instanceof Ke)e=Vi(t.result);else if(t instanceof Je){for(const i of t.args)if(e=Vi(i),e)break}else(t instanceof je||t instanceof We)&&t.input instanceof Re&&"zoom"===t.input.name&&(e=t);return e instanceof ct||t.eachChild((t=>{const i=Vi(t);i instanceof ct?e=i:!e&&i?e=new ct("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new ct("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function ji(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ji(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const Gi={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Zi(t){if(null==t)return{filter:()=>!0,needGeometry:!1};ji(t)||(t=Hi(t));const e=Ri(t,Gi);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,i,r)=>e.value.evaluate(t,i,{},r),needGeometry:Wi(t)}}function qi(t,e){return t<e?-1:t>e?1:0}function Wi(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Wi(t[e]))return!0;return!1}function Hi(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Ji(t[1],t[2],"=="):"!="===e?Yi(Ji(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ji(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Hi))):"all"===e?["all"].concat(t.slice(1).map(Hi)):"none"===e?["all"].concat(t.slice(1).map(Hi).map(Yi)):"in"===e?Ki(t[1],t.slice(2)):"!in"===e?Yi(Ki(t[1],t.slice(2))):"has"===e?$i(t[1]):"!has"===e?Yi($i(t[1])):"within"!==e||t;var i}function Ji(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Ki(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(qi)]]:["filter-in-small",t,["literal",e]]}}function $i(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Yi(t){return["!",t]}function Xi(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${Xi(i)},`;return`${e}]`}const i=Object.keys(t).sort();let r="{";for(let e=0;e<i.length;e++)r+=`${JSON.stringify(i[e])}:${Xi(t[i[e]])},`;return`${r}}`}function Qi(t){let e="";for(const i of $)e+=`/${Xi(t[i])}`;return e}function tr(t){const e=t.value;return e?[new at(t.key,e,"constants have been deprecated as of v8")]:[]}function er(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ir(t){if(Array.isArray(t))return t.map(ir);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=ir(t[i]);return e}return er(t)}function rr(t){const e=t.key,i=t.value,r=t.valueSpec||{},n=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=t.validateSpec;let l=[];const c=Ti(i);if("object"!==c)return[new at(e,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],u=r[c]||r["*"];let h;if(n[c])h=n[c];else if(r[c])h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new at(e,i[t],`unknown property "${t}"`));continue}h=a}l=l.concat(h({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:t,validateSpec:a},i))}for(const t in r)n[t]||r[t].required&&void 0===r[t].default&&void 0===i[t]&&l.push(new at(e,i,`missing required property "${t}"`));return l}function nr(t){const e=t.value,i=t.valueSpec,r=t.style,n=t.styleSpec,o=t.key,s=t.arrayElementValidator||t.validateSpec;if("array"!==Ti(e))return[new at(o,e,`array expected, ${Ti(e)} found`)];if(i.length&&e.length!==i.length)return[new at(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new at(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values};n.$version<7&&(a.function=i.function),"object"===Ti(i.value)&&(a=i.value);let l=[];for(let i=0;i<e.length;i++)l=l.concat(s({array:e,arrayIndex:i,value:e[i],valueSpec:a,validateSpec:t.validateSpec,style:r,styleSpec:n,key:`${o}[${i}]`}));return l}function or(t){const e=t.key,i=t.value,r=t.valueSpec;let n=Ti(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new at(e,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new at(e,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new at(e,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function sr(t){const e=t.valueSpec,i=er(t.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Ti(t.value.stops)&&"array"===Ti(t.value.stops[0])&&"object"===Ti(t.value.stops[0][0]),u=rr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new at(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(nr({key:t.key,value:r,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ti(r)&&0===r.length&&e.push(new at(t.key,r,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new at(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new at(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Si(t.valueSpec)&&u.push(new at(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!bi(t.valueSpec)?u.push(new at(t.key,t.value,"property functions not supported")):a&&!wi(t.valueSpec)&&u.push(new at(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new at(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const r=t.value,a=t.key;if("array"!==Ti(r))return[new at(a,r,`array expected, ${Ti(r)} found`)];if(2!==r.length)return[new at(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Ti(r[0]))return[new at(a,r,`object expected, ${Ti(r[0])} found`)];if(void 0===r[0].zoom)return[new at(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new at(a,r,"object stop key must have value")];if(o&&o>er(r[0].zoom))return[new at(a,r[0].zoom,"stop zoom values must appear in ascending order")];er(r[0].zoom)!==o&&(o=er(r[0].zoom),n=void 0,s={}),i=i.concat(rr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:or,value:p}}))}else i=i.concat(p({key:`${a}[0]`,value:r[0],valueSpec:{},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},r));return Oi(ir(r[1]))?i.concat([new at(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(t.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const a=Ti(t.value),l=er(t.value),c=null!==t.value?t.value:o;if(r){if(a!==r)return[new at(t.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new at(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return bi(e)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(t.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new at(t.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new at(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new at(t.key,c,`integer expected, found ${l}`)]}}function ar(t){const e=("property"===t.expressionContext?Bi:Ri)(ir(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new at(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new at(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Be(i))return[new at(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Be(i))return[new at(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ue(i,["zoom","feature-state"]))return[new at(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!ze(i))return[new at(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lr(t){const e=t.key,i=t.value,r=t.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(er(i))&&n.push(new at(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(er(i))&&n.push(new at(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function cr(t){return ji(ir(t.value))?ar(lt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ur(t)}function ur(t){const e=t.value,i=t.key;if("array"!==Ti(e))return[new at(i,e,`array expected, ${Ti(e)} found`)];const r=t.styleSpec;let n,o=[];if(e.length<1)return[new at(i,e,"filter array must have at least 1 element")];switch(o=o.concat(lr({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),er(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===er(e[1])&&o.push(new at(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new at(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(n=Ti(e[1]),"string"!==n&&o.push(new at(`${i}[1]`,e[1],`string expected, ${n} found`)));for(let s=2;s<e.length;s++)n=Ti(e[s]),"$type"===er(e[1])?o=o.concat(lr({key:`${i}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new at(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)o=o.concat(ur({key:`${i}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":n=Ti(e[1]),2!==e.length?o.push(new at(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new at(`${i}[1]`,e[1],`string expected, ${n} found`));break;case"within":n=Ti(e[1]),2!==e.length?o.push(new at(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==n&&o.push(new at(`${i}[1]`,e[1],`object expected, ${n} found`))}return o}function hr(t,e){const i=t.key,r=t.validateSpec,n=t.style,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new at(i,s,`unknown property "${a}"`)];let h;if("string"===Ti(s)&&bi(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new at(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const p=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&p.push(new at(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Ci(ir(s))&&"identity"===er(s.type)&&p.push(new at(i,s,'"text-font" does not support identity functions'))),p.concat(r({key:t.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function pr(t){return hr(t,"paint")}function dr(t){return hr(t,"layout")}function fr(t){let e=[];const i=t.value,r=t.key,n=t.style,o=t.styleSpec;i.type||i.ref||e.push(new at(r,i,'either "type" or "ref" is required'));let s=er(i.type);const a=er(i.ref);if(i.id){const o=er(i.id);for(let s=0;s<t.arrayIndex;s++){const t=n.layers[s];er(t.id)===o&&e.push(new at(r,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new at(r,i[t],`"${t}" is prohibited for ref layers`))})),n.layers.forEach((e=>{er(e.id)===a&&(t=e)})),t?t.ref?e.push(new at(r,i.ref,"ref cannot reference another ref layer")):s=er(t.type):e.push(new at(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const t=n.sources&&n.sources[i.source],o=t&&er(t.type);t?"vector"===o&&"raster"===s?e.push(new at(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?e.push(new at(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?e.push(new at(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new at(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new at(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new at(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new at(r,i.source,`source "${i.source}" not found`))}else e.push(new at(r,i,'missing required property "source"'));return e=e.concat(rr({key:r,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"}),filter:cr,layout:t=>rr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>dr(lt({layerType:s},t))}}),paint:t=>rr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>pr(lt({layerType:s},t))}})}})),e}function mr(t){const e=t.value,i=t.key,r=Ti(e);return"string"!==r?[new at(i,e,`string expected, ${r} found`)]:[]}const gr={promoteId:function({key:t,value:e}){if("string"===Ti(e))return mr({key:t,value:e});{const i=[];for(const r in e)i.push(...mr({key:`${t}.${r}`,value:e[r]}));return i}}};function _r(t){const e=t.value,i=t.key,r=t.styleSpec,n=t.style,o=t.validateSpec;if(!e.type)return[new at(i,e,'"type" is required')];const s=er(e.type);let a;switch(s){case"vector":case"raster":return a=rr({key:i,value:e,valueSpec:r[`source_${s.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:gr,validateSpec:o}),a;case"raster-dem":return a=function(t){var e;const i=null!==(e=t.sourceName)&&void 0!==e?e:"",r=t.value,n=t.styleSpec,o=n.source_raster_dem,s=t.style;let a=[];const l=Ti(r);if(void 0===r)return a;if("object"!==l)return a.push(new at("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===er(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const e in r)!c&&u.includes(e)?a.push(new at(e,r[e],`In "${i}": "${e}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[e]?a=a.concat(t.validateSpec({key:e,value:r[e],valueSpec:o[e],validateSpec:t.validateSpec,style:s,styleSpec:n})):a.push(new at(e,r[e],`unknown property "${e}"`));return a}({sourceName:i,value:e,style:t.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=rr({key:i,value:e,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:gr}),e.cluster)for(const t in e.clusterProperties){const[r,n]=e.clusterProperties[t],s="string"==typeof r?[r,["accumulated"],["get",t]]:r;a.push(...ar({key:`${i}.${t}.map`,value:n,validateSpec:o,expressionContext:"cluster-map"})),a.push(...ar({key:`${i}.${t}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return rr({key:i,value:e,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return rr({key:i,value:e,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new at(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lr({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,validateSpec:o,styleSpec:r})}}function yr(t){const e=t.value,i=t.styleSpec,r=i.light,n=t.style;let o=[];const s=Ti(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new at("light",e,`object expected, ${s} found`)]),o;for(const s in e){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:i.transition,validateSpec:t.validateSpec,style:n,styleSpec:i}):r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new at(s,e[s],`unknown property "${s}"`)])}return o}function Ar(t){const e=t.value,i=t.styleSpec,r=i.terrain,n=t.style;let o=[];const s=Ti(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new at("terrain",e,`object expected, ${s} found`)]),o;for(const s in e)o=o.concat(r[s]?t.validateSpec({key:s,value:e[s],valueSpec:r[s],validateSpec:t.validateSpec,style:n,styleSpec:i}):[new at(s,e[s],`unknown property "${s}"`)]);return o}function vr(t){let e=[];const i=t.value,r=t.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i)i[s].id&&n.includes(i[s].id)&&e.push(new at(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&e.push(new at(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),e=e.concat(rr({key:`${r}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return mr({key:r,value:i})}const xr={"*":()=>[],array:nr,boolean:function(t){const e=t.value,i=t.key,r=Ti(e);return"boolean"!==r?[new at(i,e,`boolean expected, ${r} found`)]:[]},number:or,color:function(t){const e=t.key,i=t.value,r=Ti(i);return"string"!==r?[new at(e,i,`color expected, ${r} found`)]:$t.parse(String(i))?[]:[new at(e,i,`color expected, "${i}" found`)]},constants:tr,enum:lr,filter:cr,function:sr,layer:fr,object:rr,source:_r,light:yr,terrain:Ar,string:mr,formatted:function(t){return 0===mr(t).length?[]:ar(t)},resolvedImage:function(t){return 0===mr(t).length?[]:ar(t)},padding:function(t){const e=t.key,i=t.value;if("array"===Ti(i)){if(i.length<1||i.length>4)return[new at(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:r}));return n}return or({key:e,value:i,valueSpec:{}})},variableAnchorOffsetCollection:function(t){const e=t.key,i=t.value,r=Ti(i),n=t.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new at(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(lr({key:`${e}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(nr({key:`${e}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:n}));return o},sprite:vr};function br(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return t.validateSpec=br,i.expression&&Ci(er(e))?sr(t):i.expression&&Oi(ir(e))?ar(t):i.type&&xr[i.type]?xr[i.type](t):rr(lt({},t,{valueSpec:i.type?r[i.type]:i}))}function wr(t){const e=t.value,i=t.key,r=mr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new at(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new at(i,e,'"glyphs" url must include a "{range}" token'))),r}function Sr(t,e=K){let i=[];return i=i.concat(br({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:br,objectElementValidators:{glyphs:wr,"*":()=>[]}})),t.constants&&(i=i.concat(tr({key:"constants",value:t.constants,style:t,styleSpec:e,validateSpec:br}))),Cr(i)}function Tr(t){return function(e){return t({...e,validateSpec:br})}}function Cr(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function Mr(t){return function(...e){return Cr(t.apply(this,e))}}Sr.source=Mr(Tr(_r)),Sr.sprite=Mr(Tr(vr)),Sr.glyphs=Mr(Tr(wr)),Sr.light=Mr(Tr(yr)),Sr.terrain=Mr(Tr(Ar)),Sr.layer=Mr(Tr(fr)),Sr.filter=Mr(Tr(cr)),Sr.paintProperty=Mr(Tr(pr)),Sr.layoutProperty=Mr(Tr(dr));const Er=Sr,Ir=Er.light,Lr=Er.paintProperty,Pr=Er.layoutProperty;function kr(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new H(new Error(r.message))),i=!0;return i}class Nr{constructor(t,e,i){const r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const n=new Int32Array(this.arrayBuffer);t=n[0],this.d=(e=n[1])+2*(i=n[2]);for(let t=0;t<this.d*this.d;t++){const e=n[3+t],i=n[3+t+1];r.push(e===i?null:n.subarray(e,i))}const o=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],o),this.bboxes=n.subarray(o),this.insert=this._insertReadonly}else{this.d=e+2*i;for(let t=0;t<this.d*this.d;t++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;const n=i/e*t;this.min=-n,this.max=t+n}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,i,r,n,o){this.cells[n].push(o)}query(t,e,i,r,n){const o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(t,e,i,r,this._queryCell,o,{},n),o}}_queryCell(t,e,i,r,n,o,s,a){const l=this.cells[n];if(null!==l){const n=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&i>=c[l+0]&&r>=c[l+1])?(s[h]=!0,o.push(n[h])):s[h]=!1}}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++){const c=this.d*l+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(l),this._convertFromCellCoord(p+1),this._convertFromCellCoord(l+1)))&&n.call(this,t,e,i,r,c,o,s,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let i=0;for(let t=0;t<this.cells.length;t++)i+=this.cells[t].length;const r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let n=e;for(let e=0;e<t.length;e++){const i=t[e];r[3+e]=n,r.set(i,n),n+=i.length}return r[3+t.length]=n,r.set(this.keys,n),n+=this.keys.length,r[3+t.length+1]=n,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer}static serialize(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}}static deserialize(t){return new Nr(t.buffer)}}const Dr={};function Or(t,e,i={}){if(Dr[t])throw new Error(`${t} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Dr[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Or("Object",Object),Or("TransferableGridIndex",Nr),Or("Color",$t),Or("Error",Error),Or("AJAXError",F),Or("ResolvedImage",re),Or("StylePropertyFunction",Ui),Or("StyleExpression",Di,{omit:["_evaluator"]}),Or("ZoomDependentExpression",zi),Or("ZoomConstantExpression",Fi),Or("CompoundExpression",Re,{omit:["_evaluate"]});for(const t in mi)mi[t]._classRegistryKey||Or(`Expression_${t}`,mi[t]);function Rr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Fr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob)return t;if(Rr(t))return e&&e.push(t),t;if(E(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Fr(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class");if(!Dr[r])throw new Error(`${r} is not registered.`);const n=i.serialize?i.serialize(t,e):{};if(i.serialize){if(e&&n===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const i in t){if(!t.hasOwnProperty(i))continue;if(Dr[r].omit.indexOf(i)>=0)continue;const o=t[i];n[i]=Dr[r].shallow.indexOf(i)>=0?o:Fr(o,e)}t instanceof Error&&(n.message=t.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof t)}function zr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||Rr(t)||E(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(zr);if("object"==typeof t){const e=t.$name||"Object";if(!Dr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Dr[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const n=t[i];r[i]=Dr[e].shallow.indexOf(i)>=0?n:zr(n)}return r}throw new Error("can't deserialize object of type "+typeof t)}class Br{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Ur={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Vr(t){for(const e of t)if(Zr(e.charCodeAt(0)))return!0;return!1}function jr(t){for(const e of t)if(!Gr(e.charCodeAt(0)))return!1;return!0}function Gr(t){return!(Ur.Arabic(t)||Ur["Arabic Supplement"](t)||Ur["Arabic Extended-A"](t)||Ur["Arabic Presentation Forms-A"](t)||Ur["Arabic Presentation Forms-B"](t))}function Zr(t){return!(746!==t&&747!==t&&(t<4352||!(Ur["Bopomofo Extended"](t)||Ur.Bopomofo(t)||Ur["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ur["CJK Compatibility Ideographs"](t)||Ur["CJK Compatibility"](t)||Ur["CJK Radicals Supplement"](t)||Ur["CJK Strokes"](t)||!(!Ur["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ur["CJK Unified Ideographs Extension A"](t)||Ur["CJK Unified Ideographs"](t)||Ur["Enclosed CJK Letters and Months"](t)||Ur["Hangul Compatibility Jamo"](t)||Ur["Hangul Jamo Extended-A"](t)||Ur["Hangul Jamo Extended-B"](t)||Ur["Hangul Jamo"](t)||Ur["Hangul Syllables"](t)||Ur.Hiragana(t)||Ur["Ideographic Description Characters"](t)||Ur.Kanbun(t)||Ur["Kangxi Radicals"](t)||Ur["Katakana Phonetic Extensions"](t)||Ur.Katakana(t)&&12540!==t||!(!Ur["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ur["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ur["Unified Canadian Aboriginal Syllabics"](t)||Ur["Unified Canadian Aboriginal Syllabics Extended"](t)||Ur["Vertical Forms"](t)||Ur["Yijing Hexagram Symbols"](t)||Ur["Yi Syllables"](t)||Ur["Yi Radicals"](t))))}function qr(t){return!(Zr(t)||function(t){return!!(Ur["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ur["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ur["Letterlike Symbols"](t)||Ur["Number Forms"](t)||Ur["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ur["Control Pictures"](t)&&9251!==t||Ur["Optical Character Recognition"](t)||Ur["Enclosed Alphanumerics"](t)||Ur["Geometric Shapes"](t)||Ur["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ur["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ur["CJK Symbols and Punctuation"](t)||Ur.Katakana(t)||Ur["Private Use Area"](t)||Ur["CJK Compatibility Forms"](t)||Ur["Small Form Variants"](t)||Ur["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Wr(t){return t>=1424&&t<=2303||Ur["Arabic Presentation Forms-A"](t)||Ur["Arabic Presentation Forms-B"](t)}function Hr(t,e){return!(!e&&Wr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ur.Khmer(t))}function Jr(t){for(const e of t)if(Wr(e.charCodeAt(0)))return!0;return!1}const Kr="deferred",$r="loading",Yr="loaded";let Xr=null,Qr="unavailable",tn=null;const en=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Qr="error"),Xr&&Xr(t)};function rn(){nn.fire(new W("pluginStateChange",{pluginStatus:Qr,pluginURL:tn}))}const nn=new J,on=function(){return Qr},sn=function(){if(Qr!==Kr||!tn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qr=$r,rn(),tn&&j({url:tn},(t=>{t?en(t):(Qr=Yr,rn())}))},an={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qr===Yr||null!=an.applyArabicShaping,isLoading:()=>Qr===$r,setState(t){if(!C())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Qr=t.pluginStatus,tn=t.pluginURL},isParsed(){if(!C())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=an.applyArabicShaping&&null!=an.processBidirectionalText&&null!=an.processStyledBidirectionalText},getPluginURL(){if(!C())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return tn}};class ln{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Br,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!Hr(i.charCodeAt(0),e))return!1;return!0}(t,an.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class cn{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Ci(t))return new Ui(t,e);if(Oi(t)){const i=Bi(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"color"===e.type&&"string"==typeof t?i=$t.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)&&(i=ie.parse(t)):i=te.parse(t),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class un{constructor(t){this.property=t,this.value=new cn(t,void 0)}transitioned(t,e){return new pn(this.property,this.value,e,_({},t.transition,this.transition),t.now)}untransitioned(){return new pn(this.property,this.value,null,{},0)}}class hn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return x(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new un(this._values[t].property)),this._values[t].value=new cn(this._values[t].property,null===e?void 0:x(e))}getTransition(t){return x(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new un(this._values[t].property)),this._values[t].transition=x(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const i=new dn(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(t,e._values[r]);return i}untransitioned(){const t=new dn(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class pn{constructor(t,e,i,r,n){this.property=t,this.value=e,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const r=t.now||0,n=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),n,function(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}(s))}}return n}}class dn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const r=new gn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class fn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return x(this._values[t].value)}setValue(t,e){this._values[t]=new cn(this._values[t].property,null===e?void 0:x(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const r=new gn(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(t,e,i);return r}}class mn{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,r){return this.property.evaluate(this.value,this.parameters,t,e,i,r)}}class gn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class _n{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,i){const r=qe[this.specification.type];return r?r(t,e,i):t}}class yn{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,r){return new mn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,r)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new mn(this,{kind:"constant",value:void 0},t.parameters);const r=qe[this.specification.type];if(r){const n=r(t.value.value,e.value.value,i);return new mn(this,{kind:"constant",value:n},t.parameters)}return t}evaluate(t,e,i,r,n,o){return"constant"===t.kind?t.value:t.evaluate(e,i,r,n,o)}}class An extends yn{possiblyEvaluate(t,e,i,r){if(void 0===t.value)return new mn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,e);return new mn(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new mn(this,{kind:"constant",value:i},e)}return new mn(this,t.expression,e)}evaluate(t,e,i,r,n,o){if("source"===t.kind){const s=t.evaluate(e,i,r,n,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,r),t.evaluate({zoom:Math.floor(e.zoom)},i,r),t.evaluate({zoom:Math.floor(e.zoom)+1},i,r),e):t.value}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class vn{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){if(void 0!==t.value){if("constant"===t.expression.kind){const n=t.expression.evaluate(e,null,{},i,r);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new ln(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ln(Math.floor(e.zoom),e)),t.expression.evaluate(new ln(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class xn{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,r){return!!t.expression.evaluate(e,null,{},i,r)}interpolate(){return!1}}class bn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new cn(i,void 0),n=this.defaultTransitionablePropertyValues[e]=new un(i);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}}}Or("DataDrivenProperty",yn),Or("DataConstantProperty",_n),Or("CrossFadedDataDrivenProperty",An),Or("CrossFadedProperty",vn),Or("ColorRampProperty",xn);const wn="-transition";class Sn extends J{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new fn(e.layout)),e.paint)){this._transitionablePaint=new hn(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gn(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(Pr,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith(wn)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Lr,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(t.endsWith(wn))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,r,n={}){return(!n||!1!==n.validate)&&kr(this,t.call(Er,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:K,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof mn&&bi(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Tn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cn{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function En(t,e=1){let i=0,r=0;return{members:t.map((t=>{const n=Tn[t.type].BYTES_PER_ELEMENT,o=i=In(i,Math.max(e,n)),s=t.components||1;return r=Math.max(r,n),i+=n*s,{name:t.name,type:t.type,components:s,offset:o}})),size:In(i,Math.max(r,e)),alignment:e}}function In(t,e){return Math.ceil(t/e)*e}class Ln extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=i,t}}Ln.prototype.bytesPerElement=4,Or("StructArrayLayout2i4",Ln);class Pn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.int16[n+0]=e,this.int16[n+1]=i,this.int16[n+2]=r,t}}Pn.prototype.bytesPerElement=6,Or("StructArrayLayout3i6",Pn);class kn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,t}}kn.prototype.bytesPerElement=8,Or("StructArrayLayout4i8",kn);class Nn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}Nn.prototype.bytesPerElement=12,Or("StructArrayLayout2i4i12",Nn);class Dn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=s,t}}Dn.prototype.bytesPerElement=8,Or("StructArrayLayout2i4ub8",Dn);class On extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=i,t}}On.prototype.bytesPerElement=8,Or("StructArrayLayout2f8",On);class Rn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,r,n,o,s,a,l,c)}emplace(t,e,i,r,n,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}Rn.prototype.bytesPerElement=20,Or("StructArrayLayout10ui20",Rn);class Fn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,r,n,o,s,a,l,c,u,h)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=r,this.int16[d+3]=n,this.uint16[d+4]=o,this.uint16[d+5]=s,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t}}Fn.prototype.bytesPerElement=24,Or("StructArrayLayout4i4ui4i24",Fn);class zn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.float32[n+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}zn.prototype.bytesPerElement=12,Or("StructArrayLayout3f12",zn);class Bn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Bn.prototype.bytesPerElement=4,Or("StructArrayLayout1ul4",Bn);class Un extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,r,n,o,s,a,l)}emplace(t,e,i,r,n,o,s,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}Un.prototype.bytesPerElement=20,Or("StructArrayLayout6i1ul2ui20",Un);class Vn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,r,n,o)}emplace(t,e,i,r,n,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,t}}Vn.prototype.bytesPerElement=12,Or("StructArrayLayout2i2i2i12",Vn);class jn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,r,n)}emplace(t,e,i,r,n,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,t}}jn.prototype.bytesPerElement=16,Or("StructArrayLayout2f1f2i16",jn);class Gn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,t}}Gn.prototype.bytesPerElement=12,Or("StructArrayLayout2ub2f12",Gn);class Zn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,this.uint16[n+2]=r,t}}Zn.prototype.bytesPerElement=6,Or("StructArrayLayout3ui6",Zn);class qn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_){const y=24*t,A=12*t,v=48*t;return this.int16[y+0]=e,this.int16[y+1]=i,this.uint16[y+2]=r,this.uint16[y+3]=n,this.uint32[A+2]=o,this.uint32[A+3]=s,this.uint32[A+4]=a,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[A+7]=h,this.float32[A+8]=p,this.uint8[v+36]=d,this.uint8[v+37]=f,this.uint8[v+38]=m,this.uint32[A+10]=g,this.int16[y+22]=_,t}}qn.prototype.bytesPerElement=48,Or("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qn);class Wn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M){const E=this.length;return this.resize(E+1),this.emplace(E,t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M)}emplace(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T,C,M,E){const I=32*t,L=16*t;return this.int16[I+0]=e,this.int16[I+1]=i,this.int16[I+2]=r,this.int16[I+3]=n,this.int16[I+4]=o,this.int16[I+5]=s,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=p,this.uint16[I+12]=d,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=_,this.uint16[I+17]=y,this.uint16[I+18]=A,this.uint16[I+19]=v,this.uint16[I+20]=x,this.uint16[I+21]=b,this.uint16[I+22]=w,this.uint32[L+12]=S,this.float32[L+13]=T,this.float32[L+14]=C,this.uint16[I+30]=M,this.uint16[I+31]=E,t}}Wn.prototype.bytesPerElement=64,Or("StructArrayLayout8i15ui1ul2f2ui64",Wn);class Hn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}Hn.prototype.bytesPerElement=4,Or("StructArrayLayout1f4",Hn);class Jn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=3*t;return this.uint16[6*t+0]=e,this.float32[n+1]=i,this.float32[n+2]=r,t}}Jn.prototype.bytesPerElement=12,Or("StructArrayLayout1ui2f12",Jn);class Kn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i)}emplace(t,e,i,r){const n=4*t;return this.uint32[2*t+0]=e,this.uint16[n+2]=i,this.uint16[n+3]=r,t}}Kn.prototype.bytesPerElement=8,Or("StructArrayLayout1ul2ui8",Kn);class $n extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,t}}$n.prototype.bytesPerElement=4,Or("StructArrayLayout2ui4",$n);class Yn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Yn.prototype.bytesPerElement=2,Or("StructArrayLayout1ui2",Yn);class Xn extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i,r)}emplace(t,e,i,r,n){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,t}}Xn.prototype.bytesPerElement=16,Or("StructArrayLayout4f16",Xn);class Qn extends Cn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new o(this.anchorPointX,this.anchorPointY)}}Qn.prototype.size=20;class to extends Un{get(t){return new Qn(this,t)}}Or("CollisionBoxArray",to);class eo extends Cn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}eo.prototype.size=48;class io extends qn{get(t){return new eo(this,t)}}Or("PlacedSymbolArray",io);class ro extends Cn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ro.prototype.size=64;class no extends Wn{get(t){return new ro(this,t)}}Or("SymbolInstanceArray",no);class oo extends Hn{getoffsetX(t){return this.float32[1*t+0]}}Or("GlyphOffsetArray",oo);class so extends Pn{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Or("SymbolLineVertexArray",so);class ao extends Cn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ao.prototype.size=12;class lo extends Jn{get(t){return new ao(this,t)}}Or("TextAnchorOffsetArray",lo);class co extends Cn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}co.prototype.size=8;class uo extends Kn{get(t){return new co(this,t)}}Or("FeatureIndexArray",uo);class ho extends Ln{}class po extends Ln{}class fo extends Ln{}class mo extends Nn{}class go extends Dn{}class _o extends On{}class yo extends Rn{}class Ao extends Fn{}class vo extends zn{}class xo extends Bn{}class bo extends Vn{}class wo extends Gn{}class So extends Zn{}class To extends $n{}const Co=En([{name:"a_pos",components:2,type:"Int16"}],4),{members:Mo}=Co;class Eo{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,r){let n=this.segments[this.segments.length-1];return t>Eo.MAX_VERTEX_ARRAY_LENGTH&&w(`Max vertices per segment is ${Eo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!n||n.vertexLength+t>Eo.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,r){return new Eo([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function Io(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}Eo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Or("SegmentVector",Eo);const Lo=En([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Po={exports:{}},ko=function(t,e){var i,r,n,o,s,a,l,c;for(r=t.length-(i=3&t.length),n=e,s=3432918353,a=461845907,c=0;c<r;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0},No=function(t,e){for(var i,r=t.length,n=e^r,o=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&t.charCodeAt(o+2))<<16;case 2:n^=(255&t.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};Po.exports=ko,Po.exports.murmur3=ko,Po.exports.murmur2=No;var Do=i(Po.exports);class Oo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,r){this.ids.push(Ro(t)),this.positions.push(e,i,r)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=Ro(t);let i=0,r=this.ids.length-1;for(;i<r;){const t=i+r>>1;this.ids[t]>=e?r=t:i=t+1}const n=[];for(;this.ids[i]===e;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(t,e){const i=new Float64Array(t.ids),r=new Uint32Array(t.positions);return Fo(i,r,0,i.length-1),e&&e.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(t){const e=new Oo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Ro(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Do(String(t))}function Fo(t,e,i,r){for(;i<r;){const n=t[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(t[o]<n);do{s--}while(t[s]>n);if(o>=s)break;zo(t,o,s),zo(e,3*o,3*s),zo(e,3*o+1,3*s+1),zo(e,3*o+2,3*s+2)}s-i<r-s?(Fo(t,e,i,s),i=s+1):(Fo(t,e,s+1,r),r=s)}}function zo(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Or("FeaturePositionMap",Oo);class Bo{constructor(t,e){this.gl=t.gl,this.location=e}}class Uo extends Bo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Vo extends Bo{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class jo extends Bo{constructor(t,e){super(t,e),this.current=$t.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Go=new Float32Array(16);function Zo(t){return[Io(255*t.r,255*t.g),Io(255*t.b,255*t.a)]}class qo{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new jo(t,e):new Uo(t,e)}}class Wo{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&t.set(n)}getBinding(t,e,i){return"u_pattern"===i.substr(0,9)?new Vo(t,e):new Uo(t,e)}}class Ho{constructor(t,e,i,r){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,r,n){const o=this.paintVertexArray.length,s=this.expression.evaluate(new ln(0),e,{},r,[],n);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(t,e,n)}_setPaintValue(t,e,i){if("color"===this.type){const r=Zo(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jo{constructor(t,e,i,r,n,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,r,n){const o=this.expression.evaluate(new ln(this.zoom),e,{},r,[],n),s=this.expression.evaluate(new ln(this.zoom+1),e,{},r,[],n),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(t,e,n,o)}_setPaintValue(t,e,i,r){if("color"===this.type){const n=Zo(i),o=Zo(r);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=m(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,i){return new Uo(t,e)}}class Ko{constructor(t,e,i,r,n,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(t,e,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,r,n){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(t,e,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=t;i<e;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Lo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $o{constructor(t,e,i){this.binders={},this._buffers=[];const r=[];for(const n in t.paint._values){if(!i(n))continue;const o=t.paint.get(n);if(!(o instanceof mn&&bi(o.property.specification)))continue;const s=Xo(n,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[n]=h?new Wo(a.value,s):new qo(a.value,s,l),r.push(`/u_${n}`);else if("source"===a.kind||h){const i=Qo(n,l,"source");this.binders[n]=h?new Ko(a,l,c,e,i,t.id):new Ho(a,s,l,i),r.push(`/a_${n}`)}else{const t=Qo(n,l,"composite");this.binders[n]=new Jo(a,s,l,c,e,t),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ho||e instanceof Jo?e.maxValue:0}populatePaintArrays(t,e,i,r,n){for(const o in this.binders){const s=this.binders[o];(s instanceof Ho||s instanceof Jo||s instanceof Ko)&&s.populatePaintArray(t,e,i,r,n)}}setConstantPatternPositions(t,e){for(const i in this.binders){const r=this.binders[i];r instanceof Wo&&r.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,r,n){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof Ho||l instanceof Jo||l instanceof Ko)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],n),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof qo||i instanceof Wo)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Ho||i instanceof Jo)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name);else if(i instanceof Ko)for(let e=0;e<Lo.members.length;e++)t.push(Lo.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof qo||i instanceof Wo||i instanceof Jo)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof qo||n instanceof Wo||n instanceof Jo)for(const o of n.uniformNames)if(e[o]){const s=n.getBinding(t,e[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(t,e,i,r){for(const{name:t,property:n,binding:o}of e)this.binders[n].setUniform(o,r,i.get(n),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof Ko){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof Ho||i instanceof Jo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Ho||i instanceof Jo||i instanceof Ko)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ho||e instanceof Jo||e instanceof Ko)&&e.destroy()}}}class Yo{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new $o(r,e,i);this.needsUpload=!1,this._featureMap=new Oo,this._bufferOffset=0}populatePaintArrays(t,e,i,r,n,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r,n,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(t,this._featureMap,e,n,r)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Xo(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function Qo(t,e,i){const r={color:{source:On,composite:Xn},number:{source:Hn,composite:On}},n=function(t){return{"line-pattern":{source:yo,composite:yo},"fill-pattern":{source:yo,composite:yo},"fill-extrusion-pattern":{source:yo,composite:yo}}[t]}(t);return n&&n[i]||r[e][i]}Or("ConstantBinder",qo),Or("CrossFadedConstantBinder",Wo),Or("SourceExpressionBinder",Ho),Or("CrossFadedCompositeBinder",Ko),Or("CompositeExpressionBinder",Jo),Or("ProgramConfiguration",$o,{omit:["_buffers"]}),Or("ProgramConfigurationSet",Yo);const ts=8192,es=Math.pow(2,14)-1,is=-es-1;function rs(t){const e=ts/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){const r=i[t];for(let t=0;t<r.length;t++){const i=r[t],n=Math.round(i.x*e),o=Math.round(i.y*e);i.x=m(n,is,es),i.y=m(o,is,es),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function ns(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?rs(t):[]}}function os(t,e,i,r,n){t.emplaceBack(2*e+(r+1)/2,2*i+(n+1)/2)}class ss{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new po,this.indexArray=new So,this.segments=new Eo,this.programConfigurations=new Yo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){const r=this.layers[0],n=[];let o=null,s=!1;"circle"===r.type&&(o=r.layout.get("circle-sort-key"),s=!o.isConstant());for(const{feature:e,id:r,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ns(e,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:r,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:rs(e),patterns:{},sortKey:u};n.push(h)}s&&n.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r,a=t[o].feature;this.addFeature(r,n,o,i),e.featureIndex.insert(a,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,r){for(const i of e)for(const e of i){const i=e.x,r=e.y;if(i<0||i>=ts||r<0||r>=ts)continue;const n=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),o=n.vertexLength;os(this.layoutVertexArray,i,r,-1,-1),os(this.layoutVertexArray,i,r,1,-1),os(this.layoutVertexArray,i,r,1,1),os(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),n.vertexLength+=4,n.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},r)}}function as(t,e){for(let i=0;i<t.length;i++)if(gs(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(gs(t,e[i]))return!0;return!!hs(t,e)}function ls(t,e,i){return!!gs(t,e)||!!ds(e,t,i)}function cs(t,e){if(1===t.length)return ms(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++)if(gs(t,r[e]))return!0}for(let i=0;i<t.length;i++)if(ms(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(hs(t,e[i]))return!0;return!1}function us(t,e,i){if(t.length>1){if(hs(t,e))return!0;for(let r=0;r<e.length;r++)if(ds(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(ds(t[r],e,i))return!0;return!1}function hs(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1];for(let t=0;t<e.length-1;t++)if(ps(r,n,e[t],e[t+1]))return!0}return!1}function ps(t,e,i,r){return S(t,i,r)!==S(e,i,r)&&S(t,e,i)!==S(t,e,r)}function ds(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(fs(t,e[i-1],e[i])<r)return!0;return!1}function fs(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(n<0?e:n>1?i:i.sub(e)._mult(n)._add(e))}function ms(t,e){let i,r,n,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)r=i[t],n=i[s],r.y>e.y!=n.y>e.y&&e.x<(n.x-r.x)*(e.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function gs(t,e){let i=!1;for(let r=0,n=t.length-1;r<t.length;n=r++){const o=t[r],s=t[n];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function _s(t,e,i){const r=i[0],n=i[2];if(t.x<r.x&&e.x<r.x||t.x>n.x&&e.x>n.x||t.y<r.y&&e.y<r.y||t.y>n.y&&e.y>n.y)return!1;const o=S(t,e,i[0]);return o!==S(t,e,i[1])||o!==S(t,e,i[2])||o!==S(t,e,i[3])}function ys(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function As(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function vs(t,e,i,r,n){if(!e[0]&&!e[1])return t;const s=o.convert(e)._mult(n);"viewport"===i&&s._rotate(-r);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}let xs,bs;Or("CircleBucket",ss,{omit:["layers"]});var ws={get paint(){return bs=bs||new bn({"circle-radius":new yn(K.paint_circle["circle-radius"]),"circle-color":new yn(K.paint_circle["circle-color"]),"circle-blur":new yn(K.paint_circle["circle-blur"]),"circle-opacity":new yn(K.paint_circle["circle-opacity"]),"circle-translate":new _n(K.paint_circle["circle-translate"]),"circle-translate-anchor":new _n(K.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _n(K.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _n(K.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(K.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(K.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(K.paint_circle["circle-stroke-opacity"])})},get layout(){return xs=xs||new bn({"circle-sort-key":new yn(K.layout_circle["circle-sort-key"])})}},Ss=1e-6,Ts="undefined"!=typeof Float32Array?Float32Array:Array;function Cs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ms(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],A=i[0],v=i[1],x=i[2],b=i[3];return t[0]=A*r+v*a+x*h+b*m,t[1]=A*n+v*l+x*p+b*g,t[2]=A*o+v*c+x*d+b*_,t[3]=A*s+v*u+x*f+b*y,t[4]=(A=i[4])*r+(v=i[5])*a+(x=i[6])*h+(b=i[7])*m,t[5]=A*n+v*l+x*p+b*g,t[6]=A*o+v*c+x*d+b*_,t[7]=A*s+v*u+x*f+b*y,t[8]=(A=i[8])*r+(v=i[9])*a+(x=i[10])*h+(b=i[11])*m,t[9]=A*n+v*l+x*p+b*g,t[10]=A*o+v*c+x*d+b*_,t[11]=A*s+v*u+x*f+b*y,t[12]=(A=i[12])*r+(v=i[13])*a+(x=i[14])*h+(b=i[15])*m,t[13]=A*n+v*l+x*p+b*g,t[14]=A*o+v*c+x*d+b*_,t[15]=A*s+v*u+x*f+b*y,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Es,Is=Ms;function Ls(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,t}Es=new Ts(4),Ts!=Float32Array&&(Es[0]=0,Es[1]=0,Es[2]=0,Es[3]=0);class Ps extends Sn{constructor(t){super(t,ws)}createBucket(t){return new ss(t)}queryRadius(t){const e=t;return ys("circle-radius",this,e)+ys("circle-stroke-width",this,e)+As(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s,a){const l=vs(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,s),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e){return t.map((t=>ks(t,e)))}(l,a),p=u?c*s:c;for(const t of r)for(const e of t){const t=u?e:ks(e,a);let i=p;const r=Ls([],[e.x,e.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=r[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=o.cameraToCenterDistance/r[3]),ls(h,t,i))return!0}return!1}}function ks(t,e){const i=Ls([],[t.x,t.y,0,1],e);return new o(i[0]/i[3],i[1]/i[3])}class Ns extends ss{}let Ds;Or("HeatmapBucket",Ns,{omit:["layers"]});var Os={get paint(){return Ds=Ds||new bn({"heatmap-radius":new yn(K.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(K.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _n(K.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xn(K.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _n(K.paint_heatmap["heatmap-opacity"])})}};function Rs(t,{width:e,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==e*i*r)throw new RangeError(`mismatched image size. expected: ${n.length} but got: ${e*i*r}`)}else n=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=n,t}function Fs(t,{width:e,height:i},r){if(e===t.width&&i===t.height)return;const n=Rs({},{width:e,height:i},r);zs(t,n,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},r),t.width=e,t.height=i,t.data=n.data}function zs(t,e,i,r,n,o){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||i.x>t.width-n.width||i.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||r.x>e.width-n.width||r.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<n.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((r.y+l)*e.width+r.x)*o;for(let t=0;t<n.width*o;t++)a[u+t]=s[c+t]}return e}class Bs{constructor(t,e){Rs(this,t,1,e)}resize(t){Fs(this,t,1)}clone(){return new Bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){zs(t,e,i,r,n,1)}}class Us{constructor(t,e){Rs(this,t,4,e)}resize(t){Fs(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Us({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,r,n){zs(t,e,i,r,n,4)}}function Vs(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,n=t.image||new Us({width:i,height:r});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,n=0;e<r;++e,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=t.clips[e];o(n,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return n}Or("AlphaImage",Bs),Or("RGBAImage",Us);class js extends Sn{createBucket(t){return new Ns(t)}constructor(t){super(t,Os),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vs({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Gs;var Zs={get paint(){return Gs=Gs||new bn({"hillshade-illumination-direction":new _n(K.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _n(K.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _n(K.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _n(K.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _n(K.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _n(K.paint_hillshade["hillshade-accent-color"])})}};class qs extends Sn{constructor(t){super(t,Zs)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Ws=En([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hs}=Ws;var Js={exports:{}};function Ks(t,e,i){i=i||2;var r,n,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,p=$s(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,i,r){var n,o,s,a=[];for(n=0,o=e.length;n<o;n++)(s=$s(t,e[n]*r,n<o-1?e[n+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(aa(s));for(a.sort(ra),n=0;n<a.length;n++)i=na(a[n],i);return i}(t,e,p,i)),t.length>80*i){r=o=t[0],n=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<r&&(r=a),(l=t[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?32767/c:0}return Xs(p,d,i,r,n,c,0),d}function $s(t,e,i,r,n){var o,s;if(n===va(t,e,i,r)>0)for(o=e;o<i;o+=r)s=_a(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=_a(o,t[o],t[o+1],s);return s&&ha(s,s.next)&&(ya(s),s=s.next),s}function Ys(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!ha(r,r.next)&&0!==ua(r.prev,r,r.next))r=r.next;else{if(ya(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Xs(t,e,i,r,n,o,s){if(t){!s&&o&&function(t,e,i,r){var n=t;do{0===n.z&&(n.z=sa(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(t,r,n,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?ta(t,r,n,o):Qs(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(l.i/i|0),ya(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?Xs(t=ea(Ys(t),e,i),e,i,r,n,o,2):2===s&&ia(t,e,i,r,n,o):Xs(Ys(t),e,i,r,n,o,1);break}}}function Qs(t){var e=t.prev,i=t,r=t.next;if(ua(e,i,r)>=0)return!1;for(var n=e.x,o=i.x,s=r.x,a=e.y,l=i.y,c=r.y,u=n<o?n<s?n:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,p=n>o?n>s?n:s:o>s?o:s,d=a>l?a>c?a:c:l>c?l:c,f=r.next;f!==e;){if(f.x>=u&&f.x<=p&&f.y>=h&&f.y<=d&&la(n,a,o,l,s,c,f.x,f.y)&&ua(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ta(t,e,i,r){var n=t.prev,o=t,s=t.next;if(ua(n,o,s)>=0)return!1;for(var a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,p=s.y,d=a<l?a<c?a:c:l<c?l:c,f=u<h?u<p?u:p:h<p?h:p,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>p?u:p:h>p?h:p,_=sa(d,f,e,i,r),y=sa(m,g,e,i,r),A=t.prevZ,v=t.nextZ;A&&A.z>=_&&v&&v.z<=y;){if(A.x>=d&&A.x<=m&&A.y>=f&&A.y<=g&&A!==n&&A!==s&&la(a,u,l,h,c,p,A.x,A.y)&&ua(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&la(a,u,l,h,c,p,v.x,v.y)&&ua(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;A&&A.z>=_;){if(A.x>=d&&A.x<=m&&A.y>=f&&A.y<=g&&A!==n&&A!==s&&la(a,u,l,h,c,p,A.x,A.y)&&ua(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&la(a,u,l,h,c,p,v.x,v.y)&&ua(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function ea(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!ha(n,o)&&pa(n,r,r.next,o)&&ma(n,o)&&ma(o,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(o.i/i|0),ya(r),ya(r.next),r=t=o),r=r.next}while(r!==t);return Ys(r)}function ia(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&ca(s,a)){var l=ga(s,a);return s=Ys(s,s.next),l=Ys(l,l.next),Xs(s,e,i,r,n,o,0),void Xs(l,e,i,r,n,o,0)}a=a.next}s=s.next}while(s!==t)}function ra(t,e){return t.x-e.x}function na(t,e){var i=function(t,e){var i,r=e,n=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,i=r.x<r.next.x?r:r.next,a===n))return i}r=r.next}while(r!==e);if(!i)return null;var l,c=i,u=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&la(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),ma(r,t)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&oa(i,r)))&&(i=r,p=l)),r=r.next}while(r!==c);return i}(t,e);if(!i)return e;var r=ga(i,t);return Ys(r,r.next),Ys(i,i.next)}function oa(t,e){return ua(t.prev,t,e.prev)<0&&ua(e.next,t,t.next)<0}function sa(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function aa(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function la(t,e,i,r,n,o,s,a){return(n-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(r-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function ca(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&pa(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(ma(t,e)&&ma(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(ua(t.prev,t,e.prev)||ua(t,e.prev,e))||ha(t,e)&&ua(t.prev,t,t.next)>0&&ua(e.prev,e,e.next)>0)}function ua(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ha(t,e){return t.x===e.x&&t.y===e.y}function pa(t,e,i,r){var n=fa(ua(t,e,i)),o=fa(ua(t,e,r)),s=fa(ua(i,r,t)),a=fa(ua(i,r,e));return n!==o&&s!==a||!(0!==n||!da(t,i,e))||!(0!==o||!da(t,r,e))||!(0!==s||!da(i,t,r))||!(0!==a||!da(i,e,r))}function da(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function fa(t){return t>0?1:t<0?-1:0}function ma(t,e){return ua(t.prev,t,t.next)<0?ua(t,e,t.next)>=0&&ua(t,t.prev,e)>=0:ua(t,e,t.prev)<0||ua(t,t.next,e)<0}function ga(t,e){var i=new Aa(t.i,t.x,t.y),r=new Aa(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function _a(t,e,i,r){var n=new Aa(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ya(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Aa(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function va(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}Js.exports=Ks,Js.exports.default=Ks,Ks.deviation=function(t,e,i,r){var n=e&&e.length,o=Math.abs(va(t,0,n?e[0]*i:t.length,i));if(n)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(va(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},Ks.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[n][o][s]);n>0&&i.holes.push(r+=t[n-1].length)}return i};var xa=i(Js.exports);function ba(t,e,i,r,n){wa(t,e,i||0,r||t.length-1,n||Ta)}function wa(t,e,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);wa(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(r,Math.floor(e+(o-s)*l/o+c)),n)}var u=t[e],h=i,p=r;for(Sa(t,i,e),n(t[r],u)>0&&Sa(t,i,r);h<p;){for(Sa(t,h,p),h++,p--;n(t[h],u)<0;)h++;for(;n(t[p],u)>0;)p--}0===n(t[i],u)?Sa(t,i,p):Sa(t,++p,r),p<=e&&(i=p+1),e<=p&&(r=p-1)}}function Sa(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Ta(t,e){return t<e?-1:t>e?1:0}function Ca(t,e){const i=t.length;if(i<=1)return[t];const r=[];let n,o;for(let e=0;e<i;e++){const i=T(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[t[e]]):n.push(t[e]))}if(n&&r.push(n),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(ba(r[t],e,1,r[t].length-1,Ma),r[t]=r[t].slice(0,e));return r}function Ma(t,e){return e.area-t.area}function Ea(t,e,i){const r=i.patternDependencies;let n=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(n=!0);const o=e.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function Ia(t,e,i,r,n){const o=n.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r-1},i,{},n.availableImages),a=e.evaluate({zoom:r},i,{},n.availableImages),l=e.evaluate({zoom:r+1},i,{},n.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}class La{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fo,this.indexArray=new So,this.indexArray2=new To,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new Eo,this.segments2=new Eo,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=Ea("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),n=!r.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=ns(s,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),u,i))continue;const h=n?r.evaluate(u,{},i,e.availableImages):void 0,p={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:rs(s),patterns:{},sortKey:h};o.push(p)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=Ia("fill",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hs),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,r,n){for(const t of Ca(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(r+e.length-1,r),n.push(e[0].x),n.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(r+t-1,r+t),n.push(e[t].x),n.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=xa(n,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(r+s[t],r+s[t+1],r+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}let Pa,ka;Or("FillBucket",La,{omit:["layers","patternFeatures"]});var Na={get paint(){return ka=ka||new bn({"fill-antialias":new _n(K.paint_fill["fill-antialias"]),"fill-opacity":new yn(K.paint_fill["fill-opacity"]),"fill-color":new yn(K.paint_fill["fill-color"]),"fill-outline-color":new yn(K.paint_fill["fill-outline-color"]),"fill-translate":new _n(K.paint_fill["fill-translate"]),"fill-translate-anchor":new _n(K.paint_fill["fill-translate-anchor"]),"fill-pattern":new An(K.paint_fill["fill-pattern"])})},get layout(){return Pa=Pa||new bn({"fill-sort-key":new yn(K.layout_fill["fill-sort-key"])})}};class Da extends Sn{constructor(t){super(t,Na)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new La(t)}queryRadius(){return As(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,n,o,s){return cs(vs(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,s),r)}isTileClipped(){return!0}}const Oa=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ra=En([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Fa}=Oa;var za={},Ba=r,Ua=Va;function Va(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(ja,this,e)}function ja(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Ga(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)r+=((i=t[s]).x-(e=t[n]).x)*(e.y+i.y);return r}Va.types=["Unknown","Point","LineString","Polygon"],Va.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var l=t.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new Ba(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},Va.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},Va.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=Va.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=Ga(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Za=Ua,qa=Wa;function Wa(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ha,this,e),this.length=this._features.length}function Ha(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}Wa.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Za(this._pbf,e,this.extent,this._keys,this._values)};var Ja=qa;function Ka(t,e,i){if(3===t){var r=new Ja(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}za.VectorTile=function(t,e){this.layers=t.readFields(Ka,{},e)},za.VectorTileFeature=Ua,za.VectorTileLayer=qa;const $a=za.VectorTileFeature.types,Ya=Math.pow(2,13);function Xa(t,e,i,r,n,o,s,a){t.emplaceBack(e,i,2*Math.floor(r*Ya)+s,n*Ya*2,o*Ya*2,Math.round(a))}class Qa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new mo,this.centroidVertexArray=new ho,this.indexArray=new So,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new Eo,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.features=[],this.hasPattern=Ea("fill-extrusion",this.layers,e);for(const{feature:r,id:n,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=ns(r,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),a,i))continue;const l={id:n,sourceLayerIndex:s,index:o,geometry:t?a.geometry:rs(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(Ia("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,i,{}),e.featureIndex.insert(r,l.geometry,o,s,this.index,!0)}}addFeatures(t,e,i){for(const t of this.features){const{geometry:r}=t;this.addFeature(t,r,t.index,e,i)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fa),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ra.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,i,r,n){const o={x:0,y:0,vertexCount:0};for(const i of Ca(e,500)){let e=0;for(const t of i)e+=t.length;let r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const t of i){if(0===t.length)continue;if(el(t))continue;let e=0;for(let i=0;i<t.length;i++){const n=t[i];if(i>=1){const s=t[i-1];if(!tl(n,s)){r.vertexLength+4>Eo.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=n.sub(s)._perp()._unit(),i=s.dist(n);e+i>32768&&(e=0),Xa(this.layoutVertexArray,n.x,n.y,t.x,t.y,0,0,e),Xa(this.layoutVertexArray,n.x,n.y,t.x,t.y,0,1,e),o.x+=2*n.x,o.y+=2*n.y,o.vertexCount+=2,e+=i,Xa(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,0,e),Xa(this.layoutVertexArray,s.x,s.y,t.x,t.y,0,1,e),o.x+=2*s.x,o.y+=2*s.y,o.vertexCount+=2;const a=r.vertexLength;this.indexArray.emplaceBack(a,a+2,a+1),this.indexArray.emplaceBack(a+1,a+2,a+3),r.vertexLength+=4,r.primitiveLength+=2}}}}if(r.vertexLength+e>Eo.MAX_VERTEX_ARRAY_LENGTH&&(r=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray)),"Polygon"!==$a[t.type])continue;const n=[],s=[],a=r.vertexLength;for(const t of i)if(0!==t.length){t!==i[0]&&s.push(n.length/2);for(let e=0;e<t.length;e++){const i=t[e];Xa(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),o.x+=i.x,o.y+=i.y,o.vertexCount+=1,n.push(i.x),n.push(i.y)}}const l=xa(n,s);for(let t=0;t<l.length;t+=3)this.indexArray.emplaceBack(a+l[t],a+l[t+2],a+l[t+1]);r.primitiveLength+=l.length/3,r.vertexLength+=e}for(let t=0;t<o.vertexCount;t++)this.centroidVertexArray.emplaceBack(Math.floor(o.x/o.vertexCount),Math.floor(o.y/o.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}}function tl(t,e){return t.x===e.x&&(t.x<0||t.x>ts)||t.y===e.y&&(t.y<0||t.y>ts)}function el(t){return t.every((t=>t.x<0))||t.every((t=>t.x>ts))||t.every((t=>t.y<0))||t.every((t=>t.y>ts))}let il;Or("FillExtrusionBucket",Qa,{omit:["layers","features"]});var rl={get paint(){return il=il||new bn({"fill-extrusion-opacity":new _n(K["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(K["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _n(K["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _n(K["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new An(K["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(K["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(K["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _n(K["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class nl extends Sn{constructor(t){super(t,rl)}createBucket(t){return new Qa(t)}queryRadius(){return As(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,e,i,r,n,s,a,l){const c=vs(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),u=this.paint.get("fill-extrusion-height").evaluate(e,i),h=this.paint.get("fill-extrusion-base").evaluate(e,i),p=function(t,e,i,r){const n=[];for(const i of t){const t=[i.x,i.y,0,1];Ls(t,t,e),n.push(new o(t[0]/t[3],t[1]/t[3]))}return n}(c,l),d=function(t,e,i,r){const n=[],s=[],a=r[8]*e,l=r[9]*e,c=r[10]*e,u=r[11]*e,h=r[8]*i,p=r[9]*i,d=r[10]*i,f=r[11]*i;for(const e of t){const t=[],i=[];for(const n of e){const e=n.x,s=n.y,m=r[0]*e+r[4]*s+r[12],g=r[1]*e+r[5]*s+r[13],_=r[2]*e+r[6]*s+r[14],y=r[3]*e+r[7]*s+r[15],A=_+c,v=y+u,x=m+h,b=g+p,w=_+d,S=y+f,T=new o((m+a)/v,(g+l)/v);T.z=A/v,t.push(T);const C=new o(x/S,b/S);C.z=w/S,i.push(C)}n.push(t),s.push(i)}return[n,s]}(r,h,u,l);return function(t,e,i){let r=1/0;cs(i,e)&&(r=sl(i,e[0]));for(let n=0;n<e.length;n++){const o=e[n],s=t[n];for(let t=0;t<o.length-1;t++){const e=o[t],n=[e,o[t+1],s[t+1],s[t],e];as(i,n)&&(r=Math.min(r,sl(i,n)))}}return r!==1/0&&r}(d[0],d[1],p)}}function ol(t,e){return t.x*e.x+t.y*e.y}function sl(t,e){if(1===t.length){let i=0;const r=e[i++];let n;for(;!n||r.equals(n);)if(n=e[i++],!n)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=ol(a,a),h=ol(a,l),p=ol(l,l),d=ol(c,a),f=ol(c,l),m=u*p-h*h,g=(p*d-h*f)/m,_=(u*f-h*d)/m,y=r.z*(1-g-_)+n.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}const al=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ll}=al,cl=En([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ul}=cl,hl=za.VectorTileFeature.types,pl=Math.cos(Math.PI/180*37.5),dl=Math.pow(2,14)/.5;class fl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new go,this.layoutVertexArray2=new _o,this.indexArray=new So,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new Eo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=Ea("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),n=!r.isConstant(),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ns(e,t);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),c,i))continue;const u=n?r.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:rs(e),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const t=Ia("line",this.layers,r,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(r,n,o,i,{});e.featureIndex.insert(t[o].feature,n,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,ul)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ll),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,r,n){const o=this.layers[0].layout,s=o.get("line-join").evaluate(t,{}),a=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,n,r)}addLine(t,e,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===hl[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?15*ts/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,d,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(d=e===a-1?s?t[l+1]:void 0:t[e+1],d&&t[e].equals(d))continue;m&&(f=m),h&&(p=h),h=t[e],m=d?d.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,A=0!==y?1/y:1/0,v=2*Math.sqrt(2-2*y),x=y<pl&&p&&d,b=f.x*m.y-f.y*m.x>0;if(x&&e>l){const t=h.dist(p);if(t>2*c){const e=h.sub(h.sub(p)._mult(c/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,f,0,0,u),p=e}}const w=p&&d;let S=w?i:s?"butt":r;if(w&&"round"===S&&(A<o?S="miter":A<=2&&(S="fakeround")),"miter"===S&&A>n&&(S="bevel"),"bevel"===S&&(A>2&&(S="flipbevel"),A<n&&(S="miter")),p&&this.updateDistance(p,h),"miter"===S)g._mult(A),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(A>100)g=m.mult(-1);else{const t=A*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(b?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(A*A-1),e=b?t:0,i=b?0:t;if(p&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===S){const t=Math.round(180*v/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const r=m.sub(f)._mult(i)._add(f)._unit()._mult(b?-1:1);this.addHalfVertex(h,r.x,r.y,!1,b,0,u)}}d&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const t=p?1:-1;this.addCurrentVertex(h,g,t,t,u)}else"round"===S&&(p&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),d&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(x&&e<a-1){const t=h.dist(d);if(t>2*c){const e=h.add(d.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,r,n,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,n),this.addHalfVertex(t,s,a,o,!0,-r,n),this.distance>dl/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,r,n,o))}addHalfVertex({x:t,y:e},i,r,n,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(dl-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(n?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let ml,gl;Or("LineBucket",fl,{omit:["layers","patternFeatures"]});var _l={get paint(){return gl=gl||new bn({"line-opacity":new yn(K.paint_line["line-opacity"]),"line-color":new yn(K.paint_line["line-color"]),"line-translate":new _n(K.paint_line["line-translate"]),"line-translate-anchor":new _n(K.paint_line["line-translate-anchor"]),"line-width":new yn(K.paint_line["line-width"]),"line-gap-width":new yn(K.paint_line["line-gap-width"]),"line-offset":new yn(K.paint_line["line-offset"]),"line-blur":new yn(K.paint_line["line-blur"]),"line-dasharray":new vn(K.paint_line["line-dasharray"]),"line-pattern":new An(K.paint_line["line-pattern"]),"line-gradient":new xn(K.paint_line["line-gradient"])})},get layout(){return ml=ml||new bn({"line-cap":new _n(K.layout_line["line-cap"]),"line-join":new yn(K.layout_line["line-join"]),"line-miter-limit":new _n(K.layout_line["line-miter-limit"]),"line-round-limit":new _n(K.layout_line["line-round-limit"]),"line-sort-key":new yn(K.layout_line["line-sort-key"])})}};class yl extends yn{possiblyEvaluate(t,e){return e=new ln(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=_({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}let Al;class vl extends Sn{constructor(t){super(t,_l),this.gradientVersion=0,Al||(Al=new yl(_l.paint.properties["line-width"].specification),Al.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof je,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Al.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new fl(t)}queryRadius(t){const e=t,i=xl(ys("line-width",this,e),ys("line-gap-width",this,e)),r=ys("line-offset",this,e);return i/2+Math.abs(r)+As(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,n,s,a){const l=vs(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),c=a/2*xl(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),u=this.paint.get("line-offset").evaluate(e,i);return u&&(r=function(t,e){const i=[];for(let r=0;r<t.length;r++){const n=t[r],s=[];for(let t=0;t<n.length;t++){const i=n[t-1],r=n[t],a=n[t+1],l=0===t?new o(0,0):r.sub(i)._unit()._perp(),c=t===n.length-1?new o(0,0):a.sub(r)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(e)._add(r))}i.push(s)}return i}(r,u*a)),function(t,e,i){for(let r=0;r<e.length;r++){const n=e[r];if(t.length>=3)for(let e=0;e<n.length;e++)if(gs(t,n[e]))return!0;if(us(t,n,i))return!0}return!1}(l,r,c)}isTileClipped(){return!0}}function xl(t,e){return e>0?e+2*t:t}const bl=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wl=En([{name:"a_projected_pos",components:3,type:"Float32"}],4);En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Sl=En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);En([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tl=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cl=En([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ml(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const r=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),an.applyArabicShaping&&(t=an.applyArabicShaping(t)),t}(t.text,e,i)})),t}En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),En([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),En([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const El={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Il=24,Ll=Nl,Pl=function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},kl=function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+d]=255&a,d+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m};function Nl(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Nl.Varint=0,Nl.Fixed64=1,Nl.Bytes=2,Nl.Fixed32=5;var Dl=4294967296,Ol=1/Dl,Rl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Fl(t){return t.type===Nl.Bytes?t.readVarint()+t.pos:t.pos+1}function zl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Bl(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function Ul(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Vl(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function jl(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Gl(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Zl(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ql(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Wl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Hl(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Jl(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Kl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function $l(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Yl(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Nl.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Kl(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Yl(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Kl(this.buf,this.pos)+Kl(this.buf,this.pos+4)*Dl;return this.pos+=8,t},readSFixed64:function(){var t=Kl(this.buf,this.pos)+Yl(this.buf,this.pos+4)*Dl;return this.pos+=8,t},readFloat:function(){var t=Pl(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Pl(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return zl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return zl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return zl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return zl(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return zl(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return zl(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Rl?function(t,e,i){return Rl.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[n+2],128==(192&(o=t[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[n+2],a=t[n+3],128==(192&(o=t[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Nl.Bytes)return t.push(this.readVarint(e));var i=Fl(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Nl.Bytes)return t.push(this.readSVarint());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Nl.Bytes)return t.push(this.readBoolean());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Nl.Bytes)return t.push(this.readFloat());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Nl.Bytes)return t.push(this.readDouble());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Nl.Bytes)return t.push(this.readFixed32());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Nl.Bytes)return t.push(this.readSFixed32());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Nl.Bytes)return t.push(this.readFixed64());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Nl.Bytes)return t.push(this.readSFixed64());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Nl.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nl.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nl.Fixed32)this.pos+=4;else{if(e!==Nl.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),$l(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),$l(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),$l(this.buf,-1&t,this.pos),$l(this.buf,Math.floor(t*Ol),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),$l(this.buf,-1&t,this.pos),$l(this.buf,Math.floor(t*Ol),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Bl(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),kl(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kl(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Bl(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Nl.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ul,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Vl,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Zl,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,jl,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Gl,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ql,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Wl,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Hl,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Jl,e)},writeBytesField:function(t,e){this.writeTag(t,Nl.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Nl.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Nl.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Nl.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Nl.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Nl.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Nl.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Nl.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Nl.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Nl.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Xl=i(Ll);const Ql=3;function tc(t,e,i){1===t&&i.readMessage(ec,e)}function ec(t,e,i){if(3===t){const{id:t,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(ic,{});e.push({id:t,bitmap:new Bs({width:n+2*Ql,height:o+2*Ql},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}}function ic(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const rc=Ql;function nc(t){let e=0,i=0;for(const r of t)e+=r.w*r.h,i=Math.max(i,r.w);t.sort(((t,e)=>e.h-t.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let n=0,o=0;for(const e of t)for(let t=r.length-1;t>=0;t--){const i=r[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),n=Math.max(n,e.x+e.w),e.w===i.w&&e.h===i.h){const e=r.pop();t<r.length&&(r[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(r.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:n,h:o,fill:e/(n*o)||0}}const oc=1;class sc{constructor(t,{pixelRatio:e,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+oc,this.paddedRect.y+oc]}get br(){return[this.paddedRect.x+this.paddedRect.w-oc,this.paddedRect.y+this.paddedRect.h-oc]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*oc)/this.pixelRatio,(this.paddedRect.h-2*oc)/this.pixelRatio]}}class ac{constructor(t,e){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(t,i,n),this.addImages(e,r,n);const{w:o,h:s}=nc(n),a=new Us({width:o||1,height:s||1});for(const e in t){const r=t[e],n=i[e].paddedRect;Us.copy(r.data,a,{x:0,y:0},{x:n.x+oc,y:n.y+oc},r.data)}for(const t in e){const i=e[t],n=r[t].paddedRect,o=n.x+oc,s=n.y+oc,l=i.data.width,c=i.data.height;Us.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),Us.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),Us.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),Us.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),Us.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(t,e,i){for(const r in t){const n=t[r],o={x:0,y:0,w:n.data.width+2*oc,h:n.data.height+2*oc};i.push(o),e[r]=new sc(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,n]=t.tl;i.update(e.data,void 0,{x:r,y:n})}}var lc;Or("ImagePosition",sc),Or("ImageAtlas",ac),t.ai=void 0,(lc=t.ai||(t.ai={}))[lc.none=0]="none",lc[lc.horizontal=1]="horizontal",lc[lc.vertical=2]="vertical",lc[lc.horizontalOnly=3]="horizontalOnly";const cc=-17;class uc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new uc;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new uc;return e.imageName=t,e}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new hc;for(let r=0;r<t.sections.length;r++){const n=t.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i+1)||null,n=t.charCodeAt(i-1)||null;e+=r&&qr(r)&&!El[t[i+1]]||n&&qr(n)&&!El[t[i-1]]||!El[t[i]]?t[i]:El[t[i]]}return e}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&dc[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&dc[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new hc;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(uc.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void w("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(uc.forImage(e)),this.sectionIndex.push(this.sections.length-1)):w("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pc(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=hc.fromFeature(e,o);let y;p===t.ai.vertical&&_.verticalizePunctuation();const{processBidirectionalText:A,processStyledBidirectionalText:v}=an;if(A&&1===_.sections.length){y=[];const t=A(_.toString(),vc(_,u,s,i,n,f,m));for(const e of t){const t=new hc;t.text=e,t.sections=_.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(_.text,_.sectionIndex,vc(_,u,s,i,n,f,m));for(const e of t){const t=new hc;t.text=e[0],t.sectionIndex=e[1],t.sections=_.sections,y.push(t)}}else y=function(t,e){const i=[],r=t.text;let n=0;for(const r of e)i.push(t.substring(n,r)),n=r;return n<r.length&&i.push(t.substring(n,r.length)),i}(_,vc(_,u,s,i,n,f,m));const x=[],b={positionedLines:x,text:_.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:p,iconsInText:!1,verticalizable:!1};return function(e,i,r,n,o,s,a,l,c,u,h,p){let d=0,f=cc,m=0,g=0;const _="right"===l?1:"left"===l?0:.5;let y=0;for(const a of o){a.trim();const o=a.getMaxScale(),l=(o-1)*Il,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=v;const x=v.positionedGlyphs;let b=0;if(!a.length()){f+=s,++y;continue}for(let s=0;s<a.length();s++){const m=a.getSection(s),g=a.getSectionIndex(s),_=a.getCharCode(s);let y=0,v=null,w=null,S=null,T=Il;const C=!(c===t.ai.horizontal||!h&&!Zr(_)||h&&(dc[_]||(A=_,Ur.Arabic(A)||Ur["Arabic Supplement"](A)||Ur["Arabic Extended-A"](A)||Ur["Arabic Presentation Forms-A"](A)||Ur["Arabic Presentation Forms-B"](A))));if(m.imageName){const t=n[m.imageName];if(!t)continue;S=m.imageName,e.iconsInText=e.iconsInText||!0,w=t.paddedRect;const i=t.displaySize;m.scale=m.scale*Il/p,v={width:i[0],height:i[1],left:oc,top:-rc,advance:C?i[1]:i[0]},y=l+(Il-i[1]*m.scale),T=v.advance;const r=C?i[0]*m.scale-Il*o:i[1]*m.scale-Il*o;r>0&&r>b&&(b=r)}else{const t=r[m.fontStack],e=t&&t[_];if(e&&e.rect)w=e.rect,v=e.metrics;else{const t=i[m.fontStack],e=t&&t[_];if(!e)continue;v=e.metrics}y=(o-m.scale)*Il}C?(e.verticalizable=!0,x.push({glyph:_,imageName:S,x:d,y:f+y,vertical:C,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:v,rect:w}),d+=T*m.scale+u):(x.push({glyph:_,imageName:S,x:d,y:f+y,vertical:C,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:v,rect:w}),d+=v.advance*m.scale+u)}0!==x.length&&(m=Math.max(d-u,m),bc(x,0,x.length-1,_,b)),d=0;const w=s*o+b;v.lineOffset=Math.max(b,l),f+=w,g=Math.max(w,g),++y}var A;const v=f-cc,{horizontalAlign:x,verticalAlign:b}=xc(a);(function(t,e,i,r,n,o,s,a,l){const c=(e-i)*n;let u=0;u=o!==s?-a*r-cc:(-r*l+.5)*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=c,t.y+=u})(e.positionedLines,_,x,b,m,g,s,v,o.length),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*m,e.right=e.left+m}(b,i,r,n,y,a,l,c,p,u,d,g),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const dc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function mc(t,e,i,r,n,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*Il/o+n:0}{const r=i[e.fontStack],o=r&&r[t];return o?o.metrics.advance*e.scale+n:0}}function gc(t,e,i,r){const n=Math.pow(t-e,2);return r?t<e?n/2:2*n:n+Math.abs(i)*i}function _c(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function yc(t,e,i,r,n,o){let s=null,a=gc(e,i,n,o);for(const t of r){const r=gc(e-t.x,i,n,o)+t.badness;r<=a&&(s=t,a=r)}return{index:t,x:e,priorBreak:s,badness:a}}function Ac(t){return t?Ac(t.priorBreak).concat(t.index):[]}function vc(t,e,i,r,n,o,s){if("point"!==o)return[];if(!t)return[];const a=[],l=function(t,e,i,r,n,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=mc(t.getCharCode(i),a,r,n,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,r,n,s),c=t.text.indexOf("")>=0;let u=0;for(let i=0;i<t.length();i++){const o=t.getSection(i),p=t.getCharCode(i);if(dc[p]||(u+=mc(p,o,r,n,e,s)),i<t.length()-1){const e=!((h=p)<11904||!(Ur["Bopomofo Extended"](h)||Ur.Bopomofo(h)||Ur["CJK Compatibility Forms"](h)||Ur["CJK Compatibility Ideographs"](h)||Ur["CJK Compatibility"](h)||Ur["CJK Radicals Supplement"](h)||Ur["CJK Strokes"](h)||Ur["CJK Symbols and Punctuation"](h)||Ur["CJK Unified Ideographs Extension A"](h)||Ur["CJK Unified Ideographs"](h)||Ur["Enclosed CJK Letters and Months"](h)||Ur["Halfwidth and Fullwidth Forms"](h)||Ur.Hiragana(h)||Ur["Ideographic Description Characters"](h)||Ur["Kangxi Radicals"](h)||Ur["Katakana Phonetic Extensions"](h)||Ur.Katakana(h)||Ur["Vertical Forms"](h)||Ur["Yi Radicals"](h)||Ur["Yi Syllables"](h)));(fc[p]||e||o.imageName)&&a.push(yc(i+1,u,l,a,_c(p,t.getCharCode(i+1),e&&c),!1))}}var h;return Ac(yc(t.length(),u,l,a,0,!0))}function xc(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function bc(t,e,i,r,n){if(!r&&!n)return;const o=t[i],s=(t[i].x+o.metrics.advance*o.scale)*r;for(let r=e;r<=i;r++)t[r].x-=s,t[r].y+=n}function wc(t,e,i){const{horizontalAlign:r,verticalAlign:n}=xc(i),o=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*n;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Sc(t,e,i,r,n,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,p,d;"width"===i||"both"===i?(d=n[0]+l-r[3],h=n[0]+c+r[1]):(d=n[0]+(l+c-s.displaySize[0])/2,h=d+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],p=n[1]+m+r[2]):(u=n[1]+(f+m-s.displaySize[1])/2,p=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:p,left:d,collisionPadding:a}}const Tc=255,Cc=128,Mc=Tc*Cc;function Ec(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new ln(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=i;let n=0;for(;n<e.length&&e[n]<=t;)n++;n=Math.max(0,n-1);let o=n;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[n],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new ln(s)),maxSize:i.evaluate(new ln(a)),interpolationType:r}}}function Ic(t,e,i){let r="never";const n=t.get(e);return n?r=n:t.get(i)&&(r="always"),r}const Lc=za.VectorTileFeature.types,Pc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kc(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=a?Math.min(Mc,Math.round(a[0])):0,f=a?Math.min(Mc,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*n),o,s,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function Nc(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function Dc(t){for(const e of t.sections)if(Jr(e.text))return!0;return!1}class Oc{constructor(t){this.layoutVertexArray=new Ao,this.indexArray=new So,this.programConfigurations=t,this.segments=new Eo,this.dynamicLayoutVertexArray=new vo,this.opacityVertexArray=new xo,this.hasVisibleVertices=!1,this.placedSymbolArray=new io}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,wl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Pc,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Or("SymbolBuffers",Oc);class Rc{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new Eo,this.collisionVertexArray=new wo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Sl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Or("CollisionBuffers",Rc);class Fc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Cs([]),this.placementViewportMatrix=Cs([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ec(this.zoom,i["text-size"]),this.iconSizeData=Ec(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==Ic(r,"text-overlap","text-allow-overlap")||"never"!==Ic(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((e=>t.ai[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Oc(new Yo(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Oc(new Yo(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new oo,this.lineVertexArray=new so,this.symbolInstances=new no,this.textAnchorOffsets=new lo}calculateGlyphDependencies(t,e,i,r,n){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||r)&&n){const i=El[t.charAt(o)];i&&(e[i.charCodeAt(0)]=!0)}}populate(e,i,r){const n=this.layers[0],o=n.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Qt&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const p=i.iconDependencies,d=i.glyphDependencies,f=i.availableImages,m=new ln(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:g}of e){const e=n._featureFilter.needGeometry,_=ns(i,e);if(!n._featureFilter.filter(m,_,r))continue;let y,A;if(e||(_.geometry=rs(i)),c){const t=n.getValueAndResolveTokens("text-field",_,r,f),e=Qt.factory(t);Dc(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===on()||this.hasRTLText&&an.isParsed())&&(y=Ml(e,n,_))}if(u){const t=n.getValueAndResolveTokens("icon-image",_,r,f);A=t instanceof re?t:re.fromString(t)}if(!y&&!A)continue;const v=this.sortFeaturesByKey?h.evaluate(_,{},r):void 0;if(this.features.push({id:a,text:y,icon:A,index:l,sourceLayerIndex:g,geometry:_.geometry,properties:i.properties,type:Lc[i.type],sortKey:v}),A&&(p[A.name]=!0),y){const e=s.evaluate(_,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.ai.vertical)>=0;for(const t of y.sections)if(t.image)p[t.image.name]=!0;else{const r=Vr(y.toString()),n=t.fontStack||e,o=d[n]=d[n]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},r=[];let n=0;function o(e){r.push(t[e]),n++}function s(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(t,i,n){const o=e[i];return delete e[i],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(t,e,i){const r=i?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(!p){o(c);continue}const d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){const t=a(d,f,h),n=s(d,f,r[t].geometry);delete e[d],delete i[f],i[l(p,r[n].geometry,!0)]=n,r[t].geometry=null}else d in i?s(d,f,h):f in e?a(d,f,h):(o(c),e[d]=n-1,i[f]=n-1)}return r.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),r=t.dist(e[t.segment]);const n={};for(let r=t.segment+1;r<e.length;r++)n[r]={x:e[r].x,y:e[r].y,tileUnitDistanceFromAnchor:i},r<e.length-1&&(i+=e[r+1].dist(e[r]));for(let i=t.segment||0;i>=0;i--)n[i]={x:e[i].x,y:e[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=e[i-1].dist(e[i]));for(let t=0;t<e.length;t++){const e=n[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,i,r,n,o,s,a,l,c,u,h,p){const d=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*i.length,f,d,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,_=m.vertexLength,y=this.allowVerticalPlacement&&a===t.ai.vertical?Math.PI/2:0,A=s.text&&s.text.sections;for(let t=0;t<i.length;t++){const{tl:n,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:_,minFontScaleY:v,glyphOffset:x,isSDF:b,sectionIndex:w}=i[t],S=m.vertexLength,T=x[1];kc(f,l.x,l.y,n.x,T+n.y,u.x,u.y,r,b,h.x,h.y,_,v),kc(f,l.x,l.y,o.x,T+o.y,u.x+u.w,u.y,r,b,g.x,h.y,_,v),kc(f,l.x,l.y,a.x,T+a.y,u.x,u.y+u.h,r,b,h.x,g.y,_,v),kc(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,r,b,g.x,g.y,_,v),Nc(e.dynamicLayoutVertexArray,l,y),d.emplaceBack(S,S+1,S+2),d.emplaceBack(S+1,S+2,S+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),t!==i.length-1&&w===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},p,A&&A[w])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,_,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,i,r,n,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(t,e,i,r,n,s,a){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=l.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,p=a.anchorX,d=a.anchorY;this._addCollisionDebugVertex(u,h,s,p,d,new o(t,e)),this._addCollisionDebugVertex(u,h,s,p,d,new o(i,e)),this._addCollisionDebugVertex(u,h,s,p,d,new o(i,r)),this._addCollisionDebugVertex(u,h,s,p,d,new o(t,r)),l.vertexLength+=4;const f=n.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(t,e,i,r){for(let n=t;n<e;n++){const t=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,r?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rc(bo,Tl.members,To),this.iconCollisionBox=new Rc(bo,Tl.members,To);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,i,r,n,o,s,a,l){const c={};for(let r=e;r<i;r++){const e=t.get(r);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let e=r;e<n;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),r=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<r;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),r=[],n=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);r.push(0|Math.round(e*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort(((t,e)=>r[t]-r[e]||n[e]-n[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zc,Bc;Or("SymbolBucket",Fc,{omit:["layers","collisionBoxArray","features","compareText"]}),Fc.MAX_GLYPHS=65535,Fc.addDynamicAttributes=Nc;var Uc={get paint(){return Bc=Bc||new bn({"icon-opacity":new yn(K.paint_symbol["icon-opacity"]),"icon-color":new yn(K.paint_symbol["icon-color"]),"icon-halo-color":new yn(K.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(K.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(K.paint_symbol["icon-halo-blur"]),"icon-translate":new _n(K.paint_symbol["icon-translate"]),"icon-translate-anchor":new _n(K.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(K.paint_symbol["text-opacity"]),"text-color":new yn(K.paint_symbol["text-color"],{runtimeType:mt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new yn(K.paint_symbol["text-halo-color"]),"text-halo-width":new yn(K.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(K.paint_symbol["text-halo-blur"]),"text-translate":new _n(K.paint_symbol["text-translate"]),"text-translate-anchor":new _n(K.paint_symbol["text-translate-anchor"])})},get layout(){return zc=zc||new bn({"symbol-placement":new _n(K.layout_symbol["symbol-placement"]),"symbol-spacing":new _n(K.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _n(K.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(K.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _n(K.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _n(K.layout_symbol["icon-allow-overlap"]),"icon-overlap":new _n(K.layout_symbol["icon-overlap"]),"icon-ignore-placement":new _n(K.layout_symbol["icon-ignore-placement"]),"icon-optional":new _n(K.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _n(K.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(K.layout_symbol["icon-size"]),"icon-text-fit":new _n(K.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _n(K.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(K.layout_symbol["icon-image"]),"icon-rotate":new yn(K.layout_symbol["icon-rotate"]),"icon-padding":new yn(K.layout_symbol["icon-padding"]),"icon-keep-upright":new _n(K.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(K.layout_symbol["icon-offset"]),"icon-anchor":new yn(K.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _n(K.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _n(K.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _n(K.layout_symbol["text-rotation-alignment"]),"text-field":new yn(K.layout_symbol["text-field"]),"text-font":new yn(K.layout_symbol["text-font"]),"text-size":new yn(K.layout_symbol["text-size"]),"text-max-width":new yn(K.layout_symbol["text-max-width"]),"text-line-height":new _n(K.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(K.layout_symbol["text-letter-spacing"]),"text-justify":new yn(K.layout_symbol["text-justify"]),"text-radial-offset":new yn(K.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _n(K.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yn(K.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yn(K.layout_symbol["text-anchor"]),"text-max-angle":new _n(K.layout_symbol["text-max-angle"]),"text-writing-mode":new _n(K.layout_symbol["text-writing-mode"]),"text-rotate":new yn(K.layout_symbol["text-rotate"]),"text-padding":new _n(K.layout_symbol["text-padding"]),"text-keep-upright":new _n(K.layout_symbol["text-keep-upright"]),"text-transform":new yn(K.layout_symbol["text-transform"]),"text-offset":new yn(K.layout_symbol["text-offset"]),"text-allow-overlap":new _n(K.layout_symbol["text-allow-overlap"]),"text-overlap":new _n(K.layout_symbol["text-overlap"]),"text-ignore-placement":new _n(K.layout_symbol["text-ignore-placement"]),"text-optional":new _n(K.layout_symbol["text-optional"])})}};class Vc{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ht,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Or("FormatSectionOverride",Vc,{omit:["defaultValue"]});class jc extends Sn{constructor(t){super(t,Uc)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,r){const n=this.layout.get(t).evaluate(e,{},i,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Oi(o.value)||!n?n:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>t&&i in t?String(t[i]):""))}(e.properties,n)}createBucket(t){return new Fc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Uc.paint.overridableProperties){if(!jc.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new Vc(e),r=new Di(i,e.property.specification);let n=null;n="constant"===e.value.kind||"source"===e.value.kind?new Fi("source",r):new zi("composite",r,e.value.zoomStops),this.paint._values[t]=new mn(e.property,n,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&jc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),r=Uc.paint.properties[e];let n=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof Qt)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{n||(e instanceof le&&se(e.value)===At?o(e.value.sections):e instanceof pi?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return n}}let Gc;var Zc={get paint(){return Gc=Gc||new bn({"background-color":new _n(K.paint_background["background-color"]),"background-pattern":new vn(K.paint_background["background-pattern"]),"background-opacity":new _n(K.paint_background["background-opacity"])})}};class qc extends Sn{constructor(t){super(t,Zc)}}let Wc;var Hc={get paint(){return Wc=Wc||new bn({"raster-opacity":new _n(K.paint_raster["raster-opacity"]),"raster-hue-rotate":new _n(K.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _n(K.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _n(K.paint_raster["raster-brightness-max"]),"raster-saturation":new _n(K.paint_raster["raster-saturation"]),"raster-contrast":new _n(K.paint_raster["raster-contrast"]),"raster-resampling":new _n(K.paint_raster["raster-resampling"]),"raster-fade-duration":new _n(K.paint_raster["raster-fade-duration"])})}};class Jc extends Sn{constructor(t){super(t,Hc)}}class Kc extends Sn{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class $c{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){delete this._channel,this._callback=()=>{}}}const Yc=6371008.8;class Xc{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xc(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,r=t.lat*e,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Yc*Math.acos(Math.min(n,1))}static convert(t){if(t instanceof Xc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Xc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Xc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qc=2*Math.PI*Yc;function tu(t){return Qc*Math.cos(t*Math.PI/180)}function eu(t){return(180+t)/360}function iu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ru(t,e){return t/tu(e)}function nu(t){return 360*t-180}function ou(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}class su{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=Xc.convert(t);return new su(eu(i.lng),iu(i.lat),ru(e,i.lat))}toLngLat(){return new Xc(nu(this.x),ou(this.y))}toAltitude(){return this.z*tu(ou(this.y))}meterInMercatorCoordinateUnits(){return 1/Qc*(t=ou(this.y),1/Math.cos(t*Math.PI/180));var t}}function au(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class lu{constructor(t,e,i){if(t<0||t>25||i<0||i>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))throw new Error(`x=${e}, y=${i}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=e,this.y=i,this.key=hu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,i){const r=(o=this.y,s=this.z,a=au(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=au(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var n,o,s,a,l;const c=function(t,e,i){let r,n="";for(let o=t;o>0;o--)r=1<<o-1,n+=(e&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new o((t.x*e-this.x)*ts,(t.y*e-this.y)*ts)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=hu(t,e.z,e.z,e.x,e.y)}}class uu{constructor(t,e,i,r,n){if(t<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${i}`);this.overscaledZ=t,this.wrap=e,this.canonical=new lu(i,+r,+n),this.key=hu(e,t,i,r,n)}clone(){return new uu(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const e=this.canonical.z-t;return t>this.canonical.z?new uu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?hu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):hu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new uu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new uu(e,this.wrap,e,i,r),new uu(e,this.wrap,e,i+1,r),new uu(e,this.wrap,e,i,r+1),new uu(e,this.wrap,e,i+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new uu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new uu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new su(t.x-this.wrap,t.y))}}function hu(t,e,i,r,n){(t*=2)<0&&(t=-1*t-1);const o=1<<i;return(o*o*t+o*n+r).toString(36)+i.toString(36)+e.toString(36)}Or("CanonicalTileID",lu),Or("OverscaledTileID",uu,{omit:["posMatrix"]});class pu{constructor(t,e,i,r=1,n=1,o=1,s=0){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void w(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=e.height;const a=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=n,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let t=0;t<a;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(a,t)]=this.data[this._idx(a-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,a)]=this.data[this._idx(t,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<a;t++)for(let e=0;e<a;e++){const i=this.get(t,e);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(t,e){const i=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return this.unpack(i[r],i[r+1],i[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,i){return t*this.redFactor+e*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new Us({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,n=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=r;i<n;i++)this.data[this._idx(i,e)]=t.data[this._idx(i+a,e+l)]}}Or("DEMData",pu);class du{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class fu{constructor(t,e,i,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=r,this.properties=t.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class mu{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Nr(ts,16,0),this.grid3D=new Nr(ts,16,0),this.featureIndexArray=new uo,this.promoteId=e}insert(t,e,i,r,n,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const a=o?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const i=e[t],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];r[0]=Math.min(r[0],e.x),r[1]=Math.min(r[1],e.y),r[2]=Math.max(r[2],e.x),r[3]=Math.max(r[3],e.y)}r[0]<ts&&r[1]<ts&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new za.VectorTile(new Xl(this.rawTileData)).layers,this.sourceLayerCoder=new du(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,r){this.loadVTLayers();const n=t.params||{},s=ts/t.tileSize/t.scale,a=Zi(n.filter),l=t.queryGeometry,c=t.queryPadding*s,u=_u(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),p=_u(t.cameraQueryGeometry),d=this.grid3D.query(p.minX-c,p.minY-c,p.maxX+c,p.maxY+c,((e,i,r,n)=>function(t,e,i,r,n){for(const o of t)if(e<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const s=[new o(e,i),new o(e,n),new o(r,n),new o(r,i)];if(t.length>2)for(const e of s)if(gs(t,e))return!0;for(let e=0;e<t.length-1;e++)if(_s(t[e],t[e+1],s))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,r+c,n+c)));for(const t of d)h.push(t);h.sort(yu);const f={};let m;for(let o=0;o<h.length;o++){const c=h[o];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let p=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,n.layers,n.availableImages,e,i,r,((e,i,r)=>(p||(p=rs(e)),i.queryIntersectsFeature(l,e,r,p,this.z,t.transform,s,t.pixelPosMatrix))))}return f}loadMatchingFeature(t,e,i,r,n,o,s,a,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(o,h))return;const p=this.sourceLayerCoder.decode(i),d=this.vtLayers[p].feature(r);if(n.needGeometry){const t=ns(d,!0);if(!n.filter(new ln(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!n.filter(new ln(this.tileID.overscaledZ),d))return;const f=this.getId(d,p);for(let e=0;e<h.length;e++){const i=h[e];if(o&&o.indexOf(i)<0)continue;const n=a[i];if(!n)continue;let p={};f&&c&&(p=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const m=_({},l[i]);m.paint=gu(m.paint,n.paint,d,p,s),m.layout=gu(m.layout,n.layout,d,p,s);const g=!u||u(d,n,p);if(!g)continue;const y=new fu(d,this.z,this.x,this.y,f);y.layer=m;let A=t[i];void 0===A&&(A=t[i]=[]),A.push({featureIndex:r,feature:y,intersectionZ:g})}}lookupSymbolFeatures(t,e,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Zi(n);for(const n of t)this.loadMatchingFeature(l,i,r,n,c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function gu(t,e,i,r,n){return A(t,((t,o)=>{const s=e instanceof gn?e.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function _u(t){let e=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{minX:e,minY:i,maxX:r,maxY:n}}function yu(t,e){return e-t}function Au(t,e,i,r,n){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new o(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new o(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new o(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=n&&u.y>=n||(a.y>=n?a=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y>=n&&(u=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}Or("FeatureIndex",mu,{omit:["rawTileData","sourceLayerCoder"]});class vu extends o{constructor(t,e,i,r){super(t,e),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new vu(this.x,this.y,this.angle,this.segment)}}function xu(t,e,i,r,n){if(void 0===e.segment||0===i)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=e.dist(i)}return!0}function bu(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function wu(t,e,i){return t?.6*e*i:0}function Su(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Tu(t,e,i,r,n,o){const s=wu(i,n,o),a=Su(i,r)*o;let l=0;const c=bu(t)/2;for(let i=0;i<t.length-1;i++){const r=t[i],n=t[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=qe.number(r.x,n.x,u),p=qe.number(r.y,n.y,u),d=new vu(h,p,n.angleTo(r),i);return d._round(),!s||xu(t,d,a,s,e)?d:void 0}l+=o}}function Cu(t,e,i,r,n,o,s,a,l){const c=wu(r,o,s),u=Su(r,n),h=u*s,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Mu(t,p?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,p,!1,l)}function Mu(t,e,i,r,n,o,s,a,l){const c=o/2,u=bu(t);let h=0,p=e-i,d=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;p+i<h+f;){p+=i;const g=(p-h)/f,_=qe.number(s.x,a.x,g),y=qe.number(s.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&p-c>=0&&p+c<=u){const i=new vu(_,y,m,e);i._round(),r&&!xu(t,i,o,r,n)||d.push(i)}}h+=f}return a||d.length||s||(d=Mu(t,h/2,i,r,n,o,s,!0,l)),d}Or("Anchor",vu);const Eu=oc;function Iu(t,e,i,r){const n=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2*Eu,c=s.paddedRect.h-2*Eu,u=t.right-t.left,h=t.bottom-t.top,p=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],m=p.reduce(f,0),g=d.reduce(f,0),_=l-m,y=c-g;let A=0,v=m,x=0,b=g,w=0,S=_,T=0,C=y;if(s.content&&r){const t=s.content;A=Lu(p,0,t[0]),x=Lu(d,0,t[1]),v=Lu(p,t[0],t[2]),b=Lu(d,t[1],t[3]),w=t[0]-A,T=t[1]-x,S=t[2]-t[0]-v,C=t[3]-t[1]-b}const M=(r,n,l,c)=>{const p=ku(r.stretch-A,v,u,t.left),d=Nu(r.fixed-w,S,r.stretch,m),f=ku(n.stretch-x,b,h,t.top),_=Nu(n.fixed-T,C,n.stretch,g),y=ku(l.stretch-A,v,u,t.left),M=Nu(l.fixed-w,S,l.stretch,m),E=ku(c.stretch-x,b,h,t.top),I=Nu(c.fixed-T,C,c.stretch,g),L=new o(p,f),P=new o(y,f),k=new o(y,E),N=new o(p,E),D=new o(d/a,_/a),O=new o(M/a,I/a),R=e*Math.PI/180;if(R){const t=Math.sin(R),e=Math.cos(R),i=[e,-t,t,e];L._matMult(i),P._matMult(i),N._matMult(i),k._matMult(i)}const F=r.stretch+r.fixed,z=n.stretch+n.fixed;return{tl:L,tr:P,bl:N,br:k,tex:{x:s.paddedRect.x+Eu+F,y:s.paddedRect.y+Eu+z,w:l.stretch+l.fixed-F,h:c.stretch+c.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:O,minFontScaleX:S/a/u,minFontScaleY:C/a/h,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const t=Pu(p,_,m),e=Pu(d,y,g);for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)n.push(M(r,e[t],o,e[t+1]))}}else n.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return n}function Lu(t,e,i){let r=0;for(const n of t)r+=Math.max(e,Math.min(i,n[1]))-Math.max(e,Math.min(i,n[0]));return r}function Pu(t,e,i){const r=[{fixed:-Eu,stretch:0}];for(const[e,i]of t){const t=r[r.length-1];r.push({fixed:e-t.stretch,stretch:t.stretch}),r.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return r.push({fixed:e+Eu,stretch:i}),r}function ku(t,e,i,r){return t/e*i+r}function Nu(t,e,i,r){return t-e*i/r}class Du{constructor(t,e,i,r,n,s,a,l,c,u){if(this.boxStartIndex=t.length,c){let t=s.top,e=s.bottom;const i=s.collisionPadding;i&&(t-=i[1],e+=i[3]);let r=e-t;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{let c=s.top*a-l[0],h=s.bottom*a+l[2],p=s.left*a-l[3],d=s.right*a+l[1];const f=s.collisionPadding;if(f&&(p-=f[0]*a,c-=f[1]*a,d+=f[2]*a,h+=f[3]*a),u){const t=new o(p,c),e=new o(d,c),i=new o(p,h),r=new o(d,h),n=u*Math.PI/180;t._rotate(n),e._rotate(n),i._rotate(n),r._rotate(n),p=Math.min(t.x,e.x,i.x,r.x),d=Math.max(t.x,e.x,i.x,r.x),c=Math.min(t.y,e.y,i.y,r.y),h=Math.max(t.y,e.y,i.y,r.y)}t.emplaceBack(e.x,e.y,p,c,d,h,i,r,n)}this.boxEndIndex=t.length}}class Ou{constructor(t=[],e=Ru){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,r=e[t];for(;t>0;){const n=t-1>>1,o=e[n];if(i(r,o)>=0)break;e[t]=o,t=n}e[t]=r}_down(t){const{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&i(e[s],o)<0&&(r=s,o=e[s]),i(o,n)>=0)break;e[t]=o,t=r}e[t]=n}}function Ru(t,e){return t<e?-1:t>e?1:0}function Fu(t,e=1,i=!1){let r=1/0,n=1/0,s=-1/0,a=-1/0;const l=t[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<r)&&(r=e.x),(!t||e.y<n)&&(n=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y)}const c=Math.min(s-r,a-n);let u=c/2;const h=new Ou([],zu);if(0===c)return new o(r,n);for(let e=r;e<s;e+=c)for(let i=n;i<a;i+=c)h.push(new Bu(e+u,i+u,u,t));let p=function(t){let e=0,i=0,r=0;const n=t[0];for(let t=0,o=n.length,s=o-1;t<o;s=t++){const o=n[t],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,e+=3*l}return new Bu(i/e,r/e,0,t)}(t),d=h.length;for(;h.length;){const r=h.pop();(r.d>p.d||!p.d)&&(p=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-p.d<=e||(u=r.h/2,h.push(new Bu(r.p.x-u,r.p.y-u,u,t)),h.push(new Bu(r.p.x+u,r.p.y-u,u,t)),h.push(new Bu(r.p.x-u,r.p.y+u,u,t)),h.push(new Bu(r.p.x+u,r.p.y+u,u,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${p.d}`)),p.p}function zu(t,e){return e.max-t.max}function Bu(t,e,i,r){this.p=new o(t,e),this.h=i,this.d=function(t,e){let i=!1,r=1/0;for(let n=0;n<e.length;n++){const o=e[n];for(let e=0,n=o.length,s=n-1;e<n;s=e++){const n=o[e],a=o[s];n.y>t.y!=a.y>t.y&&t.x<(a.x-n.x)*(t.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,fs(t,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Uu;t.aq=void 0,(Uu=t.aq||(t.aq={}))[Uu.center=1]="center",Uu[Uu.left=2]="left",Uu[Uu.right=3]="right",Uu[Uu.top=4]="top",Uu[Uu.bottom=5]="bottom",Uu[Uu["top-left"]=6]="top-left",Uu[Uu["top-right"]=7]="top-right",Uu[Uu["bottom-left"]=8]="bottom-left",Uu[Uu["bottom-right"]=9]="bottom-right";const Vu=7,ju=Number.POSITIVE_INFINITY;function Gu(t,e){return e[1]!==ju?function(t,e,i){let r=0,n=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":n=i-Vu;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Vu}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,n]}(t,e[0],e[1]):function(t,e){let i=0,r=0;e<0&&(e=0);const n=e/Math.SQRT2;switch(t){case"top-right":case"top-left":r=n-Vu;break;case"bottom-right":case"bottom-left":r=-n+Vu;break;case"bottom":r=-e+Vu;break;case"top":r=e-Vu}switch(t){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=e;break;case"right":i=-e}return[i,r]}(t,e[0])}function Zu(t,e,i){var r;const n=t.layout,o=null===(r=n.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(e,{},i);if(o){const t=o.values,e=[];for(let i=0;i<t.length;i+=2){const r=e[i]=t[i],n=t[i+1].map((t=>t*Il));r.startsWith("top")?n[1]-=Vu:r.startsWith("bottom")&&(n[1]+=Vu),e[i+1]=n}return new ie(e)}const s=n.get("text-variable-anchor");if(s){let r;r=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(e,{},i)*Il,ju]:n.get("text-offset").evaluate(e,{},i).map((t=>t*Il));const o=[];for(const t of s)o.push(t,Gu(t,r));return new ie(o)}return null}function qu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wu(e,i,r,n,o,s,a,l,c,u,h){let p=s.textMaxSize.evaluate(i,{});void 0===p&&(p=a);const d=e.layers[0].layout,f=d.get("icon-offset").evaluate(i,{},h),m=Ju(r.horizontal),g=a/24,_=e.tilePixelRatio*g,y=e.tilePixelRatio*p/24,A=e.tilePixelRatio*l,v=e.tilePixelRatio*d.get("symbol-spacing"),x=d.get("text-padding")*e.tilePixelRatio,b=function(t,e,i,r=1){const n=t.get("icon-padding").evaluate(e,{},i),o=n&&n.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(d,i,h,e.tilePixelRatio),S=d.get("text-max-angle")/180*Math.PI,T="viewport"!==d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),C="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),M=d.get("symbol-placement"),E=v/2,I=d.get("icon-text-fit");let L;n&&"none"!==I&&(e.allowVerticalPlacement&&r.vertical&&(L=Sc(n,r.vertical,I,d.get("icon-text-fit-padding"),f,g)),m&&(n=Sc(n,m,I,d.get("icon-text-fit-padding"),f,g)));const P=(l,p)=>{p.x<0||p.x>=ts||p.y<0||p.y>=ts||function(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,S,T,C){const M=e.addToLineVertexArray(i,r);let E,I,L,P,k=0,N=0,D=0,O=0,R=-1,F=-1;const z={};let B=Do("");if(e.allowVerticalPlacement&&n.vertical){const t=l.layout.get("text-rotate").evaluate(x,{},T)+90;L=new Du(c,i,u,h,p,n.vertical,d,f,m,t),a&&(P=new Du(c,i,u,h,p,a,_,y,m,t))}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{}),n="none"!==l.layout.get("icon-text-fit"),s=Iu(o,r,S,n),d=a?Iu(a,r,S,n):void 0;I=new Du(c,i,u,h,p,o,_,y,!1,r),k=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Cc*l.layout.get("icon-size").evaluate(x,{})],m[0]>Mc&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${Tc}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Cc*b.compositeIconSizes[0].evaluate(x,{},T),Cc*b.compositeIconSizes[1].evaluate(x,{},T)],(m[0]>Mc||m[1]>Mc)&&w(`${e.layerIds[0]}: Value for "icon-size" is >= ${Tc}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,v,A,x,t.ai.none,i,M.lineStartIndex,M.lineLength,-1,T),R=e.icon.placedSymbolArray.length-1,d&&(N=4*d.length,e.addSymbols(e.icon,d,m,v,A,x,t.ai.vertical,i,M.lineStartIndex,M.lineLength,-1,T),F=e.icon.placedSymbolArray.length-1)}const U=Object.keys(n.horizontal);for(const r of U){const o=n.horizontal[r];if(!E){B=Do(o.text);const t=l.layout.get("text-rotate").evaluate(x,{},T);E=new Du(c,i,u,h,p,o,d,f,m,t)}const a=1===o.positionedLines.length;if(D+=Hu(e,i,o,s,l,m,x,g,M,n.vertical?t.ai.horizontal:t.ai.horizontalOnly,a?U:[r],z,R,b,T),a)break}n.vertical&&(O+=Hu(e,i,n.vertical,s,l,m,x,g,M,t.ai.vertical,["vertical"],z,F,b,T));const V=E?E.boxStartIndex:e.collisionBoxArray.length,j=E?E.boxEndIndex:e.collisionBoxArray.length,G=L?L.boxStartIndex:e.collisionBoxArray.length,Z=L?L.boxEndIndex:e.collisionBoxArray.length,q=I?I.boxStartIndex:e.collisionBoxArray.length,W=I?I.boxEndIndex:e.collisionBoxArray.length,H=P?P.boxStartIndex:e.collisionBoxArray.length,J=P?P.boxEndIndex:e.collisionBoxArray.length;let K=-1;const $=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;K=$(E,K),K=$(L,K),K=$(I,K),K=$(P,K);const Y=K>-1?1:0;Y&&(K*=C/Il),e.glyphOffsetArray.length>=Fc.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey);const X=Zu(l,x,T),[Q,tt]=function(e,i){const r=e.length,n=null==i?void 0:i.values;if((null==n?void 0:n.length)>0)for(let i=0;i<n.length;i+=2){const r=n[i+1];e.emplaceBack(t.aq[n[i]],r[0],r[1])}return[r,e.length]}(e.textAnchorOffsets,X);e.symbolInstances.emplaceBack(i.x,i.y,z.right>=0?z.right:-1,z.center>=0?z.center:-1,z.left>=0?z.left:-1,z.vertical||-1,R,F,B,V,j,G,Z,q,W,H,J,u,D,O,k,N,Y,0,d,K,Q,tt)}(e,p,l,r,n,o,L,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,_,[x,x,x,x],T,c,A,b,C,f,i,s,u,h,a)};if("line"===M)for(const t of Au(i.geometry,0,0,ts,ts)){const i=Cu(t,v,S,r.vertical||m,n,24,y,e.overscaling,ts);for(const r of i)m&&Ku(e,m.text,E,r)||P(t,r)}else if("line-center"===M){for(const t of i.geometry)if(t.length>1){const e=Tu(t,S,r.vertical||m,n,24,y);e&&P(t,e)}}else if("Polygon"===i.type)for(const t of Ca(i.geometry,0)){const e=Fu(t,16);P(t[0],new vu(e.x,e.y,0))}else if("LineString"===i.type)for(const t of i.geometry)P(t,new vu(t[0].x,t[0].y,0));else if("Point"===i.type)for(const t of i.geometry)for(const e of t)P([e],new vu(e.x,e.y,0))}function Hu(t,e,i,r,n,s,a,l,c,u,h,p,d,f,m){const g=function(t,e,i,r,n,s,a,l){const c=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const t of e.positionedLines)for(const r of t.positionedGlyphs){if(!r.rect)continue;const s=r.rect||{};let h=rc+1,p=!0,d=1,f=0;const m=(n||l)&&r.vertical,g=r.metrics.advance*r.scale/2;if(l&&e.verticalizable&&(f=t.lineOffset/2-(r.imageName?-(Il-r.metrics.width*r.scale)/2:(r.scale-1)*Il)),r.imageName){const t=a[r.imageName];p=t.sdf,d=t.pixelRatio,h=oc/d}const _=n?[r.x+g,r.y]:[0,0];let y=n?[0,0]:[r.x+g+i[0],r.y+i[1]-f],A=[0,0];m&&(A=y,y=[0,0]);const v=r.metrics.isDoubleResolution?2:1,x=(r.metrics.left-h)*r.scale-g+y[0],b=(-r.metrics.top-h)*r.scale+y[1],w=x+s.w/v*r.scale/d,S=b+s.h/v*r.scale/d,T=new o(x,b),C=new o(w,b),M=new o(x,S),E=new o(w,S);if(m){const t=new o(-g,g-cc),e=-Math.PI/2,i=Il/2-g,n=new o(5-cc-i,-(r.imageName?i:0)),s=new o(...A);T._rotateAround(e,t)._add(n)._add(s),C._rotateAround(e,t)._add(n)._add(s),M._rotateAround(e,t)._add(n)._add(s),E._rotateAround(e,t)._add(n)._add(s)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];T._matMult(i),C._matMult(i),M._matMult(i),E._matMult(i)}const I=new o(0,0),L=new o(0,0);u.push({tl:T,tr:C,bl:M,br:E,tex:s,writingMode:e.writingMode,glyphOffset:_,sectionIndex:r.sectionIndex,isSDF:p,pixelOffsetTL:I,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,l,n,s,a,r,t.allowVerticalPlacement),_=t.textSizeData;let y=null;"source"===_.kind?(y=[Cc*n.layout.get("text-size").evaluate(a,{})],y[0]>Mc&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${Tc}. Reduce your "text-size".`)):"composite"===_.kind&&(y=[Cc*f.compositeTextSizes[0].evaluate(a,{},m),Cc*f.compositeTextSizes[1].evaluate(a,{},m)],(y[0]>Mc||y[1]>Mc)&&w(`${t.layerIds[0]}: Value for "text-size" is >= ${Tc}. Reduce your "text-size".`)),t.addSymbols(t.text,g,y,l,s,a,u,e,c.lineStartIndex,c.lineLength,d,m);for(const e of h)p[e]=t.text.placedSymbolArray.length-1;return 4*g.length}function Ju(t){for(const e in t)return t[e];return null}function Ku(t,e,i,r){const n=t.compareText;if(e in n){const t=n[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<i)return!0}else n[e]=[];return n[e].push(r),!1}const $u=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yu{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=$u[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new Yu(s,o,n,t)}constructor(t,e=64,i=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const n=$u.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Xu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=r&&l.push(n[s])}continue}const p=h+u>>1,d=o[2*p],f=o[2*p+1];d>=t&&d<=i&&f>=e&&f<=r&&l.push(n[p]),(0===c?t<=d:e<=f)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?i>=d:r>=f)&&(a.push(p+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)ih(n[2*i],n[2*i+1],t,e)<=l&&a.push(r[i]);continue}const p=h+u>>1,d=n[2*p],f=n[2*p+1];ih(d,f,t,e)<=l&&a.push(r[p]),(0===c?t-i<=d:e-i<=f)&&(s.push(h),s.push(p-1),s.push(1-c)),(0===c?t+i>=d:e+i>=f)&&(s.push(p+1),s.push(u),s.push(1-c))}return a}}function Xu(t,e,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;Qu(t,e,s,r,n,o),Xu(t,e,i,r,s-1,1-o),Xu(t,e,i,s+1,n,1-o)}function Qu(t,e,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);Qu(t,e,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=r,l=n;for(th(t,e,r,i),e[2*n+o]>s&&th(t,e,r,n);a<l;){for(th(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*r+o]===s?th(t,e,r,l):(l++,th(t,e,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function th(t,e,i,r){eh(t,i,r),eh(e,2*i,2*r),eh(e,2*i+1,2*r+1)}function eh(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function ih(t,e,i,r){const n=t-i,o=e-r;return n*n+o*o}var rh;t.bh=void 0,(rh=t.bh||(t.bh={})).create="create",rh.load="load",rh.fullLoad="fullLoad";let nh=null,oh=[];const sh=1e3/60,ah="loadTime",lh="fullLoadTime",ch={mark(t){performance.mark(t)},frame(t){const e=t;null!=nh&&oh.push(e-nh),nh=e},clearMetrics(){nh=null,oh=[],performance.clearMeasures(ah),performance.clearMeasures(lh);for(const e in t.bh)performance.clearMarks(t.bh[e])},getPerformanceMetrics(){performance.measure(ah,t.bh.create,t.bh.load),performance.measure(lh,t.bh.create,t.bh.fullLoad);const e=performance.getEntriesByName(ah)[0].duration,i=performance.getEntriesByName(lh)[0].duration,r=oh.length,n=1/(oh.reduce(((t,e)=>t+e),0)/r/1e3),o=oh.filter((t=>t>sh)).reduce(((t,e)=>t+(e-sh)/sh),0);return{loadTime:e,fullLoadTime:i,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};t.$=function(t,e,i){var r,n,o,s,a,l,c,u,h,p,d,f,m=i[0],g=i[1],_=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=r=e[0],t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=r*m+a*g+h*_+e[12],t[13]=n*m+l*g+p*_+e[13],t[14]=o*m+c*g+d*_+e[14],t[15]=s*m+u*g+f*_+e[15]),t},t.A=Ts,t.B=qe,t.C=class{constructor(t,e,i){this.receive=t=>{const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[i];const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t()}else C()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)},this.process=()=>{if(!this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)},this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new $c(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=C()?t:window}send(t,e,i,r,n=!1){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[o]=i);const s=[],a={id:o,type:t,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Fr(e,s)};return this.target.postMessage(a,{transfer:s}),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(zr(e.error)):i(null,zr(e.data)))}else{let i=!1;const r=[],n=e.hasCallback?(e,n)=>{i=!0,delete this.cancelCallbacks[t];const o={id:t,type:"<response>",sourceMapId:this.mapId,error:e?Fr(e):null,data:Fr(n,r)};this.target.postMessage(o,{transfer:r})}:t=>{i=!0};let o=null;const s=zr(e.data);if(this.parent[e.type])o=this.parent[e.type](e.sourceMapId,s,n);else if("getWorkerSource"in this.parent){const t=e.type.split(".");o=this.parent.getWorkerSource(e.sourceMapId,t[0],s.source)[t[1]](s,n)}else n(new Error(`Could not find function ${e.type}`));!i&&o&&o.cancel&&(this.cancelCallbacks[t]=o.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.D=_n,t.E=J,t.F=function(t,e){const i={};for(let r=0;r<e.length;r++){const n=e[r];n in t&&(i[n]=t[n])}return i},t.G=eu,t.H=iu,t.I=sc,t.J=h,t.K=p,t.L=Xc,t.M=L,t.N=ts,t.O=uu,t.P=o,t.Q=En,t.R=Us,t.S=Eo,t.T=hn,t.U=su,t.V=class extends kn{},t.W=lu,t.X=function(t,e){const i=window.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){const r=window.document.createElement("source");G(t[e])||(i.crossOrigin="Anonymous"),r.src=t[e],i.appendChild(r)}return{cancel:()=>{}}},t.Y=at,t.Z=function(){var t=new Ts(16);return Ts!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t._=e,t.a=E,t.a$=class extends Yn{},t.a0=function(t,e,i){var r=i[0],n=i[1],o=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.a1=Ms,t.a2=function(){return y++},t.a3=to,t.a4=Fc,t.a5=function(){an.isLoading()||an.isLoaded()||"deferred"!==on()||sn()},t.a6=Zi,t.a7=ns,t.a8=ln,t.a9=fu,t.aA=en,t.aB=function(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Y(t[i],e[t[i].ref]));return t},t.aC=function(t){if("custom"===t.type)return new Kc(t);switch(t.type){case"background":return new qc(t);case"circle":return new Ps(t);case"fill":return new Da(t);case"fill-extrusion":return new nl(t);case"heatmap":return new js(t);case"hillshade":return new qs(t);case"line":return new vl(t);case"raster":return new Jc(t);case"symbol":return new jc(t)}},t.aD=x,t.aE=function(t,e){if(!t)return[{command:Q.setStyle,args:[e]}];let i=[];try{if(!X(t.version,e.version))return[{command:Q.setStyle,args:[e]}];X(t.center,e.center)||i.push({command:Q.setCenter,args:[e.center]}),X(t.zoom,e.zoom)||i.push({command:Q.setZoom,args:[e.zoom]}),X(t.bearing,e.bearing)||i.push({command:Q.setBearing,args:[e.bearing]}),X(t.pitch,e.pitch)||i.push({command:Q.setPitch,args:[e.pitch]}),X(t.sprite,e.sprite)||i.push({command:Q.setSprite,args:[e.sprite]}),X(t.glyphs,e.glyphs)||i.push({command:Q.setGlyphs,args:[e.glyphs]}),X(t.transition,e.transition)||i.push({command:Q.setTransition,args:[e.transition]}),X(t.light,e.light)||i.push({command:Q.setLight,args:[e.light]});const r={},n=[];!function(t,e,i,r){let n;for(n in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)||et(n,i,r));for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)?X(t[n],e[n])||("geojson"===t[n].type&&"geojson"===e[n].type&&rt(t,e,n)?i.push({command:Q.setGeoJSONSourceData,args:[n,e[n].data]}):it(n,e,i,r)):tt(n,e,i))}(t.sources,e.sources,n,r);const o=[];t.layers&&t.layers.forEach((t=>{r[t.source]?i.push({command:Q.removeLayer,args:[t.id]}):o.push(t)})),i=i.concat(n),function(t,e,i){e=e||[];const r=(t=t||[]).map(ot),n=e.map(ot),o=t.reduce(st,{}),s=e.reduce(st,{}),a=r.slice(),l=Object.create(null);let c,u,h,p,d,f,m;for(c=0,u=0;c<r.length;c++)h=r[c],Object.prototype.hasOwnProperty.call(s,h)?u++:(i.push({command:Q.removeLayer,args:[h]}),a.splice(a.indexOf(h,u),1));for(c=0,u=0;c<n.length;c++)h=n[n.length-1-c],a[a.length-1-c]!==h&&(Object.prototype.hasOwnProperty.call(o,h)?(i.push({command:Q.removeLayer,args:[h]}),a.splice(a.lastIndexOf(h,a.length-u),1)):u++,f=a[a.length-c],i.push({command:Q.addLayer,args:[s[h],f]}),a.splice(a.length-c,0,h),l[h]=!0);for(c=0;c<n.length;c++)if(h=n[c],p=o[h],d=s[h],!l[h]&&!X(p,d))if(X(p.source,d.source)&&X(p["source-layer"],d["source-layer"])&&X(p.type,d.type)){for(m in nt(p.layout,d.layout,i,h,null,Q.setLayoutProperty),nt(p.paint,d.paint,i,h,null,Q.setPaintProperty),X(p.filter,d.filter)||i.push({command:Q.setFilter,args:[h,d.filter]}),X(p.minzoom,d.minzoom)&&X(p.maxzoom,d.maxzoom)||i.push({command:Q.setLayerZoomRange,args:[h,d.minzoom,d.maxzoom]}),p)Object.prototype.hasOwnProperty.call(p,m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?nt(p[m],d[m],i,h,m.slice(6),Q.setPaintProperty):X(p[m],d[m])||i.push({command:Q.setLayerProperty,args:[h,m,d[m]]}));for(m in d)Object.prototype.hasOwnProperty.call(d,m)&&!Object.prototype.hasOwnProperty.call(p,m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&(0===m.indexOf("paint.")?nt(p[m],d[m],i,h,m.slice(6),Q.setPaintProperty):X(p[m],d[m])||i.push({command:Q.setLayerProperty,args:[h,m,d[m]]}))}else i.push({command:Q.removeLayer,args:[h]}),f=a[a.lastIndexOf(h)+1],i.push({command:Q.addLayer,args:[d,f]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Q.setStyle,args:[e]}]}return i},t.aF=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.aG=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i},t.aH=A,t.aI=v,t.aJ=nn,t.aK=function(t){return t({pluginStatus:Qr,pluginURL:tn}),nn.on("pluginStateChange",t),t},t.aL=class extends Bo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.aM=Uo,t.aN=class extends Bo{constructor(t,e){super(t,e),this.current=Go}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.aO=Vo,t.aP=class extends Bo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.aQ=class extends Bo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.aR=jo,t.aS=function(t,e,i,r,n,o,s){var a=1/(e-i),l=1/(r-n),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(s+o)*c,t[15]=1,t},t.aT=$t,t.aU=Is,t.aV=class extends jn{},t.aW=Cl,t.aX=class extends Zn{},t.aY=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.aZ=Vs,t.a_=ho,t.aa=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,r,n)=>{const o=r||n;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ab=function(t,e){const i=[];for(const r in t)r in e||i.push(r);return i},t.ac=function(t){if(null==M){const e=t.navigator?t.navigator.userAgent:null;M=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return M},t.ad=m,t.ae=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+c*r,t[1]=s*n+u*r,t[2]=a*n+h*r,t[3]=l*n+p*r,t[4]=c*n-o*r,t[5]=u*n-s*r,t[6]=h*n-a*r,t[7]=p*n-l*r,t},t.af=function(t){var e=new Ts(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.ag=Ls,t.ah=function(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=t,a=n?m(We.interpolationFactor(n,e,o,s),0,1):0;"camera"===t.kind?r=qe.number(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:r}},t.aj=function(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===t.kind?r/Cc:"composite"===t.kind?qe.number(r/Cc,n/Cc,i):e},t.ak=Nc,t.al=function(t,e,i,r){const n=e.y-t.y,s=e.x-t.x,a=r.y-i.y,l=r.x-i.x,c=a*s-l*n;if(0===c)return null;const u=(l*(t.y-i.y)-a*(t.x-i.x))/c;return new o(t.x+u*s,t.y+u*n)},t.am=Au,t.an=as,t.ao=Cs,t.ap=Il,t.ar=Ic,t.as=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=i*a-r*s,A=i*l-n*s,v=i*c-o*s,x=r*l-n*a,b=r*c-o*a,w=n*c-o*l,S=u*m-h*f,T=u*g-p*f,C=u*_-d*f,M=h*g-p*m,E=h*_-d*m,I=p*_-d*g,L=y*I-A*E+v*M+x*C-b*T+w*S;return L?(t[0]=(a*I-l*E+c*M)*(L=1/L),t[1]=(n*E-r*I-o*M)*L,t[2]=(m*w-g*b+_*x)*L,t[3]=(p*b-h*w-d*x)*L,t[4]=(l*C-s*I-c*T)*L,t[5]=(i*I-n*C+o*T)*L,t[6]=(g*v-f*w-_*A)*L,t[7]=(u*w-p*v+d*A)*L,t[8]=(s*E-a*C+c*S)*L,t[9]=(r*C-i*E-o*S)*L,t[10]=(f*b-m*v+_*y)*L,t[11]=(h*v-u*b-d*y)*L,t[12]=(a*T-s*M-l*S)*L,t[13]=(i*M-r*T+n*S)*L,t[14]=(m*A-f*x-g*y)*L,t[15]=(u*x-h*A+p*y)*L,t):null},t.at=qu,t.au=xc,t.av=Yu,t.aw=function(){const t={},e=K.$version;for(const i in K.$root){const r=K.$root[i];if(r.required){let n=null;n="version"===i?e:"array"===r.type?[]:{},null!=n&&(t[i]=n)}}return t},t.ax=Q,t.ay=Br,t.az=z,t.b=function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))},t.b0=So,t.b1=function(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=e[0],A=e[1],v=e[2],x=e[3],b=e[4],w=e[5],S=e[6],T=e[7],C=e[8],M=e[9],E=e[10],I=e[11],L=e[12],P=e[13],k=e[14],N=e[15];return Math.abs(i-y)<=Ss*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-A)<=Ss*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(n-v)<=Ss*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=Ss*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=Ss*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=Ss*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-S)<=Ss*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=Ss*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-C)<=Ss*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-M)<=Ss*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-E)<=Ss*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-I)<=Ss*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(f-L)<=Ss*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(m-P)<=Ss*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-k)<=Ss*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(_-N)<=Ss*Math.max(1,Math.abs(_),Math.abs(N))},t.b2=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.b3=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.b4=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.b5=g,t.b6=cu,t.b7=ru,t.b8=function(t,e,i,r,n){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(t[10]=(n+r)*(o=1/(r-n)),t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t},t.b9=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+c*r,t[5]=s*n+u*r,t[6]=a*n+h*r,t[7]=l*n+p*r,t[8]=c*n-o*r,t[9]=u*n-s*r,t[10]=h*n-a*r,t[11]=p*n-l*r,t},t.bA=r,t.bB=Ll,t.bC=Ri,t.bD=an,t.ba=d,t.bb=f,t.bc=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.bd=class extends Pn{},t.be=Yc,t.bf=nu,t.bg=ch,t.bi=F,t.bj=function(t,e,i=!1){if(Qr===Kr||Qr===$r||Qr===Yr)throw new Error("setRTLTextPlugin cannot be called multiple times.");tn=O.resolveURL(t),Qr=Kr,Xr=e,rn(),i||sn()},t.bk=on,t.bl=function(t,e){const i={};for(let r=0;r<t.length;r++){const n=e&&e[t[r].id]||Qi(t[r]);e&&(e[t[r].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(t[r])}const r=[];for(const t in i)r.push(i[t]);return r},t.bm=Or,t.bn=du,t.bo=mu,t.bp=ac,t.bq=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=ts/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const i=e.bucket.layers[0],r=i.layout,n=i._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new ln(e.bucket.zoom+1),e.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new ln(e.bucket.zoom+1),e.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new ln(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new ln(t),e.canonical),n["text-size"].possiblyEvaluate(new ln(i),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new ln(t),e.canonical),n["icon-size"].possiblyEvaluate(new ln(i),e.canonical)]}const s=r.get("text-line-height")*Il,a="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const n of e.bucket.features){const u=r.get("text-font").evaluate(n,{},e.canonical).join(","),h=c.evaluate(n,{},e.canonical),p=o.layoutTextSize.evaluate(n,{},e.canonical),d=o.layoutIconSize.evaluate(n,{},e.canonical),f={horizontal:{},vertical:void 0},m=n.text;let g,_=[0,0];if(m){const o=m.toString(),c=r.get("text-letter-spacing").evaluate(n,{},e.canonical)*Il,d=jr(o)?c:0,g=r.get("text-anchor").evaluate(n,{},e.canonical),y=Zu(i,n,e.canonical);if(!y){const t=r.get("text-radial-offset").evaluate(n,{},e.canonical);_=t?Gu(g,[t*Il,ju]):r.get("text-offset").evaluate(n,{},e.canonical).map((t=>t*Il))}let A=a?"center":r.get("text-justify").evaluate(n,{},e.canonical);const v=r.get("symbol-placement"),x="point"===v?r.get("text-max-width").evaluate(n,{},e.canonical)*Il:0,b=()=>{e.bucket.allowVerticalPlacement&&Vr(o)&&(f.vertical=pc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,"left",d,_,t.ai.vertical,!0,v,p,h))};if(!a&&y){const i=new Set;if("auto"===A)for(let t=0;t<y.values.length;t+=2)i.add(qu(y.values[t]));else i.add(A);let r=!1;for(const n of i)if(!f.horizontal[n])if(r)f.horizontal[n]=f.horizontal[0];else{const i=pc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,"center",n,d,_,t.ai.horizontal,!1,v,p,h);i&&(f.horizontal[n]=i,r=1===i.positionedLines.length)}b()}else{"auto"===A&&(A=qu(g));const i=pc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,A,d,_,t.ai.horizontal,!1,v,p,h);i&&(f.horizontal[A]=i),b(),Vr(o)&&a&&l&&(f.vertical=pc(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,A,d,_,t.ai.vertical,!1,v,p,h))}}let y=!1;if(n.icon&&n.icon.name){const t=e.imageMap[n.icon.name];t&&(g=wc(e.imagePositions[n.icon.name],r.get("icon-offset").evaluate(n,{},e.canonical),r.get("icon-anchor").evaluate(n,{},e.canonical)),y=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=y:e.bucket.sdfIcons!==y&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const A=Ju(f.horizontal)||f.vertical;e.bucket.iconsInText=!!A&&A.iconsInText,(A||g)&&Wu(e.bucket,n,f,g,e.imageMap,o,p,d,_,y,e.canonical)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.br=fl,t.bs=La,t.bt=Qa,t.bu=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.bv=Xl,t.bw=za,t.bx=function(t,i,r,n,o){return e(this,void 0,void 0,(function*(){if(p())try{return yield L(t,i,r,n,o)}catch(t){}return function(t,e,i,r,n){const o=t.width,s=t.height;P&&k||(P=new OffscreenCanvas(o,s),k=P.getContext("2d",{willReadFrequently:!0})),P.width=o,P.height=s,k.drawImage(t,0,0,o,s);const a=k.getImageData(e,i,r,n);return k.clearRect(0,0,o,s),a.data}(t,i,r,n,o)}))},t.by=pu,t.bz=i,t.c=R,t.d=function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame((()=>{i.src=I}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(r):I},t.e=_,t.f=function(t,e){return V(_(t,{type:"json"}),e)},t.g=B,t.h=O,t.i=C,t.j=H,t.k=W,t.l=j,t.m=V,t.n=function(t){return new Xl(t).readFields(tc,[])},t.o=function(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const n=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),n[s]=e,0==--r&&i(o,n)}))}))},t.p=nc,t.q=Bs,t.r=bn,t.s=G,t.t=Ir,t.u=Ur,t.v=K,t.w=w,t.x=kr,t.y=Er,t.z=function([t,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(i)}}})),r(0,(function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.aC(i);e._featureFilter=t.a6(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=t.bl(Object.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(e)}}}class i{constructor(e){const i={},r=[];for(const t in e){const n=e[t],o=i[t]={};for(const t in n){const e=n[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};r.push(i),o[t]={rect:i,metrics:e.metrics}}}const{w:n,h:o}=t.p(r),s=new t.q({width:n||1,height:o||1});for(const r in e){const n=e[r];for(const e in n){const o=n[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[r][e].rect;t.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}t.bm("GlyphAtlas",i);class r{constructor(e){this.tileID=new t.O(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(e,r,o,s,a){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a3;const l=new t.bn(Object.keys(e.layers).sort()),c=new t.bo(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o},p=r.familiesBySource[this.source];for(const i in p){const r=e.layers[i];if(!r)continue;1===r.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(i),a=[];for(let t=0;t<r.length;t++){const e=r.feature(t),n=c.getId(e,i);a.push({feature:e,id:n,index:t,sourceLayerIndex:s})}for(const e of p[i]){const i=e[0];i.source!==this.source&&t.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(n(e,this.zoom,o),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(e.map((t=>t.id))))}}let d,f,m,g;const _=t.aH(h.glyphDependencies,(t=>Object.keys(t).map(Number)));this.inFlightDependencies.forEach((t=>null==t?void 0:t.cancel())),this.inFlightDependencies=[];const y=++this.dependencySentinel;Object.keys(_).length?this.inFlightDependencies.push(s.send("getGlyphs",{uid:this.uid,stacks:_,source:this.source,tileID:this.tileID,type:"glyphs"},((t,e)=>{y===this.dependencySentinel&&(d||(d=t,f=e,x.call(this)))}))):f={};const A=Object.keys(h.iconDependencies);A.length?this.inFlightDependencies.push(s.send("getImages",{icons:A,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{y===this.dependencySentinel&&(d||(d=t,m=e,x.call(this)))}))):m={};const v=Object.keys(h.patternDependencies);function x(){if(d)return a(d);if(f&&m&&g){const e=new i(f),r=new t.bp(m,g);for(const i in u){const s=u[i];s instanceof t.a4?(n(s.layers,this.zoom,o),t.bq({bucket:s,glyphMap:f,glyphPositions:e.positions,imageMap:m,imagePositions:r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):s.hasPattern&&(s instanceof t.br||s instanceof t.bs||s instanceof t.bt)&&(n(s.layers,this.zoom,o),s.addFeatures(h,this.tileID.canonical,r.patternPositions))}this.status="done",a(null,{buckets:Object.values(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?m:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?this.inFlightDependencies.push(s.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{y===this.dependencySentinel&&(d||(d=t,g=e,x.call(this)))}))):g={},x.call(this)}}function n(e,i,r){const n=new t.a8(i);for(const t of e)t.recalculate(n,r)}function o(e,i){const r=t.l(e.request,((r,n,o,s)=>{if(r)i(r);else if(n)try{const e=new t.bw.VectorTile(new t.bv(n));i(null,{vectorTile:e,rawData:n,cacheControl:o,expires:s})}catch(t){const r=new Uint8Array(n);let o=`Unable to parse the tile at ${e.request.url}, `;o+=31===r[0]&&139===r[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${t.messge}`,i(new Error(o))}}));return()=>{r.cancel(),i()}}class s{constructor(t,e,i,r){this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||o,this.fetching={},this.loading={},this.loaded={}}loadTile(e,i){const n=e.uid;this.loading||(this.loading={});const o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request),s=this.loading[n]=new r(e);s.abort=this.loadVectorData(e,((e,r)=>{if(delete this.loading[n],e||!r)return s.status="done",this.loaded[n]=s,i(e);const a=r.rawData,l={};r.expires&&(l.expires=r.expires),r.cacheControl&&(l.cacheControl=r.cacheControl);const c={};if(o){const t=o.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}s.vectorTile=r.vectorTile,s.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(delete this.fetching[n],e||!r)return i(e);i(null,t.e({rawTileData:a.slice(0)},r,l,c))})),this.loaded=this.loaded||{},this.loaded[n]=s,this.fetching[n]={rawTileData:a,cacheControl:l,resourceTiming:c}}))}reloadTile(e,i){const r=this.loaded,n=e.uid;if(r&&r[n]){const o=r[n];o.showCollisionBoxes=e.showCollisionBoxes,"parsing"===o.status?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,r)=>{if(e||!r)return i(e,r);let o;if(this.fetching[n]){const{rawTileData:e,cacheControl:i,resourceTiming:s}=this.fetching[n];delete this.fetching[n],o=t.e({rawTileData:e.slice(0)},r,i,s)}else o=r;i(null,o)})):"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,i):i())}}abortTile(t,e){const i=this.loading,r=t.uid;i&&i[r]&&i[r].abort&&(i[r].abort(),delete i[r]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}}class a{constructor(){this.loaded={}}loadTile(e,i){return t._(this,void 0,void 0,(function*(){const{uid:r,encoding:n,rawImageData:o,redFactor:s,greenFactor:a,blueFactor:l,baseShift:c}=e,u=o.width+2,h=o.height+2,p=t.a(o)?new t.R({width:u,height:h},yield t.bx(o,-1,-1,u,h)):o,d=new t.by(r,p,n,s,a,l,c);this.loaded=this.loaded||{},this.loaded[r]=d,i(null,d)}))}removeTile(t){const e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]}}function l(t,e){if(0!==t.length){c(t[0],e);for(var i=1;i<t.length;i++)c(t[i],!e)}}function c(t,e){for(var i=0,r=0,n=0,o=t.length,s=o-1;n<o;s=n++){var a=(t[n][0]-t[s][0])*(t[s][1]+t[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!e&&t.reverse()}var u=t.bz((function t(e,i){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)t(e.features[r],i);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],i);else if("Feature"===n)t(e.geometry,i);else if("Polygon"===n)l(e.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)l(e.coordinates[r],i);return e}));const h=t.bw.VectorTileFeature.prototype.toGeoJSON;var p={exports:{}},d=t.bA,f=t.bw.VectorTileFeature,m=g;function g(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}g.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],r=[],n=0;n<i.length;n++)r.push(new d(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[e,r,i,n]},_.prototype.toGeoJSON=f.prototype.toGeoJSON;var y=t.bB,A=m;function v(t){var e=new y;return function(t,e){for(var i in t.layers)e.writeMessage(3,x,t.layers[i])}(t,e),e.finish()}function x(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)r.feature=t.feature(i),e.writeMessage(2,b,r);var n=r.keys;for(i=0;i<n.length;i++)e.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)e.writeMessage(4,M,o[i])}function b(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,w,t),e.writeVarintField(3,i.type),e.writeMessage(4,C,i)}function w(t,e){var i=t.feature,r=t.keys,n=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,p=s[h];void 0===p&&(n.push(l),s[h]=p=n.length-1),e.writeVarint(p)}}}function S(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function C(t,e){for(var i=t.loadGeometry(),r=t.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),e.writeVarint(S(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(S(2,u-1));var p=l[h].x-n,d=l[h].y-o;e.writeVarint(T(p)),e.writeVarint(T(d)),n+=p,o+=d}3===r&&e.writeVarint(S(7,1))}}function M(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}p.exports=v,p.exports.fromVectorTileJs=v,p.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var r in t)i[r]=new A(t[r].features,e),i[r].name=r,i[r].version=e.version,i[r].extent=e.extent;return v({layers:i})},p.exports.GeoJSONWrapper=A;var E=t.bz(p.exports);const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},L=Math.fround||(P=new Float32Array(1),t=>(P[0]=+t,P[0]));var P;const k=3,N=5,D=6;class O{constructor(t){this.options=Object.assign(Object.create(I),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:r}=this.options;e&&console.time("total time");const n=`prepare ${t.length} points`;e&&console.time(n),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=L(z(r)),a=L(B(n));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);e&&console.timeEnd(n);for(let t=r;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let n=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,n=180;else if(i>n){const t=this.getClusters([i,r,180,o],e),s=this.getClusters([-180,r,n,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(z(i),B(o),z(n),B(r)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+N]>1?R(l,e,this.clusterProps):this.points[l[e+k]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(e*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+N]>1?R(o,i,this.clusterProps):this.points[o[i+k]])}if(0===l.length)throw new Error(r);return l}getLeaves(t,e,i){const r=[];return this._appendLeaves(r,t,e=e||10,i=i||0,0),r}getTile(t,e,i){const r=this.trees[this._limitZoom(t)],n=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((e-a)/n,l,(e+1+a)/n,c),r.data,e,i,n,u),0===e&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),e===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,r,n){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(t,o.cluster_id,i,r,n):n<r?n++:t.push(e),t.length===i)break}return n}_createTree(e){const i=new t.av(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,r,n,o){for(const s of t){const t=s*this.stride,a=e[t+N]>1;let l,c,u;if(a)l=F(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+k]];l=i.properties;const[r,n]=i.geometry.coordinates;c=z(r),u=B(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let p;p=a||this.options.generateId?e[t+k]:this.points[e[t+k]].id,void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const r=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),p=a[i+N];let d=p;for(const t of h){const i=t*c;a[i+2]>e&&(d+=a[i+N])}if(d>p&&d>=o){let t,o=r*p,s=u*p,f=-1;const m=(i/c<<5)+(e+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+N];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,n&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),n(t,this._map(a,l)))}a[i+4]=m,l.push(o/d,s/d,1/0,m,-1,d),n&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(d>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+N]>1){const r=this.clusterProps[t[e+D]];return i?Object.assign({},r):r}const r=this.points[t[e+k]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function R(t,e,i){return{type:"Feature",id:t[e+k],properties:F(t,e,i),geometry:{type:"Point",coordinates:[(r=t[e],360*(r-.5)),U(t[e+1])]}};var r}function F(t,e,i){const r=t[e+N],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=t[e+D],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+k],point_count:r,point_count_abbreviated:n})}function z(t){return t/360+.5}function B(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function U(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function V(t,e,i,r){for(var n,o=r,s=i-e>>1,a=i-e,l=t[e],c=t[e+1],u=t[i],h=t[i+1],p=e+3;p<i;p+=3){var d=j(t[p],t[p+1],l,c,u,h);if(d>o)n=p,o=d;else if(d===o){var f=Math.abs(p-s);f<a&&(n=p,a=f)}}o>r&&(n-e>3&&V(t,e,n,r),t[n+2]=o,i-n>3&&V(t,n,i,r))}function j(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=t-i)*s+(a=e-r)*a}function G(t,e,i,r){var n={id:void 0===t?null:t,type:e,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Z(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<e.length;r++)Z(t,e[r]);else if("MultiPolygon"===i)for(r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)Z(t,e[r][n])}(n),n}function Z(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function q(t,e,i,r){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)W(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)W(n[c],a);else if("LineString"===o)H(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)H(n[c],a=[],s,!1),t.push(G(l,"LineString",a,e.properties));return}J(n,a,s,!1)}else if("Polygon"===o)J(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)q(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];J(n[c],u,s,!0),a.push(u)}}t.push(G(l,o,a,e.properties))}}function W(t,e){e.push(K(t[0])),e.push($(t[1])),e.push(0)}function H(t,e,i,r){for(var n,o,s=0,a=0;a<t.length;a++){var l=K(t[a][0]),c=$(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=e.length-3;e[2]=1,V(e,0,u,i),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function J(t,e,i,r){for(var n=0;n<t.length;n++){var o=[];H(t[n],o,i,r),e.push(o)}}function K(t){return t/360+.5}function $(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Y(t,e,i,r,n,o,s,a){if(r/=e,o>=(i/=e)&&s<r)return t;if(s<i||o>=r)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,p=u.type,d=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(d>=i&&f<r)l.push(u);else if(!(f<i||d>=r)){var m=[];if("Point"===p||"MultiPoint"===p)X(h,m,i,r,n);else if("LineString"===p)Q(h,m,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===p)et(h,m,i,r,n,!1);else if("Polygon"===p)et(h,m,i,r,n,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var _=[];et(h[g],_,i,r,n,!0),_.length&&m.push(_)}if(m.length){if(a.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(G(u.id,p,m[g],u.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(G(u.id,p,m,u.tags))}}}return l.length?l:null}function X(t,e,i,r,n){for(var o=0;o<t.length;o+=3){var s=t[o+n];s>=i&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function Q(t,e,i,r,n,o,s){for(var a,l,c=tt(t),u=0===n?rt:nt,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],_=t[p+4],y=0===n?d:f,A=0===n?g:_,v=!1;s&&(a=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-_,2))),y<i?A>i&&(l=u(c,d,f,g,_,i),s&&(c.start=h+a*l)):y>r?A<r&&(l=u(c,d,f,g,_,r),s&&(c.start=h+a*l)):it(c,d,f,m),A<i&&y>=i&&(l=u(c,d,f,g,_,i),v=!0),A>r&&y<=r&&(l=u(c,d,f,g,_,r),v=!0),!o&&v&&(s&&(c.end=h+a*l),e.push(c),c=tt(t)),s&&(h+=a)}var x=t.length-3;d=t[x],f=t[x+1],m=t[x+2],(y=0===n?d:f)>=i&&y<=r&&it(c,d,f,m),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&it(c,c[0],c[1],c[2]),c.length&&e.push(c)}function tt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function et(t,e,i,r,n,o){for(var s=0;s<t.length;s++)Q(t[s],e,i,r,n,o,!1)}function it(t,e,i,r){t.push(e),t.push(i),t.push(r)}function rt(t,e,i,r,n,o){var s=(o-e)/(r-e);return t.push(o),t.push(i+(n-i)*s),t.push(1),s}function nt(t,e,i,r,n,o){var s=(o-i)/(n-i);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function ot(t,e){for(var i=[],r=0;r<t.length;r++){var n,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=st(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(st(o.geometry[a],e))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(st(o.geometry[a][c],e));n.push(l)}i.push(G(o.id,s,n,o.tags))}return i}function st(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var r=0;r<t.length;r+=3)i.push(t[r]+e,t[r+1],t[r+2]);return i}function at(t,e){if(t.transformed)return t;var i,r,n,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(lt(c[r],c[r+1],e,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(lt(c[r][n],c[r][n+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function lt(t,e,i,r,n,o){return[Math.round(i*(t*r-n)),Math.round(i*(e*r-o))]}function ct(t,e,i,r,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,ut(s,t[a],o,n);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ut(t,e,i,r){var n=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)ht(s,n,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)ht(s,n[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)ht(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(p.id=e.id),t.features.push(p)}}function ht(t,e,i,r,n,o){var s=r*r;if(r>0&&e.size<(n?s:r))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===r||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;n&&function(t,e){for(var i=0,r=0,n=t.length,o=n-2;r<n;o=r,r+=2)i+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(i>0===e)for(r=0,n=t.length;r<n/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[n-2-r],t[r+1]=t[n-1-r],t[n-2-r]=s,t[n-1-r]=a}}(a,o),t.push(a)}}function pt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)q(i,t.features[r],e,r);else q(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,e){var i=e.buffer/e.extent,r=t,n=Y(t,1,-1-i,i,0,-1,2,e),o=Y(t,1,1-i,2+i,0,-1,2,e);return(n||o)&&(r=Y(t,1,-i,1+i,0,-1,2,e)||[],n&&(r=ot(n,1).concat(r)),o&&(r=r.concat(ot(o,-1)))),r}(r,e),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function dt(t,e,i){return 32*((1<<t)*i+e)+t}function ft(t,e){return e?t.properties[e]:t.id}function mt(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=ft(t,e);if("FeatureCollection"===t.type){const i=new Set;for(const r of t.features){const t=ft(r,e);if(null==t)return!1;if(i.has(t))return!1;i.add(t)}return!0}return!1}function gt(t,e){const i=new Map;if(null==t);else if("Feature"===t.type)i.set(ft(t,e),t);else for(const r of t.features)i.set(ft(r,e),r);return i}pt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pt.prototype.splitTile=function(t,e,i,r,n,o,s){for(var a=[t,e,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=dt(e,i,r),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=ct(t,e,i,r,l),this.tileCoords.push({z:e,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,n){if(e===l.maxZoom||e===n)continue;var f=1<<n-e;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,_,y,A,v,x=.5*l.buffer/l.extent,b=.5-x,w=.5+x,S=1+x;m=g=_=y=null,A=Y(t,u,i-x,i+w,0,p.minX,p.maxX,l),v=Y(t,u,i+b,i+S,0,p.minX,p.maxX,l),t=null,A&&(m=Y(A,u,r-x,r+w,1,p.minY,p.maxY,l),g=Y(A,u,r+b,r+S,1,p.minY,p.maxY,l),A=null),v&&(_=Y(v,u,r-x,r+w,1,p.minY,p.maxY,l),y=Y(v,u,r+b,r+S,1,p.minY,p.maxY,l),v=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*i,2*r),a.push(g||[],e+1,2*i,2*r+1),a.push(_||[],e+1,2*i+1,2*r),a.push(y||[],e+1,2*i+1,2*r+1)}}},pt.prototype.getTile=function(t,e,i){var r=this.options,n=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=dt(t,e=(e%s+s)%s,i);if(this.tiles[a])return at(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[dt(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?at(this.tiles[a],n):null):null};class _t extends s{constructor(e,i,r,n){super(e,i,r),this._dataUpdateable=new Map,this.loadGeoJSON=(e,i)=>{const{promoteId:r}=e;if(e.request)return t.f(e.request,((t,e,n,o)=>{this._dataUpdateable=mt(e,r)?gt(e,r):void 0,i(t,e,n,o)}));if("string"==typeof e.data)try{const t=JSON.parse(e.data);this._dataUpdateable=mt(t,r)?gt(t,r):void 0,i(null,t)}catch(t){i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}else e.dataDiff?this._dataUpdateable?(function(t,e,i){var r,n,o,s;if(e.removeAll&&t.clear(),e.remove)for(const i of e.remove)t.delete(i);if(e.add)for(const r of e.add){const e=ft(r,i);null!=e&&t.set(e,r)}if(e.update)for(const i of e.update){let e=t.get(i.id);if(null==e)continue;const a=!i.removeAllProperties&&((null===(r=i.removeProperties)||void 0===r?void 0:r.length)>0||(null===(n=i.addOrUpdateProperties)||void 0===n?void 0:n.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(e=Object.assign({},e),t.set(i.id,e),a&&(e.properties=Object.assign({},e.properties))),i.newGeometry&&(e.geometry=i.newGeometry),i.removeAllProperties)e.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const t of i.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:t,value:r}of i.addOrUpdateProperties)e.properties[t]=r}}(this._dataUpdateable,e.dataDiff,r),i(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):i(new Error(`Cannot update existing geojson data in ${e.source}`)):i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,n&&(this.loadGeoJSON=n)}loadGeoJSONTile(e,i){const r=e.tileID.canonical;if(!this._geoJSONIndex)return i(null,null);const n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return i(null,null);const o=new class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.N,this.length=e.length,this._features=e}feature(e){return new class{constructor(e){this._feature=e,this.extent=t.N,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const r=[];for(const e of i)r.push(new t.P(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,i){return h.call(this,t,e,i)}}(this._features[e])}}(n.features);let s=E(o);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),i(null,{vectorTile:o,rawData:s.buffer})}loadData(e,i){var r;null===(r=this._pendingRequest)||void 0===r||r.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.bu(e.request);this._pendingCallback=i,this._pendingRequest=this.loadGeoJSON(e,((r,o)=>{if(delete this._pendingCallback,delete this._pendingRequest,r||!o)return i(r);if("object"!=typeof o)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{u(o,!0);try{if(e.filter){const i=t.bC(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=o.features.filter((t=>i.value.evaluate({zoom:0},t)));o={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new O(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(i);for(const e of a){const[o,s]=i[e],a=t.bC(s),l=t.bC("string"==typeof o?[o,["accumulated"],["get",e]]:o);r[e]=a.value,n[e]=l.value}return e.map=t=>{s.properties=t;const e={};for(const t of a)e[t]=r[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=n[e].evaluate(o,s)},e}(e)).load(o.features):function(t,e){return new pt(t,e)}(o,e.geojsonVtOptions)}catch(r){return i(r)}this.loaded={};const s={};if(n){const t=n.finish();t&&(s.resourceTiming={},s.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}i(null,s)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}removeSource(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class yt{constructor(e){this.self=e,this.actor=new t.C(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:s,geojson:_t},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.bD.isParsed())throw new Error("RTL text plugin already registered.");t.bD.applyArabicShaping=e.applyArabicShaping,t.bD.processBidirectionalText=e.processBidirectionalText,t.bD.processStyledBidirectionalText=e.processStyledBidirectionalText}}setReferrer(t,e){this.referrer=e}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const r=this.workerSources[t][i];for(const t in r)r[t].availableImages=e}i()}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(t,e,i){this.getWorkerSource(t,e.type,e.source).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source).loadTile(e,i)}reloadTile(t,e,i){this.getWorkerSource(t,e.type,e.source).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeDEMTile(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,r){try{t.bD.setState(i);const e=t.bD.getPluginURL();if(t.bD.isLoaded()&&!t.bD.isParsed()&&null!=e){this.self.importScripts(e);const i=t.bD.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){r(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let i=this.layerIndexes[t];return i||(i=this.layerIndexes[t]=new e),i}getWorkerSource(t,e,i){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:(e,i,r)=>{this.actor.send(e,i,r,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][i]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new a),this.demWorkerSources[t][e]}}return t.i()&&(self.worker=new yt(self)),yt})),r(0,(function(t){var e="3.6.2";class i{static testProp(t){if(!i.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in i.docStyle)return t[e];return t[0]}static create(t,e,i){const r=window.document.createElement(t);return void 0!==e&&(r.className=e),i&&i.appendChild(r),r}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){i.docStyle&&i.selectProp&&(i.userSelect=i.docStyle[i.selectProp],i.docStyle[i.selectProp]="none")}static enableDrag(){i.docStyle&&i.selectProp&&(i.docStyle[i.selectProp]=i.userSelect)}static setTransform(t,e){t.style[i.transformProp]=e}static addEventListener(t,e,i,r={}){t.addEventListener(e,i,"passive"in r?r:r.capture)}static removeEventListener(t,e,i,r={}){t.removeEventListener(e,i,"passive"in r?r:r.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",i.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",i.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",i.suppressClickInternal,!0)}),0)}static mousePos(e,i){const r=e.getBoundingClientRect();return new t.P(i.clientX-r.left-e.clientLeft,i.clientY-r.top-e.clientTop)}static touchPos(e,i){const r=e.getBoundingClientRect(),n=[];for(let o=0;o<i.length;o++)n.push(new t.P(i[o].clientX-r.left-e.clientLeft,i[o].clientY-r.top-e.clientTop));return n}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}i.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,i.selectProp=i.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),i.transformProp=i.testProp(["transform","WebkitTransform"]);const r={supported:!1,testSupport:function(t){!s&&o&&(a?l(t):n=t)}};let n,o,s=!1,a=!1;function l(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.isContextLost())return;r.supported=!0}catch(t){}t.deleteTexture(e),s=!0}var c,u;"undefined"!=typeof document&&(o=document.createElement("img"),o.onload=function(){n&&l(n),n=null,a=!0},o.onerror=function(){s=!0,n=null},o.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let i,n,o,s;e.resetRequestQueue=()=>{i=[],n=0,o=0,s={}},e.addThrottleControl=t=>{const e=o++;return s[e]=t,e},e.removeThrottleControl=t=>{delete s[t],c()},e.getImage=(t,e,o=!0)=>{r.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*");const s={requestParameters:t,supportImageRefresh:o,callback:e,cancelled:!1,completed:!1,cancel:()=>{s.completed||s.cancelled||(s.cancelled=!0,s.innerRequest&&(s.innerRequest.cancel(),n--),c())}};return i.push(s),c(),s};const a=e=>{const{requestParameters:i,supportImageRefresh:r,callback:n}=e;return t.e(i,{type:"image"}),(!1!==r||t.i()||t.g(i.url)||i.headers&&!Object.keys(i.headers).reduce(((t,e)=>t&&"accept"===e),!0)?t.m:u)(i,((t,i,r,o)=>{l(e,n,t,i,r,o)}))},l=(e,i,r,o,s,a)=>{r?i(r):o instanceof HTMLImageElement||t.a(o)?i(null,o):o&&((e,i)=>{"function"==typeof createImageBitmap?t.b(e,i):t.d(e,i)})(o,((t,e)=>{null!=t?i(t):null!=e&&i(null,e,{cacheControl:s,expires:a})})),e.cancelled||(e.completed=!0,n--,c())},c=()=>{const e=(()=>{const t=Object.keys(s);let e=!1;if(t.length>0)for(const i of t)if(e=s[i](),e)break;return e})()?t.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=n;t<e&&i.length>0;t++){const e=i.shift();if(e.cancelled){t--;continue}const r=a(e);n++,e.innerRequest=r}},u=(e,i)=>{const r=new Image,n=e.url;let o=!1;const s=e.credentials;return s&&"include"===s?r.crossOrigin="use-credentials":(s&&"same-origin"===s||!t.s(n))&&(r.crossOrigin="anonymous"),r.fetchPriority="high",r.onload=()=>{i(null,r),r.onerror=r.onload=null},r.onerror=()=>{o||i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),r.onerror=r.onload=null},r.src=n,{cancel:()=>{o=!0,r.src=""}}}}(c||(c={})),c.resetRequestQueue(),function(t){t.Glyphs="Glyphs",t.Image="Image",t.Source="Source",t.SpriteImage="SpriteImage",t.SpriteJSON="SpriteJSON",t.Style="Style",t.Tile="Tile",t.Unknown="Unknown"}(u||(u={}));class h{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeSpriteURL(t,e,i){const r=function(t){const e=t.match(p);if(!e)throw new Error(`Unable to parse URL "${t}"`);return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}(t);return r.path+=`${e}${i}`,function(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}(r)}setTransformRequest(t){this._transformRequestFn=t}}const p=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function d(e){var i=new t.A(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}var f,m=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t};f=new t.A(3),t.A!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0);var g=function(t){var e=t[0],i=t[1];return e*e+i*i};function _(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const i=[];for(const{id:r,url:n}of t){const t=`${r}${n}`;-1===i.indexOf(t)&&(i.push(t),e.push({id:r,url:n}))}}return e}function y(e,i,r,n,o){if(n)return void e(n);if(o!==Object.values(i).length||o!==Object.values(r).length)return;const s={};for(const e in i){s[e]={};const n=t.h.getImageCanvasContext(r[e]),o=i[e];for(const t in o){const{width:i,height:r,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:p,content:d}=o[t];s[e][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:p,content:d,spriteData:{width:i,height:r,x:a,y:l,context:n}}}}e(null,s)}!function(){var e=new t.A(2);t.A!=Float32Array&&(e[0]=0,e[1]=0)}();class A{constructor(t,e,i,r){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,r)}update(e,i,r){const{width:n,height:o}=e,s=!(this.size&&this.size[0]===n&&this.size[1]===o||r),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[n,o],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.a(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,n,o,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:i,y:s}=r||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.a(e)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,i,s,n,o,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(t,e,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class x extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const e=i.spriteData;i.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),i.spriteData=null}return i}addImage(t,e){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,e)&&(this.images[t]=e)}_validate(e,i){let r=!0;const n=i.data||i.spriteData;return this._validateStretch(i.stretchX,n&&n.width)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,n&&n.height)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let i=0;for(const r of t){if(r[0]<i||r[1]<r[0]||e<r[1])return!1;i=r[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const i=e.spriteData,r=i&&i.width||e.data.width,n=i&&i.height||e.data.height;return!(t[0]<0||r<t[0]||t[1]<0||n<t[1]||t[2]<0||r<t[2]||t[3]<0||n<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i=!0){const r=this.getImage(t);if(i&&(r.data.width!==e.data.width||r.data.height!==e.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${e.data.width}x${e.data.height}).`);e.version=r.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,i){const r={};for(const i of e){let e=this.getImage(i);e||(this.fire(new t.k("styleimagemissing",{id:i})),e=this.getImage(i)),e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new t.I(i,r);this.patterns[e]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new A(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:r}=t.p(e),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],r=i.x+1,o=i.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),t.R.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),t.R.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),t.R.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),t.R.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const e=this.getImage(i);e||t.w(`Image with ID: "${i}" was not found`),v(e)&&this.updateImage(i,e)}}}const b=1e20;function w(t,e,i,r,n,o,s,a,l){for(let c=e;c<e+r;c++)S(t,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)S(t,c*o+e,1,r,s,a,l)}function S(t,e,i,r,n,o,s){o[0]=0,s[0]=-b,s[1]=b,n[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){n[a]=t[e+a*i];const r=a*a;do{const t=o[l];c=(n[a]-n[t]+r-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=b}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;t[e+a*i]=n[r]+c*c}}class T{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(e,i){const r=[];for(const t in e)for(const i of e[t])r.push({stack:t,id:i});t.o(r,(({stack:t,id:e},i)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{}});let n=r.glyphs[e];if(void 0!==n)return void i(null,{stack:t,id:e,glyph:n});if(n=this._tinySDF(r,t,e),n)return r.glyphs[e]=n,void i(null,{stack:t,id:e,glyph:n});const o=Math.floor(e/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void i(null,{stack:t,id:e,glyph:n});if(!this.url)return void i(new Error("glyphsUrl is not set"));let s=r.requests[o];s||(s=r.requests[o]=[],T.loadGlyphRange(t,o,this.url,this.requestManager,((t,e)=>{if(e){for(const t in e)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e[+t]);r.ranges[o]=!0}for(const i of s)i(t,e);delete r.requests[o]}))),s.push(((r,n)=>{r?i(r):n&&i(null,{stack:t,id:e,glyph:n[e]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:r,glyph:n}of e)(t[i]||(t[i]={}))[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};i(null,t)}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e))}_tinySDF(e,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(i)?t="900":/medium/i.test(i)?t="500":/light/i.test(i)&&(t="200"),o=e.tinySDF=new T.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:t})}const s=o.draw(String.fromCharCode(r));return{id:r,bitmap:new t.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}T.loadGlyphRange=function(e,i,r,n,o){const s=256*i,a=s+255,l=n.transformRequest(r.replace("{fontstack}",e).replace("{range}",`${s}-${a}`),u.Glyphs);t.l(l,((e,i)=>{if(e)o(e);else if(i){const e={};for(const r of t.n(i))e[r.id]=r;o(null,e)}}))},T.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),p=new Uint8ClampedArray(h),d={data:p,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return d;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(b,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=y.data[4*(t*a+e)+3]/255;if(0===i)continue;const r=(t+m)*c+e+m;if(1===i)_[r]=0,g[r]=b;else{const t=.5-i;_[r]=t>0?t*t:0,g[r]=t<0?t*t:0}}w(_,0,0,c,u,c,this.f,this.v,this.z),w(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(_[t])-Math.sqrt(g[t]);p[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return d}};class C{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,i){return t.z(e.expression.evaluate(i))}interpolate(e,i,r){return{x:t.B.number(e.x,i.x,r),y:t.B.number(e.y,i.y,r),z:t.B.number(e.z,i.z,r)}}}let M;class E extends t.E{constructor(e){super(),M=M||new t.r({anchor:new t.D(t.v.light.anchor),position:new C,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(M),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.t,e,i))for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.x(this,e.call(t.y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}}class I{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]}getDashRanges(t,e,i){const r=[];let n=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(t,e,i){const r=e/2;for(let e=-i;e<=i;e++){const n=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const p=e/i*(r+1);if(s.isDash){const t=r-Math.abs(p);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+p*p);this.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let e=t.length-1;e>=0;--e){const i=t[e],r=t[e+1];i.zeroLength?t.splice(e,1):r&&r.isDash===i.isDash&&(r.left=i.left,t.splice(e,1))}const e=t[0],i=t[t.length-1];e.isDash===i.isDash&&(e.left=i.left-this.width,i.right=e.right+this.width);const r=this.width*this.nextRow;let n=0,o=t[n];for(let e=0;e<this.width;e++){e/o.right>1&&(o=t[++n]);const i=Math.abs(e-o.left),s=Math.abs(e-o.right),a=Math.min(i,s);this.data[r+e]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,n=this.getDashRanges(e,this.width,t);i?this.addRoundDash(n,t,r):this.addRegularDash(n)}const s={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,s}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}class L{constructor(e,i,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const n=this.workerPool.acquire(r);for(let e=0;e<n.length;e++){const o=new t.C(n[e],i,r);o.name=`Worker ${e}`,this.actors.push(o)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,i,r){t.o(this.actors,((t,r)=>{t.send(e,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((t=>{t.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}}function P(e,i,r){const n=function(i,n){if(i)return r(i);if(n){const i=t.F(t.e(n,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(i.vectorLayers=n.vector_layers,i.vectorLayerIds=i.vectorLayers.map((t=>t.id))),r(null,i)}};return e.url?t.f(i.transformRequest(e.url,u.Source),n):t.h.frame((()=>n(null,e)))}class k{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(e){return this._ne=e instanceof t.L?new t.L(e.lng,e.lat):t.L.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.L?new t.L(e.lng,e.lat):t.L.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,o;if(e instanceof t.L)n=e,o=e;else{if(!(e instanceof k))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(k.convert(e)):this.extend(t.L.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.L.convert(e)):this;if(n=e._sw,o=e._ne,!n||!o)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new t.L(n.lng,n.lat),this._ne=new t.L(o.lng,o.lat)),this}getCenter(){return new t.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.L(this.getWest(),this.getNorth())}getSouthEast(){return new t.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=t.L.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(t){return t instanceof k?t:t?new k(t):t}static fromLngLat(e,i=0){const r=360*i/40075017,n=r/Math.cos(Math.PI/180*e.lat);return new k(new t.L(e.lng-n,e.lat-r),new t.L(e.lng+n,e.lat+r))}}class N{constructor(t,e,i){this.bounds=k.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.G(this.bounds.getWest())*i),n=Math.floor(t.H(this.bounds.getNorth())*i),o=Math.ceil(t.G(this.bounds.getEast())*i),s=Math.ceil(t.H(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class D extends t.E{constructor(e,i,r,n){if(super(),this.load=()=>{this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=P(this._options,this.map._requestManager,((e,i)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new t.j(e)):i&&(t.e(this,i),i.bounds&&(this.tileBounds=new N(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}))},this.serialize=()=>t.e({},this._options),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.F(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,e){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r={request:this.map._requestManager.transformRequest(i,u.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function n(i,r){return delete t.request,t.aborted?e(null):i&&404!==i.status?e(i):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:t.request=t.actor.send("reloadTile",r,n.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,n.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class O extends t.E{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.F(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=P(this._options,this.map._requestManager,((e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.j(e)):i&&(t.e(this,i),i.bounds&&(this.tileBounds=new N(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}serialize(){return t.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=c.getImage(this.map._requestManager.transformRequest(i,u.Tile),((i,r,n)=>{if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(i)t.state="errored",e(i);else if(r){this.map._refreshExpiredTiles&&n&&t.setExpiryData(n);const i=this.map.painter.context,o=i.gl;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new A(i,r,o.RGBA,{useMipmap:!0}),t.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax)),t.state="loaded",e(null)}}),this.map._refreshExpiredTiles)}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}class R extends O{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e,i){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(r,u.Tile);function o(t,r){t&&(e.state="errored",i(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",i(null))}e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.request=c.getImage(n,((r,n,s)=>t._(this,void 0,void 0,(function*(){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(n){this.map._refreshExpiredTiles&&e.setExpiryData(s);const i=t.a(n)&&t.J()?n:yield function(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.K()){const i=e.width+2,r=e.height+2;try{return new t.R({width:i,height:r},yield t.M(e,-1,-1,i,r))}catch(t){}}return t.h.getImageData(e,1)}))}(n),r={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:i,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",r,o))}}))),this.map._refreshExpiredTiles)}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.O(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.O(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.O(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.O(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.O(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.O(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class F extends t.E{constructor(e,i,r,n){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>t.e({},this._options,{type:this.type,data:this._data}),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.N/this.tileSize;this.workerOptions=t.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.N,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.N,radius:(i.clusterRadius||50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},r),this}_updateWorkerData(e){const i=t.e({},this.workerOptions);e?i.dataDiff=e:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(t.h.resolveURL(this._data),u.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,i,((e,i)=>{if(this._pendingLoads--,this._removed||i&&i.abandoned)return void this.fire(new t.k("dataabort",{dataType:"source"}));let r=null;if(i&&i.resourceTiming&&i.resourceTiming[this.id]&&(r=i.resourceTiming[this.id].slice(0)),e)return void this.fire(new t.j(e));const n={dataType:"source"};this._collectResourceTiming&&r&&r.length>0&&t.e(n,{resourceTiming:r}),this.fire(new t.k("data",Object.assign(Object.assign({},n),{sourceDataType:"metadata"}))),this.fire(new t.k("data",Object.assign(Object.assign({},n),{sourceDataType:"content"})))}))}loaded(){return 0===this._pendingLoads}loadTile(t,e){const i=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(i,r,((r,n)=>(delete t.request,t.unloadVectorData(),t.aborted?e(null):r?e(r):(t.loadVectorData(n,this.map.painter,"reloadTile"===i),e(null)))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var z=t.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class B extends t.E{constructor(e,i,r,n){super(),this.load=(e,i)=>{this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=c.getImage(this.map._requestManager.transformRequest(this.url,u.Image),((r,n)=>{this._request=null,this._loaded=!0,r?this.fire(new t.j(r)):n&&(this.image=n,e&&(this.coordinates=e),i&&i(),this._finishLoading())}))},this.prepare=()=>{if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new A(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=e,this.dispatcher=r,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=i}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,(()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(t.U.fromLngLat);this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.W(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z;const r=i.map((t=>this.tileID.getTilePoint(t)._round()));return this._boundsArray=new t.V,this._boundsArray.emplaceBack(r[0].x,r[0].y,0,0),this._boundsArray.emplaceBack(r[1].x,r[1].y,t.N,0),this._boundsArray.emplaceBack(r[3].x,r[3].y,0,t.N),this._boundsArray.emplaceBack(r[2].x,r[2].y,t.N,t.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}hasTransition(){return!1}}class U extends B{constructor(e,i,r,n){super(e,i,r,n),this.load=()=>{this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,u.Source).url);t.X(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.j(e)):i&&(this.video=i,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))},this.prepare=()=>{if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new A(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=i}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.j(new t.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class V extends B{constructor(e,i,r,n){super(e,i,r,n),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,z.members)),this.boundsSegments||(this.boundsSegments=t.S.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new A(i,this.canvas,r.RGBA,{premultiply:!0});let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.j(new t.Y(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.j(new t.Y(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.j(new t.Y(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.j(new t.Y(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.j(new t.Y(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const j={},G=t=>{switch(t){case"geojson":return F;case"image":return B;case"raster":return O;case"raster-dem":return R;case"vector":return D;case"video":return U;case"canvas":return V}return j[t]};function Z(e,i){const r=t.Z();return t.$(r,r,[1,1,0]),t.a0(r,r,[.5*e.width,.5*e.height,1]),t.a1(r,r,e.calculatePosMatrix(i.toUnwrapped()))}function q(t,e,i,r,n,o){const s=function(t,e,i){if(t)for(const r of t){const t=e[r];if(t&&t.source===i&&"fill-extrusion"===t.type)return!0}else for(const t in e){const r=e[t];if(r.source===i&&"fill-extrusion"===r.type)return!0}return!1}(n&&n.layers,e,t.id),a=o.maxPitchScaleFactor(),l=t.tilesIn(r,a,s);l.sort(W);const c=[];for(const r of l)c.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(e,i,t._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,n,o,a,Z(t.transform,r.tileID))});const u=function(t){const e={},i={};for(const r of t){const t=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in t){const r=t[i],n=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of r)n[t.featureIndex]||(n[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}));return u}function W(t,e){const i=t.tileID,r=e.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class H{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a2(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const r of t){const t=r.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=r}}return i}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a4){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a4&&i.hasRTLText){this.hasRTLText=!0,t.a5();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t).queryRadius(e))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new A(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new A(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,r,n,o,s,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l},t,e,i):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=t.a6(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const e=t.a7(n,!0);if(!a.filter(new t.a8(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.a8(this.tileID.overscaledZ),n))continue;const p=r.getId(n,o),d=new t.a9(n,l,c,u,p);d.tile=h,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aa(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const r=this.expirationTime-i;r?this.expirationTime=t+Math.max(r,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;n.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=t.h.now()+e}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}}class J{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:e,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(t,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,r=void 0===e?0:this.data[i].indexOf(e),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const r of this.data[i])t(r.value)||e.push(r);for(const t of e)this.remove(t.value.tileID,t)}}class K{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},t.e(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(i in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][i]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(e,i){const r=String(i),n=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete n[e]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(e,i){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),t.e(this.state[e][r],this.stateChanges[e][r]),i[r]=this.state[e][r];r[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}r[e]=r[e]||{},t.e(r[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,i)}}class $ extends t.E{constructor(t,e,i){super(),this.id=t,this.dispatcher=i,this.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)})),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((t,e,i,r)=>{const n=new(G(e.type))(t,e,i,r);if(n.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${n.id}`);return n})(t,e,i,this),this._tiles={},this._cache=new J(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new K,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,e){return this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,(()=>{})),this._source.fire(new t.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Y).map((t=>t.key))}getRenderableIds(e){const i=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&i.push(this._tiles[t]);return e?i.sort(((e,i)=>{const r=e.tileID,n=i.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),s=new t.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(Y).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(e,i,r,n){if(n)return e.state="errored",void(404!==n.status?this._source.fire(new t.j(n,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=t.h.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){const e=this.getTileByID(n);i(t,e),i(e,t)}}function i(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,n=Math.floor(i*r*(null===this._maxTileCacheZoomLevels?t.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(t,this._tiles[t])}}update(e,i){if(this.transform=e,this.terrain=i,!this._sourceLoaded||this._paused)return;let r;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.O(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i}),this._source.hasTile&&(r=r.filter((t=>this._source.hasTile(t))))):r=[];const n=e.coveringZoomLevel(this._source),o=Math.max(n-$.maxOverzooming,this._source.minzoom),s=Math.max(n+$.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of r)if(e.canonical.z>this._source.minzoom){const i=e.scaledTo(e.canonical.z-1);t[i.key]=i;const r=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[r.key]=r}r=r.concat(Object.values(t))}const a=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(r,n);if(X(this._source.type)){const e={},a={},c=Object.keys(l),u=t.h.now();for(const t of c){const i=l[t],r=this._tiles[t];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const n=this.findLoadedParent(i,o);n&&(this._addTile(n.tileID),e[n.tileID.key]=n.tileID),a[t]=i}this._retainLoadedChildren(a,n,s,l);for(const t in e)l[t]||(this._coveredTiles[t]=!0,l[t]=e[t]);if(i){const t={},e={};for(const i of r)this._tiles[i.key].hasData()?t[i.key]=i:e[i.key]=i;for(const i in e){const r=e[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(t[r[0].key]=l[r[0].key]=r[0],t[r[1].key]=l[r[1].key]=r[1],t[r[2].key]=l[r[2].key]=r[2],t[r[3].key]=l[r[3].key]=r[3],delete e[i])}for(const i in e){const r=this.findLoadedParent(e[i],this._source.minzoom);if(r){t[r.tileID.key]=l[r.tileID.key]=r.tileID;for(const e in t)t[e].isChildOf(r.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}for(const t in l)this._tiles[t].clearFadeHold();const c=t.ab(this._tiles,l);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){const i={},r={},n=Math.max(e-$.maxOverzooming,this._source.minzoom),o=Math.max(e+$.maxUnderzooming,this._source.minzoom),s={};for(const r of t){const t=this._addTile(r);i[r.key]=r,t.hasData()||e<this._source.maxzoom&&(s[r.key]=r)}this._retainLoadedChildren(s,e,o,i);for(const o of t){let t=this._tiles[o.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=o.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){i[t.key]=t;continue}}else{const t=o.children(this._source.maxzoom);if(i[t[0].key]&&i[t[1].key]&&i[t[2].key]&&i[t[3].key])continue}let s=t.wasRequested();for(let e=o.overscaledZ-1;e>=n;--e){const n=o.scaledTo(e);if(r[n.key])break;if(r[n.key]=!0,t=this.getTile(n),!t&&s&&(t=this._addTile(n)),t){const e=t.hasData();if((s||e)&&(i[n.key]=n),s=t.wasRequested(),e)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;r=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=i;return i||(i=new H(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))),i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.k("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(e,i,r){const n=[],o=this.transform;if(!o)return n;const s=r?o.getCameraQueryGeometry(e):e,a=e.map((t=>o.pointCoordinate(t,this.terrain))),l=s.map((t=>o.pointCoordinate(t,this.terrain))),c=this.getIds();let u=1/0,h=1/0,p=-1/0,d=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),p=Math.max(p,t.x),d=Math.max(d,t.y);for(let e=0;e<c.length;e++){const r=this._tiles[c[e]];if(r.holdingForFade())continue;const s=r.tileID,f=Math.pow(2,o.zoom-r.tileID.overscaledZ),m=i*r.queryPadding*t.N/r.tileSize/f,g=[s.getTilePoint(new t.U(u,h)),s.getTilePoint(new t.U(p,d))];if(g[0].x-m<t.N&&g[0].y-m<t.N&&g[1].x+m>=0&&g[1].y+m>=0){const t=a.map((t=>s.getTilePoint(t))),e=l.map((t=>s.getTilePoint(t)));n.push({tile:r,tileID:s,queryGeometry:t,cameraQueryGeometry:e,scale:f})}}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.posMatrix=this.transform.calculatePosMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(X(this._source.type)){const e=t.h.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const r=this._tiles[t];r&&r.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}}function Y(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function X(t){return"raster"===t||"image"===t||"video"===t}$.maxOverzooming=10,$.maxUnderzooming=3;const Q="mapboxgl_preloaded_worker_pool";class tt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<tt.workerCount;)this.workers.push(new Worker(t.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Q]}numActive(){return Object.keys(this.active).length}}const et=Math.floor(t.h.hardwareConcurrency/2);let it;function rt(){return it||(it=new tt),it}tt.workerCount=t.ac(globalThis)?Math.max(Math.min(et,3),1):1;class nt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ad(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function ot(t,e){let i=!0;return"always"===t||"never"!==t&&"never"!==e||(i=!1),i}class st{constructor(t,e,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,r,n){this._forEachCell(e,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(t,e,i,r){this._forEachCell(e-r,i-r,e+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(r)}_insertBoxCell(t,e,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(t,e,i,r,n,o){this.circleCells[n].push(o)}_query(t,e,i,r,n,o,s){if(i<0||t>this.width||r<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=r){if(n)return[{key:null,x1:t,y1:e,x2:i,y2:r}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],r=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-r,y1:i-r,x2:e+r,y2:i+r})}}else this._forEachCell(t,e,i,r,this._queryCell,a,{hitTest:n,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(t,e,i,r){return this._query(t,e,i,r,!1,null)}hitTest(t,e,i,r,n,o){return this._query(t,e,i,r,!0,n,o).length>0}hitTestCircle(t,e,i,r,n){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},n),c.length>0}_queryCell(t,e,i,r,n,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const n=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,p=this.boxKeys[s];if(t<=n[h+2]&&e<=n[h+3]&&i>=n[h+0]&&r>=n[h+1]&&(!a||a(p))&&(!c||!ot(u,p.overlapMode))&&(o.push({key:p,x1:n[h],y1:n[h+1],x2:n[h+2],y2:n[h+3]}),c))return!0}}const p=this.circleCells[n];if(null!==p){const n=this.circles;for(const s of p)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,p=this.circleKeys[s];if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],t,e,i,r)&&(!a||a(p))&&(!c||!ot(u,p.overlapMode))){const t=n[h],e=n[h+1],i=n[h+2];if(o.push({key:p,x1:t-i,y1:e-i,x2:t+i,y2:e+i}),c)return!0}}}return!1}_queryCellCircle(t,e,i,r,n,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e,r=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(r))&&!ot(u,r.overlapMode))return o.push(!0),!0}}const p=this.circleCells[n];if(null!==p){const t=this.circles;for(const e of p)if(!c.circle[e]){c.circle[e]=!0;const i=3*e,r=this.circleKeys[e];if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(r))&&!ot(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(t,e,i,r,n,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++)if(n.call(this,t,e,i,r,this.xCellCount*l+p,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,r,n,o){const s=r-t,a=n-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(t-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(e-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,p=u-c;return h*h+p*p<=i*i}}function at(e,i,r,n,o){const s=t.Z();return i?(t.a0(s,s,[1/o,1/o,1]),r||t.ae(s,s,n.angle)):t.a1(s,n.labelPlaneMatrix,e),s}function lt(e,i,r,n,o){if(i){const i=t.af(e);return t.a0(i,i,[o,o,1]),r||t.ae(i,i,-n.angle),i}return n.glCoordMatrix}function ct(e,i,r){let n;r?(n=[e.x,e.y,r(e.x,e.y),1],t.ag(n,n,i)):(n=[e.x,e.y,0,1],wt(n,n,i));const o=n[3];return{point:new t.P(n[0]/o,n[1]/o),signedDistanceFromCamera:o}}function ut(t,e){return.5+t/e*.5}function ht(t,e){const i=t[0]/t[3],r=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&r>=-e[1]&&r<=e[1]}function pt(e,i,r,n,o,s,a,l,c,u){const h=n?e.textSizeData:e.iconSizeData,p=t.ah(h,r.transform.zoom),d=[256/r.width*2+1,256/r.height*2+1],f=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();const m=e.lineVertexArray,g=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,_=r.transform.width/r.transform.height;let y=!1;for(let n=0;n<g.length;n++){const A=g.get(n);if(A.hidden||A.writingMode===t.ai.vertical&&!y){bt(A.numGlyphs,f);continue}let v;if(y=!1,u?(v=[A.anchorX,A.anchorY,u(A.anchorX,A.anchorY),1],t.ag(v,v,i)):(v=[A.anchorX,A.anchorY,0,1],wt(v,v,i)),!ht(v,d)){bt(A.numGlyphs,f);continue}const x=ut(r.transform.cameraToCenterDistance,v[3]),b=t.aj(h,p,A),w=a?b/x:b*x,S=new t.P(A.anchorX,A.anchorY),T=ct(S,o,u).point,C={projections:{},offsets:{}},M=mt(A,w,!1,l,i,o,s,e.glyphOffsetArray,m,f,T,S,C,_,c,u);y=M.useVertical,(M.notEnoughRoom||y||M.needsFlipping&&mt(A,w,!0,l,i,o,s,e.glyphOffsetArray,m,f,T,S,C,_,c,u).notEnoughRoom)&&bt(A.numGlyphs,f)}n?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function dt(t,e,i,r,n,o,s,a,l,c,u,h,p){const d=a.glyphStartIndex+a.numGlyphs,f=a.lineStartIndex,m=a.lineStartIndex+a.lineLength,g=e.getoffsetX(a.glyphStartIndex),_=e.getoffsetX(d-1),y=vt(t*g,i,r,n,o,s,a.segment,f,m,l,c,u,h,p);if(!y)return null;const A=vt(t*_,i,r,n,o,s,a.segment,f,m,l,c,u,h,p);return A?{first:y,last:A}:null}function ft(e,i,r,n){return e===t.ai.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(e===t.ai.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function mt(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=i/24,y=e.lineOffsetX*_,A=e.lineOffsetY*_;let v;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,i=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,u=dt(_,l,y,A,r,h,p,e,c,s,d,m,g);if(!u)return{notEnoughRoom:!0};const x=ct(u.first.point,a,g).point,b=ct(u.last.point,a,g).point;if(n&&!r){const t=ft(e.writingMode,x,b,f);if(t)return t}v=[u.first];for(let n=e.glyphStartIndex+1;n<t-1;n++)v.push(vt(_*l.getoffsetX(n),y,A,r,h,p,e.segment,i,o,c,s,d,m,g));v.push(u.last)}else{if(n&&!r){const i=ct(p,o,g).point,r=e.lineStartIndex+e.segment+1,n=new t.P(c.getx(r),c.gety(r)),s=ct(n,o,g),a=s.signedDistanceFromCamera>0?s.point:gt(p,n,i,1,o,g),l=ft(e.writingMode,i,a,f);if(l)return l}const i=vt(_*l.getoffsetX(e.glyphStartIndex),y,A,r,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,s,d,m,g);if(!i)return{notEnoughRoom:!0};v=[i]}for(const e of v)t.ak(u,e.point,e.angle);return{}}function gt(t,e,i,r,n,o){const s=ct(t.add(t.sub(e)._unit()),n,o).point,a=i.sub(s);return i.add(a._mult(r/a.mag()))}function _t(e,i){const{projectionCache:r,lineVertexArray:n,labelPlaneMatrix:o,tileAnchorPoint:s,distanceFromAnchor:a,getElevation:l,previousVertex:c,direction:u,absOffsetX:h}=i;if(r.projections[e])return r.projections[e];const p=new t.P(n.getx(e),n.gety(e)),d=ct(p,o,l);if(d.signedDistanceFromCamera>0)return r.projections[e]=d.point,d.point;const f=e-u;return gt(0===a?s:new t.P(n.getx(f),n.gety(f)),p,c,h-a+1,o,l)}function yt(t,e,i){return t._unit()._perp()._mult(e*i)}function At(e,i,r,n,o,s,a,l){const{projectionCache:c,direction:u}=l;if(c.offsets[e])return c.offsets[e];const h=r.add(i);if(e+u<n||e+u>=o)return c.offsets[e]=h,h;const p=_t(e+u,l),d=yt(p.sub(r),a,u),f=r.add(d),m=p.add(d);return c.offsets[e]=t.al(s,h,f,m)||h,c.offsets[e]}function vt(t,e,i,r,n,o,s,a,l,c,u,h,p,d){const f=r?t-e:t+e;let m=f>0?1:-1,g=0;r&&(m*=-1,g=Math.PI),m<0&&(g+=Math.PI);let _,y,A=m>0?a+s:a+s+1,v=n,x=n,b=0,w=0;const S=Math.abs(f),T=[];let C;for(;b+w<=S;){if(A+=m,A<a||A>=l)return null;b+=w,x=v,y=_;const t={projectionCache:h,lineVertexArray:c,labelPlaneMatrix:u,tileAnchorPoint:o,distanceFromAnchor:b,getElevation:d,previousVertex:x,direction:m,absOffsetX:S};if(v=_t(A,t),0===i)T.push(x),C=v.sub(x);else{let e;const r=v.sub(x);e=0===r.mag()?yt(_t(A+m,t).sub(v),i,m):yt(r,i,m),y||(y=x.add(e)),_=At(A,e,v,a,l,y,i,t),T.push(y),C=_.sub(y)}w=C.mag()}const M=C._mult((S-b)/w)._add(y||x),E=g+Math.atan2(v.y-x.y,v.x-x.x);return T.push(M),{point:M,angle:p?E:0,path:T}}const xt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bt(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(xt,3*t)}}function wt(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t[3]=i[3]*r+i[7]*n+i[15],t}const St=100;class Tt{constructor(t,e=new st(t.width+200,t.height+200,25),i=new st(t.width+200,t.height+200,25)){this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+St,this.screenBottomBoundary=t.height+St,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,i,r,n,o){const s=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY,o),a=i*s.perspectiveRatio,l=t.x1*a+s.point.x,c=t.y1*a+s.point.y,u=t.x2*a+s.point.x,h=t.y2*a+s.point.y;return!this.isInsideGrid(l,c,u,h)||"always"!==e&&this.grid.hitTest(l,c,u,h,e,n)||s.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[l,c,u,h],offscreen:this.isOffscreen(l,c,u,h)}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,p,d,f){const m=[],g=new t.P(i.anchorX,i.anchorY),_=ct(g,s,f),y=ut(this.transform.cameraToCenterDistance,_.signedDistanceFromCamera),A=(u?o/y:o*y)/t.ap,v=ct(g,a,f).point,x=dt(A,n,i.lineOffsetX*A,i.lineOffsetY*A,!1,v,g,i,r,a,{projections:{},offsets:{}},!1,f);let b=!1,w=!1,S=!0;if(x){const i=.5*p*y+d,r=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new nt,s=x.first,a=x.last;let u=[];for(let t=s.path.length-1;t>=1;t--)u.push(s.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const g=2.5*i;if(l){const t=u.map((t=>ct(t,l,f)));u=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let _=[];if(u.length>0){const e=u[0].clone(),i=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),i.x=Math.max(i.x,u[t].x),i.y=Math.max(i.y,u[t].y);_=e.x>=r.x&&i.x<=n.x&&e.y>=r.y&&i.y<=n.y?[u]:i.x<r.x||e.x>n.x||i.y<r.y||e.y>n.y?[]:t.am([u],r.x,r.y,n.x,n.y)}for(const t of _){o.reset(t,.25*i);let r=0;r=o.length<=.5*i?1:Math.ceil(o.paddedLength/g)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+St,l=s.y+St;m.push(a,l,i,0);const u=a-i,p=l-i,d=a+i,f=l+i;if(S=S&&this.isOffscreen(u,p,d,f),w=w||this.isInsideGrid(u,p,d,f),"always"!==e&&this.grid.hitTestCircle(a,l,i,e,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:S,collisionDetected:b}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+St,a.y+St);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.an(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(t,e,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,r,n,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:e};for(let e=0;e<t.length;e+=4)s.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,r,n){let o;return n?(o=[i,r,n(i,r),1],t.ag(o,o,e)):(o=[i,r,0,1],wt(o,o,e)),{point:new t.P((o[0]/o[3]+1)/2*this.transform.width+St,(-o[1]/o[3]+1)/2*this.transform.height+St),perspectiveRatio:.5+this.transform.cameraToCenterDistance/o[3]*.5}}isOffscreen(t,e,i,r){return i<St||t>=this.screenRightBoundary||r<St||e>this.screenBottomBoundary}isInsideGrid(t,e,i,r){return i>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.ao([]);return t.$(e,e,[-100,-100,0]),e}}function Ct(e,i,r){return i*(t.N/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}class Mt{constructor(t,e,i,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Et{constructor(t,e,i,r,n){this.text=new Mt(t?t.text:null,e,i,n),this.icon=new Mt(t?t.icon:null,e,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class It{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class Lt{constructor(){this.invProjMatrix=t.Z(),this.viewportMatrix=t.Z(),this.circles=[]}}class Pt{constructor(t,e,i,r,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class kt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Nt(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.au(e);return new t.P(-(s-.5)*i+n[0]*o,-(a-.5)*r+n[1]*o)}function Dt(e,i,r,n,o,s){const{x1:a,x2:l,y1:c,y2:u,anchorPointX:h,anchorPointY:p}=e,d=new t.P(i,r);return n&&d._rotate(o?s:-s),{x1:a+d.x,y1:c+d.y,x2:l+d.x,y2:u+d.y,anchorPointX:h,anchorPointY:p}}class Ot{constructor(t,e,i,r,n){this.transform=t.clone(),this.terrain=e,this.collisionIndex=new Tt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new kt(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=r.collisionBoxArray,l=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.N,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p="map"===l.get("text-pitch-alignment"),d="map"===l.get("text-rotation-alignment"),f=Ct(r,1,this.transform.zoom),m=at(h,p,d,this.transform,f);let g=null;if(p){const e=lt(h,p,d,this.transform,f);g=t.a1([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[o.bucketInstanceId]=new Pt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const _={bucket:o,layout:l,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:g,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.ah(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:_})}attemptAnchorPlacement(e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g){const _=t.aq[e.textAnchor],y=[e.textOffset0,e.textOffset1],A=Nt(_,r,n,y,o),v=this.collisionIndex.placeCollisionBox(Dt(i,A.x,A.y,s,a,this.transform.angle),h,l,c,u.predicate,g);if((!m||0!==this.collisionIndex.placeCollisionBox(Dt(m,A.x,A.y,s,a,this.transform.angle),h,l,c,u.predicate,g).box.length)&&v.box.length>0){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(t=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:y,width:r,height:n,anchor:_,textBoxScale:o,prevAnchor:t},this.markUsedJustification(d,_,p,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,p),this.placedOrientations[p.crossTileID]=f),{shift:A,placedGlyphBoxes:v}}}placeLayerBucketPart(e,i,r){const{bucket:n,layout:o,posMatrix:s,textLabelPlaneMatrix:a,labelToScreenMatrix:l,textPixelRatio:c,holdingForFade:u,collisionBoxArray:h,partiallyEvaluatedTextSize:p,collisionGroup:d}=e.parameters,f=o.get("text-optional"),m=o.get("icon-optional"),g=t.ar(o,"text-overlap","text-allow-overlap"),_="always"===g,y=t.ar(o,"icon-overlap","icon-allow-overlap"),A="always"===y,v="map"===o.get("text-rotation-alignment"),x="map"===o.get("text-pitch-alignment"),b="none"!==o.get("icon-text-fit"),w="viewport-y"===o.get("symbol-z-order"),S=_&&(A||!n.hasIconData()||m),T=A&&(_||!n.hasTextData()||f);!n.collisionArrays&&h&&n.deserializeCollisionBoxes(h);const C=this.retainedQueryData[n.bucketInstanceId].tileID,M=this.terrain?(t,e)=>this.terrain.getElevation(C,t,e):null,E=(e,h)=>{var A,w;if(i[e.crossTileID])return;if(u)return void(this.placements[e.crossTileID]=new It(!1,!1,!1));let C=!1,E=!1,I=!0,L=null,P={box:null,offscreen:null},k={box:null,offscreen:null},N=null,D=null,O=null,R=0,F=0,z=0;h.textFeatureIndex?R=h.textFeatureIndex:e.useRuntimeCollisionCircles&&(R=e.featureIndex),h.verticalTextFeatureIndex&&(F=h.verticalTextFeatureIndex);const B=h.textBox;if(B){const i=i=>{let r=t.ai.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(n,r,e))}return r},r=(i,r)=>{if(n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&h.verticalTextBox){for(const e of n.writingModes)if(e===t.ai.vertical?(P=r(),k=P):P=i(),P&&P.box&&P.box.length)break}else P=i()},o=e.textAnchorOffsetStartIndex,a=e.textAnchorOffsetEndIndex;if(a===o){const o=(t,i)=>{const r=this.collisionIndex.placeCollisionBox(t,g,c,s,d.predicate,M);return r&&r.box&&r.box.length&&(this.markUsedOrientation(n,i,e),this.placedOrientations[e.crossTileID]=i),r};r((()=>o(B,t.ai.horizontal)),(()=>{const i=h.verticalTextBox;return n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?o(i,t.ai.vertical):{box:null,offscreen:null}})),i(P&&P.box&&P.box.length)}else{let l=t.aq[null===(w=null===(A=this.prevPlacement)||void 0===A?void 0:A.variableOffsets[e.crossTileID])||void 0===w?void 0:w.anchor];const u=(t,i,r)=>{const u=t.x2-t.x1,h=t.y2-t.y1,p=e.textBoxScale,f=b&&"never"===y?i:null;let m={box:[],offscreen:!1},_="never"===g?1:2,A="never";l&&_++;for(let i=0;i<_;i++){for(let i=o;i<a;i++){const o=n.textAnchorOffsets.get(i);if(l&&o.textAnchor!==l)continue;const a=this.attemptAnchorPlacement(o,t,u,h,p,v,x,c,s,d,A,e,n,r,f,M);if(a&&(m=a.placedGlyphBoxes,m&&m.box&&m.box.length))return C=!0,L=a.shift,m}l?l=null:A=g}return m};r((()=>u(B,h.iconBox,t.ai.horizontal)),(()=>{const i=h.verticalTextBox;return n.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&e.numVerticalGlyphVertices>0&&i?u(i,h.verticalIconBox,t.ai.vertical):{box:null,offscreen:null}})),P&&(C=P.box,I=P.offscreen);const p=i(P&&P.box);if(!C&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(n,t.anchor,e,p))}}}if(N=P,C=N&&N.box&&N.box.length>0,I=N&&N.offscreen,e.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),c=t.aj(n.textSizeData,p,i),u=o.get("text-padding");D=this.collisionIndex.placeCollisionCircles(g,i,n.lineVertexArray,n.glyphOffsetArray,c,s,a,l,r,x,d.predicate,e.collisionCircleDiameter,u,M),D.circles.length&&D.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),C=_||D.circles.length>0&&!D.collisionDetected,I=I&&D.offscreen}if(h.iconFeatureIndex&&(z=h.iconFeatureIndex),h.iconBox){const t=t=>{const e=b&&L?Dt(t,L.x,L.y,v,x,this.transform.angle):t;return this.collisionIndex.placeCollisionBox(e,y,c,s,d.predicate,M)};k&&k.box&&k.box.length&&h.verticalIconBox?(O=t(h.verticalIconBox),E=O.box.length>0):(O=t(h.iconBox),E=O.box.length>0),I=I&&O.offscreen}const U=f||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,V=m||0===e.numIconVertices;if(U||V?V?U||(E=E&&C):C=E&&C:E=C=E&&C,C&&N&&N.box&&this.collisionIndex.insertCollisionBox(N.box,g,o.get("text-ignore-placement"),n.bucketInstanceId,k&&k.box&&F?F:R,d.ID),E&&O&&this.collisionIndex.insertCollisionBox(O.box,y,o.get("icon-ignore-placement"),n.bucketInstanceId,z,d.ID),D&&(C&&this.collisionIndex.insertCollisionCircles(D.circles,g,o.get("text-ignore-placement"),n.bucketInstanceId,R,d.ID),r)){const t=n.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Lt);for(let t=0;t<D.circles.length;t+=4)e.circles.push(D.circles[t+0]),e.circles.push(D.circles[t+1]),e.circles.push(D.circles[t+2]),e.circles.push(D.collisionDetected?1:0)}if(0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===n.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new It(C||S,E||T,I||n.justReloaded),i[e.crossTileID]=!0};if(w){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=n.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];E(n.symbolInstances.get(i),n.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)E(n.symbolInstances.get(t),n.collisionArrays[t]);if(r&&n.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[n.bucketInstanceId];t.as(e.invProjMatrix,s),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}n.justReloaded=!1}markUsedJustification(e,i,r,n){let o;o=n===t.ai.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.at(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,i,r){const n=i===t.ai.horizontal||i===t.ai.horizontalOnly?i:0,o=i===t.ai.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,n=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=n[t];o?(this.opacities[t]=new Et(o,r,e.text,e.icon),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Et(null,r,e.text,e.icon,e.skipFade),i=i||e.text||e.icon)}for(const t in n){const e=n[t];if(!this.opacities[t]){const n=new Et(e,r,!1,!1);n.isHidden()||(this.opacities[t]=n,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,r.collisionBoxArray)}}updateBucketOpacities(e,i,r){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const n=e.layers[0],o=n.layout,s=new Et(null,0,!1,!1,!0),a=o.get("text-allow-overlap"),l=o.get("icon-allow-overlap"),c=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),u="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),p="none"!==o.get("icon-text-fit"),d=new Et(null,0,a&&(l||!e.hasIconData()||o.get("icon-optional")),l&&(a||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const f=(t,e,i)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(i);t.hasVisibleVertices=t.hasVisibleVertices||i!==qt};for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:a,crossTileID:l}=n;let m=this.opacities[l];i[l]?m=s:m||(m=d,this.opacities[l]=m),i[l]=!0;const g=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],y=_===t.ai.vertical,A=_===t.ai.horizontal||_===t.ai.horizontalOnly;if(o>0||a>0){const t=Zt(m.text);f(e.text,o,y?qt:t),f(e.text,a,A?qt:t);const i=m.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||y?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||A?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(e,r.anchor,n,_);const s=this.placedOrientations[n.crossTileID];s&&(this.markUsedJustification(e,"left",n,s),this.markUsedOrientation(e,s,n))}if(g){const t=Zt(m.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&y);n.placedIconSymbolIndex>=0&&(f(e.icon,n.numIconVertices,i?t:qt),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=m.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,n.numVerticalIconVertices,i?qt:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[r];if(i){let r=new t.P(0,0);if(i.textBox||i.verticalTextBox){let t=!0;if(c){const e=this.variableOffsets[l];e?(r=Nt(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):t=!1}i.textBox&&Rt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||y,r.x,r.y),i.verticalTextBox&&Rt(e.textCollisionBox.collisionVertexArray,m.text.placed,!t||A,r.x,r.y)}const n=Boolean(!A&&i.verticalIconBox);i.iconBox&&Rt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,n,p?r.x:0,p?r.y:0),i.verticalIconBox&&Rt(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!n,p?r.x:0,p?r.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Rt(t,e,i,r,n){t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0),t.emplaceBack(e?1:0,i?1:0,r||0,n||0)}const Ft=Math.pow(2,25),zt=Math.pow(2,24),Bt=Math.pow(2,17),Ut=Math.pow(2,16),Vt=Math.pow(2,9),jt=Math.pow(2,8),Gt=Math.pow(2,1);function Zt(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*Ft+e*zt+i*Bt+e*Ut+i*Vt+e*jt+i*Gt+e}const qt=0;class Wt{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class Ht{constructor(t,e,i,r,n,o,s,a){this.placement=new Ot(t,e,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,r){const n=t.h.now(),o=()=>!this._forceFullPlacement&&t.h.now()-n>2;for(;this._currentPlacementIndex>=0;){const t=i[e[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=n)&&(!t.maxzoom||t.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new Wt(t)),this._inProgressLayer.continuePlacement(r[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Jt=512/t.N/2;class Kt{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const n=new Map;for(let t=0;t<i.length;t++){const e=i.get(t),r=e.key,o=n.get(r);o?o.push(e):n.set(r,[e])}for(const[e,i]of n){const r={positions:i.map((t=>({x:Math.floor(t.anchorX*Jt),y:Math.floor(t.anchorY*Jt)}))),crossTileIDs:i.map((t=>t.crossTileID))};if(r.positions.length>128){const e=new t.av(r.positions.length,16,Uint16Array);for(const{x:t,y:i}of r.positions)e.add(t,i);e.finish(),delete r.positions,r.index=e}this._symbolsByKey[e]=r}}getScaledCoordinates(e,i){const{x:r,y:n,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=Jt/Math.pow(2,l-o),u=(a*t.N+e.anchorY)*c,h=n*t.N*Jt;return{x:Math.floor((s*t.N+e.anchorX)*c-r*t.N*Jt),y:Math.floor(u-h)}}findMatches(t,e,i){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let n=0;n<t.length;n++){const o=t.get(n);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);if(s.index){const t=s.index.range(a.x-r,a.y-r,a.x+r,a.y+r).sort();for(const e of t){const t=s.crossTileIDs[e];if(!i[t]){i[t]=!0,o.crossTileID=t;break}}}else if(s.positions)for(let t=0;t<s.positions.length;t++){const e=s.positions[t],n=s.crossTileIDs[t];if(Math.abs(e.x-a.x)<=r&&Math.abs(e.y-a.y)<=r&&!i[n]){i[n]=!0,o.crossTileID=n;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class $t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],r={};for(const t in i){const n=i[t];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),r[n.tileID.key]=n}this.indexes[t]=r}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let t=0;t<e.symbolInstances.length;t++){const n=e.symbolInstances.get(t);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Kt(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.getCrossTileIDsLists())for(const e of i)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)t[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],e=!0)}return e}}class Xt{constructor(){this.layerIndexes={},this.crossTileIDs=new $t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Yt);let n=!1;const o={};r.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,e,this.crossTileIDs)&&(n=!0),o[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const Qt=(e,i)=>t.x(e,i&&i.filter((t=>"source.canvas"!==t.identifier))),te=t.F(t.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),ee=t.F(t.ax,["setCenter","setZoom","setBearing","setPitch"]),ie=t.aw();class re extends t.E{constructor(e,i={}){super(),this.map=e,this.dispatcher=new L(rt(),this,e._getMapId()),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new T(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new I(256,512),this.crossTileSymbolIndex=new Xt,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.az());const r=this;this._rtlTextPluginCallback=re.registerForPluginStateChange((e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.aA(e),i&&i.every((t=>t)))for(const t in r.sourceCaches){const e=r.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||r.sourceCaches[t].reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const i=e.getSource();if(i&&i.vectorLayerIds)for(const t in this._layers){const e=this._layers[t];e.source===i.id&&this._validateLayer(e)}}))}loadURL(e,i={},r){this.fire(new t.k("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const n=this.map._requestManager.transformRequest(e,u.Style);this._request=t.f(n,((e,n)=>{this._request=null,e?this.fire(new t.j(e)):n&&this._load(n,i,r)}))}loadJSON(e,i={},r){this.fire(new t.k("dataloading",{dataType:"style"})),this._request=t.h.frame((()=>{this._request=null,i.validate=!1!==i.validate,this._load(e,i,r)}))}loadEmpty(){this.fire(new t.k("dataloading",{dataType:"style"})),this._load(ie,{validate:!1})}_load(e,i,r){var n;const o=i.transformStyle?i.transformStyle(r,e):e;if(!i.validate||!Qt(this,t.y(o))){this._loaded=!0,this.stylesheet=o;for(const t in o.sources)this.addSource(t,o.sources[t],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs),this._createLayers(),this.light=new E(this.stylesheet.light),this.map.setTerrain(null!==(n=this.stylesheet.terrain)&&void 0!==n?n:null),this.fire(new t.k("data",{dataType:"style"})),this.fire(new t.k("style.load"))}}_createLayers(){const e=t.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",e),this._order=e.map((t=>t.id)),this._layers={},this._serializedLayers=null;for(const i of e){const e=t.aC(i);e.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=e}}_loadSprite(e,i=!1,r=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(e,i,r,n){const o=_(e),s=o.length,a=r>1?"@2x":"",l={},h={},p={};for(const{id:e,url:r}of o){const o=i.transformRequest(i.normalizeSpriteURL(r,a,".json"),u.SpriteJSON),d=`${e}_${o.url}`;l[d]=t.f(o,((t,i)=>{delete l[d],h[e]=i,y(n,h,p,t,s)}));const f=i.transformRequest(i.normalizeSpriteURL(r,a,".png"),u.SpriteImage),m=`${e}_${f.url}`;l[m]=c.getImage(f,((t,i)=>{delete l[m],p[e]=i,y(n,h,p,t,s)}))}return{cancel(){for(const t of Object.values(l))t.cancel()}}}(e,this.map._requestManager,this.map.getPixelRatio(),((e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.j(e));else if(n)for(const t in n){this._spritesImagesIds[t]=[];const e=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in n))):[];for(const t of e)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const e in n[t]){const r="default"===t?e:`${t}:${e}`;this._spritesImagesIds[t].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,n[t][e],!1):this.imageManager.addImage(r,n[t][e]),i&&(this._changedImages[r]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"})),r&&r(e)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const r=e.sourceLayer;if(!r)return;const n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.j(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const e=this._serializedAllLayers();if(!t||0===t.length)return Object.values(e);const i=[];for(const r of t)e[r]&&i.push(e[r]);return i}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const i of e){const e=this._layers[i];"custom"!==e.type&&(t[i]=e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error(`Invalid action ${e}`);this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];r[t]=e.used,e.used=!1}for(const t of this._order){const i=this._layers[t];i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const e in r){const i=this.sourceCaches[e];r[e]!==i.used&&i.fire(new t.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.z=e.zoom,i&&this.fire(new t.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){this._checkLoaded();const r=this.serialize();if(e=i.transformStyle?i.transformStyle(r,e):e,Qt(this,t.y(e)))return!1;(e=t.aD(e)).layers=t.aB(e.layers);const n=t.aE(r,e).filter((t=>!(t.command in ee)));if(0===n.length)return!1;const o=n.filter((t=>!(t.command in te)));if(o.length>0)throw new Error(`Unimplemented: ${o.map((t=>t.command)).join(", ")}.`);for(const t of n)"setTransition"!==t.command&&this[t.command].apply(this,t.args);return this.stylesheet=e,this._serializedLayers=null,!0}addImage(e,i){if(this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){if(!this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.y.source,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=this.sourceCaches[e]=new $(e,i,this.dispatcher);n.style=this,n.setEventedParent(this,(()=>({isSourceLoaded:n.loaded(),source:n.serialize(),sourceId:e}))),n.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.j(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error(`There is no source with this ID=${t}`);const i=this.sourceCaches[t].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this.getLayer(n))return void this.fire(new t.j(new Error(`Layer "${n}" already exists on this map.`)));let o;if("custom"===e.type){if(Qt(this,t.aF(e)))return;o=t.aC(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(n,e.source),e=t.aD(e),e=t.e(e,{source:n})),this._validate(t.y.layer,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.aC(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new t.j(new Error(`Cannot add layer "${n}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){const t=this._removedLayers[n];delete this._removedLayers[n],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.j(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.j(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,r={}){this._checkLoaded();const n=this.getLayer(e);if(n){if(!t.aG(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.y.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=t.aD(i),this._updateLayer(n)))}else this.fire(new t.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.aD(this.getLayer(e).filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.aG(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.aG(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this.sourceCaches[r];if(void 0===o)return void this.fire(new t.j(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&n?this.fire(new t.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,i)):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this.sourceCaches[r];if(void 0===n)return void this.fire(new t.j(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.j(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(s,e.id,i):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this.sourceCaches[i];if(void 0!==n)return"vector"!==n.getSource().type||r?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,e.id)):void this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.j(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.aH(this.sourceCaches,(t=>t.serialize())),i=this._serializeByIds(this._order),r=this.map.getTerrain()||void 0,n=this.stylesheet;return t.aI({version:n.version,name:n.name,metadata:n.metadata,light:n.light,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,sprite:n.sprite,glyphs:n.glyphs,transition:n.transition,sources:e,layers:i,terrain:r},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(e(o)){i[o]=n;for(const e of t){const t=e[o];if(t)for(const e of t)r.push(e)}}}r.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(i[e.layer.id]<o)break;n.push(e),r.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)n.push(e.feature)}}return n}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(t.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.j(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers();for(const t in this.sourceCaches)i.layers&&!n[t]||o.push(q(this.sourceCaches[t],this._layers,s,e,i,r));return this.placement&&o.push(function(t,e,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(W);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,t);for(const t in r){const e=a[t]=a[t]||[],n=r[t];n.sort(((t,e)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of n)e.push(t)}}for(const e in a)a[e].forEach((r=>{const n=r.feature,o=i[t[e].source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}));return a}(this._layers,s,this.sourceCaches,e,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.y.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this.sourceCaches[e];return r?function(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),r=[],n={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,e))}return r}(r,i):[]}addSourceType(t,e,i){return G(t)?i(new Error(`A source type called "${t}" already exists.`)):(((t,e)=>{j[t]=e})(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t.aG(e[i],r[i])){n=!0;break}if(!n)return;const o={now:t.h.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}_validate(e,i,r,n,o={}){return(!o||!1!==o.validate)&&Qt(this,e.call(t.y,t.e({key:i,style:this.serialize(),value:r,styleSpec:t.v},n)))}_remove(e=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(e)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(e,i,r,n,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this.sourceCaches[i.source];l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.h.now(),e.zoom))&&(this.pauseablePlacement=new Ht(e,this.map.terrain,this._order,o,i,r,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.h.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();const r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i);const r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,[""])}getResource(e,i,r){return t.m(i,r)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(t.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,r={},n){this._checkLoaded();const o=[{id:e,url:i}],s=[..._(this.stylesheet.sprite),...o];this._validate(t.y.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,n))}removeSprite(e){this._checkLoaded();const i=_(this.stylesheet.sprite);if(i.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;i.splice(i.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}else this.fire(new t.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return _(this.stylesheet.sprite)}setSprite(e,i={},r){this._checkLoaded(),e&&this._validate(t.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}}re.registerForPluginStateChange=t.aK;var ne=t.Q([{name:"a_pos",type:"Int16",components:2}]),oe="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const se={prelude:ae("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:ae("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ae("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ae("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:ae("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ae("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ae("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ae("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ae("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:ae("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:ae("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:ae("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:ae("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ae("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ae("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:ae("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:ae("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:ae("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ae("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:ae("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:ae("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:ae("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",oe),terrainDepth:ae("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",oe),terrainCoords:ae("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",oe)};function ae(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),n=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(n):n,a={};return{fragmentSource:t=t.replace(i,((t,e,i,r,n)=>(a[n]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return a[n]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:r,staticUniforms:s}}class le{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,r,n,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==r.length;for(let t=0;!c&&t<r.length;t++)this.boundPaintVertexBuffers[t]!==r[t]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,i,r,n,o,s,a,l):(t.bindVertexArray.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind())}freshBind(t,e,i,r,n,o,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,e.enableAttributes(u,t);for(const e of i)e.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,n);for(const e of i)e.bind(),e.setVertexAttribPointers(u,t,n);o&&(o.bind(),o.setVertexAttribPointers(u,t,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,n)),a&&(a.bind(),a.setVertexAttribPointers(u,t,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ce(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const r=t[i].split(" ");e.push(r.pop())}return e}class ue{constructor(e,i,r,n,o,s){const a=e.gl;this.program=a.createProgram();const l=ce(i.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=se.prelude.staticUniforms?ce(se.prelude.staticUniforms):[],p=i.staticUniforms?ce(i.staticUniforms):[],d=r?r.getBinderUniforms():[],f=h.concat(p).concat(d),m=[];for(const t of f)m.indexOf(t)<0&&m.push(t);const g=r?r.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;"),s&&g.push("#define TERRAIN3D;");const _=g.concat(se.prelude.fragmentSource,i.fragmentSource).join("\n"),y=g.concat(se.prelude.vertexSource,i.vertexSource).join("\n"),A=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(A,_),a.compileShader(A),!a.getShaderParameter(A,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(A)}`);a.attachShader(this.program,A);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(v,y),a.compileShader(v),!a.getShaderParameter(v,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(v)}`);a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(v),a.deleteShader(A);for(let t=0;t<m.length;t++){const e=m[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=n(e,x),this.terrainUniforms=((e,i)=>({u_depth:new t.aL(e,i.u_depth),u_terrain:new t.aL(e,i.u_terrain),u_terrain_dim:new t.aM(e,i.u_terrain_dim),u_terrain_matrix:new t.aN(e,i.u_terrain_matrix),u_terrain_unpack:new t.aO(e,i.u_terrain_unpack),u_terrain_exaggeration:new t.aM(e,i.u_terrain_exaggeration)}))(e,x),this.binderUniforms=r?r.getUniforms(e,x):[]}draw(t,e,i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_){const y=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(r),t.setColorMode(n),t.setCullFace(o),a){t.activeTexture.set(y.TEXTURE2),y.bindTexture(y.TEXTURE_2D,a.depthTexture),t.activeTexture.set(y.TEXTURE3),y.bindTexture(y.TEXTURE_2D,a.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(a[t])}for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);f&&f.setUniforms(t,this.binderUniforms,p,{zoom:d});let A=0;switch(e){case y.LINES:A=2;break;case y.TRIANGLES:A=3;break;case y.LINE_STRIP:A=1}for(const i of h.get()){const r=i.vaos||(i.vaos={});(r[l]||(r[l]=new le)).bind(t,this,c,f?f.getPaintVertexBuffers():[],u,i.vertexOffset,m,g,_),y.drawElements(e,i.primitiveLength*A,y.UNSIGNED_SHORT,i.primitiveOffset*A*2)}}}function he(t,e,i){const r=1/Ct(i,1,e.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,s=o*(i.tileID.canonical.x+i.tileID.wrap*n),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const pe=(e,i,r,n)=>{const o=i.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=function(){var e=new t.A(9);return t.A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();"viewport"===o.properties.get("anchor")&&function(t,e){var i=Math.sin(e),r=Math.cos(e);t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(l,-i.transform.angle),function(t,e,i){var r=e[0],n=e[1],o=e[2];t[0]=r*i[0]+n*i[3]+o*i[6],t[1]=r*i[1]+n*i[4]+o*i[7],t[2]=r*i[2]+n*i[5]+o*i[8]}(a,a,l);const c=o.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:n}},de=(e,i,r,n,o,s,a)=>t.e(pe(e,i,r,n),he(s,i,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),fe=t=>({u_matrix:t}),me=(e,i,r,n)=>t.e(fe(e),he(r,i,n)),ge=(t,e)=>({u_matrix:t,u_world:e}),_e=(e,i,r,n,o)=>t.e(me(e,i,r,n),{u_world:o}),ye=(t,e,i,r)=>{const n=t.transform;let o,s;if("map"===r.paint.get("circle-pitch-alignment")){const t=Ct(i,1,n.zoom);o=!0,s=[t,t]}else o=!1,s=n.pixelsToGLUnits;return{u_camera_to_center_distance:n.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:s}},Ae=(t,e,i)=>{const r=Ct(i,1,e.zoom),n=Math.pow(2,e.zoom-i.tileID.overscaledZ),o=i.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*n),e.pixelsToGLUnits[1]/(r*n)],u_overscale_factor:o}},ve=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),xe=t=>({u_matrix:t}),be=(t,e,i,r)=>({u_matrix:t,u_extrude_scale:Ct(e,1,i),u_intensity:r});function we(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.U(0,n/r).toLngLat().lat,new t.U(0,(n+1)/r).toLngLat().lat]}const Se=(t,e,i,r)=>{const n=t.transform;return{u_matrix:Ie(t,e,i,r),u_ratio:1/Ct(e,1,n.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/n.pixelsToGLUnits[0],1/n.pixelsToGLUnits[1]]}},Te=(e,i,r,n,o)=>t.e(Se(e,i,r,o),{u_image:0,u_image_height:n}),Ce=(t,e,i,r,n)=>{const o=t.transform,s=Ee(e,o);return{u_matrix:Ie(t,e,i,n),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Ct(e,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[s,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Me=(e,i,r,n,o,s)=>{const a=e.lineAtlas,l=Ee(i,e.transform),c="round"===r.layout.get("line-cap"),u=a.getDash(n.from,c),h=a.getDash(n.to,c),p=u.width*o.fromScale,d=h.width*o.toScale;return t.e(Se(e,i,r,s),{u_patternscale_a:[l/p,-u.height/2],u_patternscale_b:[l/d,-h.height/2],u_sdfgamma:a.width/(256*Math.min(p,d)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Ee(t,e){return 1/Ct(t,1,e.tileZoom)}function Ie(t,e,i,r){return t.translatePosMatrix(r?r.posMatrix:e.tileID.posMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Le=(t,e,i,r,n)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(s=n.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Pe(n.paint.get("raster-hue-rotate"))};var o,s};function Pe(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const ke=(t,e,i,r,n,o,s,a,l,c)=>{const u=n.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:u.cameraToCenterDistance,u_pitch:u.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:u.width/u.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+l,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},Ne=(e,i,r,n,o,s,a,l,c,u,h)=>{const p=o.transform;return t.e(ke(e,i,r,n,o,s,a,l,c,u),{u_gamma_scale:n?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:o.pixelRatio,u_is_halo:+h})},De=(e,i,r,n,o,s,a,l,c,u)=>t.e(Ne(e,i,r,n,o,s,a,l,!0,c,!0),{u_texsize_icon:u,u_texture_icon:1}),Oe=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),Re=(e,i,r,n,o,s)=>t.e(function(t,e,i,r){const n=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/Ct(r,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(n,s,r,o),{u_matrix:e,u_opacity:i}),Fe={fillExtrusion:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_lightpos:new t.aP(e,i.u_lightpos),u_lightintensity:new t.aM(e,i.u_lightintensity),u_lightcolor:new t.aP(e,i.u_lightcolor),u_vertical_gradient:new t.aM(e,i.u_vertical_gradient),u_opacity:new t.aM(e,i.u_opacity)}),fillExtrusionPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_lightpos:new t.aP(e,i.u_lightpos),u_lightintensity:new t.aM(e,i.u_lightintensity),u_lightcolor:new t.aP(e,i.u_lightcolor),u_vertical_gradient:new t.aM(e,i.u_vertical_gradient),u_height_factor:new t.aM(e,i.u_height_factor),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade),u_opacity:new t.aM(e,i.u_opacity)}),fill:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix)}),fillPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),fillOutline:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world)}),fillOutlinePattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world),u_image:new t.aL(e,i.u_image),u_texsize:new t.aQ(e,i.u_texsize),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),circle:(e,i)=>({u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_scale_with_map:new t.aL(e,i.u_scale_with_map),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_extrude_scale:new t.aQ(e,i.u_extrude_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_matrix:new t.aN(e,i.u_matrix)}),collisionBox:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pixels_to_tile_units:new t.aM(e,i.u_pixels_to_tile_units),u_extrude_scale:new t.aQ(e,i.u_extrude_scale),u_overscale_factor:new t.aM(e,i.u_overscale_factor)}),collisionCircle:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_inv_matrix:new t.aN(e,i.u_inv_matrix),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_viewport_size:new t.aQ(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.aR(e,i.u_color),u_matrix:new t.aN(e,i.u_matrix),u_overlay:new t.aL(e,i.u_overlay),u_overlay_scale:new t.aM(e,i.u_overlay_scale)}),clippingMask:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix)}),heatmap:(e,i)=>({u_extrude_scale:new t.aM(e,i.u_extrude_scale),u_intensity:new t.aM(e,i.u_intensity),u_matrix:new t.aN(e,i.u_matrix)}),heatmapTexture:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_world:new t.aQ(e,i.u_world),u_image:new t.aL(e,i.u_image),u_color_ramp:new t.aL(e,i.u_color_ramp),u_opacity:new t.aM(e,i.u_opacity)}),hillshade:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_latrange:new t.aQ(e,i.u_latrange),u_light:new t.aQ(e,i.u_light),u_shadow:new t.aR(e,i.u_shadow),u_highlight:new t.aR(e,i.u_highlight),u_accent:new t.aR(e,i.u_accent)}),hillshadePrepare:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_image:new t.aL(e,i.u_image),u_dimension:new t.aQ(e,i.u_dimension),u_zoom:new t.aM(e,i.u_zoom),u_unpack:new t.aO(e,i.u_unpack)}),line:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels)}),lineGradient:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_image:new t.aL(e,i.u_image),u_image_height:new t.aM(e,i.u_image_height)}),linePattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texsize:new t.aQ(e,i.u_texsize),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_image:new t.aL(e,i.u_image),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_scale:new t.aP(e,i.u_scale),u_fade:new t.aM(e,i.u_fade)}),lineSDF:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ratio:new t.aM(e,i.u_ratio),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.aQ(e,i.u_units_to_pixels),u_patternscale_a:new t.aQ(e,i.u_patternscale_a),u_patternscale_b:new t.aQ(e,i.u_patternscale_b),u_sdfgamma:new t.aM(e,i.u_sdfgamma),u_image:new t.aL(e,i.u_image),u_tex_y_a:new t.aM(e,i.u_tex_y_a),u_tex_y_b:new t.aM(e,i.u_tex_y_b),u_mix:new t.aM(e,i.u_mix)}),raster:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_tl_parent:new t.aQ(e,i.u_tl_parent),u_scale_parent:new t.aM(e,i.u_scale_parent),u_buffer_scale:new t.aM(e,i.u_buffer_scale),u_fade_t:new t.aM(e,i.u_fade_t),u_opacity:new t.aM(e,i.u_opacity),u_image0:new t.aL(e,i.u_image0),u_image1:new t.aL(e,i.u_image1),u_brightness_low:new t.aM(e,i.u_brightness_low),u_brightness_high:new t.aM(e,i.u_brightness_high),u_saturation_factor:new t.aM(e,i.u_saturation_factor),u_contrast_factor:new t.aM(e,i.u_contrast_factor),u_spin_weights:new t.aP(e,i.u_spin_weights)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texture:new t.aL(e,i.u_texture)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texture:new t.aL(e,i.u_texture),u_gamma_scale:new t.aM(e,i.u_gamma_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_is_halo:new t.aL(e,i.u_is_halo)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.aL(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aL(e,i.u_is_size_feature_constant),u_size_t:new t.aM(e,i.u_size_t),u_size:new t.aM(e,i.u_size),u_camera_to_center_distance:new t.aM(e,i.u_camera_to_center_distance),u_pitch:new t.aM(e,i.u_pitch),u_rotate_symbol:new t.aL(e,i.u_rotate_symbol),u_aspect_ratio:new t.aM(e,i.u_aspect_ratio),u_fade_change:new t.aM(e,i.u_fade_change),u_matrix:new t.aN(e,i.u_matrix),u_label_plane_matrix:new t.aN(e,i.u_label_plane_matrix),u_coord_matrix:new t.aN(e,i.u_coord_matrix),u_is_text:new t.aL(e,i.u_is_text),u_pitch_with_map:new t.aL(e,i.u_pitch_with_map),u_texsize:new t.aQ(e,i.u_texsize),u_texsize_icon:new t.aQ(e,i.u_texsize_icon),u_texture:new t.aL(e,i.u_texture),u_texture_icon:new t.aL(e,i.u_texture_icon),u_gamma_scale:new t.aM(e,i.u_gamma_scale),u_device_pixel_ratio:new t.aM(e,i.u_device_pixel_ratio),u_is_halo:new t.aL(e,i.u_is_halo)}),background:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_opacity:new t.aM(e,i.u_opacity),u_color:new t.aR(e,i.u_color)}),backgroundPattern:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_opacity:new t.aM(e,i.u_opacity),u_image:new t.aL(e,i.u_image),u_pattern_tl_a:new t.aQ(e,i.u_pattern_tl_a),u_pattern_br_a:new t.aQ(e,i.u_pattern_br_a),u_pattern_tl_b:new t.aQ(e,i.u_pattern_tl_b),u_pattern_br_b:new t.aQ(e,i.u_pattern_br_b),u_texsize:new t.aQ(e,i.u_texsize),u_mix:new t.aM(e,i.u_mix),u_pattern_size_a:new t.aQ(e,i.u_pattern_size_a),u_pattern_size_b:new t.aQ(e,i.u_pattern_size_b),u_scale_a:new t.aM(e,i.u_scale_a),u_scale_b:new t.aM(e,i.u_scale_b),u_pixel_coord_upper:new t.aQ(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.aQ(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.aM(e,i.u_tile_units_to_pixels)}),terrain:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texture:new t.aL(e,i.u_texture),u_ele_delta:new t.aM(e,i.u_ele_delta)}),terrainDepth:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_ele_delta:new t.aM(e,i.u_ele_delta)}),terrainCoords:(e,i)=>({u_matrix:new t.aN(e,i.u_matrix),u_texture:new t.aL(e,i.u_texture),u_terrain_coords_id:new t.aM(e,i.u_terrain_coords_id),u_ele_delta:new t.aM(e,i.u_ele_delta)})};class ze{constructor(t,e,i){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Be={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ue{constructor(t,e,i,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const r=e.attributes[this.attributes[i].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=e.attributes[n.name];void 0!==o&&t.vertexAttribPointer(o,n.components,t[Be[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ve=new WeakMap;function je(t){var e;if(Ve.has(t))return Ve.get(t);{const i=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return Ve.set(t,i),i}}class Ge{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ze extends Ge{getDefault(){return t.aT.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qe extends Ge{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class We extends Ge{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class He extends Ge{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Je extends Ge{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ke extends Ge{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class $e extends Ge{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ye extends Ge{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Xe extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Qe extends Ge{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ti extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class ei extends Ge{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ii extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class ri extends Ge{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ni extends Ge{getDefault(){return t.aT.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class oi extends Ge{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class si extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class ai extends Ge{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class li extends Ge{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ci extends Ge{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ui extends Ge{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class hi extends Ge{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pi extends Ge{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class di extends Ge{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fi extends Ge{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class mi extends Ge{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gi extends Ge{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _i extends Ge{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const i=this.gl;je(i)?i.bindVertexArray(t):null===(e=i.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class yi extends Ge{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ai extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class vi extends Ge{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xi extends Ge{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class bi extends xi{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class wi extends xi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Si extends xi{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ti{constructor(t,e,i,r,n){this.context=t,this.width=e,this.height=i;const o=t.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new bi(t,s),r)this.depthAttachment=n?new Si(t,s):new wi(t,s);else if(n)throw new Error("Stencil cannot be setted without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Ci{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Ci.Replace=[1,0],Ci.disabled=new Ci(Ci.Replace,t.aT.transparent,[!1,!1,!1,!1]),Ci.unblended=new Ci(Ci.Replace,t.aT.transparent,[!0,!0,!0,!0]),Ci.alphaBlended=new Ci([1,771],t.aT.transparent,[!0,!0,!0,!0]);class Mi{constructor(t){var e,i;if(this.gl=t,this.clearColor=new Ze(this),this.clearDepth=new qe(this),this.clearStencil=new We(this),this.colorMask=new He(this),this.depthMask=new Je(this),this.stencilMask=new Ke(this),this.stencilFunc=new $e(this),this.stencilOp=new Ye(this),this.stencilTest=new Xe(this),this.depthRange=new Qe(this),this.depthTest=new ti(this),this.depthFunc=new ei(this),this.blend=new ii(this),this.blendFunc=new ri(this),this.blendColor=new ni(this),this.blendEquation=new oi(this),this.cullFace=new si(this),this.cullFaceSide=new ai(this),this.frontFace=new li(this),this.program=new ci(this),this.activeTexture=new ui(this),this.viewport=new hi(this),this.bindFramebuffer=new pi(this),this.bindRenderbuffer=new di(this),this.bindTexture=new fi(this),this.bindVertexBuffer=new mi(this),this.bindElementBuffer=new gi(this),this.bindVertexArray=new _i(this),this.pixelStoreUnpack=new yi(this),this.pixelStoreUnpackPremultiplyAlpha=new Ai(this),this.pixelStoreUnpackFlipY=new vi(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),je(t)){this.HALF_FLOAT=t.HALF_FLOAT;const r=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(i=t.RGB16F)&&void 0!==i?i:null==r?void 0:r.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new ze(this,t,e)}createVertexBuffer(t,e,i){return new Ue(this,t,e,i)}createRenderbuffer(t,e,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),n}createFramebuffer(t,e,i,r){return new Ti(this,t,e,i,r)}clear({color:t,depth:e,stencil:i}){const r=this.gl;let n=0;t&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.aG(e.blendFunction,Ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var t;return je(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return je(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Ei{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ei.ReadOnly=!1,Ei.ReadWrite=!0,Ei.disabled=new Ei(519,Ei.ReadOnly,[0,1]);const Ii=7680;class Li{constructor(t,e,i,r,n,o){this.test=t,this.ref=e,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Li.disabled=new Li({func:519,mask:0},0,0,Ii,Ii,Ii);class Pi{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}let ki;function Ni(e,i,r,n,o,s,a){const l=e.context,c=l.gl,u=e.useProgram("collisionBox"),h=[];let p=0,d=0;for(let f=0;f<n.length;f++){const m=n[f],g=i.getTile(m),_=g.getBucket(r);if(!_)continue;let y=m.posMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(m.posMatrix,g,o,s));const A=a?_.textCollisionBox:_.iconCollisionBox,v=_.collisionCircleArray;if(v.length>0){const i=t.Z(),r=y;t.aU(i,_.placementInvProjMatrix,e.transform.glCoordMatrix),t.aU(i,i,_.placementViewportMatrix),h.push({circleArray:v,circleOffset:d,transform:r,invTransform:i,coord:m}),p+=v.length/4,d=p}A&&u.draw(l,c.LINES,Ei.disabled,Li.disabled,e.colorModeForRenderPass(),Pi.disabled,Ae(y,e.transform,g),e.style.map.terrain&&e.style.map.terrain.getTerrainData(m),r.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,null,e.transform.zoom,null,null,A.collisionVertexBuffer)}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.aV;m.resize(4*p),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,r=t.circleArray[i+0],n=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];m.emplace(g++,r,n,o,s,0),m.emplace(g++,r,n,o,s,1),m.emplace(g++,r,n,o,s,2),m.emplace(g++,r,n,o,s,3)}(!ki||ki.length<2*p)&&(ki=function(e){const i=2*e,r=new t.aX;r.resize(i),r._trim();for(let t=0;t<i;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(p));const _=l.createIndexBuffer(ki,!0),y=l.createVertexBuffer(m,t.aW.members,!0);for(const i of h){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(A=e.transform).cameraToCenterDistance,u_viewport_size:[A.width,A.height]};f.draw(l,c.TRIANGLES,Ei.disabled,Li.disabled,e.colorModeForRenderPass(),Pi.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(i.coord),r.id,y,_,t.S.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,e.transform.zoom,null,null,null)}var A;y.destroy(),_.destroy()}Pi.disabled=new Pi(!1,1029,2305),Pi.backCCW=new Pi(!0,1029,2305);const Di=t.ao(new Float32Array(16));function Oi(e,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=t.au(e);return new t.P((-(a-.5)*i/o+n[0])*s,(-(l-.5)*r/o+n[1])*s)}function Ri(e,i,r,n,o,s,a,l,c,u,h){const p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={};d.clear();for(let f=0;f<p.length;f++){const g=p.get(f),_=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:n[g.crossTileID];if(_){const n=new t.P(g.anchorX,g.anchorY),p=ct(n,r?a:s,h),f=ut(o.cameraToCenterDistance,p.signedDistanceFromCamera);let y=t.aj(e.textSizeData,c,g)*f/t.ap;r&&(y*=e.tilePixelRatio/l);const{width:A,height:v,anchor:x,textOffset:b,textBoxScale:w}=_,S=Oi(x,A,v,b,w,y),T=r?ct(n.add(S),s,h).point:p.point.add(i?S.rotate(-o.angle):S),C=e.allowVerticalPlacement&&g.placedOrientation===t.ai.vertical?Math.PI/2:0;for(let e=0;e<g.numGlyphs;e++)t.ak(d,T,C);u&&g.associatedIconIndex>=0&&(m[g.associatedIconIndex]={shiftedAnchor:T,angle:C})}else bt(g.numGlyphs,d)}if(u){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e);if(r.hidden)bt(r.numGlyphs,f);else{const i=m[e];if(i)for(let e=0;e<r.numGlyphs;e++)t.ak(f,i.shiftedAnchor,i.angle);else bt(r.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function Fi(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function zi(e,i,r,n,o,s,a,l,c,u,h,p){const d=e.context,f=d.gl,m=e.transform,g="map"===l,_="map"===c,y="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),A=g&&!_&&!y,v=!r.layout.get("symbol-sort-key").isConstant();let x=!1;const b=e.depthModeForSublayer(0,Ei.ReadOnly),w=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),S=[];for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const p=h.programConfigurations.get(r.id),d=o||c.sdfIcons,b=o?c.textSizeData:c.iconSizeData,T=_||0!==m.pitch,C=e.useProgram(Fi(d,o,c),p),M=t.ah(b,m.zoom),E=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let I,L,P,k,N=[0,0],D=null;if(o)L=n.glyphAtlasTexture,P=f.LINEAR,I=n.glyphAtlasTexture.size,c.iconsInText&&(N=n.imageAtlasTexture.size,D=n.imageAtlasTexture,k=T||e.options.rotating||e.options.zooming||"composite"===b.kind||"camera"===b.kind?f.LINEAR:f.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=n.imageAtlasTexture,P=d||e.options.rotating||e.options.zooming||t||T?f.LINEAR:f.NEAREST,I=n.imageAtlasTexture.size}const O=Ct(n,1,e.transform.zoom),R=at(l.posMatrix,_,g,e.transform,O),F=lt(l.posMatrix,_,g,e.transform,O),z=w&&c.hasTextData(),B="none"!==r.layout.get("icon-text-fit")&&z&&c.hasIconData();if(y){const t=e.style.map.terrain?(t,i)=>e.style.map.terrain.getElevation(l,t,i):null,i="map"===r.layout.get("text-rotation-alignment");pt(c,l.posMatrix,e,o,R,F,_,u,i,t)}const U=e.translatePosMatrix(l.posMatrix,n,s,a),V=y||o&&w||B?Di:R,j=e.translatePosMatrix(F,n,s,a,!0),G=d&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let Z;Z=d?c.iconsInText?De(b.kind,M,A,_,e,U,V,j,I,N):Ne(b.kind,M,A,_,e,U,V,j,o,I,!0):ke(b.kind,M,A,_,e,U,V,j,o,I);const q={program:C,buffers:h,uniformValues:Z,atlasTexture:L,atlasTextureIcon:D,atlasInterpolation:P,atlasInterpolationIcon:k,isSDF:d,hasHalo:G};if(v&&c.canOverlap){x=!0;const e=h.segments.get();for(const i of e)S.push({segments:new t.S([i]),sortKey:i.sortKey,state:q,terrainData:E})}else S.push({segments:h.segments,sortKey:0,state:q,terrainData:E})}x&&S.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of S){const i=t.state;if(d.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Bi(i.buffers,t.segments,r,e,i.program,b,h,p,n,t.terrainData)),n.u_is_halo=0}Bi(i.buffers,t.segments,r,e,i.program,b,h,p,i.uniformValues,t.terrainData)}}function Bi(t,e,i,r,n,o,s,a,l,c){const u=r.context;n.draw(u,u.gl.TRIANGLES,o,s,a,Pi.disabled,l,c,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,r.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Ui(t,e,i,r,n){if(!i||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const t=n.getPaintProperty(e);s=o[t],a=o[t]}s&&a&&t.setConstantPatternPositions(s,a)}function Vi(t,e,i,r,n,o,s){const a=t.context.gl,l="fill-pattern",c=i.paint.get(l),u=c&&c.constantOr(1),h=i.getCrossfadeParameters();let p,d,f,m,g;s?(d=u&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",p=a.LINES):(d=u?"fillPattern":"fill",p=a.TRIANGLES);const _=c.constantOr(null);for(const c of r){const r=e.getTile(c);if(u&&!r.patternsLoaded())continue;const y=r.getBucket(i);if(!y)continue;const A=y.programConfigurations.get(i.id),v=t.useProgram(d,A),x=t.style.map.terrain&&t.style.map.terrain.getTerrainData(c);u&&(t.context.activeTexture.set(a.TEXTURE0),r.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),A.updatePaintBuffers(h)),Ui(A,l,_,r,i);const b=x?c:null,w=t.translatePosMatrix(b?b.posMatrix:c.posMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"));if(s){m=y.indexBuffer2,g=y.segments2;const e=[a.drawingBufferWidth,a.drawingBufferHeight];f="fillOutlinePattern"===d&&u?_e(w,t,h,r,e):ge(w,e)}else m=y.indexBuffer,g=y.segments,f=u?me(w,t,h,r):fe(w);v.draw(t.context,p,n,t.stencilModeForClipping(c),o,Pi.disabled,f,x,i.id,y.layoutVertexBuffer,m,g,i.paint,t.transform.zoom,A)}}function ji(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c="fill-extrusion-pattern",u=i.paint.get(c),h=u.constantOr(1),p=i.getCrossfadeParameters(),d=i.paint.get("fill-extrusion-opacity"),f=u.constantOr(null);for(const u of r){const r=e.getTile(u),m=r.getBucket(i);if(!m)continue;const g=t.style.map.terrain&&t.style.map.terrain.getTerrainData(u),_=m.programConfigurations.get(i.id),y=t.useProgram(h?"fillExtrusionPattern":"fillExtrusion",_);h&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(p)),Ui(_,c,f,r,i);const A=t.translatePosMatrix(u.posMatrix,r,i.paint.get("fill-extrusion-translate"),i.paint.get("fill-extrusion-translate-anchor")),v=i.paint.get("fill-extrusion-vertical-gradient"),x=h?de(A,t,v,d,u,p,r):pe(A,t,v,d);y.draw(a,a.gl.TRIANGLES,n,o,s,Pi.backCCW,x,g,i.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,i.paint,t.transform.zoom,_,t.style.map.terrain&&m.centroidVertexBuffer)}}function Gi(t,e,i,r,n,o,s){const a=t.context,l=a.gl,c=i.fbo;if(!c)return;const u=t.useProgram("hillshade"),h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get()),u.draw(a,l.TRIANGLES,n,o,s,Pi.disabled,((t,e,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:r?r.posMatrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:we(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:o,u_accent:s}})(t,i,r,h?e:null),h,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}function Zi(e,i,r,n,o,s){const a=e.context,l=a.gl,c=i.dem;if(c&&c.data){const u=c.dim,h=c.stride,p=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(h),i.demTexture){const t=i.demTexture;t.update(p,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new A(a,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let d=i.fbo;if(!d){const t=new A(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),d=i.fbo=a.createFramebuffer(u,u,!0,!1),d.colorAttachment.set(t.texture)}a.bindFramebuffer.set(d.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,Pi.disabled,((e,i)=>{const r=i.stride,n=t.Z();return t.aS(n,0,t.N,-t.N,0,0,1),t.$(n,n,[0,-t.N,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}})(i.tileID,c),null,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function qi(e,i,r,n,o,s){const a=n.paint.get("raster-fade-duration");if(!s&&a>0){const n=t.h.now(),s=(n-e.timeAdded)/a,l=i?(n-i.timeAdded)/a:-1,c=r.getSource(),u=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),p=h&&e.refreshedUponExpiration?1:t.ad(h?s:1-l,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const Wi=new t.aT(1,0,0,1),Hi=new t.aT(0,1,0,1),Ji=new t.aT(0,0,1,1),Ki=new t.aT(1,0,1,1),$i=new t.aT(0,1,1,1);function Yi(t,e,i,r){Qi(t,0,e+i/2,t.transform.width,i,r)}function Xi(t,e,i,r){Qi(t,e-i/2,0,i,t.transform.height,r)}function Qi(t,e,i,r,n,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,i*t.pixelRatio,r*t.pixelRatio,n*t.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function tr(e,i,r){const n=e.context,o=n.gl,s=r.posMatrix,a=e.useProgram("debug"),l=Ei.disabled,c=Li.disabled,u=e.colorModeForRenderPass(),h="$debug",p=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);n.activeTexture.set(o.TEXTURE0);const d=i.getTileByID(r.key).latestRawTileData,f=Math.floor((d&&d.byteLength||0)/1024),m=i.getTile(r).tileSize,g=512/Math.min(m,512)*(r.overscaledZ/e.transform.zoom)*.5;let _=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(_+=` => ${r.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,r=t.context.gl,n=t.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(e,5,5),n.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${_} ${f}kB`),a.draw(n,o.TRIANGLES,l,c,Ci.alphaBlended,Pi.disabled,ve(s,t.aT.transparent,g),null,h,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),a.draw(n,o.LINE_STRIP,l,c,u,Pi.disabled,ve(s,t.aT.red),p,h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function er(t,e,i){const r=t.context,n=r.gl,o=t.colorModeForRenderPass(),s=new Ei(n.LEQUAL,Ei.ReadWrite,t.depthRangeFor3D),a=t.useProgram("terrain"),l=e.getTerrainMesh();r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]);for(const c of i){const i=t.renderToTexture.getTexture(c),u=e.getTerrainData(c.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.texture);const h={u_matrix:t.transform.calculatePosMatrix(c.tileID.toUnwrapped()),u_texture:0,u_ele_delta:e.getMeshFrameDelta(t.transform.zoom)};a.draw(r,n.TRIANGLES,s,Li.disabled,o,Pi.backCCW,h,u,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class ir{constructor(e,i){this.context=new Mi(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.Z(),renderTime:0},this.setup(),this.numSublayers=$.maxUnderzooming+$.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xt}resize(t,e,i){if(this.width=Math.floor(t*i),this.height=Math.floor(e*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const e=this.context,i=new t.a_;i.emplaceBack(0,0),i.emplaceBack(t.N,0),i.emplaceBack(0,t.N),i.emplaceBack(t.N,t.N),this.tileExtentBuffer=e.createVertexBuffer(i,ne.members),this.tileExtentSegments=t.S.simpleSegment(0,0,4,2);const r=new t.a_;r.emplaceBack(0,0),r.emplaceBack(t.N,0),r.emplaceBack(0,t.N),r.emplaceBack(t.N,t.N),this.debugBuffer=e.createVertexBuffer(r,ne.members),this.debugSegments=t.S.simpleSegment(0,0,4,5);const n=new t.V;n.emplaceBack(0,0,0,0),n.emplaceBack(t.N,0,t.N,0),n.emplaceBack(0,t.N,0,t.N),n.emplaceBack(t.N,t.N,t.N,t.N),this.rasterBoundsBuffer=e.createVertexBuffer(n,z.members),this.rasterBoundsSegments=t.S.simpleSegment(0,0,4,2);const o=new t.a_;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,ne.members),this.viewportSegments=t.S.simpleSegment(0,0,4,2);const s=new t.a$;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(s);const a=new t.b0;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const l=this.context.gl;this.stencilClearMode=new Li({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.Z();t.aS(r,0,this.width,this.height,0,0,1),t.a0(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,i.TRIANGLES,Ei.disabled,this.stencilClearMode,Ci.disabled,Pi.disabled,xe(r),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source;const i=this.context,r=i.gl;this.nextStencilID+e.length>256&&this.clearStencil(),i.setColorMode(Ci.disabled),i.setDepthMode(Ei.disabled);const n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of e){const e=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(t);n.draw(i,r.TRIANGLES,Ei.disabled,new Li({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),Ci.disabled,Pi.disabled,xe(t.posMatrix),o,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Li({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Li({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}stencilConfigForOverlap(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const t={};for(let i=0;i<n;i++)t[i+r]=new Li({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=n,[t,i]}return[{[r]:Li.disabled},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Ci([e.CONSTANT_COLOR,e.ONE],new t.aT(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Ci.unblended:Ci.alphaBlended}depthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return Ei.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ei(i||this.context.gl.LEQUAL,e,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.h.now()),this.imageManager.beginFrame();const r=this.style._order,n=this.style.sourceCaches,o={},s={},a={};for(const t in n){const e=n[t];e.used&&e.prepare(this.context),o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const e=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!t.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||e.length)&&(t.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,i){const r=e.context,n=r.gl,o=Ci.unblended,s=new Ei(n.LEQUAL,Ei.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.aT.transparent,depth:1});for(const t of l){const l=i.getTerrainData(t.tileID),u={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_ele_delta:i.getMeshFrameDelta(e.transform.zoom)};c.draw(r,n.TRIANGLES,s,Li.disabled,o,Pi.backCCW,u,l,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,i){const r=e.context,n=r.gl,o=Ci.unblended,s=new Ei(n.LEQUAL,Ei.ReadWrite,[0,1]),a=i.getTerrainMesh(),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.aT.transparent,depth:1}),i.coordsIndex=[];for(const t of c){const c=i.getTerrainData(t.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture);const h={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(e.transform.zoom)};u.draw(r,n.TRIANGLES,s,Li.disabled,o,Pi.backCCW,h,c,"terrain",a.vertexBuffer,a.indexBuffer,a.segments),i.coordsIndex.push(t.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const t of r){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=s[e.source];("custom"===e.type||i.length)&&this.renderLayer(this,n[e.source],e,i)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.aT.black:t.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],e=n[t.source],i=o[t.source];this._renderTileClippingMasks(t,i),this.renderLayer(this,e,t,i)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],e=n[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t))continue;const i=("symbol"===t.type?a:s)[t.source];this._renderTileClippingMasks(t,o[t.source]),this.renderLayer(this,e,t,i)}if(this.options.showTileBoundaries){const t=function(t,e){let i=null;const r=Object.values(t._layers).flatMap((i=>i.source&&!i.isHidden(e)?[t.sourceCaches[i.source]]:[])),n=r.filter((t=>"vector"===t.getSource().type)),o=r.filter((t=>"vector"!==t.getSource().type)),s=t=>{(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)};return n.forEach((t=>s(t))),i||o.forEach((t=>s(t))),i}(this.style,this.transform.zoom);t&&function(t,e,i){for(let r=0;r<i.length;r++)tr(t,e,i[r])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;Yi(t,t.transform.height-(e.top||0),3,Wi),Yi(t,e.bottom||0,3,Hi),Xi(t,e.left||0,3,Ji),Xi(t,t.transform.width-(e.right||0),3,Ki);const i=t.transform.centerPoint;!function(t,e,i,r){Qi(t,e-1,i-10,2,20,r),Qi(t,e-10,i-1,20,2,r)}(t,i.x,t.transform.height-i.y,$i)}(this),this.context.setDefault()}renderLayer(e,i,r,n){if(!r.isHidden(this.transform.zoom)&&("background"===r.type||"custom"===r.type||(n||[]).length))switch(this.id=r.id,r.type){case"symbol":!function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const s=Li.disabled,a=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,i,r,n,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const o of e){const e=n.getTile(o),s=e.getBucket(r);if(!s||!s.text||!s.text.segments.get().length)continue;const h=t.ah(s.textSizeData,l.zoom),p=Ct(e,1,i.transform.zoom),d=at(o.posMatrix,u,c,i.transform,p),f="none"!==r.layout.get("icon-text-fit")&&s.hasIconData();if(h){const t=Math.pow(2,l.zoom-e.tileID.overscaledZ);Ri(s,c,u,a,l,d,o.posMatrix,t,h,f,i.style.map.terrain?(t,e)=>i.style.map.terrain.getElevation(o,t,e):null)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&zi(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&zi(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(Ni(e,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Ni(e,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}(e,i,r,n,this.style.placement.variableOffsets);break;case"circle":!function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=!r.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Ei.ReadOnly),p=Li.disabled,d=e.colorModeForRenderPass(),f=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c)continue;const u=c.programConfigurations.get(r.id),h=e.useProgram("circle",u),p=c.layoutVertexBuffer,d=c.indexBuffer,m=e.style.map.terrain&&e.style.map.terrain.getTerrainData(s),g={programConfiguration:u,program:h,layoutVertexBuffer:p,indexBuffer:d,uniformValues:ye(e,s,a,r),terrainData:m};if(l){const e=c.segments.get();for(const i of e)f.push({segments:new t.S([i]),sortKey:i.sortKey,state:g})}else f.push({segments:c.segments,sortKey:0,state:g})}l&&f.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of f){const{programConfiguration:i,program:n,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l}=t.state;n.draw(c,u.TRIANGLES,h,p,d,Pi.disabled,a,l,r.id,o,s,t.segments,r.paint,e.transform.zoom,i)}}(e,i,r,n);break;case"heatmap":!function(e,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=Li.disabled,l=new Ci([s.ONE,s.ONE],t.aT.transparent,[!0,!0,!0,!0]);!function(t,e,i){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let n=i.heatmapFbo;if(n)r.bindTexture(r.TEXTURE_2D,n.colorAttachment.get()),t.bindFramebuffer.set(n.framebuffer);else{const o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),n=i.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1,!1),function(t,e,i,r){var n,o;const s=t.gl,a=null!==(n=t.HALF_FLOAT)&&void 0!==n?n:s.UNSIGNED_BYTE,l=null!==(o=t.RGBA16F)&&void 0!==o?o:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,l,e.width/4,e.height/4,0,s.RGBA,a,null),r.colorAttachment.set(i)}(t,e,o,n)}}(o,e,r),o.clear({color:t.aT.transparent});for(let t=0;t<n.length;t++){const c=n[t];if(i.hasRenderableParent(c))continue;const u=i.getTile(c),h=u.getBucket(r);if(!h)continue;const p=h.programConfigurations.get(r.id),d=e.useProgram("heatmap",p),{zoom:f}=e.transform;d.draw(o,s.TRIANGLES,Ei.disabled,a,l,Pi.disabled,be(c.posMatrix,u,f,r.paint.get("heatmap-intensity")),null,r.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,r.paint,e.transform.zoom,p)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const r=e.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new A(r,i.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Ei.disabled,Li.disabled,e.colorModeForRenderPass(),Pi.disabled,((e,i,r,n)=>{const o=t.Z();t.aS(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:i.paint.get("heatmap-opacity")}})(e,i),null,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,r))}(e,i,r,n);break;case"line":!function(e,i,r,n){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,Ei.ReadOnly),l=e.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),u=r.paint.get("line-pattern"),h=u.constantOr(1),p=r.paint.get("line-gradient"),d=r.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":p?"lineGradient":"line",m=e.context,g=m.gl;let _=!0;for(const o of n){const n=i.getTile(o);if(h&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;const y=s.programConfigurations.get(r.id),v=e.context.program.get(),x=e.useProgram(f,y),b=_||x.program!==v,w=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),S=u.constantOr(null);if(S&&n.imageAtlas){const t=n.imageAtlas,e=t.patternPositions[S.to.toString()],i=t.patternPositions[S.from.toString()];e&&i&&y.setConstantPatternPositions(e,i)}const T=w?o:null,C=h?Ce(e,n,r,d,T):c?Me(e,n,r,c,d,T):p?Te(e,n,r,s.lineClipsArray.length,T):Se(e,n,r,T);if(h)m.activeTexture.set(g.TEXTURE0),n.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),y.updatePaintBuffers(d);else if(c&&(b||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(p){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.ad(t.aY(s.maxLineLength/t.N*1024*n),256,m.maxTextureSize)}n.gradient=t.aZ({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new A(m,n.gradient,g.RGBA),n.version=r.gradientVersion,a=n.texture}m.activeTexture.set(g.TEXTURE0),a.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}x.draw(m,g.TRIANGLES,a,e.stencilModeForClipping(o),l,Pi.disabled,C,w,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,e.transform.zoom,y,s.layoutVertexBuffer2),_=!1}}(e,i,r,n);break;case"fill":!function(e,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.aT.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?Ei.ReadWrite:Ei.ReadOnly);Vi(e,i,r,n,t,a,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ei.ReadOnly);Vi(e,i,r,n,t,a,!0)}}(e,i,r,n);break;case"fill-extrusion":!function(t,e,i,r){const n=i.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){const o=new Ei(t.context.gl.LEQUAL,Ei.ReadWrite,t.depthRangeFor3D);if(1!==n||i.paint.get("fill-extrusion-pattern").constantOr(1))ji(t,e,i,r,o,Li.disabled,Ci.disabled),ji(t,e,i,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{const n=t.colorModeForRenderPass();ji(t,e,i,r,o,Li.disabled,n)}}}(e,i,r,n);break;case"hillshade":!function(t,e,i,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const n=t.context,o=t.depthModeForSublayer(0,Ei.ReadOnly),s=t.colorModeForRenderPass(),[a,l]="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r];for(const r of l){const n=e.getTile(r);void 0!==n.needsHillshadePrepare&&n.needsHillshadePrepare&&"offscreen"===t.renderPass?Zi(t,n,i,o,Li.disabled,s):"translucent"===t.renderPass&&Gi(t,r,n,i,o,a[r.overscaledZ],s)}n.viewport.set([0,0,t.width,t.height])}(e,i,r,n);break;case"raster":!function(t,e,i,r){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const n=t.context,o=n.gl,s=e.getSource(),a=t.useProgram("raster"),l=t.colorModeForRenderPass(),[c,u]=s instanceof B?[{},r]:t.stencilConfigForOverlap(r),h=u[u.length-1].overscaledZ,p=!t.options.moving;for(const r of u){const u=t.depthModeForSublayer(r.overscaledZ-h,1===i.paint.get("raster-opacity")?Ei.ReadWrite:Ei.ReadOnly,o.LESS),d=e.getTile(r);d.registerFadeDuration(i.paint.get("raster-fade-duration"));const f=e.findLoadedParent(r,0),m=qi(d,f,e,i,t.transform,t.style.map.terrain);let g,_;const y="nearest"===i.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;n.activeTexture.set(o.TEXTURE0),d.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(o.TEXTURE1),f?(f.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),g=Math.pow(2,f.tileID.overscaledZ-d.tileID.overscaledZ),_=[d.tileID.canonical.x*g%1,d.tileID.canonical.y*g%1]):d.texture.bind(y,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);const A=t.style.map.terrain&&t.style.map.terrain.getTerrainData(r),v=A?r:null,x=v?v.posMatrix:t.transform.calculatePosMatrix(r.toUnwrapped(),p),b=Le(x,_||[0,0],g||1,m,i);s instanceof B?a.draw(n,o.TRIANGLES,u,Li.disabled,l,Pi.disabled,b,A,i.id,s.boundsBuffer,t.quadTriangleIndexBuffer,s.boundsSegments):a.draw(n,o.TRIANGLES,u,c[r.overscaledZ],l,Pi.disabled,b,A,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}(e,i,r,n);break;case"background":!function(t,e,i,r){const n=i.paint.get("background-color"),o=i.paint.get("background-opacity");if(0===o)return;const s=t.context,a=s.gl,l=t.transform,c=l.tileSize,u=i.paint.get("background-pattern");if(t.isPatternMissing(u))return;const h=!u&&1===n.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==h)return;const p=Li.disabled,d=t.depthModeForSublayer(0,"opaque"===h?Ei.ReadWrite:Ei.ReadOnly),f=t.colorModeForRenderPass(),m=t.useProgram(u?"backgroundPattern":"background"),g=r||l.coveringTiles({tileSize:c,terrain:t.style.map.terrain});u&&(s.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));const _=i.getCrossfadeParameters();for(const e of g){const l=r?e.posMatrix:t.transform.calculatePosMatrix(e.toUnwrapped()),h=u?Re(l,o,t,u,{tileID:e,tileSize:c},_):Oe(l,o,n),g=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e);m.draw(s,a.TRIANGLES,d,p,f,Pi.disabled,h,g,i.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}(e,0,r,n);break;case"custom":!function(t,e,i){const r=t.context,n=i.implementation;if("offscreen"===t.renderPass){const e=n.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(n,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Li.disabled);const e="3d"===n.renderingMode?new Ei(t.context.gl.LEQUAL,Ei.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ei.ReadOnly);r.setDepthMode(e),n.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}(e,0,r)}}translatePosMatrix(e,i,r,n,o){if(!r[0]&&!r[1])return e;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:Ct(i,r[0],this.transform.zoom),o?r[1]:Ct(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.$(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}useProgram(t,e){this.cache=this.cache||{};const i=t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[i]||(this.cache[i]=new ue(this.context,se[t],e,Fe[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[i]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new A(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}class rr{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(e,i,r){const n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=1/(r=t.ag([],r,e))[3]/i*n;return t.b3(r,r,[o,o,1/r[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=function(t,e){var i=e[0],r=e[1],n=e[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}([],function(t,e,i){var r=e[0],n=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=n*l-o*a,t[1]=o*s-r*l,t[2]=r*a-n*s,t}([],m([],o[t[0]],o[t[1]]),m([],o[t[2]],o[t[1]]))),i=-((r=e)[0]*(n=o[t[1]])[0]+r[1]*n[1]+r[2]*n[2]);var r,n;return e.concat(i)}));return new rr(o,s)}}class nr{constructor(t,e){this.min=t,this.max=e,this.center=function(t,e,i){return t[0]=.5*e[0],t[1]=.5*e[1],t[2]=.5*e[2],t}([],function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}([],this.min,this.max))}quadrant(t){const e=[t%2==0,t<2],i=d(this.min),r=d(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],r[t]=e[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new nr(i,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(e){const i=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let r=!0;for(let n=0;n<e.planes.length;n++){const o=e.planes[n];let s=0;for(let e=0;e<i.length;e++)t.b4(o,i[e])>=0&&s++;if(0===s)return 0;s!==i.length&&(r=!1)}if(r)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<e.points.length;n++){const o=e.points[n][t]-this.min[t];i=Math.min(i,o),r=Math.max(r,o)}if(r<0||i>this.max[t]-this.min[t])return 0}return 1}}class or{constructor(t=0,e=0,i=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.B.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.B.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.B.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.B.number(e.right,i.right,r)),this}getCenter(e,i){const r=t.ad((this.left+e-this.right)/2,0,e),n=t.ad((this.top+i-this.bottom)/2,0,i);return new t.P(r,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new or(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class sr{constructor(e,i,r,n,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||!!o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new or,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const i=-t.b5(e,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=function(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}(),function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=r*-a+o*l,t[3]=n*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.ad(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.b6(0,e)];if(this._renderWorldCopies){const r=this.pointCoordinate(new t.P(0,0)),n=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.b6(r,e))}return i}coveringTiles(e){var i,r;let n=this.coveringZoomLevel(e);const o=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const s=this.pointCoordinate(this.getCameraPoint()),a=t.U.fromLngLat(this.center),l=Math.pow(2,n),c=[l*s.x,l*s.y,0],u=[l*a.x,l*a.y,0],h=rr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n);let p=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(p=n);const d=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,f=t=>({aabb:new nr([t*l,0,0],[(t+1)*l,l,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),m=[],_=[],y=n,A=e.reparseOverscaled?o:n;if(this._renderWorldCopies)for(let t=1;t<=3;t++)m.push(f(-t)),m.push(f(t));for(m.push(f(0));m.length>0;){const n=m.pop(),o=n.x,s=n.y;let a=n.fullyVisible;if(!a){const t=n.aabb.intersects(h);if(0===t)continue;a=2===t}const l=e.terrain?c:u,f=n.aabb.distanceX(l),v=n.aabb.distanceY(l),x=Math.max(Math.abs(f),Math.abs(v));if(n.zoom===y||x>d+(1<<y-n.zoom)-2&&n.zoom>=p){const e=y-n.zoom,i=c[0]-.5-(o<<e),r=c[1]-.5-(s<<e);_.push({tileID:new t.O(n.zoom===y?A:n.zoom,n.wrap,n.zoom,o,s),distanceSq:g([u[0]-.5-o,u[1]-.5-s]),tileDistanceToCamera:Math.sqrt(i*i+r*r)})}else for(let l=0;l<4;l++){const c=(o<<1)+l%2,u=(s<<1)+(l>>1),h=n.zoom+1;let p=n.aabb.quadrant(l);if(e.terrain){const o=new t.O(h,n.wrap,h,c,u),s=e.terrain.getMinMaxElevation(o),a=null!==(i=s.minElevation)&&void 0!==i?i:this.elevation,l=null!==(r=s.maxElevation)&&void 0!==r?r:this.elevation;p=new nr([p.min[0],p.min[1],a],[p.max[0],p.max[1],l])}m.push({aabb:p,zoom:h,x:c,y:u,wrap:n.wrap,fullyVisible:a})}}return _.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.ad(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.P(t.G(e.lng)*this.worldSize,t.H(i)*this.worldSize)}unproject(e){return new t.U(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const i=this.pointLocation(this.centerPoint,e),r=e.getElevationForLngLatZoom(i,this.tileZoom);if(!(this.elevation-r))return;const n=this.getCameraPosition(),o=t.U.fromLngLat(n.lngLat,n.altitude),s=t.U.fromLngLat(i,r),a=o.x-s.x,l=o.y-s.y,c=o.z-s.z,u=Math.sqrt(a*a+l*l+c*c),h=this.scaleZoom(this.cameraToCenterDistance/u/this.tileSize);this._elevation=r,this._center=i,this.zoom=h}setLocationAtPoint(e,i){const r=this.pointCoordinate(i),n=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),s=new t.U(o.x-(r.x-n.x),o.y-(r.y-n.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,e){return e?this.coordinatePoint(this.locationCoordinate(t),e.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,e){return this.coordinateLocation(this.pointCoordinate(t,e))}locationCoordinate(e){return t.U.fromLngLat(e)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(e,i){if(i){const t=i.pointCoordinate(e);if(null!=t)return t}const r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.ag(r,r,this.pixelMatrixInverse),t.ag(n,n,this.pixelMatrixInverse);const o=r[3],s=n[3],a=r[1]/o,l=n[1]/s,c=r[2]/o,u=n[2]/s,h=c===u?0:(0-c)/(u-c);return new t.U(t.B.number(r[0]/o,n[0]/s,h)/this.worldSize,t.B.number(a,l,h)/this.worldSize)}coordinatePoint(e,i=0,r=this.pixelMatrix){const n=[e.x*this.worldSize,e.y*this.worldSize,i,1];return t.ag(n,n,r),new t.P(n[0]/n[3],n[1]/n[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return(new k).extend(this.pointLocation(new t.P(0,e))).extend(this.pointLocation(new t.P(this.width,e))).extend(this.pointLocation(new t.P(this.width,this.height))).extend(this.pointLocation(new t.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new k([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,i=!1){const r=e.key,n=i?this._alignedPosMatrixCache:this._posMatrixCache;if(n[r])return n[r];const o=e.canonical,s=this.worldSize/this.zoomScale(o.z),a=o.x+Math.pow(2,o.z)*e.wrap,l=t.ao(new Float64Array(16));return t.$(l,l,[a*s,o.y*s,0]),t.a0(l,l,[s/t.N,s/t.N,1]),t.a1(l,i?this.alignedProjMatrix:this.projMatrix,l),n[r]=new Float32Array(l),n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,i,r,n,o=-90,s=90,a=-180,l=180;const c=this.size,u=this._unmodified;if(this.latRange){const i=this.latRange;o=t.H(i[1])*this.worldSize,s=t.H(i[0])*this.worldSize,e=s-o<c.y?c.y/(s-o):0}if(this.lngRange){const e=this.lngRange;a=t.b5(t.G(e[0])*this.worldSize,0,this.worldSize),l=t.b5(t.G(e[1])*this.worldSize,0,this.worldSize),l<a&&(l+=this.worldSize),i=l-a<c.x?c.x/(l-a):0}const h=this.point,p=Math.max(i||0,e||0);if(p)return this.center=this.unproject(new t.P(i?(l+a)/2:h.x,e?(s+o)/2:h.y)),this.zoom+=this.scaleZoom(p),this._unmodified=u,void(this._constraining=!1);if(this.latRange){const t=h.y,e=c.y/2;t-e<o&&(n=o+e),t+e>s&&(n=s-e)}if(this.lngRange){const e=(a+l)/2,i=t.b5(h.x,e-this.worldSize/2,e+this.worldSize/2),n=c.x/2;i-n<a&&(r=a+n),i+n>l&&(r=l-n)}void 0===r&&void 0===n||(this.center=this.unproject(new t.P(void 0!==r?r:h.x,void 0!==n?n:h.y)).wrap()),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=t.b7(1,this.center.lat)*this.worldSize;let n=t.ao(new Float64Array(16));t.a0(n,n,[this.width/2,-this.height/2,1]),t.$(n,n,[1,-1,0]),this.labelPlaneMatrix=n,n=t.ao(new Float64Array(16)),t.a0(n,n,[1,-1,1]),t.$(n,n,[-1,-1,0]),t.a0(n,n,[2/this.width,2/this.height,1]),this.glCoordMatrix=n;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this._minEleveationForCurrentTile),a=o-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?a:o,c=Math.PI/2+this._pitch,u=this._fov*(.5+e.y/this.height),h=Math.sin(u)*l/Math.sin(t.ad(Math.PI-c-u,.01,Math.PI-.01)),p=this.getHorizon(),d=2*Math.atan(p/this.cameraToCenterDistance)*(.5+e.y/(2*p)),f=Math.sin(d)*l/Math.sin(t.ad(Math.PI-c-d,.01,Math.PI-.01)),m=Math.min(h,f),g=1.01*(Math.cos(Math.PI/2-this._pitch)*m+l),_=this.height/50;n=new Float64Array(16),t.b8(n,this._fov,this.width/this.height,_,g),n[8]=2*-e.x/this.width,n[9]=2*e.y/this.height,t.a0(n,n,[1,-1,1]),t.$(n,n,[0,0,-this.cameraToCenterDistance]),t.b9(n,n,this._pitch),t.ae(n,n,this.angle),t.$(n,n,[-i,-r,0]),this.mercatorMatrix=t.a0([],n,[this.worldSize,this.worldSize,this.worldSize]),t.a0(n,n,[1,1,this._pixelPerMeter]),this.pixelMatrix=t.a1(new Float64Array(16),this.labelPlaneMatrix,n),t.$(n,n,[0,0,-this.elevation]),this.projMatrix=n,this.invProjMatrix=t.as([],n),this.pixelMatrix3D=t.a1(new Float64Array(16),this.labelPlaneMatrix,n);const y=this.width%2/2,A=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),b=i-Math.round(i)+v*y+x*A,w=r-Math.round(r)+v*A+x*y,S=new Float64Array(n);if(t.$(S,S,[b>.5?b-1:b,w>.5?w-1:w,0]),this.alignedProjMatrix=S,n=t.as(new Float64Array(16),this.pixelMatrix),!n)throw new Error("failed to invert matrix");this.pixelMatrixInverse=n,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new t.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.ag(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}getCameraQueryGeometry(e){const i=this.getCameraPoint();if(1===e.length)return[e[0],i];{let r=i.x,n=i.y,o=i.x,s=i.y;for(const t of e)r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y);return[new t.P(r,n),new t.P(o,n),new t.P(o,s),new t.P(r,s),new t.P(r,n)]}}}function ar(t,e){let i,r=!1,n=null,o=null;const s=()=>{n=null,r&&(t.apply(o,i),n=setTimeout(s,e),r=!1)};return(...t)=>(r=!0,o=this,i=t,n||s(),n)}class lr{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(t.length>=3&&!t.some((t=>isNaN(t)))){const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch(t){}},this._updateHash=ar(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),o=Math.round(e.lng*n)/n,s=Math.round(e.lat*n)/n,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===t?(e=!0,`${r}=${c}`):i})).filter((t=>t));return e||i.push(`${t}=${c}`),`#${i.join("&")}`}return`#${c}`}}const cr={linearity:.3,easing:t.ba(0,0,.3,1)},ur=t.e({deceleration:2500,maxSpeed:1400},cr),hr=t.e({deceleration:20,maxSpeed:1400},cr),pr=t.e({deceleration:1e3,maxSpeed:360},cr),dr=t.e({deceleration:1e3,maxSpeed:90},cr);class fr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.h.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.h.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=gr(i.pan.mag(),r,t.e({},ur,e||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,mr(n,o)}if(i.zoom){const t=gr(i.zoom,r,hr);n.zoom=this._map.transform.zoom+t.amount,mr(n,t)}if(i.bearing){const e=gr(i.bearing,r,pr);n.bearing=this._map.transform.bearing+t.ad(e.amount,-179,179),mr(n,e)}if(i.pitch){const t=gr(i.pitch,r,dr);n.pitch=this._map.transform.pitch+t.amount,mr(n,t)}if(n.zoom||n.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;n.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),t.e(n,{noMoveStart:!0})}}function mr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function gr(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.ad(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class _r extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n,o={}){const s=i.mousePos(r.getCanvasContainer(),n),a=r.unproject(s);super(e,t.e({point:s,lngLat:a,originalEvent:n},o)),this._defaultPrevented=!1,this.target=r}}class yr extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,n){const o="touchend"===e?n.changedTouches:n.touches,s=i.touchPos(r.getCanvasContainer(),o),a=s.map((t=>r.unproject(t))),l=s.reduce(((t,e,i,r)=>t.add(e.div(r.length))),new t.P(0,0));super(e,{points:s,point:l,lngLats:a,lngLat:r.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class Ar extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class vr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ar(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new _r(t.type,this._map,t))}mouseup(t){this._map.fire(new _r(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new _r(t.type,this._map,t))}dblclick(t){return this._firePreventable(new _r(t.type,this._map,t))}mouseover(t){this._map.fire(new _r(t.type,this._map,t))}mouseout(t){this._map.fire(new _r(t.type,this._map,t))}touchstart(t){return this._firePreventable(new yr(t.type,this._map,t))}touchmove(t){this._map.fire(new yr(t.type,this._map,t))}touchend(t){this._map.fire(new yr(t.type,this._map,t))}touchcancel(t){this._map.fire(new yr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new _r(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new _r(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class br{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(t.P.convert(e),this._map.terrain)}}class wr{constructor(t,e){this._map=t,this._tr=new br(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(i.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const r=e;if(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=r,this._box||(this._box=i.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(n.x,r.x),s=Math.max(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(n.y,r.y);i.setTransform(this._box,`translate(${o}px,${a}px)`),this._box.style.width=s-o+"px",this._box.style.height=l-a+"px"}mouseupWindow(e,r){if(!this._active)return;if(0!==e.button)return;const n=this._startPos,o=r;if(this.reset(),i.suppressClick(),n.x!==o.x||n.y!==o.y)return this._map.fire(new t.k("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,o,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(i.remove(this._box),this._box=null),i.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.k(e,{originalEvent:i}))}}function Sr(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const i={};for(let r=0;r<t.length;r++)i[t[r].identifier]=e[r];return i}class Tr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=Sr(r,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const r=Sr(i,e);for(const t in this.touches){const e=r[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Cr{constructor(t){this.singleTap=new Tr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const r=this.singleTap.touchend(t,e,i);if(r){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class Mr{constructor(t){this._tr=new br(t),this._zoomIn=new Cr({numTouches:1,numTaps:2}),this._zoomOut=new Cr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const r=this._zoomIn.touchend(t,e,i),n=this._zoomOut.touchend(t,e,i),o=this._tr;return r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:t})}):n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(n)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Er{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const r=e.length?e[0]:e;return!this._moved&&r.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(i,r))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&i.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ir={0:1,2:2};class Lr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=i.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const i=Ir[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton)}isValidEndEvent(t){return i.mouseButton(t)===this._eventButton}}class Pr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const kr=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=function(t){t.preventDefault()}},Nr=({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const n=new Lr({checkCorrectEvent:t=>0===i.mouseButton(t)&&t.ctrlKey||2===i.mouseButton(t)});return new Er({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*r}),moveStateManager:n,enable:t,assignEvents:kr})},Dr=({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const n=new Lr({checkCorrectEvent:t=>0===i.mouseButton(t)&&t.ctrlKey||2===i.mouseButton(t)});return new Er({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*r}),moveStateManager:n,enable:t,assignEvents:kr})};class Or{constructor(t,e){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0),setTimeout((()=>{this._cancelCooperativeMessage=!1}),200)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._map._cooperativeGestures&&(2===this._minTouches&&i.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,i.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(i.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=Sr(r,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const t in n){const e=n[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,n[t]=e)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[r,n]=this._firstTwoTouches,o=Fr(i,e,r),s=Fr(i,e,n);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,r){if(!this._firstTwoTouches)return;const[n,o]=this._firstTwoTouches,s=Fr(r,e,n),a=Fr(r,e,o);s&&a||(this._active&&i.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fr(t,e,i){for(let r=0;r<t.length;r++)if(t[r].identifier===i)return e[r]}function zr(t,e){return Math.log(t/e)/Math.LN2}class Br extends Rr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(zr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zr(this._distance,i),pinchAround:e}}}function Ur(t,e){return 180*t.angleWith(e)/Math.PI}class Vr extends Rr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ur(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=Ur(t,this._startVector);return Math.abs(i)<e}}function jr(t){return Math.abs(t.y)>Math.abs(t.x)}class Gr extends Rr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,jr(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const r=t[0].sub(this._lastPoints[0]),n=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,n=e.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return jr(t)&&jr(e)&&o}}const Zr={panStep:100,bearingStep:15,pitchStep:10};class qr{constructor(t){this._tr=new br(t);const e=Zr;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,r=0,n=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:Wr,zoom:e?Math.round(a.zoom)+e*(t.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wr(t){return t*(2-t)}const Hr=4.000244140625;class Jr{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new br(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!e[this._map._metaKey])return;e.preventDefault()}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.h.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Hr==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=i.mousePos(this._el,e),n=this._tr;this._around=t.L.convert(this._aroundCenter?n.center:n.unproject(r)),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Hr?this._wheelZoomRate:this._defaultZoomRate;let i=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==i&&(i=1/i);const r="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(r*i))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:e.zoom,r=this._startZoom,n=this._easing;let o,s=!1;if("wheel"===this._type&&r&&n){const e=Math.min((t.h.now()-this._lastWheelEventTime)/200,1),a=n(e);o=t.B.number(r,i,a),e<1?this._frameId||(this._frameId=!0):s=!0}else o=i,s=!0;return this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!s,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.bb;if(this._prevEase){const e=this._prevEase,r=(t.h.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.ba(o,s,.25,1)}return this._prevEase={start:t.h.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Kr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $r{constructor(t){this._tr=new br(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yr{constructor(){this._tap=new Cr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(this._tapTime){const r=e[0],n=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;n&&o?i.length>0&&(this._swipePoint=r,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(t,e,i)}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=e[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const r=this._tap.touchend(t,e,i);r&&(this._tapTime=t.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xr{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qr{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tn{constructor(t,e,i,r){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const en=t=>t.zoom||t.drag||t.pitch||t.rotate;class rn extends t.k{}function nn(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class on{constructor(t,e){this.handleWindowEvent=t=>{this.handleEvent(t,`${t.type}Window`)},this.handleEvent=(t,e)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===t.type?void 0:t,n={needsRenderFrame:!1},o={},s={},a=t.touches,l=a?this._getMapTouches(a):void 0,c=l?i.touchPos(this._el,l):i.mousePos(this._el,t);for(const{handlerName:i,handler:a,allowed:u}of this._handlers){if(!a.isEnabled())continue;let h;this._blockedByActive(s,u,i)?a.reset():a[e||t.type]&&(h=a[e||t.type](t,c,l),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||a.isActive())&&(s[i]=a)}const u={};for(const t in this._previousActiveHandlers)s[t]||(u[t]=r);this._previousActiveHandlers=s,(Object.keys(u).length||nn(n))&&(this._changes.push([n,o,u]),this._triggerRenderFrame()),(Object.keys(s).length||nn(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=n;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fr(t),this._bearingSnap=e.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,r]of this._listeners)i.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,e,r]of this._listeners)i.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new vr(e,t));const n=e.boxZoom=new wr(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const o=new Mr(e),s=new $r(e);e.doubleClickZoom=new Kr(s,o),this._add("tapZoom",o),this._add("clickZoom",s),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const a=new Yr;this._add("tapDragZoom",a);const l=e.touchPitch=new Gr(e);this._add("touchPitch",l),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const c=Nr(t),u=Dr(t);e.dragRotate=new Qr(t,c,u),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const h=(({enable:t,clickTolerance:e})=>{const r=new Lr({checkCorrectEvent:t=>0===i.mouseButton(t)&&!t.ctrlKey});return new Er({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:r,enable:t,assignEvents:kr})})(t),p=new Or(t,e);e.dragPan=new Xr(r,h,p),this._add("mousePan",h),this._add("touchPan",p,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const d=new Vr,f=new Br;e.touchZoomRotate=new tn(r,f,d,a),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",f,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const m=e.scrollZoom=new Jr(e,(()=>this._triggerRenderFrame()));this._add("scrollZoom",m,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const g=e.keyboard=new qr(e);this._add("keyboard",g),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new xr(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(en(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const r in t)if(r!==i&&(!e||e.indexOf(r)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.e(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.e(i,o),t.e(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(t,e,i){const r=this._map,n=r._getTransformForUpdate(),o=r.terrain;if(!(nn(t)||o&&this._terrainMovement))return this._fireEvents(e,i,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,pinchAround:h}=t;void 0!==h&&(u=h),r._stop(!0),u=u||r.transform.centerPoint;const p=n.pointLocation(s?u.sub(s):u);l&&(n.bearing+=l),c&&(n.pitch+=c),a&&(n.zoom+=a),o?this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?n.center=n.pointLocation(n.centerPoint.sub(s)):n.setLocationAtPoint(p,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,n.setLocationAtPoint(p,u),this._map.once("moveend",(()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,n.recalculateZoom(r.terrain)}))):n.setLocationAtPoint(p,u),r._applyUpdatedTransform(n),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(e,i,r){const n=en(this._eventsInProgress),o=en(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||r,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=en(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!e||!e.essential&&t.h.prefersReducedMotion?(this._map.fire(new t.k("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()):(i(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:l})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.k(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new rn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class sn extends t.E{constructor(e,i){super(),this._renderFrameCallback=()=>{const e=Math.min((t.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new t.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.e({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,r){return this.easeTo(t.e({zoom:e},i),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,r){return this.easeTo(t.e({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=k.convert(t);const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(e,i,r,n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const t=n.padding;n.padding={top:t,bottom:t,right:t,left:t}}n.padding=t.e(o,n.padding);const s=this.transform,a=s.padding,l=s.project(t.L.convert(e)),c=s.project(t.L.convert(i)),u=l.rotate(-r*Math.PI/180),h=c.rotate(-r*Math.PI/180),p=new t.P(Math.max(u.x,h.x),Math.max(u.y,h.y)),d=new t.P(Math.min(u.x,h.x),Math.min(u.y,h.y)),f=p.sub(d),m=(s.width-(a.left+a.right+n.padding.left+n.padding.right))/f.x,g=(s.height-(a.top+a.bottom+n.padding.top+n.padding.bottom))/f.y;if(g<0||m<0)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),n.maxZoom),y=t.P.convert(n.offset),A=new t.P((n.padding.left-n.padding.right)/2,(n.padding.top-n.padding.bottom)/2).rotate(r*Math.PI/180),v=y.add(A).mult(s.scale/s.zoomScale(_));return{center:s.unproject(l.add(c).div(2).sub(v)),zoom:_,bearing:r}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(e,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.P.convert(e)),this.transform.pointLocation(t.P.convert(i)),r,n),n,o)}_fitInternal(e,i,r){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=this._getTransformForUpdate();let n=!1,o=!1,s=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.L.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(s=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this._applyUpdatedTransform(r),this.fire(new t.k("movestart",i)).fire(new t.k("move",i)),n&&this.fire(new t.k("zoomstart",i)).fire(new t.k("zoom",i)).fire(new t.k("zoomend",i)),o&&this.fire(new t.k("rotatestart",i)).fire(new t.k("rotate",i)).fire(new t.k("rotateend",i)),s&&this.fire(new t.k("pitchstart",i)).fire(new t.k("pitch",i)).fire(new t.k("pitchend",i)),this.fire(new t.k("moveend",i))}calculateCameraOptionsFromTo(e,i,r,n=0){const o=t.U.fromLngLat(e,i),s=t.U.fromLngLat(r,n),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),p=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),d=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),zoom:p,pitch:f,bearing:d}}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.bb},e)).animate||!e.essential&&t.h.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let d=r.centerPoint.add(p);const f=r.pointLocation(d),m=t.L.convert(e.center||f);this._normalizeCenter(m);const g=r.project(f),_=r.project(m).sub(g),y=r.zoomScale(l-n);let A,v;e.around&&(A=t.L.convert(e.around),v=r.locationPoint(A));const x={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==n,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||u!==s,this._padding=!r.isPaddingEqual(h),this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,x),this.terrain&&this._prepareElevation(m),this._ease((f=>{if(this._zooming&&(r.zoom=t.B.number(n,l,f)),this._rotating&&(r.bearing=t.B.number(o,c,f)),this._pitching&&(r.pitch=t.B.number(s,u,f)),this._padding&&(r.interpolatePadding(a,h,f),d=r.centerPoint.add(p)),this.terrain&&!e.freezeElevation&&this._updateElevation(f),A)r.setLocationAtPoint(A,v);else{const t=r.zoomScale(r.zoom-n),e=l>n?Math.min(2,y):Math.max(.5,y),i=Math.pow(e,1-f),o=r.unproject(g.add(_.mult(f*i)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,d)}this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(t=>{this.terrain&&this._finalizeElevation(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,i||r.moving||this.fire(new t.k("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.k("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.k("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.k("pitchstart",e))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(i-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.elevation=t.B.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:i,zoom:r,pitch:n,bearing:o,elevation:s}=this.transformCameraUpdate(e);i&&(e.center=i),void 0!==r&&(e.zoom=r),void 0!==n&&(e.pitch=n),void 0!==o&&(e.bearing=o),void 0!==s&&(e.elevation=s),this.transform.apply(e)}_fireMoveEvents(e){this.fire(new t.k("move",e)),this._zooming&&this.fire(new t.k("zoom",e)),this._rotating&&this.fire(new t.k("rotate",e)),this._pitching&&this.fire(new t.k("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.k("zoomend",e)),n&&this.fire(new t.k("rotateend",e)),o&&this.fire(new t.k("pitchend",e)),this.fire(new t.k("moveend",e))}flyTo(e,i){if(!e.essential&&t.h.prefersReducedMotion){const r=t.F(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.bb},e);const r=this._getTransformForUpdate(),n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.ad(+e.zoom,r.minZoom,r.maxZoom):n,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,p=r.zoomScale(l-n),d=t.P.convert(e.offset);let f=r.centerPoint.add(d);const m=r.pointLocation(f),g=t.L.convert(e.center||m);this._normalizeCenter(g);const _=r.project(m),y=r.project(g).sub(_);let A=e.curve;const v=Math.max(r.width,r.height),x=v/p,b=y.mag();if("minZoom"in e){const i=t.ad(Math.min(e.minZoom,n,l),r.minZoom,r.maxZoom),o=v/r.zoomScale(i-n);A=Math.sqrt(o/b*2)}const w=A*A;function S(t){const e=(x*x-v*v+(t?-1:1)*w*w*b*b)/(2*(t?x:v)*w*b);return Math.log(Math.sqrt(e*e+1)-e)}function T(t){return(Math.exp(t)-Math.exp(-t))/2}function C(t){return(Math.exp(t)+Math.exp(-t))/2}const M=S(!1);let E=function(t){return C(M)/C(M+A*t)},I=function(t){return v*((C(M)*(T(e=M+A*t)/C(e))-T(M))/w)/b;var e},L=(S(!0)-M)/A;if(Math.abs(b)<1e-6||!isFinite(L)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,i);const t=x<v?-1:1;L=Math.abs(Math.log(x/v))/A,I=function(){return 0},E=function(e){return Math.exp(t*A*e)}}return e.duration="duration"in e?+e.duration:1e3*L/("screenSpeed"in e?+e.screenSpeed/A:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==c,this._pitching=u!==s,this._padding=!r.isPaddingEqual(h),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(g),this._ease((p=>{const m=p*L,A=1/E(m);r.zoom=1===p?l:n+r.scaleZoom(A),this._rotating&&(r.bearing=t.B.number(o,c,p)),this._pitching&&(r.pitch=t.B.number(s,u,p)),this._padding&&(r.interpolatePadding(a,h,p),f=r.centerPoint.add(d)),this.terrain&&!e.freezeElevation&&this._updateElevation(p);const v=1===p?g:r.unproject(_.add(y.mult(I(m))).mult(A));r.setLocationAtPoint(r.renderWorldCopies?v.wrap():v,f),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(()=>{this.terrain&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,r){!1===r.animate||0===r.duration?(e(1),i()):(this._easeStart=t.h.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=t.b5(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.L.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}class an{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=i.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=i.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=i.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){i.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const r=e[i];if(r.used||r.usedForTerrain){const e=r.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let r=i+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ln{constructor(t={}){this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=i.create("div","maplibregl-ctrl");const e=i.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){i.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class cn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const un={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var hn=t.Q([{name:"a_pos3d",type:"Int16",components:3}]);class pn extends t.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const r={};for(const n of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i}))r[n.key]=!0,this._renderableTilesKeys.push(n.key),this._tiles[n.key]||(n.posMatrix=new Float64Array(16),t.aS(n.posMatrix,0,t.N,0,t.N,0,1),this._tiles[n.key]=new H(n,this.tileSize));for(const t in this._tiles)r[t]||delete this._tiles[t]}freeRtt(t){for(const e in this._tiles){const i=this._tiles[e];(!t||i.tileID.equals(t)||i.tileID.isChildOf(t)||t.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(e){const i={};for(const r of this._renderableTilesKeys){const n=this._tiles[r].tileID;if(n.canonical.equals(e.canonical)){const n=e.clone();n.posMatrix=new Float64Array(16),t.aS(n.posMatrix,0,t.N,0,t.N,0,1),i[r]=n}else if(n.canonical.isChildOf(e.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=n.canonical.z-e.canonical.z,a=n.canonical.x-(n.canonical.x>>s<<s),l=n.canonical.y-(n.canonical.y>>s<<s),c=t.N>>s;t.aS(o.posMatrix,0,c,0,c,0,1),t.$(o.posMatrix,o.posMatrix,[-a*c,-l*c,0]),i[r]=o}else if(e.canonical.isChildOf(n.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=e.canonical.z-n.canonical.z,a=e.canonical.x-(e.canonical.x>>s<<s),l=e.canonical.y-(e.canonical.y>>s<<s),c=t.N>>s;t.aS(o.posMatrix,0,t.N,0,t.N,0,1),t.$(o.posMatrix,o.posMatrix,[a*c,l*c,0]),t.a0(o.posMatrix,o.posMatrix,[1/2**s,1/2**s,0]),i[r]=o}}return i}getSourceTile(t,e){const i=this.sourceCache._source;let r=t.overscaledZ-this.deltaZoom;if(r>i.maxzoom&&(r=i.maxzoom),r<i.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(r).key);let n=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!n||!n.dem)&&e)for(;r>=i.minzoom&&(!n||!n.dem);)n=this.sourceCache.getTileByID(t.scaledTo(r--).key);return n}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter((e=>e.timeAdded>=t))}}class dn{constructor(t,e,i){this.painter=t,this.sourceCache=new pn(e),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,r,n=t.N){var o;if(!(i>=0&&i<n&&r>=0&&r<n))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}([],[i/n*t.N,r/n*t.N],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),p=c[0]-u,d=c[1]-h;return a.get(u,h)*(1-p)*(1-d)+a.get(u+1,h)*p*(1-d)+a.get(u,h+1)*(1-p)*d+a.get(u+1,h+1)*p*d}getElevationForLngLatZoom(e,i){const{tileID:r,mercatorX:n,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(r,n%t.N,o%t.N,t.N)}getElevation(e,i,r,n=t.N){return this.getDEMElevation(e,i,r,n)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,i=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new A(e,i,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new A(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ao([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const t=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new A(t,i.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),i.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const r=i&&i+i.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.sourceCache.sourceCache._source.maxzoom;let n=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?n=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>n<<n),s=e.canonical.y-(e.canonical.y>>n<<n),a=t.bc(new Float64Array(16),[1/(t.N<<n),1/(t.N<<n),0]);t.$(a,a,[o*t.N,s*t.N,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){const e=this.painter,i=e.width/devicePixelRatio,r=e.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new A(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new A(e.context,{width:i,height:r,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=e.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,e=0;t<this._coordsTextureSize;t++)for(let r=0;r<this._coordsTextureSize;r++,e+=4)i[e+0]=255&r,i[e+1]=255&t,i[e+2]=r>>8<<4|t>>8,i[e+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),n=new A(e,r,e.gl.RGBA,{premultiply:!1});return n.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=n,n}pointCoordinate(e){const i=new Uint8Array(4),r=this.painter.context,n=r.gl;r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),n.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,n.RGBA,n.UNSIGNED_BYTE,i),r.bindFramebuffer.set(null);const o=i[0]+(i[2]>>4<<8),s=i[1]+((15&i[2])<<8),a=this.coordsIndex[255-i[3]],l=a&&this.sourceCache.getTileByID(a);if(!l)return null;const c=this._coordsTextureSize,u=(1<<l.tileID.canonical.z)*c;return new t.U(this._allowMercatorOverflow(e,(l.tileID.canonical.x*c+o)/u),(l.tileID.canonical.y*c+s)/u,this.getElevation(l.tileID,o,s,c))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,i=new t.bd,r=new t.b0,n=this.meshSize,o=t.N/n,s=n*n;for(let t=0;t<=n;t++)for(let e=0;e<=n;e++)i.emplaceBack(e*o,t*o,0);for(let t=0;t<s;t+=n+1)for(let e=0;e<n;e++)r.emplaceBack(e+t,n+e+t+1,n+e+t+2),r.emplaceBack(e+t,n+e+t+2,e+t+1);const a=i.length,l=a+2*(n+1);for(const e of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(r*o,e*t.N,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(l+t,l+t+1,l+t+3),r.emplaceBack(l+t,l+t+3,l+t+2),r.emplaceBack(a+t,a+t+3,a+t+1),r.emplaceBack(a+t,a+t+2,a+t+3);const c=i.length,u=c+2*(n+1);for(const e of[0,1])for(let r=0;r<=n;r++)for(const n of[0,1])i.emplaceBack(e*t.N,r*o,n);for(let t=0;t<2*n;t+=2)r.emplaceBack(c+t,c+t+1,c+t+3),r.emplaceBack(c+t,c+t+3,c+t+2),r.emplaceBack(u+t,u+t+3,u+t+1),r.emplaceBack(u+t,u+t+2,u+t+3);return this._mesh={indexBuffer:e.createIndexBuffer(r),vertexBuffer:e.createVertexBuffer(i,hn.members),segments:t.S.simpleSegment(0,0,i.length,r.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*t.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(t,e){var i;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(i=this.getMinMaxElevation(r).minElevation)&&void 0!==i?i:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,i={minElevation:null,maxElevation:null};return e&&e.dem&&(i.minElevation=e.dem.min*this.exaggeration,i.maxElevation=e.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(e,i){const r=t.U.fromLngLat(e.wrap()),n=(1<<i)*t.N,o=r.x*n,s=r.y*n,a=Math.floor(o/t.N),l=Math.floor(s/t.N);return{tileID:new t.O(i,0,i,a,l),mercatorX:o,mercatorY:s}}_allowMercatorOverflow(e,i){const r=e.x<this.painter.width/2;let n=t.bf(i);const o=this.painter.transform.center.lng;return r&&Math.sign(n)>0&&Math.sign(o)<0||!r&&Math.sign(n)<0&&Math.sign(o)>0?(n=360*Math.sign(o)+n,t.G(n)):i}}class fn{constructor(t,e,i){this._context=t,this._size=e,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const e=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new A(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),e.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),e.colorAttachment.set(i.texture),{id:t,fbo:e,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((e=>t.id!==e)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((t=>!t.inUse))}}const mn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class gn{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new fn(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((i=>!t._layers[i].isHidden(e))),this._coordsDescendingInv={};for(const e in t.sourceCaches){this._coordsDescendingInv[e]={};const i=t.sourceCaches[e].getVisibleCoordinates();for(const t of i){const i=this.terrain.sourceCache.getTerrainCoords(t);for(const t in i)this._coordsDescendingInv[e][t]||(this._coordsDescendingInv[e][t]=[]),this._coordsDescendingInv[e][t].push(i[t])}}this._coordsDescendingInvStr={};for(const e of t._order){const i=t._layers[e],r=i.source;if(mn[i.type]&&!this._coordsDescendingInvStr[r]){this._coordsDescendingInvStr[r]={};for(const t in this._coordsDescendingInv[r])this._coordsDescendingInvStr[r][t]=this._coordsDescendingInv[r][t].map((t=>t.key)).sort().join()}}for(const t of this._renderableTiles)for(const e in this._coordsDescendingInvStr){const i=this._coordsDescendingInvStr[e][t.tileID.key];i&&i!==t.rttCoords[e]&&(t.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const i=e.type,r=this.painter,n=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(mn[i]&&(this._prevType&&mn[this._prevType]||this._stacks.push([]),this._prevType=i,this._stacks[this._stacks.length-1].push(e.id),!n))return!0;if(mn[this._prevType]||mn[i]&&n){this._prevType=i;const e=this._stacks.length-1,n=this._stacks[e]||[];for(const i of this._renderableTiles){if(this.pool.isFull()&&(er(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(i),i.rtt[e]){const t=this.pool.getObjectForId(i.rtt[e].id);if(t.stamp===i.rtt[e].stamp){this.pool.useObject(t);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),i.rtt[e]={id:o.id,stamp:o.stamp},r.context.bindFramebuffer.set(o.fbo.framebuffer),r.context.clear({color:t.aT.transparent,stencil:0}),r.currentStencilSource=void 0;for(let t=0;t<n.length;t++){const e=r.style._layers[n[t]],s=e.source?this._coordsDescendingInv[e.source][i.tileID.key]:[i.tileID];r.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),r._renderTileClippingMasks(e,s),r.renderLayer(r,r.style.sourceCaches[e.source],e,s),e.source&&(i.rttCoords[e.source]=this._coordsDescendingInvStr[e.source][i.tileID.key])}}return er(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),mn[i]}return!1}}const _n=e,yn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},An=t=>{t.touchstart=t.dragStart,t.touchmoveWindow=t.dragMove,t.touchend=t.dragEnd},vn={showCompass:!0,showZoom:!0,visualizePitch:!1};class xn{constructor(e,r,n=!1){this.mousedown=e=>{this.startMouse(t.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),i.mousePos(this.element,e)),i.addEventListener(window,"mousemove",this.mousemove),i.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.moveMouse(t,i.mousePos(this.element,t))},this.mouseup=t=>{this.mouseRotate.dragEnd(t),this.mousePitch&&this.mousePitch.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.startTouch(t,this._startPos),i.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=i.touchPos(this.element,t.targetTouches)[0],this.moveTouch(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const o=e.dragRotate._mouseRotate.getClickTolerance(),s=e.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Nr({clickTolerance:o,enable:!0}),this.touchRotate=(({enable:t,clickTolerance:e,bearingDegreesPerPixelMoved:i=.8})=>{const r=new Pr;return new Er({clickTolerance:e,move:(t,e)=>({bearingDelta:(e.x-t.x)*i}),moveStateManager:r,enable:t,assignEvents:An})})({clickTolerance:o,enable:!0}),this.map=e,n&&(this.mousePitch=Dr({clickTolerance:s,enable:!0}),this.touchPitch=(({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5})=>{const r=new Pr;return new Er({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:r,enable:t,assignEvents:An})})({clickTolerance:s,enable:!0})),i.addEventListener(r,"mousedown",this.mousedown),i.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),i.addEventListener(r,"touchcancel",this.reset)}startMouse(t,e){this.mouseRotate.dragStart(t,e),this.mousePitch&&this.mousePitch.dragStart(t,e),i.disableDrag()}startTouch(t,e){this.touchRotate.dragStart(t,e),this.touchPitch&&this.touchPitch.dragStart(t,e),i.disableDrag()}moveMouse(t,e){const i=this.map,{bearingDelta:r}=this.mouseRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const{pitchDelta:r}=this.mousePitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}moveTouch(t,e){const i=this.map,{bearingDelta:r}=this.touchRotate.dragMove(t,e)||{};if(r&&i.setBearing(i.getBearing()+r),this.touchPitch){const{pitchDelta:r}=this.touchPitch.dragMove(t,e)||{};r&&i.setPitch(i.getPitch()+r)}}off(){const t=this.element;i.removeEventListener(t,"mousedown",this.mousedown),i.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),i.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.removeEventListener(window,"touchend",this.touchend),i.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){i.enableDrag(),i.removeEventListener(window,"mousemove",this.mousemove),i.removeEventListener(window,"mouseup",this.mouseup),i.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),i.removeEventListener(window,"touchend",this.touchend)}}let bn;function wn(e,i,r){if(e=new t.L(e.lng,e.lat),i){const n=new t.L(e.lng-360,e.lat),o=new t.L(e.lng+360,e.lat),s=r.locationPoint(e).distSqr(i);r.locationPoint(n).distSqr(i)<s?e=n:r.locationPoint(o).distSqr(i)<s&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const Sn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tn(t,e,i){const r=t.classList;for(const t in Sn)r.remove(`maplibregl-${i}-anchor-${t}`);r.add(`maplibregl-${i}-anchor-${e}`)}class Cn extends t.E{constructor(e){if(super(),this._onKeyPress=t=>{const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},this._update=t=>{if(!this._map)return;const e=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!e)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=wn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let r="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?r=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(r=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),t&&"moveend"!==t.type||(this._pos=this._pos.round()),i.setTransform(this._element,`${Sn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${r}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout((()=>{const t=this._map.unproject(this._pos),e=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=t.distanceTo(this._lngLat)>20*e?"0.2":"1.0",this._opacityTimeout=null}),100))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.k("dragstart"))),this.fire(new t.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.k("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=i.create("div"),this._element.setAttribute("aria-label","Map marker");const r=i.createNS("http://www.w3.org/2000/svg","svg"),n=41,o=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${n}px`),r.setAttributeNS(null,"width",`${o}px`),r.setAttributeNS(null,"viewBox",`0 0 ${o} ${n}`);const s=i.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"stroke","none"),s.setAttributeNS(null,"stroke-width","1"),s.setAttributeNS(null,"fill","none"),s.setAttributeNS(null,"fill-rule","evenodd");const a=i.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=i.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=i.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=i.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=i.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const p=i.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"fill","#000000");const d=i.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),p.appendChild(d);const f=i.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=i.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=i.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const _=i.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(_),a.appendChild(l),a.appendChild(u),a.appendChild(p),a.appendChild(f),a.appendChild(m),r.appendChild(a),r.setAttributeNS(null,"height",n*this._scale+"px"),r.setAttributeNS(null,"width",o*this._scale+"px"),this._element.appendChild(r),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),Tn(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),i.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.L.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,r=Math.abs(i)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-i+r)],"bottom-right":[-r,-1*(e-i+r)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Mn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let En=0,In=!1;const Ln={maxWidth:100,unit:"metric"};function Pn(t,e,i){const r=i&&i.maxWidth||100,n=t._container.clientHeight/2,o=t.unproject([0,n]),s=t.unproject([r,n]),a=o.distanceTo(s);if(i&&"imperial"===i.unit){const i=3.2808*a;i>5280?kn(e,r,i/5280,t._getUIString("ScaleControl.Miles")):kn(e,r,i,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?kn(e,r,a/1852,t._getUIString("ScaleControl.NauticalMiles")):a>=1e3?kn(e,r,a/1e3,t._getUIString("ScaleControl.Kilometers")):kn(e,r,a,t._getUIString("ScaleControl.Meters"))}function kn(t,e,i,r){const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i);t.style.width=e*(n/i)+"px",t.innerHTML=`${n}&nbsp;${r}`}const Nn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Dn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function On(e){if(e){if("number"==typeof e){const i=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(i,i),"top-right":new t.P(-i,i),bottom:new t.P(0,-e),"bottom-left":new t.P(i,-i),"bottom-right":new t.P(-i,-i),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const i=t.P.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return On(new t.P(0,0))}const Rn={extend:(e,...i)=>t.e(e,...i),run(t){t()},logToElement(t,e=!1,i="log"){const r=window.document.getElementById(i);r&&(e&&(r.innerHTML=""),r.innerHTML+=`<br>${t}`)}},Fn=e;class zn{static get version(){return Fn}static get workerCount(){return tt.workerCount}static set workerCount(t){tt.workerCount=t}static get maxParallelImageRequests(){return t.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(e){t.c.MAX_PARALLEL_IMAGE_REQUESTS=e}static get workerUrl(){return t.c.WORKER_URL}static set workerUrl(e){t.c.WORKER_URL=e}static addProtocol(e,i){t.c.REGISTERED_PROTOCOLS[e]=i}static removeProtocol(e){delete t.c.REGISTERED_PROTOCOLS[e]}}return zn.Map=class extends sn{constructor(e){if(t.bg.mark(t.bh.create),null!=(e=t.e({},yn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new sr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=e=>{e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._cooperativeGestures=e.cooperativeGestures,this._metaKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new cn,this._controls=[],this._mapId=t.a2(),this._locale=t.e({},un,e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this._imageQueueHandle=c.addThrottleControl((()=>this.isMoving())),this._requestManager=new h(e.transformRequest),"string"==typeof e.container){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=ar((t=>{this._trackResize&&!this._removed&&this.resize(t)._update()}),50);this._resizeObserver=new ResizeObserver((i=>{t?e(i):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new on(this,e),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=e.hash&&new lr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new an({customAttribution:e.customAttribution})),e.maplibreLogo&&this.addControl(new ln,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.k(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.k(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.k("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,i,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,i,r)}resize(e){var i;const r=this._containerDimensions(),n=r[0],o=r[1],s=this._getClampedPixelRatio(n,o);if(this._resizeCanvas(n,o,s),this.painter.resize(n,o,s),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(n,o);this._resizeCanvas(n,o,e),this.painter.resize(n,o,e)}this.transform.resize(n,o),null===(i=this._requestedCameraState)||void 0===i||i.resize(n,o);const a=!this._moving;return a&&(this.stop(),this.fire(new t.k("movestart",e)).fire(new t.k("move",e))),this.fire(new t.k("resize",e)),a&&this.fire(new t.k("moveend",e)),this}_getClampedPixelRatio(t,e){const{0:i,1:r}=this._maxCanvasSize,n=this.getPixelRatio(),o=t*n,s=e*n;return Math.min(o>i?i/o:1,s>r?r/s:1)*n}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(k.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(t){return this._cooperativeGestures=t,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(e){return this.transform.locationPoint(t.L.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.pointLocation(t.P.convert(e),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let r=!1;const n=n=>{const o=this.getLayer(e)?this.queryRenderedFeatures(n.point,{layers:[e]}):[];o.length?r||(r=!0,i.call(this,new _r(t,this,n.originalEvent,{features:o}))):r=!1};return{layer:e,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const n=n=>{(this.getLayer(e)?this.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?r=!0:r&&(r=!1,i.call(this,new _r(t,this,n.originalEvent)))},o=e=>{r&&(r=!1,i.call(this,new _r(t,this,e.originalEvent)))};return{layer:e,listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=t=>{const r=this.getLayer(e)?this.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,i.call(this,t),delete t.features)};return{layer:e,listener:i,delegates:{[t]:r}}}}on(t,e,i){if(void 0===i)return super.on(t,e);const r=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const t in r.delegates)this.on(t,r.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);const r=this._createDelegatedListener(t,e,i);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&(r=>{const n=this._delegatedListeners[t];for(let t=0;t<n.length;t++){const r=n[t];if(r.layer===e&&r.listener===i){for(const t in r.delegates)this.off(t,r.delegates[t]);return n.splice(t,1),this}}})(),this)}queryRenderedFeatures(e,i){if(!this.style)return[];let r;const n=e instanceof t.P||Array.isArray(e),o=n?e:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(n?{}:e)||{},o instanceof t.P||"number"==typeof o[0])r=[t.P.convert(o)];else{const e=t.P.convert(o[0]),i=t.P.convert(o[1]);r=[e,new t.P(i.x,e.y),i,new t.P(e.x,i.y),e]}return this.style.queryRenderedFeatures(r,i,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(t,e)));const i=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new re(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,i):this.style.loadJSON(t,e,i),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new re(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.transformRequest(e,u.Style);t.f(r,((e,r)=>{e?this.fire(new t.j(e)):r&&this._updateDiff(r,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e,i)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(e){const i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.j(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const i=this.style.sourceCaches[e.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);for(const i in this.style._layers){const r=this.style._layers[i];"hillshade"===r.type&&r.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dn(this.painter,i,e),this.painter.renderToTexture=new gn(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=t=>{"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new t.k("terrain",{terrain:e})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,i,r={}){const{pixelRatio:n=1,sdf:o=!1,stretchX:s,stretchY:a,content:l}=r;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||t.a(i))){if(void 0===i.width||void 0===i.height)return this.fire(new t.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:c,data:u}=i,h=i;return this.style.addImage(e,{data:new t.R({width:r,height:c},new Uint8Array(u)),pixelRatio:n,stretchX:s,stretchY:a,content:l,sdf:o,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e),this}}{const{width:r,height:c,data:u}=t.h.getImageData(i);this.style.addImage(e,{data:new t.R({width:r,height:c},u),pixelRatio:n,stretchX:s,stretchY:a,content:l,sdf:o,version:0})}}updateImage(e,i){const r=this.style.getImage(e);if(!r)return this.fire(new t.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||t.a(i)?t.h.getImageData(i):i,{width:o,height:s,data:a}=n;if(void 0===o||void 0===s)return this.fire(new t.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||s!==r.data.height)return this.fire(new t.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const l=!(i instanceof HTMLImageElement||t.a(i));return r.data.replace(a,l),this.style.updateImage(e,r),this}getImage(t){return this.style.getImage(t)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.j(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){c.getImage(this._requestManager.transformRequest(t,u.Image),e)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,r={}){return this.style.setPaintProperty(t,e,i,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,r={}){return this.style.setLayoutProperty(t,e,i,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,i,(t=>{t||this._update(!0)})),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,(t=>{t||this._update(!0)})),this}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=i.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=i.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),n=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],n);const o=this._controlContainer=i.create("div","maplibregl-control-container",t),s=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{s[t]=i.create("div",`maplibregl-ctrl-${t} `,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=i.create("div","maplibregl-cooperative-gesture-screen",this._container);let t="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(t="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${t}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){i.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(t,e,i){this._canvas.width=Math.floor(i*t),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const t={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{e={requestedAttributes:t},i&&(e.statusMessage=i.statusMessage,e.type=i.type)}),{once:!0});const i=this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t);if(!i){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new ir(i,this.transform),r.testSupport(i)}_onCooperativeGesture(t,e,i){return!e&&i<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout((()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")}),100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(e){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=t.h.now();this.style.zoomHistory.update(e,n);const o=new t.a8(e,{now:n,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),s=o.crossFadingFactor();1===s&&s===this._crossFadingFactor||(r=!0,this._crossFadingFactor=s),this.style.update(o)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new t.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.bg.mark(t.bh.load),this.fire(new t.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const n=this._sourcesDirty||this._styleDirty||this._placementDirty;return n||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.k("idle")),!this._loaded||this._fullyLoaded||n||(this._fullyLoaded=!0,t.bg.mark(t.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),c.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),i.remove(this._canvasContainer),i.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),t.bg.clearMetrics(),this._removed=!0,this.fire(new t.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=t.h.frame((e=>{t.bg.frame(e),this._frame=null,this._render(e)})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return _n}getCameraTargetElevation(){return this.transform.elevation}},zn.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,e)=>{const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)},this.options=t.e({},vn,e),this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),i.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),i.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=i.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){i.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const r=i.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r}},zn.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new t.L(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.e({bearing:n},this.options.fitBoundsOptions),s=k.fromLngLat(i,r);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new t.L(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&In)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=i.create("button","maplibregl-ctrl-geolocate",this._container),i.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=i.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cn({element:this._dotElement}),this._circleElement=i.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.k("trackuserlocationend")))}))}},this.options=t.e({},Mn,e)}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,e=!1){void 0===bn||e?void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then((e=>{bn="denied"!==e.state,t(bn)})).catch((()=>{bn=!!window.navigator.geolocation,t(bn)})):(bn=!!window.navigator.geolocation,t(bn)):t(bn)}(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),i.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,En=0,In=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),i=t.getNorthEast(),r=e.distanceTo(i),n=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":En--,In=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),En++,En>1?(t={maximumAge:6e5,timeout:0},In=!0):(t=this.options.positionOptions,In=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},zn.AttributionControl=an,zn.LogoControl=ln,zn.ScaleControl=class{constructor(e){this._onMove=()=>{Pn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Pn(this._map,this._container,this.options)},this.options=t.e({},Ln,e)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){i.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},zn.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){i.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=i.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);i.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new t.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},zn.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=t}onAdd(t){return this._map=t,this._container=i.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=i.create("button","maplibregl-ctrl-terrain",this._container),i.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){i.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},zn.Popup=class extends t.E{constructor(e){super(),this.remove=()=>(this._content&&i.remove(this._content),this._container&&(i.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=i.create("div","maplibregl-popup",this._map.getContainer()),this._tip=i.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wn(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const e=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let r=this.options.anchor;const n=On(this.options.offset);if(!r){const t=this._container.offsetWidth,i=this._container.offsetHeight;let o;o=e.y+n.bottom.y<i?["top"]:e.y>this._map.transform.height-i?["bottom"]:[],e.x<t/2?o.push("left"):e.x>this._map.transform.width-t/2&&o.push("right"),r=0===o.length?"bottom":o.join("-")}const o=e.add(n[r]).round();i.setTransform(this._container,`${Sn[r]} translate(${o.x}px,${o.y}px)`),Tn(this._container,r,"popup")},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Nn),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.L.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=t;r=i.firstChild,r;)e.appendChild(r);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=i.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){this._container&&this._container.classList.add(t)}removeClassName(t){this._container&&this._container.classList.remove(t)}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}_createCloseButton(){this.options.closeButton&&(this._closeButton=i.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Dn);t&&t.focus()}},zn.Marker=Cn,zn.Style=re,zn.LngLat=t.L,zn.LngLatBounds=k,zn.Point=t.P,zn.MercatorCoordinate=t.U,zn.Evented=t.E,zn.AJAXError=t.bi,zn.config=t.c,zn.CanvasSource=V,zn.GeoJSONSource=F,zn.ImageSource=B,zn.RasterDEMTileSource=R,zn.RasterTileSource=O,zn.VectorTileSource=D,zn.VideoSource=U,zn.setRTLTextPlugin=t.bj,zn.getRTLTextPluginStatus=t.bk,zn.prewarm=function(){rt().acquire(Q)},zn.clearPrewarmedResources=function(){const t=it;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Q),it=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Rn.extend(zn,{isSafari:t.ac,getPerformanceMetrics:t.bg.getPerformanceMetrics}),zn})),i}()},54869:(t,e,i)=>{"use strict";function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}i.d(e,{aH:()=>a}),"function"==typeof SuppressedError&&SuppressedError;var n=r((function t(e,i){if(e===i)return!0;if(e&&i&&"object"==typeof e&&"object"==typeof i){if(e.constructor!==i.constructor)return!1;var r,n,o;if(Array.isArray(e)){if((r=e.length)!=i.length)return!1;for(n=r;0!=n--;)if(!t(e[n],i[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===i.source&&e.flags===i.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===i.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===i.toString();if((r=(o=Object.keys(e)).length)!==Object.keys(i).length)return!1;for(n=r;0!=n--;)if(!Object.prototype.hasOwnProperty.call(i,o[n]))return!1;for(n=r;0!=n--;){var s=o[n];if(!t(e[s],i[s]))return!1}return!0}return e!=e&&i!=i}));const o="__googleMapsScriptId";var s;!function(t){t[t.INITIALIZED=0]="INITIALIZED",t[t.LOADING=1]="LOADING",t[t.SUCCESS=2]="SUCCESS",t[t.FAILURE=3]="FAILURE"}(s||(s={}));class a{constructor({apiKey:t,authReferrerPolicy:e,channel:i,client:r,id:s=o,language:l,libraries:c=[],mapIds:u,nonce:h,region:p,retries:d=3,url:f="https://maps.googleapis.com/maps/api/js",version:m}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=t,this.authReferrerPolicy=e,this.channel=i,this.client=r,this.id=s||o,this.language=l,this.libraries=c,this.mapIds=u,this.nonce=h,this.region=p,this.retries=d,this.url=f,this.version=m,a.instance){if(!n(this.options,a.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(a.instance.options)}`);return a.instance}a.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?s.FAILURE:this.done?s.SUCCESS:this.loading?s.LOADING:s.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let t=this.url;return t+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(t+=`&key=${this.apiKey}`),this.channel&&(t+=`&channel=${this.channel}`),this.client&&(t+=`&client=${this.client}`),this.libraries.length>0&&(t+=`&libraries=${this.libraries.join(",")}`),this.language&&(t+=`&language=${this.language}`),this.region&&(t+=`&region=${this.region}`),this.version&&(t+=`&v=${this.version}`),this.mapIds&&(t+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(t+=`&auth_referrer_policy=${this.authReferrerPolicy}`),t}deleteScript(){const t=document.getElementById(this.id);t&&t.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise(((t,e)=>{this.loadCallback((i=>{i?e(i.error):t(window.google)}))}))}importLibrary(t){return this.execute(),google.maps.importLibrary(t)}loadCallback(t){this.callbacks.push(t),this.execute()}setScript(){var t,e;if(document.getElementById(this.id))return void this.callback();const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach((t=>!i[t]&&delete i[t])),(null===(e=null===(t=null===window||void 0===window?void 0:window.google)||void 0===t?void 0:t.maps)||void 0===e?void 0:e.importLibrary)||(t=>{let e,i,r,n="The Google Maps JavaScript API",o="google",s="importLibrary",a="__ib__",l=document,c=window;c=c[o]||(c[o]={});const u=c.maps||(c.maps={}),h=new Set,p=new URLSearchParams,d=()=>e||(e=new Promise(((s,c)=>{return d=this,f=void 0,g=function*(){var d;for(r in yield i=l.createElement("script"),i.id=this.id,p.set("libraries",[...h]+""),t)p.set(r.replace(/[A-Z]/g,(t=>"_"+t[0].toLowerCase())),t[r]);p.set("callback",o+".maps."+a),i.src=this.url+"?"+p,u[a]=s,i.onerror=()=>e=c(Error(n+" could not load.")),i.nonce=this.nonce||(null===(d=l.querySelector("script[nonce]"))||void 0===d?void 0:d.nonce)||"",l.head.append(i)},new((m=void 0)||(m=Promise))((function(t,e){function i(t){try{n(g.next(t))}catch(t){e(t)}}function r(t){try{n(g.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof m?n:new m((function(t){t(n)}))).then(i,r)}n((g=g.apply(d,f||[])).next())}));var d,f,m,g})));u[s]?console.warn(n+" only loads once. Ignoring:",t):u[s]=(t,...e)=>h.add(t)&&d().then((()=>u[s](t,...e)))})(i);const r=this.libraries.map((t=>this.importLibrary(t)));r.length||r.push(this.importLibrary("core")),Promise.all(r).then((()=>this.callback()),(t=>{const e=new ErrorEvent("error",{error:t});this.loadErrorCallback(e)}))}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(t){if(this.errors.push(t),this.errors.length<=this.retries){const t=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${t} ms.`),setTimeout((()=>{this.deleteScript(),this.setScript()}),t)}else this.onerrorEvent=t,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach((t=>{t(this.onerrorEvent)})),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading||(this.loading=!0,this.setScript())}}}},26494:(t,e,i)=>{"use strict";i.d(e,{$W:()=>r,Gj:()=>d,Hu:()=>c,N0:()=>h,Re:()=>a,rF:()=>u,ub:()=>l}),i(82807);const r=new class{constructor(){this._apiKey="",this._fetch="undefined"!=typeof self?fetch.bind(self):"undefined"!=typeof global&&global.fetch?global.fetch:null,this.tileCacheSize=200}set apiKey(t){this._apiKey=t}get apiKey(){return this._apiKey}set fetch(t){this._fetch=t}get fetch(){return this._fetch}};new Set(Object.values({AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"}));const n={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(n);class o extends Error{constructor(t,e=""){super(`Call to enpoint ${t.url} failed with the status code ${t.status}. ${e}`),this.res=t}}const s={403:"Key is missing, invalid or restricted"},a={info:async function(t={}){const e=new URL("geolocation/ip.json",n.maptilerApiURL);e.searchParams.set("key",t.apiKey??r.apiKey);const i=e.toString(),a=await async function(t,e={}){if(null===r.fetch)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(""===new URL(t).searchParams.get("key").trim())throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return r.fetch(t,e)}(i);if(!a.ok)throw new o(a,a.status in s?s[a.status]:"");return await a.json()}};function l(t){let e;const i=t.trim();let r;return r=i.startsWith("http://")||i.startsWith("https://")?i:null!==(e=/^maptiler:\/\/(.*)/.exec(i))?`https://api.maptiler.com/maps/${e[1]}/style.json`:`https://api.maptiler.com/maps/${i}/style.json`,r}class c{constructor(t,e,i,r,n,o){this.name=t,this.variantType=e,this.id=i,this.referenceStyle=r,this.description=n,this.imageURL=o}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(t){return this.referenceStyle.hasVariant(t)}getVariant(t){return this.referenceStyle.getVariant(t)}getVariants(){return this.referenceStyle.getVariants().filter((t=>t!==this))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return l(this.getId())}}class u{constructor(t,e){this.name=t,this.id=e,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(t){this.variants[t.getType()]=t,this.orderedVariants.push(t)}hasVariant(t){return t in this.variants}getVariant(t){return t in this.variants?this.variants[t]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const h=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function p(t){return new Proxy(t,{get:(e,i,r)=>e.hasVariant(i)?e.getVariant(i):i.toString().toUpperCase()===i?t.getDefaultVariant():Reflect.get(e,i,r)})}const d=function(){const t={};for(let e=0;e<h.length;e+=1){const i=h[e],r=p(new u(i.name,i.referenceStyleID));for(let t=0;t<i.variants.length;t+=1){const e=i.variants[t],n=new c(e.name,e.variantType,e.id,r,e.description,e.imageURL);r.addVariant(n)}t[i.referenceStyleID]=r}return t}();Math.PI},95436:(t,e,i)=>{"use strict";i.d(e,{gw:()=>o});var r=i(65154),n=i(53481);let o=null,s=null,a=null,l=null,c=null,u=null;(()=>{try{n.MaptilerLayer=n.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(t){n.setOptions(this,t),this._throttledUpdate=n.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(t){this._container||this._initContainer();const e=document.createElement("a");e.href="https://www.maptiler.com",e.style="position:absolute; left:10px; bottom:2px; z-index:999;";const i=document.createElement("img");i.src="https://api.maptiler.com/resources/logo.svg",i.alt="MapTiler logo",i.width="100",i.height="30",e.appendChild(i),t.getContainer().appendChild(e);const r=this.getPaneName();t.getPane(r).appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&n.DomEvent.on(t._proxy,n.DomUtil.TRANSITION_END,this._transitionEnd,this),t.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(t){this._map._proxy&&this._map.options.zoomAnimation&&n.DomEvent.off(this._map._proxy,n.DomUtil.TRANSITION_END,this._transitionEnd,this);const e=this.getPaneName();t.getPane(e).removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+2*this.options.padding)},getBounds:function(){const t=this.getSize().multiplyBy(.5),e=this._map.latLngToContainerPoint(this._map.getCenter());return n.latLngBounds(this._map.containerPointToLatLng(e.subtract(t)),this._map.containerPointToLatLng(e.add(t)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(t){this._maptilerMap.setStyle(t)},setLanguage:function(t){this._maptilerMap.setLanguage(t)},_roundPoint:function(t){return{x:Math.round(t.x),y:Math.round(t.y)}},_initContainer:function(){const t=this._container=n.DomUtil.create("div","leaflet-gl-layer"),e=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding);t.style.width=e.x+"px",t.style.height=e.y+"px";const r=this._map.containerPointToLayerPoint([0,0]).subtract(i);n.DomUtil.setPosition(t,this._roundPoint(r))},_initMaptilerSDK:function(){const t=this._map.getCenter();let e=this.options.style,i=this.options.apiKey;if(("string"==typeof this.options.style||this.options.style instanceof String)&&this.options.style.startsWith("https://api.maptiler.com/maps/"))try{const t=new URL(this.options.style),r=t.searchParams.get("key");r&&(i=r,t.searchParams.delete("key"),e=t.href)}catch(t){console.error(t)}const o={...this.options,style:e,apiKey:i,container:this._container,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(delete o.center,delete o.zoom),this._maptilerMap=new r.Map(o),this._maptilerMap.once("load",(()=>{this.fire("ready")})),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",(()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)})),this._maptilerMap.transform.latRange=null,this._maptilerMap.transform.maxValidLatitude=1/0,this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const s=this._maptilerMap._actualCanvas;n.DomUtil.addClass(s,"leaflet-image-layer"),n.DomUtil.addClass(s,"leaflet-zoom-animated"),this.options.interactive&&n.DomUtil.addClass(s,"leaflet-interactive"),this.options.className&&n.DomUtil.addClass(s,this.options.className),Object.keys(r.helpers).forEach((t=>{this[t]=e=>r.helpers[t].apply(null,[this._maptilerMap,e])}))},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const t=this.getSize(),e=this._map.getSize().multiplyBy(this.options.padding),i=this._map.containerPointToLayerPoint([0,0]).subtract(e);n.DomUtil.setPosition(this._container,this._roundPoint(i)),this._transformGL(),this._maptilerMap.transform.width!==t.x||this._maptilerMap.transform.height!==t.y?(this._container.style.width=t.x+"px",this._container.style.height=t.y+"px",null!==this._maptilerMap._resize&&void 0!==this._maptilerMap._resize?this._maptilerMap._resize():this._maptilerMap.resize()):null!==this._maptilerMap._update&&void 0!==this._maptilerMap._update?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){const t=this._map.getCenter(),e=this._maptilerMap.transform;e.center=r.LngLat.convert([t.lng,t.lat]),e.zoom=this._map.getZoom()-1},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){const e=this._map.getZoomScale(t.zoom),i=this._map.getSize().multiplyBy(this.options.padding*e),r=this.getSize()._divideBy(2),o=this._map.project(t.center,t.zoom)._subtract(r)._add(this._map._getMapPanePos().add(i))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),t.zoom)._subtract(o);n.DomUtil.setTransform(this._maptilerMap._actualCanvas,s.subtract(this._offset),e)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const t=this._map.getZoomScale(this._map.getZoom());n.DomUtil.setTransform(this._maptilerMap._actualCanvas,null,t),this._zooming=!1,this._update()},_transitionEnd:function(){n.Util.requestAnimFrame((function(){const t=this._map.getZoom(),e=this._map.getCenter(),i=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());n.DomUtil.setTransform(this._maptilerMap._actualCanvas,i,1),this._maptilerMap.once("moveend",n.Util.bind((function(){this._zoomEnd()}),this)),this._maptilerMap.jumpTo({center:e,zoom:t-1})}),this)},_resize:function(t){this._transitionEnd(t)}}),o=n.MaptilerLayer,n.maptilerLayer=function(t){return new n.MaptilerLayer(t)},s=n.maptilerLayer,n.MaptilerStyle={},Object.keys(r.MapStyle).forEach((t=>{n.MaptilerStyle[t]=r.MapStyle[t]})),a=n.MaptilerStyle,l=n.MaptilerStyle,n.maptilerStyle=n.MaptilerStyle,n.MaptilerLanguage={},Object.keys(r.Language).forEach((t=>{n.MaptilerLanguage[t]=r.Language[t]})),c=n.MaptilerLanguage,u=n.MaptilerLanguage,n.maptilerLanguage=n.MaptilerLanguage}catch(t){console.error(t)}})()},65154:(t,e,i)=>{"use strict";i.d(e,{Language:()=>l,LngLat:()=>He,Map:()=>Ut,MapStyle:()=>s.Gj,helpers:()=>Ze});var r=i(16443),n=i(13293),o=i(37007),s=i(26494),a=i(18562);const l={VISITOR:"visitor",VISITOR_ENGLISH:"visitor_en",STYLE:"style",AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"name:latin",NON_LATIN:"name:nonlatin",LOCAL:"name",INTERNATIONAL:"name_int",ALBANIAN:"name:sq",AMHARIC:"name:am",ARABIC:"name:ar",ARMENIAN:"name:hy",AZERBAIJANI:"name:az",BASQUE:"name:eu",BELORUSSIAN:"name:be",BENGALI:"name:bn",BOSNIAN:"name:bs",BRETON:"name:br",BULGARIAN:"name:bg",CATALAN:"name:ca",CHINESE:"name:zh",TRADITIONAL_CHINESE:"name:zh-Hant",SIMPLIFIED_CHINESE:"name:zh-Hans",CORSICAN:"name:co",CROATIAN:"name:hr",CZECH:"name:cs",DANISH:"name:da",DUTCH:"name:nl",ENGLISH:"name:en",ESPERANTO:"name:eo",ESTONIAN:"name:et",FINNISH:"name:fi",FRENCH:"name:fr",FRISIAN:"name:fy",GEORGIAN:"name:ka",GERMAN:"name:de",GREEK:"name:el",HEBREW:"name:he",HINDI:"name:hi",HUNGARIAN:"name:hu",ICELANDIC:"name:is",INDONESIAN:"name:id",IRISH:"name:ga",ITALIAN:"name:it",JAPANESE:"name:ja",JAPANESE_HIRAGANA:"name:ja-Hira",JAPANESE_KANA:"name:ja_kana",JAPANESE_LATIN:"name:ja_rm",JAPANESE_2018:"name:ja-Latn",KANNADA:"name:kn",KAZAKH:"name:kk",KOREAN:"name:ko",KOREAN_LATIN:"name:ko-Latn",KURDISH:"name:ku",ROMAN_LATIN:"name:la",LATVIAN:"name:lv",LITHUANIAN:"name:lt",LUXEMBOURGISH:"name:lb",MACEDONIAN:"name:mk",MALAYALAM:"name:ml",MALTESE:"name:mt",NORWEGIAN:"name:no",OCCITAN:"name:oc",PERSIAN:"name:fa",POLISH:"name:pl",PORTUGUESE:"name:pt",PUNJABI:"name:pa",WESTERN_PUNJABI:"name:pnb",ROMANIAN:"name:ro",ROMANSH:"name:rm",RUSSIAN:"name:ru",SCOTTISH_GAELIC:"name:gd",SERBIAN_CYRILLIC:"name:sr",SERBIAN_LATIN:"name:sr-Latn",SLOVAK:"name:sk",SLOVENE:"name:sl",SPANISH:"name:es",SWEDISH:"name:sv",TAMIL:"name:ta",TELUGU:"name:te",THAI:"name:th",TURKISH:"name:tr",UKRAINIAN:"name:uk",URDU:"name:ur",VIETNAMIAN_LATIN:"name:vi",WELSH:"name:cy"},c=new Set(Object.values(l));function u(t){return c.has(t)}const h=new Set(Object.values(l));function p(){if("undefined"==typeof navigator)return`name:${Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0]}`;const t=Array.from(new Set(navigator.languages.map((t=>`name:${t.split("-")[0]}`)))).filter((t=>h.has(t)));return t.length?t[0]:l.LOCAL}const d={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:l.STYLE,secondaryLanguage:l.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(d);var f=Object.defineProperty,m=(t,e,i)=>(((t,e,i)=>{e in t?f(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);const g=(0,a.A)(),_=new class extends o{constructor(){super(),m(this,"primaryLanguage",d.primaryLanguage),m(this,"secondaryLanguage"),m(this,"session",!0),m(this,"_unit","metric"),m(this,"_apiKey","")}set unit(t){this._unit=t,this.emit("unit",t)}get unit(){return this._unit}set apiKey(t){this._apiKey=t,s.$W.apiKey=t,this.emit("apiKey",t)}get apiKey(){return this._apiKey}set fetch(t){s.$W.fetch=t}get fetch(){return s.$W.fetch}};class y extends r.LogoControl{onAdd(t){return super.onAdd(t)}}var A=Object.defineProperty,v=(t,e,i)=>(((t,e,i)=>{e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class x extends y{constructor(t={}){var e,i;super(t),v(this,"logoURL",""),v(this,"linkURL",""),this.logoURL=null!=(e=t.logoURL)?e:d.maptilerLogoURL,this.linkURL=null!=(i=t.linkURL)?i:d.maptilerURL}onAdd(t){var e;this._map=t,this._compact=null!=(e=this.options.compact)&&e,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const i=window.document.createElement("a");return i.style.backgroundRepeat="no-repeat",i.style.cursor="pointer",i.style.display="block",i.style.height="23px",i.style.margin="0 0 -4px -4px",i.style.overflow="hidden",i.style.width="88px",i.style.backgroundImage=`url(${this.logoURL})`,i.style.backgroundSize="100px 30px",i.style.width="100px",i.style.height="30px",i.target="_blank",i.rel="noopener",i.href=this.linkURL,i.setAttribute("aria-label","MapTiler logo"),i.setAttribute("rel","noopener"),this._container.appendChild(i),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}var b=Object.defineProperty,w=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,C=(t,e,i)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,M=(t,e)=>{for(var i in e||(e={}))S.call(e,i)&&C(t,i,e[i]);if(w)for(var i of w(e))T.call(e,i)&&C(t,i,e[i]);return t};function E(t,e,i){const r=window.document.createElement(t);return void 0!==e&&(r.className=e),i&&i.appendChild(r),r}function I(t){t.parentNode&&t.parentNode.removeChild(t)}function L(t,e){let i=null;try{i=new URL(t)}catch(e){return{url:t}}return i.host===d.maptilerApiHost&&(i.searchParams.has("key")||i.searchParams.append("key",_.apiKey),_.session&&i.searchParams.append("mtsid",g)),{url:i.href}}function P(t){return function(e,i){var r;if(void 0!==t){const n=t(e,i),o=L(null!=(r=null==n?void 0:n.url)?r:"");return M(M({},n),o)}return L(e)}}function k(){return Math.random().toString(36).substring(2)}function N(t){return/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t)}function D(t){return t?"string"==typeof t||t instanceof String?!t.startsWith("http")&&t.toLowerCase().includes(".json")?t:(0,s.ub)(t):t instanceof s.Hu?t.getExpandedStyleURL():t instanceof s.rF?t.getDefaultVariant().getExpandedStyleURL():t:s.Gj[s.N0[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}var O=Object.defineProperty,R=(t,e,i)=>(((t,e,i)=>{e in t?O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);class F{constructor(){var t;R(this,"_map"),R(this,"_container"),R(this,"_terrainButton"),t=this,["_toggleTerrain","_updateTerrainIcon"].forEach((e=>{"function"==typeof t[e]&&(t[e]=t[e].bind(t))}))}onAdd(t){return this._map=t,this._container=E("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E("button","maplibregl-ctrl-terrain",this._container),E("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class z extends r.NavigationControl{onAdd(t){return super.onAdd(t)}}var B=Object.defineProperty;class U extends z{constructor(){var t;super({showCompass:!0,showZoom:!0,visualizePitch:!0}),((t,e,i)=>{e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(this,"symbol"!=typeof(t="_rotateCompassArrow")?t+"":t,(()=>{const t=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t})),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",(t=>{0===this._map.getPitch()?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}))}_createButton(t,e){const i=super._createButton(t,e);return i.clickFunction=e,i}}class V extends r.GeolocateControl{onAdd(t){return super.onAdd(t)}}var j=Object.defineProperty,G=Object.defineProperties,Z=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,J=(t,e,i)=>e in t?j(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e,i)=>(J(t,"symbol"!=typeof e?e+"":e,i),i);const $=r.Marker,Y=r.LngLat,X=r.LngLatBounds;class Q extends V{constructor(){super(...arguments),K(this,"lastUpdatedCenter",new Y(0,0)),K(this,"_updateCamera",(t=>{var e,i,r;const n=new Y(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,s=(a=((t,e)=>{for(var i in e||(e={}))W.call(e,i)&&J(t,i,e[i]);if(q)for(var i of q(e))H.call(e,i)&&J(t,i,e[i]);return t})({bearing:this._map.getBearing()},this.options.fitBoundsOptions),G(a,Z({linear:!0})));var a;const l=this._map.getZoom();l>(null!=(r=null==(i=null==(e=this.options)?void 0:e.fitBoundsOptions)?void 0:i.maxZoom)?r:30)&&(s.zoom=l),this._map.fitBounds(X.fromLngLat(n,o),s,{geolocateSource:!0});let c=!1;const u=()=>{c=!0};this._map.once("click",u),this._map.once("dblclick",u),this._map.once("dragstart",u),this._map.once("mousedown",u),this._map.once("touchstart",u),this._map.once("wheel",u),this._map.once("moveend",(()=>{this._map.off("click",u),this._map.off("dblclick",u),this._map.off("dragstart",u),this._map.off("mousedown",u),this._map.off("touchstart",u),this._map.off("wheel",u),c||(this.lastUpdatedCenter=this._map.getCenter())}))})),K(this,"_setupUI",(t=>{if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=E("button","maplibregl-ctrl-geolocate",this._container),E("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $({element:this._dotElement}),this._circleElement=E("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",(t=>{const e=t.originalEvent&&"resize"===t.originalEvent.type,i=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&"ACTIVE_LOCK"===this._watchState&&!e&&i>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))}))})),K(this,"_onZoom",(()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}))}_updateCircleRadius(){if("BACKGROUND"!==this._watchState&&"ACTIVE_LOCK"!==this._watchState)return;const t=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],e=this._map.project(t),i=this._map.unproject([e.x,e.y]),r=this._map.unproject([e.x+20,e.y]),n=i.distanceTo(r)/20,o=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}}class tt extends r.AttributionControl{onAdd(t){return super.onAdd(t)}}class et extends r.ScaleControl{onAdd(t){return super.onAdd(t)}}class it extends r.FullscreenControl{onAdd(t){return super.onAdd(t)}}var rt,nt,ot,st,at,lt,ct,ut,ht,pt,dt,ft,mt,gt=Object.defineProperty,_t=Object.defineProperties,yt=Object.getOwnPropertyDescriptors,At=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable,bt=(t,e,i)=>e in t?gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,wt=(t,e)=>{for(var i in e||(e={}))vt.call(e,i)&&bt(t,i,e[i]);if(At)for(var i of At(e))xt.call(e,i)&&bt(t,i,e[i]);return t},St=(t,e)=>_t(t,yt(e)),Tt=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Ct=(t,e,i)=>(Tt(t,e,"read from private field"),i?i.call(t):e.get(t)),Mt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Et=(t,e,i,r)=>(Tt(t,e,"write to private field"),r?r.call(t,i):e.set(t,i),i),It=(t,e,i)=>(Tt(t,e,"access private method"),i);class Lt{constructor(t,e){var i;Mt(this,ut),Mt(this,pt),Mt(this,ft),Mt(this,rt,void 0),bt(this,("map","map"),undefined),Mt(this,nt,void 0),Mt(this,ot,void 0),Mt(this,st,void 0),Mt(this,at,void 0),Mt(this,lt,!1),Mt(this,ct,void 0),void 0!==t.style&&Et(this,lt,!0),Et(this,rt,St(wt(St(wt({zoomAdjust:-4,position:"top-right"},e),{forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1}),t),{containerStyle:wt({border:"1px solid #000",width:"400px",height:"300px"},null!=(i=t.containerStyle)?i:{})})),void 0!==t.lockZoom&&(Ct(this,rt).minZoom=t.lockZoom,Ct(this,rt).maxZoom=t.lockZoom)}setStyle(t,e){Ct(this,lt)||this.map.setStyle(t,e),It(this,pt,dt).call(this)}addLayer(t,e){return Ct(this,lt)||this.map.addLayer(t,e),It(this,pt,dt).call(this),this.map}moveLayer(t,e){return Ct(this,lt)||this.map.moveLayer(t,e),It(this,pt,dt).call(this),this.map}removeLayer(t){return Ct(this,lt)||this.map.removeLayer(t),It(this,pt,dt).call(this),this}setLayerZoomRange(t,e,i){return Ct(this,lt)||this.map.setLayerZoomRange(t,e,i),It(this,pt,dt).call(this),this}setFilter(t,e,i){return Ct(this,lt)||this.map.setFilter(t,e,i),It(this,pt,dt).call(this),this}setPaintProperty(t,e,i,r){return Ct(this,lt)||this.map.setPaintProperty(t,e,i,r),It(this,pt,dt).call(this),this}setLayoutProperty(t,e,i,r){return Ct(this,lt)||this.map.setLayoutProperty(t,e,i,r),It(this,pt,dt).call(this),this}setGlyphs(t,e){return Ct(this,lt)||this.map.setGlyphs(t,e),It(this,pt,dt).call(this),this}onAdd(t){Et(this,nt,t),Et(this,ot,E("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[t,e]of Object.entries(Ct(this,rt).containerStyle))Ct(this,ot).style.setProperty(t,e);return Ct(this,rt).container=Ct(this,ot),Ct(this,rt).zoom=t.getZoom()+Ct(this,rt).zoomAdjust,this.map=new Ut(Ct(this,rt)),this.map.once("style.load",(()=>{this.map.resize()})),this.map.once("load",(()=>{It(this,ut,ht).call(this,Ct(this,rt).parentRect),Et(this,ct,It(this,ft,mt).call(this))})),Ct(this,ot)}onRemove(){var t;null==(t=Ct(this,ct))||t.call(this),I(Ct(this,ot))}}rt=new WeakMap,nt=new WeakMap,ot=new WeakMap,st=new WeakMap,at=new WeakMap,lt=new WeakMap,ct=new WeakMap,ut=new WeakSet,ht=function(t){void 0===t||void 0===t.linePaint&&void 0===t.fillPaint||(Et(this,at,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:Ct(this,at)}),void 0===t.lineLayout&&void 0===t.linePaint||this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:wt({},t.lineLayout),paint:wt({"line-color":"#FFF","line-width":1,"line-opacity":.85},t.linePaint)}),void 0!==t.fillPaint&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:wt({"fill-color":"#08F","fill-opacity":.135},t.fillPaint)}),It(this,pt,dt).call(this))},pt=new WeakSet,dt=function(){if(void 0===Ct(this,at))return;const{devicePixelRatio:t}=window,e=Ct(this,nt).getCanvas(),i=e.width/t,r=e.height/t,n=Ct(this,nt).unproject.bind(Ct(this,nt)),o=n([0,0]),s=n([i,0]),a=n([0,r]),l=n([i,r]);Ct(this,at).geometry.coordinates=[[a.toArray(),l.toArray(),s.toArray(),o.toArray(),a.toArray()]],this.map.getSource("parentRect").setData(Ct(this,at))},ft=new WeakSet,mt=function(){const{pitchAdjust:t}=Ct(this,rt),e=()=>{o("parent")},i=()=>{o("minimap")},r=()=>{Ct(this,nt).on("move",e),this.map.on("move",i)},n=()=>{Ct(this,nt).off("move",e),this.map.off("move",i)},o=e=>{var i;n();const o="parent"===e?Ct(this,nt):this.map,s="parent"===e?this.map:Ct(this,nt),a=o.getCenter(),l=o.getZoom()+(null!=(i=Ct(this,rt).zoomAdjust)?i:-4)*("parent"===e?1:-1),c=o.getBearing(),u=o.getPitch();s.jumpTo({center:a,zoom:l,bearing:c,pitch:t?u:0}),It(this,pt,dt).call(this),r()};return r(),()=>{n()}};var Pt=Object.defineProperty,kt=Object.defineProperties,Nt=Object.getOwnPropertyDescriptors,Dt=Object.getOwnPropertySymbols,Ot=Object.prototype.hasOwnProperty,Rt=Object.prototype.propertyIsEnumerable,Ft=(t,e,i)=>e in t?Pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,zt=(t,e,i)=>(Ft(t,"symbol"!=typeof e?e+"":e,i),i),Bt=(t,e,i)=>new Promise(((r,n)=>{var o=t=>{try{a(i.next(t))}catch(t){n(t)}},s=t=>{try{a(i.throw(t))}catch(t){n(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(o,s);a((i=i.apply(t,e)).next())}));class Ut extends r.Map{constructor(t){var e,i,n;t.apiKey&&(_.apiKey=t.apiKey);const o=D(t.style),s=location.hash;var a,c;_.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super((a=((t,e)=>{for(var i in e||(e={}))Ot.call(e,i)&&Ft(t,i,e[i]);if(Dt)for(var i of Dt(e))Rt.call(e,i)&&Ft(t,i,e[i]);return t})({},t),c={style:o,maplibreLogo:!1,transformRequest:P(t.transformRequest)},kt(a,Nt(c)))),zt(this,"isTerrainEnabled",!1),zt(this,"terrainExaggeration",1),zt(this,"primaryLanguage"),zt(this,"terrainGrowing",!1),zt(this,"terrainFlattening",!1),zt(this,"minimap"),zt(this,"forceLanguageUpdate"),zt(this,"languageAlwaysBeenStyle"),zt(this,"isReady",!1),this.primaryLanguage=null!=(e=t.language)?e:_.primaryLanguage,this.forceLanguageUpdate=this.primaryLanguage!==l.STYLE&&this.primaryLanguage!==l.STYLE_LOCK,this.languageAlwaysBeenStyle=this.primaryLanguage===l.STYLE,this.terrainExaggeration=null!=(i=t.terrainExaggeration)?i:this.terrainExaggeration,this.once("styledata",(()=>Bt(this,null,(function*(){if(!t.geolocate)return;if(t.center)return;if(t.hash&&s)return;try{if("COUNTRY"===t.geolocate)return void(yield this.fitToIpBounds())}catch(t){console.warn(t.message)}let e;try{yield this.centerOnIpPoint(t.zoom),e=this.getCameraHash()}catch(t){console.warn(t.message)}"granted"===(yield navigator.permissions.query({name:"geolocation"})).state&&navigator.geolocation.getCurrentPosition((i=>{e===this.getCameraHash()&&(this.terrain?this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:t.zoom||12,duration:2e3}):this.once("terrain",(()=>{this.easeTo({center:[i.coords.longitude,i.coords.latitude],zoom:t.zoom||12,duration:2e3})})))}),null,{maximumAge:864e5,timeout:5e3,enableHighAccuracy:!1})})))),this.on("styledata",(()=>{this.setPrimaryLanguage(this.primaryLanguage)})),this.on("styledata",(()=>{null===this.getTerrain()&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)})),this.once("load",(()=>Bt(this,null,(function*(){"unavailable"===r.getRTLTextPluginStatus()&&r.setRTLTextPlugin(d.rtlPluginURL,(t=>{t&&console.error(t)}),!0)})))),this.once("load",(()=>Bt(this,null,(function*(){let e={logo:null};try{const t=Object.keys(this.style.sourceCaches).map((t=>this.getSource(t))).filter((t=>t&&"url"in t&&"string"==typeof t.url&&(null==t?void 0:t.url.includes("tiles.json")))),i=new URL(t[0].url);i.searchParams.has("key")||i.searchParams.append("key",_.apiKey);const r=yield fetch(i.href);e=yield r.json()}catch(t){}if(!0!==t.forceNoAttributionControl)if("logo"in e&&e.logo){const i=e.logo;this.addControl(new x({logoURL:i}),t.logoPosition),!1===t.attributionControl&&this.addControl(new tt({customAttribution:t.customAttribution}))}else t.maptilerLogo&&this.addControl(new x,t.logoPosition);if(t.scaleControl){const e=!0===t.scaleControl||void 0===t.scaleControl?"bottom-right":t.scaleControl,i=new et({unit:_.unit});this.addControl(i,e),_.on("unit",(t=>{i.setUnit(t)}))}if(!1!==t.navigationControl){const e=!0===t.navigationControl||void 0===t.navigationControl?"top-right":t.navigationControl;this.addControl(new U,e)}if(!1!==t.geolocateControl){const e=!0===t.geolocateControl||void 0===t.geolocateControl?"top-right":t.geolocateControl;this.addControl(new Q({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),e)}if(t.terrainControl){const e=!0===t.terrainControl||void 0===t.terrainControl?"top-right":t.terrainControl;this.addControl(new F,e)}if(t.fullscreenControl){const e=!0===t.fullscreenControl||void 0===t.fullscreenControl?"top-right":t.fullscreenControl;this.addControl(new it({}),e)}this.isReady=!0,this.fire("ready",{target:this})}))));let u,h=!1,p=!1;this.once("ready",(()=>{h=!0,p&&this.fire("loadWithTerrain",u)})),this.once("style.load",(()=>{var e;const{minimap:i}=t;if("object"==typeof i){const{zoom:r,center:n,style:o,language:s,apiKey:a,maptilerLogo:l,antialias:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:p,minZoom:d,maxZoom:f,boxZoom:m,locale:g,fadeDuration:_,crossSourceCollisions:y,clickTolerance:A,bounds:v,fitBoundsOptions:x,pixelRatio:b,validateStyle:w}=t;this.minimap=new Lt(i,{zoom:r,center:n,style:o,language:s,apiKey:a,container:"null",maptilerLogo:l,antialias:c,refreshExpiredTiles:u,maxBounds:h,scrollZoom:p,minZoom:d,maxZoom:f,boxZoom:m,locale:g,fadeDuration:_,crossSourceCollisions:y,clickTolerance:A,bounds:v,fitBoundsOptions:x,pixelRatio:b,validateStyle:w}),this.addControl(this.minimap,null!=(e=i.position)?e:"bottom-left")}else!0===i?(this.minimap=new Lt({},t),this.addControl(this.minimap,"bottom-left")):void 0!==i&&!1!==i&&(this.minimap=new Lt({},t),this.addControl(this.minimap,i))}));const f=t=>{t.terrain&&(p=!0,u={type:"loadWithTerrain",target:this,terrain:t.terrain},this.off("terrain",f),h&&this.fire("loadWithTerrain",u))};this.on("terrain",f),t.terrain&&this.enableTerrain(null!=(n=t.terrainExaggeration)?n:this.terrainExaggeration)}onLoadAsync(){return Bt(this,null,(function*(){return new Promise((t=>{if(this.loaded())return t(this);this.once("load",(()=>{t(this)}))}))}))}onReadyAsync(){return Bt(this,null,(function*(){return new Promise((t=>{if(this.isReady)return t(this);this.once("ready",(()=>{t(this)}))}))}))}onLoadWithTerrainAsync(){return Bt(this,null,(function*(){return new Promise((t=>{if(this.isReady&&this.terrain)return t(this);this.once("loadWithTerrain",(()=>{t(this)}))}))}))}setStyle(t,e){var i;return null==(i=this.minimap)||i.setStyle(t),this.forceLanguageUpdate=!0,this.once("idle",(()=>{this.forceLanguageUpdate=!1})),super.setStyle(D(t),e)}addLayer(t,e){var i;return null==(i=this.minimap)||i.addLayer(t,e),super.addLayer(t,e)}moveLayer(t,e){var i;return null==(i=this.minimap)||i.moveLayer(t,e),super.moveLayer(t,e)}removeLayer(t){var e;return null==(e=this.minimap)||e.removeLayer(t),super.removeLayer(t)}setLayerZoomRange(t,e,i){var r;return null==(r=this.minimap)||r.setLayerZoomRange(t,e,i),super.setLayerZoomRange(t,e,i)}setFilter(t,e,i){var r;return null==(r=this.minimap)||r.setFilter(t,e,i),super.setFilter(t,e,i)}setPaintProperty(t,e,i,r){var n;return null==(n=this.minimap)||n.setPaintProperty(t,e,i,r),super.setPaintProperty(t,e,i,r)}setLayoutProperty(t,e,i,r){var n;return null==(n=this.minimap)||n.setLayoutProperty(t,e,i,r),super.setLayoutProperty(t,e,i,r)}setGlyphs(t,e){var i;return null==(i=this.minimap)||i.setGlyphs(t,e),super.setGlyphs(t,e)}getStyleLanguage(){return this.style.stylesheet.metadata?"object"!=typeof this.style.stylesheet.metadata?null:"maptiler:language"in this.style.stylesheet.metadata&&"string"==typeof this.style.stylesheet.metadata["maptiler:language"]?this.style.stylesheet.metadata["maptiler:language"]:null:null}setLanguage(t){var e,i;null==(i=null==(e=this.minimap)?void 0:e.map)||i.setLanguage(t),this.onStyleReady((()=>{this.setPrimaryLanguage(t)}))}setPrimaryLanguage(t){const e=this.getStyleLanguage();if(t!==l.STYLE||e!==l.AUTO&&e!==l.VISITOR){if(t!==l.STYLE&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle)return;if(this.primaryLanguage===t&&!this.forceLanguageUpdate)return}if(!u(t))return void console.warn(`The language "${t}" is not supported.`);if(this.primaryLanguage===l.STYLE_LOCK)return void console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");this.primaryLanguage=t;let i=t;if(t===l.STYLE){if(!e)return void console.warn("The style has no default languages.");if(!u(e))return void console.warn("The language defined in the style is not valid.");i=e}let r=l.LOCAL,n=`{${r}}`;i==l.VISITOR?(r=p(),n=["case",["all",["has",r],["has",l.LOCAL]],["case",["==",["get",r],["get",l.LOCAL]],["get",l.LOCAL],["format",["get",r],{"font-scale":.8},"\n",["get",l.LOCAL],{"font-scale":1.1}]],["get",l.LOCAL]]):i==l.VISITOR_ENGLISH?(r=l.ENGLISH,n=["case",["all",["has",r],["has",l.LOCAL]],["case",["==",["get",r],["get",l.LOCAL]],["get",l.LOCAL],["format",["get",r],{"font-scale":.8},"\n",["get",l.LOCAL],{"font-scale":1.1}]],["get",l.LOCAL]]):i===l.AUTO?(r=p(),n=["case",["has",r],["get",r],["get",l.LOCAL]]):i===l.LOCAL?(r=l.LOCAL,n=`{${r}}`):(r=i,n=["case",["has",r],["get",r],["get",l.LOCAL]]);const{layers:o}=this.getStyle();for(const{id:t,layout:e}of o){if(!e)continue;if(!("text-field"in e))continue;const i=this.getLayoutProperty(t,"text-field");"string"==typeof i&&(i.toLowerCase().includes("ref")||i.toLowerCase().includes("housenumber"))||this.setLayoutProperty(t,"text-field",n)}}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(t,e=1e3){if(!this.terrain)return;const i=performance.now(),r=this.terrain.exaggeration,n=t-r,o=()=>{if(!this.terrain)return;if(this.terrainFlattening)return;const s=(performance.now()-i)/e;if(s<.99){const t=1-Math.pow(1-s,4),e=r+t*n;this.terrain.exaggeration=e,requestAnimationFrame(o)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=t;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(o)}enableTerrain(t=this.terrainExaggeration){if(t<0)return void console.warn("Terrain exaggeration cannot be negative.");const e=i=>Bt(this,null,(function*(){this.terrain&&"data"===i.type&&"source"===i.dataType&&"source"in i&&"maptiler-terrain"===i.sourceId&&"raster-dem"===i.source.type&&i.isSourceLoaded&&(this.off("data",e),this.growTerrain(t))})),i=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=t,this.on("data",e),this.addSource(d.terrainSourceId,{type:"raster-dem",url:d.terrainSourceURL}),this.setTerrain({source:d.terrainSourceId,exaggeration:0})};if(this.getTerrain())return this.isTerrainEnabled=!0,void this.growTerrain(t);this.loaded()||this.isTerrainEnabled?i():this.once("load",(()=>{this.getTerrain()&&this.getSource(d.terrainSourceId)||i()}))}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const t=performance.now(),e=this.terrain.exaggeration,i=()=>{if(!this.terrain)return;if(this.terrainGrowing)return;const r=(performance.now()-t)/1e3;if(r<.99){const t=Math.pow(1-r,4),n=e*t;this.terrain.exaggeration=n,requestAnimationFrame(i)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(d.terrainSourceId)&&this.removeSource(d.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(i)}setTerrainExaggeration(t,e=!0){!e&&this.terrain?(this.terrainExaggeration=t,this.terrain.exaggeration=t,this.triggerRepaint()):this.enableTerrain(t)}onStyleReady(t){this.isStyleLoaded()?t():this.once("styledata",(()=>{t()}))}fitToIpBounds(){return Bt(this,null,(function*(){const t=yield s.Re.info();this.fitBounds(t.country_bounds,{duration:0,padding:100})}))}centerOnIpPoint(t){return Bt(this,null,(function*(){var e,i;const r=yield s.Re.info();this.jumpTo({center:[null!=(e=null==r?void 0:r.longitude)?e:0,null!=(i=null==r?void 0:r.latitude)?i:0],zoom:t||11})}))}getCameraHash(){const t=new Float32Array(5),e=this.getCenter();return t[0]=e.lng,t[1]=e.lat,t[2]=this.getZoom(),t[3]=this.getPitch(),t[4]=this.getBearing(),n.o4.fromUint8Array(new Uint8Array(t.buffer))}getSdkConfig(){return _}getMaptilerSessionId(){return g}setTransformRequest(t){return super.setTransformRequest(P(t)),this}loadImageAsync(t){return Bt(this,null,(function*(){return new Promise(((e,i)=>{this.loadImage(t,((t,r)=>{t?i(t):e(r)}))}))}))}}r.Marker,r.Popup,r.Style,r.CanvasSource,r.GeoJSONSource,r.ImageSource,r.RasterTileSource,r.RasterDEMTileSource,r.VectorTileSource,r.VideoSource,r.TerrainControl,Object.defineProperty;var Vt=Object.defineProperty,jt=Object.getOwnPropertySymbols,Gt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable,qt=(t,e,i)=>e in t?Vt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Wt=(t,e)=>{for(var i in e||(e={}))Gt.call(e,i)&&qt(t,i,e[i]);if(jt)for(var i of jt(e))Zt.call(e,i)&&qt(t,i,e[i]);return t};function Ht(t){if("undefined"!=typeof DOMParser){const e=(new DOMParser).parseFromString(t,"application/xml");if(e.querySelector("parsererror"))throw new Error("The provided string is not valid XML");return e}throw new Error("No XML parser found")}function Jt(t,e){if(!t.hasChildNodes())return!1;for(const i of Array.from(t.childNodes)){const t=i.nodeName;if("string"==typeof t&&t.trim().toLowerCase()===e.toLowerCase())return!0}return!1}function Kt(t){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(t);throw new Error("No XML serializer found")}function $t(t){if("string"==typeof t&&(t=Ht(t)),!Jt(t,"gpx"))throw new Error("The XML document is not valid GPX");const e=le(t,"trk"),i=le(t,"rte"),r=le(t,"wpt"),n={type:"FeatureCollection",features:[]};for(const t of Array.from(e)){const e=re(t);e&&n.features.push(e)}for(const t of Array.from(i)){const e=ne(t);e&&n.features.push(e)}for(const t of Array.from(r))n.features.push({type:"Feature",properties:Wt(Wt({},se(o=t)),fe(o,["sym"])),geometry:{type:"Point",coordinates:_e(o).coordinates}});var o;return n}function Yt(t,e){var i;if("string"==typeof t&&(t=Ht(t)),!Jt(t,"kml"))throw new Error("The XML document is not valid KML");const r={type:"FeatureCollection",features:[]},n={},o={},s={},a=le(t,"Placemark"),l=le(t,"Style"),c=le(t,"StyleMap");for(const t of Array.from(l)){const i=ae(void 0!==e?e(t):Kt(t)).toString(16);n["#"+ce(t,"id")]=i,o[i]=t}for(const t of Array.from(c)){n["#"+ce(t,"id")]=ae(void 0!==e?e(t):Kt(t)).toString(16);const r=le(t,"Pair"),o={};for(const t of Array.from(r))o[null!=(i=de(he(t,"key")))?i:""]=de(he(t,"styleUrl"));s["#"+ce(t,"id")]=o}for(const t of Array.from(a))r.features=r.features.concat(ee(t,n,o,s));return r}function Xt(t){if(null===t)return["#000000",1];let e="",i=1;return"#"===t.substring(0,1)&&(t=t.substring(1)),6!==t.length&&3!==t.length||(e=t),8===t.length&&(i=parseInt(t.substring(0,2),16)/255,e="#"+t.substring(6,8)+t.substring(4,6)+t.substring(2,4)),[null!=e?e:"#000000",null!=i?i:1]}function Qt(t){var e;let i=le(t,"coord");const r=[],n=[];0===i.length&&(i=le(t,"gx:coord"));for(const t of Array.from(i))r.push(pe((null!=(e=de(t))?e:"").split(" ")));const o=le(t,"when");for(const t of Array.from(o))n.push(de(t));return{coords:r,times:n}}function te(t){var e,i,r;const n=["Polygon","LineString","Point","Track","gx:Track"];let o,s,a,l,c;const u=[],h=[];if(null!==he(t,"MultiGeometry"))return te(he(t,"MultiGeometry"));if(null!==he(t,"MultiTrack"))return te(he(t,"MultiTrack"));if(null!==he(t,"gx:MultiTrack"))return te(he(t,"gx:MultiTrack"));for(a=0;a<n.length;a++)if(s=le(t,n[a]),s)for(l=0;l<s.length;l++)if(o=s[l],"Point"===n[a])u.push({type:"Point",coordinates:me(null!=(e=de(he(o,"coordinates")))?e:"")});else if("LineString"===n[a])u.push({type:"LineString",coordinates:ge(null!=(i=de(he(o,"coordinates")))?i:"")});else if("Polygon"===n[a]){const t=le(o,"LinearRing"),e=[];for(c=0;c<t.length;c++)e.push(ge(null!=(r=de(he(t[c],"coordinates")))?r:""));u.push({type:"Polygon",coordinates:e})}else if("Track"===n[a]||"gx:Track"===n[a]){const t=Qt(o);u.push({type:"LineString",coordinates:t.coords}),t.times.length&&h.push(t.times)}return{geoms:u,coordTimes:h}}function ee(t,e,i,r){var n,o,s,a,l,c,u,h,p,d;const f=te(t),m={},g=de(he(t,"name")),_=de(he(t,"address")),y=de(he(t,"description")),A=he(t,"TimeSpan"),v=he(t,"TimeStamp"),x=he(t,"ExtendedData"),b=he(t,"visibility");let w,S=de(he(t,"styleUrl")),T=he(t,"LineStyle"),C=he(t,"PolyStyle");if(!f.geoms.length)return[];if(g&&(m.name=g),_&&(m.address=_),S){"#"!==S[0]&&(S="#"+S),m.styleUrl=S,e[S]&&(m.styleHash=e[S]),r[S]&&(m.styleMapHash=r[S],m.styleHash=e[null!=(n=r[S].normal)?n:""]);const t=i[null!=(o=m.styleHash)?o:""];if(t){T||(T=he(t,"LineStyle")),C||(C=he(t,"PolyStyle"));const e=he(t,"IconStyle");if(e){const t=he(e,"Icon");if(t){const e=de(he(t,"href"));e&&(m.icon=e)}}}}if(y&&(m.description=y),A){const t=de(he(A,"begin")),e=de(he(A,"end"));t&&e&&(m.timespan={begin:t,end:e})}if(null!==v&&(m.timestamp=null!=(s=de(he(v,"when")))?s:(new Date).toISOString()),null!==T){const t=Xt(de(he(T,"color"))),e=t[0],i=t[1],r=parseFloat(null!=(a=de(he(T,"width")))?a:"");e&&(m.stroke=e),isNaN(i)||(m["stroke-opacity"]=i),isNaN(r)||(m["stroke-width"]=r)}if(C){const t=Xt(de(he(C,"color"))),e=t[0],i=t[1],r=de(he(C,"fill")),n=de(he(C,"outline"));e&&(m.fill=e),isNaN(i)||(m["fill-opacity"]=i),r&&(m["fill-opacity"]="1"===r?m["fill-opacity"]||1:0),n&&(m["stroke-opacity"]="1"===n?m["stroke-opacity"]||1:0)}if(x){const t=le(x,"Data"),e=le(x,"SimpleData");for(w=0;w<t.length;w++)m[null!=(l=t[w].getAttribute("name"))?l:""]=null!=(c=de(he(t[w],"value")))?c:"";for(w=0;w<e.length;w++)m[null!=(u=e[w].getAttribute("name"))?u:""]=null!=(h=de(e[w]))?h:""}null!==b&&(m.visibility=null!=(p=de(b))?p:""),0!==f.coordTimes.length&&(m.coordTimes=1===f.coordTimes.length?f.coordTimes[0]:f.coordTimes);const M={type:"Feature",geometry:1===f.geoms.length?f.geoms[0]:{type:"GeometryCollection",geometries:f.geoms},properties:m};return ce(t,"id")&&(M.id=null!=(d=ce(t,"id"))?d:void 0),[M]}function ie(t,e){const i=le(t,e),r=[],n=[];let o=[];const s=i.length;if(!(s<2)){for(let t=0;t<s;t++){const e=_e(i[t]);r.push(e.coordinates),e.time&&n.push(e.time),(e.heartRate||o.length)&&(0===o.length&&(o=new Array(t).fill(null)),o.push(e.heartRate))}return{line:r,times:n,heartRates:o}}}function re(t){const e=le(t,"trkseg"),i=[],r=[],n=[];let o;for(let t=0;t<e.length;t++)if(o=ie(e[t],"trkpt"),void 0!==o&&(o.line&&i.push(o.line),o.times&&o.times.length&&r.push(o.times),n.length||o.heartRates&&o.heartRates.length)){if(!n.length)for(let e=0;e<t;e++)n.push(new Array(i[e].length).fill(null));o.heartRates&&o.heartRates.length?n.push(o.heartRates):n.push(new Array(o.line.length).fill(null))}if(0===i.length)return;const s=Wt(Wt({},se(t)),oe(he(t,"extensions")));return 0!==r.length&&(s.coordTimes=1===i.length?r[0]:r),0!==n.length&&(s.heartRates=1===i.length?n[0]:n),1===i.length?{type:"Feature",properties:s,geometry:{type:"LineString",coordinates:i[0]}}:{type:"Feature",properties:s,geometry:{type:"MultiLineString",coordinates:i}}}function ne(t){const e=ie(t,"rtept");if(void 0!==e)return{type:"Feature",properties:Wt(Wt({},se(t)),oe(he(t,"extensions"))),geometry:{type:"LineString",coordinates:e.line}}}function oe(t){var e,i;const r={};if(t){const n=he(t,"line");if(n){const t=de(he(n,"color")),o=parseFloat(null!=(e=de(he(n,"opacity")))?e:"0"),s=parseFloat(null!=(i=de(he(n,"width")))?i:"0");t&&(r.stroke=t),isNaN(o)||(r["stroke-opacity"]=o),isNaN(s)||(r["stroke-width"]=96*s/25.4)}}return r}function se(t){const e=fe(t,["name","cmt","desc","type","time","keywords"]),i=le(t,"link");if(0!==i.length){e.links=[];for(const t of Array.from(i)){const i=Wt({href:ce(t,"href")},fe(t,["text","type"]));e.links.push(i)}}return e}function ae(t){let e=0;if(!t||!t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i)|0;return e}function le(t,e){return t.getElementsByTagName(e)}function ce(t,e){return t.getAttribute(e)}function ue(t,e){var i;return parseFloat(null!=(i=ce(t,e))?i:"0")}function he(t,e){const i=le(t,e);return i.length?i[0]:null}function pe(t){return t.map(parseFloat).map((t=>isNaN(t)?null:t))}function de(t){var e;return t&&(e=t).normalize&&e.normalize(),t&&t.textContent}function fe(t,e){var i;const r={};let n,o;for(o=0;o<e.length;o++)n=he(t,e[o]),n&&(r[e[o]]=null!=(i=de(n))?i:"");return r}function me(t){return pe(t.replace(/\s*/g,"").split(","))}function ge(t){const e=t.replace(/^\s*|\s*$/g,"").split(/\s+/),i=[];for(const t of e)i.push(me(t));return i}function _e(t){var e,i;const r=[ue(t,"lon"),ue(t,"lat")],n=he(t,"ele"),o=he(t,"gpxtpx:hr")||he(t,"hr"),s=he(t,"time");let a;return n&&(a=parseFloat(null!=(e=de(n))?e:"0"),isNaN(a)||r.push(a)),{coordinates:r,time:s?de(s):null,heartRate:null!==o?parseFloat(null!=(i=de(o))?i:"0"):null}}var ye=Object.defineProperty,Ae=(t,e,i)=>(((t,e,i)=>{e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i);function ve(t){const e=t.toString(16);return 1==e.length?"0"+e:e}class xe extends Array{constructor(t={}){super(),Ae(this,"min",0),Ae(this,"max",1),"min"in t&&(this.min=t.min),"max"in t&&(this.max=t.max),"stops"in t&&this.setStops(t.stops,{clone:!1})}static fromArrayDefinition(t){return new xe({stops:t.map((t=>({value:t[0],color:t[1]})))})}setStops(t,e={clone:!0}){const i=e.clone?this.clone():this;i.length=0;let r=1/0,n=-1/0;for(let e=0;e<t.length;e+=1)r=Math.min(r,t[e].value),n=Math.max(n,t[e].value),i.push({value:t[e].value,color:t[e].color.slice()});return i.sort(((t,e)=>t.value<e.value?-1:1)),this.min=r,this.max=n,i}scale(t,e,i={clone:!0}){const r=i.clone,n=this[0].value,o=this.at(-1).value-n,s=e-t,a=[];for(let e=0;e<this.length;e+=1){const i=(this[e].value-n)/o*s+t;r?a.push({value:i,color:this[e].color.slice()}):this[e].value=i}return r?new xe({stops:a}):this}at(t){return t<0?this[this.length+t]:this[t]}clone(){return new xe({stops:this.getRawColorStops()})}getRawColorStops(){const t=[];for(let e=0;e<this.length;e+=1)t.push({value:this[e].value,color:this[e].color});return t}reverse(t={clone:!0}){const e=t.clone?this.clone():this;for(let t=0;t<~~(e.length/2);t+=1){const i=e[t].color;e[t].color=e.at(-(t+1)).color,e.at(-(t+1)).color=i}return e}getBounds(){return{min:this.min,max:this.max}}getColor(t,e={smooth:!0}){if(t<=this[0].value)return this[0].color;if(t>=this.at(-1).value)return this.at(-1).color;for(let i=0;i<this.length-1;i+=1){if(t>this[i+1].value)continue;const r=this[i].color;if(!e.smooth)return r.slice();const n=this[i].value,o=this[i+1].value,s=this[i+1].color,a=(o-t)/(o-n);return r.map(((t,e)=>Math.round(t*a+s[e]*(1-a))))}return[0,0,0]}getColorHex(t,e={smooth:!0,withAlpha:!1}){return"#"+ve((i=this.getColor(t,e))[0])+ve(i[1])+ve(i[2])+(4===i.length?ve(i[3]):"");var i}getColorRelative(t,e={smooth:!0}){const i=this.getBounds();return this.getColor(i.min+t*(i.max-i.min),e)}getCanvasStrip(t={horizontal:!0,size:512,smooth:!0}){const e=document.createElement("canvas");e.width=t.horizontal?t.size:1,e.height=t.horizontal?1:t.size;const i=e.getContext("2d");if(!i)throw new Error("Canvs context is missing");const r=i.getImageData(0,0,e.width,e.height),n=r.data,o=t.size,s=this[0].value,a=(this.at(-1).value-s)/o;for(let e=0;e<o;e+=1){const i=this.getColor(s+e*a,{smooth:t.smooth});n[4*e]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i.length>3?i[3]:255}return i.putImageData(r,0,0),e}resample(t,e=15){const i=this.getBounds(),r=this.scale(0,1),n=1/(e-1);let o;if("ease-in-square"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=Math.pow(i,2);return{value:i,color:r.getColor(o)}}));else if("ease-out-square"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-Math.pow(1-i,2);return{value:i,color:r.getColor(o)}}));else if("ease-out-sqrt"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=Math.pow(i,.5);return{value:i,color:r.getColor(o)}}));else if("ease-in-sqrt"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-Math.pow(1-i,.5);return{value:i,color:r.getColor(o)}}));else if("ease-out-exp"===t)o=Array.from({length:e},((t,e)=>{const i=e*n,o=1-Math.pow(2,-10*i);return{value:i,color:r.getColor(o)}}));else{if("ease-in-exp"!==t)throw new Error("Invalid ressampling method.");o=Array.from({length:e},((t,e)=>{const i=e*n,o=Math.pow(2,10*i-10);return{value:i,color:r.getColor(o)}}))}return new xe({stops:o}).scale(i.min,i.max)}transparentStart(){const t=this.getRawColorStops();return t.unshift({value:t[0].value,color:t[0].color.slice()}),t[1].value+=.001,t.forEach((t=>{3===t.color.length&&t.color.push(255)})),t[0].color[3]=0,new xe({stops:t})}hasTransparentStart(){return 4===this[0].color.length&&0===this[0].color[3]}}const be={NULL:new xe({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),GRAY:new xe({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),JET:new xe({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),HSV:new xe({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),HOT:new xe({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),SPRING:new xe({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),SUMMER:new xe({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),AUTOMN:new xe({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),WINTER:new xe({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),BONE:new xe({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),COPPER:new xe({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),GREYS:new xe({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),YIGNBU:new xe({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),GREENS:new xe({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),YIORRD:new xe({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),BLUERED:new xe({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),RDBU:new xe({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),PICNIC:new xe({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),RAINBOW:new xe({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),PORTLAND:new xe({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),BLACKBODY:new xe({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),EARTH:new xe({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),ELECTRIC:new xe({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),VIRIDIS:new xe({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),INFERNO:new xe({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),MAGMA:new xe({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),PLASMA:new xe({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),WARM:new xe({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),COOL:new xe({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),RAINBOW_SOFT:new xe({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),BATHYMETRY:new xe({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),CDOM:new xe({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),CHLOROPHYLL:new xe({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),DENSITY:new xe({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),FREESURFACE_BLUE:new xe({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),FREESURFACE_RED:new xe({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),OXYGEN:new xe({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),PAR:new xe({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),PHASE:new xe({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),SALINITY:new xe({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),TEMPERATURE:new xe({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),TURBIDITY:new xe({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),VELOCITY_BLUE:new xe({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),VELOCITY_GREEN:new xe({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),CUBEHELIX:new xe({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),CIVIDIS:new xe({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),TURBO:new xe({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),ROCKET:new xe({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),MAKO:new xe({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]})},we=[["#1D5B79","#468B97","#EF6262","#F3AA60"],["#614BC3","#33BBC5","#85E6C5","#C8FFE0"],["#461959","#7A316F","#CD6688","#AED8CC"],["#0079FF","#00DFA2","#F6FA70","#FF0060"],["#39B5E0","#A31ACB","#FF78F0","#F5EA5A"],["#37E2D5","#590696","#C70A80","#FBCB0A"],["#FFD36E","#FFF56D","#99FFCD","#9FB4FF"],["#00EAD3","#FFF5B7","#FF449F","#005F99"],["#10A19D","#540375","#FF7000","#FFBF00"]];function Se(){return we[~~(Math.random()*we.length)][~~(4*Math.random())]}function Te(){return`maptiler_source_${k()}`}function Ce(){return`maptiler_layer_${k()}`}function Me(t,e){if(e<=t[0].zoom)return t[0].value;if(e>=t[t.length-1].zoom)return t[t.length-1].value;for(let i=0;i<t.length-1;i+=1)if(e>=t[i].zoom&&e<t[i+1].zoom){const r=t[i+1].zoom-t[i].zoom,n=(e-t[i].zoom)/r;return n*t[i+1].value+(1-n)*t[i].value}return 0}function Ee(t){return["interpolate",["linear"],["zoom"],...t.map((t=>[t.zoom,t.value])).flat()]}function Ie(t){return["interpolate",["linear"],["zoom"],...t.map((t=>[t.zoom,t.value])).flat()]}function Le(t,e){return"number"==typeof e&&"number"==typeof t?2*e+t:"number"==typeof e&&Array.isArray(t)?["interpolate",["linear"],["zoom"],...t.map((t=>[t.zoom,2*e+t.value])).flat()]:"number"==typeof t&&Array.isArray(e)?["interpolate",["linear"],["zoom"],...e.map((e=>[e.zoom,2*e.value+t])).flat()]:Array.isArray(t)&&Array.isArray(e)?["interpolate",["linear"],["zoom"],...Array.from(new Set([...t.map((t=>t.zoom)),...e.map((t=>t.zoom))])).sort(((t,e)=>t<e?-1:1)).map((i=>[i,2*Me(e,i)+Me(t,i)])).flat()]:0}function Pe(t){const e=t.trimStart(),i=`${e}${" ".repeat(t.length-e.length)}`,r=Array.from(i);if(!r.every((t=>" "===t||"_"===t)))throw new Error("A dash pattern must be composed only of whitespace and underscore characters.");if(!r.some((t=>"_"===t))||!r.some((t=>" "===t)))throw new Error("A dash pattern must contain at least one underscore and one whitespace character");const n=[1];for(let t=1;t<r.length;t+=1)r[t-1]===r[t]?n[n.length-1]+=1:n.push(1);return n}function ke(t,e){return["interpolate",["linear"],["get",e],...t.map((t=>[t.value,t.color])).flat()]}function Ne(t,e,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.map((t=>[t.value,.025*t.pointRadius])).flat()],2,["interpolate",["linear"],["get",e],...t.map((t=>[t.value,.05*t.pointRadius])).flat()],4,["interpolate",["linear"],["get",e],...t.map((t=>[t.value,.1*t.pointRadius])).flat()],8,["interpolate",["linear"],["get",e],...t.map((t=>[t.value,.25*t.pointRadius])).flat()],16,["interpolate",["linear"],["get",e],...t.map((t=>[t.value,t.pointRadius])).flat()]]:["interpolate",["linear"],["get",e],...t.map((t=>[t.value,t.pointRadius])).flat()]}function De(t,e){return t.every((e=>e.color[3]===t[0].color[3]))?t[0].color[3]?t[0].color[3]/255:1:["interpolate",["linear"],["get",e],...t.getRawColorStops().map((t=>{const e=t.value,i=t.color;return[e,4===i.length?i[3]/255:1]})).flat()]}function Oe(t,e=10){return["interpolate",["linear"],["heatmap-density"],...Array.from({length:e+1},((i,r)=>{const n=r/e;return[n,t.getColorHex(n)]})).flat()]}var Re=Object.defineProperty,Fe=Object.defineProperties,ze=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,Ue=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable,je=(t,e,i)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ge=(t,e)=>{for(var i in e||(e={}))Ue.call(e,i)&&je(t,i,e[i]);if(Be)for(var i of Be(e))Ve.call(e,i)&&je(t,i,e[i]);return t};const Ze={addPolyline:function(t,e){return i=this,r=arguments,n=function*(t,e,i={}){var r,n,o;if(!e.sourceId&&!e.data)throw new Error("Creating a polyline layer requires an existing .sourceId or a valid .data property");let s=e.data;if("string"==typeof s){if(N(s))s=`https://api.maptiler.com/data/${e.data}/features.json?key=${_.apiKey}`;else if("gpx"===(null==(r=s.split(".").pop())?void 0:r.toLowerCase().trim())){const t=yield fetch(s,i);s=$t(yield t.text())}else if("kml"===(null==(n=s.split(".").pop())?void 0:n.toLowerCase().trim())){const t=yield fetch(s,i);s=Yt(yield t.text())}else{const t=null!=(o=function(t){try{return JSON.parse(t)}catch(t){}return null}(s))?o:function(t){try{"string"==typeof t&&(t=Ht(t))}catch(t){return null}try{return $t(t)}catch(t){}try{return Yt(t)}catch(t){}return null}(s);t&&(s=t)}if(!s)throw new Error("Polyline data was provided as string but is incompatible with valid formats.")}return function(t,e){var i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x;if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const b=null!=(i=e.sourceId)?i:Te(),w=null!=(r=e.layerId)?r:Ce(),S={polylineLayerId:w,polylineOutlineLayerId:"",polylineSourceId:b};e.data&&!t.getSource(b)&&t.addSource(b,{type:"geojson",data:e.data});const T=null!=(n=e.lineWidth)?n:3,C=null!=(o=e.lineColor)?o:Se(),M=null!=(s=e.lineOpacity)?s:1,E=null!=(a=e.lineBlur)?a:0,I=null!=(l=e.lineGapWidth)?l:0;let L=null!=(c=e.lineDashArray)?c:null;const P=null!=(u=e.outlineWidth)?u:1,k=null!=(h=e.outlineColor)?h:"#FFFFFF",N=null!=(p=e.outlineOpacity)?p:1,D=null!=(d=e.outlineBlur)?d:0;if("string"==typeof L&&(L=Pe(L)),!0===e.outline){const i=`${w}_outline`;S.polylineOutlineLayerId=i,t.addLayer({id:i,type:"line",source:b,layout:{"line-join":null!=(f=e.lineJoin)?f:"round","line-cap":null!=(m=e.lineCap)?m:"round"},minzoom:null!=(g=e.minzoom)?g:0,maxzoom:null!=(_=e.maxzoom)?_:23,paint:{"line-opacity":"number"==typeof N?N:Ie(N),"line-color":"string"==typeof k?k:Ee(k),"line-width":Le(T,P),"line-blur":"number"==typeof D?D:Ie(D)}},e.beforeId)}return t.addLayer({id:w,type:"line",source:b,layout:{"line-join":null!=(y=e.lineJoin)?y:"round","line-cap":null!=(A=e.lineCap)?A:"round"},minzoom:null!=(v=e.minzoom)?v:0,maxzoom:null!=(x=e.maxzoom)?x:23,paint:Ge({"line-opacity":"number"==typeof M?M:Ie(M),"line-color":"string"==typeof C?C:Ee(C),"line-width":"number"==typeof T?T:Ie(T),"line-blur":"number"==typeof E?E:Ie(E),"line-gap-width":"number"==typeof I?I:Ie(I)},L&&{"line-dasharray":L})},e.beforeId),S}(t,(a=Ge({},e),Fe(a,ze({data:s}))));var a},new Promise(((t,e)=>{var o=t=>{try{a(n.next(t))}catch(t){e(t)}},s=t=>{try{a(n.throw(t))}catch(t){e(t)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(i,r)).next())}));var i,r,n},addPolygon:function(t,e){var i,r,n,o,s,a,l,c,u,h,p;if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const d=null!=(i=e.sourceId)?i:Te(),f=null!=(r=e.layerId)?r:Ce(),m={polygonLayerId:f,polygonOutlineLayerId:e.outline?`${f}_outline`:"",polygonSourceId:d};if(e.data&&!t.getSource(d)){let i=e.data;"string"==typeof i&&N(i)&&(i=`https://api.maptiler.com/data/${i}/features.json?key=${_.apiKey}`),t.addSource(d,{type:"geojson",data:i})}let g=null!=(n=e.outlineDashArray)?n:null;const y=null!=(o=e.outlineWidth)?o:1,A=null!=(s=e.outlineColor)?s:"#FFFFFF",v=null!=(a=e.outlineOpacity)?a:1,x=null!=(l=e.outlineBlur)?l:0,b=null!=(c=e.fillColor)?c:Se(),w=null!=(u=e.fillOpacity)?u:1,S=null!=(h=e.outlinePosition)?h:"center",T=null!=(p=e.pattern)?p:null;"string"==typeof g&&(g=Pe(g));const C=(i=null)=>{var r,n,o,s,a,l;if(t.addLayer({id:f,type:"fill",source:d,minzoom:null!=(r=e.minzoom)?r:0,maxzoom:null!=(n=e.maxzoom)?n:23,paint:Ge({"fill-color":"string"==typeof b?b:Ee(b),"fill-opacity":"number"==typeof w?w:Ie(w)},i&&{"fill-pattern":i})},e.beforeId),!0===e.outline){let i;i="inside"===S?"number"==typeof y?.5*y:Ie(y.map((({zoom:t,value:e})=>({zoom:t,value:.5*e})))):"outside"===S?"number"==typeof y?-.5*y:Ie(y.map((t=>({zoom:t.zoom,value:-.5*t.value})))):0,t.addLayer({id:m.polygonOutlineLayerId,type:"line",source:d,layout:{"line-join":null!=(o=e.outlineJoin)?o:"round","line-cap":null!=(s=e.outlineCap)?s:"butt"},minzoom:null!=(a=e.minzoom)?a:0,maxzoom:null!=(l=e.maxzoom)?l:23,paint:Ge({"line-opacity":"number"==typeof v?v:Ie(v),"line-color":"string"==typeof A?A:Ee(A),"line-width":"number"==typeof y?y:Ie(y),"line-blur":"number"==typeof x?x:Ie(x),"line-offset":i},g&&{"line-dasharray":g})},e.beforeId)}};return T?t.hasImage(T)?C(T):t.loadImage(T,((e,i)=>e?(console.error("Could not load the pattern image.",e.message),C()):i?(t.addImage(T,i),void C(T)):(console.error(`An image cannot be created from the pattern URL ${T}.`),C()))):C(),m},addPoint:function(t,e){var i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,y;if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const A=null!=(i=e.minPointRadius)?i:10,v=null!=(r=e.maxPointRadius)?r:50,x=null!=(n=e.cluster)&&n,b=Array.isArray(e.pointColor)?e.pointColor:be.TURBO.scale(10,e.cluster?1e4:1e3).resample("ease-out-square"),w=b.getBounds(),S=null!=(o=e.sourceId)?o:Te(),T=null!=(s=e.layerId)?s:Ce(),C=null!=(a=e.showLabel)?a:x,M=null==(l=e.alignOnViewport)||l,E=null!=(c=e.outline)&&c,I=null!=(u=e.outlineOpacity)?u:1,L=null!=(h=e.outlineWidth)?h:1,P=null!=(p=e.outlineColor)?p:"#FFFFFF";let k;const D=null==(d=e.zoomCompensation)||d,O=null!=(f=e.minzoom)?f:0,R=null!=(m=e.maxzoom)?m:23;k="number"==typeof e.pointOpacity?e.pointOpacity:Array.isArray(e.pointOpacity)?Ie(e.pointOpacity):e.cluster?De(b,"point_count"):e.property?De(b,e.property):Ie([{zoom:O,value:0},{zoom:O+.25,value:1},{zoom:R-.25,value:1},{zoom:R,value:0}]);const F={pointLayerId:T,clusterLayerId:"",labelLayerId:"",pointSourceId:S};if(e.data&&!t.getSource(S)){let i=e.data;"string"==typeof i&&N(i)&&(i=`https://api.maptiler.com/data/${i}/features.json?key=${_.apiKey}`),t.addSource(S,{type:"geojson",data:i,cluster:x})}if(x){F.clusterLayerId=`${T}_cluster`;const i=Array.from({length:20},((t,e)=>{const i=w.min+e*(w.max-w.min)/19;return{value:i,pointRadius:A+(v-A)*Math.pow(e/19,.5),color:b.getColorHex(i)}}));t.addLayer({id:F.clusterLayerId,type:"circle",source:S,filter:["has","point_count"],paint:Ge({"circle-color":"string"==typeof e.pointColor?e.pointColor:ke(i,"point_count"),"circle-radius":"number"==typeof e.pointRadius?e.pointRadius:Array.isArray(e.pointRadius)?Ie(e.pointRadius):Ne(i,"point_count",!1),"circle-pitch-alignment":M?"viewport":"map","circle-pitch-scale":"map","circle-opacity":k},E&&{"circle-stroke-opacity":"number"==typeof I?I:Ie(I),"circle-stroke-width":"number"==typeof L?L:Ie(L),"circle-stroke-color":"string"==typeof P?P:Ee(P)}),minzoom:O,maxzoom:R},e.beforeId),t.addLayer({id:F.pointLayerId,type:"circle",source:S,filter:["!",["has","point_count"]],paint:Ge({"circle-pitch-alignment":M?"viewport":"map","circle-pitch-scale":"map","circle-color":"string"==typeof e.pointColor?e.pointColor:b.getColorHex(b.getBounds().min),"circle-radius":"number"==typeof e.pointRadius?e.pointRadius:Array.isArray(e.pointRadius)?Ie(e.pointRadius):.75*i[0].pointRadius,"circle-opacity":k},E&&{"circle-stroke-opacity":"number"==typeof I?I:Ie(I),"circle-stroke-width":"number"==typeof L?L:Ie(L),"circle-stroke-color":"string"==typeof P?P:Ee(P)}),minzoom:O,maxzoom:R},e.beforeId)}else{let i="string"==typeof e.pointColor?e.pointColor:Array.isArray(e.pointColor)?e.pointColor.getColorHex(e.pointColor.getBounds().min):Se(),r="number"==typeof e.pointRadius?D?Ie([{zoom:0,value:.025*e.pointRadius},{zoom:2,value:.05*e.pointRadius},{zoom:4,value:.1*e.pointRadius},{zoom:8,value:.25*e.pointRadius},{zoom:16,value:1*e.pointRadius}]):e.pointRadius:Array.isArray(e.pointRadius)?Ie(e.pointRadius):D?Ie([{zoom:0,value:.05*A},{zoom:2,value:.1*A},{zoom:4,value:.2*A},{zoom:8,value:.5*A},{zoom:16,value:1*A}]):A;if(e.property&&Array.isArray(e.pointColor)){const t=Array.from({length:20},((t,i)=>{const r=w.min+i*(w.max-w.min)/19;return{value:r,pointRadius:"number"==typeof e.pointRadius?e.pointRadius:A+(v-A)*Math.pow(i/19,.5),color:"string"==typeof e.pointColor?e.pointColor:b.getColorHex(r)}}));i=ke(t,e.property),r=Ne(t,e.property,D)}t.addLayer({id:F.pointLayerId,type:"circle",source:S,layout:{"circle-sort-key":e.property?["/",1,["get",e.property]]:0},paint:Ge({"circle-pitch-alignment":M?"viewport":"map","circle-pitch-scale":"map","circle-color":i,"circle-opacity":k,"circle-radius":r},E&&{"circle-stroke-opacity":"number"==typeof I?I:Ie(I),"circle-stroke-width":"number"==typeof L?L:Ie(L),"circle-stroke-color":"string"==typeof P?P:Ee(P)}),minzoom:O,maxzoom:R},e.beforeId)}if(!1!==C&&(e.cluster||e.property)){F.labelLayerId=`${T}_label`;const i=null!=(g=e.labelColor)?g:"#fff",r=null!=(y=e.labelSize)?y:12;t.addLayer({id:F.labelLayerId,type:"symbol",source:S,filter:["has",e.cluster?"point_count":e.property],layout:{"text-field":e.cluster?"{point_count_abbreviated}":`{${e.property}}`,"text-font":["Noto Sans Regular"],"text-size":r,"text-pitch-alignment":M?"viewport":"map","symbol-sort-key":["/",1,["get",e.cluster?"point_count":e.property]]},paint:{"text-color":i,"text-opacity":k},minzoom:O,maxzoom:R},e.beforeId)}return F},addHeatmap:function(t,e){var i,r,n,o,s,a,l,c,u,h;if(e.layerId&&t.getLayer(e.layerId))throw new Error(`A layer already exists with the layer id: ${e.layerId}`);const p=null!=(i=e.sourceId)?i:Te(),d=null!=(r=e.layerId)?r:Ce(),f=null!=(n=e.minzoom)?n:0,m=null!=(o=e.maxzoom)?o:23,g=null==(s=e.zoomCompensation)||s,y=null!=(a=e.opacity)?a:[{zoom:f,value:0},{zoom:f+.25,value:1},{zoom:m-.25,value:1},{zoom:m,value:0}];let A=Array.isArray(e.colorRamp)?e.colorRamp:be.TURBO.transparentStart();const v=A.getBounds();0===v.min&&1===v.max||(A=A.scale(0,1)),A.hasTransparentStart()||(A=A.transparentStart());const x=null!=(l=e.intensity)?l:[{zoom:0,value:.01},{zoom:4,value:.2},{zoom:16,value:1}],b=null!=(c=e.property)?c:null,w=null!=(u=e.weight)?u:1;let S=1;b?"number"==typeof w?(S=w,"number"==typeof e.weight&&console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`")):Array.isArray(w)?S=function(t,e){return["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,t.value])).flat()]}(w,b):console.warn("The option `.property` is ignored when `.propertyValueWeights` is not of type `PropertyValueWeights`"):"number"==typeof w?S=w:Array.isArray(w)&&console.warn("The options `.propertyValueWeights` can only be used when `.property` is provided.");const T=[{zoom:0,value:1.25},{zoom:2,value:2.5},{zoom:4,value:5},{zoom:8,value:12.5},{zoom:16,value:50}],C=null!=(h=e.radius)?h:g?T:10;let M=1;"number"==typeof C?M=C:Array.isArray(C)&&"zoom"in C[0]?M=Ie(C):b&&Array.isArray(C)&&"propertyValue"in C[0]?M=function(t,e,i=!0){return i?["interpolate",["linear"],["zoom"],0,["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,.025*t.value])).flat()],2,["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,.05*t.value])).flat()],4,["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,.1*t.value])).flat()],8,["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,.25*t.value])).flat()],16,["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,t.value])).flat()]]:["interpolate",["linear"],["get",e],...t.map((t=>[t.propertyValue,t.value])).flat()]}(C,b,g):!b&&Array.isArray(C)&&"propertyValue"in C[0]?(M=Ie(T),console.warn("The option `.radius` can only be property-driven if the option `.property` is provided.")):M=Ie(T);const E={heatmapLayerId:d,heatmapSourceId:p};if(e.data&&!t.getSource(p)){let i=e.data;"string"==typeof i&&N(i)&&(i=`https://api.maptiler.com/data/${i}/features.json?key=${_.apiKey}`),t.addSource(p,{type:"geojson",data:i})}return t.addLayer({id:d,type:"heatmap",source:p,minzoom:f,maxzoom:m,paint:{"heatmap-weight":S,"heatmap-intensity":"number"==typeof x?x:Ie(x),"heatmap-color":Oe(A),"heatmap-radius":M,"heatmap-opacity":"number"==typeof y?y:Ie(y)}}),E}},{setRTLTextPlugin:qe,getRTLTextPluginStatus:We,LngLat:He,LngLatBounds:Je,MercatorCoordinate:Ke,Evented:$e,AJAXError:Ye,prewarm:Xe,clearPrewarmedResources:Qe,version:ti,workerCount:ei,maxParallelImageRequests:ii,workerUrl:ri,addProtocol:ni,removeProtocol:oi}=r;r.Map,r.Marker,r.Popup,r.Style,r.CanvasSource,r.GeoJSONSource,r.ImageSource,r.RasterTileSource,r.RasterDEMTileSource,r.VectorTileSource,r.VideoSource,r.NavigationControl,r.GeolocateControl,r.AttributionControl,r.LogoControl,r.ScaleControl,r.FullscreenControl,r.TerrainControl},20992:(t,e,i)=>{"use strict";function r(t,e){return Array.from(t.getElementsByTagName(e))}function n(t){return"#"===t[0]?t:`#${t}`}function o(t){return t?.normalize(),t&&t.textContent||""}function s(t,e,i){const r=t.getElementsByTagName(e),n=r.length?r[0]:null;return n&&i&&i(n),n}function a(t,e,i){const r={};if(!t)return r;const n=t.getElementsByTagName(e),o=n.length?n[0]:null;return o&&i?i(o,r):r}function l(t,e,i){const r=o(s(t,e));return r&&i&&i(r)||{}}function c(t,e,i){const r=parseFloat(o(s(t,e)));if(!isNaN(r))return i&&i(r),r}function u(t,e){const i={};for(const r of e)l(t,r,(t=>{i[r]=t}));return i}function h(t){return 1===t?.nodeType}function p(t,e){const i={},r="stroke"==e||"fill"===e?e:e+"-color";return"#"===t[0]&&(t=t.substring(1)),6===t.length||3===t.length?i[r]="#"+t:8===t.length&&(i[e+"-opacity"]=parseInt(t.substring(0,2),16)/255,i[r]="#"+t.substring(6,8)+t.substring(4,6)+t.substring(2,4)),i}function d(t,e,i){const r={};return c(t,e,(t=>{r[i]=t})),r}function f(t,e){return a(t,"color",(t=>p(o(t),e)))}function m(t){return a(t,"Icon",((t,e)=>(l(t,"href",(t=>{e.icon=t})),e)))}function g(t){return Object.assign({},function(t){return a(t,"PolyStyle",((t,e)=>Object.assign(e,a(t,"color",(t=>p(o(t),"fill"))),l(t,"fill",(t=>{if("0"===t)return{"fill-opacity":0}})),l(t,"outline",(t=>{if("0"===t)return{"stroke-opacity":0}})))))}(t),function(t){return a(t,"LineStyle",(t=>Object.assign(f(t,"stroke"),d(t,"width","stroke-width"))))}(t),function(t){return a(t,"LabelStyle",(t=>Object.assign(f(t,"label"),d(t,"scale","label-scale"))))}(t),function(t){return a(t,"IconStyle",(t=>Object.assign(f(t,"icon"),d(t,"scale","icon-scale"),d(t,"heading","icon-heading"),a(t,"hotSpot",(t=>{const e=parseFloat(t.getAttribute("x")||""),i=parseFloat(t.getAttribute("y")||""),r=t.getAttribute("xunits")||"",n=t.getAttribute("yunits")||"";return isNaN(e)||isNaN(i)?{}:{"icon-offset":[e,i],"icon-offset-units":[r,n]}})),m(t))))}(t))}i.d(e,{bW:()=>z});const _=t=>Number(t),y={string:t=>t,int:_,uint:_,short:_,ushort:_,float:_,double:_,bool:t=>Boolean(t)};function A(t,e){return a(t,"ExtendedData",((t,i)=>{for(const e of r(t,"Data"))i[e.getAttribute("name")||""]=o(s(e,"value"));for(const n of r(t,"SimpleData")){const t=n.getAttribute("name")||"",r=e[t]||y.string;i[t]=r(o(n))}return i}))}function v(t){const e=s(t,"description");for(const t of Array.from(e?.childNodes||[]))if(4===t.nodeType)return{description:{"@type":"html",value:o(t)}};return{}}function x(t){return a(t,"TimeSpan",(t=>({timespan:{begin:o(s(t,"begin")),end:o(s(t,"end"))}})))}function b(t){return a(t,"TimeStamp",(t=>({timestamp:o(s(t,"when"))})))}function w(t,e){return l(t,"styleUrl",(t=>(t=n(t),e[t]?Object.assign({styleUrl:t},e[t]):{styleUrl:t})))}const S=/\s*/g,T=/^\s*|\s*$/g,C=/\s+/;function M(t){return t.replace(S,"").split(",").map(parseFloat).filter((t=>!isNaN(t))).slice(0,3)}function E(t){return t.replace(T,"").split(C).map(M).filter((t=>t.length>=2))}function I(t){let e=r(t,"coord");var i;0===e.length&&(i=t,"coord","*",e=Array.from(i.getElementsByTagNameNS("*","coord")));const n=e.map((t=>o(t).split(" ").map(parseFloat)));return 0===n.length?null:{geometry:n.length>2?{type:"LineString",coordinates:n}:{type:"Point",coordinates:n[0]},times:r(t,"when").map((t=>o(t)))}}function L(t){if(0===t.length)return t;const e=t[0],i=t[t.length-1];let r=!0;for(let t=0;t<Math.max(e.length,i.length);t++)if(e[t]!==i[t]){r=!1;break}return r?t:t.concat([t[0]])}function P(t){return o(s(t,"coordinates"))}function k(t){let e=[],i=[];for(let n=0;n<t.childNodes.length;n++){const o=t.childNodes.item(n);if(h(o))switch(o.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const t=k(o);e=e.concat(t.geometries),i=i.concat(t.coordTimes);break}case"Point":{const t=M(P(o));t.length>=2&&e.push({type:"Point",coordinates:t});break}case"LinearRing":case"LineString":{const t=E(P(o));t.length>=2&&e.push({type:"LineString",coordinates:t});break}case"Polygon":{const t=[];for(const e of r(o,"LinearRing")){const i=L(E(P(e)));i.length>=4&&t.push(i)}t.length&&e.push({type:"Polygon",coordinates:t});break}case"Track":case"gx:Track":{const t=I(o);if(!t)break;const{times:r,geometry:n}=t;e.push(n),r.length&&i.push(r);break}}}return{geometries:e,coordTimes:i}}function N(t,e,i,r){const{coordTimes:n,geometries:o}=k(t),s=function(t){return 0===t.length?null:1===t.length?t[0]:{type:"GeometryCollection",geometries:t}}(o);if(!s&&r.skipNullGeometry)return null;const a={type:"Feature",geometry:s,properties:Object.assign(u(t,["name","address","visibility","open","phoneNumber","description"]),v(t),w(t,e),g(t),A(t,i),x(t),b(t),n.length?{coordinateProperties:{times:1===n.length?n[0]:n}}:{})};void 0!==a.properties?.visibility&&(a.properties.visibility="0"!==a.properties.visibility);const l=t.getAttribute("id");return null!==l&&""!==l&&(a.id=l),a}const D=Math.PI/180;function O(t,e,i,r){const n=function(t){return s(t,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[L(E(P(t)))]}}:function(t){const e=s(t,"LatLonBox");if(e){const t=c(e,"north"),i=c(e,"west"),r=c(e,"east"),n=c(e,"south"),o=c(e,"rotation");if("number"==typeof t&&"number"==typeof n&&"number"==typeof i&&"number"==typeof r){const e=[i,n,r,t];let s=[[[i,t],[r,t],[r,n],[i,n],[i,t]]];return"number"==typeof o&&(s=function(t,e,i){const r=[(t[0]+t[2])/2,(t[1]+t[3])/2];return[e[0].map((t=>{const e=t[1]-r[1],n=t[0]-r[0],o=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),s=Math.atan2(e,n)+i*D;return[r[0]+Math.cos(s)*o,r[1]+Math.sin(s)*o]}))]}(e,s,o)),{bbox:e,geometry:{type:"Polygon",coordinates:s}}}}return null}(t)}(t),o=n?.geometry||null;if(!o&&r.skipNullGeometry)return null;const a={type:"Feature",geometry:o,properties:Object.assign({"@geometry-type":"groundoverlay"},u(t,["name","address","visibility","open","phoneNumber","description"]),v(t),w(t,e),g(t),m(t),A(t,i),x(t),b(t))};n?.bbox&&(a.bbox=n.bbox),void 0!==a.properties?.visibility&&(a.properties.visibility="0"!==a.properties.visibility);const l=t.getAttribute("id");return null!==l&&""!==l&&(a.id=l),a}function R(t){let e=t.getAttribute("id");const i=t.parentNode;return!e&&h(i)&&"CascadingStyle"===i.localName&&(e=i.getAttribute("kml:id")||i.getAttribute("id")),n(e||"")}function*F(t,e={skipNullGeometry:!1}){const i=function(t){const e={};for(const i of r(t,"Style"))e[R(i)]=g(i);for(const i of r(t,"StyleMap")){const t=n(i.getAttribute("id")||"");l(i,"styleUrl",(i=>{i=n(i),e[i]&&(e[t]=e[i])}))}return e}(t),o=function(t){const e={};for(const i of r(t,"SimpleField"))e[i.getAttribute("name")||""]=y[i.getAttribute("type")||""]||y.string;return e}(t);for(const n of r(t,"Placemark")){const t=N(n,i,o,e);t&&(yield t)}for(const n of r(t,"GroundOverlay")){const t=O(n,i,o,e);t&&(yield t)}}function z(t,e={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(F(t,e))}}},20491:(t,e,i)=>{"use strict";i(67604),i(96558),i(30669),i(93279),i(45046)},66093:(t,e,i)=>{"use strict";i(67604),i(93279),i(7743)},90999:(t,e,i)=>{"use strict";i(29987)},7002:(t,e,i)=>{"use strict";i(93279),i(45046)},31234:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(93279);function n(t,e){void 0===e&&(e={});var i=Number(t[0]),n=Number(t[1]),o=Number(t[2]),s=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[i,n],l=[i,s],c=[o,s],u=[o,n];return(0,r.n1)([[a,u,c,l,a]],e.properties,{bbox:t,id:e.id})}},75917:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(29987);function n(t){var e=[1/0,1/0,-1/0,-1/0];return(0,r.Fh)(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}n.default=n;const o=n},67604:(t,e,i)=>{"use strict";i(93279),i(45046)},92881:(t,e,i)=>{"use strict";i(93279),i(45046),i(18008)},18008:()=>{"use strict";!function(){function t(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var i=this.points[e],r=this.points[e+1];this.centers.push({x:(i.x+r.x)/2,y:(i.y+r.y)/2,z:(i.z+r.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),e=0;e<this.centers.length-1;e++){var n=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,o=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,s=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+n),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+s)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+n),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+o),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+s)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}t.prototype.cacheSteps=function(t){var e=[],i=this.pos(0);e.push(0);for(var r=0;r<this.duration;r+=10){var n=this.pos(r);Math.sqrt((n.x-i.x)*(n.x-i.x)+(n.y-i.y)*(n.y-i.y)+(n.z-i.z)*(n.z-i.z))>t&&(e.push(r),i=n)}return e},t.prototype.vector=function(t){var e=this.pos(t+10),i=this.pos(t-10);return{angle:180*Math.atan2(e.y-i.y,e.x-i.x)/3.14,speed:Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)+(i.z-e.z)*(i.z-e.z))}},t.prototype.pos=function(t){var e=t-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var i=e/this.duration;if(i>=1)return this.points[this.length-1];var r=Math.floor((this.points.length-1)*i);return function(t,e,i,r,n){var o=function(t){var e=t*t;return[e*t,3*e*(1-t),3*t*(1-t)*(1-t),(1-t)*(1-t)*(1-t)]}(t);return{x:n.x*o[0]+r.x*o[1]+i.x*o[2]+e.x*o[3],y:n.y*o[0]+r.y*o[1]+i.y*o[2]+e.y*o[3],z:n.z*o[0]+r.z*o[1]+i.z*o[2]+e.z*o[3]}}((this.length-1)*i-r,this.points[r],this.controls[r][1],this.controls[r+1][0],this.points[r+1])}}()},20145:(t,e,i)=>{"use strict";i(45046)},64284:(t,e,i)=>{"use strict";i(75917),i(22608),i(1958),i(45046)},50347:(t,e,i)=>{"use strict";i(78640),i(65875),i(22608),i(45046),i(93279)},28297:(t,e,i)=>{"use strict";i(22608),i(78640),i(29987),i(65875)},3327:(t,e,i)=>{"use strict";i(11016),i(22900),i(45046)},55263:(t,e,i)=>{"use strict";i(28297),i(29987)},27296:(t,e,i)=>{"use strict";i(29987),i(45046),i(20790),i(78640),i(11016)},52170:(t,e,i)=>{"use strict";i(22900),i(75448),i(7743),i(93279)},22608:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(45046);function n(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var n=(0,r.uG)(t),s=(0,r.bg)(e),a=s.type,l=e.bbox,c=s.coordinates;if(l&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(n,l))return!1;"Polygon"===a&&(c=[c]);for(var u=!1,h=0;h<c.length&&!u;h++)if(o(n,c[h][0],i.ignoreBoundary)){for(var p=!1,d=1;d<c[h].length&&!p;)o(n,c[h][d],!i.ignoreBoundary)&&(p=!0),d++;p||(u=!0)}return u}function o(t,e,i){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,o=e.length-1;n<e.length;o=n++){var s=e[n][0],a=e[n][1],l=e[o][0],c=e[o][1];if(t[1]*(s-l)+a*(l-t[0])+c*(t[0]-s)==0&&(s-t[0])*(l-t[0])<=0&&(a-t[1])*(c-t[1])<=0)return!i;a>t[1]!=c>t[1]&&t[0]<(l-s)*(t[1]-a)/(c-a)+s&&(r=!r)}return r}},1958:(t,e,i)=>{"use strict";i(45046)},64078:(t,e,i)=>{"use strict";i(75917),i(1958),i(22608),i(45046)},57468:(t,e,i)=>{"use strict";i(25903),i(50039),i(29987),i(57672),i(93279)},75843:(t,e,i)=>{"use strict";i(29987),i(93279)},87836:(t,e,i)=>{"use strict";i(75843),i(30669),i(17450),i(93279),i(29987)},12102:(t,e,i)=>{"use strict";i(57941),i(17450),i(93279),i(45046),i(29987)},25903:(t,e,i)=>{"use strict";i(75917),i(93279)},17450:(t,e,i)=>{"use strict";i(29987),i(93279)},96338:(t,e,i)=>{"use strict";i(96558),i(93279)},22900:(t,e,i)=>{"use strict";i(93279),i(45046)},40231:(t,e,i)=>{"use strict";i(30669),i(29987),i(93279),i(36112)},37601:(t,e,i)=>{"use strict";i(29987),i(61756)},67925:(t,e,i)=>{"use strict";i(29987),i(93279)},44660:(t,e,i)=>{"use strict";i(75917),i(22608),i(72519)},2343:(t,e,i)=>{"use strict";i(93279),i(29987)},43103:(t,e,i)=>{"use strict";i(30669),i(93279),i(29987),i(96221),i(86042)},86042:(t,e,i)=>{"use strict";i(93279),i(45046),i(29987),i(56787),i(90575)},56787:(t,e,i)=>{"use strict";i(93279),i(45046),i(29987)},90575:(t,e,i)=>{"use strict";i(93279),i(45046),i(29987),i(88184)},57941:(t,e,i)=>{"use strict";i(93279),i(29987),i(71582)},96558:(t,e,i)=>{"use strict";i(93279),i(45046)},50365:(t,e,i)=>{"use strict";i(59004),i(93279),i(45046)},39721:(t,e,i)=>{"use strict";i(93279),i(45046),i(29987),i(40368),i(59004)},38220:(t,e,i)=>{"use strict";i(17450),i(45046),i(29987)},30669:(t,e,i)=>{"use strict";i(45046),i(93279)},53416:(t,e,i)=>{"use strict";i(93279),i(7861),i(5486),i(45046)},58658:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(75917),n=i(31234);const o=function(t){return(0,n.A)((0,r.A)(t))}},29307:(t,e,i)=>{"use strict";i(29987),i(93279)},40368:(t,e,i)=>{"use strict";i(29987),i(93279)},90301:(t,e,i)=>{"use strict";i(29987),i(93279)},52282:(t,e,i)=>{"use strict";i(45046);var r=Math.PI/180,n=180/Math.PI,o=function(t,e){this.lon=t,this.lat=e,this.x=r*t,this.y=r*e};o.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},o.prototype.antipode=function(){var t=-1*this.lat,e=this.lon<0?180+this.lon:-1*(180-this.lon);return new o(e,t)};var s=function(){this.coords=[],this.length=0};s.prototype.move_to=function(t){this.length++,this.coords.push(t)};var a=function(t){this.properties=t||{},this.geometries=[]};a.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var t=[],e=0;e<this.geometries.length;e++)t.push(this.geometries[e].coords);return{geometry:{type:"MultiLineString",coordinates:t},type:"Feature",properties:this.properties}},a.prototype.wkt=function(){for(var t="",e="LINESTRING(",i=function(t){e+=t[0]+" "+t[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(i),t+=e.substring(0,e.length-1)+")"}return t};var l=function(t,e,i){if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new o(t.x,t.y),this.end=new o(e.x,e.y),this.properties=i||{};var r=this.start.x-this.end.x,n=this.start.y-this.end.y,s=Math.pow(Math.sin(n/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g===Math.PI)throw new Error("it appears "+t.view()+" and "+e.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+t+" and "+e)};l.prototype.interpolate=function(t){var e=Math.sin((1-t)*this.g)/Math.sin(this.g),i=Math.sin(t*this.g)/Math.sin(this.g),r=e*Math.cos(this.start.y)*Math.cos(this.start.x)+i*Math.cos(this.end.y)*Math.cos(this.end.x),o=e*Math.cos(this.start.y)*Math.sin(this.start.x)+i*Math.cos(this.end.y)*Math.sin(this.end.x),s=e*Math.sin(this.start.y)+i*Math.sin(this.end.y),a=n*Math.atan2(s,Math.sqrt(Math.pow(r,2)+Math.pow(o,2)));return[n*Math.atan2(o,r),a]},l.prototype.Arc=function(t,e){var i=[];if(!t||t<=2)i.push([this.start.lon,this.start.lat]),i.push([this.end.lon,this.end.lat]);else for(var r=1/(t-1),n=0;n<t;++n){var o=r*n,l=this.interpolate(o);i.push(l)}for(var c=!1,u=0,h=e&&e.offset?e.offset:10,p=180-h,d=-180+h,f=360-h,m=1;m<i.length;++m){var g=i[m-1][0],_=i[m][0],y=Math.abs(_-g);y>f&&(_>p&&g<d||g>p&&_<d)?c=!0:y>u&&(u=y)}var A=[];if(c&&u<h){var v=[];A.push(v);for(var x=0;x<i.length;++x){var b=parseFloat(i[x][0]);if(x>0&&Math.abs(b-i[x-1][0])>f){var w=parseFloat(i[x-1][0]),S=parseFloat(i[x-1][1]),T=parseFloat(i[x][0]),C=parseFloat(i[x][1]);if(w>-180&&w<d&&180===T&&x+1<i.length&&i[x-1][0]>-180&&i[x-1][0]<d){v.push([-180,i[x][1]]),x++,v.push([i[x][0],i[x][1]]);continue}if(w>p&&w<180&&-180===T&&x+1<i.length&&i[x-1][0]>p&&i[x-1][0]<180){v.push([180,i[x][1]]),x++,v.push([i[x][0],i[x][1]]);continue}if(w<d&&T>p){var M=w;w=T,T=M;var E=S;S=C,C=E}if(w>p&&T<d&&(T+=360),w<=180&&T>=180&&w<T){var I=(180-w)/(T-w),L=I*C+(1-I)*S;v.push([i[x-1][0]>p?180:-180,L]),(v=[]).push([i[x-1][0]>p?-180:180,L]),A.push(v)}else v=[],A.push(v);v.push([b,i[x][1]])}else v.push([i[x][0],i[x][1]])}}else{var P=[];A.push(P);for(var k=0;k<i.length;++k)P.push([i[k][0],i[k][1]])}for(var N=new a(this.properties),D=0;D<A.length;++D){var O=new s;N.geometries.push(O);for(var R=A[D],F=0;F<R.length;++F)O.move_to(R[F])}return N}},93279:(t,e,i)=>{"use strict";function r(t,e,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=t,r}function n(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!l(t[0])||!l(t[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:t},e,i)}function o(t,e,i){void 0===i&&(i={});for(var n=0,o=t;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:t},e,i)}function s(t,e,i){if(void 0===i&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:t},e,i)}function a(t,e,i){return void 0===i&&(i={}),r({type:"MultiPoint",coordinates:t},e,i)}function l(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}i.d(e,{N4:()=>r,kB:()=>a,n1:()=>o,wi:()=>s,zx:()=>n})},68526:(t,e,i)=>{"use strict";i(30669),i(95475),i(93279)},83185:(t,e,i)=>{"use strict";i(75917),i(68526),i(83811),i(30669),i(17450),i(1200),i(51465),i(93279),i(29987),i(45046)},95475:(t,e,i)=>{"use strict";i(93279),i(45046),i(59004)},45046:(t,e,i)=>{"use strict";function r(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function n(t,e,i){if(!t)throw new Error("No feature passed");if(!i)throw new Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw new Error("Invalid input to "+i+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+i+": must be a "+e+", given "+t.geometry.type)}function o(t){return"Feature"===t.type?t.geometry:t}i.d(e,{bg:()=>o,mo:()=>n,uG:()=>r}),i(93279)},74169:(t,e,i)=>{"use strict";i(75917),i(90999),i(22608),i(29307),i(45046),i(93279),i(45228),i(29987);var r=[],n=[],o=[],s=[],a=[],l=[],c=[],u=[],h=[],p=[],d=[],f=[],m=[],g=[],_=[],y=[],A=[],v=[],x=[],b=[],w=[],S=[],T=[],C=[];c[85]=p[85]=-1,u[85]=d[85]=0,h[85]=f[85]=1,x[85]=S[85]=1,b[85]=T[85]=0,w[85]=C[85]=1,r[85]=s[85]=0,n[85]=a[85]=-1,o[85]=_[85]=0,y[85]=m[85]=0,A[85]=g[85]=1,l[85]=v[85]=1,S[1]=S[169]=0,T[1]=T[169]=-1,C[1]=C[169]=0,m[1]=m[169]=-1,g[1]=g[169]=0,_[1]=_[169]=0,p[4]=p[166]=0,d[4]=d[166]=-1,f[4]=f[166]=1,y[4]=y[166]=1,A[4]=A[166]=0,v[4]=v[166]=0,c[16]=c[154]=0,u[16]=u[154]=1,h[16]=h[154]=1,s[16]=s[154]=1,a[16]=a[154]=0,l[16]=l[154]=1,x[64]=x[106]=0,b[64]=b[106]=1,w[64]=w[106]=0,r[64]=r[106]=-1,n[64]=n[106]=0,o[64]=o[106]=1,x[2]=x[168]=0,b[2]=b[168]=-1,w[2]=w[168]=1,S[2]=S[168]=0,T[2]=T[168]=-1,C[2]=C[168]=0,m[2]=m[168]=-1,g[2]=g[168]=0,_[2]=_[168]=0,y[2]=y[168]=-1,A[2]=A[168]=0,v[2]=v[168]=1,c[8]=c[162]=0,u[8]=u[162]=-1,h[8]=h[162]=0,p[8]=p[162]=0,d[8]=d[162]=-1,f[8]=f[162]=1,m[8]=m[162]=1,g[8]=g[162]=0,_[8]=_[162]=1,y[8]=y[162]=1,A[8]=A[162]=0,v[8]=v[162]=0,c[32]=c[138]=0,u[32]=u[138]=1,h[32]=h[138]=1,p[32]=p[138]=0,d[32]=d[138]=1,f[32]=f[138]=0,r[32]=r[138]=1,n[32]=n[138]=0,o[32]=o[138]=0,s[32]=s[138]=1,a[32]=a[138]=0,l[32]=l[138]=1,S[128]=S[42]=0,T[128]=T[42]=1,C[128]=C[42]=1,x[128]=x[42]=0,b[128]=b[42]=1,w[128]=w[42]=0,r[128]=r[42]=-1,n[128]=n[42]=0,o[128]=o[42]=1,s[128]=s[42]=-1,a[128]=a[42]=0,l[128]=l[42]=0,p[5]=p[165]=-1,d[5]=d[165]=0,f[5]=f[165]=0,S[5]=S[165]=1,T[5]=T[165]=0,C[5]=C[165]=0,y[20]=y[150]=0,A[20]=A[150]=1,v[20]=v[150]=1,s[20]=s[150]=0,a[20]=a[150]=-1,l[20]=l[150]=1,c[80]=c[90]=-1,u[80]=u[90]=0,h[80]=h[90]=1,x[80]=x[90]=1,b[80]=b[90]=0,w[80]=w[90]=1,m[65]=m[105]=0,g[65]=g[105]=1,_[65]=_[105]=0,r[65]=r[105]=0,n[65]=n[105]=-1,o[65]=o[105]=0,c[160]=c[10]=-1,u[160]=u[10]=0,h[160]=h[10]=1,p[160]=p[10]=-1,d[160]=d[10]=0,f[160]=f[10]=0,S[160]=S[10]=1,T[160]=T[10]=0,C[160]=C[10]=0,x[160]=x[10]=1,b[160]=b[10]=0,w[160]=w[10]=1,y[130]=y[40]=0,A[130]=A[40]=1,v[130]=v[40]=1,m[130]=m[40]=0,g[130]=g[40]=1,_[130]=_[40]=0,r[130]=r[40]=0,n[130]=n[40]=-1,o[130]=o[40]=0,s[130]=s[40]=0,a[130]=a[40]=-1,l[130]=l[40]=1,p[37]=p[133]=0,d[37]=d[133]=1,f[37]=f[133]=1,S[37]=S[133]=0,T[37]=T[133]=1,C[37]=C[133]=0,r[37]=r[133]=-1,n[37]=n[133]=0,o[37]=o[133]=0,s[37]=s[133]=1,a[37]=a[133]=0,l[37]=l[133]=0,y[148]=y[22]=-1,A[148]=A[22]=0,v[148]=v[22]=0,S[148]=S[22]=0,T[148]=T[22]=-1,C[148]=C[22]=1,x[148]=x[22]=0,b[148]=b[22]=1,w[148]=w[22]=1,s[148]=s[22]=-1,a[148]=a[22]=0,l[148]=l[22]=1,c[82]=c[88]=0,u[82]=u[88]=-1,h[82]=h[88]=1,y[82]=y[88]=1,A[82]=A[88]=0,v[82]=v[88]=1,m[82]=m[88]=-1,g[82]=g[88]=0,_[82]=_[88]=1,x[82]=x[88]=0,b[82]=b[88]=-1,w[82]=w[88]=0,c[73]=c[97]=0,u[73]=u[97]=1,h[73]=h[97]=0,p[73]=p[97]=0,d[73]=d[97]=-1,f[73]=f[97]=0,m[73]=m[97]=1,g[73]=g[97]=0,_[73]=_[97]=0,r[73]=r[97]=1,n[73]=n[97]=0,o[73]=o[97]=1,c[145]=c[25]=0,u[145]=u[25]=-1,h[145]=h[25]=0,m[145]=m[25]=1,g[145]=g[25]=0,_[145]=_[25]=1,S[145]=S[25]=0,T[145]=T[25]=1,C[145]=C[25]=1,s[145]=s[25]=-1,a[145]=a[25]=0,l[145]=l[25]=0,p[70]=p[100]=0,d[70]=d[100]=1,f[70]=f[100]=0,y[70]=y[100]=-1,A[70]=A[100]=0,v[70]=v[100]=1,x[70]=x[100]=0,b[70]=b[100]=-1,w[70]=w[100]=1,r[70]=r[100]=1,n[70]=n[100]=0,o[70]=o[100]=0,p[101]=p[69]=0,d[101]=d[69]=1,f[101]=f[69]=0,r[101]=r[69]=1,n[101]=n[69]=0,o[101]=o[69]=0,S[149]=S[21]=0,T[149]=T[21]=1,C[149]=C[21]=1,s[149]=s[21]=-1,a[149]=a[21]=0,l[149]=l[21]=0,y[86]=y[84]=-1,A[86]=A[84]=0,v[86]=v[84]=1,x[86]=x[84]=0,b[86]=b[84]=-1,w[86]=w[84]=1,c[89]=c[81]=0,u[89]=u[81]=-1,h[89]=h[81]=0,m[89]=m[81]=1,g[89]=g[81]=0,_[89]=_[81]=1,c[96]=c[74]=0,u[96]=u[74]=1,h[96]=h[74]=0,p[96]=p[74]=-1,d[96]=d[74]=0,f[96]=f[74]=1,x[96]=x[74]=1,b[96]=b[74]=0,w[96]=w[74]=0,r[96]=r[74]=1,n[96]=n[74]=0,o[96]=o[74]=1,c[24]=c[146]=0,u[24]=u[146]=-1,h[24]=h[146]=1,y[24]=y[146]=1,A[24]=A[146]=0,v[24]=v[146]=1,m[24]=m[146]=0,g[24]=g[146]=1,_[24]=_[146]=1,s[24]=s[146]=0,a[24]=a[146]=-1,l[24]=l[146]=0,p[6]=p[164]=-1,d[6]=d[164]=0,f[6]=f[164]=1,y[6]=y[164]=-1,A[6]=A[164]=0,v[6]=v[164]=0,S[6]=S[164]=0,T[6]=T[164]=-1,C[6]=C[164]=1,x[6]=x[164]=1,b[6]=b[164]=0,w[6]=w[164]=0,m[129]=m[41]=0,g[129]=g[41]=1,_[129]=_[41]=1,S[129]=S[41]=0,T[129]=T[41]=1,C[129]=C[41]=0,r[129]=r[41]=-1,n[129]=n[41]=0,o[129]=o[41]=0,s[129]=s[41]=0,a[129]=a[41]=-1,l[129]=l[41]=0,y[66]=y[104]=0,A[66]=A[104]=1,v[66]=v[104]=0,m[66]=m[104]=-1,g[66]=g[104]=0,_[66]=_[104]=1,x[66]=x[104]=0,b[66]=b[104]=-1,w[66]=w[104]=0,r[66]=r[104]=0,n[66]=n[104]=-1,o[66]=o[104]=1,c[144]=c[26]=-1,u[144]=u[26]=0,h[144]=h[26]=0,S[144]=S[26]=1,T[144]=T[26]=0,C[144]=C[26]=1,x[144]=x[26]=0,b[144]=b[26]=1,w[144]=w[26]=1,s[144]=s[26]=-1,a[144]=a[26]=0,l[144]=l[26]=1,p[36]=p[134]=0,d[36]=d[134]=1,f[36]=f[134]=1,y[36]=y[134]=0,A[36]=A[134]=1,v[36]=v[134]=0,r[36]=r[134]=0,n[36]=n[134]=-1,o[36]=o[134]=1,s[36]=s[134]=1,a[36]=a[134]=0,l[36]=l[134]=0,c[9]=c[161]=-1,u[9]=u[161]=0,h[9]=h[161]=0,p[9]=p[161]=0,d[9]=d[161]=-1,f[9]=f[161]=0,m[9]=m[161]=1,g[9]=g[161]=0,_[9]=_[161]=0,S[9]=S[161]=1,T[9]=T[161]=0,C[9]=C[161]=1,c[136]=0,u[136]=1,h[136]=1,p[136]=0,d[136]=1,f[136]=0,y[136]=-1,A[136]=0,v[136]=1,m[136]=-1,g[136]=0,_[136]=0,S[136]=0,T[136]=-1,C[136]=0,x[136]=0,b[136]=-1,w[136]=1,r[136]=1,n[136]=0,o[136]=0,s[136]=1,a[136]=0,l[136]=1,c[34]=0,u[34]=-1,h[34]=0,p[34]=0,d[34]=-1,f[34]=1,y[34]=1,A[34]=0,v[34]=0,m[34]=1,g[34]=0,_[34]=1,S[34]=0,T[34]=1,C[34]=1,x[34]=0,b[34]=1,w[34]=0,r[34]=-1,n[34]=0,o[34]=1,s[34]=-1,a[34]=0,l[34]=0,c[35]=0,u[35]=1,h[35]=1,p[35]=0,d[35]=-1,f[35]=1,y[35]=1,A[35]=0,v[35]=0,m[35]=-1,g[35]=0,_[35]=0,S[35]=0,T[35]=-1,C[35]=0,x[35]=0,b[35]=1,w[35]=0,r[35]=-1,n[35]=0,o[35]=1,s[35]=1,a[35]=0,l[35]=1,c[153]=0,u[153]=1,h[153]=1,m[153]=-1,g[153]=0,_[153]=0,S[153]=0,T[153]=-1,C[153]=0,s[153]=1,a[153]=0,l[153]=1,p[102]=0,d[102]=-1,f[102]=1,y[102]=1,A[102]=0,v[102]=0,x[102]=0,b[102]=1,w[102]=0,r[102]=-1,n[102]=0,o[102]=1,c[155]=0,u[155]=-1,h[155]=0,m[155]=1,g[155]=0,_[155]=1,S[155]=0,T[155]=1,C[155]=1,s[155]=-1,a[155]=0,l[155]=0,p[103]=0,d[103]=1,f[103]=0,y[103]=-1,A[103]=0,v[103]=1,x[103]=0,b[103]=-1,w[103]=1,r[103]=1,n[103]=0,o[103]=0,c[152]=0,u[152]=1,h[152]=1,y[152]=-1,A[152]=0,v[152]=1,m[152]=-1,g[152]=0,_[152]=0,S[152]=0,T[152]=-1,C[152]=0,x[152]=0,b[152]=-1,w[152]=1,s[152]=1,a[152]=0,l[152]=1,c[156]=0,u[156]=-1,h[156]=1,y[156]=1,A[156]=0,v[156]=1,m[156]=-1,g[156]=0,_[156]=0,S[156]=0,T[156]=-1,C[156]=0,x[156]=0,b[156]=1,w[156]=1,s[156]=-1,a[156]=0,l[156]=1,c[137]=0,u[137]=1,h[137]=1,p[137]=0,d[137]=1,f[137]=0,m[137]=-1,g[137]=0,_[137]=0,S[137]=0,T[137]=-1,C[137]=0,r[137]=1,n[137]=0,o[137]=0,s[137]=1,a[137]=0,l[137]=1,c[139]=0,u[139]=1,h[139]=1,p[139]=0,d[139]=-1,f[139]=0,m[139]=1,g[139]=0,_[139]=0,S[139]=0,T[139]=1,C[139]=0,r[139]=-1,n[139]=0,o[139]=0,s[139]=1,a[139]=0,l[139]=1,c[98]=0,u[98]=-1,h[98]=0,p[98]=0,d[98]=-1,f[98]=1,y[98]=1,A[98]=0,v[98]=0,m[98]=1,g[98]=0,_[98]=1,x[98]=0,b[98]=1,w[98]=0,r[98]=-1,n[98]=0,o[98]=1,c[99]=0,u[99]=1,h[99]=0,p[99]=0,d[99]=-1,f[99]=1,y[99]=1,A[99]=0,v[99]=0,m[99]=-1,g[99]=0,_[99]=1,x[99]=0,b[99]=-1,w[99]=0,r[99]=1,n[99]=0,o[99]=1,p[38]=0,d[38]=-1,f[38]=1,y[38]=1,A[38]=0,v[38]=0,S[38]=0,T[38]=1,C[38]=1,x[38]=0,b[38]=1,w[38]=0,r[38]=-1,n[38]=0,o[38]=1,s[38]=-1,a[38]=0,l[38]=0,p[39]=0,d[39]=1,f[39]=1,y[39]=-1,A[39]=0,v[39]=0,S[39]=0,T[39]=-1,C[39]=1,x[39]=0,b[39]=1,w[39]=0,r[39]=-1,n[39]=0,o[39]=1,s[39]=1,a[39]=0,l[39]=0;var M=function(t){return[[t.bottomleft,0],[0,0],[0,t.leftbottom]]},E=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0]]},I=function(t){return[[t.topright,1],[1,1],[1,t.righttop]]},L=function(t){return[[0,t.lefttop],[0,1],[t.topleft,1]]},P=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop]]},k=function(t){return[[t.bottomright,0],[t.bottomleft,0],[1,t.righttop],[1,t.rightbottom]]},N=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.topleft,1],[t.topright,1]]},D=function(t){return[[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},O=[],R=[],F=[],z=[],B=[],U=[],V=[],j=[];z[1]=B[1]=18,z[169]=B[169]=18,F[4]=R[4]=12,F[166]=R[166]=12,O[16]=j[16]=4,O[154]=j[154]=4,U[64]=V[64]=22,U[106]=V[106]=22,F[2]=U[2]=17,z[2]=B[2]=18,F[168]=U[168]=17,z[168]=B[168]=18,O[8]=z[8]=9,R[8]=F[8]=12,O[162]=z[162]=9,R[162]=F[162]=12,O[32]=j[32]=4,R[32]=V[32]=1,O[138]=j[138]=4,R[138]=V[138]=1,B[128]=j[128]=21,U[128]=V[128]=22,B[42]=j[42]=21,U[42]=V[42]=22,R[5]=B[5]=14,R[165]=B[165]=14,F[20]=j[20]=6,F[150]=j[150]=6,O[80]=U[80]=11,O[90]=U[90]=11,z[65]=V[65]=3,z[105]=V[105]=3,O[160]=U[160]=11,R[160]=B[160]=14,O[10]=U[10]=11,R[10]=B[10]=14,F[130]=j[130]=6,z[130]=V[130]=3,F[40]=j[40]=6,z[40]=V[40]=3,R[101]=V[101]=1,R[69]=V[69]=1,B[149]=j[149]=21,B[21]=j[21]=21,F[86]=U[86]=17,F[84]=U[84]=17,O[89]=z[89]=9,O[81]=z[81]=9,O[96]=V[96]=0,R[96]=U[96]=15,O[74]=V[74]=0,R[74]=U[74]=15,O[24]=F[24]=8,z[24]=j[24]=7,O[146]=F[146]=8,z[146]=j[146]=7,R[6]=U[6]=15,F[6]=B[6]=16,R[164]=U[164]=15,F[164]=B[164]=16,z[129]=j[129]=7,B[129]=V[129]=20,z[41]=j[41]=7,B[41]=V[41]=20,F[66]=V[66]=2,z[66]=U[66]=19,F[104]=V[104]=2,z[104]=U[104]=19,O[144]=B[144]=10,U[144]=j[144]=23,O[26]=B[26]=10,U[26]=j[26]=23,R[36]=j[36]=5,F[36]=V[36]=2,R[134]=j[134]=5,F[134]=V[134]=2,O[9]=B[9]=10,R[9]=z[9]=13,O[161]=B[161]=10,R[161]=z[161]=13,R[37]=j[37]=5,B[37]=V[37]=20,R[133]=j[133]=5,B[133]=V[133]=20,F[148]=B[148]=16,U[148]=j[148]=23,F[22]=B[22]=16,U[22]=j[22]=23,O[82]=F[82]=8,z[82]=U[82]=19,O[88]=F[88]=8,z[88]=U[88]=19,O[73]=V[73]=0,R[73]=z[73]=13,O[97]=V[97]=0,R[97]=z[97]=13,O[145]=z[145]=9,B[145]=j[145]=21,O[25]=z[25]=9,B[25]=j[25]=21,R[70]=V[70]=1,F[70]=U[70]=17,R[100]=V[100]=1,F[100]=U[100]=17,O[34]=z[34]=9,R[34]=F[34]=12,B[34]=j[34]=21,U[34]=V[34]=22,O[136]=j[136]=4,R[136]=V[136]=1,F[136]=U[136]=17,z[136]=B[136]=18,O[35]=j[35]=4,R[35]=F[35]=12,z[35]=B[35]=18,U[35]=V[35]=22,O[153]=j[153]=4,z[153]=B[153]=18,R[102]=F[102]=12,U[102]=V[102]=22,O[155]=z[155]=9,B[155]=j[155]=23,R[103]=V[103]=1,F[103]=U[103]=17,O[152]=j[152]=4,F[152]=U[152]=17,z[152]=B[152]=18,O[156]=F[156]=8,z[156]=B[156]=18,U[156]=j[156]=23,O[137]=j[137]=4,R[137]=V[137]=1,z[137]=B[137]=18,O[139]=j[139]=4,R[139]=z[139]=13,B[139]=V[139]=20,O[98]=z[98]=9,R[98]=F[98]=12,U[98]=V[98]=22,O[99]=V[99]=0,R[99]=F[99]=12,z[99]=U[99]=19,R[38]=F[38]=12,B[38]=j[38]=21,U[38]=V[38]=22,R[39]=j[39]=5,F[39]=B[39]=16,U[39]=V[39]=22;var G=[];G[1]=G[169]=M,G[4]=G[166]=E,G[16]=G[154]=I,G[64]=G[106]=L,G[168]=G[2]=P,G[162]=G[8]=k,G[138]=G[32]=N,G[42]=G[128]=D,G[5]=G[165]=function(t){return[[0,0],[0,t.leftbottom],[1,t.rightbottom],[1,0]]},G[20]=G[150]=function(t){return[[1,0],[t.bottomright,0],[t.topright,1],[1,1]]},G[80]=G[90]=function(t){return[[1,1],[1,t.righttop],[0,t.lefttop],[0,1]]},G[65]=G[105]=function(t){return[[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},G[160]=G[10]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.leftbottom],[0,t.lefttop]]},G[130]=G[40]=function(t){return[[t.topleft,1],[t.topright,1],[t.bottomright,0],[t.bottomleft,0]]},G[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},G[101]=G[69]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,1],[t.topleft,1]]},G[149]=G[21]=function(t){return[[t.topright,1],[1,1],[1,0],[0,0],[0,t.leftbottom]]},G[86]=G[84]=function(t){return[[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[1,1]]},G[89]=G[81]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,1]]},G[96]=G[74]=function(t){return[[1,t.righttop],[1,t.rightbottom],[0,t.lefttop],[0,1],[t.topleft,1]]},G[24]=G[146]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[t.topright,1]]},G[6]=G[164]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop]]},G[129]=G[41]=function(t){return[[t.topright,1],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1]]},G[66]=G[104]=function(t){return[[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},G[144]=G[26]=function(t){return[[1,1],[1,t.righttop],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},G[36]=G[134]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[t.topleft,1],[t.topright,1]]},G[9]=G[161]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom]]},G[37]=G[133]=function(t){return[[1,t.rightbottom],[1,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},G[148]=G[22]=function(t){return[[1,1],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},G[82]=G[88]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1]]},G[73]=G[97]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,1],[t.topleft,1]]},G[145]=G[25]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},G[70]=G[100]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},G[34]=function(t){return[D(t),k(t)]},G[35]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]},G[136]=function(t){return[N(t),P(t)]},G[153]=function(t){return[I(t),M(t)]},G[102]=function(t){return[E(t),L(t)]},G[155]=function(t){return[[1,1],[1,t.righttop],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topright,1]]},G[103]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.lefttop],[0,1],[t.topleft,1]]},G[152]=function(t){return[I(t),P(t)]},G[156]=function(t){return[[1,1],[1,t.righttop],[t.bottomright,0],[t.bottomleft,0],[0,t.leftbottom],[0,t.lefttop],[t.topright,1]]},G[137]=function(t){return[N(t),M(t)]},G[139]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomleft,0],[0,0],[0,t.leftbottom],[t.topleft,1],[t.topright,1]]},G[98]=function(t){return[k(t),L(t)]},G[99]=function(t){return[[1,t.righttop],[1,t.rightbottom],[t.bottomright,0],[t.bottomleft,0],[0,t.lefttop],[0,1],[t.topleft,1]]},G[38]=function(t){return[E(t),D(t)]},G[39]=function(t){return[[1,t.rightbottom],[1,0],[t.bottomright,0],[0,t.leftbottom],[0,t.lefttop],[t.topleft,1],[t.topright,1]]}},27082:(t,e,i)=>{"use strict";i(75917),i(29987),i(45046),i(93279),i(45228)},37654:(t,e,i)=>{"use strict";i(93279)},50802:(t,e,i)=>{"use strict";i(30669),i(29987)},82861:(t,e,i)=>{"use strict";i(96338),i(96558),i(93279)},91988:(t,e,i)=>{"use strict";i(50802),i(18743),i(29987),i(93279)},78640:(t,e,i)=>{"use strict";i(93279),i(45046),i(75448),i(29987),i(4945)},17788:(t,e,i)=>{"use strict";i(29987),i(45046),i(93279)},20790:(t,e,i)=>{"use strict";i(4945),i(75448),i(37028),i(1958),i(45046),i(29987),i(93279),i(4982)},75448:(t,e,i)=>{"use strict";i(93279),i(45046),i(29987)},18743:(t,e,i)=>{"use strict";i(67604),i(30669),i(96558),i(93279)},59895:(t,e,i)=>{"use strict";i(45046),i(93279),i(37028)},86069:(t,e,i)=>{"use strict";i(4945),i(47969),i(75917),i(51204),i(75448),i(78640),i(37028),i(45046),i(29987),i(93279)},6773:(t,e,i)=>{"use strict";i(75917),i(45046),i(93279)},33102:(t,e,i)=>{"use strict";i(93279),i(59004)},29987:(t,e,i)=>{"use strict";i.d(e,{Fh:()=>n,iw:()=>s,k7:()=>o});var r=i(93279);function n(t,e,i){if(null!==t)for(var r,o,s,a,l,c,u,h,p=0,d=0,f=t.type,m="FeatureCollection"===f,g="Feature"===f,_=m?t.features.length:1,y=0;y<_;y++){l=(h=!!(u=m?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var A=0;A<l;A++){var v=0,x=0;if(null!==(a=h?u.geometries[A]:u)){c=a.coordinates;var b=a.type;switch(p=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(c,d,y,v,x))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<c.length;r++){if(!1===e(c[r],d,y,v,x))return!1;d++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<c.length;r++){for(o=0;o<c[r].length-p;o++){if(!1===e(c[r][o],d,y,v,x))return!1;d++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(r=0;r<c.length;r++){for(x=0,o=0;o<c[r].length;o++){for(s=0;s<c[r][o].length-p;s++){if(!1===e(c[r][o][s],d,y,v,x))return!1;d++}x++}v++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===n(a.geometries[r],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(t,e,i,r){var o=i;return n(t,(function(t,r,n,s,a){o=0===r&&void 0===i?t:e(o,t,r,n,s,a)}),r),o}function s(t,e){!function(t,e){var i,r,n,o,s,a,l,c,u,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(i=0;i<m;i++){for(a=d?t.features[i].geometry:f?t.geometry:t,c=d?t.features[i].properties:f?t.properties:{},u=d?t.features[i].bbox:f?t.bbox:void 0,h=d?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=l?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],p,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,c,u,h))return!1;p++}}(t,(function(t,i,n,o,s){var a,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==e((0,r.N4)(t,n,{bbox:o,id:s}),i,0)&&void 0}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<t.coordinates.length;c++){var u={type:a,coordinates:t.coordinates[c]};if(!1===e((0,r.N4)(u,n),i,c))return!1}}))}},33922:(t,e,i)=>{"use strict";i(67604),i(96558),i(30669)},25590:(t,e,i)=>{"use strict";i(38220),i(29987)},37028:(t,e,i)=>{"use strict";i(67604),i(30669),i(96558),i(78640),i(29987),i(93279),i(45046)},2116:(t,e,i)=>{"use strict";i(45046),i(29987),i(17885),i(45228)},69399:(t,e,i)=>{"use strict";i(30669),i(29987)},18034:(t,e,i)=>{"use strict";i(45046)},83811:(t,e,i)=>{"use strict";i(64078),i(30669),i(93279)},89481:(t,e,i)=>{"use strict";i(29307),i(25903),i(69399),i(22608),i(93279)},17885:(t,e,i)=>{"use strict";i(30669),i(93279),i(45046),i(29987),i(78664)},50360:(t,e,i)=>{"use strict";i(22608),i(93279),i(29987)},19117:(t,e,i)=>{"use strict";i(29987),i(93279)},46977:(t,e,i)=>{"use strict";i(45046),i(93279),i(75917),i(29307),i(69399)},65875:(t,e,i)=>{"use strict";i(93279),i(45046)},83998:(t,e,i)=>{"use strict";i(93279),i(99146),i(16795)},42809:(t,e,i)=>{"use strict";i.d(e,{A:()=>o});var r=i(93279),n=i(51564);const o=function(){function t(t,e){this.from=t,this.to=e,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return t.prototype.getSymetric=function(){return this.symetric||(this.symetric=new t(this.to,this.from),this.symetric.symetric=this),this.symetric},t.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},t.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},t.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},t.prototype.toLineString=function(){return(0,r.wi)([this.from.coordinates,this.to.coordinates])},t.prototype.compareTo=function(t){return(0,n.BV)(t.from.coordinates,t.to.coordinates,this.to.coordinates)},t}()},16795:(t,e,i)=>{"use strict";i.d(e,{A:()=>a});var r=i(51564),n=i(93279),o=i(58658),s=i(22608);const a=function(){function t(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return t.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},t.prototype.get=function(t){return this.edges[t]},Object.defineProperty(t.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.edges.forEach(t)},t.prototype.map=function(t){return this.edges.map(t)},t.prototype.some=function(t){return this.edges.some(t)},t.prototype.isValid=function(){return!0},t.prototype.isHole=function(){var t=this,e=this.edges.reduce((function(e,i,r){return i.from.coordinates[1]>t.edges[e].from.coordinates[1]&&(e=r),e}),0),i=(0===e?this.length:e)-1,n=(e+1)%this.length,o=(0,r.BV)(this.edges[i].from.coordinates,this.edges[e].from.coordinates,this.edges[n].from.coordinates);return 0===o?this.edges[i].from.coordinates[0]>this.edges[n].from.coordinates[0]:o>0},t.prototype.toMultiPoint=function(){return(0,n.kB)(this.edges.map((function(t){return t.from.coordinates})))},t.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map((function(t){return t.from.coordinates}));return t.push(this.edges[0].from.coordinates),this.polygon=(0,n.n1)([t])},t.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=(0,o.A)(this.toPolygon())},t.findEdgeRingContaining=function(t,e){var i,o,s=t.getEnvelope();return e.forEach((function(e){var a=e.getEnvelope();if(o&&(i=o.getEnvelope()),!(0,r.Jp)(a,s)&&(0,r.sb)(a,s)){for(var l=t.map((function(t){return t.from.coordinates})),c=void 0,u=function(t){e.some((function(e){return(0,r.C_)(t,e.from.coordinates)}))||(c=t)},h=0,p=l;h<p.length;h++)u(p[h]);c&&e.inside((0,n.zx)(c))&&(o&&!(0,r.sb)(i,a)||(o=e))}})),o},t.prototype.inside=function(t){return(0,s.A)(t,this.toPolygon())},t}()},99146:(t,e,i)=>{"use strict";var r=i(42552),n=i(42809),o=i(16795),s=i(29987),a=i(45046);!function(){function t(){this.edges=[],this.nodes={}}t.fromGeoJson=function(e){!function(t){if(!t)throw new Error("No geojson passed");if("FeatureCollection"!==t.type&&"GeometryCollection"!==t.type&&"MultiLineString"!==t.type&&"LineString"!==t.type&&"Feature"!==t.type)throw new Error("Invalid input type '"+t.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(e);var i=new t;return(0,s.iw)(e,(function(t){(0,a.mo)(t,"LineString","Graph::fromGeoJson"),(0,s.k7)(t,(function(t,e){if(t){var r=i.getNode(t),n=i.getNode(e);i.addEdge(r,n)}return e}))})),i},t.prototype.getNode=function(t){var e=r.A.buildId(t),i=this.nodes[e];return i||(i=this.nodes[e]=new r.A(t)),i},t.prototype.addEdge=function(t,e){var i=new n.A(t,e),r=i.getSymetric();this.edges.push(i),this.edges.push(r)},t.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map((function(e){return t.nodes[e]})).forEach((function(e){return t._removeIfDangle(e)}))},t.prototype._removeIfDangle=function(t){var e=this;if(t.innerEdges.length<=1){var i=t.getOuterEdges().map((function(t){return t.to}));this.removeNode(t),i.forEach((function(t){return e._removeIfDangle(t)}))}},t.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach((function(e){e.label===e.symetric.label&&(t.removeEdge(e.symetric),t.removeEdge(e))}))},t.prototype._computeNextCWEdges=function(t){var e=this;void 0===t?Object.keys(this.nodes).forEach((function(t){return e._computeNextCWEdges(e.nodes[t])})):t.getOuterEdges().forEach((function(e,i){t.getOuterEdge((0===i?t.getOuterEdges().length:i)-1).symetric.next=e}))},t.prototype._computeNextCCWEdges=function(t,e){for(var i,r,n=t.getOuterEdges(),o=n.length-1;o>=0;--o){var s=n[o],a=s.symetric,l=void 0,c=void 0;s.label===e&&(l=s),a.label===e&&(c=a),l&&c&&(c&&(r=c),l&&(r&&(r.next=l,r=void 0),i||(i=l)))}r&&(r.next=i)},t.prototype._findLabeledEdgeRings=function(){var t=[],e=0;return this.edges.forEach((function(i){if(!(i.label>=0)){t.push(i);var r=i;do{r.label=e,r=r.next}while(!i.isEqual(r));e++}})),t},t.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach((function(t){t.label=void 0})),this._findLabeledEdgeRings().forEach((function(e){t._findIntersectionNodes(e).forEach((function(i){t._computeNextCCWEdges(i,e.label)}))}));var e=[];return this.edges.forEach((function(i){i.ring||e.push(t._findEdgeRing(i))})),e},t.prototype._findIntersectionNodes=function(t){var e=[],i=t,r=function(){var r=0;i.from.getOuterEdges().forEach((function(e){e.label===t.label&&++r})),r>1&&e.push(i.from),i=i.next};do{r()}while(!t.isEqual(i));return e},t.prototype._findEdgeRing=function(t){var e=t,i=new o.A;do{i.push(e),e.ring=i,e=e.next}while(!t.isEqual(e));return i},t.prototype.removeNode=function(t){var e=this;t.getOuterEdges().forEach((function(t){return e.removeEdge(t)})),t.innerEdges.forEach((function(t){return e.removeEdge(t)})),delete this.nodes[t.id]},t.prototype.removeEdge=function(t){this.edges=this.edges.filter((function(e){return!e.isEqual(t)})),t.deleteEdge()}}()},42552:(t,e,i)=>{"use strict";i.d(e,{A:()=>n});var r=i(51564);const n=function(){function t(e){this.id=t.buildId(e),this.coordinates=e,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return t.buildId=function(t){return t.join(",")},t.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter((function(e){return e.from.id!==t.from.id}))},t.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter((function(e){return e.to.id!==t.to.id}))},t.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},t.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort((function(e,i){var n=e.to,o=i.to;if(n.coordinates[0]-t.coordinates[0]>=0&&o.coordinates[0]-t.coordinates[0]<0)return 1;if(n.coordinates[0]-t.coordinates[0]<0&&o.coordinates[0]-t.coordinates[0]>=0)return-1;if(n.coordinates[0]-t.coordinates[0]==0&&o.coordinates[0]-t.coordinates[0]==0)return n.coordinates[1]-t.coordinates[1]>=0||o.coordinates[1]-t.coordinates[1]>=0?n.coordinates[1]-o.coordinates[1]:o.coordinates[1]-n.coordinates[1];var s=(0,r.BV)(t.coordinates,n.coordinates,o.coordinates);return s<0?1:s>0?-1:Math.pow(n.coordinates[0]-t.coordinates[0],2)+Math.pow(n.coordinates[1]-t.coordinates[1],2)-(Math.pow(o.coordinates[0]-t.coordinates[0],2)+Math.pow(o.coordinates[1]-t.coordinates[1],2))})),this.outerEdgesSorted=!0)},t.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},t.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},t.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},t}()},51564:(t,e,i)=>{"use strict";i.d(e,{BV:()=>o,C_:()=>l,Jp:()=>s,sb:()=>a});var r=i(22608),n=i(93279);function o(t,e,i){var r=e[0]-t[0],n=e[1]-t[1],o=i[0]-e[0];return function(t){return(t>0)-(t<0)||+t}(r*(i[1]-e[1])-o*n)}function s(t,e){var i=t.geometry.coordinates[0].map((function(t){return t[0]})),r=t.geometry.coordinates[0].map((function(t){return t[1]})),n=e.geometry.coordinates[0].map((function(t){return t[0]})),o=e.geometry.coordinates[0].map((function(t){return t[1]}));return Math.max.apply(null,i)===Math.max.apply(null,n)&&Math.max.apply(null,r)===Math.max.apply(null,o)&&Math.min.apply(null,i)===Math.min.apply(null,n)&&Math.min.apply(null,r)===Math.min.apply(null,o)}function a(t,e){return e.geometry.coordinates[0].every((function(e){return(0,r.A)((0,n.zx)(e),t)}))}function l(t,e){return t[0]===e[0]&&t[1]===e[1]}},2811:(t,e,i)=>{"use strict";i(29987),i(93279)},60073:(t,e,i)=>{"use strict";i(93279)},55934:(t,e,i)=>{"use strict";i(55263),i(30669),i(93279)},38197:(t,e,i)=>{"use strict";i(20145),i(29987),i(45046),i(93279)},7743:(t,e,i)=>{"use strict";i(93279),i(45046)},7861:(t,e,i)=>{"use strict";i(93279),i(45046)},78664:(t,e,i)=>{"use strict";i(93279),i(45046)},59788:(t,e,i)=>{"use strict";i(93279)},46156:(t,e,i)=>{"use strict";i(96338),i(82861),i(29987),i(93279),i(45046)},57784:(t,e,i)=>{"use strict";function r(t){for(var e=t,i=[];e.parent;)i.unshift(e),e=e.parent;return i}i(75917),i(22608),i(30669),i(91349),i(22900),i(31234),i(45046),i(93279);var n={search:function(t,e,i,o){t.cleanDirty();var s=(o=o||{}).heuristic||n.heuristics.manhattan,l=o.closest||!1,c=new a((function(t){return t.f})),u=e;for(e.h=s(e,i),c.push(e);c.size()>0;){var h=c.pop();if(h===i)return r(h);h.closed=!0;for(var p=t.neighbors(h),d=0,f=p.length;d<f;++d){var m=p[d];if(!m.closed&&!m.isWall()){var g=h.g+m.getCost(h),_=m.visited;(!_||g<m.g)&&(m.visited=!0,m.parent=h,m.h=m.h||s(m,i),m.g=g,m.f=m.g+m.h,t.markDirty(m),l&&(m.h<u.h||m.h===u.h&&m.g<u.g)&&(u=m),_?c.rescoreElement(m):c.push(m))}}}return l?r(u):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var i=Math.sqrt(2),r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return 1*(r+n)+(i-2)*Math.min(r,n)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};function o(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var i=0;i<t.length;i++){this.grid[i]=[];for(var r=0,n=t[i];r<n.length;r++){var o=new s(i,r,n[r]);this.grid[i][r]=o,this.nodes.push(o)}}this.init()}function s(t,e,i){this.x=t,this.y=e,this.weight=i}function a(t){this.content=[],this.scoreFunction=t}o.prototype.init=function(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)n.cleanNode(this.nodes[t])},o.prototype.cleanDirty=function(){for(var t=0;t<this.dirtyNodes.length;t++)n.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]},o.prototype.markDirty=function(t){this.dirtyNodes.push(t)},o.prototype.neighbors=function(t){var e=[],i=t.x,r=t.y,n=this.grid;return n[i-1]&&n[i-1][r]&&e.push(n[i-1][r]),n[i+1]&&n[i+1][r]&&e.push(n[i+1][r]),n[i]&&n[i][r-1]&&e.push(n[i][r-1]),n[i]&&n[i][r+1]&&e.push(n[i][r+1]),this.diagonal&&(n[i-1]&&n[i-1][r-1]&&e.push(n[i-1][r-1]),n[i+1]&&n[i+1][r-1]&&e.push(n[i+1][r-1]),n[i-1]&&n[i-1][r+1]&&e.push(n[i-1][r+1]),n[i+1]&&n[i+1][r+1]&&e.push(n[i+1][r+1])),e},o.prototype.toString=function(){for(var t,e,i,r,n=[],o=this.grid,s=0,a=o.length;s<a;s++){for(t=[],i=0,r=(e=o[s]).length;i<r;i++)t.push(e[i].weight);n.push(t.join(" "))}return n.join("\n")},s.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},s.prototype.getCost=function(t){return t&&t.x!==this.x&&t.y!==this.y?1.41421*this.weight:this.weight},s.prototype.isWall=function(){return 0===this.weight},a.prototype={push:function(t){this.content.push(t),this.sinkDown(this.content.length-1)},pop:function(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t},remove:function(t){var e=this.content.indexOf(t),i=this.content.pop();e!==this.content.length-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))},size:function(){return this.content.length},rescoreElement:function(t){this.sinkDown(this.content.indexOf(t))},sinkDown:function(t){for(var e=this.content[t];t>0;){var i=(t+1>>1)-1,r=this.content[i];if(!(this.scoreFunction(e)<this.scoreFunction(r)))break;this.content[i]=e,this.content[t]=r,t=i}},bubbleUp:function(t){for(var e=this.content.length,i=this.content[t],r=this.scoreFunction(i);;){var n,o=t+1<<1,s=o-1,a=null;if(s<e){var l=this.content[s];(n=this.scoreFunction(l))<r&&(a=s)}if(o<e){var c=this.content[o];this.scoreFunction(c)<(null===a?r:n)&&(a=o)}if(null===a)break;this.content[t]=this.content[a],this.content[a]=i,t=a}}}},47109:(t,e,i)=>{"use strict";i(22900),i(29987),i(93279)},1200:(t,e,i)=>{"use strict";i(55934)},47969:(t,e,i)=>{"use strict";i(30669)},29611:(t,e,i)=>{"use strict";i(29987),i(45046),i(93279),i(75843),i(50360),i(53416)},102:(t,e,i)=>{"use strict";i(22608),i(29987)},39654:(t,e,i)=>{"use strict";i(66570),i(93279)},96221:(t,e,i)=>{"use strict";i(93279)},5486:(t,e,i)=>{"use strict";i(17450),i(7743),i(78664),i(7861),i(29987),i(45046),i(93279)},91349:(t,e,i)=>{"use strict";i(25903),i(17450),i(75917),i(7743),i(78664),i(7861),i(29987),i(93279),i(45046)},11557:(t,e,i)=>{"use strict";i(29987),i(93279),i(45046),i(7861)},51465:(t,e,i)=>{"use strict";i(30669),i(95475),i(93279)},51204:(t,e,i)=>{"use strict";i(29987)},14945:(t,e,i)=>{"use strict";i.d(e,{Fh1:()=>r.Fh}),i(27082),i(57941),i(50360),i(43103),i(44660),i(90301),i(47109),i(92881),i(102),i(59788),i(58658),i(47969),i(96338),i(33922),i(25903),i(12102),i(17450),i(2343),i(30669),i(29307),i(75917),i(39654),i(31234),i(22608),i(69399),i(37028),i(2116),i(18034),i(96221),i(67604),i(96558),i(37654),i(89481),i(90999),i(20491),i(50802),i(59895),i(18743),i(83811),i(51204),i(40368),i(78640),i(91988),i(46021),i(52282),i(75448),i(86069),i(82861),i(65875),i(6773),i(7002),i(20790),i(46156),i(7743),i(78664),i(7861),i(46977),i(38197),i(74169),i(5486),i(91349),i(11557),i(17788),i(83998),i(28297),i(64284),i(50347),i(20145),i(27296),i(1958),i(3327),i(64078),i(55263),i(22900),i(40231),i(37601),i(17885),i(52170),i(57784),i(13012),i(53416),i(75843),i(87836),i(29611),i(66093),i(19117),i(25590),i(38220),i(2811),i(60073),i(67925),i(93279),i(45046);var r=i(29987);i(50365),i(57468),i(14657),i(95475),i(39721),i(68526),i(33102),i(1200),i(51465),i(83185)},14657:(t,e,i)=>{"use strict";i(59004),i(45046),i(93279)},46021:(t,e,i)=>{"use strict";i(29987),i(93279),i(72519),i(90999),i(22608)},13012:(t,e,i)=>{"use strict";i(93279),i(45046),i(79539)},13293:(t,e,i)=>{"use strict";i.d(e,{o4:()=>B});var r=i(50252).hp;const n="3.7.7",o=n,s="function"==typeof r,a="function"==typeof TextDecoder?new TextDecoder:void 0,l="function"==typeof TextEncoder?new TextEncoder:void 0,c=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),u=(t=>{let e={};return t.forEach(((t,i)=>e[t]=i)),e})(c),h=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,p=String.fromCharCode.bind(String),d="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),f=t=>t.replace(/=/g,"").replace(/[+\/]/g,(t=>"+"==t?"-":"_")),m=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),g=t=>{let e,i,r,n,o="";const s=t.length%3;for(let s=0;s<t.length;){if((i=t.charCodeAt(s++))>255||(r=t.charCodeAt(s++))>255||(n=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=i<<16|r<<8|n,o+=c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}return s?o.slice(0,s-3)+"===".substring(s):o},_="function"==typeof btoa?t=>btoa(t):s?t=>r.from(t,"binary").toString("base64"):g,y=s?t=>r.from(t).toString("base64"):t=>{let e=[];for(let i=0,r=t.length;i<r;i+=4096)e.push(p.apply(null,t.subarray(i,i+4096)));return _(e.join(""))},A=(t,e=!1)=>e?f(y(t)):y(t),v=t=>{if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?p(192|e>>>6)+p(128|63&e):p(224|e>>>12&15)+p(128|e>>>6&63)+p(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return p(240|e>>>18&7)+p(128|e>>>12&63)+p(128|e>>>6&63)+p(128|63&e)},x=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,b=t=>t.replace(x,v),w=s?t=>r.from(t,"utf8").toString("base64"):l?t=>y(l.encode(t)):t=>_(b(t)),S=(t,e=!1)=>e?f(w(t)):w(t),T=t=>S(t,!0),C=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,M=t=>{switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return p(55296+(e>>>10))+p(56320+(1023&e));case 3:return p((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return p((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},E=t=>t.replace(C,M),I=t=>{if(t=t.replace(/\s+/g,""),!h.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));let e,i,r,n="";for(let o=0;o<t.length;)e=u[t.charAt(o++)]<<18|u[t.charAt(o++)]<<12|(i=u[t.charAt(o++)])<<6|(r=u[t.charAt(o++)]),n+=64===i?p(e>>16&255):64===r?p(e>>16&255,e>>8&255):p(e>>16&255,e>>8&255,255&e);return n},L="function"==typeof atob?t=>atob(m(t)):s?t=>r.from(t,"base64").toString("binary"):I,P=s?t=>d(r.from(t,"base64")):t=>d(L(t).split("").map((t=>t.charCodeAt(0)))),k=t=>P(D(t)),N=s?t=>r.from(t,"base64").toString("utf8"):a?t=>a.decode(P(t)):t=>E(L(t)),D=t=>m(t.replace(/[-_]/g,(t=>"-"==t?"+":"/"))),O=t=>N(D(t)),R=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),F=function(){const t=(t,e)=>Object.defineProperty(String.prototype,t,R(e));t("fromBase64",(function(){return O(this)})),t("toBase64",(function(t){return S(this,t)})),t("toBase64URI",(function(){return S(this,!0)})),t("toBase64URL",(function(){return S(this,!0)})),t("toUint8Array",(function(){return k(this)}))},z=function(){const t=(t,e)=>Object.defineProperty(Uint8Array.prototype,t,R(e));t("toBase64",(function(t){return A(this,t)})),t("toBase64URI",(function(){return A(this,!0)})),t("toBase64URL",(function(){return A(this,!0)}))},B={version:n,VERSION:o,atob:L,atobPolyfill:I,btoa:_,btoaPolyfill:g,fromBase64:O,toBase64:S,encode:S,encodeURI:T,encodeURL:T,utob:b,btou:E,decode:O,isValid:t=>{if("string"!=typeof t)return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},fromUint8Array:A,toUint8Array:k,extendString:F,extendUint8Array:z,extendBuiltins:()=>{F(),z()}}},87375:()=>{"use strict";var t,e;t=void 0,e=function(t,e){var i=function(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}})),e.default=t,Object.freeze(e)}(e),r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},r(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var o=function(){return o=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},o.apply(this,arguments)};function s(t,e,i){if(i||2===arguments.length)for(var r,n=0,o=e.length;n<o;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var a=function(t){function e(e,r){var n=t.call(this)||this;return n.polyline=i.polyline(e,r),n.polygon=i.polygon(e,o(o({},r),{weight:0})),n}return n(e,t),e.prototype.onAdd=function(t){return this.polyline.addTo(t),this.polygon.addTo(t),this},e.prototype.onRemove=function(){return this.polyline.remove(),this.polygon.remove(),this},e.prototype.addLatLng=function(t){return this.polyline.addLatLng(t),this.polygon.addLatLng(t),this},e.prototype.getLatLngs=function(){return this.polygon.getLatLngs()[0]},e.prototype.toGeoJSON=function(){return this.polygon.toGeoJSON()},e}(i.Layer),l=function(t){for(var e=null,i=null,r=null,n=null,o=0;o<t.length;o++){var s=t[o],a=s[0],l=s[1];(null===e||a<e)&&(e=a),(null===i||a>i)&&(i=a),(null===r||l<r)&&(r=l),(null===n||l>n)&&(n=l)}return[e,r,i,n]},c=function t(e){if(e.type)switch(e.type){case"Point":return[e.coordinates[0],e.coordinates[1],e.coordinates[0],e.coordinates[1]];case"MultiPoint":case"LineString":return l(e.coordinates);case"MultiLineString":case"Polygon":return function(t){for(var e=null,i=null,r=null,n=null,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a],c=l[0],u=l[1];(null===e||c<e)&&(e=c),(null===i||c>i)&&(i=c),(null===r||u<r)&&(r=u),(null===n||u>n)&&(n=u)}return[e,r,i,n]}(e.coordinates);case"MultiPolygon":return function(t){for(var e=null,i=null,r=null,n=null,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++)for(var l=s[a],c=0;c<l.length;c++){var u=l[c],h=u[0],p=u[1];(null===e||h<e)&&(e=h),(null===i||h>i)&&(i=h),(null===r||p<r)&&(r=p),(null===n||p>n)&&(n=p)}return[e,r,i,n]}(e.coordinates);case"Feature":return e.geometry?t(e.geometry):null;case"FeatureCollection":return function(t){for(var e=[],i=t.features.length-1;i>=0;i--){var r=c(t.features[i].geometry);e.push([r[0],r[1]]),e.push([r[2],r[3]])}return l(e)}(e);case"GeometryCollection":return function(t){for(var e=[],i=t.geometries.length-1;i>=0;i--){var r=c(t.geometries[i]);e.push([r[0],r[1]]),e.push([r[2],r[3]])}return l(e)}(e);default:throw new Error("Unknown type: "+e.type)}return null},u=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},h=function(t,e,i,r){var n=(r[0]-i[0])*(t[1]-i[1])-(r[1]-i[1])*(t[0]-i[0]),o=(e[0]-t[0])*(t[1]-i[1])-(e[1]-t[1])*(t[0]-i[0]),s=(r[1]-i[1])*(e[0]-t[0])-(r[0]-i[0])*(e[1]-t[1]);if(0!==s){var a=n/s,l=o/s;if(a>=0&&a<=1&&l>=0&&l<=1)return!0}return!1},p=function t(e,i){if(u(e[0][0])){if(u(i[0][0])){for(var r=0;r<e.length-1;r++)for(var n=0;n<i.length-1;n++)if(h(e[r],e[r+1],i[n],i[n+1]))return!0}else for(var o=0;o<i.length;o++)if(t(e,i[o]))return!0}else for(var s=0;s<e.length;s++)if(t(e[s],i))return!0;return!1},d=function(t,e){for(var i=!1,r=-1,n=t.length,o=n-1;++r<n;o=r)(t[r][1]<=e[1]&&e[1]<t[o][1]||t[o][1]<=e[1]&&e[1]<t[r][1])&&e[0]<(t[o][0]-t[r][0])*(e[1]-t[r][1])/(t[o][1]-t[r][1])+t[r][0]&&(i=!i);return i},f=function(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},m=function(t,e){return t[0]>e[0]?-1:t[0]<e[0]?1:t[1]>e[1]?-1:t[1]<e[1]?1:0},g=function(t){for(var e=[],i=0;i<t.length;i++){var r=t[i].slice();!1===f(r[0],r[r.length-1])&&r.push(r[0]),e.push(r)}return e},_=function(t,e){if(t.length!==e.length)return!1;for(var i=t.slice().sort(m),r=e.slice().sort(m),n=0;n<i.length;n++){if(i[n].length!==r[n].length)return!1;for(var o=0;o<i.length;o++)if(i[n][o]!==r[n][o])return!1}return!0},y=function(t,e){if(t&&t.length){if(1===t.length)return d(t[0],e);if(d(t[0],e)){for(var i=1;i<t.length;i++)if(d(t[i],e))return!1;return!0}return!1}return!1},A=function t(e,i){var r,n,o;if("Feature"===i.type&&(i=i.geometry),"Point"===i.type&&"Point"===e.type)return f(e.coordinates,i.coordinates);if("MultiLineString"===i.type&&"Point"===e.type)for(n=0;n<e.coordinates.length;n++)if(t(e,{type:"LineString",coordinates:i.coordinates[n]}))return!0;if(("LineString"===i.type||"MultiPoint"===i.type)&&"Point"===e.type)for(n=0;n<i.coordinates.length;n++){if(e.coordinates.length!==i.coordinates[n].length)return!1;if(f(e.coordinates,i.coordinates[n]))return!0}if("Polygon"===i.type){if("Polygon"===e.type){if(i.coordinates.length===e.coordinates.length)for(n=0;n<e.coordinates.length;n++)if(_(e.coordinates[n],i.coordinates[n]))return!0;return!(!e.coordinates.length||!y(i.coordinates,e.coordinates[0][0])||p(g(e.coordinates),g(i.coordinates)))}if("Point"===e.type)return y(i.coordinates,e.coordinates);if("LineString"===e.type||"MultiPoint"===e.type){if(!e.coordinates||0===e.coordinates.length)return!1;for(n=0;n<e.coordinates.length;n++)if(!1===y(i.coordinates,e.coordinates[n]))return!1;return!0}if("MultiLineString"===e.type){for(n=0;n<e.coordinates.length;n++)if(!1===t({type:"LineString",coordinates:e.coordinates[n]},i))return o++,!1;return!0}if("MultiPolygon"===e.type){for(n=0;n<e.coordinates.length;n++)if(!1===t({type:"Polygon",coordinates:e.coordinates[n]},i))return!1;return!0}}if("MultiPolygon"===i.type){if("Point"===e.type){if(i.coordinates.length)for(n=0;n<i.coordinates.length;n++)if(r=i.coordinates[n],y(r,e.coordinates)&&!1===p([e.coordinates],i.coordinates))return!0;return!1}if("Polygon"===e.type){for(n=0;n<e.coordinates.length;n++)if(i.coordinates[n].length===e.coordinates.length)for(var s=0;s<e.coordinates.length;s++)if(_(e.coordinates[s],i.coordinates[n][s]))return!0;if(!1===p(e.coordinates,i.coordinates)&&i.coordinates.length){for(n=0;n<i.coordinates.length;n++)r=i.coordinates[n],o=!1!==y(r,e.coordinates[0][0]);return o}}else if("LineString"===e.type||"MultiPoint"===e.type)for(n=0;n<i.coordinates.length;n++)return!!t(e,{type:"Polygon",coordinates:i.coordinates[n]});else{if("MultiLineString"===e.type){for(n=0;n<e.coordinates.length;n++)if(!1===t({type:"LineString",coordinates:e.coordinates[n]},i))return!1;return!0}if("MultiPolygon"===e.type){for(n=0;n<i.coordinates.length;n++)if(!1===t(e,{type:"Polygon",coordinates:i.coordinates[n]}))return!1;return!0}}}return!1},v=function(t,e){return A(e,t)},x=function t(e,i){return"Feature"===i.type&&(i=i.geometry),!(!A(e,i)&&!A(i,e))||!("MultiPolygon"!==e.type||!function(t,e){return t.coordinates.some((function(t){var i={type:"Polygon",coordinates:t};return A(i,e)||A(e,i)}))}(e,i))||("Point"!==e.type&&"MultiPoint"!==e.type&&"Point"!==i.type&&"MultiPoint"!==i.type?p(e.coordinates,i.coordinates):"Feature"===e.type?t(e.geometry,i):(function(){var t=Array.prototype.slice.apply(arguments);"undefined"!=typeof console&&console.warn&&console.warn.apply(console,t)}("Type "+e.type+" to "+i.type+" intersection is not supported by intersects"),!1))},b=1/298.257223563,w=function(t,e,i){var r=i||64,n=e||250;if(!t||t.length<2||!n||!r)throw new Error("Terraformer: missing parameter for Terraformer.Circle");return{type:"Feature",geometry:S(t,n,r),properties:{radius:n,center:t,steps:r}}},S=function(t,e,i){for(var r,n=i||64,o={type:"Polygon",coordinates:[[]]},s=0;s<n;s++)r=360*s/n,o.coordinates[0].push(T(t,r,e));return o.coordinates=g(o.coordinates),o},T=function(t,e,i){for(var r,n,o,s=6378137,a=6356752.3142,l=b,c=t[0],u=t[1],h=i,p=Math.PI,d=e*p/180,f=Math.sin(d),m=Math.cos(d),g=(1-l)*Math.tan(u*p/180),_=1/Math.sqrt(1+g*g),y=g*_,A=Math.atan2(g,m),v=_*f,x=1-v*v,w=x*(s*s-a*a)/(a*a),S=1+w/16384*(4096+w*(w*(320-175*w)-768)),T=w/1024*(256+w*(w*(74-47*w)-128)),C=h/(a*S),M=2*Math.PI;Math.abs(C-M)>1e-12;)r=Math.cos(2*A+C),M=C,C=h/(a*S)+T*(n=Math.sin(C))*(r+T/4*((o=Math.cos(C))*(2*r*r-1)-T/6*r*(4*n*n-3)*(4*r*r-3)));var E=y*n-_*o*m,I=Math.atan2(y*o+_*n*m,(1-l)*Math.sqrt(v*v+E*E)),L=l/16*x*(4+l*(4-3*x));return[c+180*(Math.atan2(n*f,_*o-y*n*m)-(1-L)*l*v*(C+L*n*(r+L*o*(2*r*r-1))))/p,180*I/p]};function C(t,e){return w(i.GeoJSON.latLngToCoords(t),e).geometry}function M(t,e){if(void 0===e&&(e={}),t instanceof i.Circle)return C(r=t.getLatLng(),n=t.getRadius());if(t instanceof i.CircleMarker){if(null!=e.zoom&&null!=e.crs){var r=t.getLatLng(),n=function(t,e,r){var n=t.getLatLng(),o=e.latLngToPoint(n,r),s=t.getRadius()/Math.SQRT2,a=i.point([o.x-s,o.y-s]),l=e.pointToLatLng(a,r);return e.distance(n,l)}(t,e.crs,e.zoom);return C(r,n)}return console.warn("Zoom and CRS is required for calculating CircleMarker polygon, falling back to center point only"),t.toGeoJSON().geometry}return t instanceof i.Marker||t instanceof i.Polyline?t.toGeoJSON().geometry:void console.warn("Layer GeoJSON geometry is not available",t)}function E(t,e,r){void 0===r&&(r={});var n=t.toGeoJSON().geometry,o=t.getBounds(),s=e.filter((function(t){var e,s,a;if(t instanceof i.Polyline?s=t.getBounds():(e=M(t,r))&&(a=c(e),s=i.latLngBounds([a[1],a[0]],[a[3],a[2]])),!s||!s.isValid())return!1;if(!(r.intersect?o.intersects(s):o.contains(s)))return!1;if(e||(e=M(t,r)),!e)return!1;var l=r.intersect?function(t,e){return"Point"===e.type?v(t,e):x(t,e)}(n,e):function(t,e){return v(t,e)}(n,e);return l}));return s}function I(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}I(".leaflet-lasso-active {\n    cursor: crosshair;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n            user-select: none;\n}\n\n.leaflet-lasso-active .leaflet-interactive {\n    cursor: crosshair;\n    pointer-events: none;\n}");var L="lasso.enabled",P="lasso.disabled",k="lasso.finished",N="leaflet-lasso-active",D=function(t){function e(e,r){void 0===r&&(r={});var n=t.call(this,e)||this;return n.options={polygon:{color:"#00C3FF",weight:2},intersect:!1},n.onMapMouseDownBound=n.onMapMouseDown.bind(n),n.onDocumentMouseMoveBound=n.onDocumentMouseMove.bind(n),n.onDocumentMouseUpBound=n.onDocumentMouseUp.bind(n),n.map=e,i.Util.setOptions(n,r),n}return n(e,t),e.prototype.setOptions=function(t){this.options=o(o({},this.options),t)},e.prototype.toggle=function(){this.enabled()?this.disable():this.enable()},e.prototype.addHooks=function(){this.map.getPane("mapPane"),this.map.getContainer().addEventListener("mousedown",this.onMapMouseDownBound),this.map.getContainer().addEventListener("touchstart",this.onMapMouseDownBound),this.map.getContainer().classList.add(N),this.map.dragging.disable(),this.map.fire(L)},e.prototype.removeHooks=function(){this.polygon&&(this.map.removeLayer(this.polygon),this.polygon=void 0),this.map.getContainer().removeEventListener("mousedown",this.onMapMouseDownBound),this.map.getContainer().removeEventListener("touchstart",this.onMapMouseDownBound),document.removeEventListener("mousemove",this.onDocumentMouseMoveBound),document.removeEventListener("touchmove",this.onDocumentMouseMoveBound),document.removeEventListener("mouseup",this.onDocumentMouseUpBound),document.removeEventListener("touchend",this.onDocumentMouseUpBound),this.map.getContainer().classList.remove(N),document.body.classList.remove(N),this.map.dragging.enable(),this.map.fire(P)},e.prototype.onMapMouseDown=function(t){t.stopPropagation();var e=this.eventToMouseEvent("down",t);if(e)if(t instanceof MouseEvent&&!t._simulated&&1!==t.buttons)this.disable();else if(!t.target.closest(".leaflet-control-container")){var i=this.map.mouseEventToLatLng(e);this.polygon=new a([i],this.options.polygon).addTo(this.map),document.body.classList.add(N),document.addEventListener("mousemove",this.onDocumentMouseMoveBound),document.addEventListener("touchmove",this.onDocumentMouseMoveBound),document.addEventListener("mouseup",this.onDocumentMouseUpBound),document.addEventListener("touchend",this.onDocumentMouseUpBound),t.preventDefault()}},e.prototype.onDocumentMouseMove=function(t){t.stopPropagation();var e=this.eventToMouseEvent("move",t);if(e&&this.polygon)if(t instanceof MouseEvent&&!t._simulated&&1!==t.buttons)this.finish(t);else{var i=this.map.mouseEventToLatLng(e);this.polygon.addLatLng(i),t.preventDefault()}},e.prototype.onDocumentMouseUp=function(t){this.finish(t),t.stopPropagation(),t.preventDefault()},e.prototype.eventToMouseEvent=function(t,e){return e instanceof MouseEvent?e:e instanceof TouchEvent&&1===e.touches.length?new MouseEvent(t,{screenX:e.touches[0].screenX,screenY:e.touches[0].screenY,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY,buttons:1}):void 0},e.prototype.finish=function(t){var e=this;if(this.polygon){var r=[];this.map.eachLayer((function(t){t!==e.polygon&&t!==e.polygon.polyline&&t!==e.polygon.polygon&&(i.MarkerCluster&&t instanceof i.MarkerCluster?r.push.apply(r,t.getAllChildMarkers()):(t instanceof i.Marker||t instanceof i.Path)&&r.push(t))}));var n=E(this.polygon.polygon,r,{zoom:this.map.getZoom(),crs:this.map.options.crs,intersect:this.options.intersect});this.map.fire(k,{originalEvent:t,latLngs:this.polygon.getLatLngs(),layers:n}),this.disable()}},e}(i.Handler);I(".leaflet-control-lasso {\n    background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAD6UlEQVR4nO1b7XHbMAwFfP0fdYKqE8QbRJ0gGUEjaAR3A4/gbuBOUHWCKhs4E1SegD06jzmYpWhJpiRKNu58Tix+AA8gCQIQK6Xolml109LfAbgDcAfg5gH4NPQEzJwSkf4kRLR2NKmJqNLfSqlqaH7+4y/0McjML0SUQdinHkO8ApCSiPZKqToogxYFAQBC50T03NDkN74raFzSGtahreSLo+9PALG7mlEXaQD6fMD0BgIp8TkQ0ZaINChpl7ExZoZxK2vcGr8nfXl2ztm5g1twI/Q6KHPvVlFg/DMgJgEAWpWCay3lIYX2zJ1bQFQhAO+i9b2l8VEEd/BSWEooBgUAm5REPvg67AGCrZDdIABgQ6qF1oOu8QBAbK4FwTd4bq23SbXeks/OIPg0f7V5TQRCpz3BNdhamH30wgu+CwFC66VqD5IIByRas/eAYDbGqi8AW+FszEp4ocC6y1KQneW6z+YmvJDDLIVDVwBKdNzPVXghi/FbLjprp4AIM2fi6loMcusal8zN8eXirOp885jNrn/BAlKxnL17GWPj+As8viqlDguwAG3V+hR7JKJvSqmyqd1KmMnrUoQHGaEzX6OVaLAfg6sRyUSeUt+UKxGobDSTmZKR5yIAj/h79IhsDPSRFxg6+ho9AAukpI1IgydGxiY4dSRON+/SXgwAyE1sHbkF79JmeEuaPs91H4DWf+Ffk1nSgDwQ0RH5iUbZqgXcAI0MG/FbKn7f+i5DZo14PabISR/lb0qpjWETXq252LmSsidaCYfh8s0pbnKZuFHuEzNvmNl5MiR9YmmRLYHaxb8VJ3SG+UzD3ZyvwyI/UEPozMoZFE2xTjOADId1yuhGBMLO0raSUSE74HsGgDoPiZULsIISPkFqtUlEuOx0YsiHadeIakTC57bGPW0zAVRiP+yVXJhY+M6JHLFcCtfDvUAoahCseoXW0Wz0Oy1310O5WUQLgmX2ZddEzkffhoc2CJMUQ3h4kzt+v7S4ke/CRKWYaBtBYURmF2tcMda7bC0absWEk5TG4ISyS3Suury1BqAB+XIMIDCv7eAEsUTvHtDQoak8bhPSexSlcXadYBlqHu8p0BMIZRVIti9QeD/Hc/S1hVawgKDuufQDriqVZeYcAjeVyL4BGBc1lcaSKY8dolaYmTXgf0ykKFStcCIKpM33Q8vuR1EcXeEuMkhoDnyWCKB81wGUQV+aEhFaJ/mSlgPwYvyHZ8QN9SlS38RbY3hnYQ/NHyH8KVq0+DdGdCgMS+sRe1ImX8xYvAUw8wGb7Q9c88/2l1sAIEPBlPM0ur85GgEPk9IdgAh4mJTuAETAw3RERP8Ab2Uzgrad13wAAAAASUVORK5CYII=');\n    background-size: 22px;\n}");var O=function(t){function e(e){void 0===e&&(e={});var r=t.call(this)||this;return r.options={position:"topright",title:"Toggle Lasso"},i.Util.setOptions(r,e),r}return n(e,t),e.prototype.setOptions=function(t){this.options=o(o({},this.options),t),this.lasso&&this.lasso.setOptions(this.options)},e.prototype.onAdd=function(t){this.lasso=new D(t,this.options);var e=i.DomUtil.create("div","leaflet-bar leaflet-control"),r=i.DomUtil.create("a","leaflet-control-lasso",e);return r.href="javascript:void(0)",r.title=this.options.title,r.setAttribute("role","button"),r.setAttribute("aria-label",r.title),i.DomEvent.addListener(r,"click",this.toggle,this),i.DomEvent.disableClickPropagation(r),e},e.prototype.enabled=function(){return!!this.lasso&&this.lasso.enabled()},e.prototype.enable=function(){this.lasso&&this.lasso.enable()},e.prototype.disable=function(){this.lasso&&this.lasso.disable()},e.prototype.toggle=function(){this.lasso&&this.lasso.toggle()},e}(i.Control);void 0!==window.L&&(window.L.Lasso=D,window.L.lasso=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(D.bind.apply(D,s([void 0],t,!1)))},window.L.Control.Lasso=O,window.L.control.lasso=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(O.bind.apply(O,s([void 0],t,!1)))}),t.ACTIVE_CLASS=N,t.DISABLED_EVENT=P,t.ENABLED_EVENT=L,t.FINISHED_EVENT=k,t.LassoControl=O,t.LassoHandler=D},"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LeafletLasso={},t.L)},77135:(t,e,i)=>{"use strict";i.d(e,{Ay:()=>J});var r=i(53481),n=Object.freeze((function(t,e){const i={},n=e.getTileSize(),o=r.SVG.create("svg"),s=r.SVG.create("g"),a=[];function l(i,r,n){const o=e.getFeatureStyle(i,r,t.z);if(!o)return;const l=e.featureToLayer(i,r,n,o);s.appendChild(l.graphics),a.push(l),e.addFeatureLayer(l)}return o.setAttribute("viewBox",`0 0 ${n.x} ${n.y}`),o.appendChild(s),i.addVectorTile=function(r){return e.getOrderedLayers(Object.keys(r.layers),t.z).forEach((function(t){if(!r.layers[t])return;const e=r.layers[t],i=n.divideBy(e.extent);let o=0;for(;o!==e.length;)l(e.feature(o),t,i),o+=1})),i},i.global=e=>t.scaleBy(n).add(e),i.eachFeatureLayer=t=>a.forEach(((...e)=>t(...e,i))),i.domElement=()=>o,i.coords=()=>t,i}));function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var s=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=e*this.x-i*this.y,n=i*this.x+e*this.y;return this.x=r,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),n=e.x+i*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var l=s,c=u;function u(t,e,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=n,t.readFields(h,this,e)}function h(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function p(t){for(var e,i,r=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],r+=((i=t[s]).x-e.x)*(e.y+i.y);return r}u.types=["Unknown","Point","LineString","Polygon"],u.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,n=0,o=0,s=0,a=[];t.pos<i;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)o+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&a.push(e),e=[]),e.push(new l(o,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&a.push(e),a},u.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},u.prototype.toGeoJSON=function(t,e,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=u.types[this.type];function h(t){for(var e=0;e<t.length;e++){var i=t[e],r=180-360*(i.y+a)/o;t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(r=0;r<l.length;r++)d[r]=l[r][0];h(l=d);break;case 2:for(r=0;r<l.length;r++)h(l[r]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,n=[],o=0;o<e;o++){var s=p(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[t[o]]):i.push(t[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)h(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var d=c,f=m;function m(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(g,this,e),this.length=this._features.length}function g(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(i))}m.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new d(this._pbf,e,this.extent,this._keys,this._values)};var _=f;function y(t,e,i){if(3===t){var r=new _(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var A=function(t,e){this.layers=t.readFields(y,{},e)},v=c;function x(t,e,i,n){const o=new r.Layer(n);return o.feature=t,o.layerName=e,o.properties=t.properties,o.addTo=function(t){o._map=t,o.addInteractiveTarget(o.graphics)},o.removeFrom=function(){o.removeInteractiveTarget(o.graphics),delete o._map},o.scalePoint=function(t){return(0,r.point)(t).scaleBy(i)},o.bbox=function(){const[e,i,n,s]=t.bbox();return(0,r.bounds)(o.scalePoint([e,i]),o.scalePoint([n,s]))},o.applyOptions=function(t){t.className&&r.DomUtil.addClass(o.graphics,t.className),o.setStyle({})},o}function b(t,e){e.interactive?(t.setAttribute("pointer-events","auto"),r.DomUtil.addClass(t,"leaflet-interactive")):(r.DomUtil.removeClass(t,"leaflet-interactive"),t.removeAttribute("pointer-events")),e.hidden?t.setAttribute("visibility","hidden"):t.removeAttribute("visibility")}function w(t,e){return e.stroke?(t.setAttribute("stroke",e.color),t.setAttribute("stroke-opacity",e.opacity),t.setAttribute("stroke-width",e.weight),t.setAttribute("stroke-linecap",e.lineCap),t.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?t.setAttribute("stroke-dasharray",e.dashArray):t.removeAttribute("stroke-dasharray"),e.dashOffset?t.setAttribute("stroke-dashoffset",e.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),e.fill?(t.setAttribute("fill",e.fillColor||e.color),t.setAttribute("fill-opacity",e.fillOpacity),t.setAttribute("fill-rule",e.fillRule||"evenodd")):t.setAttribute("fill","none"),t}var S=C,T={read:function(t,e,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=c}return(d?-1:1)*s*Math.pow(2,o-r)},write:function(t,e,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,n),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;t[i+d]=255&a,d+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m}};function C(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}C.Varint=0,C.Fixed64=1,C.Bytes=2,C.Fixed32=5;var M=4294967296,E=1/M,I="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function L(t){return t.type===C.Bytes?t.readVarint()+t.pos:t.pos+1}function P(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function k(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=t;n--)i.buf[n+r]=i.buf[n]}function N(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function D(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function O(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function R(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function F(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function z(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function B(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function U(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function V(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function j(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function G(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Z(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}C.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,t(n,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=j(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Z(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=j(this.buf,this.pos)+j(this.buf,this.pos+4)*M;return this.pos+=8,t},readSFixed64:function(){var t=j(this.buf,this.pos)+Z(this.buf,this.pos+4)*M;return this.pos+=8,t},readFloat:function(){var t=T.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=T.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(t,e,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return P(t,r,e);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return P(t,r,e);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return P(t,r,e);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return P(t,r,e);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return P(t,r,e);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return P(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&I?function(t,e,i){return I.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var r="",n=e;n<i;){var o,s,a,l=t[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==C.Bytes)return t.push(this.readVarint(e));var i=L(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==C.Bytes)return t.push(this.readSVarint());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==C.Bytes)return t.push(this.readBoolean());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==C.Bytes)return t.push(this.readFloat());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==C.Bytes)return t.push(this.readDouble());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==C.Bytes)return t.push(this.readFixed32());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==C.Bytes)return t.push(this.readSFixed32());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==C.Bytes)return t.push(this.readFixed64());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==C.Bytes)return t.push(this.readSFixed64());var e=L(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===C.Varint)for(;this.buf[this.pos++]>127;);else if(e===C.Bytes)this.pos=this.readVarint()+this.pos;else if(e===C.Fixed32)this.pos+=4;else{if(e!==C.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),G(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),G(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),G(this.buf,-1&t,this.pos),G(this.buf,Math.floor(t*E),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),G(this.buf,-1&t,this.pos),G(this.buf,Math.floor(t*E),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,r;if(t>=0?(i=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos]=127&t}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):n=r;continue}if(r<56320){t[i++]=239,t[i++]=191,t[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(t[i++]=239,t[i++]=191,t[i++]=189,n=null);r<128?t[i++]=r:(r<2048?t[i++]=r>>6|192:(r<65536?t[i++]=r>>12|224:(t[i++]=r>>18|240,t[i++]=r>>12&63|128),t[i++]=r>>6&63|128),t[i++]=63&r|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&k(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),T.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),T.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&k(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,C.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,N,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,D,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,F,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,O,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,R,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,z,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,B,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,U,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,V,e)},writeBytesField:function(t,e){this.writeTag(t,C.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,C.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,C.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,C.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,C.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,C.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,C.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,C.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,C.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,C.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var q=o(S);function W(t){return`${t.x}|${t.y}|${t.z}`}const H={featureToLayer:function(t,e,i,n){switch(v.types[t.type]){case"Point":return n.icon?function(t,e,i,n){const o=x(t,e,i,n);o.setStyle=function(t){t=(0,r.extend)({},n,t),b(o.graphics,t),function(t,e){e.icon&&(t.setAttribute("width",e.icon.options.iconSize[0]),t.setAttribute("height",e.icon.options.iconSize[1]),t.setAttribute("href",e.icon.options.iconUrl))}(o.graphics,t)},o.graphics=r.SVG.create("image");const s=o.scalePoint(t.loadGeometry()[0][0]),a=n.icon.options.iconAnchor||[0,0];return o.graphics.setAttribute("x",s.x-a[0]),o.graphics.setAttribute("y",s.y-a[1]),o.applyOptions(n),o}(t,e,i,n):function(t,e,i,n){const o=x(t,e,i,n=(0,r.extend)({},r.CircleMarker.prototype.options,n)),s=o.scalePoint(t.loadGeometry()[0][0]);return o.graphics=r.SVG.create("circle"),o.graphics.setAttribute("cx",s.x),o.graphics.setAttribute("cy",s.y),o.setStyle=function(t){t=(0,r.extend)({},n,t),b(o.graphics,t),w(o.graphics,t),o.graphics.setAttribute("r",t.radius)},o.applyOptions(n),o}(t,e,i,n);case"Polygon":case"LineString":return function(t,e,i,n){const o=v.types[t.type],s=x(t,e,i,n=(0,r.extend)({},"Polygon"===o?r.Polygon.prototype.options:r.Path.prototype.options,n)),a=t.loadGeometry();return s.graphics=r.SVG.create("path"),s.graphics.setAttribute("d",r.SVG.pointsToPath(a.map((t=>t.map(s.scalePoint))),"Polygon"===o)),s.setStyle=function(t){t=(0,r.extend)({},n,t),b(s.graphics,t),w(s.graphics,t)},s.applyOptions(n),s}(t,e,i,n);default:throw new Error("Unknown feature type")}},filter:void 0,layerOrder:void 0,layers:void 0,minZoom:0,maxZoom:18,maxDetailZoom:void 0,minDetailZoom:void 0,subdomains:"abc",zoomOffset:0,zoomReverse:!1};var J=Object.freeze((function(t,e){const i=new r.GridLayer(e),o=Object.getPrototypeOf(i),s={};"string"==typeof(e=r.Util.extend({},H,e)).subdomains&&(e.subdomains=e.subdomains.split("")),e.vectorTileLayerStyles&&!e.style&&(e.style=function(t,i,r){const{getFeatureId:n,vectorTileLayerStyles:o}=e;let a=o[i];if(n){const e=n(t);s[e]&&(a=s[e])}if("function"==typeof a&&(a=a(t.properties,r,t.type)),Array.isArray(a)){if(!a.length)return;a=a[0]}return a});const a={};let l;function c(t){const i=Math.abs(t.x+t.y)%e.subdomains.length;return e.subdomains[i]}function u(t){const{minDetailZoom:i,maxDetailZoom:r}=e;return void 0!==i&&t<i?i:void 0!==r&&r<t?r:t}function h(t){const{maxZoom:i,zoomReverse:r,zoomOffset:n}=e;return r&&(t=i-t),u(t+n)}function p(t){Object.keys(a).forEach((e=>a[e].eachFeatureLayer(t)))}return i.on("tileunload",(function(t){const e=W(t.coords),r=a[e];r&&(r.eachFeatureLayer(i.removeFeatureLayer),delete a[e])})),i.onAdd=function(t,...e){return l=t,o.onAdd.call(i,t,...e)},i.onRemove=function(...t){return l=void 0,o.onRemove.call(i,...t)},i.createTile=function(t,r){const o=W(t),s=n(t,i);return a[o]=s,function(t,e){return fetch(t,e).then((function(e){if(e.ok)return e.arrayBuffer();if(404!==e.status)throw function(...t){return new Error(t.join(": "))}(t,e.status,e.statusText)}))}(i.getTileUrl(t),e.fetchOptions).then((function(t){s.addVectorTile(new A(new q(t))),r(null,s)}),(function(t){r(t,s)})),s.domElement()},i.getTileUrl=function(n){const o={s:c(n),x:n.x,y:n.y,z:h(n.z)};return l.options.crs.infinite||(o["-y"]=i._globalTileRange.max.y-n.y),r.Util.template(t,r.Util.extend(o,e))},i.setStyle=function(t){return e.style=t,p((function(t,e,r,n){const{feature:o,layerName:s}=t,a=i.getFeatureStyle(o,s,n.coords().z);t.setStyle(a)})),i},i.setFeatureStyle=function(t,r){return s[t]=r,i.setStyle(e.style),i},i.resetFeatureStyle=function(t){return delete s[t],i.setStyle(e.style),i},i.getTileSize=function(){const t=o.getTileSize.call(i),e=i._tileZoom;return void 0===e?t:t.divideBy(l.getZoomScale(u(e),e)).round()},i.getFeatureStyle=function(t,i,r){if(e.filter&&!e.filter(t,i,r))return;const n=e.style;return"function"==typeof n?n(t,i,r):n},i.getOrderedLayers=function(t,i){t=e.layers||t;const r=e.layerOrder;return void 0!==r?r(t,i):t},i.featureToLayer=e.featureToLayer,i.addFeatureLayer=function(t){return t.addTo(l),t.addEventParent(i),i},i.removeFeatureLayer=function(t){return t.removeEventParent(i),t.removeFrom(l),i},i.getBounds=function(){let t;return p((function(e,i,n,o){const s=t=>l.unproject(o.global(t),o.coords().z),a=e.bbox(),c=(0,r.latLngBounds)(s(a.min),s(a.max));t?t.extend(c):t=c})),t},i}))},3075:(t,e,i)=>{"use strict";function r(t){let e=t.length;for(;--e>=0;)t[e]=0}i.d(e,{Kc:()=>ui,UD:()=>hi});const n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),s=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=new Array(576);r(l);const c=new Array(60);r(c);const u=new Array(512);r(u);const h=new Array(256);r(h);const p=new Array(29);r(p);const d=new Array(30);function f(t,e,i,r,n){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=t&&t.length}let m,g,_;function y(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}r(d);const A=t=>t<256?u[t]:u[256+(t>>>7)],v=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},x=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,v(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},b=(t,e,i)=>{x(t,i[2*e],i[2*e+1])},w=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},S=(t,e,i)=>{const r=new Array(16);let n,o,s=0;for(n=1;n<=15;n++)s=s+i[n-1]<<1,r[n]=s;for(o=0;o<=e;o++){let e=t[2*o+1];0!==e&&(t[2*o]=w(r[e]++,e))}},T=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},C=t=>{t.bi_valid>8?v(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},M=(t,e,i,r)=>{const n=2*e,o=2*i;return t[n]<t[o]||t[n]===t[o]&&r[e]<=r[i]},E=(t,e,i)=>{const r=t.heap[i];let n=i<<1;for(;n<=t.heap_len&&(n<t.heap_len&&M(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!M(e,r,t.heap[n],t.depth));)t.heap[i]=t.heap[n],i=n,n<<=1;t.heap[i]=r},I=(t,e,i)=>{let r,s,a,l,c=0;if(0!==t.sym_next)do{r=255&t.pending_buf[t.sym_buf+c++],r+=(255&t.pending_buf[t.sym_buf+c++])<<8,s=t.pending_buf[t.sym_buf+c++],0===r?b(t,s,e):(a=h[s],b(t,a+256+1,e),l=n[a],0!==l&&(s-=p[a],x(t,s,l)),r--,a=A(r),b(t,a,i),l=o[a],0!==l&&(r-=d[a],x(t,r,l)))}while(c<t.sym_next);b(t,256,e)},L=(t,e)=>{const i=e.dyn_tree,r=e.stat_desc.static_tree,n=e.stat_desc.has_stree,o=e.stat_desc.elems;let s,a,l,c=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<o;s++)0!==i[2*s]?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):i[2*s+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,n&&(t.static_len-=r[2*l+1]);for(e.max_code=c,s=t.heap_len>>1;s>=1;s--)E(t,i,s);l=o;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],E(t,i,1),a=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=a,i[2*l]=i[2*s]+i[2*a],t.depth[l]=(t.depth[s]>=t.depth[a]?t.depth[s]:t.depth[a])+1,i[2*s+1]=i[2*a+1]=l,t.heap[1]=l++,E(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,r=e.max_code,n=e.stat_desc.static_tree,o=e.stat_desc.has_stree,s=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,u,h,p,d,f,m=0;for(p=0;p<=15;p++)t.bl_count[p]=0;for(i[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)u=t.heap[c],p=i[2*i[2*u+1]+1]+1,p>l&&(p=l,m++),i[2*u+1]=p,u>r||(t.bl_count[p]++,d=0,u>=a&&(d=s[u-a]),f=i[2*u],t.opt_len+=f*(p+d),o&&(t.static_len+=f*(n[2*u+1]+d)));if(0!==m){do{for(p=l-1;0===t.bl_count[p];)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[l]--,m-=2}while(m>0);for(p=l;0!==p;p--)for(u=t.bl_count[p];0!==u;)h=t.heap[--c],h>r||(i[2*h+1]!==p&&(t.opt_len+=(p-i[2*h+1])*i[2*h],i[2*h+1]=p),u--)}})(t,e),S(i,c,t.bl_count)},P=(t,e,i)=>{let r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),e[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=e[2*(r+1)+1],++a<l&&n===s||(a<c?t.bl_tree[2*n]+=a:0!==n?(n!==o&&t.bl_tree[2*n]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4))},k=(t,e,i)=>{let r,n,o=-1,s=e[1],a=0,l=7,c=4;for(0===s&&(l=138,c=3),r=0;r<=i;r++)if(n=s,s=e[2*(r+1)+1],!(++a<l&&n===s)){if(a<c)do{b(t,n,t.bl_tree)}while(0!=--a);else 0!==n?(n!==o&&(b(t,n,t.bl_tree),a--),b(t,16,t.bl_tree),x(t,a-3,2)):a<=10?(b(t,17,t.bl_tree),x(t,a-3,3)):(b(t,18,t.bl_tree),x(t,a-11,7));a=0,o=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4)}};let N=!1;const D=(t,e,i,r)=>{x(t,0+(r?1:0),3),C(t),v(t,i),v(t,~i),i&&t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i};var O={_tr_init:t=>{N||((()=>{let t,e,i,r,a;const y=new Array(16);for(i=0,r=0;r<28;r++)for(p[r]=i,t=0;t<1<<n[r];t++)h[i++]=r;for(h[i-1]=r,a=0,r=0;r<16;r++)for(d[r]=a,t=0;t<1<<o[r];t++)u[a++]=r;for(a>>=7;r<30;r++)for(d[r]=a<<7,t=0;t<1<<o[r]-7;t++)u[256+a++]=r;for(e=0;e<=15;e++)y[e]=0;for(t=0;t<=143;)l[2*t+1]=8,t++,y[8]++;for(;t<=255;)l[2*t+1]=9,t++,y[9]++;for(;t<=279;)l[2*t+1]=7,t++,y[7]++;for(;t<=287;)l[2*t+1]=8,t++,y[8]++;for(S(l,287,y),t=0;t<30;t++)c[2*t+1]=5,c[2*t]=w(t,5);m=new f(l,n,257,286,15),g=new f(c,o,0,30,15),_=new f(new Array(0),s,0,19,7)})(),N=!0),t.l_desc=new y(t.dyn_ltree,m),t.d_desc=new y(t.dyn_dtree,g),t.bl_desc=new y(t.bl_tree,_),t.bi_buf=0,t.bi_valid=0,T(t)},_tr_stored_block:D,_tr_flush_block:(t,e,i,r)=>{let n,o,s=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),L(t,t.l_desc),L(t,t.d_desc),s=(t=>{let e;for(P(t,t.dyn_ltree,t.l_desc.max_code),P(t,t.dyn_dtree,t.d_desc.max_code),L(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*a[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),n=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=n&&(n=o)):n=o=i+5,i+4<=n&&-1!==e?D(t,e,i,r):4===t.strategy||o===n?(x(t,2+(r?1:0),3),I(t,l,c)):(x(t,4+(r?1:0),3),((t,e,i,r)=>{let n;for(x(t,e-257,5),x(t,i-1,5),x(t,r-4,4),n=0;n<r;n++)x(t,t.bl_tree[2*a[n]+1],3);k(t,t.dyn_ltree,e-1),k(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),I(t,t.dyn_ltree,t.dyn_dtree)),T(t),r&&C(t)},_tr_tally:(t,e,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(h[i]+256+1)]++,t.dyn_dtree[2*A(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{x(t,2,3),b(t,256,l),(t=>{16===t.bi_valid?(v(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},R=(t,e,i,r)=>{let n=65535&t,o=t>>>16&65535,s=0;for(;0!==i;){s=i>2e3?2e3:i,i-=s;do{n=n+e[r++]|0,o=o+n|0}while(--s);n%=65521,o%=65521}return n|o<<16};const F=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());var z=(t,e,i,r)=>{const n=F,o=r+i;t^=-1;for(let i=r;i<o;i++)t=t>>>8^n[255&(t^e[i])];return~t},B={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},U={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:V,_tr_stored_block:j,_tr_flush_block:G,_tr_tally:Z,_tr_align:q}=O,{Z_NO_FLUSH:W,Z_PARTIAL_FLUSH:H,Z_FULL_FLUSH:J,Z_FINISH:K,Z_BLOCK:$,Z_OK:Y,Z_STREAM_END:X,Z_STREAM_ERROR:Q,Z_DATA_ERROR:tt,Z_BUF_ERROR:et,Z_DEFAULT_COMPRESSION:it,Z_FILTERED:rt,Z_HUFFMAN_ONLY:nt,Z_RLE:ot,Z_FIXED:st,Z_DEFAULT_STRATEGY:at,Z_UNKNOWN:lt,Z_DEFLATED:ct}=U,ut=258,ht=262,pt=42,dt=113,ft=666,mt=(t,e)=>(t.msg=B[e],e),gt=t=>2*t-(t>4?9:0),_t=t=>{let e=t.length;for(;--e>=0;)t[e]=0},yt=t=>{let e,i,r,n=t.w_size;e=t.hash_size,r=e;do{i=t.head[--r],t.head[r]=i>=n?i-n:0}while(--e);e=n,r=e;do{i=t.prev[--r],t.prev[r]=i>=n?i-n:0}while(--e)};let At=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const vt=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},xt=(t,e)=>{G(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,vt(t.strm)},bt=(t,e)=>{t.pending_buf[t.pending++]=e},wt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},St=(t,e,i,r)=>{let n=t.avail_in;return n>r&&(n=r),0===n?0:(t.avail_in-=n,e.set(t.input.subarray(t.next_in,t.next_in+n),i),1===t.state.wrap?t.adler=R(t.adler,e,n,i):2===t.state.wrap&&(t.adler=z(t.adler,e,n,i)),t.next_in+=n,t.total_in+=n,n)},Tt=(t,e)=>{let i,r,n=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-ht?t.strstart-(t.w_size-ht):0,c=t.window,u=t.w_mask,h=t.prev,p=t.strstart+ut;let d=c[o+s-1],f=c[o+s];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do{if(i=e,c[i+s]===f&&c[i+s-1]===d&&c[i]===c[o]&&c[++i]===c[o+1]){o+=2,i++;do{}while(c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&c[++o]===c[++i]&&o<p);if(r=ut-(p-o),o=p-ut,r>s){if(t.match_start=e,s=r,r>=a)break;d=c[o+s-1],f=c[o+s]}}}while((e=h[e&u])>l&&0!=--n);return s<=t.lookahead?s:t.lookahead},Ct=t=>{const e=t.w_size;let i,r,n;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ht)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),yt(t),r+=e),0===t.strm.avail_in)break;if(i=St(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=i,t.lookahead+t.insert>=3)for(n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=At(t,t.ins_h,t.window[n+1]);t.insert&&(t.ins_h=At(t,t.ins_h,t.window[n+3-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ht&&0!==t.strm.avail_in)},Mt=(t,e)=>{let i,r,n,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,s=0,a=t.strm.avail_in;do{if(i=65535,n=t.bi_valid+42>>3,t.strm.avail_out<n)break;if(n=t.strm.avail_out-n,r=t.strstart-t.block_start,i>r+t.strm.avail_in&&(i=r+t.strm.avail_in),i>n&&(i=n),i<o&&(0===i&&e!==K||e===W||i!==r+t.strm.avail_in))break;s=e===K&&i===r+t.strm.avail_in?1:0,j(t,0,0,s),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,vt(t.strm),r&&(r>i&&(r=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,i-=r),i&&(St(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(0===s);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?4:e!==W&&e!==K&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(n=t.window_size-t.strstart,t.strm.avail_in>n&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,n+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),n>t.strm.avail_in&&(n=t.strm.avail_in),n&&(St(t.strm,t.window,t.strstart,n),t.strstart+=n,t.insert+=n>t.w_size-t.insert?t.w_size-t.insert:n),t.high_water<t.strstart&&(t.high_water=t.strstart),n=t.bi_valid+42>>3,n=t.pending_buf_size-n>65535?65535:t.pending_buf_size-n,o=n>t.w_size?t.w_size:n,r=t.strstart-t.block_start,(r>=o||(r||e===K)&&e!==W&&0===t.strm.avail_in&&r<=n)&&(i=r>n?n:r,s=e===K&&0===t.strm.avail_in&&i===r?1:0,j(t,t.block_start,i,s),t.block_start+=i,vt(t.strm)),s?3:1)},Et=(t,e)=>{let i,r;for(;;){if(t.lookahead<ht){if(Ct(t),t.lookahead<ht&&e===W)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=At(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-ht&&(t.match_length=Tt(t,i)),t.match_length>=3)if(r=Z(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=At(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=At(t,t.ins_h,t.window[t.strstart+1]);else r=Z(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(xt(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===K?(xt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(xt(t,!1),0===t.strm.avail_out)?1:2},It=(t,e)=>{let i,r,n;for(;;){if(t.lookahead<ht){if(Ct(t),t.lookahead<ht&&e===W)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=At(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-ht&&(t.match_length=Tt(t,i),t.match_length<=5&&(t.strategy===rt||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-3,r=Z(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=n&&(t.ins_h=At(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(xt(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(r=Z(t,0,t.window[t.strstart-1]),r&&xt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Z(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===K?(xt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(xt(t,!1),0===t.strm.avail_out)?1:2};function Lt(t,e,i,r,n){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=r,this.func=n}const Pt=[new Lt(0,0,0,0,Mt),new Lt(4,4,8,4,Et),new Lt(4,5,16,8,Et),new Lt(4,6,32,32,Et),new Lt(4,4,16,16,It),new Lt(8,16,32,32,It),new Lt(8,16,128,128,It),new Lt(8,32,128,256,It),new Lt(32,128,258,1024,It),new Lt(32,258,258,4096,It)];function kt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ct,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),_t(this.dyn_ltree),_t(this.dyn_dtree),_t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),_t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),_t(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Nt=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==pt&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==dt&&e.status!==ft?1:0},Dt=t=>{if(Nt(t))return mt(t,Q);t.total_in=t.total_out=0,t.data_type=lt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?pt:dt,t.adler=2===e.wrap?0:1,e.last_flush=-2,V(e),Y},Ot=t=>{const e=Dt(t);var i;return e===Y&&((i=t.state).window_size=2*i.w_size,_t(i.head),i.max_lazy_match=Pt[i.level].max_lazy,i.good_match=Pt[i.level].good_length,i.nice_match=Pt[i.level].nice_length,i.max_chain_length=Pt[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},Rt=(t,e,i,r,n,o)=>{if(!t)return Q;let s=1;if(e===it&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),n<1||n>9||i!==ct||r<8||r>15||e<0||e>9||o<0||o>st||8===r&&1!==s)return mt(t,Q);8===r&&(r=9);const a=new kt;return t.state=a,a.strm=t,a.status=pt,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=o,a.method=i,Ot(t)};var Ft={deflateInit:(t,e)=>Rt(t,e,ct,15,8,at),deflateInit2:Rt,deflateReset:Ot,deflateResetKeep:Dt,deflateSetHeader:(t,e)=>Nt(t)||2!==t.state.wrap?Q:(t.state.gzhead=e,Y),deflate:(t,e)=>{if(Nt(t)||e>$||e<0)return t?mt(t,Q):Q;const i=t.state;if(!t.output||0!==t.avail_in&&!t.input||i.status===ft&&e!==K)return mt(t,0===t.avail_out?et:Q);const r=i.last_flush;if(i.last_flush=e,0!==i.pending){if(vt(t),0===t.avail_out)return i.last_flush=-1,Y}else if(0===t.avail_in&&gt(e)<=gt(r)&&e!==K)return mt(t,et);if(i.status===ft&&0!==t.avail_in)return mt(t,et);if(i.status===pt&&0===i.wrap&&(i.status=dt),i.status===pt){let e=ct+(i.w_bits-8<<4)<<8,r=-1;if(r=i.strategy>=nt||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=r<<6,0!==i.strstart&&(e|=32),e+=31-e%31,wt(i,e),0!==i.strstart&&(wt(i,t.adler>>>16),wt(i,65535&t.adler)),t.adler=1,i.status=dt,vt(t),0!==i.pending)return i.last_flush=-1,Y}if(57===i.status)if(t.adler=0,bt(i,31),bt(i,139),bt(i,8),i.gzhead)bt(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),bt(i,255&i.gzhead.time),bt(i,i.gzhead.time>>8&255),bt(i,i.gzhead.time>>16&255),bt(i,i.gzhead.time>>24&255),bt(i,9===i.level?2:i.strategy>=nt||i.level<2?4:0),bt(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(bt(i,255&i.gzhead.extra.length),bt(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=z(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(bt(i,0),bt(i,0),bt(i,0),bt(i,0),bt(i,0),bt(i,9===i.level?2:i.strategy>=nt||i.level<2?4:0),bt(i,3),i.status=dt,vt(t),0!==i.pending)return i.last_flush=-1,Y;if(69===i.status){if(i.gzhead.extra){let e=i.pending,r=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+r>i.pending_buf_size;){let n=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>e&&(t.adler=z(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex+=n,vt(t),0!==i.pending)return i.last_flush=-1,Y;e=0,r-=n}let n=new Uint8Array(i.gzhead.extra);i.pending_buf.set(n.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending+=r,i.gzhead.hcrc&&i.pending>e&&(t.adler=z(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let e,r=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>r&&(t.adler=z(t.adler,i.pending_buf,i.pending-r,r)),vt(t),0!==i.pending)return i.last_flush=-1,Y;r=0}e=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,bt(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>r&&(t.adler=z(t.adler,i.pending_buf,i.pending-r,r)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let e,r=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>r&&(t.adler=z(t.adler,i.pending_buf,i.pending-r,r)),vt(t),0!==i.pending)return i.last_flush=-1,Y;r=0}e=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,bt(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>r&&(t.adler=z(t.adler,i.pending_buf,i.pending-r,r))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(vt(t),0!==i.pending))return i.last_flush=-1,Y;bt(i,255&t.adler),bt(i,t.adler>>8&255),t.adler=0}if(i.status=dt,vt(t),0!==i.pending)return i.last_flush=-1,Y}if(0!==t.avail_in||0!==i.lookahead||e!==W&&i.status!==ft){let r=0===i.level?Mt(i,e):i.strategy===nt?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Ct(t),0===t.lookahead)){if(e===W)return 1;break}if(t.match_length=0,i=Z(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(xt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===K?(xt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(xt(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===ot?((t,e)=>{let i,r,n,o;const s=t.window;for(;;){if(t.lookahead<=ut){if(Ct(t),t.lookahead<=ut&&e===W)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(n=t.strstart-1,r=s[n],r===s[++n]&&r===s[++n]&&r===s[++n])){o=t.strstart+ut;do{}while(r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o);t.match_length=ut-(o-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=Z(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Z(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(xt(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===K?(xt(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(xt(t,!1),0===t.strm.avail_out)?1:2})(i,e):Pt[i.level].func(i,e);if(3!==r&&4!==r||(i.status=ft),1===r||3===r)return 0===t.avail_out&&(i.last_flush=-1),Y;if(2===r&&(e===H?q(i):e!==$&&(j(i,0,0,!1),e===J&&(_t(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),vt(t),0===t.avail_out))return i.last_flush=-1,Y}return e!==K?Y:i.wrap<=0?X:(2===i.wrap?(bt(i,255&t.adler),bt(i,t.adler>>8&255),bt(i,t.adler>>16&255),bt(i,t.adler>>24&255),bt(i,255&t.total_in),bt(i,t.total_in>>8&255),bt(i,t.total_in>>16&255),bt(i,t.total_in>>24&255)):(wt(i,t.adler>>>16),wt(i,65535&t.adler)),vt(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?Y:X)},deflateEnd:t=>{if(Nt(t))return Q;const e=t.state.status;return t.state=null,e===dt?mt(t,tt):Y},deflateSetDictionary:(t,e)=>{let i=e.length;if(Nt(t))return Q;const r=t.state,n=r.wrap;if(2===n||1===n&&r.status!==pt||r.lookahead)return Q;if(1===n&&(t.adler=R(t.adler,e,i,0)),r.wrap=0,i>=r.w_size){0===n&&(_t(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(i-r.w_size,i),0),e=t,i=r.w_size}const o=t.avail_in,s=t.next_in,a=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Ct(r);r.lookahead>=3;){let t=r.strstart,e=r.lookahead-2;do{r.ins_h=At(r,r.ins_h,r.window[t+3-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=2,Ct(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=s,t.input=a,t.avail_in=o,r.wrap=n,Y},deflateInfo:"pako deflate (from Nodeca project)"};const zt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Bt={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const e in i)zt(i,e)&&(t[e]=i[e])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,r=0,n=t.length;e<n;e++){let n=t[e];i.set(n,r),r+=n.length}return i}};let Ut=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Ut=!1}const Vt=new Uint8Array(256);for(let t=0;t<256;t++)Vt[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Vt[254]=Vt[254]=1;var jt={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,r,n,o,s=t.length,a=0;for(n=0;n<s;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<s&&(r=t.charCodeAt(n+1),56320==(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(a),o=0,n=0;o<a;n++)i=t.charCodeAt(n),55296==(64512&i)&&n+1<s&&(r=t.charCodeAt(n+1),56320==(64512&r)&&(i=65536+(i-55296<<10)+(r-56320),n++)),i<128?e[o++]=i:i<2048?(e[o++]=192|i>>>6,e[o++]=128|63&i):i<65536?(e[o++]=224|i>>>12,e[o++]=128|i>>>6&63,e[o++]=128|63&i):(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63,e[o++]=128|i>>>6&63,e[o++]=128|63&i);return e},buf2string:(t,e)=>{const i=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let r,n;const o=new Array(2*i);for(n=0,r=0;r<i;){let e=t[r++];if(e<128){o[n++]=e;continue}let s=Vt[e];if(s>4)o[n++]=65533,r+=s-1;else{for(e&=2===s?31:3===s?15:7;s>1&&r<i;)e=e<<6|63&t[r++],s--;s>1?o[n++]=65533:e<65536?o[n++]=e:(e-=65536,o[n++]=55296|e>>10&1023,o[n++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Ut)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let r=0;r<e;r++)i+=String.fromCharCode(t[r]);return i})(o,n)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let i=e-1;for(;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?e:i+Vt[t[i]]>e?i:e}},Gt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Zt=Object.prototype.toString,{Z_NO_FLUSH:qt,Z_SYNC_FLUSH:Wt,Z_FULL_FLUSH:Ht,Z_FINISH:Jt,Z_OK:Kt,Z_STREAM_END:$t,Z_DEFAULT_COMPRESSION:Yt,Z_DEFAULT_STRATEGY:Xt,Z_DEFLATED:Qt}=U;function te(t){this.options=Bt.assign({level:Yt,method:Qt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Xt},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Gt,this.strm.avail_out=0;let i=Ft.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Kt)throw new Error(B[i]);if(e.header&&Ft.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?jt.string2buf(e.dictionary):"[object ArrayBuffer]"===Zt.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=Ft.deflateSetDictionary(this.strm,t),i!==Kt)throw new Error(B[i]);this._dict_set=!0}}function ee(t,e){const i=new te(e);if(i.push(t,!0),i.err)throw i.msg||B[i.err];return i.result}te.prototype.push=function(t,e){const i=this.strm,r=this.options.chunkSize;let n,o;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Jt:qt,"string"==typeof t?i.input=jt.string2buf(t):"[object ArrayBuffer]"===Zt.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(o===Wt||o===Ht)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(n=Ft.deflate(i,o),n===$t)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Ft.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Kt;if(0!==i.avail_out){if(o>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},te.prototype.onData=function(t){this.chunks.push(t)},te.prototype.onEnd=function(t){t===Kt&&(this.result=Bt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ie={Deflate:te,deflate:ee,deflateRaw:function(t,e){return(e=e||{}).raw=!0,ee(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,ee(t,e)},constants:U};const re=16209;var ne=function(t,e){let i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S,T;const C=t.state;i=t.next_in,S=t.input,r=i+(t.avail_in-5),n=t.next_out,T=t.output,o=n-(e-t.avail_out),s=n+(t.avail_out-257),a=C.dmax,l=C.wsize,c=C.whave,u=C.wnext,h=C.window,p=C.hold,d=C.bits,f=C.lencode,m=C.distcode,g=(1<<C.lenbits)-1,_=(1<<C.distbits)-1;t:do{d<15&&(p+=S[i++]<<d,d+=8,p+=S[i++]<<d,d+=8),y=f[p&g];e:for(;;){if(A=y>>>24,p>>>=A,d-=A,A=y>>>16&255,0===A)T[n++]=65535&y;else{if(!(16&A)){if(64&A){if(32&A){C.mode=16191;break t}t.msg="invalid literal/length code",C.mode=re;break t}y=f[(65535&y)+(p&(1<<A)-1)];continue e}for(v=65535&y,A&=15,A&&(d<A&&(p+=S[i++]<<d,d+=8),v+=p&(1<<A)-1,p>>>=A,d-=A),d<15&&(p+=S[i++]<<d,d+=8,p+=S[i++]<<d,d+=8),y=m[p&_];;){if(A=y>>>24,p>>>=A,d-=A,A=y>>>16&255,16&A){if(x=65535&y,A&=15,d<A&&(p+=S[i++]<<d,d+=8,d<A&&(p+=S[i++]<<d,d+=8)),x+=p&(1<<A)-1,x>a){t.msg="invalid distance too far back",C.mode=re;break t}if(p>>>=A,d-=A,A=n-o,x>A){if(A=x-A,A>c&&C.sane){t.msg="invalid distance too far back",C.mode=re;break t}if(b=0,w=h,0===u){if(b+=l-A,A<v){v-=A;do{T[n++]=h[b++]}while(--A);b=n-x,w=T}}else if(u<A){if(b+=l+u-A,A-=u,A<v){v-=A;do{T[n++]=h[b++]}while(--A);if(b=0,u<v){A=u,v-=A;do{T[n++]=h[b++]}while(--A);b=n-x,w=T}}}else if(b+=u-A,A<v){v-=A;do{T[n++]=h[b++]}while(--A);b=n-x,w=T}for(;v>2;)T[n++]=w[b++],T[n++]=w[b++],T[n++]=w[b++],v-=3;v&&(T[n++]=w[b++],v>1&&(T[n++]=w[b++]))}else{b=n-x;do{T[n++]=T[b++],T[n++]=T[b++],T[n++]=T[b++],v-=3}while(v>2);v&&(T[n++]=T[b++],v>1&&(T[n++]=T[b++]))}break}if(64&A){t.msg="invalid distance code",C.mode=re;break t}y=m[(65535&y)+(p&(1<<A)-1)]}}break}}while(i<r&&n<s);v=d>>3,i-=v,d-=v<<3,p&=(1<<d)-1,t.next_in=i,t.next_out=n,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=n<s?s-n+257:257-(n-s),C.hold=p,C.bits=d};const oe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),se=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ae=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),le=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ce=(t,e,i,r,n,o,s,a)=>{const l=a.bits;let c,u,h,p,d,f,m=0,g=0,_=0,y=0,A=0,v=0,x=0,b=0,w=0,S=0,T=null;const C=new Uint16Array(16),M=new Uint16Array(16);let E,I,L,P=null;for(m=0;m<=15;m++)C[m]=0;for(g=0;g<r;g++)C[e[i+g]]++;for(A=l,y=15;y>=1&&0===C[y];y--);if(A>y&&(A=y),0===y)return n[o++]=20971520,n[o++]=20971520,a.bits=1,0;for(_=1;_<y&&0===C[_];_++);for(A<_&&(A=_),b=1,m=1;m<=15;m++)if(b<<=1,b-=C[m],b<0)return-1;if(b>0&&(0===t||1!==y))return-1;for(M[1]=0,m=1;m<15;m++)M[m+1]=M[m]+C[m];for(g=0;g<r;g++)0!==e[i+g]&&(s[M[e[i+g]]++]=g);if(0===t?(T=P=s,f=20):1===t?(T=oe,P=se,f=257):(T=ae,P=le,f=0),S=0,g=0,m=_,d=o,v=A,x=0,h=-1,w=1<<A,p=w-1,1===t&&w>852||2===t&&w>592)return 1;for(;;){E=m-x,s[g]+1<f?(I=0,L=s[g]):s[g]>=f?(I=P[s[g]-f],L=T[s[g]-f]):(I=96,L=0),c=1<<m-x,u=1<<v,_=u;do{u-=c,n[d+(S>>x)+u]=E<<24|I<<16|L}while(0!==u);for(c=1<<m-1;S&c;)c>>=1;if(0!==c?(S&=c-1,S+=c):S=0,g++,0==--C[m]){if(m===y)break;m=e[i+s[g]]}if(m>A&&(S&p)!==h){for(0===x&&(x=A),d+=_,v=m-x,b=1<<v;v+x<y&&(b-=C[v+x],!(b<=0));)v++,b<<=1;if(w+=1<<v,1===t&&w>852||2===t&&w>592)return 1;h=S&p,n[h]=A<<24|v<<16|d-o}}return 0!==S&&(n[d+S]=m-x<<24|64<<16),a.bits=A,0};const{Z_FINISH:ue,Z_BLOCK:he,Z_TREES:pe,Z_OK:de,Z_STREAM_END:fe,Z_NEED_DICT:me,Z_STREAM_ERROR:ge,Z_DATA_ERROR:_e,Z_MEM_ERROR:ye,Z_BUF_ERROR:Ae,Z_DEFLATED:ve}=U,xe=16180,be=16190,we=16191,Se=16192,Te=16194,Ce=16199,Me=16200,Ee=16206,Ie=16209,Le=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Pe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ke=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<xe||e.mode>16211?1:0},Ne=t=>{if(ke(t))return ge;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=xe,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,de},De=t=>{if(ke(t))return ge;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Ne(t)},Oe=(t,e)=>{let i;if(ke(t))return ge;const r=t.state;return e<0?(i=0,e=-e):(i=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ge:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=i,r.wbits=e,De(t))},Re=(t,e)=>{if(!t)return ge;const i=new Pe;t.state=i,i.strm=t,i.window=null,i.mode=xe;const r=Oe(t,e);return r!==de&&(t.state=null),r};let Fe,ze,Be=!0;const Ue=t=>{if(Be){Fe=new Int32Array(512),ze=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(ce(1,t.lens,0,288,Fe,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;ce(2,t.lens,0,32,ze,0,t.work,{bits:5}),Be=!1}t.lencode=Fe,t.lenbits=9,t.distcode=ze,t.distbits=5},Ve=(t,e,i,r)=>{let n;const o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(e.subarray(i-o.wsize,i),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>r&&(n=r),o.window.set(e.subarray(i-r,i-r+n),o.wnext),(r-=n)?(o.window.set(e.subarray(i-r,i),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};var je={inflateReset:De,inflateReset2:Oe,inflateResetKeep:Ne,inflateInit:t=>Re(t,15),inflateInit2:Re,inflate:(t,e)=>{let i,r,n,o,s,a,l,c,u,h,p,d,f,m,g,_,y,A,v,x,b,w,S=0;const T=new Uint8Array(4);let C,M;const E=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ke(t)||!t.output||!t.input&&0!==t.avail_in)return ge;i=t.state,i.mode===we&&(i.mode=Se),s=t.next_out,n=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,c=i.hold,u=i.bits,h=a,p=l,w=de;t:for(;;)switch(i.mode){case xe:if(0===i.wrap){i.mode=Se;break}for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(2&i.wrap&&35615===c){0===i.wbits&&(i.wbits=15),i.check=0,T[0]=255&c,T[1]=c>>>8&255,i.check=z(i.check,T,2,0),c=0,u=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",i.mode=Ie;break}if((15&c)!==ve){t.msg="unknown compression method",i.mode=Ie;break}if(c>>>=4,u-=4,b=8+(15&c),0===i.wbits&&(i.wbits=b),b>15||b>i.wbits){t.msg="invalid window size",i.mode=Ie;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&c?16189:we,c=0,u=0;break;case 16181:for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(i.flags=c,(255&i.flags)!==ve){t.msg="unknown compression method",i.mode=Ie;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Ie;break}i.head&&(i.head.text=c>>8&1),512&i.flags&&4&i.wrap&&(T[0]=255&c,T[1]=c>>>8&255,i.check=z(i.check,T,2,0)),c=0,u=0,i.mode=16182;case 16182:for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.time=c),512&i.flags&&4&i.wrap&&(T[0]=255&c,T[1]=c>>>8&255,T[2]=c>>>16&255,T[3]=c>>>24&255,i.check=z(i.check,T,4,0)),c=0,u=0,i.mode=16183;case 16183:for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.head&&(i.head.xflags=255&c,i.head.os=c>>8),512&i.flags&&4&i.wrap&&(T[0]=255&c,T[1]=c>>>8&255,i.check=z(i.check,T,2,0)),c=0,u=0,i.mode=16184;case 16184:if(1024&i.flags){for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.length=c,i.head&&(i.head.extra_len=c),512&i.flags&&4&i.wrap&&(T[0]=255&c,T[1]=c>>>8&255,i.check=z(i.check,T,2,0)),c=0,u=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(d=i.length,d>a&&(d=a),d&&(i.head&&(b=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(r.subarray(o,o+d),b)),512&i.flags&&4&i.wrap&&(i.check=z(i.check,r,d,o)),a-=d,o+=d,i.length-=d),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===a)break t;d=0;do{b=r[o+d++],i.head&&b&&i.length<65536&&(i.head.name+=String.fromCharCode(b))}while(b&&d<a);if(512&i.flags&&4&i.wrap&&(i.check=z(i.check,r,d,o)),a-=d,o+=d,b)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===a)break t;d=0;do{b=r[o+d++],i.head&&b&&i.length<65536&&(i.head.comment+=String.fromCharCode(b))}while(b&&d<a);if(512&i.flags&&4&i.wrap&&(i.check=z(i.check,r,d,o)),a-=d,o+=d,b)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;u<16;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(4&i.wrap&&c!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Ie;break}c=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=we;break;case 16189:for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}t.adler=i.check=Le(c),c=0,u=0,i.mode=be;case be:if(0===i.havedict)return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,me;t.adler=i.check=1,i.mode=we;case we:if(e===he||e===pe)break t;case Se:if(i.last){c>>>=7&u,u-=7&u,i.mode=Ee;break}for(;u<3;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}switch(i.last=1&c,c>>>=1,u-=1,3&c){case 0:i.mode=16193;break;case 1:if(Ue(i),i.mode=Ce,e===pe){c>>>=2,u-=2;break t}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=Ie}c>>>=2,u-=2;break;case 16193:for(c>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Ie;break}if(i.length=65535&c,c=0,u=0,i.mode=Te,e===pe)break t;case Te:i.mode=16195;case 16195:if(d=i.length,d){if(d>a&&(d=a),d>l&&(d=l),0===d)break t;n.set(r.subarray(o,o+d),s),a-=d,o+=d,l-=d,s+=d,i.length-=d;break}i.mode=we;break;case 16196:for(;u<14;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(i.nlen=257+(31&c),c>>>=5,u-=5,i.ndist=1+(31&c),c>>>=5,u-=5,i.ncode=4+(15&c),c>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Ie;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;u<3;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.lens[E[i.have++]]=7&c,c>>>=3,u-=3}for(;i.have<19;)i.lens[E[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,C={bits:i.lenbits},w=ce(0,i.lens,0,19,i.lencode,0,i.work,C),i.lenbits=C.bits,w){t.msg="invalid code lengths set",i.mode=Ie;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;S=i.lencode[c&(1<<i.lenbits)-1],g=S>>>24,_=S>>>16&255,y=65535&S,!(g<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(y<16)c>>>=g,u-=g,i.lens[i.have++]=y;else{if(16===y){for(M=g+2;u<M;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(c>>>=g,u-=g,0===i.have){t.msg="invalid bit length repeat",i.mode=Ie;break}b=i.lens[i.have-1],d=3+(3&c),c>>>=2,u-=2}else if(17===y){for(M=g+3;u<M;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=g,u-=g,b=0,d=3+(7&c),c>>>=3,u-=3}else{for(M=g+7;u<M;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=g,u-=g,b=0,d=11+(127&c),c>>>=7,u-=7}if(i.have+d>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Ie;break}for(;d--;)i.lens[i.have++]=b}}if(i.mode===Ie)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Ie;break}if(i.lenbits=9,C={bits:i.lenbits},w=ce(1,i.lens,0,i.nlen,i.lencode,0,i.work,C),i.lenbits=C.bits,w){t.msg="invalid literal/lengths set",i.mode=Ie;break}if(i.distbits=6,i.distcode=i.distdyn,C={bits:i.distbits},w=ce(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,C),i.distbits=C.bits,w){t.msg="invalid distances set",i.mode=Ie;break}if(i.mode=Ce,e===pe)break t;case Ce:i.mode=Me;case Me:if(a>=6&&l>=258){t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,ne(t,p),s=t.next_out,n=t.output,l=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,c=i.hold,u=i.bits,i.mode===we&&(i.back=-1);break}for(i.back=0;S=i.lencode[c&(1<<i.lenbits)-1],g=S>>>24,_=S>>>16&255,y=65535&S,!(g<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(_&&!(240&_)){for(A=g,v=_,x=y;S=i.lencode[x+((c&(1<<A+v)-1)>>A)],g=S>>>24,_=S>>>16&255,y=65535&S,!(A+g<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=A,u-=A,i.back+=A}if(c>>>=g,u-=g,i.back+=g,i.length=y,0===_){i.mode=16205;break}if(32&_){i.back=-1,i.mode=we;break}if(64&_){t.msg="invalid literal/length code",i.mode=Ie;break}i.extra=15&_,i.mode=16201;case 16201:if(i.extra){for(M=i.extra;u<M;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.length+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;S=i.distcode[c&(1<<i.distbits)-1],g=S>>>24,_=S>>>16&255,y=65535&S,!(g<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(!(240&_)){for(A=g,v=_,x=y;S=i.distcode[x+((c&(1<<A+v)-1)>>A)],g=S>>>24,_=S>>>16&255,y=65535&S,!(A+g<=u);){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}c>>>=A,u-=A,i.back+=A}if(c>>>=g,u-=g,i.back+=g,64&_){t.msg="invalid distance code",i.mode=Ie;break}i.offset=y,i.extra=15&_,i.mode=16203;case 16203:if(i.extra){for(M=i.extra;u<M;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}i.offset+=c&(1<<i.extra)-1,c>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Ie;break}i.mode=16204;case 16204:if(0===l)break t;if(d=p-l,i.offset>d){if(d=i.offset-d,d>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Ie;break}d>i.wnext?(d-=i.wnext,f=i.wsize-d):f=i.wnext-d,d>i.length&&(d=i.length),m=i.window}else m=n,f=s-i.offset,d=i.length;d>l&&(d=l),l-=d,i.length-=d;do{n[s++]=m[f++]}while(--d);0===i.length&&(i.mode=Me);break;case 16205:if(0===l)break t;n[s++]=i.length,l--,i.mode=Me;break;case Ee:if(i.wrap){for(;u<32;){if(0===a)break t;a--,c|=r[o++]<<u,u+=8}if(p-=l,t.total_out+=p,i.total+=p,4&i.wrap&&p&&(t.adler=i.check=i.flags?z(i.check,n,p,s-p):R(i.check,n,p,s-p)),p=l,4&i.wrap&&(i.flags?c:Le(c))!==i.check){t.msg="incorrect data check",i.mode=Ie;break}c=0,u=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;u<32;){if(0===a)break t;a--,c+=r[o++]<<u,u+=8}if(4&i.wrap&&c!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=Ie;break}c=0,u=0}i.mode=16208;case 16208:w=fe;break t;case Ie:w=_e;break t;case 16210:return ye;default:return ge}return t.next_out=s,t.avail_out=l,t.next_in=o,t.avail_in=a,i.hold=c,i.bits=u,(i.wsize||p!==t.avail_out&&i.mode<Ie&&(i.mode<Ee||e!==ue))&&Ve(t,t.output,t.next_out,p-t.avail_out),h-=t.avail_in,p-=t.avail_out,t.total_in+=h,t.total_out+=p,i.total+=p,4&i.wrap&&p&&(t.adler=i.check=i.flags?z(i.check,n,p,t.next_out-p):R(i.check,n,p,t.next_out-p)),t.data_type=i.bits+(i.last?64:0)+(i.mode===we?128:0)+(i.mode===Ce||i.mode===Te?256:0),(0===h&&0===p||e===ue)&&w===de&&(w=Ae),w},inflateEnd:t=>{if(ke(t))return ge;let e=t.state;return e.window&&(e.window=null),t.state=null,de},inflateGetHeader:(t,e)=>{if(ke(t))return ge;const i=t.state;return 2&i.wrap?(i.head=e,e.done=!1,de):ge},inflateSetDictionary:(t,e)=>{const i=e.length;let r,n,o;return ke(t)?ge:(r=t.state,0!==r.wrap&&r.mode!==be?ge:r.mode===be&&(n=1,n=R(n,e,i,0),n!==r.check)?_e:(o=Ve(t,e,i,i),o?(r.mode=16210,ye):(r.havedict=1,de)))},inflateInfo:"pako inflate (from Nodeca project)"},Ge=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Ze=Object.prototype.toString,{Z_NO_FLUSH:qe,Z_FINISH:We,Z_OK:He,Z_STREAM_END:Je,Z_NEED_DICT:Ke,Z_STREAM_ERROR:$e,Z_DATA_ERROR:Ye,Z_MEM_ERROR:Xe}=U;function Qe(t){this.options=Bt.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Gt,this.strm.avail_out=0;let i=je.inflateInit2(this.strm,e.windowBits);if(i!==He)throw new Error(B[i]);if(this.header=new Ge,je.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=jt.string2buf(e.dictionary):"[object ArrayBuffer]"===Ze.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=je.inflateSetDictionary(this.strm,e.dictionary),i!==He)))throw new Error(B[i])}function ti(t,e){const i=new Qe(e);if(i.push(t),i.err)throw i.msg||B[i.err];return i.result}Qe.prototype.push=function(t,e){const i=this.strm,r=this.options.chunkSize,n=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=e===~~e?e:!0===e?We:qe,"[object ArrayBuffer]"===Ze.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),o=je.inflate(i,s),o===Ke&&n&&(o=je.inflateSetDictionary(i,n),o===He?o=je.inflate(i,s):o===Ye&&(o=Ke));i.avail_in>0&&o===Je&&i.state.wrap>0&&0!==t[i.next_in];)je.inflateReset(i),o=je.inflate(i,s);switch(o){case $e:case Ye:case Ke:case Xe:return this.onEnd(o),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||o===Je))if("string"===this.options.to){let t=jt.utf8border(i.output,i.next_out),e=i.next_out-t,n=jt.buf2string(i.output,t);i.next_out=e,i.avail_out=r-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(o!==He||0!==a){if(o===Je)return o=je.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Qe.prototype.onData=function(t){this.chunks.push(t)},Qe.prototype.onEnd=function(t){t===He&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Bt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var ei={Inflate:Qe,inflate:ti,inflateRaw:function(t,e){return(e=e||{}).raw=!0,ti(t,e)},ungzip:ti,constants:U};const{Deflate:ii,deflate:ri,deflateRaw:ni,gzip:oi}=ie,{Inflate:si,inflate:ai,inflateRaw:li,ungzip:ci}=ei;var ui=ri,hi=ai},82807:(t,e,i)=>{"use strict";i.d(e,{A:()=>r});class r extends Map{#t=0;#e=new Map;#i=new Map;#r;#n;#o;constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof t.maxAge&&0===t.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.#r=t.maxSize,this.#n=t.maxAge||Number.POSITIVE_INFINITY,this.#o=t.onEviction}get __oldCache(){return this.#i}#s(t){if("function"==typeof this.#o)for(const[e,i]of t)this.#o(e,i.value)}#a(t,e){return"number"==typeof e.expiry&&e.expiry<=Date.now()&&("function"==typeof this.#o&&this.#o(t,e.value),this.delete(t))}#l(t,e){if(!1===this.#a(t,e))return e.value}#c(t,e){return e.expiry?this.#l(t,e):e.value}#u(t,e){const i=e.get(t);return this.#c(t,i)}#h(t,e){this.#e.set(t,e),this.#t++,this.#t>=this.#r&&(this.#t=0,this.#s(this.#i),this.#i=this.#e,this.#e=new Map)}#p(t,e){this.#i.delete(t),this.#h(t,e)}*#d(){for(const t of this.#i){const[e,i]=t;this.#e.has(e)||!1===this.#a(e,i)&&(yield t)}for(const t of this.#e){const[e,i]=t;!1===this.#a(e,i)&&(yield t)}}get(t){if(this.#e.has(t)){const e=this.#e.get(t);return this.#c(t,e)}if(this.#i.has(t)){const e=this.#i.get(t);if(!1===this.#a(t,e))return this.#p(t,e),e.value}}set(t,e,{maxAge:i=this.#n}={}){const r="number"==typeof i&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;return this.#e.has(t)?this.#e.set(t,{value:e,expiry:r}):this.#h(t,{value:e,expiry:r}),this}has(t){return this.#e.has(t)?!this.#a(t,this.#e.get(t)):!!this.#i.has(t)&&!this.#a(t,this.#i.get(t))}peek(t){return this.#e.has(t)?this.#u(t,this.#e):this.#i.has(t)?this.#u(t,this.#i):void 0}delete(t){const e=this.#e.delete(t);return e&&this.#t--,this.#i.delete(t)||e}clear(){this.#e.clear(),this.#i.clear(),this.#t=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this.#d()],i=e.length-t;i<0?(this.#e=new Map(e),this.#i=new Map,this.#t=e.length):(i>0&&this.#s(e.slice(0,i)),this.#i=new Map(e.slice(i)),this.#e=new Map,this.#t=0),this.#r=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.#e){const[e,i]=t;!1===this.#a(e,i)&&(yield[e,i.value])}for(const t of this.#i){const[e,i]=t;this.#e.has(e)||!1===this.#a(e,i)&&(yield[e,i.value])}}*entriesDescending(){let t=[...this.#e];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;!1===this.#a(r,n)&&(yield[r,n.value])}t=[...this.#i];for(let e=t.length-1;e>=0;--e){const i=t[e],[r,n]=i;this.#e.has(r)||!1===this.#a(r,n)&&(yield[r,n.value])}}*entriesAscending(){for(const[t,e]of this.#d())yield[t,e.value]}get size(){if(!this.#t)return this.#i.size;let t=0;for(const e of this.#i.keys())this.#e.has(e)||t++;return Math.min(this.#t+t,this.#r)}get maxSize(){return this.#r}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[i,r]of this.entriesAscending())t.call(e,r,i,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}}},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";i.r(r),i.d(r,{default:()=>o});var t=i(24388),e=window.powerbi,n={name:"iconMapProE938B1CED4834168A55864E1F8E7242E",displayName:"Icon Map Pro",class:"Visual",apiVersion:"5.6.0",create:e=>{if(t.b)return new t.b(e);throw"Visual instance not found"},createModalDialog:(t,e,i)=>{const r=globalThis.dialogRegistry;t in r&&new r[t](e,i)},custom:!0};void 0!==e&&(e.visuals=e.visuals||{},e.visuals.plugins=e.visuals.plugins||{},e.visuals.plugins.iconMapProE938B1CED4834168A55864E1F8E7242E=n);const o=n})(),iconMapProE938B1CED4834168A55864E1F8E7242E=r})();