function watermark(e){var t={watermark_txt:"",watermark_x:100,watermark_y:20,watermark_rows:20,watermark_cols:20,watermark_x_space:100,watermark_y_space:50,watermark_color:"#000000",watermark_alpha:.1,watermark_fontsize:"18px",watermark_font:"微软雅黑",watermark_width:120,watermark_height:80,watermark_angle:15};if(1===arguments.length&&"object"==typeof arguments[0]){var i=arguments[0]||{};for(var a in i)i[a]&&t[a]&&i[a]===t[a]||i[a]&&(t[a]=i[a])}var n=document.createDocumentFragment(),o=Math.max(document.body.scrollWidth,document.body.clientWidth),s=Math.max(document.body.scrollHeight,document.body.clientHeight);(0==t.watermark_cols||t.watermark_x+t.watermark_width*t.watermark_cols+t.watermark_x_space*(t.watermark_cols-1)>o)&&(t.watermark_cols=(o-t.watermark_x+t.watermark_x_space)/(t.watermark_width+t.watermark_x_space),t.watermark_x_space=(o-t.watermark_x-t.watermark_width*t.watermark_cols)/(t.watermark_cols-1)),(0==t.watermark_rows||t.watermark_y+t.watermark_height*t.watermark_rows+t.watermark_y_space*(t.watermark_rows-1)>s)&&(t.watermark_rows=(t.watermark_y_space+s-t.watermark_y)/(t.watermark_height+t.watermark_y_space),t.watermark_y_space=(s-t.watermark_y-t.watermark_height*t.watermark_rows)/(t.watermark_rows-1));for(var r,l,d=0;d<t.watermark_rows;d++){l=t.watermark_y+(t.watermark_y_space+t.watermark_height)*d;for(var h=0;h<t.watermark_cols;h++){r=t.watermark_x+(t.watermark_width+t.watermark_x_space)*h;var c=document.createElement("div");c.id="mask_div"+d+h,c.appendChild(document.createTextNode(t.watermark_txt)),c.style.webkitTransform="rotate(-"+t.watermark_angle+"deg)",c.style.transform="rotate(-"+t.watermark_angle+"deg)",c.style.visibility="",c.style.position="absolute",c.style.left=r+"px",c.style.top=l+"px",c.style.overflow="hidden",c.style.zIndex="-9999",c.style.border="solid #eee 1px",c.style.opacity="0.3",c.style.opacity=t.watermark_alpha,c.style.fontSize=t.watermark_fontsize,c.style.fontFamily=t.watermark_font,c.style.color=t.watermark_color,c.style.textAlign="center",c.style.width=t.watermark_width+"px",c.style.height=t.watermark_height+"px",c.style.display="block",n.appendChild(c)}}document.body.appendChild(n)}var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,a){void 0===e&&(e=[]);var n=e;return i(n),t&&(n.identityFields=t),a&&(n.source=a),n}function i(e,t){e.grouped=t?function(){return t}:function(){return a(e)}}function a(e){for(var t,i=[],a=0,n=e.length;n>a;a++){var o=e[a];if(!t||t.identity!==o.identity){if(t={values:[]},o.identity){t.identity=o.identity;var s=o.source;void 0!==s.groupName?t.name=s.groupName:s.displayName&&(t.name=s.displayName)}i.push(t)}t.values.push(o)}return i}e.createValueColumns=t,e.setGrouped=i,e.groupValues=a}(t=e.DataViewTransform||(e.DataViewTransform={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t){if(!e||!e.length)return-1;var i=e[0];if(i.values&&i.values.length>0)for(var n=0,o=i.values.length;o>n;++n){var s=i.values[n];if(s&&s.source&&a(s.source,t))return n}return-1}function i(e,t){if(e&&e.length)for(var i=0,n=e.length;n>i;i++)if(a(e[i].source,t))return i;return-1}function a(e,t){var i=e.roles;return i&&i[t]}function n(e,t){return null!=e&&null!=e.metadata&&e.metadata.columns&&e.metadata.columns.some(function(e){return e.roles&&void 0!==e.roles[t]})}function o(e,t){return e&&e.source&&e.source.roles&&e.source.roles[t]===!0}e.getMeasureIndexOfRole=t,e.getCategoryIndexOfRole=i,e.hasRole=a,e.hasRoleInDataView=n,e.hasRoleInValueColumn=o}(t=e.DataRoleHelper||(e.DataRoleHelper={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,i){if(!e)return i;var a=e[t];return void 0===a?i:a}function i(e,i,a){var n=t(e,i);return n&&n.solid?n.solid.color:a}e.getValue=t,e.getFillColorByPropertyName=i}(t=e.DataViewObject||(e.DataViewObject={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t;!function(t){function i(t,i,a){return t?e.DataViewObject.getValue(t[i.objectName],i.propertyName,a):a}function a(e,t,i){return e&&e[t]?e[t]:i}function n(e,t,a){var n=i(e,t);return n&&n.solid?n.solid.color:a}function o(e,t,a){var n=i(e,t,a);return n&&n.solid?n.solid.color:void 0===n||null===n||"object"==typeof n&&!n.solid?a:n}t.getValue=i,t.getObject=a,t.getFillColor=n,t.getCommonValue=o}(t=e.DataViewObjects||(e.DataViewObjects={}))}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i;!function(t){var i;!function(t){var i,a=e.extensibility.utils.dataview.DataRoleHelper;!function(e){function t(e,t,i){if(e.categories&&e.categories.length>0){var n=e.categories[0];return n.source&&a.hasRole(n.source,t)&&a.hasRole(n.source,i)}return!1}function i(e){return void 0!==e.groupName?e.groupName:e.queryName}function n(e){var t=s(e);return null!=t&&t.imageUrl===!0}function o(e){var t=s(e);return null!=t&&t.webUrl===!0}function s(e){return e&&e.type&&e.type.misc}function r(e){return e&&e.metadata&&e.metadata.columns&&e.metadata.columns.length?e.metadata.columns.some(function(e){return n(e)===!0}):!1}e.categoryIsAlsoSeriesRole=t,e.getSeriesName=i,e.isImageUrlColumn=n,e.isWebUrlColumn=o,e.getMiscellaneousTypeDescriptor=s,e.hasImageUrlColumn=r}(i=t.converterHelper||(t.converterHelper={}))}(i=t.dataview||(t.dataview={}))}(i=t.utils||(t.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.getDefault=function(){return new this},t.createPropertyIdentifier=function(e,t){return{objectName:e,propertyName:t}},t.parse=function(t){var i,a=this.getDefault();if(!t||!t.metadata||!t.metadata.objects)return a;i=a.getProperties();for(var n in i)for(var o in i[n]){var s=a[n][o];a[n][o]=e.DataViewObjects.getCommonValue(t.metadata.objects,i[n][o],s)}return a},t.isPropertyEnumerable=function(e){return!t.InnumerablePropertyPrefix.test(e)},t.enumerateObjectInstances=function(e,t){var i=e&&e[t.objectName];if(!i)return[];var a={objectName:t.objectName,selector:null,properties:{}};for(var n in i)i.hasOwnProperty(n)&&(a.properties[n]=i[n]);return{instances:[a]}},t.prototype.getProperties=function(){var e=this,i={},a=Object.keys(this);return a.forEach(function(a){if(t.isPropertyEnumerable(a)){var n=Object.keys(e[a]);i[a]={},n.forEach(function(e){t.isPropertyEnumerable(a)&&(i[a][e]=t.createPropertyIdentifier(a,e))})}}),i},t}();t.InnumerablePropertyPrefix=/^_/,e.DataViewObjectsParser=t}(t=e.dataview||(e.dataview={}))}(t=e.utils||(e.utils={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={})),!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function i(e,t){t=t||ie;var i=t.createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}function a(e){var t=!!e&&"length"in e&&e.length,i=pe.type(e);return"function"!==i&&!pe.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}function o(e,t,i){return pe.isFunction(t)?pe.grep(e,function(e,a){return!!t.call(e,a,e)!==i}):t.nodeType?pe.grep(e,function(e){return e===t!==i}):"string"!=typeof t?pe.grep(e,function(e){return re.call(t,e)>-1!==i}):ze.test(t)?pe.filter(t,e,i):(t=pe.filter(t,e),pe.grep(e,function(e){return re.call(t,e)>-1!==i&&1===e.nodeType}))}function s(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function r(e){var t={};return pe.each(e.match(Ne)||[],function(e,i){t[i]=!0}),t}function l(e){return e}function d(e){throw e}function h(e,t,i,a){var n;try{e&&pe.isFunction(n=e.promise)?n.call(e).done(t).fail(i):e&&pe.isFunction(n=e.then)?n.call(e,t,i):t.apply(void 0,[e].slice(a))}catch(e){i.apply(void 0,[e])}}function c(){ie.removeEventListener("DOMContentLoaded",c),e.removeEventListener("load",c),pe.ready()}function u(){this.expando=pe.expando+u.uid++}function g(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Ue.test(e)?JSON.parse(e):e)}function m(e,t,i){var a;if(void 0===i&&1===e.nodeType)if(a="data-"+t.replace(Be,"-$&").toLowerCase(),i=e.getAttribute(a),"string"==typeof i){try{i=g(i)}catch(n){}Ie.set(e,t,i)}else i=void 0;return i}function p(e,t,i,a){var n,o=1,s=20,r=a?function(){return a.cur()}:function(){return pe.css(e,t,"")},l=r(),d=i&&i[3]||(pe.cssNumber[t]?"":"px"),h=(pe.cssNumber[t]||"px"!==d&&+l)&&Re.exec(pe.css(e,t));if(h&&h[3]!==d){d=d||h[3],i=i||[],h=+l||1;do o=o||".5",h/=o,pe.style(e,t,h+d);while(o!==(o=r()/l)&&1!==o&&--s)}return i&&(h=+h||+l||0,n=i[1]?h+(i[1]+1)*i[2]:+i[2],a&&(a.unit=d,a.start=h,a.end=n)),n}function f(e){var t,i=e.ownerDocument,a=e.nodeName,n=Xe[a];return n?n:(t=i.body.appendChild(i.createElement(a)),n=pe.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),Xe[a]=n,n)}function v(e,t){for(var i,a,n=[],o=0,s=e.length;s>o;o++)a=e[o],a.style&&(i=a.style.display,t?("none"===i&&(n[o]=Ae.get(a,"display")||null,n[o]||(a.style.display="")),""===a.style.display&&We(a)&&(n[o]=f(a))):"none"!==i&&(n[o]="none",Ae.set(a,"display",i)));for(o=0;s>o;o++)null!=n[o]&&(e[o].style.display=n[o]);return e}function _(e,t){var i;return i="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&n(e,t)?pe.merge([e],i):i}function y(e,t){for(var i=0,a=e.length;a>i;i++)Ae.set(e[i],"globalEval",!t||Ae.get(t[i],"globalEval"))}function b(e,t,i,a,n){for(var o,s,r,l,d,h,c=t.createDocumentFragment(),u=[],g=0,m=e.length;m>g;g++)if(o=e[g],o||0===o)if("object"===pe.type(o))pe.merge(u,o.nodeType?[o]:o);else if(Ze.test(o)){for(s=s||c.appendChild(t.createElement("div")),r=(Fe.exec(o)||["",""])[1].toLowerCase(),l=qe[r]||qe._default,s.innerHTML=l[1]+pe.htmlPrefilter(o)+l[2],h=l[0];h--;)s=s.lastChild;pe.merge(u,s.childNodes),s=c.firstChild,s.textContent=""}else u.push(t.createTextNode(o));for(c.textContent="",g=0;o=u[g++];)if(a&&pe.inArray(o,a)>-1)n&&n.push(o);else if(d=pe.contains(o.ownerDocument,o),s=_(c.appendChild(o),"script"),d&&y(s),i)for(h=0;o=s[h++];)$e.test(o.type||"")&&i.push(o);return c}function x(){return!0}function D(){return!1}function C(){try{return ie.activeElement}catch(e){}}function w(e,t,i,a,n,o){var s,r;if("object"==typeof t){"string"!=typeof i&&(a=a||i,i=void 0);for(r in t)w(e,r,i,a,t[r],o);return e}if(null==a&&null==n?(n=i,a=i=void 0):null==n&&("string"==typeof i?(n=a,a=void 0):(n=a,a=i,i=void 0)),n===!1)n=D;else if(!n)return e;return 1===o&&(s=n,n=function(e){return pe().off(e),s.apply(this,arguments)},n.guid=s.guid||(s.guid=pe.guid++)),e.each(function(){pe.event.add(this,t,n,a,i)})}function z(e,t){return n(e,"table")&&n(11!==t.nodeType?t:t.firstChild,"tr")?pe(">tbody",e)[0]||e:e}function S(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function P(e){var t=nt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function T(e,t){var i,a,n,o,s,r,l,d;if(1===t.nodeType){if(Ae.hasData(e)&&(o=Ae.access(e),s=Ae.set(t,o),d=o.events)){delete s.handle,s.events={};for(n in d)for(i=0,a=d[n].length;a>i;i++)pe.event.add(t,n,d[n][i])}Ie.hasData(e)&&(r=Ie.access(e),l=pe.extend({},r),Ie.set(t,l))}}function j(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Ye.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function L(e,t,a,n){t=oe.apply([],t);var o,s,r,l,d,h,c=0,u=e.length,g=u-1,m=t[0],p=pe.isFunction(m);if(p||u>1&&"string"==typeof m&&!ge.checkClone&&at.test(m))return e.each(function(i){var o=e.eq(i);p&&(t[0]=m.call(this,i,o.html())),L(o,t,a,n)});if(u&&(o=b(t,e[0].ownerDocument,!1,e,n),s=o.firstChild,1===o.childNodes.length&&(o=s),s||n)){for(r=pe.map(_(o,"script"),S),l=r.length;u>c;c++)d=o,c!==g&&(d=pe.clone(d,!0,!0),l&&pe.merge(r,_(d,"script"))),a.call(e[c],d,c);if(l)for(h=r[r.length-1].ownerDocument,pe.map(r,P),c=0;l>c;c++)d=r[c],$e.test(d.type||"")&&!Ae.access(d,"globalEval")&&pe.contains(h,d)&&(d.src?pe._evalUrl&&pe._evalUrl(d.src):i(d.textContent.replace(ot,""),h))}return e}function N(e,t,i){for(var a,n=t?pe.filter(t,e):e,o=0;null!=(a=n[o]);o++)i||1!==a.nodeType||pe.cleanData(_(a)),a.parentNode&&(i&&pe.contains(a.ownerDocument,a)&&y(_(a,"script")),a.parentNode.removeChild(a));return e}function O(e,t,i){var a,n,o,s,r=e.style;return i=i||lt(e),i&&(s=i.getPropertyValue(t)||i[t],""!==s||pe.contains(e.ownerDocument,e)||(s=pe.style(e,t)),!ge.pixelMarginRight()&&rt.test(s)&&st.test(t)&&(a=r.width,n=r.minWidth,o=r.maxWidth,r.minWidth=r.maxWidth=r.width=s,s=i.width,r.width=a,r.minWidth=n,r.maxWidth=o)),void 0!==s?s+"":s}function M(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function E(e){if(e in mt)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=gt.length;i--;)if(e=gt[i]+t,e in mt)return e}function k(e){var t=pe.cssProps[e];return t||(t=pe.cssProps[e]=E(e)||e),t}function A(e,t,i){var a=Re.exec(t);return a?Math.max(0,a[2]-(i||0))+(a[3]||"px"):t}function I(e,t,i,a,n){var o,s=0;for(o=i===(a?"border":"content")?4:"width"===t?1:0;4>o;o+=2)"margin"===i&&(s+=pe.css(e,i+Ge[o],!0,n)),a?("content"===i&&(s-=pe.css(e,"padding"+Ge[o],!0,n)),"margin"!==i&&(s-=pe.css(e,"border"+Ge[o]+"Width",!0,n))):(s+=pe.css(e,"padding"+Ge[o],!0,n),"padding"!==i&&(s+=pe.css(e,"border"+Ge[o]+"Width",!0,n)));return s}function U(e,t,i){var a,n=lt(e),o=O(e,t,n),s="border-box"===pe.css(e,"boxSizing",!1,n);return rt.test(o)?o:(a=s&&(ge.boxSizingReliable()||o===e.style[t]),"auto"===o&&(o=e["offset"+t[0].toUpperCase()+t.slice(1)]),o=parseFloat(o)||0,o+I(e,t,i||(s?"border":"content"),a,n)+"px")}function B(e,t,i,a,n){return new B.prototype.init(e,t,i,a,n)}function H(){ft&&(ie.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(H):e.setTimeout(H,pe.fx.interval),pe.fx.tick())}function R(){return e.setTimeout(function(){pt=void 0}),pt=pe.now()}function G(e,t){var i,a=0,n={height:e};for(t=t?1:0;4>a;a+=2-t)i=Ge[a],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function W(e,t,i){for(var a,n=(Y.tweeners[t]||[]).concat(Y.tweeners["*"]),o=0,s=n.length;s>o;o++)if(a=n[o].call(i,t,e))return a}function V(e,t,i){var a,n,o,s,r,l,d,h,c="width"in t||"height"in t,u=this,g={},m=e.style,p=e.nodeType&&We(e),f=Ae.get(e,"fxshow");i.queue||(s=pe._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,r=s.empty.fire,s.empty.fire=function(){s.unqueued||r()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,pe.queue(e,"fx").length||s.empty.fire()})}));for(a in t)if(n=t[a],vt.test(n)){if(delete t[a],o=o||"toggle"===n,n===(p?"hide":"show")){if("show"!==n||!f||void 0===f[a])continue;p=!0}g[a]=f&&f[a]||pe.style(e,a)}if(l=!pe.isEmptyObject(t),l||!pe.isEmptyObject(g)){c&&1===e.nodeType&&(i.overflow=[m.overflow,m.overflowX,m.overflowY],d=f&&f.display,null==d&&(d=Ae.get(e,"display")),h=pe.css(e,"display"),"none"===h&&(d?h=d:(v([e],!0),d=e.style.display||d,h=pe.css(e,"display"),v([e]))),("inline"===h||"inline-block"===h&&null!=d)&&"none"===pe.css(e,"float")&&(l||(u.done(function(){m.display=d}),null==d&&(h=m.display,d="none"===h?"":h)),m.display="inline-block")),i.overflow&&(m.overflow="hidden",u.always(function(){m.overflow=i.overflow[0],m.overflowX=i.overflow[1],m.overflowY=i.overflow[2]})),l=!1;for(a in g)l||(f?"hidden"in f&&(p=f.hidden):f=Ae.access(e,"fxshow",{display:d}),o&&(f.hidden=!p),p&&v([e],!0),u.done(function(){p||v([e]),Ae.remove(e,"fxshow");for(a in g)pe.style(e,a,g[a])})),l=W(p?f[a]:0,a,u),a in f||(f[a]=l.start,p&&(l.end=l.start,l.start=0))}}function X(e,t){var i,a,n,o,s;for(i in e)if(a=pe.camelCase(i),n=t[a],o=e[i],Array.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==a&&(e[a]=o,delete e[i]),s=pe.cssHooks[a],s&&"expand"in s){o=s.expand(o),delete e[a];for(i in o)i in e||(e[i]=o[i],t[i]=n)}else t[a]=n}function Y(e,t,i){var a,n,o=0,s=Y.prefilters.length,r=pe.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=pt||R(),i=Math.max(0,d.startTime+d.duration-t),a=i/d.duration||0,o=1-a,s=0,l=d.tweens.length;l>s;s++)d.tweens[s].run(o);return r.notifyWith(e,[d,o,i]),1>o&&l?i:(l||r.notifyWith(e,[d,1,0]),r.resolveWith(e,[d]),!1)},d=r.promise({elem:e,props:pe.extend({},t),opts:pe.extend(!0,{specialEasing:{},easing:pe.easing._default},i),originalProperties:t,originalOptions:i,startTime:pt||R(),duration:i.duration,tweens:[],createTween:function(t,i){var a=pe.Tween(e,d.opts,t,i,d.opts.specialEasing[t]||d.opts.easing);return d.tweens.push(a),a},stop:function(t){var i=0,a=t?d.tweens.length:0;if(n)return this;for(n=!0;a>i;i++)d.tweens[i].run(1);return t?(r.notifyWith(e,[d,1,0]),r.resolveWith(e,[d,t])):r.rejectWith(e,[d,t]),this}}),h=d.props;for(X(h,d.opts.specialEasing);s>o;o++)if(a=Y.prefilters[o].call(d,e,h,d.opts))return pe.isFunction(a.stop)&&(pe._queueHooks(d.elem,d.opts.queue).stop=pe.proxy(a.stop,a)),a;return pe.map(h,W,d),pe.isFunction(d.opts.start)&&d.opts.start.call(e,d),d.progress(d.opts.progress).done(d.opts.done,d.opts.complete).fail(d.opts.fail).always(d.opts.always),pe.fx.timer(pe.extend(l,{elem:e,anim:d,queue:d.opts.queue})),d}function F(e){var t=e.match(Ne)||[];return t.join(" ")}function $(e){return e.getAttribute&&e.getAttribute("class")||""}function q(e,t,i,a){var n;if(Array.isArray(t))pe.each(t,function(t,n){i||Tt.test(e)?a(e,n):q(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,a)});else if(i||"object"!==pe.type(t))a(e,t);else for(n in t)q(e+"["+n+"]",t[n],i,a)}function Z(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var a,n=0,o=t.toLowerCase().match(Ne)||[];if(pe.isFunction(i))for(;a=o[n++];)"+"===a[0]?(a=a.slice(1)||"*",(e[a]=e[a]||[]).unshift(i)):(e[a]=e[a]||[]).push(i)}}function Q(e,t,i,a){function n(r){var l;return o[r]=!0,pe.each(e[r]||[],function(e,r){var d=r(t,i,a);return"string"!=typeof d||s||o[d]?s?!(l=d):void 0:(t.dataTypes.unshift(d),n(d),!1)}),l}var o={},s=e===Ht;return n(t.dataTypes[0])||!o["*"]&&n("*")}function K(e,t){var i,a,n=pe.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:a||(a={}))[i]=t[i]);return a&&pe.extend(!0,e,a),e}function J(e,t,i){for(var a,n,o,s,r=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===a&&(a=e.mimeType||t.getResponseHeader("Content-Type"));if(a)for(n in r)if(r[n]&&r[n].test(a)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}s||(s=n)}o=o||s}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}function ee(e,t,i,a){var n,o,s,r,l,d={},h=e.dataTypes.slice();if(h[1])for(s in e.converters)d[s.toLowerCase()]=e.converters[s];for(o=h.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&a&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=h.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=d[l+" "+o]||d["* "+o],!s)for(n in d)if(r=n.split(" "),r[1]===o&&(s=d[l+" "+r[0]]||d["* "+r[0]])){s===!0?s=d[n]:d[n]!==!0&&(o=r[0],h.unshift(r[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(c){return{state:"parsererror",error:s?c:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}var te=[],ie=e.document,ae=Object.getPrototypeOf,ne=te.slice,oe=te.concat,se=te.push,re=te.indexOf,le={},de=le.toString,he=le.hasOwnProperty,ce=he.toString,ue=ce.call(Object),ge={},me="3.2.1",pe=function(e,t){return new pe.fn.init(e,t)},fe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ve=/^-ms-/,_e=/-([a-z])/g,ye=function(e,t){return t.toUpperCase()};pe.fn=pe.prototype={jquery:me,constructor:pe,length:0,toArray:function(){return ne.call(this)},get:function(e){return null==e?ne.call(this):0>e?this[e+this.length]:this[e]},pushStack:function(e){var t=pe.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return pe.each(this,e)},map:function(e){return this.pushStack(pe.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(ne.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:se,sort:te.sort,splice:te.splice},pe.extend=pe.fn.extend=function(){var e,t,i,a,n,o,s=arguments[0]||{},r=1,l=arguments.length,d=!1;for("boolean"==typeof s&&(d=s,s=arguments[r]||{},r++),"object"==typeof s||pe.isFunction(s)||(s={}),r===l&&(s=this,r--);l>r;r++)if(null!=(e=arguments[r]))for(t in e)i=s[t],a=e[t],s!==a&&(d&&a&&(pe.isPlainObject(a)||(n=Array.isArray(a)))?(n?(n=!1,o=i&&Array.isArray(i)?i:[]):o=i&&pe.isPlainObject(i)?i:{},s[t]=pe.extend(d,o,a)):void 0!==a&&(s[t]=a));return s},pe.extend({expando:"jQuery"+(me+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===pe.type(e)},isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=pe.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==de.call(e)||(t=ae(e))&&(i=he.call(t,"constructor")&&t.constructor,"function"!=typeof i||ce.call(i)!==ue))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?le[de.call(e)]||"object":typeof e},globalEval:function(e){i(e)},camelCase:function(e){return e.replace(ve,"ms-").replace(_e,ye)},each:function(e,t){var i,n=0;if(a(e))for(i=e.length;i>n&&t.call(e[n],n,e[n])!==!1;n++);else for(n in e)if(t.call(e[n],n,e[n])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(fe,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(a(Object(e))?pe.merge(i,"string"==typeof e?[e]:e):se.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:re.call(t,e,i)},merge:function(e,t){for(var i=+t.length,a=0,n=e.length;i>a;a++)e[n++]=t[a];return e.length=n,e},grep:function(e,t,i){for(var a,n=[],o=0,s=e.length,r=!i;s>o;o++)a=!t(e[o],o),a!==r&&n.push(e[o]);return n},map:function(e,t,i){var n,o,s=0,r=[];if(a(e))for(n=e.length;n>s;s++)o=t(e[s],s,i),null!=o&&r.push(o);else for(s in e)o=t(e[s],s,i),null!=o&&r.push(o);return oe.apply([],r)},guid:1,proxy:function(e,t){var i,a,n;return"string"==typeof t&&(i=e[t],t=e,e=i),pe.isFunction(e)?(a=ne.call(arguments,2),n=function(){return e.apply(t||this,a.concat(ne.call(arguments)))},n.guid=e.guid=e.guid||pe.guid++,n):void 0},now:Date.now,support:ge}),"function"==typeof Symbol&&(pe.fn[Symbol.iterator]=te[Symbol.iterator]),pe.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){le["[object "+t+"]"]=t.toLowerCase()});var be=function(e){function t(e,t,i,a){var n,o,s,r,l,d,h,u=t&&t.ownerDocument,m=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return i;if(!a&&((t?t.ownerDocument||t:R)!==M&&O(t),t=t||M,k)){if(11!==m&&(l=ve.exec(e)))if(n=l[1]){if(9===m){if(!(s=t.getElementById(n)))return i;if(s.id===n)return i.push(s),i}else if(u&&(s=u.getElementById(n))&&B(t,s)&&s.id===n)return i.push(s),i}else{if(l[2])return K.apply(i,t.getElementsByTagName(e)),i;if((n=l[3])&&D.getElementsByClassName&&t.getElementsByClassName)return K.apply(i,t.getElementsByClassName(n)),i}if(D.qsa&&!Y[e+" "]&&(!A||!A.test(e))){if(1!==m)u=t,h=e;else if("object"!==t.nodeName.toLowerCase()){for((r=t.getAttribute("id"))?r=r.replace(xe,De):t.setAttribute("id",r=H),d=S(e),o=d.length;o--;)d[o]="#"+r+" "+g(d[o]);h=d.join(","),u=_e.test(e)&&c(t.parentNode)||t}if(h)try{return K.apply(i,u.querySelectorAll(h)),i}catch(p){}finally{r===H&&t.removeAttribute("id")}}}return T(e.replace(re,"$1"),t,i,a)}function i(){function e(i,a){return t.push(i+" ")>C.cacheLength&&delete e[t.shift()],e[i+" "]=a}var t=[];return e}function a(e){return e[H]=!0,e}function n(e){var t=M.createElement("fieldset");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),a=i.length;a--;)C.attrHandle[i[a]]=t}function s(e,t){var i=t&&e,a=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(a)return a;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function r(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function l(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function d(e){return function(t){return"form"in t?t.parentNode&&t.disabled===!1?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&we(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function h(e){return a(function(t){return t=+t,a(function(i,a){for(var n,o=e([],i.length,t),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(a[n]=i[n]))})})}function c(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function u(){}function g(e){for(var t=0,i=e.length,a="";i>t;t++)a+=e[t].value;return a}function m(e,t,i){var a=t.dir,n=t.next,o=n||a,s=i&&"parentNode"===o,r=W++;return t.first?function(t,i,n){for(;t=t[a];)if(1===t.nodeType||s)return e(t,i,n);return!1}:function(t,i,l){var d,h,c,u=[G,r];if(l){for(;t=t[a];)if((1===t.nodeType||s)&&e(t,i,l))return!0}else for(;t=t[a];)if(1===t.nodeType||s)if(c=t[H]||(t[H]={}),h=c[t.uniqueID]||(c[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[a]||t;else{if((d=h[o])&&d[0]===G&&d[1]===r)return u[2]=d[2];if(h[o]=u,u[2]=e(t,i,l))return!0}return!1}}function p(e){return e.length>1?function(t,i,a){for(var n=e.length;n--;)if(!e[n](t,i,a))return!1;return!0}:e[0]}function f(e,i,a){for(var n=0,o=i.length;o>n;n++)t(e,i[n],a);return a}function v(e,t,i,a,n){for(var o,s=[],r=0,l=e.length,d=null!=t;l>r;r++)(o=e[r])&&(i&&!i(o,a,n)||(s.push(o),d&&t.push(r)));return s}function _(e,t,i,n,o,s){return n&&!n[H]&&(n=_(n)),o&&!o[H]&&(o=_(o,s)),a(function(a,s,r,l){var d,h,c,u=[],g=[],m=s.length,p=a||f(t||"*",r.nodeType?[r]:r,[]),_=!e||!a&&t?p:v(p,u,e,r,l),y=i?o||(a?e:m||n)?[]:s:_;if(i&&i(_,y,r,l),n)for(d=v(y,g),n(d,[],r,l),h=d.length;h--;)(c=d[h])&&(y[g[h]]=!(_[g[h]]=c));if(a){if(o||e){if(o){for(d=[],h=y.length;h--;)(c=y[h])&&d.push(_[h]=c);o(null,y=[],d,l)}for(h=y.length;h--;)(c=y[h])&&(d=o?ee(a,c):u[h])>-1&&(a[d]=!(s[d]=c))}}else y=v(y===s?y.splice(m,y.length):y),o?o(null,s,y,l):K.apply(s,y)})}function y(e){for(var t,i,a,n=e.length,o=C.relative[e[0].type],s=o||C.relative[" "],r=o?1:0,l=m(function(e){return e===t},s,!0),d=m(function(e){return ee(t,e)>-1},s,!0),h=[function(e,i,a){var n=!o&&(a||i!==j)||((t=i).nodeType?l(e,i,a):d(e,i,a));return t=null,n}];n>r;r++)if(i=C.relative[e[r].type])h=[m(p(h),i)];else{if(i=C.filter[e[r].type].apply(null,e[r].matches),i[H]){for(a=++r;n>a&&!C.relative[e[a].type];a++);return _(r>1&&p(h),r>1&&g(e.slice(0,r-1).concat({value:" "===e[r-2].type?"*":""})).replace(re,"$1"),i,a>r&&y(e.slice(r,a)),n>a&&y(e=e.slice(a)),n>a&&g(e))}h.push(i)}return p(h)}function b(e,i){var n=i.length>0,o=e.length>0,s=function(a,s,r,l,d){var h,c,u,g=0,m="0",p=a&&[],f=[],_=j,y=a||o&&C.find.TAG("*",d),b=G+=null==_?1:Math.random()||.1,x=y.length;for(d&&(j=s===M||s||d);m!==x&&null!=(h=y[m]);m++){if(o&&h){for(c=0,s||h.ownerDocument===M||(O(h),r=!k);u=e[c++];)if(u(h,s||M,r)){l.push(h);break}d&&(G=b)}n&&((h=!u&&h)&&g--,a&&p.push(h))}if(g+=m,n&&m!==g){for(c=0;u=i[c++];)u(p,f,s,r);if(a){if(g>0)for(;m--;)p[m]||f[m]||(f[m]=Z.call(l));f=v(f)}K.apply(l,f),d&&!a&&f.length>0&&g+i.length>1&&t.uniqueSort(l)}return d&&(G=b,j=_),p};return n?a(s):s}var x,D,C,w,z,S,P,T,j,L,N,O,M,E,k,A,I,U,B,H="sizzle"+1*new Date,R=e.document,G=0,W=0,V=i(),X=i(),Y=i(),F=function(e,t){return e===t&&(N=!0),0},$={}.hasOwnProperty,q=[],Z=q.pop,Q=q.push,K=q.push,J=q.slice,ee=function(e,t){for(var i=0,a=e.length;a>i;i++)if(e[i]===t)return i;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ae="(?:\\\\.|[\\w-]|[^\x00-\\xa0])+",ne="\\["+ie+"*("+ae+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ae+"))|)"+ie+"*\\]",oe=":("+ae+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ne+")*)|.*)\\)|)",se=new RegExp(ie+"+","g"),re=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),le=new RegExp("^"+ie+"*,"+ie+"*"),de=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),he=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),ce=new RegExp(oe),ue=new RegExp("^"+ae+"$"),ge={ID:new RegExp("^#("+ae+")"),CLASS:new RegExp("^\\.("+ae+")"),TAG:new RegExp("^("+ae+"|[*])"),ATTR:new RegExp("^"+ne),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,pe=/^h\d$/i,fe=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_e=/[+~]/,ye=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),be=function(e,t,i){var a="0x"+t-65536;return a!==a||i?t:0>a?String.fromCharCode(a+65536):String.fromCharCode(a>>10|55296,1023&a|56320)},xe=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,De=function(e,t){return t?"\x00"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Ce=function(){O()},we=m(function(e){return e.disabled===!0&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{K.apply(q=J.call(R.childNodes),R.childNodes),q[R.childNodes.length].nodeType}catch(ze){K={apply:q.length?function(e,t){Q.apply(e,J.call(t))}:function(e,t){for(var i=e.length,a=0;e[i++]=t[a++];);e.length=i-1}}}D=t.support={},z=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},O=t.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:R;return a!==M&&9===a.nodeType&&a.documentElement?(M=a,E=M.documentElement,k=!z(M),R!==M&&(i=M.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Ce,!1):i.attachEvent&&i.attachEvent("onunload",Ce)),D.attributes=n(function(e){return e.className="i",!e.getAttribute("className")}),D.getElementsByTagName=n(function(e){return e.appendChild(M.createComment("")),!e.getElementsByTagName("*").length}),D.getElementsByClassName=fe.test(M.getElementsByClassName),D.getById=n(function(e){return E.appendChild(e).id=H,!M.getElementsByName||!M.getElementsByName(H).length}),D.getById?(C.filter.ID=function(e){var t=e.replace(ye,be);return function(e){return e.getAttribute("id")===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&k){var i=t.getElementById(e);return i?[i]:[]}}):(C.filter.ID=function(e){var t=e.replace(ye,be);return function(e){var i="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&k){var i,a,n,o=t.getElementById(e);if(o){if(i=o.getAttributeNode("id"),i&&i.value===e)return[o];for(n=t.getElementsByName(e),a=0;o=n[a++];)if(i=o.getAttributeNode("id"),i&&i.value===e)return[o]}return[]}}),C.find.TAG=D.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):D.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,a=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&a.push(i);return a}return o},C.find.CLASS=D.getElementsByClassName&&function(e,t){
return"undefined"!=typeof t.getElementsByClassName&&k?t.getElementsByClassName(e):void 0},I=[],A=[],(D.qsa=fe.test(M.querySelectorAll))&&(n(function(e){E.appendChild(e).innerHTML="<a id='"+H+"'></a><select id='"+H+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&A.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||A.push("\\["+ie+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+H+"-]").length||A.push("~="),e.querySelectorAll(":checked").length||A.push(":checked"),e.querySelectorAll("a#"+H+"+*").length||A.push(".#.+[+~]")}),n(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=M.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&A.push("name"+ie+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&A.push(":enabled",":disabled"),E.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&A.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),A.push(",.*:")})),(D.matchesSelector=fe.test(U=E.matches||E.webkitMatchesSelector||E.mozMatchesSelector||E.oMatchesSelector||E.msMatchesSelector))&&n(function(e){D.disconnectedMatch=U.call(e,"*"),U.call(e,"[s!='']:x"),I.push("!=",oe)}),A=A.length&&new RegExp(A.join("|")),I=I.length&&new RegExp(I.join("|")),t=fe.test(E.compareDocumentPosition),B=t||fe.test(E.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,a=t&&t.parentNode;return e===a||!(!a||1!==a.nodeType||!(i.contains?i.contains(a):e.compareDocumentPosition&&16&e.compareDocumentPosition(a)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},F=t?function(e,t){if(e===t)return N=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!D.sortDetached&&t.compareDocumentPosition(e)===i?e===M||e.ownerDocument===R&&B(R,e)?-1:t===M||t.ownerDocument===R&&B(R,t)?1:L?ee(L,e)-ee(L,t):0:4&i?-1:1)}:function(e,t){if(e===t)return N=!0,0;var i,a=0,n=e.parentNode,o=t.parentNode,r=[e],l=[t];if(!n||!o)return e===M?-1:t===M?1:n?-1:o?1:L?ee(L,e)-ee(L,t):0;if(n===o)return s(e,t);for(i=e;i=i.parentNode;)r.unshift(i);for(i=t;i=i.parentNode;)l.unshift(i);for(;r[a]===l[a];)a++;return a?s(r[a],l[a]):r[a]===R?-1:l[a]===R?1:0},M):M},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==M&&O(e),i=i.replace(he,"='$1']"),D.matchesSelector&&k&&!Y[i+" "]&&(!I||!I.test(i))&&(!A||!A.test(i)))try{var a=U.call(e,i);if(a||D.disconnectedMatch||e.document&&11!==e.document.nodeType)return a}catch(n){}return t(i,M,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==M&&O(e),B(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==M&&O(e);var i=C.attrHandle[t.toLowerCase()],a=i&&$.call(C.attrHandle,t.toLowerCase())?i(e,t,!k):void 0;return void 0!==a?a:D.attributes||!k?e.getAttribute(t):(a=e.getAttributeNode(t))&&a.specified?a.value:null},t.escape=function(e){return(e+"").replace(xe,De)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],a=0,n=0;if(N=!D.detectDuplicates,L=!D.sortStable&&e.slice(0),e.sort(F),N){for(;t=e[n++];)t===e[n]&&(a=i.push(n));for(;a--;)e.splice(i[a],1)}return L=null,e},w=t.getText=function(e){var t,i="",a=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=w(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[a++];)i+=w(t);return i},C=t.selectors={cacheLength:50,createPseudo:a,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ye,be),e[3]=(e[3]||e[4]||e[5]||"").replace(ye,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return ge.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ce.test(i)&&(t=S(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ye,be).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=V[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&V(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,a){return function(n){var o=t.attr(n,e);return null==o?"!="===i:!i||(o+="","="===i?o===a:"!="===i?o!==a:"^="===i?a&&0===o.indexOf(a):"*="===i?a&&o.indexOf(a)>-1:"$="===i?a&&o.slice(-a.length)===a:"~="===i?(" "+o.replace(se," ")+" ").indexOf(a)>-1:"|="===i&&(o===a||o.slice(0,a.length+1)===a+"-"))}},CHILD:function(e,t,i,a,n){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),r="of-type"===t;return 1===a&&0===n?function(e){return!!e.parentNode}:function(t,i,l){var d,h,c,u,g,m,p=o!==s?"nextSibling":"previousSibling",f=t.parentNode,v=r&&t.nodeName.toLowerCase(),_=!l&&!r,y=!1;if(f){if(o){for(;p;){for(u=t;u=u[p];)if(r?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;m=p="only"===e&&!m&&"nextSibling"}return!0}if(m=[s?f.firstChild:f.lastChild],s&&_){for(u=f,c=u[H]||(u[H]={}),h=c[u.uniqueID]||(c[u.uniqueID]={}),d=h[e]||[],g=d[0]===G&&d[1],y=g&&d[2],u=g&&f.childNodes[g];u=++g&&u&&u[p]||(y=g=0)||m.pop();)if(1===u.nodeType&&++y&&u===t){h[e]=[G,g,y];break}}else if(_&&(u=t,c=u[H]||(u[H]={}),h=c[u.uniqueID]||(c[u.uniqueID]={}),d=h[e]||[],g=d[0]===G&&d[1],y=g),y===!1)for(;(u=++g&&u&&u[p]||(y=g=0)||m.pop())&&((r?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++y||(_&&(c=u[H]||(u[H]={}),h=c[u.uniqueID]||(c[u.uniqueID]={}),h[e]=[G,y]),u!==t)););return y-=n,y===a||y%a===0&&y/a>=0}}},PSEUDO:function(e,i){var n,o=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[H]?o(i):o.length>1?(n=[e,e,"",i],C.setFilters.hasOwnProperty(e.toLowerCase())?a(function(e,t){for(var a,n=o(e,i),s=n.length;s--;)a=ee(e,n[s]),e[a]=!(t[a]=n[s])}):function(e){return o(e,0,n)}):o}},pseudos:{not:a(function(e){var t=[],i=[],n=P(e.replace(re,"$1"));return n[H]?a(function(e,t,i,a){for(var o,s=n(e,null,a,[]),r=e.length;r--;)(o=s[r])&&(e[r]=!(t[r]=o))}):function(e,a,o){return t[0]=e,n(t,null,o,i),t[0]=null,!i.pop()}}),has:a(function(e){return function(i){return t(e,i).length>0}}),contains:a(function(e){return e=e.replace(ye,be),function(t){return(t.textContent||t.innerText||w(t)).indexOf(e)>-1}}),lang:a(function(e){return ue.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ye,be).toLowerCase(),function(t){var i;do if(i=k?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===E},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:d(!1),disabled:d(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return pe.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:h(function(){return[0]}),last:h(function(e,t){return[t-1]}),eq:h(function(e,t,i){return[0>i?i+t:i]}),even:h(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:h(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:h(function(e,t,i){for(var a=0>i?i+t:i;--a>=0;)e.push(a);return e}),gt:h(function(e,t,i){for(var a=0>i?i+t:i;++a<t;)e.push(a);return e})}},C.pseudos.nth=C.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[x]=r(x);for(x in{submit:!0,reset:!0})C.pseudos[x]=l(x);return u.prototype=C.filters=C.pseudos,C.setFilters=new u,S=t.tokenize=function(e,i){var a,n,o,s,r,l,d,h=X[e+" "];if(h)return i?0:h.slice(0);for(r=e,l=[],d=C.preFilter;r;){a&&!(n=le.exec(r))||(n&&(r=r.slice(n[0].length)||r),l.push(o=[])),a=!1,(n=de.exec(r))&&(a=n.shift(),o.push({value:a,type:n[0].replace(re," ")}),r=r.slice(a.length));for(s in C.filter)!(n=ge[s].exec(r))||d[s]&&!(n=d[s](n))||(a=n.shift(),o.push({value:a,type:s,matches:n}),r=r.slice(a.length));if(!a)break}return i?r.length:r?t.error(e):X(e,l).slice(0)},P=t.compile=function(e,t){var i,a=[],n=[],o=Y[e+" "];if(!o){for(t||(t=S(e)),i=t.length;i--;)o=y(t[i]),o[H]?a.push(o):n.push(o);o=Y(e,b(n,a)),o.selector=e}return o},T=t.select=function(e,t,i,a){var n,o,s,r,l,d="function"==typeof e&&e,h=!a&&S(e=d.selector||e);if(i=i||[],1===h.length){if(o=h[0]=h[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&k&&C.relative[o[1].type]){if(t=(C.find.ID(s.matches[0].replace(ye,be),t)||[])[0],!t)return i;d&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(n=ge.needsContext.test(e)?0:o.length;n--&&(s=o[n],!C.relative[r=s.type]);)if((l=C.find[r])&&(a=l(s.matches[0].replace(ye,be),_e.test(o[0].type)&&c(t.parentNode)||t))){if(o.splice(n,1),e=a.length&&g(o),!e)return K.apply(i,a),i;break}}return(d||P(e,h))(a,t,!k,i,!t||_e.test(e)&&c(t.parentNode)||t),i},D.sortStable=H.split("").sort(F).join("")===H,D.detectDuplicates=!!N,O(),D.sortDetached=n(function(e){return 1&e.compareDocumentPosition(M.createElement("fieldset"))}),n(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),D.attributes&&n(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),n(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,i){var a;return i?void 0:e[t]===!0?t.toLowerCase():(a=e.getAttributeNode(t))&&a.specified?a.value:null}),t}(e);pe.find=be,pe.expr=be.selectors,pe.expr[":"]=pe.expr.pseudos,pe.uniqueSort=pe.unique=be.uniqueSort,pe.text=be.getText,pe.isXMLDoc=be.isXML,pe.contains=be.contains,pe.escapeSelector=be.escape;var xe=function(e,t,i){for(var a=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&pe(e).is(i))break;a.push(e)}return a},De=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},Ce=pe.expr.match.needsContext,we=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,ze=/^.[^:#\[\.,]*$/;pe.filter=function(e,t,i){var a=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===a.nodeType?pe.find.matchesSelector(a,e)?[a]:[]:pe.find.matches(e,pe.grep(t,function(e){return 1===e.nodeType}))},pe.fn.extend({find:function(e){var t,i,a=this.length,n=this;if("string"!=typeof e)return this.pushStack(pe(e).filter(function(){for(t=0;a>t;t++)if(pe.contains(n[t],this))return!0}));for(i=this.pushStack([]),t=0;a>t;t++)pe.find(e,n[t],i);return a>1?pe.uniqueSort(i):i},filter:function(e){return this.pushStack(o(this,e||[],!1))},not:function(e){return this.pushStack(o(this,e||[],!0))},is:function(e){return!!o(this,"string"==typeof e&&Ce.test(e)?pe(e):e||[],!1).length}});var Se,Pe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Te=pe.fn.init=function(e,t,i){var a,n;if(!e)return this;if(i=i||Se,"string"==typeof e){if(a="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Pe.exec(e),!a||!a[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(a[1]){if(t=t instanceof pe?t[0]:t,pe.merge(this,pe.parseHTML(a[1],t&&t.nodeType?t.ownerDocument||t:ie,!0)),we.test(a[1])&&pe.isPlainObject(t))for(a in t)pe.isFunction(this[a])?this[a](t[a]):this.attr(a,t[a]);return this}return n=ie.getElementById(a[2]),n&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):pe.isFunction(e)?void 0!==i.ready?i.ready(e):e(pe):pe.makeArray(e,this)};Te.prototype=pe.fn,Se=pe(ie);var je=/^(?:parents|prev(?:Until|All))/,Le={children:!0,contents:!0,next:!0,prev:!0};pe.fn.extend({has:function(e){var t=pe(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(pe.contains(this,t[e]))return!0})},closest:function(e,t){var i,a=0,n=this.length,o=[],s="string"!=typeof e&&pe(e);if(!Ce.test(e))for(;n>a;a++)for(i=this[a];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&pe.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?pe.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?re.call(pe(e),this[0]):re.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(pe.uniqueSort(pe.merge(this.get(),pe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),pe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return xe(e,"parentNode")},parentsUntil:function(e,t,i){return xe(e,"parentNode",i)},next:function(e){return s(e,"nextSibling")},prev:function(e){return s(e,"previousSibling")},nextAll:function(e){return xe(e,"nextSibling")},prevAll:function(e){return xe(e,"previousSibling")},nextUntil:function(e,t,i){return xe(e,"nextSibling",i)},prevUntil:function(e,t,i){return xe(e,"previousSibling",i)},siblings:function(e){return De((e.parentNode||{}).firstChild,e)},children:function(e){return De(e.firstChild)},contents:function(e){return n(e,"iframe")?e.contentDocument:(n(e,"template")&&(e=e.content||e),pe.merge([],e.childNodes))}},function(e,t){pe.fn[e]=function(i,a){var n=pe.map(this,t,i);return"Until"!==e.slice(-5)&&(a=i),a&&"string"==typeof a&&(n=pe.filter(a,n)),this.length>1&&(Le[e]||pe.uniqueSort(n),je.test(e)&&n.reverse()),this.pushStack(n)}});var Ne=/[^\x20\t\r\n\f]+/g;pe.Callbacks=function(e){e="string"==typeof e?r(e):pe.extend({},e);var t,i,a,n,o=[],s=[],l=-1,d=function(){for(n=n||e.once,a=t=!0;s.length;l=-1)for(i=s.shift();++l<o.length;)o[l].apply(i[0],i[1])===!1&&e.stopOnFalse&&(l=o.length,i=!1);e.memory||(i=!1),t=!1,n&&(o=i?[]:"")},h={add:function(){return o&&(i&&!t&&(l=o.length-1,s.push(i)),function a(t){pe.each(t,function(t,i){pe.isFunction(i)?e.unique&&h.has(i)||o.push(i):i&&i.length&&"string"!==pe.type(i)&&a(i)})}(arguments),i&&!t&&d()),this},remove:function(){return pe.each(arguments,function(e,t){for(var i;(i=pe.inArray(t,o,i))>-1;)o.splice(i,1),l>=i&&l--}),this},has:function(e){return e?pe.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=s=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=s=[],i||t||(o=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=i||[],i=[e,i.slice?i.slice():i],s.push(i),t||d()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!a}};return h},pe.extend({Deferred:function(t){var i=[["notify","progress",pe.Callbacks("memory"),pe.Callbacks("memory"),2],["resolve","done",pe.Callbacks("once memory"),pe.Callbacks("once memory"),0,"resolved"],["reject","fail",pe.Callbacks("once memory"),pe.Callbacks("once memory"),1,"rejected"]],a="pending",n={state:function(){return a},always:function(){return o.done(arguments).fail(arguments),this},"catch":function(e){return n.then(null,e)},pipe:function(){var e=arguments;return pe.Deferred(function(t){pe.each(i,function(i,a){var n=pe.isFunction(e[a[4]])&&e[a[4]];o[a[1]](function(){var e=n&&n.apply(this,arguments);e&&pe.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[a[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(t,a,n){function o(t,i,a,n){return function(){var r=this,h=arguments,c=function(){var e,c;if(!(s>t)){if(e=a.apply(r,h),e===i.promise())throw new TypeError("Thenable self-resolution");c=e&&("object"==typeof e||"function"==typeof e)&&e.then,pe.isFunction(c)?n?c.call(e,o(s,i,l,n),o(s,i,d,n)):(s++,c.call(e,o(s,i,l,n),o(s,i,d,n),o(s,i,l,i.notifyWith))):(a!==l&&(r=void 0,h=[e]),(n||i.resolveWith)(r,h))}},u=n?c:function(){try{c()}catch(e){pe.Deferred.exceptionHook&&pe.Deferred.exceptionHook(e,u.stackTrace),t+1>=s&&(a!==d&&(r=void 0,h=[e]),i.rejectWith(r,h))}};t?u():(pe.Deferred.getStackHook&&(u.stackTrace=pe.Deferred.getStackHook()),e.setTimeout(u))}}var s=0;return pe.Deferred(function(e){i[0][3].add(o(0,e,pe.isFunction(n)?n:l,e.notifyWith)),i[1][3].add(o(0,e,pe.isFunction(t)?t:l)),i[2][3].add(o(0,e,pe.isFunction(a)?a:d))}).promise()},promise:function(e){return null!=e?pe.extend(e,n):n}},o={};return pe.each(i,function(e,t){var s=t[2],r=t[5];n[t[1]]=s.add,r&&s.add(function(){a=r},i[3-e][2].disable,i[0][2].lock),s.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=s.fireWith}),n.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,i=t,a=Array(i),n=ne.call(arguments),o=pe.Deferred(),s=function(e){return function(i){a[e]=this,n[e]=arguments.length>1?ne.call(arguments):i,--t||o.resolveWith(a,n)}};if(1>=t&&(h(e,o.done(s(i)).resolve,o.reject,!t),"pending"===o.state()||pe.isFunction(n[i]&&n[i].then)))return o.then();for(;i--;)h(n[i],s(i),o.reject);return o.promise()}});var Oe=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;pe.Deferred.exceptionHook=function(t,i){e.console&&e.console.warn&&t&&Oe.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,i)},pe.readyException=function(t){e.setTimeout(function(){throw t})};var Me=pe.Deferred();pe.fn.ready=function(e){return Me.then(e)["catch"](function(e){pe.readyException(e)}),this},pe.extend({isReady:!1,readyWait:1,ready:function(e){(e===!0?--pe.readyWait:pe.isReady)||(pe.isReady=!0,e!==!0&&--pe.readyWait>0||Me.resolveWith(ie,[pe]))}}),pe.ready.then=Me.then,"complete"===ie.readyState||"loading"!==ie.readyState&&!ie.documentElement.doScroll?e.setTimeout(pe.ready):(ie.addEventListener("DOMContentLoaded",c),e.addEventListener("load",c));var Ee=function(e,t,i,a,n,o,s){var r=0,l=e.length,d=null==i;if("object"===pe.type(i)){n=!0;for(r in i)Ee(e,t,r,i[r],!0,o,s)}else if(void 0!==a&&(n=!0,pe.isFunction(a)||(s=!0),d&&(s?(t.call(e,a),t=null):(d=t,t=function(e,t,i){return d.call(pe(e),i)})),t))for(;l>r;r++)t(e[r],i,s?a:a.call(e[r],r,t(e[r],i)));return n?e:d?t.call(e):l?t(e[0],i):o},ke=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};u.uid=1,u.prototype={cache:function(e){var t=e[this.expando];return t||(t={},ke(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var a,n=this.cache(e);if("string"==typeof t)n[pe.camelCase(t)]=i;else for(a in t)n[pe.camelCase(a)]=t[a];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][pe.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,a=e[this.expando];if(void 0!==a){if(void 0!==t){Array.isArray(t)?t=t.map(pe.camelCase):(t=pe.camelCase(t),t=t in a?[t]:t.match(Ne)||[]),i=t.length;for(;i--;)delete a[t[i]]}(void 0===t||pe.isEmptyObject(a))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!pe.isEmptyObject(t)}};var Ae=new u,Ie=new u,Ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Be=/[A-Z]/g;pe.extend({hasData:function(e){return Ie.hasData(e)||Ae.hasData(e)},data:function(e,t,i){return Ie.access(e,t,i)},removeData:function(e,t){Ie.remove(e,t)},_data:function(e,t,i){return Ae.access(e,t,i)},_removeData:function(e,t){Ae.remove(e,t)}}),pe.fn.extend({data:function(e,t){var i,a,n,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(n=Ie.get(o),1===o.nodeType&&!Ae.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(a=s[i].name,0===a.indexOf("data-")&&(a=pe.camelCase(a.slice(5)),m(o,a,n[a])));Ae.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){Ie.set(this,e)}):Ee(this,function(t){var i;if(o&&void 0===t){if(i=Ie.get(o,e),void 0!==i)return i;if(i=m(o,e),void 0!==i)return i}else this.each(function(){Ie.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Ie.remove(this,e)})}}),pe.extend({queue:function(e,t,i){var a;return e?(t=(t||"fx")+"queue",a=Ae.get(e,t),i&&(!a||Array.isArray(i)?a=Ae.access(e,t,pe.makeArray(i)):a.push(i)),a||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=pe.queue(e,t),a=i.length,n=i.shift(),o=pe._queueHooks(e,t),s=function(){pe.dequeue(e,t)};"inprogress"===n&&(n=i.shift(),a--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,s,o)),!a&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return Ae.get(e,i)||Ae.access(e,i,{empty:pe.Callbacks("once memory").add(function(){Ae.remove(e,[t+"queue",i])})})}}),pe.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?pe.queue(this[0],e):void 0===t?this:this.each(function(){var i=pe.queue(this,e,t);pe._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&pe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){pe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,a=1,n=pe.Deferred(),o=this,s=this.length,r=function(){--a||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)i=Ae.get(o[s],e+"queueHooks"),i&&i.empty&&(a++,i.empty.add(r));return r(),n.promise(t)}});var He=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Re=new RegExp("^(?:([+-])=|)("+He+")([a-z%]*)$","i"),Ge=["Top","Right","Bottom","Left"],We=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&pe.contains(e.ownerDocument,e)&&"none"===pe.css(e,"display")},Ve=function(e,t,i,a){var n,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];n=i.apply(e,a||[]);for(o in t)e.style[o]=s[o];return n},Xe={};pe.fn.extend({show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){We(this)?pe(this).show():pe(this).hide()})}});var Ye=/^(?:checkbox|radio)$/i,Fe=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,$e=/^$|\/(?:java|ecma)script/i,qe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};qe.optgroup=qe.option,qe.tbody=qe.tfoot=qe.colgroup=qe.caption=qe.thead,qe.th=qe.td;var Ze=/<|&#?\w+;/;!function(){var e=ie.createDocumentFragment(),t=e.appendChild(ie.createElement("div")),i=ie.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),ge.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",ge.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Qe=ie.documentElement,Ke=/^key/,Je=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,et=/^([^.]*)(?:\.(.+)|)/;pe.event={global:{},add:function(e,t,i,a,n){var o,s,r,l,d,h,c,u,g,m,p,f=Ae.get(e);if(f)for(i.handler&&(o=i,i=o.handler,n=o.selector),n&&pe.find.matchesSelector(Qe,n),i.guid||(i.guid=pe.guid++),(l=f.events)||(l=f.events={}),(s=f.handle)||(s=f.handle=function(t){return"undefined"!=typeof pe&&pe.event.triggered!==t.type?pe.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Ne)||[""],d=t.length;d--;)r=et.exec(t[d])||[],g=p=r[1],m=(r[2]||"").split(".").sort(),g&&(c=pe.event.special[g]||{},g=(n?c.delegateType:c.bindType)||g,c=pe.event.special[g]||{},h=pe.extend({type:g,origType:p,data:a,handler:i,guid:i.guid,selector:n,needsContext:n&&pe.expr.match.needsContext.test(n),namespace:m.join(".")},o),(u=l[g])||(u=l[g]=[],u.delegateCount=0,c.setup&&c.setup.call(e,a,m,s)!==!1||e.addEventListener&&e.addEventListener(g,s)),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),n?u.splice(u.delegateCount++,0,h):u.push(h),pe.event.global[g]=!0)},remove:function(e,t,i,a,n){var o,s,r,l,d,h,c,u,g,m,p,f=Ae.hasData(e)&&Ae.get(e);if(f&&(l=f.events)){for(t=(t||"").match(Ne)||[""],d=t.length;d--;)if(r=et.exec(t[d])||[],g=p=r[1],m=(r[2]||"").split(".").sort(),g){for(c=pe.event.special[g]||{},g=(a?c.delegateType:c.bindType)||g,u=l[g]||[],r=r[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=u.length;o--;)h=u[o],!n&&p!==h.origType||i&&i.guid!==h.guid||r&&!r.test(h.namespace)||a&&a!==h.selector&&("**"!==a||!h.selector)||(u.splice(o,1),h.selector&&u.delegateCount--,c.remove&&c.remove.call(e,h));s&&!u.length&&(c.teardown&&c.teardown.call(e,m,f.handle)!==!1||pe.removeEvent(e,g,f.handle),delete l[g])}else for(g in l)pe.event.remove(e,g+t[d],i,a,!0);pe.isEmptyObject(l)&&Ae.remove(e,"handle events")}},dispatch:function(e){var t,i,a,n,o,s,r=pe.event.fix(e),l=new Array(arguments.length),d=(Ae.get(this,"events")||{})[r.type]||[],h=pe.event.special[r.type]||{};for(l[0]=r,t=1;t<arguments.length;t++)l[t]=arguments[t];if(r.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,r)!==!1){for(s=pe.event.handlers.call(this,r,d),t=0;(n=s[t++])&&!r.isPropagationStopped();)for(r.currentTarget=n.elem,i=0;(o=n.handlers[i++])&&!r.isImmediatePropagationStopped();)r.rnamespace&&!r.rnamespace.test(o.namespace)||(r.handleObj=o,r.data=o.data,a=((pe.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,l),void 0!==a&&(r.result=a)===!1&&(r.preventDefault(),r.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,r),r.result}},handlers:function(e,t){var i,a,n,o,s,r=[],l=t.delegateCount,d=e.target;if(l&&d.nodeType&&!("click"===e.type&&e.button>=1))for(;d!==this;d=d.parentNode||this)if(1===d.nodeType&&("click"!==e.type||d.disabled!==!0)){for(o=[],s={},i=0;l>i;i++)a=t[i],n=a.selector+" ",void 0===s[n]&&(s[n]=a.needsContext?pe(n,this).index(d)>-1:pe.find(n,this,null,[d]).length),s[n]&&o.push(a);o.length&&r.push({elem:d,handlers:o})}return d=this,l<t.length&&r.push({elem:d,handlers:t.slice(l)}),r},addProp:function(e,t){Object.defineProperty(pe.Event.prototype,e,{enumerable:!0,configurable:!0,get:pe.isFunction(t)?function(){return this.originalEvent?t(this.originalEvent):void 0}:function(){return this.originalEvent?this.originalEvent[e]:void 0},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[pe.expando]?e:new pe.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==C()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===C()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n(this,"input")?(this.click(),!1):void 0},_default:function(e){return n(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},pe.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},pe.Event=function(e,t){return this instanceof pe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?x:D,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&pe.extend(this,t),this.timeStamp=e&&e.timeStamp||pe.now(),void(this[pe.expando]=!0)):new pe.Event(e,t)},pe.Event.prototype={constructor:pe.Event,isDefaultPrevented:D,isPropagationStopped:D,isImmediatePropagationStopped:D,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=x,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=x,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=x,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},pe.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Ke.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Je.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},pe.event.addProp),pe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){pe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,a=this,n=e.relatedTarget,o=e.handleObj;return n&&(n===a||pe.contains(a,n))||(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),pe.fn.extend({on:function(e,t,i,a){return w(this,e,t,i,a)},one:function(e,t,i,a){return w(this,e,t,i,a,1)},off:function(e,t,i){var a,n;if(e&&e.preventDefault&&e.handleObj)return a=e.handleObj,pe(e.delegateTarget).off(a.namespace?a.origType+"."+a.namespace:a.origType,a.selector,a.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return t!==!1&&"function"!=typeof t||(i=t,t=void 0),i===!1&&(i=D),this.each(function(){pe.event.remove(this,e,i,t)})}});var tt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,it=/<script|<style|<link/i,at=/checked\s*(?:[^=]|=\s*.checked.)/i,nt=/^true\/(.*)/,ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;pe.extend({htmlPrefilter:function(e){return e.replace(tt,"<$1></$2>")},clone:function(e,t,i){var a,n,o,s,r=e.cloneNode(!0),l=pe.contains(e.ownerDocument,e);if(!(ge.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||pe.isXMLDoc(e)))for(s=_(r),o=_(e),a=0,n=o.length;n>a;a++)j(o[a],s[a]);if(t)if(i)for(o=o||_(e),s=s||_(r),a=0,n=o.length;n>a;a++)T(o[a],s[a]);else T(e,r);return s=_(r,"script"),s.length>0&&y(s,!l&&_(e,"script")),r},cleanData:function(e){for(var t,i,a,n=pe.event.special,o=0;void 0!==(i=e[o]);o++)if(ke(i)){if(t=i[Ae.expando]){if(t.events)for(a in t.events)n[a]?pe.event.remove(i,a):pe.removeEvent(i,a,t.handle);i[Ae.expando]=void 0}i[Ie.expando]&&(i[Ie.expando]=void 0)}}}),pe.fn.extend({detach:function(e){return N(this,e,!0)},remove:function(e){return N(this,e)},text:function(e){return Ee(this,function(e){return void 0===e?pe.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return L(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=z(this,e);t.appendChild(e)}})},prepend:function(){return L(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=z(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return L(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return L(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(pe.cleanData(_(e,!1)),e.textContent="");return this},clone:function(e,t){
return e=null!=e&&e,t=null==t?e:t,this.map(function(){return pe.clone(this,e,t)})},html:function(e){return Ee(this,function(e){var t=this[0]||{},i=0,a=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!it.test(e)&&!qe[(Fe.exec(e)||["",""])[1].toLowerCase()]){e=pe.htmlPrefilter(e);try{for(;a>i;i++)t=this[i]||{},1===t.nodeType&&(pe.cleanData(_(t,!1)),t.innerHTML=e);t=0}catch(n){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return L(this,arguments,function(t){var i=this.parentNode;pe.inArray(this,e)<0&&(pe.cleanData(_(this)),i&&i.replaceChild(t,this))},e)}}),pe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){pe.fn[e]=function(e){for(var i,a=[],n=pe(e),o=n.length-1,s=0;o>=s;s++)i=s===o?this:this.clone(!0),pe(n[s])[t](i),se.apply(a,i.get());return this.pushStack(a)}});var st=/^margin/,rt=new RegExp("^("+He+")(?!px)[a-z%]+$","i"),lt=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)};!function(){function t(){if(r){r.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",r.innerHTML="",Qe.appendChild(s);var t=e.getComputedStyle(r);i="1%"!==t.top,o="2px"===t.marginLeft,a="4px"===t.width,r.style.marginRight="50%",n="4px"===t.marginRight,Qe.removeChild(s),r=null}}var i,a,n,o,s=ie.createElement("div"),r=ie.createElement("div");r.style&&(r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",ge.clearCloneStyle="content-box"===r.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(r),pe.extend(ge,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return t(),a},pixelMarginRight:function(){return t(),n},reliableMarginLeft:function(){return t(),o}}))}();var dt=/^(none|table(?!-c[ea]).+)/,ht=/^--/,ct={position:"absolute",visibility:"hidden",display:"block"},ut={letterSpacing:"0",fontWeight:"400"},gt=["Webkit","Moz","ms"],mt=ie.createElement("div").style;pe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=O(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,i,a){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,s,r=pe.camelCase(t),l=ht.test(t),d=e.style;return l||(t=k(r)),s=pe.cssHooks[t]||pe.cssHooks[r],void 0===i?s&&"get"in s&&void 0!==(n=s.get(e,!1,a))?n:d[t]:(o=typeof i,"string"===o&&(n=Re.exec(i))&&n[1]&&(i=p(e,t,n),o="number"),void(null!=i&&i===i&&("number"===o&&(i+=n&&n[3]||(pe.cssNumber[r]?"":"px")),ge.clearCloneStyle||""!==i||0!==t.indexOf("background")||(d[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,a))||(l?d.setProperty(t,i):d[t]=i))))}},css:function(e,t,i,a){var n,o,s,r=pe.camelCase(t),l=ht.test(t);return l||(t=k(r)),s=pe.cssHooks[t]||pe.cssHooks[r],s&&"get"in s&&(n=s.get(e,!0,i)),void 0===n&&(n=O(e,t,a)),"normal"===n&&t in ut&&(n=ut[t]),""===i||i?(o=parseFloat(n),i===!0||isFinite(o)?o||0:n):n}}),pe.each(["height","width"],function(e,t){pe.cssHooks[t]={get:function(e,i,a){return i?!dt.test(pe.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?U(e,t,a):Ve(e,ct,function(){return U(e,t,a)}):void 0},set:function(e,i,a){var n,o=a&&lt(e),s=a&&I(e,t,a,"border-box"===pe.css(e,"boxSizing",!1,o),o);return s&&(n=Re.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=pe.css(e,t)),A(e,i,s)}}}),pe.cssHooks.marginLeft=M(ge.reliableMarginLeft,function(e,t){return t?(parseFloat(O(e,"marginLeft"))||e.getBoundingClientRect().left-Ve(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px":void 0}),pe.each({margin:"",padding:"",border:"Width"},function(e,t){pe.cssHooks[e+t]={expand:function(i){for(var a=0,n={},o="string"==typeof i?i.split(" "):[i];4>a;a++)n[e+Ge[a]+t]=o[a]||o[a-2]||o[0];return n}},st.test(e)||(pe.cssHooks[e+t].set=A)}),pe.fn.extend({css:function(e,t){return Ee(this,function(e,t,i){var a,n,o={},s=0;if(Array.isArray(t)){for(a=lt(e),n=t.length;n>s;s++)o[t[s]]=pe.css(e,t[s],!1,a);return o}return void 0!==i?pe.style(e,t,i):pe.css(e,t)},e,t,arguments.length>1)}}),pe.Tween=B,B.prototype={constructor:B,init:function(e,t,i,a,n,o){this.elem=e,this.prop=i,this.easing=n||pe.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=a,this.unit=o||(pe.cssNumber[i]?"":"px")},cur:function(){var e=B.propHooks[this.prop];return e&&e.get?e.get(this):B.propHooks._default.get(this)},run:function(e){var t,i=B.propHooks[this.prop];return this.options.duration?this.pos=t=pe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):B.propHooks._default.set(this),this}},B.prototype.init.prototype=B.prototype,B.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=pe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){pe.fx.step[e.prop]?pe.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[pe.cssProps[e.prop]]&&!pe.cssHooks[e.prop]?e.elem[e.prop]=e.now:pe.style(e.elem,e.prop,e.now+e.unit)}}},B.propHooks.scrollTop=B.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},pe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},pe.fx=B.prototype.init,pe.fx.step={};var pt,ft,vt=/^(?:toggle|show|hide)$/,_t=/queueHooks$/;pe.Animation=pe.extend(Y,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return p(i.elem,e,Re.exec(t),i),i}]},tweener:function(e,t){pe.isFunction(e)?(t=e,e=["*"]):e=e.match(Ne);for(var i,a=0,n=e.length;n>a;a++)i=e[a],Y.tweeners[i]=Y.tweeners[i]||[],Y.tweeners[i].unshift(t)},prefilters:[V],prefilter:function(e,t){t?Y.prefilters.unshift(e):Y.prefilters.push(e)}}),pe.speed=function(e,t,i){var a=e&&"object"==typeof e?pe.extend({},e):{complete:i||!i&&t||pe.isFunction(e)&&e,duration:e,easing:i&&t||t&&!pe.isFunction(t)&&t};return pe.fx.off?a.duration=0:"number"!=typeof a.duration&&(a.duration in pe.fx.speeds?a.duration=pe.fx.speeds[a.duration]:a.duration=pe.fx.speeds._default),null!=a.queue&&a.queue!==!0||(a.queue="fx"),a.old=a.complete,a.complete=function(){pe.isFunction(a.old)&&a.old.call(this),a.queue&&pe.dequeue(this,a.queue)},a},pe.fn.extend({fadeTo:function(e,t,i,a){return this.filter(We).css("opacity",0).show().end().animate({opacity:t},e,i,a)},animate:function(e,t,i,a){var n=pe.isEmptyObject(e),o=pe.speed(t,i,a),s=function(){var t=Y(this,pe.extend({},e),o);(n||Ae.get(this,"finish"))&&t.stop(!0)};return s.finish=s,n||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,i){var a=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=pe.timers,s=Ae.get(this);if(n)s[n]&&s[n].stop&&a(s[n]);else for(n in s)s[n]&&s[n].stop&&_t.test(n)&&a(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));!t&&i||pe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=Ae.get(this),a=i[e+"queue"],n=i[e+"queueHooks"],o=pe.timers,s=a?a.length:0;for(i.finish=!0,pe.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)a[t]&&a[t].finish&&a[t].finish.call(this);delete i.finish})}}),pe.each(["toggle","show","hide"],function(e,t){var i=pe.fn[t];pe.fn[t]=function(e,a,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(G(t,!0),e,a,n)}}),pe.each({slideDown:G("show"),slideUp:G("hide"),slideToggle:G("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){pe.fn[e]=function(e,i,a){return this.animate(t,e,i,a)}}),pe.timers=[],pe.fx.tick=function(){var e,t=0,i=pe.timers;for(pt=pe.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||pe.fx.stop(),pt=void 0},pe.fx.timer=function(e){pe.timers.push(e),pe.fx.start()},pe.fx.interval=13,pe.fx.start=function(){ft||(ft=!0,H())},pe.fx.stop=function(){ft=null},pe.fx.speeds={slow:600,fast:200,_default:400},pe.fn.delay=function(t,i){return t=pe.fx?pe.fx.speeds[t]||t:t,i=i||"fx",this.queue(i,function(i,a){var n=e.setTimeout(i,t);a.stop=function(){e.clearTimeout(n)}})},function(){var e=ie.createElement("input"),t=ie.createElement("select"),i=t.appendChild(ie.createElement("option"));e.type="checkbox",ge.checkOn=""!==e.value,ge.optSelected=i.selected,e=ie.createElement("input"),e.value="t",e.type="radio",ge.radioValue="t"===e.value}();var yt,bt=pe.expr.attrHandle;pe.fn.extend({attr:function(e,t){return Ee(this,pe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){pe.removeAttr(this,e)})}}),pe.extend({attr:function(e,t,i){var a,n,o=e.nodeType;return 3!==o&&8!==o&&2!==o?"undefined"==typeof e.getAttribute?pe.prop(e,t,i):(1===o&&pe.isXMLDoc(e)||(n=pe.attrHooks[t.toLowerCase()]||(pe.expr.match.bool.test(t)?yt:void 0)),void 0!==i?null===i?void pe.removeAttr(e,t):n&&"set"in n&&void 0!==(a=n.set(e,i,t))?a:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(a=n.get(e,t))?a:(a=pe.find.attr(e,t),null==a?void 0:a)):void 0},attrHooks:{type:{set:function(e,t){if(!ge.radioValue&&"radio"===t&&n(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,a=0,n=t&&t.match(Ne);if(n&&1===e.nodeType)for(;i=n[a++];)e.removeAttribute(i)}}),yt={set:function(e,t,i){return t===!1?pe.removeAttr(e,i):e.setAttribute(i,i),i}},pe.each(pe.expr.match.bool.source.match(/\w+/g),function(e,t){var i=bt[t]||pe.find.attr;bt[t]=function(e,t,a){var n,o,s=t.toLowerCase();return a||(o=bt[s],bt[s]=n,n=null!=i(e,t,a)?s:null,bt[s]=o),n}});var xt=/^(?:input|select|textarea|button)$/i,Dt=/^(?:a|area)$/i;pe.fn.extend({prop:function(e,t){return Ee(this,pe.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[pe.propFix[e]||e]})}}),pe.extend({prop:function(e,t,i){var a,n,o=e.nodeType;return 3!==o&&8!==o&&2!==o?(1===o&&pe.isXMLDoc(e)||(t=pe.propFix[t]||t,n=pe.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(a=n.set(e,i,t))?a:e[t]=i:n&&"get"in n&&null!==(a=n.get(e,t))?a:e[t]):void 0},propHooks:{tabIndex:{get:function(e){var t=pe.find.attr(e,"tabindex");return t?parseInt(t,10):xt.test(e.nodeName)||Dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),ge.optSelected||(pe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),pe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){pe.propFix[this.toLowerCase()]=this}),pe.fn.extend({addClass:function(e){var t,i,a,n,o,s,r,l=0;if(pe.isFunction(e))return this.each(function(t){pe(this).addClass(e.call(this,t,$(this)))});if("string"==typeof e&&e)for(t=e.match(Ne)||[];i=this[l++];)if(n=$(i),a=1===i.nodeType&&" "+F(n)+" "){for(s=0;o=t[s++];)a.indexOf(" "+o+" ")<0&&(a+=o+" ");r=F(a),n!==r&&i.setAttribute("class",r)}return this},removeClass:function(e){var t,i,a,n,o,s,r,l=0;if(pe.isFunction(e))return this.each(function(t){pe(this).removeClass(e.call(this,t,$(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Ne)||[];i=this[l++];)if(n=$(i),a=1===i.nodeType&&" "+F(n)+" "){for(s=0;o=t[s++];)for(;a.indexOf(" "+o+" ")>-1;)a=a.replace(" "+o+" "," ");r=F(a),n!==r&&i.setAttribute("class",r)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):pe.isFunction(e)?this.each(function(i){pe(this).toggleClass(e.call(this,i,$(this),t),t)}):this.each(function(){var t,a,n,o;if("string"===i)for(a=0,n=pe(this),o=e.match(Ne)||[];t=o[a++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==e&&"boolean"!==i||(t=$(this),t&&Ae.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Ae.get(this,"__className__")||""))})},hasClass:function(e){var t,i,a=0;for(t=" "+e+" ";i=this[a++];)if(1===i.nodeType&&(" "+F($(i))+" ").indexOf(t)>-1)return!0;return!1}});var Ct=/\r/g;pe.fn.extend({val:function(e){var t,i,a,n=this[0];return arguments.length?(a=pe.isFunction(e),this.each(function(i){var n;1===this.nodeType&&(n=a?e.call(this,i,pe(this).val()):e,null==n?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=pe.map(n,function(e){return null==e?"":e+""})),t=pe.valHooks[this.type]||pe.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))})):n?(t=pe.valHooks[n.type]||pe.valHooks[n.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(Ct,""):null==i?"":i)):void 0}}),pe.extend({valHooks:{option:{get:function(e){var t=pe.find.attr(e,"value");return null!=t?t:F(pe.text(e))}},select:{get:function(e){var t,i,a,o=e.options,s=e.selectedIndex,r="select-one"===e.type,l=r?null:[],d=r?s+1:o.length;for(a=0>s?d:r?s:0;d>a;a++)if(i=o[a],(i.selected||a===s)&&!i.disabled&&(!i.parentNode.disabled||!n(i.parentNode,"optgroup"))){if(t=pe(i).val(),r)return t;l.push(t)}return l},set:function(e,t){for(var i,a,n=e.options,o=pe.makeArray(t),s=n.length;s--;)a=n[s],(a.selected=pe.inArray(pe.valHooks.option.get(a),o)>-1)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),pe.each(["radio","checkbox"],function(){pe.valHooks[this]={set:function(e,t){return Array.isArray(t)?e.checked=pe.inArray(pe(e).val(),t)>-1:void 0}},ge.checkOn||(pe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var wt=/^(?:focusinfocus|focusoutblur)$/;pe.extend(pe.event,{trigger:function(t,i,a,n){var o,s,r,l,d,h,c,u=[a||ie],g=he.call(t,"type")?t.type:t,m=he.call(t,"namespace")?t.namespace.split("."):[];if(s=r=a=a||ie,3!==a.nodeType&&8!==a.nodeType&&!wt.test(g+pe.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),d=g.indexOf(":")<0&&"on"+g,t=t[pe.expando]?t:new pe.Event(g,"object"==typeof t&&t),t.isTrigger=n?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=a),i=null==i?[t]:pe.makeArray(i,[t]),c=pe.event.special[g]||{},n||!c.trigger||c.trigger.apply(a,i)!==!1)){if(!n&&!c.noBubble&&!pe.isWindow(a)){for(l=c.delegateType||g,wt.test(l+g)||(s=s.parentNode);s;s=s.parentNode)u.push(s),r=s;r===(a.ownerDocument||ie)&&u.push(r.defaultView||r.parentWindow||e)}for(o=0;(s=u[o++])&&!t.isPropagationStopped();)t.type=o>1?l:c.bindType||g,h=(Ae.get(s,"events")||{})[t.type]&&Ae.get(s,"handle"),h&&h.apply(s,i),h=d&&s[d],h&&h.apply&&ke(s)&&(t.result=h.apply(s,i),t.result===!1&&t.preventDefault());return t.type=g,n||t.isDefaultPrevented()||c._default&&c._default.apply(u.pop(),i)!==!1||!ke(a)||d&&pe.isFunction(a[g])&&!pe.isWindow(a)&&(r=a[d],r&&(a[d]=null),pe.event.triggered=g,a[g](),pe.event.triggered=void 0,r&&(a[d]=r)),t.result}},simulate:function(e,t,i){var a=pe.extend(new pe.Event,i,{type:e,isSimulated:!0});pe.event.trigger(a,null,t)}}),pe.fn.extend({trigger:function(e,t){return this.each(function(){pe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?pe.event.trigger(e,t,i,!0):void 0}}),pe.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){pe.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),pe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ge.focusin="onfocusin"in e,ge.focusin||pe.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){pe.event.simulate(t,e.target,pe.event.fix(e))};pe.event.special[t]={setup:function(){var a=this.ownerDocument||this,n=Ae.access(a,t);n||a.addEventListener(e,i,!0),Ae.access(a,t,(n||0)+1)},teardown:function(){var a=this.ownerDocument||this,n=Ae.access(a,t)-1;n?Ae.access(a,t,n):(a.removeEventListener(e,i,!0),Ae.remove(a,t))}}});var zt=e.location,St=pe.now(),Pt=/\?/;pe.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(a){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||pe.error("Invalid XML: "+t),i};var Tt=/\[\]$/,jt=/\r?\n/g,Lt=/^(?:submit|button|image|reset|file)$/i,Nt=/^(?:input|select|textarea|keygen)/i;pe.param=function(e,t){var i,a=[],n=function(e,t){var i=pe.isFunction(t)?t():t;a[a.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(e)||e.jquery&&!pe.isPlainObject(e))pe.each(e,function(){n(this.name,this.value)});else for(i in e)q(i,e[i],t,n);return a.join("&")},pe.fn.extend({serialize:function(){return pe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=pe.prop(this,"elements");return e?pe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!pe(this).is(":disabled")&&Nt.test(this.nodeName)&&!Lt.test(e)&&(this.checked||!Ye.test(e))}).map(function(e,t){var i=pe(this).val();return null==i?null:Array.isArray(i)?pe.map(i,function(e){return{name:t.name,value:e.replace(jt,"\r\n")}}):{name:t.name,value:i.replace(jt,"\r\n")}}).get()}});var Ot=/%20/g,Mt=/#.*$/,Et=/([?&])_=[^&]*/,kt=/^(.*?):[ \t]*([^\r\n]*)$/gm,At=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,It=/^(?:GET|HEAD)$/,Ut=/^\/\//,Bt={},Ht={},Rt="*/".concat("*"),Gt=ie.createElement("a");Gt.href=zt.href,pe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zt.href,type:"GET",isLocal:At.test(zt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":pe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?K(K(e,pe.ajaxSettings),t):K(pe.ajaxSettings,e)},ajaxPrefilter:Z(Bt),ajaxTransport:Z(Ht),ajax:function(t,i){function a(t,i,a,r){var d,u,g,b,x,D=i;h||(h=!0,l&&e.clearTimeout(l),n=void 0,s=r||"",C.readyState=t>0?4:0,d=t>=200&&300>t||304===t,a&&(b=J(m,C,a)),b=ee(m,b,C,d),d?(m.ifModified&&(x=C.getResponseHeader("Last-Modified"),x&&(pe.lastModified[o]=x),x=C.getResponseHeader("etag"),x&&(pe.etag[o]=x)),204===t||"HEAD"===m.type?D="nocontent":304===t?D="notmodified":(D=b.state,u=b.data,g=b.error,d=!g)):(g=D,!t&&D||(D="error",0>t&&(t=0))),C.status=t,C.statusText=(i||D)+"",d?v.resolveWith(p,[u,D,C]):v.rejectWith(p,[C,D,g]),C.statusCode(y),y=void 0,c&&f.trigger(d?"ajaxSuccess":"ajaxError",[C,m,d?u:g]),_.fireWith(p,[C,D]),c&&(f.trigger("ajaxComplete",[C,m]),--pe.active||pe.event.trigger("ajaxStop")))}"object"==typeof t&&(i=t,t=void 0),i=i||{};var n,o,s,r,l,d,h,c,u,g,m=pe.ajaxSetup({},i),p=m.context||m,f=m.context&&(p.nodeType||p.jquery)?pe(p):pe.event,v=pe.Deferred(),_=pe.Callbacks("once memory"),y=m.statusCode||{},b={},x={},D="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(h){if(!r)for(r={};t=kt.exec(s);)r[t[1].toLowerCase()]=t[2];t=r[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return h?s:null},setRequestHeader:function(e,t){return null==h&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==h&&(m.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)C.always(e[C.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||D;return n&&n.abort(t),a(0,t),this}};if(v.promise(C),m.url=((t||m.url||zt.href)+"").replace(Ut,zt.protocol+"//"),m.type=i.method||i.type||m.method||m.type,m.dataTypes=(m.dataType||"*").toLowerCase().match(Ne)||[""],null==m.crossDomain){d=ie.createElement("a");try{d.href=m.url,d.href=d.href,m.crossDomain=Gt.protocol+"//"+Gt.host!=d.protocol+"//"+d.host}catch(w){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=pe.param(m.data,m.traditional)),Q(Bt,m,i,C),h)return C;c=pe.event&&m.global,c&&0===pe.active++&&pe.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!It.test(m.type),o=m.url.replace(Mt,""),m.hasContent?m.data&&m.processData&&0===(m.contentType||"").indexOf("application/x-www-form-urlencoded")&&(m.data=m.data.replace(Ot,"+")):(g=m.url.slice(o.length),m.data&&(o+=(Pt.test(o)?"&":"?")+m.data,delete m.data),m.cache===!1&&(o=o.replace(Et,"$1"),g=(Pt.test(o)?"&":"?")+"_="+St++ +g),m.url=o+g),m.ifModified&&(pe.lastModified[o]&&C.setRequestHeader("If-Modified-Since",pe.lastModified[o]),pe.etag[o]&&C.setRequestHeader("If-None-Match",pe.etag[o])),(m.data&&m.hasContent&&m.contentType!==!1||i.contentType)&&C.setRequestHeader("Content-Type",m.contentType),C.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Rt+"; q=0.01":""):m.accepts["*"]);for(u in m.headers)C.setRequestHeader(u,m.headers[u]);if(m.beforeSend&&(m.beforeSend.call(p,C,m)===!1||h))return C.abort();if(D="abort",_.add(m.complete),C.done(m.success),C.fail(m.error),n=Q(Ht,m,i,C)){if(C.readyState=1,c&&f.trigger("ajaxSend",[C,m]),h)return C;m.async&&m.timeout>0&&(l=e.setTimeout(function(){C.abort("timeout")},m.timeout));try{h=!1,n.send(b,a)}catch(w){if(h)throw w;a(-1,w)}}else a(-1,"No Transport");return C},getJSON:function(e,t,i){return pe.get(e,t,i,"json")},getScript:function(e,t){return pe.get(e,void 0,t,"script")}}),pe.each(["get","post"],function(e,t){pe[t]=function(e,i,a,n){return pe.isFunction(i)&&(n=n||a,a=i,i=void 0),pe.ajax(pe.extend({url:e,type:t,dataType:n,data:i,success:a},pe.isPlainObject(e)&&e))}}),pe._evalUrl=function(e){return pe.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},pe.fn.extend({wrapAll:function(e){var t;return this[0]&&(pe.isFunction(e)&&(e=e.call(this[0])),t=pe(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return pe.isFunction(e)?this.each(function(t){pe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=pe(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=pe.isFunction(e);return this.each(function(i){pe(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){pe(this).replaceWith(this.childNodes)}),this}}),pe.expr.pseudos.hidden=function(e){return!pe.expr.pseudos.visible(e)},pe.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},pe.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var Wt={0:200,1223:204},Vt=pe.ajaxSettings.xhr();ge.cors=!!Vt&&"withCredentials"in Vt,ge.ajax=Vt=!!Vt,pe.ajaxTransport(function(t){var i,a;return ge.cors||Vt&&!t.crossDomain?{send:function(n,o){var s,r=t.xhr();if(r.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)r[s]=t.xhrFields[s];t.mimeType&&r.overrideMimeType&&r.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)r.setRequestHeader(s,n[s]);i=function(e){return function(){i&&(i=a=r.onload=r.onerror=r.onabort=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?o(0,"error"):o(r.status,r.statusText):o(Wt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=i(),a=r.onerror=i("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&e.setTimeout(function(){i&&a()})},i=i("abort");try{r.send(t.hasContent&&t.data||null)}catch(l){if(i)throw l}},abort:function(){i&&i()}}:void 0}),pe.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),pe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return pe.globalEval(e),e}}}),pe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),pe.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(a,n){t=pe("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),ie.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Xt=[],Yt=/(=)\?(?=&|$)|\?\?/;pe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||pe.expando+"_"+St++;return this[e]=!0,e}}),pe.ajaxPrefilter("json jsonp",function(t,i,a){var n,o,s,r=t.jsonp!==!1&&(Yt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yt.test(t.data)&&"data");return r||"jsonp"===t.dataTypes[0]?(n=t.jsonpCallback=pe.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,r?t[r]=t[r].replace(Yt,"$1"+n):t.jsonp!==!1&&(t.url+=(Pt.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||pe.error(n+" was not called"),s[0]},t.dataTypes[0]="json",o=e[n],e[n]=function(){s=arguments},a.always(function(){void 0===o?pe(e).removeProp(n):e[n]=o,t[n]&&(t.jsonpCallback=i.jsonpCallback,Xt.push(n)),s&&pe.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),ge.createHTMLDocument=function(){var e=ie.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),pe.parseHTML=function(e,t,i){if("string"!=typeof e)return[];"boolean"==typeof t&&(i=t,t=!1);var a,n,o;return t||(ge.createHTMLDocument?(t=ie.implementation.createHTMLDocument(""),a=t.createElement("base"),a.href=ie.location.href,t.head.appendChild(a)):t=ie),n=we.exec(e),o=!i&&[],n?[t.createElement(n[1])]:(n=b([e],t,o),o&&o.length&&pe(o).remove(),pe.merge([],n.childNodes))},pe.fn.load=function(e,t,i){var a,n,o,s=this,r=e.indexOf(" ");return r>-1&&(a=F(e.slice(r)),e=e.slice(0,r)),pe.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),s.length>0&&pe.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){o=arguments,s.html(a?pe("<div>").append(pe.parseHTML(e)).find(a):e)}).always(i&&function(e,t){s.each(function(){i.apply(this,o||[e.responseText,t,e])})}),this},pe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){pe.fn[t]=function(e){return this.on(t,e)}}),pe.expr.pseudos.animated=function(e){return pe.grep(pe.timers,function(t){return e===t.elem}).length},pe.offset={setOffset:function(e,t,i){var a,n,o,s,r,l,d,h=pe.css(e,"position"),c=pe(e),u={};"static"===h&&(e.style.position="relative"),r=c.offset(),o=pe.css(e,"top"),l=pe.css(e,"left"),d=("absolute"===h||"fixed"===h)&&(o+l).indexOf("auto")>-1,d?(a=c.position(),s=a.top,n=a.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),pe.isFunction(t)&&(t=t.call(e,i,pe.extend({},r))),null!=t.top&&(u.top=t.top-r.top+s),null!=t.left&&(u.left=t.left-r.left+n),"using"in t?t.using.call(e,u):c.css(u)}},pe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){pe.offset.setOffset(this,e,t)});var t,i,a,n,o=this[0];return o?o.getClientRects().length?(a=o.getBoundingClientRect(),t=o.ownerDocument,i=t.documentElement,n=t.defaultView,{top:a.top+n.pageYOffset-i.clientTop,left:a.left+n.pageXOffset-i.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i=this[0],a={top:0,left:0};return"fixed"===pe.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n(e[0],"html")||(a=e.offset()),a={top:a.top+pe.css(e[0],"borderTopWidth",!0),left:a.left+pe.css(e[0],"borderLeftWidth",!0)}),{top:t.top-a.top-pe.css(i,"marginTop",!0),left:t.left-a.left-pe.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===pe.css(e,"position");)e=e.offsetParent;return e||Qe})}}),pe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;pe.fn[e]=function(a){return Ee(this,function(e,a,n){var o;return pe.isWindow(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===n?o?o[t]:e[a]:void(o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):e[a]=n)},e,a,arguments.length)}}),pe.each(["top","left"],function(e,t){pe.cssHooks[t]=M(ge.pixelPosition,function(e,i){return i?(i=O(e,t),rt.test(i)?pe(e).position()[t]+"px":i):void 0})}),pe.each({Height:"height",Width:"width"},function(e,t){pe.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,a){pe.fn[a]=function(n,o){var s=arguments.length&&(i||"boolean"!=typeof n),r=i||(n===!0||o===!0?"margin":"border");return Ee(this,function(t,i,n){var o;return pe.isWindow(t)?0===a.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===n?pe.css(t,i,r):pe.style(t,i,n,r)},t,s?n:void 0,s)}})}),pe.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,a){return this.on(t,e,i,a)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),pe.holdReady=function(e){e?pe.readyWait++:pe.ready(!0)},pe.isArray=Array.isArray,pe.parseJSON=JSON.parse,pe.nodeName=n,"function"==typeof define&&define.amd&&define("jquery",[],function(){return pe});var Ft=e.jQuery,$t=e.$;return pe.noConflict=function(t){return e.$===pe&&(e.$=$t),t&&e.jQuery===pe&&(e.jQuery=Ft),pe},t||(e.jQuery=e.$=pe),pe});var jQuery="undefined"!=typeof jQuery?jQuery:window.$,$=jQuery,Syncfusion=window.ej=window.Syncfusion=window.Syncfusion||{},ej=Syncfusion;!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e()}(function(){window.ej=window.Syncfusion=window.Syncfusion||{},function(e,t,i){"use strict";var a,n,o,s;t.version="16.1.0.24",t.consts={NamespaceJoin:"-"},t.TextAlign={Center:"center",Justify:"justify",Left:"left",Right:"right"},t.Orientation={Horizontal:"horizontal",Vertical:"vertical"},t.serverTimezoneOffset=0,t.persistStateVersion=null,t.locales=t.locales||[],Object.prototype.hasOwnProperty||(Object.prototype.hasOwnProperty=function(e,t){return e[t]!==i}),Date.prototype.toISOString||function(){function e(e){var t=String(e);return 1===t.length&&(t="0"+t),t}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}(),String.format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t++)e=e.replace(new RegExp("\\{"+t+"\\}","gm"),arguments[t+1]);return e.replace(/\{[0-9]\}/g,"")},jQuery.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},t.defineClass=function(e,a,n,o){if(!e||!n)return i;for(var s=e.split("."),r=window,l=0;l<s.length-1;l++)t.isNullOrUndefined(r[s[l]])&&(r[s[l]]={}),
r=r[s[l]];return(o||t.isNullOrUndefined(r[s[l]]))&&(a="function"==typeof a?a:function(){},r[s[l]]=a,r[s[l]].prototype=n),r[s[l]]},t.util={getNameSpace:function(e){var i=e.toLowerCase().split(".");return"ej"===i[0]&&(i[0]="e"),i.join(t.consts.NamespaceJoin)},getObject:function(e,a){var n,o,s;if(!a||!e)return i;for("string"!=typeof e&&(e=JSON.stringify(e)),n=a,o=e.split("."),s=0;s<o.length&&!t.util.isNullOrUndefined(n);s++)n=n[o[s]];return n},createObject:function(e,i,a){for(var n,o=e.split("."),s=a||window,r=s,l=o.length,d=0;l>d;d++)n=o[d],d+1==l?r[n]=i:t.isNullOrUndefined(r[n])&&(r[n]={}),r=r[n];return s},isNullOrUndefined:function(e){return e===i||null===e},exportAll:function(i,a){var n,o,s,r,l,d,h,c,u=[],g=[],m={action:i,method:"post","data-ajax":"false"},p=t.buildTag("form","",null,m);if(0!=a.length){for(h=0;h<a.length;h++)o=h,s=e("#"+a[h]),r=e("#"+a[h]).data(),n=r.ejWidgets,l=e(s).data(n[0]),g.push({id:l._id,locale:l.model.locale}),t.isNullOrUndefined(l)||(d=l._getExportModel(l.model),u.push({name:n[0],type:"hidden",value:l.stringify(d)}),c=t.buildTag("input","",null,u[o]),p.append(c));e("body").append(p),p.submit(),setTimeout(function(){var i,a,o;if(g.length)for(o=0;o<g.length;o++)t.isNullOrUndefined(g[o].locale)||(i=e("#"+g[o].id).data(),n=i.ejWidgets,a=e("#"+g[o].id).data(n[0]),a.model.locale=g[o].locale)},0),p.remove()}return!0},print:function(i,a){var a,n,o,s=t.buildTag("div"),r=i.clone();s.append(r),a||(a=window.open("","print","height=452,width=1024,tabbar=no")),a.document.write("<!DOCTYPE html>"),n=e("head").find("link").add("style"),"msie"===t.browserInfo().name?(o="",n.each(function(t,i){"LINK"==i.tagName&&e(i).attr("href",i.href),o+=i.outerHTML}),a.document.write("<html><head></head><body>"+o+s[0].innerHTML+"</body></html>")):(o="",a.document.write("<html><head>"),n.each(function(t,i){"LINK"==i.tagName&&e(i).attr("href",i.href),o+=i.outerHTML}),a.document.writeln(o+"</head><body>"),a.document.writeln(s[0].innerHTML+"</body></html>")),a.document.close(),a.focus(),setTimeout(function(){t.isNullOrUndefined(a.window)||(a.print(),setTimeout(function(){a.close()},1e3))},1e3)},ieClearRemover:function(t){var i=e(t).height();t.style.paddingTop=parseFloat(i/2)+"px",t.style.paddingBottom=parseFloat(i/2)+"px",t.style.height="1px",t.style.lineHeight="1px"},sendAjaxRequest:function(t){e.ajax({type:t.type,cache:t.cache,url:t.url,dataType:t.dataType,data:t.data,contentType:t.contentType,async:t.async,success:t.successHandler,error:t.errorHandler,beforeSend:t.beforeSendHandler,complete:t.completeHandler})},buildTag:function(t,a,n,o){var s,r=/^[a-z]*[0-9a-z]+/gi.exec(t)[0],l=/#([_a-z]+[-_0-9a-z]+)/gi.exec(t);return l=l?l[l.length-1]:i,s=/\.([a-z]+[-_0-9a-z ]+)/gi.exec(t),s=s?s[s.length-1]:i,e(document.createElement(r)).attr(l?{id:l}:{}).addClass(s||"").css(n||{}).attr(o||{}).html(a||"")},_preventDefaultException:function(e,t){if(e)for(var i in t)if(t[i].test(e[i]))return!0;return!1},getMaxZindex:function(){var t=1;return t=Math.max.apply(null,e.map(e("body *"),function(t){return"absolute"==e(t).css("position")||"fixed"==e(t).css("position")?parseInt(e(t).css("z-index"))||1:void 0})),(t==i||null==t)&&(t=1),t},blockDefaultActions:function(e){e.cancelBubble=!0,e.returnValue=!1,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},getDimension:function(t,i){var a,n,o,s=e(t).parents().andSelf().filter(":hidden");return s&&(n={visibility:"hidden",display:"block"},o=[],s.each(function(){var e={};for(var t in n)e[t]=this.style[t],this.style[t]=n[t];o.push(e)}),a=/(outer)/g.test(i)?e(t)[i](!0):e(t)[i](),s.each(function(e){var t=o[e];for(var i in n)this.style[i]=t[i]})),a},transitionEndEvent:function(){return{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[t.userAgent()]},animationEndEvent:function(){return{"":"animationend",webkit:"webkitAnimationEnd",Moz:"animationend",O:"webkitAnimationEnd",ms:"animationend"}[t.userAgent()]},startEvent:function(){return t.isTouchDevice()||e.support.hasPointer?"touchstart":"mousedown"},endEvent:function(){return t.isTouchDevice()||e.support.hasPointer?"touchend":"mouseup"},moveEvent:function(){return t.isTouchDevice()||e.support.hasPointer?e.support.hasPointer&&!t.isMobile()?"ejtouchmove":"touchmove":"mousemove"},cancelEvent:function(){return t.isTouchDevice()||e.support.hasPointer?"touchcancel":"mousecancel"},tapEvent:function(){return t.isTouchDevice()||e.support.hasPointer?"tap":"click"},tapHoldEvent:function(){return t.isTouchDevice()||e.support.hasPointer?"taphold":"click"},isDevice:function(){return t.getBooleanVal(e("head"),"data-ej-forceset",!1)?t.getBooleanVal(e("head"),"data-ej-device",this._device()):this._device()},isPortrait:function(){var e=document.documentElement;return e&&e.clientWidth/e.clientHeight<1.1},isLowerResolution:function(){return window.innerWidth<=640&&t.isPortrait()&&t.isDevice()||window.innerWidth<=800&&!t.isDevice()||window.innerWidth<=800&&!t.isPortrait()&&t.isWindows()&&t.isDevice()||t.isMobile()},isIOSWebView:function(){return/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)},isAndroidWebView:function(){return!("undefined"==typeof Android)},isWindowsWebView:function(){return-1!=location.href.indexOf("x-wmapp")},_device:function(){return/Android|BlackBerry|iPhone|iPad|iPod|IEMobile|kindle|windows\sce|palm|smartphone|iemobile|mobile|pad|xoom|sch-i800|playbook/i.test(navigator.userAgent.toLowerCase())},isMobile:function(){return/iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(navigator.userAgent.toLowerCase())&&/mobile/i.test(navigator.userAgent.toLowerCase())||t.getBooleanVal(e("head"),"data-ej-mobile",!1)===!0},isTablet:function(){return/ipad|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase())||t.getBooleanVal(e("head"),"data-ej-tablet",!1)===!0||!t.isMobile()&&t.isDevice()},isTouchDevice:function(){return("ontouchstart"in window||window.navigator.msPointerEnabled&&t.isMobile())&&this.isDevice()},getClearString:function(t){return e.trim(t.replace(/\s+/g," ").replace(/(\r\n|\n|\r)/gm,"").replace(new RegExp(">[\n	 ]+<","g"),"><"))},getBooleanVal:function(t,i,a){var n=e(t).attr(i);return null!=n?"true"==n.toLowerCase():a},_getSkewClass:function(e,t,i){var a=e.width(),n=e.height(),o=e.offset().left,s=e.offset().left+a,r=e.offset().top,l=e.offset().top+n,d=.3*a,h=.3*n;return o+d>t&&r+h>i?"e-m-skew-topleft":t>s-d&&r+h>i?"e-m-skew-topright":t>s-d&&i>l-h?"e-m-skew-bottomright":o+d>t&&i>l-h?"e-m-skew-bottomleft":t>o+d&&r+h>i&&s-d>t?"e-m-skew-top":o+d>t?"e-m-skew-left":t>s-d?"e-m-skew-right":i>l-h?"e-m-skew-bottom":"e-m-skew-center"},_removeSkewClass:function(t){e(t).removeClass("e-m-skew-top e-m-skew-bottom e-m-skew-left e-m-skew-right e-m-skew-topleft e-m-skew-topright e-m-skew-bottomleft e-m-skew-bottomright e-m-skew-center e-skew-top e-skew-bottom e-skew-left e-skew-right e-skew-topleft e-skew-topright e-skew-bottomleft e-skew-bottomright e-skew-center")},_getObjectKeys:function(e){var t,i=[];if(e=Object.prototype.toString.call(e)===Object.prototype.toString()?e:{},!Object.keys){for(t in e)e.hasOwnProperty(t)&&i.push(t);return i}return Object.keys?Object.keys(e):void 0},_touchStartPoints:function(e,t){if(e){var i=e.touches?e.touches[0]:e;t._distX=0,t._distY=0,t._moved=!1,t._pointX=i.pageX,t._pointY=i.pageY}},_isTouchMoved:function(e,t){if(e){var i,a,n=e.touches?e.touches[0]:e,o=n.pageX-t._pointX,s=n.pageY-t._pointY;Date.now();return t._pointX=n.pageX,t._pointY=n.pageY,t._distX+=o,t._distY+=s,i=Math.abs(t._distX),a=Math.abs(t._distY),!(5>i&&5>a)}},listenEvents:function(e,i,a,n,o,s){for(var r=0;r<e.length;r++)t.listenTouchEvent(e[r],i[r],a[r],n,o,s)},listenTouchEvent:function(i,a,n,o,s,r){for(var l,d=o?"removeEventListener":"addEventListener",h=o?"off":"on",c=e(i),u=0;u<c.length;u++)switch(l=c[u],a){case"touchstart":t._bindEvent(l,d,a,n,"mousedown","MSPointerDown","pointerdown",r);break;case"touchmove":t._bindEvent(l,d,a,n,"mousemove","MSPointerMove","pointermove",r);break;case"touchend":t._bindEvent(l,d,a,n,"mouseup","MSPointerUp","pointerup",r);break;case"touchcancel":t._bindEvent(l,d,a,n,"mousecancel","MSPointerCancel","pointercancel",r);break;case"tap":case"taphold":case"ejtouchmove":case"click":e(l)[h](a,n);break;default:"msie"==t.browserInfo().name&&t.browserInfo().version<9?s._on(e(l),a,n):l[d](a,n,!0)}},_bindEvent:function(t,i,a,n,o,s,r){e.support.hasPointer?t[i](window.navigator.pointerEnabled?r:s,n,!0):t[i](a,n,!0)},_browser:function(){return/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":""},styles:document.createElement("div").style,userAgent:function(){for(var e,i="webkitT,t,MozT,msT,OT".split(","),a=0,n=i.length;n>a;a++)if(e=i[a]+"ransform",e in t.styles)return i[a].substr(0,i[a].length-1);return!1},addPrefix:function(e){return""===t.userAgent()?e:(e=e.charAt(0).toUpperCase()+e.substr(1),t.userAgent()+e)},destroyWidgets:function(t){var i=e(t).find("[data-role *= ejm]");i.each(function(t,i){var a=e(i),n=a.data("ejWidgets");n&&a[n]("destroy")})},getAttrVal:function(t,i,a){var n=e(t).attr(i);return null!=n?n:a},getOffset:function(t){var i,a={},n=t.offset()||{left:0,top:0};return e.extend(!0,a,n),"static"!=e("body").css("position")&&(i=e("body").offset(),a.left-=i.left,a.top-=i.top),a},getZindexPartial:function(i,a){var n,o,s;return!t.isNullOrUndefined(i)&&i.length>0?(n=i.parents(),o=e("body").children(),!t.isNullOrUndefined(i)&&i.length>0&&o.splice(o.index(a),1),e(o).each(function(e,t){n.push(t)}),s=Math.max.apply(s,e.map(n,function(t){return"static"!=e(t).css("position")?parseInt(e(t).css("z-index"))||1:void 0})),!s||1e4>s?s=1e4:s+=1,s):void 0},isValidAttr:function(t,i){var a,t=e(t)[0];return"undefined"!=typeof t[i]?!0:(a=!1,e.each(t,function(e){return e.toLowerCase()==i.toLowerCase()?(a=!0,!1):void 0}),a)}},e.extend(t,t.util),t.widgetBase={droppables:{"default":[]},resizables:{"default":[]},_renderEjTemplate:function(i,a,n,o,s){var r=null;if(("object"==typeof i||i.startsWith("#")||i.startsWith("."))&&(r=e(i).attr("type")),r){if(r=r.toLowerCase(),t.template[r])return t.template[r](this,i,a,n,o)}else if(!t.isNullOrUndefined(s))return t.template["text/x-"+s](this,i,a,n,o);return t.template.render(this,i,a,n,o)},destroy:function(){var i,a,n,o;if(!this._trigger("destroy")){this.model.enablePersistence&&(this.persistState(),e(window).off("unload",this._persistHandler));try{this._destroy()}catch(s){}for(i=this.element.data("ejWidgets")||[],o=0;o<i.length;o++)i[o]==this.pluginName&&i.splice(o,1);for(i.length||this.element.removeData("ejWidgets");this._events&&(a=this._events.pop(),n=[],a);){for(o=0;o<a[1].length;o++)e.isPlainObject(a[1][o])||n.push(a[1][o]);e.fn.off.apply(a[0],n)}this._events=null,this.element.removeClass(t.util.getNameSpace(this.sfType)).removeClass("e-js").removeData(this.pluginName),this.element=null,this.model=null}},_on:function(i){this._events||(this._events=[]);for(var a=[].splice.call(arguments,1,arguments.length-1),n={},o=a.length;n&&"function"!=typeof n;)n=a[--o];return a[o]=t.proxy(a[o],this),this._events.push([i,a,n,a[o]]),e.fn.on.apply(i,a),this},_off:function(t,i,a,n){var o,s,r,l,d,h=this._events;if(!h||!h.length)return this;for("function"==typeof a&&(o=n,n=a,a=o),s=i.match(/\S+/g)||[""],r=0;r<h.length;r++)if(l=h[r],d=l[0].length&&(!n||l[2]===n)&&(l[1][0]===i||s[0])&&(!a||l[1][1]===a)&&e.inArray(t[0],l[0])>-1){e.fn.off.apply(t,n?[i,a,l[3]]:[i,a]),h.splice(r,1);break}return this},_trigger:function(i,a){var n,o,s,r,l=null,d={};return e.extend(d,a),i in this.model&&(l=this.model[i]),l&&("string"==typeof l&&(l=t.util.getObject(l,window)),e.isFunction(l)&&(o=t.event(i,this.model,a),s=this.model._applyScope,n=l.call(this,o),s&&s.call(),a&&e.extend(a,o),o.cancel||!t.isNullOrUndefined(n)))?n===!1||o.cancel:(r=Boolean(a),a=a||{},a.originalEventType=i,a.type=this.pluginName+i,o=e.Event(a.type,t.event(a.type,this.model,a)),this.element&&this.element.trigger(o),r&&e.extend(a,o),t.isOnWebForms&&0==o.cancel&&this.model.serverEvents&&this.model.serverEvents.length&&t.raiseWebFormsServerEvents(i,a,d),o.cancel)},setModel:function(t,i){var n,o,s,r;if(!this._trigger("modelChange",{changes:t})){for(n in t){if(!i){if(this.model[n]===t[n]){delete t[n];continue}if(e.isPlainObject(t[n])&&(a(this.model[n],t[n]),e.isEmptyObject(t[n]))){delete t[n];continue}}if(this.dataTypes&&(o=this._isValidModelValue(n,this.dataTypes,t),o!==!0))throw"setModel - Invalid input for property :"+n+" - "+o;this.model.notifyOnEachPropertyChanges&&this.model[n]!==t[n]&&(s={oldValue:this.model[n],newValue:t[n]},t[n]=this._trigger(n+"Change",s)?this.model[n]:s.newValue)}e.isEmptyObject(t)||(this._setFirst?(r=t.dataSource,r&&delete t.dataSource,e.extend(!0,this.model,t),r&&(this.model.dataSource=r instanceof Array?r.slice():r,t.dataSource=this.model.dataSource),this._setModel&&this._setModel(t)):this._setModel&&this._setModel(t)===!1||e.extend(!0,this.model,t),"enablePersistence"in t&&this._setState(t.enablePersistence))}},option:function(a,n,o){if(!a)return this.model;if(e.isPlainObject(a))return this.setModel(a,o);if("string"==typeof a){a=a.replace(/^model\./,"");var s=t.getObject(a,this.model);if(n===i&&!o)return s;if("enablePersistence"===a)return this._setState(n);if(o&&n===t.extensions.modelGUID)return this._setModel(t.createObject(a,t.getObject(a,this.model),{}));if(o||t.getObject(a,this.model)!==n)return this.setModel(t.createObject(a,n,{}),o)}return i},_isValidModelValue:function(e,t,i){var a,n,o,s=t[e],r=i[e];if(!s)return!0;if("string"==typeof s){if("enum"==s&&(i[e]=r?r.toString().toLowerCase():r,s="string"),"array"===s){if("[object Array]"===Object.prototype.toString.call(r))return!0}else if("data"===s||"parent"===s||typeof r===s)return!0;return"Expected type - "+s}if(r instanceof Array){for(n=0;n<r.length;n++)if(a=this._isValidModelValue(e,t,r[n]),a!==!0)return" ["+n+"] - "+a;return!0}for(o in r)if(a=this._isValidModelValue(o,s,r),a!==!0)return o+" : "+a;return!0},_returnFn:function(e,t){-1!=t.indexOf(".")?this._returnFn(e[t.split(".")[0]],t.split(".").slice(1).join(".")):e[t]=e[t].call(e.propName)},_removeCircularRef:function(e){function t(e,a,n){if("object"==typeof e){if(Array.prototype.indexOf||(Array.prototype.indexOf=function(e){return jQuery.inArray(e,this)}),i.indexOf(e)>=0)return void delete n[a];i.push(e);for(var o in e)e.hasOwnProperty(o)&&t(e[o],o,e);return void i.pop()}}var i=[];return t(e,"obj",null),e},stringify:function(e,i){for(var a,n=this.observables,o=0;o<n.length;o++)a=t.getObject(n[o],e),t.isNullOrUndefined(a)||"function"!=typeof a||this._returnFn(e,n[o]);return i&&(e=this._removeCircularRef(e)),JSON.stringify(e)},_setState:function(i){i===!0?(this._persistHandler=t.proxy(this.persistState,this),e(window).on("unload",this._persistHandler)):(this.deleteState(),e(window).off("unload",this._persistHandler))},_removeProp:function(e,i){t.isNullOrUndefined(e)||(-1!=i.indexOf(".")?this._removeProp(e[i.split(".")[0]],i.split(".").slice(1).join(".")):delete e[i])},persistState:function(){var e,i;if(this._ignoreOnPersist){for(e=r({},this.model),i=0;i<this._ignoreOnPersist.length;i++)this._removeProp(e,this._ignoreOnPersist[i]);e.ignoreOnPersist=this._ignoreOnPersist}else if(this._addToPersist){for(e={},i=0;i<this._addToPersist.length;i++)t.createObject(this._addToPersist[i],t.getObject(this._addToPersist[i],this.model),e);e.addToPersist=this._addToPersist}else e=r({},this.model);this._persistState&&(e.customPersists={},this._persistState(e.customPersists)),window.localStorage?(t.isNullOrUndefined(t.persistStateVersion)||null!=window.localStorage.getItem("persistKey")||window.localStorage.setItem("persistKey",t.persistStateVersion),window.localStorage.setItem("$ej$"+this.pluginName+this._id,JSON.stringify(e))):document.cookie&&(t.isNullOrUndefined(t.persistStateVersion)||null!=t.cookie.get("persistKey")||t.cookie.set("persistKey",t.persistStateVersion),t.cookie.set("$ej$"+this.pluginName+this._id,e))},deleteState:function(){window.localStorage?window.localStorage.removeItem("$ej$"+this.pluginName+this._id):document.cookie&&t.cookie.set("$ej$"+this.pluginName+this._id,model,new Date)},restoreState:function(i){var a,n,o=null;if(window.localStorage?o=window.localStorage.getItem("$ej$"+this.pluginName+this._id):document.cookie&&(o=t.cookie.get("$ej$"+this.pluginName+this._id)),o&&(a=JSON.parse(o),this._restoreState&&(this._restoreState(a.customPersists),delete a.customPersists),t.isNullOrUndefined(a)===!1&&(t.isNullOrUndefined(a.ignoreOnPersist)?t.isNullOrUndefined(a.addToPersist)||(this._addToPersist=a.addToPersist,delete a.addToPersist):(this._ignoreOnPersist=a.ignoreOnPersist,delete a.ignoreOnPersist))),t.isNullOrUndefined(a)||t.isNullOrUndefined(this._ignoreOnPersist))this.model=e.extend(!0,this.model,a);else{for(n in this._ignoreOnPersist)-1!==this._ignoreOnPersist[n].indexOf(".")?t.createObject(this._ignoreOnPersist[n],t.getObject(this._ignoreOnPersist[n],this.model),a):a[this._ignoreOnPersist[n]]=this.model[this._ignoreOnPersist[n]];this.model=a}!i&&o&&this._setModel&&this._setModel(this.model)},ignoreOnPersist:function(e){var t,a,n=[];if("object"==typeof e?n=e:"string"==typeof e&&n.push(e),this._addToPersist===i)for(this._ignoreOnPersist=this._ignoreOnPersist||[],t=0;t<n.length;t++)this._ignoreOnPersist.push(n[t]);else for(t=0;t<n.length;t++)a=this._addToPersist.indexOf(n[t]),this._addToPersist.splice(a,1)},addToPersist:function(t){var a,n,o=[];if("object"==typeof t?o=t:"string"==typeof t&&o.push(t),this._addToPersist===i)for(this._ignoreOnPersist=this._ignoreOnPersist||[],n=0;n<o.length;n++)a=this._ignoreOnPersist.indexOf(o[n]),this._ignoreOnPersist.splice(a,1);else for(n=0;n<o.length;n++)-1===e.inArray(o[n],this._addToPersist)&&this._addToPersist.push(o[n])},formatting:function(i,a,n){var o,s,r,l,d,h,c,u,g;if(i=i.replace(/%280/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">"),n=t.preferredCulture(n)?n:"en-US",o=i,s=i.split("{0:"),d=i.split("}"),r=s[0],l=d[1],"string"==typeof a&&e.isNumeric(a)&&(a=Number(a)),-1!=i.indexOf("{0:"))return h=new RegExp("\\{0(:([^\\}]+))?\\}","gm"),c=h.exec(i),null!=c&&null!=a?null!=r&&null!=l?r+t.format(a,c[2],n)+l:t.format(a,c[2],n):null!=a?a:"";if(o.startsWith("{")&&!o.startsWith("{0:")){var m=o.split(""),a=(a||"")+"",p=a.split(""),f=/[0aA\*CN<>\?]/gm;for(u=0,g=0;u<m.length;u++)m[u]=f.test(m[u])?"{"+g++ +"}":m[u];return String.format.apply(String,[m.join("")].concat(p)).replace("{","").replace("}","")}return null!=this.data&&null==this.data.Value?(e.each(this.data,function(e,t){o=o.replace(new RegExp("\\{"+e+"\\}","gm"),t)}),o):this.data.Value}},t.WidgetBase=function(){},a=function(t,i){for(var n in t)t[n]===i[n]&&delete i[n],e.isPlainObject(i[n])&&e.isPlainObject(t[n])&&a(t[n],i[n])},t.widget=function(a,o,d){var c,u,g;if("object"!=typeof a)g=d._rootCSS||t.getNameSpace(o),d=t.defineClass(o,function(i,s){var h,c,u,m,p,f,v,_,y,b,x;if(this.sfType=o,this.pluginName=a,this.instance=l,t.isNullOrUndefined(this._setFirst)&&(this._setFirst=!0),this["ob.values"]={},e.extend(this,t.widgetBase),this.dataTypes)for(h in s)if(c=this._isValidModelValue(h,this.dataTypes,s),c!==!0)throw"setModel - Invalid input for property :"+h+" - "+c;for(u=i.data("ejWidgets")||[],u.push(a),i.data("ejWidgets",u),p=0;t.widget.observables&&this.observables&&p<this.observables.length;p++)m=t.getObject(this.observables[p],s),m&&t.createObject(this.observables[p],t.widget.observables.register(m,this.observables[p],this,i),s);if(this.element=i.jquery?i:e(i),this.model=r(!0,{},d.prototype.defaults,s),this.model.keyConfigs=r(this.keyConfigs),this.element.addClass(g+" e-js").data(a,this),this._id=i[0].id,this.model.enablePersistence){if(window.localStorage&&!t.isNullOrUndefined(t.persistStateVersion)&&window.localStorage.getItem("persistKey")!=t.persistStateVersion)for(p in window.localStorage)-1!=p.indexOf("$ej$")&&(window.localStorage.removeItem(p),window.localStorage.setItem("persistKey",t.persistStateVersion));else if(document.cookie&&!t.isNullOrUndefined(t.persistStateVersion)&&t.cookie.get("persistKey")!=t.persistStateVersion){f=document.cookie.split(/; */);for(v in f)-1!=v.indexOf("$ej$")&&(t.cookie.set(v.split("=")[0],model,new Date),t.cookie.set("persistKey",t.persistStateVersion))}this._persistHandler=t.proxy(this.persistState,this),e(window).on("unload",this._persistHandler),this.restoreState(!0)}if(this._init(s),"object"==typeof this.model.keyConfigs&&!(this.model.keyConfigs instanceof Array)){_=!1,this.model.keyConfigs.focus&&this.element.attr("accesskey",this.model.keyConfigs.focus);for(y in this.model.keyConfigs)if("focus"!==y){_=!0;break}_&&this._keyPressed&&(b=i,x="keydown",this.keySettings&&(b=this.keySettings.getElement?this.keySettings.getElement()||b:b,x=this.keySettings.event||x),this._on(b,x,function(e){if(this.model.keyConfigs){var t=n.getActionFromCode(this.model.keyConfigs,e.which,e.ctrlKey,e.shiftKey,e.altKey),i={code:e.which,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey};t&&this._keyPressed(t,e.target,i,e)===!1&&e.preventDefault()}}))}this._trigger("create")},d),e.fn[a]=function(n){for(var r,l,c=n,u=0;u<this.length;u++){var m=e(this[u]),p=m.data(a),f=p&&m.hasClass(g),v=null;if(this.length>0&&e.isPlainObject(c)&&(n=t.copyObject({},c)),f){if(n)if(l=[].slice.call(arguments,1),this.length>0&&l[0]&&"option"===c&&e.isPlainObject(l[0])&&(l[0]=t.copyObject({},l[0])),e.isPlainObject(n))p.setModel(n);else if(0!==n.indexOf("_")&&!t.isNullOrUndefined(v=t.getObject(n,p))||0===n.indexOf("model.")){if(!v||!e.isFunction(v)){if(1==arguments.length)return v;p.option(n,arguments[1]);continue}if(r=v.apply(p,l),r!==i)return r}else s(o+": function/property - "+n+" does not exist")}else d.prototype._requiresID!==!0||e(this[u]).attr("id")||m.attr("id",h("ejControl_")),n&&"object"!=typeof n?s(a+": methods/properties can be accessed only after plugin creation"):(d.prototype.defaults&&!t.isNullOrUndefined(t.setCulture)&&"locale"in d.prototype.defaults&&"ejChart"!=a&&(!n||"locale"in n?t.isNullOrUndefined(n)&&(n={},n.locale=t.setCulture().name):n.locale=t.setCulture().name),new d(m,n))}return-1!=a.indexOf("ejm")&&t.widget.registerInstance(m,a,o,d.prototype),this},t.widget.register(a,o,d.prototype),t.loadLocale(a);else{d=o;for(c in a)u=a[c],u instanceof Array&&(d._rootCSS=u[1],u=u[0]),t.widget(c,u,d),a[c]instanceof Array&&(d._rootCSS="")}},t.loadLocale=function(i){for(var a=t.locales,n=0,o=a.length;o>n;n++)e.fn["Locale_"+a[n]](i)},e.extend(t.widget,function(){var e={},i=[],a=function(i,a,n){t.isNullOrUndefined(e[i])||s("ej.widget : The widget named "+i+" is trying to register twice."),e[i]={name:i,className:a,proto:n},t.widget.extensions&&t.widget.extensions.registerWidget(i)},n=function(e,t,a,n){i.push({element:e,pluginName:t,className:a,proto:n})};return{register:a,registerInstance:n,registeredWidgets:e,registeredInstances:i}}()),t.widget.destroyAll=function(e){var t,i,a,n;if(e&&e.length)for(t=0;t<e.length;t++)if(i=e.eq(t).data(),a=i.ejWidgets,a&&a.length)for(n=0;n<a.length;n++)i[a[n]]&&i[a[n]].destroy&&i[a[n]].destroy()},t.cookie={get:function(e){var t=RegExp(e+"=([^;]+)").exec(document.cookie);return t&&t.length>1?t[1]:i},set:function(e,t,i){"object"==typeof t&&(t=JSON.stringify(t)),t=escape(t)+(null==i?"":"; expires="+i.toUTCString()),document.cookie=e+"="+t}},n={getActionFromCode:function(e,t,i,a,o){var s,r,l;i=i||!1,a=a||!1,o=o||!1;for(s in e)if("focus"!==s)for(r=n.getKeyObject(e[s]),l=0;l<r.length;l++)if(t===r[l].code&&i==r[l].isCtrl&&a==r[l].isShift&&o==r[l].isAlt)return s;return null},getKeyObject:function(t){for(var i,a,o,s={isCtrl:!1,isShift:!1,isAlt:!1},r=e.extend(!0,{},s),l=t.split(","),d=[],h=0;h<l.length;h++){if(i=null,-1!=l[h].indexOf("+"))for(a=l[h].split("+"),o=0;o<a.length;o++)i=n.getResult(e.trim(a[o]),s);else i=n.getResult(e.trim(l[h]),e.extend(!0,{},r));d.push(i)}return d},getResult:function(e,t){return"ctrl"===e?t.isCtrl=!0:"shift"===e?t.isShift=!0:"alt"===e?t.isAlt=!0:t.code=parseInt(e,10),t}},t.getScrollableParents=function(t){return e(t).parentsUntil("html").filter(function(){return"visible"!=e(this).css("overflow")}).add(e(window))},t.browserInfo=function(){var i,a,n,o,s={},r=[],l={opera:/(opera|opr)(?:.*version|)[ \/]([\w.]+)/i,edge:/(edge)(?:.*version|)[ \/]([\w.]+)/i,webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,msie:/(msie|trident) ([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+)|)/i};for(i in l)if(l.hasOwnProperty(i)&&(r=navigator.userAgent.match(l[i]))){if(s.name="opr"==r[1].toLowerCase()?"opera":r[1].toLowerCase(),s.version=r[2],s.culture={},s.culture.name=s.culture.language=navigator.language||navigator.userLanguage,"undefined"!=typeof t.globalize){for(a=t.preferredCulture().name,n=navigator.language||navigator.userLanguage?t.preferredCulture(navigator.language||navigator.userLanguage):t.preferredCulture("en-US"),o=0;navigator.languages&&o<navigator.languages.length&&(n=t.preferredCulture(navigator.languages[o]),n.language!=navigator.languages[o]);o++);t.preferredCulture(a),e.extend(!0,s.culture,n)}!navigator.userAgent.match(/Trident\/7\./)||(s.name="msie");break}return s.isMSPointerEnabled="msie"==s.name&&s.version>9&&window.navigator.msPointerEnabled,s.pointerEnabled=window.navigator.pointerEnabled,s},t.eventType={mouseDown:"mousedown touchstart",mouseMove:"mousemove touchmove",mouseUp:"mouseup touchend",mouseLeave:"mouseleave touchcancel",click:"click touchend"},t.event=function(t,i,a){return e.extend(a||{},{type:t,model:i,cancel:!1})},t.proxy=function(e,t,i){return e&&"function"==typeof e?"on"in e&&t?i?e.on(t,i):e.on(t):function(){var a=i?[i]:[];return a.push.apply(a,arguments),e.apply(t||this,a)}:null},t.hasStyle=function(e){var t,i,a=document.documentElement.style;if(e in a)return!0;for(t=["ms","Moz","Webkit","O","Khtml"],e=e[0].toUpperCase()+e.slice(1),i=0;i<t.length;i++)if(t[i]+e in a)return!0;return!1},Array.prototype.indexOf=Array.prototype.indexOf||function(e){var t,i=this.length;if(0===i)return-1;for(t=0;i>t;t++)if(t in this&&this[t]===e)return t;return-1},String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e};var r=t.copyObject=function(e,a){var n,o,s,l,d,h,c=2;for("boolean"!=typeof e&&(c=1),s=[].slice.call(arguments,c),1===c&&(a=e,e=i),l=0;l<s.length;l++)for(d in s[l])if(n=a[d],o=s[l][d],o!==i&&n!==o&&s[l]!==o&&a!==o)if(o instanceof Array)if(0===l&&e)if("dataSource"===d)a[d]=o.slice();else for(a[d]=[],h=0;h<o.length;h++)r(!0,a[d],o);else a[d]=o.slice();else t.isPlainObject(o)?(a[d]=n||{},e?r(e,a[d],o):r(a[d],o)):a[d]=o;return a},l=function(){return this},d=0,h=function(e){return e+d++};t.template={},t.template.render=t.template["text/x-jsrender"]=function(t,i,a,n,o){"#"!==i.slice(0,1)&&(i=["<div>",i,"</div>"].join(""));var s={prop:o,index:n};return e(i).render(a,s)},t.isPlainObject=function(e){if(!e||t.DataManager!==i&&e instanceof t.DataManager||"object"!=typeof e||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!e.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1}catch(a){return!1}var n,o=t.support.isOwnLast;for(n in e)if(o)break;return n===i||e.hasOwnProperty(n)},o=!1,t.util.valueFunction=function(e){return function(a,n){var s=t.getObject(e,this.model);return o===!1&&(o=t.getObject("observables.getValue",t.widget)),a===i?t.isNullOrUndefined(o)?"function"==typeof s?s.call(this):s:o(s,n):void("function"==typeof s?(this["ob.values"][e]=a,s.call(this,a)):t.createObject(e,a,this.model))}},t.util.getVal=function(e){return"function"==typeof e?e():e},t.support={isOwnLast:function(){var e,t=function(){this.a=1};t.prototype.b=1;for(e in new t)return"b"===e}(),outerHTML:function(){return document.createElement("div").outerHTML!==i}()},s=t.throwError=function(e){try{throw new Error(e)}catch(t){throw t.message+"\n"+t.stack}},t.getRandomValue=function(e,a){var n,o;return e===i||a===i?t.throwError("Min and Max values are required for generating a random number"):("crypto"in window&&"getRandomValues"in crypto?(o=new Uint16Array(1),window.crypto.getRandomValues(o),n=o[0]%(a-e)+e):n=Math.random()*(a-e)+e,0|n)},t.extensions={},t.extensions.modelGUID="{0B1051BA-1CCB-42C2-A3B5-635389B92A50}"}(window.jQuery,window.Syncfusion),function(){$.fn.addEleAttrs=function(e){var t=$(this);$.each(e,function(e,i){i&&i.specified&&t.attr(i.name,i.value)})},$.fn.removeEleAttrs=function(e){return this.each(function(){var t=$(this),i=$(this.attributes).clone();$.each(i,function(i,a){a&&a.specified&&e.test(a.name)&&t.removeAttr(a.name)})})},$.fn.attrNotStartsWith=function(e){var t,a=[];for(this.each(function(){t=$(this.attributes).clone()}),i=0;i<t.length;i++){if(t[i]&&t[i].specified&&e.test(t[i].name))continue;a.push(t[i])}return a},$.fn.removeEleEmptyAttrs=function(){return this.each(function(){var e=$(this),t=$(this.attributes).clone();$.each(t,function(t,i){i&&i.specified&&""===i.value&&e.removeAttr(i.name)})})},$.extend($.support,{has3d:ej.addPrefix("perspective")in ej.styles,hasTouch:"ontouchstart"in window,hasPointer:navigator.msPointerEnabled,hasTransform:ej.userAgent()!==!1,pushstate:"pushState"in history&&"replaceState"in history,hasTransition:ej.addPrefix("transition")in ej.styles}),$.extend($.expr[":"],{attrNotStartsWith:function(e,t,i){for(var a=e.attributes,n=0;n<a.length;n++)if(0===a[n].nodeName.indexOf(i[3]))return!1;return!0}});var e=$.fn.andSelf||$.fn.addBack;$.fn.andSelf=$.fn.addBack=function(){return e.apply(this,arguments)}}()}),function(e){"function"==typeof define&&define.amd?define(["./ej.core.min"],e):e()}(function(){window.ej=window.Syncfusion=window.Syncfusion||{},function(e,t,i,a){"use strict";var n,o,s,r,l,d,h,c,u;t.DataManager=function(i,n,o){if(!(this instanceof t.DataManager))return new t.DataManager(i,n,o);i||(i=[]),o=o||i.adaptor,"string"==typeof o&&(o=new t[o]);var s=[],r=this;return i instanceof Array?s={json:i,offline:!0}:"object"==typeof i?e.isPlainObject(i)?(i.json||(i.json=[]),i.table&&(i.json=this._getJsonFromElement(i.table,i.headerOption)),s={url:i.url,insertUrl:i.insertUrl,removeUrl:i.removeUrl,updateUrl:i.updateUrl,crudUrl:i.crudUrl,batchUrl:i.batchUrl,json:i.json,headers:i.headers,accept:i.accept,data:i.data,async:i.async,timeTillExpiration:i.timeTillExpiration,cachingPageSize:i.cachingPageSize,enableCaching:i.enableCaching,requestType:i.requestType,key:i.key,crossDomain:i.crossDomain,antiForgery:i.antiForgery,jsonp:i.jsonp,dataType:i.dataType,offline:i.offline!==a?i.offline:"remoteSaveAdaptor"==i.adaptor||i.adaptor instanceof t.remoteSaveAdaptor?!1:!i.url,requiresFormat:i.requiresFormat}):(i.jquery||N(i))&&(s={json:this._getJsonFromElement(i),offline:!0,table:i}):"string"==typeof i&&(s={url:i,offline:!1,dataType:"json",json:[]}),s.requiresFormat!==a||t.support.cors||(s.requiresFormat=c(s.crossDomain)?!0:s.crossDomain),s.antiForgery&&this.antiForgeryToken(),s.dataType===a&&(s.dataType="json"),this.dataSource=s,this.defaultQuery=n,s.url&&s.offline&&!s.json.length?(this.isDataAvailable=!1,this.adaptor=o||new t.ODataAdaptor,this.dataSource.offline=!1,this.ready=this.executeQuery(n||t.Query()).done(function(e){r.dataSource.offline=!0,r.isDataAvailable=!0,s.json=e.result,r.adaptor=new t.JsonAdaptor})):this.adaptor=s.offline?new t.JsonAdaptor:new t.ODataAdaptor,!s.jsonp&&this.adaptor instanceof t.ODataAdaptor&&(s.jsonp="callback"),this.adaptor=o||this.adaptor,s.enableCaching&&(this.adaptor=new t.CacheAdaptor(this.adaptor,s.timeTillExpiration,s.cachingPageSize)),this},t.DataManager.prototype={setDefaultQuery:function(e){this.defaultQuery=e},executeQuery:function(i,n,o,s){var r,d,h;return"function"==typeof i&&(s=o,o=n,n=i,i=null),i||(i=this.defaultQuery),i instanceof t.Query||u("DataManager - executeQuery() : A query is required to execute"),r=e.Deferred(),r.then(n,o,s),d={query:i},this.dataSource.offline||this.dataSource.url==a?t.isNullOrUndefined(this.dataSource.async)||0!=this.dataSource.async?l(function(){this._localQueryProcess(i,d,r)},this):this._localQueryProcess(i,d,r):(h=this.adaptor.processQuery(this,i),t.isNullOrUndefined(h.url)?l(function(){
d=this._getDeferedArgs(i,h,d),r.resolveWith(this,[d])},this):this._makeRequest(h,r,d,i)),r.promise()},_localQueryProcess:function(e,t,i){var a=this.executeLocal(e);t=this._getDeferedArgs(e,a,t),i.resolveWith(this,[t])},_getDeferedArgs:function(e,t,i){return e._requiresCount?(i.result=t.result,i.count=t.count):i.result=t,i.getTableModel=M(e._fromTable,i.result,this),i.getKnockoutModel=E(i.result),i},executeLocal:function(i){var a,n;if(this.defaultQuery||i instanceof t.Query||u("DataManager - executeLocal() : A query is required to execute"),this.dataSource.json||u("DataManager - executeLocal() : Json data is required to execute"),i=i||this.defaultQuery,a=this.adaptor.processQuery(this,i),i._subQuery){var o=i._subQuery._fromTable,s=i._subQuery._lookup,r=i._requiresCount?a.result:a;for(s&&s instanceof Array&&g(i._subQuery._fKey,o,r,s,i._subQuery._key),n=0;n<r.length;n++)r[n][o]instanceof Array&&(r[n]=e.extend({},r[n]),r[n][o]=this.adaptor.processResponse(i._subQuery.using(t.DataManager(r[n][o].slice(0))).executeLocal(),this,i))}return this.adaptor.processResponse(a,this,i)},_makeRequest:function(i,a,n,o){var s,r=!!o._subQuerySelector,l=h(function(e){n.error=e,a.rejectWith(this,[n])},this),c=h(function(e,t,i,s,l,d,h){r||(n.xhr=i,n.count=parseInt(t,10),n.result=e,n.request=s,n.aggregates=d,n.getTableModel=M(o._fromTable,e,this),n.getKnockoutModel=E(e),n.actual=l,n.virtualSelectRecords=h,a.resolveWith(this,[n]))},this),u=h(function(t,i){var a,s,d=e.Deferred(),h={parent:n};return o._subQuery._isChild=!0,a=this.adaptor.processQuery(this,o._subQuery,t?this.adaptor.processResponse(t):i),s=this._makeRequest(a,d,h,o._subQuery),r||d.then(function(e){t&&(g(o._subQuery._fKey,o._subQuery._fromTable,t,e,o._subQuery._key),c(t))},l),s},this),m=d(function(e,i,a,n){-1==a.getResponseHeader("Content-Type").indexOf("xml")&&t.dateParse&&(e=t.parseJSON(e));var s=this.adaptor.processResponse(e,this,o,a,n),l=0,d=null,h=e.virtualSelectRecords;return o._requiresCount&&(l=s.count,d=s.aggregates,s=s.result),o._subQuery?void(r||u(s)):void c(s,l,a,n,e,d,h)},this),p=e.extend({type:"GET",dataType:this.dataSource.dataType,crossDomain:this.dataSource.crossDomain,jsonp:this.dataSource.jsonp,cache:!0,beforeSend:h(this._beforeSend,this),processData:!1,success:m,error:l},i);return"async"in this.dataSource&&(p.async=this.dataSource.async),p=e.ajax(p),r&&(s=o._subQuerySelector.call(this,{query:o._subQuery,parent:o}),s&&s.length?(p=e.when(p,u(null,s)),p.then(d(function(e,t,i){var a,n=this.adaptor.processResponse(e[0],this,o,e[2],i[0]),s=0;o._requiresCount&&(s=n.count,n=n.result),a=this.adaptor.processResponse(t[0],this,o._subQuery,t[2],i[1]),s=0,o._subQuery._requiresCount&&(s=a.count,a=a.result),g(o._subQuery._fKey,o._subQuery._fromTable,n,a,o._subQuery._key),r=!1,c(n,s,e[2])},this),l)):r=!1),p},_beforeSend:function(e,t){var i,a,n,o;for(this.adaptor.beforeSend(this,e,t),i=this.dataSource.headers,n=0;i&&n<i.length;n++){a=[];for(o in i[n])a.push(o),e.setRequestHeader(o,i[n][o])}},saveChanges:function(i,a,n,o){var s,r,l;return n instanceof t.Query&&(o=n,n=null),s={url:n,key:a||this.dataSource.key},r=this.adaptor.batchRequest(this,i,s,o),this.dataSource.offline?r:(l=e.Deferred(),e.ajax(e.extend({beforeSend:h(this._beforeSend,this),success:d(function(e,t,n,o){l.resolveWith(this,[this.adaptor.processResponse(e,this,null,n,o,i,a)])},this),error:function(e){l.rejectWith(this,[{error:e}])}},r)),l.promise())},insert:function(i,a,n){var o,s;return i=p.replacer(i),a instanceof t.Query&&(n=a,a=null),o=this.adaptor.insert(this,i,a,n),this.dataSource.offline?o:(s=e.Deferred(),e.ajax(e.extend({type:"POST",contentType:"application/json; charset=utf-8",processData:!1,beforeSend:h(this._beforeSend,this),success:d(function(e,i,a,n){try{t.isNullOrUndefined(e)?e=[]:p.parseJson(e)}catch(o){e=[]}e=this.adaptor.processResponse(p.parseJson(e),this,null,a,n),s.resolveWith(this,[{record:e,dataManager:this}])},this),error:function(e){s.rejectWith(this,[{error:e,dataManager:this}])}},o)),s.promise())},antiForgeryToken:function(){var i;return t.isNullOrUndefined(e("input[name='_ejRequestVerifyToken']").val())?i=t.buildTag("input","","",{type:"hidden",name:"_ejRequestVerifyToken",value:t.getGuid()}).appendTo("body"):e("input[name='_ejRequestVerifyToken']").val(t.getGuid()),t.cookie.set("_ejRequestVerifyToken",e("input[name='_ejRequestVerifyToken']").val()),{name:"_ejRequestVerifyToken",value:e("input[name='_ejRequestVerifyToken']").val()}},remove:function(i,a,n,o){var s,r;return"object"==typeof a&&(a=a[i]),n instanceof t.Query&&(o=n,n=null),s=this.adaptor.remove(this,i,a,n,o),this.dataSource.offline?s:(r=e.Deferred(),e.ajax(e.extend({type:"POST",contentType:"application/json; charset=utf-8",beforeSend:h(this._beforeSend,this),success:d(function(e,i,a,n){try{t.isNullOrUndefined(e)?e=[]:p.parseJson(e)}catch(o){e=[]}e=this.adaptor.processResponse(p.parseJson(e),this,null,a,n),r.resolveWith(this,[{record:e,dataManager:this}])},this),error:function(e){r.rejectWith(this,[{error:e,dataManager:this}])}},s)),r.promise())},update:function(i,a,n,o){var s,r;return a=p.replacer(a),n instanceof t.Query&&(o=n,n=null),s=this.adaptor.update(this,i,a,n,o),this.dataSource.offline?s:(r=e.Deferred(),e.ajax(e.extend({contentType:"application/json; charset=utf-8",beforeSend:h(this._beforeSend,this),success:d(function(e,i,a,n){try{t.isNullOrUndefined(e)?e=[]:p.parseJson(e)}catch(o){e=[]}e=this.adaptor.processResponse(p.parseJson(e),this,null,a,n),r.resolveWith(this,[{record:e,dataManager:this}])},this),error:function(e){r.rejectWith(this,[{error:e,dataManager:this}])}},s)),r.promise())},_getJsonFromElement:function(i){"string"==typeof i&&(i=e(e(i).html())),i=i.jquery?i[0]:i;var a=i.tagName.toLowerCase();return"table"!==a&&u("ej.DataManager : Unsupported htmlElement : "+a),t.parseTable(i)}};var g=function(e,i,a,n,o){var s,r,l,d={};for(n.result&&(n=n.result),n.GROUPGUID&&u("ej.DataManager: Do not have support Grouping in hierarchy"),s=0;s<n.length;s++)l=t.getObject(e,n[s]),r=d[l]||(d[l]=[]),r.push(n[s]);for(s=0;s<a.length;s++)a[s][i]=d[t.getObject(o||e,a[s])]},m={accept:"application/json;odata=light;q=1,application/json;odata=verbose;q=0.5",multipartAccept:"multipart/mixed",batch:"$batch",changeSet:"--changeset_",batchPre:"batch_",contentId:"Content-Id: ",batchContent:"Content-Type: multipart/mixed; boundary=",changeSetContent:"Content-Type: application/http\nContent-Transfer-Encoding: binary ",batchChangeSetContentType:"Content-Type: application/json; charset=utf-8 "},p={parseJson:function(e){var t=typeof e;return"string"===t?e=JSON.parse(e,p.jsonReviver):e instanceof Array?p.iterateAndReviveArray(e):"object"===t&&p.iterateAndReviveJson(e),e},iterateAndReviveArray:function(e){for(var t=0;t<e.length;t++)"object"==typeof e[t]?p.iterateAndReviveJson(e[t]):e[t]="string"!=typeof e[t]||/^[\s]*\[|^[\s]*\{|\"/g.test(e[t])?p.parseJson(e[t]):p.jsonReviver("",e[t])},iterateAndReviveJson:function(e){var t;for(var i in e)i.startsWith("__")||(t=e[i],"object"==typeof t?t instanceof Array?p.iterateAndReviveArray(t):p.iterateAndReviveJson(t):e[i]=p.jsonReviver(i,t))},jsonReviver:function(e,t){var i,a,n=t;if("string"==typeof t){if(i=/^\/Date\(([+-]?[0-9]+)([+-][0-9]{4})?\)\/$/.exec(t))return p.replacer(new Date(parseInt(i[1])));/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*){1})([zZ]|([+\-])(\d\d):?(\d\d))?$/.test(t)&&(t=p.replacer(new Date(t)),isNaN(t)&&(a=n.split(/[^0-9]/),t=p.replacer(new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5]))))}return t},isJson:function(e){return"string"==typeof e[0]?e:t.parseJSON(e)},isGuid:function(e){var t=/[A-Fa-f0-9]{8}(?:-[A-Fa-f0-9]{4}){3}-[A-Fa-f0-9]{12}/i.exec(e);return null!=t},replacer:function(e){return t.isPlainObject(e)?p.jsonReplacer(e):e instanceof Array?p.arrayReplacer(e):e instanceof Date?p.jsonReplacer({val:e}).val:e},jsonReplacer:function(e){var i;for(var a in e)i=e[a],i instanceof Date&&(e[a]=new Date(+i+36e5*t.serverTimezoneOffset));return e},arrayReplacer:function(e){for(var i=0;i<e.length;i++)t.isPlainObject(e[i])?e[i]=p.jsonReplacer(e[i]):e[i]instanceof Date&&(e[i]=p.jsonReplacer({date:e[i]}).date);return e}};t.isJSON=p.isJson,t.parseJSON=p.parseJson,t.dateParse=!0,t.isGUID=p.isGuid,t.Query=function(e){return this instanceof t.Query?(this.queries=[],this._key="",this._fKey="","string"==typeof e?this._fromTable=e||"":e&&e instanceof Array&&(this._lookup=e),this._expands=[],this._sortedColumns=[],this._groupedColumns=[],this._subQuery=null,this._isChild=!1,this._params=[],this):new t.Query(e)},t.Query.prototype={key:function(e){return"string"==typeof e&&(this._key=e),this},using:function(e){return e instanceof t.DataManager?(this.dataManagar=e,this):u("Query - using() : 'using' function should be called with parameter of instance ej.DataManager")},execute:function(e,i,a,n){return e=e||this.dataManagar,e&&e instanceof t.DataManager?e.executeQuery(this,i,a,n):u("Query - execute() : dataManager needs to be is set using 'using' function or should be passed as argument")},executeLocal:function(e){return e=e||this.dataManagar,e&&e instanceof t.DataManager?e.executeLocal(this):u("Query - executeLocal() : dataManager needs to be is set using 'using' function or should be passed as argument")},clone:function(){var e=new t.Query;return e.queries=this.queries.slice(0),e._key=this._key,e._isChild=this._isChild,e.dataManagar=this.dataManager,e._fromTable=this._fromTable,e._params=this._params.slice(0),e._expands=this._expands.slice(0),e._sortedColumns=this._sortedColumns.slice(0),e._groupedColumns=this._groupedColumns.slice(0),e._subQuerySelector=this._subQuerySelector,e._subQuery=this._subQuery,e._fKey=this._fKey,e._requiresCount=this._requiresCount,e},from:function(e){return"string"==typeof e&&(this._fromTable=e),this},addParams:function(e,i){return"function"==typeof i||t.isPlainObject(i)?"function"==typeof i&&this._params.push({key:e,fn:i}):this._params.push({key:e,value:i}),this},expand:function(e){return this._expands="string"==typeof e?[].slice.call(arguments,0):e.slice(0),this},where:function(e,i,a,n){i=(i||t.FilterOperators.equal).toLowerCase();var o=null;return"string"==typeof e?o=new t.Predicate(e,i,a,n):e instanceof t.Predicate?o=e:u("Query - where : Invalid arguments"),this.queries.push({fn:"onWhere",e:o}),this},search:function(e,i,a,n){i&&"boolean"!=typeof i?"string"==typeof i&&(i=[i]):(i=[],n=i),"boolean"==typeof a&&(n=a,a=null),a=a||t.FilterOperators.contains,a.length<3&&(a=t.data.operatorSymbols[a]);var o=t.data.fnOperators[a]||t.data.fnOperators.processSymbols(a);return this.queries.push({fn:"onSearch",e:{fieldNames:i,operator:a,searchKey:e,ignoreCase:n,comparer:o}}),this},sortBy:function(e,i,a){var n,o,s,r,l=t.sortOrder.Ascending;if("string"==typeof e&&e.toLowerCase().endsWith(" desc")&&(e=e.replace(/ desc$/i,""),i=t.sortOrder.Descending),e instanceof Array){for(s=0;s<e.length;s++)this.sortBy(e[s],i,a);return this}if("boolean"==typeof i?i=i?t.sortOrder.Descending:t.sortOrder.Ascending:"function"==typeof i&&(l="custom"),i&&"string"!=typeof i||(l=i?i.toLowerCase():t.sortOrder.Ascending,i=t.pvt.fnSort(i)),a)for(n=f(this.queries,"onSortBy"),s=0;s<n.length;s++)if(o=n[s].e.fieldName,"string"==typeof o){if(o===e)return this}else if(o instanceof Array)for(r=0;r<o.length;r++)if(o[r]===e||e.toLowerCase()===o[r]+" desc")return this;return this.queries.push({fn:"onSortBy",e:{fieldName:e,comparer:i,direction:l}}),this},sortByDesc:function(e){return this.sortBy(e,t.sortOrder.Descending)},group:function(e,t){return this.sortBy(e,null,!0),this.queries.push({fn:"onGroup",e:{fieldName:e,fn:t}}),this},page:function(e,t){return this.queries.push({fn:"onPage",e:{pageIndex:e,pageSize:t}}),this},range:function(e,t){return("number"!=typeof e||"number"!=typeof t)&&u("Query() - range : Arguments type should be a number"),this.queries.push({fn:"onRange",e:{start:e,end:t}}),this},take:function(e){return"number"!=typeof e&&u("Query() - Take : Argument type should be a number"),this.queries.push({fn:"onTake",e:{nos:e}}),this},skip:function(e){return"number"!=typeof e&&u("Query() - Skip : Argument type should be a number"),this.queries.push({fn:"onSkip",e:{nos:e}}),this},select:function(e){return"string"==typeof e&&(e=[].slice.call(arguments,0)),e instanceof Array||u("Query() - Select : Argument type should be String or Array"),this.queries.push({fn:"onSelect",e:{fieldNames:e}}),this},hierarchy:function(e,i){return e&&e instanceof t.Query||u("Query() - hierarchy : query must be instance of ej.Query"),"function"==typeof i&&(this._subQuerySelector=i),this._subQuery=e,this},foreignKey:function(e){return"string"==typeof e&&(this._fKey=e),this},requiresCount:function(){return this._requiresCount=!0,this},aggregate:function(e,t){this.queries.push({fn:"onAggregates",e:{field:t,type:e}})}},t.Adaptor=function(e){this.dataSource=e,this.pvt={},this.init.apply(this,[].slice.call(arguments,1))},t.Adaptor.prototype={options:{from:"table",requestType:"json",sortBy:"sorted",select:"select",skip:"skip",group:"group",take:"take",search:"search",count:"requiresCounts",where:"where",aggregates:"aggregates",antiForgery:"antiForgery"},init:function(){},extend:function(t){var i,a,n=function(t){this.dataSource=t,this.options&&(this.options=e.extend({},this.options)),this.init.apply(this,[].slice.call(arguments,0)),this.pvt={}};n.prototype=new this.type,n.prototype.type=n,i=n.prototype.base={};for(a in t)n.prototype[a]&&(i[a]=n.prototype[a]);return e.extend(!0,n.prototype,t),n},processQuery:function(){},processResponse:function(e){return e.d?e.d:e},convertToQueryString:function(t){return e.param(t)},type:t.Adaptor},t.UrlAdaptor=(new t.Adaptor).extend({processQuery:function(e,t,i){var a,o,s,r,l,d,h=f(t.queries,"onSortBy"),u=f(t.queries,"onGroup"),g=f(t.queries,"onWhere"),m=f(t.queries,"onSearch"),p=f(t.queries,"onAggregates"),y=v(t.queries,["onSelect","onPage","onSkip","onTake","onRange"]),b=t._params,x=e.dataSource.url,D=null,C=this.options,w={sorted:[],grouped:[],filters:[],searches:[],aggregates:[]};for(y.onPage?(a=y.onPage,o=n(a.pageIndex,t),D=n(a.pageSize,t),o=(o-1)*D):y.onRange&&(a=y.onRange,o=a.start,D=a.end-a.start),s=0;s<h.length;s++)a=n(h[s].e.fieldName,t),w.sorted.push(_(this,"onEachSort",{name:a,direction:h[s].e.direction},t));for(i&&(a=this.getFiltersFrom(i,t),a&&w.filters.push(_(this,"onEachWhere",a.toJSON(),t))),s=0;s<g.length;s++){w.filters.push(_(this,"onEachWhere",g[s].e.toJSON(),t));for(l in w.filters[s])c(w[l])&&delete w[l]}for(s=0;s<m.length;s++)a=m[s].e,w.searches.push(_(this,"onEachSearch",{fields:a.fieldNames,operator:a.operator,key:a.searchKey,ignoreCase:a.ignoreCase},t));for(s=0;s<u.length;s++)w.grouped.push(n(u[s].e.fieldName,t));for(s=0;s<p.length;s++)a=p[s].e,w.aggregates.push({type:a.type,field:n(a.field,t)});r={},r[C.from]=t._fromTable,C.expand&&(r[C.expand]=t._expands),r[C.select]=y.onSelect?_(this,"onSelect",n(y.onSelect.fieldNames,t),t):"",r[C.count]=t._requiresCount?_(this,"onCount",t._requiresCount,t):"",r[C.search]=w.searches.length?_(this,"onSearch",w.searches,t):"",r[C.skip]=y.onSkip?_(this,"onSkip",n(y.onSkip.nos,t),t):"",r[C.take]=y.onTake?_(this,"onTake",n(y.onTake.nos,t),t):"",r[C.antiForgery]=e.dataSource.antiForgery?e.antiForgeryToken().value:"",r[C.where]=w.filters.length||w.searches.length?_(this,"onWhere",w.filters,t):"",r[C.sortBy]=w.sorted.length?_(this,"onSortBy",w.sorted,t):"",r[C.group]=w.grouped.length?_(this,"onGroup",w.grouped,t):"",r[C.aggregates]=w.aggregates.length?_(this,"onAggregates",w.aggregates,t):"",r.param=[],_(this,"addParams",{dm:e,query:t,params:b,reqParams:r});for(l in r)(c(r[l])||""===r[l]||0===r[l].length||"params"===l)&&delete r[l];return C.skip in r&&C.take in r||null===D||(r[C.skip]=_(this,"onSkip",o,t),r[C.take]=_(this,"onTake",D,t)),d=this.pvt,this.pvt={},"json"===this.options.requestType?{data:JSON.stringify(r),url:x,ejPvtData:d,type:"POST",contentType:"application/json; charset=utf-8"}:(a=this.convertToQueryString(r,t,e),a=(-1!==e.dataSource.url.indexOf("?")?"&":"/")+a,{type:"GET",url:a.length?x.replace(/\/*$/,a):x,ejPvtData:d})},convertToQueryString:function(t,i,a){return a.dataSource.url&&-1!==a.dataSource.url.indexOf("?")?e.param(t):"?"+e.param(t)},processResponse:function(e,i,n,o,s,r){var l,d,h,c,u,g,m=s.ejPvtData||{},p=e.groupDs;if(o&&o.getResponseHeader("Content-Type")&&-1!=o.getResponseHeader("Content-Type").indexOf("xml")&&9==e.nodeType)return n._requiresCount?{result:[],count:0}:[];if(l=JSON.parse(s.data),l&&"batch"===l.action&&e.added)return r.added=e.added,r;if(e.d&&(e=e.d),m&&m.aggregates&&m.aggregates.length){var f,v=m.aggregates,h={},_={};for(("count"in e&&(h.count=e.count),e.result&&(h.result=e.result),e.aggregate&&(e=e.aggregate),c=0);c<v.length;c++)f=t.aggregates[v[c].type],f&&(_[v[c].field+" - "+v[c].type]=f(e,v[c].field));h.aggregates=_,e=h}if(m&&m.groups&&m.groups.length){for((d=m.groups,h={},"count"in e&&(h.count=e.count),e.aggregates&&(h.aggregates=e.aggregates),e.result&&(e=e.result),c=0);c<d.length;c++)u=null,g=P(d[c],n.queries),t.isNullOrUndefined(p)||(p=t.group(p,d[c],null,g)),e=t.group(e,d[c],m.aggregates,g,u,p);return h.count!=a?h.result=e:h=e,h}return e},onGroup:function(e){this.pvt.groups=e},onAggregates:function(e){this.pvt.aggregates=e},batchRequest:function(e,t,i,a){var n={changed:t.changed,added:t.added,deleted:t.deleted,action:"batch",table:i.url,key:i.key,antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""};return a&&this.addParams({dm:e,query:a,params:a._params,reqParams:n}),{type:"POST",url:e.dataSource.batchUrl||e.dataSource.crudUrl||e.dataSource.removeUrl||e.dataSource.url,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n)}},beforeSend:function(){},insert:function(e,t,i,a){var n={value:t,table:i,action:"insert",antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""};return a&&this.addParams({dm:e,query:a,params:a._params,reqParams:n}),{url:e.dataSource.insertUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify(n)}},remove:function(e,t,i,a,n){var o={key:i,keyColumn:t,table:a,action:"remove",antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""};return n&&this.addParams({dm:e,query:n,params:n._params,reqParams:o}),{type:"POST",url:e.dataSource.removeUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify(o)}},update:function(e,t,i,a,n){var o={value:i,action:"update",keyColumn:t,key:i[t],table:a,antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""};return n&&this.addParams({dm:e,query:n,params:n._params,reqParams:o}),{type:"POST",url:e.dataSource.updateUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify(o)}},getFiltersFrom:function(e,i){var a;e instanceof Array&&e.length||u("ej.SubQuery: Array of key values required");var n,o=i._fKey,s=o,r=i._key,l=[],d="object"!=typeof e[0];for("object"!=typeof e[0]&&(s=null),a=0;a<e.length;a++)n=d?e[a]:t.pvt.getObject(r||s,e[a]),l.push(new t.Predicate(o,"==",n));return t.Predicate.or(l)},addParams:function(e){var t,i,a=e.dm,n=e.query,o=e.params,s=e.reqParams;for(s.params={},t=0;i=o[t];t++)s[i.key]&&u("ej.Query: Custom Param is conflicting other request arguments"),s[i.key]=i.value,i.fn&&(s[i.key]=i.fn.call(n,i.key,n,a)),s.params[i.key]=s[i.key]}}),t.WebMethodAdaptor=(new t.UrlAdaptor).extend({processQuery:function(e,i,a){var n=t.UrlAdaptor.prototype.processQuery(e,i,a),o=t.parseJSON(n.data),s={};return s.value=o,_(this,"addParams",{dm:e,query:i,params:i._params,reqParams:s}),{data:JSON.stringify(s),url:n.url,ejPvtData:n.ejPvtData,type:"POST",contentType:"application/json; charset=utf-8"}},addParams:function(e){var t,i,a,n,o=e.dm,s=e.query,r=e.params,l=e.reqParams;for(l.params={},t=0;i=r[t];t++)l[i.key]&&u("ej.Query: Custom Param is conflicting other request arguments"),a=i.key,n=i.value,i.fn&&(n=i.fn.call(s,i.key,s,o)),l[a]=n,l.params[a]=l[a]}}),t.CacheAdaptor=(new t.UrlAdaptor).extend({init:function(e,i,a){var n,o;t.isNullOrUndefined(e)||(this.cacheAdaptor=e),this.pageSize=a,this.guidId=t.getGuid("cacheAdaptor"),n={keys:[],results:[]},window.localStorage&&window.localStorage.setItem(this.guidId,JSON.stringify(n)),o=this.guidId,t.isNullOrUndefined(i)||setInterval(function(){for(var e,a=t.parseJSON(window.localStorage.getItem(o)),n=[],s=0;s<a.results.length;s++)a.results[s].timeStamp=new Date-new Date(a.results[s].timeStamp),new Date-new Date(a.results[s].timeStamp)>i&&n.push(s);for(e=n,s=0;s<n.length;s++)a.results.splice(n[s],1),a.keys.splice(n[s],1);window.localStorage.removeItem(o),window.localStorage.setItem(o,JSON.stringify(a))},i)},generateKey:function(e,t){var i,a,n,o,s=f(t.queries,"onSortBy"),r=f(t.queries,"onGroup"),l=f(t.queries,"onWhere"),d=f(t.queries,"onSearch"),h=(f(t.queries,"onPage"),v(t.queries,["onSelect","onPage","onSkip","onTake","onRange"])),c=(t._params,e);for(h.onPage&&(c+=h.onPage.pageIndex),s.forEach(function(e){c+=e.e.direction+e.e.fieldName}),r.forEach(function(e){c+=e.e.fieldName}),d.forEach(function(e){c+=e.e.searchKey}),i=0;i<l.length;i++)if(a=l[i],a.e.isComplex){for(n=t.clone(),n.queries=[],o=0;o<a.e.predicates.length;o++)n.queries.push({fn:"onWhere",e:a.e.predicates[o],filter:t.queries.filter});c+=a.e.condition+this.generateKey(e,n)}else c+=a.e.field+a.e.operator+a.e.value;return c},processQuery:function(e,i){var a,n,o=this.generateKey(e.dataSource.url,i);return window.localStorage&&(a=t.parseJSON(window.localStorage.getItem(this.guidId))),n=a?a.results[a.keys.indexOf(o)]:null,null==n||this._crudAction||this._insertAction?(this._crudAction=null,this._insertAction=null,this.cacheAdaptor.processQuery.apply(this.cacheAdaptor,[].slice.call(arguments,0))):n},processResponse:function(i,a,n,o,s,r){var l;if(this._insertAction||s&&this.cacheAdaptor.options.batch&&s.url.endsWith(this.cacheAdaptor.options.batch)&&"post"===s.type.toLowerCase())return this.cacheAdaptor.processResponse(i,a,n,o,s,r);var i=this.cacheAdaptor.processResponse.apply(this,[].slice.call(arguments,0)),d=this.generateKey(a.dataSource.url,n),h={};for(window.localStorage&&(h=t.parseJSON(window.localStorage.getItem(this.guidId))),l=e.inArray(d,h.keys),-1!=l&&(h.results.splice(l,1),h.keys.splice(l,1)),h.results[h.keys.push(d)-1]={keys:d,result:i.result,timeStamp:new Date,count:i.count};h.results.length>this.pageSize;)h.results.splice(0,1),h.keys.splice(0,1);return window.localStorage.setItem(this.guidId,JSON.stringify(h)),i},update:function(e,t,i,a){return this._crudAction=!0,this.cacheAdaptor.update(e,t,i,a)},insert:function(e,t,i){return this._insertAction=!0,this.cacheAdaptor.insert(e,t,i)},remove:function(e,t,i,a){return this._crudAction=!0,this.cacheAdaptor.remove(e,t,i,a)},batchRequest:function(e,t,i){return this.cacheAdaptor.batchRequest(e,t,i)}});var f=function(e,t){return e.filter(function(e){return e.fn===t})||[]},v=function(e,t){for(var i=e.filter(function(e){return-1!==t.indexOf(e.fn)}),a={},n=0;n<i.length;n++)a[i[n].fn]||(a[i[n].fn]=i[n].e);return a},_=function(e,t,i,a){if(e[t]){var n=e[t](i,a);c(n)||(i=n)}return i};t.ODataAdaptor=(new t.UrlAdaptor).extend({options:{requestType:"get",accept:"application/json;odata=light;q=1,application/json;odata=verbose;q=0.5",multipartAccept:"multipart/mixed",sortBy:"$orderby",select:"$select",skip:"$skip",take:"$top",count:"$inlinecount",where:"$filter",expand:"$expand",batch:"$batch",changeSet:"--changeset_",batchPre:"batch_",contentId:"Content-Id: ",batchContent:"Content-Type: multipart/mixed; boundary=",changeSetContent:"Content-Type: application/http\nContent-Transfer-Encoding: binary ",batchChangeSetContentType:"Content-Type: application/json; charset=utf-8 "},onEachWhere:function(e,t){return e.isComplex?this.onComplexPredicate(e,t):this.onPredicate(e,t)},_typeStringQuery:function(e,i,a,n,o){return-1!=a.indexOf("'")&&(a=a.replace(new RegExp(/'/g),"''")),a="'"+a+"'",i&&(n="cast("+n+", 'Edm.String')"),t.isGUID(a)&&(o="guid"),e.ignoreCase&&(o?n:n="tolower("+n+")",a=a.toLowerCase()),{val:a,guid:o,field:n}},onPredicate:function(e,i,a){var n,o,s,r,l,d,h="",c=e.value,u=typeof c,g=this._p(e.field);if(c instanceof Date&&(c="datetime'"+p.replacer(c).toJSON()+"'"),"string"===u&&(r=this._typeStringQuery(e,a,c,g,o),c=r.val,g=r.field,o=r.guid),n=t.data.odBiOperator[e.operator],""!=e.anyCondition&&n)return h+=c.table,h+="/"+e.anyCondition,h+="(d:d/",h+=g,h+=n,h+=c.value,h+")";if("in"==e.operator||"notin"==e.operator){for(s=0;s<c.length;s++)r=this._typeStringQuery(e,a,c[s],g,o),c[s]=r.val,g=r.field,h+=g,h+=n,h+=c[s],s!=c.length-1&&(h+="in"==e.operator?" or ":" and ");return h}return n?(h+=g,h+=n,o&&(h+=o),h+c):(n=t.data.odUniOperator[e.operator],n&&"string"===u?("substringof"===n&&(l=c,c=g,g=l),h+=n+"(",h+=g+",",o&&(h+=o),h+=c+")","notcontains"==e.operator&&(h+=" eq false"),""!=e.anyCondition&&n?(d+=c.table,d+="/"+e.anyCondition,d+="(d:d/",h+=h,d+")"):h):"")},onComplexPredicate:function(e,t){for(var i=[],a=0;a<e.predicates.length;a++)i.push("("+this.onEachWhere(e.predicates[a],t)+")");return i.join(" "+e.condition+" ")},onWhere:function(e){return this.pvt.searches&&e.push(this.onEachWhere(this.pvt.searches,null,!0)),e.join(" and ")},onEachSearch:function(e){var i,a;for(0===e.fields.length&&u("Query() - Search : oData search requires list of field names to search"),i=this.pvt.searches||[],a=0;a<e.fields.length;a++)i.push(new t.Predicate(e.fields[a],e.operator,e.key,e.ignoreCase));this.pvt.searches=i},onSearch:function(){return this.pvt.searches=t.Predicate.or(this.pvt.searches),""},onEachSort:function(e){var t,i=[];if(e.name instanceof Array)for(t=0;t<e.name.length;t++)i.push(this._p(e.name[t]));else i.push(this._p(e.name)+("descending"===e.direction?" desc":""));return i.join(",")},onSortBy:function(e){return e.reverse().join(",")},onGroup:function(e){return this.pvt.groups=e,""},onSelect:function(e){for(var t=0;t<e.length;t++)e[t]=this._p(e[t]);return e.join(",")},onAggregates:function(e){return this.pvt.aggregates=e,""},onCount:function(e){return e===!0?"allpages":""},beforeSend:function(e,t,i){i.url.endsWith(this.options.batch)&&"post"===i.type.toLowerCase()&&(t.setRequestHeader("Accept",m.multipartAccept),t.setRequestHeader("DataServiceVersion","2.0"),t.overrideMimeType("text/plain; charset=x-user-defined")),e.dataSource.crossDomain||(t.setRequestHeader("DataServiceVersion","2.0"),t.setRequestHeader("MaxDataServiceVersion","2.0"))},processResponse:function(i,a,n,o,s,r){var l,d,h,u,g,m,f,v,_,y;if(!t.isNullOrUndefined(i.d)&&(l=n&&n._requiresCount?i.d.results:i.d,!t.isNullOrUndefined(l)))for(_=0;_<l.length;_++)t.isNullOrUndefined(l[_].__metadata)||delete l[_].__metadata;if(d=s&&s.ejPvtData,o&&o.getResponseHeader("Content-Type")&&-1!=o.getResponseHeader("Content-Type").indexOf("xml")&&9==i.nodeType)return n._requiresCount?{result:[],count:0}:[];if(s&&this.options.batch&&s.url.endsWith(this.options.batch)&&"post"===s.type.toLowerCase()){if(h=o.getResponseHeader("Content-Type"),h=h.substring(h.indexOf("=batchresponse")+1),i=i.split(h),i.length<2)return;for(i=i[1],m=/(?:\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(i),i.replace(m[0],""),f=m[1],i=i.split(f),_=i.length;_>-1;_--)/\bContent-ID:/i.test(i[_])&&/\bHTTP.+201/.test(i[_])&&(u=parseInt(/\bContent-ID: (\d+)/i.exec(i[_])[1]),r.added[u]&&(g=p.parseJson(/^\{.+\}/m.exec(i[_])[0]),e.extend(r.added[u],this.processResponse(g))));return r}var b=o&&o.getResponseHeader("DataServiceVersion"),x=null,D={};if(b=b&&parseInt(b,10)||2,n&&n._requiresCount&&((i.__count||i["odata.count"])&&(x=i.__count||i["odata.count"]),i.d&&(i=i.d),(i.__count||i["odata.count"])&&(x=i.__count||i["odata.count"])),3===b&&i.value&&(i=i.value),i.d&&(i=i.d),3>b&&i.results&&(i=i.results),d&&d.aggregates&&d.aggregates.length){var C,w=d.aggregates,z={};for(_=0;_<w.length;_++)C=t.aggregates[w[_].type],C&&(z[w[_].field+" - "+w[_].type]=C(i,w[_].field));D=z}if(d&&d.groups&&d.groups.length)for(v=d.groups,_=0;_<v.length;_++)y=P(v[_],n.queries),i=t.group(i,v[_],d.aggregates,y);return c(x)?i:{result:i,count:x,aggregates:D}},convertToQueryString:function(e,t,i){var a,n=[],o=e.table||"";delete e.table,i.dataSource.requiresFormat&&(e.$format="json");for(a in e)n.push(a+"="+e[a]);return n=n.join("&"),i.dataSource.url&&-1!==i.dataSource.url.indexOf("?")&&!o?n:n.length?o+"?"+n:o||""},insert:function(e,t,i){return{url:e.dataSource.url.replace(/\/*$/,i?"/"+i:""),data:JSON.stringify(t)}},remove:function(e,t,i,a){return"string"==typeof i?{type:"DELETE",url:e.dataSource.url.replace(/\/*$/,a?"/"+a:"")+"('"+i+"')"}:{type:"DELETE",url:e.dataSource.url.replace(/\/*$/,a?"/"+a:"")+"("+i+")"}},update:function(e,t,i,a){return{type:"PUT",url:e.dataSource.url.replace(/\/*$/,a?"/"+a:"")+"("+i[t]+")",data:JSON.stringify(i),accept:this.options.accept}},batchRequest:function(e,i,a){var n=a.guid=t.getGuid(m.batchPre),o=e.dataSource.url.replace(/\/*$/,"/"+this.options.batch),s={url:a.url,key:a.key,cid:1,cSet:t.getGuid(m.changeSet)},r="--"+n+"\n";return r+="Content-Type: multipart/mixed; boundary="+s.cSet.replace("--","")+"\n",this.pvt.changeSet=0,r+=this.generateInsertRequest(i.added,s),r+=this.generateUpdateRequest(i.changed,s),r+=this.generateDeleteRequest(i.deleted,s),r+=s.cSet+"--\n",r+="--"+n+"--",{type:"POST",url:o,contentType:"multipart/mixed; charset=UTF-8;boundary="+n,data:r}},generateDeleteRequest:function(e,t){var i,a;if(!e)return"";for(i="",a=0;a<e.length;a++)i+="\n"+t.cSet+"\n",i+=m.changeSetContent+"\n\n",i+="DELETE ",i+=t.url+"("+e[a][t.key]+") HTTP/1.1\n",i+="If-Match : * \n",i+="Accept: "+m.accept+"\n",i+="Content-Id: "+this.pvt.changeSet++ +"\n",i+=m.batchChangeSetContentType+"\n";return i+"\n"},generateInsertRequest:function(e,t){var i,a;if(!e)return"";for(i="",a=0;a<e.length;a++)i+="\n"+t.cSet+"\n",i+=m.changeSetContent+"\n\n",i+="POST ",i+=t.url+" HTTP/1.1\n",i+="Accept: "+m.accept+"\n",i+="Content-Id: "+this.pvt.changeSet++ +"\n",i+=m.batchChangeSetContentType+"\n\n",i+=JSON.stringify(e[a])+"\n";return i},generateUpdateRequest:function(e,t){var i,a;if(!e)return"";for(i="",a=0;a<e.length;a++)i+="\n"+t.cSet+"\n",i+=m.changeSetContent+"\n\n",i+="PUT ",i+=t.url+"("+e[a][t.key]+") HTTP/1.1\n",i+="If-Match : * \n",i+="Accept: "+m.accept+"\n",i+="Content-Id: "+this.pvt.changeSet++ +"\n",i+=m.batchChangeSetContentType+"\n\n",i+=JSON.stringify(e[a])+"\n\n";return i},_p:function(e){return e.replace(/\./g,"/")}}),t.ODataV4Adaptor=(new t.ODataAdaptor).extend({options:{requestType:"get",accept:"application/json;odata=light;q=1,application/json;odata=verbose;q=0.5",multipartAccept:"multipart/mixed",sortBy:"$orderby",select:"$select",skip:"$skip",take:"$top",count:"$count",search:"$search",where:"$filter",expand:"$expand",batch:"$batch",changeSet:"--changeset_",batchPre:"batch_",contentId:"Content-Id: ",batchContent:"Content-Type: multipart/mixed; boundary=",changeSetContent:"Content-Type: application/http\nContent-Transfer-Encoding: binary ",batchChangeSetContentType:"Content-Type: application/json; charset=utf-8 "},onCount:function(e){return e===!0?"true":""},onPredicate:function(e,i,a){var n="",o=e.value,s=o instanceof Date;return t.data.odUniOperator.contains="contains",n=t.ODataAdaptor.prototype.onPredicate.call(this,e,i,a),t.data.odUniOperator.contains="substringof",s&&(n=n.replace(/datetime'(.*)'$/,"$1")),n},onEachSearch:function(e){var t=this.pvt.search||[];t.push(e.key),this.pvt.search=t},onSearch:function(){return this.pvt.search.join(" OR ")},beforeSend:function(){},processQuery:function(e,i){for(var a,n,o=/\/[\d*\/]*/g,s="",r=i._expands.length-1;r>0;r--)if(s.indexOf(i._expands[r])>=0)i._expands.pop();else if(o.test(i._expands[r])){for(s=i._expands.pop(),a=s.replace(o,"($expand="),n=0;n<s.split(o).length-1;n++)a+=")";i._expands.unshift(a),r++}return t.ODataAdaptor.prototype.processQuery.apply(this,[e,i])},processResponse:function(i,a,n,o,s,r){var l,d,h,u,g,m,f,v,_,y,b=s&&s.ejPvtData;if(o&&o.getResponseHeader("Content-Type")&&-1!=o.getResponseHeader("Content-Type").indexOf("xml")&&9==i.nodeType)return n._requiresCount?{result:[],count:0}:[];if(s&&this.options.batch&&s.url.endsWith(this.options.batch)&&"post"===s.type.toLowerCase()){if(l=o.getResponseHeader("Content-Type"),l=l.substring(l.indexOf("=batchresponse")+1),i=i.split(l),
i.length<2)return;for(i=i[1],u=/(?:\bContent-Type.+boundary=)(changesetresponse.+)/i.exec(i),i.replace(u[0],""),g=u[1],i=i.split(g),_=i.length;_>-1;_--)/\bContent-ID:/i.test(i[_])&&/\bHTTP.+201/.test(i[_])&&(d=parseInt(/\bContent-ID: (\d+)/i.exec(i[_])[1]),r.added[d]&&(h=p.parseJson(/^\{.+\}/m.exec(i[_])[0]),e.extend(r.added[d],this.processResponse(h))));return r}if(m=null,f={},n&&n._requiresCount&&"@odata.count"in i&&(m=i["@odata.count"]),i=t.isNullOrUndefined(i.value)?i:i.value,b&&b.aggregates&&b.aggregates.length){var x,D=b.aggregates,C={};for(_=0;_<D.length;_++)x=t.aggregates[D[_].type],x&&(C[D[_].field+" - "+D[_].type]=x(i,D[_].field));f=C}if(b&&b.groups&&b.groups.length)for(v=b.groups,_=0;_<v.length;_++)y=P(v[_],n.queries),i=t.group(i,v[_],b.aggregates,y);return c(m)?i:{result:i,count:m,aggregates:f}}}),t.JsonAdaptor=(new t.Adaptor).extend({processQuery:function(e,t){for(var i,n,o=e.dataSource.json.slice(0),s=o.length,r=!0,l={},d=0;d<t.queries.length;d++)n=t.queries[d],i=this[n.fn].call(this,o,n.e,t),"onAggregates"==n.fn?l[n.e.field+" - "+n.e.type]=i:o=i!==a?i:o,("onPage"===n.fn||"onSkip"===n.fn||"onTake"===n.fn||"onRange"===n.fn)&&(r=!1),r&&(s=o.length);return t._requiresCount&&(o={result:o,count:s,aggregates:l}),o},batchRequest:function(e,t,i){for(var a=0;a<t.added.length;a++)this.insert(e,t.added[a]);for(a=0;a<t.changed.length;a++)this.update(e,i.key,t.changed[a]);for(a=0;a<t.deleted.length;a++)this.remove(e,i.key,t.deleted[a]);return t},onWhere:function(e,t){return e?e.filter(function(e){return t.validate(e)}):e},onAggregates:function(e,i){var a=t.aggregates[i.type];return e&&a&&0!=e.length?a(e,i.field):null},onSearch:function(e,i){return e&&e.length?(0===i.fieldNames.length&&t.pvt.getFieldList(e[0],i.fieldNames),e.filter(function(e){for(var a=0;a<i.fieldNames.length;a++)if(i.comparer.call(e,t.pvt.getObject(i.fieldNames[a],e),i.searchKey,i.ignoreCase))return!0;return!1})):e},onSortBy:function(e,i,a){var o,s,r;if(!e)return e;if(s=n(i.fieldName,a),!s)return e.sort(i.comparer);if(s instanceof Array){for(s=s.slice(0),r=s.length-1;r>=0;r--)s[r]&&(o=i.comparer,s[r].endsWith(" desc")&&(o=t.pvt.fnSort(t.sortOrder.Descending),s[r]=s[r].replace(" desc","")),e=S(e,s[r],o,[]));return e}return S(e,s,i.comparer,a?a.queries:[])},onGroup:function(e,i,a){var o,s,r,l,d;if(!e)return e;if(o=f(a.queries,"onAggregates"),s=[],o.length)for(l=0;l<o.length;l++)r=o[l].e,s.push({type:r.type,field:n(r.field,a)});return d=P(i.fieldName,a.queries),t.group(e,n(i.fieldName,a),s,d)},onPage:function(e,t,i){var a=n(t.pageSize,i),o=(n(t.pageIndex,i)-1)*a,s=o+a;return e?e.slice(o,s):e},onRange:function(e,t){return e?e.slice(n(t.start),n(t.end)):e},onTake:function(e,t){return e?e.slice(0,n(t.nos)):e},onSkip:function(e,t){return e?e.slice(n(t.nos)):e},onSelect:function(e,i){return e?t.select(e,n(i.fieldNames)):e},insert:function(e,t){return e.dataSource.json.push(t)},remove:function(e,i,a){var n,o=e.dataSource.json;for("object"==typeof a&&(a=t.getObject(i,a)),n=0;n<o.length&&t.getObject(i,o[n])!==a;n++);return n!==o.length?o.splice(n,1):null},update:function(i,a,n){for(var o=i.dataSource.json,s=t.getObject(a,n),r=0;r<o.length&&t.getObject(a,o[r])!==s;r++);return r<o.length?e.extend(o[r],n):null}}),t.ForeignKeyAdaptor=function(i,n){var o=(new t[n||"JsonAdaptor"]).extend({init:function(){var e,a;for(this.foreignData=[],this.key=[],this.adaptorType=n,this.value=[],this.fValue=[],this.keyField=[],e=i,a=0;a<e.length;a++)this.foreignData[a]=e[a].dataSource,this.key[a]=e[a].foreignKeyField,this.fValue[a]=t.isNullOrUndefined(e[a].field)?e[a].foreignKeyValue:e[a].field+"_"+e[a].foreignKeyValue,this.value[a]=e[a].foreignKeyValue,this.keyField[a]=e[a].field||e[a].foreignKeyField,this.initial=!0},processQuery:function(e,i){var a,n,o,s=e.dataSource.json;if(this.initial){for(a=0;a<s.length;a++)for(n=this,o=0;o<this.foreignData.length;o++)this.foreignData[o].filter(function(e){t.getObject(n.key[o],e)==t.getObject(n.keyField[o],s[a])&&(s[a][n.fValue[o]]=t.getObject(n.value[o],e))});this.initial=!1}return this.base.processQuery.apply(this,[e,i])},setValue:function(i){for(var n,o,s,r=0;r<this.foreignData.length;r++)n=this,o=i[this.fValue[r]],"string"!=typeof o||isNaN(o)||(o=t.parseFloat(o)),s=e.grep(n.foreignData[r],function(e){return e[n.value[r]]==o})[0],t.isNullOrUndefined(s)&&(s=e.grep(n.foreignData[r],function(e){return e[n.key[r]]==o})[0],t.getObject(this.value[r],s)!=a&&t.createObject(n.value[r],t.getObject(this.value[r],s),i)),t.getObject(this.value[r],s)!=a&&t.createObject(this.keyField[r],t.getObject(this.key[r],s),i)},insert:function(e,t,i){return this.setValue(t),{url:e.dataSource.insertUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify({value:t,table:i,action:"insert",antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""})}},update:function(e,i,a,n){return this.setValue(a),t.JsonAdaptor.prototype.update(e,i,a,n),{type:"POST",url:e.dataSource.updateUrl||e.dataSource.crudUrl||e.dataSource.url,data:JSON.stringify({value:a,action:"update",keyColumn:i,key:a[i],table:n,antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""})}}});return e.extend(this,new o),this},t.remoteSaveAdaptor=(new t.JsonAdaptor).extend({beforeSend:t.UrlAdaptor.prototype.beforeSend,insert:t.UrlAdaptor.prototype.insert,update:t.UrlAdaptor.prototype.update,remove:t.UrlAdaptor.prototype.remove,addParams:t.UrlAdaptor.prototype.addParams,batchRequest:function(e,t,i,a){var n={changed:t.changed,added:t.added,deleted:t.deleted,action:"batch",table:i.url,key:i.key,antiForgery:e.dataSource.antiForgery?e.antiForgeryToken().value:""};return a&&this.addParams({dm:e,query:a,params:a._params,reqParams:n}),{type:"POST",url:e.dataSource.batchUrl||e.dataSource.crudUrl||e.dataSource.url,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(n)}},processResponse:function(e,i,a,n,o,s,r){if(t.isNullOrUndefined(s))return e.d?e.d:e;e.d&&(e=e.d),e.added&&(s.added=e.added),e.changed&&(s.changed=e.changed),e.deleted&&(s.deleted=e.deleted);for(var l=0;l<s.added.length;l++)t.JsonAdaptor.prototype.insert(i,s.added[l]);for(l=0;l<s.changed.length;l++)t.JsonAdaptor.prototype.update(i,r,s.changed[l]);for(l=0;l<s.deleted.length;l++)t.JsonAdaptor.prototype.remove(i,r,s.deleted[l]);return e}}),t.WebApiAdaptor=(new t.ODataAdaptor).extend({insert:function(e,t){return{type:"POST",url:e.dataSource.url,data:JSON.stringify(t)}},remove:function(e,t,i){return{type:"DELETE",url:e.dataSource.url+"/"+i,data:JSON.stringify(i)}},update:function(e,t,i){return{type:"PUT",url:e.dataSource.url,data:JSON.stringify(i)}},batchRequest:function(i,a,n){var o=n.guid=t.getGuid(m.batchPre),s=[];return e.each(a.added,function(e,t){s.push("--"+o),s.push("Content-Type: application/http; msgtype=request",""),s.push("POST "+i.dataSource.insertUrl+" HTTP/1.1"),s.push("Content-Type: application/json; charset=utf-8"),s.push("Host: "+location.host),s.push("",t?JSON.stringify(t):"")}),e.each(a.changed,function(e,t){s.push("--"+o),s.push("Content-Type: application/http; msgtype=request",""),s.push("PUT "+i.dataSource.updateUrl+" HTTP/1.1"),s.push("Content-Type: application/json; charset=utf-8"),s.push("Host: "+location.host),s.push("",t?JSON.stringify(t):"")}),e.each(a.deleted,function(e,t){s.push("--"+o),s.push("Content-Type: application/http; msgtype=request",""),s.push("DELETE "+i.dataSource.removeUrl+"/"+t[n.key]+" HTTP/1.1"),s.push("Content-Type: application/json; charset=utf-8"),s.push("Host: "+location.host),s.push("",t?JSON.stringify(t):"")}),s.push("--"+o+"--",""),{type:"POST",url:i.dataSource.batchUrl||i.dataSource.crudUrl||i.dataSource.url,data:s.join("\r\n"),contentType:'multipart/mixed; boundary="'+o+'"'}},processResponse:function(e,i,a,n,o){var s,r,l,d=o&&o.ejPvtData;if(o&&"post"!=o.type.toLowerCase()){var h=n&&n.getResponseHeader("DataServiceVersion"),u=null,g={};if(h=h&&parseInt(h,10)||2,a&&a._requiresCount&&(c(e.Count)||(u=e.Count)),3>h&&e.Items&&(e=e.Items),d&&d.aggregates&&d.aggregates.length){var m,p=d.aggregates,f={};for(r=0;r<p.length;r++)m=t.aggregates[p[r].type],m&&(f[p[r].field+" - "+p[r].type]=m(e,p[r].field));g=f}if(d&&d.groups&&d.groups.length)for(s=d.groups,r=0;r<s.length;r++)l=P(s[r],a.queries),e=t.group(e,s[r],d.aggregates,l);return c(u)?e:{result:e,count:u,aggregates:g}}}}),n=function(e,t){return"function"==typeof e?e.call(t||{}):e},t.TableModel=function(i,a,n,o){var s,r,l,d;if(!O(this,t.TableModel))return new t.TableModel(a);for(O(a,Array)||u("ej.TableModel - Json Array is required"),s=[],l=h(x,this),d=0;d<a.length;d++)r=new t.Model(a[d],this),r.state="unchanged",r.on("stateChange",l),o&&r.computes(o),s.push(r);return this.name=i||"table1",this.rows=t.NotifierArray(s),this._deleted=[],this._events=e({}),this.dataManager=n,this._isDirty=!1,this},t.TableModel.prototype={on:function(e,t){this._events.on(e,t)},off:function(e,t){this._events.off(e,t)},setDataManager:function(e){this.dataManagar=e},saveChanges:function(){if(this.dataManager&&O(this.dataManager,t.DataManager)||u("ej.TableModel - saveChanges : Set the dataManager using setDataManager function"),this.isDirty()){var e=this.dataManager.saveChanges(this.getChanges(),this.key,this.name);e.done(h(function(e){for(var t=this.toArray(),i=0;i<t.length;i++)"added"===t.state&&t.set(this.key,e.added.filter(function(e){return e[this.key]===t.get(this.key)})[0][this.key]),t[i].markCommit();this._events.triggerHandler({type:"save",table:this})},this)),e.fail(h(function(e){this.rejectChanges(),this._events.triggerHandler({type:"reject",table:this,error:e})},this)),this._isDirty=!1}},rejectChanges:function(){for(var e=this.toArray(),t=0;t<e.length;t++)e[t].revert(!0);this._isDirty=!1,this._events.triggerHandler({type:"reject",table:this})},insert:function(e){var i=new t.Model(e);i._isDirty=this._isDirty=!0,this.rows.push(i),this._events.triggerHandler({type:"insert",model:i,table:this})},update:function(e){var t;this.key||u("TableModel - update : Primary key should be assigned to TableModel.key");var i,a=e,n=this.key,o=a[n];i=this.rows.array.filter(function(e){return e.get(n)===o}),i=i[0];for(t in a)i.set(t,a[t]);this._isDirty=!0,this._events.triggerHandler({type:"update",model:i,table:this})},remove:function(e){var t,i,n,o;for(this.key||u("TableModel - update : Primary key should be assigned to TableModel.key"),t=this.key,i=-1,e&&"object"==typeof e&&(e=e[t]!==a?e[t]:e.get(t)),o=0;o<this.rows.length();o++)if(this.rows.array[o].get(t)===e){i=o;break}i>-1&&(n=this.rows.removeAt(i),n.markDelete(),this._deleted.push({model:n,position:i}),this._isDirty=!0,this._events.triggerHandler({type:"remove",model:n,table:this}))},isDirty:function(){return this._isDirty},getChanges:function(){for(var e={added:[],changed:[]},i=this.toArray(),a=0;a<i.length;a++)e[i[a].state]&&e[i[a].state].push(i[a].json);return e.deleted=t.select(this._deleted,["model"]),e},toArray:function(){return this.rows.toArray()},setDirty:function(e,t){this._isDirty!==!!e&&(this._isDirty=!!e,this._events.triggerHandler({type:"dirty",table:this,model:t}))},get:function(e){return this.rows.array[e]},length:function(){return this.rows.array.length},bindTo:function(t){var i,a,n=o,r=e(t.html()),l=this.toArray();for(e.inArray(t.prop("tagName").toLowerCase(),["table","tbody"])&&(n=s),n.insertBefore(t),t.detach().empty(),a=0;a<l.length;a++)i=r.clone(),l[a].bindTo(i),t.append(i);t.insertAfter(n),n.remove()}},o=i?e(document.createElement("div")):{},s=i?e(document.createElement("tr")):{},t.Model=function(i,a,n){"string"==typeof a&&(n=a,a=null),this.$id=A("m"),this.json=i,this.table=a instanceof t.TableModel?a:null,this.name=n||this.table&&this.table.name,this.dataManager=a instanceof t.DataManager?a:a.dataManagar,this.actual={},this._events=e({}),this.isDirty=!1,this.state="added",this._props=[],this._computeEls={},this._fields={},this._attrEls={},this._updates={},this.computed={}},t.Model.prototype={computes:function(t){e.extend(this.computed,t)},on:function(e,t){this._events.on(e,t)},off:function(e,t){this._events.off(e,t)},set:function(e,t){var i,n,o=this.json,s=e;for(e=e.split("."),n=0;n<e.length-1;n++)e=e[0],o=o[e[0]];this.isDirty=!0,this.changeState("changed",{from:"set"}),i=o[e],this.actual[e]!==a||e in this.actual||(this.actual[e]=t),o[e]=t,this._updateValues(e,t),this._events.triggerHandler({type:s,current:t,previous:i,model:this})},get:function(e){return t.pvt.getObject(e,this.json)},revert:function(e){for(var t in this.actual)this.json[t]=this.actual[t];this.isDirty=!1,e?this.state="unchanged":this.changeState("unchanged",{from:"revert"})},save:function(i,a){return i=i||this.dataManagar,a=a||i.dataSource.key,i||u("ej.Model - DataManager is required to commit the changes"),"added"===this.state?i.insert(this.json,this.name).done(t.proxy(function(t){e.extend(this.json,t.record)},this)):"changed"===this.state?i.update(a,this.json,this.name):"deleted"===this.state?i.remove(a,this.json,this.name):void 0},markCommit:function(){this.isDirty=!1,this.changeState("unchanged",{from:"commit"})},markDelete:function(){this.changeState("deleted",{from:"delete"})},changeState:function(t,i){if(this.state!==t){if("added"===this.state){if("deleted"!==t)return;t="unchanged"}var a=t;i=i||{},this.state=t,this._events.triggerHandler(e.extend({type:"stateChange",current:t,previous:a,model:this},i))}},properties:function(){if(this._props.length)return this._props;for(var e in this.json)this._props.push(e),this._updates[e]={read:[],input:[]};return this._props},bindTo:function(t){var i,a,n,o,s=e(t),r=s.find("[ej-observe], [ej-computed], [ej-prop]"),l=r.length;for(s.data("ejModel",this),n={fields:[],props:[],computes:[]},o=0;l>o;o++)i=r.eq(o),a=i.attr("ej-prop"),a&&this._processAttrib(a,i,n),a=i.attr("ej-observe"),a&&-1!==this._props.indexOf(a)?this._processField(i,a,n):(a=i.attr("ej-computed"))&&this._processComputed(a,i,n);s.data("ejModelBinding"+this.$id,n)},unbind:function(t){var i,a,n,o,s,r,l,d={props:this._attrEls,computes:this._computeEls},h=!1;t&&(d=e(t).removeData("ejModel").data("ejModelBinding"+this.$id)||d,h=!0);for(a in this.computed)i=d.computes[a],a=this.computed[a],i&&a.deps&&(this.off(a.deps.join(" "),i.handle),h&&delete this._computeEls[a]);h||(this._computeEls={});for(a in d.props)i=d.props[a],i&&(this.off(i.deps.join(" "),i.handle),delete d.props[a],h&&delete this._attrEls[a]);if(h||(this._attrEls={}),d.fields&&d.fields.length)for(n=d.fields.length,l=0;n>l;l++)o=d.fields[l],e(o).off("change",null,this._changeHandler),r=-1!==this.formElements.indexOf(o.tagName.toLowerCase())?"input":"read",s=this._updates[r].indexOf(o),-1!==s&&this._updates[r].splice(s,1)},_processComputed:function(e,t,i){if(e){var a,n,o=b(e),s=-1!==this.formElements.indexOf(t[0].tagName.toLowerCase())?"val":"html";this.computed[e]&&this.computed[o]||(this.computed[o]={value:new Function("var e = this; return "+e),deps:this._generateDeps(e)},e=o),a=this.computed[e],a.get||(a.get=function(){a.value.call(this.json)}),n=a.deps,a=a.value,this._updateDeps(n),this._updateElement(t,s,a),a={el:t,handle:h(this._computeHandle,this,{value:e,type:s})},this._computeEls[e]=a,i.computes[e]=a,this.on(n.join(" "),a.handle)}},_computeHandle:function(e){var t=this._computeEls[e.value];t&&this.computed[e.value]&&this._updateElement(t.el,e.type,this.computed[e.value].value)},_updateElement:function(t,i,a){t[i](a.call(e.extend({},this.json,this.computed)))},_updateDeps:function(e){for(var i=0;i<e.length;i++)!(e[i]in this.json)&&e[i]in this.computed&&t.merge(e,this.computed[e[i]].deps)},_generateDeps:function(e){for(var t,i=e.replace(/(^e\.)|( e\.)/g,"#%^*##ej.#").split("#%^*#"),a=[],n=0;n<i.length;n++)i[n].startsWith("#ej.#")&&(t=i[n].replace("#ej.#","").split(" ")[0],t&&-1!==this._props.indexOf(t)&&a.push(t));return a},_processAttrib:function(e,t,i){var a,n,o,s,r={};for(e=e.replace(/^ +| +$/g,"").split(";"),o=0;o<e.length;o++)e[o]=e[o].split(":"),e[o].length<2||(a=e[o][0].replace(/^ +| +$/g,"").replace(/^'|^"|'$|"$/g,""),r[a]=e[o][1].replace(/^ +| +$/g,"").replace(/^'|^"|'$|"$/g,""));e=r,s=[];for(a in e)s.push(e[a]);this._updateDeps(s),this._updateProps(t,e),r=A("emak"),n={el:t,handle:h(this._attrHandle,this,r),value:e,deps:s},t.prop("ejmodelattrkey",r),i.props[r]=n,this._attrEls[r]=n,this.on(s.join(" "),n.handle)},_attrHandle:function(e){var t=this._attrEls[e];t&&this._updateProps(t.el,t.value)},_updateProps:function(t,i){var a,n=this.json,o=this.computed;for(var s in i)a=i[s],a in n?a=n[a]:a in o&&(a=o[a],a&&(a=a.value.call(e.extend({},this.json,o)))),c(a)||t.prop(s,a)},_updateValues:function(e,t){var i=this._updates[e];i&&(i.read||i.input)&&(this._ensureItems(i.read,"html",t),this._ensureItems(i.input,"val",t))},_ensureItems:function(t,i,a){if(t)for(var n=t.length-1;n>-1;n--)t[n].offsetParent?e(t[n])[i](a):t.splice(n,1)},_changeHandler:function(t){t.data.self.set(t.data.prop,e(this).val())},_processField:function(e,t,i){var a={self:this,prop:t},n=this.get(t);return i.fields.push(e[0]),-1===this.formElements.indexOf(e[0].tagName.toLowerCase())?(e.html(n),this._updates[t].read.push(e[0])):(e.val(n).off("change",null,this._changeHandler).on("change",null,a,this._changeHandler),this._updates[t].input.push(e[0]))},formElements:["input","select","textarea"]};var y=/[^\w]+/g,b=function(e){return e.replace(y,"_")},x=function(e){this.setDirty(!0,e.model)};if(t.Predicate=function(e,i,a,n){if(!(this instanceof t.Predicate))return new t.Predicate(e,i,a,n);if("string"==typeof e){var o="";-1!=i.toLowerCase().indexOf(" any")?(i=i.replace(" any",""),o="any"):-1!=i.toLowerCase().indexOf(" all")&&(i=i.replace(" all",""),o="all"),this.field=e,this.operator=i,this.value=a,this.ignoreCase=n,this.isComplex=!1,this.anyCondition=o,this._comparer=t.data.fnOperators.processOperator(""!=o?o:this.operator)}else(e instanceof t.Predicate&&a instanceof t.Predicate||a instanceof Array)&&(this.isComplex=!0,this.condition=i.toLowerCase(),this.predicates=[e],a instanceof Array?[].push.apply(this.predicates,a):this.predicates.push(a));return this},t.Predicate.and=function(){return r._combinePredicates([].slice.call(arguments,0),"and")},t.Predicate.or=function(){return r._combinePredicates([].slice.call(arguments,0),"or")},t.Predicate.fromJSON=function(e){var t,i,a;if(O(e,Array)){for(t=[],i=0,a=e.length;a>i;i++)t.push(r._fromJSON(e[i]));return t}return r._fromJSON(e)},r={_combinePredicates:function(e,i){if(!e.length)return a;if(1===e.length){if(!O(e[0],Array))return e[0];e=e[0]}return new t.Predicate(e[0],i,e.slice(1))},_combine:function(e,i,a,n,o,s){return i instanceof t.Predicate?t.Predicate[o](e,i):"string"==typeof i?t.Predicate[o](e,new t.Predicate(i,a,n,s)):u("Predicate - "+o+" : invalid arguments")},_fromJSON:function(e){var i;if(!e||O(e,t.Predicate))return e;var a=e.predicates||[],n=a.length,o=[];for(i=0;n>i;i++)o.push(r._fromJSON(a[i]));return e.isComplex?new t.Predicate(o[0],e.condition,o.slice(1)):new t.Predicate(e.field,e.operator,t.parseJSON({val:e.value}).val,e.ignoreCase)}},t.Predicate.prototype={and:function(e,t,i,a){return r._combine(this,e,t,i,"and",a)},or:function(e,t,i,a){return r._combine(this,e,t,i,"or",a)},validate:function(e){var i,a,n,o=this.predicates;if(!this.isComplex)return this._comparer.call(this,t.pvt.getObject(this.field,e),this.value,this.ignoreCase);for(i="and"===this.condition,n=0;n<o.length;n++)if(a=o[n].validate(e),i){if(!a)return!1}else if(a)return!0;return i},toJSON:function(){var e,t,i;if(this.isComplex)for(e=[],t=this.predicates,i=0;i<t.length;i++)e.push(t[i].toJSON());return{isComplex:this.isComplex,field:this.field,operator:this.operator,value:this.value,ignoreCase:this.ignoreCase,condition:this.condition,predicates:e,anyCondition:this.anyCondition}}},t.dataUtil={swap:function(e,t,i){if(t!=i){var a=e[t];e[t]=e[i],e[i]=a}},mergeSort:function(e,i,a){return a&&"string"!=typeof a||(a=t.pvt.fnSort(a,!0)),"function"==typeof i&&(a=i,i=null),t.pvt.mergeSort(e,i,a)},max:function(e,i,a){return"function"==typeof i&&(a=i,i=null),t.pvt.getItemFromComparer(e,i,a||t.pvt.fnDescending)},min:function(e,i,a){return"function"==typeof i&&(a=i,i=null),t.pvt.getItemFromComparer(e,i,a||t.pvt.fnAscending)},distinct:function(e,t,i){for(var a,n=[],o={},s=0;s<e.length;s++)a=L(e,t,s),a in o||(n.push(i?e[s]:a),o[a]=1);return n},sum:function(e,t){for(var i,a=0,n="number"!=typeof L(e,t,0),o=0;o<e.length;o++)i=L(e,t,o),isNaN(i)||null===i||(n&&(i=+i),a+=i);return a},avg:function(e,i){return t.sum(e,i)/e.length},select:function(e,i){for(var a=[],n=0;n<e.length;n++)a.push(t.pvt.extractFields(e[n],i));return a},group:function(i,a,n,o,s,r){var l,d,h,c,u,g,m,p,f,v;if(s=s||1,i.GROUPGUID==t.pvt.consts.GROUPGUID){for(f=0;f<i.length;f++)t.isNullOrUndefined(r)?(i[f].items=t.group(i[f].items,a,n,o,i.level+1),i[f].count=i[f].items.length):(l=-1,v=e.grep(r,function(e){return e.key==i[f].key}),l=r.indexOf(v[0]),i[f].items=t.group(i[f].items,a,n,o,i.level+1,r[l].items),i[f].count=r[l].count);return i.childLevels+=1,i}for(d={},h=[],h.GROUPGUID=t.pvt.consts.GROUPGUID,h.level=s,h.childLevels=0,h.records=i,g=0;g<i.length;g++)c=L(i,a,g),t.isNullOrUndefined(o)||(c=o(c,a)),d[c]||(d[c]={key:c,count:0,items:[],aggregates:{},field:a},h.push(d[c]),t.isNullOrUndefined(r)||(u=e.grep(r,function(e){return e.key==d[c].key}),d[c].count=u[0].count)),d[c].count=t.isNullOrUndefined(r)?d[c].count+=1:d[c].count,d[c].items.push(i[g]);if(n&&n.length)for(g=0;g<h.length;g++){for(m={},f=0;f<n.length;f++)p=t.aggregates[n[f].type],t.isNullOrUndefined(r)?p&&(m[n[f].field+" - "+n[f].type]=p(h[g].items,n[f].field)):(v=e.grep(r,function(e){return e.key==h[g].key}),p&&(m[n[f].field+" - "+n[f].type]=p(v[0].items,n[f].field)));h[g].aggregates=m}return h},parseTable:function(i,a,n){var o,s,r,l,d,h,c,u=i.rows,g=[],m=[];if(!u.length)return[];switch(n=n||0,(a||"").toLowerCase()){case t.headerOption.tHead:o=i.tHead.rows[n];break;case t.headerOption.row:default:o=i.rows[n]}for(r=o.cells,s=0;s<r.length;s++)g.push(e.trim(r[s].innerHTML));for(s=n+1;s<u.length;s++){for(l={},d=u[s].cells,h=0;h<d.length;h++)c=d[h].innerHTML,l[g[h]]="string"==typeof c&&e.isNumeric(c)?Number(c):c;m.push(l)}return m}},t.headerOption={tHead:"thead",row:"row"},t.aggregates={sum:function(e,i){return t.sum(e,i)},average:function(e,i){return t.avg(e,i)},minimum:function(e,i){return t.getObject(i,t.min(e,i))},maximum:function(e,i){return t.getObject(i,t.max(e,i))},truecount:function(e,i){var a=t.Predicate(i,"equal",!0);return t.DataManager(e).executeLocal(t.Query().where(a)).length},falsecount:function(e,i){var a=t.Predicate(i,"equal",!1);return t.DataManager(e).executeLocal(t.Query().where(a)).length},count:function(e){return e.length}},t.pvt={filterQueries:f,mergeSort:function(e,i,a){if(e.length<=1)return e;var n=parseInt(e.length/2,10),o=e.slice(0,n),s=e.slice(n);return o=t.pvt.mergeSort(o,i,a),s=t.pvt.mergeSort(s,i,a),t.pvt.merge(o,s,i,a)},getItemFromComparer:function(e,i,a){var n,o,s,r=0,l="string"==typeof L(e,i,0);if(e.length)for(;t.isNullOrUndefined(n)&&r<e.length;)n=L(e,i,r),s=e[r++];for(;r<e.length;r++)o=L(e,i,r),t.isNullOrUndefined(o)||(l&&(n=+n,o=+o),a(n,o)>0&&(n=o,s=e[r]));return s},quickSelect:function(e,i,a,n,o,s){if(a==n)return e[a];var r=t.pvt.partition(e,i,a,n,s),l=r-a+1;return l==o?e[r]:l>o?t.pvt.quickSelect(e,i,a,r-1,o,s):t.pvt.quickSelect(e,i,r+1,n,o-l,s)},extractFields:function(e,i){var a,n={};if(1==i.length)return t.pvt.getObject(i[0],e);for(a=0;a<i.length;a++)n[i[a].replace(".",t.pvt.consts.complexPropertyMerge)]=t.pvt.getObject(i[a],e);return n},partition:function(e,i,a,n,o){var s,r=parseInt((a+n)/2,10),l=L(e,i,r);for(t.swap(e,r,n),r=a,s=a;n>s;s++)o(L(e,i,s),l)&&(t.swap(e,s,r),r++);return t.swap(e,r,n),r},fnSort:function(e){return e=e?e.toLowerCase():t.sortOrder.Ascending,e==t.sortOrder.Ascending?t.pvt.fnAscending:t.pvt.fnDescending},fnGetComparer:function(e,i){return function(a,n){return i(t.pvt.getObject(e,a),t.pvt.getObject(e,n))}},fnAscending:function(e,t){return null===t||t===a?-1:"string"==typeof e?e.localeCompare(t):null===e||e===a?1:e-t},fnDescending:function(e,t){return null===t||t===a?1:"string"==typeof e?-1*e.localeCompare(t):null===e||e===a?-1:t-e},merge:function(e,t,i,a){for(var n,o=[];e.length>0||t.length>0;)n=e.length>0&&t.length>0?a?a(L(e,i,0),L(t,i,0))<=0?e:t:e[0][i]<e[0][i]?e:t:e.length>0?e:t,o.push(n.shift());return o},getObject:function(e,t){var i,n,o;if(!t)return a;if(!e)return t;if(-1===e.indexOf("."))return t[e];for(i=t,n=e.split("."),o=0;o<n.length&&null!=i;o++)i=i[n[o]];return i},createObject:function(e,t,i){for(var n=e.split("."),o=i||window,s=o,r=0;r<n.length;r++)r+1==n.length?s[n[r]]=t===a?{}:t:null==s[n[r]]&&(s[n[r]]={}),s=s[n[r]];return o},getFieldList:function(e,i,n){if(n===a&&(n=""),i===a||null===i)return t.pvt.getFieldList(e,[],n);for(var o in e)"object"!=typeof e[o]||e[o]instanceof Array?i.push(n+o):t.pvt.getFieldList(e[o],i,n+o+".");return i}},t.FilterOperators={lessThan:"lessthan",greaterThan:"greaterthan",lessThanOrEqual:"lessthanorequal",greaterThanOrEqual:"greaterthanorequal",equal:"equal",contains:"contains",startsWith:"startswith",endsWith:"endswith",notEqual:"notequal"},t.data={},t.data.operatorSymbols={"<":"lessthan",">":"greaterthan","<=":"lessthanorequal",">=":"greaterthanorequal","==":"equal","!=":"notequal","*=":"contains","$=":"endswith","^=":"startswith"},t.data.odBiOperator={"<":" lt ",">":" gt ","<=":" le ",">=":" ge ","==":" eq ","!=":" ne ",lessthan:" lt ",lessthanorequal:" le ",greaterthan:" gt ",greaterthanorequal:" ge ",equal:" eq ",notequal:" ne ","in":" eq ",notin:" ne "},t.data.odUniOperator={"$=":"endswith","^=":"startswith","*=":"substringof",endswith:"endswith",startswith:"startswith",contains:"substringof",notcontains:"substringof"},t.data.fnOperators={equal:function(e,t,i){return i?j(e)==j(t):e==t},notequal:function(e,i,a){return!t.data.fnOperators.equal(e,i,a)},notin:function(e,i,a){for(var n=0;n<i.length;n++)if(0==t.data.fnOperators.notequal(e,i[n],a))return!1;return!0},lessthan:function(e,t,i){return i?j(e)<j(t):t>e},greaterthan:function(e,t,i){return i?j(e)>j(t):e>t},lessthanorequal:function(e,t,i){return i?j(e)<=j(t):t>=e},greaterthanorequal:function(e,t,i){return i?j(e)>=j(t):e>=t},contains:function(e,t,i){return i?!c(e)&&!c(t)&&-1!=j(e).indexOf(j(t)):!c(e)&&!c(t)&&-1!=e.toString().indexOf(t)},notcontains:function(e,i,a){return!t.data.fnOperators.contains(e,i,a)},notnull:function(e){return null!==e},isnull:function(e){return null===e},startswith:function(e,t,i){return i?e&&t&&j(e).startsWith(j(t)):e&&t&&e.startsWith(t)},endswith:function(e,t,i){return i?e&&t&&j(e).endsWith(j(t)):e&&t&&e.endsWith(t)},all:function(e,i,a){for(var n=0;n<i.length;n++)if(0==t.data.fnOperators[this.operator](e,i[n],a))return!1;return!0},any:function(e,i,a){for(var n=0;n<i.length;n++)if(1==t.data.fnOperators[this.operator](e,i[n],a))return!0;return!1},processSymbols:function(e){var i,a=t.data.operatorSymbols[e];return a&&(i=t.data.fnOperators[a])?i:u("Query - Process Operator : Invalid operator")},processOperator:function(e){var i=t.data.fnOperators[e];return i?i:t.data.fnOperators.processSymbols(e)}},t.data.fnOperators["in"]=function(e,i,a){for(var n=0;n<i.length;n++)if(1==t.data.fnOperators.equal(e,i[n],a))return!0;return!1},t.NotifierArray=function(i){return O(this,t.NotifierArray)?(this.array=i,this._events=e({}),this._isDirty=!1,this):new t.NotifierArray(i)},t.NotifierArray.prototype={on:function(e,t){this._events.on(e,t)},off:function(e,t){this._events.off(e,t)},push:function(e){var t;return t=O(e,Array)?[].push.apply(this.array,e):this.array.push(e),this._raise("add",{item:e,index:this.length()-1}),t},pop:function(){var e=this.array.pop();return this._raise("remove",{item:e,index:this.length()-1}),e},addAt:function(e,t){return this.array.splice(e,0,t),this._raise("add",{item:t,index:e}),t},removeAt:function(e){var t=this.array.splice(e,1)[0];return this._raise("remove",{item:t,index:e}),t},remove:function(e){var t=this.array.indexOf(e);return t>-1&&(this.array.splice(t,1),this._raise("remove",{item:e,index:t})),t},length:function(){return this.array.length},_raise:function(t,i){this._events.triggerHandler(e.extend({type:t},i)),this._events.triggerHandler({type:"all",name:t,args:i})},toArray:function(){return this.array}},e.extend(t,t.dataUtil),Array.prototype.forEach=Array.prototype.forEach||function(e,t){for(var i=0,a=this.length;a>i;++i)e.call(t,this[i],i,this)},Array.prototype.indexOf=Array.prototype.indexOf||function(e){var t,i=this.length;if(0===i)return-1;for(t=0;i>t;t++)if(t in this&&this[t]===e)return t;return-1},Array.prototype.filter=Array.prototype.filter||function(e){var t,i,a,n;if("function"!=typeof e)throw new TypeError;for(t=[],i=arguments[1]||this,a=0;a<this.length;a++)n=this[a],e.call(i,n,a,this)&&t.push(n);return t},String.prototype.endsWith=String.prototype.endsWith||function(e){return this.slice(-e.length)===e},String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},t.support||(t.support={}),t.support.stableSort=function(){for(var e=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].sort(function(){return 0}),t=0;17>t;t++)if(t!==e[t])return!1;return!0}(),t.support.cors=e.support.cors,!e.support.cors&&window.XDomainRequest){var D=/^https?:\/\//i,C=/^get|post$/i,w=new RegExp("^"+location.protocol,"i"),z=/\/xml/i;e.ajaxTransport("text html xml json",function(e,t){if(e.crossDomain&&e.async&&C.test(e.type)&&D.test(t.url)&&w.test(t.url)){var i=null,n=(t.dataType||"").toLowerCase();return{send:function(o,s){i=new XDomainRequest,/^\d+$/.test(t.timeout)&&(i.timeout=t.timeout),i.ontimeout=function(){s(500,"timeout")},i.onload=function(){var e,t="Content-Length: "+i.responseText.length+"\r\nContent-Type: "+i.contentType,o={code:200,message:"success"},r={text:i.responseText};try{if("json"===n)try{r.json=JSON.parse(i.responseText)}catch(l){o.code=500,o.message="parseerror"}else if("xml"===n||"text"!==n&&z.test(i.contentType)){e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1;try{e.loadXML(i.responseText)}catch(l){e=a}if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)throw o.code=500,o.message="parseerror","Invalid XML: "+i.responseText;r.xml=e}}catch(d){throw d}finally{s(o.code,o.message,r,t)}},i.onerror=function(){s(500,"error",{text:i.responseText})},-1!=navigator.userAgent.indexOf("MSIE 9.0")&&(i.onprogress=function(){}),i.open(e.type,e.url),i.send(t.data)},abort:function(){i&&i.abort()}}}})}e.support.cors=!0,t.sortOrder={Ascending:"ascending",Descending:"descending"},t.pvt.consts={GROUPGUID:"{271bbba0-1ee7}",complexPropertyMerge:"_"},l=function(e,t){t&&(e=h(e,t)),(window.setImmediate||window.setTimeout)(e,0)},t.support.enableLocalizedSort=!1;var S=function(e,i,a,n){return t.support.stableSort?t.support.enableLocalizedSort||"string"!=typeof t.pvt.getObject(i,e[0]||{})||a!==t.pvt.fnAscending&&a!==t.pvt.fnDescending||1!==n.filter(function(e){return"onSortBy"===e.fn}).length?e.sort(t.pvt.fnGetComparer(i,a)):T(e,i,a===t.pvt.fnDescending):t.mergeSort(e,i,a)},P=function(i,a){for(var n=e.grep(a,function(e){return"onGroup"==e.fn}),o=0;o<n.length;o++)if(t.getObject("fieldName",n[o].e)==i)return t.getObject("fn",n[o].e)},T=function(e,i,a){var n=Object.prototype.toString;Object.prototype.toString=-1===i.indexOf(".")?function(){return this[i]}:function(){return t.pvt.getObject(i,this)},e=e.sort(),Object.prototype.toString=n,a&&e.reverse()},j=function(e){return e?e.toLowerCase?e.toLowerCase():e.toString().toLowerCase():0===e||e===!1?e.toString():""},L=function(e,i,a){return i?t.pvt.getObject(i,e[a]):e[a]},N=function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&1===e.nodeType&&"object"==typeof e&&"string"==typeof e.nodeName},O=function(e,t){return e instanceof t},M=function(e,i,a,n){return function(o){return"object"==typeof o&&(n=o,o=null),new t.TableModel(o||e,i,a,n)}},E=function(t){return function(i,a){var n,o,s,r,l;for(a=a||window.ko,a||u("Knockout is undefined"),o=[],l=0;l<t.length;l++){n={};for(s in t[l])s.startsWith("_")||(n[s]=a.observable(t[l][s]));for(s in i)r=i[s],e.isPlainObject(r)?(r.owner||(r.owner=n),r=a.computed(r)):r=a.computed(r,n),
n[s]=r;o.push(n)}return a.observableArray(o)}},k=0,A=function(e){return k+=1,e+k};t.getGuid=function(e){var t,i="0123456789abcdef";return(e||"")+"00000000-0000-4000-0000-000000000000".replace(/0/g,function(e,a){if("crypto"in window&&"getRandomValues"in crypto){var n=new Uint8Array(1);window.crypto.getRandomValues(n),t=n[0]%16|0}else t=16*Math.random()|0;return i[19===a?3&t|8:t]})},d=function(e,t){return function(){var i=[].slice.call(arguments,0);return i.push(this),e.apply(t||this,i)}},h=function(e,t,i){return"bind"in e?i?e.bind(t,i):e.bind(t):function(){var a=i?[i]:[];return a.push.apply(a,arguments),e.apply(t||this,a)}},t.merge=function(e,t){e&&t&&Array.prototype.push.apply(e,t)},c=function(e){return e===a||null===e},u=function(e){try{throw new Error(e)}catch(t){throw t.message+"\n"+t.stack}}}(window.jQuery,window.Syncfusion,window.document)}),function(e){"function"==typeof define&&define.amd?define(["./ej.core.min"],e):e()}(function(){!function(e,t,i){t.widget("ejDraggable","ej.Draggable",{element:null,model:null,validTags:["div","span","a"],defaults:{scope:"default",handle:null,dragArea:null,clone:!1,distance:1,dragOnTaphold:!1,cursorAt:{top:-1,left:-2},dragStart:null,drag:null,dragStop:null,create:null,destroy:null,helper:function(){return e('<div class="e-drag-helper" />').html("draggable").appendTo(document.body)}},_init:function(){this.handler=function(){},this.resizables={},this._wireEvents(),this._browser=t.browserInfo(),this._isIE8="msie"==this._browser.name&&"8.0"==this._browser.version,this._isIE9="msie"==this._browser.name&&"9.0"==this._browser.version,"msie"==this._browser.name&&this.element.addClass("e-pinch"),"edge"==this._browser.name&&this.element.css("touch-action","none")},_setModel:function(e){for(var t in e)switch(t){case"dragArea":this.model.dragArea=e[t];break;case"dragOnTaphold":this.model.dragOnTaphold=e[t]}},_destroy:function(){e(document).off(t.eventType.mouseUp,this._destroyHandler).off(t.eventType.mouseUp,this._dragStopHandler).off(t.eventType.mouseMove,this._dragStartHandler).off(t.eventType.mouseMove,this._dragHandler).off("mouseleave",this._dragMouseOutHandler).off("selectstart",!1),t.widgetBase.droppables[this.scope]=null},_initialize:function(i){var a,n;return i.target&&i.target.nodeName&&e(i.target).closest("input[type='text'], input[type='checkbox'], textarea, select, option").length?!0:(a=i,i.preventDefault(),i=this._getCoordinate(i),this.target=e(a.currentTarget),this._initPosition={x:i.pageX,y:i.pageY},e(document).on(t.eventType.mouseMove,this._dragStartHandler).on(t.eventType.mouseUp,this._destroyHandler),this.model.clone||(n=this.element.offset(),this._relXposition=i.pageX-n.left,this._relYposition=i.pageY-n.top),void e(document.documentElement).trigger(t.eventType.mouseDown,a))},_setDragArea:function(){var i,a,n,o,s,r,l,d=e(this.model.dragArea)[0];if(d){if(o=["left","right","bottom","top"],t.isNullOrUndefined(d.getBoundingClientRect)){for(i=e(this.model.dragArea).outerWidth(),a=e(this.model.dragArea).outerHeight(),l=0;l<o.length;l++)this["border-"+o[l]+"-width"]=0,this["padding-"+o[l]]=0;s=r=0}else{for(n=d.getBoundingClientRect(),i=n.width?n.width:n.right-n.left,a=n.height?n.height:n.bottom-n.top,l=0;l<o.length;l++)this["border-"+o[l]+"-width"]=isNaN(parseFloat(e(e(this.model.dragArea)[0]).css("border-"+o[l]+"-width")))?0:parseFloat(e(e(this.model.dragArea)[0]).css("border-"+o[l]+"-width")),this["padding-"+o[l]]=isNaN(parseFloat(e(e(this.model.dragArea)[0]).css("padding-"+o[l])))?0:parseFloat(e(e(this.model.dragArea)[0]).css("padding-"+o[l]));s=e(this.model.dragArea).offset().top,r=e(this.model.dragArea).offset().left}this._left=t.isNullOrUndefined(e(this.model.dragArea).offset())?0+this["border-left-width"]+this["padding-left"]:r+this["border-left-width"]+this["padding-left"],this._top=t.isNullOrUndefined(e(this.model.dragArea).offset())?0+this["border-top-width"]+this["padding-top"]:s+this["border-top-width"]+this["padding-top"],this._right=r+i-[this["border-right-width"]+this["padding-right"]],this._bottom=s+a-[this["border-bottom-width"]+this["padding-bottom"]]}},_dragStart:function(a){var n,o,s,r,l,d;if("touchmove"==a.type||"mousemove"==a.type&&1==(a.buttons!==i?a.buttons:a.which)||this._isIE8||this._isIE9){n=a,a=this._getCoordinate(a),this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0},this.offset=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.position=this._getMousePosition(n);var h=this._initPosition.x-a.pageX,c=this._initPosition.y-a.pageY,u=Math.sqrt(h*h+c*c);if(u>=this.model.distance){if(o=this.model.helper({sender:n,element:this.target}),!o||t.isNullOrUndefined(o))return;if(s=this.model.handle=this.helper=o,this.model.dragStart&&(r=null,"touchmove"==n.type?(l=n.originalEvent.changedTouches[0],r=document.elementFromPoint(l.clientX,l.clientY)):r=n.originalEvent.target||n.target,0==this.model.cursorAt.top&&0==this.model.cursorAt.left&&(r=this._checkTargetElement(a)||r),this._trigger("dragStart",{event:n,element:this.element,target:r,currentTarget:this._getCurrTarget(a)})))return this._destroy(),!1;this.model.dragArea?this._setDragArea():(this._left=this._top=this._right=this._bottom=0,this["border-top-width"]=this["border-left-width"]=0),d=s.offsetParent().offset(),e(document).off(t.eventType.mouseMove,this._dragStartHandler).off(t.eventType.mouseUp,this._destroyHandler).on(t.eventType.mouseMove,this._dragHandler).on(t.eventType.mouseUp,this._dragStopHandler).on("mouseleave",this._dragMouseOutHandler).on("selectstart",!1),t.widgetBase.droppables[this.model.scope]={draggable:this.element,helper:s.css({position:"absolute",left:this.position.left-d.left,top:this.position.top-d.top}),destroy:this._destroyHandler}}}},_drag:function(i){var a,n,o,s,r,l,d,h,c;i.preventDefault(),this.position=this._getMousePosition(i),this.position.top<0&&(this.position.top=0),e(document).height()<this.position.top&&(this.position.top=e(document).height()),e(document).width()<this.position.left&&(this.position.left=e(document).width()),h=t.widgetBase.droppables[this.model.scope].helper,this.model.drag&&(r=null,"touchmove"==i.type?(l=i.originalEvent.changedTouches[0],r=document.elementFromPoint(l.clientX,l.clientY)):r=i.originalEvent.target||i.target,0==this.model.cursorAt.top&&0==this.model.cursorAt.left&&(r=this._checkTargetElement(i)||r),this._trigger("drag",{event:i,element:this.target,target:r,currentTarget:this._getCurrTarget(i)})),d=this._checkTargetElement(i),t.isNullOrUndefined(d)?this._hoverTarget&&(i.target=i.toElement=this._hoverTarget,this._hoverTarget.object._out(i),this._hoverTarget=null):(i.target=i.toElement=d,d.object._over(i),this._hoverTarget=d),h=t.widgetBase.droppables[this.model.scope].helper,c=h.offsetParent().offset(),o=t.isNullOrUndefined(i.pageX)?i.originalEvent.changedTouches[0].pageX:i.pageX,s=t.isNullOrUndefined(i.pageY)?i.originalEvent.changedTouches[0].pageY:i.pageY,this.model.dragArea?(this._pageX!=o&&(a=this._left>this.position.left?this._left:this._right<this.position.left+h.outerWidth(!0)?this._right-h.outerWidth(!0):this.position.left),this._pageY!=s&&(n=this._top>this.position.top?this._top:this._bottom<this.position.top+h.outerHeight(!0)?this._bottom-h.outerHeight(!0):this.position.top)):(a=this.position.left,n=this.position.top),(0>n||n-[c.top+this["border-top-width"]]<0)&&(n=[c.top+this["border-top-width"]]),(0>a||a-[c.left+this["border-left-width"]]<0)&&(a=[c.left+this["border-left-width"]]),h.css({left:a-[c.left+this["border-left-width"]],top:n-[c.top+this["border-top-width"]]}),this.position.left=a,this.position.top=n,this._pageX=o,this._pageY=s},_dragStop:function(e){var t,i;("mouseup"==e.type||"touchend"==e.type)&&this._destroy(e),this.model.dragStop&&(t=null,"touchend"==e.type?0==this.model.cursorAt.top&&0==this.model.cursorAt.left?t=e.originalEvent.target||e.target:(i=e.originalEvent.changedTouches[0],t=document.elementFromPoint(i.clientX,i.clientY)):t=e.originalEvent.target||e.target,0==this.model.cursorAt.top&&0==this.model.cursorAt.left&&(t=this._checkTargetElement(e)||t),this._trigger("dragStop",{event:e,element:this.target,target:t,currentTarget:this._getCurrTarget(e)})),this._dragEnd(e)},_dragEnd:function(e){var i=this._checkTargetElement(e);t.isNullOrUndefined(i)||(e.target=e.toElement=i,i.object._drop(e,this.element))},_dragMouseEnter:function(t){e(document).off("mouseenter",this._dragMouseEnterHandler),this._isIE9?this._dragManualStop(t):this._isIE8?0==t.button&&this._dragManualStop(t):0==t.buttons&&this._dragManualStop(t)},_dragManualStop:function(e){null!=this.model.dragStop&&this._trigger("dragStop",{event:e,element:this.target,target:e.originalEvent.target||e.target,currentTarget:this._getCurrTarget(e)}),this._destroy(e)},_dragMouseOut:function(){e(document).on("mouseenter",this._dragMouseEnterHandler)},_checkTargetElement:function(e){var t,i;return"touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type||"taphold"==e.type?(i=e.originalEvent.changedTouches[0],t=document.elementFromPoint(i.clientX,i.clientY)):t=e.target,this.helper&&this._contains(this.helper[0],t)?(this.helper.hide(),t=this._elementUnderCursor(e),this.helper.show(),this._withDropElement(t)):this._withDropElement(t)},_getCurrTarget:function(e){var i,a,n=e.originalEvent&&e.originalEvent.target||e.target;return t.isNullOrUndefined(n.style)?void 0:(i=n.style.display,this.element.is(n)&&(n.style.display="none"),a=null,t.isNullOrUndefined(e.pageX)||t.isNullOrUndefined(e.pageY)||(a=document.elementFromPoint(e.pageX,e.pageY)),n.style.display=i,a)},_withDropElement:function(i){if(i){var a=e(i).data("ejDroppable");if(t.isNullOrUndefined(a)&&(a=this._checkParentElement(e(i))),!t.isNullOrUndefined(a))return e.extend(i,{object:a})}},_checkParentElement:function(i){var a,n=e(i).closest(".e-droppable");return n.length>0&&(a=e(n).data("ejDroppable"),!t.isNullOrUndefined(a))?a:void 0},_elementUnderCursor:function(e){return"touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type||"taphold"==e.type?document.elementFromPoint(e.originalEvent.changedTouches[0].clientX,e.originalEvent.changedTouches[0].clientY):document.elementFromPoint(e.clientX,e.clientY)},_contains:function(t,i){try{return e.contains(t,i)||t==i}catch(a){return!1}},_wireEvents:function(){1==t.isDevice()&&1==this.model.dragOnTaphold?this._on(this.element,"taphold",this._initialize):this._on(this.element,t.eventType.mouseDown,this._initialize),this._dragStartHandler=e.proxy(this._dragStart,this),this._destroyHandler=e.proxy(this._destroy,this),this._dragStopHandler=e.proxy(this._dragStop,this),this._dragHandler=e.proxy(this._drag,this),this._dragMouseEnterHandler=e.proxy(this._dragMouseEnter,this),this._dragMouseOutHandler=e.proxy(this._dragMouseOut,this)},_getMousePosition:function(e){e=this._getCoordinate(e);var t=this.model.clone?e.pageX:e.pageX-this._relXposition,i=this.model.clone?e.pageY:e.pageY-this._relYposition;return{left:t-[this.margins.left+this.model.cursorAt.left],top:i-[this.margins.top+this.model.cursorAt.top]}},_getCoordinate:function(e){var i=e;return("touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type||"taphold"==e.type&&"msie"!=t.browserInfo().name)&&(i=e.originalEvent.changedTouches[0]),i}})}(jQuery,Syncfusion),function(e,t){t.widget("ejDroppable","ej.Droppable",{element:null,model:null,validTags:["div","span","a"],dropElements:[],defaults:{accept:null,scope:"default",drop:null,over:null,out:null,create:null,destroy:null},_init:function(){this._mouseOver=!1,this.dropElements.push(this)},_setModel:function(){},_destroy:function(){e(this.element).off("mouseup",e.proxy(this._drop,this))},_over:function(e){this._mouseOver||(this._trigger("over",e),this._mouseOver=!0)},_out:function(e){this._mouseOver&&(this._trigger("out",e),this._mouseOver=!1)},_drop:function(t,i){var a,n=t.target,o=e(n).parents(".e-droppable");for(e(n).hasClass("e-droppable")&&o.push(n),a=0;a<this.dropElements.length;a++)e(o).is(e(this.dropElements[a].element))&&this.dropElements[a]._dropEvent.call(this.dropElements[a],t,i)},_dropEvent:function(i,a){var n,o=t.widgetBase.droppables[this.model.scope],s=!t.isNullOrUndefined(o.helper)&&o.helper.is(":visible");s&&"touchend"==i.type&&e(o.helper).hide(),n=this._isDropArea(i),s&&"touchend"==i.type&&e(o.helper).show(),o&&!t.isNullOrUndefined(this.model.drop)&&s&&n.canDrop&&this.model.drop(e.extend(i,{dropTarget:n.target,dragElement:a},!0),o)},_isDropArea:function(t){var i,a,n,o,s,r={canDrop:!0,target:e(t.target)};if("touchend"==t.type)for(i=t.originalEvent.changedTouches[0],a=document.elementFromPoint(i.clientX,i.clientY),r.canDrop=!1,n=e(a).parents(),o=0;o<this.element.length;o++){if(e(a).is(e(this.element[o])))r={canDrop:!0,target:e(a)};else for(s=0;s<n.length;s++)if(e(this.element[o]).is(e(n[s]))){r={canDrop:!0,target:e(a)};break}if(r.canDrop)break}return r}})}(jQuery,Syncfusion),function(e,t){t.widget("ejResizable","ej.resizable",{element:null,model:null,validTags:["div","span","a"],defaults:{scope:"default",handle:null,distance:1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,cursorAt:{top:1,left:1},resizeStart:null,resize:null,resizeStop:null,create:null,destroy:null,helper:function(){return e('<div class="e-resize-helper" />').html("resizable").appendTo(document.body)}},_init:function(){this.target=this.element,this._browser=t.browserInfo(),this._isIE8="msie"==this._browser.name&&"8.0"==this._browser.version,this._isIE9="msie"==this._browser.name&&"9.0"==this._browser.version,null!=this.handle?e(this.target).delegate(this.handle,t.eventType.mouseDown,e.proxy(this._mousedown,this)).delegate(this.handle,"resizestart",this._blockDefaultActions):e(this.target).on(t.eventType.mouseDown,e.proxy(this._mousedown,this)),this._resizeStartHandler=e.proxy(this._resizeStart,this),this._destroyHandler=e.proxy(this._destroy,this),this._resizeStopHandler=e.proxy(this._resizeStop,this),this._resizeHandler=e.proxy(this._resize,this),this._resizeMouseEnterHandler=e.proxy(this._resizeMouseEnter,this)},_mouseover:function(i){e(i.target).hasClass("e-resizable")?(e(i.target).css({cursor:"se-resize"}),e(this.target).on(t.eventType.mouseDown,e.proxy(this._mousedown,this))):(e(this.target).off(t.eventType.mouseDown),e(this.target).css({cursor:""}))},_blockDefaultActions:function(e){e.cancelBubble=!0,e.returnValue=!1,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},_setModel:function(){},_mousedown:function(i){var a=i;return i=this._getCoordinate(i),this.target=e(a.currentTarget),this._initPosition={x:i.pageX,y:i.pageY},this._pageX=i.pageX,this._pageY=i.pageY,e(document).on(t.eventType.mouseMove,this._resizeStartHandler).on(t.eventType.mouseUp,this._destroyHandler),e(document.documentElement).trigger(t.eventType.mouseDown,a),!1},_resizeStart:function(i){var a,n;if(e(i.target).hasClass("e-resizable")){i=this._getCoordinate(i);var o,s,r=this._initPosition.x-i.pageX,l=this._initPosition.y-i.pageY,d=Math.sqrt(r*r+l*l);if(d>=this.model.distance){if(null!=this.model.resizeStart&&this._trigger("resizeStart",{event:i,element:this.target}))return;a=this.model.helper({element:this.target}),o=i.pageX-this._pageX+a.outerWidth(),s=i.pageY-this._pageY+a.outerHeight(),this._pageX=i.pageX,this._pageY=i.pageY,n=this.getElementPosition(a),e(document).off(t.eventType.mouseMove,this._resizeStartHandler).off(t.eventType.mouseUp,this._destroyHandler).on(t.eventType.mouseMove,this._resizeHandler).on(t.eventType.mouseUp,this._resizeStopHandler).on("mouseenter",this._resizeMouseEnterHandler).on("selectstart",!1),t.widgetBase.resizables[this.scope]={resizable:this.target,helper:a.css({width:o,height:s}),destroy:this._destroyHandler}}}},_resize:function(e){var i,a,n,o,s;e=this._getCoordinate(e),o=this.getElementPosition(t.widgetBase.resizables[this.scope].helper),s=this.model.helper({element:this.target}),i=e.pageX-this._pageX+s.outerWidth(),a=e.pageY-this._pageY+s.outerHeight(),this._pageX=e.pageX,this._pageY=e.pageY,i<this.model.minWidth&&(n=this.model.minWidth-i,i=this.model.minWidth,this._pageX=e.pageX+n),a<this.model.minHeight&&(n=this.model.minHeight-a,a=this.model.minHeight,this._pageY=e.pageY+n),null!=this.model.maxHeight&&a>this.model.maxHeight&&(n=a-this.model.maxHeight,a=this.model.maxHeight,this._pageY=e.pageY-n),null!=this.model.maxWidth&&i>this.model.maxWidth&&(n=i-this.model.maxWidth,i=this.model.maxWidth,this._pageX=e.pageX-n),t.widgetBase.resizables[this.scope].helper.css({width:i,height:a}),this._trigger("resize",{element:this.target})},_resizeStop:function(e){null!=this.model.resizeStop&&this._trigger("resizeStop",{element:this.target}),("mouseup"==e.type||"touchend"==e.type)&&this._destroy(e)},_resizeMouseEnter:function(e){this._isIE9?this._resizeManualStop(e):this._isIE8?0==e.button&&this._resizeManualStop(e):0==e.buttons&&this._resizeManualStop(e)},_resizeManualStop:function(e){null!=this.model.resizeStop&&this._trigger("resizeStop",{element:this.target}),this._destroy(e)},_destroy:function(){e(document).off(t.eventType.mouseUp,this._destroyHandler).off(t.eventType.mouseUp,this._resizeStopHandler).off(t.eventType.mouseMove,this._resizeStartHandler).off(t.eventType.mouseMove,this._resizeHandler).off("mouseenter",this._resizeMouseEnterHandler).off("selectstart",!1),t.widgetBase.resizables[this.scope]=null},getElementPosition:function(e){return null!=e&&e.length>0?{left:e[0].offsetLeft,top:e[0].offsetTop}:null},_getCoordinate:function(e){var t=e;return("touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type)&&(t=e.originalEvent.changedTouches[0]),t}})}(jQuery,Syncfusion)}),function(e){"function"==typeof define&&define.amd?define(["./ej.core.min"],e):e()}(function(){!function(e,t,i,a){"use strict";t.widget("ejScrollBar","ej.ScrollBar",{defaults:{orientation:"horizontal",viewportSize:0,height:18,width:18,smallChange:57,largeChange:57,value:0,maximum:0,minimum:0,buttonSize:18,infiniteScrolling:!1},validTags:["div"],type:"transclude",dataTypes:{buttonSize:"number",smallChange:"number",largeChange:"number"},observables:["value"],value:t.util.valueFunction("value"),_enabled:!0,content:function(){return this._content&&this._content.length||(this._content="horizontal"===this.model.orientation?this.element.find(".e-hhandle"):this.element.find(".e-vhandle")),this._content},_init:function(){this.element.addClass("e-widget"),this._ensureScrollers(),this.content(),this._setInitialValues()},_setInitialValues:function(){var e="X";this.model.orientation===t.ScrollBar.Orientation.Horizontal?this.element.addClass("e-hscrollbar"):(this.element.addClass("e-vscrollbar"),e="Y"),(0!==this.value()||0!==this.model.minimum)&&(this.value()<this.model.minimum&&this.value(this.model.minimum),this.scroll(this.value(),"none"))},_ensureScrollers:function(){e.fn.jquery;this.model.height&&this.element.height(this.model.height),this.model.width&&this.element.width(this.model.width),this._scrollData||(this._scrollData="vertical"===this.model.orientation?this._createScroller("Height","Y","Top","e-v"):this._createScroller("Width","X","Left","e-h"))},_setModel:function(e){for(var t in e){if("value"!==t){this.refresh();break}this.value()&&this.scroll(this.value(),"none")}},_createScroller:function(t,i,a,n){var o,s={};e.fn.jquery;return s.dimension=t,s.xy=i,s.position=a,s.css=n,s.uDimension=t,this._calculateLayout(s),this._createLayout(s),o=this[s.main].find(".e-button"),this._off(o,"mousedown")._on(o,"mousedown",{d:s,step:1},this._spaceMouseDown),this._off(this[s.scroll],"mousedown")._on(this[s.scroll],"mousedown",{d:s},this._spaceMouseDown),this._off(this[s.handler],"mousedown touchstart")._on(this[s.handler],"mousedown touchstart",{d:s},this._mouseDown),s},_createLayout:function(i){var a,n,o="<div class='"+i.css+"{0}' style='"+i.dimension+":{1}px'>{2}</div>",s=e.fn.jquery,r={};r[i.dimension]=i.modelDim,n=t.buildTag("div."+i.css+"scroll e-box",String.format(o,"up e-chevron-up_01 e-icon e-box e-button",i.buttonSize)+String.format(o,"handlespace",i.handleSpace,String.format(o,"handle e-box e-pinch",i.handle))+String.format(o,"down e-chevron-down_01 e-icon e-box e-button",i.buttonSize),r),this.element.append(n),this.element.find(".e-vhandle").addClass("e-v-line e-icon"),this.element.find(".e-hhandle").addClass("e-h-line e-icon"),a="1.7.1"===s||"1.7.2"===s?i.uDimension.toLowerCase():"outer"+i.uDimension,this[i.handler]=this.element.find("."+i.handler),this[i.handler].css("transition","none"),this[i.scroll]=this[i.handler].parent(),this[i.main]=this[i.scroll].parent(),this[i.main].find(".e-button")["outer"+i.uDimension](i.buttonSize)},_calculateLayout:function(e){var i,n;e.scrollDim="scroll"+e.dimension,e.lPosition=e.position.toLowerCase(),e.clientXy="page"+e.xy,e.scrollVal="scroll"+e.position,e.scrollOneStepBy=this.model.smallChange,e.modelDim=this.model[e.dimension=e.dimension.toLowerCase()],e.handler=e.css+"handle",e.buttonSize=this.model.buttonSize,e.main=e.css+"scroll",e.scroll=e.css+"ScrollSpace",e.handleSpace=e.modelDim-2*e.buttonSize,e.scrollable=this.model.maximum-this.model.minimum,i=this.model.height,"horizontal"===this.model.orientation&&(i=this.model.width),e.handle=this.model.viewportSize/(this.model.maximum-this.model.minimum+this.model.viewportSize)*(i-2*this.model.buttonSize),n=!t.isNullOrUndefined(this.model.elementHeight)&&"string"==typeof this.model.elementHeight&&-1!=this.model.elementHeight.indexOf("%"),e.handle<20&&!n&&(e.handle=20),e.onePx=e.scrollable/(e.handleSpace-e.handle),e.fromScroller=!1,e.up=!0,e.vInterval=a},_updateLayout:function(e){this.element.height(this.model.height),this.element.width(this.model.width);var t=this.element.find("."+e.css+"handle"),i=this.element.find("."+e.css+"handlespace"),n="width"==e.dimension?t.css("left"):t.css("top"),o="width"==e.dimension?i.outerWidth():i.outerHeight();n!==a&&"auto"!==n&&(o>=e.handle+parseFloat(n)||(this.model.enableRTL?t.css("width"===e.dimension?"left":"top",parseFloat(o)-e.handle):t.css("width"===e.dimension?"left":"top",parseFloat(o)-e.handle>0?parseFloat(o)-e.handle:0))),this.element.find("."+e.css+"scroll").css(e.dimension,e.modelDim+"px").find(".e-button").css(e.dimension,this.model.buttonSize).end().find("."+e.css+"handlespace").css(e.dimension,e.handleSpace+"px").find("."+e.css+"handle").css(e.dimension,e.handle+"px")},refresh:function(){this._ensureScrollers(),this.value()&&this.scroll(this.value(),"none"),this._scrollData&&(this._calculateLayout(this._scrollData),this._updateLayout(this._scrollData))},scroll:function(e,i,a,n){var o,s,r=this._scrollData;if(!a)if(this.model.orientation===t.ScrollBar.Orientation.Horizontal){if(this._trigger("scroll",{source:i||"custom",scrollData:this._scrollData,scrollLeft:e,originalEvent:n}))return}else if(this._trigger("scroll",{source:i||"custom",scrollData:this._scrollData,scrollTop:e,originalEvent:n}))return;this._scrollData&&(!this._scrollData.enableRTL||"mousemove"!=n&&"touchmove"!=n||"msie"==t.browserInfo().name?!this._scrollData.enableRTL||"mousemove"!=n&&"touchmove"!=n||"msie"!=t.browserInfo().name?this.value(e):this.value(-1*e):this.value(-r.scrollable+e),this.content().length>0&&(this.model.orientation===t.ScrollBar.Orientation.Horizontal?(o=this.element.find(".e-hhandlespace").width()-this.element.find(".e-hhandle").outerWidth(),e=o<(e-this.model.minimum)/this._scrollData.onePx?o:(e-this.model.minimum)/this._scrollData.onePx,this._scrollData.enableRTL&&("mousemove"==n||"touchmove"==n)&&"msie"!=t.browserInfo().name&&(e=o-e,e>0?e=-1*e:e),this._scrollData.enableRTL&&("mousemove"==n||"touchmove"==n)&&"msie"==t.browserInfo().name&&(e=-e),this._scrollData.enableRTL&&e>0&&!this._scrollData._scrollleftflag?e=0:e,this._scrollData._scrollleftflag&&(e>0?e=-1*e:e,this.value(e)),this.content()[0].style.left=e+"px",this._scrollData._scrollleftflag=!1):(s=this.element.find(".e-vhandlespace").height()-this.element.find(".e-vhandle").outerHeight(),e=s<(e-this.model.minimum)/this._scrollData.onePx?s:(e-this.model.minimum)/this._scrollData.onePx,"msie"==t.browserInfo().name&&isNaN(e)&&(e=""),this.content()[0].style.top=e+"px")))},_changeTop:function(e,t,i){var a,n;return a="height"===e.dimension?this.value():this.value(),n=a+t,e.step=t,e.enableRTL&&0>t||t>0&&!e.enableRTL?e.enableRTL?n<-1*this.model.maximum&&(n=-1*this.model.maximum):n>this.model.maximum&&(n=this.model.maximum):e.enableRTL?n>this.model.minimum&&(n=this.model.minimum):n<this.model.minimum&&(n=this.model.minimum),(n!==a||this.model.infiniteScrolling)&&this.scroll(n,i),n!==a},_mouseUp:function(i){if(i.data){var a=i.data.d;clearInterval(a.vInterval),"touchend"==i.type&&e(i.target).removeClass("e-touch"),"mouseup"!==i.type&&"touchend"!==i.type&&(i.toElement||i.relatedTarget||i.target)||(this._prevY=this._d=this._data=null,this._off(e(document),"mousemove touchmove",this._mouseMove),e(document).off("mouseup touchend",t.proxy(this._mouseUp,this)),a.fromScroller=!1,this[a.scroll].off("mousemove"),this[a.handler].off("mousemove").css("transition",""),"thumb"!==i.data.source||t.isNullOrUndefined(this.model)||e.when(this.content()).done(t.proxy(function(){this._trigger("thumbEnd",{originalEvent:i,scrollData:a})},this))),a.up=!0}},_mouseDown:function(i){this._enabled&&(this._d=i,this._data=this._d.data.d,this._data.target=this._d.target,this._data.fromScroller=!0,this[this._data.handler].css("transition","none"),this._on(e(document),"mousemove touchmove",{d:this._data,source:"thumb"},this._mouseMove),this._trigger("thumbStart",{originalEvent:this._d,scrollData:this._data}),e(document).one("mouseup touchend",{d:this._data,source:"thumb"},t.proxy(this._mouseUp,this)),"touchstart"==i.type&&e(i.target).addClass("e-touch"))},_mouseCall:function(e){e.type="mouseup",this._mouseUp(e)},_mouseMove:function(i){var a,n,o,s=0,r=parseInt(this[this._data.handler].css(this._data.lPosition))||0;if(i.preventDefault(),n=1,t.isNullOrUndefined(i.target.tagName)){if(e(i.target).is(document))return void this._mouseCall(i)}else if("iframe"===i.target.tagName.toLowerCase())return void this._mouseCall(i);o="mousemove"==i.type?i[this._data.clientXy]:i.originalEvent.changedTouches[0][this._data.clientXy],this._prevY&&o!==this._prevY&&(s=o-this._prevY,this.model.infiniteScrolling?(r+=s,this._data.step=s,(this._data.enableRTL?r>0:0>r)&&(r=0),r*(this._data.enableRTL?-1:1)+this._data.handle>=this._data.handleSpace&&(r=(this._data.handleSpace-this._data.handle)*(this._data.enableRTL?-1:1)),a=Math.ceil(r*this._data.onePx),this.scroll(a,"thumb")):(a=s*this._data.onePx,this._changeTop(this._data,a,"thumb",this._d)),this._trigger("thumbMove",{originalEvent:i,direction:this._data.step>0?1:-1,scrollData:this._data})),1===n&&(this._prevY=o)},_spaceMouseDown:function(i){var a,n,o;i.data&&this._enabled&&(a=i.data.d,1===i.which&&i.target!==this[a.handler][0])&&(n=i.data.step?this.model.smallChange:this.model.largeChange,o=i.data.top||this[a.handler].offset()[a.lPosition],i[a.clientXy]=i[a.clientXy]||0,i[a.clientXy]<o&&(n*=-1),a.target=i.target,this._changeTop(a,n,3===n?"track":"button",i),1!==i.data.step&&this[a.scroll].mousemove(function(){a.up=!0}),a.up=!1,a.vInterval=setInterval(t.proxy(function(){return(0>n?o+n/a.onePx<i[a.clientXy]:o+a.handle+n/a.onePx>i[a.clientXy])&&(a.up=!0),a.up?void clearInterval(a.vInterval):(this._changeTop(a,n,3===n?"track":"button",i),void(o=i.data?i.data.top||this[a.handler].offset()[a.lPosition]:this[a.handler].offset()[a.lPosition]))},this),150),e(document).one("mouseup",{d:a},t.proxy(this._mouseUp,this)),e(document).mouseout({d:a},t.proxy(this._mouseUp,this)))},_remove:function(){this.model.orientation===t.ScrollBar.Orientation.Horizontal&&this.element.find(".e-hscroll").remove(),this.model.orientation===t.ScrollBar.Orientation.Vertical&&this.element.find(".e-vscroll").remove(),this._scrollData=null,this._content=null},_destroy:function(){this.element.remove()}}),t.ScrollBar.Orientation={Horizontal:"horizontal",Vertical:"vertical"}}(jQuery,Syncfusion,window),function(e,t,i,a){"use strict";t.widget("ejScroller","ej.Scroller",{_addToPersist:["scrollLeft","scrollTop"],defaults:{height:250,autoHide:!1,animationSpeed:600,width:0,scrollOneStepBy:57,buttonSize:18,scrollLeft:0,scrollTop:0,targetPane:null,scrollerSize:18,enablePersistence:!1,enableRTL:a,enableTouchScroll:!0,enabled:!0,create:null,destroy:null,wheelStart:null,wheelMove:null,wheelStop:null},validTags:["div"],type:"transclude",dataTypes:{buttonSize:"number",scrollOneStepBy:"number"},observables:["scrollTop","scrollLeft"],scrollTop:t.util.valueFunction("scrollTop"),scrollLeft:t.util.valueFunction("scrollLeft"),keyConfigs:{up:"38",down:"40",left:"37",right:"39",pageUp:"33",pageDown:"34",pageLeft:"ctrl+37",pageRight:"ctrl+39"},content:function(){return this._content&&this._content.length&&this._content[0].offsetParent||(this._content=this.element.children().first().addClass("e-content")),this._content},_setFirst:!0,_updateScroll:!1,_init:function(){t.isNullOrUndefined(this.content()[0])||(this._tempWidth=this.model.width,this._prevScrollWidth=this.content()[0].scrollWidth,this._prevScrollHeight=this.content()[0].scrollHeight,this.element.addClass("e-widget"),this.content(),this._browser=t.browserInfo().name,this._wheelStart=!0,this._eleHeight=this.model.height,this._eleWidth=this.model.width,this.model.enableRTL===a&&(this.model.enableRTL="rtl"===this.element.css("direction")),this._ensureScrollers(),this.model.enableRTL&&(this.element.addClass("e-rtl"),this._rtlScrollLeftValue=this.content().scrollLeft()),this._on(this.content(),"scroll",this._scroll),null!=this.model.targetPane&&this._on(this.content().find(this.model.targetPane),"scroll",this._scroll),this.scrollLeft()&&this._setScrollLeftValue(this.scrollLeft()),this.scrollTop()&&this.content().scrollTop(this.scrollTop()),this.model.autoHide&&this._autohide(),this.model.enabled?this.enable():this.disable(),this._setDimension(),(this._prevScrollWidth!==this.content()[0].scrollWidth||this._prevScrollHeight!==this.content()[0].scrollHeight)&&this.refresh()),this._addActionClass()},_addActionClass:function(){"msie"==this._browser&&(this.content().removeClass("e-pinch e-pan-x e-pan-y"),this._vScrollbar&&this._hScrollbar?this.content().addClass("e-pinch"):this._vScrollbar&&!this._hScrollbar?this.content().addClass("e-pan-x"):this._hScrollbar&&!this._vScrollbar&&this.content().addClass("e-pan-y"))},_setDimension:function(){t.isNullOrUndefined(this.model.height)||"string"!=typeof this.model.height||-1==this.model.height.indexOf("%")||(this._vScroll?this.model.height=this._convertPercentageToPixel(parseInt(this._eleHeight),this.element.parent().height()):e(this.content()[0]).height("")),t.isNullOrUndefined(this.model.width)||"string"!=typeof this.model.width||-1==this.model.width.indexOf("%")||(this._hScroll?this.model.width=this._convertPercentageToPixel(parseInt(this._eleWidth),this.element.parent().width()):e(this.content()[0]).width(""))},_setScrollLeftValue:function(e){this.model.enableRTL&&(e="mozilla"==t.browserInfo().name?0>e?e:-1*e:!t.isNullOrUndefined(this._rtlScrollLeftValue)&&("chrome"==t.browserInfo().name||this._rtlScrollLeftValue>0)?0>e?this._rtlScrollLeftValue+e:this._rtlScrollLeftValue-e:Math.abs(e)),this.content().scrollLeft(e)},_ensureScrollers:function(){var n,o=e.fn.jquery;this.model.height="string"==typeof this.model.height&&-1!=this.model.height.indexOf("px")?parseInt(this.model.height):this.model.height,this.model.width="string"==typeof this.model.width&&-1!=this.model.width.indexOf("px")?parseInt(this.model.width):this.model.width,this.model.height&&this.element.height(this.model.height),this.model.width&&this.element.width(this.model.width),this._off(this.content(),"mousedown touchstart"),this.content().length>0&&(this.isVScroll()?(this._tempVscrollbar||(this._vScrollbar=this._createScrollbar(t.ScrollBar.Orientation.Vertical,this.isHScroll()),this._tempVscrollbar=this._vScrollbar),this.model.enableTouchScroll&&this._on(this.content(),"mousedown touchstart",{
d:this._vScrollbar._scrollData},this._mouseDownOnContent)):(this._vScrollbar=null,this._tempVscrollbar=this._vScrollbar,this.element.children(".e-vscrollbar").remove()),this.isHScroll()?(this._tempHscrollbar||(this._hScrollbar=this._createScrollbar(t.ScrollBar.Orientation.Horizontal,this.isVScroll()),this._tempHscrollbar=this._hScrollbar),this.model.enableTouchScroll&&this._on(this.content(),"mousedown touchstart",{d:this._hScrollbar._scrollData},this._mouseDownOnContent)):(this._hScrollbar=null,this._tempHscrollbar=this._hScrollbar,this.element.children(".e-hscrollbar").remove()),this._vScrollbar||this._hScrollbar||this.content().css({width:"auto",height:"auto"}),this.element.find(".e-hscroll").length>0||this._vScrollbar&&this.content().outerHeight(this.content().outerHeight()-1),"1.7.1"===o||"1.7.2"===o?(this._contentHeight="height",this._contentWidth="width"):(this._contentHeight="outerHeight",this._contentWidth="outerWidth"),this._hScroll=this.isHScroll(),this._vScroll=this.isVScroll(),this._hScroll||this._vScroll?(this.content().addClass("e-content"),n=this._exactElementDimension(this.element),this._elementDimension(n),null!==this.model.targetPane&&this.content().find(this.model.targetPane)[0]!==a?this.content().find(this.model.targetPane)[0].scrollLeft=this.scrollLeft():!this.isHScroll()&&this.element.children(".e-hscrollbar").length>0&&this._ensureScrollers(),isNaN(this._eleWidth)&&this._eleWidth.indexOf("%")>0&&isNaN(this._eleHeight)&&this._eleHeight.indexOf("%")>0&&e(i).on("resize",e.proxy(this._resetScroller,this))):this.content().removeClass("e-content"),this._setDimension(),this._parentHeight=e(this.element).parent().height(),this._parentWidth=e(this.element).parent().width())},_elementDimension:function(e){this._ElementHeight=e.height-(this.border_bottom+this.border_top+this.padding_bottom+this.padding_top),this.content()[this._contentHeight](this._ElementHeight-(this._hScroll&&!this.model.autoHide?this.model.scrollerSize:this.element.find(".e-hscrollbar").is(":visible")?this.model.scrollerSize:0)),this._ElementWidth=e.width-(this.border_left+this.border_right+this.padding_left+this.padding_right),this.content()[this._contentWidth](this._ElementWidth-(this._vScroll&&!this.model.autoHide?this.model.scrollerSize:this.element.find(".e-vscrollbar").is(":visible")?this.model.scrollerSize:0))},_convertPercentageToPixel:function(e,t){return Math.floor(e*t/100)},isHScroll:function(){var i,a=parseFloat(e.fn.jquery)>=3?Math.ceil(this.element.width()):this.element.width(),n=this.model.width;if(t.isNullOrUndefined(this.model.width)||(n="string"==typeof this.model.width&&-1!=this.model.width.indexOf("%")?a:parseFloat(e.fn.jquery)>=3&&!isNaN(parseFloat(this.model.width))?Math.ceil(parseFloat(this.model.width)):this.model.width),t.isNullOrUndefined(this._tempWidth)||"string"!=typeof this._tempWidth||-1==this._tempWidth.indexOf("%")){if(n>0){if(i=this.content().find(this.model.targetPane),null!=this.model.targetPane&&i.length)return i[0].scrollWidth+i.siblings().width()>n;if(this.content()[0].scrollWidth>n)return!0;if(this.content()[0].scrollWidth==n){if(this.model.autoHide&&e(this.content()[0]).find("> *").length>0)return e(this.content()[0]).find("> *")[0].scrollWidth>e(this.content()[0]).width();if(e(this.content()[0]).find("> *").length>0)return e(this.content()[0]).find("> *")[0].scrollWidth>(t.isNullOrUndefined(this._tempVscrollbar)?n:n-this.model.scrollerSize)}return!1}return!1}return t.isNullOrUndefined(this.model.width)||"string"!=typeof this.model.width||-1==this.model.width.indexOf("%")?this.content()[0].scrollWidth>a?!0:void 0:this.content()[0].scrollWidth>a},isVScroll:function(){return t.isNullOrUndefined(this.model.height)||"string"!=typeof this.model.height||-1==this.model.height.indexOf("%")?!!(this.model.height>0&&(this.content()[0].scrollHeight>Math.ceil(this.model.height)||this.isHScroll()&&(this.content()[0].scrollHeight==this.model.height||this.content()[0].scrollHeight>this.model.height-(this.model.scrollerSize-2)))):this.content()[0].scrollHeight>this.element.outerHeight()},_setModel:function(e){for(var i in e)switch(i){case"enableRTL":e[i]?(this.element.addClass("e-rtl"),this._rtlScrollLeftValue=this.content().scrollLeft(),t.isNullOrUndefined(this._hScrollbar)||(this._hScrollbar._scrollData.enableRTL=!0)):(this.element.removeClass("e-rtl"),t.isNullOrUndefined(this._hScrollbar)||(this._hScrollbar._scrollData.enableRTL=!1)),this._hScrollbar&&(this.element.find(".e-hhandle").css("left",0),this._hScrollbar.value(0));break;case"scrollLeft":(parseFloat(t.util.getVal(e[i]))<0||!this._hScroll)&&(e[i]=0),this._hScrollbar&&(e[i]=parseFloat(t.util.getVal(e[i]))>this._hScrollbar._scrollData.scrollable?this._hScrollbar._scrollData.scrollable:parseFloat(t.util.getVal(e[i]))),this._setScrollLeftValue(parseFloat(e[i])),this.scrollLeft(e[i]),!this._hScrollbar||this._hScrollbar._scrollData._scrollleftflag&&this.model.enableRTL||this.scrollX(e[i],!0);break;case"scrollTop":this._vScrollbar&&(e[i]=parseFloat(t.util.getVal(e[i]))>this._vScrollbar._scrollData.scrollable?this._vScrollbar._scrollData.scrollable:parseFloat(t.util.getVal(e[i]))),(parseFloat(e[i])<0||!this._vScroll)&&(e[i]=0),this.content().scrollTop(parseFloat(e[i])),this.scrollTop(e[i]),this.scrollY(e[i],!0);break;case"touchScroll":this.model.enableTouchScroll?(this._vScrollbar&&this._on(this.content(),"mousedown touchstart",{d:this._vScrollbar._scrollData},this._mouseDownOnContent),this._hScrollbar&&this._on(this.content(),"mousedown touchstart",{d:this._hScrollbar._scrollData},this._mouseDownOnContent)):this._off(this.content(),"mousedown touchstart");break;case"scrollOneStepBy":this._vScrollbar&&(this._vScrollbar._scrollData.scrollOneStepBy=e[i],this._vScrollbar.model.smallChange=e[i]),this._hScrollbar&&(this._hScrollbar._scrollData.scrollOneStepBy=e[i],this._hScrollbar.model.smallChange=e[i]);break;case"buttonSize":this._vScrollbar&&(this._vScrollbar.model.buttonSize=this.model.buttonSize),this._hScrollbar&&(this._hScrollbar.model.buttonSize=this.model.buttonSize),this.refresh();break;case"height":this._eleHeight=e[i],this.refresh();break;case"width":this._eleWidth=e[i],this.refresh();break;case"enabled":e[i]?this.enable():this.disable();break;default:this.refresh()}},_createScrollbar:function(i,a){var n,o,s,r,l,d,h,c=this,u=document.createElement("div");return i===t.ScrollBar.Orientation.Vertical?(o=this.model.scrollerSize,s=n=t.isNullOrUndefined(this.model.height)||"string"!=typeof this.model.height||-1==this.model.height.indexOf("%")?this.model.height-(a?this.model.scrollerSize:0):this.element.height()-(a?this.model.scrollerSize:0),r=this.content()[0].scrollHeight,l=this.scrollTop()):(o=n=this.model.width-(a?this.model.scrollerSize:0),s=this.model.scrollerSize,t.isNullOrUndefined(this.model.width)||"string"!=typeof this.model.width||-1==this.model.width.indexOf("%")?(d=this.content().find(this.model.targetPane),r=null!=this.model.targetPane&&d.length?d[0].scrollWidth+d.parent().width()-d.width():this.content()[0].scrollWidth):(o=n=this.element.width()-(a?this.model.scrollerSize:0),r=this.content()[0].scrollWidth),l=this.scrollLeft()),this.element.children(".e-hscrollbar").length>0?e(this.element.children(".e-hscrollbar")).before(u):this.element.append(u),e(u).ejScrollBar({elementHeight:c._eleHeight,elementWidth:c._eleWidth,buttonSize:c.model.buttonSize,orientation:i,viewportSize:n,height:s,width:o,maximum:r-n,value:l,smallChange:this.model.scrollOneStepBy,largeChange:3*this.model.scrollOneStepBy,scroll:t.proxy(this._scrollChanged,this),thumbEnd:t.proxy(this._thumbEnd,this),thumbStart:t.proxy(this._thumbStart,this),thumbMove:t.proxy(this._thumbMove,this)}),h=e(u).ejScrollBar("instance"),i!==t.ScrollBar.Orientation.Vertical&&a||this._off(this.element,"msie"==this._browser?"wheel mousewheel":"mousewheel DOMMouseScroll",this._mouseWheel)._on(this.element,"msie"==this._browser?"wheel mousewheel":"mousewheel DOMMouseScroll",{d:h._scrollData},this._mouseWheel),i===t.ScrollBar.Orientation.Horizontal?this._scrollXdata=h._scrollData:this._scrollYdata=h._scrollData,i===t.ScrollBar.Orientation.Horizontal&&this.model.enableRTL&&(h._scrollData.enableRTL=!0),h._enabled=this.model.enabled,h},_updateScrollbar:function(i,a){var n=i===t.ScrollBar.Orientation.Vertical?this._vScrollbar:this._hScrollbar;n&&(i===t.ScrollBar.Orientation.Vertical?(n.model.width=this.model.scrollerSize,n.model.height=n.model.viewportSize=this.model.height-(a?this.model.scrollerSize:0),n.model.maximum=this.content()[0].scrollHeight-n.model.viewportSize,n.model.value=this.scrollTop()):(n.model.width=n.model.viewportSize=this.model.width-(a?this.model.scrollerSize:0),n.model.height=this.model.scrollerSize,n.model.maximum=(null!=this.model.targetPane&&this.content().find(this.model.targetPane).length>0?this.content().find(this.model.targetPane)[0].scrollWidth+(this.content().width()-e(this.model.targetPane).outerWidth()):this.content()[0].scrollWidth)-n.model.viewportSize,this.model.enableRTL||(n.model.value=this.scrollLeft())))},_autohide:function(){this.model.autoHide?(this.element.addClass("e-autohide"),this._on(this.element,"mouseenter mouseleave touchstart touchend",this._scrollerHover),this.content().siblings(".e-scrollbar.e-js").hide(),this._elementDimension(this._exactElementDimension(this.element))):(this.element.removeClass("e-autohide"),this._off(this.element,"mouseenter mouseleave touchstart touchend",this._scrollerHover),this.content().siblings(".e-scrollbar.e-js").show())},_scrollChanged:function(i){this._updateScroll=!0,i.scrollTop!==a?this.scrollY(i.scrollTop,!0,"",i.source):i.scrollLeft!==a&&this.scrollX(i.scrollLeft,!0,"",i.source),this._updateScroll=!1;var n=this;e.when(this.content()).done(t.proxy(function(){n._trigger("scrollEnd",{scrollData:i})}))},_bindBlurEvent:function(a,n){this._scrollEle=e(a).data("ejScrollBar"),this._event=n;this._listener=function(){this._scrollEle._off(e(document),"mousemove touchmove",this._scrollEle._mouseMove),e(document).off("mouseup touchend",t.proxy(this._scrollEle._mouseUp,this._scrollEle)),this._scrollEle._prevY=null,this._off(e(document),"mousemove touchmove",this._mouseMove),this._off(e(document),"mouseup touchend",this._mouseUp),this._off(e(i),"blur"),"e-vhandle"===this._evtData.handler?this._scrollEle._trigger("thumbEnd",{originalEvent:this._event,scrollData:this._evtData}):this._scrollEle._trigger("thumbEnd",{originalEvent:this._event,scrollData:this._evtData})},this._on(e(i),"blur",this._listener)},_thumbStart:function(e){this._evtData=e.scrollData;var t="e-vhandle"===e.scrollData.handler?this.element.find("."+e.scrollData.handler).closest(".e-scrollbar"):this.element.find("."+e.scrollData.handler).closest(".e-scrollbar"),t="e-vhandle"===e.scrollData.handler?this.element.find("."+e.scrollData.handler).closest(".e-scrollbar"):this.element.find("."+e.scrollData.handler).closest(".e-scrollbar");this._bindBlurEvent(t,e),this._trigger("thumbStart",e)},_thumbMove:function(e){this._trigger("thumbMove",e)},_thumbEnd:function(t){this._trigger("thumbEnd",t),this._off(e(i),"blur")},refresh:function(i){var a,n;i?(this._tempVscrollbar=null,this.element.children(".e-vscrollbar").remove(),this._tempHscrollbar=null,this.element.children(".e-hscrollbar").remove()):this.element.find(">.e-content").removeAttr("style"),t.isNullOrUndefined(this._eleHeight)||"string"!=typeof this._eleHeight||-1==this._eleHeight.indexOf("%")||this._parentHeight==e(this.element).parent().height()||(a=this._exactElementDimension(this.element.parent()),a=a.height-(this.border_bottom+this.border_top+this.padding_bottom+this.padding_top),this.model.height=this._convertPercentageToPixel(parseInt(this._eleHeight),a)),t.isNullOrUndefined(this._eleWidth)||"string"!=typeof this._eleWidth||-1==this._eleWidth.indexOf("%")||this._parentWidth==e(this.element).parent().width()||(a=this._exactElementDimension(this.element.parent()),a=a.width-(this.border_left+this.border_right+this.padding_left+this.padding_right),this.model.width=this._convertPercentageToPixel(parseInt(this._eleWidth),a)),this._ensureScrollers(),n=this.model.scrollLeft,this.model.enableRTL?(this.element.hasClass("e-rtl")||this.element.addClass("e-rtl"),this._rtlScrollLeftValue=this.content().scrollLeft(),n>0?this.content().scrollLeft(this._rtlScrollLeftValue-n):this._setScrollLeftValue(n)):this.content().scrollLeft(n),(this.scrollTop()&&t.isNullOrUndefined(this._vScrollbar)||!t.isNullOrUndefined(this._vScrollbar)&&this._vScrollbar&&null!=this._vScrollbar._scrollData&&!this._vScrollbar._scrollData.skipChange)&&this.content().scrollTop(this.scrollTop()),this._vScrollbar&&(this._vScrollbar._scrollData.dimension="Height",this._updateScrollbar(t.ScrollBar.Orientation.Vertical,this._hScroll),this._vScroll&&!this._vScrollbar._calculateLayout(this._vScrollbar._scrollData)&&this._vScrollbar._updateLayout(this._vScrollbar._scrollData)),this._hScrollbar&&(this._hScrollbar._scrollData.dimension="Width",this._updateScrollbar(t.ScrollBar.Orientation.Horizontal,this._vScroll),this._hScroll&&!this._hScrollbar._calculateLayout(this._hScrollbar._scrollData)&&this._hScrollbar._updateLayout(this._hScrollbar._scrollData)),"msie"==t.browserInfo().name&&"8.0"==t.browserInfo().version?this.element.find(".e-hhandle").css("left","0px"):null!=this.model.targetPane&&this._on(this.content().find(this.model.targetPane),"scroll",this._scroll),this._addActionClass(),this._autohide()},_exactElementDimension:function(e){var t,i,a,n=e.get(0).getBoundingClientRect(),o=["left","right","top","bottom"];for(t=n.width?n.width:n.right-n.left,i=n.height?n.height:n.bottom-n.top,a=0;a<o.length;a++)this["border_"+o[a]]=isNaN(parseFloat(e.css("border-"+o[a]+"-width")))?0:parseFloat(e.css("border-"+o[a]+"-width")),this["padding_"+o[a]]=isNaN(parseFloat(e.css("padding-"+o[a])))?0:parseFloat(e.css("padding-"+o[a]));return{width:t,height:i}},_keyPressed:function(e,i){if(this.model.enabled){if(-1!==["input","select","textarea"].indexOf(i.tagName.toLowerCase()))return!0;var a,n;if(-1!==["up","down","pageUp","pageDown"].indexOf(e))this._vScrollbar&&("msie"==t.browserInfo().name&&this.model.allowVirtualScrolling&&this._content.focus(),a=this._vScrollbar._scrollData),n="o";else{if(-1===["left","right","pageLeft","pageRight"].indexOf(e))return!0;this._hScrollbar&&(a=this._hScrollbar._scrollData),n="i"}return a?!this._changeTop(a,(e.indexOf(n)<0?-1:1)*("p"!==e[0]?1:3)*a.scrollOneStepBy,"key"):!0}},scrollY:function(e,i,a,n,o){var o,s=this;if(""!==e){if(i){if(o={source:n||"custom",scrollData:this._vScrollbar?this._vScrollbar._scrollData:null,scrollTop:e,originalEvent:o},e=o.scrollTop,this.scrollTop(e),this._trigger("scroll",o))return;return void this.content().scrollTop(e)}(t.isNullOrUndefined(a)||""===a)&&(a=100),this._vScrollbar&&(e=parseFloat(e)>this._vScrollbar._scrollData.scrollable?this._vScrollbar._scrollData.scrollable:parseFloat(e)),this.scrollTop(e),this.content().stop().animate({scrollTop:e},a,"linear",function(){s._trigger("scroll",{source:n||"custom",scrollData:s._vScrollbar?s._vScrollbar._scrollData:null,scrollTop:e,originalEvent:o})})}},scrollX:function(e,i,a,n,o){var s,r,l=this;if(""!==e){if(this._hScrollbar&&(e=parseFloat(e)>this._hScrollbar._scrollData.scrollable?this._hScrollbar._scrollData.scrollable:parseFloat(e)),s=t.browserInfo().name,this.model.enableRTL&&"mozilla"!=s&&(0>e&&(e=Math.abs(e)),r=null!=this.model.targetPane?this.content().find(this.model.targetPane)[0]:this.content()[0],"mousemove"!=o&&"touchmove"!=o&&"msie"!=s&&this._hscrollbar&&"msie"!=s&&(e=this._hScrollbar._scrollData.scrollable-e)),this.scrollLeft(e),i){if(this._trigger("scroll",{source:n||"custom",scrollData:this._hScrollbar?this._hScrollbar._scrollData:null,scrollLeft:e,originalEvent:o}))return;return void(null!=this.model.targetPane&&this.content().find(this.model.targetPane).length?this.content().find(this.model.targetPane).scrollLeft(e):this.content().scrollLeft(e))}(t.isNullOrUndefined(a)||""===a)&&(a=100),null!=this.model.targetPane&&this.content().find(this.model.targetPane).length?this.content().find(this.model.targetPane).stop().animate({scrollLeft:e},a,"linear"):this.content().stop().animate({scrollLeft:e},a,"linear",function(){l._trigger("scroll",{source:n||"custom",scrollData:l._hScrollbar?l._hScrollbar._scrollData:null,scrollLeft:e,originalEvent:o})})}},enable:function(){var e=this.element.find(".e-vscrollbar,.e-hscrollbar,.e-vscroll,.e-hscroll,.e-vhandle,.e-hhandle,.e-vscroll .e-icon,.e-hscroll .e-icon");e.hasClass("e-disable")&&(e.removeClass("e-disable").attr({"aria-disabled":!1}),this.model.enabled=!0),this._vScrollbar&&(this._vScrollbar._enabled=this.model.enabled),this._hScrollbar&&(this._hScrollbar._enabled=this.model.enabled)},disable:function(){var e=this.element.find(".e-vscrollbar,.e-hscrollbar,.e-vscroll,.e-hscroll,.e-vhandle,.e-hhandle,.e-vscroll .e-icon,.e-hscroll .e-icon");e.addClass("e-disable").attr({"aria-disabled":!0}),this.model.enabled=!1,this._vScrollbar&&(this._vScrollbar._enabled=this.model.enabled),this._hScrollbar&&(this._hScrollbar._enabled=this.model.enabled)},_changeTop:function(e,i,a,n){var o,s=Math.ceil(null!=this.model.targetPane&&"height"!=e.dimension?this.content().find(this.model.targetPane)[e.scrollVal]():this.content()[e.scrollVal]());return"height"==e.dimension&&0==s&&(s=0!=this.scrollTop()?this.scrollTop():0),o=s+i,(e.enableRTL?o<e.scrollable:o>e.scrollable)&&(o=Math.round(e.scrollable)),(e.enableRTL?o>0:0>o)&&(o=0),o!==s&&(this["scroll"+e.xy](o,!0,"",a,n),"X"!==e.xy||t.isNullOrUndefined(this._hScrollbar)?t.isNullOrUndefined(this._vScrollbar)||this._vScrollbar.scroll(o,a,!0,n):this._hScrollbar.scroll(o,a,!0,n)),o!==s},_mouseWheel:function(t){var a;if((!this._vScrollbar||!t.ctrlKey)&&(this._vScrollbar||t.shiftKey)&&t.data&&this.model.enabled){var n,o=0,s=t.data.d,r=t;if(t=t.originalEvent,this._wheelStart&&this._trigger("wheelStart",{originalEvent:t,scrollData:r.data.d}),this._wheelStart=!1,clearTimeout(e.data(this,"timer")),1!=this._wheelx&&(0==t.wheelDeltaX||0==t.wheelDeltaY)&&(this._wheelx=1),0==navigator.platform.indexOf("Mac")&&0==this._wheelx&&("webkit"==this._browser||"chrome"==this._browser))return!0;"mozilla"==this._browser?t.axis==t.HORIZONTAL_AXIS?s=this._scrollXdata:this._scrollYdata:"msie"==this._browser?("wheel"==t.type&&(o=t.deltaX/120),"mousewheel"==t.type&&t.shiftKey&&(s=this._scrollXdata,t.preventDefault?t.preventDefault():t.returnValue=!1)):this._wheelx&&0!=t.wheelDeltaX&&0==t.wheelDeltaY&&this._scrollXdata&&(s=this._scrollXdata),0==t.wheelDeltaX&&(this._wheelx=t.wheelDeltaX),t.wheelDelta?(o=this._normalizingDelta(t),i.opera&&parseFloat(i.opera.version,10)<10&&(o=-o)):t.detail&&(o=t.detail/3),o&&(r.originalEvent&&(n=r.originalEvent.wheelDelta&&r.originalEvent.wheelDelta>0||r.originalEvent.detail&&r.originalEvent.detail<0?-1:1),this._changeTop(s,o*s.scrollOneStepBy,"wheel",t)?(t.preventDefault?t.preventDefault():r.preventDefault(),r.stopImmediatePropagation(),r.stopPropagation(),this._trigger("wheelMove",{originalEvent:t,scrollData:r.data.d,direction:n})):(this._trigger("scrollEnd",{originalEvent:t,scrollData:r}),this._wheelx=0),a=this,e.data(this,"timer",setTimeout(function(){a._wheelStart=!0,a._trigger("wheelStop",{originalEvent:t,scrollData:r.data.d,direction:n})},250)))}},_normalizingDelta:function(e){return 0==navigator.platform.indexOf("Mac")?-e.wheelDelta/3:-e.wheelDelta/120},_contentHeightWidth:function(){"block"==this.content().siblings().css("display")&&this.model.autoHide?(this._hScroll&&this.content()[this._contentHeight](this._ElementHeight-this.model.scrollerSize),this._vScroll&&this.content()[this._contentWidth](this._ElementWidth-this.model.scrollerSize)):"none"==this.content().siblings().css("display")&&this.model.autoHide&&(this._vScroll||this._hScroll)&&(this.content()[this._contentHeight](this._ElementHeight),this.content()[this._contentWidth](this._ElementWidth))},_scrollerHover:function(e){this.model.enabled&&("mouseenter"!=e.type&&"touchstart"!=e.type||this.content().siblings().is(":visible")?("mouseleave"==e.type||"touchend"==e.type)&&(this.content().siblings().hide(),this._contentHeightWidth(),this._trigger("scrollHide",{originalEvent:e})):(this.content().siblings().css("display","block"),this._contentHeightWidth(),this._ensureScrollers(),this._setScrollLeftValue(this.model.scrollLeft),this._trigger("scrollVisible",{originalEvent:e})))},_mouseUp:function(a){if(a.data){var n=a.data.d;this.model.enableRTL&&("mouseup"==a.type||"touchend"==a.type)&&(this.model.scrollLeft=this._rtlScrollLeftValue-this.model.scrollLeft),"mouseup"!==a.type&&"touchend"!==a.type&&(a.toElement||a.relatedTarget)||(this.content().css("cursor","default"),this._off(e(document),"mousemove touchmove"),this._off(e(document),"mouseup touchend",this._mouseUp),n.fromScroller=!1,this._mouseMoved!==!0||"thumb"!==a.data.source||t.isNullOrUndefined(this.model)||(e.when(this.content()).done(t.proxy(function(){this._trigger("thumbEnd",{originalEvent:a,scrollData:n})},this)),this._off(e(i),"blur"))),n.up=!0,i.ontouchmove=null}},_mouseDownOnContent:function(n){var o,s;if(this._startX=n.clientX!=a?n.clientX:n.originalEvent.changedTouches[0].clientX,this._startY=n.clientY!=a?n.clientY:n.originalEvent.changedTouches[0].clientY,this._timeStart=n.timeStamp||Date.now(),this.model.enabled&&(o=n.data.d,this._evtData=n.data,s="e-vhandle"===o.handler?this.element.find("."+o.handler).closest(".e-scrollbar"):this.element.find("."+o.handler).closest(".e-scrollbar"),this._bindBlurEvent(s,n),!this._trigger("thumbStart",{originalEvent:n,scrollData:o}))&&(3!=n.which||2!=n.button)){o.fromScroller=!0;var r,l=null,d=1,h=5;this._document=e(document),this._window=e(i),this._swipe=Math.abs(this._relDisX)>Math.abs(this._relDisY)?this._relDisX<0?"left":"right":this._relDisY<0?"up":"down",this._mouseMove=function(e){var s,c,u;if(this.model.enableRTL&&this._UpdateScrollLeftValue(n),this._startX+this._startY!=e.clientX+e.clientY){if(this._relDisX=(this._startx=e.clientX!=a?e.clientX:e.originalEvent.changedTouches[0].clientX)-this._startX,this._relDisY=(this._starty=e.clientY!=a?e.clientY:e.originalEvent.changedTouches[0].clientY)-this._startY,this._duration=(e.timeStamp||Date.now())-this._timeStart,this._velocityY=Math.abs(this._relDisY)/this._duration,this._velocityX=Math.abs(this._relDisX)/this._duration,!t.isNullOrUndefined(e.target.tagName)&&"iframe"===e.target.tagName.toLowerCase())return e.type="mouseup",void this._mouseUp(e);if(s="mousemove"==e.type?e[o.clientXy]:e.originalEvent.changedTouches[0][o.clientXy],l&&s!==l&&(this._mouseMoved=!0,c=s-l,u=this.model[o.scrollVal]-c,1==d&&Math.abs(c)>h&&(r=o.position,d=0),0==d&&(l=s),u>=0&&u<=o.scrollable&&r===o.position)){var g=this._velocityY>.5&&this._duration<50&&"Top"==o.position,m=this._velocityX>.5&&this._duration<50&&"Left"==o.position,p=(this._velocityY>.5||this._velocityX>.5)&&this._duration<50;p?g?(u=Math.abs(this._relDisY)+this._duration*this._velocityY,this._startY>this._starty?(u+=this.scrollTop(),u>o.scrollable&&(u=o.scrollable)):(u<this.scrollTop()&&(u=Math.abs(u-this.scrollTop())),u>this.scrollTop()&&(u=0)),this.scrollTop()<=o.scrollable&&this.scrollY(u,!1,this.model.animationSpeed,"thumb")):m&&(u=Math.abs(this._relDisX),this._startX>this._startx?(u+=this.scrollLeft(),u>o.scrollable&&(u=o.scrollable)):(u-=this.scrollLeft(),u=Math.abs(u),(u>o.scrollable||u>=this.scrollLeft())&&(u=0)),this.scrollLeft()<=o.scrollable&&this.scrollX(u,!1,this.model.animationSpeed,"thumb")):(this["scroll"+o.xy](u,!0,"","thumb",e.type),"X"===o.xy?this._hScrollbar.scroll(u,"thumb",!0,e.type):t.isNullOrUndefined(this._vScrollbar)||this._vScrollbar.scroll(u,"thumb",!0,e.type),this.content().css("cursor","pointer"),this._trigger("thumbMove",{originalEvent:e,direction:"down"==this._swipe||"right"==this._swipe?1:-1,scrollData:o}))}i.ontouchmove=function(e){e=e||i.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1},null==l&&(l=s),(0==Math.round(this._content.scrollTop())&&"down"==this._swipe||(Math.ceil(this._content.scrollTop())==o.scrollable||Math.ceil(this._content.scrollTop())+1==o.scrollable)&&"up"==this._swipe)&&(this._trigger("scrollEnd",{originalEvent:e.originalEvent,scrollData:e}),i.ontouchmove=null)}},this._on(e(document),"mousemove touchmove",{d:o,source:"thumb"},this._mouseMove),this._mouseMoved=!1,this._on(e(document),"mouseup touchend",{d:o,source:"thumb"},this._mouseUp)}},_scroll:function(e){for(var i,a,n=[this._vScrollbar?this._vScrollbar._scrollData:null,this._hScrollbar?this._hScrollbar._scrollData:null],o=0;2>o;o++)i=n[o],i&&!i.skipChange&&(this.model&&(!this.model.targetPane||this.model.targetPane&&this._evtData&&"X"!=this._evtData.xy)&&("height"===i.dimension?this.scrollTop(e.target[i.scrollVal]):this.scrollLeft(e.target[i.scrollVal])),i.sTop=this.model&&null!=this.model.targetPane&&1==o&&this.content().find(this.model.targetPane).length?this.content().find(this.model.targetPane)[0][i.scrollVal]:"scrollTop"==i.scrollVal?this.scrollTop():this.scrollLeft(),this[i.scrollVal](i.sTop),i.fromScroller||(1===o?(a=this.content()[0],this._rtlScrollLeftValue&&a.scrollWidth-a.clientWidth!=this._rtlScrollLeftValue&&(this._rtlScrollLeftValue=a.scrollWidth-a.clientWidth),i.sTop=this.model&&"mozilla"!=t.browserInfo().name&&this.model.enableRTL&&!this._hScrollbar._scrollData._scrollleftflag?0==this._rtlScrollLeftValue?-1*i.sTop:i.sTop-this._rtlScrollLeftValue:i.sTop,this._hScrollbar.scroll(i.sTop,"",!0)):this._vScrollbar.scroll(i.sTop,"",!0),(2==n.length&&1==o||1==n.length&&0==o)&&(this._externalScroller=!1,this.model&&this._trigger("scroll",{source:"custom",scrollData:this._hScrollbar?this._hScrollbar._scrollData:null,scrollLeft:this.scrollLeft(),originalEvent:e}))));this._UpdateScrollLeftValue(e)},_UpdateScrollLeftValue:function(e){this.model&&"touchstart"!=e.type&&"mousedown"!=e.type&&this.model.enableRTL&&this._rtlScrollLeftValue&&this.model.scrollLeft!=this._previousScrollLeft&&(this.model.scrollLeft=this._rtlScrollLeftValue-this.model.scrollLeft,this._previousScrollLeft=this.model.scrollLeft),(this.model&&"touchstart"==e.type||"mousedown"==e.type)&&this.model.enableRTL&&(this.model.scrollLeft=this.content().scrollLeft(),this.option("scrollLeft",this.content().scrollLeft()))},_changevHandlerPosition:function(e){var t=this._vScrollbar;t&&(e=null!=t._scrollData&&e>=t._scrollData.scrollable?t._scrollData.scrollable:e,null!=t&&e>=0&&e<=t._scrollData.scrollable&&t[t._scrollData.handler].css(t._scrollData.lPosition,e/t._scrollData.onePx+"px"))},_changehHandlerPosition:function(e){var t=this._hScrollbar;t&&(e=null!=t._scrollData&&e>=t._scrollData.scrollable?t._scrollData.scrollable:e,null!=t&&top>=0&&e<=t._scrollData.scrollable&&t[t._scrollData.handler].css(t._scrollData.lPosition,e/t._scrollData.onePx+"px"))},_destroy:function(){this.element.css({width:"",height:""}).children(".e-vscrollbar,.e-hscrollbar").remove(),this.content().removeClass("e-content").css({width:"",height:""}),this.element.removeClass("e-widget")},_preventDefault:function(e){e=e||i.event,e.preventDefault&&e.preventDefault(),e.returnValue=!1}})}(jQuery,Syncfusion,window)}),function(e){"function"==typeof define&&define.amd?define(["./../common/ej.core.min","./ej.checkbox.min"],e):e()}(function(){!function(e,t,i){t.widget("ejMenu","ej.Menu",{element:null,model:null,validTags:["ul"],_setFirst:!1,_rootCss:"e-menu",angular:{terminal:!1},defaults:{height:"",width:"",animationType:"default",orientation:t.Orientation.Horizontal,menuType:"normalmenu",isResponsive:!0,contextMenuTarget:null,htmlAttributes:{},cssClass:"",openOnClick:!1,subMenuDirection:"none",enableCenterAlign:!1,showRootLevelArrows:!0,showSubLevelArrows:!0,enableAnimation:!0,container:null,enableSeparator:!0,enabled:!0,overflowHeight:"auto",overflowWidth:"auto",fields:{child:null,dataSource:null,query:null,tableName:null,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass",url:"url",imageAttribute:"imageAttribute",htmlAttribute:"htmlAttribute",linkAttribute:"linkAttribute",imageUrl:"imageUrl"},enableRTL:!1,titleText:"Menu",locale:"en-US",excludeTarget:null,beforeOpen:null,open:null,close:null,mouseover:null,mouseout:null,click:null,keydown:null,overflowOpen:null,overflowClose:null,create:null,destroy:null},dataTypes:{animationType:"enum",cssClass:"string",titleText:"string",locale:"string",openOnClick:"boolean",enabled:"boolean",enableCenterAlign:"boolean",showArrow:"boolean",showRootLevelArrows:"boolean",showSubLevelArrows:"boolean",enableSeparator:"boolean",isResponsive:"boolean",enableRTL:"boolean",enableAnimation:"boolean",fields:{dataSource:"data",query:"data",child:"data"},excludeTarget:"string",htmlAttributes:"data"},_setModel:function(t){for(var i in t)switch(i){case"menuType":t[i]=this.model.menuType;break;case"fields":this._wireEvents("_off"),this.element.empty().insertBefore(this.wrapper),this.wrapper.remove(),e.extend(this.model.fields,t[i]),this._intializeData(),this.model.enabled||this._wireEvents("_off");break;case"orientation":this._setOrientation(t[i]);break;case"showRootLevelArrows":this._addArrow(t[i],this.model.showSubLevelArrows);break;case"showSubLevelArrows":this._addArrow(this.model.showRootLevelArrows,t[i]);break;case"enableSeparator":this._setSeparator(t[i]);break;case"height":this._setHeight(t[i]);break;case"width":this._setWidth(t[i]);break;case"cssClass":this._setSkin(t[i]);break;case"isResponsive":this.model.isResponsive?this._responsiveLayout():(e(this.resWrap).remove(),e(this.wrapper).removeClass("e-menu-responsive"),e(this.element).removeClass("e-menu-responsive"),this.resWrap=null);break;case"htmlAttributes":this._addAttr(t[i]);break;case"enableRTL":this._setRTL(t[i]);break;case"enableCenterAlign":this._centerAlign(t[i]);break;case"excludeTarget":this.model.excludeTarget=t[i];break;case"enabled":this.model.enabled=t[i],this._controlStatus(t[i]);break;case"animationType":this._setAnimation(t[i]);break;case"enableAnimation":this.model.enableAnimation=t[i];break;case"openOnClick":this._hoverOpen=!t[i],this._hoverClose=!t[i];break;case"subMenuDirection":this._setSubMenuDirection(this.model.subMenuDirection);break;case"titleText":this._titleText(t[i]);break;case"locale":this.model.locale=t[i],this._updateLocalConstant(),this._setLocale();break;case"overflowHeight":this._setOverflowDimensions("height",t[i]);break;case"overflowWidth":this._setOverflowDimensions("width",t[i])}},_updateLocalConstant:function(){this._localizedLabels=t.getLocalizedConstants("ej.Menu",this.model.locale)},_setLocale:function(){this._titleText(this._localizedLabels.titleText)},_titleText:function(i){this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&e(this.label).text(i)},_destroy:function(){this.model.menuType==t.MenuType.ContextMenu?this._referenceElement.append(this._cloneElement):this._cloneElement.insertBefore(this.wrapper),this._cloneElement.removeClass("e-menu e-js"),this.wrapper.remove()},_init:function(){this._cloneElement=this.element.clone(),this.element.css("visibility","hidden"),this._setValues(),this._intializeData(),this.element.css("visibility","visible")},_setValues:function(){this._mouseOver=!0,this._hoverOpen=!0,this._hoverClose=!0,this._isMenuOpen=!1,this._hideSpeed=100,this._showSpeed=100,this._isSubMenuOpen=!1,this._isContextMenuOpen=!1,this._disabledMenuItems=[],this._hiddenMenuItems=[],this._delayMenuHover=0,this._delaySubMenuHover=0,this._delaySubMenuShow=0,this._preventContextOpen=!0,this._setAnimation(this.model.animationType),this._isFocused=!0,this._menuOverflowItems=[],this._menuHeaderItems=[],this._menuCloneItems=[],this._itemWidth=0},_intializeData:function(){t.isNullOrUndefined(this.model.fields)||null==this.model.fields.dataSource?(this._renderMenu(),this._wireEvents("_on"),this._calculateOverflowItems()):(this._generateTemplate(this.model.fields.dataSource),this._renderMenu())},_renderMenu:function(){this._renderControl(),this._addArrow(this.model.showRootLevelArrows,this.model.showSubLevelArrows),this._renderArrow(),this._intializeMenu(),this._itemWidth=this.element.width(),this.model.isResponsive&&this._ensureResponsiveClasses(e(window).width()<767),
"horizontal"==this.model.orientation&&(this._on(this.element.parent().find("span.e-check-wrap.e-icon"),"click",this._mobileResponsiveMenu),null!=this.model.fields.dataSource&&this._calculateOverflowItems())},_renderControl:function(){"normalmenu"==this.model.menuType?(this.wrapper=t.buildTag("div"),this.wrapper.addClass(this.model.cssClass+" e-menu-wrap")):this.wrapper=t.buildTag("div.e-menu-wrap"),this.model.isResponsive&&this._responsiveLayout(),this.model.menuType!=t.MenuType.ContextMenu&&(this.wrapper.insertBefore(this.element),this.wrapper.append(this.element)),this.element.addClass("e-menu e-widget e-box").attr({role:"menu",tabindex:0}),this._addAttr(this.model.htmlAttributes),this.model.enableRTL&&this._setRTL(this.model.enableRTL),this._setSubMenuDirection(this.model.subMenuDirection),"normalmenu"==this.model.menuType?"horizontal"==this.model.orientation?this.element.addClass("e-horizontal"):this.element.addClass("e-vertical"):this._contextMenu_Template(),this._addClass(),this.model.enableCenterAlign&&this._centerAlign(this.model.enableCenterAlign),this.model.enableSeparator&&this._setSeparator(!0),this.model.enabled||this.disable()},_renderPopupWrapper:function(){if(this._ensureOverflowPopup()){this.popupWrapper=t.buildTag("div.e-menu-popwrap"),this.popupWrapper.insertAfter(this.element);var e="number"==typeof value?this.model.overflowHeight+"px":this.model.overflowHeight,i="number"==typeof value?this.model.overflowWidth+"px":this.model.overflowWidth;this.popupWrapper.css({height:e,width:i}),this.popupWrapper.hide(),this._addOverflowItems()}},_calculateOverflowItems:function(){var i,a,n;if(this._ensureOverflowPopup()){this.element.find("li.e-list").removeClass("e-menu-show"),e(this.lastelement).removeClass("e-last"),this._menuHeaderItems=[],i=this.element.outerWidth(),this.element.find("li.e-ham-wrap").length>0&&(this._itemWidth<=this.element.width()||this._itemWidth>=this.element.width()&&!this._isOverflowPopupOpen())&&(t.isNullOrUndefined(this.popupWrapper)||this.popupWrapper.hide()),this._renderHamburgerIcon(),this.element.find("li.e-ham-wrap").css({display:"list-item"});var o=this.element.find("li.e-ham-wrap").outerWidth(),s=0,r=!0;for(this.element.find("li.e-ham-wrap").hide(),this._menuHeaderItems=this.element.find(">li.e-list"),this._menuOverflowItems=[],a=0;a<this._menuHeaderItems.length;a++)if(n=e(this._menuHeaderItems[a]),s+=n.outerWidth(),i>s)n.removeClass("e-menu-hide"),this.element.find(">li.e-list.e-haschild>ul").find("li.e-haschild").find("span.e-icon.e-arrowhead-down").removeClass("e-arrowhead-down").addClass("e-arrowhead-right"),this.model.enableSeparator&&this._setSeparator(!0);else{if(r){r=!1,this.element.find("li.e-ham-wrap").css({display:"list-item"}),s=s-n.outerWidth()+o,a>1&&(s-=e(this._menuHeaderItems[a-1]).outerWidth(),a-=2);continue}this._menuOverflowItems.push(e(n).clone(!0)),n.addClass("e-menu-hide")}this._menuOverflowItems.length>0?(this._renderHamburgerIcon(),e(".e-menu-popwrap").length?this._addOverflowItems():this._renderPopupWrapper(),this.lastelement=this.element.find(">li.e-list:visible").last().addClass("e-last"),this.element.find(">li.e-list.e-haschild>ul").find("li.e-haschild").find("span.e-icon.e-arrowhead-down").removeClass("e-arrowhead-down").addClass("e-arrowhead-right")):0==this._menuOverflowItems.length&&e("li.e-ham-wrap").length>0&&this.element.find("li.e-ham-wrap").remove()}("vertical"==this.model.orientation||this.model.menuType==t.MenuType.ContextMenu&&e(window).width()>=768&&this.model.isResponsive)&&this.element.find("span.e-icon.e-arrowhead-down").removeClass("e-arrowhead-down").addClass("e-arrowhead-right")},_renderHamburgerIcon:function(){if(this._ensureOverflowPopup()&&0==this.element.find("li.e-ham-wrap").length){var i=t.buildTag("li.e-ham-wrap"),a=t.buildTag("div");this.hamburgerspan=t.buildTag("span.e-hamburger"),a.append(this.hamburgerspan),i.append(a),this.element.append(i),0!=this.model.height?this._setHeight(this.model.height):e("li.e-ham-wrap").css({height:this.element.find("li.e-list").first().height()}),this._on(this.element.find("li.e-ham-wrap"),"click",this._overflowOpen)}},_addOverflowItems:function(){var i,a,n;if(this._ensureOverflowPopup()&&e(".e-menu-popwrap").length>0&&!t.isNullOrUndefined(this.popupWrapper)){for(this.popupWrapper.empty(),this._menuCloneItems.length=0,i=0;i<this._menuOverflowItems.length;i++)this._menuCloneItems.push(e(this._menuOverflowItems[i]).clone(!0));for(this.ulTag=t.buildTag("ul"),this.ulTag.addClass("e-menu e-js e-responsive e-widget e-box e-vertical"),this.popupWrapper.append(this.ulTag),i=0;i<this._menuCloneItems.length;i++)e(this._menuCloneItems[i]).hasClass("e-haschild")&&(e(this._menuCloneItems[i]).find("span.e-icon").removeClass("e-arrowhead-down e-arrowhead-right").addClass("e-arrowhead-down"),e(this._menuCloneItems[i]).children("span.e-menu-arrow.e-menu-left").remove()),this.ulTag.append(this._menuCloneItems[i]);e(this.ulTag).children("li").removeClass("e-menu-hide"),a=Math.round(this.popupWrapper.width()),a>0&&(n=this.popupWrapper.innerWidth(),this.popupWrapper.find("ul.e-menu").css({width:n+"px"})),this.model.enableSeparator&&this._setSeparator(!0)}},_overflowOpen:function(e){if(this._isOverflowPopupOpen()){var i=t.util.getOffset(this.element),a=i.left+(this.model.enableRTL?0:this.element.outerWidth()-this.popupWrapper.outerWidth()),n=i.top+this.element.outerHeight();this.wrapper.parent().length&&("absolute"==this.wrapper.parent().css("position")||"relative"==this.wrapper.parent().css("position"))&&(i=t.util.getOffset(this.wrapper.parent()),a-=i.left,n-=i.top),this.popupWrapper.css({left:a,top:n}),this.popupWrapper.show(),this._trigger("overflowOpen",{e:e})}else this._overflowClose(e)},_overflowClose:function(e){this._ensureOverflowPopup()&&!t.isNullOrUndefined(this.popupWrapper)&&(this.popupWrapper.find("li.e-list").removeClass(".e-mhover.e-active.e-mfocused"),this._hideAnimation(this.popupWrapper.find('li.e-list:has("> ul")').find("> ul:visible"),this._hideAnim),this.popupWrapper.hide(),this._trigger("overflowClose",{e:e}))},_isOverflowPopupOpen:function(){return e(this.popupWrapper).length>0?"none"==this.popupWrapper.css("display"):void 0},_removePopup:function(){e(window).width()<767&&this.model.isResponsive&&(this._ensureResponsiveClasses(e(window).width()),this.element.find("li.e-ham-wrap").length>0&&this.popupWrapper.length>0&&(this.element.find("li.e-ham-wrap").remove(),e(".e-menu-popwrap").remove(),this.element.find("li.e-list").addClass("e-menu-show")))},_mobileResponsiveMenu:function(){this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&"none"==this.element.css("display")?this.element.removeClass("e-res-hide").addClass("e-res-show"):this.model.menuType==t.MenuType.ContextMenu||"vertical"==this.model.orientation||"none"==this.element.css("display")||this.element.removeClass("e-res-show").addClass("e-res-hide")},_ensureOverflowPopup:function(){return this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&e(window).width()>=768&&this.model.isResponsive},_onResize:function(){this.element.find("li.e-ham-wrap").hide(),e(window).width()>=768?this._calculateOverflowItems():this._removePopup()},_ensureResponsiveClasses:function(e){e&&this.element.find("span.e-icon").hasClass("e-arrowhead-right")&&this.element.find("span.e-icon.e-arrowhead-right").removeClass("e-arrowhead-right").addClass("e-arrowhead-down")},_responsiveLayout:function(){this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&(this.wrapper.addClass("e-menu-responsive"),this.element.addClass("e-menu-responsive"),this.resWrap=t.buildTag("span.e-menu-res-wrap e-menu-responsive"),this.inResWrap=t.buildTag("span.e-in-wrap e-box e-menu-res-in-wrap"),this.label=t.buildTag("span.e-res-title").html("en-US"==this.model.locale?this.model.titleText:t.Menu.Locale[this.model.locale]&&t.Menu.Locale[this.model.locale].titleText?t.Menu.Locale[this.model.locale].titleText:this.model.titleText),this.check=t.buildTag("span.e-check-wrap e-icon"),this.wrapper.append(this.resWrap),this.resWrap.append(this.inResWrap),this.inResWrap.append(this.label).append(this.check))},_addAttr:function(t){var i=this;e.map(t,function(e,t){"class"==t?i.wrapper.addClass(e):"disabled"==t&&"disabled"==e?i.disable():i.element.attr(t,e)})},_oncheck:function(e){var t=this.element.parents(".e-menu-wrap").children(".e-menu");e.isChecked?t.removeClass("e-res-hide").addClass("e-res-show"):t.removeClass("e-res-show").addClass("e-res-hide")},_addClass:function(){var t,i,a,n,o;for(this.element.find('li:has("> ul")').find("> a,> span").addClass("aschild"),this.element.find(">li").addClass("e-list").attr({role:"menuitem"}),this.element.find("li").find(">a, >span").addClass("e-menulink"),t=this.element.find(".e-list a.aschild"),i=this.element.find(".e-list span.aschild"),o=0;o<t.length;o++)a=e(t[o]),a.siblings().attr({"aria-hidden":!0}),a.parent().attr({"aria-haspopup":!0,role:"menuitem"}).addClass("e-haschild"),a.siblings("ul").children("li").addClass("e-list").attr("role","menuitem");for(o=0;o<i.length;o++)n=e(i[o]),n.siblings().attr({"aria-hidden":!0}),n.parent().attr({"aria-haspopup":!0,role:"menu"}).addClass("e-haschild"),n.siblings("ul").children("li").addClass("e-list").attr("role","menuitem")},_renderArrow:function(){if(this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&0==e(e(this.element).find("span.e-menu-arrow")).length){var i=t.buildTag("span.e-menu-arrow e-menu-left");e(i).append("<span class='e-arrowMenuOuter'></span>").append("<span class='e-arrowMenuInner'></span>"),this.element.find(">li.e-list.e-haschild").append(i)}},_generateTemplate:function(e){var i,a=this;e instanceof t.DataManager?(i=e.executeQuery(this._columnToSelect(this.model.fields)),i.done(function(e){a._odataFlag=!0,a._generateItemTemplate(e.result),0!=a.model.height&&a._setHeight(a.model.height),a._wireEvents("_on")})):(a._odataFlag=!1,this._generateItemTemplate(a.model.fields.dataSource),this._wireEvents("_on"))},_generateItemTemplate:function(e){for(var t,i=0;i<e.length;i++)(null==e[i][this.model.fields.parentId]||0==e[i][this.model.fields.parentId])&&(t=this._menuTemplate(e[i],e,this.model.fields),this.element.append(t))},_menuTemplate:function(i,a,n){var o,s,r,l,d,h,c,u,g,m,p;if(o=e(document.createElement("li")),o.attr("class","e-list"),i[n.htmlAttribute]&&this._setAttributes(i[n.htmlAttribute],o),s=e(document.createElement("a")),s.attr("class","e-menulink"),i[n.imageUrl]&&""!=i[n.imageUrl]?(r=e(document.createElement("img")),r.attr("src",i[n.imageUrl]),i[n.imageAttribute]&&this._setAttributes(i[n.imageAttribute],r),s.append(r)):i[n.spriteCssClass]&&""!=i[n.spriteCssClass]&&(l=e(document.createElement("span")),l.addClass(i[n.spriteCssClass]),s.append(l)),s.append(i[n.text]),i[n.linkAttribute]&&this._setAttributes(i[n.linkAttribute],s),i[n.url]&&s.attr("href",i[n.url]),o.append(s),i[n.id]&&o.prop("id",i[n.id]),t.isNullOrUndefined(n.child)){if(!this._odataFlag&&(u=t.DataManager(n.dataSource).executeLocal(t.Query().where(n.parentId,t.FilterOperators.equal,i[n.id])),u&&u.length>0)){for(g=t.buildTag("ul"),m=0;m<u.length;m++)p=this._menuTemplate(u[m],n.dataSource,n),g.append(p);o.append(g)}}else if(this._odataFlag=!0,n.child.dataSource instanceof t.DataManager)d=this,h=t.Query(),e(o).attr({"aria-haspopup":!0,role:"menu"}).addClass("e-haschild"),h=this._columnToSelect(n.child),h.where(n.child.parentId,t.FilterOperators.equal,i[n.id]),c=n.child.dataSource.executeQuery(h),c.done(function(t){var i,a,s,r=t.result;if(r&&r.length>0){for(i=e(document.createElement("ul")),a=0;a<r.length;a++)s=d._menuTemplate(r[a],n.child.dataSource,n.child),i.append(s);o.append(i),e(o).children("a").addClass("aschild"),e(o).parent().hasClass("e-menu")&&d.model.showRootLevelArrows?e(o).children("a.aschild").append(e("<span>").addClass("e-icon e-arrowhead-down")).addClass("e-arrow-space"):d.model.showSubLevelArrows&&e(o).children("a.aschild").append(e("<span>").addClass("e-icon e-arrowhead-right")).addClass("e-arrow-space"),0!=d.model.height&&d._setHeight(d.model.height)}}),c.then(function(){d._renderArrow()});else if(t.isNullOrUndefined(i.child)||(t.isPlainObject(i.child)?u=t.DataManager(n.child.dataSource).executeLocal(t.Query().where(n.child.parentId,t.FilterOperators.equal,i[n.id])):i.child instanceof Array&&(u=i.child)),u&&u.length>0){for(g=e(document.createElement("ul")),m=0;m<u.length;m++)p=this._menuTemplate(u[m],n.child.dataSource,n.child),g.append(p);o.append(g)}return o},_setAttributes:function(e,t){for(var i in e)"class"==i?t.addClass(e[i]):t.attr(i,e[i])},_addArrow:function(t,i){if(t){var a="horizontal"==this.model.orientation?"e-arrowhead-down":"e-arrowhead-right";this.element.find('>li.e-list:has("> ul")').children("a").append(e("<span>").addClass("e-icon "+a)).addClass("e-arrow-space")}else this.element.find('>li.e-list:has("> ul")').children("a").removeClass("e-arrow-space").children("span.e-icon").remove();i?this.element.find(">li.e-list > ul li.e-list:has(>ul)").children("a").append(e("<span>").addClass("e-icon e-arrowhead-right")).addClass("e-arrow-space"):this.element.find(">li.e-list > ul li.e-list:has(>ul)").children("a").removeClass("e-arrow-space").children("span.e-icon").remove()},_intializeMenu:function(){0!=this.model.height&&this._setHeight(this.model.height),0!=this.model.width&&this._setWidth(this.model.width),"contextmenu"==this.model.menuType&&(this.model.openOnClick=!1),this.model.openOnClick&&(this._hoverOpen=!1,this._hoverClose=!1)},_setOrientation:function(e){"horizontal"==e?this.element.removeClass("e-vertical e-horizontal").addClass("e-horizontal"):this.element.removeClass("e-horizontal e-vertical").addClass("e-vertical"),"vertical"==e&&this._removePopup()},_setHeight:function(i){"horizontal"==this.model.orientation&&"auto"!==i?(i="number"==typeof i?i+"px":i,this.element.find("> li").find(">a:first").css("line-height",i),this.model.showRootLevelArrows&&this.element.find("> li").find(">a:first").find("> span:first").css({"line-height":i,top:"0px"}),this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&e("li.e-ham-wrap").length>0&&(this.element.find("li.e-ham-wrap").children("div").css({"line-height":i}),this.element.find("li.e-ham-wrap").css({height:i}),e(".e-menu-popwrap").length>0&&this.popupWrapper.find("a.e-menulink").css({"line-height":i}))):this.element.height(i)},_setWidth:function(e){this.element.css("width",e),"horizontal"===this.model.orientation&&"auto"!==e&&this.model.isResponsive&&this.resWrap.css("width",e),"horizontal"==this.model.orientation&&this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&this._calculateOverflowItems()},_setOverflowDimensions:function(e,i){this.model.menuType!=t.MenuType.ContextMenu&&"vertical"!=this.model.orientation&&(i="number"==typeof i?i+"px":i),"height"==e?this.popupWrapper.css({height:i}):"width"==e&&this.popupWrapper.css({width:i}),this._addOverflowItems()},_setRTL:function(e){e?this.element.removeClass("e-rtl").addClass("e-rtl"):this.element.removeClass("e-rtl"),e&&"horizontal"===this.model.orientation?this.wrapper.removeClass("e-menu-rtl").addClass("e-menu-rtl"):this.wrapper.removeClass("e-menu-rtl"),this.model.subMenuDirection=e?"left":"right"},_setSubMenuDirection:function(e){"left"!=e&&"right"!=e&&(this.model.subMenuDirection=this.model.enableRTL?"left":"right")},_setAnimation:function(e){"none"===e?(this._showAnim="none",this._hideAnim="none"):(this._showAnim="slideDown",this._hideAnim="slideUp")},_controlStatus:function(e){1!=e?this.disable():this.enable()},_centerAlign:function(e){"horizontal"==this.model.orientation&&e?this.element.css("text-align","center"):this.element.css("text-align","inherit")},_columnToSelect:function(e){var i,a=[],n=t.Query();if(t.isNullOrUndefined(e.query)){for(i in e)"tableName"!==i&&"child"!==i&&"dataSource"!==i&&e[i]&&a.push(e[i]);a.length>0&&n.select(a),this.model.fields.dataSource.dataSource.url.match(e.tableName+"$")||t.isNullOrUndefined(e.tableName)||n.from(e.tableName)}else n=e.query;return n},_max_zindex:function(){var t,i,a,n;return"contextmenu"==this.model.menuType?(t=e(this._targetElement).parents(),t.push(this._targetElement)):t=e(this.element).parents(),i=e("body").children(),n=i.index(this.popup),i.splice(n,1),e(i).each(function(e,i){t.push(i)}),a=Math.max.apply(a,e.map(t,function(t){return"static"!=e(t).css("position")?parseInt(e(t).css("z-index"))||1:void 0})),!a||1e4>a?a=1e4:a+=1,a},_recursiveFunction:function(t,i){var a=this,n=!1;e.each(t,function(e,t){return t.Text==i?(a.selectedItem=t,n=!0,!1):(null!=t.ChildItems&&a._recursiveFunction(t.ChildItems,i),n?!1:void 0)})},_contextMenu_Template:function(){if(""!=this.element[0].id)var t=e(".e-menu-wrap #"+this.element[0].id).get(0);t&&e(t.parentElement).remove(),this.model.orientation="vertical",this.element.addClass(this.model.cssClass+" e-context"),this.element.css("display","none"),this._referenceElement=this.element.parent(),e("body").append(this.element),this.wrapper.insertBefore(this.element),this.wrapper.append(this.element)},_closeMenu:function(){this._hideAnimation(this.element.find('li.e-list:has("> ul")').find("> ul:visible"),this._hideAnim)},_onMenuIntent:function(e,t,i){t._delayMenuHover=window.setTimeout(function(){if(1==t._mouseOver&&i){var a=t._showAnim,n=t._hideAnim;t._showSpeed,t._hideSpeed;t._show(e,a,n)}},this._showSpeed)},_onHide:function(e,t,i){t._delaySubMenuHover=window.setTimeout(function(){if(0==t._mouseOver&&i){t._id,t._hideAnim,t._hideSpeed;t._closeAll()}},t._hideSpeed)},_subMenuPos:function(t,a){var n,o,s,r,l,d,h,c,u=e(t).offset(),g=u.left,m=e("ul:first",t),p=e(t).outerWidth();if(null==u||u==i)return!1;if(s=m.outerWidth()+1,r=this.model.container?e(this.model.container).width()+e(document).scrollLeft():document.documentElement.clientWidth+e(document).scrollLeft(),"normalmenu"==this.model.menuType)if(e(t.parentNode).is(this.element))"horizontal"==this.model.orientation?(m.css("top",e(t).outerHeight()+"px"),this.model.enableRTL?(o=0>g+p-s?g+p-s:1,m.css({left:"auto",right:o+"px"})):(n=g+s>r?g+s-r:1,m.css("left",-1*n+"px"))):"left"==a&&g>s||"right"==a&&r<=u.left+p+s&&g>s?m.css("left",-(s+4)+"px"):m.css("left",e(t).outerWidth()+4+"px");else if("left"==a&&g>s||"right"==a&&r<=u.left+p+s&&g>s)m.css("left",-(s+4)+"px");else{m.css("left",e(t).outerWidth()+4+"px");var h=m.outerHeight(),f=e(window).height(),v=f-(u.top-e(window).scrollTop());h>f?(l=u.top-e(window).scrollTop(),m.css("top",-l+4+"px")):h>v?(l=v-h,m.css("top",l-2+"px")):m.css("top","")}else r-=u.left+2*s+4,0>r?(d=null==s?"-206.5px":"-"+(s+5)+"px",m.css("left",d)):m.parent("li.e-list").parent("ul").width()&&"right"==a?m.css("left",m.parent("li.e-list").parent("ul").width()+4+"px"):u.left>s&&m.css("left",-(s+4)+"px"),h=m.outerHeight(),u.top+h>e(window).height()?(c=-h+e(t).outerHeight(),h>u.top+e(t).outerHeight()/2?m.css("top",-(h/2)+"px"):m.css("top",c+"px")):m.css("top","0px")},_setSkin:function(e){this.wrapper.removeClass(this.model.cssClass).addClass(e+" e-menu-wrap")},_setSeparator:function(i){i?(this.element.addClass("e-separator"),e(".e-menu-popwrap").length>0&&!t.isNullOrUndefined(this.ulTag)&&this.ulTag.addClass("e-separator")):this.element.removeClass("e-separator")},_contextMenuEvents:function(t){this[t](e(this.model.contextMenuTarget),"mouseup taphold",this._ContextMenuHandler),this[t](this.element,"contextmenu",this._onDefaultPreventer),this[t](e(this.model.contextMenuTarget),"contextmenu",this._onDefaultPreventer),this[t](e(document),"mousedown",this._onContextClose)},_show:function(t,i,a){var n,o=e("> ul",t),s=this._max_zindex();o.attr({"aria-hidden":!1}),this._hideAnimation(e(t).siblings().find(" > ul:visible"),a),e.inArray(this._disabledMenuItems,t)>-1||("none"!=o.css("display")?(n=this.model.openOnClick?e(o):o.children().find("> ul"),this._hideAnimation(n,a)):e("> ul",t).children().find("> ul").hide(),this._subMenuPos(t,this.model.subMenuDirection),o.css({"z-index":s+1}),e(t).children("span.e-menu-arrow").css({"z-index":s+2}),"block"==e("> ul",t).css("display")||e(t).hasClass("e-disable-item")||(this._showAnimation(o,i),o.closest("li").addClass("e-active e-mfocused")),e(t).siblings("li.e-active").length>0&&e(t).siblings("li.e-active").removeClass("e-active e-mfocused"))},_closeAll:function(){this._hideAnimation(this.element.find('li.e-list:has("> ul")').find("> ul:visible"),this._hideAnim),this._hideAnimation(this.element.find("> ul:visible"),this._hideAnim)},_showAnimation:function(e,t){switch(t){case"slideDown":e.slideDown(this.model.enableAnimation?200:0);break;case"none":e.css("display","block")}},_hideAnimation:function(t,i){switch(i){case"slideUp":e(t).attr({"aria-hidden":!0}),t.slideUp(this.model.enableAnimation?100:0);break;case"none":t.css("display","none")}t.closest("li").removeClass("e-active e-mfocused")},_removeValue:function(i,a){for(var n=t.browserInfo(),o="8.0"===n.version&&"msie"===n.name?i[0].outerText:i[0].textContent,s=e(a).length,r=0,l=0==e(a).children("a").length?e(a).children("span"):e(a).children("a");s>=r;){if(e(l[r]).text()===o)return r;r++}},_createSubLevelItem:function(t,i){var a;a=e(document.createElement("ul")),a.append(i),t.append(a),t.attr({role:"menu","aria-haspopup":"true"}),t.addClass("e-haschild"),this.element.find('li:has("> ul")').find("> a,>span").addClass("aschild e-arrow-space"),this._insertArrows(a)},_insertArrows:function(t){this.model.showRootLevelArrows?t.find(">a,>span").append(e("<span>").addClass("e-icon e-arrowhead-down")).addClass("e-arrow-space"):t.find(">a,>span").removeClass("e-arrow-space").find(">span.e-icon").remove(),this.model.showSubLevelArrows?t.parent("li.e-list:has(>ul)").children("a,span").append(e("<span>").addClass("e-icon e-arrowhead-right")).addClass("e-arrow-space"):t.parent("li.e-list:has(>ul)").children("a,span").removeClass("e-arrow-space").find(">span.e-icon").remove()},_createMenuItem:function(t){var i,a,n,o;return i=e(document.createElement("li")),i.attr({"class":"e-list",role:"menuitem"}),t.htmlAttribute&&this._setAttributes(t.htmlAttribute,i),t.text&&""!=t.text&&(a=e(document.createElement("a")),a.attr({"class":"e-menulink"}),t.imageUrl&&""!=t.imageUrl?(n=e(document.createElement("img")),n.attr("src",t.imageUrl),t.imageAttribute&&this._setAttributes(t.imageAttribute,n),a.append(n)):t.spriteCssClass&&""!=t.spriteCssClass&&(o=e(document.createElement("span")),o.addClass(t.spriteCssClass),a.append(o)),a.append(t.text),t.linkAttribute&&this._setAttributes(t.linkAttribute,a),t.url&&a.attr("href",t.url),i.append(a)),t.id&&i.prop("id",t.id),this.model.enabled||i.addClass("e-disable-item"),i},_insertNode:function(i,a,n){var o=0,s=0,r=0,l=[];for(e(a).is(this.element)?l.push(this.element):"string"==typeof a?l.push(this.element.find(a)):"undefined"==typeof a?l.push(this.element):l.push(a),s=0;s<l.length;s++)for(r=0;r<l[s].length;r++)for(o=0;o<i.length&&!t.isNullOrUndefined(i[o]);o++)this._addItem(i[o],l[s][r],n)},_addItem:function(t,i,a){var n,o;switch(this._wireEvents("_off"),n=this._createMenuItem(t),i=e("default"===i?"#"+t.parentId:i),a){case"insert":o=e(i).is(this.element)?i:i.children("ul"),0!=o.length?o.append(n):this._createSubLevelItem(i,n);break;case"insertBefore":e(i).is(this.element)?i.prepend(n):n.insertBefore(i);break;case"insertAfter":e(i).is(this.element)?i.append(n):n.insertAfter(i)}this._wireEvents("_on")},_removeItem:function(e){0==e.siblings("li").length?(e.closest("ul").siblings("a.aschild").removeClass("aschild e-arrow-space").children("span.e-icon").remove(),e.closest("ul").hasClass("e-menu")?e.remove():e.closest("ul").remove()):e.remove()},_hiddenElement:function(t){t.length>0&&-1==e.inArray(t[0],this._hiddenMenuItems)&&(t.addClass("e-hidden-item"),this._hiddenMenuItems.push(t[0]))},_showElement:function(t){t.length>0&&e.inArray(t[0],this._hiddenMenuItems)>-1&&(t.removeClass("e-hidden-item"),this._hiddenMenuItems.splice(this._hiddenMenuItems.indexOf(t[0]),1))},_getNodeByID:function(t){return"object"!=typeof t&&""!=t&&(t=this.element.find(".e-list"+t)),e(t)},_processItems:function(t,i){for(var a=this._getNodeByID(t),n=0;n<a.length;n++)i?this._showElement(e(a[n])):this._hiddenElement(e(a[n]))},insert:function(e,t){this._insertNode(e,t,"insert")},insertBefore:function(e,t){this._insertNode(e,t,"insertBefore")},insertAfter:function(e,t){this._insertNode(e,t,"insertAfter")},remove:function(t){for(var i=0,a=0,i=0;i<t.length;i++)for(t[i]="string"==typeof t[i]?this.element.find(t[i]):t[i],a=0;a<t[i].length;a++)"LI"===t[i][a].tagName||"UL"===t[i][a].tagName?this._removeItem(e(t[i][a])):t[i][a].remove()},showContextMenu:function(i,a,n,o,s){if(this._closeMenu(),this._eventArgs=o,t.isNullOrUndefined(o)||!this._checkForExclusion(o.target)){if(this._trigger("beforeOpen",{target:n,events:o}))return!1;if(this._preventContextOpen){if(this._targetElement=t.isNullOrUndefined(n)?t.isNullOrUndefined(target)?this.element:target:n,s){var r=this._calculateContextMenuPosition(o);i=r.X,a=r.Y}this.element.css({left:i,top:a}),this.element.css({"z-index":this._max_zindex()+1}),this._showAnimation(this.element,this._showAnim),this._isContextMenuOpen=!0,this.element.focus(),this._trigger("open",{target:n}),this._on(t.getScrollableParents(e(this.model.contextMenuTarget)),"scroll",this.hideContextMenu)}return!1}},_checkForExclusion:function(i){var a,n;if(!t.isNullOrUndefined(this.model.excludeTarget))for(a=this.model.excludeTarget.split(","),n=0;n<a.length;n++)if(e(i).closest(this.model.excludeTarget).is(e.trim(a[n])))return!0},hideContextMenu:function(i){this._closeMenu(),this.element.find(".e-mhover").removeClass("e-mhover"),this.element.find(".e-mfocused").removeClass("e-mfocused"),this._hideAnimation(this.element,this._hideAnim),this._isContextMenuOpen=!1,this._trigger("close",e.extend({events:i},i)),this._off(t.getScrollableParents(e(this.model.contextMenuTarget)),"scroll",this.hideContextMenu)},disableItem:function(t){var i=e(this.element.find("li.e-list >a ,li.e-list >span")).filter(function(){return e.trim(e(this).text())===t});i.length>0&&!(e.inArray(i.parent()[0],this._disabledMenuItems)>-1)&&(i.parent().addClass("e-disable-item").attr({"aria-disabled":!0}),i.parent().find(">a.aschild span.e-icon").addClass("e-disable"),this._disabledMenuItems.push(i.parent()[0]))},disableItemByID:function(t){if(t&&""!=t){var a=this.element.find("#"+t)?this.element.find("#"+t)[0]:i;!a||e.inArray(a,this._disabledMenuItems)>-1||(e(a).addClass("e-disable-item").attr({"aria-disabled":!0}),e(a).find(">a.aschild span.e-icon").addClass("e-disable"),this._disabledMenuItems.push(a))}},getHiddenItems:function(){return this._hiddenMenuItems},hideItems:function(e){if("object"==typeof e&&e.length!==i)for(var t=0;t<e.length;t++)this._processItems(e[t],!1);else this._processItems(e,!1)},showItems:function(e){if("object"==typeof e&&e.length!==i)for(var t=0;t<e.length;t++)this._processItems(e[t],!0);else this._processItems(e,!0)},enableItem:function(t){var i,a=e(this.element.find("li.e-list >a ,li.e-list >span")).filter(function(){return e.trim(e(this).text())===t});a.length>0&&e.inArray(a.parent()[0],this._disabledMenuItems)>-1&&(a.parent().removeClass("e-disable-item").attr({"aria-disabled":!1}),a.parent().find(">a.aschild span.e-icon").removeClass("e-disable"),i=this._removeValue(a,this._disabledMenuItems),this._disabledMenuItems.splice(i,1))},enableItemByID:function(t){var i,a;if(t&&""!=t&&(i=this.element.find("#"+t)[0],i&&e.inArray(i,this._disabledMenuItems)>-1))for(e(i).removeClass("e-disable-item").attr({"aria-disabled":!1}),e(i).find(">a.aschild span.e-icon").removeClass("e-disable"),a=this._disabledMenuItems.length-1;a>=0;a--)this._disabledMenuItems[a].id==t&&this._disabledMenuItems.splice(a,1)},disable:function(){this.model.enabled=!1;var t=this.element.find(">li[class~=e-list]"),i=this;e.each(t,function(t,a){e.inArray(a,i._disabledMenuItems)>-1||(e(a).addClass("e-disable-item").attr({"aria-disabled":!0}),e(a).find(">a.aschild span.e-icon").addClass("e-disable"),i._disabledMenuItems.push(a))})},enable:function(){var t,i=this;this.model.enabled=!0,t=this.element.find("li.e-disable-item"),e.each(t,function(t,a){e(a).removeClass("e-disable-item").attr({"aria-disabled":!1}),e(a).find(">a.aschild span.e-icon").removeClass("e-disable"),i._disabledMenuItems.pop(a)})},show:function(e,t,i,a){return this.model.enabled?void("contextmenu"==this.model.menuType?this.showContextMenu(e,t,i,a,!1):this.element.css("display","block")):!1},hide:function(e){return this.model.enabled?void("contextmenu"==this.model.menuType?this.hideContextMenu(e):(this._closeMenu(),this.element.css("display","none"))):!1},_wireEvents:function(t){this[t](this.element.find("li.e-list"),"mouseout",this._mouseOutHandler),this[t](this.element.find("li.e-list"),"mouseover",this._mouseOverHandler),this[t](this.element.children(),"click",this._onClickHandler),this[t](this.element,"keydown",this._onKeyDownHandler),this[t](this.element,"focus",this._OnFocusHandler),this[t](this.element,"blur",this._OnFocusOutHandler),"contextmenu"==this.model.menuType&&null!=e(this.model.contextMenuTarget)[0]&&this._contextMenuEvents(t),"contextmenu"!=this.model.menuType&&(this[t](e(document),"click",this._onDocumentClick),this[t](this.element,"mousedown",this._onMouseDownHandler)),this[t](e(window),"resize",e.proxy(this._onResize,this))},_mouseOverHandler:function(i){var a,n,o,s="";if(this.element.find(".e-mhover").removeClass("e-mhover"),i.currentTarget=e(i.target).closest("li")[0],e(i.currentTarget).hasClass("e-disable-item")?this._isFocused=!1:e(i.currentTarget).addClass("e-mhover"),i.stopPropagation&&i.stopPropagation(),"undefined"!=typeof this._delaySubMenuHover&&clearTimeout(this._delaySubMenuHover),"undefined"!=typeof this._delaySubMenuHover&&clearTimeout(this._delayMenuHover),this._mouseOver=!0,this._isMenuOpen=!0,this._isSubMenuOpen=!e(i.currentTarget.parentNode.parentNode).is(this.element),"LI"==i.currentTarget.nodeName)a=i.currentTarget;else{if(!i.currentTarget.parentNode)return i.preventDefault(),!1;if("LI"!=i.currentTarget.parentNode.nodeName)return!1;a=i.currentTarget.parentNode}e(i.currentTarget).hasClass("e-disable-item")||this._onMenuIntent(a,this,this._hoverOpen),e.inArray(a,this._disabledMenuItems)>-1||(n=e(a).children("a,span").text(),s=t.isNullOrUndefined(a)?"":e(a)[0].id,o={text:n,element:a,event:i,ID:s},this._trigger("mouseover",e.extend({events:o},o)))},_onMouseDownHandler:function(t){e(t.target).hasClass("e-menu")&&(this._isFocused=!1)},_mouseOutHandler:function(i){var a,n,o,s="";if(e(i.currentTarget).removeClass("e-mhover"),i.stopPropagation&&i.stopPropagation(),"undefined"!=typeof this._delaySubMenuHover&&clearTimeout(this._delaySubMenuHover),"undefined"!=typeof this._delaySubMenuHover&&clearTimeout(this._delayMenuHover),this._mouseOver=!1,this._isMenuOpen=!1,"LI"==i.currentTarget.nodeName)a=i.currentTarget;else{if(!i.currentTarget.parentNode)return i.preventDefault(),!1;if("LI"!=i.currentTarget.parentNode.nodeName)return!1;a=i.currentTarget.parentNode}this._onHide(a,this,this._hoverClose),e.inArray(a,this._disabledMenuItems)>-1||(n=e(a).children("a,span").text(),s=t.isNullOrUndefined(a)?"":e(a)[0].id,o={text:n,element:a,event:i,ID:s},this._trigger("mouseout",e.extend({events:o},o)))},_onClickHandler:function(i){var a,n,o,s,r,l,d,h="";return this._isFocused=!0,s=!1,!e(i.target).closest("li.e-list").hasClass("e-disable-item")&&e(i.target).closest("li.e-list").length>0?(a=e(i.target).closest("li.e-list")[0],e(a).is(this.element.find(">li.e-list"))&&(this._activeElement=a),e(i.target).is("a")&&e(a).find(">a,>span").hasClass("aschild")&&this.model.openOnClick&&(this._isFocused=!1),!this._hoverOpen&&e(a).find(">a,>span").hasClass("aschild")&&(this._show(a,this._showAnim,this._hideAnim),this._hoverOpen=!1,s=!0),void(e.inArray(a,this._disabledMenuItems)>-1||("contextmenu"==this.model.menuType&&this._isContextMenuOpen&&!e(a).hasClass("e-haschild")&&(this._hideAnimation(this.element,this._hideAnim),this._isContextMenuOpen=!1,this._trigger("close",e.extend({events:i},i)),
this._off(t.getScrollableParents(e(this.model.contextMenuTarget)),"scroll",this.hideContextMenu)),s||e(a).find(">a,>span").hasClass("aschild")||(this._closeMenu(),this.model.openOnClick&&(this._hoverOpen=!1)),r=e(a).children("a,span").text(),l=e(a).closest("ul").parent("li"),0!=l.length?(n=t.isNullOrUndefined(l.attr("id"))?null:l.attr("id"),o=l.children("a,span").text()):(n=null,o=null),h=t.isNullOrUndefined(a)?"":e(a)[0].id,d={text:r,element:a,event:i,selectedItem:this.selectedItem,ID:h,parentId:n,parentText:o},this._trigger("click",e.extend({events:d},d)),this.selectedItem=null,this.model.openOnClick&&"contextmenu"!=this.model.menuType&&this.element.focus()))):void(e(i.target).is(this.element)&&(this._activeElement=this.element.find(">li:first")))},_onKeyDownHandler:function(i){var a,n,o;if(i.target&&i.target.nodeName&&e(i.target).closest("input, textarea").length>0)return!0;if("contextmenu"!=this.model.menuType||this._isContextMenuOpen){var s,r,l,d,h="",c=this.element.find(".e-mhover"),u=this.element.find(".e-mfocused");if(!e(c).length>0&&e(this._activeElement).length>0&&(c=u=e(this._activeElement)),9==i.keyCode?(this._isFocused=!1,this._OnFocusOutHandler()):(37==i.keyCode||38==i.keyCode||39==i.keyCode||40==i.keyCode)&&i.preventDefault(),40==i.keyCode&&("horizontal"==this.model.orientation?this.element.find(">li.e-mhover").children("ul").length>0||e(this._activeElement).length>0?("none"===e(c).children("ul").css("display")&&this._show(c[c.length-1],this._showAnim,this._hideAnim),c.removeClass("e-mhover e-mfocused").children("ul:first").find("li:first").addClass("e-mhover"),null==this._activeElement?c.addClass("e-mfocused"):e(this._activeElement).addClass("e-mfocused")):(d=c.parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),e(c[c.length-1]).removeClass("e-mfocused e-mhover"),r=e(d[d.index(c)+1]).length>0?e(d[d.index(c[c.length-1])+1]):d.first(),r.addClass("e-mhover")):"horizontal"!=this.model.orientation&&(d=0==c.length?this.element.children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"):c.parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),c.removeClass("e-mfocused e-mfocused"),c.length>0?(c.removeClass("e-mhover"),r=e(d[d.index(c[c.length-1])+1]).length>0?e(d[d.index(c[c.length-1])+1]):d.first()):r=d.first(),r.addClass("e-mhover"))),39==i.keyCode&&("horizontal"==this.model.orientation&&(this.element.find(">li.e-list").hasClass("e-mhover")||e(this._activeElement).length>0)?(c.removeClass("e-mfocused e-mhover"),d=this.element.children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=e(d[d.index(c[c.length-1])+1]).length>0?e(d[d.index(c[c.length-1])+1]):d.first(),r.addClass("e-mhover")):e(c).children("ul").length>0?(c.removeClass("e-mfocused e-mhover"),a=c.children("ul:first").find("li:first"),this._show(c[c.length-1],this._showAnim,this._hideAnim),d=c.addClass("e-mfocused").children("ul:first").children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=e(d[d.index(a)]).length>0?e(d[d.index(a)]):d.first(),r.addClass("e-mhover")):c.children("ul").length<=0&&"horizontal"==this.model.orientation&&c.parent().closest(".e-list").parent().hasClass("e-menu")&&(this._hideAnimation(c.parent(),this._hideAnim),c.removeClass("e-mfocused e-mhover"),e(u[u.length-1]).removeClass("e-mfocused"),d=c.parent().closest(".e-list").parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=e(e(d[d.index(u[u.length-1])+1]).length>0?d[d.index(u[u.length-1])+1]:d[d.index(u.first())]),r.addClass("e-mhover"))),38==i.keyCode&&("horizontal"==this.model.orientation?(d=c.parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),c.removeClass("e-mfocused e-mhover"),r=e(d[d.index(c[c.length-1])-1]).length>0?e(d[d.index(c[c.length-1])-1]):d.last()):"horizontal"!=this.model.orientation&&(d=0==c.length?this.element.children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"):c.parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),c.length>0?(c.removeClass("e-mfocused e-mhover"),r=e(d[d.index(c[c.length-1])-1]).length>0?e(d[d.index(c[c.length-1])-1]):d.last()):r=d.last()),r.addClass("e-mhover")),37==i.keyCode&&("horizontal"==this.model.orientation?this.element.find(">li.e-list").hasClass("e-mhover")||e(this._activeElement).length>0?(c.removeClass("e-mfocused e-mhover"),d=this.element.find("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=e(d[d.index(c[c.length-1])-1]).length>0?e(d[d.index(c[c.length-1])-1]):d.last(),r.addClass("e-mhover")):(this._hideAnimation(c.parent(),this._hideAnim),c.removeClass("e-mfocused e-mhover"),e(u[u.length-1]).removeClass("e-mfocused e-active"),d=c.parent().closest(".e-list").parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=c.parent().closest(".e-list").parent(".e-menu").length>0?e(d[d.index(u[u.length-1])-1]).length>0?e(d[d.index(u[u.length-1])-1]):d.last():e(d[d.index(u[u.length-1])]).length>0?e(d[d.index(u[u.length-1])]):d.last(),r.addClass("e-mhover")):(0==c.parent(".e-menu").length||"contextmenu"==this.model.menuType&&0==c.parent("ul.e-context").length)&&(this._hideAnimation(c.parent(),this._hideAnim),c.removeClass("e-mfocused e-mhover"),e(u[u.length-1]).removeClass("e-mfocused"),d=c.parent().closest(".e-list").parent().children("li.e-list:visible:not(.e-hidden-item, .e-disable-item)"),r=e(e(d[d.index(u[u.length-1])]).length>0?d[d.index(u[u.length-1])]:d[d.index(u.last())]),r.addClass("e-mhover"))),13==i.keyCode&&(n=e(c).children("a,span").text(),h=t.isNullOrUndefined(e(c)[0])?"":e(c)[0].id,o={menuId:this.element[0].id,text:n,selectedItem:u,ID:h},"contextmenu"==this.model.menuType?this._isContextMenuOpen&&c.length>0&&!u.hasClass("e-disable-item")&&(this.model.click&&this._trigger("click",e.extend({events:o},o)),this.selectedItem=null,this.hideContextMenu(i)):c.length>0&&!c.hasClass("e-disable-item")&&(e(c).find(">a,>span").hasClass("aschild")&&"none"===e(c).children("ul").css("display")?(this._show(c[0],this._showAnim,this._hideAnim),c.removeClass("e-mhover").children("ul:first").find("li:first").addClass("e-mhover")):(this.element.find(".e-mhover >a,.e-mhover >span ").focus(),this.element.find("li.e-list").removeClass("e-mhover e-mfocused"),this._closeAll()),t.isNullOrUndefined(e(c).find(">a").attr("href"))&&this._trigger("click",e.extend({events:o},o)))),27==i.keyCode&&("contextmenu"==this.model.menuType?this.hideContextMenu(i):this.element.find("li.e-list").removeClass("e-mhover"),this.element.find('li.e-list:has("> ul")').find("> ul:visible").parents("li.e-list").addClass("e-mhover"),this._closeAll()),!e(i.target).is(this.element)||!i.target.parentNode)return!1;c.length&&(s=c),e.inArray(s,this._disabledMenuItems)>-1||(n=e(s).children("a,span").text(),h=t.isNullOrUndefined(s)?"":e(s)[0].id,(this.element.find("li.e-mfocused.e-mhover").length||13==i.keyCode)&&(l=13==i.keyCode?c:this.element.find("li.e-mfocused.e-mhover")),o={text:n,element:s,targetElement:l,event:i,ID:h},this._trigger("keydown",e.extend({events:o},o))),this._activeElement=null,u=this.element.find(".e-mfocused")}},_OnFocusHandler:function(){"contextmenu"!=this.model.menuType&&!this.element.find(">li:first").hasClass("e-disable-item")&&this._isFocused&&0==this.element.find(".e-mhover").length&&0==e("li.e-ham-wrap").length?this.element.find(">li:first").addClass("e-mhover"):this._isFocused=!0,"contextmenu"!=this.model.menuType&&(this._activeElement=this.element.find(">li:first"))},_OnFocusOutHandler:function(){this._isFocused||(this.element.find("li.e-list").removeClass("e-mhover e-mfocused"),this._closeAll()),this._isFocused=!1},_onDocumentClick:function(t){this.model.openOnClick&&(this._hoverOpen=!1),e(t.target).parents(".e-menu").is(this.element)||(this.element.find("li.e-list").removeClass("e-mhover e-mfocused"),this._closeAll(),this._isFocused=!0),e(t.target).parents("ul.e-menu").is(this.popupWrapper)||e(t.target).hasClass("e-ham-wrap")||e(t.target).parent().hasClass("e-ham-wrap")||e(t.target).hasClass("e-hamburger")||e(t.target).parent("li").hasClass("e-haschild")||e(t.target).is("span.e-icon.e-arrowhead-down")||this._isOverflowPopupOpen()||"contextmenu"==this.model.menuType||!(e("li.e-ham-wrap").length>0)||this._overflowClose()},_ContextMenuHandler:function(e){var t,i,a,n,o,s=!1;"taphold"==e.type&&0!=e.button?s=!0:e.button?s=2==e.button:e.which&&(s=3==e.which),t=e.target,s?(i=e,"taphold"==e.type&&(i="touchstart"==e.options.type?e.options.touches[0]:e.options),a=this._showSpeed,this.showContextMenu(null,null,t,i,!0)):this._isContextMenuOpen&&(n=this._hideAnim,o=this._hideSpeed,this.hideContextMenu(e,n,o))},_calculateContextMenuPosition:function(t){var i,a,n;return this.element.css({top:"",left:""}),i=t.clientX+this.element.width()<e(window).width()?t.pageX:t.pageX-this.element.width(),a=t.clientY+this.element.height()<e(window).height()?t.pageY:t.clientY>this.element.height()?t.pageY-this.element.height():e(window).height()-this.element.outerHeight(),n="static"!=e("body").css("position")?e("body").offset():{left:0,top:0},i-=n.left,a-=n.top,{X:i,Y:a}},_onDefaultPreventer:function(e){return e.preventDefault(),e.stopPropagation(),!1},_onContextClose:function(t){var i,a,n,o,s=this;this._isContextMenuOpen&&(i=!1,(e(t.target).is(this.element)||e(t.target).parents(".e-context").is(this.element))&&(i=!0),i||(a=this._hideAnim,n=this._hideSpeed,this.hideContextMenu(t,a,n),o=e(t.target).parents(),e.each(o,function(e,t){t.id==s._ContextTargetId})))}}),t.Menu.Locale=t.Menu.Locale||{},t.Menu.Locale["default"]=t.Menu.Locale["en-US"]={titleText:"Menu"},t.MenuType={NormalMenu:"normalmenu",ContextMenu:"contextmenu"},t.Direction={Left:"left",Right:"right",None:"none"},t.AnimationType={None:"none",Default:"default"}}(jQuery,Syncfusion)}),function(e,t,i){"use strict";function a(e,t){t&&t.onError&&t.onError(e)===!1||(this.name="JsRender Error",this.message=e||"JsRender error")}function n(e,t){var i;e=e||{};for(i in t)e[i]=t[i];return e}function o(e,t,i){return(!te.rTag||arguments.length)&&(L=e?e.charAt(0):L,N=e?e.charAt(1):N,O=t?t.charAt(0):O,M=t?t.charAt(1):M,E=i||E,e="\\"+L+"(\\"+E+")?\\"+N,t="\\"+O+"\\"+M,T="(?:(?:(\\w+(?=[\\/\\s\\"+O+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+O+"]|\\"+O+"(?!\\"+M+"))*?)",te.rTag=T+")",T=new RegExp(e+T+"(\\/)?|(?:\\/(\\w+)))"+t,"g"),j=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t)),[L,N,O,M,E]}function s(e,t){t||(t=e,e=i);var a,n,o,s,r=this,l=!t||"root"===t;if(e){if(s=r.type===t?r:i,!s)if(a=r.views,r._.useKey){for(n in a)if(s=a[n].get(e,t))break}else for(n=0,o=a.length;!s&&o>n;n++)s=a[n].get(e,t)}else if(l)for(;r.parent.parent;)s=r=r.parent;else for(;r&&!s;)s=r.type===t?r:i,r=r.parent;return s}function r(){var e=this.get("item");return e?e.index:i}function l(e,t){var a,o=this,s=t&&t[e]||(o.ctx||{})[e];return s=s===i?o.getRsc("helpers",e):s,s&&"function"==typeof s&&(a=function(){return s.apply(o,arguments)},n(a,s)),a||s}function d(e,t,a){var n,o,s,r=+a===a&&a,l=t.linkCtx;return r&&(a=(r=t.tmpl.bnds[r-1])(t.data,t,Q)),s=a.args[0],(e||r)&&(o=l&&l.tag||{_:{inline:!l},tagName:e+":",flow:!0,_is:"tag"},o._.bnd=r,l&&(l.tag=o,a.ctx=w(a.ctx,l.view.ctx)),o.tagCtx=a,a.view=t,o.ctx=a.ctx||{},delete a.ctx,t._.tag=o,e="true"!==e&&e,e&&((n=t.getRsc("converters",e))||y("Unknown converter: {{"+e+":"))&&(o.depends=n.depends,s=n.apply(o,a.args)),s=r&&t._.onRender?t._.onRender(s,t,r):s,t._.tag=i),s}function h(e,t){for(var a=this,n=Q[e],o=n&&n[t];o===i&&a;)n=a.tmpl[e],o=n&&n[t],a=a.parent;return o}function c(e,t,a,o){var s,r,l,d,h,c,u,g,m,p,f,v,b,x,D="",C=+o===o&&o,z=t.linkCtx||0,S=t.ctx,P=a||t.tmpl,T=t._;for("tag"===e._is&&(r=e,e=r.tagName),C&&(o=(v=P.bnds[C-1])(t.data,t,Q)),u=o.length,r=r||z.tag,c=0;u>c;c++)m=o[c],f=m.tmpl,f=m.content=f&&P.tmpls[f-1],a=m.props.tmpl,c||a&&r||(b=t.getRsc("tags",e)||y("Unknown tag: {{"+e+"}}")),a=a||(r?r:b).template||f,a=""+a===a?t.getRsc("templates",a)||K(a):a,n(m,{tmpl:a,render:_,index:c,view:t,ctx:w(m.ctx,S)}),r||(b._ctr?(r=new b._ctr,x=!!r.init,r.attr=r.attr||b.attr||i):r={render:b.render},r._={inline:!z},z&&(z.attr=r.attr=z.attr||r.attr,z.tag=r,r.linkCtx=z),(r._.bnd=v||z)&&(r._.arrVws={}),r.tagName=e,r.parent=h=S&&S.tag,r._is="tag",r._def=b),T.tag=r,m.tag=r,r.tagCtxs=o,r.flow||(p=m.ctx=m.ctx||{},l=r.parents=p.parentTags=S&&w(p.parentTags,S.parentTags)||{},h&&(l[h.tagName]=h),p.tag=r);for(r.rendering={},c=0;u>c;c++)m=r.tagCtx=o[c],r.ctx=m.ctx,!c&&x&&(r.init(m,z,r.ctx),x=i),(s=r.render)&&(g=s.apply(r,m.args)),D+=g!==i?g:m.tmpl?m.render():"";return delete r.rendering,r.tagCtx=r.tagCtxs[0],r.ctx=r.tagCtx.ctx,r._.inline&&(d=r.attr)&&"html"!==d&&(D="text"===d?J.html(D):""),C&&t._.onRender?t._.onRender(D,t,C):D}function u(e,t,a,n,o,d,c,u){var g,m,p,f="array"===t,v={key:0,useKey:f?0:1,id:""+Y++,onRender:u,bnds:{}},_={data:n,tmpl:o,content:c,views:f?[]:{},parent:a,ctx:e,type:t,get:s,getIndex:r,getRsc:h,hlp:l,_:v,_is:"view"};return a&&(g=a.views,m=a._,m.useKey?(g[v.key="_"+m.useKey++]=_,p=m.tag,v.bnd=f&&(!p||!!p._.bnd&&p)):g.splice(v.key=_.index=d!==i?d:g.length,0,_),_.ctx=e||a.ctx),_}function g(e){var t,i,a,n,o;for(t in Z)if(n=Z[t],(o=n.compile)&&(i=e[t+"s"]))for(a in i)i[a]=o(a,i[a],e,t,n)}function m(e,t,i){var a,n;return"function"==typeof t?t={depends:t.depends,render:t}:((n=t.template)&&(t.template=""+n===n?K[n]||K(n):n),t.init!==!1&&(a=t._ctr=function(){},(a.prototype=t).constructor=a)),i&&(t._parentTmpl=i),t}function p(a,n,o,s,r,l){function d(i){if(""+i===i||i.nodeType>0){try{c=i.nodeType>0?i:!j.test(i)&&t&&t(e.document).find(i)[0]}catch(n){}return c&&(i=c.getAttribute($),a=a||i,i=K[i],i||(a=a||"_"+X++,c.setAttribute($,a),i=K[a]=p(a,c.innerHTML,o,s,r,l))),i}}var h,c;return n=n||"",h=d(n),l=l||(n.markup?n:{}),l.tmplName=a,o&&(l._parentTmpl=o),!h&&n.markup&&(h=d(n.markup))&&h.fn&&(h.debug!==n.debug||h.allowCode!==n.allowCode)&&(h=h.markup),h!==i?(a&&!o&&(q[a]=function(){return n.render.apply(n,arguments)}),h.fn||n.fn?h.fn&&(n=a&&a!==h.tmplName?w(l,h):h):(n=f(h,l),x(h,n)),g(l),n):void 0}function f(e,t){var i,a=ie.wrapMap||{},o=n({markup:e,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:_},t);return t.htmlTag||(i=G.exec(e),o.htmlTag=i?i[1].toLowerCase():""),i=a[o.htmlTag],i&&i!==a.div&&(o.markup=S.trim(o.markup),o._elCnt=!0),o}function v(e,t){function a(o,s,r){var l,d,h,c;if(o&&""+o!==o&&!o.nodeType&&!o.markup){for(h in o)a(h,o[h],s);return Q}return s===i&&(s=o,o=i),o&&""+o!==o&&(r=s,s=o,o=i),c=r?r[n]=r[n]||{}:a,d=t.compile,(l=te.onBeforeStoreItem)&&(d=l(c,o,s,d)||d),o?null===s?delete c[o]:c[o]=d?s=d(o,s,r,e,t):s:s=d(i,s),d&&s&&(s._is=e),(l=te.onStoreItem)&&l(c,o,s,d),s}var n=e+"s";Q[n]=a,Z[e]=t}function _(e,t,a,n,o,s){var r,l,d,h,c,g,m,p,f,v,_,b,x,D=this,C=!D.attr||"html"===D.attr,z="";if(n===!0&&(m=!0,n=0),D.tag?(p=D,D=D.tag,v=D._,b=D.tagName,x=p.tmpl,t=w(t,D.ctx),f=p.content,p.props.link===!1&&(t=t||{},t.link=!1),a=a||p.view,e=e===i?a:e):x=D.jquery&&(D[0]||y('Unknown template: "'+D.selector+'"'))||D,x&&(!a&&e&&"view"===e._is&&(a=e),a&&(f=f||a.content,s=s||a._.onRender,e===a&&(e=a.data,o=!0),t=w(t,a.ctx)),a&&a.data!==i||((t=t||{}).root=e),x.fn||(x=K[x]||K(x)),x)){if(s=(t&&t.link)!==!1&&C&&s,_=s,s===!0&&(_=i,s=a._.onRender),S.isArray(e)&&!o)for(h=m?a:n!==i&&a||u(t,"array",a,e,x,n,f,s),r=0,l=e.length;l>r;r++)d=e[r],c=u(t,"item",h,d,x,(n||0)+r,f,s),g=x.fn(d,c,Q),z+=h._.onRender?h._.onRender(g,c):g;else h=m?a:u(t,b||"data",a,e,x,n,f,s),v&&!D.flow&&(h.tag=D),z+=x.fn(e,h,Q);return _?_(z,h):z}return""}function y(e){throw new Q.sub.Error(e)}function b(e){y("Syntax error\n"+e)}function x(e,t,i,a){function n(t){t-=h,t&&u.push(e.substr(h,t).replace(I,"\\n"))}function o(t){t&&b('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function s(s,d,m,p,f,v,_,y,x,D,w,z){v&&(f=":",p="html"),D=D||i;var S,P,T=d&&[],j="",L="",N="",O=!D&&!f&&!_;m=m||f,n(z),h=z+s.length,y?l&&u.push(["*","\n"+x.replace(U,"$1")+"\n"]):m?("else"===m&&(R.test(x)&&b('for "{{else if expr}}" use "{{else expr}}"'),T=g[6],g[7]=e.substring(g[7],z),g=c.pop(),u=g[3],O=!0),x&&(x=x.replace(I," "),j=C(x,T,t).replace(H,function(e,t,i){return t?N+=i+",":L+=i+",",""})),L=L.slice(0,-1),j=j.slice(0,-1),S=L&&L.indexOf("noerror:true")+1&&L||"",r=[m,p||!!a||"",j,O&&[],'params:"'+x+'",props:{'+L+"}"+(N?",ctx:{"+N.slice(0,-1)+"}":""),S,T||0],u.push(r),O&&(c.push(g),g=r,g[7]=h)):w&&(P=g[0],o(w!==P&&"else"!==P&&w),g[7]=e.substring(g[7],z),g=c.pop()),o(!g&&w),u=g[3]}var r,l=t&&t.allowCode,d=[],h=0,c=[],u=d,g=[,,,d];return e=e.replace(B,"\\$&"),o(c[0]&&c[0][3].pop()[0]),e.replace(T,s),n(e.length),(h=d[d.length-1])&&o(""+h!==h&&+h[7]===h[7]&&h[0]),D(d,i?e:t,i)}function D(e,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,v,_,y,x,C,w,z,S,P,T,j,L,N,O=0,M="",E="",k={},A=e.length;for(""+i===i?(y=a?'data-link="'+i.replace(I," ").slice(1,-1)+'"':i,i=0):(y=i.tmplName||"unnamed",i.allowCode&&(k.allowCode=!0),i.debug&&(k.debug=!0),p=i.bnds,_=i.tmpls),n=0;A>n;n++)if(o=e[n],""+o===o)M+='\nret+="'+o+'";';else if(s=o[0],"*"===s)M+=""+o[1];else{if(r=o[1],l=o[2],w=o[3],d=o[4],E=o[5],z=o[7],(T="else"===s)||(O=0,p&&(v=o[6])&&(O=p.push(v))),(j=":"===s)?(r&&(s="html"===r?">":r+s),E&&(L="prm"+n,E="try{var "+L+"=["+l+"][0];}catch(e){"+L+'="";}\n',l=L)):(w&&(x=f(z,k),x.tmplName=y+"/"+s,D(w,x),_.push(x)),T||(C=s,P=M,M=""),S=e[n+1],S=S&&"else"===S[0]),d+=",args:["+l+"]}",j&&v||r&&">"!==s){if(N=new Function("data,view,j,u"," // "+y+" "+O+" "+s+"\n"+E+"return {"+d+";"),N.paths=v,N._ctxs=s,a)return N;m=1}if(M+=j?"\n"+(v?"":E)+(a?"return ":"ret+=")+(m?(m=0,g=!0,'c("'+r+'",view,'+(v?(p[O-1]=N,O):"{"+d)+");"):">"===s?(c=!0,"h("+l+");"):(u=!0,"(v="+l+")!="+(a?"=":"")+'u?v:"";')):(h=!0,"{tmpl:"+(w?_.length:"0")+","+d+","),C&&!S){if(M="["+M.slice(0,-1)+"]",(a||v)&&(M=new Function("data,view,j,u"," // "+y+" "+O+" "+C+"\nreturn "+M+";"),v&&((p[O-1]=M).paths=v),M._ctxs=s,a))return M;M=P+'\nret+=t("'+C+'",view,this,'+(O||M)+");",v=0,C=0}}M="// "+y+"\nvar j=j||"+(t?"jQuery.":"js")+"views"+(u?",v":"")+(h?",t=j._tag":"")+(g?",c=j._cnvt":"")+(c?",h=j.converters.html":"")+(a?";\n":',ret="";\n')+(ie.tryCatch?"try{\n":"")+(k.debug?"debugger;":"")+M+(a?"\n":"\nreturn ret;\n")+(ie.tryCatch?"\n}catch(e){return j._err(e);}":"");try{M=new Function("data,view,j,u",M)}catch(U){b("Compiled template code:\n\n"+M,U)}return i&&(i.fn=M),M}function C(e,t,i){function a(a,g,m,p,f,v,_,y,D,w,z,S,P,T,j,E,A,I,U,B){function H(e,i,a,r,l,d,h){if(i&&(t&&("linkTo"===n&&(o=t.to=t.to||[],o.push(f)),(!n||s)&&t.push(f)),"."!==i)){var c=(a?'view.hlp("'+a+'")':r?"view":"data")+(h?(l?"."+l:a?"":r?"":"."+i)+(d||""):(h=a?"":r?l||"":i,""));return c+=h?"."+h:"","view.data"===c.slice(0,9)?c.slice(5):c}return e}var R;return v=v||"",m=m||g||S,f=f||D,w=w||A||"",_?void b(e):(t&&E&&!u&&!c&&(!n||s||o)&&(R=d[h],B.length-2>U-R&&(R=B.slice(R,U+1),E=N+":"+R+O,E=r[E]=r[E]||x(L+E+M,i,!0),E.paths||C(R,E.paths=[],i),(o||t).push({_jsvOb:E}))),u?(u=!P,u?a:'"'):c?(c=!T,c?a:'"'):(m?(h++,d[h]=U++,m):"")+(I?h?"":n?(n=s=o=!1,"\b"):",":y?(h&&b(e),n=f,s=p,"\b"+f+":"):f?f.split("^").join(".").replace(k,H)+(w?(l[++h]=!0,"."!==f.charAt(0)&&(d[h]=U),w):v):v?v:j?(l[h--]=!1,j+(w?(l[++h]=!0,w):"")):z?(l[h]||b(e),","):g?"":(u=P,c=T,'"')))}var n,o,s,r=i.links,l={},d={0:-1},h=0,c=!1,u=!1;return(e+" ").replace(A,a)}function w(e,t){return e&&e!==t?t?n(n({},t),e):e:t&&n({},t)}function z(e){return F[e]||(F[e]="&#"+e.charCodeAt(0)+";")}if(!(t&&t.views||e.jsviews)){var S,P,T,j,L="{",N="{",O="}",M="}",E="^",k=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,A=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^)|[)\]])([([]?))|(\s+)/g,I=/[ \t]*(\r\n|\n|\r)/g,U=/\\(['"])/g,B=/['"\\]/g,H=/\x08(~)?([^\x08]+)\x08/g,R=/^if\s/,G=/<(\w+)[>\s]/,W=/[\x00`><"'&]/g,V=W,X=0,Y=0,F={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},$="data-jsv-tmpl",q={},Z={template:{compile:p},tag:{compile:m},helper:{},converter:{}},Q={jsviews:"v1.0.0-beta",render:q,settings:{delimiters:o,debugMode:!0,tryCatch:!0},sub:{View:u,Error:a,tmplFn:x,parse:C,extend:n,error:y,syntaxError:b},_cnvt:d,_tag:c,_err:function(e){return ie.debugMode?"Error: "+(e.message||e)+". ":""}};(a.prototype=new Error).constructor=a,r.depends=function(){return[this.get("item"),"index"]};for(P in Z)v(P,Z[P]);var K=Q.templates,J=Q.converters,ee=(Q.helpers,Q.tags),te=Q.sub,ie=Q.settings;t?(S=t,S.fn.render=_):(S=e.jsviews={},S.isArray=Array&&Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}),S.render=q,S.views=Q,S.templates=K=Q.templates,ee({"else":function(){},"if":{render:function(e){var t=this;return t.rendering.done||!e&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=!0,t.selected=t.tagCtx.index,t.tagCtx.render())},onUpdate:function(e,t,i){for(var a,n,o=0;(a=this.tagCtxs[o])&&a.args.length;o++)if(a=a.args[0],n=!a!=!i[o].args[0],!!a||n)return n;return!1},flow:!0},"for":{render:function(e){var t=this,a=t.tagCtx,n=!arguments.length,o="",s=n||0;return t.rendering.done||(n?o=i:e!==i&&(o+=a.render(e),s+=S.isArray(e)?e.length:1),(t.rendering.done=s)&&(t.selected=a.index)),o},onArrayChange:function(e,t){var i,a=this,n=t.change;if(this.tagCtxs[1]&&("insert"===n&&e.target.length===t.items.length||"remove"===n&&!e.target.length||"refresh"===n&&!t.oldItems.length!=!e.target.length))this.refresh();else for(i in a._.arrVws)i=a._.arrVws[i],i.data===e.target&&i._.onArrayChange.apply(i,arguments);e.done=!0},flow:!0},include:{flow:!0},"*":{render:function(e){return e},flow:!0}}),J({html:function(e){return e!=i?String(e).replace(V,z):""},attr:function(e){return e!=i?String(e).replace(W,z):null===e?null:""},url:function(e){return e!=i?encodeURI(String(e)):null===e?null:""}}),o()}}(this,this.jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e()}(function(){!function(e,t){function i(){var e={},t=[],i={webkit:/(chrome)[ \/]([\w.]+)/i,safari:/(webkit)[ \/]([\w.]+)/i,msie:/(msie) ([\w.]+)/i,opera:/(opera)(?:.*version|)[ \/]([\w.]+)/i,mozilla:/(mozilla)(?:.*? rv:([\w.]+)|)/i};for(var a in i)if(i.hasOwnProperty(a)&&(t=navigator.userAgent.match(i[a]))){e.name=t[1].toLowerCase(),e.version=t[2],!navigator.userAgent.match(/Trident\/7\./)||(e.name="msie");break}return e.isMSPointerEnabled="msie"==e.name&&e.version>9&&window.navigator.msPointerEnabled,e.pointerEnabled=window.navigator.pointerEnabled,e}function a(t,i,a){var n=a.type;a.type=i,e.event.dispatch.call(t,a),a.type=n}function n(e,t){if(t)for(prop in t)prop in e||(e[prop]=t[prop])}function o(e){return e.originalEvent.touches?e.originalEvent.touches[0]:c?e.originalEvent:e}function s(e){var i=c?e.originalEvent.pointerType:e.originalEvent.touches?"touch":"mouse",a=c&&u==t?4==i?"mouse":"touch":i;return e.pointerType=a,"mousedown"!=e.type&&"mouseup"!=e.type&&n(e,e.originalEvent),"touch"==a&&(e.button=t),e}function r(t,i,a){var n,o,s,r,l,d={};return a&&(l=a.originalEvent.touches?[a.originalEvent.touches[0],t.originalEvent.changedTouches[0]]:[a.originalEvent,t.originalEvent],i._isSwipe||i._isdrag?(n=e.event.special.pinch._getdistance(l[0],l[1]),o=i.time,r={pageX:i.stopPoint.pageX,pageY:i.stopPoint.pageY}):i._isPinch&&(n=e.event.special.pinch.distance(t),o=t.timeStamp-a.timeStamp,s=i._pinchDistance),i._isDelta&&(d._dTime=t.timeStamp-a.timeStamp,d._x=l[1].pageX-l[0].pageX,d._y=l[1].pageY-l[0].pageY)),{options:t,delta:{time:d._dTime||null,X:d._x||null,Y:d._y||null},distance:n,scale:i._isPinch?s:null,time:o,velocity:{XY:n/d._dTime||null,X:d._x/d._dTime||null,Y:d._y/d._dTime||null},currentPosition:{pageX:r?r.pageX:null,pageY:r?r.pageY:null}}}function l(){var e=new Date;return e.getTime()}function d(e){c&&e.css("-ms-touch-action","pinch-zoom").css("touch-action","pinch-zoom")}var h=e(document);e.each("touchstart touchmove touchend tap doubletap taphold swipe swipeleft swiperight pinch pinchin pinchout pinchstop scrollstart scrollstop".split(" "),function(t,i){e.fn[i]=function(e){return e?this.on(i,e):this.trigger(i)},e.attrFn&&(e.attrFn[i]=!0)});var c=i().isMSPointerEnabled,u=i().pointerEnabled,g="ontouchstart"in window,m="scroll",p="undefined"==typeof orientation,f=navigator.userAgent.match(/iPhone|iPad|iPod/i),v=c?u?"pointerdown":"MSPointerDown":g?"touchstart":"mousedown",_=c?u?"pointerup":"MSPointerUp":f?"touchend":g?"touchend":"mouseup",y=c?u?"pointermove":"MSPointerMove":g?"touchmove":"mousemove",b=c?u?"pointercancel":"MSPointerCancel":g?"touchcancel":"mouseleave",x=c||!p?v:f?"touchstart":"touchstart mousedown",D=c||!p?_:"touchend mouseup",C=c||!p?y:"touchmove mousemove",w=i(),z="msie"==w.name&&"9.0"==w.version;e.event.special.ejtouchmove={setup:function(){function t(){}function i(e){if(e.originalEvent&&(!e.which||1===e.which)){var t=(e.target,e.originalEvent);c&&(s={x:t.x,y:t.y}),l.on(y,o)}}function o(e){if(!e.which||1===e.which){var t=(e.target,e.originalEvent);n(e,e.originalEvent),(!c||!s||Math.abs(s.x-t.x)>10||Math.abs(s.y-t.y)>10&&c)&&a(r,"ejtouchmove",e)}}var s,r=this,l=e(r);l.on(v,i),h.on(_,t),s={}}},e.event.special.swipeupdown={setup:function(){var i=this,a=e(i);d(a),a.on(v,function(i){function n(e){if(e.preventDefault(),h){var t=o(e);s={time:(new Date).getTime(),coords:[t.pageX,t.pageY]},Math.abs(h.coords[1]-s.coords[1])>10&&e.preventDefault()}}if(i.originalEvent){var s,l=i,d=o(i),h={time:(new Date).getTime(),coords:[d.pageX,d.pageY],origin:e(i.target)};a.on(y,n).one(_,function(i){if(a.off(y,n),h&&s&&s.time-h.time<1e3&&Math.abs(h.coords[1]-s.coords[1])>30&&Math.abs(h.coords[0]-s.coords[0])<75){var o={time:s.time-h.time,_isSwipe:!0,_isDelta:!0,stopPoint:s},d=r(i,o,l);h.origin.trigger(e.extend(!0,{type:"swipeupdown"},d)).trigger(e.extend(!0,{type:h.coords[1]>s.coords[1]?"swipeup":"swipedown"},d))}h=s=t})}})}},e.event.special.scrollstart={isEnabled:!0,setup:function(){function t(e,t){i=t,a(o,i?"scrollstart":"scrollstop",e)}var i,n,o=this,s=e(o);s.on(m,function(a){e.event.special.scrollstart.isEnabled&&(i||t(a,!0),clearTimeout(n),n=setTimeout(function(){t(a,!1)},250))})}},e.event.special.tap={doubleTapThreshold:500,tapholdThreshold:650,canDoubleTap:function(t){return l()-t.doubleTapStartTime<=e.event.special.tap.doubleTapThreshold},setup:function(){var t,i=this,n=e(i),o=n.data();d(n),o.isDoubleTapWait=!1,o.stopProcess=!1,o.preTouchend=null,o.preTouchstart=null,n.on(x,function(r){function d(){clearTimeout(v),n.off(D,u),z&&h.off(D,u),h.off(D,d),n.off(b,d),n.off(C,c),n.off("dragstart",m)}function c(e){var t=10,i=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0]:e.originalEvent,a=r.originalEvent.changedTouches?r.originalEvent.changedTouches[0]:r.originalEvent;i.pageX-a.pageX<t&&i.pageX-a.pageX>-t&&i.pageY-a.pageY<t&&i.pageY-a.pageY>-t||("mousemove"==e.type||"pointermove"==e.type&&"mouse"==e.originalEvent.pointerType||"MSPointerMove"==e.type&&4==e.originalEvent.pointerType?(clearTimeout(v),n.off(b,d),n.off(C,c)):d())}function u(n){var h,c;"touchend"==n.type&&(o.preTouchend=l()),d(),t!=n.target&&("mouseup"==n.type||"pointerup"==r.type||"MSPointerUp")&&(h=n.target,jQuery.contains(t,h)?g(n,t):jQuery.contains(h,t)||(c=e(t).parents().has(e(h)).first()[0],ej.isNullOrUndefined(c)||g(n,c))),p===n.currentTarget&&(a(i,"tap",e.extend(s(n),{time:l()-o.startTime})),o.isDoubleTapWait&&e.event.special.tap.canDoubleTap(o)?(o.isDoubleTapWait=!1,a(i,"doubletap",e.extend(s(n),{time:l()-o.doubleTapStartTime}))):(o.isDoubleTapWait&&(o.isDoubleTapWait=!1,o.doubleTapStartTime=o.startTime),e.event.special.tap.canDoubleTap(o)&&(o.isDoubleTapWait=!0)))}function g(e,t){e.target=t,e.toElement=t}function m(){d()}var p,f,v,_,y;if(r.originalEvent)if(("mousedown"==r.type||"pointerdown"==r.type||"MSPointerDown")&&(t=r.target),o=n.data(),o.startTime=l(),o.isDoubleTapWait||(o.doubleTapStartTime=o.startTime),"touchstart"==r.type&&(o.preTouchstart=o.startTime),o.stopProcess="mousedown"==r.type&&(o.startTime-o.preTouchend<300||o.startTime-o.preTouchstart<30),p=r.currentTarget,f=r.originalEvent,r.which&&1!==r.which||o.stopProcess)o.stopProcess&&(o.stopProcess=!1);else{n.on(D,u),h.on(D,d),z&&h.on(D,u),n.on(b,d),n.on(C,c),n.on("dragstart",m),_={};for(y in f)_[y]=f[y];v=setTimeout(function(){o.isDoubleTapWait&&(o.isDoubleTapWait=!1),a(i,"taphold",e.extend(s(r),{options:_,time:l()-o.startTime}))},e.event.special.tap.tapholdThreshold)}})}},e.event.special.swipe={scrollSupression:10,duration:1e3,horizontalDistance:30,verticalDistance:75,pointers:window.navigator.msPointerEnabled,startPoint:function(t){var i=o(t);return{time:(new Date).getTime(),Items:i,coords:[i.pageX,i.pageY],origin:e(t.target)}},stopPoint:function(e){var t=o(e);return{time:(new Date).getTime(),Items:t,coords:[t.pageX,t.pageY]}},handleSwipe:function(t,i,a,n){if((t.Items.pageY!=t.Items.clientY||i.Items.pageY!=i.Items.clientY)&&(e.event.special.swipe.horizontalDistance=130),i.time-t.time<e.event.special.swipe.duration&&Math.abs(t.coords[0]-i.coords[0])>e.event.special.swipe.horizontalDistance&&Math.abs(t.coords[1]-i.coords[1])<e.event.special.swipe.verticalDistance){var o={time:i.time-t.time,_isSwipe:!0,_isDelta:!0,stopPoint:i},s=r(a,o,n);t.origin.trigger(e.extend(!0,{type:"swipe"},s)).trigger(e.extend(!0,{type:t.coords[0]>i.coords[0]?"swipeleft":"swiperight"},s))}},setup:function(){var i=this,a=e(i);d(a),a.on(v,function(i){function n(t){s&&(o=e.event.special.swipe.stopPoint(t),Math.abs(s.coords[0]-o.coords[0])>e.event.special.swipe.scrollSupression&&t.preventDefault())}if(i.originalEvent){var o,s=e.event.special.swipe.startPoint(i),r=i;e(i.target).data("_dataTouchStart",{event:i,_now:(new Date).getTime()}),a.on(y,n).one(_,function(i){a.off(y,n),s&&o&&e.event.special.swipe.handleSwipe(s,o,i,r),s=o=t})}})}},e.event.special.pinch={distance:function(t){return t.originalEvent.touches.length<2?null:e.event.special.pinch._getdistance(t.originalEvent.touches[0],t.originalEvent.touches[1])},_getdistance:function(e,t){return Math.sqrt((e.pageX-t.pageX)*(e.pageX-t.pageX)+(e.pageY-t.pageY)*(e.pageY-t.pageY))},setup:function(){var i=this,a=e(i);d(a),a.on(v,function(i){function n(t){l=t,s=e.event.special.pinch.distance(t)||null,d&&s&&Math.abs(d-s)>h&&(e(t.target).trigger(e.extend(!0,{type:d>s?"pinchin":"pinchout"},r(t,{_isPinch:!0,_pinchDistance:c},o))),d=s)}var o;if(i.originalEvent&&(o=i,i.originalEvent.touches&&i.originalEvent.touches.length>=2)){var s,l,d=e.event.special.pinch.distance(i),h=5,c=d,u=r(i,{_isPinch:!0,_pinchDistance:c},o);e(i.target).trigger(e.extend(!0,{type:"pinch"},u)),a.on(y,n).one(_,function(){a.off(y,n),e(i.target).trigger(e.extend(!0,{type:"pinchstop"},r(l,{_isPinch:!0,_pinchDistance:s},o))),d=s=t})}})}},e.event.special.touchdrag={setup:function(){var i=this,a=e(i);d(a),a.on(v,function(i){function n(t){l&&(s=o(t),e.event.special.pinch._getdistance(l,s)>5&&e(t.target).trigger(e.extend(!0,{type:"touchdrag"},r(t,{_isdrag:!0,stopPoint:s,_isDelta:!0},d))))}if(i.originalEvent){var s,l=o(i),d=i;e(i.target).data("_dataTouchStart",{event:i,_now:(new Date).getTime()}),a.on(y,n).one(_,function(){a.off(y,n),l=s=t})}})}},e.each({scrollstop:"scrollstart",doubletap:"tap",taphold:"tap",swipeleft:"swipe",swiperight:"swipe",swipedown:"swipeupdown",swipeup:"swipeupdown",pinchin:"pinch",pinchout:"pinch",pinchstop:"pinch"},function(t,i){e.event.special[t]={setup:function(){e(this).on(i,e.noop)}}})}(jQuery)}),function(e){"function"==typeof define&&define.amd?define(["./../common/ej.core.min","jsrender","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./../web/ej.menu.min"],e):e()}(function(){!function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,_requiresID:!0,validTags:["div"],defaults:{width:"",height:"",nodes:[],connectors:[],labelRenderingMode:"html",defaultSettings:{connector:null,node:null,group:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null,root:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[],connectionDataSource:{dataSource:null,
id:"",sourceNode:"",targetNode:"",sourcePointX:"",sourcePointY:"",targetPointX:"",targetPointY:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[]}},serializationSettings:{preventDefaultValues:!1},rulerSettings:{showRulers:!1,horizontalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},verticalRuler:{interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25}},snapSettings:{horizontalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},verticalGridLines:{linesInterval:null,snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},scrollSettings:{horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,minZoom:.25,maxZoom:30,zoomFactor:.2,padding:{left:0,right:0,top:0,bottom:0}},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"diagram",scrollableArea:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},autoScrollBorder:{left:15,top:15,right:15,bottom:15},boundaryConstraints:"infinity"},locale:"en-US",contextMenu:{items:[],showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,tooltip:{templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5}},showTooltip:!0,layout:{bounds:null,type:"none",horizontalAlignment:"center",verticalAlignment:"top",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,margin:{left:0,right:0,top:0,bottom:0},marginX:0,marginY:0,fixedNode:"",getLayoutInfo:null,getConnectorSegments:null,root:"",springLength:100,springFactor:.442,maxIteration:1e3},drawingTools:{},backgroundImage:{source:"",scale:"meet",alignment:"xmidymid"},backgroundColor:"transparent",bridgeDirection:"top",version:"13.1",constraints:502,tool:null,drawType:{},selectedItems:{offsetX:0,offsetY:0,width:0,height:0,rotateAngle:0,children:[],constraints:30,userHandles:[],tooltip:{templateId:"",alignment:{horizontal:"center",vertical:"bottom"},margin:{top:10}},getConstraints:null},commandManager:{commands:{}},historyManager:{push:null,pop:null,canPop:null,canLog:null,undo:null,redo:null,startGroupAction:null,closeGroupAction:null,stackLimit:null,undoStack:[],redoStack:[]},layers:[],connectorType:"straightLine",editorFocusChange:null,nodeCollectionChange:null,templateNodeRendering:null,historyChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,dragEnter:null,dragOver:null,dragLeave:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null,contextMenuClick:null,contextMenuBeforeOpen:null,contextMenuClose:null,connectorSourceChange:null,connectorTargetChange:null,scrollChange:null,segmentChange:null,propertyChange:null,groupChange:null,create:null,destroy:null},observables:["nodes","connectors","locale","enableContextMenu","backgroundColor","backgroundImage","enableAutoScroll","showTooltip","bridgeDirection","tool","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance","snapSettings.snapConstraints","dataSourceSettings.id","dataSourceSettings.parent","dataSourceSettings.root","dataSourceSettings.dataSource","dataSourceSettings.tableName","dataSourceSettings.query","layout.type","layout.orientation","layout.horizontalSpacing","layout.verticalSpacing","layout.marginX","layout.marginY","layout.fixedNode","selectedItems.offsetX","selectedItems.offsetY","selectedItems.width","selectedItems.height","selectedItems.rotateAngle","scrollSettings.horizontalOffset","scrollSettings.verticalOffset","scrollSettings.zoomFactor","tooltip.templateId","tooltip.relativeMode","tooltip.alignment.horizontal","tooltip.alignment.vertical","contextMenu.items","contextMenu.showCustomMenuItemsOnly"],nodes:ej.util.valueFunction("nodes"),connectors:ej.util.valueFunction("connectors"),locale:ej.util.valueFunction("locale"),enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),bridgeDirection:ej.util.valueFunction("bridgeDirection"),tool:ej.util.valueFunction("tool"),_backgroundColor:ej.util.valueFunction("backgroundColor"),_backgroundImage:ej.util.valueFunction("backgroundImage"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapConstraints:ej.util.valueFunction("snapSettings.snapConstraints"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),_selectorOffsetX:ej.util.valueFunction("selectedItems.offsetX"),_selectorOffsetY:ej.util.valueFunction("selectedItems.offsetY"),_selectorWidth:ej.util.valueFunction("selectedItems.width"),_selectorHeight:ej.util.valueFunction("selectedItems.height"),_selectorRotateAngle:ej.util.valueFunction("selectedItems.rotateAngle"),_horizontalOffset:ej.util.valueFunction("scrollSettings.horizontalOffset"),_verticalOffset:ej.util.valueFunction("scrollSettings.verticalOffset"),zoomFactor:ej.util.valueFunction("scrollSettings.zoomFactor"),_layoutType:ej.util.valueFunction("layout.type"),_layoutOrientation:ej.util.valueFunction("layout.orientation"),_horizontalSpacing:ej.util.valueFunction("layout.horizontalSpacing"),_verticalSpacing:ej.util.valueFunction("layout.verticalSpacing"),_layoutMarginX:ej.util.valueFunction("layout.marginX"),_layoutMarginY:ej.util.valueFunction("layout.marginY"),_fixedNode:ej.util.valueFunction("layout.fixedNode"),_dataSourceUniqueId:ej.util.valueFunction("dataSourceSettings.id"),_dataSourceParentId:ej.util.valueFunction("dataSourceSettings.parent"),_dataSource:ej.util.valueFunction("dataSourceSettings.dataSource"),_dataSourceTableName:ej.util.valueFunction("dataSourceSettings.tableName"),_dataSourceQueryString:ej.util.valueFunction("dataSourceSettings.query"),_dataSourceRoot:ej.util.valueFunction("dataSourceSettings.root"),_tooltipTemplateId:ej.util.valueFunction("tooltip.templateId"),_horizontalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.horizontal"),_verticalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.vertical"),_tooltipMode:ej.util.valueFunction("tooltip.relativeMode"),_showCustomContextMenuItems:ej.util.valueFunction("contextMenu.showCustomMenuItemsOnly"),_contextMenuItems:ej.util.valueFunction("contextMenu.items"),dataTypes:{nodes:"data",connectors:"data",contextMenu:{items:"array"},dataSourceSettings:{dataSource:"data"},defaultSettings:{connector:{segments:"data",labels:"data"},node:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"},group:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"}},snapSettings:{horizontalGridLines:{linesInterval:"data",snapInterval:"data"},verticalGridLines:{linesInterval:"data",snapInterval:"data"}},selectedItems:{children:"data",userHandles:"data"}},_doubleClickEvent:!1,_nodes:[],_connectors:[],_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_enableAPIMethods:!0,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_UndoRedo:!1,_mouseEventTriggered:!1,_selectedItem:"",_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_historyCount:0,_lastbefore:null,_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,_previousSelectedItems:[],_eventCause:{},_crudDeleteNodes:[],_isMobile:!1,_labelHashTable:{},activeTool:null,selectionList:[],tools:null,nameTable:{},boundaryTable:{},_init:function(){var e,t,i,a,n,o;this.boundaryTable={},this.nameTable={},this.selectionList=[],this._isInit=!0,this.nameTable={},this.boundaryTable={},e=!!window.SVGSVGElement,e&&("NewVersion"===this.model.version&&(this.model.version=ej.version),this.model.height||(this.model.height="18px"),ej.widget.unobtrusive!==undefined&&(this.model.snapSettings.horizontalGridLines&&this.model.snapSettings.horizontalGridLines.linesInterval&&"string"==typeof this.model.snapSettings.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=JSON.parse(this.model.snapSettings.horizontalGridLines.linesInterval)),this.model.snapSettings.verticalGridLines&&this.model.snapSettings.verticalGridLines.linesInterval&&"string"==typeof this.model.snapSettings.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=JSON.parse(this.model.snapSettings.verticalGridLines.linesInterval)),this.model.defaultSettings.connector&&(t=ej.datavisualization.Diagram.Connector({}),this.model.defaultSettings.connector=this._equivalentPropMap(t,this.model.defaultSettings.connector)),this.model.defaultSettings.node&&(i=ej.datavisualization.Diagram.Node({}),this.model.defaultSettings.node=this._equivalentPropMap(i,this.model.defaultSettings.node))),this.model.snapSettings.horizontalGridLines&&null==this.model.snapSettings.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),this.model.snapSettings.verticalGridLines&&null==this.model.snapSettings.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75]),a=this,a.model.dataSourceSettings.crudAction.read&&(n=$.ajax({type:"GET",url:a.model.dataSourceSettings.crudAction.read,async:!1,success:function(e){a.model.dataSourceSettings.dataSource=e},error:function(){}}),this._isWebAPI=!0),a.model.dataSourceSettings.connectionDataSource.crudAction.read&&(n=$.ajax({type:"GET",url:a.model.dataSourceSettings.connectionDataSource.crudAction.read,async:!1,success:function(e){a.model.dataSourceSettings.connectionDataSource.dataSource=e},error:function(){}}),this._isWebAPI=!0),this.model.backgroundImage&&("string"==typeof this.model.backgroundImage&&(o=this.model.backgroundImage),"function"==typeof this.model.backgroundImage&&(o=this.model.backgroundImage()),o&&(this.model.backgroundImage=ej.datavisualization.Diagram.BackgroundImage({source:o}))),this._layoutMarginX()&&(this.model.layout.margin.left=this.model.layout.margin.right=this._layoutMarginX()),this._layoutMarginY()&&(this.model.layout.margin.top=this.model.layout.margin.bottom=this._layoutMarginY()),this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this._initDefaults(),this._initViews(),this._initData(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1,this._initCommands(),this._initHistoryManager(),this.model.zoomFactor&&.2!==this.model.zoomFactor&&(this.model.scrollSettings.zoomFactor=this.model.zoomFactor),this._updateScrollSettings(this.model.scrollSettings),delete this._viewPort,this._cloneModel=$.extend(!0,{},this.model)),delete this._isInit},_equivalentPropMap:function(e,t){var i,a={};for(var n in e)i=n.toLowerCase(),ej.isPlainObject(t[i])||ej.isPlainObject(t[n])?a[n]=this._equivalentPropMap(e[n],t[i]?t[i]:t[n]):(t[i]||t[n])&&(a[n]=t[i]?t[i]:t[n]);return a},getDiagramBounds:function(){var e=this._getDigramBounds();return e.width=e.width>this.model.scrollSettings.viewPortWidth?e.width+(e.x>0?e.x:0):this.model.scrollSettings.viewPortWidth,e.height=e.height>this.model.scrollSettings.viewPortHeight?e.height+(e.y>0?e.y:0):this.model.scrollSettings.viewPortHeight,e.x=e.x>0?0:e.x,e.y=e.y>0?0:e.y,e},getDiagramContent:function(e){var t,i,a,n,o,s,r,l={};l={top:isNaN(l.top)?0:l.top,bottom:isNaN(l.bottom)?0:l.bottom,left:isNaN(l.left)?0:l.left,right:isNaN(l.right)?0:l.right};var d,h,c=this._currZoom,u=this._hScrollOffset,g=this._vScrollOffset,m=0,p=0,f=this.model.width,v=this.model.height,_=this.getDiagramBounds();for(this._hScrollbar&&this._hScrollbar._scrollData&&(m=this._hScrollbar.model.minimum/c),this._vScrollbar&&this._vScrollbar._scrollData&&(p=this._vScrollbar.model.minimum/c),this._preventZoomEvent=!0,1!==this._currZoom&&(r=new ej.datavisualization.Diagram.Zoom,r.zoomFactor=1/c-1,this.zoomTo(r)),t={},_.x!==this._hScrollOffset/c&&(t.horizontalOffset=_.x),_.y!==this._vScrollOffset/c&&(t.verticalOffset=_.y),Object.keys(t).length>0&&this.update({scrollSettings:t}),$("#"+this.element[0].id).ejDiagram({width:_.width+"px",height:_.height+"px"}),d=this._hScrollbar.element[0].style.visibility,this._hScrollbar.element[0].style.visibility="hidden",h=this._vScrollbar.element[0].style.visibility,this._vScrollbar.element[0].style.visibility="hidden",i=this.model.snapSettings.snapConstraints&ej.datavisualization.Diagram.SnapConstraints.ShowLines,i&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints&~ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),this._clearSelection(!0),e=e||document.styleSheets,a="",n=0;n<e.length;n++)(e[n].href||"string"==typeof e[n])&&(a+='<link href="'+(e[n].href||e[n])+'" rel="stylesheet" />');return o=$(this.element).html(),s="margin-left:"+l.left+"px;margin-top:"+l.top+"px;margin-right:"+l.right+"px;margin-bottom:"+l.bottom+"px;",o=a+"<body style='margin:0px;padding:0px'><div style=\""+s+'">'+o+"</div></body>",o=o.replace(/ transform: t/g," -webkit-transform: t"),$("#"+this.element[0].id).ejDiagram({width:f,height:v}),c&&(r=new ej.datavisualization.Diagram.Zoom,r.zoomFactor=c/this._currZoom-1,this.zoomTo(r)),this.update({scrollSettings:{horizontalOffset:u,verticalOffset:g}}),delete this._preventZoomEvent,this._hScrollbar&&(this._hScrollbar.element[0].style.visibility=d),this._vScrollbar&&(this._vScrollbar.element[0].style.visibility=h),i&&$("#"+this.element[0].id).ejDiagram({snapSettings:{snapConstraints:this.model.snapSettings.snapConstraints|ej.datavisualization.Diagram.SnapConstraints.ShowLines}}),o},refresh:function(){var e,t;if(this._updateTableNodes(),this._updateGroupChildren(this.model),this._isSwimlaneExist){for(e=this.connectors(),t=0;t<e.length;t++)e[t].zOrder=-1;delete this._isSwimlaneExist}this._updateScrollOffset(0,0),this._destroy(),this.element.addClass("e-datavisualization-diagram"),this._currZoom=1,this._hScrollbar=null,this._vScrollbar=null,this._view=null,this._svg=null,this._page=null,this._pageBackgroundLayer=null,this._diagramLayer=null,this._htmlLayer=null,this.clearHistory(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this.model.dataSourceSettings&&this.model.dataSourceSettings.dataSource&&(this.nodes([]),this.connectors([]),this._nodes=[],this._connectors=[]),this._init()},_initCommands:function(e){var t,i,a,n,o=ej.datavisualization.Diagram.KeyModifiers,s=ej.datavisualization.Diagram.Keys;if(e)t=this.model.commandManager.commands;else{e=this.model.commandManager.commands,t={copy:{gesture:{key:s.C,keyModifiers:o.Control},_isDefault:!0},paste:{gesture:{key:s.V,keyModifiers:o.Control},_isDefault:!0},cut:{gesture:{key:s.X,keyModifiers:o.Control},_isDefault:!0},"delete":{gesture:{key:s.Delete},_isDefault:!0},undo:{gesture:{key:s.Z,keyModifiers:o.Control},_isDefault:!0},redo:{gesture:{key:s.Y,keyModifiers:o.Control},_isDefault:!0},selectAll:{gesture:{key:s.A,keyModifiers:o.Control},_isDefault:!0},nudgeUp:{parameter:"up",gesture:{key:s.Up},_isDefault:!0},nudgeRight:{parameter:"right",gesture:{key:s.Right},_isDefault:!0},nudgeDown:{parameter:"down",gesture:{key:s.Down},_isDefault:!0},nudgeLeft:{parameter:"left",gesture:{key:s.Left},_isDefault:!0},startEdit:{gesture:{key:113},_isDefault:!0},endEdit:{gesture:{key:s.Escape},_isDefault:!0},focusToNextItem:{gesture:{key:s.Tab},_isDefault:!0},focusToPreviousItem:{gesture:{key:s.Tab,keyModifiers:o.Control},_isDefault:!0},selectFocusedItem:{gesture:{key:s.Enter},_isDefault:!0}};for(i in t)this._initCommandValues(i,t[i])}for(a in e)t[a]?e[a]?(e[a]&&t[a].gesture&&e[a].gesture&&(this._isLoad||t[a]._isDefault&&delete t[a]._isDefault,e[a].gesture=ej.datavisualization.Diagram.Gesture($.extend({},!0,t[a].gesture,e[a].gesture)),this._tempCommandManager&&this._tempCommandManager.commands&&this._tempCommandManager.commands[a]._isDefault&&this._initCommandValues(a,e[a])),$.extend(t[a],!0,e[a])):t[a]=null:e[a]&&(n=ej.datavisualization.Diagram.Command(e[a]),t[a]=n);this.model.commandManager.commands=t},_initCommandValues:function(e,t){switch(e){case"copy":t.execute=$.proxy(this.copy,this),t.canExecute=$.proxy(this._canExecute,this);break;case"paste":t.execute=$.proxy(this._commandPaste,this),t.canExecute=$.proxy(this._canExecute,this);break;case"cut":t.execute=$.proxy(this.cut,this),t.canExecute=$.proxy(this._canExecute,this);break;case"delete":t.execute=$.proxy(this.remove,this),t.canExecute=$.proxy(this._canExecute,this);break;case"undo":t.execute=$.proxy(this.undo,this),t.canExecute=$.proxy(this._canExecute,this);break;case"redo":t.execute=$.proxy(this.redo,this),t.canExecute=$.proxy(this._canExecute,this);break;case"selectAll":t.execute=$.proxy(this._selectCommand,this),t.canExecute=$.proxy(this._canExecute,this);break;case"nudgeUp":case"nudgeRight":case"nudgeDown":case"nudgeLeft":t.execute=$.proxy(this._nudgeCommand,this),t.canExecute=$.proxy(this._canExecute,this);break;case"startEdit":t.execute=$.proxy(this._startEditCommand,this),t.canExecute=$.proxy(this._canExecute,this);break;case"endEdit":t.execute=$.proxy(this._endEdit,this),t.canExecute=$.proxy(this._canExecute,this);break;case"focusToNextItem":case"focusToPreviousItem":t.execute=$.proxy(this._focusToItem,this),t.canExecute=$.proxy(this._canExecute,this);break;case"selectFocusedItem":t.execute=$.proxy(this._selectFocusedItem,this),t.canExecute=$.proxy(this._canExecute,this)}},_initViews:function(e){e||(this._views=[],this._views.push(this._id)),this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_initDefaults:function(){this.tool()||(ej.isMobile()?(this.tool(ej.datavisualization.Diagram.Tool.ZoomPan),this._isMobile=!0):this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect)),this._initTools()},_initCanvas:function(e){this._renderCanvas(e)},_initVisualGuide:function(){this.model.tooltip&&(this.model.tooltip=ej.datavisualization.Diagram.Tooltip(this.model.tooltip)),this.model.selectedItems&&(this.model.selectorConstraints&&(this.model.selectedItems.constraints=this.model.selectorConstraints),this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Util.canEnableTooltip(this)&&this.showTooltip()?this.model.selectedItems.tooltip?ej.datavisualization.Diagram.Tooltip(this.model.selectedItems.tooltip):ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null,this.model.selectedItems.tooltip&&this.model.tooltipTemplateId&&(this.model.selectedItems.tooltip.templateId=this.model.selectedItems.tooltip.templateId||this.model.tooltipTemplateId))},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),portTool:new ej.datavisualization.Diagram.PortTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),bezierLine:new ej.datavisualization.Diagram.BezierLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this),shapeTool:new ej.datavisualization.Diagram.ShapeTool(this),text:new ej.datavisualization.Diagram.TextTool(this),labelMove:new ej.datavisualization.Diagram.LabelMoveTool(this),labelResize:new ej.datavisualization.Diagram.LabelResizeTool(this),labelRotate:new ej.datavisualization.Diagram.LabelRotateTool(this)},this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this._registerDrawingTools()},_initDiagramTool:function(){var e,t=this.tool();t&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(e=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(e,!1)):t&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(e=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(e,!0)):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&(this.activateTool("select"),this.activeTool.singleAction=!1)},_initHandles:function(){var e,t=this.model.selectedItems.userHandles;if(t)for(e=0;e<t.length;e++)t[e]=ej.datavisualization.Diagram.UserHandle(t[e]),t[e].tool&&(t[e].tool.diagram=this,this.tools[t[e].name]=t[e].tool)},_initHistoryManager:function(){this.model.historyManager.push=$.proxy(this.addHistoryEntry,this),this.model.historyManager.pop=$.proxy(this.removeHistoryEntry,this),this.model.historyManager.canPop=$.proxy(this.canRemoveHistoryEntry,this),this.model.historyManager.startGroupAction=$.proxy(this._startGroupAction,this),this.model.historyManager.closeGroupAction=$.proxy(this._closeGroupAction,this)},_cloneGlobalVariables:function(){this._historyList=$.extend(!0,{},this._historyList)},_setNodesConnectors:function(e,t){var i,a=[],n=!1,o=!1,s=e.nodes?"function"==typeof e.nodes?e.nodes().length:e.nodes.length:0,r=e.connectors?e.connectors&&"function"==typeof e.connectors?e.connectors().length:e.connectors.length:0;if(e.nodes&&s!=this._nodes.length){for(i=0;i<this.nodes().length;i++)this._removeElementFromCollection(this.nameTable[this.nodes()[i].name]);this._isPreventModelChange=!0,this.nodes("function"==typeof e.nodes?e.nodes():e.nodes),this._isPreventModelChange=!1,this._initNodeCollection(t),n=!0}if(e.connectors&&r!=this._connectors.length){for(i=0;i<this.connectors().length;i++)this._removeElementFromCollection(this.nameTable[this.connectors()[i].name]);this._isPreventModelChange=!0,this.connectors("function"==typeof e.connectors?e.connectors():e.connectors),this._isPreventModelChange=!1,this._initConnectorCollection(),o=!0}return a=this.nodes(),a=a.length>0?this.nodes().concat(this.connectors()):this.connectors(),(a.length>0||0==e.nodes.length||0==e.connectors.length)&&this._resetObjectCollection(a,t,n,o),!0},_removeElementFromCollection:function(e){if(e){if(e.children)for(var t=0;t<e.children.length;t++)this._removeElementFromCollection(this.nameTable[this._getChild(e.children[t])]);e.segments?this._removeEdges(e):(this._disConnect(e,{}),e.inEdges=e.outEdges=[]),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[e.name],e),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,e),this._removeElement(e),delete this.nameTable[e.name]}},_updateCloneModel:function(e){e&&(this._cloneModel[e]="string"==typeof this.model[e]?this.model[e]:$.extend(!0,{},this.model[e]))},_compareModelProperty:function(e,t,i){if(e&&this._cloneModel[e]!==this.model[e]){var a={};a[e]=this.model[e],this._comparePropertyValues(this._cloneModel,e,a,t,i),this._updateCloneModel(e)}},_setModel:function(e){var t,i,a,n,o,s,r,l,d,h=!1;for(a in e){switch(a){case"height":case"width":this._svgParentDimention=null,this._initViews(!0),this._initCanvas(!0);break;case"nodes":case"connectors":h||this._isPreventModelChange||this._isRefreshTriggered&&"function"==typeof this.model.nodes||(h=this._setNodesConnectors(e,this._isLoad),this._trigger("refresh")),delete this._isRefreshTriggered;break;case"enableContextMenu":this.model.enableContextMenu=e[a],this._initContextMenu(this._isLoad);break;case"contextMenu":this.model.contextMenu=$.extend({},this.model.contextMenu,e[a]),this._initContextMenu(this._isLoad);break;case"rulerSettings":this._updateRulerSettings(e[a]);break;case"snapSettings":i=e[a],i&&Object.keys(i).length>0&&(this._updateSnapSettings(e[a]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(e[a]);break;case"constraints":if(this.model.constraints=e[a],this._hasSelection()&&!ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._clearSelection(),n=this._getConnectors(),n.length>0)for(o=0;o<n.length;o++)ej.datavisualization.Diagram.Util.updateBridging(this.model.connectors[o],this),ej.datavisualization.Diagram.DiagramContext.update(this.model.connectors[o],this);break;case"drawingTools":this.model.drawingTools=e[a],this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=this.model.backgroundImage&&"string"==typeof this.model.backgroundImage?ej.datavisualization.Diagram.BackgroundImage({source:this.model.backgroundImage}):$.extend(!0,{},this.model.backgroundImage,e[a]),ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"backgroundColor":this.model.backgroundColor=e[a],ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(e[a]);break;case"autoScrollMargin":this.model.autoScrollMargin=e[a];break;case"layout":e[a].marginX&&(this.model.layout.margin.left=this.model.layout.margin.right=Number("function"==typeof e[a].marginX?this._layoutMarginX():e[a].marginX)),e[a].marginY&&(this.model.layout.margin.top=this.model.layout.margin.bottom=Number("function"==typeof e[a].marginY?this._layoutMarginY():e[a].marginY)),this.model.layout=$.extend(!0,{},this.model.layout,e[a]),this._setLayout(e[a]);break;case"selectedItems":this.updateSelector(e[a]);break;case"pageSettings":this.updatePageSettings(e[a]);break;case"scrollSettings":this._updateScrollSettings(e[a]);break;case"locale":this.locale(e[a]),s=document.getElementById(this.element[0].id+"_contextMenu"),s.parentNode.removeChild(s),this.model.contextMenu&&this.model.contextMenu.items&&this.model.contextMenu.items.length>0&&(this.model.contextMenu.items=[]),this._renderContextMenu();break;case"nodeTemplate":this._clearElementCollection(),this._initData(),t=this,this._views.forEach(function(e){var i=t._views[e],a=t._setNodeZOrder(i);t._renderDiagramObjects(a,i)}),this.layout();break;case"bridgeDirection":case"tool":this.update(e);break;case"connectorTemplate":this._updateConnectors();break;case"commandManager":r=e[a]&&e[a].commands?e[a].commands:undefined,this._initCommands(r);break;case"historyManager":this.model.historyManager=$.extend(!0,this.model.historyManager,{},e[a]);var c=this.model.historyManager.stackLimit,u=this.model.historyManager.redoStack.length,g=this.model.historyManager.undoStack.length;u>0&&(u>c?(d=u-c,this.model.historyManager.redoStack.splice(0,d),this.model.historyManager.undoStack=[]):(l=c-u,d=g-l,this.model.historyManager.undoStack.splice(0,d))),g>0&&(d=g-c,d>0&&this.model.historyManager.undoStack.splice(0,d)),this._initHistoryManager();break;case"showTooltip":this.model.showTooltip=e[a],this.model.selectedItems.tooltip=this.showTooltip()?ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null;break;case"toolTipTemplateId":this.model.selectedItems.tooltip||(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip({margin:{top:10}})),this.model.selectedItems.tooltip.templateId=e[a];break;case"tooltip":this.model.tooltip=null===e[a]?null:ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.tooltip,{},e[a]));break;case"dataSourceSettings":i=e[a],i&&Object.keys(i).length>0&&(this.clear(),$.extend(this.model.dataSourceSettings,e[a]),this._initData(),t=this,this._views.forEach(function(e){var i=t._views[e],a=t._setNodeZOrder(i);t._renderDiagramObjects(a,i)}),this.layout())}"nodes"===a||"connectors"===a||"selectorConstraints"===a||"selectedItems"===a||"bridgeDirection"===a||"tool"===a||"dataSourceSettings"===a||this._compareModelProperty(a)}},_resetObjectCollection:function(e,t,i,a){var n,o,s,r;if(i&&($(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove(),$(this.element).find(".ej-d-seperator").remove()),a)for(n=$(this.element).find(".ej-d-connector"),o=n.length-1;o>=0;o--)s=this.nameTable[n[o].id],s&&""==s.parent&&$(n[o]).remove();this._hasSelection()&&this._clearSelection(),r=this,this._views.forEach(function(e){var t=r._views[e],i=r._setNodeZOrder(t);r._renderDiagramObjects(i,t)})},_getConnectors:function(){var e,t,i=[];for(e in this.nameTable)t=this.nameTable[e],("connector"===t._type||t.segments)&&i.push(t);return i},_generateNodes:function(e){for(var t,i,a=[],n=0;n<e.length;n++)t=e[n],i=this._makeNode(t),null!=i&&i.name&&!this._findNodeByName(a,i.name)&&a.push(i);return a},_generateConnectors:function(e){for(var t,i,a=[],n=0;n<e.length;n++)t=e[n],i=this._makeLine(t),i&&i.name&&!this._findNodeByName(a,i.name)&&a.push(i);return a},_findNodeByName:function(e,t){for(var i=0;i<e.length;i++)if(e[i].name===t)return!0;return!1},_makeNode:function(e){var t,i=this.model.dataSourceSettings,a={},n=e[i.id];if(n){if(a.name=n,i.customFields&&i.customFields.length>0)for(t=0;t<i.customFields.length;t++)a[i.customFields[t]]=e[i.customFields[t]];return a}return null},_makeLine:function(e){var t,i=this.model.dataSourceSettings.connectionDataSource,a={};if(a.name=e[i.id]?e[i.id]:"connector_"+ej.datavisualization.Diagram.Util.randomId(),a.sourceNode=e[i.sourceNode],a.targetNode=e[i.targetNode],e[i.sourcePointX]&&e[i.sourcePointY]&&(a.sourcePoint={x:Number(e[i.sourcePointX]),y:Number(e[i.sourcePointY])}),e[i.targetPointX]&&e[i.targetPointY]&&(a.targetPoint={x:Number(e[i.targetPointX]),y:Number(e[i.targetPointY])}),i.customFields&&i.customFields.length>0)for(t=0;t<i.customFields.length;t++)a[i.customFields[t]]=e[i.customFields[t]];return a},insertData:function(e){var t,i,a,n;if(e)a=this._parameterMap(e),t="connector"===e.type?this.model.dataSourceSettings.connectionDataSource.crudAction.create:this.model.dataSourceSettings.crudAction.create,
a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),t);else{if(i=this._getNewNodes(),i.nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.create)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.create)}}},updateData:function(e){var t,i,a,n;if(e)a=this._parameterMap(e),t="connector"===e.type?this.model.dataSourceSettings.connectionDataSource.crudAction.update:this.model.dataSourceSettings.crudAction.update,a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),t);else{if(i=this._getUpdatedNodes(),i.nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.update)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.update)}}},removeData:function(e){var t,i,a,n;if(e)a=this._parameterMap(e),t="connector"===e.type?this.model.dataSourceSettings.connectionDataSource.crudAction.destroy:this.model.dataSourceSettings.crudAction.destroy,a&&this._raiseAjaxPost(JSON.stringify({data:[a]}),t);else{if(i=this._getDeletedNodes(),i.nodes){for(a=[],n=0;n<i.nodes.length;n++)a.push(this._parameterMap(i.nodes[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.crudAction.destroy)}if(i.connectors){for(a=[],n=0;n<i.connectors.length;n++)a.push(this._parameterMap(i.connectors[n]));a&&a.length>0&&this._raiseAjaxPost(JSON.stringify({data:a}),this.model.dataSourceSettings.connectionDataSource.crudAction.destroy)}}},_parameterMap:function(e){var t,i,a={};if("connector"===e.type){if(t=this.model.dataSourceSettings.connectionDataSource,t.id&&(a[t.id]=e.name),t.sourcePointX&&t.sourcePointY&&(a[t.sourcePointX]=e.sourcePoint.X,a[t.sourcePointY]=e.sourcePoint.Y),t.targetPointX&&t.targetPointY&&(a[t.targetPointX]=e.targetPoint.X,a[t.targetPointY]=e.targetPoint.Y),t.sourceNode&&(a[t.sourceNode]=e.sourceNode),t.targetNode&&(a[t.targetNode]=e.targetNode),t.customFields&&t.customFields.length>0)for(i=0;i<t.customFields.length;i++)a[t.customFields[i]]=e[t.customFields[i]]}else if(t=this.model.dataSourceSettings,t.id&&(a[t.id]=e.name),t.width&&(a[t.width]=e.width),t.height&&(a[t.height]=e.height),t.offsetX&&(a[t.offsetX]=e.offsetX),t.offsetY&&(a[t.offsetY]=e.offsetY),t.customFields&&t.customFields.length>0)for(i=0;i<t.customFields.length;i++)a[t.customFields[i]]=e[t.customFields[i]];return a},_raiseAjaxPost:function(e,t){$.ajax({contentType:"application/json",type:"POST",url:t,data:this._isWebAPI?JSON.stringify(JSON.parse(e).data):JSON.stringify(JSON.parse(e)),dataType:"json",error:function(e){404===e.status&&console.log("Method not found")}})},_initData:function(){var dataSourceSettings,dataSource,nodes,connectors,dataSourceApplied,tempNodes,tempconnectors,i,collapsedNodes;if(this.model.dataSourceSettings&&(dataSourceSettings={},this.model.dataSourceSettings.dataSource&&this.model.dataSourceSettings.connectionDataSource.dataSource?(dataSourceSettings.dataSource=this.model.dataSourceSettings.dataSource,dataSourceSettings.isBinding=!0,dataSourceSettings.nodes=this._generateNodes(this.model.dataSourceSettings.dataSource),dataSourceSettings.connectors=this._generateConnectors(this.model.dataSourceSettings.connectionDataSource.dataSource)):this.model.dataSourceSettings.dataSource&&(dataSourceSettings.id=this._dataSourceUniqueId(),dataSourceSettings.parent=this._dataSourceParentId(),dataSourceSettings.root=this._dataSourceRoot(),dataSourceSettings.dataSource=this._dataSource(),dataSourceSettings.tableName=this._dataSourceTableName(),dataSourceSettings.query=this._dataSourceQueryString()),dataSource=dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],dataSourceSettings&&dataSourceSettings.isBinding)dataSourceSettings.nodes&&dataSourceSettings.nodes.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.nodes,nodes,"nodes"),dataSourceSettings.connectors&&dataSourceSettings.connectors.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.connectors,connectors,"connectors");else if(this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(e){diagram.retriveData=e.result,diagram._applyTemplate(diagram.model.dataSourceSettings,e.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(e){diagram.retriveData=e.result,diagram._applyTemplate(diagram.model.dataSourceSettings,e.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?(this._initDataSource(dataSourceSettings,nodes,connectors),dataSourceSettings.parent&&(dataSourceApplied=!0)):"string"!=typeof dataSource&&dataSource.length&&(this._applyDataSource(dataSourceSettings,dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0));for(tempNodes=[],tempconnectors=[],this.nodes().length>0&&(tempNodes=this.nodes()),this.connectors().length>0&&(tempconnectors=this.connectors()),this.nodes(nodes),this.connectors(connectors),i=0;i<tempNodes.length;i++)this.nodes().push(tempNodes[i]),this._nodes=$.extend(!0,[],this.nodes());for(i=0;i<tempconnectors.length;i++)this.connectors().push(tempconnectors[i]),this._connectors=$.extend(!0,[],this.connectors())}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied),this._initConnectorCollection(dataSourceApplied),collapsedNodes.length>0&&this._collapseNodes(collapsedNodes),this._cloneModel=$.extend(!0,{},this.model)},_getSetTool:function(){var e;return this.model.setTool&&("string"==typeof this.model.setTool&&(e=ej.util.getObject(this.model.setTool,window)),$.isFunction(this.model.setTool)&&(e=this.model.setTool)),e},_getNodeTemplate:function(){var e;return this.model.nodeTemplate&&("string"==typeof this.model.nodeTemplate&&(e=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(e=this.model.nodeTemplate)),e},_getConnectorTemplate:function(){var e;return this.model.connectorTemplate&&("string"==typeof this.model.connectorTemplate&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(e=this.model.connectorTemplate)),e},_initNodeCollection:function(e,t){var i,a,n=[],o=this.nodes();for(this.model.dataSourceSettings.dataSource||(i=this._getNodeTemplate()),this._isNodeInitializing=!0,a=0;a<o.length;a++)o[a].container&&!$.isEmptyObject(o[a].container)||o[a].isSwimlane||"swimlane"===o[a].type?(a=this._convertGroupChild(o[a],o),o[a]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a])):"object"!=typeof o[a].shape&&(o[a]=ej.datavisualization.Diagram.NodeType(o[a],this)),""==o[a].name&&(o[a].name="node_"+ej.datavisualization.Diagram.Util.randomId()),"swimlane"===o[a].type||o[a].isSwimlane?this.nameTable[o[a].name]=ej.datavisualization.Diagram.Group(o[a]):"group"===o[a]._type||o[a].children&&o[a].children.length>0?("bpmn"==o[a].type&&o[a].container?o[a]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a]):(a=this._convertGroupChild(o[a],o),o[a]=this._getNewGroup(o[a])),o[a]._type="group",this.nameTable[o[a].name]=o[a],this._initGroupNode(o[a]),e||"bpmn"===o[a].type||this._udpateChildRotateAngle(o[a])):t?o[a].shape&&"object"==typeof o[a].shape&&ej.datavisualization.Diagram.Util._updateShapeProperties(o[a]):(o[a]=this._getNewNode(o[a]),this.nameTable[o[a].name]=o[a]),!t&&i&&(i(this,o[a]),"object"!=typeof o[a].shape&&(o[a]=ej.datavisualization.Diagram.NodeType(o[a],this)),("group"===o[a]._type||o[a].children&&o[a].children.length>0)&&(o[a]="bpmn"==o[a].type&&o[a].container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,o[a]):this._getNewGroup(o[a]),this._initGroupNode(o[a]))),"node"===o[a]._type&&o[a].labels.length&&(0==o[a].width||0==o[a].height)&&this._getNodeDimension(o[a]),this.nameTable[o[a].name]=o[a],this._updateQuad(o[a]),o[a].isExpanded||n.push(o[a]);return delete this._isNodeInitializing,this._nodes=$.extend(!0,[],o),n},_convertGroupChild:function(e,t){var i,a;if(e.children&&e.children.length>0)for(i=0;i<e.children.length;i++)a=e.children[i],a&&"string"==typeof a&&(a=this.nameTable[a],e.children[i]=a,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[a.name],a),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,a,!1),"group"===a.type&&(i=this._convertGroupChild(a,e.children)),"connector"===a.type?ej.datavisualization.Diagram.Util.removeItem(this.connectors(),a):ej.datavisualization.Diagram.Util.removeItem(this.nodes(),a));return t.indexOf(e)},_initConnectorCollection:function(e){for(var t,i=this.connectors(),a=this._getConnectorTemplate(),n=0,o=i.length;o>n;n++)t=e?i[n]:this._getNewConnector(i[n]),this.nameTable[t.name]=t,e||this.model.layout&&this._layoutType()===ej.datavisualization.Diagram.LayoutTypes.None&&this._dock(t,this.nameTable),this._updateEdges(t),a&&!e&&a(this,t),i[n]=t;this._connectors=$.extend(!0,[],i)},_initDataSource:function(dataSourceSettings,nodes,connectors){var dataSource=dataSourceSettings.dataSource,diagram=this,mapper,query,queryPromise;dataSource.dataSource.json&&dataSource.dataSource.json.length>0?diagram._applyDataSource(dataSourceSettings,dataSource.dataSource.json,nodes,connectors):dataSource.dataSource.table||(mapper=dataSourceSettings,dataSource instanceof ej.DataManager&&($.ajaxSetup({async:!1}),query=this._findQuery(mapper,dataSourceSettings.nodeBinding),queryPromise=dataSourceSettings.dataSource.executeQuery(eval(query)),queryPromise.done(function(e){diagram.retriveData=e.result,diagram._applyDataSource(dataSourceSettings,e.result,nodes,connectors)})))},_findQuery:function(e,t){var i,a,n,o,s,r,l=[],d=ej.Query(),h=e.query||this.model.dataSourceSettings.query;if(ej.isNullOrUndefined(h)){i=e.dataSource||this.model.dataSourceSettings.dataSource,a=e.tableName||this.model.dataSourceSettings.tableName;for(n in e)"tableName"===n||"dataSource"===n||"designTemplate"===n||n.match("Binding")||e[n]&&l.push(e[n]);for(o in t)if("labels"===o)for(s=t[o],r=0;r<s.length;r++)s[r].text&&l.push(s[r].text);else"shape"==o||"line"==o?t[o][type]&&n.push(t[o][type]):t[o]&&l.push(t[o]);l.length>0&&d.select(l),i.dataSource.url.match(a+"$")||ej.isNullOrUndefined(a)||d.from(a)}else d=h;return d},_updateMultipleRootNodes:function(e,t,i){var a,n,o=e[i.parent];if(o&&o.length>0)for(n=0;n<o.length;n++)a=o[n],t[a]?t[a].items.push(e):t[a]={items:[e]};return t},_applyDataSource:function(e,t,i,a){for(var n,o,s,r,l,d,h,c,u,g,m,p=[],f=0;f<t.length;f++)h=t[f],Array.isArray(h[e.parent])?p=this._updateMultipleRootNodes(h,p,e,t):p[h[e.parent]]?p[h[e.parent]].items.push(h):p[h[e.parent]]={items:[h]},e.root===h[e.id]&&(n={items:[h]});if(c=[],e.parent)if(n)c.push(n);else for(d in p)(d||0===d)&&"undefined"!=d&&'""'!=d&&"null"!=d||c.push(p[d]);else c.push(p[undefined]);for(this.model.nodeTemplate&&(g=this._getNodeTemplate()),this.model.connectorTemplate&&(m=this._getConnectorTemplate()),o=0;o<c.length;o++)for(s=0;s<c[o].items.length;s++)r=c[o].items[s],l=this._applyNodeTemplate(e,r,g),i.push(l),e.parent&&(u=p[l[e.id]],u&&u.items&&this._renderChildNodes(e,u,l.name,i,a,p,g,m))},_getNewNodes:function(){var e,t,i=[],a=[];for(e in this.nameTable)t=this.nameTable[e],t&&"connector"===t.type&&"new"===t._status?(t._status="",a.push(t)):t&&"new"===t._status&&(t._status="",i.push(t));return{nodes:i,connectors:a}},_getUpdatedNodes:function(){var e,t,i=[],a=[];for(e in this.nameTable)t=this.nameTable[e],t&&"connector"===t.type&&"update"===t._status?(t._status="",a.push(t)):t&&"update"===t._status&&(t._status="",i.push(t));return{nodes:i,connectors:a}},_getDeletedNodes:function(){for(var e,t=[],i=[],a=0;a<this._crudDeleteNodes.length;a++)e=this._crudDeleteNodes[a],e&&"connector"===e.type?i.push(e):e&&t.push(e);return this._crudDeleteNodes=[],{nodes:t,connectors:i}},_isContainsSameConnector:function(e,t,i){var a,n;if(t&&i)for(a=0;a<e.length;a++)if(n=e[a],n&&n.sourceNode===t&&n.targetNode===i)return!0;return!1},_renderChildNodes:function(e,t,i,a,n,o,s,r){for(var l,d,h,c,u=0;u<t.items.length;u++)l=t.items[u],d=this._applyNodeTemplate(e,l,s),c=!1,this._collectionContains(d.name,a)?c=!0:a.push(d),this._isContainsSameConnector(n,i,d.name)||n.push(this._applyConnectorTemplate(e,null,i,d.name,r)),c||(h=o[l[e.id]],h&&this._renderChildNodes(e,h,d.name,a,n,o,s,r))},_applyTemplate:function(e,t,i,a){var n,o,s,r,l;if(this.model.nodeTemplate&&(n=this._getNodeTemplate()),this.model.connectorTemplate&&(l=this._getConnectorTemplate()),"nodes"==a)for(o=0;o<t.length;o++)s=this._applyNodeTemplate(e,t[o],n),i.push(s);if("connectors"==a)for(o=0;o<t.length;o++)r=this._applyConnectorTemplate(e,t[o],t[o].sourceNode,t[o].targetNode,l),i.push(r)},_applyNodeTemplate:function(e,t,i){var a=t;return""!==a.name&&a.name||(a.name=ej.datavisualization.Diagram.Util.randomId()),a="group"!=a.type?this._getNewNode(a):this._getNewGroup(a),i&&i(this,a),"group"===a._type&&this._initGroupNode(a),a},_applyConnectorTemplate:function(e,t,i,a,n){var o={};return o.name=t&&t.name?t.name:ej.datavisualization.Diagram.Util.randomId(),o.sourceNode=i,o.targetNode=a,o=this._getNewConnector(o),n&&n(this,o),o},_collapseNodes:function(e){for(var t,i=0;i<e.length;i++)t=e[i],this._collapseChildren(t)},_getNewNode:function(e){return e.shape&&"object"==typeof e.shape&&ej.datavisualization.Diagram.Util._updateShapeProperties(e),ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,e))},_getNewGroup:function(e){var t,i=null,a=0;if("bpmn"==e.type&&(e=ej.datavisualization.Diagram.Util._updateBpmnChild(ej.datavisualization.Diagram.Node(e),this)),e.children&&e.children.length>0)for(t in e.children)i=this.nameTable[this._getChild(e.children[t])],i&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),i.segments?(a=this.connectors().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewConnector(i),a>=0&&(this.connectors()[a]=this.nameTable[i.name]),this._dock(this.nameTable[i.name],this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(this.nameTable[i.name],this)):"node"===i._type?(a=this.nodes().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewNode(i),a>=0&&(this.nodes()[a]=this.nameTable[i.name])):"group"===i._type&&(a=this.nodes().indexOf(i),delete this.nameTable[i.name],this.nameTable[i.name]=this._getNewGroup(i),a>=0&&(this.nodes()[a]=this.nameTable[i.name])));return ej.datavisualization.Diagram.Group($.extend(!1,{},this.model.defaultSettings.group,e))},_isEmptyDiagramObject:function(e){if($.isEmptyObject(e))return!0;for(var t in e)if("object"==typeof e[t])return this._isEmptyDiagramObject(e[t]);return!1},_getNewConnector:function(e){var t,i,a,n=$.extend(!0,{},this.model.defaultSettings.connector,e);return this.model.layout&&"organizationalchart"==this.model.layout.type&&(n=$.extend(!0,{},{segments:[{type:"orthogonal"}]},n)),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(n.defaultType=this.model.defaultSettings.connector.segments[0].type),n.shape&&!this._isEmptyDiagramObject(n.shape)&&("umlactivity"==n.shape.type&&(n=ej.datavisualization.Diagram.UMLConnectorShape(n),n.sourceNode&&(t=this.nameTable[n.sourceNode]),n.targetNode&&(i=this.nameTable[n.targetNode]),a=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(i,t,n,this),n.targetNode=a?a.name:null),"umlclassifier"==n.shape.type?(n=ej.datavisualization.Diagram.UMLConnectorShape(n),n.sourceNode&&(t=this.nameTable[n.sourceNode]),n.targetNode&&(i=this.nameTable[n.targetNode]),a=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(i,t,n,this),n.targetNode=a?a.name:null):(n.shape=$.extend(!0,{},ej.datavisualization.Diagram.ConnectorShapeDefaults,n.shape),"sequence"==n.shape.flow&&("normal"==n.shape.sequence&&(n=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n)),"conditional"==n.shape.sequence&&(n=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n),n.sourceDecorator={shape:"diamond",fillColor:"white",width:20,height:10}),"default"==n.shape.sequence&&(n=$.extend(!0,{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},n))),"association"==n.shape.flow&&("directional"==n.shape.association&&(n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},n)),"nondirectional"==n.shape.association&&(n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"none"}},n)),"bidirectional"==n.shape.association&&(n=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},n),n.sourceDecorator={shape:"openarrow",width:5,height:10})),"message"==n.shape.flow&&(n=$.extend(!0,{},{segments:[{type:"straight"}],sourceDecorator:{shape:"circle",fillColor:"white"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"},n)))),ej.datavisualization.Diagram.Util._initConnectionEnds(n,this),ej.datavisualization.Diagram.Connector(n)},_setOverview:function(e,t){var i,a,n;e?(this._overview=e,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._views[e._id]||(this._views.push(e._id),this._views[e._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},e._renderDocument(this._views[e._id]),i=this._views[e._id],a=this._setNodeZOrder(i),this._renderDiagramObjects(a,i,null,!0),e._updateOverview(i)),delete this._viewPort):(e=$("#"+t).ejOverview("instance"),e._removeDocument(this._views[t]),this._views[t]=undefined,n=this._views.indexOf(t),this._views.splice(n,1))},_updateScrollOffset:function(e,t,i){this._hScrollOffset=Number(e),this._vScrollOffset=Number(t),this._verticalOffset(Number(t)),this._horizontalOffset(Number(e)),this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),ej.datavisualization.Diagram.ScrollUtil._transform(this,e,t,i);var a=this;this._views.forEach(function(i){var n,o=a._views[i];"overview"==o.type&&(n=$("#"+i).ejOverview("instance"),n&&n._scrollOverviewRect(e,t,a._currZoom))}),this.model.scrollSettings.viewPortHeight=this._viewPort.height,this.model.scrollSettings.viewPortWidth=this._viewPort.width,this.model.scrollSettings.currentZoom=this._currZoom},_getChild:function(e){return ej.datavisualization.Diagram.Util.getChild(e)},_getChildren:function(e){var t,i,a;if(e){for(t=[],i=0;i<e.length;i++)a=e[i],a&&("object"==typeof a?t.push(a.name):t.push(a));return t}},_initGroupNode:function(e,t){for(var i,a=null,n=0;e.children&&n<e.children.length;n++)i=t?$.extend(!0,{},t[this._getChild(e.children[n])]):e.children[n],a="string"==typeof i?this.nameTable[i]:i,a&&(a._type||"umlclassifier"!=a.type||(a._type="group"),a.container&&(a._type="group",a.labels=a.labels||[]),i&&"object"==typeof i&&("object"!=typeof a.shape&&"bpmn"!=e.type&&(a=ej.datavisualization.Diagram.NodeType(a,this)),"group"==a._type||a.children||a.segments||"connector"==a.type?a.segments||"connector"==a.type?(a=this._getNewConnector(a),""==a.name&&(a.name=ej.datavisualization.Diagram.Util.randomId())):(a=this._getNewGroup(a),""==a.name&&(a.name=ej.datavisualization.Diagram.Util.randomId()),this._initGroupNode(a)):("bpmn"!=e.type&&"umlclassifier"!=e.type&&(a=this._getNewNode(a)),""==a.name&&(a.name=ej.datavisualization.Diagram.Util.randomId()),"node"==a._type&&a.labels.length&&(0==a.width||0==a.height)&&this._getNodeDimension(a)),e.children[n]=a,a.parent=e.name,this.nameTable[a.name]=a,a.segments&&this._dock(a,this.nameTable)),this._updateQuad(this.nameTable[this._getChild(e.children[n])]));this._isLoad||ej.datavisualization.Diagram.Util._updateGroupBounds(e,this)},_udpateChildRotateAngle:function(e){var t,i,a,n,o,s;if(e.rotateAngle)for(a=ej.Matrix.identity(),ej.Matrix.rotate(a,e.rotateAngle,e.offsetX,e.offsetY),n=0;n<e.children.length;n++)i=this.nameTable[this._getChild(e.children[n])],i.rotateAngle=i.rotateAngle?i.rotateAngle+e.rotateAngle:e.rotateAngle,i.rotateAngle%=360,i.rotateAngle<0&&(i.rotateAngle+=360),i.segments?(i.sourceNode||this._setEndPoint(i,ej.Matrix.transform(a,i.sourcePoint),!1),i.targetNode||this._setEndPoint(i,ej.Matrix.transform(a,i.targetPoint),!0)):("group"==i.type&&this._udpateChildRotateAngle(i),o=i.offsetX,t=i.offsetY,s=ej.Matrix.transform(a,ej.datavisualization.Diagram.Point(o,t)),this._translate(i,s.x-o,s.y-t,this.nameTable),this._updateAssociatedConnectorEnds(i,this.nameTable))},_getNodeDimension:function(e){var t,i,a,n,o=e._width,s=e._height,r=e.width?e.width:e.maxWidth?e.maxWidth:e.minWidth,l=document.createElement("span"),d=0,h=0;if(e.labels.length){for(ej.datavisualization.Diagram.Util.attr(l,{id:e.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(l),i=0;i<e.labels.length;i++)t=e.labels[i],t.bold&&(l.style.fontWeight="bold"),t.italic&&(l.style.fontStyle="italic"),l.style.textDecoration=t.textDecoration,l.style.fontFamily=t.fontFamily,l.style.fontSize=t.fontSize+"px",l.style.color=t.fontColor,l.style.backgroundColor=t.fillColor,l.style.borderColor=t.borderColor,l.style.borderWidth=t.borderWidth+"px",l.textContent=t.text,"nowrap"==t.wrapping?(l.style.whiteSpace="nowrap",l.style.wordWrap="normal"):("wrap"==t.wrapping&&(l.style.wordBreak="break-all"),l.style.wordWrap="break-word",l.style.whiteSpace="pre"),e.maxWidth&&(l.style.maxWidth=r-(t.margin.left+t.margin.right)-t.fontSize+"px"),e.minWidth&&(l.style.minWidth=r-(t.margin.left+t.margin.right)-t.fontSize+"px"),d+=l.offsetWidth+t.margin.left+t.margin.right+5,h+=l.offsetHeight+t.margin.top+t.margin.bottom;a=e.name.match("_attribute")?"attribute":e.name.match("_method")?"method":e.name.match("_member")?"member":"header",e._width=Math.max(e.minWidth||0,d||0),e.maxWidth&&(e._width=Math.min(e.maxWidth,e._width)),e._height=Math.max(e.minHeight||0,h||0),e.maxHeight&&(e._height=Math.min(e.maxHeight,e._height)),e.width||"left"!=e.labels[0].horizontalAlignment||"attribute"==a||"method"==a||"member"==a||(e.offsetX+=(e._width-o)/2),e.width||"right"!=e.labels[0].horizontalAlignment||(e.offsetX-=(e._width-o)/2),e.height||"top"!=e.labels[0].verticalAlignment||(e.offsetY+=(e._height-s)/2),e.height||"bottom"!=e.labels[0].verticalAlignment||(e.offsetY-=(e._height-s)/2),e.parent&&(n=this.nameTable[e.parent]),this.element[0].removeChild(l)}},_getMinMaxSize:function(e,t,i,a,n){var o,s,r,l,d,h,c=null,u=null;return t>=e.minWidth&&t<=e.maxWidth?c=t:"stretch"!=e.horizontalAlign||!e.parent||a||n?n?(s=this.nameTable[e.parent],s&&(r=ej.datavisualization.Diagram.Util.bounds(s),h=this._getMinMaxSize(s,r.width,r.height),c=h.width?h.width:t)):c=t<e.minWidth&&0!=e.minWidth?e.minWidth:t>e.maxWidth&&0!=e.maxWidth&&!e.isSwimlane?e.maxWidth:t:(s=this.nameTable[e.parent],s&&(r=ej.datavisualization.Diagram.Util.bounds(s),0==r.width&&0==r.height&&(r.width=t,r.height=i),h=this._getMinMaxSize(s,r.width,r.height),s.isSwimlane&&"vertical"==s.orientation&&(o=this.nameTable[this._getChild(s.children[0])],o&&(h.height-=o.height)),h.width-=s.paddingLeft+s.paddingRight+s.marginLeft+s.marginRight,h.height-=s.paddingTop+s.paddingBottom+s.marginTop+s.marginBottom,c=h.width?h.width:t)),i>=e.minHeight&&i<=e.maxHeight?u=i:(s=this.nameTable[e.parent],"stretch"!=e.verticalAlign||!e.parent||a||e.isLane?u=i<e.minHeight&&0!=e.minHeight?e.minHeight:i>e.maxHeight&&0!=e.maxHeight?e.maxHeight:i:(r=ej.datavisualization.Diagram.Util.bounds(s),0==r.width&&0==r.height&&(l=null,d=!1,r.width=e.minWidth,r.height=e.minHeight,(0==e.minWidth||0==e.minHeight)&&(r.width=t,r.height=i,l=!1,d=!0),d||(l=!0)),h=this._getMinMaxSize(s,r.width,r.height),h.width-=s.paddingLeft+s.paddingRight+s.marginLeft+s.marginRight,h.height-=s.paddingTop+s.paddingBottom+s.marginTop+s.marginBottom,l&&(h.height-=e.marginTop),u=h.height?h.height:i)),{width:c,height:u}},_updateConnectorBridging:function(e){var t,i,a=[];for(this.boundaryTable[e.name]=ej.datavisualization.Diagram.Util.bounds(e),e._intersects&&e._intersects.length&&(a=e._intersects),t=0;t<a.length;t++)i=this.nameTable[a[t]],i&&i.visible&&i.segments&&i!=e&&ej.datavisualization.Diagram.Util.canBridge(i,this)&&(ej.datavisualization.Diagram.Util.updateBridging(i,this,[e]),this._disableSegmentChange||ej.datavisualization.Diagram.DiagramContext._refreshOnlySegments(i,this))},_drawToolShape:function(e,t){"image"==e||"native"==e||"html"==e||"text"===e||"basic"===e||"flow"===e||"arrow"===e||"bpmn"===e||this.activeTool._isPolyline()?this.activateTool("shapeTool",t):"straightLine"==e?this.activateTool("straightLine",t):"orthogonalLine"==e?this.activateTool("orthogonalLine",t):"bezierLine"==e&&this.activateTool("bezierLine",t)},_destroy:function(){if(this.element.empty().removeClass("e-datavisualization-diagram"),this.enableContextMenu()){var e=$("#"+this.element[0].id+"_contextMenu").data("ejMenu");e.destroy()}$("#"+this.element[0].id+"_contextMenu").remove()},_updateRuler:function(e,t){var i={};e.interval&&(i.interval=e.interval),e.segmentWidth&&(i.segmentWidth=e.segmentWidth),e.tickAlignment&&(i.tickAlignment=e.tickAlignment),e.markerColor&&(i.markerColor=e.markerColor),e.thickness&&(i.thickness=e.thickness),e.arrangeTick&&(i.arrangeTick=e.arrangeTick),$.isEmptyObject(i)||$("#"+t[0].id).ejRuler(i)},_updateRulerSettings:function(e){this.updateViewPort(),(e.showRulers!=undefined||e.horizontalRuler&&e.horizontalRuler.thickness||e.verticalRuler&&e.verticalRuler.thickness)&&(this._svgParentDimention=null,this._initViews(!0),this._initCanvas(!0)),e.horizontalRuler&&this._updateRuler(e.horizontalRuler,this._hRuler),e.verticalRuler&&this._updateRuler(e.verticalRuler,this._vRuler),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,this._hScrollOffset,this._vScrollOffset)},_updateScrollSettings:function(e){var t,i,a,n,o=this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Limited,s=this.model.pageSettings.scrollableArea,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);(e.horizontalOffset!==undefined||e.verticalOffset!==undefined)&&(t={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:r},e.horizontalOffset!==undefined&&(i=Number("function"==typeof e.horizontalOffset?e.horizontalOffset():e.horizontalOffset),(!o||i>=s.x&&i<=s.x+s.width)&&("diagram"==this._scrollLimit()&&(i=Math.max(this._hScrollbar.model.minimum,i),i=Math.min(this._hScrollbar.model.maximum,i)),this._updateScrollOffset(i,this._verticalOffset()))),e.verticalOffset!==undefined&&(a=Number("function"==typeof e.verticalOffset?e.verticalOffset():e.verticalOffset),(!o||a>=s.y&&a<=s.y+s.height)&&("diagram"==this._scrollLimit()&&(a=Math.max(this._vScrollbar.model.minimum,a),a=Math.min(this._vScrollbar.model.maximum,a)),this._updateScrollOffset(this._horizontalOffset(),a))),n={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:r},this._raiseEvent("scrollChange",{newValues:n,oldValues:t})),e.zoomFactor&&this.zoomFactor("function"==typeof e.zoomFactor?e.zoomFactor():e.zoomFactor),e.padding&&($.extend(this.model.scrollSettings.padding,e.padding),this._updateScrollOffset(this._horizontalOffset(),this._verticalOffset()))},updatePageSettings:function(e){if(e){var t=$.extend(!0,{},this.model.pageSettings);e.pageHeight&&this._pageHeight(Number("function"==typeof e.pageHeight?e.pageHeight():e.pageHeight)),e.pageWidth&&this._pageWidth(Number("function"==typeof e.pageWidth?e.pageWidth():e.pageWidth)),("function"==typeof e.multiplePage||"boolean"==typeof e.multiplePage)&&this._multiplePage("function"==typeof e.multiplePage?e.multiplePage():e.multiplePage),("function"==typeof e.showPageBreak||"boolean"==typeof e.showPageBreak)&&this._showPageBreak("function"==typeof e.showPageBreak?e.showPageBreak():e.showPageBreak),(e.pageBorderColor||""===e.pageBorderColor)&&this._pageOrientation("function"==typeof e.pageOrientation?e.pageOrientation():e.pageOrientation),(e.pageBorderWidth||0===e.pageBorderWidth)&&this._pageBorderWidth(Number("function"==typeof e.pageBorderWidth?e.pageBorderWidth():e.pageBorderWidth)),(e.pageMargin||0===e.pageMargin)&&this._pageMargin(Number("function"==typeof e.pageMargin?e.pageMargin():e.pageMargin)),(e.pageBackgroundColor||""===e.pageBackgroundColor)&&this._pageBackgroundColor("function"==typeof e.pageBackgroundColor?e.pageBackgroundColor():e.pageBackgroundColor),e.scrollLimit&&this._scrollLimit("function"==typeof e.scrollLimit?e.scrollLimit():e.scrollLimit),e.scrollableArea&&(this.model.pageSettings.scrollableArea=e.scrollableArea),(e.pageBorderColor||""===e.pageBorderColor)&&this._pageBorderColor("function"==typeof e.pageBorderColor?e.pageBorderColor():e.pageBorderColor),this._compareModelProperty("pageSettings"),this._isUndo||this.addHistoryEntry({type:"pagesettingschanged",undoObject:t,category:"internal",redoObject:$.extend(!0,{},this.model.pageSettings)}),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this)}},_updateSnapSettings:function(e){e&&(e.horizontalGridLines&&e.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=e.horizontalGridLines.linesInterval),e.verticalGridLines&&e.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=e.verticalGridLines.linesInterval),e.snapAngle&&this._snapAngle(Number("function"==typeof e.snapAngle?e.snapAngle():e.snapAngle)),e.snapObjectDistance&&this._snapObjectDistance(Number("function"==typeof e.snapObjectDistance?e.snapObjectDistance():e.snapObjectDistance)))},_cloneObject:function(e){var t,i;if(("node"===this.getObjectType(e)||"connector"===this.getObjectType(e))&&"bpmn"!=e.type)return $.extend(!0,{},e);if(!("group"!==this.getObjectType(e)&&"bpmn"!==e.type||e.isSwimlane)){for(t=$.extend(!0,{},e),i=0;t.children&&t.children.length>0&&i<t.children.length;i++)t.children[i]=this._cloneObject(this.nameTable[this._getChild(t.children[i])]),t.children[i].parent=t.name;return t}return"group"===this.getObjectType(e)&&e.isSwimlane?this.getNode(e):void 0;
},_cloneSelectionList:function(){for(var e,t,i=[],a=0;a<this.selectionList.length;a++)if("pseudoGroup"===this.getObjectType(this.selectionList[a]))for(e=this.selectionList[0],t=0;e.children&&e.children.length>0&&t<e.children.length;t++)i.push(this._cloneObject(this.nameTable[this._getChild(e.children[t])]));else i.push(this._cloneObject(this.selectionList[a]));return i},getNode:function(e,t){return e?this._getNode(e,t):void 0},addPhase:function(e,t){this._addPhase(e,t)},stopEvents:function(e){this.activeTool.inAction&&!e.originalEvent.target&&e.target&&(e.originalEvent.target=e.target,this._mouseup(e))},_updateSwimlanePhase:function(e,t){var i,a;e&&t&&(t.label&&(i=this.nameTable[e.name],i&&(this._comparePropertyValues(e,"label",t),t.label=$.extend(!0,{},t.label),t.label.rotateAngle="vertical"===t.orientation?270:0,t.label.name=i.labels[0].name,t.label.mode=ej.datavisualization.Diagram.LabelEditMode.View,e.label=t.label,this.updateLabel(i.name,i.labels[0],e.label))),(t.lineColor||t.lineDashArray||t.lineWidth)&&(a={},t.lineColor&&(this._comparePropertyValues(e,"lineColor",t),e.lineColor=t.lineColor,a.stroke=t.lineColor),t.lineDashArray&&(this._comparePropertyValues(e,"lineDashArray",t),e.lineDashArray=t.lineDashArray,a["stroke-dasharray"]=t.lineDashArray),t.lineWidth&&(this._comparePropertyValues(e,"lineWidth",t),e.lineWidth=t.lineWidth,a["stroke-width"]=t.lineWidth),ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(e,a,this)),t.fillColor&&(this._comparePropertyValues(e,"fillColor",t),e.fillColor=t.fillColor,ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(e,this)))},_updateNodeVisibility:function(e,t){var i,a,n,o;if(e){if("group"===e.type)for(n=0;n<e.children.length;n++)i=this.nameTable[this._getChild(e.children[n])],i&&this._updateNodeVisibility(i,t);if(e.isSwimlane&&(a=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,e)))for(n=0;n<a.length;n++)o=this.nameTable[this._getChild(a[n])],o.visible=t.visible,ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(o,t,this);e.visible=t.visible}},_compareInnerProperties:function(e,t){var i,a=!0;if(e&&t)for(i in t)if("object"==typeof e[i]){if(a=this._compareInnerProperties(e[i],t[i]),!a)return!1}else if(e[i]!==t[i])return!1;return!0},_comparePropertyValues:function(e,t,i,a,n){var o,s;if(e){var r=null,l=e,d=i,h=t.split("."),c=h.length;if(c>1)for(o=0;c>o&&(l=l[h[o]],d=d[h[o]],o++,l&&d);)o==c-1&&l[h[o]]!=d[h[o]]&&(r={element:e,cause:n?n:a?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:h[0],oldValue:l,newValue:d},this._raisePropertyChange(r));else r={cause:n?n:a?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:t,oldValue:e[t],newValue:i[t]},"labels"===t||"ports"===t||"segments"===t||("object"!=typeof e[t]||this._compareInnerProperties(e[t],i[t]))&&e[t]&&("object"==typeof e[t]||e[t]==i[t])?"segments"===t?e[t]!=i[t]&&(r.element=e):("labels"===t||"ports"===t)&&e[t].length>0&&(s="ports"===t?this._findPort(e,i.name):this._findLabel(e,i.name),this._compareInnerProperties(s,i)||(r.element=s,r.oldValue=s,r.newValue=i)):r.element=e,r.element&&this._raisePropertyChange(r)}},updateNode:function(e,t){var i,a,n,o,s,r,l,d,h,c,u,g;if(e){var m,p,f,v,u=this._findNode(e),_=ej.Matrix.identity(),y=!1,b=ej.datavisualization.Diagram.NodeConstraints,x=u&&(u.isSwimlane||u.isLane||u.isPhase||"phase"===u.type);(x||!x)&&(this._needUpdate=!1,i=null,u&&((u.isSwimlane||u.isLane)&&t.header&&(a=t.header,delete t.header,this.model.historyManager.startGroupAction(),y=!0),this._isUndo||this._isSizingCommand||this._recordPropertiesChanged(u,t,"node"),t.pivot!=undefined&&(m=ej.datavisualization.Diagram.Util.bounds(u,!0),ej.Matrix.rotate(_,u.rotateAngle,u.offsetX,u.offsetY),t.pivot.x!==undefined&&(this._comparePropertyValues(u,"pivot.x",t),n=t.pivot.x-u.pivot.x,u.pivot.x=t.pivot.x,u.offsetX+=n*(u.width||u._width||0)),t.pivot.y!==undefined&&(this._comparePropertyValues(u,"pivot.y",t),o=t.pivot.y-u.pivot.y,u.pivot.y=t.pivot.y,u.offsetY+=o*(u.height||u._height||0)),v=ej.Matrix.transform(_,{x:u.offsetX,y:u.offsetY}),u.offsetX=v.x,u.offsetY=v.y),t.offsetX!=undefined&&(p=t.offsetX-u.offsetX,this._outOfBoundsOnNudge(u,p,0)&&(i={element:u,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetX",oldValue:u.offsetX,newValue:u.offsetX+p},this._raisePropertyChange(i),this._translate(u,p,0,this.nameTable),0!=u.marginLeft&&(u.marginLeft+=p))),t.offsetY!=undefined&&(f=t.offsetY-u.offsetY,this._outOfBoundsOnNudge(u,0,f)&&(i={element:u,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetY",oldValue:u.offsetY,newValue:u.offsetY+f},this._raisePropertyChange(i),this._translate(u,0,f,this.nameTable),0!=u.marginTop&&(u.marginTop+=f))),t.rotateAngle!=undefined&&(this._comparePropertyValues(u,"rotateAngle",t),this._rotate(u,t.rotateAngle-u.rotateAngle,this.nameTable)),u.isSwimlane||u.isLane?this._updateSwimlaneSize(u,t):(s=this.tools.resize,t.width!=undefined&&(u.width=u.width?u.width:1,i={element:u,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"width",oldValue:u.width,newValue:t.width},this._raisePropertyChange(i),r=!1,l=!!u.isLane,s._outOfBoundsDrag(u,t.width/u.width,1,new ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY))&&(this.scale(u,t.width/u.width,1,new ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY),this.nameTable,r,l),"bpmn"===u.type&&"group"===u._type&&ej.datavisualization.Diagram.Util._updateGroupBounds(u,this))),t.height!=undefined&&(u.height=u.height?u.height:1,i={element:u,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"height",oldValue:u.height,newValue:t.height},this._raisePropertyChange(i),r=!1,l=!!u.isLane,s._outOfBoundsDrag(u,1,t.height/u.height,new ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY))&&(this.scale(u,1,t.height/u.height,new ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY),this.nameTable,r,l),"bpmn"===u.type&&"group"===u._type&&ej.datavisualization.Diagram.Util._updateGroupBounds(u,this)))),t.connectorPadding!=undefined&&(this._comparePropertyValues(u,"connectorPadding",t),u.connectorPadding=t.connectorPadding,this.scale(u,1,1,new ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY),this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(u,"visible",t),this._updateNodeVisibility(u,t),t.visible||this._clearSelection()),t.constraints!=undefined&&(this._comparePropertyValues(u,"constraints",t),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(("group"!=u._type||"bpmn"===u.type)&&(u.constraints&b.Shadow||t.constraints&b.Shadow)&&(!(u.constraints&b.Shadow)&&t.constraints&b.Shadow?(u.constraints=t.constraints,"bpmn"===u.type&&u.children&&"group"!=u.shape?(ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(u,this),ej.datavisualization.Diagram.DiagramContext.renderShadow(this.nameTable[this._getChild(u.children[0])],this)):ej.datavisualization.Diagram.DiagramContext.renderShadow(u,this)):u.constraints&b.Shadow&&!(t.constraints&b.Shadow)&&(u.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(u,this))),u.constraints=t.constraints,this.selectionList[0]&&this.selectionList[0].name===u.name&&(ej.datavisualization.Diagram.Util.canSelect(this.selectionList[0])?(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"===this.selectionList[0].type,this._currZoom,this._adornerLayer,this)):this._clearSelection(!0)))),t.fillColor!=undefined&&(this._comparePropertyValues(u,"fillColor",t),u.fillColor=t.fillColor),t.cssClass!=undefined&&(this._comparePropertyValues(u,"cssClass",t),u.cssClass=t.cssClass),t.opacity!=undefined&&(this._comparePropertyValues(u,"opacity",t),u.opacity=t.opacity),t.borderColor!=undefined&&(this._comparePropertyValues(u,"borderColor",t),u.borderColor=t.borderColor),t.borderWidth!=undefined&&(this._comparePropertyValues(u,"borderWidth",t),u.borderWidth=t.borderWidth),t.borderDashArray!=undefined&&(this._comparePropertyValues(u,"borderDashArray",t),u.borderDashArray=t.borderDashArray),t.shadow!=undefined&&(this._comparePropertyValues(u,"shadow",t),"bpmn"===u.type&&u.children&&"group"!=u.shape?(u.children[0].shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,u.children[0].shadow,{},t.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(u.children[0],this)):(u.shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,u.shadow,{},t.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(u,this))),t.gradient!==undefined&&(this._comparePropertyValues(u,"gradient",t),u.gradient=null===t.gradient?t.gradient:t.gradient&&"radial"===t.gradient.type?ej.datavisualization.Diagram.RadialGradient(t.gradient):ej.datavisualization.Diagram.LinearGradient(t.gradient)),t.isExpanded!==undefined&&(this._comparePropertyValues(u,"isExpanded",t),u._updateExpander=!0,t.isExpanded?(u.isExpanded=!0,this._expandChildren(u)):(u.isExpanded=!1,this._collapseChildren(u)),this._selectionContains(u)&&(d=!0,this._clearSelection(!0)),this.layout(),d&&this._addSelection(u,!0)),t.tooltip!==undefined&&(this._comparePropertyValues(u,"tooltip",t),u.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,u.tooltip,{},t.tooltip))),t.excludeFromLayout!=undefined&&(this._comparePropertyValues(u,"excludeFromLayout",t),u.excludeFromLayout=t.excludeFromLayout,this.layout()),t.addInfo!=undefined&&(this._comparePropertyValues(u,"addInfo",t),u.addInfo=t.addInfo),t.maxWidth!=undefined&&(this._comparePropertyValues(u,"maxWidth",t),u.maxWidth=t.maxWidth),t.maxHeight!=undefined&&(this._comparePropertyValues(u,"maxHeight",t),u.maxHeight=t.maxHeight),u=this._findNode(e),t.shape&&"object"==typeof t.shape&&(this._comparePropertyValues(u,"shape",t),ej.datavisualization.Diagram.Util._updateShapeProperties(t),"html"==u.type&&(h=document.getElementById(u.name+"_parentdiv"),h.parentNode.removeChild(h)),ej.datavisualization.Diagram.DiagramContext.setNodeShape(u,this)),"node"==this.getObjectType(u)&&(u=this._updateShape(u,t)),u&&"phase"!=u.type&&(ej.datavisualization.Diagram.DiagramContext.update(u,this),"bpmn"==u.type?ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(u,this):ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(u,this)),this.selectionList[0]&&this.selectionList[0].name===u.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(u,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints))),e&&(t&&t.pathData&&(c=u._absolutePath),u=this._findNode(e),c&&(u._absolutePath=c,u._absoluteBounds=null),u&&"node"===u._type&&t&&"group"===t.type&&t.children&&t.children.length>0&&(g=!1,this._svg.document.getElementById(u.name)&&(g=!0),this.remove(u),u.borderColor="transparent",u.borderDashArray="",u.borderWidth=1,u.fillColor="#1BA0E2",u.labels=[],u.fillColor="",u.type=t.type,u.children=t.children,u=ej.datavisualization.Diagram.Group(u),this._initGroupNode(u),g&&(ej.datavisualization.Diagram.Util._updateGroupBounds(u,this),this.add(u)))),u&&(u.isLane||u.isSwimlane||"phase"===u.type||u.isPhase)&&(this._needUpdate=!0,t.header=a,u.isLane?this._updateLane(u,t):u.isSwimlane?(this._needUpdate=!1,this._updateSwimlane(u,t,!0)):("phase"===u.type||u.phase)&&(this._needUpdate=!1,this._updateSwimlanePhase(u,t))),y&&this.model.historyManager.closeGroupAction()}},_updateSwimlaneSize:function(e,t){var i,a,n,o,s,r;if(e)if(t.height&&(this._comparePropertyValues(e,"height",t),i=t.height-e.height,this._comparePropertyValues(e,"offsetY",{offsetY:e.offsetY+i/2})),t.width&&(this._comparePropertyValues(e,"width",t),i=t.width-e.width,this._comparePropertyValues(e,"offsetX",{offsetX:e.offsetX+i/2})),e.isSwimlane&&(t.height||t.width)){if(o=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,e),o.length>0&&(a=this.nameTable[this._getChild(o[o.length-1])])){if("vertical"===e.orientation){if(t.width&&t.width>e.width&&(a.minWidth=a.width+t.width-e.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a,!0)),t.height)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],t.height>=e.height&&(r.minHeight=t.height)}else{if(t.width)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],t.width>=e.width&&(r.minWidth=t.width);t.height&&t.height>e.height&&(a.minHeight=a.height+t.height-e.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a,!0))}ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,e)}}else if(e.isLane&&(t.height||t.width)){if(n=this.nameTable[e.parent.split("laneStack")[0]],o=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,n),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),n&&"vertical"===n.orientation){if(t.width&&(t.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0)),t.height)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],t.height>=r.height&&(r.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0))}else{if(t.width)for(s=0;s<o.length;s++)r=this.nameTable[this._getChild(o[s])],t.width>=r.width&&(r.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0));t.height&&(t.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0))}ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,n)}},_updateShape:function(e,t){var i,a,n,o=!1;return t.type&&(this._comparePropertyValues(e,"type",t),e.type=e._shape=t.type,o=!0),t.shape&&(this._comparePropertyValues(e,"shape",t),e.shape=e._shape=t.shape,o=!0),"bpmn"!=e.type?(t.cornerRadius!=undefined&&(this._comparePropertyValues(e,"cornerRadius",t),e.cornerRadius=t.cornerRadius,o=!0),t.pathData&&(this._comparePropertyValues(e,"pathData",t),e.pathData=t.pathData,o=!0),t.templateId!==undefined&&(e.templateId=t.templateId,o=!0),t.html!==undefined&&(this._comparePropertyValues(e,"html",t),e.html=t.html,o=!0),t.contentId!==undefined&&(this._comparePropertyValues(e,"contentId",t),e.contentId=t.contentId,o=!0),t.source&&(this._comparePropertyValues(e,"source",t),e.source=t.source,o=!0),t.textBlock&&(this._comparePropertyValues(e,"textBlock",t),e.textBlock=t.textBlock,o=!0),t.points&&(this._comparePropertyValues(e,"points",t),e.points=t.points,o=!0),o&&(e.children&&delete e.children,e=ej.datavisualization.Diagram.NodeType(e,this),i=document.getElementById(e.name+"_parentdiv"),i&&i.parentNode.removeChild(i),ej.datavisualization.Diagram.DiagramContext.setNodeShape(e,this),this._clearSelection(!0),this._addSelection(e,!0))):(a=$.extend(!0,{},this.nameTable[e.name]),t.event&&(this._comparePropertyValues(e,"event",t),a.event=t.event,o=!0),t.trigger&&(this._comparePropertyValues(e,"trigger",t),a.trigger=t.trigger,o=!0),t.gateway&&(this._comparePropertyValues(e,"gateway",t),a.gateway=t.gateway,o=!0),t.data&&(this._comparePropertyValues(e,"data",t),a.data=$.extend(a.data,t.data),o=!0),t.activity&&(this._comparePropertyValues(e,"activity",t),a.activity=t.activity,o=!0),t.task!==undefined&&(this._comparePropertyValues(e,"task",t),a.task=$.extend(a.task,t.task),o=!0),t.annotation!==undefined&&(this._comparePropertyValues(e,"annotation",t),a.annotation=$.extend(a.annotation,t.annotation),o=!0),t.subProcess!==undefined&&(this._comparePropertyValues(e,"subProcess",t),a.subProcess=$.extend(a.subProcess,t.subProcess),o=!0),t.direction&&(this._comparePropertyValues(e,"direction",t),a.direction=t.direction,o=!0),o&&(n=this._svg.getElementById(e.name).nextSibling,this._removeElement(e),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[e.name],e),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[e.name]),this._nodes=$.extend(!0,[],this.nodes()),e=ej.datavisualization.Diagram.NodeType(a,this),e="bpmn"==e.type&&e.container?ej.datavisualization.Diagram.ContainerHelper._initContainer(this,e):this._getNewGroup(e),this._initGroupNode(e),this.nameTable[e.name]=e,this.nodes().push(e),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(e),ej.datavisualization.Diagram.DiagramContext.renderGroup(e,this),n&&this._svg.getElementById(e.name).parentNode.insertBefore(this._svg.getElementById(e.name),this._svg.getElementById(n.id)),this._clearSelection(!0),this._addSelection(e,!0))),e},_updateObject:function(e){var t,i,a,n;if(e)if("pseudoGroup"==e.type)for(i=this._getChildren(e.children),a=0,n=i.length;n>a;a++)t=this.nameTable[this._getChild(i[a])],ej.datavisualization.Diagram.DiagramContext.update(t,this);else e.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[e.parent],this),ej.datavisualization.Diagram.DiagramContext.update(e,this)},_udatePhaseSize:function(e,t){var i,a,n,o,s,r,l,d=this.nameTable[this._getChild(e.children[1])];if("vertical"===e.orientation){if(d.minWidth!=t.phaseSize){if(d.width=d.maxWidth,d.minWidth=t.phaseSize,i=d.maxWidth-t.phaseSize,a=t.phaseSize/d.maxWidth,d.maxWidth=t.phaseSize,this.scale(d,a,1e-4,ej.datavisualization.Diagram.Point(d.offsetX,d.offsetY),this.nameTable),d.children&&d.children.length>0)for(s=0;s<d.children.length;s++)r=this.nameTable[this._getChild(d.children[s])],r&&this.scale(r,a,1e-4,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);l=this.nameTable[this._getChild(e.children[2])],l.marginLeft-=i}}else if("horizontal"===e.orientation&&d.minHeight!=t.phaseSize){if(d.height=d.maxHeight,d.minHeight=t.phaseSize,n=d.maxHeight-t.phaseSize,o=t.phaseSize/d.maxHeight,o=o===1/0?0:o,d.maxHeight=t.phaseSize,this.scale(d,1e-4,o,ej.datavisualization.Diagram.Point(d.offsetX,d.offsetY),this.nameTable),d.children&&d.children.length>0)for(s=0;s<d.children.length;s++)r=this.nameTable[this._getChild(d.children[s])],r&&this.scale(r,1e-4,o,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);l=this.nameTable[this._getChild(e.children[2])],l.marginTop-=n}},_updateLane:function(e,t){var i,a,n,o;e&&t&&(t.header&&(this._comparePropertyValues(this.getNode(e.name),"header",t),e.children&&e.children.length>0&&(i=this._getChild(e.children[0]),i&&(a=this.nameTable[i]),a&&(this.updateLabel(a.name,a.labels[0],t.header),t.header.fillColor&&t.header.fillColor!=a.fillColor&&this.updateNode(a.name,{fillColor:t.header.fillColor})))),t.fillColor&&t.fillColor!=e.fillColor&&(this._comparePropertyValues(e,"fillColor",t),this.updateNode(e.name,{fillColor:t.fillColor})),(t.minHeight&&t.minHeight!=e.minHeight||t.minWidth&&t.minWidth!=e.minWidth)&&(t.minHeight&&(this._comparePropertyValues(e,"minHeight",t),e.minHeight=t.minHeight),t.minWidth&&(this._comparePropertyValues(e,"minWidth",t),e.minWidth=t.minWidth),n=this.nameTable[e.parent],n&&(o=this.nameTable[n.parent],o&&ej.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(this,o)),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,o),ej.datavisualization.Diagram.SvgContext.updateSelector(o,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)),t.constraints&&t.constraints!=e.constraints&&(this._comparePropertyValues(e,"constraints",t),e.constraints=t.constraints))},_updateLastPhase:function(e,t,i){var a,n,o,s;e.isSwimlane&&e.phases&&1==e.phases.length&&(a=0,n=this.nameTable[this._getChild(e.phases[0])],"horizontal"===e.orientation?(n.offset=e.minWidth-a,this.updateNode(this.nameTable["phaseStack"+this._getChild(e.phases[0])].name,{width:e.minWidth-a}),i&&(s=ej.datavisualization.Diagram.Util.bounds(e),this.updateNode(this.nameTable["phaseStack"+this._getChild(e.phases[0])].name,{offsetX:s.x+e.width/2}))):"vertical"===e.orientation&&(n.offset=e.minHeight-a,o=n.offset-a,o-=t.header?t.header.height:50,this.updateNode(this.nameTable["phaseStack"+this._getChild(e.phases[0])].name,{height:o}),i&&(s=ej.datavisualization.Diagram.Util.bounds(e),this.updateNode(this.nameTable["phaseStack"+this._getChild(e.phases[0])].name,{offsetY:(t.header?t.header.height:50)/2+s.y+e.height/2}))))},_updateSwimlane:function(e,t,i){var a,n,o,s,r,l,d,h,c,u;t.header&&e.children&&e.children.length>0&&(a=this._getChild(e.children[0]),a&&(n=this.nameTable[a]),n&&(this._comparePropertyValues(this.getNode(e.name),"header",t),this.updateLabel(n.name,n.labels[0],t.header),t.header.fillColor&&t.header.fillColor!=n.fillColor&&this.updateNode(n.name,{fillColor:t.header.fillColor})));for(o in t)e[o]&&t[o]!==e[o]&&("offsetX"===o?(this._comparePropertyValues(this.getNode(e.name),"offsetX",t),s=t.offsetX-e.offsetX,this._outOfBoundsOnNudge(e,s,0)&&this._translate(e,s,0,this.nameTable)):"offsetY"===o?(this._comparePropertyValues(this.getNode(e.name),"offsetY",t),r=t.offsetY-e.offsetY,this._outOfBoundsOnNudge(e,0,r)&&this._translate(e,0,r,this.nameTable)):"minWidth"!==o&&"minHeight"!==o&&"maxwidth"!==o&&"maxHeight"!==o&&"width"!=o&&"height"!=o&&"phaseSize"!=o&&(e[o]=t[o]));if(t.phases&&t.phases.length>0)for(c=0;c<t.phases.length;c++)l=this.nameTable[this._getChild(t.phases[c])],l&&this._updateSwimlanePhase(l,t.phases[c],!0);if(i&&(t.phaseSize||0===t.phaseSize)&&t.phaseSize!==e.phaseSize){this._comparePropertyValues(this.getNode(e.name),"phaseSize",t),t.phaseSize!=e.phaseSize&&(d=!0);var l,g=this.nameTable[e.name+"phaseStack"],m=this.nameTable[e.name+"laneStack"],p=t.phaseSize-e.phaseSize;for(c=0;c<g.children.length;c++)l=this.nameTable[this._getChild(g.children[c])],l&&(t.phaseSize=0===t.phaseSize?1e-4:t.phaseSize,"horizontal"===e.orientation?l.height=t.phaseSize:l.width=t.phaseSize);e.phaseSize+=p,"horizontal"===e.orientation?m.marginTop+=p:m.marginLeft+=p,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,g,null,e)}if(t.lanes&&t.lanes.length>0)for(c=0;c<t.lanes.length;c++)h=this.nameTable[this._getChild(t.lanes[c])],h&&this._updateLane(h,t.lanes[c]);i||(t&&t.phaseSize&&(u=!1),t.minHeight&&t.minHeight!=e.minHeight&&(this._comparePropertyValues(this.getNode(e.name),"minHeight",t),e.minHeight=t.minHeight,u=!0),t.minWidth&&t.minWidth!=e.minWidth&&(this._comparePropertyValues(this.getNode(e.name),"minWidth",t),e.minWidth=t.minWidth,u=!0),t.maxHeight&&t.maxHeight!=e.maxHeight&&(this._comparePropertyValues(this.getNode(e.name),"maxHeight",t),e.minHeight=t.maxHeight,u=!0),t.maxWidth&&t.maxWidth!=e.maxWidth&&(this._comparePropertyValues(this.getNode(e.name),"maxWidth",t),e.minWidth=t.maxWidth,u=!0),u&&!this._isUndo&&this._updateLastPhase(e,t),(t.phaseSize||0===t.phaseSize)&&t.phaseSize!=e.phaseSize&&(this._comparePropertyValues(this.getNode(e.name),"phaseSize",t),this._udatePhaseSize(e,t),0===t.phaseSize&&(e.phaseSize=0))),ej.datavisualization.Diagram.DiagramContext.update(e,this),this.selectionList[0]&&this.selectionList[0].name===e.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(e,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},updateConnector:function(e,t){var i,a,n,o,s,r;if(e&&(i=this._findConnector(e))){if(this._isUndo||this._recordPropertiesChanged(i,t,"connector"),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t.constraints!==undefined&&(this._comparePropertyValues(i,"constraints",t),i.constraints=t.constraints,!ej.datavisualization.Diagram.Util.canSelect(i)&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&this._clearSelection(!0)),t.lineColor&&(this._comparePropertyValues(i,"lineColor",t),i.lineColor=t.lineColor),(t.cssClass||""===t.cssClass)&&(this._comparePropertyValues(i,"cssClass",t),i.cssClass=t.cssClass),(t.lineWidth||0===t.lineWidth)&&(this._comparePropertyValues(i,"lineWidth",t),i.lineWidth=t.lineWidth),t.lineDashArray!==undefined&&(this._comparePropertyValues(i,"lineDashArray",t),i.lineDashArray=t.lineDashArray),i.shape&&"umlclassifier"==i.shape.type&&t.shape&&t.shape.multiplicity!=undefined)for(i.shape.multiplicity=t.shape.multiplicity,i.shape.multiplicity=ej.datavisualization.Diagram.UMLConnectorMultiplicity(i.shape.multiplicity),a=ej.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),n=0;n<i.labels.length;n++)i.labels[n].name==i.name+"_sourcelabel"?i.labels[n].text=a[0].text:i.labels[n].name==i.name+"_targetlabel"&&(i.labels[n].text=a[1].text);if(t.opacity!==undefined&&(this._comparePropertyValues(i,"opacity",t),i.opacity=t.opacity),t.cornerRadius!==undefined&&(this._comparePropertyValues(i,"cornerRadius",t),i.cornerRadius=t.cornerRadius),t.lineHitPadding!==undefined&&(this._comparePropertyValues(i,"lineHitPadding",t),i.lineHitPadding=t.lineHitPadding),t.sourcePadding!=undefined&&(this._comparePropertyValues(i,"sourcePadding",t),i.sourcePadding=t.sourcePadding,this._dock(i,this.nameTable)),t.targetPadding!=undefined&&(this._comparePropertyValues(i,"targetPadding",t),i.targetPadding=t.targetPadding,this._dock(i,this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(i,"visible",t),i.visible=t.visible,t.visible||this._clearSelection()),t.bridgeSpace!=undefined&&(this._comparePropertyValues(i,"bridgeSpace",t),i.bridgeSpace=t.bridgeSpace),t.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",t),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},t.tooltip))),t.segments&&(this._comparePropertyValues(i,"segments",t),t.segments.length>1?(o=$.extend(!0,[],t.segments),i.segments=o):i.segments=t.segments,ej.datavisualization.Diagram.Util._initConnectionEnds(i,this),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments.length&&(s=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,s),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),i==this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSegments(this._adornerSvg),ej.datavisualization.Diagram.SvgContext.addSegments(this._adornerSvg,this.selectionList[0],this._currZoom))),t.targetDecorator&&(this._comparePropertyValues(i,"targetDecorator",t),r=i.targetDecorator?$.extend(!0,{},i.targetDecorator,t.targetDecorator):ej.datavisualization.Diagram.Decorator(t.targetDecorator),i.targetDecorator=r),t.sourceDecorator&&(this._comparePropertyValues(i,"sourceDecorator",t),r=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,t.sourceDecorator):ej.datavisualization.Diagram.Decorator(t.sourceDecorator),i.sourceDecorator=r),(t.sourceDecorator||t.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),t.hasOwnProperty("sourceNode")||t.hasOwnProperty("targetNode")||t.hasOwnProperty("targetPort")||t.hasOwnProperty("sourcePort")||t.hasOwnProperty("targetPoint")||t.hasOwnProperty("sourcePoint")){if(t.sourceNode!==undefined){this._comparePropertyValues(i,"sourceNode",t);var l=this.nameTable[i.sourceNode],d=this.nameTable[t.sourceNode],h=this.nameTable[i.targetNode],c=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(d,h,i,this);t.sourceNode=c?c.name:null,l&&-1!=l.outEdges.indexOf(i.name)&&ej.datavisualization.Diagram.Util.removeItem(l.outEdges,i.name),i.sourceNode=t.sourceNode}if(t.targetNode!==undefined){this._comparePropertyValues(i,"targetNode",t);var d=this.nameTable[i.sourceNode],h=this.nameTable[t.targetNode],l=this.nameTable[i.targetNode],c=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(h,d,i,this);t.targetNode=c?c.name:null,l&&-1!=l.inEdges.indexOf(i.name)&&ej.datavisualization.Diagram.Util.removeItem(l.inEdges,i.name),i.targetNode=t.targetNode}t.targetPort!==undefined&&(this._comparePropertyValues(i,"targetPort",t),i.targetPort=t.targetPort),t.sourcePort!==undefined&&(this._comparePropertyValues(i,"sourcePort",t),i.sourcePort=t.sourcePort),t.targetPoint!==undefined&&(this._comparePropertyValues(i,"targetPoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.targetPoint,!0)),t.sourcePoint!==undefined&&(this._comparePropertyValues(i,"sourcePoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.sourcePoint,!1)),this._updateEdges(i),this._dock(i,this.nameTable)}ej.datavisualization.Diagram.Util.updateBridging(i,this),this._svg&&(this._updateConnectorBridging(i),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},_updateDrawType:function(e){var t,i,a,n,o=!1,s=e.tool;if(s&ej.datavisualization.Diagram.Tool.ContinuesDraw?o=!1:s&ej.datavisualization.Diagram.Tool.DrawOnce&&(o=!0),a=e.drawType?e.drawType:this.model.drawType)if("connector"!==a.type||this.activeTool._isPolyline()){if("text"===a.type)this.activateTool("text",o);else if(a.type||a.shape){t=a.shape?a.shape:a.type,"basic"==a.type?i=ej.datavisualization.Diagram.BasicShapes:"flow"==a.type?i=ej.datavisualization.Diagram.FlowShapes:"arrow"==a.type?i=ej.datavisualization.Diagram.ArrowShapes:"bpmn"==a.type&&(i=ej.datavisualization.Diagram.BPMNShapes);for(n in i)if(i[n]==a.shape){t=a.type;break}t&&this._drawToolShape(t,o)}}else{var r=this.model.defaultSettings.connector,l=r&&r.segments&&r.segments.length?r.segments[0].type:"",d=a.segments&&a.segments.length&&a.segments[0].type?a.segments[0].type:l;"bezier"===d||"bezierLine"===this.model.connectorType?this.activateTool("bezierLine",o):"orthogonal"===d||"orthogonalLine"===this.model.connectorType?this.activateTool("orthogonalLine",o):("straight"===d||"straightLine"===this.model.connectorType)&&this.activateTool("straightLine",o)}},update:function(e){var t,i,a,n,o;if(e.scrollSettings&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Unknown,this._setModel({scrollSettings:e.scrollSettings})),e.backgroundColor&&this._setModel({backgroundColor:e.backgroundColor}),e.tool&&(this.activeTool._showAllPorts(!0),t=e.tool,this.tool(t),this._compareModelProperty("tool"),t&ej.datavisualization.Diagram.Tool.ContinuesDraw||t&ej.datavisualization.Diagram.Tool.DrawOnce?this._updateDrawType(e):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select",!1)),e.bridgeDirection)for(this.bridgeDirection("function"==typeof e.bridgeDirection?e.bridgeDirection():e.bridgeDirection),this._compareModelProperty("bridgeDirection"),i=this.connectors(),a=0,n=i.length;n>a;a++)o=i[a],o&&ej.datavisualization.Diagram.Util.canBridge(o,this)&&(ej.datavisualization.Diagram.Util.updateBridging(o,this),ej.datavisualization.Diagram.DiagramContext.update(o,this));e.rulerSettings&&this._setModel({scrollSettings:e.scrollSettings})},bringToCenter:function(e){var t=this._currZoom,i=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),a={x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t},n=a.x+a.width/2-i.width/2,o=a.y+a.height/2-i.height/2;ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-n,this._vScrollOffset-o,null,!1)},bringIntoView:function(e){var t,i=0,a=0,n=this._currZoom;
e.right=e.right?e.right:e.x+e.width,e.bottom=e.bottom?e.bottom:e.y+e.height;var o=this._hScrollOffset,s=this._vScrollOffset,r=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);e={x:e.x*n,y:e.y*n,width:e.width*n,height:e.height*n,right:e.right*n,bottom:e.bottom*n},t={x:this._hScrollOffset,y:this._vScrollOffset,width:r.width,height:r.height},ej.datavisualization.Diagram.Geometry.containsRect(t,e)||(e.right>-o+r.width&&(i=e.right-r.width),e.x<-o&&(i=e.x),e.bottom>-s+r.height&&(a=e.bottom-r.height),e.y<-s&&(a=e.y),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-i,this._vScrollOffset-a,null,!1))},getBridgeSegment:function(e,t,i,a,n){return"A "+a/2+" "+a/2+"  "+i+" , 1 "+n+" "+t.x+","+t.y},fitToPage:function(e,t,i,a){var n,o,s,r,l,d,h,c,u,g={},m=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);if(i=i||{},i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right},t=t?t:"pageSettings","pageSettings"==t&&this.model.pageSettings.pageWidth&&this.model.pageSettings.pageHeight||this.nodes().length>0||this.connectors().length>0){switch(e=e?e:"page","custom"!=t&&(s=this._getDigramBounds(t),s.x-=this.model.scrollSettings.padding.left,s.y-=this.model.scrollSettings.padding.top,s.width+=this.model.scrollSettings.padding.left+this.model.scrollSettings.padding.right,s.height+=this.model.scrollSettings.padding.top+this.model.scrollSettings.padding.bottom),r=s.width,l=s.height,g.x=(m.width-(i.left+i.right))/r,g.y=(m.height-(i.top+i.bottom))/l,a||this._vScrollbar&&this._vScrollbar._scrollData||this._hScrollbar&&this._hScrollbar._scrollData||(g.x=Math.min(1,g.x),g.y=Math.min(1,g.y)),d=this._hScrollOffset,h=this._vScrollOffset,e){case"width":n=g.x,o=n/this._getCurrentZoom(),c=(m.width-("content"!=t?s.width:r)*n)/2-s.x*n,d+=c+(i.left-i.right)/2*n,h-=this._vScrollOffset*o,h="custom"!=t?h:h+this._vScrollOffset*o;break;case"height":n=g.y,o=n/this._getCurrentZoom(),c=(m.width-("content"!=t?s.width:r)*n)/2-s.x*n,u=(m.height-("content"!=t?s.height:l)*n)/2-s.y*n,d+=c+(i.left-i.right)/2*n,h+=u+(i.top-i.bottom)/2*n;break;case"page":n=Math.min(g.x,g.y),o=n/this._getCurrentZoom(),c=(m.width-("content"!=t?s.width:r)*n)/2-s.x*n,u=(m.height-("content"!=t?s.height:l)*n)/2-s.y*n,d+=c+(i.left-i.right)/2*n,h+=u+(i.top-i.bottom)/2*n}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,d,h,new ej.datavisualization.Diagram.Point(0,0),!0)}else o=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,o,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},_convertImagesToBuffer:function(e){for(var t,i,a=[],n=0;n<e.length;n++){t=e[n],t=t.replace(/^data:[a-z]*;,/,"");var o=t.split(","),s=atob(o[1]),r=new ArrayBuffer(s.length),l=new Uint8Array(r);for(i=0;i<s.length;i++)l[i]=s.charCodeAt(i);a.push(r)}return a},_downloadImage:function(e,t,i,a){var n,o,s,r,l,d,h=ej.browserInfo();if("msie"===h.name&&parseFloat(h.version)<10||"webkit"==h.name)return n="webkit"==h.name?"Safari":"IE-9",alert("Downloading option is not supported in "+n+", Please use the returned data"),a;for(o=0;o<e.length;o++)s=new Blob([e[o]],{type:"application/octet-stream"}),"msie"===h.name||"edge"===h.name?window.navigator.msSaveOrOpenBlob(s,t+"."+i):(r=document.createElement("a"),l=URL.createObjectURL(s),r.href=l,r.setAttribute("download",t+"."+i),document.createEvent?(d=document.createEvent("MouseEvents"),d.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(d)):r.fireEvent&&r.fireEvent("onclick"))},exportImage:function(e,t){var i,a,n,o,s,r;t=ej.datavisualization.Diagram.ExportSettings(t),i=t&&t.region?t.region:"content",a=t.margin||{},a={top:isNaN(a.top)?25:a.top,bottom:isNaN(a.bottom)?25:a.bottom,left:isNaN(a.left)?25:a.left,right:isNaN(a.right)?25:a.right},n=this._getDigramBounds(i),t.bounds&&(n={x:isNaN(t.bounds.x)?n.x:t.bounds.x,y:isNaN(t.bounds.y)?n.y:t.bounds.y,width:t.bounds.width||n.width,height:t.bounds.height||n.height}),o=document.createElement("img"),s={src:e},ej.datavisualization.Diagram.Util.attr(o,s),r=this,o.onload=function(){var i,o,s,l,d,h,c,u,g=new ej.datavisualization.Diagram.Canvas({width:n.width+(a.left+a.right),height:n.height+(a.top+a.bottom)}),m=g.document.getContext("2d");return m.fillStyle=r._pageBackgroundColor(),m.fillRect(0,0,n.width+(a.left+a.right),n.height+(a.top+a.bottom)),m.drawImage(this,n.x,n.y,n.width,n.height,a.left,a.top,n.width,n.height),e=g.document.toDataURL(),t.printOptions?void r._raisePrintAction(e,t.printOptions):(m.restore(),i=t.fileName||"diagram",o=t.format||"jpg",void(t.multiplePage?(t.pageHeight=t.pageHeight?t.pageHeight:r.model.pageSettings.pageHeight,t.pageWidth=t.pageWidth?t.pageWidth:r.model.pageSettings.pageWidth,t.pageHeight=t.pageHeight?t.pageHeight:g.width,t.pageWidth=t.pageWidth?t.pageWidth:g.height,t.pageOrientation=r.model.pageSettings.pageOrientation||t.pageOrientation,a=t.margin||{},s=!1,t.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?t.pageHeight>t.pageWidth&&(s=!0):t.pageWidth>t.pageHeight&&(s=!0),s&&(l=t.pageWidth,t.pageWidth=t.pageHeight,t.pageHeight=l),t.margin={top:isNaN(a.top)?0:a.top,bottom:isNaN(a.bottom)?0:a.bottom,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right},d=document.createElement("img"),h={id:r.element[0].id+"_printImage",src:e},ej.datavisualization.Diagram.Util.attr(d,h),d.onload=function(){var e=r._getMultipleImage(d,t,!0),a=r._convertImagesToBuffer(e);r._downloadImage(a,i,o,e)}):(c=[e],u=r._convertImagesToBuffer(c),r._downloadImage(u,i,o,c))))}},exportDiagram:function(e){var t,i,a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C;e=ej.datavisualization.Diagram.ExportSettings(e),n=[],e||(e={});var w=e&&e.region?e.region:"content",z=e&&e.mode?e.mode:"download",S=e.margin||{};if(S={top:isNaN(S.top)?25:S.top,bottom:isNaN(S.bottom)?25:S.bottom,left:isNaN(S.left)?25:S.left,right:isNaN(S.right)?25:S.right},o=this._getDigramBounds(w),e.bounds&&(i=!0,o={x:isNaN(e.bounds.x)?o.x:e.bounds.x,y:isNaN(e.bounds.y)?o.y:e.bounds.y,width:e.bounds.width||o.width,height:e.bounds.height||o.height}),!e.bounds)for(s=this.nodes(),r=0;r<s.length;r++)for(l=s[r],d=l.labels,h=0;h<d.length;h++)c=d[h],c.visible&&(u=ej.datavisualization.Diagram.Util.getLabelbounds(this,l,c)),u&&(o=this._union(u,o));if(o.x-=S.left,o.y-=S.top,o.width+=S.left+S.right,o.height+=S.top+S.bottom,g=e.fileName||"diagram","svg"!=e.format){if(this._setScaleValueforCanvas(e,o),m=this._diagramAsCanvas({bounds:o,margin:S,region:w,scaleX:e._scaleX,scaleY:e._scaleY},i),t=e.format||"jpg",p=a=m.toDataURL(),"data"==z)return a;"msie"===ej.browserInfo().name&&parseFloat(ej.browserInfo().version)<10||(e.multiplePage?(e.pageHeight=e.pageHeight?e.pageHeight:this.model.pageSettings.pageHeight,e.pageWidth=e.pageWidth?e.pageWidth:this.model.pageSettings.pageWidth,e.pageHeight=e.pageHeight?e.pageHeight:m.width,e.pageWidth=e.pageWidth?e.pageWidth:m.height,e.pageOrientation=this.model.pageSettings.pageOrientation||e.pageOrientation,S=e.margin||{},f=!1,e.pageOrientation==ej.datavisualization.Diagram.PageOrientations.Landscape?e.pageHeight>e.pageWidth&&(f=!0):e.pageWidth>e.pageHeight&&(f=!0),f&&(v=e.pageWidth,e.pageWidth=e.pageHeight,e.pageHeight=v),e.margin={top:isNaN(S.top)?0:S.top,bottom:isNaN(S.bottom)?0:S.bottom,left:isNaN(S.left)?0:S.left,right:isNaN(S.right)?0:S.right},_=document.createElement("img"),y={id:this.element[0].id+"_printImage",src:p},ej.datavisualization.Diagram.Util.attr(_,y),b=this,_.onload=function(){var i=b._getMultipleImage(_,e,!0);n=b._convertImagesToBuffer(i),b._downloadImage(n,g,t,a)}):(x=[p],n=this._convertImagesToBuffer(x)))}else{if(t=e.format||"svg",D=a=this._diagramAsSvg({bounds:o,margin:S}),"data"==z)return a;"msie"===ej.browserInfo().name&&parseFloat(ej.browserInfo().version)<10||(C=(new XMLSerializer).serializeToString(D),n.push(C))}"download"==z&&this._downloadImage(n,g,t,a)},_diagramAsSvg:function(e){var t,i,a,n,o,s,r,l,d=new ej.datavisualization.Diagram.Svg({id:"diagram_svg",width:e.bounds.width,height:e.bounds.height});document.body.appendChild(d.document),t=this._svg.document.getElementById(this._canvas.id+"_pageBackground"),t=$(t).find("#pageback")[0],t=t.cloneNode(!0);var h=this._getDigramBounds(),c=h.x,u=h.y,g=h.width,m=h.height;for(d.appendChild(t),t.setAttribute("transform","translate("+-e.bounds.x+", "+-e.bounds.y+")"),t.setAttribute("x",c),t.setAttribute("y",u),t.setAttribute("width",g),t.setAttribute("height",m),t=this._svg.document.getElementById(this._canvas.id+"_diagramLayer"),t=t.cloneNode(!0),d.appendChild(t),t.setAttribute("transform","translate("+-e.bounds.x+", "+-e.bounds.y+")"),i=this.nodes(),r=0;r<i.length;r++)if(a=i[r],"group"==a._type?ej.datavisualization.Diagram.SvgContext._renderLabelGroup(a,d,this):ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(a,d,this),a.annotation&&a._annotation&&a._annotation.length)for(n=0;n<a._annotation.length;n++)diagram.nameTable[a._annotation[n]]&&(o=diagram.nameTable[a._annotation[n]],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(o,d,this));for(s=this.connectors(),r=0;r<s.length;r++)l=s[r],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(l,d,this);return document.body.removeChild(d.document),d.appendChild(this._svg.document.getElementById(this._canvas.id+"patterndefinition").cloneNode(!0)),d.document},_setScaleValueforCanvas:function(e,t){e._scaleX=1,e._scaleY=1,e.pageHeight=e.pageHeight?e.pageHeight:this.model.pageSettings.pageHeight,e.pageWidth=e.pageWidth?e.pageWidth:this.model.pageSettings.pageWidth;var i=e.pageHeight?e.pageHeight:t.height,a=e.pageWidth?e.pageWidth:t.width;("fill"===e.stretch||"uniform"===e.stretch||"uniformtofill"===e.stretch)&&(e._scaleX=a/t.width,e._scaleY=i/t.height,"uniform"===e.stretch?e._scaleX=e._scaleY=Math.min(e._scaleX,e._scaleY):"uniformtofill"===e.stretch&&(e._scaleX=e._scaleY=Math.max(e._scaleX,e._scaleY)),t.width=a,t.height=i),t.x*=e._scaleX,t.y*=e._scaleY},_diagramAsCanvas:function(e){var t,i,a,n,o,s,r,l,d,h,c=e.margin,u=a=e.bounds,g=this._pageBackgroundColor(),m=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:u.width,height:u.height});if(m._diagram=this,m._scaleX=e.scaleX,m._scaleY=e.scaleY,n=m.document.getContext("2d"),n.fillStyle=this._backgroundColor(),n.translate(-u.x,-u.y),n.fillRect(u.x,u.y,u.width,u.height),o=this._backgroundImage(),o&&o.source){s=new Image,s.src=o.source;var p=a.width/s.width,f=a.height/s.height,v=a.x,_=a.y,y=a.width,b=a.height,x=ej.datavisualization.Diagram.CanvasContext._isImageExportable(o);"none"!=o.scale&&"none"!=o.alignment?(r="meet"==o.scale?Math.min(p,f):Math.max(p,f),y=r*s.width,b=r*s.height,o.alignment.indexOf("xmid")>-1?v+=(a.width-y)/2:o.alignment.indexOf("xmax")>-1&&(v=v+a.width-y),o.alignment.indexOf("ymid")>-1?_+=(a.height-b)/2:o.alignment.indexOf("ymax")>-1&&(_=_+a.height-b),("none"==this._backgroundColor()||"transparent"==this._backgroundColor())&&(n.fillStyle="white",n.fillRect(a.x*e.scaleX,a.y*e.scaleY,a.width*e.scaleX,a.height*e.scaleY)),x&&n.drawImage(s,v,_,r*s.width,r*s.height)):x&&n.drawImage(s,v,_,a.width,a.height)}else n.fillStyle=g,n.fillRect(a.x*e.scaleX-c.left,a.y*e.scaleY-c.top,a.width*e.scaleX+c.left+c.right,e.scaleY*a.height+c.top+c.bottom);for(l=this._pageBorderColor(),d=this._pageBorderWidth(),d&&(n.strokeStyle="none"==l?"transparent":l,n.lineWidth=d,n.strokeRect(a.x*e.scaleX,a.y*e.scaleY,a.width*e.scaleX,a.height*e.scaleY)),t=this.nodes().concat(this.connectors()),t=this._sortByZIndex(t,!0),this._sortByGroupChildrenZIndex(!0),h=0;h<t.length;h++)i=t[h],ej.datavisualization.Diagram.Util.enableLayerOption(i,"print",this)&&(i.segments?ej.datavisualization.Diagram.CanvasContext.renderConnector(i,m):"group"!==i._type||i.parent?"node"!==i._type||i.isPhase||i.parent||ej.datavisualization.Diagram.CanvasContext.renderNode(i,m,this):ej.datavisualization.Diagram.CanvasContext.renderGroup(i,m,this));return m.document},_renderCanvasPhase:function(e,t){var i,a,n,o,s,r,l,d,h,c=0,u=0,g=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,e);if(g)for(a=0;a<g.length;a++){if(i=this.nameTable[this._getChild(g[a])],n=this.nameTable[e.name]){o=this._getChildren(n.children),o.length>1&&(s=this.nameTable[o[0]]);var m,p=ej.datavisualization.Diagram.Util.bounds(n),f=[];p.top+50,p.left+50;if("vertical"==i.orientation)for(f.push({x:0,y:0}),f.push({x:p.width,y:0}),m=ej.datavisualization.Diagram.SvgContext._convertToSVGPoints(f),c=p.x,u=p.y+i.offset,s&&(u+=s.height),r=0,l=f.length;l>r;++r)h=ej.datavisualization.Diagram.Geometry.translate(f[r],c,u),f[r]=h;else for(f.push({x:0,y:s.height?s.height:0}),f.push({x:0,y:p.height}),c=p.x+i.offset,u=p.y,r=0,l=f.length;l>r;++r)h=ej.datavisualization.Diagram.Geometry.translate(f[r],c,u),f[r]=h}for(d=0;d<f.length;d++)h=f[d],h.x*=t._scaleX,h.y*=t._scaleY;ej.datavisualization.Diagram.CanvasContext.renderPhases(i,t,f)}},_getPrintCanvasStyle:function(e,t){var i,a=0,n=0;return e&&(a=e.width,n=e.height),t&&((t.pageHeight||t.pageWidth)&&(n=t.pageHeight?t.pageHeight:n,a=t.pageWidth?t.pageWidth:a),t.pageOrientation&&("landscape"===t.pageOrientation&&n>a?i=a:"portrait"===t.pageOrientation&&a>n&&(i=a),i&&(a=n,n=i))),{height:n,width:a}},_getMultipleImage:function(e,t,i){var a,n,o,s,r,l,d=[],h=document.createElement("div"),c=this._getPrintCanvasStyle(e,t),u=t.margin,g=u.left,m=u.top,p=u.right,f=u.bottom,v=0,_=0;if(a=c.width+v,n=c.height+_,o=0,s=0,t&&t.multiplePage){if(h.style.height="auto",h.style.width="auto",r=e.height,l=e.width,e){var y,b,x,D=0,C=0,w=0,z=0;do{do w=c.width,z=c.height,o+c.width>=l&&(w=l-o),s+c.height>=r&&(z=r-s),x=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint"+D+C,width:c.width,height:c.height}),b=x.document.getContext("2d"),b.drawImage(e,v+o+g,_+s+m,w-p-g,z-f-m,0+g,0+m,w-p-g,z-f-m),o+c.width>=l&&(o-=o-l),y=x.document.toDataURL(),b.restore(),o+=a,i?d.push(y):this._printImage(h,y,D+""+C),D++;while(l>o);C++,D=v=o=0,s+c.height>=r&&(s-=s-r),s+=n}while(r>s)}}else{var a,n,v=0,_=0,c=this._getPrintCanvasStyle(e,t);a=c.width,n=c.height,x=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint0",width:a,height:n}),b=x.document.getContext("2d"),b.drawImage(e,v+g,_+m,e.width-(p+g),e.height-(m+f),0+g,0+m,a-(p+g),n-(m+f)),y=x.document.toDataURL(),b.restore(),this._printImage(h,y,0)}return i?d:h},_printImage:function(e,t,i){var a,n,o;a=document.createElement("img"),n=document.createElement("div"),o={"class":"e-diagram-print-page"},ej.datavisualization.Diagram.Util.attr(n,o),o={id:this.element[0].id+"_multiplePrint_img"+i,style:"float:left",src:t},ej.datavisualization.Diagram.Util.attr(a,o),n.appendChild(a),e.appendChild(n)},printImage:function(e,t){t=t||{};var i=t.margin||{};i={top:isNaN(i.top)?0:i.top,bottom:isNaN(i.bottom)?0:i.bottom,left:isNaN(i.left)?0:i.left,right:isNaN(i.right)?0:i.right},t=ej.datavisualization.Diagram.PrintSettings(t),this.exportImage(e,{printOptions:t,region:t.region,margin:i})},_raisePrintAction:function(e,t){var i,a=document.createElement("img"),n={id:this.element[0].id+"_printImage",src:e};ej.datavisualization.Diagram.Util.attr(a,n),i=this,a.onload=function(){var e=i._getMultipleImage(a,t),n=window.open("");null!=n&&(n.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page {page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}  </style><title></title></head>"),n.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),n.document.write("<center>"+e.innerHTML+"</center>"),n.document.close())}},print:function(e){e=ej.datavisualization.Diagram.PrintSettings(e);var t=this.exportDiagram({mode:"data",region:e.region,margin:{top:0,bottom:0,left:0,right:0},stretch:e.stretch});this._raisePrintAction(t,e)},save:function(){var e,t=this.model.drawingTools,i=this.model.selectedItems.userHandles;return this.model.drawingTools=null,this.model.selectedItems.userHandles=[],this.nameTable.multipleSelection&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable.multipleSelection),this._nodes=$.extend(!0,[],this.nodes())),this._updateTableNodes(),e=jQuery.extend(!0,{},this.model),delete e.historyManager,ej.version&&(e.version=ej.version),this._updateGroupChildren(e),this.model.drawingTools=t,this.model.selectedItems.userHandles=i,this._checkForNullValues(e),this.model.serializationSettings.preventDefaultValues&&(e=this._optimizeJson(e)),e},_updateDefaults:function(e){var t,i;this.defaultTabels||(this.defaultTabels={},this.defaultTabels.defaults=$.extend(!0,{},this.defaults),this.defaultTabels.defaults.snapSettings.verticalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.snapSettings.horizontalGridLines.linesInterval=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],this.defaultTabels.defaults.tooltip=this.defaultTabels.defaults.selectedItems.tooltip=ej.datavisualization.Diagram.TooltipDefaults),e&&e.type&&(this.defaultTabels[e.type]||("group"===e.type&&e.isSwimlane?(t=ej.datavisualization.Diagram.SwimLane({}),t.phases=[ej.datavisualization.Diagram.Phase({label:{text:"Phase"}})],t.lanes=[ej.datavisualization.Diagram.Lane({})],this.defaultTabels.Swimlane=t):"group"===e.type?this.defaultTabels[e.type]=$.extend(!1,ej.datavisualization.Diagram.Group(this.model.defaultSettings.group?this.model.defaultSettings.group:{type:e.type})):"connector"===e.type?this.defaultTabels[e.type]=ej.datavisualization.Diagram.ConnectorDefaults:"textBlock"===e.type?this.defaultTabels[e.type]=ej.datavisualization.Diagram.TextBlockDefaults:"labels"===e.type||"label"===e.type?this.defaultTabels[e.type]=ej.datavisualization.Diagram.LabelDefaults:"ports"===e.type?this.defaultTabels[e.type]=ej.datavisualization.Diagram.PortDefaults:"basic"===e.type||"flow"===e.type||"arrow"===e.type||"bpmn"===e.type||"text"===e.type||"image"===e.type||"native"===e.type||"html"===e.type||"node"===e.type?(i=ej.datavisualization.Diagram.Node($.extend(!1,{type:e.type},ej.datavisualization.Diagram.NodeBase({type:e.type}),ej.datavisualization.Diagram.NodeType({type:e.type,shape:e.shape},this))),i.container&&(i.container=ej.datavisualization.Diagram.Container(i.container)),this.defaultTabels[e.type]=i):("umlclassifier"===e.type||"umlactivity"===e.type)&&(i=ej.datavisualization.Diagram.Node($.extend(!1,{type:e.type},ej.datavisualization.Diagram.NodeBase({type:e.type}),ej.datavisualization.Diagram.NodeType({type:e.type,shape:e.shape,classifier:e.classifier,"class":e["class"],"interface":e["interface"],enumeration:e.enumeration},this))),this.defaultTabels[e.type]=i)))},_optimizeJson:function(e){return this._updateDefaults(),this._compareObject(e,this.defaultTabels.defaults)},_updateHistoryManager:function(e){for(var t in e)("push"!==e[t]||"stackLimit"!==e[t]||"pop"!==e[t])&&delete e[t];return e},_compareObject:function(e,t){var i,a,n,o,s,r,l,d,h,c,u;if(e&&t)for(i in e)if(a=e[i],null===a||""===a)delete e[i];else if(e.hasOwnProperty(i))if("_"===i.charAt(0)||"bpmn"===e.type&&"container"===i)delete e[i];else if(n=t[i]===undefined?this.defaultTabels[i]:t[i],a!==undefined&&n!==undefined&&(("collapseIcon"===i||"expandIcon"===i||"layout"===i)&&(a.shape===n.shape&&delete e[i].shape,a.type===n.type&&delete e[i].type),"isSwimlane"!==i&&"classifier"!==i&&"type"!==i&&"shape"!==i&&a===n&&delete e[i]),null!==a&&"object"==typeof a){if(null!==a&&a instanceof Array)if(0===a.length)delete e[i];else for(o in a)if("object"==typeof a[o]){if("labels"===i||"label"===i||"textBlock"===i||"ports"===i){if(this._updateDefaults({type:i}),s=this.defaultTabels[i],"label"===i&&(s=this.defaultTabels.labels),("labels"===i||"ports"===i)&&this.model.defaultSettings){r=this.model.defaultSettings;for(l in r)if(d=r[l],d&&d[i])for(h in d[i][o])this.defaultTabels[i][h]=d[i][h]}}else"children"===i?(this._updateDefaults({type:a[o].type}),s=this.defaultTabels[a[o].type]):(this._updateDefaults(a[o]),s=this.defaultTabels[a[o].type]);a[o].isSwimlane?s=this.defaultTabels.Swimlane:("umlclassifier"===a[o].type||"bpmn"===a[o].type)&&delete e[i][o].children,e[i][o]=this._compareObject(a[o],s===undefined?n:s)}else e[i]=this._compareObject(a,n);else if("class"!==i&&"interface"!==i&&"enumeration"!==i){if("commandManager"===i||"contextMenu"===i)if("contextMenu"!==i||this.model.enableContextMenu){if("commandManager"===i){c=a.commands;for(u in c)c[u]._isDefault&&delete c[u];$.isEmptyObject(a.commands)&&delete e[i].commands}}else delete e[i];e[i]="historyManager"===i?this._updateHistoryManager(a):this._compareObject(a,n)}($.isEmptyObject(a)||0===a.length)&&delete e[i]}return e},_checkForNullValues:function(e){this._checkTargetNull(e.pageSettings)},_checkTargetNull:function(e){for(var t in e)null==e[t]||e[t]==1/0?e[t]=0:"object"==typeof e[t]&&e[t]&&this._checkTargetNull(e[t])},_updateGroupChildren:function(e){var t,i,a,n=[],o=[],s="function"==typeof e.nodes?e.nodes():e.nodes;if(s&&s.length>0)for(a=0;a<s.length;a++)""!==s[a].parent||s[a].isSwimlane?s[a].isSwimlane&&(t=this._getNode(s[a].name),this._isSwimlaneExist=!0,t&&n.push(jQuery.extend(!0,{},t))):(this._updateChildren(s[a]),n.push(jQuery.extend(!0,{},s[a])));if(i="function"==typeof e.connectors?e.connectors():e.connectors,i&&i.length>0)for(a=0;a<i.length;a++)o.push(i[a]);e.connectors=o,e.nodes=n},_updateChildren:function(e){var t,i,a,n=[];if(e&&e.children&&e.children.length>0)for(a=0;a<e.children.length;a++)i=this._getChild(e.children[a]),i&&(t=this.nameTable[i]),t&&n.push(jQuery.extend(!0,{},t));e.children=n},_containsNode:function(e){var t,i;for(e=this._getChild(e),t=null,i=0;i<this.nodes().length;i++)if(t=this.nodes()[i],t&&t.name===e)return!0;return null},_updateTableNodes:function(){var e,t,i=0;for(i;i<this.nodes().length;i++)e=this.nameTable[this.nodes()[i].name],e&&(this.nodes()[i]=e,"group"===e._type&&this._updateTableGroup(e));for(i;i<this.connectors().length;i++)t=this.nameTable[this.connectors()[i].name],t&&(this.connectors()[i]=t)},_updateTableGroup:function(e){for(var t=(e.children,0);t<e.children.length;t++)e.children[t]=this.nameTable[this._getChild(e.children[t])],e.children[t]&&"group"===e.children[t]._type&&this._updateTableGroup(e.children[t])},upgrade:function(e){var t,i,a,n,o,s,r;if(e){if(t=Number(e.version),isNaN(t)&&e.version&&(t=e.version.split("."),e.version=t=Number(t[0]+"."+t[1])),e.version)if(14.2>t){if(e.nodes&&14.1>t)for(i=0;i<e.nodes.length;i++)a=e.nodes[i],this.setConstraints(a),a&&("native"===a.type||"image"===a.type||"html"===a.type)&&(a.scale="stretch");if(e.connectors)for(n=0;n<e.connectors.length;n++){if(o=e.connectors[n],14.1>t&&(o.constraints|=ej.datavisualization.Diagram.ConnectorConstraints.PointerEvents,o.labels&&o.labels.length>0))for(r=0;r<o.labels.length;r++)s=o.labels[r],s.relativeMode=ej.datavisualization.Diagram.LabelRelativeMode.SegmentBounds;14.2>t&&o&&o.segments&&1===o.segments.length&&"orthogonal"===o.segments[0].type&&(o.segments[0].length=13)}}else"13.1"==e.version;else if(this.commonAPIChanges(e),e.nodes)for(i=0;i<e.nodes.length;i++)e.nodes[i].inEdges||(e.nodes[i].inEdges=[],e.nodes[i].outEdges=[]),e.nodes[i].constraints=ej.datavisualization.Diagram.NodeConstraints.Default;e.version<15.4&&(e.scrollSettings?(e.scrollSettings.minZoom=.25,e.scrollSettings.maxZoom=30):e.scrollSettings={horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,zoomFactor:.2,minZoom:.25,maxZoom:30,padding:{left:0,right:0,top:0,bottom:0}}),e.version=ej.version}},setConstraints:function(e){var t,i,a,n,o;if(e&&"group"==e.type&&!e.isSwimlane)for(e.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,t=0;t<e.children.length;t++)o=e.children[t],"group"==o.type?this.setConstraints(o):o.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents;else if(e&&"group"==e.type&&e.isSwimlane){for(e.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,i=0;i<e.lanes.length;i++)if(a=e.lanes[i],a.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents,a.children)for(n=0;n<a.children.length;n++)o=a.children[n],"group"==o.type?this.setConstraints(o):o.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents}else e.constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents},commonAPIChanges:function(e){var t,i;if(e.defaultSettings={node:e.nodeDefaults,connectors:e.connectorDefaults},e.connectors)for(t=0;t<e.connectors.length;t++)e.connectors[t].constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default,e.connectors[t].line&&("straight"==e.connectors[t].line.type?(i=[{type:"straight",startPoint:e.connectors[t].line.startPoint,endPoint:e.connectors[t].line.endPoint}],this.commonSourceTargetChanges(e.connectors[t])):"orthogonal"==e.connectors[t].line.type?(i=[{type:"orthogonal",startPoint:e.connectors[t].line.startPoint,endPoint:e.connectors[t].line.endPoint}],this.commonSourceTargetChanges(e.connectors[t])):"bezier"==e.connectors[t].line.type&&(i=[{type:"bezier",startPoint:e.connectors[t].line.startPoint,endPoint:e.connectors[t].line.endPoint,point1:e.connectors[t].line.point1,point2:e.connectors[t].line.point2}],this.commonSourceTargetChanges(e.connectors[t])),e.connectors[t].sourcePoint=e.connectors[t].line.startPoint,e.connectors[t].targetPoint=e.connectors[t].line.endPoint,e.connectors[t].segments=i)},commonSourceTargetChanges:function(e){e.sourceNodeName&&(e.sourceNode=e.sourceNodeName),e.sourceNodePort&&(e.sourcePort=e.sourceNodePort),e.targetNodeName&&(e.targetNode=e.targetNodeName),e.targetPortName&&(e.targetPort=e.targetPortName)},load:function(e){var t,i,a,n,o,s;if(e&&"NewVersion"===e.version&&(e.version=ej.version),this._isLoad=!0,this._isOptimize=!0,this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this.clear(),this._zOrder=0,this.enableContextMenu()&&(t=$("#"+this.element[0].id+"_contextMenu").data("ejMenu"),t.destroy(),$("#"+this.element[0].id+"_contextMenu").remove()),e&&e.nodes&&e.nodes.length>0)for(a=e.nodes.length-1;a>=0;a--)i=e.nodes[a],i&&("connector"===i.type||i.segments)&&(e.connectors.push(i),e.nodes.splice(a,1)),i._shape&&(this._isOptimize=!1);if(e&&e.connectors&&e.connectors.length>0)for(a=e.connectors.length-1;a>=0;a--)n=e.connectors[a],o=!1,n.targetNode&&(this._isExist(e,n.targetNode)||(o=!0,e.connectors.splice(a,1))),n.sourceNode&&(this._isExist(e,n.sourceNode)||o||e.connectors.splice(a,1));e.selectedItems&&(e.selectedItems.userHandles=this.model.selectedItems.userHandles?this.model.selectedItems.userHandles:[]),this.upgrade(e),s={nodes:e.nodes?e.nodes:[],connectors:e.connectors?e.connectors:[],commandManager:e.commandManager?e.commandManager:{},contextMenu:e.contextMenu?e.contextMenu:{},snapSettings:e.snapSettings?e.snapSettings:{},historyManager:e.historyManager?e.historyManager:this._initHistoryManager(),backgroundImage:e.backgroundImage?e.backgroundImage:ej.datavisualization.Diagram.BackgroundImage({source:""}),enableAutoScroll:e.enableAutoScroll?e.enableAutoScroll:!0,autoScrollMargin:e.autoScrollMargin?e.autoScrollMargin:20,layout:e.layout?e.layout:{},pageSettings:e.pageSettings?e.pageSettings:{},click:e.click?e.click:null,connectionChange:e.connectionChange?e.connectionChange:null,defaultSettings:e.defaultSettings?e.defaultSettings:{node:null,connector:null},dataSource:e.dataSource?e.dataSource:null,dataSourceSchema:e.dataSourceSettings?e.dataSourceSettings:{},doubleClick:e.doubleClick?e.doubleClick:null,enableContextMenu:e.enableContextMenu===undefined?!0:e.enableContextMenu,tooltip:e.tooltip?e.tooltip:null,height:e.height?e.height:null,mouseEnter:e.mouseEnter?e.mouseEnter:null,mouseOver:e.mouseOver?e.mouseOver:null,mouseLeave:e.mouseLeave?e.mouseLeave:null,nodeTemplate:e.nodeTemplate?e.nodeTemplate:null,rotationChange:e.rotationChange?e.rotationChange:null,selectedItems:e.selectedItems?e.selectedItems:null,width:e.width?e.width:null,constraints:e.constraints,phases:e.phases?e.phases:[],scrollSettings:e.scrollSettings},this._tempCommandManager=e.commandManager,e.showTooltip!==undefined&&(s.showTooltip=e.showTooltip),e.tooltipTemplateId!==undefined&&(s.tooltipTemplateId=e.tooltipTemplateId),$("#"+this._id).ejDiagram(s),this._isLoad=!1,delete this._isOptimize,delete this._tempCommandManager},_isExist:function(e,t){for(var i,a,n,o=!1,s=0;e.nodes&&s<e.nodes.length;s++)if(!o&&(i=e.nodes[s]))if(i.isSwimlane){if(i.lanes)for(a=i.lanes,n=0;n<a.length&&!(o=this._checkNodeExist(a[n],t));n++);}else if(o=this._checkNodeExist(i,t))break;return o},_checkNodeExist:function(e,t){var i,a,n;if(e.children)for(i=0;i<e.children.length;i++)if(a=e.children[i],a&&(n=this._checkNodeExist(a,t)))return!0;return e.name===t},layout:function(){this._setLayout()},_setLayout:function(){this._doLayout(),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),this._clearSelection()},addSelection:function(e,t){var i,a;e&&!this._selectionContains(e)&&(this.model.selectedItems.children.length>0&&!t?(a=this.nameTable.multipleSelection,a||(a=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this.nodes().push(a),this.nameTable[a.name]=a),this.model.selectedItems.children.length>1?a.children=this.selectionList[0].children:a.children.push(this.selectionList[0].name),a.children.push(e.name),ej.datavisualization.Diagram.Util._updateGroupBounds(a,this,null,!0),i=a):i=e,this._hasSelection()&&this._clearSelection(!0),a&&this.nameTable.multipleSelection===undefined&&t===!1&&(this.nodes().push(a),this.nameTable[a.name]=a),this._addSelection(i))},clearSelection:function(){this._clearSelection()},removeSelection:function(e){var e,t;(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&e&&(e=this.nameTable[e.name],this.selectionList[0]==e||"pseudoGroup"==this.selectionList[0].type&&1==this.selectionList[0].children.length?this._clearSelection():"pseudoGroup"==this.selectionList[0].type&&this._collectionContains(e.name,this.selectionList[0].children)&&(t=this.selectionList[0].children.indexOf(e.name),-1!=t?ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,e.name):ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,e),ej.datavisualization.Diagram.Util.removeItem(this.model.selectedItems.children,e),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),this._updateSelectionHandle()))},updateSelectedObject:function(e,t){var i=this.nameTable[e];i&&ej.datavisualization.Diagram.Util.enableLayerOption(i,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(i)||i._isHeader)&&(this.activeTool.selectedObject=i),t&&t.isSwimlane&&(this.activeTool.selectedObject=t)},updateSelection:function(e){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&this._updateSelectionHandle(e)},activateTool:function(e,t){this.tools[e]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=e,this.activeTool=this.tools[this._toolToActivate],this.activeTool.singleAction=!0,(t===!1||"panTool"===e)&&(this.activeTool.singleAction=!1)),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer",this.activeTool.startPoint=ej.datavisualization.Diagram.Point(0,0),this.activeTool._isMouseDown=!1),this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.activeTool.singleAction?this.tool(this.tool()|ej.datavisualization.Diagram.Tool.DrawOnce):this.tool(this.tool()|ej.datavisualization.Diagram.Tool.ContinuesDraw),this.activeTool._showAllPorts()),this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this.tool()&ej.datavisualization.Diagram.Tool.DrawOnce&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.DrawOnce),this.tool()&ej.datavisualization.Diagram.Tool.ContinuesDraw&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.ContinuesDraw),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",
this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect)),this.activeTool._removeHighLighter(),ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer)},updateLabel:function(e,t,i){var a,n;if(e&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(a=this._findNode(e),a||(a=this._findConnector(e)),i&&t&&!i.name||t.name==i.name)){if(a){i.templateId&&t.templateId&&t.templateId!=i.templateId&&ej.datavisualization.Diagram.DiagramContext.setLabelTemplate(a,t,this),this._isUndo||this._recordPropertiesChanged(a,i,"label",t),"text"!==a.type&&(t=this._findLabel(a,t.name)),i.name=t.name,this._comparePropertyValues(a,"labels",i);for(n in i)t.hasOwnProperty(n)&&(t[n]="object"==typeof i[n]?$.extend(!0,{},t[n],i[n]):i[n]);i.wrapText!==undefined&&(t.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),a.segments||"text"!==a.type?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(a,t,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(a,t,this)):"text"===a.type&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(a,t,this),this._updateQuad(a)}i.mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&this.startLabelEdit(a,t)}return t},startLabelEdit:function(e,t){var i,a,n;if(e){for(i=0;i<this.selectionList.length;i++)if(a=this.selectionList[i],a!==e&&"undefined"!=typeof a.labels.length)for(n=0;n<a.labels.length;n++)a.labels[n].mode=ej.datavisualization.Diagram.LabelEditMode.View;t||"text"!==e.type||(t=e.textBlock),this._setLabelEditing(t)?this._startEdit(e):this._endEdit()}},_setSelectorConstraints:function(e){this.model.selectedItems.constraints=e,this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,e,undefined,this),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"==this.selectionList[0].type,this._currZoom,this._adornerLayer,this))},_raiseGroupChangeEvent:function(e,t,i,a){var n={};return n.element=e?e:null,n.oldParent=t?t:null,n.newParent=i?i:null,n.cause=a?a:null,t!=i&&this._raiseEvent("groupChange",n),n},group:function(){var e,t,i,a,n,o,s;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type){for(e=[],t=0;t<this.selectionList[0].children.length;t++)e.push(this.nameTable[this._getChild(this.selectionList[0].children[t])]);for(this._sortByZIndex(e,!0),a=ej.datavisualization.Diagram.Util.randomId(),n=new ej.datavisualization.Diagram.Group({name:a,rotateAngle:this.selectionList[0].rotateAngle}),this._clearSelection(!0),t=0;t<e.length;t++)this._isUndo=!0,n.children.push(e[t]),e[t].parent&&(o=this.nameTable[e[t].parent],o&&ej.datavisualization.Diagram.Util.removeChildFromGroup(o.children,e[t])),e[t].parent=a,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,e[t].name),e[t].segments?(ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[e[t].name]),this._connectors=$.extend(!0,[],this.connectors())):(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[e[t].name]),this._nodes=$.extend(!0,[],this.nodes())),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[e[t].name],e[t]),"html"==e[t].type?(i=document.getElementById(e[t].name+"_parentdiv"),i.parentNode.removeChild(i)):"group"===e[t]._type&&this._checkForHtmlNode(e[t]),i=this._svg.document.getElementById(e[t].name),i&&i.parentNode.removeChild(i),this._removeElement(e[t]),this._raiseGroupChangeEvent(e[t],o,n,"group");ej.datavisualization.Diagram.Util.clear(this.selectionList),n=this._getNewGroup(n),this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Unknown,this._isGroupNode=!0,this.add(n),s={type:"groupchanged",object:n,actionType:"group",category:"internal"},this.addHistoryEntry(s),this._isUndo=!1,delete this._isGroupNode}},_checkForHtmlNode:function(e){for(var t,i,a=this._getChildren(e.children),n=0;n<a.length;n++)t=this.nameTable[a[n]],t&&("group"===t._type?this._checkForHtmlNode(t):"html"==t.type&&(i=document.getElementById(t.name+"_parentdiv"),i.parentNode.removeChild(i)))},_removeChildren:function(e,t){for(var i,a=this._getChildren(e.children),n=0;n<a.length;n++)i=this.nameTable[a[n]],i&&(e.isLane||i.inEdges.length>0||i.outEdges.length>0?(this._disConnect(i,t),this._removeConnector(i,t)):i.segments?(this._removeEdges(i),i.sourceNode=i.sourcePort=i.targetNode=i.targetPort=null):this._disConnect(i,t,!0),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i),this._nodes=$.extend(!0,[],this.nodes()),"group"===i._type?(this._removeChildren(i,t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]),this._removeElement(i))},ungroup:function(){var e,t,i,a,n,o,s,r,l;if(this.selectionList[0]&&"group"===this.selectionList[0]._type&&this.selectionList[0].canUngroup&&!this.selectionList[0].isSwimlane&&!this.selectionList[0].isLane){for(this._isUndo=!0,e=this.selectionList[0].children,a=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],i=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),this._removeElement(this.selectionList[0]),this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),t=0;t<e.length;t++)r=this.nameTable[this._getChild(e[t])],r.parent&&(s=this.nameTable[r.parent]),$(a).children("#"+r.name)[0]&&a.removeChild($(a).children("#"+r.name)[0]),r&&(r.parent&&(r.parent=null),r.segments?(n=r,n.parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),-1===this.connectors().indexOf(n)&&(this.connectors().push(n),this._connectors=$.extend(!0,[],this.connectors()))):(n=r,n.parent="","group"===n._type?(this._updateChildrenEdges(n),(n.isLane||n.isSwimlane)&&(n.width=0,n.height=0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this),-1===this.nodes().indexOf(n)&&(this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()))),r.parent&&(o=this.nameTable[r.parent]),this._raiseGroupChangeEvent(r,s,o,"unGroup"));ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(i.name)),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),l={type:"groupchanged",object:i,actionType:"ungroup",category:"internal"},this.addHistoryEntry(l),this._isUndo=!1}},nudge:function(e,t){t=t?t:1;var i,a={up:{x:0,y:-t},down:{x:0,y:t},left:{x:-t,y:0},right:{x:t,y:0}},n=a[e];"up"===e?i="down":"down"===e?i="up":"left"===e?i="right":"right"===e&&(i="left"),n&&this.selectionList[0]&&!this.selectionList[0].isLane&&!this.selectionList[0].isPhase&&(this._isUndo||this.addHistoryEntry({type:"nudge",object:this.selectionList[0],undoDirection:i,redoDirection:e,values:t,category:"internal"}),this._nudge(this.selectionList[0],n.x,n.y,e))},selectAll:function(){var e,t,i,a,n,o=null;for(this._clearSelection(!0),e=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),t=this.nodes(),i=0,a=t.length;a>i;i++)ej.datavisualization.Diagram.Util.canSelect(t[i])&&ej.datavisualization.Diagram.Util.enableLayerOption(t[i],"lock",this)&&(o=this.nameTable[t[i].name],o&&""==o.parent&&"pseudoGroup"!=o.type&&o.visible&&e.children.push(o.name));for(n=this.connectors(),i=0,a=n.length;a>i;i++)ej.datavisualization.Diagram.Util.canSelect(n[i])&&ej.datavisualization.Diagram.Util.enableLayerOption(n[i],"lock",this)&&""==n[i].parent&&n[i].visible&&e.children.push(n[i].name);ej.datavisualization.Diagram.Util._updateGroupBounds(e,this),e.children.length>1?(this.nodes().push(e),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[e.name]=e,this._addSelection(e)):1===e.children.length&&this._addSelection(this.nameTable[e.children[0]])},align:function(e){var t,i,a,n,o,s;if(this.selectionList[0]&&("group"===this.selectionList[0].type||"pseudoGroup"==this.selectionList[0].type)&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var r,l=this.nameTable[this.selectionList[0].name].children,d=[],h=this._findCornerNodes();if("left"===e?r=h.left:"right"===e?r=h.right:"top"===e?r=h.top:"bottom"===e&&(r=h.bottom),r?t=ej.datavisualization.Diagram.Util.bounds(r):("center"===e||"middle"===e)&&(t=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),t){for(this._associatedConnectorsUpdate=!0,n=0,o=0,i=0;i<l.length;i++)s=this.nameTable[this._getChild(l[i])],a=ej.datavisualization.Diagram.Util.bounds(s),"left"===e?n=-(a.x-t.x):"right"===e?n=-(a.x+a.width-(t.x+t.width)):"top"===e?o=-(a.y-t.y):"bottom"===e?o=-(a.y+a.height-(t.y+t.height)):"center"===e?n=-(a.x+a.width/2-(t.x+t.width/2)):"middle"===e&&(o=-(a.y+a.height/2-(t.y+t.height/2))),this._moveNode(n,o,s),this._updateContainerOnNudge(s),d.push({object:s,delta:{x:n,y:o}});for(delete this._associatedConnectorsUpdate,i=0;i<l.length;i++)s=this.nameTable[this._getChild(l[i])],s.segments||this._updateAssociateConnector(s);ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}this.addHistoryEntry({type:"alignCommand",values:d,category:"internal",object:this.selectionList[0]})}},_updateAssociateConnector:function(e){var t,i,a;if(e.children&&(i=e.children))for(a=0;a<i.length;a++)t=this.nameTable[this._getChild(i[a])],t&&this._updateAssociateConnector(t);ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(e,this._svg,this)},sameSize:function(){var e,t;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=ej.datavisualization.Diagram.Util.bounds(a),o=[];for(this._isSizingCommand=!0,e=0;e<i.length;e++)t=this.nameTable[this._getChild(i[e])],t.segments||(o.push({object:t,values:{width:t.width||t._width||0,height:t.height||t._height||0}}),this.updateNode(t.name,{width:n.width,height:n.height}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:o}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameHeight:function(){var e,t;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=[],o=ej.datavisualization.Diagram.Util.bounds(a);for(this._isSizingCommand=!0,e=0;e<i.length;e++)t=this.nameTable[this._getChild(i[e])],t.segments||(n.push({object:t,values:{width:t.width||t._width||0,height:t.height||t._height||0}}),this.updateNode(t.name,{height:o.height}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:n}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameWidth:function(){var e,t;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,a=this.nameTable[this._getChild(this.selectionList[0].children[0])],n=ej.datavisualization.Diagram.Util.bounds(a),o=[];for(this._isSizingCommand=!0,e=0;e<i.length;e++)t=this.nameTable[this._getChild(i[e])],t.segments||(o.push({object:t,values:{width:t.width||t._width||0,height:t.height||t._height||0}}),this.updateNode(t.name,{width:n.width}));delete this._isSizingCommand,this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:o}),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},spaceDown:function(){var e,t,i,a,n,o,s,r,l;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(e=this.selectionList[0].children,this._sliceDockLines(e),this._sortByYvalue(this.selectionList[0].children),t=e.length,i=[],e&&t>2)){var d=this._findCornerNodes(),h=(d.top,0),a=null,n=null;for(s in e)a=null,n=null,a=this.nameTable[this._getChild(e[s])],n=this.nameTable[this._getChild(e[Number(s)+1])],a&&n&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=ej.datavisualization.Diagram.Util.bounds(n),h+=l.y-(r.y+r.height));o=h/(t-1);for(s in e)a=this.nameTable[this._getChild(e[s])],n=this.nameTable[this._getChild(e[Number(s)+1])],a&&n&&(r=ej.datavisualization.Diagram.Util.bounds(a),l=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,0,r.bottom-l.top+o),this._translate(n,0,r.bottom-l.top+o,this.nameTable),i.push({object:n,delta:{x:0,y:r.bottom-l.top+o}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:i,category:"internal",object:this.selectionList[0]})}},spaceAcross:function(){var e,t,i,a,n,o,s,r,l,d;if(this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(e=this.selectionList[0].children,this._sliceDockLines(e),this._sortByXvalue(this.selectionList[0].children),t=e.length,i=[],e&&t>2)){var h=this._findCornerNodes(),c=(h.left,0),a=null,n=null;for(r in e)a=null,n=null,a=this.nameTable[this._getChild(e[r])],n=this.nameTable[this._getChild(e[Number(r)+1])],a&&n&&(l=ej.datavisualization.Diagram.Util.bounds(a),d=ej.datavisualization.Diagram.Util.bounds(n),c+=d.x-(l.x+l.width));o=c/(t-1),s=0;for(r in e)a=this.nameTable[this._getChild(e[r])],n=this.nameTable[this._getChild(e[Number(r)+1])],a&&n&&(l=ej.datavisualization.Diagram.Util.bounds(a),d=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,l.right-d.left+o,0),this._translate(n,l.right-d.left+o,0,this.nameTable),i.push({object:n,delta:{x:l.right-d.left+o,y:0}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:i,category:"internal",object:this.selectionList[0]})}},sendBackward:function(){var e,t,i,a,n,o;if(this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&(i=this.selectionList[0])){for(e=this._findOverlapNode(i,"sendBackward"),this._sortByZIndex(e),a=0;a<e.length;a++)if(i.zOrder>e[a].zOrder){t=e[a];break}n=i.zOrder,t&&(o=t.zOrder,this._comparePropertyValues(i,"zOrder",{zOrder:o},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(n,o,i,t),this.addHistoryEntry({type:"zOrder",command:"back",start:o,end:n,nearestNode:t,object:i,category:"internal"}))}},_sendElementsToBack:function(e,t,i,a){for(var n,o,s=t;e>s;s++)""!=i.parent?(n=this._findObjectByIndex(s,!0),n&&(n.zOrder+=1)):(n=this._findObjectByIndex(s),n&&(n.zOrder+=1));this._deleteZorderProcess(),""!=i.parent?i.parent&&(o=this.nameTable[i.parent],this._findChildren(o,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;var r=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l=$(r).find("#"+i.name+"_label")[0],d=$(r).find("#"+i.name+"_parentdiv")[0],h=$(r).find("#"+a.name+"_parentdiv")[0];h||(h=$(r).find("#"+a.name)[0]),h&&d&&h.parentNode.insertBefore(d,h),h&&l&&h.parentNode.insertBefore(l,h),this._svg.getElementById(a.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(a.name)),this._updateSelectionHandle()},_deleteZorderProcess:function(){for(var e in this.nodes())this.nodes()[e]._isProcessed&&delete this.nodes()[e]._isProcessed;for(e in this.connectors())this.connectors()[e]._isProcessed&&delete this.connectors()[e]._isProcessed},_bringElementsToFront:function(e,t,i,a){for(var n,o,s=t;s>e;s--)""!=i.parent?(n=this._findObjectByIndex(s,!0),n&&(n.zOrder-=1)):(n=this._findObjectByIndex(s),n&&(n.zOrder-=1));this._deleteZorderProcess(),i.parent?(o=this.nameTable[i.parent],this._findChildren(o,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;var r=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],l=$(r).find("#"+i.name+"_label")[0],d=$(r).find("#"+a.name+"_label")[0],h=$(r).find("#"+i.name+"_parentdiv")[0],c=$(r).find("#"+a.name+"_parentdiv")[0];c||(c=$(r).find("#"+a.name)[0]),d&&h&&d.parentNode.insertBefore(h,d.nextSibling),h&&l&&h.parentNode.insertBefore(l,h.nextSibling),c&&h&&c.parentNode.insertBefore(h,c.nextSibling),this._svg.getElementById(a.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(a.name).nextSibling),this._updateSelectionHandle()},moveForward:function(){var e,t,i,a,n,o;if(this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&(i=this.selectionList[0])){for(e=this._findOverlapNode(i,"moveForward"),this._sortByZIndex(e),a=e.length-1;a>=0;a--)if(i.zOrder<e[a].zOrder){t=e[a];break}n=i.zOrder,t&&(o=t.zOrder,this._comparePropertyValues(i,"zOrder",{zOrder:o},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(n,o,i,t),this.addHistoryEntry({type:"zOrder",command:"front",start:o,end:n,nearestNode:t,object:i,category:"internal"}))}},sendToBack:function(){var e,t,i=this.selectionList[0];if(i&&"pseudoGroup"!=i.type){var a,n=this._findOverlapNode(i,"sendToBack"),o=this._sortByZIndex(n),s=i.zOrder,r=i.zOrder;for(t=0;t<o.length;t++)o[t].zOrder<r&&(0==t&&(a=o[t]),r=o[t].zOrder,e=o[t]);e&&(this._comparePropertyValues(i,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(s,r,i,e),this.addHistoryEntry({type:"zOrder",command:"back",start:r,end:s,nearestNode:a,object:i,category:"internal"}))}},bringToFront:function(){var e,t,i=this.selectionList[0];if(i&&"pseudoGroup"!=i.type){var a=this._findOverlapNode(i,"bringToFront"),n=this._sortByZIndex(a),o=i.zOrder,s=i.zOrder;for(t=0;t<n.length;t++)n[t].zOrder>s&&(s=n[t].zOrder,e=n[t]);e&&(this._comparePropertyValues(i,"zOrder",{zOrder:s},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(o,s,i,e),this.addHistoryEntry({type:"zOrder",command:"front",start:s,end:o,nearestNode:n[t-1],object:i,category:"internal"}))}},_getChildFromCollection:function(e,t){if(e&&e.length>0&&t)for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i]},_updateNameTable:function(e){var t,i;if(e.children&&e.children.length>0)for(t=0;t<e.children.length;t++)i="object"==typeof e.children[t]?e.children[t]:null,i&&(this.nameTable[i.name]=i,i.children&&i.children.length>0&&this._updateNameTable(i))},_recordPageSettingsChanged:function(e){var t=e.redoObject;e.isUndo&&(t=e.undoObject),t&&this.updatePageSettings(t)},_recordMultiRotationChanged:function(e){ej.datavisualization.Diagram.canvasHelper._undoMultiRotateNode(this,e)},_recordMultiPinPointChanged:function(e){ej.datavisualization.Diagram.canvasHelper._undoMultiDragNode(this,e)},_recordMultiSizeChanged:function(e){ej.datavisualization.Diagram.canvasHelper._undoMultiResizeNode(this,e)},undo:function(){var e;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&ej.datavisualization.Diagram.Util.canUndo(this)){if(this._getHistoryList(),this._isUndo=!0,e=this.getUndoEntry(),e&&("closeGroup"==e.type?this._groupUndo=!0:"startGroup"==e.type?this._groupUndo=!1:this._undo(e),this._groupUndo)){for(e=this.getUndoEntry();e&&"startGroup"!=e.type&&(this._undo(e),this._groupUndo);)e=this.getUndoEntry();delete this._groupUndo}this._isUndo=!1}},redo:function(){this._isUndo=!0;var e=this.getRedoEntry();if(e&&("startGroup"==e.type?this._groupRedo=!0:this._redo(e),this._groupRedo)){for(e=this.getRedoEntry();e&&"closeGroup"!=e.type;)this._isUndo=!0,this._redo(e),e=this.getRedoEntry();delete this._groupRedo}this._isUndo=!1},_ComparehistoryChangeEvent:function(e,t){var i,a,n,o,s,r,l,d={source:[],changes:[]};switch(t.type){case"positionchanged":case"rotationchanged":case"sizechanged":d=this._getPseudoGroupElements(e,t);break;case"endpointchanged":this._UndoRedo?(a=this._historyChangeEvent(t.undoObject,t.redoObject,t),i={type:t.type,oldValues:a.changes?a.changes.oldValues:a.oldValues,newValues:a.changes?a.changes.newValues:a.newValues,cancel:!1},d.source.push(t.undoObject)):(a=this._historyChangeEvent(t.redoObject,t.undoObject,t),i={type:t.type,oldValues:a.changes?a.changes.oldValues:a.oldValues,newValues:a.changes?a.changes.newValues:a.newValues,cancel:!1},d.source.push(t.redoObject)),d.changes.push(i);break;case"collectionchanged":"remove"==t.changeType&&(i={type:t.type,addedItems:[],deletedItems:[e]}),"insert"==t.changeType&&(i={type:t.type,addedItems:[e],deletedItems:[]}),d.changes.push(i),d.source.push(e);break;case"labelchanged":i=this._UndoRedo?{type:t.type,newValues:{text:t.previousLabelValue},oldValues:{text:t.updatedLabelValue}}:{type:t.type,newValues:{text:t.updatedLabelValue},oldValues:{text:t.previousLabelValue}},d.changes.push(i),d.source.push(t.shape);break;case"labelcollectionchanged":i={type:t.type,source:t.shape,addedItems:[t.label],deletedItems:[]},d.changes.push(i),d.source.push(t.shape);case"groupchanged":i="group"==t.actionType?{type:t.type,source:t.object,addedItems:[t.object],deletedItems:[]}:{type:t.type,source:t.object,addedItems:[],deletedItems:[t.object]},d.changes.push(i),d.source.push(t.object);break;case"phasepositionchanged":this._UndoRedo?(i={type:t.type,newValues:{offset:t.undoObject.offset},oldValues:{offset:t.redoObject.offset}},d.source.push(t.undoObject)):(i={type:t.type,newValues:{offset:t.redoObject.offset},oldValues:{offset:t.undoObject.offset}},d.source.push(t.redoObject)),d.changes.push(i);break;case"phasecollectionchanged":i=t.isAdded?{type:t.type,addedItems:[t.phase],deletedItems:[]}:{type:t.type,addedItems:[],deletedItems:[t.phase]},d.source.push(t.phase),d.changes.push(i);break;case"propertiesChanged":i=this._propertyChangeEventValues(t),d.source.push(i.source),d.changes.push(i.changes);break;case"portscollectionchanged":"insert"==t.changeType&&(i={type:t.type,addedItems:[t.collection],deletedItems:[]}),"remove"==t.changeType&&(i={type:t.type,addedItems:[],deletedItems:[t.collection]}),d.source.push(t.object),d.changes.push(i);break;case"nudge":n={},o={},"label"!==t.object._type?this._UndoRedo?("left"==t.undoDirection&&(n.offsetX=t.object.offsetX-t.values,o.offsetX=t.object.offsetX),"right"==t.undoDirection&&(n.offsetX=t.object.offsetX+t.values,o.offsetX=t.object.offsetX),"up"==t.undoDirection&&(n.offsetY=t.object.offsetY-t.values,o.offsetY=t.object.offsetY),"down"==t.undoDirection&&(n.offsetY=t.object.offsetY+t.values,o.offsetY=t.object.offsetY),i={type:t.type,newValues:n,oldValues:o}):("left"==t.redoDirection&&(n.offsetX=t.object.offsetX-t.values,o.offsetX=t.object.offsetX),"right"==t.redoDirection&&(n.offsetX=t.object.offsetX+t.values,o.offsetX=t.object.offsetX),"up"==t.redoDirection&&(n.offsetY=t.object.offsetY-t.values,o.offsetY=t.object.offsetY),"down"==t.redoDirection&&(n.offsetY=t.object.offsetY+t.values,o.offsetY=t.object.offsetY),i={type:t.type,newValues:n,oldValues:o}):i=this._labelNudge(t),d.source.push(t.object),d.changes.push(i);break;case"spacingCommand":case"alignCommand":var n={},o={},h=[],c=[];for(r=0;r<t.values.length;r++)l=t.values[r],l.object.segments?(s=$.extend(!0,{},l.object),o={sourcePoint:s.sourcePoint,targetPoint:s.targetPoint},c.push(o),ej.datavisualization.Diagram.Util._translateLine(s,l.delta.x,l.delta.y),n={sourcePoint:s.sourcePoint,targetPoint:s.targetPoint},h.push(n)):(n={offsetX:l.object.offsetX-l.delta.x,offsetY:l.object.offsetY-l.delta.y},h.push(n),o={offsetX:l.object.offsetX,offsetY:l.object.offsetY},c.push(o));i={type:t.type,newValues:h,oldValues:c},d.source.push(t.object),d.changes.push(i);break;case"sizeCommand":var n={},o={},h=[],c=[];for(r=0;r<t.values.length;r++)l=t.values[r],n={width:l.values.width,height:l.values.height},h.push(n),o={width:l.object.width,height:l.object.height},c.push(o);i={type:t.type,newValues:h,oldValues:c},d.source.push(t.object),d.changes.push(i);break;case"zOrder":i={type:t.type,source:t.object,newValues:{zOrder:t.end},oldValues:{zOrder:t.object.zOrder}},d.source.push(t.object),d.changes.push(i)}return d},_labelNudge:function(e){var t=this.findNode(e.object._parent),i={},a={},n=this._UndoRedo?e.undoDirection:e.redoDirection;return"left"==n||"right"==n?(i.offsetX="left"==n?e.object.offset.x-e.values/t.width:e.object.offset.x+e.values/t.width,a.offsetX=e.object.offset.x):("up"==n||"down"==n)&&(i.offsetY="up"==n?e.object.offset.y-e.values/t.height:e.object.offset.y+e.values/t.height,a.offsetY=e.object.offset.y),{type:e.type,newValues:i,oldValues:a}},_getPseudoGroupElements:function(e,t){var i,a,n,o,s,r,l=this._UndoRedo||!this._isUndo?t.undoObject.node:t.redoObject.node;if(n={source:[],changes:[]},e&&"pseudoGroup"==e.type)for(s=this._getChildren(e.children),a=0;a<s.length;a++)i=this.nameTable[this._getChild(s[a])],r=this._UndoRedo||!this._isUndo?t.undoObject.childTable[s[a]]:t.redoObject.childTable[s[a]],o=this._isUndo?this._historyChangeEvent(r,i,t):this._historyChangeEvent(i,r,t),o.source&&n.source.push(o.source),o.changes&&n.changes.push(o.changes);else o=this._isUndo?this._historyChangeEvent(l,e,t):this._historyChangeEvent(e,l,t),o.source&&n.source.push(o.source),o.changes&&n.changes.push(o.changes);return n},_propertyChangeEventValues:function(e){var t,i,a,n,o,s=[],r=e.updateValues?e.updateValues:e.values;i="label"==e.elementType?e.label:"port"==e.elementType?e.port:e.object,a={},n={};for(o in r)i[o]!=r[o]&&(a[o]=i[o],n[o]=r[o]);return t={type:e.type,newValues:n,oldValues:a,deletedItems:[],addedItems:[]},s.push(t),{changes:s,source:i}},_historyChangeEvent:function(e,t,i){var a,n,o={type:i.type,deletedItems:[],addedItems:[],oldValues:{},newValues:{}};return e.offsetX!=t.offsetX&&(o.oldValues.offsetX=t.offsetX,o.newValues.offsetX=e.offsetX),e.offsetY!=t.offsetY&&(o.oldValues.offsetY=t.offsetY,o.newValues.offsetY=e.offsetY),e.width!=t.width&&(o.oldValues.width=t.width,o.newValues.width=e.width),e.height!=t.height&&(o.oldValues.height=t.height,o.newValues.height=e.height),e.rotateAngle!=t.rotateAngle&&(o.oldValues.rotateAngle=t.rotateAngle,o.newValues.rotateAngle=e.rotateAngle),(e.sourcePoint||t.sourcePoint)&&(a=e.sourcePoint||{},n=t.sourcePoint||{},(a.x!=n.x||a.y!=n.y)&&(o.oldValues.sourcePoint=t.sourcePoint,o.newValues.sourcePoint=e.sourcePoint)),(e.targetPoint||t.targetPoint)&&(a=e.targetPoint||{},n=t.targetPoint||{},(a.x!=n.x||a.y!=n.y)&&(o.oldValues.targetPoint=t.targetPoint,o.newValues.targetPoint=e.targetPoint)),{changes:o,source:t}},_undo:function(e){var t,i,a,n,o,s,r,l,d,h,c,u,g=[];if(this._UndoRedo=!0,e)if("internal"==e.category){if(t=e.object||(e.undoObject?e.undoObject.node||e.undoObject:undefined)||e.shape,!t&&e.phase&&(t=e.phase),t&&e.undoObject&&e.undoObject.node&&(t=this.nameTable[t.name]||t),!t)return void this.undo();if(this.model.historyManager.undoStack.length>0&&(i=this.model.historyManager.undoStack.splice(0,1),this.model.historyManager.redoStack.splice(0,0,i[0])),g=this._ComparehistoryChangeEvent(t,e),g.cause=ej.datavisualization.Diagram.HistoryChangeCause.Undo,this._raiseEvent("historyChange",g),t&&t.parent&&(a="object"==typeof t.parent?t.parent.name:t.parent),a&&!t.isLane&&!this.nameTable[a])return this._isUndo=!1,void this.undo();switch(e.type){case"pagesettingschanged":o={isUndo:!0,undoObject:e.undoObject,redoObject:e.redoObject},this._recordPageSettingsChanged(o);break;case"positionchanged":e.swimlaneMultiSelection?(e.undo=!0,this._recordMultiPinPointChanged(e)):(n={object:e.undoObject,isMultipleNode:e.isMultipleNode},this._recordPinPointChanged(n));break;case"rotationchanged":e.swimlaneMultiSelection?(e.undo=!0,this._recordMultiRotationChanged(e)):(n={object:e.undoObject,isMultipleNode:e.isMultipleNode},this._recordRotationChanged(n));break;case"sizechanged":e.undo=!0,e.swimlaneMultiSelection?this._recordMultiSizeChanged(e):(n={object:e.undoObject,isMultipleNode:e.isMultipleNode},this._recordSizeChanged(n,e));break;case"endpointchanged":n={undoObject:e.undoObject,redoObject:e.redoObject,isMultipleNode:e.isMultipleNode,_isUndo:!0},this._recordEndPointChanged(n);break;case"collectionchanged":if("insert"==e.changeType&&!this.nameTable[e.object.name]&&"pseudoGroup"!==e.object._type){if(this._groupUndo)return;this._isUndo=!1,this.undo()}n={changeType:e.changeType,childTable:e.childTable,edgeTable:e.edgeTable,isUndo:!0,sourcePorts:e.sourcePorts,targetPorts:e.targetPorts,index:e.index},n.object=jQuery.extend(!0,{},e.object),s=this._recordCollectionChanged(n,e),s&&(e.sourcePorts=n.sourcePorts,e.targetPorts=n.targetPorts,e.edgeTable=n.edgeTable,e.childTable=n.childTable);break;case"labelchanged":n={object:e.shape,label:e.previousLabelValue,index:e.index?e.index:0},this._recordLabelChanged(n);break;case"labelpositionchanged":e.undo=!0,this._recordLabelPositionChanged(e);break;case"labelsizechanged":e.undo=!0,this._recordLabelPositionChanged(e);break;case"labelrotationchanged":e.undo=!0,this._recordLabelPositionChanged(e);break;case"labelcollectionchanged":e.isUndo=!0,this.labelcollectionchanged(e);break;case"groupchanged":n={object:e.object,isUndo:!0,actionType:e.actionType},this._recordGroupChanged(n);break;case"phasepositionchanged":e.undo=!0,this._recordPhasesizeChanged(e);break;case"phasecollectionchanged":e=$.extend(!0,{},{phase:e.phase,group:e.group,isAdded:e.isAdded,phaseObject:e.phaseObject,islastPhase:e.islastPhase}),e.undo=!0,this._recordPhaseCollectionChanged(e);break;case"propertiesChanged":d=this.nameTable[e.object.name],d&&(r=this._getModifiedProperties(d,e.values,e[e.elementType]),"node"==e.elementType?this.updateNode(d.name,e.values):"connector"==e.elementType?this.updateConnector(d.name,e.values):"label"==e.elementType?e.label=this.updateLabel(d.name,e.label,e.values):"port"==e.elementType&&this.updatePort(d.name,e.port,e.values),e.values=r);break;case"portpositionchanged":e.undo=!0,this._recordPortPositionChanged(e);break;case"portscollectionchanged":e.isUndo=!0,this._recordPortsCollectionChanged(e);break;case"nudge":this._recordNudgingChanges(t,e);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(e);break;case"sizeCommand":this._recordSizeCommandChanges(e);break;case"swapLane":e=jQuery.extend(!0,{},{undoObject:e.undoObject,redoObject:e.redoObject,moveIndex:e.moveIndex,insertIndex:e.currentIndex}),e.undo=!0,ej.datavisualization.Diagram.canvasHelper._undoSwap(this,e);
break;case"zOrder":l=e.start,d=this.nameTable[e.object.name],this._comparePropertyValues(d,"zOrder",{zOrder:e.end}),"back"==e.command?(this._bringElementsToFront(e.start,e.end,e.object,e.nearestNode),e.command="front"):(this._sendElementsToBack(e.start,e.end,e.object,e.nearestNode),e.command="back"),e.nearestNode=this._findObjectByIndex(l),h=e.start,e.start=e.end,e.end=h,this._deleteZorderProcess()}e.activeLabel?(this._clearSelection(!0),this._addSelection(e.activeLabel,!0)):this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.undo&&(c=this.model.historyManager.undo,"string"==typeof c&&(c=ej.util.getObject(c,window)),$.isFunction(c)&&(u=c(e.data),u&&(e.data=u)))},_redo:function(e){var t,i,a,n,o,s,r,l,d,h,c,u=[];if(this._UndoRedo=!1,e)if("internal"==e.category){if(t=e.object||(e.undoObject?e.undoObject.node||e.undoObject:undefined)||e.shape,!t&&e.phase&&(t=e.phase),t&&e.undoObject&&e.undoObject.node&&(t=this.nameTable[t.name]||t),!t)return void this.redo();if(this.model.historyManager.redoStack.length>0&&(i=this.model.historyManager.redoStack.splice(0,1),this.model.historyManager.undoStack.splice(0,0,i[0])),u=this._ComparehistoryChangeEvent(t,e),u.cause=ej.datavisualization.Diagram.HistoryChangeCause.Redo,this._raiseEvent("historyChange",u),t&&t.parent&&(a="object"==typeof t.parent?t.parent.name:t.parent),a&&!this.nameTable[a])return this._isUndo=!1,void this.redo();switch(e.type){case"pagesettingschanged":n={isUndo:!1,undoObject:e.undoObject,redoObject:e.redoObject},this._recordPageSettingsChanged(n);break;case"positionchanged":e.swimlaneMultiSelection?(e.undo=!1,this._recordMultiPinPointChanged(e)):(o={object:e.redoObject,isMultipleNode:e.isMultipleNode},this._recordPinPointChanged(o));break;case"rotationchanged":e.swimlaneMultiSelection?(e.undo=!1,this._recordMultiRotationChanged(e)):(o={object:e.redoObject,isMultipleNode:e.isMultipleNode},this._recordRotationChanged(o));break;case"sizechanged":e.undo=!1,e.swimlaneMultiSelection?this._recordMultiSizeChanged(e):(o={object:e.redoObject,isMultipleNode:e.isMultipleNode},this._recordSizeChanged(o));break;case"endpointchanged":o={undoObject:e.undoObject,redoObject:e.redoObject,isMultipleNode:e.isMultipleNode,_isUndo:!1},this._recordEndPointChanged(o);break;case"collectionchanged":o={changeType:e.changeType,childTable:e.childTable,edgeTable:e.edgeTable,isUndo:!1,sourcePorts:e.sourcePorts,targetPorts:e.targetPorts,index:e.index},o.object=jQuery.extend(!0,{},e.object),this._recordCollectionChanged(o,e.object);break;case"labelchanged":o={object:e.shape,label:e.updatedLabelValue,index:e.index?e.index:0},this._recordLabelChanged(o);break;case"labelpositionchanged":e.undo=!1,this._recordLabelPositionChanged(e);break;case"labelsizechanged":e.undo=!1,this._recordLabelPositionChanged(e);break;case"labelrotationchanged":e.undo=!1,this._recordLabelPositionChanged(e);break;case"labelcollectionchanged":e.isUndo=!1,this.labelcollectionchanged(e);break;case"groupchanged":o={object:e.object,actionType:e.actionType,isUndo:!1},this._recordGroupChanged(o);break;case"phasepositionchanged":e.undo=!1,this._recordPhasesizeChanged(e);break;case"phasecollectionchanged":e=$.extend(!0,{},{phase:e.phase,group:e.group,phaseObject:e.phaseObject,islastPhase:e.islastPhase,isAdded:e.isAdded}),e.undo=!1,this._recordPhaseCollectionChanged(e);break;case"propertiesChanged":l=this.nameTable[e.object.name],l&&(s=this._getModifiedProperties(l,e.values,e[e.elementType]),"node"==e.elementType?this.updateNode(l.name,e.values):"connector"==e.elementType?this.updateConnector(l.name,e.values):"label"==e.elementType?e.label=this.updateLabel(l.name,e.label,e.values):"port"==e.elementType&&this.updatePort(l.name,e.port,e.values),e.values=s);break;case"portpositionchanged":e.undo=!1,this._recordPortPositionChanged(e);break;case"portscollectionchanged":e.isUndo=!1,this._recordPortsCollectionChanged(e);break;case"nudge":this._recordNudgingChanges(t,e,!0);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(e);break;case"sizeCommand":this._recordSizeCommandChanges(e);break;case"swapLane":e=jQuery.extend(!0,{},{undoObject:e.undoObject,redoObject:e.redoObject,moveIndex:e.moveIndex,insertIndex:e.currentIndex}),e.undo=!1,ej.datavisualization.Diagram.canvasHelper._undoSwap(this,e);break;case"zOrder":r=e.start,l=this.nameTable[e.object.name],this._comparePropertyValues(l,"zOrder",{zOrder:e.end}),"back"==e.command?(this._bringElementsToFront(e.start,e.end,e.object,e.nearestNode),e.command="front"):(this._sendElementsToBack(e.start,e.end,e.object,e.nearestNode),e.command="back"),e.nearestNode=this._findObjectByIndex(r),d=e.start,e.start=e.end,e.end=d,this._deleteZorderProcess()}e.activeLabel?(this._clearSelection(!0),this._addSelection(e.activeLabel,!0)):this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.redo&&(h=this.model.historyManager.redo,"string"==typeof h&&(h=ej.util.getObject(h,window)),$.isFunction(h)&&(c=h(e.data),c&&(e.data=c)))},_startGroupAction:function(){this.addHistoryEntry({type:"startGroup",category:"internal"})},_closeGroupAction:function(){this.addHistoryEntry({type:"closeGroup",category:"internal"})},addHistoryEntry:function(e){var t,i,a,n,o,s;if(!this._preventHistoryEntry&&!this.model.historyManager.suspend){if(this.model.historyManager.canLog&&(t=this.model.historyManager.canLog,"string"==typeof t&&(t=ej.util.getObject(t,window)),$.isFunction(t)&&(o=this.getNode(e.object||e.undoObject&&e.undoObject.node||e.shape),i=this._ComparehistoryChangeEvent(o,e),s={changes:i.changes.length?i.changes[0]:null,source:i.source.length?this.getNode(i.source[0]):null},0==t(s))))return;"internal"!=e.category&&(e={data:e}),this._historyList.canUndo&&this._historyList.currentEntry&&(this._historyList.currentEntry.data||"internal"==this._historyList.currentEntry.category)&&(a=this._historyList.currentEntry,a.next?a.previous&&(n=a.next,n.previous=null,a.next=e,e.previous=a):(a.next=e,e.previous=a)),this._historyList.currentEntry=e,this.model.historyManager.stackLimit&&(this._historyList.currentEntry&&this._historyList.currentEntry.previous&&!this._lastbefore?this._lastbefore=e:this._historyList.currentEntry.previous||(this._lastbefore=null,this._historyCount=0),this._historyCount<this.model.historyManager.stackLimit?this._historyCount++:this._lastbefore&&(this._lastbefore.previous&&delete this._lastbefore.previous,this._lastbefore.next&&(this._lastbefore=this._lastbefore.next))),o=e.object||(e.redoObject?e.redoObject.node||e.redoObject:undefined)||e.shape,s=this._ComparehistoryChangeEvent(o,e),s.cause=ej.datavisualization.Diagram.HistoryChangeCause.CustomAction,this._getHistoryList(),this._raiseEvent("historyChange",s),this._historyList.canUndo=!0,this._historyList.canRedo=!1}},removeHistoryEntry:function(e){var t,i,a,n,o;if(null!=this._historyList.currentEntry){if(t=this._historyList.currentEntry)if(t==e)i=t.previous,a=t.next,this._historyList.currentEntry=a||i;else{for(n=t.next;n;){if(n==e){i=n.previous,a=n.next;break}n=n.next}for(o=t.previous;o;){if(o==e){i=o.previous,a=o.next;break}o=o.previous}}i&&a?(i.next=a,a.previous=i):i?i.next=null:a&&(a.previous=null)}},canRemoveHistoryEntry:function(e){return"internal"!=e.category},clearHistory:function(){var e=this._historyList;e.currentEntry=null,e.canUndo=!1,e.canRedo=!1,this.model.historyManager.undoStack=[],this.model.historyManager.redoStack=[]},_getHistroyObject:function(e,t){t&&e.push({redoObject:t.redoObject?t.redoObject:null,undoObject:t.undoObject?t.undoObject:null,type:t.type?t.type:null,isMultipleNode:t.isMultipleNode?t.isMultipleNode:null,category:t.category?t.category:""})},_getHistoryList:function(){var e,t,i=[],a=[],n=this._historyList.currentEntry;for(n=this._historyList.currentEntry,this._historyList.canUndo||0===this.model.historyManager.undoStack.length?this._getHistroyObject(i,n):this._getHistroyObject(a,n);n&&n.previous;)e=n.previous,this._getHistroyObject(i,e),n=n.previous;for(n=this._historyList.currentEntry;n&&n.next;)t=n.next,this._getHistroyObject(a,t),n=n.next;this.model.historyManager.undoStack=i,this.model.historyManager.redoStack=a},getUndoEntry:function(){var e,t=null,i=this._historyList;return i.canUndo&&(t=i.currentEntry,e=i.currentEntry.previous,e?(i.currentEntry=e,i.canRedo||(i.canRedo=!0)):(i.canRedo=!0,i.canUndo=!1)),t},getRedoEntry:function(){var e,t=null,i=this._historyList;return i.canRedo&&(e=i.currentEntry.previous||i.canUndo?i.currentEntry.next:i.currentEntry,e&&(i.currentEntry=e,i.canUndo||(i.canUndo=!0),e.next||(i.canRedo=!1,i.canUndo=!0)),t=i.currentEntry),t},cut:function(){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=0,this._setClipboard(),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,this._delete(),delete this._multipleAction)},insertLabel:function(e,t,i){var a,n,o,s;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(a=this.nameTable[e],a&&t&&(n="node"==this.getObjectType(a)?this.model.defaultSettings.node:this.model.defaultSettings.connector,n=n?n:{},n&&n.labels&&a.labels&&n.labels[i!==undefined?i:a.labels.length]&&(t=$.extend(!0,{},n.labels[i!==undefined?i:a.labels.length],t)),n.labels=n.labels?n.labels:[],t=ej.datavisualization.Diagram.Label(t),t._parent=e,o=n.labels,o.splice(),this._collectionContains(t,a.labels)||a.labels.splice(i,0,t),s={element:a,index:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:o,newValue:a.labels},this._raisePropertyChange(s),ej.datavisualization.Diagram.DiagramContext.addLabel(a,t,this,i),this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:a,label:t,isUndo:!0,category:"internal",index:i})))},addLabel:function(e,t){var i,a,n,o;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=this.nameTable[e],i&&t&&(n="node"==this.getObjectType(i)?this.model.defaultSettings.node:this.model.defaultSettings.connector,n&&n.labels&&i.labels&&n.labels[i.labels.length]&&(t=$.extend(!0,{},n.labels[i.labels.length],t)),t=ej.datavisualization.Diagram.Label(t),t._parent=e,a=i.labels,i.labels.push(t),o={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:a,newValue:i.labels},this._raisePropertyChange(o),ej.datavisualization.Diagram.DiagramContext.addLabel(i,t,this),this.addHistoryEntry({type:"labelcollectionchanged",shape:i,label:t,isUndo:!0,category:"internal"})))},removeLabels:function(e,t){var i,a,n,o=[];if(t&&t.length>0){if(i=this.nameTable[e],i&&i.labels&&i.labels.length>0)for(a=t.length-1;a>=0;a--)for(n=i.labels.length-1;n>=0;n--)i.labels[n].name===t[a].name&&(ej.datavisualization.Diagram.SvgContext.deleteLabel(i,i.labels[n],this),o.push({index:n,label:$.extend(!0,{},i.labels[n])}),i.labels.splice(n,1));this._isUndo||this.addHistoryEntry({type:"labelcollectionchanged",shape:i,labels:o,isLabelRemove:!0,isUndo:!0,category:"internal"})}},_initLayer:function(){for(var e,t=this.model.layers,i=0;i<t.length;i++)t[i]=ej.datavisualization.Diagram.Layers(t[i]),e=t[i],(!e.visible||e.lock)&&(e.active=!1),this._updateLayer(t[i])},_updateLayer:function(e){for(var t,i=e.objects,a=0;a<i.length;a++)t=i[a],this._isUpdate(this.nameTable[t],e)&&this.updateNode(t,{})},_findLayer:function(e){for(var t,i=this.model.layers,a=0;a<i.length;a++)i[a].name===e&&(t=i[a]);return t},_checkGroupChild:function(e){for(var t,i,a,n,o=this._getChildren(e.children),s=0;o&&s<o.length;s++)if(t=this.nameTable[o[s]],i=this.model.layers,t.length>0){for(a=0;a<i.length;a++)n=i[a].objects.indexOf(t.name),n>-1&&(this.model.layers[a].objects.splice(n,1),this._updateLayer(i[a]));t.children&&this._checkGroupChild(t)}},addLayers:function(e){for(var t,i,a,n,o=0;o<e.length;o++)if(n=this.model.layers,e[o]=ej.datavisualization.Diagram.Layers(e[o]),t=e[o],(!t.visible||t.lock)&&(t.active=!1),!this._findLayer(t.name)&&(this.model.layers.push(t),t.objects&&t.objects.length))for(i=0;t&&i<t.objects.length;i++)a=this.nameTable[t.objects[i]],a&&("group"===a.type&&this._checkGroupChild(a),!a||a.isLane||a.isPhase||this._isUpdate(a,t)&&(this.updateNode(a.name,{}),this._clearSelection(!0)))},addNodeToLayer:function(e,t){var i,a,n;if(i=this._findLayer(e))for(a=i.objects,n=0;n<t.length;n++)a.indexOf(t[n])<0&&(a.push(t[n]),this.updateNode(t[n],{}))},_isUpdate:function(e,t){var i=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[e],"visible",this),a=ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[e],"lock",this);return t.visible!==i||t.lock!==a},removeNodeToLayer:function(e,t){var i,a,n,o;if(i=this._findLayer(e))for(a=i.objects,n=0;n<t.length;n++)o=a.indexOf(t[n].name),o>0&&(a.splice(o,1),this.updateNode(t[n],{}))},removeLayers:function(e){for(var t,i,a,n=0;n<e.length;n++)t=this.model.layers,i=this._findLayer(e[n].name),a=t.indexOf(i),this.model.layers.splice(a),this._updateLayer(i)},updateLayer:function(e,t){var i=this._findLayer(e),a=!1;t.visible!==undefined&&(i.visible!==t.visible&&(a=!0),i.visible=t.visible),t.lock!==undefined&&(i.lock!==t.lock&&(a=!0),i.lock=t.lock),t.print!==undefined&&(i.print=t.print),t.active!==undefined&&(i.active=t.active),t.snap!==undefined&&(i.snap!==t.snap&&(a=!0),i.snap=t.snap),t.objects!==undefined&&this._updateNodeToLayer(i.objects,t.objects),(!t.visible||t.lock)&&(i.active=!1),a&&this._updateLayer(i),this._clearSelection(!0)},_updateNodeToLayer:function(e,t){for(var i,a,n,o=0;o<t.length;o++)e.objects.indexOf(t[o])>-1&&i.push(t[o]);if(i.length>0)for(o=0;o<t.length;o++)a=t[o],i.indexOf(a)<0&&this.addNodeToLayer(e.name,a);else{for(n=ej.datavisualization.Diagram.Layers(),o=0;o<e.objects.length;o++)this.updateLayer(e.objects[o],n);e.objects=t,this._updateLayer(e)}},_isParent:function(e,t){if(e){if(t.indexOf(e.parent)>-1||t.indexOf(e.name)>-1)return!0;if(e.parent&&this.nameTable[e.parent].parent)return this._isParent(this.nameTable[this.nameTable[e.parent].parent],t)}},_updatePortConnection:function(e,t,i){for(var a,n=0;n<t.length;n++)a=this.nameTable[t[n]],a&&(a.sourcePort===i.name?(i._removeFromSourcePort=!0,i._removeLine=a.name,a.sourcePort=null):a.targetPort===i.name&&(i._removeFromTargetPort=!0,i._removeLine=a.name,a.targetPort=null),(i._removeFromSourcePort||i._removeFromTargetPort)&&(this._dock(a,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this)))},removePorts:function(e,t){var i,a,n,o=[];if(t&&t.length>0){if(i=this.nameTable[e],i&&i.ports&&i.ports.length>0)for(a=t.length-1;a>=0;a--)for(n=i.ports.length-1;n>=0;n--)i.ports[n].name===t[a].name&&(ej.datavisualization.Diagram.SvgContext.deletePort(i,i.ports[n],this),this._updatePortConnection(i,i.inEdges,i.ports[n]),this._updatePortConnection(i,i.outEdges,i.ports[n]),o.push($.extend(!0,{},i.ports[n])),i.ports.splice(n,1)[0]);this._isUndo||this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:o,changeType:"remove",isUndo:!0,category:"internal"})}},_insertPort:function(e,t,i){var a,n;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(a=this.nameTable[e],a&&t&&(t=ej.datavisualization.Diagram.Port(t),this._collectionContains(t,a.ports)||(a.ports.splice(i,0,t),ej.datavisualization.Diagram.DiagramContext.renderPort(a,t,this,i))),n=[t],this.addHistoryEntry({type:"portscollectionchanged",object:a,collection:n.slice(),changeType:"insert",isUndo:!0,category:"internal"}))},addPorts:function(e,t){var i,a;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(i=this.nameTable[e],i&&t)){for(a=0;a<t.length;a++)t[a]=ej.datavisualization.Diagram.Port(t[a]),i.ports.push(t[a]),this._raisePropertyChange({element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"ports",oldValue:null,newValue:t[a]}),ej.datavisualization.Diagram.DiagramContext.renderPort(i,t[a],this);this.addHistoryEntry({type:"portscollectionchanged",object:i,collection:t,changeType:"insert",isUndo:!0,category:"internal"})}},updatePort:function(e,t,i){var a,n;if(e&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))){if(a=this._findNode(e),i&&t&&(!i.name||t.name==i.name)&&a){t=this._findPort(a,t.name),this._isUndo||this._recordPropertiesChanged(a,i,"port",t),i.name=t.name,this._comparePropertyValues(a,"ports",i);for(n in i)t.hasOwnProperty(n)&&(t[n]="object"==typeof i[n]?$.extend(!0,{},t[n],i[n]):i[n]);ej.datavisualization.Diagram.DiagramContext.updatePort(a,t,this)}i.offset&&(this._updateAssociatedConnectorEnds(a,this.nameTable),ej.datavisualization.Diagram.SvgContext._updateAssociatedConnector(a,this._svg,this))}},copy:function(){return(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=1,this.selectionList&&this.selectionList.length>0&&this._setClipboard()),this._cloneSelectionList()},paste:function(e,t){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&((e||this._clipboardData)&&(this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard),this._pasteMultipleLane(),this._paste(e,t!==undefined?t:!0))},_pasteMultipleLane:function(){var e,t,i,a,n,o,s=[],r=[],l=[];if(this._clipboardData&&(n=this._clipboardData,n=$.extend(!0,{},this._clipboardData),o=n.node,"pseudoGroup"==o._type)){for(a=0;a<o.children.length;a++)e=o.children[a],t=n.childTable[e],t&&(t.isLane?(t._laneIndex=this._getRemoveIndex(t),this._collectionContains(t.parent,r)||r.push(t.parent),s[a]=t):l.push(t.name));if(s.length>0){if(i=this._sameParent(s,r,this._clipboardData.childTable),l.length>0)for(a in l)this._collectionContains(l[a],i.children)||i.children.push(l[a]);i&&i.children&&(this._clipboardData.node.children=i.children)}}},_sameParent:function(e,t,i){var a,n,o,s,r,l,d,h,c,u,g=[],m=[];if(u=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),e.length>1&&t.length>0){for(e=this._sortByLaneIndex(e),a=0;a<t.length;a++){for(l=ej.datavisualization.Diagram.Util.randomId(),g=[],n=0;n<e.length;n++)s=e[n],s&&s.isLane&&s.parent===t[a]&&(r=this.getNode(s),d=this._cloneLaneObj(r,l,i),g.push(d));if(c=this.nameTable[t[a]],c&&c.parent&&(h=this.nameTable[c.parent],h.isSwimlane))for(m=h.children[1].children.slice(),o=0;o<m.length;o++)m[o]=$.extend(!0,{},m[o]),m[o].name+=l;g&&m&&g.length>0&&m.length>0&&(h={type:"swimlane",offsetX:h.offsetX+10,offsetY:h.offsetY+10,orientation:h.orientation,lanes:g,phases:m},u.children.push(h))}return u}},_commandPaste:function(){this.paste()},_getNodesfrombounds:function(e,t){for(var i,a,n,o,s,r=!1,l=[],d=this.nodes(),h=0,c=d.length;c>h;h++)n=this.nameTable[d[h].name],t&&n&&(r=t.name===n.name),n&&n.visible&&!r&&(a=ej.datavisualization.Diagram.Util.bounds(n),a=ej.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(n)&&ej.datavisualization.Diagram.Util.enableLayerOption(n,"lock",this)&&(i=this.getObjectType(n),ej.datavisualization.Diagram.Geometry.containsRect(e,a)?""===n.parent&&l.push(n):"group"===i&&this.activeTool&&this.activeTool.inAction&&this.activeTool._checkGroupChildren(l,n,e)));for(o=this.connectors(),h=0,c=o.length;c>h;h++)s=this.nameTable[o[h].name],t&&s&&(r=t.name===s.name),s&&s.visible&&!r&&(a=ej.datavisualization.Diagram.Util.bounds(s),a=ej.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),ej.datavisualization.Diagram.Util.canSelect(s)&&ej.datavisualization.Diagram.Util.enableLayerOption(o,"lock",this)&&ej.datavisualization.Diagram.Geometry.containsRect(e,a)&&""===s.parent&&l.push(s));return l},_setClipboard:function(){var e,t,i,a,n,o;if(this.selectionList.length>0){var s,r,l,d=this.selectionList[0],h={},c=[];if("group"===d._type||"pseudoGroup"===d.type){for(a=this._getChildren(d.children),t=0;t<a.length;t++)for(i=t+1;i<a.length;i++)n=this.nameTable[this._getChild(a[t])],o=this.nameTable[this._getChild(a[i])],o&&n&&o.zOrder<n.zOrder&&(e=a[t],a[t]=a[i],a[i]=e);h=this._getChildTable(d,h)}h[d.name]=d,r=ej.datavisualization.Diagram.Util.bounds(d),l={x:r.x,y:r.y,width:r.width,height:r.height},c=this._getNodesfrombounds(l,d),s=$.extend(!0,{},{childTable:h,node:d,collection:c}),s.node.segments&&(s.node.targetNode=null,s.node.targetPort=null,s.node.sourceNode=null,s.node.sourcePort=null),s.addInfo=this._updateClipBoardConnectors(d,h),this._clipboardData=s}},_updateClipBoardConnectors:function(e,t){var i,a,n=[];if(e&&"pseudoGroup"===e.type&&e.children.length>0)for(a=0;a<e.children.length;a++)i=this.nameTable[this._getChild(e.children[a])],i&&(i.isSwimlane||i.isLane)&&this._updateSwimlaneGroupConnectors(e,i,t,n);else this._updateSwimlaneGroupConnectors(null,e,t,n);return n},_updateEdgesToClipboard:function(e,t,i,a,n,o){var s,r,l,d;i.parent&&e&&(s=this.nameTable[e.sourceNode],r=this.nameTable[e.targetNode],s&&r&&(l=this.nameTable[s.parent],d=this.nameTable[r.parent],(l&&l.isLane&&d&&d.isLane||l&&d&&("group"==l.type||"group"==d.type))&&(!this._collectionContains(e.name,o?i.outEdges:i.inEdges)||this._collectionContains(e.name,n)||this._collectionContains(e.name,t?t:[])||n.push(this.nameTable[this._getChild(e)]))))},_updateSwimlaneConnectors:function(e,t,i,a){if(t){for(var n,o=0;o<t.inEdges.length>0;o++)n=this.nameTable[this._getChild(t.inEdges[o])],this._updateEdgesToClipboard(n,e,t,i,a);for(o=0;o<t.outEdges.length>0;o++)n=this.nameTable[this._getChild(t.outEdges[o])],this._updateEdgesToClipboard(n,e,t,i,a,!0)}},_updateSwimlaneGroupConnectors:function(e,t,i,a){var n,o,s,r,l,d=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,t);for(!d&&e&&t.isLane&&(d=[t.name]),o=0;d&&o<d.length;o++)if(s=this.nameTable[this._getChild(d[o])],s&&s.children&&s.children.length>0)for(n=s.children,r=0;r<n.length;r++)l=this.nameTable[this._getChild(n[r])],l&&this._updateSwimlaneGroupChildConnectors(e&&e.children?e.children:null,l,i,a)},_updateSwimlaneGroupChildConnectors:function(e,t,i,a){var n,o,s=0;if(this._updateSwimlaneConnectors(e&&e.children?e.children:null,t,i,a),o=t.children)for(s=0;s<o.length;s++)n=this.nameTable[this._getChild(o[s])],n&&this._updateSwimlaneGroupChildConnectors(e,n,i,a)},_getChildTable:function(e,t){var i,a,n,o,s,r,l,d;if(a=this._getChildren(e.children))for(o=0;o<a.length;o++)if(n=a[o],i=this.nameTable[n],i&&(i.parent===e.name||"pseudoGroup"==e.type)){if(s=t[i.name]=$.extend(!0,{},i),("group"===s._type||"pseudoGroup"===s.type)&&(t=this._getChildTable(s,t)),s.inEdges&&s.inEdges.length>0)for(r in s.inEdges)d=this.nameTable[s.inEdges[r]],d&&(t[d.name]&&delete t[d.name],t[d.name]=d);if(s.outEdges&&s.outEdges.length>0)for(l in s.outEdges)d=this.nameTable[s.outEdges[l]],d&&(t[d.name]&&delete t[d.name],t[d.name]=d)}return t},isSameParent:function(e){var t;if(e.length>1){for(t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0}},_sortByLaneIndex:function(e){return e.sort(function(e,t){return e._laneIndex>t._laneIndex?1:t._laneIndex>e._laneIndex?-1:0})},_paste:function(e,t){var i,a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C,w,z,S;if(e){var l="",a=[],r=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"});for(t&&(l=ej.datavisualization.Diagram.Util.randomId()),S=0;S<e.length;S++)e[S].name+=l,e[S].outEdges&&(e[S].outEdges=[]),e[S].inEdges&&(e[S].inEdges=[]),e.length>1&&r.children.push(e[S].name),"connector"!=e[S].type?("group"!==e[S].type&&"bpmn"!==e[S].type||e[S].isSwimlane||(this._clonePasteGroup(e[S],l,e),this.add($.extend({},e[S]))),e[S].isSwimlane?(this._clonePasteSwimlaneObj(e[S],l,e),z=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,e[S],i),this._outOfBoundsOnNudge(z,10*diagram._pasteIndex,10*this._pasteIndex)&&this.add(z)):this.add($.extend({},e[S]))):a.push(e[S]);for(S=0;S<a.length;S++)a[S].sourceNode&&this.nameTable[a[S].sourceNode+l]?a[S].sourceNode+=l:(a[S].sourceNode="",a[S].sourcePort=""),a[S].targetNode&&this.nameTable[a[S].targetNode+l]?a[S].targetNode+=l:(a[S].targetNode="",a[S].targetPort=""),e.length>1&&r.children.push(a[S].name),this.add($.extend({},a[S]));e.length>1&&(this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[r.name]=r,this._clearSelection(!0),ej.datavisualization.Diagram.Util._updateGroupBounds(r,this),this.addSelection(r,!0))}else if(this._clipboardData&&(i=this._clipboardData,a=[],i=$.extend(!0,{},this._clipboardData),n=i.node,o=!1,n.zOrder=-1,this.tools.move._outOfBoundsDrag(n,10*this._pasteIndex,10*this._pasteIndex)&&n&&"phase"!=n.type)){if(n.container)n.isSwimlane?(this.model.historyManager.startGroupAction(),o=!0,n=this._pasteSwimlaneObj(n,i),i.childTable=this._getChildTable(n,i.childTable)):(n.isLane?(n=this._cloneLaneObj(n,ej.datavisualization.Diagram.Util.randomId(),i.childTable),"vertical"===n.orientation&&(n.height=n.height),x=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(n,this,this._clipboardData,!0),x&&(this._pasteObj=!0,this.add(x),this._pasteObj=!1),n=x):!n.container||n.isLane||n.isSwimlane||(n=this._cloneContainer(n,ej.datavisualization.Diagram.Util.randomId(),i.childTable),this._preserveConnection(i.childTable,n),this.add(n),n=this.nameTable[n.name]),h=10*this._pasteIndex,this._translate(n,h,h,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(n,this)),this._selectionContains(n)&&(this._clearSelection(!0),this._addSelection(n));else if("pseudoGroup"==n.type){for(s=n.children,r=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this._isUndo=!0,this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,S=0;S<s.length;S++)l=s[S],d="object"==typeof l?l:i.childTable[l],d.zOrder=-1,d._annotation&&delete d._annotation,d&&(d.isSwimlane||"swimlane"===d.type)?(o=!0,d=this._pasteSwimlaneObj(d,i),d&&this._isUndo&&(h=10*this._pasteIndex,this._translate(d,h,h,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(d,this)),d||(this.add(l),d=this.nameTable[l.name],this._clipboardData.childTable=this._getChildTable(d,i.childTable),this._clipboardData.node.children[S]=d,this._clipboardData.childTable[d.name]=d,c=!0),d&&r.children.push(d.name),n=r):d&&d.isLane?(u=this._pasteSwimlane(d,i,!0,10*this._pasteIndex),u&&r.children.push(u.name),h=10*this._pasteIndex,this._translate(u,h,h,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(u,this)):d&&(l+=ej.datavisualization.Diagram.Util.randomId(),delete i.childTable[d.name],c&&(this._clipboardData.childTable[d.name]=d),d.name=l,d.parent="",i.childTable[d.name]=d,this._preserveConnection(i.childTable,d),g=!0,d.segments&&(m=!0,p=!0,i.childTable[d._oldSourceNode]&&!this.nameTable[d.sourceNode]&&(m=!1,d.sourceNode=null),i.childTable[d._oldTargetNode]&&!this.nameTable[d.targetNode]&&(p=!1,d.targetNode=null),m||p||(g=!1)),g&&(r.children.push(l),"group"===d._type&&"bpmn"!=d.type?this._pasteChildren(i.childTable,d):d.children=[],h=10*this._pasteIndex,this._translate(d,h,h,this.nameTable),!d.segments||1!=d.segments.length||"orthogonal"!=d.segments[0].type||d.sourceNode||d.targetNode||(y=d.segments[0].points),b=!1,b=this.add(d),y&&b&&(d=this.nameTable[d.name],d.segments[0].points=y,ej.datavisualization.Diagram.DiagramContext.update(d,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom))));o&&this.model.historyManager.startGroupAction(),delete this._multipleAction,this._clearSelection(),r&&r.children.length>0&&(this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[r.name]=r,ej.datavisualization.Diagram.Util._updateGroupBounds(r,this),this._addSelection(r),f={},f=this._getChildTable(this.selectionList[0],f),v={type:"collectionchanged",object:this._updatePsedoGroupChildren(this.selectionList[0]),childTable:jQuery.extend(!0,{},f),changeType:"insert",category:"internal"},this.addHistoryEntry(v),this._isUndo=!1)}else"bpmn"==n.type?(_=ej.datavisualization.Diagram.Util.randomId(),n.parent="",n.name=n.name+_,n.inEdges=[],n.outEdges=[],n.children=[],n._annotation&&delete n._annotation,h=10*this._pasteIndex,this._translate(n,h,h,this.nameTable),this.add(n)):(n.name=n.name+ej.datavisualization.Diagram.Util.randomId(),n.parent="","group"===n._type?this._pasteChildren(i.childTable,n):n.segments||n.segments||(n.inEdges=[],n.outEdges=[]),h=10*this._pasteIndex,this._translate(n,h,h,this.nameTable),!n.segments||1!=n.segments.length||"orthogonal"!=n.segments[0].type||n.sourceNode||n.targetNode||(y=n.segments[0].points),b=this.add(n),b&&y&&(n=this.nameTable[n.name],n.segments[0].points=y,ej.datavisualization.Diagram.DiagramContext.update(n,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom)),this._updateSelectionHandle());if(i.addInfo.length){for(D in i.addInfo)C=i.addInfo[D],C.isSwimlane?(i.childTable[C.name]=C,i.childTable=this._getChildTable(C,i.childTable),C=this._pasteSwimlaneObj(C,i),i.childTable[C.name]=C,i.childTable=this._getChildTable(C,i.childTable)):(i.childTable[C.name]&&C!==i.childTable[C.name]&&(C=$.extend(!0,{},i.childTable[C.name])),w=C.name+ej.datavisualization.Diagram.Util.randomId(),C.name=w,C.parent="",C._oldSourceNode&&C._oldTargetNode&&(i.childTable[C.name]=C,this._preserveConnection(i.childTable,C),h=10*this._pasteIndex,this._translate(C,h,h,this.nameTable),this.add(C),c&&(a[D]=C),this._selectionContains(C)&&this._clearSelection(!0)));c&&(this._clipboardData.addInfo=a),this._selectionContains(n)||this._addSelection(n)}o&&this.model.historyManager.closeGroupAction(),this._pasteIndex++}},_cloneContainer:function(e,t,i){var a,n,o;for(e.name=e.name+t,a=0;a<e.children.length;a++)n=i?i:this.nameTable,o=n[this._getChild(e.children[a])],o.name+=t,o.parent=e.name,o.children&&o.children.length>0&&(o=this._cloneContainer(o,t,i)),e.children[a]=o;return ej.datavisualization.Diagram.bpmnHelper.updateProcessCollection(e,this),e},_clonePasteGroup:function(e,t,i){for(var a,n,o=0;o<e.children.length;o++)if(e.children[o].name+=t,e.children[o].parent=e.name,e.children[o].segments)e.children[o].sourceNode&&(e.children[o].sourceNode+=t),e.children[o].targetNode&&(e.children[o].targetNode+=t);else{for(n=0;n<e.children[o].inEdges.length;n++)a=e.children[o].inEdges[n],this._collectionContains(a,e.children)||i&&this._collectionContains(a,i)?a+=t:e.children[o].inEdges.splice(n,1);for(n=0;n<e.children[o].outEdges.length;n++)a=e.children[o].outEdges[n],this._collectionContains(a,e.children)||i&&this._collectionContains(a,i)?a+=t:e.children[o].outEdges.splice(n,1)}},_clonePasteSwimlaneObj:function(e,t,i){var a,n,o,s,r,l,d,h;if(e.lanes&&e.lanes.length>0)for(d=0;d<e.lanes.length;d++)if(e.lanes[d]&&(e.lanes[d].name+=t,e.lanes[d].children&&e.lanes[d].children.length>0)){for(a=e.lanes[d].children,n=[],o=0;o<a.length;o++){for(s=jQuery.extend(!0,{},a[o]),s.name+=t,s.parent=e.lanes[d].name,r=0;r<s.inEdges.length;r++)this._collectionContains(s.inEdges[r],i)?(s.inEdges[r]+=t,e.lanes[d].children[o]=s):s.inEdges.splice(r,1);for(r=0;r<s.outEdges.length;r++)this._collectionContains(s.outEdges[r],i)?(s.outEdges[r]+=t,e.lanes[d].children[o]=s):s.outEdges.splice(r,1);n.push(s)}e.lanes[d].children=n}if(e.phases&&e.phases.length>0){for(l=[],d=0;d<e.phases.length;d++)e.phases[d]&&(h=jQuery.extend(!0,{},e.phases[d]),h.name+=t,h.parent="",l.push(h));e.phases=l}},_cloneLaneObj:function(e,t,i){var e=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneLaneObj(this,e,t,i);return e},_cloneSwimlaneObj:function(e,t,i){e=$.extend(!0,{},e);var e=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneSwimlaneObj(this,e,t,i);
return e},_pasteSwimlaneObj:function(e,t){return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlaneObj(this,e,t)},_pasteSwimlane:function(e,t,i,a){return e&&e.isSwimlane?ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlane(this,e,t,i,a):void 0},_cloneNode:function(e,t,i,a){var e,n,o=!1,s=null;if(e){if(e="string"==typeof e?e:e.name,e=jQuery.extend(!0,{},t.childTable[e]),e.isPhaseStack&&(e.name=e.name.split("phaseStack")[0]+i+"phaseStack",o=!0,s=e.name),e.children&&e.children.length>0)for(n in e.children)this._cloneNode(e.children[n],t,i,s),e.children[n]&&("string"==typeof e.children[n]?e.children[n]+=i:e.children[n].name+=i);a?e.parent="string"==typeof a?a:a.name:""!=e.parent&&(e.parent+=i),o||(e.name+=i),this._preserveConnection(t.childTable,e),this.nameTable[e.name]=e}},_cloneSwimlane:function(e,t,i){var a,n,o=e.name;if(e.name+=i,e.children&&e.children.length>0)for(n in e.children)this._cloneNode(e.children[n],t,i,e),"string"==typeof e.children[n]?e.children[n]+=i:e.children[n]=e.children[n].isPhaseStack?o+i+"phaseStack":e.children[n].name+i;if(e.phases&&e.phases.length>0)for(n in e.phases)a=jQuery.extend(!0,{},this.nameTable[this._getChild(e.phases[n])]),a.name+=i,a.parent+=i,this.nameTable[a.name]=a,e.phases[n]=a.name;this.nameTable[e.name]=e},_pasteChild:function(e,t,i,a){var n=e.name+ej.datavisualization.Diagram.Util.randomId();delete t[e.name],e.name=n,t[e.name]=e,this._preserveConnection(t,e),e.parent=i.name,a.push(n),"group"===e._type&&this._pasteChildren(t,e),this.add(e)},_pasteChildren:function(e,t){for(var i,a,n=[],o=t.children,s=0;s<o.length;s++)a=this._getChild(o[s]),i=e[a],i.zOrder=-1,i&&this._pasteChild(i,e,t,n);for(t.children=[],s=0;s<n.length;s++)t.children.push(this.nameTable[n[s]]);this._preserveConnection(e,t)},_preserveConnections:function(e,t){for(var i,a=this._getChildren(t.children),n=0;n<a.length;n++)i=e[a[n]],i&&(this._preserveConnection(e,i),"group"===i._type&&this._preserveConnections(e,t))},_preserveConnection:function(e,t){var i,a,n,o;if(t.segments)t.targetNode&&(o=e[t.targetNode],o&&o.inEdges.push(t.name)),t.sourceNode&&(o=e[t.sourceNode],o&&o.outEdges.push(t.name));else{if(n=t.inEdges.length,n>0){for(i=0;n>i;i++)a=e[t.inEdges[i]],a&&(a._oldTargetNode=a.targetNode,a.targetNode=t.name);t.inEdges=[]}if(n=t.outEdges.length,n>0){for(i=0;i<t.outEdges.length;i++)a=e[t.outEdges[i]],a&&(a._oldSourceNode=a.sourceNode,a.sourceNode=t.name);t.outEdges=[]}}},_expandChildren:function(e){for(var t,i,a=0;a<e.outEdges.length;a++)t=this.nameTable[e.outEdges[a]],i=this.nameTable[t.targetNode],i.excludeFromLayout||(t.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateQuad(t),i.isExpanded&&this._expandChildren(i),i.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateQuad(i))},_collapseChildren:function(e){for(var t,i,a=0;a<e.outEdges.length;a++)t=this.nameTable[e.outEdges[a]],i=this.nameTable[t.targetNode],i.excludeFromLayout||(t.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(t,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t),i.isExpanded&&this._collapseChildren(i),i.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i))},zoomTo:function(e){e||(e=new ej.datavisualization.Diagram.Zoom),e.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+e.zoomFactor,0,0,e.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+e.zoomFactor),0,0,e.focusPoint,!0)},remove:function(e){e&&this.nameTable[e.name]&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))?this._delete(e):this._delete()},clear:function(){if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this)){this._clearSelection();var e=this;for(this._views.forEach(function(t){var i=e._views[t];$(i.diagramLayer).empty(),$(e._expander).empty(),$(e._adornerLayer.children).empty(),$(i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0]).empty()});this.nodes().length>0;)this.nodes().pop();for(;this.connectors().length>0;)this.connectors().pop();this._nodes=[],this._connectors=[],this.nameTable={},this.selectionList=[],this.clearHistory(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this._updateScrollOffset(0,0)}},_clearElementCollection:function(){$(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove(),$(this.element).find(".ej-d-seperator").remove();var e=this.model.dataSourceSettings.dataSource;if("string"!=typeof e&&e.length){for($(this.element).find(".ej-d-connector").remove();this.nodes().length>0;)this.nodes().pop();for(;this.connectors().length>0;)this.connectors().pop();this._nodes=[],this._connectors=[],this.nameTable={},this.selectionList=[],this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch()}},_updateChildOnGroup:function(e){var t,i=null;return e&&e.parent&&(i=this._svg.document.getElementById(e.parent),t=this.nameTable[e.parent],t&&(t.container?ej.datavisualization.Diagram.ContainerHelper._add(this,e):(e=this.nameTable[this._getChild(e)],null!=e&&t.children.push(e),"group"==e._type&&this._initGroupNode(e),ej.datavisualization.Diagram.Util._refreshParentGroup(e,this)))),i},_raiseChildrenPropertyChange:function(e,t){var i,a,n,o,s;if(e&&e.parent){var r,l,d=this._findNode(e.parent),h=[],c=[];if(d){if(d.isLaneStack)i=this._getNode(d.parent),c=i.lanes,c=c.slice(),t?i.lanes.push(e):(a=ej.datavisualization.Diagram.canvasHelper._getLaneIndex(i,e),i.lanes.splice(a,1)),h=i.lanes,r=i,l="lanes";else if(d.isPhaseStack)i=this._getNode(d.parent),c=i.phases,c=c.slice(),t?i.phases.push(e):(a=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,e.name),i.phases.splice(a,1)),h=i.phases,r=i,l="phases";else{var d=this._getNode(e.parent),u=[],a=-1;for(n=0;n<d.children.length;n++)o=this._getNode(d.children[n]),o&&(o.name===e.name&&(a=n),u.push(o));c=u.slice(),h=u.slice(),t?h.push(e):h.splice(a,1),r=d,l="children"}s={element:r,cause:this._isDragg||this.activeTool.inAction?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:l,oldValue:c,newValue:h},this._raisePropertyChange(s)}}},addLane:function(e,t){var i,a;this._isLaneApi=!0,e.isLane&&(e=this._dynamicLane(e,this),t||e.parent?(i=this._updateDynamicLane(this,e,t),i&&i.isSwimlane?(a=this.nameTable[this._getChild(i.children[2])],e=ej.datavisualization.Diagram.canvasHelper._updateDropLaneProperties(this,e,i),t||0===t?a.children.splice(t,0,e):a.children.push(e),e.parent=a.name,this._swimlaneObject=!0):e=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(e,this),this.add(e),a&&i&&(ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,a),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,i),this._clearSelection(!0),this._addSelection(i)),delete this._swimlaneObject):(e=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(e,this),this.add(e))),delete this._isLaneApi},_dynamicLane:function(e,t){var i=ej.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(e,t.nameTable),a=i.orientation;return i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,t.nameTable),i.minHeight=e.height,i.minWidth=e.width,i.parent=e.parent,i.orientation=a,e.orientation&&(i.orientation=e.orientation),i.isLane&&(i=ej.datavisualization.Diagram.ContainerHelper._initContainer(t,i)),i},_updateDynamicLane:function(e,t){var i,a;if(t.parent)a=e.nameTable[t.parent];else for(i=0;i<this.selectionList.length;i++)a=this.selectionList[i];return a},_add:function(e,t,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D;if(!e.length>0&&(e=ej.datavisualization.Diagram.NodeType(e,this),this.model.nodeTemplate&&"node"===e._type?n=this._getNodeTemplate():o=this._getConnectorTemplate(),n&&n(this,e),o&&o(this,e)),e.pivot||(e.pivot={x:.5,y:.5}),!e||!(e.segments||e.sourcePoint||e.targetPoint||e.sourceNode||e.targetNode)||e.segments&&e.segments[0]&&e.segments[0].points||(s=$.extend(!0,{},e),s=this._getNewConnector(s)),s&&this._outOfBoundsOnNudge(s,0,0)||!s&&this._outOfBoundsOnNudge(e,0,0)){if(r=this._eventCause,this._raiseChildrenPropertyChange(e,!0),this._eventCause=r,l=!1,(e.isSwimlane||"swimlane"===e.type)&&!this._pasteObj&&this._isNewNode&&(e=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,e)),e.length>0)for(y=0;y<e.length;y++)this.add(e[y]);else if(e.addInfo&&(e.addInfo.height&&(e.height=e.addInfo.height),e.addInfo.width&&(e.width=e.addInfo.width)),d="connector"==e.type?"connector":"node",c={changeType:"insert",element:this.getNode(e)},e.isLane?this._isDragg||!this._selectedSymbol?(v=this._isUndo?ej.datavisualization.Diagram.GroupChangeCause.HistoryChange:ej.datavisualization.Diagram.GroupChangeCause.Drop,this._isLaneApi&&(v=ej.datavisualization.Diagram.GroupChangeCause.Unknown),h=this.getNode(e),c={changeType:"insert",element:h,state:"changing"},this._eventCause.nodeCollectionChange=v,u=c,c=this._raiseEvent(d+"CollectionChange",c),c||(c=u),c.cancel||(this._updateLane(e,c.element),this._raiseGroupChangeEvent(h,null,this.getNode(e.parent),v))):this._updateLane(e,c.element):e.isSwimlane?(c=this._raiseCollectionChangeEvent(e,d),this._updateSwimlane(e,c.element,!0)):e.container&&!$.isEmptyObject(e.container)&&(e=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,e)),e.isLane||e.isSwimlane){if(!c.cancel&&(l=e.isLane&&(this._selectedSymbol&&this._selectedSymbol.isLane||this._swimlaneObject||this._isUndo)?!0:this.nodes().push(e),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[e.name]=e,l)){if("group"===e._type&&t){if(this._paletteItemClick&&(e.offsetX=e.minWidth/2+50,e.offsetY=e.minHeight/2+50),ej.datavisualization.Diagram.DiagramContext.renderGroup(e,this),e.phases&&e.phases.length>0)for(_=null,y=0,b=e.phases.length;b>y;y++)_=this.nameTable[this._getChild(e.phases[y])],"phase"==_.type&&ej.datavisualization.Diagram.SvgContext.renderphase(_,this._svg,this._diagramLayer,this);this._clearSelection(!0),this._addSelection(e)}this._updateQuad(e)}}else if("connector"!=e.type){if(v=this._eventCause[d+"CollectionChange"],v||(this._eventCause[d+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),"group"===e._type||e.children&&e.children.length>0?(this._convertGroupChild(e,[]),e=ej.datavisualization.Diagram.Group(e),this.nameTable[e.name]=e,c=this._raiseCollectionChangeEvent(e,d),e._type="group","bpmn"==e.type&&(e=ej.datavisualization.Diagram.Util._updateBpmnChild(e,this)),this._initGroupNode(e),this._isGroupNode||"bpmn"===e.type||this._udpateChildRotateAngle(e)):e.isPhase||(e=this._getNewNode(e),this.nameTable[e.name]=e,c=this._raiseCollectionChangeEvent(e,d),this._getNodeDimension(e)),!c.cancel&&(e._status="new",l=e.parent?!0:this.nodes().push(e),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[e.name]=e,l)){if(this._containerOverNode&&(ej.datavisualization.Diagram.canvasHelper._addNodeToContainer(this,e,this._containerOverNode),delete this._containerOverNode),"group"===e._type||e.children&&e.children.length>0?(this._updateParent(e),0==e.offsetX&&0==e.offsetY&&ej.datavisualization.Diagram.Util._updateGroupBounds(e,this,!0),this._updateChildrenEdges(e),g=null,g=this._updateChildOnGroup(e),t&&!e.parent&&(delete this._isNodeInitializing,ej.datavisualization.Diagram.DiagramContext.renderGroup(e,this))):t&&(g=null,g=this._updateChildOnGroup(e),(""===e.parent||e.isPhase||this._isInsert)&&ej.datavisualization.Diagram.DiagramContext.renderNode(e,this,g),this._selectedSymbol&&e.textBlock&&(m=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],m&&(p=$(m).find("#"+e.name+"label")[0],p&&p.childNodes&&p.childNodes.length>0&&(p.childNodes[0].style.display="none")))),this._updateQuad(e),this.nameTable[e.name]=e,"group"===e._type||e.children&&e.children.length>0)for(y=0;y<e.children.length;y++)f=e.children[y],this.nameTable[f.name]=f;t&&!a&&(this._clearSelection(!0),this._addSelection(e))}}else e=this._getNewConnector(e),this.nameTable[e.name]=e,v=this._eventCause[d+"CollectionChange"],v||(this._eventCause[d+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),c=this._raiseCollectionChangeEvent(e,d),c.cancel||(l=e.parent?!0:this.connectors().push(e),e._status="new",l&&(this._updateEdges(e),this._dock(e,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(e,this),this._updateConnectorBridging(e),e.parent||t&&ej.datavisualization.Diagram.DiagramContext.renderConnector(e,this),this.nameTable[e.name]=e,this._updateQuad(e),this._updateChildOnGroup(e),t&&!a&&(this._clearSelection(!0),this._addSelection(e))));this._setZorder(e),!this._isUndo&&(!this._selectedSymbol||this._endEditing)&&l&&(x={},this.selectionList&&this.selectionList.length>0&&(x=this._getChildTable(this.selectionList[0],x)),i&&(!i||i.entryHistory)||e.isPhase||(D={type:"collectionchanged",object:jQuery.extend(!0,{},e),childTable:jQuery.extend(!0,{},x),changeType:"insert",category:"internal"},this.addHistoryEntry(D))),this._trigger("refresh"),this._isRefreshTriggered=!0,!l||e.isPhase||e.isLane||this._selectedSymbol&&!this._endEditing||(c.state="changed",this._raiseEvent(d+"CollectionChange",c))}return delete this._isNewNode,l},_raiseCollectionChangeEvent:function(e,t){var i={changeType:"insert",element:this.getNode(e),state:"changing"};return e.isPhase||this._selectedSymbol&&!this._endEditing||(this._raiseEvent(t+"CollectionChange",i),e._absolutePath=null),i},add:function(e,t){var i,a;return ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this)?(this._isNodeInitializing=!0,this._isNewNode=!0,i=ej.datavisualization.Diagram.Util.enableLayerOption({},"active",this),i&&(i=ej.datavisualization.Diagram.Layers(i),i.objects.indexOf(e.name)<0&&i.objects.push(e.name)),a=this._add(e,!0,t),delete this._isNodeInitializing,a):void 0},updateUserHandles:function(e){e=this.nameTable[e.name],ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,e,this._adornerSvg,!1,!1,this._currZoom,this)},scrollToNode:function(e){var t,i,a,n,o=this._vScrollbar&&this._vScrollbar._scrollData?this._vScrollbar._scrollData.buttonSize:0,s=this._hScrollbar&&this._hScrollbar._scrollData?this._hScrollbar._scrollData.buttonSize:0,r=this._currZoom,l=this.element[0].getBoundingClientRect(),d=ej.datavisualization.Diagram.Util.bounds(e);t=(d.x+d.width/2)*r,i=(d.y+d.height/2)*r,a=this._hScrollOffset,n=this._vScrollOffset,l.width+this._hScrollOffset<t+d.width/2*r&&(a=t+(d.width/2+o)*r-l.width),l.height+this._vScrollOffset<i+d.height/2*r&&(n=i+(d.height/2+s)*r-l.height),this._updateScrollOffset(a,n)},findNode:function(e){return this._findNode(e)},getObjectType:function(e){return ej.datavisualization.Diagram.Util.getObjectType(e)},_registerDrawingTools:function(){var e,t;for(e in this.model.drawingTools)t=this.model.drawingTools[e],t.diagram=this,this.tools[t.name]=t},_sortByXvalue:function(e){for(var t,i,a,n,o,s,r=0;r<e.length;r++)for(i=r+1;i<e.length;i++)o=this.nameTable[this._getChild(e[r])],s=this.nameTable[this._getChild(e[i])],a=ej.datavisualization.Diagram.Util.bounds(o),n=ej.datavisualization.Diagram.Util.bounds(s),(a.x>n.x||a.right>n.right)&&(t=e[r],e[r]=e[i],e[i]=t);return e},_sortByYvalue:function(e){for(var t,i,a,n,o,s,r=0;r<e.length;r++)for(i=r+1;i<e.length;i++)o=this.nameTable[this._getChild(e[r])],s=this.nameTable[this._getChild(e[i])],a=ej.datavisualization.Diagram.Util.bounds(o),n=ej.datavisualization.Diagram.Util.bounds(s),(a.y>n.y||a.bottom>n.bottom)&&(t=e[r],e[r]=e[i],e[i]=t);return e},_sortByZIndex:function(e,t){var i,a,n;if(t)for(a=0;a<e.length;a++)for(n=a+1;n<e.length;n++)e[a].zOrder>e[n].zOrder&&(i=e[a],e[a]=e[n],e[n]=i);else for(a=0;a<e.length;a++)for(n=a+1;n<e.length;n++)e[a].zOrder<e[n].zOrder&&(i=e[a],e[a]=e[n],e[n]=i);return e},_updateBPMNIndex:function(e,t){var i,a,n,o,s,r,l;if("bpmn"===e.type&&e.parent&&(o=this.nameTable[e.parent],o&&o.isLane))for(s=o.children,a=0;a<s.length;a++)for(n=a+1;n<s.length;n++)r=this.nameTable[this._getChild(s[a])],l=this.nameTable[this._getChild(s[n])],!(t?r.zOrder>l.zOrder:r.zOrder<l.zOrder)||r.isPhase||l.isPhase||r.isLane||l.isLane||(i=s[a],s[a]=s[n],s[n]=i)},_sortByGroupChildrenZIndex:function(e){for(var t,i,a,n,o,s,r,l=this.nodes(),d=0;d<l.length;d++)if(n=l[d],this._updateBPMNIndex(n,e),"group"===n._type&&"bpmn"!==n.type&&!n.isSwimlane){for(o=this._getChildren(n.children),i=0;i<o.length;i++)for(a=i+1;a<o.length;a++)s=this.nameTable[this._getChild(o[i])],r=this.nameTable[this._getChild(o[a])],!(e?s.zOrder>r.zOrder:s.zOrder<r.zOrder)||s.isPhase||r.isPhase||s.isLane||r.isLane||(t=o[i],o[i]=o[a],o[a]=t);n.children=o}},_findCornerNodes:function(){var e,t,i,a,n,o,s,r,l,d,h,c=this.selectionList[0].children,u=this.nameTable[this._getChild(this.selectionList[0].children[0])];if(e=u,t=u,i=u,a=u,c.length>1)for(n=0;n<c.length;n++)s=this.nameTable[this._getChild(c[n])],o=ej.datavisualization.Diagram.Util.bounds(s),r=ej.datavisualization.Diagram.Util.bounds(t),o.x+o.width>r.x+r.width&&(t=s),l=ej.datavisualization.Diagram.Util.bounds(a),o.y+o.height>l.y+l.height&&(a=s),d=ej.datavisualization.Diagram.Util.bounds(e),o.x<d.x&&(e=s),h=ej.datavisualization.Diagram.Util.bounds(i),o.y<h.y&&(i=s);return{left:e,right:t,top:i,bottom:a}},_comparePropertyOnAlign:function(e,t,i,a){e&&(e.segments?(this._comparePropertyValues(e,"sourcePoint",{sourcePoint:{x:e.sourcePoint.x+t,y:e.sourcePoint.y+i}},a),this._comparePropertyValues(e,"targetPoint",{targetPoint:{x:e.targetPoint.x+t,y:e.targetPoint.y+i}},a)):(e.offsetX!=e.offsetX+t&&this._comparePropertyValues(e,"offsetX",{offsetX:e.offsetX+t},null,a),e.offsetY!=e.offsetY+i&&this._comparePropertyValues(e,"offsetY",{offsetX:e.offsetY+i},null,a)))},_moveNode:function(e,t,i){this._comparePropertyOnAlign(i,e,t,ej.datavisualization.Diagram.ActionType.Align),this._translate(i,e,t,this.nameTable),this._updateNodeMargin(i),ej.datavisualization.Diagram.DiagramContext.update(i,this)},_updateContainerOnNudge:function(e){var t=this.nameTable[e.parent];t&&t.container&&(ej.datavisualization.Diagram.canvasHelper._updateNodeMargin(this,e,t),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0))},_outOfBoundsOnNudge:function(e,t,i){var a,n,o,s,r=this.nameTable[this._getChild(e.parent)];if(!(r&&r.isLane&&r.parent))return s=this.tools.move,s._outOfBoundsDrag(e,t,i);if(a=this.nameTable[this._getChild(r.parent)],a&&a.isLaneStack&&a.parent&&(n=this.nameTable[this._getChild(a.parent)],n&&"infinity"!=this.model.pageSettings.boundaryConstraints)){var l=ej.datavisualization.Diagram.Util.bounds(r),d=ej.datavisualization.Diagram.Util.bounds(e),h=ej.datavisualization.Diagram.Util.bounds(n),c=h.right,u=h.bottom;if(d.bottom+i+20>=l.bottom&&(u+=i),d.right+t+20>=l.right&&(c+=t),o=this.activeTool._getPageBounds(),i>0&&h.bottom!=u&&u>o.height||t>0&&h.right!=c&&c>o.width)return!1}return!0},_anyFromSwimlane:function(e){if(e.parent){var t=this.nameTable[e.parent];return t&&t.container&&t.isLane?this._getSwimlane(t):this._anyFromSwimlane(t)}return null},_nudge:function(e,t,i,a,n,o){var s,r,l,d,h,c;if(!(e&&e.segments&&e.sourceNode&&e.targetNode)){var u,g,m=this.nameTable[e.parent];if("label"!==e._type){if(this._outOfBoundsOnNudge(e,t,i)){if(!n)if(e.segments)g={element:e,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:"sourcePoint",oldValue:{sourcePoint:e.sourcePoint},newValue:{sourcePoint:{x:e.sourcePoint.x+t,y:e.sourcePoint.y+i}}},this._raisePropertyChange(g),g={element:e,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:"targetPoint",oldValue:{targetPoint:e.targetPoint},newValue:{targetPoint:{x:e.targetPoint.x+t,y:e.targetPoint.y+i}}},this._raisePropertyChange(g);else{var p="right"===a||"left"===a?e.offsetX:e.offsetY,f="right"===a||"left"===a?e.offsetX+t:e.offsetY+i,v="right"===a||"left"===a?"offsetX":"offsetY";g={element:e,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:a,propertyName:v,oldValue:p,newValue:f},this._raisePropertyChange(g)}if(d=this.nameTable[e.parent],d&&d.isLane&&(s=this._moveOnLane(e,d,t,i)),!s||s.proceedY||(i=0),!s||s.proceedX||(t=0),"pseudoGroup"==e.type){for(r=this._removeContainerConnector(this._getChildren(e.children)),r=this._sortByYvalue(r),r=this._sortByXvalue(r),l=r.length-1;l>=0&&(u=this.nameTable[this._getChild(r[l])],!u||this._nudge(u,t,i,a,!0,0===l));l--);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(this,u),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.Util._updateGroupBounds(e,this)}else this._translate(e,t,i,this.nameTable,undefined,undefined,!0),o||e.parent&&(d=this.nameTable[e.parent],h=this._anyFromSwimlane(e),h&&h.isSwimlane&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0)),this._updateContainerOnNudge(e);if(this._updateNodeMargin(e),e.parent){if(d=this.nameTable[e.parent],d&&d.container&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,"canvas"===d.container.type&&ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,d),delete this._disablePhaseUpdate,h=this._anyFromSwimlane(e),h&&(ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,h),this._updateSwimlanes||(this._updateSwimlanes=[]),this._collectionContains(h.name,this._updateSwimlanes)||this._updateSwimlanes.push(h.name),n||(delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(h,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,h,!0)))),o&&this._updateSwimlanes){for(delete this._disableSwimlaneUptate,c=0;c<this._updateSwimlanes.length;c++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[c]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[c]]);delete this._updateSwimlanes}}else if(o&&this._updateSwimlanes){for(c=0;c<this._updateSwimlanes.length;c++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[c]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[c]]);delete this._updateSwimlanes}else"pseudoGroup"!=e.type&&ej.datavisualization.Diagram.DiagramContext.update(e,this);return this._updateSelectionHandle(!0),!0}return!1}return m=this.findNode(e._parent),this.translateLabel(m,e,t,i),ej.datavisualization.Diagram.DiagramContext.update(e,this),this._updateSelectionHandle(!0),!0}},_removeContainerConnector:function(e){var t,i,a=[];if(e&&e.length>0)for(t=0;t<e.length;t++)i=this.nameTable[this._getChild(e[t])],i&&!i.segments?a.push(e[t]):!i.segments||i.sourceNode||i.targetNode||a.push(e[t]);return a},_moveOnLane:function(e,t,i,a){var n,o,s,r=!1,l=0,d=!1,h=0;return i=i?i:0,a=a?a:0,t.children&&t.children.length>0&&(n=this.nameTable[this._getChild(t.children[0])],n&&-1!=n.name.indexOf("_Headerr")&&("horizontal"===t.orientation?l=n.width:"vertical"===t.orientation&&(h=n.height))),e&&t?(o=ej.datavisualization.Diagram.Util.bounds(e),s=ej.datavisualization.Diagram.Util.bounds(t),o.y+a>=s.y+t.paddingTop+h&&(r=!0),o.x+i>=s.x+t.paddingLeft+l&&(d=!0),{proceedY:r,proceedX:d,x:s.x+t.paddingLeft+l-o.x+i,y:s.y+t.paddingTop+h-o.y+a}):void 0},_selectCommand:function(e){this._isEditing&&(this._endEdit(),document.getElementById(this._id).focus()),e.keyDownEventArgs.preventDefault(),this.selectAll()},_nudgeCommand:function(e){!this._currentState&&this.selectionList[0]&&(this._currentState={x:this.selectionList[0].offsetX,y:this.selectionList[0].offsetY}),this.nudge(e.parameter,e.keyDownEventArgs.shiftKey?5:1),e.keyDownEventArgs.preventDefault()},_startEditCommand:function(){var e,t,i;this.selectionList.length>0&&(e=this.selectionList[0],"pseudoGroup"==e.type||("text"===e.type&&this._setLabelEditing(e.textBlock)&&this._startEdit(e),e.isSwimlane?(t=this.nameTable[e.name+"_header_swimlane"],t&&this._startEdit(t)):e.isLane?e.children&&e.children.length>0&&(t=this.nameTable[this._getChild(e.children[0])],t&&this._startEdit(t)):e.type&&"phase"===e.type?(i=this.nameTable["phaseStack"+e.name],i&&this._startEdit(i)):e.labels.length>0&&this._setLabelEditing(e.labels[0])&&this._startEdit(e)))},_findObjectByName:function(e){var t=null;return this._findNode(e)&&(t=this._findNode(e)),this._findConnector(e)&&(t=this._findConnector(e)),t},_findObjectByIndex:function(e,t){var i,a,n,o,s,r=null;if(t){if(s=this.nameTable[this.selectionList[0].parent])for(i=this._getChildren(s.children),o=0;o<i.length;o++)a=this.nameTable[i[o]],a.zOrder===e&&(r=i[o])}else{for(n=0;n<this.nodes().length;n++)a=this.nodes()[n],a.zOrder!==e||a._isProcessed||(r=a,a._isProcessed=!0);for(n=0;n<this.connectors().length;n++)a=this.connectors()[n],a.zOrder!==e||a._isProcessed||(r=a,a._isProcessed=!0)}return"string"==typeof r?this.nameTable[r]:r},_findOverlapNode:function(e,t){var i,a,n,o,s,r,l,d=[],h=[];if(e.parent){if(n=ej.datavisualization.Diagram.Util.bounds(e),o=this.nameTable[e.parent])for(r=this._getChildren(o.children),i=0;i<r.length;i++)r[i]!==e.name&&(s=this.nameTable[r[i]],l=ej.datavisualization.Diagram.Util.bounds(s),s&&this._intersect(n,l)&&h.push(s))}else{for(i=0;i<this.nodes().length;i++)d.push(this.nameTable[this._getChild(this.nodes()[i])]);for(i=0;i<this.connectors().length;i++)d.push(this.nameTable[this._getChild(this.connectors()[i])]);if("sendToBack"===t||"bringToFront"===t)return d;if(n=ej.datavisualization.Diagram.Util.bounds(e),e)for(a=0;a<d.length;a++)l=ej.datavisualization.Diagram.Util.bounds(d[a]),e.name===d[a].name||e.children&&this._collectionContains(d[a].name,e.children)||this._intersect(n,l)&&h.push(d[a])}return h},_intersect:function(e,t){return e.x<=t.x+t.width&&t.x<=e.x+e.width&&e.y<=t.y+t.height&&t.y<=e.y+e.height},_focusToItem:function(e){var t,i=this.nodes(),a=this.connectors(),n=0,o=[],s=this;if(i.length||a.length){this._diagramElements||(o=this.nodes().concat(this.connectors()),o=this._sortByZIndex(o,!0),o=o.map(function(e){return e.name}),this._diagramElements=o),n=this._focusedElement||this.selectionList.length||!this._diagramElements.length?this._focusedElement?this._diagramElements.indexOf(this._focusedElement):"pseudoGroup"!=this.selectionList[0].type?this._diagramElements.indexOf(this.selectionList[0].name):Math.min.apply(Math,this.selectionList[0].children.map(function(e){return s._diagramElements.indexOf(e.name||e)})):e.keyDownEventArgs.shiftKey?0:this._diagramElements.length-1;do n=e.keyDownEventArgs.shiftKey?0!=n?--n:this._diagramElements.length-1:n!=this._diagramElements.length-1?++n:0,"pseudoGroup"!=this.nameTable[this._diagramElements[n]].type&&(this._focusedElement=this._diagramElements[n]);while(!ej.datavisualization.Diagram.Util.canSelect(this.nameTable[this._focusedElement])&&ej.datavisualization.Diagram.Util.enableLayerOption(this.nameTable[this._focusedElement],"lock",this));t=ej.datavisualization.Diagram.Util.bounds(this.nameTable[this._focusedElement]),t={x:t.x-8,y:t.y-8,width:t.width+16,height:t.height+16},this.bringIntoView({x:t.x-25,y:t.y-25,width:t.width+50,height:t.height+50}),ej.datavisualization.Diagram.SvgContext._drawNavigationHighlighter(t,this._adornerSvg,this._adornerLayer,this._currZoom),e.keyDownEventArgs.preventDefault()}},_selectFocusedItem:function(e){ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);var t=this.nameTable[this._focusedElement];this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Keydown,t&&this.addSelection(t,!0),this._diagramElements=null,this._focusedElement=null,e.keyDownEventArgs.preventDefault()},_createDefaultTooltip:function(){var e,t=document.createElement("div"),i={id:this.element[0].id+"_DefaulttooltipDiv","class":"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(t,i),this._tooltipLayer.appendChild(t),this.model.tooltipTemplateId||(e=document.createElement("span"),i={"class":"e-diagram-tooltipLabel-default",id:"e-diagram-tooltipLabel-default"},ej.datavisualization.Diagram.Util.attr(e,i),t.appendChild(e)),t},_createMouseOverTooltip:function(){var e=document.createElement("div"),t={id:this.element[0].id+"_mouseovertooltipDiv","class":"e-diagram-tooltip-mouseover",style:"pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(e,t),this._tooltipLayer.appendChild(e),e},_renderTooltip:function(e,t){var i,a,n,o,s,r,l,d;e.parent&&this.nameTable[e.parent]&&this.nameTable[e.parent].container||this.model.selectedItems.tooltip&&(i=document.getElementById(this.element[0].id+"_DefaulttooltipDiv"),i||(i=this._createDefaultTooltip()),r=this._currZoom,this.model.selectedItems.tooltip.templateId?$.templates&&this.model.selectedItems.tooltip&&(e.segments||(d=this._getTooltipPosition(e,this.model.selectedItems.tooltip),d.x=-this._hScrollOffset+d.x*r,d.y=-this._vScrollOffset+d.y*r,i.style.top=d.y+"px",i.style.left=d.x+"px",i.style.transform="translate("+d.tx+" ,"+d.ty+")",a=$.templates("#"+this.model.selectedItems.tooltip.templateId),o=a.render(e),$(i).html(o))):(t&&(i.style.width="150px"),s=150,l=i.childNodes[0],this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?e.segments||(n="X : "+Math.round(e.offsetX-e.width*e.pivot.x)+"px  Y : "+Math.round(e.offsetY-e.height*e.pivot.y)+"px"):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?n="W : "+Math.round(e.width)+"px  H : "+Math.round(e.height)+"px":this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(t&&(i.style.width="50px"),s=50,n=Math.round(e.rotateAngle)+"°"),n?(d=this._getTooltipPosition(e,this.model.selectedItems.tooltip),d.x=-this._hScrollOffset+d.x*r,d.y=-this._vScrollOffset+d.y*r,i.style.top=d.y+"px",i.style.left=d.x+"px",i.style.transform="translate("+d.tx+" ,"+d.ty+")",l.textContent=n):this._removeTooltip()))},_removeTooltip:function(){var e=document.getElementById(this.element[0].id+"_DefaulttooltipDiv");e&&e.parentNode.removeChild(e)},_removeMouseOverTooltip:function(){var e=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");e&&e.parentNode.removeChild(e)},_renderCanvas:function(e){this._browserInfo=ej.browserInfo(),this._canvas=document.getElementById(this.element[0].id+"_canvas"),this._canvas||(this._canvas=document.createElement("div"),this.element.append(this._canvas)),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),(null===this._canvas.getAttribute("class")||""===this._canvas.getAttribute("class"))&&this._canvas.setAttribute("class","drawing"),this._canvas.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";"),this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width}),this._views[this._id].canvas=this._canvas,this.element[0].setAttribute("tabindex","0"),this._renderDiagram(e),ej.datavisualization.Diagram.Util.canFloatElements(this)&&this._setItemDraggable(this._canvas)},_getDigramBounds:function(e){var t,i,a,n,o;return t=this._spatialSearch.pageLeft||0,i=this._spatialSearch.pageTop||0,a=this._spatialSearch.pageRight-this._spatialSearch.pageLeft||0,n=this._spatialSearch.pageBottom-this._spatialSearch.pageTop||0,"content"!=e&&(this.model.pageSettings&&this._multiplePage()?(t=this._spatialSearch.pageLeft,
i=this._spatialSearch.pageTop,this._pageWidth()&&(t=Math.floor(t/this._pageWidth())*this._pageWidth(),a=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-t),this._pageHeight()&&(i=Math.floor(i/this._pageHeight())*this._pageHeight(),n=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-i),null===this._spatialSearch.pageRight&&0!==this._pageWidth()&&(a=this._pageWidth()),null===this._spatialSearch.pageBottom&&0!==this._pageHeight()&&(n=this._pageHeight())):(this._pageWidth()&&(t=0,a=this._pageWidth()),this._pageHeight()&&(i=0,n=this._pageHeight()))),o=new ej.datavisualization.Diagram.Rectangle,o.x=t,o.y=i,o.width=a,o.height=n,o},_initContextMenu:function(e){this.enableContextMenu()?this._renderContextMenu(e):$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(e){var t,i,a,n,o,s,r=document.createElement("li"),l=document.createElement("a"),d=ej.datavisualization.Diagram.Locale[this.locale()];if(d||(d=ej.datavisualization.Diagram.Locale["en-US"]),l.innerHTML=d[e.name]||e.text,r.setAttribute("id",this.element[0].id+"_contextMenu_"+e.name),t=document.createElement("span"),t.setAttribute("id",e.name+"_image"),i="display:table-cell; vertical-align:middle; text-align:center;",e.imageUrl&&(i=i+"background-image: url("+e.imageUrl+");width:25px;height:25px"),t.setAttribute("style",i),a="sf-d-menuitem "+e.name,e.cssClass&&(a=a+" "+e.cssClass),t.setAttribute("class",a),l.appendChild(t),e.subItems&&e.subItems.length>0){for(n=document.createElement("ul"),o=0;o<e.subItems.length;o++)s=this._renderContextMenuItem(e.subItems[o],n),s.setAttribute("style","display:block;"),n.appendChild(s);r.appendChild(n)}return r.appendChild(l),r},_renderContextMenu:function(){var e,t,i,a,n,o,s,r,l=$.extend(!0,[],this.model.contextMenu.items);if(!this.model.contextMenu.showCustomMenuItemsOnly){for(e=[],a=0;a<this._defaultContextMenuItems.length;a++)if(t=!1,this.model.contextMenu.items.length)for(i=0;i<this.model.contextMenu.items.length;i++){if(this.model.contextMenu.items[i].name===this._defaultContextMenuItems[a].name){t=!0;break}i!==this.model.contextMenu.items.length-1||t||e.push(this._defaultContextMenuItems[a])}else e.push(this._defaultContextMenuItems[a]);for(a=0;a<e.length;a++)l.push(e[a])}for(a=0,s=document.createElement("ul"),s.setAttribute("id",this.element[0].id+"_contextMenu"),a=0;a<l.length;a++)n=l[a],n.templateId?(r=this._renderEjTemplate("#"+n.templateId,n),r&&(s.innerHTML=r)):n&&n.name&&(o=this._renderContextMenuItem(n,s),s.appendChild(o));this._canvas.appendChild(s),$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)}),$("#"+this.element[0].id+"_contextMenu")[0].style.display="none"},_onContextMenuClose:function(e){if(this.model.contextMenuClose){var t={diagram:this,contextMenu:e};this._trigger("contextMenuClose",t)}else this.element[0].focus()},_onContextMenuOpen:function(e){var t,i,a,n;return e.events&&!e.events.originalEvent&&(e.events.originalEvent=e.events),this.activeTool.mouseup&&("textTool"==this.activeTool.name?(this._endEdit(),this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()):this.activeTool.mouseup(e.events,!0)),this._disableDefaultContextMenu?(delete this._disableDefaultContextMenu,!1):(t=this.element[0].id,i=this._findNodeUnderMouse(e),null===i&&e.target&&"segmentEnd"===$(e.target).attr("class")&&this.selectionList[0]&&(i=this.selectionList[0]),a=!1,$(e.target).parents(".e-scrollbar").length&&this.enableContextMenu()&&(e.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance").hideContextMenu()),this.selectionList[0]&&("pseudoGroup"===this.selectionList[0].type||"group"===this.selectionList[0]._type)&&(a=!0),i||!(this.selectionList.length>0)||a||this.activeTool&&"textTool"==this.activeTool.name||this._clearSelection(),this.enableContextMenu()&&($("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_copy")[0]&&($("#"+t+"_contextMenu_copy")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_paste")[0]&&($("#"+t+"_contextMenu_paste")[0].style.display=this._clipboardData?"block":"none"),$("#"+t+"_contextMenu_undo")[0]&&($("#"+t+"_contextMenu_undo")[0].style.display=this._historyList&&this._historyList.canUndo?"block":"none"),$("#"+t+"_contextMenu_redo")[0]&&($("#"+t+"_contextMenu_redo")[0].style.display=this._historyList&&this._historyList.canRedo?"block":"none"),$("#"+t+"_contextMenu_selectAll")[0]&&($("#"+t+"_contextMenu_selectAll")[0].style.display=this.nodes().length+this.connectors().length?"block":"none"),$("#"+t+"_contextMenu_grouping")[0]&&($("#"+t+"_contextMenu_grouping")[0].style.display=!this.selectionList[0]||"group"!=this.selectionList[0].type&&"pseudoGroup"!=this.selectionList[0].type?"none":"block"),$("#"+t+"_contextMenu_order")[0]&&($("#"+t+"_contextMenu_order")[0].style.display=this.selectionList.length?"block":"none")),n={diagram:this,contextMenu:e,contextmenu:e},n.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuBeforeOpen",n),void(this.enableContextMenu()&&($("#"+t+"_contextMenu")[0].style.display="block",$("#"+t+"_contextMenu")[0].clientHeight<=2&&(e.cancel=!0),$("#"+t+"_contextMenu")[0].style.display="none")))},_onMenuItemClick:function(e){var t=e.events.ID.replace(this._id+"_contextMenu_","");if(e.canExecute=!0,e.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuClick",e),e.canExecute)switch(t){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}},_onMenuItemMouseOver:function(e){var t=e.events.element.lastChild.childNodes[1];$(t).addClass("hover")},_onMenuItemMouseOut:function(e){var t=e.events.element.lastChild.childNodes[1];$(t).removeClass("hover")},_renderDiagram:function(e){var t=this;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._doLayout(),this._views.forEach(function(i){var a,n=t._views[i];"mainview"==n.type&&n.context==ej.datavisualization.Diagram.SvgContext&&(n.context._renderDocument(n,t,e),t._createScrollbar(t._canvas,t),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(t),ej.datavisualization.Diagram.PageUtil._updatePageSize(t)),e||(a=t._setNodeZOrder(n),t._renderDiagramObjects(a,n))}),$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(e,t){var i,a=document.createElement("div");a.setAttribute("id",e.id+"_hScrollbar"),document.getElementById(e.id+"_hScrollbar")||t._svgParent.appendChild(a),i=document.createElement("div"),i.setAttribute("id",e.id+"_vScrollbar"),document.getElementById(e.id+"_vScrollbar")||t._svgParent.appendChild(i)},_disableScrollbar:function(){this._isMobile&&($("#"+this._hScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}),$("#"+this._vScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}))},_doLayout:function(){this.model.layout&&this._layoutType()!==ej.datavisualization.Diagram.LayoutTypes.None&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this))},_updateNodes:function(){for(var e=this.nodes(),t=0;t<e.length;t++)ej.datavisualization.Diagram.DiagramContext.update(e[t],this)},_updateConnectors:function(){for(var e=this.connectors(),t=0;t<e.length;t++)ej.datavisualization.Diagram.DiagramContext.update(e[t],this)},_updateEdgeCollection:function(){for(var e=0;e<this.connectors().length;e++)this._updateEdges(this.connectors()[e])},updateViewPort:function(){this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),ej.datavisualization.Diagram.DiagramContext.updateViewPort(this),this.model.scrollSettings.viewPortHeight=this._viewPort.height,this.model.scrollSettings.viewPortWidth=this._viewPort.width;var e=this;this._views.forEach(function(t){var i,a=e._views[t];"overview"==a.type&&(i=$("#"+t).ejOverview("instance"),i&&i._scrollOverviewRect(e._hScrollOffset,e._vScrollOffset,e._currZoom))}),ej.datavisualization.Diagram.ScrollUtil._updateRuler(this,e._hScrollOffset,e._vScrollOffset)},_containsSameIndex:function(e,t){var i,a,n,o,s,r,l;if(t){for(s=t.children,l=0;l<s.length;l++)if(r=this.nameTable[this._getChild(s[l])],r&&r.zOrder&&r.zOrder===e)return!0}else{for(i=this.nodes(),l=0;l<i.length>0;l++)if(a=i[l],a&&a.zOrder===e)return!0;for(n=this.connectors(),l=0;l<n.length>0;l++)if(o=n[l],o&&o.zOrder===e)return!0}return!1},_setZorder:function(e){var t,i,a;if(e&&e.zOrder){if(-1==e.zOrder)if(this._containsSameIndex(this._zOrder)){do this._zOrder++;while(this._containsSameIndex(this._zOrder));e.zOrder=this._zOrder}else e.zOrder=this._zOrder,this._zOrder++;if("group"===e._type)for(t=e.children,a=0;a<t.length;a++)i=this.nameTable[this._getChild(t[a])],i&&i.zOrder&&-1===i.zOrder&&this._setZorder(i)}},_union:function(e,t){var i=Math.min(e.x,t.x),a=Math.min(e.y,t.y),n=Math.max(e.x+e.width,t.x+t.width),o=Math.max(e.y+e.height,t.y+t.height);return new ej.datavisualization.Diagram.Rectangle(i,a,n-i,o-a)},_getSeperetor:function(e){return this.nameTable[e]},_updateNextPhase:function(e,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._updateNextPhase(this,e,t,i)},_getOuterNodes:function(e,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getOuterNodes(this,e,t,i)},_getInnerNodes:function(e,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getInnerNodes(this,e,t,i)},_moveOuterNodes:function(e,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOuterNodes(this,e,t,i)},_moveOnPhaseChange:function(e,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOnPhaseChange(this,e,t,i)},_getPhaseDifferece:function(e,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseDifferece(this,e,t,i)},_updatePhaseOffset:function(e){var t,i,a,n=this.nameTable[e.name],o=this.nameTable[n.parent],s=this._getChildren(o.children),r=s.indexOf(n.name);s&&s.length>0&&r>-1&&e.offset!=undefined&&(t=this.nameTable[s[r]],i=e.offset-n.offset,a=this.nameTable[o.parent],i=this._getPhaseDifferece(a,r,i),this._moveOuterNodes(a,i,r),0===r?"horizontal"===n.orientation?(n.width+=i,n.offset=n.width,this._comparePropertyValues(a,"offsetX",{offsetX:a.offsetX+i/2},this.activeTool.inAction)):(n.height+=i,n.offset=n.height,this._comparePropertyValues(a,"offsetY",{offsetY:a.offsetY+i/2},this.activeTool.inAction)):"horizontal"===n.orientation?(n.width+=i,n.offset+=i,this._comparePropertyValues(a,"offsetX",{offsetX:a.offsetX+i/2},this.activeTool.inAction)):(n.height+=i,n.offset+=i,this._comparePropertyValues(a,"offsetY",{offsetY:a.offsetY+i/2},this.activeTool.inAction)),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._moveOnPhaseChange(n,i,r),this._updateNextPhase(a,i,r),delete this._disablePhaseUpdate,delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,a))},_updatePhase:function(e){var t=this.nameTable[e.name];t&&(t.offset!=undefined&&e.offset!=undefined&&e.offset!=t.offset&&(this._comparePropertyValues(t,"offset",{offset:e.offset},this.activeTool.inAction),this._updatePhaseOffset(e),this._hasSelection()&&this._clearSelection(!0)),this._updateSwimlanePhase(t,e))},_setNodeZOrder:function(){for(var e,t,i,a,n,o,s,r=null,l=this.nodes(),l=l.concat(this.connectors()),d=0;d<l.length;d++)""===l[d].parent&&this._setZorder(l[d]);for(e=0;e<l.length;e++){for(t=e+1;t<l.length;t++)l[e].zOrder>l[t].zOrder&&""===l[e].parent&&""===l[t].parent&&(r=l[e],l[e]=l[t],l[t]=r);if("group"===l[e]._type&&(i=l[e].children,!l[e].isSwimlane))for(a=0;a<i.length;a++)for(n=a+1;n<i.length;n++)o="object"==typeof i[a]?i[a]:this.nameTable[i[a]],s="object"==typeof i[n]?i[n]:this.nameTable[i[n]],!(o.zOrder>s.zOrder)||o.isPhase||s.isPhase||o.isLane||s.isLane||(r=i[a],i[a]=i[n],i[n]=r)}return l},_renderDiagramObjects:function(e,t,i,a){var n,o,s,r,l=[],d=[];for(this._initLayer(),r=0,n=e.length;n>r;++r)"node"===this.getObjectType(e[r])||"group"===this.getObjectType(e[r])?(o=this.nameTable[e[r].name],o&&this._outOfBoundsOnNudge(o,0,0)?(this._isLoad&&(this._disableSegmentChange=!0),ej.datavisualization.Diagram.DiagramContext._renderNodeObject(o,t,i,a,this),this._isLoad&&delete this._disableSegmentChange,this._updateQuad(o)):l.push(r)):(s=this.nameTable[e[r].name]||e[r],s&&this._outOfBoundsOnNudge(s,0,0)?(ej.datavisualization.Diagram.DiagramContext._renderConnectorObject(s,t,this),this._updateQuad(s)):d.push(r));if(l.length>0||d.length>0){if(l.length>0){for(r=l.length-1;r>=0;r--)this._removeFromNameTable(this.nodes()[r]),this.nodes().splice(r,1);this._nodes=$.extend(!0,[],this.nodes())}if(d.length>0){for(r=d.length-1;r>=0;r--)this._removeFromNameTable(this.connectors()[r]),this.connectors().splice(r,1);this._connectors=$.extend(!0,[],this.connectors())}}},_removeFromNameTable:function(e){var t,i;if(e&&"group"===e._type)for(t=0;t<e.children.length;t++)i=e.children[t],"group"===i._type?this._removeChildrenFromNameTable(i):delete this.nameTable[this._getChild(i)];delete this.nameTable[this._getChild(e)]},_unWireEvents:function(){var e=$(this._canvas);this._off(e,ej.eventType.mouseDown,this._mousedown),this._off(e,ej.eventType.mouseMove,this._mousemove),this._off(e,ej.eventType.mouseUp,this._mouseup),this._off(e,ej.eventType.mouseLeave,this._documentmouseup),this._off(e,"doubletap",this._doubleclick),this._off(this.element,"keydown",this._keydown),this._off(this.element,"keyup",this._keyup),this._off(e,"pinchin",this._pinchin),this._off(e,"pinchout",this._pinchout),this._off(this.element,"touchstart",this._handleTouchStart),"mozilla"===ej.browserInfo().name?this._off(this.element,"DOMMouseScroll",this._handleMouseWheel):this._off(this.element,"mousewheel",this._handleMouseWheel),this._off($(document),"mouseup",this._documentmouseup),window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._off($(window),"resize",this.updateViewPort)},_wireEvents:function(){var e,t=$(this._canvas);this._on(t,ej.eventType.mouseDown,this._mousedown),this._on(t,ej.eventType.mouseMove,this._mousemove),this._on(t,ej.eventType.mouseUp,this._mouseup),this._on(t,ej.eventType.mouseLeave,this._documentmouseup),this._on(t,"doubletap",this._doubleclick),this._on(this.element,"keydown",this._keydown),this._on(this.element,"keyup",this._keyup),this._on(this.element,"contextmenu",this._preventDefaultContextMenu),this._on(t,"pinchin",this._pinchin),this._on(t,"pinchout",this._pinchout),this._on(this.element,"touchstart",this._handleTouchStart),"mozilla"===ej.browserInfo().name?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel),this._on($(document),"mouseup",this._documentmouseup),window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._on($(window),"resize",this.updateViewPort),e=this,$(t).ejDroppable({over:function(t){e._isDropOver=!0;var i=!1;t.originalEvent&&t.originalEvent.changedTouches?i=!0:t&&t.changedTouches&&(i=!0),i||e.activeTool.inAction===!1&&e._selectedSymbol&&(e._viewPort||(e._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(e,!0)),e._addSymbolToDiagram(t),e._isSvgDropover=!0)},out:function(){delete e._isDropOver},drop:function(t,i){e._svgdrop(t,i),e._isDropped=!0}})},_preventDefaultContextMenu:function(e){return this._disableDefaultContextMenu?(e.preventDefault(),e.stopPropagation(),delete this._disableDefaultContextMenu,!1):void 0},_mousePosition:function(e,t){var i=this._isTouchEvent(e),a=this._scrollLeft!==undefined?this._scrollLeft:this._canvas.scrollLeft,n=this._scrollTop!==undefined?this._scrollTop:this._canvas.scrollTop,o=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),s=i.clientX+a-o.left,r=n+i.clientY-o.top,l=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);return t||(s=(s+this._hScrollOffset-l.left)/this._currZoom,r=(r+this._vScrollOffset-l.top)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(100*s)/100,Math.round(100*r)/100)},_contextmenu:function(e){e.preventDefault(),e.stopPropagation()},_pinchin:function(e){this._getTouchEvent(e),e.preventDefault()},_pinchout:function(e){this._getTouchEvent(e),e.preventDefault()},_handleTouchStart:function(e){this._getTouchEvent(e),e.preventDefault()},_getTouchEvent:function(e){this._isTouchedEvent="touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type},_getvalues:function(e){var t,i,a,n=($(e.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),e.target.id.split("_"));return t=this.findNode(n[0]),i=this._mousePosition(e),a=this._findPortAtPoint(i,t),{source:a,action:ej.datavisualization.Diagram.ActiveTool}},_mousedown:function(e){var t,i,a,n,o;this._getTouchEvent(e),this._isPinching=!1,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._diagramElements=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer),this._invoke(e)&&(this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),t=this._mousePosition(e),i=this._isForeignObject(e.originalEvent.target),(i||this._isHyperLink(e))&&!this._isForeignEvent(e)||e.preventDefault(),this.model.contextMenu&&"none"!==$("#"+this.element[0].id+"_contextMenu").css("display")&&(e.cancel=!0),this._isEditing&&(this._endEdit(),"textTool"===this.activeTool.name&&this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()),(1===e.which||3===e.which||0===e.which&&e.originalEvent.changedTouches)&&(this._removeMouseOverTooltip(),0===e.which&&e.originalEvent.changedTouches&&(a=null,n=this._isUserHandle(e),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(n||(a=this._findNodeUnderMouse(e),this._raiseMouseEvents(a,t)),!a&&this.selectionList[0]&&(a=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(e,a))),(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&e.shiftKey&&(a=this._findNodeUnderMouse(e),!a&&this.selectionList[0]&&(a=this.selectionList[0]),this._checkToolToActivate(e,a)),"panTool"===this._toolToActivate?this.activeTool=this.tools[this._toolToActivate]:("move"===this._toolToActivate&&(a=this._findNodeUnderMouse(e),a&&a.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(a)&&(this._toolToActivate="select",this._currentCursor="default",this._updateCursor())),o=this.tools[this._toolToActivate]||this.activeTool,this.activateTool(this._toolToActivate,o?o.singleAction:null)),this.activeTool.mousedown&&this.activeTool.mousedown(e),this.activeTool._findNodeUnderMouse&&(this._focusedElement=this.activeTool._findNodeUnderMouse(e,!0))))},_getParentNode:function(e){var t,i=this.findNode(e);return i.parent&&(t=this.findNode(i.parent),t.parent&&this._getParentNode(t.name)),t.name},_getDiagramElements:function(e){return e&&(e.isSwimlane||e.isLane)&&(e=this.getNode(e)),e},_mousemove:function(e){var t,i,a,n,o,s,r,l,d,h,c;if(this._getTouchEvent(e),this._mouseEventTriggered=!0,this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),"touchmove"==e.type&&e.originalEvent.touches.length>1)this._isPinching=!0;else if(this._isPinching=!1,o=null,t=this._isUserHandle(e),this.activeTool.inAction===!1&&this._selectedSymbol)this._previousData=null,this._addSymbolToDiagram(e);else{if(this.activeTool.inAction&&"move"===this.activeTool.name&&this.selectionList[0]&&(i=this._findNodeUnderMouse(e),this.nameTable[this._previousData]&&(!i||this._previousData!=(i._isHeader?i.parent:i.name))&&(this.nameTable[this._previousData].parent&&(a=this._getParentNode(this.nameTable[this._previousData].name)),n={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(a)?a:null},this._raiseEvent("dragLeave",n),this._previousData=null),i&&this._previousData&&this.nameTable[this._previousData]!==(i._isHeader?this.nameTable[i.parent]:i)&&(this._previousData=i._isHeader?i.parent:i.name,this.nameTable[this._previousData].parent&&(a=this._getParentNode(this.nameTable[this._previousData].name)),n={element:this._getDiagramElements(this.selectionList[0]),target:this._getDiagramElements(this.nameTable[this._previousData]),targetType:this.getObjectType(this.nameTable[this._previousData]),actualObject:this.findNode(a)?a:null},this._raiseEvent("dragEnter",n))),o=ej.datavisualization.Diagram.Util.isClassifier(e)?ej.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(e,this):this._findNodeUnderMouse(e),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(t||o&&(this._nodeUnderMouse&&this._nodeUnderMouse!=o&&!this._nodeUnderMouse.segments&&this.activeTool._showPort(this._nodeUnderMouse,!0),o.segments||this.activeTool._showPort(o)),!o&&this.selectionList[0]&&(o=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(e,o),1==e.which&&1==e.buttons&&(this._focusedElement=this.activeTool._findNodeUnderMouse(e,!0))):(s=!0,this._activatedFromPort&&!this.activeTool.inAction&&(l=null,this._nodeUnderMouse&&!this._nodeUnderMouse.segments&&(r=this._mousePosition(e),l=this._findPortAtPoint(r,this._nodeUnderMouse)),l&&(!l||l.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag)||(ej.datavisualization.Diagram.SvgContext._removePortHighlighter(this._adornerSvg,this._adornerLayer),this.deactivateTool(),s=!1,delete this._activatedFromPort)),s&&(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),d=ej.datavisualization.Diagram.Util.isClassifier(e)?ej.datavisualization.Diagram.ClassifierHelper.getDropableElementUnderMouse(e,this):this._findNodeUnderMouse(e),o)),this._updateCursor(),d=d||this._findNodeUnderMouse(e),this.activeTool.mousemove&&this.activeTool.mousemove(e),this._raiseMouseEvents(d,e),h=!1,this.activeTool.inAction){do{if(!d||ej.datavisualization.Diagram.Util.canAllowDrop(d))break;if(d.parent)d=this.nameTable[d.parent];else{if(d.segments){h=!0;break}if(d.container)break;d=null}}while(d);this._nodeUnderMouse&&this._nodeUnderMouse.segments&&this._nodeUnderMouse!=d&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg),d&&d!=this._focusedElement&&d!=this.nodeUnderMouse&&(h||ej.datavisualization.Diagram.Util.canAllowDrop(d))?(c=this.getObjectType(d),this._focusedElement&&(this._focusedElement.isLane||this._focusedElement.isSwimlane||this._focusedElement.isPhase)&&"node"==c&&"connector"==c?this._nodeUnderMouse=null:this._nodeUnderMouse&&(this._nodeUnderMouse.isLane||this._nodeUnderMouse.isSwimlane||this._nodeUnderMouse.isPhase)&&d.segments||(this._nodeUnderMouse=d)):d&&d.container||(this._nodeUnderMouse=null)}else this._focusedElement||(this._nodeUnderMouse=d);this._initiateAutoScroll(e)}},_mouseup:function(e){var t,i,a,n,o,s,r,l,d,h,c;this._getTouchEvent(e),!this._isPinching&&e.originalEvent&&e.originalEvent.target&&this._invoke(e)&&(t=this._isForeignObject(e.originalEvent.target),!t&&this._isHyperLink(e)&&e.preventDefault(),this.activeTool instanceof ej.datavisualization.Diagram.PanTool?(document.onmousemove=null,document.onmouseup=null,(!ej.datavisualization.Diagram.Util.isPageEditable(this)||this.activeTool instanceof ej.datavisualization.Diagram.PanTool)&&!this.activeTool.inAction&&(s=this.activeTool._findNodeUnderMouse(e),s&&this._raiseEvent("itemClick",{actualObject:s,selectedObject:s,model:this.model,cancel:!1,event:e}),i=this._mousePosition(e.originalEvent),this._raiseEvent("click",{element:s,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(e),offsetX:i.x,offsetY:i.y,event:e}),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null))):e.target.id!==this._id+"_canvas_svg"||"panTool"!=!this.activeTool.name&&this.activeTool.inAction||(i=this._mousePosition(e.originalEvent),this._raiseEvent("click",{element:this,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(e),offsetX:i.x,offsetY:i.y,event:e})),e.target&&!this._isAnimating&&(a=$(e.target).parents(".ej-d-icon-template"),a&&a.length&&(n=a[0],n.id.endsWith("_expander")&&(o=n.id.replace("_expander",""),s=this.nameTable[o],s&&(r=this.getObjectType(s),("node"==r||"group"==r)&&(this.clearSelection(),ej.datavisualization.Diagram.LayoutUtil.expandSubTree(this,s,s.name,!0,ej.datavisualization.Diagram.Util.canSelect(s))))))),!this._selectedSymbol||this._selectedSymbol.isLane||this._isNodeEnters?this._selectedSymbol&&this._isNodeEnters&&(l=this.findNode(this.selectionList[0].name),this.edgeTable?delete this.edgeTable:(d={},d=this._getChildTable(this.selectionList[0],d),"pseudoGroup"==this._selectedSymbol.type?h={type:"collectionchanged",object:this._updatePsedoGroupChildren(this._selectedSymbol),childTable:jQuery.extend(!0,{},d),changeType:"insert",category:"internal"}:this._selectedSymbol.isPhase||(h={type:"collectionchanged",object:jQuery.extend(!0,{},this._selectedSymbol),childTable:jQuery.extend(!0,{},d),changeType:"insert",category:"internal"}),this.addHistoryEntry(h),this._isDragg=!0),this._clearSelection(!0),this._selectedSymbol=null,delete this._isNodeEnters,"pseudoGroup"==l.type&&(this.nodes().push(l),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[l.name]=l,ej.datavisualization.Diagram.Util._updateGroupBounds(l,this)),this._addSelection(l)):(this._findLabelEditing=!0,this._dropSymbol(null,e),delete this._findLabelEditing,this._isDragg=!0),"msie"===ej.browserInfo().name&&this._doubleClickEvent&&(this.activeTool._isMouseDown=!0),this.activeTool.mouseup?(this.activeTool.inAction||(this._isSelectMode=!0),this.activeTool.mouseup(e),delete this._isSelectMode):this._isInternalTool(this.activeTool)||(this._isUserHandle(e)&&(c=this.activeTool.cursor),this.deactivateTool()),this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||t||3===e.which&&this.enableContextMenu()||this.element[0].focus(),this._currentCursor=c?c:this.activeTool.cursor,"move"===this.activeTool.name&&this._focusedElement&&!ej.datavisualization.Diagram.Util.canSelect(this._focusedElement)&&ej.datavisualization.Diagram.Util.enableLayerOption(this._focusedElement,"lock",this)?(this._currentCursor="default",this._updateCursor()):this._updateCursor()),this._isSvgDropover&&($("#"+this.element[0].id+"_canvas").ejDroppable("instance")._mouseOver=!1),delete this._isSvgDropover,this._focusedElement=null,this._nodeUnderMouse=this._findNodeUnderMouse(e),delete this._scrollLeft,delete this._scrollTop,delete this._controlBBox,this._mouseEventTriggered=!1,this._isDragg=!1,delete this._viewPort,delete this._isDropOver,this._timeStamp=e.timeStamp},_doubleclick:function(e){var t,i,a,n,o,s;if(this._getTouchEvent(e),this._doubleClickEvent=!this._doubleClickEvent,n=this._nodeUnderMouse||this,t={element:this.getNode(n),cancel:!1,actualObject:this.getNode(this.activeTool.actualObject)},this._isEditing||this._raiseEvent("doubleClick",t),i=this.activeTool._drawingPolygon,"panTool"!=this.activeTool.name&&(this._nodeUnderMouse&&this.activeTool._doubleClick(this._nodeUnderMouse),ej.datavisualization.Diagram.Util.isClassifier(e)&&(a=ej.datavisualization.Diagram.ClassifierHelper.getEditableElementUnderMouse(e,this)),ej.datavisualization.Diagram.Util.isPageEditable(this)&&!this.activeTool.inAction&&(this.selectionList.length>0||a||this.activeTool.selectedObject)&&!t.cancel&&!i)){if(n=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0]?this.selectionList[0]:a,"umlclassifier"==n.type)for(o=0;o<n.children.length;o++)n.children[o]="string"==typeof n.children[o]?this.nameTable[n.children[o]]:n.children[o],o!=n.children.length-n.children.length&&o==n.children.length-1&&(n.children[o].labels[0].text="\n---\n"+n.children[o].labels[0].text),o!=n.children.length-n.children.length&&o==n.children.length-2&&(n.children[o].labels[0].text="\n---\n"+n.children[o].labels[0].text),n.labels[0].text+=n.children[o].labels[0].text;this._isEditing||"pseudoGroup"==n.type||t.cancel||(this.activeTool._findLabelUnderMouse(e,!1,this._mousePosition(e.originalEvent),!0),n.labels&&n.labels.length>0&&(s=this.activeTool.getLabelUnderMouse(),s||(s=n.labels[0])),!this._isEditing&&"text"===n.type&&this._setLabelEditing(n.textBlock)?(this.scrollToNode(n),this._startEdit(n)):this._isEditing||n.isLaneStack||n.isLane||n.isSwimlane||!(n.labels&&(0===n.labels.length||"undefined"==typeof n.labels.length)||n.labels&&n.labels.length>0&&this._setLabelEditing(s))?n.isLane&&n.labels&&n.labels.length>0&&this._setLabelEditing(s)?n.labels&&n.labels.length>0?(this.scrollToNode(n),this._startEdit(n)):this.activeTool.selectedObject=null:n.isLane&&(this.activeTool.selectedObject=null):(this.scrollToNode(n),this._startEdit(n)))}this.activeTool._isMouseDown=!1},_documentmouseup:function(e){var t,i;this._getTouchEvent(e),t=this._selectedSymbol,this._removeMouseOverTooltip(),this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool instanceof ej.datavisualization.Diagram.ShapeTool&&this.activeTool._drawingPolygon||(this._selectedSymbol&&"mouseleave"!=e.type&&(this._findLabelEditing=!0,this._dropSymbol(null,e),delete this._findLabelEditing,this._isDragg=!0),this.activeTool.mouseup(e,!0)),this.activeTool._removeRulerMarkers(),t&&(27!=e.keyCode&&46!=e.keyCode&&(i=document.getElementsByClassName("e-paletteItem dragClone")[0],null!=i&&(i.style.display="block"),this._selectedSymbol=t),this._raiseEvent("dragLeave",{element:this.selectionList[0],target:this,targetType:"diagram"}),this._mouseEventTriggered&&this._delete(this.selectionList[0])),this._isNodeEnters&&(delete this._isNodeEnters,this._selectedSymbol=null,i=document.getElementsByClassName("dragClone")[0],null!=i&&(i.style.display="block")),delete this._viewPort,delete this._isDropOver,this._mouseEventTriggered=!1,this._isDragg=!1},_invoke:function(e){if(e.originalEvent.target){var t=e.originalEvent.target.className;if(t&&"string"==typeof t&&("edit"==t||"editBox"==t||t.indexOf("e-hhandle")>-1||t.indexOf("e-hhandlespace")>-1||t.indexOf("e-vhandle")>-1||t.indexOf("e-vhandlespace")>-1))return!1}return!0},_handleMouseWheel:function(e){var t,i,a,n,o,s,r,l,d;this._isForeignEvent(e,!0)||(e.originalEvent.preventDefault&&e.originalEvent.preventDefault(),t=new ej.datavisualization.Diagram.Point(0,0),this._isEditing&&this._endEdit(),(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?(t=this._mousePosition(e.originalEvent),e.originalEvent.wheelDelta>0||-40*e.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,t,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,t,!0)):(i=0,
a={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},e.originalEvent.wheelDelta>0||-40*e.originalEvent.detail>0?(o=this._vScrollbar.model.minimum,s="limited"===this._scrollLimit()&&this._vScrollOffset-this._scrollPixel>=this.model.pageSettings.scrollableArea.y*this._currZoom,this._vScrollOffset-this._scrollPixel>=o||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||s?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),n=!0,i=-this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,o),n=!0,i=0)):(r=this._vScrollbar.model.maximum,l=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),s="limited"===this._scrollLimit()&&(this.model.pageSettings.scrollableArea.y+this.model.pageSettings.scrollableArea.height)*this._currZoom>=this._vScrollOffset+this._scrollPixel+l.height,r>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||s?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),n=!0,i=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,r),n=!0,i=0)),n&&(d={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},(a.horizontalOffset!=d.horizontalOffset||a.verticalOffset!=d.verticalOffset)&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Pan,this._raiseEvent("scrollChange",{newValues:d,oldValues:a}))),this._updateEditBox(0,i)))},_setActiveTool:function(e){var t,i,a;this._mousePosition(e);this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(i=!1,this.selectionList[0]&&(t=this.selectionList[0],i=this._checkToolToActivate(e,t)),i||(t=this._findNodeUnderMouse(e),this._isUserHandle(e)?(a=$(e.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(e,t),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(e,t),this._raiseMouseEvents(t),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(e,t,i){var a=i?i:100,n=this,o=0,s=0,r=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),l=this._hScrollbar.model.maximum+r.width,d=this._vScrollbar.model.maximum+r.height,h=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);if(this._canAutoScroll){switch(e){case"right":(this._hScrollOffset+r.width+10-h.left<l||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum-h.left||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(o=-10);break;case"bottom":(this._vScrollOffset+r.height+10-h.top<d||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(s=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum-h.top||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(s=-10)}n._clearTimeOutValue=window.setTimeout(function(i){var i={delay:a};n._raiseEvent("autoScrollChange",i),n._updateScrollBar(o,s,e,t,i.delay)},a)}},_updateScrollBar:function(e,t,i,a,n){if(this._clearTimeOutValue&&window.clearTimeout(this._clearTimeOutValue),0===e&&0===t)this._canAutoScroll=!1;else if(this.activeTool.inAction){var o=this._hScrollOffset+e*this._currZoom,s=this._vScrollOffset+t*this._currZoom,r=this._updateSelectionOnScroll(e,t);r?(this._updateScrollOffset(o,s),this._beginAutoScroll(i,a,n)):this._canAutoScroll=!1}},_updateSelectionOnScroll:function(e,t){var i,a,n,o,s=this.activeTool;if("select"===s.name)s.currentPoint=new ej.datavisualization.Diagram.Point(s.currentPoint.x+e,s.currentPoint.y+t),s._updateHelper();else if("orthogonalLine"===s.name||"straightLine"===s.name)s.currentPoint=new ej.datavisualization.Diagram.Point(s.currentPoint.x+e,s.currentPoint.y+t),s._targetPossibleConnection=s._currentPossibleConnection,s._targetPort=s._possibleConnectionPort,s._updateHelper();else if(this.selectionList.length>0){if(i=this.selectionList[0],i.isLane||(s.currentPoint=ej.datavisualization.Diagram.Point(s.currentPoint.x+e,s.currentPoint.y+t)),"move"===s.name){if(i.isLane||!s._outOfBoundsDrag(i,e,t))return!1;s._canMoveLabel?this._translateLabel(i,s.activeLabel,e,t):this._translate(i,e,t,this.nameTable)}else"resize"===s.name?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(this),s._updateSize(i,s.previousPoint,s.currentPoint)):"endPoint"===s.name&&(s.selectedSegment&&"segmentEnd"==s._endPoint?(a=s.currentPoint.x-s.previousPoint.x,n=s.currentPoint.y-s.previousPoint.y,s._updateAdjacentSegments(a,n)):(o=s._updatePoints(i),o.cancel||(s._disconnect(i),s._updateConnection(i,o.updateSelection))));s.previousPoint=ej.datavisualization.Diagram.Point(s.currentPoint.x,s.currentPoint.y),s._canMoveLabel||"phase"==i.type||(ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateSelectionHandle(!0),this._renderTooltip(i))}return!0},_isUserHandle:function(e){return"userHandle"===e.target.parentNode.className.animVal},_isUserHandleActive:function(e){var t,i,a=!1;if(this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0)for(t=0,i=this.model.selectedItems.userHandles.length,t;i>t;t++){if(this.model.selectedItems.userHandles[t].name===e){a=!0;break}a=!0}return a},_getEventDetail:function(e){return"msie"===ej.browserInfo().name?this._timeStamp?e.timeStamp-this._timeStamp>=300?1:2:1:e.originalEvent.detail},_raiseMouseEvents:function(e,t){var i,a;this._isEditing||(this.nameTable[this._lastNodeUnderMouse]&&(!e||this._lastNodeUnderMouse!=(e._isHeader?e.parent:e.name))&&(i=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"),i&&i.parentNode.removeChild(i),this.activeTool.inAction||(this._raiseEvent("mouseLeave",{element:this.getNode(this.nameTable[this._lastNodeUnderMouse])}),this._lastNodeUnderMouse=null),null==this._nodeUnderMouse||this._nodeUnderMouse.segments||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort&&this.activeTool._showPort(this._nodeUnderMouse,!0)),e&&!this.activeTool.inAction&&(this._lastNodeUnderMouse&&this._lastNodeUnderMouse==(e._isHeader?e.parent:e.name)||(this._lastNodeUnderMouse=e._isHeader?e.parent:e.name,this._raiseEvent("mouseEnter",{element:this.getNode(this._lastNodeUnderMouse)}))),e&&(a={element:this.getNode(e)},this._raiseEvent("mouseOver",a),a.element&&!this.activeTool.inAction?this._renderMouseOverTooltip(e,t):this._removeMouseOverTooltip()))},_renderMouseOverTooltip:function(e,t){var i,a,n,o,s,r,l,d,h,c,u,g,m,p;if(ej.datavisualization.Diagram.Util.canShowTooltip(e,this)&&(i=this.getObjectType(e),n="node"==i||"group"==i?ej.datavisualization.Diagram.NodeConstraints:ej.datavisualization.Diagram.ConnectorConstraints,e.constraints&n.InheritTooltip?(a=this.model.tooltip,o=!0):a=e.tooltip,a&&(!o||this._tooltipTemplateId()))){h=this._getTooltipPosition(e,a,t,o),s=h.x,r=h.y,l=h.tx,d=h.ty,s=-this._hScrollOffset+s*this._currZoom,r=-this._vScrollOffset+r*this._currZoom,c="left:"+s+"px; top:"+r+"px; display: block; position: absolute; pointer-events: none; transform:translate("+l+","+d+")",u=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"),u||(u=this._createMouseOverTooltip()),u.style.left=s+"px",u.style.top=r+"px",u.style.transform="translate("+l+" ,"+d+")",u.style.display="block",u.style.position="absolute",$.templates&&(g=o?this._tooltipTemplateId():a.templateId,m=$.templates("#"+g).render(e)),$(u).html(m),p=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this),u.style.marginLeft=u.style.marginTop="0px";var f=this.element[0].getBoundingClientRect(),v=u.getBoundingClientRect(),_=this.model.scrollSettings.currentZoom,y=ej.datavisualization.Diagram.Util.bounds(e,"rotatetool"==this.activeTool.name);if(f.left>v.left||f.right<v.right){if("mouse"==(o?this._tooltipMode():a.relativeMode)||"center"==a.alignment.horizontal)var b=f.left>v.left?"left":"right",x="right"==b?v.right-f.right:f.left-v.left,D="right"==b?-x-a.margin.right:a.margin.left+x;else"left"!=a.alignment.horizontal&&"right"!=a.alignment.horizontal||"center"!=a.alignment.vertical?(b=a.alignment.horizontal,"center"==b&&(b=f.left>v.left?"left":"right"),x="right"==b?v.right-f.right:f.left-v.left,D="right"==b?-x-a.margin.right:a.margin.left+x):(D=y.width*_+v.width+a.margin.left+a.margin.right,D="left"==a.alignment.horizontal?1*D:-1*D);u.style.marginLeft=D+"px"}(f.bottom<v.bottom||f.top>v.top)&&("mouse"==(o?this._tooltipMode():a.relativeMode)||"center"==a.alignment.vertical?(b=f.top>v.top?"top":"bottom",x="top"==b?v.top-f.top:v.bottom-f.bottom,D="top"==b?a.margin.top-x:-(x+a.margin.bottom)):"center"!=a.alignment.horizontal||"bottom"!=a.alignment.vertical&&"top"!=a.alignment.vertical?(x="top"==a.alignment.vertical?f.top-v.top:f.bottom-v.bottom,D="top"==a.alignment.vertical?a.margin.top+x:x-a.margin.bottom):(D=y.height*_+v.height+(a.margin.bottom+a.margin.top),D="bottom"==a.alignment.vertical?-1*D:1*D),u.style.marginTop=D+"px")}},_getTooltipPosition:function(e,t,i,a){var n,o,s,r,l,d=ej.datavisualization.Diagram.Util.bounds(e,!1);if("object"==(a?this._tooltipMode():t.relativeMode)){switch(a?this._horizontalTooltipAlignment():t.alignment.horizontal){case"left":n=d.x,n-=t.margin.left,s="-100%";break;case"right":n=d.right,n+=t.margin.right,s="0%";break;case"center":n=d.center.x,s="-50%"}switch(a?this._verticalTooltipAlignment():t.alignment.vertical){case"top":o=d.y,o-=t.margin.top,r="-100%";break;case"bottom":o=d.bottom,o+=t.margin.bottom,r="0%";break;case"center":o=d.center.y,r="-50%"}}else i&&(l=this._mousePosition(i),n=l.x+t.margin.left,o=l.y+t.margin.top);return{x:n,y:o,tx:s,ty:r}},_isHandle:function(e){var t=$(e.target).parent("g.handle");return t.length>0},_findNodeUnderMouse:function(e){var t,i,a=null;if(e.target){var n=$(e.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),i=(e.target.className,e.target.id.split("_"));if("lblbg"==i[i.length-1])return;n&&(t=n.attr("class"),t&&("ej-d-node"===t||"ej-d-group"===t||ej.datavisualization.Diagram.Util.isClassifier(e))?(a=this._findNode(n.attr("id")),a||(a=this._findNode(n.attr("id").split("_label")[0])),a||(a=this._findNode(n.attr("id").split("_parentdiv")[0])),a&&a._isInternalShape&&a.parent&&this.nameTable[a.parent]&&"bpmn"==this.nameTable[a.parent].type&&(a=this.nameTable[a.parent])):"ej-d-connector"===t&&(a=this._findConnector(n.attr("id")),a||(a=this._findConnector(n.attr("id").split("_label")[0]))),!a&&e.target&&e.target.parentNode&&(i=e.target.parentNode.id.split("_ej_ports"),a=this.findNode(i[0])))}return a},_findConnectableNodeUnderMouse:function(e){var t,i,a,n,o,s,r,l,d,h=null;if(e&&"touchmove"===e.type){var c=this._mousePosition(e),u=ej.datavisualization.Diagram.Rectangle(c.x,c.y,0,0),g=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,u);for(t=0;t<g.length;t++)if(i=g[t],i.objects.length>0)for(a=0;a<i.objects.length;a++)if(n=i.objects[a],o=ej.datavisualization.Diagram.Util.bounds(n),ej.datavisualization.Diagram.Geometry.intersectsRect(u,o)&&!n.segments&&n.visible)return n}else{for(var m,p=$(e.target).parents(".ej-d-node,.ej-d-group"),f=p[0],t=1;f;)m=f.getAttribute("class"),h=this._findNode(f.getAttribute("id")),h||(h=this._findNode(f.getAttribute("id").split("_parentdiv")[0])),!h||!ej.datavisualization.Diagram.Util.canConnect(h)&&h.parent?(f=p[t],t++):f=null;h&&("umlclassifier"==h.type&&(s=this.activeTool.selectedObject),s&&s.sourceNode&&(r=this.nameTable[s.sourceNode]),s&&s.targetNode&&(l=this.nameTable[s.targetNode]),r&&(h=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(h,r,s,this)),l&&(h=ej.datavisualization.Diagram.ClassifierHelper.EnableorDisableConnection(h,l,s,this))),!h&&e.target&&e.target.parentNode&&(d=e.target.parentNode.id.split("_ej_ports"),h=this.findNode(d[0]))}return h},_isForeignEvent:function(e,t){if(e.originalEvent&&e.originalEvent.target)if(t){if("input"===e.originalEvent.target.localName&&("text"===e.originalEvent.target.type||"password"===e.originalEvent.target.type)||"textarea"===e.originalEvent.target.localName&&(!this._isEditing||e.originalEvent.target.id!==this.element[0].id+"_editBox"))return!0}else if("img"===e.originalEvent.target.localName)return!0},_isForeignObject:function(e){var t=e;if(t)for(;null!=t.parentNode;){if("foreignObject"===t.tagName||"string"==typeof t.className&&-1!==t.className.split(" ").indexOf("foreignObject"))return t;t=t.parentNode}return null},_altKeyPressed:function(e){return e&ej.datavisualization.Diagram.KeyModifiers.Alt},_ctrlKeyPressed:function(e){return e&ej.datavisualization.Diagram.KeyModifiers.Control},_shiftKeyPressed:function(e){return e&ej.datavisualization.Diagram.KeyModifiers.Shift},_keydown:function(e){var t,i,a,n;this._isKeyDown=!0,this._removeMouseOverTooltip();var o=e.keyCode?e.keyCode:e.which,s=navigator.platform.match("Mac")?e.metaKey:e.ctrlKey,r=e.key;if(!this._isForeignEvent(e,!0)){for(t in this.model.commandManager.commands)i=this.model.commandManager.commands[t],i&&i.gesture&&(i.gesture.keyModifiers||i.gesture.key)&&(!i.gesture.key||o==i.gesture.key||r==i.gesture.key||navigator.platform.match("Mac")&&"Backspace"===r&&"delete"===t)&&(!i.gesture.keyModifiers||(s||e.altKey||e.shiftKey)&&(!this._altKeyPressed(i.gesture.keyModifiers)||e.altKey)&&(!this._shiftKeyPressed(i.gesture.keyModifiers)||e.shiftKey)&&(!this._ctrlKeyPressed(i.gesture.keyModifiers)||s))&&(this._currentCommand=t,"focusToNextItem"!==this._currentCommand&&"focusToPreviousItem"!==this._currentCommand&&"selectFocusedItem"!==this._currentCommand&&(this._diagramElements=null,this._focusedElement=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer)),i.execute&&i.canExecute&&(a=i.canExecute,"string"==typeof i.canExecute&&(a=ej.util.getObject(i.canExecute,window)),$.isFunction(a)&&a({model:this.model})&&(n=i.execute,"string"==typeof i.execute&&(n=ej.util.getObject(i.execute,window)),$.isFunction(n)&&n({keyDownEventArgs:e,parameter:i.parameter,model:this.model}))));this.activeTool.keydown&&this.activeTool.keydown(e)}this._isKeyDown=!1},_keyup:function(e){var t=e.keyCode?e.keyCode:e.which;this._isEditing||37!==t&&38!==t&&39!==t&&40!==t||(this._currentState,delete this._currentState,e.preventDefault(),this.activeTool.inAction=!1,this._updateSelectionHandle())},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this)),this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this)),this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this)),this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this)),this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this)),this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this)),this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_svgdrop:function(e,t){var i,a,n,o,s,r,l,d,h;if(this._selectedSymbol&&ej.datavisualization.Diagram.Util.isPageEditable(this)){i={},a=e.originalEvent,a.preventDefault?a.preventDefault():a.returnValue=!1;var c=this._currZoom,u=$("#"+this.element[0].id).offset(),g=this._isTouchEvent(e);g.pageX||e.pageX||(e.originalEvent&&e.originalEvent.changedTouches?g=e.originalEvent.changedTouches[0]:e&&e.changedTouches&&(g=e.changedTouches[0]));var m=(g?g.pageX:e.pageX)+this._hScrollOffset-u.left,p=(g?g.pageY:e.pageY)+this._vScrollOffset-u.top,f=$.extend(!0,{},this._selectedSymbol),v=t.helper[0].getAttribute("paletteId"),_=$("#"+v).ejSymbolPalette("instance");if(v){if(this._selectedSymbol=null,f.name+=ej.datavisualization.Diagram.Util.randomId(),!f.isPhase&&f.segments)f.segments&&ej.datavisualization.Diagram.Util._translateLine(f,m,p),f=this.getNode(f);else if(!f.isPhase){if(n=$.extend(!0,{},_.nameTable),f.offsetX=m/c,f.offsetY=p/c,"group"===f._type){for(o=this._getChildren(f.children),s=0;s<o.length;s++)r=$.extend(!0,{},n[o[s]]),r.parent=f.name,r.name=f.name+r.name,o[s]=r.name,this.nameTable[r.name]=r,this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(this.nameTable[r.name]);f.height=f.width=0,this._updateChildBounds(f,this.nameTable)}"group"===f._type?f=this._getNewGroup(f):f.segments?f=this._getNewConnector(f):f.isPhase||"phase"===f.type||(f=this._getNewNode(f))}f&&f.isLane&&(this._cloneGroupNode(f,ej.datavisualization.Diagram.Util.randomId()),f=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(f,this.nameTable),f=this._initLaneContaier(f)),i={element:f,cancel:!1},this._raiseDropEvent(i),f&&f.isLane&&(l=f.children[0],d=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(f,this,null,null,l),d&&d.isSwimlane&&(f=d)),f.isPhase||(i.cancel||this.add(f),f=this.selectionList[0],this.scrollToNode(f),f.labels.length>0&&"edit"===f.labels[0].mode?(this._isEditing=!0,this.startLabelEdit(f,f.labels[0])):this.element[0].focus())}}else h=null,h=this._findNodeUnderMouse(e),i={element:t.helper,e:e,draggable:t.draggable,targetNode:h},this._raiseDropEvent(i)},_isTouchEvent:function(e){return"touchmove"==e.type||"touchstart"==e.type||"touchend"==e.type?e.originalEvent?e.originalEvent.changedTouches[0]:e.changedTouches[0]:e},_raiseDropEvent:function(e){e.source=this._symbolPalette?this._symbolPalette:null,e.objectType=e.source?ej.datavisualization.Diagram.ObjectTypes.Palette:ej.datavisualization.Diagram.ObjectTypes.Diagram,this._raiseEvent("drop",e),this._symbolPalette=null},_recordCollectionChanged:function(e,t){var i,a,n,o,s,r,l,d,h,c,u,g,m,p;if(this._isUndo=!0,this._isInsert=!0,i=e.changeType,e.isUndo&&(i="insert"==e.changeType?"remove":"insert"),this._clearSelection("insert"!=i),"insert"==i)if(e.object.container||e.object._isMultipleLaneDelete){c=[];for(g in e.childTable)h=e.childTable[g],this.nameTable[g]=h;if(o=e.object,o.isSwimlane)this.nameTable[o.name]=o,o.width=0,o.height=0,this._swimlanePaste=!0,this._multipleAction=!0,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._pasteSwimlaneObj(o),delete this._swimlanePaste,this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(o),delete this._multipleAction,this._clearSelection(!0);else if("pseudoGroup"==o._type||o.isLane)if("pseudoGroup"==o._type){for(g=0;g<o.children.length;g++)h=o.children[g],c[g]=e.childTable[h.name],h.isLane&&this.nameTable[h.name]&&delete this.nameTable[h.name];for(u=this._sortByLaneIndex(c),g=0;g<u.length;g++)h=u[g],h.isLane?this._recordCollectionChangedAddLane(h,h._laneIndex):(this.add(h,e),this._clearSelection(!0))}else this._recordCollectionChangedAddLane(e.object,e.index);else this.add(o),this._addConnector(o,e)}else if("pseudoGroup"!=e.object.type){if(!e.object.segments){if(a=null,e.object.inEdges&&e.object.inEdges.length>0)for(g=0;g<e.object.inEdges.length;g++)this.nameTable[e.object.inEdges[g]]&&(this.nameTable[e.object.inEdges[g]].targetNode=e.object.name),e.targetPorts&&(a=e.targetPorts[e.object.inEdges[g]]),a&&this.nameTable[e.object.inEdges[g]]&&(this.nameTable[e.object.inEdges[g]].targetPort=a);if(e.object.outEdges&&e.object.outEdges.length>0)for(g=0;g<e.object.outEdges.length;g++)this.nameTable[e.object.outEdges[g]]&&(this.nameTable[e.object.outEdges[g]].sourceNode=e.object.name),e.sourcePorts&&(a=e.sourcePorts[e.object.outEdges[g]]),a&&this.nameTable[e.object.outEdges[g]]&&(this.nameTable[e.object.outEdges[g]].sourcePort=a)}"group"===e.object._type&&this._addChildren(e.object,e.childTable),e.object.isSwimlane&&(e.object=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(e.object,this)),this.add(e.object,e),e.object.parent&&(n=this.nameTable[e.object.parent]),"group"===e.object._type?(this._addConnector(e.object,e),this._addGroupConnector(e.object,e)):this._addConnector(e.object,e)}else{for(delete this.nameTable.multipleSelection,l=[],d=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"}),g=0;g<e.object.children.length;g++)h="object"==typeof e.object.children[g]?e.object.children[g]:e.childTable[e.object.children[g]],h&&(r=this.getObjectType(h),"group"!==r||h.isSwimlane||this._addChildren(h,e.childTable),h.isSwimlane?(this._swimlanePaste=!0,this._isUndo=!0,h=this._pasteSwimlaneObj(h,e),delete this._swimlanePaste):"connector"!=r?this.add(h,e):l.push(h),h&&d.children.push(h.name));for(g=0;g<l.length;g++)this.add(l[g],e);for(this._addGroupConnector(e.object,e),g=0;g<d.children.length;g++)if(o=this.nameTable[this._getChild(d.children[g])],o&&!o.segments){if(o.inEdges.length>0)for(s=0;s<o.inEdges.length;s++)this._isUndo?e.childTable[o.inEdges[s]].targetNode=o.name:this.nameTable[o.inEdges[s]].targetNode=o.name;if(o.outEdges.length>0)for(s=0;s<o.outEdges.length;s++)this._isUndo?e.childTable[o.outEdges[s]].sourceNode=o.name:this.nameTable[o.outEdges[s]].sourceNode=o.name}this._clearSelection(),this.nodes().push(d),this._nodes=$.extend(!0,[],this.nodes()),d.offsetX=e.object.offsetX,d.offsetY=e.object.offsetY,d.height=e.object.height,d.width=e.object.width,d.rotateAngle=e.object.rotateAngle,this.nameTable[d.name]=d,this.addSelection(d,!0)}else if("remove"==i){if("pseudoGroup"!=e.object.type&&!e.object.isLane)return this._removeAdjacentConnections(e.object,e),e.object.isSwimlane||e.object.annotation?this._remove(this.nameTable[e.object.name]):this._remove(e.object),!0;if(e.object.isLane)m=e.object,e.index||0==e.index||(p=null,e.object.isLane&&t&&(t.index=this._getRemoveIndex(e.object,!0))),this._remove(m);else for(g=0;g<e.object.children.length;g++)this._remove(this.nameTable[this._getChild(e.object.children[g])])}this._groupUndo||(this._isUndo=!1),this._isInsert=!1,this.tools.move._isLane=!1},_recordCollectionChangedAddLane:function(e,t){var i,a;e&&e.isLane&&e.parent&&(e&&e.parent&&(a=this.nameTable[e.parent]),a&&a&&(i=this.nameTable[a.parent]),i&&(this.activeTool.selectedObject=e,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,ej.datavisualization.Diagram.canvasHelper._addNewLane(this,e,i,!0,t),this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(e),this._clearSelection(!0)))},_addAssiciatedChildConnectors:function(e){var t,i,a,n=this._getChildren(e.children);if(n&&n.length>0)for(t=0,i=n.length;i>t;t++)a=this.nameTable[n[t]],a&&(this._addConnector(a),"group"===a.type&&this._addAssiciatedChildConnectors(a))},_updateRecordPinPoint:function(e,t,i){var a,n,o,s,r,l,d,h,c,u,g;if("pseudoGroup"==e.type){for(r=e,l=this._getChildren(e.children),n=0;n<l.length;n++)o=this.nameTable[l[n]],s=t[l[n]],s&&(o.segments?(d=t[o.name],o.sourcePoint=d.sourcePoint,o.targetPoint=d.targetPoint,o.segments=jQuery.extend(!0,o.segments,d.segments)):(this._propertyChangeValues(o,s),this._translate(o,s.offsetX-o.offsetX,s.offsetY-o.offsetY,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(o,this));this.selectionList[0]&&this.selectionList[0].name===r.name&&(this.selectionList[0].offsetX=r.offsetX,this.selectionList[0].offsetY=r.offsetY),ej.datavisualization.Diagram.SvgContext.updateSelector(r,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}else e.segments?i?(a=t[e.name],e.sourcePoint=a.sourcePoint,e.targetPoint=a.targetPoint,e.segments=$.extend(!0,[],a.segments),ej.datavisualization.Diagram.DiagramContext.update(e,this)):(this._clearSelection(!0),a=this._findConnector(e.name),e.targetNode&&(h=this.nameTable[e.targetNode],ej.datavisualization.Diagram.Util.removeItem(h.inEdges,e)),e.sourceNode&&(h=this.nameTable[e.sourceNode],ej.datavisualization.Diagram.Util.removeItem(h.outEdges,e)),e.targetNode&&(h=this.nameTable[e.targetNode],h.inEdges.push(e.name)),e.sourceNode&&(h=this.nameTable[e.sourceNode],h.outEdges.push(e.name)),this._propertyChangeConnectorValues(a,e),a.targetNode=e.targetNode,a.sourceNode=e.sourceNode,a.targetPort=e.targetPort,a.sourcePort=e.sourcePort,a.sourcePoint=e.sourcePoint,a.targetPoint=e.targetPoint,a.segments=$.extend(!0,[],e.segments),ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.SvgContext.updateSelector(e,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints),this.addSelection(e,!0)):i?(a=t[e.name],this._translate(e,a.offsetX-e.offsetX,a.offsetY-e.offsetY,t),ej.datavisualization.Diagram.DiagramContext.update(a,this)):(a=this._findNode(e.name),this._clearSelection(!0),this._propertyChangeValues(a,e),e.parent&&(g=this.nameTable[e.parent]),g||(g=this.nameTable[a.parent],c=!0),g&&g.container?(this._raiseGroupChangeEvent(e,a.parent?this.nameTable[a.parent]:null,this.nameTable[e.parent],ej.datavisualization.Diagram.GroupChangeCause.HistoryChange),ej.datavisualization.Diagram.canvasHelper._undoDragNode(this,this.nameTable[e.name],e),c&&(u=this.nameTable[g.parent.split("laneStack")[0]],u&&ej.datavisualization.Diagram.DiagramContext.update(u,this))):(this._translate(a,e.offsetX-a.offsetX,e.offsetY-a.offsetY,this.nameTable),e.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[a.parent],this),a.parent&&(g=this.nameTable[a.parent],g&&a.parent&&""==e.parent&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(g.children,a.name),this._delete(a),("group"===e.type||"bpmn"===e.type)&&this._initGroupNode(e,t),this.add(e))),e.parent&&(g=this.nameTable[e.parent],e.parent&&""==a.parent&&(this._delete(a),e=$.extend(!0,{},e),("group"===e.type||"bpmn"===e.type)&&this._initGroupNode(e,t),this.add(e)))),ej.datavisualization.Diagram.DiagramContext.update(a,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,a),this.addSelection(a,!0))},_propertyChangeValues:function(e,t){var i,a=e.offsetX===t.offsetX?"":"offsetX",n=e.offsetY===t.offsetY?"":"offsetY";"offsetX"===a&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:e.offsetX,newValue:t.offsetX},this._raisePropertyChange(i)),"offsetY"===n&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:e.offsetY,newValue:t.offsetY},this._raisePropertyChange(i))},_propertyChangeResizeValues:function(e,t){var i,a=t.width===e.width?"":"width",n=t.height===e.height?"":"height";"width"===a&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:e.width,newValue:t.width},this._raisePropertyChange(i)),"height"===n&&(i={element:e,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:e.height,newValue:t.height},this._raisePropertyChange(i))},_propertyChangeConnectorValues:function(e,t){var i,a=e.sourcePoint.x===t.sourcePoint.x||e.sourcePoint.y===t.sourcePoint.y?"":"sourcePoint",n=e.targetPoint.x===t.targetPoint.x||e.targetPoint.y===t.targetPoint.y?"":"targetPoint";"sourcePoint"===a&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:a,oldValue:e.sourcePoint,newValue:t.sourcePoint},this._raisePropertyChange(i)),"targetPoint"===n&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:n,oldValue:e.targetPoint,newValue:t.targetPoint},this._raisePropertyChange(i))},_renderNodeOnLane:function(e,t){var i,a,n=this;n._views.forEach(function(o){var s;i=n._views[o],a=i.svg||i._canvas,t=i.svg.getElementById(e.parent),"overview"==i.type&&(s=!0),"group"===e._type?i.context.renderGroup(e,a,t||i.diagramLayer,n.nameTable,n,null,!0):"node"===n.getObjectType(e)&&i.context.renderNode(e,a,t||i.diagramLayer)})},_updateUndoObject:function(e,t){var i,a,n;t.parent&&(n=this.nameTable[t.parent]),n&&this._collectionContains(t.name,n.children)?(ej.datavisualization.Diagram.Util.removeChildFromGroup(n.children,t.name),e.parent&&(i=this.nameTable[e.parent]),i&&i.children&&!this._collectionContains(t.name,i.children)&&(i.children.push(e.name),this.nameTable[e.name].parent=i.name,i.isLane&&(a=this.tools.move,a._updateMargin(t,i)))):e.parent&&(n=this.nameTable[e.parent])},_collectionContains:function(e,t){for(var i=0;i<t.length;i++)if("string"==typeof t[i]&&t[i]===e||t[i].name===e)return!0},_recordPinPointChanged:function(e){var t=e.object.node,i=e.object.childTable;(t||t.isSwimlane)&&this._updateRecordPinPoint(t,i)},_updateRecordRotation:function(e,t){var i,a,n,o,s,r,l,d;if("pseudoGroup"==e.type){for(this._clearSelection(!0),this.nameTable[e.name]=e,d=this.nameTable[e.name],o=e.children,i=0;i<o.length;i++)a=this.nameTable[this._getChild(o[i])],n=t[o[i]],a&&(a.segments?(s=t[a.name],a.sourcePoint=s.sourcePoint,a.targetPoint=s.targetPoint):n&&(this._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,this.nameTable),this._comparePropertyValues(a,"rotateAngle",{rotateAngle:n.rotateAngle}),this._rotate(a,n.rotateAngle-a.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(a,this));d&&(r=e.rotateAngle-d.rotateAngle,d.rotateAngle+=r,this.selectionList[0]&&(this.selectionList[0].rotateAngle=d.rotateAngle)),this.nameTable[e.name]=e,this.addSelection(e,!0)}else l=null,e.parent&&(l=this.nameTable[e.parent]),l&&l.container?(d=this._findNode(e.name),ej.datavisualization.Diagram.canvasHelper._undoRotateNode(this,d,e)):e&&(this._clearSelection(!0),d=this._findNode(e.name),this._comparePropertyValues(d,"rotateAngle",{rotateAngle:e.rotateAngle}),this._rotate(d,e.rotateAngle-d.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(d,this),this.addSelection(d,!0))},_recordSizeChanged:function(e,t){var i=e.object.node,a=e.object.childTable;this._updateRecordSize(i,a,t)},_updateRecordSize:function(e,t,i){var a,n,o,s,r,l,d,h;if(this._clearSelection(!0),"group"!==e._type&&"pseudoGroup"!==e.type||e.isLane||e.isSwimlane||"bpmn"===e.type)e.isLane||e.isSwimlane?(a=this._findNode(e.name),ej.datavisualization.Diagram.canvasHelper._undoResizeLane(this,e,i)):"bpmn"==e.type&&e.container?(a=this._findNode(e.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,e)):(h=null,e.parent&&(h=this.nameTable[e.parent]),h&&h.container?(a=this._findNode(e.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,e)):e.segments||(a=this._findNode(e.name),this._propertyChangeResizeValues(a,e),this._translate(a,e.offsetX-a.offsetX,e.offsetY-a.offsetY,this.nameTable),this.scale(a,e.width/a.width,e.height/a.height,ej.datavisualization.Diagram.Point(a.offsetX,a.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this),this.addSelection(a,!0)));else{for("pseudoGroup"==e.type&&(this.nameTable[e.name]=e),a=this._findNode(e.name),s=this._getChildren(a.children),r=this._getChildren(e.children),n=0;s&&n<s.length;n++)l=this.nameTable[r[n]],o=t[r[n]],o&&(l.segments?(d=t[l.name],l.sourcePoint=d.sourcePoint,l.targetPoint=d.targetPoint,l.segments=$.extend(!0,[],d.segments)):(this._propertyChangeResizeValues(l,o),this._translate(l,o.offsetX-l.offsetX,o.offsetY-l.offsetY,this.nameTable),this.scale(l,o.width/l.width,o.height/l.height,ej.datavisualization.Diagram.Point(l.offsetX,l.offsetY),this.nameTable)));h=null,e.parent&&(h=this.nameTable[e.parent]),h&&h.container?(a=this._findNode(e.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,a,e)):(a.offsetX=e.offsetX,a.offsetY=e.offsetY,a.width=e.width,a.height=e.height,"resize"==this.activeTool.name&&this.activeTool.inAction&&"pseudoGroup"!=this.selectionList[0].type&&"group"!=this.selectionList[0].type||this._updateAssociatedConnectorEnds(a,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(a,this),this.addSelection(a,!0))}},_recordRotationChanged:function(e){var t=e.object.node,i=e.object.childTable;this._updateRecordRotation(t,i)},_recordEndPointChanged:function(e){
this.clearSelection(!0);var t,i,a,n;e._isUndo?(t=i=e.undoObject,a=e.redoObject):(t=i=e.redoObject,a=e.undoObject),t=t.parent?this._findChildren(this.nameTable[t.parent],t.name):this._findConnector(t.name),a.targetNode&&(n=this.nameTable[a.targetNode],ej.datavisualization.Diagram.Util.removeItem(n.inEdges,a.name)),a.sourceNode&&(n=this.nameTable[a.sourceNode],ej.datavisualization.Diagram.Util.removeItem(n.outEdges,a.name)),i.targetNode&&(n=this.nameTable[i.targetNode],n.inEdges.push(i.name)),i.sourceNode&&(n=this.nameTable[i.sourceNode],n.outEdges.push(i.name)),this._propertyChangeConnectorValues(t,i),this._comparePropertyValues(t,"targetNode",{targetNode:i.targetNode}),t.targetNode=i.targetNode,this._comparePropertyValues(t,"sourceNode",{sourceNode:i.sourceNode}),t.sourceNode=i.sourceNode,this._comparePropertyValues(t,"targetPort",{targetPort:i.targetPort}),t.targetPort=i.targetPort,this._comparePropertyValues(t,"sourcePort",{sourcePort:i.sourcePort}),t.sourcePort=i.sourcePort,this._comparePropertyValues(t,"sourcePoint",{sourcePoint:i.sourcePoint}),t.sourcePoint=i.sourcePoint,this._comparePropertyValues(t,"targetPoint",{targetPoint:i.targetPoint}),t.targetPoint=i.targetPoint,t.segments=$.extend(!0,[],i.segments),this._updateEdges(t),this._dock(t,this.nameTable),ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this),ej.datavisualization.Diagram.Util.updateBridging(t,this),ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateConnectorBridging(t),this._addSelection(t,!!this._selectionContains(t)),this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom),ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},_recordLabelPositionChanged:function(e){var t,i,a=e.activeLabel;a&&(t=e.redoObject?e.redoObject.node:null,e.undo&&(t=e.undoObject?e.undoObject.node:null),t&&(i=this._findLabel(t,a.name),this.updateLabel(t.name,a,{margin:i.margin,offset:i.offset,segmentOffset:i.segmentOffset,width:i.width,height:i.height,rotateAngle:i.rotateAngle})))},_recordPortPositionChanged:function(e){var t,i,a=e.activePort;a&&(t=e.redoObject?e.redoObject.node:null,e.undo&&(t=e.undoObject?e.undoObject.node:null),t&&(i=this._findPort(t,a.name),this.updatePort(t.name,a,{offset:i.offset})))},_recordLabelChanged:function(e){var t=this.nameTable[e.object.name];this._comparePropertyValues(t.labels[e.index?e.index:0],"text",{text:e.label}),"text"===e.object.type?(t.textBlock.text=e.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(t,t.textBlock,this)):"umlclassifier"==t.type?(this._clearSelection(!0),e.label=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(e.label,t,this),t=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(t,this),t.labels[e.index].text="",ej.datavisualization.Diagram.DiagramContext.update(t,this),this.addSelection(t,!0)):t.shape&&"umlclassifier"==t.shape.type?(t=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(t,e.label,t.labels[e.index]),ej.datavisualization.Diagram.DiagramContext.update(t,this)):t.labels[e.index]?(t.labels[e.index].text=e.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[e.index],this)):(t.labels[e.index]=ej.datavisualization.Diagram.Label({text:e.label}),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,t.labels[e.index],null,this))},labelcollectionchanged:function(e){var t,i,a,n,o=this.nameTable[e.shape.name],s=o.labels;if(s.slice(0),e.isLabelRemove){if(e.labels&&e.labels.length>0)for(t=e.labels.slice(),n=0;n<t.length;n++)i=t[n].index,a=t[n].label,i!=undefined&&a&&(e.isUndo?this.insertLabel(o.name,a,i):this.removeLabels(o.name,[a]))}else e.isUndo?this.removeLabels(o.name,[e.label]):this.addLabel(o.name,e.label),this._raisePropertyChange({element:o,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:s,newValue:o.labels})},_recordGroupChanged:function(e){var t,i,a,n,o,s,r,l,d,h=e.actionType;if(e.isUndo&&("group"===e.actionType&&(h="ungroup"),"ungroup"===e.actionType&&(h="group")),this._clearSelection("group"==h),t=this._getChildren(e.object.children),"group"===h){for(i=new ej.datavisualization.Diagram.Group(e.object),i.children=[],a=0;a<t.length;a++)d=this.nameTable[t[a]],i.children.push(d),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),d),d.parent&&(o=this.nameTable[d.parent]),d.parent=i.name,r=this._svg.document.getElementById(t[a]),r&&r.parentNode.removeChild(r),d.parent&&(s=this.nameTable[d.parent]),this._raiseGroupChangeEvent(d,o,s,"group");this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this.add(i),this._addSelection(i)}else{for(n=e.object,r=this._svg.document.getElementById(n.name),r&&r.parentNode.removeChild(r),l=this._getChildren(n.children),a=0;a<l.length;a++)d=this.nameTable[l[a]],d.parent&&(o=this.nameTable[d.parent]),d.parent="",this._isUndo=!0,d.segments||("group"==d._type?ej.datavisualization.Diagram.DiagramContext.renderGroup(d,this):ej.datavisualization.Diagram.DiagramContext.renderNode(d,this),-1===this.nodes().indexOf(d)&&(this.nodes().push(d),this._nodes=$.extend(!0,[],this.nodes()))),d.segments&&(ej.datavisualization.Diagram.DiagramContext.renderConnector(d,this),-1===this.connectors().indexOf(d)&&(this.connectors().push(d),this._connectors=$.extend(!0,[],this.connectors()))),this._isUndo=!1,this._nodes=$.extend(!0,[],this.nodes()),d.parent&&(s=this.nameTable[d.parent]),this._raiseGroupChangeEvent(d,o,s,"ungroup");this._removeElement(n),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(n.name)),this._nodes=$.extend(!0,[],this.nodes())}},_recordNudgingChanges:function(e,t,i){var a,n;this._isUndo=!0,a=t.undoDirection,i&&(a=t.redoDirection),this._clearSelection(!0),"pseudoGroup"===e.type&&(n=ej.datavisualization.Diagram.Group(e),delete this.nameTable[n.name],this.nameTable[n.name]=e),this._addSelection("label"==e._type?e:this.nameTable[e.name],!0),this.nudge(a,t.values),this._isUndo=!1},_recordPropertiesChanged:function(e,t,i,a){var n,o=this._getModifiedProperties("port"==i||"label"==i?a:e,t);o&&Object.keys(o).length&&("connector"==i&&((t.sourcePoint||t.sourceNode)&&(o.sourcePoint=e.sourcePoint,o.sourceNode=e.sourceNode,o.sourcePort=e.sourcePort),(t.targetPoint||t.targetNode)&&(o.targetNode=e.targetNode,o.targetPort=e.targetPort,o.targetPoint=e.targetPoint)),n={type:"propertiesChanged",values:o,category:"internal",object:e,elementType:i,updateValues:t},n[i]=a,this.addHistoryEntry(n))},_recordAlignCommandChanges:function(e){var t,i,a,n,o;if(e&&e.values.length){for(this._associatedConnectorsUpdate=!0,t=0;t<e.values.length;t++)i=e.values[t],i.object&&i.delta&&(a={x:-i.delta.x,y:-i.delta.y},n=this.nameTable[this._getChild(i.object)],this._comparePropertyOnAlign(n,-i.delta.x,-i.delta.y),this._translate(n,-i.delta.x,-i.delta.y,this.nameTable),this._updateContainerOnNudge(n),i.delta=a,this._updateObject(n));for(delete this._associatedConnectorsUpdate,t=0;t<e.values.length;t++)o=this.nameTable[this._getChild(e.values[t].object)],o.segments||this._updateAssociateConnector(o);this.nameTable[e.object.name]||(this.nameTable[e.object.name]=e.object),ej.datavisualization.Diagram.Util._updateGroupBounds(e.object,this),this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(e.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(e.object,!0)}},_recordPhaseCollectionChanged:function(e){e.undo?e.isAdded?e.phase&&this._removePhase(e.phase.name):e.phase&&this._addPhase(e.group,e.phase,e):e.isAdded?e.phase&&this._addPhase(e.group,e.phase,e):e.phase&&this._removePhase(e.phase.name),this._clearSelection(!0)},_recordSizeCommandChanges:function(e){var t,i,a,n;if(e&&e.values.length){for(t=0;t<e.values.length;t++)i=e.values[t],i.object&&i.values&&(a={width:i.object.width||i.object._width||0,height:i.object.height||i.object._height||0},n=this.nameTable[this._getChild(i.object)],this._comparePropertyValues(n,"height",{height:i.values.height}),this._comparePropertyValues(n,"width",{width:i.values.width}),this.scale(n,i.values.width/(n.width||n._width||0),i.values.height/(n.height||n.height||0),{x:n.offsetX,y:n.offsetY},this.nameTable),i.values=a,this._updateObject(n));this.nameTable[e.object.name]||"pseudoGroup"!=e.object.type||(this.nameTable[e.object.name]=e.object),ej.datavisualization.Diagram.Util._updateGroupBounds(e.object,this),this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(e.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(e.object,!0)}},_getModifiedProperties:function(e,t,i){var a,n;if(i=i||e,t&&Object.keys(t).length&&i){a={};for(n in t)(t[n]!=i[n]||"object"==typeof i[n])&&(a[n]=i[n]&&i[n]instanceof Array?i[n]:i[n]&&"object"==typeof i[n]?$.extend(!0,{},i[n]):i[n]);return a}},_addCollectionChangeToHistory:function(e){var t,i;""==e.parent&&(t={},this.selectionList&&this.selectionList.length>0&&(t=this._getChildTable(this.selectionList[0],t)),i={type:"collectionchanged",object:jQuery.extend(!0,{},e),childTable:jQuery.extend(!0,{},t),changeType:"insert",category:"internal"},this.addHistoryEntry(i))},_recordPhasesizeChanged:function(e){var t=$.extend(!0,{},e.undoObject),i=$.extend(!0,{},e.redoObject);e.undo?this._updatePhase({name:t.name,offset:t.offset}):this._updatePhase({name:i.name,offset:i.offset})},_recordPortsCollectionChanged:function(e){var t,i,a,n,o,s,r,l=e.changeType;if(e.isUndo&&(l="insert"==e.changeType?"remove":"insert"),t=this.nameTable[e.object.name],"remove"==l)for(o=0;o<e.collection.length;o++)for(this._updatePortConnection(t,t.inEdges,e.collection[o]),this._updatePortConnection(t,t.outEdges,e.collection[o]),ej.datavisualization.Diagram.Util.removeItem(t.ports,e.collection[o]),i=0;i<this._views.length;i++)a=this._views[i],n=this._views[a].svg.document.getElementById(t.name+"_"+e.collection[o].name),n&&n.parentNode.removeChild(n);else for(o=0;o<e.collection.length;o++)t.ports.push(e.collection[o]),ej.datavisualization.Diagram.DiagramContext.renderPort(t,e.collection[o],this),e.collection[o]._removeLine&&(s=e.collection[o]._removeLine,s&&(r=this.nameTable[s],r&&(e.collection[o]._removeFromSourcePort||e.collection[o]._removeFromTargetPort)&&(e.collection[o]._removeFromSourcePort&&(r.sourcePort=e.collection[o].name),e.collection[o]._removeFromTargetPort&&(r.targetPort=e.collection[o].name),this._dock(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this))))},_initLaneContaier:function(e){return e.isLane&&(e=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,e)),e},_addSymbolToDiagram:function(e){var t,i,a,n,o;if(ej.datavisualization.Diagram.Util.isPageEditable(this)){var s=this._currZoom,r=$("#"+this.element[0].id).offset(),l=this._isTouchEvent(e);l.pageX||e.pageX||(e.originalEvent&&e.originalEvent.changedTouches?l=e.originalEvent.changedTouches[0]:e&&e.changedTouches&&(l=e.changedTouches[0]));var d,h=(l?l.pageX:e.pageX)+this._hScrollOffset-r.left,c=(l?l.pageY:e.pageY)+this._vScrollOffset-r.top,u=$.extend(!0,{},this._selectedSymbol);if(this._selectedSymbol&&(d=u,this._isNodeEnters?d.isSwimlane&&(this.nameTable[d.name]=d,d=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,d,{childTable:this.childTable,object:d}),this._addAssiciatedChildConnectors(d)):(d&&"pseudoGroup"!=d.type&&(u.name+=ej.datavisualization.Diagram.Util.randomId()),u.segments?ej.datavisualization.Diagram.Util._translateLine(u,h/s,c/s):(this._cloneGroupNode(u,ej.datavisualization.Diagram.Util.randomId()),"group"===u._type?(t=ej.datavisualization.Diagram.Util._getChildrenBounds(u,this),ej.datavisualization.Diagram.Util._translate(u,h/s-t.x-t.height/2,c/s-t.y-t.width/2,this.nameTable,null,this)):(u.offsetX=h/s,u.offsetY=c/s),u.isLane&&(i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(u,this.nameTable),i.isLane=u.isLane,i.orientation=u.orientation,d=i),"bpmn"==u.type&&delete d.children)),d&&(a={element:d,target:this,targetType:"diagram"},this._raiseEvent("dragEnter",a),!a.cancel))){if(this._isEditing&&(this._endEditing=!0,this._endEdit(),delete this._endEditing),d&&!this._isNodeEnters&&(d=this._initLaneContaier(d)),"pseudoGroup"!=d.type)d.isLane&&(this.nameTable[this._getChild(d.children[0])]._isHeader=!0),this.add(d);else{for(n=0;n<d.children.length;n++)this.add(d.children[n]),d.children[n]=d.children[n].name;for(o in this.edgeTable)this.nameTable[o]||this.add(this.edgeTable[o]);this._hasSelection()&&this._clearSelection(!0),this.nodes().push(d),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[d.name]=d,ej.datavisualization.Diagram.Util._updateGroupBounds(d,this),this.addSelection(d,!0)}this._focusedElement=d,d.isLane&&ej.datavisualization.Diagram.SvgContext._hideNode(d,this._svg),this.element[0].focus(),this._toolToActivate="move",document.getElementsByClassName("e-paletteItem dragClone")[0]&&$(".e-paletteItem.dragClone").css("display","none"),this.activateTool("move",!1),this._symbolDrop=!0,this.activeTool.mousedown(e),this.activeTool.mousemove(e)}}delete this._symbolDrop},_removeSymbolFromDiagram:function(){if(this._selectedSymbol){var e=document.getElementsByClassName("e-paletteItem dragClone")[0];null!=e&&(e.style.display="block"),this._remove(this.selectionList[0]),this._selectedSymbol=null}},_updateGroupChild:function(e){for(var t=(e.children,0);t<e.children.length;t++)e.children[t]=this.nameTable[this._getChild(e.children[t])],e.children[t]&&"group"===e.children[t]._type&&this._updateGroupChild(e.children[t])},_dropSymbol:function(e,t){var i,a,n,o,s,r;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=e||this.selectionList[0]||this.activeTool.selectedObject,a={element:this.getNode(i)},this._nodeUnderMouse&&(a.target=this._nodeUnderMouse),n=!1,a.target||(a.target=this.model),i&&"group"===i._type&&this._updateGroupChild(i),this._remove(i),this.nameTable[a.element.name]=a.element,this._selectedSymbol=null,o=e||a.element,s=this.activeTool._getMouseOverElement(t),this.activeTool._outOfBoundsDrag(o)&&ej.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this,this.activeTool.selectedObject,s)?(this._raiseDropEvent(a),a.cancel||(this._isInsert=!0,this._containerOverNode=null,s&&s.container&&ej.datavisualization.Diagram.Util.canAllowDrop(s)&&!s.isSwimlane&&ej.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.activeTool.selectedObject,s)&&"connector"!==this.getObjectType(o)&&(o.parent=s.name,this._containerOverNode=s),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Drop,n=this.add(o),delete this._containerOverNode,this.activeTool.selectedObject=this.selectionList[0],this._isInsert=!1),n?(r=this.nameTable[a.element.name],this._updateDroppedSymbol(r)):this.activeTool.selectedObject=null):(this.activeTool.selectedObject=null,delete this.nameTable[a.element.name],this._clearSelection(!0)),ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||(this._clearSelection(!0),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan&&this.activateTool("panTool")))},_updateDroppedSymbol:function(e){e&&this.selectionList.length>0&&(this.scrollToNode(e),e.labels.length>0&&"edit"===e.labels[0].mode&&!e.labels[0].readOnly?e.isPhase||e.isSwimlane||e.isLane||(this._isEditing=!0,this.startLabelEdit(e,e.labels[0])):this.element[0].focus(),this._nodeUnderMouse&&this._nodeUnderMouse.segments&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg))},_initiateAutoScroll:function(e){if(this.activeTool.inAction&&this.enableAutoScroll()&&!(this.activeTool instanceof ej.datavisualization.Diagram.RotateTool)){var t=this._viewPort,i=this._mousePosition(e,!0),a=this.model.pageSettings.autoScrollBorder,n=ej.datavisualization.Diagram.ScrollUtil._getRulerSize(this);i.x+a.right-n.left>=t.width-18?(this._beginAutoScroll("right",e),this._canAutoScroll=!0):i.x<=a.left+n.left?(this._beginAutoScroll("left",e),this._canAutoScroll=!0):i.y+a.bottom+n.top>=t.height-18?(this._beginAutoScroll("bottom",e),this._canAutoScroll=!0):i.y<=a.top+n.top?(this._beginAutoScroll("top",e),this._canAutoScroll=!0):this._canAutoScroll=!1}},_updatePoints:function(e,t,i,a){var n=new ej.datavisualization.Diagram.Point(i.x-t.x,i.y-t.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(n)||e._updateEndPoint(n.x,n.y,a)},_cloneGroupNode:function(e,t,i){var a,n,o=null,s=e.children=this._getChildren(e.children);if("group"===e._type)for(n=0;n<s.length;n++)i?o=i[s[n]]:this._paletteTable&&(o=this._paletteTable[s[n]]),o&&(o=$.extend(!0,{},o),"group"===o._type&&this._cloneGroupNode(o,t),a=$.extend(!0,{},o),a.name+=t,a.parent=e.name,s[n]=a.name,this.nameTable[a.name]=a)},_addGroupConnector:function(e,t){var i,a,n,o,s,r,l;if(!e.segments)for(r=this._getChildren(e.children),n=0;n<r.length;n++)if(l=this.nameTable[r[n]]){if(l.inEdges&&l.inEdges.length>0)for(i=l.inEdges,o=0,s=i.length;s>o;o++)a=t.edgeTable?t.edgeTable[i[o]]:t.childTable[i[o]],a&&!this.nameTable[a.name]&&this.add(a);if(l.outEdges&&l.outEdges.length>0)for(i=l.outEdges,o=0,s=i.length;s>o;o++)a=t.edgeTable?t.edgeTable[i[o]]:t.childTable[i[o]],a&&!this.nameTable[a.name]&&this.add(a)}},_addConnector:function(e,t){var i,a,n,o;if(!e.segments){if(e.inEdges&&e.inEdges.length>0)for(i=e.inEdges,n=0,o=i.length;o>n;n++)a=t?t.edgeTable[i[n]]:this.nameTable[i[n]],a.zOrder=-1,this.add(a);if(e.outEdges&&e.outEdges.length>0)for(i=e.outEdges,n=0,o=i.length;o>n;n++)a=t?t.edgeTable[i[n]]:this.nameTable[i[n]],a.zOrder=-1,this.add(a)}},_addChildren:function(e,t){for(var i,a=this._getChildren(e.children),n=0;n<a.length;n++)i=t[a[n]],"group"===i._type&&this._addChildren(i,t),this.nameTable[a[n]]=i,e.children[n]=i},_updateLabels:function(e,t){e.labels=t;for(var i=0;i<e.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(e,e.labels[i],this)},_getNode:function(e,t){var i;return i=t?"object"==typeof e?t[e.name]:t[e]:"object"==typeof e?this.nameTable[e.name]:this.nameTable[e],i||"object"!=typeof e?i&&"string"==typeof e&&(i=t?t[e]:this.nameTable[e]):i=e,i?i.isLane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"lane"):i.isPhase||"phase"===i.type?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"phase"):i.isSwimlane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"swimlane",t):"node"===i._type||"group"===i._type||"pseudoGroup"===i._type||"node"==this.getObjectType(i)?i:i:null},_updateEdges:function(e){var t;ej.datavisualization.Diagram.Util.isTargetConnected(e)&&(t=this.nameTable[e.targetNode],t&&-1==t.inEdges.indexOf(e.name)&&t.inEdges.push(e.name)),ej.datavisualization.Diagram.Util.isSourceConnected(e)&&(t=this.nameTable[e.sourceNode],t&&-1==t.outEdges.indexOf(e.name)&&t.outEdges.push(e.name))},_updateChildrenEdges:function(e){for(var t,i=this._getChildren(e.children),a=0;a<i.length;a++)t=i[a],t.segments?(this._updateEdges(t),this._dock(t,this.nameTable)):"group"===t._type&&this._updateChildrenEdges(t)},_updateParent:function(e){for(var t,i,a=this._getChildren(e.children),n=0;n<a.length;n++)t=this.nodes().indexOf(this.nameTable[a[n]]),i=this.nameTable[a[n]],i="bpmn"!=i.type&&"connector"!=i.type?this._getNewNode(i):i,i&&"group"===i._type?this._updateParent(i):i&&(i.parent=e.name,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],this.nameTable[i.name]),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,this.nameTable[i.name]),this.nameTable[i.name]=i,-1!=t&&(this.nodes()[t]=i)),this._updateQuad(this.nameTable[i.name])},_findPortAtPoint:function(e,t){var i,a,n,o,s,r,l,d,h,c,u;if(t)for(d=ej.datavisualization.Diagram.Util.bounds(t,!0),i=t.ports,c=0,u=i.length;u>c;++c)if(a=i[c],o=ej.datavisualization.Diagram.Size(a.size,a.size),s=ej.datavisualization.Diagram.Util._getPortPosition(a,d),h=ej.Matrix.identity(),ej.Matrix.rotate(h,t.rotateAngle,t.offsetX,t.offsetY),s=ej.Matrix.transform(h,s),r=s.x-a.size/2,l=s.y-a.size/2,n=ej.datavisualization.Diagram.Rectangle(r,l,o.width,o.height),ej.datavisualization.Diagram.Geometry.containsPoint(n,e)||this.portHighlight&&(n=ej.datavisualization.Diagram.Rectangle(r-1,l-1,o.width+1,o.height+1),ej.datavisualization.Diagram.Geometry.containsPoint(n,e)))return ej.datavisualization.Diagram.Util.canConnect(a,!0)?a:null;return null},_findLabelAtPoint:function(e,t){var i,a,n,o,s,r,l,d,h,c,u,g,m,p,f=null,v=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],_=[];if(t&&this.model.labelRenderingMode!==ej.datavisualization.Diagram.LabelRenderingMode.Svg&&(c=ej.datavisualization.Diagram.Util.bounds(t,!0),i=t.labels,i&&i.length>0))for(f=i[0],m=0,p=i.length;p>m;m++)if(f=i[m],u=$(v).find("#"+t.name+"_"+f.name)[0],l=u?u.offsetWidth:0,d=u?u.offsetHeight:0,l||(l=c.width),d||(d=f.fontSize),n=ej.datavisualization.Diagram.Size(l,d),o=ej.datavisualization.Diagram.Util._getLabelPosition(f,c),o.x=c.x+o.x,o.y=c.y+o.y,g=ej.Matrix.identity(),t.segments?ej.Matrix.rotate(g,0,c.x+c.width/2,c.y+c.height/2):ej.Matrix.rotate(g,-t.rotateAngle,t.offsetX,t.offsetY),h=ej.Matrix.transform(g,e),g=ej.Matrix.identity(),ej.Matrix.rotate(g,-f.rotateAngle,o.x,o.y),h=ej.Matrix.transform(g,h),f.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Top?o.y+=n.height/2:f.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Bottom&&(o.y-=n.height/2),f.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Left?o.x+=n.width/2:f.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Right&&(o.x-=n.width/2),s=o.x-n.width/2,r=o.y-n.height/2,a=ej.datavisualization.Diagram.Rectangle(s,r,n.width,n.height),ej.datavisualization.Diagram.Geometry.containsPoint(a,h)&&_.push(f),m==i.length-1)return _.length?_[_.length-1]:null;return f},_getCurrentZoom:function(){return this._currZoom},_findNode:function(e){return this.nameTable[e]},_findPort:function(e,t){for(var i=e.ports,a=0,n=i.length;n>a;a++)if(i[a].name===t)return i[a];return null},_findLabel:function(e,t){for(var i=e.labels,a=0,n=i.length;n>a;a++)if(i[a].name===t)return i[a];return null},_findLabelRotateAngle:function(e){var t=this.findNode(e._parent),i=0;return t&&(i=t.segments?e.rotateAngle:e.rotateAngle+t.rotateAngle,i>360&&(i%=360)),i},_findConnector:function(e){return this.nameTable[e]},_findChildren:function(e,t){for(var i,a,n=this._getChildren(e.children),o=0;o<n.length;o++)if(i=this.nameTable[n[o]]){if(t==i.name)return i;if("group"===i._type&&(a=this._findChildren(i,t)))return a}return null},_removeLaneParent:function(e){var t,i,a,n,o,s,r,l,d=[],h=[],c=[],u=0,g=!1,m=[];if(e.isLane&&e.parent){if(a=this.nameTable[e.parent],a.children&&1===a.children.length&&a&&a.parent&&(l=this.nameTable[a.parent]))return{remove:!0,node:l}}else if("pseudoGroup"==e._type){for(t=0;t<e.children.length;t++)h[t]=this.nameTable[e.children[t]],h[t]&&h[t].isLane&&h[t].parent?(d[t]=h[t].parent,g=!0):m.push(h[t]);if(this.isSameParent(d)&&d.length==e.children.length){if(i=this.nameTable[d[0]],i.children.length==d.length&&(l=this.nameTable[i.parent],l&&l.isSwimlane))return{remove:!0,node:l}}else if(g){for(r=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),c=d.filter(function(e,t,i){return i.indexOf(e)==t}),t=0;t<c.length;t++){for(u=0,n=0;n<d.length;n++)c[t]==d[n]&&u++;if(s=this.nameTable[c[t]],u&&s&&s.children&&s.children.length==u)l=this.nameTable[s.parent],l&&l.isSwimlane&&r.children.push(l);else if(u)for(o=0;o<e.children.length;o++)h=this.nameTable[e.children[o]],h.parent==c[t]&&r.children.push(h)}if(m.length>0)for(o in m)r.children.push(m[o]);if(r&&r.children.length>1)return ej.datavisualization.Diagram.Util._updateGroupBounds(r,this),{remove:!0,node:r}}}return{remove:!1}},_delete:function(e){var t,i,a,n,o,s,r,l,d,h,c,u=!1,g=!1;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(e=e||this.selectionList[0]))if(!e.isPhase&&(e.type&&"phase"!=e.type||e.segments||"node"==e._type||"pseudoGroup"==e._type)||this._dropPhase){if(r=this._removeLaneParent(e),r.remove&&(e=r.node),o=e,"pseudoGroup"==o.type)for(s=0;s<o.children.length;s++)i="object"==typeof o.children[s]?o.children[s].name:o.children[s],t=this.findNode(i),t&&t.parent&&t.isLane&&(t._laneIndex=this._getRemoveIndex(t),g=!0);if("pseudoGroup"==o.type&&g){for(a=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),n=this._getChildren(o.children),this._multipleAction=!0,s=n.length-1;s>=0;s--)t=this.nameTable[n[s]],t.isLane&&t.parent?(r=this._removeLaneParent(t),l=r.remove?r.node:t):l=t,l&&a.children.push(l);for(g&&(a._isMultipleLaneDelete=!0),a&&a.children.length>0&&(ej.datavisualization.Diagram.Util._updateGroupBounds(a,this),this._selectedSymbol||this._removeAdjacentConnections(a)),n=a.children,s=n.length-1;s>=0;s--)t="object"==typeof n[s]?n[s]:this.nameTable[n[s]],this._isUndo=!1,u=this._remove(t),this._isUndo=!0;delete this._multipleAction,this._isUndo=!1}else if("pseudoGroup"==o._type){for(s=0;s<e.children.length;s++)e.children[s]="object"==typeof e.children[s]?e.children[s].name:e.children[s];for(this._selectedSymbol||this._removeAdjacentConnections(e),n=this._getChildren(o.children),this._multipleAction=!0,s=n.length-1;s>=0;s--)this._remove(this.nameTable[n[s]])&&(u=!0),this._isUndo=!0;delete this._multipleAction,this._isUndo=!1}else this._selectedSymbol||this._removeAdjacentConnections(e),this._nodeUnderMouse===o&&(this._nodeUnderMouse=null),u=this._remove(o),o.container&&o.parent&&(d=this.nameTable[o.parent],d&&d.container&&"stack"==d.container.type&&(this._getChild(d.children[0])?(h=this._getSwimlane(o),h&&this._updateChildAdjacentConnectors(h,!0),ej.datavisualization.Diagram.DiagramContext.update(d,this)):(c=this.nameTable[d.parent],c&&this._remove(c))));u&&this._clearSelection()}else e.type&&"phase"==e.type&&(this._removePhase(e.name),this._clearSelection())},_removeAdjacentConnections:function(e,t){var i,a,n,o,s,r,t,l={},d={};if(l=this._getChildTable(e,l),d=this._getEdgeTable(e,d),!this._isUndo||t){if(i={},a={},!e.segments){if(e.outEdges&&e.outEdges.length>0)for(o=e.outEdges.length,s=0;o>s;s++)n=this.nameTable[e.outEdges[s]],n&&n.sourcePort&&(i[n.name]=n.sourcePort);if(e.inEdges&&e.inEdges.length>0)for(o=e.inEdges.length,s=0;o>s;s++)n=this.nameTable[e.inEdges[s]],n&&n.targetPort&&(a[n.name]=n.targetPort)}this._isUndo?(t.targetPorts=a,t.sourcePorts=i,t.edgeTable=d,t.childTable=l):(r=null,e.isLane&&(r=this._getRemoveIndex(e)),t={type:"collectionchanged",object:this._updatePsedoGroupChildren(e),index:r,childTable:jQuery.extend(!0,{},l),edgeTable:jQuery.extend(!0,{},d),sourcePorts:i,targetPorts:a,changeType:"remove",category:"internal"},e.isPhase||ej.datavisualization.Diagram.Util.canDelete(e)&&this.addHistoryEntry(t))}},_updatePsedoGroupChildren:function(e){var t,i,a=jQuery.extend(!0,{},e);if(e&&"pseudoGroup"==e.type)for(i=0;i<a.children.length;i++)t=this.nameTable[this._getChild(a.children[i])],t&&(t.isSwimlane||t.isLane&&e._isMultipleLaneDelete)&&(a.children[i]=this.getNode(t));return a},_getRemoveIndex:function(e){var t,i,a;if(e.parent&&(t=this.nameTable[e.parent],t&&t.children&&t.children.length>0))for(a in t.children)if(i=this._getChild(t.children[a]),i===this._getChild(e))return Number(a);return 0},_getSwimlaneHeader:function(e){var t;return e&&e.isSwimlane&&e.children&&e.children.length>0&&(t=this.nameTable[this._getChild(e.children[0])]),t},_addPhase:function(e,t,i){var a,n,o,s,r,l,d=this.nameTable[e],h=!1;if(d&&d.isSwimlane&&t&&(d&&d.orientation&&t.offset&&("horizontal"==d.orientation?(a=d.offsetX-d.width/2,o=this._getFirstLane(d),o&&(a+=o.width),h=t.offset>d.width||d.offsetX-d.width/2+t.offset<a):"vertical"==d.orientation&&(a=d.offsetY-d.height/2,n=this._getSwimlaneHeader(d),n&&(a+=n.height),o=this._getFirstLane(d),o&&(a+=o.height),h=t.offset>d.height||d.offsetY-d.height/2+t.offset<a)),t.offset&&!h)){if(i&&i.islastPhase&&(s=i.phase,"horizontal"===d.orientation?d.width>t.offset&&(t.width+=d.width-t.offset,t.offset=d.width):d.height-n.height>t.offset&&(t.height+=d.height-n.height-t.offset,t.offset=d.height-n.height)),r=ej.datavisualization.Diagram.Phase(t),r.orientation=d.orientation,r.label=ej.datavisualization.Diagram.Label(t.label?t.label:{text:"Phase"}),r.parent=d.name,this.nameTable[r.name]&&(ej.datavisualization.Diagram.Util.removeItem(this.model.phases,this.nameTable[r.name]),delete this.nameTable[r.name]),i&&i.islastPhase){var c=this._getInsertIndex(r)+1,u=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,d),g=$.extend(!0,{},i.phaseObject.prevPhase);this._updateInsertPhase(r,g.name,d,c,i),ej.datavisualization.Diagram.SvgContext.renderphase(r,this._svg,this._diagramLayer,this,d),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(d.children[1])],!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,r)}else{var c=this._getInsertIndex(r)+1,u=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,d),g=$.extend(!0,{},this.nameTable[this._getChild(u[c-1])]);this._updateInsertPhase(r,u[c],d,c),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.SvgContext.renderphase(r,this._svg,this._diagramLayer,this,d),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(d.children[1])],!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,r)}this._isUndo||(l={type:"phasecollectionchanged",phase:r,category:"internal",group:d.name,isAdded:!0},this.addHistoryEntry(l))}this._clearSelection(!0)},_removePhase:function(e){var t,i,a,n,o,s,r,l,d=this.nameTable[e],h=!1,c=null;d&&(this._raiseChildrenPropertyChange(d),t=this.nameTable[d.parent.split("phaseStack")[0]],i=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,t),t&&i&&i.length>1&&(r=this,a=i.indexOf(d.name),this._views.forEach(function(t){var i=r._views[t],a=i.svg.getElementById(e+"_phase_g");a&&a.parentNode.removeChild(a)}),n=ej.datavisualization.Diagram.SwimLaneContainerHelper._getNextPhase(this,d),a===i.length-1&&(n=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPrevPhase(this,d),c=$.extend(!0,{},{prevPhase:n,currPhase:d}),n.offset=d.offset,h=!0),"horizontal"===t.orientation?n.width+=d.width:n.height+=d.height,o=this.nameTable[e],ej.datavisualization.Diagram.Util.removeItem(this.nodes(),o),this._nodes=$.extend(!0,[],this.nodes()),s=this.nameTable[o.parent],delete this.nameTable[e],ej.datavisualization.Diagram.SvgContext._updatephase(n,this),ej.datavisualization.Diagram.Util.removeItem(i,d.name),ej.datavisualization.Diagram.Util.removeItem(s.children,o),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,s,!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,d),r=this,this._views.forEach(function(t){var i=r._views[t],a=i.svg.getElementById(e);a&&a.parentNode.removeChild(a);var n=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=$(n).find("#"+o.name+"_label")[0],l=i.svg.getElementById(o.name);l&&l.parentNode&&l.parentNode.removeChild(l),s&&n.removeChild(s)}),this._isUndo||(l={type:"phasecollectionchanged",phase:d,group:t.name,category:"internal",phaseObject:c,islastPhase:h,isAdded:!1},this.addHistoryEntry(l))))},_getEdgeTable:function(e,t){var i,a,n,o,s,r,l,d;if(!e.segments){if("group"===e._type||"pseudoGroup"===e._type)for(r=this._getChildren(e.children),n=0;n<r.length;n++){if(l=this.nameTable[r[n]],l&&l.inEdges&&l.inEdges.length>0)for(i=l.inEdges,o=0,a=i.length;a>o;o++)s=this.nameTable[i[o]],
s&&(d=t[s.name]=$.extend(!0,{},s));if(l&&l.outEdges&&l.outEdges.length>0)for(i=l.outEdges,o=0,a=i.length;a>o;o++)s=this.nameTable[i[o]],s&&(d=t[s.name]=$.extend(!0,{},s))}if(e.inEdges&&e.inEdges.length>0)for(i=e.inEdges,o=0,a=i.length;a>o;o++)s=this.nameTable[i[o]],s&&(d=t[s.name]=$.extend(!0,{},s));if(e.outEdges&&e.outEdges.length>0)for(i=e.outEdges,o=0,a=i.length;a>o;o++)s=this.nameTable[i[o]],s&&(d=t[s.name]=$.extend(!0,{},s))}return t},_remove:function(e,t,i){var a,t,n,o,s,r,l,d,h,c,u,g,m=!1;if(this._raiseChildrenPropertyChange(e),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&e&&(ej.datavisualization.Diagram.Util.canDelete(e)||i)&&(a=e.segments?"connector":"node",t=t?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,n={changeType:"remove",element:this.getNode(e),cancel:!1,dependent:t,state:"changing"},e.segments||(n.adjustDependent=!0,n.deleteDependent=!0),o=this._eventCause[a+"CollectionChange"],o||(this._isKeyDown||this._isUndo)&&(this._eventCause[a+"CollectionChange"]=this._isUndo&&!this._multipleAction?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Keydown),e.isPhase||this._selectedSymbol||this._raiseEvent(a+"CollectionChange",n),!n.cancel)){if(m=!0,s=e.name,"group"==e.type&&"pseudoGroup"!=e.type)for(r=this._getChildren(e.children),l=0;l<r.length;l++)if(d=this.nameTable[r[l]],d&&!ej.datavisualization.Diagram.Util.canDelete(d))return;if(e.isSwimlane&&ej.datavisualization.Diagram.SvgContext._removephases(e,this),"bpmn"==e.type)for(r=this._getChildren(e.children),l=0;r&&l<r.length;l++)if(d=this.nameTable[r[l]],d&&d.annotation&&d._annotation)for(h=0;h<d._annotation.length;h++)this.nameTable[d._annotation[h]]&&this._remove(this.nameTable[d._annotation[h]],t,!0);if(e.segments)this._removeEdges(e),e.sourceNode=e.sourcePort=e.targetNode=e.targetPort=null,this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[e.name]),ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[e.name]),this._connectors=$.extend(!0,[],this.connectors());else{if(e.annotation&&e._annotation)for(h=0;h<e._annotation.length;h++)this.nameTable[e._annotation[h]]&&this._remove(this.nameTable[e._annotation[h]]);this._disConnect(e,n),this._removeConnector(e,n),this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[e.name]),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[e.name]),this._nodes=$.extend(!0,[],this.nodes())}a=this.getObjectType(e),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[e.name],e),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,e,!1),e.parent&&(c=this.nameTable[e.parent],c&&("group"==c.type||"bpmn"==c.type||"umlclassifier"==c.type)&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(c.children,e.name),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),u=$.extend(!0,{},c),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,c,!0),c.parent&&ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,this.nameTable[c.parent]),ej.datavisualization.Diagram.Util._refreshParentGroup(e,this),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(this,c,u),ej.datavisualization.Diagram.canvasHelper._updateAddRemoveLaneConnectors(this,e),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[c.parent]),this._updateQuad(c))),delete this.nameTable[s],e.segments&&this._updateConnectorBridging(e),g=this._svg.getElementById(e.name),"group"==e._type&&"pseudoGroup"!=e.type&&this._removeChildren(e,n),this._removeElement(e),g&&g.parentNode&&g.parentNode.removeChild(g),ej.datavisualization.Diagram.SvgContext._removeContainerHelper(this.activeTool.selectedObject,this._adornerSvg,this._adornerLayer),this._clearSelection(!(!this._selectedSymbol&&!this._dropPhase))}return!m||e.isPhase||this._selectedSymbol||(n.state="changed","connector"===e.type?this._raiseEvent("connectorCollectionChange",n):this._raiseEvent("nodeCollectionChange",n)),m},_removeConnector:function(e,t){var i,a,n;if(!e.segments){if(t.deleteDependent&&!t.adjustDependent){if(e.inEdges&&e.inEdges.length>0)for(i=e.inEdges,a=i.length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);if(e.outEdges&&e.outEdges.length>0)for(i=e.outEdges,a=0,n=i.length;n>a;a++)this._updateConnection(this.nameTable[i[a]],!0)}if(t.deleteDependent&&t.adjustDependent)if(e.inEdges&&e.inEdges.length>0&&e.outEdges&&e.outEdges.length>0){for(i=e.outEdges,a=i.length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);for(i=e.inEdges,a=i.length-1;a>=0;a--)this.nameTable[i[a]]&&this._updateConnection(this.nameTable[i[a]],!0)}else if(e.inEdges&&0==e.inEdges.length&&e.outEdges.length>0)for(i=e.outEdges,a=i.length-1;a>=0;a--)this._updateConnection(this.nameTable[i[a]],!0);else if(e.outEdges&&0==e.outEdges.length&&e.inEdges.length>0)for(i=e.inEdges,a=i.length-1;a>=0;a--)this.nameTable[i[a]]&&this._updateConnection(this.nameTable[i[a]],!0);else if((e.inEdges&&1==e.inEdges.length||e.inEdges.length>1)&&1==e.outEdges.length)for(i=e.outEdges,a=0,n=i.length;n>a;a++)this._updateConnection(this.nameTable[i[a]],!0);else if(!(e.inEdges&&e.inEdges.length>1&&e.outEdges.length>1))for(i=e.inEdges,a=0,n=i.length;n>a;a++)this._updateConnection(this.nameTable[i[a]],!0)}},_updateConnection:function(e,t){e&&ej.datavisualization.Diagram.Util.canDelete(e)&&(this._remove(e,t),this.updateConnector(e.name))},_removeElement:function(e){for(var t,i=0;i<this._views.length;i++)t=this._views[i],this._views[t].context.removeChild(e,this._views[t])},_disConnect:function(e,t,i){var a,n,o,s,r,l,d,h,c,u,g;if(e.inEdges&&e.inEdges.length>0)for(a=e.inEdges,d=0,c=a.length;c>d;d++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[a[d]])&&(g=!0);if(e.outEdges&&e.outEdges.length>0)for(n=e.outEdges,d=0,c=n.length;c>d;d++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[n[d]])&&(g=!0);if(t.deleteDependent&&t.adjustDependent&&!i&&g){if(e.inEdges&&e.inEdges.length>0&&e.outEdges.length>0)if(a=e.inEdges,n=e.outEdges,(e.inEdges.length>1||1==e.inEdges.length)&&1==e.outEdges.length){for(d=0,c=a.length;c>d;d++)this.nameTable[a[d]]&&this.nameTable[n[0]]&&this.nameTable[a[d]].targetNode==this.nameTable[n[0]].sourceNode&&(r=this.nameTable[this.nameTable[n[0]].targetNode],r&&(l=$.extend(!0,{},r),this.nameTable[a[d]].sourceNode!=this.nameTable[n[0]].targetNode&&(this.nameTable[a[d]].targetNode=this.nameTable[n[0]].targetNode,this.nameTable[a[d]].targetPort=this.nameTable[n[0]].targetPort,r.inEdges.push(this.nameTable[a[d]].name))),ej.datavisualization.Diagram.Util.dock(this.nameTable[a[d]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[a[d]],this));this.nameTable[n[0]]&&(this.nameTable[n[0]].sourceNode=null,this.nameTable[n[0]].sourcePort=null)}else if(!(e.inEdges.length>1&&e.outEdges.length>1))for(d=0,c=a.length;c>d;d++)if(e.outEdges.length>0&&this.nameTable[a[d]]){for(s=this.nameTable[this.nameTable[a[d]].sourceNode],l=$.extend(!0,{},s),h=0,u=n.length;u>h;h++)this.nameTable[a[d]].targetNode==this.nameTable[n[h]].sourceNode&&(this.nameTable[n[h]].sourceNode=this.nameTable[a[d]].sourceNode,this.nameTable[n[h]].sourcePort=this.nameTable[a[d]].sourcePort,s.outEdges[l.outEdges.length+h]=this.nameTable[n[h]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[n[h]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[n[h]],this));this.nameTable[a[d]].targetNode=null,this.nameTable[a[d]].targetPort=null}}else{if(e.inEdges&&e.inEdges.length>0)for(a=e.inEdges,d=0,c=a.length;c>d;d++)o=this.nameTable[a[d]],o&&(o.targetNode=null,o.targetPort=null);if(e.outEdges&&e.outEdges.length>0)for(n=e.outEdges,d=0,c=n.length;c>d;d++)o=this.nameTable[n[d]],o&&(o.sourceNode=null,o.sourcePort=null)}},_removeEdges:function(e){e.targetNode&&this.nameTable[e.targetNode]&&this.nameTable[e.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[e.targetNode].inEdges,e.name),e.sourceNode&&this.nameTable[e.sourceNode]&&this.nameTable[e.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[e.sourceNode].outEdges,e.name)},_selectionContains:function(e){if(this._hasSelection()&&e)for(var t=0;t<this.selectionList.length;t++)if(e.name===this.selectionList[t].name)return!0;return!1},_getPhaseIndex:function(e){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,e)},_getPhaseBounds:function(e){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseBounds(this,e)},_addSelection:function(e,t){var i,a,n,o,s,r,l,d;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||e&&"pseudoGroup"===e._type||this._selectedSymbol||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&e&&ej.datavisualization.Diagram.Util.enableLayerOption(e,"lock",this)&&(ej.datavisualization.Diagram.Util.canSelect(e)||"phase"==e.type)&&!this._selectionContains(e)){var h=[],c=[],u=[];if(this._previousSelectedItems&&(c=this._previousSelectedItems),"pseudoGroup"==e.type)for(i=this._getChildren(e.children),a=0;a<i.length;a++)n=this.nameTable[i[a]],-1==c.indexOf(n)?h.push(n):ej.datavisualization.Diagram.Util.removeItem(c,n),u.push(n);else h.push(e),u.push(e);o=this._eventCause.selectionChange,o||(this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Unknown),s=this.getNode(e),r={changeType:"insert",element:this.getNode(e),state:"changing",selectedItems:u,oldItems:c,newItems:h,cancel:!1},this._selectedSymbol&&!this._endEditing||t||(this._raiseEvent("selectionChange",r),this._previousSelectedItems=r.newItems),r.cancel?e&&"pseudoGroup"==e.type&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),e),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[e.name]):(this.selectionList.push(e),this._updateSelectorObject(e),e.isPhase&&(l=this._getPhaseBounds(e)),ej.datavisualization.Diagram.SvgContext.renderSelector(e,this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,l,this),null!=this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0&&(d=!1,"pseudoGroup"==e.type&&(d=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,e,this._adornerSvg,d,this._currZoom,this._adornerLayer,this)),this._selectedSymbol&&!this._endEditing||t||(r={changeType:"insert",element:this.getNode(e),state:"changed",cause:r.cause,selectedItems:u,oldItems:c,newItems:h,cancel:!1},this._raiseEvent("selectionChange",r)))}},_getInsertIndex:function(e){var t,i,a,n=-1,o=this.nameTable[e.parent],s=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,o);if(s&&s.length>0&&this.nameTable[this._getChild(s[0])])for(t=this.nameTable[this._getChild(s[0])].offset,a=0;a<s.length;a++)i=this.nameTable[this._getChild(s[a])],i&&i.offset<=e.offset&&i.offset>=t&&(t=i.offset,n=a);return n},_updateInsertPhase:function(e,t,i,a,n){var o,s,r,l,d,h,c=this.nameTable[t],u=this.nameTable[this._getChild(i.children[1])];u&&u.children&&u.children.length>0&&(o=this.nameTable[t],s=ej.datavisualization.Diagram.Node(e),i.isSwimlane&&i.orientation&&"vertical"==i.orientation?(n?(r=e.height,o.height=n.phaseObject.prevPhase.height,o.offset=n.phaseObject.prevPhase.offset):(r=o.height,o.height=c.offset-e.offset,l=r-o.height,s.height=l),s.parent=u.name,s.name=e.name,s.width=o.width,s.isPhase=!0):(n?(d=e.width,o.width=n.phaseObject.prevPhase.width,o.offset=n.phaseObject.prevPhase.offset):(d=o.width,o.width=c.offset-e.offset,h=d-o.width,s.width=h),s.parent=u.name,s.name=e.name,s.height=o.height,s.isPhase=!0),s.x=0,s.y=0,this._isUndo&&0!==s.labels.length||(s.labels=[e.label?e.label:ej.datavisualization.Diagram.Label()]),s.labels[0].rotateAngle="horizontal"==e.orientation?0:270,s.constraints=ej.datavisualization.Diagram.NodeConstraints.Default&~(ej.datavisualization.Diagram.NodeConstraints.Select|ej.datavisualization.Diagram.NodeConstraints.Connect),s.isPhase=!0,s._type="node",this.add(s,{entryHistory:!0}),u.children.pop(s),u.children.splice(a,0,s))},_getFirstLane:function(e){var t,i,a;return e.children[2]&&(t=this.nameTable[this._getChild(e.children[2])]),t&&t.children&&t.children.length>0&&(i=this.nameTable[this._getChild(t.children[0])],i&&i.children&&i.children.length>0&&(a=this.nameTable[this._getChild(i.children[0])]))?a:null},updateSelector:function(e){if(""!=this._selectedItem){var t={};e.offsetX&&(t.offsetX=Number("function"==typeof e.offsetX?e.offsetX():e.offsetX)),e.offsetY&&(t.offsetY=Number("function"==typeof e.offsetY?e.offsetY():e.offsetY)),e.width&&(t.width=Number("function"==typeof e.width?e.width():e.width)),e.height&&(t.height=Number("function"==typeof e.height?e.height():e.height)),e.rotateAngle&&(t.rotateAngle=Number("function"==typeof e.rotateAngle?e.rotateAngle():e.rotateAngle)),this.updateNode(this._selectedItem,t)}e.userHandles&&(this.model.selectedItems.userHandles=e.userHandles,this._initHandles(),this.selectionList[0]&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,"pseudoGroup"==this.selectionList[0].type,!1,this._currZoom,this)),e.tooltip&&(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.selectedItems.tooltip,{},e.tooltip)))},_updateSelectorObject:function(e){var t,i;if(e.segments||(this._selectorOffsetX(e.offsetX),this._selectorOffsetY(e.offsetY),this._selectorWidth(e.width),this._selectorHeight(e.height),this._selectorRotateAngle(e.rotateAngle),this._selectedItem=e.name),"pseudoGroup"==e.type)for(t=0;t<e.children.length;t++)i=e.children[t],"object"==typeof i?this.model.selectedItems.children.indexOf(i)<0&&this.model.selectedItems.children.push(i):"string"==typeof i&&this.model.selectedItems.children.indexOf(this.nameTable[this._getChild(i)])<0&&this.model.selectedItems.children.push(this.nameTable[this._getChild(i)]);else this.model.selectedItems.children.indexOf(e)<0&&this.model.selectedItems.children.push(e)},_clearSelectorObject:function(){this._selectorOffsetX(0),this._selectorOffsetY(0),this._selectorWidth(0),this._selectorHeight(0),this._selectorRotateAngle(0),this._selectedItem="",this.model.selectedItems.children=[]},_raiseEvent:function(e,t){return this.model[e]?(t.elementType=this.getObjectType(t.element),(("nodeCollectionChange"===e||"connectorCollectionChange"===e||"selectionChange"===e)&&"changing"===t.state||"scrollChange"===e)&&(t.cause=this._eventCause[e]?this._eventCause[e]:"unknown"),this._multipleAction||(this._eventCause={}),t.diagramId=this.element[0].id,this._trigger(e,t)):void 0},_clearSelection:function(e){if(this._hasSelection()){this._isEditing&&this.selectionList.length>0&&!this._isDragg&&this._endEdit();var t={changeType:"remove",state:"changing",element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1};this._selectedSymbol||e||(this._raiseEvent("selectionChange",t),this._previousSelectedItems=[]),t.cancel||(this._clearSelectorObject(),this.selectionList[0]&&"pseudoGroup"==this.selectionList[0].type&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.selectionList[0]),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer,this),this._selectedSymbol||e||(t={changeType:"remove",state:"changed",cause:t.cause,element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1},this._raiseEvent("selectionChange",t)))}},_updateSelectionHandle:function(e){var t,i,a,n;this.selectionList.length>0&&(t="label"==this.selectionList[0]._type?this.selectionList[0]:this.nameTable[this.selectionList[0].name],i=this.model.selectedItems.constraints,e&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&(i&=~ej.datavisualization.Diagram.SelectorConstraints.UserHandles),"label"!==this.selectionList[0]._type&&this._updateSelectorObject(t),a=ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,i,this.activeTool._resizeDirection,e),a||null!=this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0&&(n=!1,"pseudoGroup"==t.type&&(n=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,t,this._adornerSvg,n,e,this._currZoom,this)))},_hasSelection:function(){return this.selectionList.length>0},_canActivateLabelTool:function(e,t){var i,a,n,o,s,r,l;if(t){if(i=this._findLabelAtPoint(this._mousePosition(e),t),null==i&&(a="",o=e.target,this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg&&(s=$(e.target).parents(".ej-d-label"),s[0]&&(o=s[0])),o&&(a=o.getAttribute("class"),"ej-d-label"==a)))for(r=o.id.split("_"),l=0;l<t.labels.length;l++)n=t.labels[l].name.split("_"),r[r.length-1]==n[n.length-1]&&(i=t.labels[l]);if(i)return ej.datavisualization.Diagram.Util.canMoveLabel(t)?1:ej.datavisualization.Diagram.Util.canSelect(i)||ej.datavisualization.Diagram.Util.canMove(i)||ej.datavisualization.Diagram.Util.canResize(i)||ej.datavisualization.Diagram.Util.canRotate(i)}return!1},_checkToolToActivate:function(e,t){var i,a,n,o,s,r,l,d,h=!1,c=!1;return i=ej.datavisualization.Diagram.Util._getPseudoGroupConstraints(this,t,this.selectionList[0]),t?((t.segments&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&e.shiftKey||(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&e.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",h=!0),h||(e.target&&"ej-d-port"!=e.target.getAttribute("class")&&this._selectionContains(t)?(t.segments?h=this._canActivateEndPointTool(e,t):((!i||i&ej.datavisualization.Diagram.NodeConstraints.Resize)&&(h=this._canActivateResizeTool(e,t)),h||(!i||i&ej.datavisualization.Diagram.NodeConstraints.Rotate)&&(h=this._canActivateRotateTool(e,t))),h||(h=this._canActivateUserHandle(e,t)),h||(!i||i&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(t&&t.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(t)?(this._toolToActivate="select",this._currentCursor="default"):e&&e.target&&this._canActivateLabelTool(e,t)&&("ej-d-label"===e.target.getAttribute("class")||"ej-d-label"===e.target.parentNode.getAttribute("class")||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?c=!0:h=this._canActivateMoveTool(e,t)),h||(h=this._canActivatephaseTool(e))):(e&&e.target&&"ej-d-port"===e.target.getAttribute("class")&&(a=this._mousePosition(e),n=this._findPortAtPoint(a,t),n&&(o=this._getvalues(e),s=this._getSetTool(),s&&s(o,n),(s&&"draw"===o.action||"drag"!=o.action&&n.constraints&ej.datavisualization.Diagram.PortConstraints.ConnectOnDrag&&ej.datavisualization.Diagram.PortConstraints.Connect&&(n.visibility&ej.datavisualization.Diagram.PortVisibility.Visible||n.visibility&ej.datavisualization.Diagram.PortVisibility.Hover))&&(this._currentCursor="crosshair",r=this.model.drawType,l=r.segments&&r.segments.length&&r.segments[0].type?r.segments[0].type:"orthogonal","orthogonal"===l?this.activateTool("orthogonalLine",!0):this.activateTool("straightLine",!0),this._activatedFromPort=!0,h=!0))),e&&this._canActivateLabelTool(e,t)&&e.target&&("ej-d-label"===e.target.getAttribute("class")||"ej-d-label"===e.target.parentNode.getAttribute("class")||this.model.labelRenderingMode===ej.datavisualization.Diagram.LabelRenderingMode.Svg)?c=!0:(!i||i&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(h=this._canActivateMoveTool(e,t))))):h=this._canActivatephaseTool(e),n&&"drag"===o.action&&(this._currentCursor="pointer",this._toolToActivate="portTool"),c&&(this._currentCursor="pointer",this._toolToActivate="labelMove",h=!0),h||(this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&(d=this._findNodeUnderMouse(e),d&&(this._toolToActivate="select",this._currentCursor="default",h=!0)),h||(this._toolToActivate="panTool",this._currentCursor="pointer")):(this._toolToActivate="select",this._currentCursor="default")),"rotate"!=this._toolToActivate&&"labelRotate"!=this._toolToActivate&&this._adornerSvg.document.removeAttribute("class"),h},_canActivatephaseTool:function(e){if($(e.target).parents(".ej-d-seperator").first()[0]){var t=$(e.target).parents("g").first()[0].id,i=this._getSeperetor(t.split("_phase_g")[0]),a=this.nameTable[i.parent.split("phaseStack")[0]];if(a&&ej.datavisualization.Diagram.Util.canResize(a))return this._currentCursor=i?"horizontal"==i.orientation?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(e){if(this._isUserHandle(e)&&e.target){var t=e.target.id.split("_")[0];return this._toolToActivate=t,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(e,t){if(t){var i=e.target.getAttribute("class");if(i&&("targetEndPoint"===i&&ej.datavisualization.Diagram.Util.canDragTargetEnd(t)||"sourceEndPoint"===i&&ej.datavisualization.Diagram.Util.canDragSourceEnd(t)||(i.match("bezierpoint")||"segmentEnd"==i)&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(t)))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(e,t){var i,a=e.target.getAttribute("class");return ej.datavisualization.Diagram.Util.canResize(t,a)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer&&("nw-resize"===a||"n-resize"===a||"ne-resize"===a||"w-resize"===a||"e-resize"===a||"sw-resize"===a||"s-resize"===a||"se-resize"===a)?("label"!==t._type?(this._toolToActivate="resize",i=t.rotateAngle):(this._toolToActivate="labelResize",i=this._findLabelRotateAngle(t)),i>=0&&25>i||i>=160&&205>=i||i>=340&&360>=i?this._currentCursor=a:i>=25&&70>=i||i>=205&&250>=i?this._currentCursor="n-resize"===a||"s-resize"===a?"ne-resize":"nw-resize"===a||"se-resize"===a?"n-resize":"e-resize"===a||"w-resize"===a?"nw-resize":"e-resize":i>=70&&115>=i||i>=250&&295>=i?this._currentCursor="n-resize"===a||"s-resize"===a?"e-resize":"nw-resize"===a||"se-resize"===a?"ne-resize":"e-resize"===a||"w-resize"===a?"n-resize":"nw-resize":(i>=115&&155>=i||i>=295&&340>=i)&&(this._currentCursor="n-resize"===a||"s-resize"===a?"nw-resize":"nw-resize"===a||"se-resize"===a?"e-resize":"e-resize"===a||"w-resize"===a?"ne-resize":"n-resize"),!0):!1},_canActivateMoveTool:function(e,t){var i,a,n,o,s;return e.target&&(i=e.target.className),a=i&&ej.datavisualization.Diagram.Util.isClassifier(e)?ej.datavisualization.Diagram.ClassifierHelper.getMovableElementUnderMouse(e,this):i&&"ej-d-multiselector"===i.animVal&&t&&"pseudoGroup"==t.type&&ej.datavisualization.Diagram.Util.canDragHelper(this)?this.selectionList[0]:this._findNodeUnderMouse(e),a&&a.name===t.name&&(n=!0,t.parent&&(n=!!(this.selectionList.length>0&&this._selectionContains(t))),o=!1,t.parent&&(s=this.nameTable[t.parent],s&&((s.isSwimlane||s.isLane)&&ej.datavisualization.Diagram.Util.canMove(s)||s.isPhaseStack)&&(o=!0)),ej.datavisualization.Diagram.Util.canMove(t)||o)?(this._toolToActivate="move",this._currentCursor=this._isHyperLink(e)?"pointer":this.selectionList.length>0&&(this._selectionContains(t)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],t.name))?"move":"default",!0):!1},_isLabelTemplate:function(e){var t,i,a,n,o;if(e&&(t=$(e.target).parents(".ej-label-template"),i=t[0])){if(a=i.parentNode.id.split("_"),"lblbg"==a[a.length-1])return!0;for(n=e.target.parentNode,o=n.getAttribute("class");n;){if("ej-label-template"===o)return!0;n=n.parentNode,o=n.getAttribute("class")}}},_isHyperLink:function(e){var t=e.target,i=t.getAttribute("class");return!(i&&"ej-d-label"!=!i||!t.parentNode||!$(t.parentNode).hasClass("ej-d-label")||(t=t.parentNode,!$(t.parentNode).hasClass("ej-d-anchor")))},_canActivateRotateTool:function(e,t){if(ej.datavisualization.Diagram.Util.canRotate(t)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator){var i=e.target.getAttribute("class");if("rotateHandle"===i)return this._toolToActivate="label"!==t._type?"rotate":"labelRotate","msie"===ej.browserInfo().name?(this._currentcursor="default",this._adornerSvg.document.setAttribute("class","svg-rotate-ie"),this._currentCursor=""):(this._adornerSvg.document.setAttribute("class","svg-rotate"),this._currentCursor=""),!0}return!1},_canActivatePivotTool:function(e){var t=e.target.getAttribute("class");return"pivot"===t?(this._toolToActivate="pivot",this._currentCursor="default",!0):!1},_updateCursor:function(){this.element[0].style.cursor=this._currentCursor,this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0].style.cursor=this._currentCursor},_getResizeCursor:function(e){var t="default";switch(e){case"topleft":t="nw-resize";break;case"topcenter":t="n-resize";break;case"topright":t="ne-resize";break;case"middleleft":t="w-resize";break;case"middleright":t="e-resize";break;case"bottomleft":t="sw-resize";break;case"bottomcenter":t="s-resize";break;case"bottomright":t="se-resize"}return t},_startEdit:function(e){var t,i,a,n,o,s,r,l,d,h,c,u,g,m,p=ej.Matrix.identity(),f=e.width?e.width:e._width,v=e.height?e.height:e._height;ej.Matrix.rotate(p,e.rotateAngle,f/2,v/2),"text"===e.type?(n=null!==this._svg.getElementById(e.name+"_shape")?this._svg.getElementById(e.name+"_shape").getBBox():{x:e.offsetX-f*e.pivot.x,y:e.offsetY-v*e.pivot.y,width:f,height:v},t=e.textBlock,t&&!t.readOnly&&(o=ej.datavisualization.Diagram.Util.bounds(e),s=new ej.datavisualization.Diagram.Rectangle(n.x-t.fontSize,n.y-t.fontSize,n.width+t.fontSize/2,n.height+t.fontSize/2),r=this._currZoom,m=ej.Matrix.transform(p,ej.datavisualization.Diagram.Util._getLabelPosition(t,o)),i=e.offsetX-f*e.pivot.x+m.x,a=e.offsetY-v*e.pivot.y+m.y,"left"==t.horizontalAlignment?i+=n.width/2:"right"==t.horizontalAlignment&&(i-=n.width/2),"top"==t.verticalAlignment?a+=n.height/2:"bottom"==t.verticalAlignment&&(a-=n.height/2),0===n.width||0===n.height?(n=ej.datavisualization.Diagram.Util.bounds(e),s.width=0==n.width?50:o.width*r,s.x=i*r-s.width/2*r-this._hScrollOffset,s.height=t.fontSize,s.y=a*r-s.height/2*r-this._vScrollOffset):(s.width=50,s.height=t.fontSize,s.x=i*r-s.width/2*r-this._hScrollOffset,s.y=a*r-s.height/2*r-this._vScrollOffset),this._boundingBox=s,this._createEditBox(t,s.x,s.y,s.width,s.height,e),this._isEditing=!0)):(e.labels.length>0?(t=this.activeTool.getLabelUnderMouse(),t||(t=e.labels[0])):(this._newLabelCreated=!0,l=this._findNode(e.name),t=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}),e.labels.push(t),d=l!==e?l:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(e,t,d,this),"textTool"===this.activeTool.name&&(this.activateTool.activeLabel=t)),t&&!t.readOnly&&""===t.hyperlink&&""===t.templateId&&("svg"!==this.model.labelRenderingMode?(h=this._htmlLayer?this._htmlLayer:this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],c=$(h).find("#"+e.name+"_"+t.name)[0]):c=this._svg.document.getElementById(e.name+"_"+t.name),c?(o=ej.datavisualization.Diagram.Util.bounds(e),"svg"!==this.model.labelRenderingMode?(s=new ej.datavisualization.Diagram.Rectangle(c.offsetLeft,c.offsetTop,c.offsetWidth,c.offsetHeight),n=s):(n=c.getBBox(),s=new ej.datavisualization.Diagram.Rectangle(0,0,n.width,n.height)),r="svg"!=this.model.labelRenderingMode?this._currZoom:1,u=ej.datavisualization.Diagram.Util._getLabelPosition(t,o),e.segments||"segmentpath"==t.relativeMode?(s=c.getBoundingClientRect(),s={x:s.left,y:s.top,width:s.width,height:s.height},g=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),i=(s.x+s.width/2-g.left+this._hScrollOffset)/r,a=(s.y+s.height/2-g.top+this._vScrollOffset)/r):("left"==t.horizontalAlignment?u.x+=n.width/2:"right"==t.horizontalAlignment&&(u.x-=n.width/2),"top"==t.verticalAlignment?u.y+=n.height/2:"bottom"==t.verticalAlignment&&(u.y-=n.height/2),m=ej.Matrix.transform(p,u),i=e.offsetX-f*e.pivot.x+m.x,a=e.offsetY-v*e.pivot.y+m.y),0===n.width||0===n.height?(n=ej.datavisualization.Diagram.Util.bounds(e),e.segments?(s.width=n.width<50?50:o.width,s.x=i*r-s.width/2-this._hScrollOffset):(s.width=n.width<50?50:o.width,s.x=i*r-s.width/2-this._hScrollOffset),s.height="umlclassifier"==e.type?e.height:t.fontSize,s.y=a*r-s.height/2*r-this._vScrollOffset):(s.x=i*r-s.width/2*r-this._hScrollOffset,s.y=a*r-s.height/2*r-this._vScrollOffset),this._boundingBox=s,this._createEditBox(t,s.x,s.y,s.width,s.height,e),this._isEditing=!0):this.activeTool.selectedObject=null))},_hideShowSVGLabels:function(e,t,i){if(this._svg&&t){var a;a="text"===t.type?this._svg.document.getElementById(t.name+"_shape_lblbg"):this._svg.document.getElementById(t.name+"_"+e.name),a&&a.setAttribute("visibility",i&&(e.visible||t.visible)?"visible":"hidden"),a=this._svg.document.getElementById(t.name+"_"+e.name+"_lblbg"),a&&a.setAttribute("visibility",i&&e.visible?"visible":"hidden")}},_createEditBox:function(e,t,i,a,n,o){var s,r,l,d,h,c,u;this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(e,o):(s=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s&&(r="text"===o.type?$(s).find("#"+o.name+"_shape_lblbg")[0]:$(s).find("#"+o.name+"_"+e.name+"_lblbg")[0],r&&(r.style.display="none"))),l=ej.datavisualization.Diagram.Util.bounds(o),d=document.createElement("div"),"stretch"==e.horizontalAlignment&&e.textOverflow&&0==e.rotateAngle&&o.isSwimlane?i-=e.fontSize:"stretch"==e.horizontalAlignment&&!o.isSwimlane&&o._isHeader&&e.textOverflow&&0!=e.rotateAngle&&(t=-t-e.fontSize-a/4),h={id:this.element[0].id+"_editBoxDiv","class":"edit",style:"top:"+i+"px;left:"+t+"px;width:"+a+"px;font-family:"+e.fontFamily+";font-size:"+e.fontSize+"px;min-width: 50px;min-height:"+e.fontSize+"px;"},ej.datavisualization.Diagram.Util.canZoomTextEditor(this)&&(h.style+="transform: scale("+this._currZoom+");"),ej.datavisualization.Diagram.Util.attr(d,h),c=document.createElement("textarea"),u=e.fontColor?e.fontColor.toLowerCase():"black",u="white"!=u&&"ffffff"!=u&&"rgb(255,255,255)"!=u?u:"black",h={id:this.element[0].id+"_editBox","class":"editBox",style:"font-size:"+e.fontSize+"px;font-family:"+e.fontFamily+";min-height:"+e.fontSize+"px; height: "+n+"px; line-height: normal; color:"+u+";font-weight:"+(e.bold?"bold":"normal")+";font-style:"+(e.italic?"italic":"normal")+";text-decoration:"+e.textDecoration,nodeWidth:l.width,nodeHeight:l.height,fontSize:e.fontSize,nodeOffsetX:o.offsetX,nodeOffsetY:o.offsetY,containerName:o.name},ej.datavisualization.Diagram.Util.attr(c,h),c.value=e.text,d.appendChild(c),$(this._canvas).append(d),""!==e.text&&this._updateEditor(null,d,c,l.width,e.fontSize,e,o),this._on($(c),"focusout",this._editboxfocusout),this._on($(c),"keyup",this._editBoxKeyUp),this._on($(c),"input",this._editBoxTextChange),this._on($(c),"focusin",this._editboxfocusin),c.focus())},_editBoxKeyUp:function(e){this._updateLabelPosition(e)},_editBoxTextChange:function(e){this._updateLabelPosition(e)},_updateEditBox:function(e,t){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-e+"px",i.style.top=i.offsetTop-t+"px")},_editboxfocusout:function(){
this._endEditing=!0,this._endEdit(),delete this._endEditing},_editboxfocusin:function(e){e.target.select(),this._raiseEvent("editorFocusChange",e)},_updateLabelPosition:function(e){var t,i,a,n=50,o=this._currZoom,s=this._boundingBox,r=Number(e.target.getAttribute("fontSize")),l=Number(e.target.getAttribute("nodeWidth")),d=s.x+s.width/2,h=s.y+s.height/2,c=this._textLength(e);0===c.width?(t=s.width<n?n:s.width,e.target.parentNode.style.width=t+"px",e.target.parentNode.style.left=d-t/2-r/4+"px"):(t=c.width<=l*o?c.width<n?n:c.width:c.width>=l*o?c.width>n?c.width:n:n>l?n:l*o,e.target.parentNode.style.width=t+"px",e.target.parentNode.style.left=d-t/2+"px"),0===c.height?(e.target.style.height=r+"px",e.target.parentNode.style.top=h-r/2+"px"):this._selectedItem&&(i=this.nameTable[this._selectedItem],"text"===i.type&&(a=this._currentLabel)),this._updateEditor(e,e.target.parentNode,e.target,l,r,a)},_updateEditor:function(e,t,i,a,n,o,s){var r,l,d,h,c,u,g,m,p=this._textLength(e,o),f="svg"!=this.model.labelRenderingMode||s&&"text"===s.type?this._currZoom:1,v=50,_=this._boundingBox.x,y=this._boundingBox.y,b=this._boundingBox.width,x=this._boundingBox.height,D=i.value,C=D.split("\n");s||(s=this.activeTool.selectedObject),s&&s.parent&&(h=this.nameTable[s.parent]),this._nodeUnderMouse&&(this.old=this._nodeUnderMouse,c=this._nodeUnderMouse.name.match("_attribute")?"attribute":this._nodeUnderMouse.name.match("_method")?"method":this._nodeUnderMouse.name.match("_member")?"member":this._nodeUnderMouse.name.match("_header_classifier")?"header":"null"),this.old&&(c=this.old.name.match("_attribute")?"attribute":this.old.name.match("_method")?"method":this.old.name.match("_member")?"member":this.old.name.match("_header_classifier")?"header":"null"),u=c&&"null"!=c?p.width>a?p.width:a:a<p.width?a:p.width,"mozilla"===this._browserInfo.name&&(u+=2),g=v>u?v:u,t.style.width=g+"px",r=e?(g-b)/2:(g-b*f)/2,t.style.left=h&&h.isLane&&o&&"stretch"==o.horizontalAlignment&&o.textOverflow&&0!=o.rotateAngle?_-r-n-b/4+"px":_-r-n/4+"px",C.length>1||p.width!=a?(s&&"umlclassifier"!=s.type&&(i.style.height="0"),d="mozilla"===this._browserInfo.name?i.scrollHeight-5:i.scrollHeight-4):d=n;var w=$(i).offset(),z=$(this._canvas).offset(),S=$(this._canvas).height();S||(S=this._getCanvasHeight(this._canvas,S)),w.top-z.top+Number(d)>S&&(d-=w.top-z.top+Number(d)-S,d="mozilla"===this._browserInfo.name?d-7:d-6),i.style.height=d+"px",m=0,e?(l=(d-x)/2,m=y-l*f):(l=h&&h.isSwimlane&&o&&"stretch"==o.horizontalAlignment&&o.textOverflow&&0==o.rotateAngle?(d-x*f)/2+o.fontSize:(d-x*f)/2,m=y-l-3*f),t.style.top=m+"px",this._boundingBox=new ej.datavisualization.Diagram.Rectangle(_-r,m,g,d)},_getCanvasHeight:function(e,t){for(var i=t,a=e;0>=i;)a=a.parentNode,a&&(i=$(a).height());return i},_textLength:function(e,t){var i,a=document.createElement("div"),n=document.getElementById(this.element[0].id+"_editBox"),o={id:this.element[0].id+"_editBoxHiddenDiv",style:"position : absolute; width : auto; height : auto;font-size:"+n.style.fontSize+"px;font-family:"+n.style.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"};return t&&(o.style="position : absolute; width : auto; height : auto;font-weight:"+(t.bold?"bold":"normal")+";font-style:"+(t.italic?"italic":"normal")+";text-decoration:"+t.textDecoration+";font-size:"+t.fontSize+"px;font-family:"+t.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"),ej.datavisualization.Diagram.Util.attr(a,o),e?a.appendChild(document.createTextNode(e.target.value)):a.appendChild(document.createTextNode(n.value)),document.body.appendChild(a),i=a.getBoundingClientRect(),document.body.removeChild(a),i},_endEdit:function(e){var t,i,a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b=document.getElementById(this.element[0].id+"_editBox");if(b){if(o=this._findNode(b.getAttribute("containerName")),"textTool"===this.activeTool.name)o=this.activeTool.selectedObject;else if(!o)for(s=0;s<this.selectionList.length;s++)r=this.selectionList[s],"undefined"!=typeof r.labels.length&&r.labels.length>0&&r.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(o=this.selectionList[s]);o&&(this._isEditing=!1,"text"==o.type?l=o.textBlock:(l=this.activeTool.getLabelUnderMouse(),l||(l=o.labels[0])),"umlclassifier"==o.type&&(b.value=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(b.value,o,this)),l&&(d=l.text),"node"!=o._type||o.width&&o.height||!this.nameTable[o.name]||(a=o._width,n=o._height,o.labels[0].text=b.value,this._getNodeDimension(o)),"umlclassifier"==o.type&&(o=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(o,this)),e&&(h=27===e.keyDownEventArgs.keyCode?"ESC":String.fromCharCode(e.keyDownEventArgs.keyCode)),b.value!=d&&(t=this._raiseEvent("textChange",{element:this.getNode(o),label:l,value:b.value,keyCode:h})),t?(o._width&&a&&(o._width=a),o._height&&n&&(o._height=n),o&&"text"===o.type?ej.datavisualization.Diagram.DiagramContext.update(o,this):(l=this.activeTool.activeLabel?this.activeTool.activeLabel:o.labels.length>0?o.labels[0]:null,l!=undefined&&(l.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(o,l,this))),this.activeTool&&(this.activeTool.activeLabel=null,this.activeTool.selectedObject=null)):(o&&o.type!==undefined&&"text"===o.type?(c=d,o.textBlock.text=b.value,o.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(o.name)?(ej.datavisualization.Diagram.DiagramContext.update(o,this),i={type:"labelchanged",shape:o,previousLabelValue:c,updatedLabelValue:b.value,category:"internal"},this.addHistoryEntry(i)):(""!==b.value&&(u=Number(b.style.height.substring(0,b.style.height.length-2)),o.height<u&&(o.offsetY=o.offsetY-o.height/2+u/2,o.height=u),this.selectionList.length>0&&this._clearSelection(!0),this.tools.move._outOfBoundsDrag(o)&&(this.add(o),g=this.nameTable[o.parent],g&&g.isLane&&(m=this._moveOnLane(o,g),m.proceedX||this.updateNode(o.name,{offsetX:o.offsetX+m.x}),m.proceedY||this.updateNode(o.name,{offsetY:o.offsetY+m.y}),this._updateNodeMargin(o),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,g),g.isLane&&(p=this._getSwimlane(g),p&&(this._updateChildAdjacentConnectors(p,!0),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,p),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,p)))))),this.activeTool.selectedObject=null)):o==undefined||"pseudoGroup"==o.type||(l!=undefined?(this._comparePropertyValues(l,"text",{text:b.value}),d=d?d:l.text,d!=b.value&&(this._newLabelCreated?(l.text=b.value,i={type:"labelcollectionchanged",shape:o,label:l,isUndo:!0,category:"internal"}):i={type:"labelchanged",shape:o,previousLabelValue:l.text,updatedLabelValue:b.value,index:o.labels.indexOf(l),category:"internal"},this.addHistoryEntry(i)),l.text=b.value,l.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(o,l,this),o.isPhase&&(o.name.split("phaseStack")[1]&&(f=this.nameTable[o.name.split("phaseStack")[1]]),f&&f.label&&(f.label.text=b.value)),this.activeTool.selectedObject=null):0==o.labels.length&&(l=ej.datavisualization.Diagram.Label(),l.text=b.value,l.mode=ej.datavisualization.Diagram.LabelEditMode.View,o.labels.push(l),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(o,l,null,this)),this.activeTool.activeLabel&&(this.activeTool.activeLabel=null)),o.shape&&"umlclassifier"==o.shape.type&&(o=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(o,b.value,l)),"node"!=o._type||o.width&&o.height||!this.nameTable[o.name]||(ej.datavisualization.Diagram.DiagramContext.update(o,this),o.parent&&ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[o.parent],this)),"umlclassifier"==o.type&&(o.labels[0].text="",ej.datavisualization.Diagram.DiagramContext.update(o,this)),o.shape&&"umlclassifier"==o.shape.type&&ej.datavisualization.Diagram.DiagramContext.update(o,this))),this._off($(b),"focusout",this._editboxfocusout),this._off($(b),"keyup",this._editBoxKeyUp),this._off($(b),"input",this._editBoxTextChange),v=$("#"+this.element[0].id+"_editBoxDiv")[0],v&&v.parentNode.removeChild(v),this._svg&&(this.model.labelRenderingMode==ej.datavisualization.Diagram.LabelRenderingMode.Svg?this._hideShowSVGLabels(l,o,!0):(_=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],_&&("text"===o.type?y=$(_).find("#"+o.name+"_shape_lblbg")[0]:l&&(y=$(_).find("#"+o.name+"_"+l.name+"_lblbg")[0]),y&&(y.style.display="block"))),o&&this._updateQuad(o))}e&&e.keyDownEventArgs&&27===e.keyDownEventArgs.keyCode&&this.element[0].focus(),delete this._newLabelCreated},_getSwimlane:function(e){var t,i;return e="string"==typeof e?this.nameTable[e]:e,i=this.nameTable[e.parent],i&&(t=this.nameTable[i.parent]),t},_setLabelEditing:function(e){var t;return e?(e.readOnly?(e.mode=ej.datavisualization.Diagram.LabelEditMode.View,t=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),e.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=e,t=!0),t):void 0},_isInternalTool:function(e){return!!(e instanceof ej.datavisualization.Diagram.SelectTool||e instanceof ej.datavisualization.Diagram.ConnectionEditTool||e instanceof ej.datavisualization.Diagram.MoveTool||e instanceof ej.datavisualization.Diagram.ResizeTool||e instanceof ej.datavisualization.Diagram.LabelMoveTool||e instanceof ej.datavisualization.Diagram.LabelResizeTool||e instanceof ej.datavisualization.Diagram.LabelRotateTool||e instanceof ej.datavisualization.Diagram.PhaseTool||e instanceof ej.datavisualization.Diagram.RotateTool||e instanceof ej.datavisualization.Diagram.PanTool&&this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan)},_updateNodeMargin:function(e){var t,i,a,n,o,s,r;if(""!=e.parent&&(t=this.nameTable[e.parent],t&&t.container&&"canvas"==t.container.type)){var l=ej.datavisualization.Diagram.Util.bounds(t),d=ej.datavisualization.Diagram.Util.bounds(e),h=ej.datavisualization.Diagram.Geometry.rect([d.topLeft,d.topRight,d.bottomRight,d.bottomLeft]);e.marginLeft=h.x-(l.x+t.paddingLeft),i=l.x+t.width-(h.x+h.width)-t.paddingRight,e.marginRight=0>i?0:i,e.marginTop=h.y-(l.y+t.paddingTop),a=l.y+t.height-(h.y+h.height)-t.paddingBottom,e.marginBottom=0>a?0:a,t.isLane&&(n=0,o=0,"horizontal"===t.orientation?(n=50,o=0):(n=0,o=50),e.marginLeft=e.marginLeft>=n?e.marginLeft:n,e.marginTop=e.marginTop>=o?e.marginTop:o)}if(("pseudoGroup"==e.type||"multipleSelection"==e.name)&&e.children.length>0)for(r=0;r<e.children.length;r++)s=this.nameTable[this._getChild(e.children[r])],s&&this._updateNodeMargin(s)},_raisePropertyChange:function(e){e&&(this._isSizingCommand?e.cause=ej.datavisualization.Diagram.ActionType.Size:this._isUndo?e.cause=ej.datavisualization.Diagram.ActionType.HistoryChange:this._isTouchedEvent&&(e.cause=ej.datavisualization.Diagram.ActionType.Touch),this._raiseEvent("propertyChange",e))},_updateAdjacentEdges:function(e,t){var i,a;if(e.inEdges&&e.inEdges.length>0)for(i=0,a=e.inEdges.length;a>i;i++)t[e.inEdges[i]]=this.nameTable[e.inEdges[i]];if(e.outEdges&&e.outEdges.length>0)for(i=0,a=e.outEdges.length;a>i;i++)t[e.outEdges[i]]=this.nameTable[e.outEdges[i]]},_translate:function(e,t,i,a,n,o){var s,o,r,l,d;if(!t&&!i)return!1;if(e.segments)ej.datavisualization.Diagram.Util._translateLine(e,t,i,e),this._dock(e,a),ej.datavisualization.Diagram.Util.updateBridging(e,this),this._updateConnectorBridging(e);else{if(o||(s=!0),o=o||{},this._updateAdjacentEdges(e,o),e.offsetX+=t,e.offsetY+=i,this._parentNode||"phase"==this.activeTool.name||(this._parentNode=e),("group"===e._type||"pseudoGroup"===e.type)&&!n){for(r=this._getChildren(e.children),l=0;l<r.length;l++)d=a[this._getChild(r[l])],d&&(this._translate(d,t,i,a,undefined,o),d.parent&&d.parent!=e.name&&"pseudoGroup"!=e.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(a[d.parent],this));"group"!=e.type&&e.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(e,this)}if(e!=this.activeTool.helper&&(this.nameTable[e.name]&&this._updateQuad(e),ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(e,t,i,null,this)),this._parentNode==e&&delete this._parentNode,s&&!this._preventDocking&&e!=this.activeTool.helper&&!this._disableSegmentChange)for(l in o)d=this.nameTable[l],d&&((e.isSwimlane||("pseudoGroup"==e.type||"group"==e.type)&&!this._containsChild(e,d))&&ej.datavisualization.Diagram.Util._translateLine(d,t,i,d),this._dock(d,this.nameTable),d.annotation&&ej.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(d,this))}},_containsChild:function(e,t){var i,a,n,o;if(e.children&&e.children.length>0)for(i=this._getChildren(e.children),a=0;a<i.length;a++){if(n=this._collectionContains(t.name,i))return!0;o=this._getChild(i[a]),o&&o.children&&this._containsChild(o,t)}},_translatePort:function(e,t,i,a){t.offset.x=t.offset.x+i/e.width,t.offset.y=t.offset.y+a/e.height,ej.datavisualization.Diagram.DiagramContext.updatePort(e,t,this);this._adornerSvg;this._updateAssociatedConnectorEnds(e,this.nameTable,!0)},_translateLabel:function(e,t,i,a){var n,o=!1;e&&e.segments&&"segmentpath"===t.relativeMode&&ej.datavisualization.Diagram.Util.isAllowDragLimit(e)&&(o=!0),o||(n=$.extend(!0,{},t),t.margin.left+=i,t.margin.top+=a,t.margin.right-=i,t.margin.bottom-=a,"center"==t.horizontalAlignment&&(t.margin.right=0),"center"==t.verticalAlignment&&(t.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(e,t,this),this._comparePropertyValues(e,"labels",n))},translateLabel:function(e,t,i,a){var n,o;e&&(e.segments&&"segmentpath"===t.relativeMode&&!ej.datavisualization.Diagram.Util.isAllowDragLimit(e)?(n=$.extend(!0,{},t),t.margin.left+=i,t.margin.top+=a,t.margin.right-=i,t.margin.bottom-=a,"center"==t.horizontalAlignment&&(t.margin.right=0),"center"==t.verticalAlignment&&(t.margin.bottom=0),ej.datavisualization.Diagram.DiagramContext.updateLabel(e,t,this),this._comparePropertyValues(e,"labels",n)):(o=ej.datavisualization.Diagram.Util.bounds(e),t.offset.x+=i/o.width,t.offset.y+=a/o.height,ej.datavisualization.Diagram.DiagramContext.updateLabel(e,t,this)))},_rotate:function(e,t,i){var a,n,o,s,r,l,d;if(!e.segments&&t){if(e.rotateAngle+=t,e.rotateAngle%=360,e.rotateAngle<0&&(e.rotateAngle+=360),"group"===e._type||"pseudoGroup"===e.type){for(a=ej.Matrix.identity(),ej.Matrix.rotate(a,t,e.offsetX,e.offsetY),s=this._getChildren(e.children),l=0;l<s.length;l++)r=i[s[l]],r&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(a,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(a,r.targetPoint),!0)):(this._rotate(r,t,i),n=r.offsetX,o=r.offsetY,d=ej.Matrix.transform(a,ej.datavisualization.Diagram.Point(n,o)),this._translate(r,d.x-n,d.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=e.name&&"pseudoGroup"!=e.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],this));ej.datavisualization.Diagram.Util._updateGroupBounds(e,this)}e.parent&&this._updateParentBounds(e.parent),e!=this.activeTool.helper&&this._updateQuad(e),this._updateAssociatedConnectorEnds(e,i)}},_raiseOffsetPropertyChange:function(e,t,i,a){e&&!e.segments?(t=t?t:0,i=i?i:0,t!=e.offsetX&&this._comparePropertyValues(e,"offsetX",{offsetX:t},a),i!=e.offsetY&&this._comparePropertyValues(e,"offsetY",{offsetY:i},a)):(t=t?t:0,i=i?i:0,this._comparePropertyValues(e,"sourcePoint",{sourcePoint:{x:e.sourcePoint.x+t,y:e.sourcePoint.y+i}},a),this._comparePropertyValues(e,"targetPoint",{targetPoint:{x:e.targetPoint.x+t,y:e.targetPoint.y+i}},a))},_raiseSizePropertyChange:function(e,t,i,a){if(e&&i&&t){var n=e.height*i,o=e.width*t;n!=e.height&&(this._comparePropertyValues(e,"height",{height:n},a),this._comparePropertyValues(e,"offsetY",{offsetY:e.offsetY+(n-e.height)},a)),o!=e.width&&(this._comparePropertyValues(e,"width",{width:o},a),this._comparePropertyValues(e,"offsetX",{offsetX:e.offsetX+(o-e.width)/2},a))}},scale:function(e,t,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_;if(t&&1!=t||i&&1!=i||e.isPhase)if(e.container)switch(e.container.type){case"canvas":g={},f=ej.Matrix.identity(),ej.Matrix.rotate(f,-e.rotateAngle,a.x,a.y),ej.Matrix.scale(f,t,i,a.x,a.y),ej.Matrix.rotate(f,e.rotateAngle,a.x,a.y),y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width*t,x=e.height*i,s&&(e.minHeight=x,e.minWidth=b),g.width=b,g.height=x,g&&g.width>1&&(m=e.offsetX-e.width/2,e.width!=g.width&&(e._scaled=!0),e.width=g.width,e.offsetX=e._isBpmn?y.x:m+e.width/2),g&&g.height>1&&(p=e.offsetY-e.height/2,e.height!=g.height&&(e._scaled=!0),e.height=g.height,e.offsetY=e._isBpmn?y.y:p+e.height/2);break;case"stack":f=ej.Matrix.identity(),ej.Matrix.rotate(f,-e.rotateAngle,a.x,a.y),ej.Matrix.scale(f,t,i,a.x,a.y),ej.Matrix.rotate(f,e.rotateAngle,a.x,a.y),y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),v=0,_=0,0!=t&&(v=e.marginLeft,_=e.marginRight),b=e.width*t-(v+_),x=e.height*i-(e.marginTop+e.marginBottom),g={height:e.height,width:e.width},this._resizeStack&&(e.width=b,e.height=x,e.offsetX=y.x,e.offsetY=y.y)}else if(f=ej.Matrix.identity(),e.segments){for(ej.Matrix.scale(f,t,i,a.x,a.y),h=0;h<e.segments.length;h++){for(c=e.segments[h],u=0;u<c.points.length;u++)c.points[u]=ej.Matrix.transform(f,c.points[u]),0!=h||0!=u||e.sourceNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(e,ej.Matrix.transform(f,e.sourcePoint),!1)),h!=e.segments.length-1||u!=c.points.length-1||e.targetNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],e.targetPoint=c._endPoint);c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],"orthogonal"==c.type?c.length||0===c.length?c.length=c._length=ej.datavisualization.Diagram.Geometry.distance(c._startPoint,c._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(c,e.segments[h-1],e.segments[h+1],e.sourcePoint,e.targetPoint):(c.point&&(c.point=c._endPoint),c._point=c._endPoint)}(e.sourceNode||e.targetNode)&&this._dock(e,n)}else{if("group"===e._type||"pseudoGroup"===e.type){if("bpmn"!=e.type||e.width*t>=1&&e.height*i>=1){for(r={x:e.offsetX,y:e.offsetY},l=this._getChildren(e.children),h=0;h<l.length;h++)d=n[l[h]],d&&("bpmn"!=e.type||ej.datavisualization.Diagram.Util.canResize(d))&&(this.scale(d,t,i,a,n),d.parent&&d.parent!=e.name&&"pseudoGroup"!=e.type&&ej.datavisualization.Diagram.Util._updateGroupBounds(n[d.parent],this));if("bpmn"==e.type&&ej.datavisualization.Diagram.Util._updateBPMNProperties(e,this,n,!0),e.children.length<=0){ej.Matrix.rotate(f,-e.rotateAngle,a.x,a.y),ej.Matrix.scale(f,t,i,a.x,a.y),ej.Matrix.rotate(f,e.rotateAngle,a.x,a.y);var y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width?e.width*t:e._width*t,x=e.height?e.height*i:e._height*i;b>1&&(e.width?(b!=e.width&&(e._scaled=!0),e.width=b,e.offsetX=y.x):(b!=e._width&&(e._scaled=!0),e.maxWidth=e.parent&&n[e.parent].width!=e.maxWidth?n[e.parent].width:b,e.offsetX=y.x-(e._width*t-e._width)/2)),x>1&&(e.height?(x!=e.height&&(e._scaled=!0),e.height=x,e.offsetY=y.y):(x!=e._height&&(e._scaled=!0),e.maxHeight=e.parent&&n[e.parent].height>x?n[e.parent].height:x,e.offsetY=y.y-(e._height*i-e._height)/2))}ej.datavisualization.Diagram.Util._updateGroupBounds(e,this),e!=this.activeTool.helper&&ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(e,1/t,1/i,r,this)}}else{ej.Matrix.rotate(f,-e.rotateAngle,a.x,a.y),ej.Matrix.scale(f,t,i,a.x,a.y),ej.Matrix.rotate(f,e.rotateAngle,a.x,a.y);var y=ej.Matrix.transform(f,ej.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width*t,x=e.height*i;if(0!=e.maxWidth&&(b=Math.min(e.maxWidth,b)),0!=e.minWidth&&(b=Math.max(e.minWidth,b)),0!=e.maxHeight&&(x=Math.min(e.maxHeight,x)),0!=e.minHeight&&(x=Math.max(e.minHeight,x)),b>0&&(b!=e.width&&(e._scaled=!0),b!=e.maxWidth&&b!=e.minWidth))for(e.width=b,e.offsetX=y.x,h=0;h<e.labels.length;h++)e.labels[h].width=e.labels[h].width*t;if(x>0&&(x!=e.height&&(e._scaled=!0),x!=e.maxHeight&&x!=e.minHeight))for(e.height=x,e.offsetY=y.y,h=0;h<e.labels.length;h++)e.labels[h].height=e.labels[h].height*i}e.parent&&this._updateParentBounds(e.parent),ej.datavisualization.Diagram.Util._updateBPMNProperties(e,this,n,!0),"resize"==this.activeTool.name&&this.activeTool.inAction&&this.selectionList[0]&&"pseudoGroup"!=this.selectionList[0].type&&"group"!=this.selectionList[0].type||this._updateAssociatedConnectorEnds(e,n),e!=this.activeTool.helper&&this._updateQuad(e)}},_updateParentBounds:function(e){e=this.nameTable[this._getChild(e)],e&&"bpmn"!=e.type&&!e.container&&(ej.datavisualization.Diagram.Util._updateGroupBounds(e,this),ej.datavisualization.Diagram.DiagramContext.update(e,this),e.parent&&this._updateParentBounds(e.parent))},_dock:function(e,t,i){if(!(this._preventDocking||this._disableSegmentChange||this._layoutInAction&&this._isAnimating)){var a=e.segments.length,n=e.segments[0].points.length,o=e.segments[e.segments.length-1].points.length;this._preventSegmentAdjusting&&(e._preventSegmentAdjusting=!0),ej.datavisualization.Diagram.Util.dock(e,t,this),delete e._preventSegmentAdjusting,a!=e.segments.length&&this._svg&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(e,e.sourcePort,e.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(e,this)),this.selectionList[0]==e&&(i||n!=e.segments[0].points.length||o!=e.segments[e.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom),this._updateQuad(e)}},_updateChildAdjacentConnectors:function(e,t){var i,a,n=this._getChildTable(e,{});for(i in n)a=this.nameTable[i],a&&a.segments&&-1==e.children.indexOf(i)&&(t||(a._staticLength=!0),this._dock(a,this.nameTable),delete a._staticLength,ej.datavisualization.Diagram.DiagramContext.update(a,this))},_setEndPoint:function(e,t,i){ej.datavisualization.Diagram.Util._setLineEndPoint(e,t,i),this._updateQuad(e)},_updateAssociatedConnectorEnds:function(e,t,i){var a,n,o,s,r,l,d;if(!e.segments&&(e.inEdges.length||e.outEdges.length)){for(s=this._isNodeToNodeConnection(e),r=e,"bpmn"==e.type&&"group"==e._type&&(r="object"==typeof e.children[0]?e.children[0]:this.nameTable[e.children[0]]),s&&(l=ej.datavisualization.Diagram.Util._findSegmentPoints(r)),d={},this._parentNode&&(d=this._getChildTable(this._parentNode,{})),a=0,n=e.inEdges.length;n>a;a++)o=t[e.inEdges[a]],!o||this._parentNode&&d[o.sourceNode]||(o.targetPadding?delete r._segmentPoints:r._segmentPoints=l,this._dock(o,t),i&&ej.datavisualization.Diagram.DiagramContext.update(o,this));for(a=0,n=e.outEdges.length;n>a;a++)o=t[e.outEdges[a]],!o||this._parentNode&&d[o.targetNode]||(o.sourcePadding?delete r._segmentPoints:r._segmentPoints=l,this._dock(o,t),i&&ej.datavisualization.Diagram.DiagramContext.update(o,this));delete r._segmentPoints}},_isNodeToNodeConnection:function(e){var t,i;if(e.inEdges.length)for(t=0,i=e.inEdges.length;i>t;t++)if(this.nameTable[e.inEdges[t]]&&!this.nameTable[e.inEdges[t]].targetPort&&("bpmn"!=e.type||"orthogonal"!=this.nameTable[e.inEdges[t]].segments[0].type))return!0;if(e.outEdges.length)for(t=0,i=e.outEdges.length;i>t;t++)if(this.nameTable[e.outEdges[t]]&&!this.nameTable[e.outEdges[t]].sourcePort&&("bpmn"!=e.type||"orthogonal"!=this.nameTable[e.outEdges[t]].segments[this.nameTable[e.outEdges[t]].segments.length-1].type))return!0},_updateChildBounds:function(e,t){var i,a,n,o,s,r,l;0==e.width&&0==e.height?(i=e.offsetX,a=e.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(e,this),this._translate(e,i-e.offsetX,a-e.offsetY,t)):(i=e.offsetX,a=e.offsetY,n=ej.datavisualization.Diagram.Util._getChildrenBounds(e,this),e.offsetX=n.x+n.width*e.pivot.x,e.offsetY=n.y+n.height*e.pivot.y,o=i-e.offsetX,s=i-e.offsetY,this._translate(e,o,s,t),r=e.width/n.width,l=e.height/n.height,this.scale(e,r,l,e.pivot,t),this._translate(e,i-e.offsetX,a-e.offsetY,t))},_isLastChildOfParent:function(e){var t,i,a=this.nameTable[e.parent];if(a.children)for(i=0;i<a.children.length;i++)if(t=this.nameTable[this._getChild(a.children[i])],t&&t.name==e.name&&i==a.children.length-1)return!0;return!1},_updateQuad:function(e){var t,i,a;this._spatialSearch&&this.nameTable[e.name]&&(t=this.getObjectType(e),i=!1,(e.isPhase||e.isLane||e._isHeader||e.isLaneStack||e.isPhaseStack||e._isInternalShape||"pseudoGroup"==e.type)&&(i=!0),e.parent&&this.nameTable[e.parent]&&(a=this.nameTable[e.parent],(a.isPhaseStack||a.isSwimlane)&&(i=!0),"bpmn"!=a.type&&this._isLastChildOfParent(e)&&this._updateQuad(a)),null!=this._selectedSymbol&&this._selectedSymbol.isLane&&e.isLane&&!e.parent&&(i=!1),this._disableUpdateQuad&&(i=!0),i||e._connectorType||ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,e))},_sliceDockLines:function(e){var t=$.extend({},e),i=null;for(var a in t)i=this.nameTable[this._getChild(t[a])],i&&i.segments&&(i.sourceNode||i.targetNode)&&e.pop(i.name)},_canExecute:function(){return this._isEditing&&("delete"==this._currentCommand||"cut"==this._currentCommand||"focusToPreviousItem"==this._currentCommand||"undo"==this._currentCommand||"redo"==this._currentCommand||"focusToNextItem"==this._currentCommand||"selectFocusedItem"==this._currentCommand||"selectAll"==this._currentCommand||"copy"==this._currentCommand||"paste"==this._currentCommand||this._currentCommand.match("nudge"))?!1:!("endEdit"==this._currentCommand&&!this._isEditing)},_setItemDraggable:function(e){var t=this,i=!1;this._canDragGlobally=!0,$(e).ejDraggable({clone:!0,helper:function(){var e,i,a,n,o;return this._selectedSymbol=null,this._isDragged=!1,e=t._renderItemContainer("diagram_clone",document.body),e.document.setAttribute("drag","true"),t.activeTool&&t.activeTool.selectedObject&&!t.activeTool.helper&&(i=$.extend(!0,{},t.activeTool.selectedObject),t._updateChildren(i),t.edgeTable={},t.edgeTable=t._getEdgeTable(i,t.edgeTable),this._updateSelectedItem(i,i.isSwimlane),this._selectedSymbol=i,this._isDragged=!1,this._targetId=t._id,a=ej.datavisualization.Diagram.Util.bounds(i),this.cursorAt={top:105,left:105},n=ej.datavisualization.Diagram.NodeType({offsetX:i.offsetX,offsetY:i.offsetY,width:100,height:100,shape:"path",opacity:.5,pathData:"M49.955,50.7915L1.74601,99L98.164,99zM1,1.83699L1,98.332L49.2477,50.0843zM99,1.74699L50.662,50.0845L99,98.422zM1.57701,1L49.9548,49.3773L98.332,1zM0,0L100,0L100,100L0,100z "},t),n=t._getNewNode(n),ej.datavisualization.Diagram.SvgContext.renderNode(n,e,null,!0,t)),o=document.getElementById("diagram_clone_paletteItem"),$(o).addClass("dragClone"),$(o).css("display","none"),$(o)},drag:function(e){var t,a,n,o,s,r,l=$(e.target).parents(".e-datavisualization-diagram");if(l.length){if(o=$("#"+l.attr("id")).ejDiagram("instance"),(this.model._isDragged||this.model._targetId!=o._id)&&this.model._selectedSymbol){this.model._isDragged||this.model._targetId==o._id?this.model._targetId!=o._id&&(o.edgeTable&&delete o.edgeTable,i=!1):(t=$("#"+this.model._targetId).ejDiagram("instance"),t._delete(t.nameTable[this.model._selectedSymbol.name]),i=!1,s=t._historyList.currentEntry,r=s.previous,s.object=r.undoObject.node,r.undoObject.childTable&&(s.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(s.edgeTable=r.undoObject.edgeTable),t.removeHistoryEntry(r)),this.model._isDragged=!0,o._selectedSymbol=this.model._selectedSymbol,o._isNodeEnters=!0;var d=o._selectedSymbol,h=o._currZoom,c=$("#"+o.element[0].id).offset(),u=o._isTouchEvent(e.event),g=((u?u.pageX:e.event.pageX)+o._hScrollOffset-c.left)/h,m=((u?u.pageY:e.event.pageY)+o._vScrollOffset-c.top)/h;if(d.segments?this.model._translate(d,g-(d.sourcePoint.x+d.targetPoint.x)/2*h,m-(d.sourcePoint.y+d.targetPoint.y)/2*h):this.model._translate(d,g-d.offsetX/h,m-d.offsetY/h),this.model._isDragged&&o.edgeTable&&o.nameTable[d.name]&&!i&&"pseudoGroup"!=d.type){for(a in o.edgeTable)o.nameTable[a]?(n=o.nameTable[a],n.sourceNode=o.edgeTable[a].sourceNode,n.sourcePort=o.edgeTable[a].sourcePort,n.targetNode=o.edgeTable[a].targetNode,n.targetPort=o.edgeTable[a].targetPort):o.add(o.edgeTable[a]);o._clearSelection(!0),o._addSelection(o.nameTable[d.name],!0),i=!0}}this.helper.css("display","none")}else this.model._selectedSymbol&&(o=$("#"+this.model._targetId).ejDiagram("instance"),o._delete(o.nameTable[this.model._selectedSymbol.name]),i=!1,this.model._isDragged||(s=o._historyList.currentEntry,r=s.previous,s.object=r.undoObject.node,r.undoObject.childTable&&(s.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(s.edgeTable=r.undoObject.edgeTable),o.removeHistoryEntry(r)),this.helper.css("display","block"),this.model._isDragged=!0);$("html,body").css("cursor","no-drop")},dragStop:function(e){var t,i,a,n=$(e.target).parents(".e-datavisualization-diagram");n&&(t=$("#"+n.attr("id")).ejDiagram("instance"),this.model._isDragged&&this.model._targetId==t._id&&(i=t._historyList.currentEntry,a=i.previous,i.undoObject.node=a.object,a.childTable&&(i.undoObject.childTable=a.childTable),a.edgeTable&&(i.undoObject.edgeTable=a.edgeTable),t.removeHistoryEntry(a)),t._selectedSymbol=null,delete t._isNodeEnters),$(this.helper).remove(),$("html,body").css("cursor","default")},_translate:function(e,t,i){if(e.segments)ej.datavisualization.Diagram.Util._translateLine(e,t,i,e);else if(e.offsetX+=t,e.offsetY+=i,"pseudoGroup"==e.type||"group"==e.type)for(var a=0;a<e.children.length;a++)this._translate(e.children[a],t,i)},_updateSelectedItem:function(e,i){var a,n;if("pseudoGroup"==e.type||"group"==e.type)for(a=0;a<e.children.length;a++)"string"==typeof e.children[a]&&(e.children[a]=t.nameTable[t._getChild(e.children[a])]),this._updateSelectedItem(e.children[a],i);if(!i)if(e.segments)e.sourceNode=e.targetNode=e.sourcePort=e.targetPort="";else{for(a=0;a<e.inEdges.length;a++)n=t.findNode(e.inEdges[a]),-1==t.model.selectedItems.children.indexOf(n)&&e.inEdges.splice(a,1);for(a=0;a<e.outEdges.length;a++)n=t.findNode(e.outEdges[a]),-1==t.model.selectedItems.children.indexOf(n)&&e.outEdges.splice(a,1)}}})},_renderItemContainer:function(e,t){var i=document.createElement("div"),a={width:100,height:100},n={id:e+"_paletteItem",draggable:"true",height:a.height+"px",width:a.width+"px",style:"padding: 4; height:"+(a.height+1)+"px;width:"+(a.width+1)+"px;-ms-touch-action: none;touch-action: none;"};return ej.datavisualization.Diagram.Util.attr(i,n),t.appendChild(i),this._setItemDraggable(i),this._renderAnchor(i,e,a)},_renderAnchor:function(e,t,i){var a=document.createElement("div"),n={id:t+"_anchor",height:i.height+"px","class":"e-anchor"};return ej.datavisualization.Diagram.Util.attr(a,n),e.appendChild(a),this._renderSvg(a,t,i)},_renderSvg:function(e,t,i){var a,n=document.createElement("div"),o={id:t+"_svgWrapper","class":"e-svg-container",style:"width:"+i.width+"px;height:"+i.height+"px;"};return ej.datavisualization.Diagram.Util.attr(n,o),o={id:t+"_svg",width:i.width,height:i.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},a=new ej.datavisualization.Diagram.Svg(o),n.appendChild(a.document),e.appendChild(n),a}}),ej.datavisualization.Diagram.Locale={},ej.datavisualization.Diagram.Locale["default"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"},ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"},$.fn.pinchDiagram=function(e,t){var i=[],a=function(e){var t,a,n,o,s,r,l=e.touches;if(l.length>=2)for(t=0;t<l.length;t++){for(a=l[t],n=!1,o=0;o<i.length;o++)if(s=i[o],a.identifier===s.identifier){
n=!0;break}n||(r=$.extend({},a),i.push(r))}e.preventDefault()},n=function(e,t){var i=t.pageX-e.pageX,a=t.pageY-e.pageY;return Math.sqrt(i*i+a*a)},o=function(e){for(var t,a,n,o,s=e.changedTouches,r=0;r<s.length;r++)for(t=s[r],a=0;a<i.length;a++)n=i[a],n.identifier===t.identifier&&(o=i.indexOf(n),i.splice(o,1));e.preventDefault()},s=function(e,t){e.pageX=t.pageX,e.pageY=t.pageY},r=function(e){var a,o,r;if(e.preventDefault(),a=e.touches,a.length>=2){var l=a[0],d=a[1],h=i[0],c=i[1];o=n(l,d)/n(h,c),r=t._mousePosition(e,!1),ej.datavisualization.Diagram.ZoomUtil.zoomPan(t,o,0,0,r,!0,!0),s(h,l),s(c,d)}};this[0].addEventListener("touchstart",a,!1),this[0].addEventListener("touchend",o,!1),this[0].addEventListener("touchmove",r,!1)}}(jQuery,Syncfusion),function(e,t){"use strict";t.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4},t.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:t.MatrixTypes.Identity},t.Matrix={identity:function(){return e.extend(!0,{},t.MatrixDefaults)},multiply:function(e,i){var a,n,o,s,r=e.type,l=i.type;if(l!=t.MatrixTypes.Identity){if(r==t.MatrixTypes.Identity)return e.m11=i.m11,e.m12=i.m12,e.m21=i.m21,e.m22=i.m22,e.offsetX=i.offsetX,e.offsetY=i.offsetY,void(e.type=i.type);if(l==t.MatrixTypes.Translation)return e.offsetX+=i.offsetX,e.offsetY+=i.offsetY,void(r!=t.MatrixTypes.Unknown&&(e.type|=t.MatrixTypes.Translation));if(r!=t.MatrixTypes.Translation){switch(a=r<<4|l){case 34:return e.m11*=i.m11,void(e.m22*=i.m22);case 35:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX=i.offsetX,e.offsetY=i.offsetY,void(e.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling);case 36:break;default:switch(a){case 50:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX*=i.m11,void(e.offsetY*=i.m22);case 51:return e.m11*=i.m11,e.m22*=i.m22,e.offsetX=i.m11*e.offsetX+i.offsetX,void(e.offsetY=i.m22*e.offsetY+i.offsetY);case 52:break;default:switch(a){case 66:case 67:case 68:break;default:return}}}return n=this.identity(),this._setMatrix(n,e.m11*i.m11+e.m12*i.m21,e.m11*i.m12+e.m12*i.m22,e.m21*i.m11+e.m22*i.m21,e.m21*i.m12+e.m22*i.m22,e.offsetX*i.m11+e.offsetY*i.m21+i.offsetX,e.offsetX*i.m12+e.offsetY*i.m22+i.offsetY),n.m21||n.m12?n.type=t.MatrixTypes.Unknown:((n.m11&&1!=n.m11||n.m22&&1!=n.m22)&&(n.type=t.MatrixTypes.Scaling),(n.offsetX||n.offsetY)&&(n.type|=t.MatrixTypes.Translation),(n.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))==t.MatrixTypes.Identity&&(n.type=t.MatrixTypes.Identity)),e.m11=n.m11,e.m12=n.m12,e.m21=n.m21,e.m22=n.m22,e.offsetX=n.offsetX,e.offsetY=n.offsetY,void(e.type=n.type)}if(o=e.offsetX,s=e.offsetY,e.m11=i.m11,e.m12=i.m12,e.m21=i.m21,e.m22=i.m22,e.offsetX=i.offsetX,e.offsetY=i.offsetY,e.type=i.type,e.offsetX=o*i.m11+s*i.m21+i.offsetX,e.offsetY=o*i.m12+s*i.m22+i.offsetY,l==t.MatrixTypes.Unknown)return void(e.type=t.MatrixTypes.Unknown);e.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling}},transform:function(e,t){var i=this._multiplyPoint(e,t.x,t.y);return{x:Math.round(100*i.x)/100,y:Math.round(100*i.y)/100}},rotate:function(e,t,i,a){t%=360,this.multiply(e,this._createRotationRadians(.017453292519943295*t,i?i:0,a?a:0))},scale:function(e,t,i,a,n){this.multiply(e,this._createScaling(t,i,a?a:0,n?n:0))},translate:function(e,i,a){return e.type&t.MatrixTypes.Identity?void this._setMatrix(e,1,0,0,1,i,a,t.MatrixTypes.Translation):e.type&t.MatrixTypes.Unknown?(e.offsetX+=i,void(e.offsetY+=a)):(e.offsetX+=i,e.offsetY+=a,void(e.type|=t.MatrixTypes.Translation))},_createScaling:function(e,i,a,n){var o=this.identity();return this._setMatrix(o,e,0,0,i,a-e*a,n-i*n,a||n?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling),o},_createRotationRadians:function(e,i,a){var n=this.identity(),o=Math.sin(e),s=Math.cos(e),r=i*(1-s)+a*o,l=a*(1-s)-i*o;return this._setMatrix(n,s,o,-o,s,r,l,t.MatrixTypes.Unknown),n},_multiplyPoint:function(e,i,a){switch(e.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=e.offsetX,a+=e.offsetY;break;case t.MatrixTypes.Scaling:i*=e.m11,a*=e.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=e.m11,i+=e.offsetX,a*=e.m22,a+=e.offsetY;break;default:var n=a*e.m21+e.offsetX,o=i*e.m12+e.offsetY;i*=e.m11,i+=n,a*=e.m22,a+=o}return{x:i,y:a}},_setMatrix:function(e,i,a,n,o,s,r,l){e.m11=i,e.m12=a,e.m21=n,e.m22=o,e.offsetX=s,e.offsetY=r,e.type=l||t.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(e,t){"use strict";t.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(e,i,a){var n,o;switch(a||(a=1),n=this.bounds(e),o=t.datavisualization.Diagram.Point(0,0),i){case"topleft":o=n.topLeft;break;case"topcenter":o=n.top;break;case"topright":o=n.topRight;break;case"middleleft":o=n.left;break;case"middleright":o=n.right;break;case"bottomleft":o=n.bottomLeft;break;case"bottomcenter":o=n.bottom;break;case"bottomright":o=n.bottomRight;break;case"pivot":o=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY);break;case"rotate":var s=20/a,r=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY-e.height*e.pivot.y-10-s),l=t.Matrix.identity();t.Matrix.rotate(l,e.rotateAngle,e.offsetX,e.offsetY),o=t.Matrix.transform(l,r)}return o},findResizeHandleAtPoint:function(e,i){var a,n,o,s,r,l=null;if(e)for(o=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"],s=0,r=o.length;r>s;s++)if(a=this._getResizeHandleCenter(e,o[s]),a!==t.datavisualization.Diagram.Point(0,0)&&(n=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(a.x,a.y),7))){l=o[s];break}return l},findRotationHandleAtPoint:function(e,i,a){var n=this._getResizeHandleCenter(e,"rotate",a),o=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(n.x,n.y),10);return!!o},findPivotHandleAtPoint:function(e,i){var a=this._getResizeHandleCenter(e,"pivot"),n=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(a.x,a.y),7);return!!n},findEndPointHandleAtPoint:function(e,i){var a,n,o,s,r=null;return e&&(n=e.line.points,o=n[n.length-1],a=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),a&&(r="targetEndPoint"),a||(o=n[0],a=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),a&&(r="sourceEndPoint")),a||"bezier"!==e.line.type||(o=e.line._point1,a=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),a&&(r="bezierpoint1"),a||(s=e.line._point2,a=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(s.x,s.y),7),a&&(r="bezierpoint2")))),r}},t.datavisualization.Diagram.LayoutUtil={expandSubTree:function(e,i,a,n,o,s,r){var l,d,h,c;e._isAnimating||(l=e.model.scrollSettings.currentZoom,d=i.offsetX*l-e.model.scrollSettings.viewPortWidth/2-e.model.scrollSettings.horizontalOffset,(i.offsetY*l<e.model.scrollSettings.verticalOffset||i.offsetY*l>e.model.scrollSettings.verticalOffset+e.model.scrollSettings.viewPortHeight-3*i.height*l)&&e.update({scrollSettings:{verticalOffset:i.offsetY-e.model.scrollSettings.viewPortHeight/2}}),h=0,0!=d&&s?(e._preventScrollerUpdate=!0,c=setInterval(function(){4>h&&e.update({scrollSettings:{horizontalOffset:e.model.scrollSettings.horizontalOffset+d/4}}),h++,5==h&&(clearInterval(c),delete e._preventScrollerUpdate,r===!1&&i.isExpanded||!i.outEdges.length?t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(e):t.datavisualization.Diagram.LayoutUtil.expand(e,i,a,n,o))},25)):(delete e._preventScrollerUpdate,r===!1&&i.isExpanded||!i.outEdges.length?t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(e):this.expand(e,i,a,n,o)))},_updateVisiblity:function(e,i,a){for(var n,o,s=0;s<i.outEdges.length;s++)n=i.outEdges[s],n=e.findNode(n),o=e.findNode(n.targetNode),n.opacity=o.opacity=a/100,t.datavisualization.Diagram.DiagramContext.updateNodeStyle(o,e),t.datavisualization.Diagram.DiagramContext.updateConnectorStyle(n,e),o.isExpanded&&o.outEdges.length&&this._updateVisiblity(e,o,a)},expand:function(e,t,i,a,n){e.updateNode(t.name,{isExpanded:!t.isExpanded})}},t.datavisualization.Diagram.Util={convertPathToArray:function(e){var t,i,a,n,o=[],s=this.parsePathData(e);if(s.length>0)for(t=0;t<s.length;t++)switch(i=s[t],a=i[0],a.toLowerCase()){case"m":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n],y:i[n+1]}),n+=1,"m"===a?a="l":"M"===a&&(a="L");break;case"l":case"t":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n],y:i[n+1]}),n+=1;break;case"h":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x:i[n]});break;case"v":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,y:i[n]});break;case"z":o.push({pathSegTypeAsLetter:a});break;case"c":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x1:i[n],y1:i[n+1],x2:i[n+2],y2:i[n+3],x:i[n+4],y:i[n+5]}),n+=5;break;case"s":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x2:i[n],y2:i[n+1],x:i[n+2],y:i[n+3]}),n+=3;break;case"q":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,x1:i[n],y1:i[n+1],x:i[n+2],y:i[n+3]}),n+=3;break;case"a":for(n=1;n<i.length;n++)o.push({pathSegTypeAsLetter:a,r1:i[n],r2:i[n+1],angle:i[n+2],largeArcFlag:this.parseArcFlag(i[n+3]),sweepFlag:this.parseArcFlag(i[n+4]),x:i[n+5],y:i[n+6]}),n+=6}return o},_getImageAlignment:function(e){if(e)switch(e.toLowerCase()){case"xminymin":return"xMinYMin";case"xminymid":return"xMinYMid";case"xminymax":return"xMinYMax";case"xmidymin":return"xMidYMin";case"xmidymid":return"xMidYMid";case"xmidymax":return"xMidYMax";case"xmaxymin":return"xMaxYMin";case"xmaxymid":return"xMaxYMid";case"xmaxymax":return"xMaxYMax";case"none":return"none"}return"none"},parseArcFlag:function(e){var t;return"0"===e||0===e?t=!1:("1"===e||1===e)&&(t=!0),t},parsePathData:function(e){var t,i,a,n,o=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,s=[];for(o.lastIndex=0,a=!1;t=o.exec(e);)"e"===t[1]?(n="",a=!0):t[1]?("zm"===t[1].toLowerCase()?(i&&s.push(i),s.push(["Z"]),i=[t[1].substring(1,2)]):(i&&s.push(i),i=[t[1]]),a=!1):(i||(i=[]),a||i.push(Number(t[2])),a=!1);return i&&s.push(i),s},pathSegArrayAsString:function(e){for(var t,i="",a=0;a<e.length;a++)t=e[a],i+=0===a?this.pathToString(t):" "+this.pathToString(t);return i},canEnablePointerEvents:function(e,i){var a,n=e;if(i)for(;n;){if(a=n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.PointerEvents:n.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents,!a)return a;n="string"==typeof n.parent?i.nameTable[n.parent]:n}return!0},isClassifier:function(t){var i="string"==typeof t.target.className?t.target.className:t.target.className.baseVal;return!!(e(t.target).hasClass("ej-d-classifier")||i.indexOf("ej-d-classifier")>-1)},pathToString:function(e){var t;switch(e.pathSegTypeAsLetter){case"Z":case"z":t=e.pathSegTypeAsLetter;break;case"M":case"m":case"L":case"l":t=e.pathSegTypeAsLetter+" "+e.x+" "+e.y;break;case"C":case"c":t=e.pathSegTypeAsLetter+" "+e.x1+" "+e.y1+" "+e.x2+" "+e.y2+" "+e.x+" "+e.y;break;case"Q":case"q":t=e.pathSegTypeAsLetter+" "+e.x1+" "+e.y1+" "+e.x+" "+e.y;break;case"A":case"a":t=e.pathSegTypeAsLetter+" "+e.r1+" "+e.r2+" "+e.angle+" "+(e.largeArcFlag?"1":"0")+" "+(e.sweepFlag?"1":"0")+" "+e.x+" "+e.y;break;case"H":case"h":t=e.pathSegTypeAsLetter+" "+e.x;break;case"V":case"v":t=e.pathSegTypeAsLetter+" "+e.y;break;case"S":case"s":t=e.pathSegTypeAsLetter+" "+e.x2+" "+e.y2+" "+e.x+" "+e.y;break;case"T":case"t":t=e.pathSegTypeAsLetter+" "+e.x+" "+e.y}return t},findPortByName:function(e,t){var i,a,n;if(e&&e.ports)for(a=0,n=e.ports.length;n>a;a++)if(i=e.ports[a],i.name===t)return i;return null},attr:function(e,t){for(var i in t)e.setAttribute(i.toString(),t[i])},removeChildFromGroup:function(e,t){var i,a=e.indexOf(t);if(0>a)for(i in e)if("object"==typeof e[i]&&"string"==typeof t&&e[i].name===t){a=i;break}a>=0&&e.splice(a,1)},removeFromCollection:function(e,t,i){var i,a,n;if(e){i=e.nameTable[e._getChild(i)];for(a in t)n=e.nameTable[e._getChild(t[a])],n.name===i.name&&t.splice(a,1)}},removeItem:function(e,t){var i=e.indexOf(t);i>=0&&e.splice(i,1)},clear:function(e){for(;e.length>0;)e.pop()},getChild:function(e){return e?"object"==typeof e?e.name:e:void 0},randomId:function(){for(var e,i="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",a="",n=0;4>n;n++)e=t.getRandomValue(0,i.length-1),a+=i.substring(e,e+1);return a},htmlEncode:function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(e){return this.canSelect(e)?e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Drag:"label"==e._type?e.constraints&t.datavisualization.Diagram.LabelConstraints.Draggable:e.constraints&t.datavisualization.Diagram.NodeConstraints.Drag:void 0},canMoveLabel:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLabel:e.constraints&t.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Rotate:"label"==e._type?e.constraints&t.datavisualization.Diagram.LabelConstraints.Rotatable:e.constraints&t.datavisualization.Diagram.NodeConstraints.Rotate},canShowTooltip:function(e,i){var a;return(a=e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritTooltip:e.constraints&t.datavisualization.Diagram.NodeConstraints.InheritTooltip)?i.model.tooltip:e.tooltip},canSelect:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Select:"label"==e._type?e.constraints&t.datavisualization.Diagram.LabelConstraints.Selectable:e.constraints&t.datavisualization.Diagram.NodeConstraints.Select},enableLayerOption:function(e,t,i){var a,n,o,s=0,r=0,l=i.model.layers;if(l&&0===l.length)return!0;for(n=0;l&&n<l.length;n++)"active"===t&&l[n][t]?(s++,o=l[n]):(e&&l[n].objects&&l[n].objects.indexOf(e.name)>-1||i._isParent(e,l[n].objects))&&(s++,a=l[n][t],l[n][t]&&r++);return"active"===t?1===s?o:!1:1===s?"lock"!==t?a:!a:!0},canBridge:function(e,i){return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging:e.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canBridgeObstacle:function(e){return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.BridgeObstacle:void 0},canCrispEdges:function(e,i){if(e.segments){if(e.constraints&t.datavisualization.Diagram.ConnectorConstraints.CrispEdges)return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.CrispEdges;if(i&&e.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritCrispEdges)return i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.CrispEdges}else{if(e.constraints&t.datavisualization.Diagram.NodeConstraints.CrispEdges)return e.constraints&t.datavisualization.Diagram.NodeConstraints.CrispEdges;if(i&&e.constraints&t.datavisualization.Diagram.NodeConstraints.InheritCrispEdges)return i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.CrispEdges}},canAllowPan:function(e){return e.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan},canAllowDrop:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.AllowDrop:e.constraints&t.datavisualization.Diagram.NodeConstraints.AllowDrop},isAllowDragLimit:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLimit:void 0},canDelete:function(e){return e.segments?e.constraints&t.datavisualization.Diagram.ConnectorConstraints.Delete:e.constraints&t.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.UserInteraction:void 0},canFloatElements:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.FloatElements:void 0},canEnableAPIMethods:function(e){return e&&e._enableAPIMethods?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.APIUpdate:void 0},canDoMultipleSelection:function(e){return e&&this.isPageEditable(e)?e.tool()&t.datavisualization.Diagram.Tool.MultipleSelect:void 0},canDoSingleSelection:function(e){return e&&this.isPageEditable(e)?e.tool()&t.datavisualization.Diagram.Tool.SingleSelect:void 0},canMoveOutofBoundary:function(e){return"infinity"!=e.model.pageSettings.boundaryConstraints},_getPseudoGroupConstraints:function(i,a,n){var o,s,r,l,d;if(n&&"pseudoGroup"===n.type)if((n.children.indexOf(a.name)>=0||a.name===n.name)&&i.model.selectedItems.getConstraints&&(s=i.model.selectedItems.getConstraints,"string"==typeof s&&(s=t.util.getObject(s,window))),s&&e.isFunction(s))o=s();else if(n.children)for(o=t.datavisualization.Diagram.NodeConstraints.Default,r=0;r<n.children.length;r++)l=i.nameTable[i._getChild(n.children[r])],l&&(d=l.constraints,d&t.datavisualization.Diagram.NodeConstraints.Resize||(o&=~t.datavisualization.Diagram.NodeConstraints.Resize),d&t.datavisualization.Diagram.NodeConstraints.Rotate||(o&=~t.datavisualization.Diagram.NodeConstraints.Rotate),d&t.datavisualization.Diagram.NodeConstraints.Drag||(o&=~t.datavisualization.Diagram.NodeConstraints.Drag));return o},canPanning:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY:void 0},canZooming:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Zoomable:void 0},canUndo:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Undoable:void 0},canZoomTextEditor:function(e){return e?e.model.constraints&t.datavisualization.Diagram.DiagramConstraints.ZoomTextEditor:void 0},canMultiSelectOnLane:function(e){return e.constraints&t.datavisualization.Diagram.NodeConstraints.MultiSelect},canMultiSelectOnNode:function(e){return e.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents},canEnableTooltip:function(e){return!!(e.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.Tooltip)},canDragHelper:function(e){return!!(e.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.DragOnEmptySpace)},canShowResizeThumbs:function(e){return e.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.AutoHideThumbs},canDrawStackHighlighter:function(e,i,a){var n,o,s,r;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(e)&&e&&i&&a&&(n=e.nameTable[a.parent],n&&n.isLaneStack&&(o=e.nameTable[n.parent],o&&o.isSwimlane)))if(s=this.bounds(o),r=e.activeTool._getPageBounds(),"horizontal"===o.orientation){if(i.height+s.bottom>=r.height||i.width-o.width+s.right>r.width)return e.activeTool.updateCursor("not-allowed"),e._notAllow=!0,!1}else if(i.width+s.right>=r.width||i.height-o.height+s.bottom>r.height)return e.activeTool.updateCursor("not-allowed"),e._notAllow=!0,!1;return!0},canDragSourceEnd:function(e){return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(e){return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(e){return e.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(e){return!!e.targetNode},isSourceConnected:function(e){return!!e.sourceNode},bounds:function(e,i){var a,n,o,s,r,l,d,h={};if(e)if(e.segments)for(a=0;a<e.segments.length;a++)n=e.segments[a],0==a?n.points&&(h=t.datavisualization.Diagram.Geometry.rect(n.points)):h=t.datavisualization.Diagram.Geometry.union(h,t.datavisualization.Diagram.Geometry.rect(n.points)),0==h.width&&(h.width=e.lineWidth,h.x-=e.lineWidth/2),0==h.height&&(h.height=e.lineWidth,h.y-=e.lineWidth/2);else"node"==e._type||"group"===e._type||"umlclassifier"==e.type||"pseudoGroup"==e._type?(o=e.width?e.width:e._width||0,s=e.height?e.height:e._height||0,h={x:e.offsetX-o*e.pivot.x,y:e.offsetY-s*e.pivot.y,width:o,height:s}):h=e;else h=t.datavisualization.Diagram.Rectangle();return h?(r={},h.x=Math.round(100*h.x)/100,h.y=Math.round(100*h.y)/100,h.width=Math.round(100*h.width)/100,h.height=Math.round(100*h.height)/100,r.width=h.width,r.height=h.height,r.x=r.left=h.x,r.right=h.x+h.width,r.y=r.top=h.y,r.bottom=h.y+h.height,r.center={x:h.x+h.width/2,y:h.y+h.height/2},r.topLeft={x:h.x,y:h.y},r.topCenter={x:h.x+h.width/2,y:h.y},r.topRight={x:h.x+h.width,y:h.y},r.middleLeft={x:h.x,y:h.y+h.height/2},r.middleRight={x:h.x+h.width,y:h.y+h.height/2},r.bottomLeft={x:h.x,y:h.y+h.height},r.bottomCenter={x:h.x+h.width/2,y:h.y+h.height},r.bottomRight={x:h.x+h.width,y:h.y+h.height},e&&e.rotateAngle&&!i&&(l=t.Matrix.identity(),t.Matrix.rotate(l,e.rotateAngle,e.offsetX,e.offsetY),r.topLeft=t.Matrix.transform(l,r.topLeft),r.topCenter=t.Matrix.transform(l,r.topCenter),r.topRight=t.Matrix.transform(l,r.topRight),r.middleLeft=t.Matrix.transform(l,r.middleLeft),r.middleRight=t.Matrix.transform(l,r.middleRight),r.bottomLeft=t.Matrix.transform(l,r.bottomLeft),r.bottomCenter=t.Matrix.transform(l,r.bottomCenter),r.bottomRight=t.Matrix.transform(l,r.bottomRight),d=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),r.x=r.left=d.x,r.y=r.top=d.y,r.right=d.x+d.width,r.bottom=d.y+d.height,r.center=t.datavisualization.Diagram.Point(d.x+d.width/2,d.y+d.height/2)),r.points=[r.topLeft,r.topRight,r.bottomRight,r.bottomLeft],r):h},_swapBounds:function(e,i){var e,i,a,n;return i=i,e.rotateAngle?(e.rotateAngle<45||(e.rotateAngle<=135?(a=t.Matrix.identity(),t.Matrix.rotate(a,e.rotateAngle,e.offsetX,e.offsetY),n=i.topCenter,i.topCenter=i.middleLeft,i.middleLeft=i.bottomCenter,i.bottomCenter=i.middleRight,i.middleRight=n,n=i.topLeft,i.topLeft=i.bottomLeft,i.bottomLeft=i.bottomRight,i.bottomRight=i.topRight,i.topRight=n):e.rotateAngle<=225?(a=t.Matrix.identity(),t.Matrix.rotate(a,e.rotateAngle,e.offsetX,e.offsetY),n=i.topCenter,i.topCenter=i.bottomCenter,i.bottomCenter=n,n=i.middleLeft,i.middleLeft=i.middleRight,i.middleRight=n,n=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=n,n=i.bottomRight,i.bottomRight=i.topRight,i.topRight=n):e.rotateAngle<=315&&(a=t.Matrix.identity(),t.Matrix.rotate(a,e.rotateAngle,e.offsetX,e.offsetY),n=i.topCenter,i.topCenter=i.middleRight,i.middleRight=i.bottomCenter,i.bottomCenter=i.middleLeft,i.middleLeft=n,n=i.topRight,i.topRight=i.bottomRight,i.bottomRight=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=n)),i.points=[i.topLeft,i.topRight,i.bottomRight,i.bottomLeft],i):void 0},canResize:function(e,i){if("label"===e._type)return e.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable;if(!i)return e.constraints&t.datavisualization.Diagram.NodeConstraints.Resize;switch(i){case"n-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth;case"s-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth;case"e-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast;case"w-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest;case"se-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;case"ne-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast;case"sw-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest;case"nw-resize":return e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest}},canConnect:function(e,i){var a=null;return e&&(i?a=e.constraints&t.datavisualization.Diagram.PortConstraints.Connect:e.segments||(a=e.constraints&t.datavisualization.Diagram.NodeConstraints.Connect)),a},_initializeSegments:function(e,i){var a,n,o;if(e.segments&&e.segments.length<=1)switch(e.segments.length||e.segments.push(t.datavisualization.Diagram.Segment({type:i||"straight"})),a=e.segments[0],a.type){case"straight":a.point?(a.point.x!=e.targetPoint.x||a.point.y!=e.targetPoint.y)&&e.segments.push({type:a.type||"straight"}):a._point=e.targetPoint;break;case"orthogonal":a.length&&a.direction?(t.datavisualization.Diagram.Util._addOrthogonalPoints(a,null,null,e.sourcePoint,e.targetPoint),(a._endPoint.x!=e.targetPoint.x||a._endPoint.y!=e.targetPoint.y)&&e.segments.push({type:a.type||"straight"})):(a._length=a.length||20,a._direction=a.direction||"auto");break;case"bezier":a.point?(a.point.x!=e.targetPoint.x||a.point.y!=e.targetPoint.y)&&e.segments.push({type:a.type||"straight"}):a._point=e.targetPoint}var s,r=e.sourcePoint,l=null,d=null;for(n=0;n<e.segments.length;n++){if(o=e.segments[n],o._startPoint=r,d=e.segments[n+1],o=e.segments[n]=t.datavisualization.Diagram.Segment(e.segments[n]),"orthogonal"==o.type){if(o._direction=o.direction||"auto",o._length=o.length||20,s=t.datavisualization.Diagram.Util._addOrthogonalPoints(e.segments[n],l,d,e.sourcePoint,e.targetPoint,s),r=e.segments[n]._endPoint,!o.length||!o.direction)break}else if("straight"==o.type){if(o.points.push(r),o.points.push(e.segments[n].point||e.targetPoint),o._point=o._endPoint=e.segments[n].point||e.targetPoint,s=t.datavisualization.Diagram.Geometry.findAngle(r,o._endPoint),r=e.segments[n]._endPoint,!o.point)break}else{if("bezier"!=o.type){o=t.datavisualization.Diagram.Segment({type:"orthogonal"}),o._direction="auto",o._length=20,o._startPoint=r,o._endPoint=e.targetPoint,e.segments.push(o),t.datavisualization.Diagram.Util._addOrthogonalPoints(o,l,null,e.sourcePoint,e.targetPoint,s);break}if(o._point=o._endPoint=e.segments[n].point||e.targetPoint,o.points.push(r),o.points.push(e.segments[n].point||e.targetPoint),s=t.datavisualization.Diagram.Geometry.findAngle(r,o._endPoint),t.datavisualization.Diagram.Util._updateBezierPoints(o),r=e.segments[n]._endPoint,!o.point)break}l=e.segments[n]}(r.x!=e.targetPoint.x||r.y!=e.targetPoint.y)&&(o=t.datavisualization.Diagram.Segment({type:(l?l.type:i)||"straight"}),o._startPoint=r,o._endPoint=e.targetPoint,"orthogonal"==o.type?t.datavisualization.Diagram.Util._addOrthogonalPoints(o,l,null,e.sourcePoint,e.targetPoint,s):(o._point=e.targetPoint,o.points.push(r),o.points.push(e.targetPoint),"bezier"==o.type&&this._updateBezierPoints(o)),e.segments.push(o))},_getDockableBPMNNode:function(e,t,i,a){var n=a?t.segments[t.segments.length-1]:t.segments[0];if(e&&"bpmn"==e.type){if("orthogonal"==n.type)return e;"group"==e._type&&(e="object"==typeof e.children[0]?e.children[0]:i[e.children[0]])}return e},dock:function(e,t,i){var a,n,o,s,r=null,l=null,d=e._srcDecoratorSize,h=e._tarDecoratorSize;e.sourcePadding&&(e._srcDecoratorSize+=e.sourcePadding),e.targetPadding&&(e._tarDecoratorSize+=e.targetPadding),a=t[e.targetNode],a&&(r=this.findPortByName(a,e.targetPort)),n=t[e.sourceNode],n&&(l=this.findPortByName(n,e.sourcePort)),o=this.isSourceConnected(e),s=this.isTargetConnected(e),l?l.connectorPadding&&(e._srcDecoratorSize+=l.connectorPadding):(n=this._getDockableBPMNNode(n,e,t,!1),n&&n.connectorPadding&&(e._srcDecoratorSize+=n.connectorPadding)),r?r.connectorPadding&&(e._tarDecoratorSize+=r.connectorPadding):(a=this._getDockableBPMNNode(a,e,t,!0),a&&a.connectorPadding&&(e._tarDecoratorSize+=a.connectorPadding)),s&&o&&r&&l?this._dockPortToPort(e,a,r,n,l):s&&r?o?1==e.segments.length?(this._dockNode(e,n,null,s,o),this._dockPortToNode(e,a,r,n,l,!0)):(this._dockNode(e,n,null,s,o),this._updateIntermediateSegments(e),this._dockPortToPoint(e,a,r,!0),this._updatePreviousSegment(e)):(this._dockPortToPoint(e,a,r,!0),this._updatePreviousSegment(e)):o&&l?s?1==e.segments.length?(this._dockNode(e,a,null,s,o),this._dockPortToNode(e,n,l,a,r,!1)):(this._dockPortToPoint(e,n,l,!1),this._updateIntermediateSegments(e),this._dockNode(e,a,null,s,o),this._updatePreviousSegment(e)):(this._dockPortToPoint(e,n,l,!1),this._updateIntermediateSegments(e)):s&&o?a&&n&&this._dockNode(e,a,n,s,o,i):s?this._dockNode(e,a,null,s,o):o&&this._dockNode(e,n,null,s,o),this._adjustEndPoint(e,n,l,a,r),e._srcDecoratorSize=d,e._tarDecoratorSize=h},_dockPortToPort:function(e,i,a,n,o){var s,r,l;if(1==e.segments.length){i&&(r=this.bounds(i,!0)),n&&(l=this.bounds(n,!0));var d,h=e.segments[0],c=(e.segments[e.segments.length-1],e.segments[0]);if("orthogonal"!==c.type)a&&(s=this._getPortPosition(a,r),i.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(d,s)),this._setLineEndPoint(e,s,!0)),o&&(s=this._getPortPosition(o,l),n.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,n.rotateAngle,n.offsetX,n.offsetY),s=t.Matrix.transform(d,s)),this._setLineEndPoint(e,s,!1)),"bezier"===c.type&&this._updateBezierPoints(c,i,a,r,n,o,l);else{var u=this._getPortPosition(a,r),g=this._getPortPosition(o,l),m=this._swapDirection(i.rotateAngle,this._getDirection(r,u)),p=this._swapDirection(n.rotateAngle,this._getDirection(l,g));n.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,n.rotateAngle,n.offsetX,n.offsetY),g=t.Matrix.transform(d,g)),i.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),u=t.Matrix.transform(d,u)),this._constructSegements(e,h,r,u,m,l,g,p),this._setLineEndPoint(e,h.points[0],!1),this._setLineEndPoint(e,h.points[h.points.length-1],!0)}}else this._dockPortToPoint(e,n,o,!1),this._updateIntermediateSegments(e),this._dockPortToPoint(e,i,a,!0),this._updatePreviousSegment(e)},_dockPortToNode:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f=e.segments[0],v=e.segments[e.segments.length-1];i&&(r=this.bounds(i,!0)),n&&(l=this.bounds(n,!0)),h=s?v:f,"orthogonal"!==h.type?(c=this._getPortPosition(a,r),d=t.Matrix.identity(),t.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),c=t.Matrix.transform(d,c),this._setLineEndPoint(e,c,s)):(u=this._getPortPosition(a,r),g=this._swapDirection(i.rotateAngle,this._getDirection(r,u)),d=t.Matrix.identity(),t.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),u=t.Matrix.transform(d,u),m=s?e.sourcePoint:e.targetPoint,p=n?this._getDirection(l,m):"top",p&&(r=this.bounds(i),l=n?this.bounds(n):{left:m.x,right:m.x,top:m.y,bottom:m.y},s?(this._setLineEndPoint(e,u,!0),this._constructSegements(e,v,r,u,g,l,m,p)):(this._setLineEndPoint(e,u,!1),this._constructSegements(e,f,l,m,p,r,u,g))))},_dockPortToPoint:function(e,i,a,n){var o,s,r,l=e.segments[0],d=e.segments[e.segments.length-1],h=n?d:l;if("orthogonal"!==h.type)this._dockPortToNode(e,i,a,null,null,n);else{var c=this.bounds(i,!0),u=this._getPortPosition(a,c),g=this._swapDirection(i.rotateAngle,this._getDirection(c,u)),m=t.Matrix.identity();t.Matrix.rotate(m,i.rotateAngle,i.offsetX,i.offsetY),u=t.Matrix.transform(m,u),o=n?d._startPoint:l._endPoint,s=this.bounds(t.datavisualization.Diagram.Rectangle(o.x,o.y,0,0)),c=this.bounds(i),r="top",n?(this._setLineEndPoint(e,u,!0),this._pointsFromNodeToPoint(e,d,g,c,i.rotateAngle,u,o,!0)):(this._setLineEndPoint(e,u,!1),this._pointsFromNodeToPoint(e,l,g,c,i.rotateAngle,u,o,!1))}},_containsminSpaceBetweenNode:function(e,t,i){var a;if(e&&e.minSpaceBetweenNode&&t&&i&&e.minSpaceBetweenNode&&e.minSpaceBetweenNode.length>0)for(a in e.minSpaceBetweenNode)if(e.minSpaceBetweenNode[a]===t.name||e.minSpaceBetweenNode[a]===i.name)return!0;return!1},_dockNode:function(e,t,i,a,n,o){var s,r,l,d,h,c,u,g,m,p=e._srcDecoratorSize+e._tarDecoratorSize;p=this._containsminSpaceBetweenNode(o,i,t)?0:p,1==e.segments.length?s=r=e.segments[0]:(s=e.segments[0],r=e.segments[e.segments.length-1]),a&&n&&!e.targetPort&&!e.sourcePort?1==e.segments.length?"orthogonal"==e.segments[0].type?(l=this.bounds(i),d=this.bounds(t),this._swapBounds(i,l),this._swapBounds(t,d),l.y-p>=d.bottom?(h=l.topCenter,u="top",c=d.bottomCenter,g="bottom"):l.bottom+p<=d.y&&(c=d.topCenter,g="top",h=l.bottomCenter,u="bottom"),l.bottom+p>d.y&&l.y<d.bottom+p&&(l.right+p<d.x||d.right>=l.x-p&&l.x>d.x?(h=l.middleRight,u="right",c=d.middleLeft,g="left"):d.right+p<l.x||l.right>=d.x-p&&l.x<d.x?(h=l.middleLeft,
u="left",c=d.middleRight,g="right"):l.x<=d.x?(h=l.middleLeft,u="left",c=d.middleLeft,g="left"):l.x<=d.right?(h=l.middleRight,u="right",c=d.middleRight,g="right"):(h=l.middleLeft,u="left",c=d.middleRight,g="right")),m=this._findEndPoint(u,h,i)||l.center,h=this._findIntersection(i,l,e,h,m,!1)||h,m=this._findEndPoint(g,c,t)||d.center,c=this._findIntersection(t,d,e,c,m,!0)||c,this._setLineEndPoint(e,h,!1),this._setLineEndPoint(e,c,!0),"orthogonal"==e.segments[0].type&&(this._constructSegements(e,e.segments[0],d,e.targetPoint,g,l,e.sourcePoint,u),e.segments[0]._direction=u)):(t&&(d=this.bounds(t),this._swapBounds(t,d),i&&(l=this.bounds(i),this._swapBounds(i,l),this._setLineEndPoint(e,l.center,!1),this._setLineEndPoint(e,d.center,!0),this._dockBounds(e,i,l,!1)),this._setLineEndPoint(e,d.center,!0),this._dockBounds(e,t,d,!0)),"bezier"==e.segments[0].type&&this._updateBezierPoints(e.segments[0])):(this._dock(e,s,i,null,!1),this._updateIntermediateSegments(e),1==e.segments.length?(this._dock(e,s,i,t,!1),this._dock(e,r,t,i,!0)):(this._dock(e,r,t,null,!0),this._updatePreviousSegment(e))):a&&!e.targetPort?(this._dock(e,r,t,i,!0),this._updatePreviousSegment(e)):n&&!e.sourcePort&&(this._dock(e,s,t,i,!1),this._updateIntermediateSegments(e))},_adjustEndPoint:function(e,t,i,a,n){var o,s,r,l,d;if(e.sourcePadding||e.targetPadding||i&&i.connectorPadding||n&&n.connectorPadding){var h=0,c=a?this.bounds(a):null,u=t?this.bounds(t):null;t&&(l=e.segments[0],o="orthogonal"!==l.type?"bezier"!==l.type?l._endPoint:l._point1:l.points[1],i&&(h=e.sourcePadding+i.connectorPadding),s=this._adjustPoint(l._startPoint,o,!0,h),this._setLineEndPoint(e,s,!1),"bezier"==l.type&&this._updateBezierPoints(l,a,n,c,t,i,u)),a&&(l=e.segments[e.segments.length-1],r="orthogonal"!==l.type?"bezier"!==l.type?l._startPoint:l._point2:l.points[l.points.length-2],n&&(h=e.targetPadding+n.connectorPadding),d=this._adjustPoint(r,l._endPoint,!1,h),this._setLineEndPoint(e,d,!0),"bezier"==l.type&&this._updateBezierPoints(l,a,n,c,t,i,u))}},_findEndPoint:function(e,t,i){var a;switch(e){case"top":a={x:t.x,y:t.y+Math.max(i.width,i.height)};break;case"bottom":a={x:t.x,y:t.y-Math.max(i.width,i.height)};break;case"left":a={y:t.y,x:t.x+Math.max(i.width,i.height)};break;case"right":a={y:t.y,x:t.x-Math.max(i.width,i.height)}}return a},_dock:function(e,i,a,n,o){var s,r,l,d,h,c,u,g,m;if(a)if(r=a,l=o?i._startPoint:i._endPoint,s=this.bounds(a),this._swapBounds(a,s),o)if("orthogonal"==i.type)if(u=e.segments[e.segments.length-2],u&&"orthogonal"==u.type)if(i.points.length>2&&t.datavisualization.Diagram.Geometry.containsPoint(s,i.points[i.points.length-2])){if(g=!1,"top"==u.direction||"bottom"==u.direction){if(u._endPoint.x>=s.left&&u._endPoint.x<=s.right)return void this._removeLastSegment(e,i,u,a,n,o);u._length=u.length=Math.abs(u._startPoint.y-s.middleLeft.y),0==u.length?g=!0:(u.length<0&&(u._length=u.length*=-1,u._direction=u.direction="top"==u.direction?"bottom":"top"),e.targetPoint=u._endPoint.x>s.right?s.middleRight:s.middleLeft)}else{if(u._endPoint.y>=s.top&&u._endPoint.y<=s.bottom)return void this._removeLastSegment(e,i,u,a,n,o);u._length=u.length=Math.abs(u._startPoint.x-s.topCenter.x),0==u.length?g=!0:(u.length<0&&(u._length=u.length*=-1,u._direction=u.direction="left"==u.direction?"right":"left"),e.targetPoint=u._endPoint.y>s.bottom?s.bottomCenter:s.topCenter)}if(g)return e.segments.splice(e.segments.length-2,1),void this._dock(e,i,a,n,o);e.targetPoint=this._findIntersection(a,s,e,e.targetPoint,s.center,o)||e.targetPoint,this._updateConnectorSegments(e,e.sourcePort,e.targetPort),i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,u),this._setLineEndPoint(e,e.targetPoint,o)}else if(t.datavisualization.Diagram.Geometry.containsPoint(s,i._startPoint)){if(m="left"==u.direction||"right"==u.direction?r.width/2:r.height/2,u._length=u.length-=m+30,0==u.length)return e.segments.splice(e.segments.length-2,1),void this._dock(e,i,a,n,o);e.targetPoint="left"==u.direction||"right"==u.direction?"right"==u.direction?s.middleLeft:s.middleRight:"bottom"==u.direction?s.topCenter:s.bottomCenter,e.targetPoint=this._findIntersection(a,s,e,e.targetPoint,s.center,o)||e.targetPoint,this._updateConnectorSegments(e,e.sourcePort,e.targetPort),i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,u),this._setLineEndPoint(e,e.targetPoint,o)}else this._dockNodeToPoint(e,l,a,o);else this._dockNodeToPoint(e,l,a,o);else this._dockNodeToPoint(e,l,a,o);else if("orthogonal"==i.type&&e.segments[1]&&"orthogonal"==e.segments[1].type)if(e.segments[0]._isInternal&&t.datavisualization.Diagram.Geometry.containsPoint(s,i._endPoint))this._insertSegmentAtSourceEnd(e,i,s,a,o);else if(t.datavisualization.Diagram.Geometry.containsPoint(s,i._endPoint))this._removeFirstSegment(e,i,s,a,o);else{switch(i.direction){case"left":h="left",d=s.middleLeft;break;case"right":h="right",d=s.middleRight;break;case"top":h="top",d=s.topCenter;break;case"bottom":h="bottom",d=s.bottomCenter}i.points=[],c=this._findEndPoint(h,d,a)||s.center,d=this._findIntersection(a,s,e,d,c,o)||d,i.points.push(d),i.points.push(i._endPoint),this._setLineEndPoint(e,d,o)}else this._dockNodeToPoint(e,i._endPoint,a,o)},_removeLastSegment:function(e,t,i,a,n,o){e.segments.splice(e.segments.length-1,1),i.length=i._length=null,i.direction=null,i._direction=t._direction,this._dock(e,i,a,n,o)},_insertSegmentAtSourceEnd:function(e,t,i,a,n){var o,s,r=e.segments[1],l=e.segments[2];"left"==e.segments[0].direction||"right"==e.segments[0].direction?(o="horizontal",e.sourcePoint="top"==r.direction?i.topCenter:i.bottomCenter,r&&(r.length||0===r.length)&&(r._length=r.length=Math.max(Math.abs(e.sourcePoint.y-r._endPoint.y),25)),l&&(l.length||0===l.length)&&(l.length=l._length=Math.abs(i.topCenter.x-l._endPoint.x))):(o="vertical",e.sourcePoint="left"==r.direction?i.middleLeft:i.middleRight,r&&(r.length||0===r.length)&&(r._length=r.length=Math.max(Math.abs(e.sourcePoint.x-r._endPoint.x),25)),l&&(l.length||0===l.length)&&(l.length=l._length=Math.abs(i.middleRight.y-l._endPoint.y))),e.segments[3]&&(e.segments[3].length||0==e.segments[3].length)&&(s="bottom"==r.direction||"right"==r.direction?r.length:-r.length,e.segments[3].length=e.segments[3]._length="vertical"==o?Math.abs(e.sourcePoint.x+s-e.segments[3]._endPoint.x):Math.abs(e.sourcePoint.y+s-e.segments[3]._endPoint.y),e.segments[3].length<0&&(s="bottom"==r.direction||"right"==r.direction?r.length:-r.length,e.segments[3].length=e.segments[3]._length="vertical"==o?Math.abs(e.sourcePoint.x+s-e.segments[3]._endPoint.x):Math.abs(e.sourcePoint.y+s-e.segments[3]._endPoint.y))),e.segments.splice(0,1),e.sourcePoint=this._findIntersection(a,i,e,e.sourcePoint,i.center,n)||e.sourcePoint,this._updateConnectorSegments(e,e.sourcePort,e.targetPort),this._setLineEndPoint(e,e.sourcePoint,n)},_removeFirstSegment:function(e,i,a,n,o){var s,r,l,d,h,c,u=e.segments[1].direction||this._getBezierDirection(e.segments[1].points[0],e.segments[1].points[1]);"left"==u||"right"==u?(l=i._endPoint.y-a.middleRight.y,e.segments[0].direction=e.segments[0]._direction=l>=0?"bottom":"top",e.segments[0].length=e.segments[0]._length=Math.abs(l),d="right"==u?e.segments[1]._endPoint.x-a.right:a.left-e.segments[1]._endPoint.x,e.sourcePoint="left"==u?a.middleLeft:a.middleRight,s=Math.abs(e.sourcePoint.x-e.segments[0]._startPoint.x),r=Math.abs(e.sourcePoint.y-e.segments[0]._endPoint.y)):((e.segments[0].length||0==e.segments[0].length)&&(l=i._endPoint.x-a.bottomCenter.x,e.segments[0].direction=e.segments[0]._direction=l>=0?"right":"left",e.segments[0].length=e.segments[0]._length=Math.abs(l)),d="bottom"==u?e.segments[1]._endPoint.y-a.bottom:a.top-e.segments[1]._endPoint.y,e.sourcePoint="top"==u?a.topCenter:a.bottomCenter,s=Math.abs(e.sourcePoint.y-e.segments[0]._startPoint.y),r=Math.abs(e.sourcePoint.x-e.segments[0]._endPoint.x)),e.segments[1]&&(e.segments[1].length||0===e.segments[1].length)&&(e.segments[1]._length=e.segments[1].length=d-25,e.segments[1]._length<0&&(e.segments.splice(0,2),(e.segments[0].length||0===e.segments[0].length)&&(e.segments[0].length=e.segments[0]._length=s),h=t.datavisualization.Diagram.Segment({type:"orthogonal",length:r,direction:u}))),h||(h=t.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:u})),c=[h],h._isInternal=!0,e.segments=c.concat(e.segments),e.sourcePoint=this._findIntersection(n,a,e,e.sourcePoint,a.center,o)||e.sourcePoint,this._updateConnectorSegments(e,e.sourcePort,e.targetPort),this._setLineEndPoint(e,e.sourcePoint,o)},_dockNodeToPoint:function(e,t,i,a){var n,o,s,r,l,d,h,c,u,g,m;if(n=a?e.segments[e.segments.length-1]:e.segments[0],"orthogonal"!=n.type)o=this.bounds(i),this._swapBounds(i,o),this._setLineEndPoint(e,o.center,a),this._dockBounds(e,i,o,a);else{if(o=this.bounds(i),this._swapBounds(i,o),h=t,e.segments.length>1){var p=e.segments[e.segments.length-2],f=Math.abs(h.x-o.left),v=Math.abs(h.x-o.right),_=Math.abs(h.y-o.top),y=Math.abs(h.y-o.bottom);p&&a&&(c="left"==p.direction||"right"==p.direction,u="top"==p.direction||"bottom"==p.direction),n=a?e.segments[e.segments.length-1]:e.segments[0],2!=n.points.length&&p||"orthogonal"!=n.type||(c=u=!1),o.bottom<h.y&&!c?(l="bottom",d="top",r=o.bottomCenter):o.y>h.y&&!c?(l="top",d="bottom",r=o.topCenter):o.right<h.x&&!u?(l="right",d="left",r=o.middleRight):o.x>h.x&&!u?(l="left",d="right",r=o.middleLeft):(m=f,r=o.middleLeft,l="left",d="right",m>=v&&0!=v&&(r=o.middleRight,l="right",d="left",m=v),m>_&&0!=_&&(r=o.topCenter,l="top",d="bottom",m=_),m>y&&0!=y&&(r=o.bottomCenter,l="bottom",d="top",m=y))}else switch(r=o.center,l=this._getBezierDirection(t,r)){case"left":d="right";break;case"right":d="left";break;case"top":d="bottom";break;case"bottom":d="top"}r&&(a||1==e.segments.length?(s=e.segments[e.segments.length-1],"orthogonal"==s.type&&(s._direction=a?l:d)):s=e.segments[0],g=this._findEndPoint(l,r,i)||o.center,r=this._findIntersection(i,o,e,r,g,a)||r,a?e.targetPoint=r:e.sourcePoint=r,1!=e.segments.length&&this._addOrthogonalPoints(s,a?e.segments[e.segments.length-2]:null,a?null:e.segments[1],e.sourcePoint,e.targetPoint),this._setLineEndPoint(e,r,a))}},_getDockSegment:function(e,i,a,n,o,s){var r,l,d=this._getEdges(a,n),s="",h=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint);return l=o?t.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):h>5?t.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):t.datavisualization.Diagram.LineSegment(i._startPoint,e.segments[1]?e.segments[1]._endPoint:e.targetPoint),t.datavisualization.Diagram.Geometry.intersectSegment(l,d.left)?(r=d.left,s="left"):t.datavisualization.Diagram.Geometry.intersectSegment(l,d.top)?(r=d.top,s="top"):t.datavisualization.Diagram.Geometry.intersectSegment(l,d.right)?(r=d.right,s="right"):t.datavisualization.Diagram.Geometry.intersectSegment(l,d.bottom)&&(r=d.bottom,s="bottom"),s=this._swapDirection(a,s),r?{dockPoint:t.datavisualization.Diagram.Geometry.midPoint(r),direction:s}:null},_dockBounds:function(e,t,i,a){var n,o,s,r;n=a?e.segments[e.segments.length-1]:e.segments[0],o=n._startPoint,s=n._endPoint||n.point,"bezier"==n.type&&(n.point1||n.point2)&&(a?o=n._point2:s=n._point1),r=this._findIntersection(t,i,e,o,s,a),r&&(this._setLineEndPoint(e,r,a),"bezier"===n.type&&this._updateBezierPoints(n))},_findIntersection:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_,y,b=s?a.segments[a.segments.length-1]:a.segments[0],x=e.connectorPadding;if(x+=s?a.targetPadding:a.sourcePadding,"orthogonal"==b.type&&(n={x:n.x,y:n.y},n.x==o.x&&(n.y<o.y?n.y-=x+5:n.y+=x+5),n.y==o.y&&(n.x<o.x?n.x-=x+5:n.x+=x+5)),h=s||"orthogonal"==b.type?n:o,"orthogonal"!=b.type&&(s?(d=t.datavisualization.Diagram.Geometry.findAngle(n,o),o=t.datavisualization.Diagram.Geometry.transform({x:o.x,y:o.y},d,Math.max(e.width/2,e.height/2))):(d=t.datavisualization.Diagram.Geometry.findAngle(o,n),n=t.datavisualization.Diagram.Geometry.transform({x:n.x,y:n.y},d,Math.max(e.width/2,e.height/2)))),"ellipse"===e._shape)return _=t.datavisualization.Diagram.LineSegment(n,o),this._getEllipseIntersectCoords(e,_,a,h,s);if("polygon"!==e._shape||"bpmn"==e.type&&"orthogonal"==b.type)!e.pathData||"path"!==e._shape||"bpmn"==e.type&&"orthogonal"==b.type?((e.connectorPadding||a.sourcePadding||a.targetPadding)&&(v=t.datavisualization.Diagram.Rectangle(i.x-x,i.y-x,e.width+2*x,e.height+2*x),i=this.bounds(v)),r=i.points,r[r.length]=r[0],l=i.points.length):(e._segmentPoints||(f=this._findSegmentPoints(e,a,s)),r=f||e._segmentPoints,e.pathData.split("m").length-1+(e.pathData.split("M").length-1)==1&&(r[r.length]=r[0]),l=r.length);else{for(r=[],r=e._segmentPoints?e._segmentPoints:this._findSegmentPoints(e,a,s),e.rotateAngle&&(c=t.Matrix.identity(),t.Matrix.rotate(c,e.rotateAngle,e.offsetX,e.offsetY)),l=r.length,f=[],u=0;l>u;u++)g=t.datavisualization.Diagram.Point(r[u].x+(e.offsetX-e.width*e.pivot.x),r[u].y+(e.offsetY-e.height*e.pivot.y)),0!=e.rotateAngle&&(g=t.Matrix.transform(c,g)),(e.connectorPadding||a.sourcePadding||a.targetPadding)&&(m=e.offsetX==g.x?0:e.offsetX<g.x?1:-1,p=e.offsetY==g.y?0:e.offsetY<g.y?1:-1,g=x?t.datavisualization.Diagram.Geometry.translate(g,m*x,p*x):g),f[u]=g;r=f}return _=t.datavisualization.Diagram.LineSegment(n,o),y=this._getIntersectionPoints(_,r,!0,h)},_getIntersectionPoints:function(e,i,a,n){var o,s,r,l,d=i.length,h=t.datavisualization.Diagram.LineSegment(i[0],i[1]),c=t.datavisualization.Diagram.Geometry.intersectSegment(e,h);if(c){if(!a)return c;s=t.datavisualization.Diagram.Geometry.distance(c,n)}if(isNaN(s)||s>0)for(o=1;d-1>o;o++)if(h=t.datavisualization.Diagram.LineSegment(i[o],i[o+1]),r=t.datavisualization.Diagram.Geometry.intersectSegment(e,h)){if(!a)return r;if(l=t.datavisualization.Diagram.Geometry.distance(r,n),(isNaN(s)||s>l)&&(s=l,c=r),s>=0&&1>=s)break}return c},_findSegmentPoints:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f=[];if("path"==e._shape){for(n=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(n),o=document.createElementNS("http://www.w3.org/2000/svg","path"),o.setAttributeNS(null,"d",e._absolutePath||e.pathData),n.appendChild(o),s=!e._absoluteBounds||e._scaled||e._absolutePath?o.getBBox():e._absoluteBounds,r=e.connectorPadding,i&&(r+=a?i.targetPadding:i.sourcePadding),r||!e._absolutePath||e._scaled?(l=t.datavisualization.Diagram.Geometry.updatePath(-r,-r,e.width+2*r,e.height+2*r,e._absolutePath||e.pathData,null,s,r?null:e),o.setAttributeNS(null,"d",l),(!e._scaled||r)&&e._absolutePath||(e._absolutePath=l,e._scaled=!1)):o.setAttributeNS(null,"d",e._absolutePath),d=t.Matrix.identity(),t.Matrix.rotate(d,e.rotateAngle,e.offsetX,e.offsetY),h=o.getTotalLength(),u=0;h>=u;u+=10)c=o.getPointAtLength(u),g={x:e.offsetX-e.width*e.pivot.x+c.x,y:e.offsetY-e.height*e.pivot.y+c.y},0!=e.rotateAngle&&(g=t.Matrix.transform(d,g)),f.push(g);document.body.removeChild(n)}else{if("polygon"!=e._shape)return null;for(m=e.points.length,p=0;m>p;p++)f[p]=e.points[p];t.datavisualization.Diagram.Geometry.updatePolygonPoints(e,f),f[f.length]=f[0]}return f},_getEdges:function(e,i){var a,n=i.points,o={},s=e%360;return o.left=t.datavisualization.Diagram.LineSegment(n[3],n[0]),o.top=t.datavisualization.Diagram.LineSegment(n[0],n[1]),o.right=t.datavisualization.Diagram.LineSegment(n[1],n[2]),o.bottom=t.datavisualization.Diagram.LineSegment(n[2],n[3]),0>s&&(s+=360),s>315||45>s||(135>s?(a=o.top,o.top=o.left,o.left=o.bottom,o.bottom=o.right,o.right=a):225>s?(a=o.top,o.top=o.bottom,o.bottom=a,a=o.left,o.left=o.right,o.right=a):(a=o.bottom,o.bottom=o.left,o.left=o.top,o.top=o.right,o.right=a)),o},_pointsFromNodeToPoint:function(e,t,i,a,n,o,s,r){var l,d,h,c=r?e._tarDecoratorSize:e._srcDecoratorSize,u=[];u.push(o),l=o.y==s.y&&("left"==i&&s.x<o.x||"right"==i&&s.x>o.x)||o.x==s.x&&("top"==i&&s.y<o.y||"bottom"==i&&s.y>o.y),l||("top"==i||"bottom"==i?"top"==i&&s.y<o.y&&s.y>o.y-c||"bottom"==i&&s.y>o.y&&s.y<o.y+c?(d="top"==i?a.top-c:a.bottom+c,u.push({x:o.x,y:d}),u.push({x:o.x+(s.x-o.x)/2,y:d}),u.push({x:o.x+(s.x-o.x)/2,y:s.y})):Math.abs(o.x-s.x)>c&&("top"==i&&s.y<o.y||"bottom"==i&&s.y>o.y)?u.push({x:o.x,y:s.y}):Math.abs(o.x-s.x)<=c||(s.x<a.left||s.x>a.right)&&s.y!=o.y?(d="top"==i?a.top-c:a.bottom+c,u.push({x:o.x,y:d}),u.push({x:s.x,y:d})):(d="top"==i?a.top-c:a.bottom+c,h=s.x<o.x?a.left-c:a.right+c,u.push({x:o.x,y:d}),u.push({x:h,y:d}),u.push({x:h,y:s.y})):"left"==i&&s.x<o.x&&s.x>o.x-c||"right"==i&&s.x>o.x&&s.x<o.x+c?(h="left"==i?a.left-c:a.right+c,u.push({x:h,y:o.y}),u.push({x:h,y:o.y+(s.y-o.y)/2}),u.push({x:s.x,y:o.y+(s.y-o.y)/2})):Math.abs(o.y-s.y)>c&&("left"==i&&s.x<o.x||"right"==i&&s.x>o.x)?u.push({x:s.x,y:o.y}):Math.abs(o.y-s.y)<=c||(s.y<a.top||s.y>a.bottom)&&s.x!=o.x?(h="left"==i?a.left-c:a.right+c,u.push({x:h,y:o.y}),u.push({x:h,y:s.y})):(d=s.y<o.y?a.top-c:a.bottom+c,h="left"==i?a.left-c:a.right+c,u.push({x:h,y:o.y}),u.push({x:h,y:d}),u.push({x:s.x,y:d}))),u.push(s),r&&u.reverse(),t._startPoint=u[0],t._endPoint=u[u.length-1],t.points=u,t.direction&&("left"==t.direction||"right"==t.direction?(t.length=t._length=Math.abs(t._startPoint.x-t._endPoint.x),t._direction=t._startPoint.x<t._endPoint.x?t.direction="right":t.direction="left"):(t.length=t._length=Math.abs(t._startPoint.y-t._endPoint.y),t._direction=t._startPoint.y<t._endPoint.y?t.direction="bottom":t.direction="top"))},_constructSegements:function(e,t,i,a,n,o,s,r){var l,d,h,c;for("right"===r&&("left"===n?l=this._rightToLeft(e,t,i,a,o,s,!1):"right"===n?l=this._rightToRight(e,i,a,o,s):"top"===n?l=this._rightToTop(e,i,a,o,s,!1):"bottom"===n&&(l=this._rightToBottom(e,i,a,o,s,!1))),"left"===r&&("right"===n&&(l=this._rightToLeft(e,t,o,s,i,a,!0),d=!0),"left"===n&&(l=this._leftToLeft(e,i,a,o,s)),"top"===n&&(l=this._leftToTop(e,i,a,o,s,!1)),"bottom"===n&&(l=this._leftToBottom(e,i,a,o,s,!1))),"top"===r&&("left"===n&&(l=this._leftToTop(e,o,s,i,a,!0),d=!0),"right"===n&&(l=this._rightToTop(e,o,s,i,a,!0),d=!0),"top"===n&&(l=this._topToTop(e,i,a,o,s)),"bottom"===n&&(l=this._topToBottom(e,t,i,a,o,s,!1))),"bottom"===r&&("left"===n&&(l=this._leftToBottom(e,o,s,i,a,!0),d=!0),"right"===n&&(l=this._rightToBottom(e,o,s,i,a,!0),d=!0),"top"===n&&(l=this._topToBottom(e,t,o,s,i,a,!0),d=!0),"bottom"===n&&(l=this._bottomToBottom(e,i,a,o,s))),d&&l.reverse(),h=l[l.length-1],c=l[l.length-2];l.length>2&&h.x==c.x&&h.y==c.y;)l.splice(l.length-1,1),h=l[l.length-1],c=l[l.length-2];for(h=l[0],c=l[1];l.length>2&&h.x==c.x&&h.y==c.y;)l.splice(0,1),h=l[0],c=l[1];t._startPoint=l[0],t._endPoint=l[l.length-1],t.points=l},_updateIntermediateSegments:function(e){var i,a=e.segments[0]._endPoint,n=e.segments[0];n.points.length;e.segments[1]&&(i=e.segments[1],i._startPoint=a,"orthogonal"!=i.type||!i.length&&0!==i.length?"orthogonal"==i.type&&null===i.length?(e.sourcePort&&n.points.length>2&&("left"==i._direction||"right"==i._direction?n.points[n.points.length-1].y==n.points[n.points.length-2].y&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1]):n.points[n.points.length-1].x==n.points[n.points.length-2].x&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1])),i._startPoint=i.points[0]=e.segments[0]._endPoint,this._addOrthogonalPoints(e.segments[1],e.segments[0],null,e.sourcePoint,e.targetPoint)):(i._startPoint=i.points[0]=e.segments[0]._endPoint,"bezier"==i.type&&this._updateBezierPoints(i)):("left"==i.direction||"right"==i.direction?(e.segments[2]&&(e.segments[2].length||0===e.segments[2].length)&&("top"==e.segments[2].direction?e.segments[2].length+=i._startPoint.y-i._endPoint.y:e.segments[2].length-=i._startPoint.y-i._endPoint.y,e.segments[2].length<0&&(e.segments[2].length*=-1,e.segments[2].direction=e.segments[2]._direction="bottom"==e.segments[2]._direction?"top":"bottom"),e.segments[2]._length=e.segments[2].length),i._endPoint.y=i._startPoint.y):(e.segments[2]&&(e.segments[2].length||0===e.segments[2].length)&&("left"==e.segments[2].direction?e.segments[2].length+=i._startPoint.x-i._endPoint.x:e.segments[2].length-=i._startPoint.x-i._endPoint.x,e.segments[2].length<0&&(e.segments[2].length*=-1,e.segments[2].direction=e.segments[2]._direction="right"==e.segments[2]._direction?"left":"right"),e.segments[2]._length=e.segments[2].length),i._endPoint.x=i._startPoint.x),e.sourcePort&&n.points.length>2&&("left"==i.direction||"right"==i.direction?n.points[n.points.length-1].y==n.points[n.points.length-2].y&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1],2==i.points.length&&(i._endPoint.y=i._startPoint.y)):n.points[n.points.length-1].x==n.points[n.points.length-2].x&&(i._startPoint=i.points[0]=n.points[n.points.length-2],n.points.splice(n.points.length-1,1),n._endPoint=n.points[n.points.length-1],2==i.points.length&&(i._endPoint.x=i._startPoint.x))),(i.length||0===i.length)&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,n,e.segments[2],e.sourcePoint,e.targetPoint),e.segments[2]&&this._addOrthogonalPoints(e.segments[2],e.segments[1],e.segments[3],e.sourcePoint,e.targetPoint)))},_updatePreviousSegment:function(e){var i,a,n,o=e.segments[e.segments.length-2],s=e.segments[e.segments.length-1];o&&("orthogonal"==o.type&&s.points.length>2&&(i=!1,a=2==o.points.length?o.direction:t.datavisualization.Diagram.Util._getBezierDirection(o.points[o.points.length-2],o.points[o.points.length-1]),"left"==a||"right"==a?s.points[0].y==s.points[1].y&&(i=!0,n=s.points[1].x-s.points[0].x,s.points.splice(0,1),s._startPoint=s.points[0],o._endPoint=s.points[0]):s.points[0].x==s.points[1].x&&(i=!0,s.points.splice(0,1),s._startPoint=s.points[0],o._endPoint=s.points[0])),o._endPoint=s._startPoint,o.points[o.points.length-1]=s._startPoint,"orthogonal"==o.type&&i?(o._length=o.length=t.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint),o._length>0&&(o._direction=o.direction=this._getBezierDirection(o._startPoint,o._endPoint)),(e.segments.length>2||!e.sourcePort)&&this._addOrthogonalPoints(o,e.segments[e.segments.length-3],s,e.sourcePoint,e.targetPoint)):o.point=s._startPoint)},_initConnectionEnds:function(e,i){var a,n,o,s,r;if(e.segments&&e.segments[0]&&"orthogonal"==e.segments[0].type&&e.segments[0].length){if(e.sourceNode&&(o=i.nameTable[e.sourceNode]))if(n=t.datavisualization.Diagram.Util.bounds(o,!0),e.sourcePort)a=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[e.sourceNode],e.sourcePort),e.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(a,n);else switch(r=e.segments[0],r.direction){case"left":e.sourcePoint=n.middleLeft;break;case"right":e.sourcePoint=n.middleRight;break;case"top":e.sourcePoint=n.topCenter;break;case"bottom":e.sourcePoint=n.bottomCenter}if(e.targetNode&&(s=i.nameTable[e.targetNode]))if(n=t.datavisualization.Diagram.Util.bounds(s,!0),e.targetPort)a=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[e.targetNode],e.targetPort),e.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(a,n);else switch(r=e.segments[0],r.direction){case"left":e.targetPoint=n.middleLeft;break;case"right":e.targetPoint=n.middleRight;break;case"top":e.targetPoint=n.topCenter;break;case"bottom":e.targetPoint=n.bottomCenter}}else e.sourceNode&&(n=t.datavisualization.Diagram.Util.bounds(i.nameTable[e.sourceNode],!0),e.sourcePort?(a=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[e.sourceNode],e.sourcePort),e.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(a,n)):e.sourcePoint=n.center),e.targetNode&&(n=t.datavisualization.Diagram.Util.bounds(i.nameTable[e.targetNode],!0),e.targetPort?(a=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[e.targetNode],e.targetPort),e.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(a,n)):e.targetPoint=n.center)},_swapDirection:function(e,t){var i,a,n=e%360;return 0>n&&(n+=360),n>315||45>n?i=t:135>n?(a={left:"top",top:"right",right:"bottom",bottom:"left"},i=a[t]):225>n?(a={left:"right",top:"bottom",right:"left",bottom:"top"},i=a[t]):(a={left:"bottom",top:"left",right:"top",bottom:"right"},i=a[t]),i},_getEllipseIntersectCoords:function(e,i,a,n,o){var s,r,l,d,h,c,u=[],g=e.connectorPadding;a&&(g+=o?a.targetPadding:a.sourcePadding),g||(g=0);var m=e.width/2,p=e.height/2,f=t.Matrix.identity();for(t.Matrix.rotate(f,e.rotateAngle,e.offsetX,e.offsetY),s="M "+(e.offsetX-e.width*e.pivot.x-g)+", "+e.offsetY+" A "+m+" "+p+" 0 0 1 "+(e.offsetX+e.width*(1-e.pivot.x)+g)+", "+e.offsetY+" A "+m+" "+p+" 0 0 1 "+(e.offsetX-e.width*e.pivot.x-g)+", "+e.offsetY+"z",r=document.createElementNS("http://www.w3.org/2000/svg","path"),r.setAttributeNS(null,"d",s),l=r.getTotalLength(),d=[],h=0;l>h;h+=3)c=r.getPointAtLength(h),0!=e.rotateAngle&&(c=t.Matrix.transform(f,c)),d[d.length]=c;return d[d.length-1]!=r.getPointAtLength(l)&&(d[d.length]=r.getPointAtLength(l)),u=d,this._getIntersectionPoints(i,u,!0,n)},_rightToLeft:function(e,i,a,n,o,s,r){var l,d,h,c,u,g=[];return g.push(s),h=e._srcDecoratorSize,c=e._tarDecoratorSize,r&&(c=e._srcDecoratorSize,h=e._tarDecoratorSize),0==o.width&&(h=0),0==a.width&&(c=0),u=h+c,n.x>s.x?s.y!=n.y&&(s.x>a.left?(l=o.right+h,d=s.y,g.push(t.datavisualization.Diagram.Point(l,d)),d=n.y>o.top?n.y:a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d)),n.y<=o.top&&(l=a.right+c,g.push(t.datavisualization.Diagram.Point(l,d)),d=a.top-c,g.push(t.datavisualization.Diagram.Point(l,d)),l=a.left-c,g.push(t.datavisualization.Diagram.Point(l,d)),d=n.y,g.push(t.datavisualization.Diagram.Point(l,d)))):(l=i.direction||void 0==i.length?a.left-o.right>0?o.right+(a.left-o.right)/2:o.right+h:o.right+i.length,d=s.y,g.push(t.datavisualization.Diagram.Point(l,d)),d=n.y,g.push(t.datavisualization.Diagram.Point(l,d)))):(Math.abs(a.top-o.bottom)<u||Math.abs(a.bottom-o.top)<u?s.x>a.right?(l=s.x+h,d=s.y):(l=a.right+c,d=s.y):(l=o.right+h,d=s.y),g.push(t.datavisualization.Diagram.Point(l,d)),a.top-o.bottom>=u?(d=a.top-c,g.push(t.datavisualization.Diagram.Point(l,d))):s.y>n.y?(d=o.top-a.bottom<u?a.left>o.right?a.bottom+(o.top-a.bottom)/2:Math.min(a.top-c,o.top-h):a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d))):(d=a.left>o.right?a.bottom+(o.top-a.bottom)/2:Math.max(a.bottom+c,o.bottom+h),g.push(t.datavisualization.Diagram.Point(l,d))),l=a.left-c,g.push(t.datavisualization.Diagram.Point(l,d)),d=n.y,g.push(t.datavisualization.Diagram.Point(l,d))),g.push(n),g},_rightToRight:function(e,i,a,n,o){var s,r,l,d,h=[];return h.push(o),r=o.y,l=e._srcDecoratorSize,d=e._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),i.right>=n.left?o.y>=i.top-d&&o.y<=i.bottom+d?(s=o.x+l,h.push(t.datavisualization.Diagram.Point(s,r)),o.y>=i.center.y?(r=o.x>i.left&&o.y>a.y?i.bottom+d:i.top-d,h.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(t.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,h.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(t.datavisualization.Diagram.Point(s,r)))):i.right<n.right?(s=n.right+l,h.push(t.datavisualization.Diagram.Point(s,r))):(s=a.x+d,h.push(t.datavisualization.Diagram.Point(s,r))):(s=o.x+l,h.push(t.datavisualization.Diagram.Point(s,r)),a.y>=n.top-l&&a.y<=n.bottom+l&&(a.y<=n.center.y?(r=n.top-l,h.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(t.datavisualization.Diagram.Point(s,r))):(r=n.bottom+l,h.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,h.push(t.datavisualization.Diagram.Point(s,r))))),h.push(t.datavisualization.Diagram.Point(s,a.y)),h.push(a),h},_rightToTop:function(e,i,a,n,o,s){var r,l,d,h,c,u=[];return u.push(o),l=o.y,d=e._srcDecoratorSize,h=e._tarDecoratorSize,s&&(h=e._srcDecoratorSize,d=e._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),c=d+h,a.x>=o.x+d?o.y+d>=a.y&&0!==i.height&&(r=i.left<=n.right?i.right+h:i.left-n.right>c?n.right+d:n.right+(i.left-n.right)/2,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.top-h,u.push(t.datavisualization.Diagram.Point(r,l))):n.bottom+d>i.top-h?(r=o.x+d<=i.right?i.right+h:n.right+d,u.push(t.datavisualization.Diagram.Point(r,l)),l=n.top>=i.top?0!==i.height?i.top-h:a.y:n.top>=i.top-h?i.top-h-d:n.top-d,u.push(t.datavisualization.Diagram.Point(r,l))):(r=o.x+d,u.push(t.datavisualization.Diagram.Point(r,l)),i.top-n.bottom<c&&0!==i.height?n.left-i.right>=c?(l=n.bottom+d,u.push(t.datavisualization.Diagram.Point(r,l)),r=n.left-d,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.top-h,u.push(t.datavisualization.Diagram.Point(r,l))):(l=i.top-(i.top-n.bottom)/2,u.push(t.datavisualization.Diagram.Point(r,l))):(l=0!==i.height?i.top-h:a.y,u.push(t.datavisualization.Diagram.Point(r,l)))),u.push(t.datavisualization.Diagram.Point(a.x,l)),u.push(a),u},_rightToBottom:function(e,i,a,n,o,s){var r,l,d,h,c,u=[];return u.push(o),l=o.y,d=e._srcDecoratorSize,h=e._tarDecoratorSize,s&&(h=e._srcDecoratorSize,d=e._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),c=d+h,a.x>=o.x?o.y<=i.bottom+h?i.left>n.right+d?(r=o.x+d,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l))):(r=i.right+h,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l))):n.right+d>a.x?(r=o.x+d,u.push(t.datavisualization.Diagram.Point(r,l)),l=n.top-i.bottom>c?i.bottom+h:i.bottom+(n.top-i.bottom)/2,u.push(t.datavisualization.Diagram.Point(r,l))):l=o.y:o.y<=i.bottom?(r=n.right+d>i.right?n.right+d:i.right+h,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,l<=n.bottom+d&&(l=n.bottom+d),u.push(t.datavisualization.Diagram.Point(r,l))):i.bottom+h<n.top-d?(r=n.right+d,u.push(t.datavisualization.Diagram.Point(r,l)),l=n.top-i.bottom<c?i.bottom+(n.top-i.bottom)/2:i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l))):(r=n.right+d,u.push(t.datavisualization.Diagram.Point(r,l)),l=n.bottom+d,u.push(t.datavisualization.Diagram.Point(r,l))),u.push(t.datavisualization.Diagram.Point(a.x,l)),u.push(a),u},_leftToLeft:function(e,i,a,n,o){var s,r,l,d,h,c=[];return c.push(o),r=o.y,l=e._srcDecoratorSize,d=e._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x-d>=o.x-l?(s=n.left-l,c.push(t.datavisualization.Diagram.Point(s,r)),o.y>a.y?a.y+d>=n.top?(r=n.top-l,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.left-n.right>h?i.left-d:n.right+(i.left-n.right)/2,c.push(t.datavisualization.Diagram.Point(s,r))):(r=a.y,c.push(t.datavisualization.Diagram.Point(s,r)),s=a.x):n.bottom+l<a.y?(r=a.y,c.push(t.datavisualization.Diagram.Point(s,r)),s=a.x):(r=n.bottom+l,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.left-n.right>h?i.left-d:n.right+(i.left-n.right)/2,c.push(t.datavisualization.Diagram.Point(s,r)))):(a.y>o.y?o.y>i.top-d&&(s=n.left-i.right<h?i.right+(n.left-i.right)/2:n.left-l,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.top-d,c.push(t.datavisualization.Diagram.Point(s,r))):i.bottom+d>=o.y&&(s=n.left-i.right<h?i.right+(n.left-i.right)/2:n.left-l,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.left-d,c.push(t.datavisualization.Diagram.Point(s,r))),s=i.left-d,c.push(t.datavisualization.Diagram.Point(s,r))),c.push(t.datavisualization.Diagram.Point(s,a.y)),c.push(a),c},_leftToTop:function(e,i,a,n,o,s){var r,l,d,h,c=[];return c.push(o),l=o.y,d=e._srcDecoratorSize,h=e._tarDecoratorSize,s&&(h=e._srcDecoratorSize,d=e._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),o.x<=a.x?(r=o.y>a.y&&i.left<=n.left?i.left-h:n.left-d,c.push(t.datavisualization.Diagram.Point(r,l)),l=n.bottom<=i.top?n.bottom+d<i.top-h?0!==i.height?i.top-h:a.y:a.x<n.right?n.bottom+(i.top-n.bottom)/2:n.top-d:n.top-d>=i.top-h?0!==i.height?i.top-h:a.y:n.top-d,c.push(t.datavisualization.Diagram.Point(r,l))):a.y<=o.y+d&&(r=n.left-d>i.right+h?n.left-d:i.right+h>=n.left-d?i.left-h:i.right+(n.left-i.right)/2,c.push(t.datavisualization.Diagram.Point(r,l)),l=i.top-h,c.push(t.datavisualization.Diagram.Point(r,l))),
c.push(t.datavisualization.Diagram.Point(a.x,l)),c.push(a),c},_leftToBottom:function(e,i,a,n,o,s){var r,l,d,h,c,u=[];return u.push(o),l=o.y,d=e._srcDecoratorSize,h=e._tarDecoratorSize,s&&(h=e._srcDecoratorSize,d=e._tarDecoratorSize),0==n.width&&(d=0),0==i.width&&(h=0),c=d+h,o.x-d<=a.x?(r=i.left<=o.x&&o.y<=i.top?i.left-h:n.left-d,u.push(t.datavisualization.Diagram.Point(r,l)),i.bottom+h<n.top-d?(l=n.top-i.bottom<c?i.bottom+(n.top-i.bottom)/2:i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l))):(l=i.bottom<n.bottom?n.bottom+d:i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l)))):o.y-d>a.y||(r=i.right>=n.left?i.left-h:n.left-i.right<c?n.left-(n.left-i.right)/2:n.left-d,u.push(t.datavisualization.Diagram.Point(r,l)),l=i.bottom+h,u.push(t.datavisualization.Diagram.Point(r,l))),u.push(t.datavisualization.Diagram.Point(a.x,l)),u.push(a),u},_topToTop:function(e,i,a,n,o){var s,r,l,d,h,c=[];return c.push(o),s=o.x,l=e._srcDecoratorSize,d=e._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x>=o.x?a.y-d>=o.y-l?(r=n.top-l,c.push(t.datavisualization.Diagram.Point(s,r)),a.x<=n.right&&(s=n.right+l,c.push(t.datavisualization.Diagram.Point(s,r)),r=0!==i.height?i.top-n.bottom>h?i.top-d:n.bottom+(i.top-n.bottom)/2:a.y,c.push(t.datavisualization.Diagram.Point(s,r)))):i.left<=o.x?(r=n.top-i.bottom>h?n.top-l:i.bottom+(n.top-i.bottom)/2,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.left-d,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.top-d,c.push(t.datavisualization.Diagram.Point(s,r))):(r=0!==i.height?i.top-d:a.y,c.push(t.datavisualization.Diagram.Point(s,r))):a.y-d>=o.y-l?(r=n.top-l,c.push(t.datavisualization.Diagram.Point(s,r)),a.x>=n.left&&(s=n.left-l,c.push(t.datavisualization.Diagram.Point(s,r)),r=0!==i.height?i.top-n.bottom>h?i.top-d:n.bottom+(i.top-n.bottom)/2:a.y,c.push(t.datavisualization.Diagram.Point(s,r)))):i.right>=o.x?(r=n.top-i.bottom>h?n.top-l:i.bottom+(n.top-i.bottom)/2,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.top-d,c.push(t.datavisualization.Diagram.Point(s,r))):(r=0!==i.height?i.top-d:a.y,c.push(t.datavisualization.Diagram.Point(s,r))),s=a.x,c.push(t.datavisualization.Diagram.Point(s,r)),c.push(a),c},_topToBottom:function(e,i,a,n,o,s,r){var l,d,h,c,u,g=[];return g.push(s),l=s.x,h=e._srcDecoratorSize,c=e._tarDecoratorSize,r&&(c=e._srcDecoratorSize,h=e._tarDecoratorSize),0==o.width&&(h=0),0==a.width&&(c=0),u=h+c,n.x>s.x?(o.top>=a.bottom?o.top-a.bottom>0?(d=void 0==i.length||i.direction?o.top-a.bottom>0?a.bottom+(o.top-a.bottom)/2:a.bottom+c:a.bottom+i.length,g.push(t.datavisualization.Diagram.Point(l,d))):(d=o.top-h,g.push(t.datavisualization.Diagram.Point(l,d)),l=a.left-o.right>=u?o.right+h:o.right+(a.left-o.right)/2,g.push(t.datavisualization.Diagram.Point(l,d)),d=a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d))):(d=a.top<o.top?a.left>=o.right+h?o.top-h:a.top-c:o.top-h,g.push(t.datavisualization.Diagram.Point(l,d)),l=a.left>=o.right+h?o.right+h:a.right+c,g.push(t.datavisualization.Diagram.Point(l,d)),d=a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d))),g.push(t.datavisualization.Diagram.Point(n.x,d))):n.x<s.x&&(o.top>=a.bottom?o.top-a.bottom>0?(d=void 0==i.length||i.direction?o.top-a.bottom>0?a.bottom+(o.top-a.bottom)/2:a.bottom+c:a.bottom+i.length,g.push(t.datavisualization.Diagram.Point(l,d))):(d=o.top-h,g.push(t.datavisualization.Diagram.Point(l,d)),l=o.left-a.right>=u?o.left-h:a.right+(o.left-a.right)/2,g.push(t.datavisualization.Diagram.Point(l,d)),d=a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d))):(d=o.left-h>=a.right+c?o.top-h:o.top-h,g.push(t.datavisualization.Diagram.Point(l,d)),l=o.left>=a.right+c||o.right+h<a.right+c?a.right+c:o.right+h,g.push(t.datavisualization.Diagram.Point(l,d)),d=o.left>=a.right+c?a.bottom+c:a.bottom<=o.bottom?o.bottom+h:a.bottom+c,g.push(t.datavisualization.Diagram.Point(l,d))),g.push(t.datavisualization.Diagram.Point(n.x,d))),g.push(n),g},_bottomToBottom:function(e,i,a,n,o){var s,r,l,d,h,c=[];return c.push(o),s=o.x,l=e._srcDecoratorSize,d=e._tarDecoratorSize,0==n.width&&(l=0),0==i.width&&(d=0),h=l+d,a.x>=o.x?n.bottom+l>=i.bottom+l?(r=n.bottom+l,c.push(t.datavisualization.Diagram.Point(s,r)),a.x<n.right&&(s=n.right+l,c.push(t.datavisualization.Diagram.Point(s,r)),r=n.top-l>=i.bottom+d?n.top-i.bottom>=h?i.bottom+d:i.bottom+(n.top-i.bottom)/2:i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r)))):o.x>i.left?(r=i.bottom-n.bottom>=h?n.bottom+l:n.bottom+(i.bottom-n.bottom)/2,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.left-d,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r))):n.bottom+l>=i.bottom+l?(r=n.bottom+l,c.push(t.datavisualization.Diagram.Point(s,r)),a.x>n.left&&(s=n.left-l,c.push(t.datavisualization.Diagram.Point(s,r)),r=n.top-l>=i.bottom+d?n.top-i.bottom>=h?i.bottom+d:i.bottom+(n.top-i.bottom)/2:i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r)))):o.x<i.right?(r=i.bottom-n.bottom>=h?n.bottom+l:n.bottom+(i.bottom-n.bottom)/2,c.push(t.datavisualization.Diagram.Point(s,r)),s=i.right+d,c.push(t.datavisualization.Diagram.Point(s,r)),r=i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r))):(r=i.bottom+d,c.push(t.datavisualization.Diagram.Point(s,r))),c.push(t.datavisualization.Diagram.Point(a.x,r)),c.push(a),c},_addOrthogonalPoints:function(e,i,a,n,o,s){var r,l,d,h,c,u=[],g=i?i._endPoint:n;u.push(g),e._direction||(e._direction=this._getOrthoDirection(g,o,i)),"auto"!==e._direction||i||a||(e._direction=this._getBezierDirection(g,o));var m=s||0==s?s:this._directionToAngle(e._direction||this._getBezierDirection(g,o)),h=e._direction;if("left"==h||"right"==h||"top"==h||"bottom"==h)m={right:0,left:180,top:270,bottom:90,auto:90}[h];else switch(h){case"straight":m=0;break;case"clockWise90":m+=90;break;case"opposite":m+=180;break;case"antiClockWise90":m+=270}if((e.length||0==e.length)&&e.direction)d=t.datavisualization.Diagram.Geometry.transform(g,m||0,e._length),d.x=Math.round(100*d.x)/100,d.y=Math.round(100*d.y)/100,u.push(d),e._endPoint=d,a&&(a._startPoint=e._endPoint,a.points&&(a.points[0]=e._endPoint,"bezier"==a.type&&this._updateBezierPoints(a)));else{if(g.x!=o.x&&g.y!=o.y||i&&i._startPoint.x==o.x){var p=20,f=o.x-(d?d.x:g.x),v=o.y-(d?d.y:g.y);switch(f=Math.abs(f)<=1e-4?0:f,v=Math.abs(v)<=1e-4?0:v,m){case 0:if(o.x<g.x)break;l=Math.abs(g.x-o.x)<30;break;case 180:if(o.x>g.x)break;l=Math.abs(g.x-o.x)<30;break;case 90:if(o.y<g.y)break;l=Math.abs(g.y-o.y)<30;break;case 270:if(o.y>g.y)break;l=Math.abs(g.y-o.y)<30}i?r=i&&i._startPoint.x==o.x?3:0==f||0==v?2:3:(l?(p=90==m||270==m?Math.abs(g.y-o.y):Math.abs(g.x-o.x),r=2,10>p&&(p+=20,r=3)):r=3,(2!=r||Math.abs(v)>1&&Math.abs(f)>1)&&(d=t.datavisualization.Diagram.Geometry.transform(g,m,p))),3==r&&(h="auto"==e._direction?i?"left"==i._direction||"right"==i.direction?"left":"top":"bottom":e._direction,"left"==h||"right"==h||0==v?(v=v>0?v:-v,c=t.datavisualization.Diagram.Geometry.transform(d||g,90,o.y-(d?d.y:g.y))):(f=f>0?f:-f,c=t.datavisualization.Diagram.Geometry.transform(d||g,0,o.x-(d?d.x:g.x)))),d&&(d.x=Math.round(100*d.x)/100,d.y=Math.round(100*d.y)/100,u.push(d)),c&&(c.x=Math.round(100*c.x)/100,c.y=Math.round(100*c.y)/100,u.push(c))}e._direction=this._getBezierDirection(u[u.length-1],o),u.push(o),e._endPoint=o,a&&(a._startPoint=e._endPoint,a.points||(a.points=[]),a.points[0]=e._endPoint,"bezier"==a.type&&this._updateBezierPoints(a))}return e.points=u,m},_getOrthoDirection:function(e,t,i){if(i){var a=t;return Math.abs(a.x-e.x)>Math.abs(a.y-e.y)&&i&&("left"==i._direction||"right"==i._direction)?e.x<a.x?"right":"left":e.y<a.y?"bottom":"top"}return e.y<t.y?"bottom":e.y>t.y?"top":e.x<t.x?"right":e.x>t.x?"left":void 0},_directionToAngle:function(e){return{right:0,left:180,top:270,bottom:90,auto:90}[e]},_resetOrthogonalPoints:function(e){var t,i=[];i.push(e.sourcePoint),i.push(e.targetPoint),e.points=[],e.sourcePoint=i[0],e.points.push(i[0]),t=this._constructOrthogonalPoints(i[0],i[1]),e.points.push(t[0]),e.points.push(t[1]),e.targetPoint=i[1],e.points.push(i[1])},_updateBezierPoints:function(e,i,a,n,o,s,r){var l,d,h,c,u,g={right:0,left:180,top:270,bottom:90};(e.vector1||e.vector2)&&(e.vector1&&(e._point1=t.datavisualization.Diagram.Geometry.transform(e._startPoint,e.vector1.angle,e.vector1.distance)),e.vector2&&(e._point2=t.datavisualization.Diagram.Geometry.transform(e._endPoint,e.vector2.angle,e.vector2.distance))),(null!=e.point1||e.vector1)&&(null!=e.point2||e.vector2)||(d=e._endPoint,h=e._startPoint,s?(l=r,h=this._getPortPosition(s,l),0!==o.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,o.rotateAngle,o.offsetX,o.offsetY),h=t.Matrix.transform(u,h)),c=this._getDirection(l,h,!0)):c=this._getBezierDirection(h,d),e.vector1||(e._point1=e.point1||this._getBezierAdjPoint(g[c],e._startPoint,e._endPoint)),a?(l=n,d=this._getPortPosition(a,l),0!==i.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,i.rotateAngle,i.offsetX,i.offsetY),d=t.Matrix.transform(u,d)),c=this._getDirection(l,d,!0)):c=this._getBezierDirection(d,h),e.vector2||(e._point2=e.point2||this._getBezierAdjPoint(g[c],e._endPoint,e._startPoint)))},_getBezierDirection:function(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?e.x<t.x?"right":"left":e.y<t.y?"bottom":"top"},_findDocAngle:function(e,t){var i={x:t.x,y:e.y},a=(this.findLength(e,i),this.findLength(i,t)),n=this.findLength(t,e),o=Math.asin(a/n);return o=isNaN(o)?0:o,o=180*o/Math.PI,e.x<t.x?e.y<t.y||(o=360-o):o=e.y<t.y?180-o:180+o,o},_getDirection:function(e,i,a){var n,o,s,r,l,d,h,c,u=e.center;return a?(h=e.points,c=a?45:180/(2+2/(e.height/e.width)),n=c,o=180-c,s=o+2*c,r=360-c,d=t.datavisualization.Diagram.Geometry.findAngle(i,u),l=d>n&&o>d?"top":d>o&&s>d?"right":d>s&&r>d?"bottom":"left"):(d=this._findDocAngle(u,i),n=this._findDocAngle(u,e.bottomRight),o=this._findDocAngle(u,e.bottomLeft),s=this._findDocAngle(u,e.topLeft),r=this._findDocAngle(u,e.topRight),d>s&&r>d?l="top":d>=n&&o>d?l="bottom":d>=o&&s>=d?l="left":(d>=r||n>d)&&(l="right")),l},_getBezierAdjPoint:function(e,i,a){var n=60,o=t.datavisualization.Diagram.Point(0,0),s=e>45&&135>e?"Bottom":e>135&&225>e?"Left":e>225&&315>e?"Top":"Right";switch(s){case"Right":n=Math.min(.45*Math.abs(i.x-a.x),n),o=t.datavisualization.Diagram.Point(i.x+n,i.y);break;case"Bottom":n=Math.min(.45*Math.abs(i.y-a.y),n),o=t.datavisualization.Diagram.Point(i.x,i.y+n);break;case"Left":n=Math.min(.45*Math.abs(i.x-a.x),n),o=t.datavisualization.Diagram.Point(i.x-n,i.y);break;case"Top":n=Math.min(.45*Math.abs(i.y-a.y),n),o=t.datavisualization.Diagram.Point(i.x,i.y-n)}return o},_setLineEndPoint:function(e,t,i){var a,n,o,s,r=e;t.x=Math.round(100*t.x)/100,t.y=Math.round(100*t.y)/100,i?(a=e.segments[e.segments.length-1],r.targetPoint=t,"orthogonal"!=a.type&&(a.point&&(a.point=t),a._point=t),a.points[a.points.length-1]=t,a._endPoint=t):(r.sourcePoint=t,n=e.segments[0],n.points[0]=t,n._startPoint=t,"orthogonal"!=n.type||e.sourcePort||e._staticLength||(n.length||0===n.length)&&n.direction&&2==n.points.length&&("left"==n._direction||"right"==n._direction?(n._endPoint.y=n._startPoint.y,o=Math.abs(n._startPoint.x-n._endPoint.x)):(n._endPoint.x=n._startPoint.x,o=Math.abs(n._startPoint.y-n._endPoint.y)),e.segments[0]._length=o,e.segments[0].length=e.segments[0]._length,e.segments[0].direction=e.segments[0]._direction)),s=i?e.segments[e.segments.length-1]:e.segments[0],"orthogonal"!==s.type||(i||e.sourcePort)&&(!i||e.targetPort)||e.sourceNode&&e.targetNode&&!(e.segments.length>1)?"bezier"===s.type&&this._updateBezierPoints(s):(s.points=[],this._addOrthogonalPoints(s,i?e.segments[e.segments.length-2]:null,i?null:e.segments[1],e.sourcePoint,e.targetPoint))},_setBezierPoint:function(e,i,a){"bezierpoint1"===a?e.vector1?(e.vector1={distance:t.datavisualization.Diagram.Geometry.distance(e._startPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(e._startPoint,i)},e._point1=i):e.point1=e._point1=i:e.vector2?(e.vector2={distance:t.datavisualization.Diagram.Geometry.distance(e._endPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(e._endPoint,i)},e._point2=i):e.point2=e._point2=i},_setPoints:function(e,t){e.sourcePoint=e.points[0]=t[0],e.targetPoint=e.points[e.points.length-1]=t[t.length-1],e.points=t,"bezier"===e.type&&(e.point1=t[2]||e.point1,e.point2=t[3]||e.point2,e.point1||(e._point1=e.point1),e.point2||(e._point2=e.point2),this._updateBezierPoints(e))},_updateConnectorSegments:function(e,i,a,n){for(var o,s=e.sourcePoint,r=0;r<e.segments.length;r++){var l=e.segments[r],d=e.segments[r-1],h=e.segments[r+1];l._startPoint=d?d._endPoint:s,0==r&&i||r==e.segments.length-1&&a||("orthogonal"==l.type?o=t.datavisualization.Diagram.Util._addOrthogonalPoints(l,d,h,e.sourcePoint,e.targetPoint,o):(o=t.datavisualization.Diagram.Geometry.findAngle(s,l._endPoint),"bezier"==l.type&&this._updateBezierPoints(l))),s=l._endPoint}n&&n._dock(e,n.nameTable)},_translateLine:function(e,i,a){for(var n,o,s=0;s<e.segments.length;s++){for(n=e.segments[s],o=0;o<n.points.length;o++)0==o?(n._startPoint=n.points[o]=t.datavisualization.Diagram.Geometry.translate(n.points[o],i,a),0==s&&(e.sourcePoint=n._startPoint)):o==n.points.length-1?(n._endPoint=n.points[o]=t.datavisualization.Diagram.Geometry.translate(n.points[o],i,a),s==e.segments.length-1&&(e.targetPoint=n._endPoint)):n.points[o]=t.datavisualization.Diagram.Geometry.translate(n.points[o],i,a);n.type===t.datavisualization.Diagram.Segments.Bezier?(n._point1=t.datavisualization.Diagram.Geometry.translate(n._point1,i,a),n._point2=t.datavisualization.Diagram.Geometry.translate(n._point2,i,a),n.point1&&(n.point1=n._point1),n.point2&&(n.point2=n._point2),n.point&&(n.point=n._endPoint),n._point=n._endPoint):"straight"==n.type&&(n.point&&(n.point=n._endPoint),n._point=n._endPoint)}},_adjustPoint:function(e,i,a,n){var o,s=a?{x:e.x,y:e.y}:{x:i.x,y:i.y};return e.x==i.x?e.y<i.y&&a||e.y>i.y&&!a?s.y+=n:s.y-=n:e.y==i.y?e.x<i.x&&a||e.x>i.x&&!a?s.x+=n:s.x-=n:a?(o=t.datavisualization.Diagram.Geometry.findAngle(e,i),s=t.datavisualization.Diagram.Geometry.transform(e,o,n)):(o=t.datavisualization.Diagram.Geometry.findAngle(i,e),s=t.datavisualization.Diagram.Geometry.transform(i,o,n)),s},_getIconPosition:function(e,i,a){var n,o,s,r,l,d,h;return e?(n=e.margin.left-e.margin.right,o=e.margin.top-e.margin.bottom,s=e.offset.x,r=e.offset.y,a?(l=t.datavisualization.Diagram.Point(i.width*s+n,i.height*r+o),(l.x>i.width||l.y>i.height)&&(l=t.datavisualization.Diagram.Point(i.width*s,i.height*r)),l):(d=i.center.x-i.width/2+i.width*s+n,h=i.center.y-i.height/2+i.height*r+o,t.datavisualization.Diagram.Point(d,h))):void 0},_rBounds:function(e,i){var a,n,o,s={};return e?(s.x=e.x,s.y=e.y,s.width=e.width,s.height=e.height,s.rotateAngle=i):s=t.datavisualization.Diagram.Rectangle(),s?(a={},s.x=Math.round(100*s.x)/100,s.y=Math.round(100*s.y)/100,s.width=Math.round(100*s.width)/100,s.height=Math.round(100*s.height)/100,a.width=s.width,a.height=s.height,a.x=a.left=s.x,a.right=s.x+s.width,a.y=a.top=s.y,a.bottom=s.y+s.height,a.center={x:s.x+s.width/2,y:s.y+s.height/2},a.topLeft={x:s.x,y:s.y},a.topCenter={x:s.x+s.width/2,y:s.y},a.topRight={x:s.x+s.width,y:s.y},a.middleLeft={x:s.x,y:s.y+s.height/2},a.middleRight={x:s.x+s.width,y:s.y+s.height/2},a.bottomLeft={x:s.x,y:s.y+s.height},a.bottomCenter={x:s.x+s.width/2,y:s.y+s.height},a.bottomRight={x:s.x+s.width,y:s.y+s.height},s&&s.rotateAngle&&(n=t.Matrix.identity(),t.Matrix.rotate(n,s.rotateAngle,s.x+s.width/2,s.y+s.height/2),a.topLeft=t.Matrix.transform(n,a.topLeft),a.topCenter=t.Matrix.transform(n,a.topCenter),a.topRight=t.Matrix.transform(n,a.topRight),a.middleLeft=t.Matrix.transform(n,a.middleLeft),a.middleRight=t.Matrix.transform(n,a.middleRight),a.bottomLeft=t.Matrix.transform(n,a.bottomLeft),a.bottomCenter=t.Matrix.transform(n,a.bottomCenter),a.bottomRight=t.Matrix.transform(n,a.bottomRight),o=t.datavisualization.Diagram.Geometry.rect([a.topLeft,a.topRight,a.bottomRight,a.bottomLeft]),a.x=a.left=o.x,a.y=a.top=o.y,a.right=o.x+o.width,a.bottom=o.y+o.height,a.center=t.datavisualization.Diagram.Point(o.x+o.width/2,o.y+o.height/2),a.width=-a.topLeft.x+a.right,a.height=-a.topRight.y+a.bottom),a.points=[a.topLeft,a.topRight,a.bottomRight,a.bottomLeft],a):s},_getLabelPosition:function(e,i,a,n,o,s){var r,l,d,h;return s&&(r=s.getBBox(),l=this._rBounds(r,e.rotateAngle)),d=i.width*(a?a.x:e.offset.x),h=i.height*(a?a.y:e.offset.y),"left"==e.horizontalAlignment?d+=e.margin.left:"right"==e.horizontalAlignment?d-=e.margin.right:d+=e.margin.left-e.margin.right+(o?-((l?l.width:i.width)/2):0),"top"==e.verticalAlignment?h+=e.margin.top:"bottom"==e.verticalAlignment?h-=e.margin.bottom:h+=e.margin.top-e.margin.bottom+(n?e.fontSize/2:0),t.datavisualization.Diagram.Point(d,h)},_getPortPosition:function(e,i,a){var n,o,s,r;return e?(n=(e.margin.left?e.margin.left:0)+(e.margin.right?e.margin.right:0),o=(e.margin.top?e.margin.top:0)+(e.margin.bottom?e.margin.bottom:0),a?t.datavisualization.Diagram.Point(i.width*e.offset.x+n,i.height*e.offset.y+o):(s=i.center.x-i.width/2+i.width*e.offset.x+n,r=i.center.y-i.height/2+i.height*e.offset.y+o,t.datavisualization.Diagram.Point(s,r))):void 0},_translate:function(e,i,a,n,o,s){var r,l,d;if(e.segments)t.datavisualization.Diagram.Util._translateLine(e,i,a,e);else if(e.offsetX+=i,e.offsetY+=a,"group"===e._type&&!o){for(r=s._getChildren(e.children),d=0;d<r.length;d++)l=n[r[d]],this._translate(l,i,a,n,null,s),l.parent&&l.parent!=e.name&&"pseudoGroup"!=e.type&&t.datavisualization.Diagram.Util._updateGroupBounds(n[l.parent],s);"group"!=e._type&&e.container&&t.datavisualization.Diagram.Util._updateGroupBounds(e,s)}},scale:function(e,i,a,n,o,s,r,l,d){var h,c,u,g,m,p,f,v,_;if(e.container)switch(e.container.type){case"canvas":p={},_=t.Matrix.identity(),t.Matrix.rotate(_,-e.rotateAngle,n.x,n.y),t.Matrix.scale(_,i,a,n.x,n.y),t.Matrix.rotate(_,e.rotateAngle,n.x,n.y),y=t.Matrix.transform(_,t.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width*i,x=e.height*a,r&&(e.minHeight=x,e.minWidth=b),1!=l?p=d._getMinMaxSize(e,b,x):(p.width=b,p.height=x),p&&p.width>1&&(f=e.offsetX-e.width/2,e.width=p.width,e.offsetX=f+e.width/2),p&&p.height>1&&(v=e.offsetY-e.height/2,e.height=p.height,e.offsetY=v+e.height/2);break;case"stack":_=t.Matrix.identity(),t.Matrix.rotate(_,-e.rotateAngle,n.x,n.y),t.Matrix.scale(_,i,a,n.x,n.y),t.Matrix.rotate(_,e.rotateAngle,n.x,n.y),y=t.Matrix.transform(_,t.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width*i-(e.marginLeft+e.marginRight),x=e.height*a-(e.marginTop+e.marginBottom),p=d._getMinMaxSize(e,b,x),p.width>1&&(f=e.offsetX-e.width/2,e.width=p.width-e.marginLeft,e.offsetX=f+e.width/2+e.marginLeft),p.height>1&&(v=e.offsetY-e.height/2,e.height=p.height-e.marginTop,e.offsetY=v+e.height/2+e.marginTop),t.datavisualization.Diagram.SvgContext._alignOnStack(e,d)}else if(_=t.Matrix.identity(),e.segments)for(t.Matrix.scale(_,i,a,n.x,n.y),u=0;u<e.segments.length;u++){for(g=e.segments[u],m=0;m<g.points.length;m++)g.points[m]=t.Matrix.transform(_,g.points[m]),0!=u||0!=m||e.sourceNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(e,t.Matrix.transform(_,e.sourcePoint),!1)),u!=e.segments.length-1||m!=g.points.length-1||e.targetNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],e.targetPoint=g._endPoint);g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],"orthogonal"==g.type?g.length||0===g.length?g.length=g._length=t.datavisualization.Diagram.Geometry.distance(g._startPoint,g._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(g,e.segments[u-1],e.segments[u+1],e.sourcePoint,e.targetPoint):(g.point&&(g.point=g._endPoint),g._point=g._endPoint)}else if("group"===e._type){for(h=d._getChildren(e.children),u=0;u<h.length;u++)c=o[h[u]],c&&(this.scale(c,i,a,n,o),c.parent&&c.parent!=e.name&&"pseudoGroup"!=e.type&&t.datavisualization.Diagram.Util._updateGroupBounds(o[c.parent],d));t.datavisualization.Diagram.Util._updateGroupBounds(e,d)}else{t.Matrix.rotate(_,-e.rotateAngle,n.x,n.y),t.Matrix.scale(_,i,a,n.x,n.y),t.Matrix.rotate(_,e.rotateAngle,n.x,n.y);var y=t.Matrix.transform(_,t.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),b=e.width*i,x=e.height*a;b>1&&(e.width=b,e.offsetX=y.x),x>1&&(e.height=x,e.offsetY=y.y)}},_getIntersectingElement:function(e,i){for(var a,n,o,s,r=t.datavisualization.Diagram.SpatialUtil.findQuads(e._spatialSearch,i),l=[],d=0;d<r.length;d++)if(a=r[d],a.objects.length>0)for(n=0;n<a.objects.length;n++)o=a.objects[n],o.visible&&(s=t.datavisualization.Diagram.Util.bounds(o),t.datavisualization.Diagram.Geometry.intersectsRect(i,s)&&(o=e._sortByZIndex(o,!0),l.push(o)));return l},_getIntersectingNodeElement:function(e,i){for(var a,n,o,s,r=t.datavisualization.Diagram.SpatialUtil.findQuads(e._spatialSearch,i),l=[],d=0;d<r.length;d++)if(a=r[d],a.objects.length>0)for(n=0;n<a.objects.length;n++)o=a.objects[n],o.visible&&(s=t.datavisualization.Diagram.Util.bounds(o),t.datavisualization.Diagram.Geometry.intersectsRect(i,s)&&(o=e._sortByZIndex(o,!0),o.segments||l.push(o)));return l},_updateChildBounds:function(e,i){var a,n,o,s,r,l,d;o=e.width,s=e.height,a=e.offsetX,n=e.offsetY,r=t.datavisualization.Diagram.Util._getChildrenBounds(e,i),e.offsetX=r.x+r.width/2,e.offsetY=r.y+r.height/2,e.height=r.height,e.width=r.width,l=o/e.width,d=s/e.height,this.scale(e,l,d,e.pivot,i.nameTable,null,null,null,i),this._translate(e,a-e.offsetX,n-e.offsetY,i.nameTable,null,i)},_updateGroupBounds:function(e,i,a,n){var o,s,r,l,d,h,c;if(e&&!e.container&&e&&("pseudoGroup"===e.type||e.children&&e.children.length>0)){o=e.width,s=e.height,r=e.offsetX,l=e.offsetY,n&&this._updateRotateAngle(e,i.nameTable);var u=this._getChildrenBounds(e,i,a),g=u.x+u.width*e.pivot.x,m=u.y+u.height*e.pivot.y,p={x:g,y:m};if(e.rotateAngle&&(!i._isNodeInitializing||i._isGroupNode)&&(d=t.Matrix.identity(),t.Matrix.rotate(d,e.rotateAngle),p=t.Matrix.transform(d,p)),u&&(e.offsetX=p.x,e.offsetY=p.y,e.width=u.width,e.height=u.height),a){if(h=null,e.children&&e.children.length>0)for(c=0;c<e.children.length;c++)i._getChild(e.children[c])&&(h=i.nameTable[i._getChild(e.children[c])]),h&&("group"===h._type||h.children&&h.children.length>0)&&this._updateGroupBounds(h,i,a);o&&o!=e.width&&i.scale(e,o/e.width,1,new t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),i.nameTable),s&&s!=e.height&&i.scale(e,1,s/e.height,new t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),i.nameTable),r&&r!=e.offsetX&&i._translate(e,r-e.offsetX,1,i.nameTable),r&&l!=e.offsetY&&i._translate(e,1,l-e.offsetY,i.nameTable)}}},_getChildrenBounds:function(e,i,a){var n,o,s,r,l=i._getChildren(e.children),d=t.datavisualization.Diagram.Rectangle();for(l.length>0&&(o=i.nameTable[l[0]],o&&(d=this._rotateChildBounds(o,e,i))),s=0,r=l.length;r>s;s++)o=i.nameTable[l[s]],o&&(i.selectedItem||!o._isInternalShape)&&("group"===o._type?(this._updateGroupBounds(o,i,a),n=this._rotateChildBounds(o,e,i)):n=this._rotateChildBounds(o,e,i)),n&&(d=t.datavisualization.Diagram.Geometry.union(d,n));return d},_updateRotateAngle:function(e,t){var i,a;if(0==e.offsetX&&0==e.offsetY&&0==e.width&&0==e.height)for(i=0;i<e.children.length;i++)if(a=t[e.children[i]],a&&!a.segments&&!e.rotateAngle)return void(e.rotateAngle=a.rotateAngle)},_rotateChildBounds:function(e,i,a){var n,o;if(e.segments||(i.rotateAngle||e.rotateAngle)&&(!a._isNodeInitializing||a._isGroupNode)){n=this.bounds(e),o=t.Matrix.identity(),t.Matrix.rotate(o,-i.rotateAngle);var s=t.Matrix.transform(o,n.topLeft),r=t.Matrix.transform(o,n.topRight),l=t.Matrix.transform(o,n.bottomLeft),d=t.Matrix.transform(o,n.bottomRight),h=Math.min(s.x,r.x,l.x,d.x),c=Math.min(s.y,r.y,l.y,d.y);return{x:h,width:Math.max(s.x,r.x,l.x,d.x)-h,y:c,height:Math.max(s.y,r.y,l.y,d.y)-c}}return{x:e.offsetX-(e.width||e._width)*e.pivot.x,y:e.offsetY-(e.height||e._height)*e.pivot.y,width:e.width||e._width,height:e.height||e._height}},_emptyBridging:function(e,i){var a,n,o,s,r;if(e&&e.length>0&&i)for(a=0;a<e.length;a++)if(n=i.nameTable[i._getChild(e[a])]){for(o=0;o<n.segments.length;o++)for(s=n.segments[o]._bridges,r=0;r<s.length;r++)s.splice(r,1);t.datavisualization.Diagram.DiagramContext.update(n,i)}},updateBridging:function(i,a,n){var o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C,w,z,S,P,T,j,L,N,O,M,E,k,A,I,U,B,H,R=[];if(n&&n.length){if(i.segments.length>0)for(S=0;S<i.segments.length;S++)for(T=i.segments[S]._bridges,r=0;r<T.length;r++)T[r]._target==n[0].name?T.splice(r,1):this.findLength(T[r].startPoint,T[r].endPoint)>n[0].bridgeSpace&&(a.nameTable[T[r]._target]&&n.push(a.nameTable[T[r]._target]),T.splice(r,1))}else if(i.segments.length>0)for(S=0;S<i.segments.length;S++)i.segments[S]._bridges=[];if(n||this._emptyBridging(i._intersects,a),i._intersects=[],t.datavisualization.Diagram.Util.canBridge(i,a)){var G=this.getPoints(i),W=i.bridgeSpace,V=a.bridgeDirection(),X=-1;if(o=n&&a.boundaryTable[i.name]?a.boundaryTable[i.name]:t.datavisualization.Diagram.Util.bounds(i),a.boundaryTable[i.name]=o,n&&n.length>0)for(d=[],j=0;j<n.length;j++)l=a.nameTable[a._getChild(n[j])],l&&d.push(l);if(h=d?d:a._getConnectors(),h.length>0)for(c=0;c<h.length;c++)if(u=h[c],t.datavisualization.Diagram.Util.canBridgeObstacle(u,a)&&i&&i.segments&&i.segments.length>0&&"bezier"!=i.segments[0].type&&u&&u.segments&&u.segments.length>0&&"bezier"!=u.segments[0].type&&u.segments&&u.visible&&i.name!==u.name&&(s=a.boundaryTable[u.name]?a.boundaryTable[u.name]:t.datavisualization.Diagram.Util.bounds(u),a.boundaryTable[u.name]=s,t.datavisualization.Diagram.Geometry.intersectsRect(o,s)&&(g=this.getPoints(u),m=this.interSect(G,g,!1,a,!0),i._intersects.push(u.name),m.length>0)))for(j=0;j<m.length;j++){var Y=0,F=0,$=0,q=0,Z=this.getLengthAtFractionPoint(i,m[j]);if($=Z.lengthAtFractionPt,Y=Z.fullLength,F=Z.segmentIndex,q=Z.pointIndex,!(0>F)&&i.segments[0])if(v=($-W/2)/Y,p=this.getPointAtLength($-W/2,G),v=($+W/2)/Y,f=this.getPointAtLength($+W/2,G),t.datavisualization.Diagram.Geometry.isEmptyPoint(f)&&(f=p),_=0===F?i.sourcePoint:i.segments[F-1]._endPoint,I="straight"===i.segments[F].type?i.segments[F]._point:i.segments[F].points[q],y=this._findAngle(_,I),R.length>F&&null!=R[F]){b=0===F?i.sourcePoint:i.segments[F-1]._endPoint;var Q=Math.abs(this.findLength(b,f)),K=0,J=-1;for(X=-1,A=0;A<R[F].bridges.length;A++)if(X++,x=R[F].bridges[A],K=Math.abs(this.findLength(b,x.endPoint)),K>Q){J=X;break}J>=0?(D=this.createSegment(p,f,y,V,q,i,a),D._target=u.name,R[F].bridges.splice(J,0,D),R[F].bridges.join(),R[F].bridgeStartPoint.splice(J,0,p),R[F].bridgeStartPoint.join(),R[F].segmentIndex=F):(D=this.createSegment(p,f,y,V,q,i,a),D._target=u.name,R[F].bridges.push(D),R[F].bridgeStartPoint.push(p),R[F].segmentIndex=F)}else isNaN(p.x)||isNaN(p.y)||t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||(C=this.createSegment(p,f,y,V,q,i,a),C._target=u.name,w=[],z=[],w.push(p),z.push(f),R.length<F+1,R[F]=e.extend(!0,{},t.datavisualization.Diagram.BridgeSegments,{}),R[F].bridges.push(C),R[F].bridgeStartPoint=w,R[F].segmentIndex=F)}if(n&&n.length&&i.segments.length>0)for(S=0;S<i.segments.length;S++)P=i.segments[S],T=i.segments[S]._bridges,R[S]||(R[S]=e.extend(!1,{},t.datavisualization.Diagram.BridgeSegments),R[S].segmentIndex=S),R[S].bridges=R[S].bridges.concat(T).sort(function(e,t){return P._startPoint.x!=P._endPoint.x?P._startPoint.x<P._endPoint.x?e.startPoint.x-t.startPoint.x:t.startPoint.x-e.startPoint.x:P._startPoint.y<P._endPoint.y?e.startPoint.y-t.startPoint.y:t.startPoint.y-e.startPoint.y}),R[S].bridgeStartPoint=R[S].bridges.map(function(e){return e.startPoint}),i.segments[S]._bridges=[];if(0!=R.length)for(j=0;j<R.length;j++)if(L=R[j]){for(A=1;A<L.bridges.length;A++)this.findLength(L.bridges[A].endPoint,L.bridges[A-1].endPoint)<W&&(L.bridges[A-1].endPoint=L.bridges[A].endPoint,E=L.bridges[A-1],N=a.getBridgeSegment(E.startPoint,E.endPoint,E.angle,W,E.sweep),L.bridges[A-1].path=N,n&&n.length&&L.bridges[A-1]._target==n[0].name&&(L.bridges[A-1]._target=L.bridges[A]._target),L.bridges.splice(A,1),L.bridgeStartPoint.splice(A,1),A--);for(O=i.sourcePoint,M=0;M<L.bridges.length;M++){for(E=L.bridges[M],k=!0,A=0;n&&A<n.length;A++)E._target==n[A].name&&(k=!1);k?(i.segments[L.segmentIndex]._bridges.push(E),O=E.endPoint):("straight"===i.segments[L.segmentIndex].type?I=i.segments[L.segmentIndex]._endPoint:"orthogonal"===i.segments[L.segmentIndex].type&&(I=i.segments[L.segmentIndex].points[E.segmentPointIndex]),0!=F&&(O=i.segments[L.segmentIndex]._endPoint),U=[],U.push(t.datavisualization.Diagram.Point(I.x-W,I.y-W)),U.push(t.datavisualization.Diagram.Point(I.x+W,I.y+W)),B=t.datavisualization.Diagram.Geometry.rect(U),U=[],U.push(t.datavisualization.Diagram.Point(O.x-W,O.y-W)),U.push(t.datavisualization.Diagram.Point(O.x+W,O.y+W)),H=t.datavisualization.Diagram.Geometry.rect(U),t.datavisualization.Diagram.Geometry.containsPoint(B,L.bridgeStartPoint[M])||t.datavisualization.Diagram.Geometry.containsPoint(H,E.endPoint)||(i.segments[L.segmentIndex]._bridges.push(E),O=E.endPoint))}}}},createSegment:function(i,a,n,o,s,r,l){var d,h,c=e.extend(!1,{},t.datavisualization.Diagram.PathSegment);return h=this.sweepDirection(n,o,r,l),d=l.getBridgeSegment(i,a,n,r.bridgeSpace,h),c.path=d,c.startPoint=i,c.endPoint=a,c.angle=n,c.segmentPointIndex=s,c.sweep=h,c},sweepDirection:function(e,t){var i,a=Math.abs(e);return"top"===t||"bottom"===t?(i=1,a>=0&&90>=a&&(i=0)):("right"===t||"left"===t)&&(i=1,0>e&&e>=-180&&(i=0)),("right"===t||"bottom"===t)&&(i=0===i?1:0),i},getPointAtLength:function(e,i){for(var a,n,o=0,s=null,r=t.datavisualization.Diagram.Point(0,0),l=0;l<i.length;l++)if(a=i[l],s){if(n=this.findLength(s,a),o+n>e){var d=e-o,h=this.findAngle(s,a),c=d*Math.cos(h*Math.PI/180),u=d*Math.sin(h*Math.PI/180);r=t.datavisualization.Diagram.Point(s.x+c,s.y+u);break}o+=n,s=a}else s=a;return r},getLengthAtFractionPoint:function(e,t){var i,a,n,o,s,r,l,d=100,h=0,c=-1,u=0,g=0,m=-1;if(null===e.segments)return 0;var p=(e.segments,e.sourcePoint),f=p;for(i=0;i<e.segments.length;i++){for(a=[],n=e.segments[i],s=0;s<n.points.length;s++)o=n.points[s],a.push(o);for(s=0;s<a.length;s++)r=a[s],l=this.getSlope(r,p,t,e),d>l&&(d=l,g=h+this.findLength(t,f),c=u,m=s),h+=this.findLength(r,p),p=r,f=r;u++}return{lengthAtFractionPt:g,fullLength:h,segmentIndex:c,pointIndex:m}},getSlope:function(e,t,i,a){var n=3,o=Math.abs(e.x-t.x),s=Math.abs(e.y-t.y),r=(i.y-e.y)/(t.y-e.y),l=(i.x-e.x)/(t.x-e.x);return!isFinite(r)||!isFinite(l)||isNaN(r)||isNaN(l)?e.x===t.x?e.y===t.y?1e4:e.y>i.y&&i.y>t.y||e.y<i.y&&i.y<t.y?Math.abs(e.x-i.x):1e4:e.y==t.y&&(e.x>i.x&&i.x>t.x||e.x<i.x&&i.x<t.x)?Math.abs(e.y-i.y):1e4:a.segments.length>0&&(e.x>=i.x&&i.x>=t.x||e.x<=i.x&&i.x<=t.x||n>o)&&(e.y>=i.y&&i.y>=t.y||e.y<=i.y&&i.y<=t.y||n>s)?Math.abs(r-l):1e4},getPoints:function(e){var t,i,a,n=[];if(e.segments.length>0)for(t=0;t<e.segments.length;t++)if(i=e.segments[t],"straight"===i.type||"bezier"===i.type)0===t&&n.push(e.sourcePoint),i._point&&n.push(i._point);else if("orthogonal"===i.type)for(a=0;a<e.segments[t].points.length;a++)n.push(e.segments[t].points[a]);return n},interSect:function(e,t,i,a,n){var o,s,r,l,d;for(i&&t.length>=2&&(t.splice(0,1),t.splice(0,1)),o=[],s=a.bridgeDirection(),r=0;r<e.length-1;r++){if(l=this.interSect1(e[r],e[r+1],t,a,n,s),l.length>0)for(d=0;d<l.length;d++)o.push(l[d]);i&&t.length>=1&&t.splice(0,1)}return o},checkforHorizontalLine:function(e){var t=Math.abs(e);return t>90?180-t:t},interSect1:function(e,i,a,n,o,s){for(var r,l,d,h=[],c=0;c<a.length-1;c++)r=this.interSect2(e,i,a[c],a[c+1]),t.datavisualization.Diagram.Geometry.isEmptyPoint(r)||(l=this._findAngle(e,i),d=this._findAngle(a[c],a[c+1]),l=this.checkforHorizontalLine(l),d=this.checkforHorizontalLine(d),"left"===s||"right"===s?l>d&&h.push(r):("top"===s||"bottom"===s)&&d>l&&h.push(r),(l===d&&o||n._autoConnectEndPoint)&&h.push(r));return h},interSect2:function(e,i,a,n){var o=t.datavisualization.Diagram.LineUtil(e.x,e.y,i.x,i.y),s=t.datavisualization.Diagram.LineUtil(a.x,a.y,n.x,n.y),r=this.interSect3(o,s);return r.enabled?r.intersectPt:t.datavisualization.Diagram.Point(0,0);
},interSect3:function(e,i){var a,n,o=t.datavisualization.Diagram.Point(0,0),s=e,r=i,l=(r.y2-r.y1)*(s.x2-s.x1)-(r.x2-r.x1)*(s.y2-s.y1),d=(r.x2-r.x1)*(s.y1-r.y1)-(r.y2-r.y1)*(s.x1-r.x1),h=(s.x2-s.x1)*(s.y1-r.y1)-(s.y2-s.y1)*(s.x1-r.x1);return 0==l?{enabled:!1,intersectPt:o}:(a=d/l,n=h/l,a>=0&&1>=a&&n>=0&&1>=n?(o.x=s.x1+a*(s.x2-s.x1),o.y=s.y1+a*(s.y2-s.y1),{enabled:!0,intersectPt:o}):{enabled:!1,intersectPt:o})},findLength:function(e,t){try{return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}catch(i){throw i}},_findAngle:function(e,t){var i=e.x-t.x,a=e.y-t.y;return Math.atan2(a,i)*(180/Math.PI)},findAngle:function(e,i){if(t.datavisualization.Diagram.Geometry.isEqualPoint(e,i))return 0;var a=t.datavisualization.Diagram.Point(i.x,e.y),n=(this.findLength(e,a),this.findLength(a,i)),o=this.findLength(i,e),s=Math.asin(n/o);return s=180*s/Math.PI,e.x<i.x?e.y<i.y||(s=360-s):s=e.y<i.y?180-s:180+s,s},_mapPalettePhase:function(e){var i,a;return e.orientation&&"horizontal"==e.orientation?(i={x:0,y:0},a={x:40,y:0}):(i={x:0,y:0},a={x:0,y:40}),t.datavisualization.Diagram.Connector({name:e?e.name:t.datavisualization.Diagram.Util.randomId(),segments:[{type:"straight"}],sourcePoint:{x:i.x,y:i.y},targetPoint:{x:a.x,y:a.y},lineWidth:e.lineWidth?e.lineWidth:1,lineDashArray:e.lineDashArray?e.lineDashArray:null,lineColor:e.lineColor?e.lineColor:"#606060",targetDecorator:{shape:"none"},isPhase:!0,orientation:e.orientation?e.orientation:"horizontal",labels:e.label?[e.label]:[],paletteItem:e.paletteItem?e.paletteItem:null})},_updateShapeProperties:function(e){switch(e._type="node",e.shape.type||(e.shape.type="rectangle"),e.shape.type){case"rectangle":e.type="basic",e._shape=e.shape.type,e.shape.cornerRadius&&(e.cornerRadius=e.shape.cornerRadius);break;case"ellipse":e.type="basic",e._shape=e.shape.type;break;case"path":e.type="basic",e._shape=e.shape.type,e.pathData=e.shape.pathData;break;case"polygon":e.type="basic",e._shape=e.shape.type,e.points=e.shape.points;break;case"image":e.type="image",e._shape=e.shape.type,e.source=e.shape.src;break;case"native":e.type="native",e._shape=e.shape.type,e.templateId=e.shape.templateId;break;case"text":e.type="text",e._shape=e.shape.type,e.textBlock=e.shape.textBlock;break;case"html":e.type="html",e._shape=e.shape.type,e.templateId=e.shape.templateId}},_refreshParentGroup:function(e,i){var a,n,o=i.nameTable[e.parent];o&&(this._updateGroupBounds(o,i),a=o.parent?document.getElementById(o.parent):i._diagramLayer,t.datavisualization.Diagram.DiagramContext.renderGroup(o,i),n=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Unknown,i._raiseGroupChangeEvent(e,void 0,o,n))},intersectsWith:function(e,t){var i=t;return e.x<i.x&&i.x<e.x+e.width&&e.y<i.y&&i.y<e.y+e.height},_findOffsetOnConnector:function(e,i,a,n){for(var o,s,r,l,d=0,h=[],c=0;c<e.segments.length;c++)for(h[c]=[],o=0;o<e.segments[c].points.length-1;o++)d+=t.datavisualization.Diagram.Geometry.distance(e.segments[c].points[o],e.segments[c].points[o+1]),h[c][o]=d;var u,g,m,p,f=e.sourceNode&&0==i.offset&&n.nameTable[e.sourceNode]||e.targetNode&&1==i.offset&&n.nameTable[e.targetNode],v=f?this.bounds(f):null,a=i.segmentOffset||0,_=d*a;for(c=0;c<h.length;c++)for(o=0;o<h[c].length;o++){if(h[c][o]>=_){if(g=e.segments[c],m=t.datavisualization.Diagram.Geometry.findAngle(g.points[o],e.segments[c].points[o+1]),p=t.datavisualization.Diagram.Geometry.transform(g.points[o],m,_-(u||0)),f){if(this.intersectsWith(v,p)&&!t.datavisualization.Diagram.Geometry.containsRect(v,this.bounds(e))){switch(r=0==i.offset?this._getBezierDirection(g.points[o],e.segments[c].points[o+1]):this._getBezierDirection(g.points[o+1],e.segments[c].points[o]),s=0==i.offset?g.points[o+1]:g.points[o],l=!1,r){case"top":v.y>s.y?p.y=v.top:l=!0;break;case"bottom":v.bottom<s.y?p.y=v.bottom:l=!0;break;case"right":v.right<s.x?p.x=v.right:l=!0;break;case"left":v.left>s.x?p.x=v.left:l=!0}if(l){_=1==i.offset?u||0:h[c][o],u=0==i.offset?h[c][o]:h[c][o-2]||(h[c-1]&&h[c-1].length>1?h[c-1][h[c-1].length-1]:h[c-2]&&h[c-2][h[c-2].length-1])||0,0==i.offset?c=c:o?o-=2:c-=2;continue}}return{segment:c,point:o,offset:{x:p.x,y:p.y}}}return{segment:c,point:o,offset:{x:p.x,y:p.y}}}u=h[c][o]}},_alignLabelOnSegments:function(e,i,a,n){var o,s,r,l,d,h,c;n.angle%360;n.angle%=360;var u,g=45,m=135,p=225,f=315;switch((0==i.segmentOffset&&e.sourceNode||1==i.segmentOffset&&e.targetNode)&&(o=0==i.segmentOffset&&e.sourceNode?a.nameTable[e.sourceNode]:a.nameTable[e.targetNode],o&&(u=this.bounds(o)),u&&(s=180/(2+2/(u.height/u.width)),g=s,m=180-s,p=m+2*s,f=360-s)),i.alignment){case"before":n.angle>=g&&n.angle<=m?(r="right",l=.5==i.segmentOffset?"center":"top"):n.angle>=p&&n.angle<=f?(r="left",l=.5==i.segmentOffset?"center":"bottom"):n.angle>g&&n.angle<p?(l="top",r=.5==i.segmentOffset?"center":"right"):(l="bottom",r=.5==i.segmentOffset?"center":"left");break;case"after":n.angle>=g&&n.angle<=m?(r="left",l=.5==i.segmentOffset?"center":"top"):n.angle>=p&&n.angle<=f?(r="right",l=.5==i.segmentOffset?"center":"bottom"):n.angle>g&&n.angle<p?(l="bottom",r=.5==i.segmentOffset?"center":"right"):(l="top",r=.5==i.segmentOffset?"center":"left");break;case"center":r="center",l="center"}if(i.boundaryConstraints&&(0==i.segmentOffset||1==i.segmentOffset))switch(e.segments.length>1&&(c=e.segments[e.segments.length-1]),d=c?c.points.length:e.segments[0].points.length,e.labels[0].name==i.name?h=t.datavisualization.Diagram.Util._getBezierDirection(e.segments[0].points[0],e.segments[0].points[1]):(c=c?c:e.segments[0],h=t.datavisualization.Diagram.Util._getBezierDirection(c.points[d-2],c.points[d-1])),h){case"left":r=0==i.segmentOffset?"right":"left";break;case"right":r=0==i.segmentOffset?"left":"right";break;case"bottom":l=0==i.segmentOffset?"top":"bottom";break;case"top":l=0==i.segmentOffset?"bottom":"top"}return{hAlign:r,vAlign:l}},getObjectType:function(e){return e?e.segments?"connector":"bpmn"==e.type&&e.container?"group":"node"===e._type||"bpmn"==e.type||"basic"==e.type||"flow"==e.type||"arrow"==e.type?"node":"text"===e.type||"image"===e.type||"native"===e.type||"html"===e.type?"node":"group"!=e._type&&"pseudoGroup"==e.type?"pseudoGroup":"group"===e._type||e.isLane||e.isSwimlane?"group":e.isSwimlane?"swimlane":null:null},_canBeTarget:function(e,t){return!(t&&e.activeTool.helper&&e.activeTool.helper._name&&e.activeTool.helper._name===t.name)},getLabelbounds:function(i,a,n){var o,s,r,l,d;if(n)if("svg"===i.model.labelRenderingMode){if(i._svg&&(o=i._svg.document.getElementById(a.name+"_"+n.name),r=i._svg.document.getBoundingClientRect(),o))return l=o.getBoundingClientRect(),s={x:l.left,y:l.top,width:l.width,height:l.height},d=i.tools.labelMove.getCenterOfLabel(n,n.segmentOffset,s),{x:l.left-r.left,y:l.top-r.top,width:l.right-l.left,height:l.bottom-l.top,centerX:d.x,centerY:d.y}}else if(i._svg){var h=i._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],r=h.getBoundingClientRect(),c=r.left,u=r.top;if(o=e(h).find("#"+a.name+"_"+n.name)[0]){var l=o.getBoundingClientRect(),g=(l.left-c)/i.model.scrollSettings.currentZoom+(c+i.model.scrollSettings.horizontalOffset),m=(l.top-u)/i.model.scrollSettings.currentZoom+(u+i.model.scrollSettings.verticalOffset),p=l.width/i.model.scrollSettings.currentZoom,f=l.height/i.model.scrollSettings.currentZoom;return c+=i.model.scrollSettings.horizontalOffset,u+=i.model.scrollSettings.verticalOffset,t.datavisualization.Diagram.Rectangle(g-c,m-u,p,f)}}},_updateBpmnChild:function(e,i){switch(e.shape){case"event":e=t.datavisualization.Diagram.DefautShapes._getBPMNEventShape(e,i);break;case"gateway":e=t.datavisualization.Diagram.DefautShapes._getBPMNGatewayShape(e,i);break;case"dataobject":e=t.datavisualization.Diagram.DefautShapes._getBPMNDataShape(e,i);break;case"activity":e=t.datavisualization.Diagram.DefautShapes._getBPMNActivityShape(e,i);break;case"group":e=t.datavisualization.Diagram.DefautShapes._getBPMNGroupShape(e,i)}return t.datavisualization.Diagram.DefautShapes.initBPMNAnnotationShape(e,i)},_getUndoObject:function(t,i){var a={},a=t._getChildTable(i,a);t.activeTool._undoObject=e.extend(!0,{},{node:i,childTable:a})},_getRedoObject:function(t,i){var a={},a=t._getChildTable(i,a);t.activeTool._redoObject=e.extend(!0,{},{node:i,childTable:a})},_collectionContains:function(e,t){for(var i=0;i<t.length;i++)if("string"==typeof t[i]&&t[i]===e||t[i].name===e)return!0},_updateActivityChildOffset:function(e,t,i){if(e.children&&e.children.length>0)for(var a=0;a<e.children.length;a++)e.children[a].offsetX=t.x,e.children[a].offsetY=t.y,this._updateActivityChildOffset(e.children[a],t,i)},_updateBPMNProperties:function(e,i,a,n){var o,s,r,l,d,h,c,u;switch(e.shape){case"activity":var g=t.datavisualization.Diagram.Util.bounds(e,!0),m=e.offsetX,p=e.offsetY,f=i._getChildren(e.children);for(l=0;l<f.length;l++)d="object"==typeof f[l]?f[l]:a[f[l]],n&&0==l&&(g=t.datavisualization.Diagram.Util.bounds(d,!0),m=d.offsetX,p=d.offsetY),0==l&&(d.pathData=d._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(e,12),"transaction"==e.subProcess.type&&(o={x:3,y:3,width:e.width-3,height:e.height-3},d.pathData=d._absolutePath+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(o,12)),delete d._absoluteBounds),n&&t.datavisualization.Diagram.Util.canResize(d)||(h=d.addInfo,h.offset&&(c=t.datavisualization.Diagram.Point(g.x+g.width*h.offset.x,g.y+g.height*h.offset.y),h.margin=t.datavisualization.Diagram.Margin(h.margin?h.margin:{}),h.hAlign&&(c.x+=h.margin.left-h.margin.right,c.x="left"==h.hAlign?c.x+h.margin.right:"right"==h.hAlign?c.x-h.margin.left:c.x),h.vAlign&&(c.y+=h.margin.top-h.margin.bottom,c.y="top"==h.vAlign?c.y+h.margin.bottom:"bottom"==h.vAlign?c.y-h.margin.top:c.y),e.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,e.rotateAngle,m,p),c=t.Matrix.transform(u,c)),d.offsetX=c.x,d.offsetY=c.y,this._updateActivityChildOffset(d,c,i)));break;case"group":e.pathData=e._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(e,15),e._scaled=!1;break;case"annotation":for(l=0;l<e.outEdges.length;l++)if(r=i.nameTable[e.outEdges[l]],r._isAnnotationLine){s=r;break}s&&t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(s,e,null,null,i);break;case"dataobject":var g=t.datavisualization.Diagram.Util.bounds(e,!0),m=e.offsetX,p=e.offsetY,f=i._getChildren(e.children),v=e.pivot||{x:.5,y:.5},_=e.offsetX?e.offsetX-e.width*v.x:e.width*v.x,y=e.offsetY?e.offsetY-e.height*v.y:e.height*v.y;for(l=0;l<f.length;l++)d="object"==typeof f[l]?f[l]:a[f[l]],n&&t.datavisualization.Diagram.Util.canResize(d)||(h=d.addInfo,h.margin=t.datavisualization.Diagram.Margin(h.margin?h.margin:{}),h.offset&&(c=t.datavisualization.Diagram.Point({}),c.x=_+h.offset.x*e.width+h.margin.left-h.margin.right,c.y=y+h.offset.y*e.height+h.margin.top-h.margin.bottom,e.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,e.rotateAngle,m,p),c=t.Matrix.transform(u,c)),d.offsetX=c.x,d.offsetY=c.y))}},indexOf:function(e,t){if(null!=e&&null!=t)for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1}},t.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1},t.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1,sweep:1},t.datavisualization.Diagram.LineUtil=function(e,t,i,a){return{x1:Number(e)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(a)||0}},t.datavisualization.Diagram.Geometry={checkPointOnCircle:function(e,t,i){var a=Math.pow(i,2),n=Math.pow(e.x-t.x,2),o=Math.pow(e.y-t.y,2);return a>=n+o},rect:function(e){var i,a,n,o,s=t.datavisualization.Diagram.Rectangle();if(1===arguments.length){var r,l,d=Number.MAX_VALUE,h=Number.MAX_VALUE,c=-Number.MAX_VALUE,u=-Number.MAX_VALUE,g=e.length;for(i=0;g>i;i++)r=e[i].x,l=e[i].y,d>r&&(d=r),r>c&&(c=r),h>l&&(h=l),l>u&&(u=l);s=t.datavisualization.Diagram.Rectangle(d,h,c-d,u-h)}else 2===arguments.length&&(a=t.datavisualization.Diagram.Point(arguments[0]),n=t.datavisualization.Diagram.Point(arguments[1]),a.x>n.x&&(o=a.x,a.x=n.x,n.x=o),a.y>n.y&&(o=a.y,a.y=n.y,n.y=o),s=t.datavisualization.Diagram.Rectangle(a.x,a.y,n.x-a.x,n.y-a.y));return s},union:function(e,i){var a=Math.min(e.x,i.x),n=Math.min(e.y,i.y),o=Math.max(e.x+e.width,i.x+i.width),s=Math.max(e.y+e.height,i.y+i.height);return t.datavisualization.Diagram.Rectangle(a,n,o-a,s-n)},distance:function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},translate:function(e,i,a){return t.datavisualization.Diagram.Point(e.x+i,e.y+a)},intersectsRect:function(e,t){return t.x<e.x+e.width&&e.x<t.x+t.width&&t.y<e.y+e.height&&e.y<t.y+t.height},findAngle:function(e,t){var i=Math.atan2(t.y-e.y,t.x-e.x);return i=180*i/Math.PI,i%=360,0>i&&(i+=360),i},intersectSegment:function(e,i){var a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_=e.point1.x,y=e.point1.y,b=e.point2.x,x=e.point2.y,D=i.point1.x,C=i.point1.y,w=i.point2.x,z=i.point2.y;return a=x-y,o=_-b,r=b*y-_*x,g=a*D+o*C+r,m=a*w+o*z+r,0!==g&&0!==m&&this.sameSign(g,m)?null:(n=z-C,s=D-w,l=w*C-D*z,c=n*_+s*y+l,u=n*b+s*x+l,0!==c&&0!==u&&this.sameSign(c,u)?null:(p=a*s-n*o,0===p?null:(f=0>p?-p/2:p/2,f=0,v=o*l-s*r,d=0>v?(v-f)/p:(v+f)/p,v=n*r-a*l,h=0>v?(v-f)/p:(v+f)/p,t.datavisualization.Diagram.Point(d,h))))},updatePath:function(e,i,a,n,o,s,r,l){var d,h;s&&s.pathBounds?(h=!0,d=r||s.pathBounds(o)):(h=!(!l||l._absolutePath),d=r),l&&(l._absoluteBounds=d);var c=0,u=0,g=!1;return(e.toString()!==d.x||i.toString()!==d.y)&&(c=e-Number(d.x),u=i-Number(d.y)),(a!==d.width||n!==d.height)&&(c=a/Number(d.width?d.width:1),u=n/Number(d.height?d.height:1),g=!0),t.datavisualization.Diagram.Geometry.processPathData(o,c,u,g,d.x,d.y,e,i,h,s)},processPathData:function(e,i,a,n,o,s,r,l,d,h){var c,u,g,m,p,f,v,_,y,b,x,D,C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttribute("d",e),d&&(h=h||new t.datavisualization.Diagram.Svg({}),e=h.absolutePath(C).getAttribute("d"),C.setAttribute("d",e)),v=t.datavisualization.Diagram.Util.convertPathToArray(e);for(var w=0,z=0,S=0,P=v.length;P>S;++S){switch(_=v[S],y=_.pathSegTypeAsLetter,"x1"in _&&(g=_.x1),"x2"in _&&(p=_.x2),"y1"in _&&(m=_.y1),"y2"in _&&(f=_.y2),"x"in _&&(w=_.x),"y"in _&&(z=_.y),n?(void 0!=w&&(w=t.datavisualization.Diagram.Geometry.scalePathData(w,i,o,r),w=Number(w.toFixed(2))),void 0!=z&&(z=t.datavisualization.Diagram.Geometry.scalePathData(z,a,s,l),z=Number(z.toFixed(2))),void 0!=g&&(g=t.datavisualization.Diagram.Geometry.scalePathData(g,i,o,r),g=Number(g.toFixed(2))),void 0!=m&&(m=t.datavisualization.Diagram.Geometry.scalePathData(m,a,s,l),m=Number(m.toFixed(2))),void 0!=p&&(p=t.datavisualization.Diagram.Geometry.scalePathData(p,i,o,r),p=Number(p.toFixed(2))),void 0!=f&&(f=t.datavisualization.Diagram.Geometry.scalePathData(f,a,s,l),f=Number(f.toFixed(2)))):(void 0!=w&&(w+=i),void 0!=z&&(z+=a),void 0!=g&&(g+=i),void 0!=m&&(m+=a),void 0!=p&&(p+=i),void 0!=f&&(f+=a)),y){case"M":b={pathSegTypeAsLetter:"M",x:w,y:z};break;case"L":b={pathSegTypeAsLetter:"L",x:w,y:z};break;case"H":b={pathSegTypeAsLetter:"H",x:w};break;case"V":b={pathSegTypeAsLetter:"V",y:z};break;case"C":b={pathSegTypeAsLetter:"C",x:w,y:z,x1:g,y1:m,x2:p,y2:f};break;case"S":b={pathSegTypeAsLetter:"S",x:w,y:z,x2:p,y2:f};break;case"Q":b={pathSegTypeAsLetter:"Q",x:w,y:z,x1:g,y1:m};break;case"T":b={pathSegTypeAsLetter:"T",x:w,y:z};break;case"A":x=_.r1,D=_.r2,n&&(x*=i,D*=a),b={pathSegTypeAsLetter:"A",x:w,y:z,r1:x,r2:D,angle:_.angle,largeArcFlag:_.largeArcFlag,sweepFlag:_.sweepFlag};break;case"z":case"Z":w=c,z=u,b=v[S]}b&&(v[S]=b),("M"===y||"m"===y)&&(c=w,u=z)}return t.datavisualization.Diagram.Util.pathSegArrayAsString(v)},scalePathData:function(e,t,i,a){return e!==i?e=a!==i?e*t-(Number(i)*t-Number(i))+(a-Number(i)):Number(e)*t-(Number(i)*t-Number(i)):a!==i&&(e=a),e},updatePolygonPoints:function(e,i){var a,n,o,s;if(e.points)for(i||(i=e.points),t.datavisualization.Diagram.Geometry.scalePoints(i,e),a=t.datavisualization.Diagram.Geometry.rect(e.points),n=0,o=e.points.length;o>n;++n)s=t.datavisualization.Diagram.Geometry.translate(i[n],-a.x,-a.y),s=t.datavisualization.Diagram.Geometry.translate(s,0,0),i[n]=s},scalePoints:function(e,i){var a,n,o,s,r=t.datavisualization.Diagram.Geometry.rect(i.points);if(r.width>0&&r.height>0)for(a=i.width/r.width,n=i.height/r.height,o=0,s=i.points.length;s>o;++o)e[o].x=e[o].x*a,e[o].y=e[o].y*n},sameSign:function(e,t){return e*t>=0},containsPoint:function(e,t){return e.x<=t.x&&t.x<=e.x+e.width&&e.y<=t.y&&t.y<=e.y+e.height},containsRect:function(e,t){return e.x<=t.x&&t.x+t.width<=e.x+e.width&&e.y<=t.y&&t.y+t.height<=e.y+e.height},inflate:function(e,t,i){e.x-=t,e.y-=i,e.width+=2*t,e.height+=2*i},isEmptyRect:function(e){return 0===e.x&&0===e.y&&0===e.width&&0===e.height},isEmptyPoint:function(e){return 0===e.x&&0===e.y},isEqualPoint:function(e,t){return e&&t&&e.x===t.x&&e.y===t.y},isEmptySize:function(e){return 0===e.width&&0===e.height},length:function(e){return t.datavisualization.Diagram.Geometry.distance(e.point1,e.point2)},midPoint:function(e){return t.datavisualization.Diagram.Point((e.point1.x+e.point2.x)/2,(e.point1.y+e.point2.y)/2)},transform:function(e,t,i){var a={};return a.x=Math.round(100*(e.x+i*Math.cos(t*Math.PI/180)))/100,a.y=Math.round(100*(e.y+i*Math.sin(t*Math.PI/180)))/100,a}},t.datavisualization.Diagram.LineSegment=function(e,t){return{point1:e,point2:t}},t.datavisualization.Diagram.Point=function(e,t){return{x:Number(e)||0,y:Number(t)||0}},t.datavisualization.Diagram.Size=function(e,t){return{width:Number(e)||0,height:Number(t)||0}},t.datavisualization.Diagram.Rectangle=function(e,t,i,a){return{x:Number(e)||0,y:Number(t)||0,width:Number(i)||0,height:Number(a)||0}},t.datavisualization.Diagram.ImageAlignment={None:"none",XMinYMin:"xminymin",XMinYMid:"xminymid",XMinYMax:"xminymax",XMidYMin:"xmidymin",XMidYMid:"xmidymid",XMidYMax:"xmidymax",XMaxYMin:"xmaxymin",XMaxYMid:"xmaxymid",XMaxYMax:"xmaxymax"},t.datavisualization.Diagram.ActiveTool={None:"none",Drag:"drag",Draw:"draw"},t.datavisualization.Diagram.ScaleConstraints={None:"none",Stretch:"stretch",Meet:"meet",Slice:"slice"},t.datavisualization.Diagram.KeyModifiers={None:0,Control:1,Meta:1,Alt:2,Shift:4},t.datavisualization.Diagram.Keys={None:"",Number0:0,Number1:1,Number2:2,Number3:3,Number4:4,Number5:5,Number6:6,Number7:7,Number8:8,Number9:9,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Left:37,Up:38,Right:39,Down:40,Escape:27,Delete:46,Tab:9,Enter:13},t.datavisualization.Diagram.LabelRenderingMode={Html:"html",Svg:"svg"},t.datavisualization.Diagram.TemplateType={Html:"html",Svg:"svg"},t.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"},t.datavisualization.Diagram.ConnectorType={StraightLine:"straightLine",OrthogonalLine:"orthogonalLine",Polyline:"polyline"},t.datavisualization.Diagram.ActionType={Unknown:"unknown",Nudge:"nudge",Touch:"touch",Mouse:"mouse",Order:"order",Align:"align",Size:"size",HistoryChange:"historyChange"},t.datavisualization.Diagram.dependentconnector={dependent:1,independent:2},t.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"},t.datavisualization.Diagram.IconShapes={Minus:"minus",Plus:"plus",ArrowUp:"arrowup",ArrowDown:"arrowdown",Template:"template",Path:"path",Image:"image",None:"none"},t.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"},t.datavisualization.Diagram.TickAlignment={LeftOrTop:"leftortop",RightOrBottom:"rightorbottom"},t.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8},t.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right",Justify:"justify"},t.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right",Stretch:"stretch"},t.datavisualization.Diagram.Alignment={Before:"before",After:"after",Center:"center"},t.datavisualization.Diagram.LabelRelativeMode={SegmentBounds:"segmentbounds",SegmentPath:"segmentpath"},t.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"},t.datavisualization.Diagram.RelativeMode={Object:"object",Mouse:"mouse"},t.datavisualization.Diagram.TextWrapping={NoWrap:"nowrap",Wrap:"wrap",WrapWithOverflow:"wrapwithoverflow"},t.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Stretch:"stretch"},t.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"},t.datavisualization.Diagram.PaletteConstraints={HeaderVisibility:2,Visible:4,Expandable:8,Default:14},t.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Drag:8,Rotate:16,Connect:32,ResizeNorthEast:64,ResizeEast:128,ResizeSouthEast:256,ResizeSouth:512,ResizeSouthWest:1024,ResizeWest:2048,ResizeNorthWest:4096,ResizeNorth:8192,Resize:16320,Shadow:16384,DragLabel:32768,AllowPan:65536,AspectRatio:131072,AllowDrop:262144,InheritTooltip:524288,MultiSelect:1048576,PointerEvents:2097152,PointerVisibility:2097152,CrispEdges:4194304,InheritCrispEdges:8388608,Interaction:16347,Default:11026430},t.datavisualization.Diagram.LabelConstraints={None:1,Selectable:2,Draggable:4,Resizable:8,Rotatable:16,All:30},t.datavisualization.Diagram.HistoryChangeCause={Undo:"undo",Redo:"redo",CustomAction:"customAction"},t.datavisualization.Diagram.CollectionChangeCause={ClipBoard:"clipBoard",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"},t.datavisualization.Diagram.GroupChangeCause={Group:"group",Ungroup:"ungroup",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"},t.datavisualization.Diagram.SelectionChangeCause={Keydown:"keydown",RubberBand:"rubberBand",Mouse:"mouse",Touch:"touch",Unknown:"unknown"},t.datavisualization.Diagram.ScrollChangeCause={Zoom:"zoom",Pan:"pan",Unknown:"unknown"},t.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,AllowDrop:1024,InheritTooltip:2048,PointerEvents:4096,PointerVisibility:4096,CrispEdges:8192,InheritCrispEdges:16384,DragLimit:32768,BridgeObstacle:65536,Interaction:122,Default:88702},t.datavisualization.Diagram.PortConstraints={None:1,Connect:2,ConnectOnDrag:4},t.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,Tooltip:16,DragOnEmptySpace:32,AutoHideThumbs:64,All:30},t.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"},t.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15},t.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"},t.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"},t.datavisualization.Diagram.BoundaryConstraints={Infinity:"infinity",Diagram:"diagram",Page:"page"},t.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"},t.datavisualization.Diagram.ObjectTypes={Diagram:"diagram",Palette:"palette",Lane:"lane",Group:"group"},t.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[],constraints:t.datavisualization.Diagram.PaletteConstraints.Default},t.datavisualization.Diagram.Palette=function(i){return i.items=i.items?i.items.slice():[],e.extend(!1,{},t.datavisualization.Diagram.PaletteDefaults,i)},t.datavisualization.Diagram.Shapes={Image:"image",Text:"text",Html:"html",Native:"native",Basic:"basic",Flow:"flow",Arrow:"arrow",BPMN:"bpmn"},t.datavisualization.Diagram.ClipBoardChangeType={All:"all",None:"none",Specific:"specific"},t.datavisualization.Diagram.OverflowType={Clip:"clip",Ellipsis:"ellipsis"},t.datavisualization.Diagram.ShapeDefaults={shape:"",source:"",pathData:"",textBlock:null,points:[],templateId:null,scale:"meet",contentAlignment:"xmidymid"},t.datavisualization.Diagram.Shape=function(i){return i&&(i.points=i.points?i.points.slice():[],"html"===i.type&&"string"==typeof i.html&&(i.html=t.datavisualization.Diagram.Util.htmlEncode(i.html)),"text"===i.type&&(i.textBlock=t.datavisualization.Diagram.TextBlock(i.textBlock?i.textBlock:{}),i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i.borderWidth=i.borderWidth?i.borderWidth:0),("image"==i.type||"native"==i.type||"text"===i.type||"html"===i.type)&&(i._shape=i.type),i._type||(i._type=i.type?i.type:"node"),i._shape||(i._shape=i.shape?i.shape:"rectangle"),i.points=i.points?i.points.slice():[]),e.extend(!1,{},t.datavisualization.Diagram.ShapeDefaults,i)},t.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"},t.datavisualization.Diagram.SegmentDefaults={type:t.datavisualization.Diagram.Segments.Straight,point:null,point1:null,point2:null,vector1:null,vector2:null,_point1:t.datavisualization.Diagram.Point(),_point2:t.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null},t.datavisualization.Diagram.Segment=function(i){var a,n=e.extend(!0,{},t.datavisualization.Diagram.SegmentDefaults,i);return n._bridges=n._bridges?n._bridges.slice():[],a=[],n.points=a,"orthogonal"==n.type?(n._length=n.length,n._direction=n.direction):("bezier"==n.type&&(n._point1=n.point1,n._point2=n.point2),n.point&&(n._point=n.point)),n},t.datavisualization.Diagram.DragLimitDefaults={top:10,left:10,right:10,bottom:10},t.datavisualization.Diagram.DragLimit=function(i){return e.extend(!0,{},t.datavisualization.Diagram.DragLimitDefaults,i)},t.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0},t.datavisualization.Diagram.Margin=function(i){return i=i||{},e.extend(!1,{},t.datavisualization.Diagram.MarginDefaults,i)},t.datavisualization.Diagram.EndPointHitPaddingDefaults={top:0,left:0,right:0,bottom:0},t.datavisualization.Diagram.EndPointHitPadding=function(e){return e=e||{},e.top=e.top||0,e.left=e.left||0,e.right=e.right||0,e.bottom=e.bottom||0,e},t.datavisualization.Diagram.GestureDefaults={key:t.datavisualization.Diagram.Keys.None,keyModifiers:t.datavisualization.Diagram.KeyModifiers.None},t.datavisualization.Diagram.Gesture=function(i){return e.extend(!0,{},t.datavisualization.Diagram.GestureDefaults,i)},t.datavisualization.Diagram.CommandDefaults={gesture:t.datavisualization.Diagram.Gesture(),execute:null,canExecute:null,parameter:null},t.datavisualization.Diagram.Command=function(i){return i.gesture&&(i.gesture=t.datavisualization.Diagram.Gesture(i.gesture)),i.canExecute||(i.canExecute=function(){return!0}),i.execute||(i.execute=function(){}),e.extend(!0,{},t.datavisualization.Diagram.CommandDefaults,i)},t.datavisualization.Diagram.TooltipDefaults={templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5},offset:null,delay:0},t.datavisualization.Diagram.Tooltip=function(i){return i.margin=i.margin||{},i.margin.top=void 0!==i.margin.top?i.margin.top:5,i.margin.left=void 0!==i.margin.left?i.margin.left:5,i.margin.right=void 0!==i.margin.right?i.margin.right:5,i.margin.bottom=void 0!==i.margin.bottom?i.margin.bottom:5,i.margin=t.datavisualization.Diagram.Margin(i.margin),i.alignment=i.alignment||{},i.alignment&&(i.alignment.horizontal=i.alignment.horizontal?i.alignment.horizontal:"center",i.alignment.vertical=i.alignment.vertical?i.alignment.vertical:"bottom"),e.extend(!1,{},t.datavisualization.Diagram.TooltipDefaults,i)},t.datavisualization.Diagram.BackgroundImageDefaults={source:"",alignment:"xmidymid",scale:"meet"},t.datavisualization.Diagram.BackgroundImage=function(i){return e.extend(!1,{},t.datavisualization.Diagram.BackgroundImageDefaults,i)},t.datavisualization.Diagram.Path=function(){this._path=""},t.datavisualization.Diagram.Path.prototype={moveTo:function(e,t){return this._path+="M"+e+","+t,this},lineTo:function(e,t){return this._path+="L"+e+","+t,this},cubicBezierTo:function(e,t){return this._path+=t?"S":"C",this._addPoints(e),this},quadraticBezierTo:function(e,t){return this._path+=t?"T":"Q",this._addPoints(e),this},ellipticalArcTo:function(e,t,i,a,n,o,s){return this._path+="A"+e+","+t+" "+i+" "+a+","+n+" "+o+","+s,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(e){for(var t,i=0;i<e.length;i++)t=e[i],this._path+=t.x+", "+t.y,i!==e.length-1&&(this._path+=" ")}},t.datavisualization.Diagram.DecoratorDefaults={shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",borderWidth:1,fillColor:"black",pathData:"",cssClass:""},t.datavisualization.Diagram.Decorator=function(i){return e.extend(!1,{},t.datavisualization.Diagram.DecoratorDefaults,i)},t.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:t.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",boundaryConstraints:!0,segmentOffset:.5,offset:t.datavisualization.Diagram.Point(.5,.5),textAlign:t.datavisualization.Diagram.TextAlign.Center,alignment:t.datavisualization.Diagram.Alignment.Center,relativeMode:t.datavisualization.Diagram.LabelRelativeMode.SegmentPath,horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,wrapping:t.datavisualization.Diagram.TextWrapping.WrapWithOverflow,margin:t.datavisualization.Diagram.Margin(),textOverflow:!1,overflowType:t.datavisualization.Diagram.OverflowType.Ellipsis,mode:t.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0,opacity:1,templateId:"",templateType:"html"},t.datavisualization.Diagram.TextBlock=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:.5),i.margin=t.datavisualization.Diagram.Margin(i.margin),void 0!==i.wrapText&&(i.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),e.extend(!1,{},t.datavisualization.Diagram.TextBlockDefaults,i)},t.datavisualization.Diagram.LabelDefaults=e.extend(!1,{},t.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent",cssClass:"",hyperlink:"",dragLimit:t.datavisualization.Diagram.DragLimit(),height:0,constraints:t.datavisualization.Diagram.LabelConstraints.None,_type:"label"}),t.datavisualization.Diagram.Label=function(i){i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:.5),i.dragLimit=t.datavisualization.Diagram.DragLimit(i.dragLimit),i.margin=t.datavisualization.Diagram.Margin(i.margin);var a=e.extend(!1,{},t.datavisualization.Diagram.LabelDefaults,i);return a.name||(a.name="label_"+t.datavisualization.Diagram.Util.randomId()),a},t.datavisualization.Diagram.serializationSettingsDefaults={preventDefaultValues:!1},t.datavisualization.Diagram.serializationSettings=function(i){return e.extend(!1,{},t.datavisualization.Diagram.serializationSettingsDefaults,i)},t.datavisualization.Diagram.ExportSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",stretch:"none"},t.datavisualization.Diagram.ExportSettings=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ExportSettingsDefaults,i)},t.datavisualization.Diagram.LayersDefaults={name:"",visible:!0,print:!0,active:!1,lock:!1,snap:!1,objects:[]},t.datavisualization.Diagram.Layers=function(i){return e.extend(!1,{},t.datavisualization.Diagram.LayersDefaults,i)},t.datavisualization.Diagram.PrintSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",margin:{left:0,top:0,right:0,bottom:0},region:"pageSettings"
},t.datavisualization.Diagram.PrintSettings=function(i){return i=i||{},i.margin=t.datavisualization.Diagram.Margin(i.margin),e.extend(!1,{},t.datavisualization.Diagram.PrintSettingsDefaults,i)},t.datavisualization.Diagram.IconDefaults={shape:t.datavisualization.Diagram.IconShapes.None,width:15,height:15,offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,margin:t.datavisualization.Diagram.Margin(),horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,cornerRadius:0,fillColor:"white",source:"",pathData:"",templateId:""},t.datavisualization.Diagram.expandIcon=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:1),i.margin=t.datavisualization.Diagram.Margin(i.margin),e.extend(!1,{},t.datavisualization.Diagram.IconDefaults,i)},t.datavisualization.Diagram.collapseIcon=function(i){return i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(void 0!==i.offset.x?i.offset.x:.5,void 0!==i.offset.y?i.offset.y:1),i.margin=t.datavisualization.Diagram.Margin(i.margin),e.extend(!1,{},t.datavisualization.Diagram.IconDefaults,i)},t.datavisualization.Diagram.PortDefaults={name:"",visibility:t.datavisualization.Diagram.PortVisibility.Default,constraints:t.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:t.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:t.datavisualization.Diagram.PortShapes.Square,pathData:"",connectorPadding:0,cssClass:"",margin:t.datavisualization.Diagram.Margin(),parent:""},t.datavisualization.Diagram.ShadowDefaults={distance:5,angle:45,opacity:.7},t.datavisualization.Diagram.Shadow=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ShadowDefaults,i)},t.datavisualization.Diagram.Port=function(i){i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x?i.offset.x:0,i.offset.y?i.offset.y:0),i.margin=t.datavisualization.Diagram.Margin(i.margin);var a=e.extend(!1,{},t.datavisualization.Diagram.PortDefaults,i);return a.name||(a.name="port_"+t.datavisualization.Diagram.Util.randomId()),a},t.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1},t.datavisualization.Diagram.Stop=function(i){return e.extend(!1,{},t.datavisualization.Diagram.StopDefaults,i)},t.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]},t.datavisualization.Diagram.LinearGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var a=0;i.stops&&a<i.stops.length;a++)i.stops[a]=t.datavisualization.Diagram.Stop(i.stops[a]);return e.extend(!1,{},t.datavisualization.Diagram.LinearGradientDefaults,i)},t.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]},t.datavisualization.Diagram.RadialGradient=function(i){i.stops=i.stops?i.stops.slice():[];for(var a=0;a<i.stops.length;a++)i.stops[a]=t.datavisualization.Diagram.Stop(i.stops[a]);return e.extend(!1,{},t.datavisualization.Diagram.RadialGradientDefaults,i)},t.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:-1,excludeFromLayout:!1,constraints:t.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],expandIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},collapseIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:t.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,connectorPadding:0,cornerRadius:0,paletteItem:null},t.datavisualization.Diagram.NodeBase=function(i){var a;if(i.labels=i.labels?i.labels.slice():[],i.ports=i.ports?i.ports.slice():[],i.inEdges=i.inEdges?i.inEdges.slice():[],i.outEdges=i.outEdges?i.outEdges.slice():[],i.expandIcon&&(i.expandIcon=t.datavisualization.Diagram.expandIcon(i.expandIcon?i.expandIcon:{})),i.collapseIcon&&(i.collapseIcon=t.datavisualization.Diagram.collapseIcon(i.collapseIcon?i.collapseIcon:{})),i.labels)for(a=0;a<i.labels.length;a++)i.labels[a]=t.datavisualization.Diagram.Label(i.labels[a]),t.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[a].constraints=t.datavisualization.Diagram.LabelConstraints.All&~t.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[a]._parent=i.name;if(i.ports)for(a=0;a<i.ports.length;a++)i.ports[a].parent=i.name,i.ports[a]=t.datavisualization.Diagram.Port(i.ports[a]);return i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),e.extend(!1,{},t.datavisualization.Diagram.NodeBaseDefaults,i)},t.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,type:t.datavisualization.Diagram.Shapes.Basic,isExpanded:!0,shadow:t.datavisualization.Diagram.Shadow(),cssClass:""},t.datavisualization.Diagram.Node=function(i){return i=i||{},i.pivot=i.pivot||{},i.pivot=t.datavisualization.Diagram.Point(void 0!==i.pivot.x?i.pivot.x:.5,void 0!==i.pivot.y?i.pivot.y:.5),i.container&&e.isEmptyObject(i.container)&&(i.container=null),(i.linearGradient||i.radialGradient)&&(i.gradient=i.linearGradient||i.radialGradient),i.gradient&&("linear"===i.gradient.type?i.gradient=t.datavisualization.Diagram.LinearGradient(i.gradient):"radial"===i.gradient.type&&(i.gradient=t.datavisualization.Diagram.RadialGradient(i.gradient))),i.shadow&&(i.shadow=t.datavisualization.Diagram.Shadow(i.shadow)),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i&&!i.name&&(i.name="node_"+t.datavisualization.Diagram.Util.randomId()),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.width||i._width||(i._width=i.minWidth?i.minWidth:i.maxWidth),i.height||i._height||(i._height=i.minHeight?i.minHeight:i.maxHeight),i._hidePorts&&(i.ports=[]),e.extend(!1,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i),t.datavisualization.Diagram.Shape(i))},t.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},shape:void 0,segments:[t.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:t.datavisualization.Diagram.Point(),targetPoint:t.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,constraints:t.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:-1,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:10,sourcePadding:0,targetPadding:0,type:"connector",cssClass:"",_endPointHitPadding:t.datavisualization.Diagram.EndPointHitPadding()},t.datavisualization.Diagram.Connector=function(i){if(i=i||{},i.labels=i.labels?i.labels.slice():[],i.segments=i.segments?i.segments.slice():[],i._endPointHitPadding=t.datavisualization.Diagram.EndPointHitPadding(i.endPointHitPadding),i.sourcePoint=i.sourcePoint||{},i.sourcePoint=t.datavisualization.Diagram.Point(void 0!==i.sourcePoint.x?i.sourcePoint.x:.5,void 0!==i.sourcePoint.y?i.sourcePoint.y:.5),i.targetPoint=i.targetPoint||{},i.targetPoint=t.datavisualization.Diagram.Point(void 0!==i.targetPoint.x?i.targetPoint.x:.5,void 0!==i.targetPoint.y?i.targetPoint.y:.5),i.name=i.name?i.name:t.datavisualization.Diagram.Util.randomId(),i.targetDecorator=t.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=t.datavisualization.Diagram.Decorator(i.sourceDecorator&&!e.isEmptyObject(i.sourceDecorator)?i.sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[t.datavisualization.Diagram.Segment({type:"straight"})],i._srcDecoratorSize=Math.max(parseInt(i.sourceDecorator.height),parseInt(i.sourceDecorator.width))+5*i.sourceDecorator.borderWidth,i._tarDecoratorSize=Math.max(parseInt(i.targetDecorator.height),parseInt(i.targetDecorator.width))+5*i.targetDecorator.borderWidth,i._inlineDecorators=[],i.segments&&(i.sourcePoint=i.sourcePoint||t.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType)),i.labels)for(var a=0;a<i.labels.length;a++)i.labels[a]=t.datavisualization.Diagram.Label(i.labels[a]),t.datavisualization.Diagram.Util.canMoveLabel(i)&&(i.labels[a].constraints=t.datavisualization.Diagram.LabelConstraints.All&~t.datavisualization.Diagram.LabelConstraints.Selectable),i.labels[a]._parent=i.name;return i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),e.extend(!1,{},t.datavisualization.Diagram.ConnectorDefaults,i)},t.datavisualization.Diagram.ContainerDefaults={type:t.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"},t.datavisualization.Diagram.Container=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ContainerDefaults,i)},t.datavisualization.Diagram.GroupDefaults={children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,type:"group"},t.datavisualization.Diagram.Group=function(i){return i=i?i:{},i.children=i.children?i.children.slice():[],"bpmn"==i.type&&(i=t.datavisualization.Diagram.Node(i)),i.minWidth=i.minWidth?i.minWidth:100,i.minHeight=i.minHeight?i.minHeight:100,i.maxWidth=i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,i.maxHeight=i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,i.container=i.container?t.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i=i||{},i.container&&e.isEmptyObject(i.container)&&(i.container=null),i&&!i.name&&(i.name="group_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i._type||"umlclassifier"==i.type||(i._type=i.type?i.type:"group"),e.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.GroupDefaults,t.datavisualization.Diagram.NodeBase(i))},t.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2},t.datavisualization.Diagram.Zoom=function(i){return e.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:t.datavisualization.Diagram.ZoomCommand.ZoomIn},i)},t.datavisualization.Diagram.DragState={Starting:"starting",Dragging:"dragging",Completed:"completed"},t.datavisualization.Diagram.ResizeState={Starting:"starting",Resizing:"resizing",Completed:"completed"},t.datavisualization.Diagram.DiagramConstraints={None:1,UserInteraction:2,APIUpdate:4,PageEditable:6,Bridging:8,Zoomable:16,PannableX:32,PannableY:64,Pannable:96,Undoable:128,Resizable:256,ZoomTextEditor:512,FloatElements:1024,CrispEdges:2048,Default:502},t.datavisualization.Diagram.BridgeDirection={Top:"top",Bottom:"bottom",Left:"left",Right:"right"},t.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32},t.datavisualization.Diagram.Region={Content:"content",PageSettings:"pageSettings"},t.datavisualization.Diagram.FileFormats={JPG:"jpg",PNG:"png",BMP:"bmp",SVG:"svg"},t.datavisualization.Diagram.ExportModes={Download:"download",Data:"data"},t.datavisualization.Diagram.FitMode={Page:"page",Width:"width",Height:"height"},t.datavisualization.Diagram.Stretch={None:"none",Fill:"fill",Uniform:"uniform",UniformToFill:"uniformtofill"},t.datavisualization.Diagram.shapeType={Image:"image",Path:"path",Native:"native"},t.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",templateId:"",source:"",shape:t.datavisualization.Diagram.shapeType.Path,borderColor:"",backgroundColor:"#2382c3",position:"",offset:t.datavisualization.Diagram.Point(.5,1),margin:{left:0,right:0,top:0,bottom:-25},horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1},t.datavisualization.Diagram.UserHandle=function(i){return e.extend(!0,{},t.datavisualization.Diagram.UserHandleDefaults,i)},t.datavisualization.Diagram.SwimLaneDefaults={header:e.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Title",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),fillColor:"transparent",orientation:"vertical",type:"group",isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,height:100,width:100,lanes:[],phases:[],phaseSize:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),addInfo:{},cssClass:""},t.datavisualization.Diagram.SwimLane=function(i){return i=i||{},i.lanes=i.lanes?i.lanes.slice():[],i.phases=i.phases?i.phases.slice():[],i&&!i.name&&(i.name="swimlane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.header||(i.header={}),i.header.height=void 0!=i.header.height?i.header.height:50,i.header.width=void 0!=i.header.width?i.header.width:50,e.extend(!0,{},t.datavisualization.Diagram.SwimLaneDefaults,i)},t.datavisualization.Diagram.LaneDefaults={header:e.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Function",borderColor:"black",fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch,width:50,height:50}),name:"",children:[],isLane:!0,orientation:"horizontal",fillColor:"#f5f5f5",labels:[],addInfo:{},minHeight:100,minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:""},t.datavisualization.Diagram.Lane=function(i){return i=i||{},i.labels=i.labels?i.labels.slice():[],i.children=i.children?i.children.slice():[],i&&!i.name&&(i.name="lane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),e.extend(!0,{},t.datavisualization.Diagram.LaneDefaults,i)},t.datavisualization.Diagram.PhaseDefaults={name:"",type:"phase",offset:100,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",parent:"",fillColor:"white",orientation:"horizontal",label:{text:"Phase"}},t.datavisualization.Diagram.Phase=function(i){return i.label&&(i.label=t.datavisualization.Diagram.Label(i.label),i._UndoRedo||i._isUndo||(i.label.text=i.label.text?i.label.text:"Phase")),e.extend(!0,{},t.datavisualization.Diagram.PhaseDefaults,i)},t.datavisualization.Diagram.PaletteItemDefaults={width:void 0,height:void 0,enableScale:!0,previewHeight:void 0,previewWidth:void 0,wrapping:t.datavisualization.Diagram.TextWrapping.NoWrap,label:null,margin:t.datavisualization.Diagram.Margin({left:4,right:4,top:4,bottom:4})},t.datavisualization.Diagram.PaletteItem=function(i){return i.margin=i.margin||{},i.margin.left=void 0!==i.margin.left?i.margin.left:4,i.margin.right=void 0!==i.margin.right?i.margin.right:4,i.margin.top=void 0!==i.margin.top?i.margin.top:4,i.margin.bottom=void 0!==i.margin.bottom?i.margin.bottom:4,i.margin=t.datavisualization.Diagram.Margin(i.margin),e.extend(!1,{},t.datavisualization.Diagram.PaletteItemDefaults,i)},t.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(i,a,n){var o,s,r,l,d,h,c=null,u=null,i=t.datavisualization.Diagram.SwimLane(i);i.orientation=i.orientation?i.orientation:"vertical",o=this._initphases(i,a),u=this._initLanes(i,a,n),s=[],r=null,i.header||(i.header={text:"",height:0,fillColor:"white"}),"horizontal"===i.orientation?l=i.header.height:d=i.header.width,i.header&&(r=t.datavisualization.Diagram.Node({_type:"node",_isHeader:!0,name:i.name+"_header_swimlane",labels:[i.header],height:l?l:50,width:d?d:50,fillColor:i.header.fillColor?i.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name})),r&&(a.nodes().push(r),a._nodes=e.extend(!0,[],a.nodes()),a.nameTable[r.name]=r,s.push(r.name)),h=null,h=0==i.phaseSize?.001:i.phaseSize?i.phaseSize:20;var g=(this._initPhaseStack(i,a,s,h),null),m=null;"vertical"==i.orientation?m="stretch":g="stretch";var p,f=0,v=0,_=0;"horizontal"==i.orientation?(p="vertical",v=(i.header?i.header.height:50)+h,_=0):(p="horizontal",v=i.header?i.header.height:50,f=i.phaseSize?i.phaseSize:h,_=(i.header?i.header.height:50)+h);var y=t.datavisualization.Diagram.Group({name:i.name+"_stack",children:u,parent:i.name,container:{type:t.datavisualization.Diagram.ContainerType.Stack,orientation:p},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:v,width:10,height:10,marginLeft:f,minHeight:_,constraints:t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect)}),b=0,x=0;return"horizontal"==i.orientation?(b=i.width,x=100):"vertical"==i.orientation&&(b=100,x=i.height-r.height),a.nodes().push(y),a._nodes=e.extend(!0,[],a.nodes()),a.nameTable[y.name]=y,s.push(y.name),c=t.datavisualization.Diagram.Group({name:i.name?i.name:"",type:"group",addInfo:i.addInfo?i.addInfo:{},parent:"",offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,children:s,zOrder:i.zOrder||0===i.zOrder?i.zOrder:-1,fillColor:"transparent",labels:[{mode:t.datavisualization.Diagram.LabelEditMode.View}],container:{type:t.datavisualization.Diagram.ContainerType.Canvas},minHeight:x?x:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:b?b:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.AllowDrop^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,phaseSize:h,cssClass:i.cssClass}),c.isSwimlane=!0,c.phases=o,c.orientation=i.orientation,c.constraints="horizontal"==c.orientation?c.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:c.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast,c},_initPhaseStack:function(i,a,n,o){var s,r,l,d,h,c="horizontal",u="left",g="top";c&&("horizontal"==i.orientation?(c="horizontal",u="stretch",s=!0):(c="vertical",g="stretch",s=!1));var m=t.datavisualization.Diagram.Group({name:i.name+"phaseStack",container:{type:"stack",orientation:c},type:"group",parent:i.name,offsetX:0,offsetY:0,minHeight:o,maxHeight:o,minWidth:o,maxWidth:o,marginTop:i.header?i.header.height:50,isPhaseStack:!0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),p=0;for(i.phaseSize&&(i.phaseSize=i.phaseSize<1?20:i.phaseSize),d=0;d<i.phases.length;d++)s?(r=i.phaseSize?i.phaseSize:20,l=i.phases[d].offset-p):(r=i.phases[d].offset-p,0==d&&(r-=i.header?i.header.height:50),l=i.phaseSize?i.phaseSize:20,i.phases[d].label&&(i.phases[d].label.rotateAngle=270)),h=t.datavisualization.Diagram.Node({parent:i.name+"phaseStack",_isHeader:!0,name:"phaseStack"+i.phases[d].name,height:r,width:l,labels:[i.phases[d].label],constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),h.labels[0].name="phaseStack"+i.phases[d].name+"label",h.labels[0].mode=t.datavisualization.Diagram.LabelEditMode.View,h.isPhase=!0,p=i.phases[d].offset,a.nameTable[h.name]=h,m.children.push(h.name),a.nodes().push(h),a._nodes=e.extend(!0,[],a.nodes());a.nodes().push(m),a._nodes=e.extend(!0,[],a.nodes()),n.push(m),a.nameTable[m.name]=m},_setDefaultLaneProperties:function(e){e.lanes=e.lanes?e.lanes:[],e.lanes.push(t.datavisualization.Diagram.Lane({}))},_initLanes:function(i,a,n){var o,s=[],r=null;if(i.lanes&&0!==i.lanes.length||this._setDefaultLaneProperties(i),i.lanes)for(o=0;o<i.lanes.length;o++)jQuery.isEmptyObject(i.lanes[o])&&(i.lanes[o]=t.datavisualization.Diagram.Lane()),i.lanes[o]._laneHeader=i.lanes[o]._laneHeader?i.lanes[o]._laneHeader:i.lanes[o].header,r=this._initLane(i.lanes[o],i,a,n),s.push(r.name),a.nodes().push(r),a._nodes=e.extend(!0,[],a.nodes()),a.nameTable[r.name]=r;return s},_initLane:function(i,a,n,o){var s,r,l,d,h,c,u,g=null,m=null;if("horizontal"==a.orientation?g="stretch":m="stretch",s=!1,r=t.datavisualization.Diagram.Group({name:i.name,addInfo:i.addInfo?i.addInfo:{},type:"group",isLane:!0,parent:a.name+"_stack",offsetX:0,offsetY:0,borderColor:i.borderColor?i.borderColor:"black",orientation:a.orientation?a.orientation:"horizontal",fillColor:i.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:g?g:"left",verticalAlign:m?m:"top",minHeight:i.height?i.height:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:i.width?i.width:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass}),i.labels&&i.labels.length>0){for(l=0;l<i.labels.length;l++)i.labels[l]=t.datavisualization.Diagram.Label(i.labels[l]);r.labels=i.labels}for(o||(d=i._laneHeader?i._laneHeader:null,h=this._iniLaneHeader(i,r.name,a,n,d),h&&(n.nodes().push(h),n._nodes=e.extend(!0,[],n.nodes()),n.nameTable[h.name]=h,r.children.push(h.name))),c=this._initChildren(i,r.name,n),u=0;u<c.length;u++)r.children.push(c[u]);return r},_iniLaneHeader:function(e,i,a,n,o){var s=null;return e.header&&(s=t.datavisualization.Diagram.Node({_isHeader:!0,name:i+"_Headerr_",type:"node",labels:[a.header],height:o.height?o.height:50,width:o.width?o.width:50,fillColor:e.header.fillColor?e.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),a.orientation&&"horizontal"==a.orientation?(s.verticalAlign="stretch",s.height=1,s.width=o.width?o.width:50):a.orientation&&"vertical"==a.orientation&&(s.horizontalAlign="stretch",s.labels[0].rotateAngle=0,s.height=o.width?o.width:50,s.width=1)),s},_initChildren:function(t,i,a){var n,o,s=[],r=null;if(t.children)for(n=0;n<t.children.length;n++)r="object"==typeof t.children[n]?t.type&&"bpmn"===t.type?t.children[n]:this._initChild(t.children[n],i,a):a.nameTable[a._getChild(t.children[n])],r&&(r.segments?(a.connectors().push(r),a._connectors=e.extend(!0,[],a.connectors())):(r.children&&(o=this._initChildren(r,r.name,a)),o&&(r.children=o),a.nodes().push(r),a._nodes=e.extend(!0,[],a.nodes())),s.push(r.name),a.nameTable[r.name]=r);return s},_initChild:function(e,i,a){var n=null;return n=e&&e.children&&e.children.length>0?a._getNewGroup(t.datavisualization.Diagram.NodeType(e,a)):a._getNewNode(t.datavisualization.Diagram.NodeType(e,a)),n.parent=i,n},_swapPhaseSize:function(e){if(e.phases.length>0)for(var t,i,a=e.phases,n=0;n<a.length;n++)for(t=0;t<a.length-n-1;t++)a[t].offset>a[t+1].offset&&(i=a[t],a[t]=a[t+1],a[t+1]=i)},_setSwimlaneSize:function(e){var t,i;if(e.phases.length>0)for(i in e.phases)t=e.phases[i],"horizontal"===e.orientation?t.offset>e.width&&(e.width=t.offset):t.offset>e.height&&(e.height=t.offset)},_setLastPhaseSize:function(e){if(e.phases.length>0){var t=e.phases[e.phases.length-1];t.offset="horizontal"===e.orientation?e.width:e.height}},_NeedDefaultPhase:function(e){return!(e.phases.length>0)},_checkForDefPhase:function(e){return!(e.phases.length>0)},_initphases:function(e,i){var a,n,o=[],s=null,r=0,l=0;if("vertical"===e.orientation?(l=e.height,r=270):l=e.width,a=t.datavisualization.Diagram.Phase({name:e.name+"defPhase",offset:l,label:e._lastPhase?e._lastPhase.labels[0]:{text:"Phase",rotateAngle:r}}),this._NeedDefaultPhase(e)?e.phases.push(a):(this._swapPhaseSize(e),this._setSwimlaneSize(e),this._setLastPhaseSize(e)),e.phases&&e.phases.length>0)for(n=0;n<e.phases.length;n++)s=t.datavisualization.Diagram.Phase(e.phases[n]),s.parent=e.name,s.orientation=e.orientation,i.nameTable[s.name]=s,o.push(s.name);return o},_createSwimlane:function(e,i,a,n,o){var s,r,l,d,h=[],c=a?a.childTable:i.nameTable,u=500,g=500,m=null,p=e.constraints?e.constraints:t.datavisualization.Diagram.NodeConstraints.Default;return e.children[0]?(s=n?e.children[0]:c[i._getChild(e.children[0])],s||(s=o),"string"==typeof s&&(s=c[s]),m={text:"Title",width:50,fillColor:s.fillColor?s.fillColor:e.fillColor,height:50}):m={text:"Title",width:50,fillColor:"white",height:50},e.orientation||e.container&&(e.orientation=e.container.orientation),r=0,"horizontal"==e.orientation&&i._selectedSymbol?(u=e.height?e.height:100,g=e.width?e.width:650,r=u):(u=e.height?e.height:650,g=e.width?e.width:100,r=e.height+m.height),e.children.length>1&&(e.children.splice(0,1),h=e.children),l={name:e.name+t.datavisualization.Diagram.Util.randomId(),header:m,fillColor:"white",isSwimlane:!0,minWidth:g,minHeight:u,height:r+1,width:g+1,maxHeight:u+Number.POSITIVE_INFINITY,maxWidth:g+Number.POSITIVE_INFINITY,offsetX:e.offsetX,offsetY:e.offsetY,orientation:e.orientation?e.orientation:"horizontal",addInfo:e.addInfo?e.addInfo:null,paletteItem:e.paletteItem?e.paletteItem:null,lanes:[{name:e.name,addInfo:e.addInfo?e.addInfo:{},constraints:p,header:{text:s.labels[0].text||""===s.labels[0].text?s.labels[0].text:"HEADER",fontSize:s.labels[0].fontSize?s.labels[0].fontSize:11,width:s.width?s.width:50,height:s.height?s.height:50,fillColor:s.fillColor,bold:!!s.labels[0].bold,italic:!!s.labels[0].italic,fontFamily:s.labels[0].fontFamily?s.labels[0].fontFamily:"Arial",fontColor:s.labels[0].fontColor?s.labels[0].fontColor:"black"},fillColor:e.fillColor?e.fillColor:"white",height:u,width:g,minHeight:u,minWidth:g,children:h?h:[],_laneHeader:e._laneHeader?e._laneHeader:null}]},d=t.datavisualization.Diagram.ContainerHelper._initContainer(i,l)},_createDiagramLane:function(e){var i=e._lane?e._lane:null,a=e.orientation,n=e.constraints?e.constraints:t.datavisualization.Diagram.NodeConstraints.Default,o={children:[{name:e.name+"_Headerr_",height:i.header?i.header.height:50,width:i.header?i.header.width:50,fillColor:i.header?i.header.fillColor:50,labels:i.header?[i.header]:[],horizontalAlign:"vertical"===a?"stretch":"left",verticalAlign:"vertical"===a?"top":"stretch"}],container:{type:"canvas"},name:e.name?e.name:t.datavisualization.Diagram.Util.randomId(),minHeight:i.minHeight?i.minHeight:100,minWidth:i.minWidth?i.minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,borderColor:"black",constraints:n|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass?i.cssClass:"",addInfo:i.addInfo?i.addInfo:null,paletteItem:e.paletteItem?e.paletteItem:null,fillColor:i.fillColor?i.fillColor:"white",isLane:!0,offsetX:e.offsetX?e.offsetX:100,offsetY:e.offsetY?e.offsetY:100,orientation:a?a:"horizontal"};return o.children[0].labels[0].rotateAngle="horizontal"===a?270:0,o},_createPaletteLane:function(e,i){var a,n,o,s,r,l=0,d=0,h=0,c=0,u=0,g="left",m=0;return e=t.datavisualization.Diagram.Lane(e),a=e.constraints?e.constraints:t.datavisualization.Diagram.NodeConstraints.Default,!e.paletteItem||e.paletteItem.enableScale||e.paletteItem.width||"horizontal"===e.orientation&&(m+=2),"horizontal"==e.orientation?(l=e.height?e.height:50,d=25,h=14+m,c=l/2+1,u=270,g="left"):"vertical"==e.orientation&&(l=25,d=e.width?e.width:50,h=d/2,c=15,g="left"),n=e.header.text?e.header.text:"",o=t.datavisualization.Diagram.Node({name:e.name+"_"+n,_type:"node",labels:[{text:e.header.text?e.header.text:"Function",fontSize:e.header.fontSize?e.header.fontSize:11,offset:{x:.5,y:.5},width:100,rotateAngle:u}],height:l,width:d,fillColor:e.header.fillColor?e.header.fillColor:"white",parent:e.name,offsetX:h,offsetY:c,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Connect}),i[o.name]=o,"horizontal"==e.orientation?(l=e.height,d=e.width-25,h=25+d/2+m,c=l/2+1):"vertical"==e.orientation&&(l=e.height-25,d=e.width,h=d/2,c=25+l/2),s=t.datavisualization.Diagram.Node({name:e.name+"content",_type:"node",height:l,width:d,fillColor:e.fillColor?e.fillColor:"white",parent:e.name,offsetX:h,offsetY:c}),s._laneHeader=e.header,i[s.name]=s,r=t.datavisualization.Diagram.Group({name:e.name+"_group",addInfo:e.addInfo?e.addInfo:{},height:e.height,width:e.width,header:e.header?e.header:null,offsetX:e.offsetX,offsetY:e.offsetY,children:[o.name,s.name],paletteItem:e.paletteItem?e.paletteItem:null}),r._lane=e,r.constraints=a,r.isLane=!0,r.orientation=e.orientation,r},_mapObject:function(e,t,i,a){var n;switch(i){case"lane":n=this._mapLane(e,t);break;case"phase":n=this._mapPhase(e,t);break;case"swimlane":n=this._mapSwimlane(e,t,a)}return n},_mapLane:function(e,i,a){var n=t.datavisualization.Diagram.Lane();return this._mapLaneHeader(e,i,n,a),this._mapChildren(e,i,n,a),n.name=i.name,n.labels=i.labels,n.fillColor=i.fillColor,n.orientation=i.orientation,n.maxHeight=i.maxHeight,n.maxWidth=i.maxWidth,n.minHeight=i.height>i.minHeight?i.height:i.minHeight,n.minWidth=i.width>i.minWidth?i.width:i.minWidth,n.constraints=i.constraints,n.addInfo=i.addInfo?i.addInfo:{},"horizontal"===i.orientation?(n.height=i.height,n.width=null):(n.height=null,n.width=i.width),n},_mapLaneHeader:function(e,t,i,a){var n;t.children[0]&&(n=e.nameTable[e._getChild(t.children[0])]),!n&&a&&(n=a[e._getChild(t.children[0])]),n&&(n.labels&&n.labels[0]&&(n.name&&(i.header.name=n.name),i.header.text=n.labels[0].text,
i.header.fontColor=n.labels[0].fontColor,i.header.fontSize=n.labels[0].fontSize,i.header.fontFamily=n.labels[0].fontFamily,i.header.bold=n.labels[0].bold,i.header.italic=n.labels[0].italic,i.header.textDecoration=n.labels[0].textDecoration,i.header.rotateAngle=n.labels[0].rotateAngle,i.header.textOverflow=n.labels[0].textOverflow,i.header.overflowType=n.labels[0].overflowType,n.labels[0].name&&(i.header._labelName=n.labels[0].name)),i.header.fillColor=n.fillColor,"vertical"===t.orientation?(i.header.height=n.height,i.header.width=null):(i.header.height=null,i.header.width=n.width))},_mapChildren:function(e,t,i,a){var n,o;if(t.children&&t.children.length>=2)for(o=1;o<t.children.length;o++)e._getChild(t.children[o])&&(n=e.nameTable[e._getChild(t.children[o])]),a&&!n&&(n=a[e._getChild(t.children[o])]),n&&(n.marginRight=0,n.marginBottom=0,i.children.push(n))},_mapSwimlane:function(e,i,a){var n=t.datavisualization.Diagram.SwimLane();return this._mapSwimlaneHeader(e,i,n,a),this._mapLanes(e,i,n,a),this._mapPhases(e,i,n,a),n.name=i.name,n.orientation=i.orientation,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.maxHeight=i.maxHeight,n.maxWidth=i.maxWidth,n.minHeight=i.minHeight,n.minWidth=i.minWidth,n.minWidth="horizontal"===n.orientation&&i.width&&i.minWidth&&i.width>i.minWidth?i.width:i.minWidth,n.phaseSize=i.phaseSize,n.constraints=i.constraints,n.zOrder=i.zOrder,n.addInfo=i.addInfo?i.addInfo:{},n.height=i.height,n.width=i.width,n},_mapSwimlaneHeader:function(e,t,i,a){if(t.children[0])var n=e.nameTable[e._getChild(t.children[0])];!n&&a&&(n=a[e._getChild(t.children[0])]),n&&(n.labels&&n.labels[0]&&(i.header.text=n.labels[0].text,i.header.fontColor=n.labels[0].fontColor,i.header.fontSize=n.labels[0].fontSize,i.header.fontFamily=n.labels[0].fontFamily,i.header.bold=n.labels[0].bold,i.header.italic=n.labels[0].italic,i.header.textDecoration=n.labels[0].textDecoration,i.header.textOverflow=n.labels[0].textOverflow,i.header.overflowType=n.labels[0].overflowType),i.header.fillColor=n.fillColor,i.header.height=n.height,i.header.width=n.width)},_mapLanes:function(e,t,i,a){var n,o,s,r;if(t.children[2]&&e._getChild(t.children[2])&&(n=a?a[e._getChild(t.children[2])]:e.nameTable[e._getChild(t.children[2])]),n&&n.children&&n.children.length>0)for(r=0;r<n.children.length;r++)e._getChild(n.children[r])&&(o=a?a[e._getChild(n.children[r])]:e.nameTable[e._getChild(n.children[r])]),o&&(s=this._mapLane(e,o,a),s&&i.lanes.push(s))},_mapPhases:function(e,i,a,n){var o,s,r,l,d,h=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i,n);if(h&&h.length>0){for(o=h.length,s=n?n:e.nameTable,h[h.length-1]&&s[h[h.length-1]]&&(r=s[h[h.length-1]],r.name.split("defPhase").length>1||r.offset==i.width||o++),l=0;o>l;l++)d=this._mapPhase(e,s[e._getChild(h[l])],n),d&&a.phases.push(d);s["phaseStack"+h[h.length-1]]&&(a._lastPhase=this._mapPhase(e,s["phaseStack"+h[h.length-1]],n))}},_mapPhase:function(e,t,i){var a;return t&&(a=i?i[t.name]:e.nameTable[t.name]),a?a:null},_getSwimLaneNode:function(e,t,i,a){if(e.isSwimlane)if(i){if(a.nameTable[a._getChild(e.children[2])].container.orientation==t.orientation)return e}else if(a.nameTable[a._getChild(e.children[2])].container.orientation!=t.orientation)return e;if(e.parent){var n=a.nameTable[e.parent];if(n)return this._getSwimLaneNode(n,t,void 0,a)}return null}}}(jQuery,Syncfusion),function(e,t){"use strict";t.datavisualization.Diagram.BasicShapes={Rectangle:"rectangle",Ellipse:"ellipse",Path:"path",Polygon:"polygon",Triangle:"triangle",Plus:"plus",Star:"star",Pentagon:"pentagon",Heptagon:"heptagon",Octagon:"octagon",Trapezoid:"trapezoid",Decagon:"decagon",RightTriangle:"righttriangle",Cylinder:"cylinder"},t.datavisualization.Diagram.FlowShapes={Process:"process",Decision:"decision",Document:"document",PreDefinedProcess:"predefinedprocess",Terminator:"terminator",PaperTap:"papertap",DirectData:"directdata",SequentialData:"sequentialdata",Sort:"sort",MultiDocument:"multidocument",Collate:"collate",SummingJunction:"summingjunction",Or:"or",InternalStorage:"internalstorage",Extract:"extract",ManualOperation:"manualoperation",Merge:"merge",OffPageReference:"offpagereference",SequentialAccessStorage:"sequentialaccessstorage",Annotation1:"annotation1",Annotation2:"annotation2",Data:"data",Card:"card"},t.datavisualization.Diagram.ArrowShapes={None:"none",CircularArrow:"circulararrow",CurvedRightArrow:"curvedrightarrow",CurvedUpArrow:"curveduparrow",CurvedLeftArrow:"curvedleftarrow",CurvedDownArrow:"curveddownarrow",JumpingRightArrow:"jumpingrightarrow",JumpingLeftArrow:"jumpingleftarrow"},t.datavisualization.Diagram.BPMNShapes={Event:"event",Gateway:"gateway",Message:"message",DataObject:"dataobject",DataSource:"datasource",Activity:"activity",Group:"group"},t.datavisualization.Diagram.BPMNEvents={Start:"start",Intermediate:"intermediate",End:"end",NonInterruptingStart:"noninterruptingstart",NonInterruptingIntermediate:"noninterruptingintermediate",ThrowingIntermediate:"throwingintermediate"},t.datavisualization.Diagram.BPMNTriggers={None:"none",Message:"message",Timer:"timer",Escalation:"escalation",Link:"link",Error:"error",Compensation:"compensation",Signal:"signal",Multiple:"multiple",Parallel:"parallel",Cancel:"cancel",Conditional:"conditional",Terminate:"terminate"},t.datavisualization.Diagram.BPMNGateways={None:"none",Exclusive:"exclusive",Inclusive:"inclusive",Parallel:"parallel",Complex:"complex",EventBased:"eventbased",ExclusiveEventBased:"exclusiveeventbased",ParallelEventBased:"paralleleventbased"},t.datavisualization.Diagram.BPMNDataObjects={None:"none",Input:"input",Output:"output"},t.datavisualization.Diagram.BPMNActivity={None:"none",Task:"task",SubProcess:"subprocess"},t.datavisualization.Diagram.BPMNLoops={None:"none",Standard:"standard",ParallelMultiInstance:"parallelmultiinstance",SequenceMultiInstance:"sequencemultiinstance"},t.datavisualization.Diagram.BPMNTasks={None:"none",Service:"service",Receive:"receive",Send:"send",InstantiatingReceive:"instantiatingreceive",Manual:"manual",BusinessRule:"businessrule",User:"user",Script:"script",Parallel:"parallel"},t.datavisualization.Diagram.BPMNSubProcessTypes={None:"none",Transaction:"transaction",Event:"event"},t.datavisualization.Diagram.BPMNBoundary={Default:"default",Call:"call",Event:"event"},t.datavisualization.Diagram.BPMNAnnotationDirections={Top:"top",Left:"left",Right:"right",Bottom:"bottom"},t.datavisualization.Diagram.BPMNFlows={Sequence:"sequence",Association:"association",Message:"message"},t.datavisualization.Diagram.BPMNSequenceFlows={Normal:"normal",Conditional:"conditional",Default:"default"},t.datavisualization.Diagram.BPMNMessageFlows={Default:"default",InitiatingMessage:"initiatingmessage",NonInitiatingMessage:"noninitiatingmessage"},t.datavisualization.Diagram.ClassifierShapes={Package:"package",Class:"class",Interface:"interface",Enumeration:"enumeration",CollapsedPackage:"collapsedpackage",Inheritance:"inheritance",Association:"association",Aggregation:"aggregation",Composition:"composition",Realization:"realization",DirectedAssociation:"directedassociation",Dependency:"dependency"},t.datavisualization.Diagram.AssociationFlows={Default:"default",Directional:"directional",BiDirectional:"bidirectional"},t.datavisualization.Diagram.UMLActivityShapes={Action:"action",Decision:"decision",MergeNode:"mergenode",InitialNode:"initialnode",FinalNode:"finalnode",ForkNode:"forknode",JoinNode:"joinnode",TimeEvent:"timeevent",AcceptingEvent:"acceptingevent",SendSignal:"sendsignal",ReceiveSignal:"receivesignal",StructuredNode:"structurednode",Note:"note"},t.datavisualization.Diagram.UMLActivityFlow={Object:"object",Control:"control",Exception:"exception"},t.datavisualization.Diagram.BPMNEventDefaults={event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.None,name:null,offset:t.datavisualization.Diagram.Point(),ports:[],labels:[]},t.datavisualization.Diagram.BPMNGatewayDefaults={gateway:t.datavisualization.Diagram.BPMNGateways.None},t.datavisualization.Diagram.BPMNDataObject=function(i){return e.extend(!1,{},{type:t.datavisualization.Diagram.BPMNDataObjects.None,collection:!1},i)},t.datavisualization.Diagram.BPMNDataObjectDefaults={data:t.datavisualization.Diagram.BPMNDataObject()},t.datavisualization.Diagram.BPMNTaskDefaults={loop:t.datavisualization.Diagram.BPMNLoops.None,type:t.datavisualization.Diagram.BPMNTasks.None,call:!1,compensation:!1,events:[]},t.datavisualization.Diagram.BPMNTask=function(i){return i&&(i.events=i.events?i.events.slice():[]),e.extend(!1,{},t.datavisualization.Diagram.BPMNTaskDefaults,i)},t.datavisualization.Diagram.BPMNSubProcessDefaults={type:t.datavisualization.Diagram.BPMNSubProcessTypes.None,event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.Message,boundary:t.datavisualization.Diagram.BPMNBoundary.Default,loop:t.datavisualization.Diagram.BPMNLoops.None,adhoc:!1,compensation:!1,collapsed:!0,events:[],processes:[]},t.datavisualization.Diagram.BPMNSubProcess=function(i){return i=i||{},i.events=i.events?i.events.slice():[],i.processes=i.processes?i.processes.slice():[],e.extend(!1,{},t.datavisualization.Diagram.BPMNSubProcessDefaults,i)},t.datavisualization.Diagram.BPMNActivityDefaults={activity:t.datavisualization.Diagram.BPMNActivity.Task,task:t.datavisualization.Diagram.BPMNTask(),subProcess:t.datavisualization.Diagram.BPMNSubProcess()},t.datavisualization.Diagram.BPMNTextAnnotationDefaults={annotation:{width:20,height:20,angle:0,length:0,text:"",direction:t.datavisualization.Diagram.BPMNAnnotationDirections.Left}},t.datavisualization.Diagram.ConnectorShapeDefaults={type:"bpmn",flow:t.datavisualization.Diagram.BPMNFlows.Sequence,sequence:t.datavisualization.Diagram.BPMNSequenceFlows.Normal,association:t.datavisualization.Diagram.AssociationFlows.Default,message:t.datavisualization.Diagram.BPMNMessageFlows.Default},t.datavisualization.Diagram.Multiplicity={OneToOne:"onetoone",OneToMany:"onetomany",ManyToOne:"manytoone",ManyToMany:"manytomany"},t.datavisualization.Diagram.ClassifierMultiplicityDefault={type:t.datavisualization.Diagram.Multiplicity.OneToOne,source:{optional:!0,lowerBounds:null,upperBounds:null},target:{optional:!0,lowerBounds:null,upperBounds:null}},t.datavisualization.Diagram.UMLActivityFlowDefaults={type:"umlactivity",activityFlow:t.datavisualization.Diagram.UMLActivityFlow.Control},t.datavisualization.Diagram.AssociationDefaults={type:"classifier",association:t.datavisualization.Diagram.AssociationFlows.BiDirectional,multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.AggregationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.CompositionDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.DependencyDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.RealizationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.InheritanceDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicityDefault},t.datavisualization.Diagram.ScopeValueDefaults={Public:"public",Protected:"",Private:"",Package:""},t.datavisualization.Diagram.ClassMemberDefaults={name:"",value:""},t.datavisualization.Diagram.ClassAttributeDefaults={name:"",type:"",scope:t.datavisualization.Diagram.ScopeValueDefaults.Public},t.datavisualization.Diagram.ClassMethodsArgumentsDefault={name:"",type:""},t.datavisualization.Diagram.ClassMethodsDefaults={name:"",type:"",arguments:t.datavisualization.Diagram.ClassMethodsArgumentsDefault,scope:t.datavisualization.Diagram.ScopeValueDefaults.Public},t.datavisualization.Diagram.ClassmethodArguments=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ClassMethodsArgumentsDefault,i)},t.datavisualization.Diagram.ClassMethod=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ClassMethodsDefaults,i)},t.datavisualization.Diagram.ClassMember=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ClassMemberDefaults,i)},t.datavisualization.Diagram.ClassAttribute=function(i){return e.extend(!1,{},t.datavisualization.Diagram.ClassAttributeDefaults,i)},t.datavisualization.Diagram.ClassifierClass=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],e.extend(!1,{},t.datavisualization.Diagram.ClassDefaults,i)},t.datavisualization.Diagram.ClassifierInterface=function(i){return i.attributes=i.attributes?i.attributes.slice():[],i.methods=i.methods?i.methods.slice():[],e.extend(!1,{},t.datavisualization.Diagram.InterfaceDefaults,i)},t.datavisualization.Diagram.ClassifierEnumeration=function(i){return i.members=i.members?i.members.slice():[],e.extend(!1,{},t.datavisualization.Diagram.EnumerationDefaults,i)},t.datavisualization.Diagram.UMLConnector=function(i){return e.extend(!1,{},t.datavisualization.Diagram.UMLConnectorDefaults,i)},t.datavisualization.Diagram.UMLConnectorAssociation=function(i){return e.extend(!1,{},t.datavisualization.Diagram.AssociationDefaults,i)},t.datavisualization.Diagram.UMLConnectorAggregation=function(i){return e.extend(!1,{},t.datavisualization.Diagram.AggregationDefaults,i)},t.datavisualization.Diagram.UMLConnectorComposition=function(i){return e.extend(!1,{},t.datavisualization.Diagram.CompositionDefaults,i)},t.datavisualization.Diagram.UMLConnectorDependency=function(i){return e.extend(!1,{},t.datavisualization.Diagram.DependencyDefaults,i)},t.datavisualization.Diagram.UMLConnectorRealization=function(i){return e.extend(!1,{},t.datavisualization.Diagram.RealizationDefaults,i)},t.datavisualization.Diagram.UMLConnectorInheritance=function(i){return e.extend(!1,{},t.datavisualization.Diagram.InheritanceDefaults,i)},t.datavisualization.Diagram.UMLConnectorMultiplicity=function(i){return i.source&&(i.source.optional=i.source.optional?i.source.optional:!0,i.source.lowerBounds=i.source.lowerBounds?i.source.lowerBounds:null,i.source.upperBounds=i.source.upperBounds?i.source.upperBounds:null),i.target&&(i.target.optional=i.target.optional?i.target.optional:!0,i.target.lowerBounds=i.target.lowerBounds?i.target.lowerBounds:null,i.target.upperBounds=i.target.upperBounds?i.target.upperBounds:null),e.extend(!1,{},t.datavisualization.Diagram.ClassifierMultiplicityDefault,i)},t.datavisualization.Diagram.UMLActivityFlow=function(i){return e.extend(!1,{},t.datavisualization.Diagram.UMLActivityFlowDefaults,i)},t.datavisualization.Diagram.ClassDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]},t.datavisualization.Diagram.InterfaceDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]},t.datavisualization.Diagram.EnumerationDefaults={name:" ",members:[t.datavisualization.Diagram.ClassMember()]},t.datavisualization.Diagram.NodeType=function(i,a){if(!i._isInternalShape){var n=a.model.defaultSettings&&a.model.defaultSettings.node&&a.model.defaultSettings.node.type?a.model.defaultSettings.node.type:"",o=!i.isPhase&&a.model.defaultSettings&&a.model.defaultSettings.node?a.model.defaultSettings.node:{};i.type||i.children||i.isLane||i.isSwimlane||i.isPhase||i.isPhaseStack||(i.type=i.segments||i.sourceNode||i.sourcePort||i.sourcePoint||i.targetNode||i.targetPort||i.targetPoint?"connector":n?n:"basic"),(i.isSwimlane||"swimlane"==i.type)&&(i._type="group"),("basic"==i.type||"flow"==i.type||"arrow"==i.type||"bpmn"==i.type||"image"==i.type||"native"==i.type||"html"===i.type||"text"===i.type||"umlactivity"==i.type)&&(a._isLoad&&(!a._isLoad||i._type)||(i._type="node"),i=e.extend(!0,{},o,i)),(!a._isLoad||a.model.nodeTemplate||a._isOptimize)&&("basic"==i.type?i=t.datavisualization.Diagram.BasicShape(i):"flow"==i.type?i=t.datavisualization.Diagram.FlowShape(i):"arrow"==i.type?i=t.datavisualization.Diagram.ArrowShape(i):"bpmn"==i.type?i=t.datavisualization.Diagram.BPMNShape(i):"umlclassifier"==i.type?i=t.datavisualization.Diagram.ClassifierShape(i,a):"umlactivity"==i.type&&(i=t.datavisualization.Diagram.UMLActivityShape(i,a)))}return i},t.datavisualization.Diagram.BasicShape=function(e){switch(e._shape="path",e.shape||(e.shape="rectangle"),e.shape){case"rectangle":e._shape="rectangle";break;case"ellipse":e._shape="ellipse";break;case"path":e._shape="path";break;case"polygon":e._shape="polygon";break;case"triangle":e.pathData="M81.1582,85.8677L111.1582,33.9067L141.1582,85.8677L81.1582,85.8677z";break;case"plus":e.pathData="M696.6084,158.2656L674.8074,158.2656L674.8074,136.4656L658.4084,136.4656L658.4084,158.2656L636.6084,158.2656L636.6084,174.6646L658.4084,174.6646L658.4084,196.4656L674.8074,196.4656L674.8074,174.6646L696.6084,174.6646L696.6084,158.2656z";break;case"star":e.pathData="M540.3643,137.9336L546.7973,159.7016L570.3633,159.7296L550.7723,171.9366L558.9053,194.9966L540.3643,179.4996L521.8223,194.9966L529.9553,171.9366L510.3633,159.7296L533.9313,159.7016L540.3643,137.9336z";break;case"pentagon":e.pathData="M370.9702,194.9961L359.5112,159.7291L389.5112,137.9341L419.5112,159.7291L408.0522,194.9961L370.9702,194.9961z";break;case"heptagon":e.pathData="M223.7783,195.7134L207.1303,174.8364L213.0713,148.8034L237.1303,137.2174L261.1883,148.8034L267.1303,174.8364L250.4813,195.7134L223.7783,195.7134z";break;case"octagon":e.pathData="M98.7319,196.4653L81.1579,178.8923L81.1579,154.0393L98.7319,136.4653L123.5849,136.4653L141.1579,154.0393L141.1579,178.8923L123.5849,196.4653L98.7319,196.4653z";break;case"trapezoid":e.pathData="M127.2842,291.4492L95.0322,291.4492L81.1582,256.3152L141.1582,256.3152L127.2842,291.4492z";break;case"decagon":e.pathData="M657.3379,302.4141L642.3369,291.5161L636.6089,273.8821L642.3369,256.2481L657.3379,245.3511L675.8789,245.3511L690.8789,256.2481L696.6089,273.8821L690.8789,291.5161L675.8789,302.4141L657.3379,302.4141z";break;case"righttriangle":e.pathData="M836.293,292.9238L776.293,292.9238L776.293,254.8408L836.293,292.9238z";break;case"cylinder":e.pathData="M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016"}return e},t.datavisualization.Diagram.FlowShape=function(e){e._shape="path",e.shape||(e.shape="process");var i=e.constraints?e.constraints:t.datavisualization.Diagram.NodeConstraints.Default;switch(e.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(i|=t.datavisualization.Diagram.NodeConstraints.AspectRatio),e.shape){case"process":e.pathData="M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z";break;case"decision":e.pathData="M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z";break;case"document":e.pathData="M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z";break;case"predefinedprocess":e.pathData="M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.333333333333334,0 L 8.333333333333334,50 M 41.66666666666667,0 L 41.66666666666667,50";break;case"terminator":e.pathData="M 269.711,29.3333C 269.711,44.061 257.772,56 243.044,56L 158.058,56C 143.33,56 131.391,44.061 131.391,29.3333L 131.391,29.3333C 131.391,14.6057 143.33,2.66669 158.058,2.66669L 243.044,2.66669C 257.772,2.66669 269.711,14.6057 269.711,29.3333 Z";break;case"papertap":e.pathData="M0.000976562,17.2042 L0.000976562,47.1654 C0.000976562,47.1654 14.403,53.5455 25.001,47.1654 C35.599,40.7852 44.403,43.5087 50.001,47.1654 L50.001,17.2042 M50.001,32.7987 L50.001,2.84052 C50.001,2.84052 35.599,-3.54271 25.001,2.84052 C14.403,9.22376 5.599,6.49418 0.000976562,2.84052 L0.000976562,32.7987";break;case"directdata":e.pathData="M 1477 613 L 1619 613 C 1627 613 1634 636 1634 665 C 1634 694 1627 717 1619 717 L 1477 717 C 1469 717 1461 694 1461 665 C 1461 636 1469 613 1477 613 ZM 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717M 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717";break;case"sequentialdata":e.pathData="M0.00297546,24.999 C0.00297546,11.1922 10.433,0.00216177 23.295,0.00216177 C36.159,0.00216177 46.585,11.1922 46.585,24.999 C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.00297546,38.8057 0.00297546,24.999 z M23.294,49.999 L50.002,49.999";break;case"sort":e.pathData="M50.001,24.9971 L25.001,49.9971 L0.000976562,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971";break;case"multidocument":e.pathData="M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.1437 C48.027,35.7653 49.025,36.6042 50.003,37.3695 L50.003,0.0021928 L6.26497,0.0021928 L6.26497,4.74451 M43.6826,47.1132 L43.6826,10.7652 L0.00257874,10.7652 L0.00257874,47.1132 C0.00257874,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.7926,43.3935 43.6826,47.1132 z";break;case"collate":e.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"summingjunction":e.constraints=i,e.pathData="M7.3252,42.6768 L42.6772,7.32477 M42.6768,42.6768 L7.3248,7.32477 M0.000976562,25.001 C0.000976562,11.193 11.197,0.000976562 25.001,0.000976562 C38.809,0.000976562 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.001 0.000976562,38.809 0.000976562,25.001 z";break;case"or":e.pathData="M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z";break;case"internalstorage":e.pathData="M 0 3.8194444444444446A 2.5,3.8194444444444446 0 0,1 2.5,0L 47.5 0A 2.5,3.8194444444444446 0 0,1 50,3.8194444444444446L 50 45.833333333333336A 2.5,3.8194444444444446 0 0,1 47.5,49.65277777777778L 2.5 49.65277777777778A 2.5,3.8194444444444446 0 0,1 0,45.833333333333336L 0 3.8194444444444446ZM 0 11.458333333333334L 50 11.458333333333334M 12.5 0L 12.5 49.65277777777778";break;case"extract":e._shape="polygon",e.constraints=i,e.points=[{x:0,y:35},{x:30,y:0},{x:60,y:35}];break;case"manualoperation":e._shape="polygon",e.points=[{x:46.4,y:28.8},{x:14.8,y:28.8},{x:0,y:0},{x:60,y:0}];break;case"merge":e._shape="polygon",e.constraints=i,e.points=[{x:60,y:0},{x:30,y:35},{x:0,y:0}];break;case"offpagereference":e._shape="polygon",e.points=[{x:60,y:33.3},{x:30.1,y:39},{x:0,y:33.3},{x:0,y:0},{x:60,y:0}];break;case"sequentialaccessstorage":e.constraints=i,e.pathData="M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9 C 55.5 48 60 39.5 60 30 Z";break;case"annotation1":e.pathData="M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865";break;case"annotation2":e.pathData="M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029";break;case"card":e._shape="polygon",e.points=[{x:275,y:60},{x:400,y:60},{x:400,y:110},{x:260,y:110},{x:260,y:75}];break;case"data":e.pathData="M 10 0 L 40 0 L 30 40 L 0 40 Z "}return e},t.datavisualization.Diagram.ArrowShape=function(e){switch(e._shape="path",e.shape||(e.shape="circulararrow"),e.shape){case"circulararrow":e.pathData="M433.4624,503.8848C429.4244,493.2388,419.1354,485.6678,407.0734,485.6678C391.4884,485.6678,378.8544,498.3018,378.8544,513.8868L384.4984,513.8868C384.4984,501.4178,394.6054,491.3108,407.0734,491.3108C415.9494,491.3108,423.6264,496.4338,427.3144,503.8848L422.9114,503.8848L426.8974,508.8848L430.8824,513.8868L434.8684,508.8848L438.8544,503.8848L433.4624,503.8848z";break;case"curvedrightarrow":e.pathData="M0.83006144,28.226993 C2.4030598,37.092016 9.5750604,44.49601 19.365042,48.044014 L19.365042,43.129004 25.376032,47.706001 31.386044,52.282999 25.376032,56.858988 19.365042,61.436991 19.365042,55.399027 C8.24608,51.372995 0.50004381,42.368995 0.50004357,31.905003 0.50004381,30.65601 0.6160717,29.429996 0.83006144,28.226993 z M31.402985,0.5 L31.402985,7.4419994 C15.834992,7.4419994 2.9619988,16.497999 0.81800008,28.275999 0.61199981,27.139999 0.49999988,25.981999 0.5,24.803999 0.49999988,11.379999 14.334993,0.5 31.402985,0.5 z";break;case"curveduparrow":e.pathData="M52.283021,0.51798058 L56.859025,6.5279841 61.436024,12.537989 55.399022,12.537989 C51.373021,23.656996 42.369015,31.403002 31.905011,31.403002 30.65601,31.403002 29.430011,31.288002 28.22701,31.073002 37.092015,29.500999 44.496018,22.328995 48.044018,12.537989 L43.129018,12.537989 47.706021,6.5279841 z M0.5,0.5 L7.4420163,0.5 C7.4420163,16.067989 16.497985,28.940971 28.276,31.083977 27.140013,31.290977 25.981993,31.402 24.804015,31.402 11.380005,31.402 0.5,17.567989 0.5,0.5 z";break;case"curvedleftarrow":e.pathData="M31.073116,28.227982 C31.287107,29.429977 31.403074,30.65599 31.403074,31.905989 31.403074,42.368966 23.657099,51.372959 12.538074,55.399935 L12.538074,61.436979 6.5270846,56.85898 0.51707193,52.282993 6.5270846,47.706976 12.538074,43.129983 12.538074,48.044958 C22.328056,44.496956 29.500118,37.091961 31.073116,28.227982 z M0.5,0.5 C17.568025,0.5 31.403045,11.380997 31.403045,24.803993 31.403045,25.981992 31.291046,27.139992 31.085045,28.276992 28.941042,16.497995 16.068023,7.442997 0.5,7.442997 z";break;case"curveddownarrow":e.pathData="M24.804015,0.50000453 C25.981993,0.50000453 27.140013,0.61301103 28.276,0.8180277 16.498045,2.9630154 7.4420161,15.836023 7.4420156,31.404005 L0.5,31.404005 C0.5,14.336024 11.380004,0.50000453 24.804015,0.50000453 z M31.90502,0.5 C42.369025,0.49999976 51.37303,8.2460016 55.399031,19.365004 L61.436034,19.365004 56.859034,25.377005 52.28303,31.387007 47.70603,25.377005 43.129027,19.365004 48.044028,19.365004 C44.496027,9.5760015 37.092024,2.4040001 28.227019,0.82999995 29.43002,0.61699978 30.65602,0.49999976 31.90502,0.5 z";break;case"jumpingrightarrow":e.pathData="M571.7207,727.7451L563.4507,716.8841L572.3297,716.8841C565.9217,699.1961,552.5427,686.2371,536.5277,683.3951C538.6997,683.0091,540.9157,682.8001,543.1717,682.8001C562.0777,682.8001,578.3457,696.7961,585.6187,716.8841L596.5277,716.8841L588.2577,727.7451L579.9907,738.6041L571.7207,727.7451z";break;case"jumpingleftarrow":e.pathData="M688.4209,727.7441L696.6889,716.8851L687.8119,716.8851C694.2179,699.1971,707.5989,686.2381,723.6119,683.3941C721.4409,683.0101,719.2259,682.8011,716.9679,682.8011C698.0639,682.8011,681.7959,696.7951,674.5209,716.8851L663.6119,716.8851L671.8839,727.7441L680.1509,738.6031L688.4209,727.7441z"}return e},t.datavisualization.Diagram.UMLConnectorShape=function(i){var a,n;switch(i.shape.relationship||(i.shape.relationship="association"),i.shape.relationship){case"association":i.shape=t.datavisualization.Diagram.UMLConnectorAssociation(i.shape);break;case"aggregation":i.shape=t.datavisualization.Diagram.UMLConnectorAggregation(i.shape);break;case"composition":i.shape=t.datavisualization.Diagram.UMLConnectorComposition(i.shape);break;case"realization":i.shape=t.datavisualization.Diagram.UMLConnectorRealization(i.shape);break;case"dependency":i.shape=t.datavisualization.Diagram.UMLConnectorDependency(i.shape);break;case"inheritance":i.shape=t.datavisualization.Diagram.UMLConnectorInheritance(i.shape)}if("umlactivity"==i.shape.type)if(i.shape=t.datavisualization.Diagram.UMLActivityFlow(i.shape),"object"==i.shape.activityFlow){if(i=e.extend(!0,i,{lineDashArray:"8 4",targetDecorator:{shape:"openarrow"},lineWidth:2}),i.labels)for(n=0;n<i.labels.length;n++)i.labels[n]=t.datavisualization.Diagram.Label(i.labels[n]),i.labels[n].text="["+i.labels[n].text+"]"}else"control"==i.shape.activityFlow?i=e.extend(!0,i,{sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"},lineWidth:2}):"exception"==i.shape.activityFlow&&(i=e.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow"}}));else if(i.shape.multiplicity)if(a=[],a=t.datavisualization.Diagram.ClassifierHelper.umlConnectorMultiplicity(i),i.labels)for(n=0;n<a.length;n++)i.labels.push(a[n]);else i=e.extend(!1,{},{labels:a},i);return"umlclassifier"==i.shape.type&&("association"==i.shape.relationship&&("bidirectional"==i.shape.association?i=e.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"none"},lineWidth:2}):"directional"==i.shape.association&&(i=e.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow"},lineWidth:2}))),"inheritance"==i.shape.relationship&&(i=e.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),"composition"==i.shape.relationship&&(i=e.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"black"},targetDecorator:{shape:"none"},lineWidth:2})),"aggregation"==i.shape.relationship&&(i=e.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"white"},targetDecorator:{shape:"none"},lineWidth:2})),"dependency"==i.shape.relationship&&(i=e.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),"realization"==i.shape.relationship&&(i=e.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2}))),i},t.datavisualization.Diagram.BPMNShape=function(t){switch(t.shape||(t.shape="event"),("sequentialflow"!=t.shape||"associationflow"!=t.shape||"messageflow"!=t.shape)&&(t.labels&&t.labels.length||(t.labels=[{}]),t.labels.length&&t.labels[0].offset||(t.labels[0]=e.extend(!1,{},t.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}))),t.shape){case"event":case"gateway":case"dataobject":case"activity":t._type="group",t._isBpmn=!0,void 0==t.children&&(t.children=[]),"activity"==t.shape&&"subprocess"==t.activity&&t.subProcess&&0==t.subProcess.collapsed&&(t=e.extend(!0,{container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10},t));break;case"message":t=e.extend(!0,t,{_shape:"path",pathData:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z"});break;case"datasource":t=e.extend(!0,t,{_shape:"path",pathData:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2 S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8"});break;case"group":t=e.extend(!0,t,{_type:"group",_isBpmn:!0,minWidth:t.width,minHeight:t.height,cornerRadius:10,container:{type:"canvas"},paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10,borderDashArray:"2 2 6 2"})}return t},t.datavisualization.Diagram.ClassifierShape=function(i,a){var n,o;switch(i.classifier||(i.classifier="class"),i.labels||(i.labels=[{}]),i.fillColor||(i.fillColor="transparent"),i.borderColor||(i.borderColor="transparent"),i.borderWidth||(i.borderWidth=1),i.opacity||(i.opacity=1),i.classifier){case"class":for(i["class"]=t.datavisualization.Diagram.ClassifierClass(i["class"]),n=0;n<i["class"].attributes.length;n++)i["class"].attributes[n]=t.datavisualization.Diagram.ClassAttribute(i["class"].attributes[n]);for(o=0;o<i["class"].methods.length;o++)i["class"].methods[o]=t.datavisualization.Diagram.ClassMethod(i["class"].methods[o]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"interface":for(i["interface"]=t.datavisualization.Diagram.ClassifierInterface(i["interface"]),
n=0;n<i["interface"].attributes.length;n++)i["interface"].attributes[n]=t.datavisualization.Diagram.ClassAttribute(i["interface"].attributes[n]);for(o=0;o<i["interface"].methods.length;o++)i["interface"].methods[o]=t.datavisualization.Diagram.ClassMethod(i["interface"].methods[o]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"enumeration":i.enumeration=t.datavisualization.Diagram.ClassifierEnumeration(i.enumeration),i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,a);break;case"member":i.labels[0]=e.extend(!1,{},{name:i.name+"_member",horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5},text:"Member"},i.labels[0]),i=e.extend(!1,{},{borderColor:"transparent",fillColor:"transparent",_shape:"rectangle",horizontalAlign:"stretch",verticalAlign:"bottom",_isClassMember:!0},i)}return i},t.datavisualization.Diagram.UMLActivityShape=function(e){switch(e.type="umlactivity",e.shape||(e.shape="action"),e._shape="path",e.shape){case"action":e.pathData="M 90 82.895 C 90 86.819 86.776 90 82.8 90 H 7.2 C 3.224 90 0 86.819 0 82.895 V 7.105 C 0 3.181 3.224 0 7.2 0 h 75.6 C 86.776 0 90 3.181 90 7.105 V 82.895 Z";break;case"decision":e.pathData="M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z";break;case"mergenode":e.pathData="M10,19.707L0.293,10L10,0.293L19.707,10L10,19.707z";break;case"initialnode":e.pathData="M10,19.5c-5.238,0-9.5-4.262-9.5-9.5S4.762,0.5,10,0.5s9.5,4.262,9.5,9.5S15.238,19.5,10,19.5z";break;case"finalnode":e.borderColor="transparent",e._type="group";var i=[],a=0,n=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize);for(i.push({name:e.name+"_activity_final_1",width:e.width,height:e.height,offsetX:e.offsetX,offsetY:e.offsetY,constraints:n|t.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001"}),i.push({name:e.name+"_activity_final_2",width:e.width/2,height:e.height/2,fillColor:"black",offsetX:e.offsetX,offsetY:e.offsetY,constraints:n|t.datavisualization.Diagram.NodeConstraints.Resize,type:"node",shape:"path",pathData:"M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50"}),a=0;a<i.length;a++)i[a]=t.datavisualization.Diagram.Node(i[a]);e.elementType="group",e.children=i;break;case"forknode":e.width=e.width?e.width:40,e.height=5,e.fillColor="black",e.pathData="m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",e.labels=[{readOnly:!0}];break;case"joinnode":e.width=e.width?e.width:40,e.height=5,e.fillColor="black",e.pathData="m0.75,0.75l636.00002,0l0,290l-636.00002,0l0,-290z",e.labels=[{readOnly:!0}];break;case"timeevent":e.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"acceptingevent":e.pathData="M17.8336 32.164 L29.64 24 L17.32 16 L48.1664 16 L48.5 32 Z";break;case"sendsignal":e.pathData="M48.164 31.8336 L56 23.832 L47.836 16 L16.168 16 L16.1668 31.8336 Z";break;case"receivesignal":e.pathData="M48.1664 31.8336 L39.836 24 L47.836 16 L16.168 16 L16.168 31.836 Z";break;case"structurednode":e._shape="rectangle",e.borderDashArray="2 3",e.labels&&e.labels.length>0&&(e.labels=[{text:"<<"+e.labels[0].text+">>",wrapText:"nowrap",fillColor:"white"}]);break;case"note":e.pathData="M20 12 L4 12 L4 22 L22 22 L22 14 L20 14 L20 12 L22 14 Z"}return e},t.datavisualization.Diagram.DefautShapes={_getBPMNEventShape:function(i,a){var n,o,s,r=[];for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i.offset=i.offset||{},i.offset=t.datavisualization.Diagram.Point(i.offset.x?i.offset.x:null,i.offset.y?i.offset.y:null),i=e.extend(!1,{},t.datavisualization.Diagram.BPMNEventDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(r.push(a.nameTable[i.children[n].name||i.children[n]]),r[n].rotateAngle=i.rotateAngle);var l=i.pivot||{x:.5,y:.5},d=i.offsetX?i.offsetX-i.width*l.x+i.width/2:i.width*l.x+i.width/2,h=i.offsetY?i.offsetY-i.height*l.y+i.height/2:i.height*l.y+i.height/2;if(!r.length)for(o=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:d,offsetY:h,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0,_isInternalShape:!0},r.push({name:i.name+"_0",width:i.width,height:i.height}),r.push({name:i.name+"_1",width:.85*i.width,height:.85*i.height}),r.push({name:i.name+"_2",width:.5*i.width,height:.5*i.height}),n=0;n<r.length;n++)r[n]=t.datavisualization.Diagram.Node(e.extend(!1,{},s,r[n]));return i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNEventShape(i,r,i.event,i.trigger),i},_getBPMNGatewayShape:function(i,a){var n,o,s,r=[];for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i=e.extend(!1,{},t.datavisualization.Diagram.BPMNGatewayDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(r.push(a.nameTable[i.children[n].name||i.children[n]]),r[n].rotateAngle=i.rotateAngle);var l=i.pivot||{x:.5,y:.5},d=i.offsetX?i.offsetX-i.width*l.x+i.width/2:i.width*l.x+i.width/2,h=i.offsetY?i.offsetY-i.height*l.y+i.height/2:i.height*l.y+i.height/2;if(!r.length)for(o=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:d,offsetY:h,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0,_isInternalShape:!0},r.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z"}),r.push({name:i.name+"_1",width:.45*i.width,height:.45*i.height}),n=0;n<r.length;n++)r[n]=t.datavisualization.Diagram.Node(e.extend(!1,{},s,r[n]));switch(r&&r[0]&&(o=r[0].constraints?r[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o|=t.datavisualization.Diagram.NodeConstraints.Shadow)),i.children=r,i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,e.extend(!0,r,[{fillColor:i.fillColor,constraints:o,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,fillColor:"black",visible:!0}]),i.gateway){case"none":r[1].visible=!1;break;case"exclusive":r[1].pathData="M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039 l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z";break;case"inclusive":r[1].pathData="M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z";break;case"parallel":r[1].pathData="M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z";break;case"complex":r[1].pathData="M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z";break;case"eventbased":r[1].fillColor="white",r[1].pathData="M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z";break;case"exclusiveeventbased":r[1].fillColor="white",r[1].pathData="M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z";break;case"paralleleventbased":r[1].fillColor="white",r[1].pathData="M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"}return i},_getClassShape:function(i,a){var n,o,s,r,l,d,h,c,u,g,m=[],p="",f="",v="",_="";if(i.children){for(u=0;u<i.children.length;u++)a.nameTable[i.children[u].name||i.children[u]]&&m.push(a.nameTable[i.children[u].name||i.children[u]]);if(m.length<=0&&i.children.length>0)for(g=0;g<i.children.length;g++)m.push(i.children[g])}else{if(s=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast|t.datavisualization.Diagram.NodeConstraints.Drag),r={width:i.width,offsetX:i.offsetX,parent:i.name,ports:[],fillColor:"transparent",borderColor:i.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0},i.fillColor&&(r.fillColor=i.fillColor),i.borderColor&&(r.borderColor=i.borderColor),i.borderWidth&&(r.borderWidth=i.borderWidth),i.labels)for(u=0;u<i.labels.length;u++)r.labels[u]=e.extend(!1,{},r.labels[u],i.labels[u]);switch(i.classifier){case"class":m.push({ports:[],name:i.name+"_header_classifier",minHeight:30,labels:[{name:"title",offset:{x:.5,y:.65},text:i["class"].name,bold:!0,fontSize:14},{name:"class",offset:{x:.5,y:.25},text:"<<Class>>"}],constraints:s});break;case"interface":m.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:"title",offset:{x:.5,y:.65},text:i["interface"].name,bold:!0,fontSize:14},{name:"interface",offset:{x:.5,y:.25},text:"<<Interface>>"}],constraints:s});break;case"enumeration":m.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:i.name+"Label1",offset:{x:.5,y:.65},text:i.enumeration.name,bold:!0,fontSize:14},{name:i.name+"enumeration",offset:{x:.5,y:.25},text:"<<Enumeration>>"}],constraints:s})}if(l=i["class"]?i["class"]:i["interface"],l&&l.attributes&&l.attributes.length){for(u=0;u<l.attributes.length;u++)l.attributes[u]=t.datavisualization.Diagram.ClassAttribute(l.attributes[u]),i.Interface&&(l.attributes[u].scope=t.datavisualization.Diagram.ScopeValueDefaults.Public),l.attributes[u].scope&&"public"==l.attributes[u].scope&&(c="+"),l.attributes[u].scope&&"private"==l.attributes[u].scope&&(c="-"),l.attributes[u].scope&&"protected"==l.attributes[u].scope&&(c="#"),l.attributes[u].scope&&"package"==l.attributes[u].scope&&(c="~"),""!=l.attributes[u].name&&(p+=c?c+" "+l.attributes[u].name+" : "+l.attributes[u].type:l.attributes[u].name+": "+l.attributes[u].type),u!=l.attributes.length-1&&(p+="\n");p&&m.push({name:i.name+"_attribute_classifier",labels:[{text:p,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}if(d=i.enumeration,d&&d.members&&d.members.length){for(u=0;u<d.members.length;u++)d.members[u]=t.datavisualization.Diagram.ClassMember(d.members[u]),""!=d.members[u].name&&(v+=d.members[u].name),u!=d.members.length-1&&(v+="\n");v&&m.push({name:i.name+"_member_classifier",labels:[{text:v,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}if(h=i["class"]?i["class"]:i["interface"],h&&h.methods&&h.methods.length){for(u=0;u<h.methods.length;u++){if(h.methods[u]=t.datavisualization.Diagram.ClassMethod(h.methods[u]),h.methods[u].scope&&"public"==h.methods[u].scope&&(c="+"),h.methods[u].scope&&"private"==h.methods[u].scope&&(c="-"),h.methods[u].scope&&"protected"==h.methods[u].scope&&(c="#"),h.methods[u].scope&&"package"==h.methods[u].scope&&(c="~"),h.methods[u].arguments)for(g=0;g<h.methods[u].arguments.length;g++)_+=h.methods[u].arguments[g].type?h.methods[u].arguments[g].name+":"+h.methods[u].arguments[g].type:h.methods[u].arguments[g].name,g!=h.methods[u].arguments.length-1&&(_+=",");""!=h.methods[u].name&&(f+=c?c+" "+h.methods[u].name+"("+_+") : "+h.methods[u].type:h.methods[u].name+"("+_+") :"+h.methods[u].type),u!=h.methods.length-1&&(f+="\n")}f&&m.push({name:i.name+"_method_classifier",labels:[{text:f,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:s})}for(u=0;u<m.length;u++)for(m[u]=t.datavisualization.Diagram.Node(e.extend(!1,{},r,m[u])),g=0;g<m[u].labels.length;g++)m[u].labels[g]=e.extend(!1,{},m[u].labels[g],r.labels[0]);for(i.children=m,i._type="group",i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints=i.constraints&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast|t.datavisualization.Diagram.NodeConstraints.Drag),u=0;u<m.length;u++)1==m.length&&(i["class"]&&(delete i["class"].attributes,delete i["class"].methods),i["interface"]&&(delete i["interface"].attributes,delete i["interface"].methods),i.enumeration&&delete i.enumeration.members),2==m.length&&(i.children[u]="string"==typeof i.children[u]?a.nameTable[i.children[u]]:i.children[u],i["class"]&&(i.children[u].name.match("attribute")&&delete i["class"].methods,i.children[u].name.match("method")&&delete i["class"].attributes),i["interface"]&&(i.children[u].name.match("attribute")&&delete i["interface"].methods,i.children[u].name.match("method")&&delete i["interface"].attributes))}for(i._height=0,u=0;u<m.length;u++)a._getNodeDimension(m[u],m[u].labels[0]),n=m[u].height?m[u].height:m[u]._height,m[u].offsetY=i._height+n/2,i._height+=n;for(o=m[0]._width,m[1]&&(o=m[0]._width>m[1]._width?m[0]._width:m[1]._width),m[2]&&(o=m[2]._width>o?m[2]._width:o),m[0].width=o,m[1]&&(m[1].width=o),m[2]&&(m[2].width=o),i._width=o,i.width=i._width,i.height=i._height,u=0;u<m.length;u++)m[u].offsetY+=i.offsetY-i.height/2;return i},_updateClassNode:function(e,i){var a;if(e.name.match("_header"))"class"==i.type?i.className=e.labels[0].text:"interface"==i.type?i.interfaceName=e.labels[0].text:i.enumerationName=e.labels[0].text;else{for(var n,o=e.name.match("_attribute")?"attribute":e.name.match("_method")?"method":"member",s=e.labels[0],r=s.text.split("\n"),l=[],d=0;d<r.length;d++)switch(a=i.Class?i.Class:i.Interface,o){case"attribute":n=r[d].split(/:[ ]*/g),l.push(t.datavisualization.Diagram.ClassMember({name:n[0],type:n[1]}));break;case"method":n=r[d].replace(")","").replace("(",":").split(/:[ ]*/g),l.push(t.datavisualization.Diagram.ClassMember({name:n[0],returnType:n[1],parameter:n[2]}));break;case"member":l.push(t.datavisualization.Diagram.ClassMember({name:r[d]}))}"attribute"==o?i.attributes=l:"method"==o?i.methods=l:i.members=l}},_getBPMNDataShape:function(i,a){var n,o,s,r,l,d,h,c=[];for(void 0==i.children&&(i.children=[]),i._type="group",o=i.pivot||{x:.5,y:.5},i.canUngroup=!1,i.data=t.datavisualization.Diagram.BPMNDataObject(i.data),i=e.extend(!1,{},t.datavisualization.Diagram.BPMNDataObjectDefaults,i),s=i.offsetX?i.offsetX-i.width*o.x:i.width*o.x,r=i.offsetY?i.offsetY-i.height*o.y:i.height*o.y,n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(c.push(a.nameTable[i.children[n].name||i.children[n]]),c[n].rotateAngle=i.rotateAngle);if(l=i.offsetX?i.offsetX-i.width*o.x+i.width/2:i.width*o.x+i.width/2,!c.length)for(d=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),h={parent:i.name,type:"node",shape:"path",offsetX:l,ports:[],rotateAngle:i.rotateAngle,constraints:d,_isDisabled:!0,_isInternalShape:!0},c.push({name:i.name+"_0",width:i.width,height:i.height,offsetY:r+i.height/2,addInfo:{offset:{x:.5,y:.5}},shape:"polygon",points:[{x:29.904,y:5},{x:7.853,y:5},{x:7.853,y:45},{x:42.147,y:45},{x:42.147,y:17.242},{x:29.932,y:5},{x:29.932,y:17.242},{x:42.147,y:17.242}]}),c.push({name:i.name+"_1",width:7.5,height:15,offsetY:85+r,addInfo:{offset:{x:.5,y:1},margin:{bottom:15}},fillColor:"black",pathData:"M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z "}),c.push({name:i.name+"_2",width:25,height:20,offsetX:s+15,offsetY:r+15,addInfo:{offset:{x:0,y:0},margin:{left:17.5,top:15}},borderColor:"black",fillColor:"white",pathData:"M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z"}),n=0;n<c.length;n++)c[n]=t.datavisualization.Diagram.Node(e.extend(!1,{},h,c[n]));switch(i.children=c,i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,e.extend(!0,c,[{fillColor:i.fillColor,constraints:i.constraints,shadow:i.shadow,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,visible:i.data.collection},{opacity:i.opacity,visible:!0}]),i.data.type){case"none":c[2].visible=!1;break;case"input":c[2].fillColor="white";break;case"output":c[2].fillColor="black"}return i},_getBPMNActivityShape:function(i,a){var n,o,s,r,l,d=[],h={};for(void 0==i.children&&(i.children=[]),i._type="group",i.canUngroup=!1,i.task=t.datavisualization.Diagram.BPMNTask(i.task),i.subProcess=t.datavisualization.Diagram.BPMNSubProcess(i.subProcess),i=e.extend(!1,{},t.datavisualization.Diagram.BPMNActivityDefaults,i),n=0;n<i.children.length;n++)a.nameTable[i.children[n].name||i.children[n]]&&(d.push(a.nameTable[i.children[n].name||i.children[n]]),d[n].rotateAngle=i.rotateAngle);if(!d.length){for(o=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),s={parent:i.name,type:"node",shape:"path",ports:[],labels:[],constraints:o,rotateAngle:i.rotateAngle,_isDisabled:!0,_isInternalShape:!0},d.push({name:i.name+"_activity",width:i.width,height:i.height,addInfo:{offset:{x:.5,y:.5}},constraints:o|t.datavisualization.Diagram.NodeConstraints.Resize}),d.push({name:i.name+"_taskType",width:14,height:14,borderColor:"black",addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:14,top:14}},pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_loop",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_compensation",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_expanded",width:12,height:12,constraints:o,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_adhoc",width:12,height:8,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black",pathData:"M10 0L40 0L30 40L0 40Z"}),d.push({name:i.name+"_event_1",width:24,height:24,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),d.push({name:i.name+"_event_2",width:20.4,height:20.4,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),d.push({name:i.name+"_event_3",width:12,height:12,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),n=0;n<d.length;n++)d[n]=t.datavisualization.Diagram.Node(e.extend(!0,{},s,d[n]));if("subprocess"==i.activity&&!i.subProcess.collapsed&&i.subProcess.processes&&i.subProcess.processes.length)for(r=0,l=i.subProcess.processes;r<i.subProcess.processes.length;r++)l[r]=t.datavisualization.Diagram.Node(t.datavisualization.Diagram.NodeType(l[r],a)),d.push(l[r])}for(i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNActivityShape(i,d),n=0;n<i.children.length;n++)h[i.children[n].name]=i.children[n];return t.datavisualization.Diagram.Util._updateBPMNProperties(i,a,h),i},_getBPMNGroupShape:function(e,i){var a,n=[],o=0;for(void 0==e.children&&(e.children=[]),o=0;o<e.children.length;o++)i.nameTable[e.children[o].name||e.children[o]]&&n.push(i.nameTable[e.children[o].name||e.children[o]]);if(!n.length)for(o=0;o<e.children.length;o++)a=t.datavisualization.Diagram.Node(t.datavisualization.Diagram.NodeType(e.children[o],i)),"bpmn"==a.type&&n.push(a);return e.ports=[],e.children=n,e.constraints=e.constraints?e.constraints:t.datavisualization.Diagram.NodeConstraints.Default,e.constraints=e.constraints&~t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.AllowDrop,e},_updateBPMNEventShape:function(i,a,n,o){var s,r,l;switch(a&&a[0]&&(s=a[0].constraints?a[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(s|=t.datavisualization.Diagram.NodeConstraints.Shadow)),r="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",l=[{pathData:r,fillColor:i.fillColor,constraints:s,shadow:i.shadow,borderWidth:i.borderWidth,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:r,fillColor:i.fillColor,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:r,fillColor:"white",borderColor:i.borderColor,opacity:i.opacity,height:.5*a[0].height,visible:!0}],e.extend(!0,a,l),n){case"start":a[1].visible=!1;break;case"noninterruptingstart":a[0].borderDashArray="2 3",a[1].visible=!1;break;case"intermediate":a[0].fillColor="white",a[0].gradient=null;break;case"noninterruptingintermediate":a[0].fillColor="white",a[0].gradient=null,a[0].borderDashArray="2 3",a[1].borderDashArray="2 3";break;case"throwingintermediate":case"end":a[0].fillColor="end"!=n?"white":"black",a[0].gradient=null,a[2].fillColor="black",a[2].borderColor=i.fillColor}switch(o){case t.datavisualization.Diagram.BPMNTriggers.None:a[2].visible=!1;break;case t.datavisualization.Diagram.BPMNTriggers.Message:a[2].pathData="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",a[2].height=3*a[2].width/4;break;case t.datavisualization.Diagram.BPMNTriggers.Timer:a[2].pathData="M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681 L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617 M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z";break;case t.datavisualization.Diagram.BPMNTriggers.Error:a[2].pathData="M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Escalation:a[2].pathData="M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Cancel:a[2].pathData="M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Compensation:a[2].pathData="M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Conditional:a[2].pathData="M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85";break;case t.datavisualization.Diagram.BPMNTriggers.Link:a[2].pathData="M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Signal:a[2].pathData="M 50 50 H 0 L 25.0025 0 L 50 50 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Terminate:a[2].pathData="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50";break;case t.datavisualization.Diagram.BPMNTriggers.Multiple:a[2].pathData="M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Parallel:a[2].pathData="M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"}return a},_updateBPMNActivityShape:function(i,a){var n,o,s,r,l,d,h,c,u,g;a&&a[0]&&(d=a[0].constraints?a[0].constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(d|=t.datavisualization.Diagram.NodeConstraints.Shadow));var m=[{fillColor:i.fillColor,borderWidth:i.borderWidth,constraints:d,shadow:i.shadow,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,pathData:this._updateRoundedRectanglePath(i,12)},{fillColor:"white",borderColor:"black",width:14,height:14,opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1}],p=[],f=9,c=0;switch(e.extend(!0,a,m),"subprocess"==i.activity&&!i.subProcess.collapsed&&a.length>f&&i.subProcess.processes.length&&(p=a.splice(a.length-i.subProcess.processes.length,i.subProcess.processes.length)),n="task"==i.activity?i.task.loop:i.subProcess.loop,o="task"==i.activity?i.task.compensation:i.subProcess.compensation,n){case"none":a[2].visible=!1;break;case"standard":a[2].pathData="M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314 c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685 c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z";break;case"parallelmultiinstance":a[2].pathData="M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ";break;case"sequencemultiinstance":a[2].pathData="M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5 L 55.375,82.5 L 40.375,82.5 Z"}if(o?a[3].pathData="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z":a[3].visible=!1,s=i.activity==t.datavisualization.Diagram.BPMNActivity.Task?i.task.events:i.subProcess.events,s&&s.length){for(r=0;r<s.length;r++){if(l=a.slice(f+3*r,f+3+3*r),!l.length||l.length<3){for(d=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),h={parent:i.name,type:"group",constraints:d,rotateAngle:i.rotateAngle,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:s[r].offset},borderColor:"transparent",labels:[{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}}]},s[r].offset=s[r].offset||{},s[r].offset=t.datavisualization.Diagram.Point(s[r].offset.x?s[r].offset.x:null,s[r].offset.y?s[r].offset.y:null),s[r]=t.datavisualization.Diagram.Node(e.extend(!0,{name:i.name+"_"+t.datavisualization.Diagram.Util.randomId()},t.datavisualization.Diagram.BPMNEventDefaults,h,s[r])),l=[{width:24,height:24},{width:20.4,height:20.4},{width:12,height:12}],c=0;c<l.length;c++)u={parent:s[r].name,type:"node",shape:"path",rotateAngle:s[r].rotateAngle,constraints:d,_isInternalShape:!0,opacity:i.opacity,addInfo:{offset:s[r].offset}},l[c]=t.datavisualization.Diagram.Node(e.extend(!0,{name:s[r].name+"_"+t.datavisualization.Diagram.Util.randomId()},u,l[c]));s[r].children=l}this._updateBPMNEventShape(i,l,s[r].event,s[r].trigger)}a=a.concat(s)}else a.splice(f,a.length-1);if(i.activity==t.datavisualization.Diagram.BPMNActivity.Task){switch(a[1].visible=!0,delete a[1]._isService,i.task.type){case"none":a[1].visible=!1;break;case"service":a[1].pathData="M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.89 0.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535 -1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z",a[1]._isService=!0;break;case"receive":a[1].pathData="M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z",a[1].height=12;break;case"send":a[1].pathData="M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z",
a[1].height=12,a[1].fillColor="black",a[1].borderColor="white";break;case"instantiatingreceive":a[1].pathData="M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785 c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z",a[1].width=20,a[1].height=20;break;case"manual":a[1].pathData="M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281 c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143 c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008 h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403 c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752 c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557 h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167 c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151 c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082 c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753 h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629 L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176 c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322",a[1].width=20;break;case"businessrule":a[1].pathData="M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322 v -4.923 h 12.667 v 4.923 H 19.177 Z";break;case"user":a[1].pathData="M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61 -3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 Z M 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452 C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626 -0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.784 1.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571 c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855 C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.003 0.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153 -0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81";break;case"script":a[1].pathData="M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13 c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734 c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709 -1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"}i.task.call&&(a[0].borderWidth=4),i.task.compensation&&"none"!=i.task.loop&&(a[2].addInfo.margin.left-=a[2].width/2+2,a[3].addInfo.margin.left+=a[3].width/2+2)}else if(i.activity==t.datavisualization.Diagram.BPMNActivity.SubProcess){var v=0,_=0,y=2;if(i.subProcess.collapsed)a[4].constraints=a[4].constraints|t.datavisualization.Diagram.NodeConstraints.PointerEvents,a[4].visible=!0,a[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z";else{for(a[4].constraints=a[4].constraints|t.datavisualization.Diagram.NodeConstraints.PointerEvents,a[4].visible=!0,a[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z",a[0]=e.extend(!0,a[0],{marginLeft:-i.paddingLeft,marginRight:-i.paddingRight,marginTop:-i.paddingTop,marginBottom:-i.paddingBottom,minWidth:i.width,minHeight:i.height}),i.constraints=i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop,i.minWidth=i.width,i.minHeight=i.height;c<p.length;)"bpmn"!=p[c].type&&p.splice(c,1),c++;a=a.concat(p)}switch(i.subProcess.boundary){case"default":a[0].borderWidth=i.borderWidth,a[0].borderDashArray="1 0";break;case"call":a[0].borderWidth=i.borderWidth<4?4:i.borderWidth,a[0].borderDashArray="1 0";break;case"event":a[0].borderWidth=i.borderWidth,a[0].borderDashArray="2 2"}i.subProcess.adhoc?(a[5].visible=!0,a[5].pathData="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z"):"event"==i.subProcess.type?(a[0].borderWidth=i.borderWidth,a[0].borderDashArray="2 2",this._updateBPMNEventShape(i,a.slice(6,9),i.subProcess.event,i.subProcess.trigger)):"transaction"==i.subProcess.type&&(g={x:3,y:3,width:i.width-3,height:i.height-3},a[0].pathData+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(g,12));do a[y].visible&&(a[y].addInfo.margin.left=_+a[y].width/2,_+=a[y].width+2),y++;while(6>y);_-=2,y=2,v=_/2;do a[y].visible&&(a[y].addInfo.margin.left-=v),y++;while(6>y)}return a},_updateRoundedRectanglePath:function(e,t){for(var i="",a=0,n=[{x:e.x||0,y:e.y||0},{x:e.x||0,y:e.height},{x:e.width,y:e.height},{x:e.width,y:e.y||0}],o=[{x:t,y:t},{x:t,y:-t},{x:-t,y:-t},{x:-t,y:t}],a=0;a<n.length;a++)i+=i?"L":"M",i+=n[a].x+(a%2==0?o[a].x:0)+","+(n[a].y+(a%2!=0?o[a].y:0)),i+="C"+n[a].x+","+n[a].y+" "+n[a].x+","+n[a].y,i+=" "+(n[a].x+(a%2!=0?o[a].x:0))+","+(n[a].y+(a%2==0?o[a].y:0));return i+="L"+(n[0].x+o[0].x)+","+n[0].y,i+"Z"},initBPMNAnnotationShape:function(i,a){var n,o,s,r,l=[],d=0;if(i._annotation&&i._annotation.length)for(;d<i._annotation.length;)if(n=a.nameTable[i._annotation[d++]],n&&n.name.split("annotation_")[0]!=i.name)i._annotation.splice(--d,1);else{if(!n)break;l.push(n)}if(i.annotation&&i.annotation.text){if(i=e.extend(!1,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),!l.length){var h=t.datavisualization.Diagram.PortVisibility.Hidden,c=t.datavisualization.Diagram.PortConstraints.None,u=[{offset:{x:0,y:.5},name:"left",visibility:h,constraints:c},{offset:{x:.5,y:0},name:"top",visibility:h,constraints:c},{offset:{x:1,y:.5},name:"right",visibility:h,constraints:c},{offset:{x:.5,y:1},name:"bottom",visibility:h,constraints:c}],g=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),m=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),p=t.datavisualization.Diagram.NodeConstraints.Default&~t.datavisualization.Diagram.NodeConstraints.Connect,f=t.datavisualization.Diagram.ConnectorConstraints.Default&~(t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd|t.datavisualization.Diagram.ConnectorConstraints.Drag);i._annotation&&i._annotation.length?(g="string"==typeof i._annotation[0]?i._annotation[0]:i._annotation[0].name,m="string"==typeof i._annotation[1]?i._annotation[1]:i._annotation[1].name):i._annotation=[],l.push({name:g,labels:[{text:i.annotation.text}],annotation:i.annotation,type:"bpmn",shape:"annotation",_type:"node",_shape:"path",ports:u,constraints:p,width:i.annotation.width,height:i.annotation.height,_preventStretch:!0}),l.push({name:m,labels:[{readOnly:!0}],type:"connector",segments:[{type:"straight"}],targetDecorator:{shape:"none"},sourceNode:l[0].name,targetNode:i.name,constraints:f,annotation:i.annotation,_isAnnotationLine:!0})}l[0].offsetX=i.offsetX+i.annotation.length*Math.cos(-i.annotation.angle*(Math.PI/180)),l[0].offsetY=i.offsetY+i.annotation.length*Math.sin(-i.annotation.angle*(Math.PI/180)),o=[{fillColor:"transparent",borderColor:i.borderColor,rotateAngle:i.rotateAngle,opacity:i.opacity,ports:[]},{lineColor:i.borderColor,opacity:i.opacity}],e.extend(!0,l,o),s=a.nameTable[l[0].name],r=a.nameTable[l[1].name],s||(s=a._getNewNode(l[0]),a.nameTable[s.name]=s,i._annotation.splice(0,1,s.name)),r||(r=a._getNewConnector(l[1]),a.nameTable[r.name]=r,i._annotation.splice(1,1,r.name)),this.updateBPMNAnnotationShape(r,s,null,i,a)}return i},renderBPMNAnnotationShape:function(e,i){var a,n,o,s;if(e._annotation&&e._annotation.length)for(a=0;a<e._annotation.length;a++)n="string"==typeof e._annotation[a]?i.nameTable[e._annotation[a]]:e._annotation[a],n&&(i.nameTable[n.name]=n,o=i.getObjectType(n),"node"==o?t.datavisualization.Diagram.DiagramContext.renderNode(n,i):"connector"==o&&(s=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateEdges(n),i._dock(n,i.nameTable),t.datavisualization.Diagram.DiagramContext.renderConnector(n,i),i._disableSegmentChange=s))},updateBPMNAnnotationShape:function(i,a,n,o,s){var r,l,d;if("connector"==s.getObjectType(i)&&i._isAnnotationLine){n&&s.nameTable[n]&&(r=s.nameTable[n],e.extend(!0,r,t.datavisualization.Diagram.BPMNTextAnnotationDefaults),delete r._annotation),o||(o=s.nameTable[i.targetNode]);var h,c=t.datavisualization.Diagram.Util.bounds(a),u=20,g=20;switch(h=o?t.datavisualization.Diagram.Util.bounds(o):{x:i.targetPoint.x,y:i.targetPoint.y,width:i.lineWidth,height:i.lineWidth},l="",c.x<=h.x+h.width&&c.x+c.width>=h.x&&(c.y+c.height<h.y&&(l="bottom"),c.y>h.y+h.height&&(l="top")),l||(c.x>h.x+h.width&&(l="left"),c.x+c.width<h.x&&(l="right")),l||i.annotation.direction||(l="left"),i.annotation.direction=l,a.labels[0].horizontalAlignment=a.labels[0].verticalAlignment=a.labels[0].textAlign="center",i.annotation.direction){case"left":g=c.height,a.pathData="M"+u+","+g+" L0,"+g+" L0,0 L"+u+",0",a.labels[0].horizontalAlignment="left",a.labels[0].textAlign="left",a.labels[0].offset=t.datavisualization.Diagram.Point(.05,.5);break;case"right":g=c.height,u=c.width-20,a.pathData="M"+u+","+g+" L"+(u+20)+","+g+" L"+(u+20)+",0 L"+u+",0",a.labels[0].horizontalAlignment="right",a.labels[0].textAlign="right",a.labels[0].offset=t.datavisualization.Diagram.Point(.95,.5);break;case"top":u=c.width,a.pathData="M"+u+","+g+" L"+u+",0 L0,0 L0,"+g,a.labels[0].verticalAlignment="top",a.labels[0].offset=t.datavisualization.Diagram.Point(.5,0);break;case"bottom":g=c.height-20,u=c.width,a.pathData="M"+u+","+g+" L"+u+","+(g+20)+" L0,"+(g+20)+" L0,"+g,a.labels[0].verticalAlignment="bottom",a.labels[0].offset=t.datavisualization.Diagram.Point(.5,1)}s.nameTable[i.name]&&(d=s._disableSegmentChange,s._disableSegmentChange=!1,i.annotation.direction=i.sourcePort=l,s._updateEdges(i),s._dock(i,s.nameTable),s._disableSegmentChange=d),t.datavisualization.Diagram.DiagramContext.update(a,s)}},translateBPMNAnnotationShape:function(i,a,n,o,s){var r,l,d,h,c,u,g,m;if(i.annotation&&"annotation"!=i.shape){if(r=[],i.annotation&&i.annotation.text&&(i=e.extend(!1,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),i._annotation&&i._annotation.length)){for(l=0;l<i._annotation.length;l++)s.nameTable[i._annotation[l]]&&r.push(s.nameTable[i._annotation[l]]);if(r.length){if(d=a,h=n,o){var d=0,h=0,p=t.Matrix.identity();i.rotateAngle?(t.Matrix.rotate(p,-i.rotateAngle,o.x,o.y),t.Matrix.scale(p,a,n,o.x,o.y),t.Matrix.rotate(p,i.rotateAngle,o.x,o.y)):t.Matrix.scale(p,a,n,o.x,o.y);var f=t.datavisualization.Diagram.Util.bounds(i),v=i.offsetX-o.x,_=i.offsetY-o.y,y={bottom:{x:i.offsetX,y:f.y},left:{x:f.x+f.width,y:i.offsetY},top:{x:i.offsetX,y:f.y+f.height},right:{x:f.x,y:i.offsetY}},b=y[r[0].annotation.direction],x=t.Matrix.transform(p,{x:b.x-v,y:b.y-_});x.x!=b.x&&(d=b.x-x.x),x.y!=b.y&&(h=b.y-x.y)}s._translate(r[0],d,h,s.nameTable)}}}else if(i.annotation&&"annotation"==i.shape){for(u=0;u<i.outEdges.length;u++)if(g=s.nameTable[i.outEdges[u]],g._isAnnotationLine){c=g;break}c&&(m=i.targetNode?s.nameTable[i.targetNode]:null,this.updateBPMNAnnotationShape(c,s.nameTable[c.sourceNode],null,m,s))}},updateAnnotationProperties:function(i,a){"node"==a.getObjectType(i)&&(i=a.nameTable[i.outEdges[0]]);var n=a.nameTable[i.targetNode],o=a.nameTable[i.sourceNode];n&&o?(i.annotation.angle=-1*t.datavisualization.Diagram.Util._findAngle({x:o.offsetX,y:o.offsetY},{x:n.offsetX,y:n.offsetY}),i.annotation.length=t.datavisualization.Diagram.Util.findLength({x:n.offsetX,y:n.offsetY},{x:o.offsetX,y:o.offsetY}),o.annotation=n.annotation=e.extend(!1,{},i.annotation),n._annotation=[i.sourceNode,i.name],a.nodes().indexOf(o)>-1&&(t.datavisualization.Diagram.Util.removeItem(a.nodes(),o),t.datavisualization.Diagram.Util.removeItem(a.connectors(),i),a._nodes=e.extend(!0,[],a.nodes()))):o&&(i.annotation.angle=-1*t.datavisualization.Diagram.Util._findAngle({x:o.offsetX,y:o.offsetY},i.targetPoint),i.annotation.length=t.datavisualization.Diagram.Util.findLength(i.targetPoint,{x:o.offsetX,y:o.offsetY}),o.annotation=e.extend(!1,{},i.annotation),a.nodes().push(o),a.connectors().push(i),a._nodes=e.extend(!0,[],a.nodes()))},updateInlineDecoratorsShape:function(e,i){var a,n,o,s;return e.shape&&"bpmn"==e.shape.type&&"message"==e.shape.flow&&(e._inlineDecorators.length&&(n=e._inlineDecorators.filter(function(t){return t.name==e.name+"_"+e.shape.message?t:void 0}),n.length&&(a=n[0])),e._inlineDecorators=[],("initiatingmessage"==e.shape.message||"noninitiatingmessage"==e.shape.message)&&(o=t.datavisualization.Diagram.Util._findOffsetOnConnector(e,{segmentOffset:.5},.5,i),s="noninitiatingmessage"==e.shape.message?"lightgrey":"white",a?(a.offsetX=o.offset.x,a.offsetY=o.offset.y,a.fillColor=s):a=t.datavisualization.Diagram.Node({name:e.name+"_"+e.shape.message,width:25,height:15,offsetX:o.offset.x,offsetY:o.offset.y,fillColor:s,shape:"path",pathData:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",constraints:t.datavisualization.Diagram.NodeConstraints.Delete}),e._inlineDecorators.push(a))),e}},t.datavisualization.Diagram.bpmnHelper={resetNodeMargin:function(e,i,a){var n,o,s,r={marginLeft:e.marginLeft,marginRight:e.marginRight,marginTop:e.marginTop,marginBottom:e.marginBottom};if(t.datavisualization.Diagram.canvasHelper._updateNodeMargin(a,e,i),i&&"group"==i._type)for(n=0;n<i.children.length;n++){o="string"==typeof i.children[n]?a.nameTable[i.children[n]]:i.children[n];for(s in r)0==r[s]&&(o[s]=0)}},updateCanvas:function(e,i){var a,n;i._isUndo||t.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,e,i.nameTable[e.parent]),e.container&&"canvas"===e.container.type&&(t.datavisualization.Diagram.canvasHelper._setSize(i,e,!0),this.updateProcessCollection(e,i),e.parent&&i.nameTable[e.parent]?(a=i.nameTable[e.parent],this.resetNodeMargin(e,a,i),this.updateCanvas(a,i)):t.datavisualization.Diagram.canvasHelper._updateNodeMargin(i,e,i.nameTable[e.parent]),i.nameTable[e.name]&&(n=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateAssociatedConnectorEnds(e,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(e,i),i._disableSegmentChange=n))},updateProcessCollection:function(e,i){var a,n;if("activity"==e.shape&&"subprocess"==e.activity){for(var o=e.subProcess.processes,a=0,s=i._getChildren(e.children);o&&o.length&&a<o.length;)-1==s.indexOf(o[a].name)?t.datavisualization.Diagram.Util.removeItem(o,o[a]):o[a]=i.nameTable[o[a++].name];for(a=0;a<e.children.length;a++)n="string"==typeof e.children[a]?i.nameTable[e.children[a]]:e.children[a],n._isInternalShape||-1!=o.indexOf(n)||o.push(n)}},isBPMNContainerChild:function(e,t){if(e&&e.parent){var i=t.nameTable[e.parent];return!(!i||"bpmn"!=i.type||"group"==i.shape||!i.container)}},canMoveOutofBounds:function(e,i,a,n){var o,s,r;return"connector"==e.getObjectType(i)&&(i.sourceNode||i.targetNode)&&(o=e.nameTable[i.sourceNode||i.targetNode],o&&this.isBPMNContainerChild(o,e))?(s=e.nameTable[o.parent],r=t.datavisualization.Diagram.Util.bounds(s),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),!(a>=r.x+r.width||a<=r.x||n>=r.y+r.height||n<=r.y)):!0},canAllowConnection:function(e,t,i){var a=null;if(t&&i&&"bpmn"==i.type){if(i.parent&&(a=e.nameTable[i.parent]),a&&"bpmn"==a.type&&"group"!=a.shape&&t.parent!=i.parent)return a;if(e._containsChild(i,t)||e._containsChild(t,i))return null}return i},canAllowDropOnContainer:function(e,t){return"bpmn"!=t.type||"bpmn"==e.type&&"annotation"!=e.shape}}}(jQuery,Syncfusion),function(e,t){"use strict";var i=function(){function e(e){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=e.id,e&&t.datavisualization.Diagram.Util.attr(this.document,e),this}return e.prototype.element=function(e,i){var a;return e&&e.id&&(a=this.document.getElementById(e.id)),a||(a=document.createElementNS(this.xmlns,i)),e&&t.datavisualization.Diagram.Util.attr(a,e),a},e.prototype.g=function(e){return this.element(e,"g")},e.prototype.defs=function(e){return this.element(e,"defs")},e.prototype.image=function(e){return this.element(e,"image")},e.prototype.path=function(e){return this.element(e,"path")},e.prototype.text=function(e){return this.element(e,"text")},e.prototype.textPath=function(e){return this.element(e,"textPath")},e.prototype.tspan=function(e){return this.element(e,"tspan")},e.prototype.rect=function(e){return this.element(e,"rect")},e.prototype.ellipse=function(e){return this.element(e,"ellipse")},e.prototype.circle=function(e){return this.element(e,"circle")},e.prototype.title=function(e){return this.element(e,"title")},e.prototype.line=function(e){return this.element(e,"line")},e.prototype.polyline=function(e){return this.element(e,"polyline")},e.prototype.polygon=function(e){return this.element(e,"polygon")},e.prototype.foreignObject=function(e){return this.element(e,"foreignObject")},e.prototype.linearGradient=function(e){return this.element(e,"linearGradient")},e.prototype.radialGradient=function(e){return this.element(e,"radialGradient")},e.prototype.stop=function(e){return this.element(e,"stop")},e.prototype.pattern=function(e){return this.element(e,"pattern")},e.prototype.appendChild=function(e){this.document.appendChild(e)},e.prototype.removeChild=function(e,t){t?t.removeChild(e):this.document.removeChild(e)},e.prototype.getElementById=function(e){return this.document.getElementById(e)},e.prototype.getElementsByClassName=function(e){return this.document.getElementsByClassName(e)},e.prototype.getElementsByTagName=function(e){return this.document.getElementsByTagName(e)},e.prototype.pathBounds=function(e){var i,a={d:e},n=this.path(a),o=new t.datavisualization.Diagram.Svg({id:"TempSvg"});return document.body.appendChild(o.document),o.document.appendChild(n),i=n.getBBox(),document.body.removeChild(o.document),i},e.prototype.textBounds=function(e,t,i){var a,n=null;return e&&t?(a=this.text(t),a.appendChild(document.createTextNode(e)),this.document.appendChild(a),n=a.getBBox(),this.document.removeChild(a)):i&&(this.document.appendChild(i),n=i.getBBox(),this.document.removeChild(i)),n},e.prototype.absolutePath=function(e){for(var i,a,n,o,s,r,l,d,h,c=t.datavisualization.Diagram.Util.convertPathToArray(e.getAttribute("d")),u=0,g=0,m=0,p=c.length;p>m;++m){if(i=c[m],a=i.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(a))"x"in i&&(u=i.x),"y"in i&&(g=i.y);else{switch("x1"in i&&(r=u+i.x1),"x2"in i&&(d=u+i.x2),"y1"in i&&(l=g+i.y1),"y2"in i&&(h=g+i.y2),"x"in i&&(u+=i.x),"y"in i&&(g+=i.y),a){case"m":n={pathSegTypeAsLetter:"M",x:u,y:g};break;case"l":n={pathSegTypeAsLetter:"L",x:u,y:g};break;case"h":n={pathSegTypeAsLetter:"H",x:u};break;case"v":n={pathSegTypeAsLetter:"V",y:g};break;case"c":n={pathSegTypeAsLetter:"C",x:u,y:g,x1:r,y1:l,x2:d,y2:h};break;case"s":n={pathSegTypeAsLetter:"S",x:u,y:g,x2:d,y2:h};break;case"q":n={pathSegTypeAsLetter:"Q",x:u,y:g,x1:r,y1:l};break;case"t":n={pathSegTypeAsLetter:"T",x:u,y:g};break;case"a":n={pathSegTypeAsLetter:"A",x:u,y:g,r1:i.r1,r2:i.r2,angle:i.angle,largeArcFlag:i.largeArcFlag,sweepFlag:i.sweepFlag};break;case"z":case"Z":u=o,g=s,n=c[m]}n&&(c[m]=n)}("M"===a||"m"===a)&&(o=u,s=g)}return e.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(c)),e},e}();t.datavisualization.Diagram.Svg=i,t.datavisualization.Diagram.SvgContext={_renderDocument:function(i,a,n){var o,s,r,l;window.SVGSVGElement&&(o=e("#"+i.canvas.id+"_svgParent")[0],o||(o=document.createElement("div")),s=t.datavisualization.Diagram.ScrollUtil._getRulerSize(a),r={id:i.canvas.id+"_svgParent",style:"height:auto;width:auto;position:absolute;overflow:hidden;left:"+s.left+"px;top:"+s.top+"px;bottom:0px;"},t.datavisualization.Diagram.Util.attr(o,r),i.canvas.appendChild(o),a._svgParent=o,r={id:i.canvas.id+"_svg",version:"1.1",style:"position:absolute;","class":"mainview_svg",role:"img"},t.isMobile()&&(r.style="position: inherit"),l=n?a._svg:new t.datavisualization.Diagram.Svg(r),i.svg=l,a&&(this._renderRulers(a,i.canvas,i.svg,n),a._svg=l,n||document.getElementById(l.document.id)||a._svgParent.appendChild(l.document),a._view=this._renderView(i.canvas,i.svg,n),a._page=this._renderPage(i.canvas,i.svg,a._view,n),this._renderBackground(a,i.canvas,i.svg,a._page,a.model,n),a._pageBackgroundLayer=this._renderBackgroundLayer(i.canvas,i.svg,a._page,n),this._renderGrid(i.canvas,i.svg,a._page,a),a._diagramLayer=i.diagramLayer=this._renderDiagramLayer(i.canvas,i.svg,a._page),a._htmlLayer=this._renderHtmlLayer(i.canvas,n,a),this._renderAdornerLayer(a,i.canvas,n,i)))},_renderRulers:function(e,t,i,a){if(e.model.rulerSettings.showRulers)this._renderOverLappingElement(e,t,i,a),this._renderRuler(e,t,i,!1,a),this._renderRuler(e,t,i,!0,a);else{var n;n=document.getElementById(t.id+"_hRuler"),n&&n.parentNode.removeChild(n),n=document.getElementById(t.id+"_vRuler"),n&&n.parentNode.removeChild(n),n=document.getElementById(t.id+"_overlap-Ruler"),n&&n.parentNode.removeChild(n)}},_renderOverLappingElement:function(e,i){var a,n,o=document.getElementById(i.id+"_overlap-Ruler");o||(o=document.createElement("div"),a=t.datavisualization.Diagram.ScrollUtil._getRulerSize(e),o.setAttribute("id",i.id+"_overlap-Ruler"),n="height: "+a.top+"px;width:"+a.left+"px;position:absolute;left:0;top:0",o.setAttribute("style",n),o.setAttribute("class","sf-diagram_overlap")),i.insertBefore(o,i.firstChild)},_updateRulerSpace:function(e,t,i){var a=document.getElementById(e._canvas.id+(i?"_hRuler":"_vRuler")),n=i?e._hRulerInstance:e._vRulerInstance;a&&e&&t&&(i?(a.style.width=t.width+2*e._hRulerInstance.model.segmentWidth+"px",a.style.height=n.model.thickness+"px",a=document.getElementById(e._canvas.id+"_overlap-Ruler"),a&&(a.style.height=n.model.thickness+"px")):(a.style.height=t.height+2*e._vRulerInstance.model.segmentWidth+"px",a.style.width=n.model.thickness+"px",a=document.getElementById(e._canvas.id+"_overlap-Ruler"),a&&(a.style.width=n.model.thickness+"px")))},_renderRuler:function(i,a,n,o){var s,r,l,d,h=document.getElementById(a.id+(o?"_hRuler":"_vRuler")),c=t.datavisualization.Diagram.ScrollUtil._getRulerSize(i),u=t.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i);h||(h=document.createElement("div"),s=o?"height: "+c.top+"px;width:"+u.width+"px;margin-left:"+c.left+"px;":"height:"+u.height+"px;width: "+c.left+"px;float:left;top:"+c.top+"px;",h.setAttribute("id",a.id+(o?"_hRuler":"_vRuler")),h.setAttribute("style",s),h.setAttribute("class","sf-diagram_hRuler")),a.insertBefore(h,a.firstChild),r=o?i.model.rulerSettings.horizontalRuler:i.model.rulerSettings.verticalRuler,r=e.extend(!0,{},r),r.length=(o?u.width:u.height)+r.segmentWidth,r.orientation=o?"horizontal":"vertical",l=e("#"+h.id).ejRuler(r),d=e("#"+h.id).ejRuler("instance"),o?(i._hRuler=l,i._hRulerInstance=d):(i._vRuler=l,i._vRulerInstance=d)},_renderView:function(e,t,i){var a,n=t.document.getElementById(e.id+"_view");return n||(a={id:e.id+"_view"},n=t.g(a)),i||t.appendChild(n),n},_renderHtmlLayer:function(e,i,a){var n,o,s=document.getElementById(e.id+"_htmlLayer");return s||(s=document.createElement("div")),n={id:e.id+"_htmlLayer","class":"htmlLayer"},t.datavisualization.Diagram.Util.attr(s,n),o=s,s.style.pointerEvents="none",i||a._svgParent.appendChild(o),o},_renderAdornerLayer:function(e,i,a,n){var o,s=document.getElementById(i.id+"_adorner");s||(s=document.createElement("div")),o={id:i.id+"_adorner","class":"adornerLayer",style:"position:absolute;left:0px;top:0px"},t.datavisualization.Diagram.Util.attr(s,o),e._adornerLayer=this._renderAdornerSvg(e,i,s,a,n),e._tooltipLayer=this._renderTooltipLayer(i,s,a),a||e._svgParent.appendChild(s)},_renderTooltipLayer:function(e,i,a){var n,o,s=document.getElementById(e.id+"_tooltip");return s||(s=document.createElement("div")),n={id:e.id+"_tooltip","class":"diagram_tooltip"},t.datavisualization.Diagram.Util.attr(s,n),o=s,s.style.pointerEvents="none",a||i.appendChild(o),o},_renderPage:function(e,t,i,a){var n,o=t.document.getElementById(e.id+"_page");return o||(n={id:e.id+"_page","class":"page"},o=t.g(n)),a||i.appendChild(o),o},_renderDiagramLayer:function(e,t,i){var a,n=t.document.getElementById(e.id+"_diagramLayer");return n||(a={id:e.id+"_diagramLayer","class":"DiagramLayer"},n=t.g(a),i.appendChild(n)),n},_renderAdornerSvg:function(e,i,a,n,o){var s,r,l,d,h;return window.SVGSVGElement?(h={id:i.id+"_svg_adorner",version:"1.1",style:"position:absolute",fill:"none","pointer-events":"none"},s=n?e._adornerSvg:new t.datavisualization.Diagram.Svg(h),n||document.getElementById(s.document.id)||a.appendChild(s.document),r=s.document.getElementById(i.id+"_expander"),r||(h={id:i.id+"_expander","class":"ExpanderLayer","pointer-events":"all"},r=s.g(h),s.document.appendChild(r)),o._expander=e._expander=r,l=s.document.getElementById(i.id+"_adornerLayer"),l||(h={id:i.id+"_adornerLayer","class":"AdornerLayer","pointer-events":"none"},l=s.g(h),s.document.appendChild(l)),d=s.document.getElementById(i.id+"_portLayer"),d||(h={id:i.id+"_portLayer","class":"portLayer","pointer-events":"none"},d=s.g(h),l.appendChild(d)),e._adornerSvg=s,l):void 0},_renderBackgroundLayer:function(e,t,i,a){var n,o=t.document.getElementById(e.id+"_pageBackground");return o||(n={id:e.id+"_pageBackground","class":"PageBackgroundLayer",style:"pointer-events:none;"},o=t.g(n)),a||i.appendChild(o),o},_renderBackground:function(e,i,a,n){var o,s,r;a.document.style.msTouchAction="none",a.document.style.display="block",a.document.style.backgroundColor="white";var l={id:i.id+"_backgroundLayer"},d=a.g(l),h=e._getDigramBounds();if(e._backgroundImage()){var c=e._backgroundImage(),u=t.datavisualization.Diagram.Util._getImageAlignment(c.alignment),g="none "+u!="none"&&"none"!=c.scale?u+" "+c.scale:"none";l={id:i.id+"_backgroundImage",x:h.x,y:h.y,width:h.width,height:h.height,preserveAspectRatio:g,"pointer-events":"none"},o=a.image(l),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c.source),a.getElementById(i.id+"_backgroundImage")||d.appendChild(o)}s=e._backgroundColor(),r=a.rect({id:i.id+"_backgroundColor",width:"100%",height:"100%",fill:s,"pointer-events":"none"}),s?a.getElementById(i.id+"_backgroundColor")||d.appendChild(r):a.getElementById(r.id)&&d.removeChild(a.getElementById(r.id)),a.getElementById(d.id)||n.appendChild(d)},_renderGrid:function(e,i,a,n){var o,s,r,l,d,h,c,u,g=n._svg.document.getElementById(e.id+"patterndefinition");if(g||(g=i.defs({id:e.id+"patterndefinition"}),i.appendChild(g)),n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var u=document.getElementById(e.id+"_grid"),c=document.getElementById(e.id+"pattern_gridline"),h=document.getElementById(e.id+"pattern_grid");h&&h.parentNode&&h.parentNode.removeChild(h),s={id:e.id+"_grid","pointer-events":"none"},o=i.g(s),r=0,n.model.snapSettings.horizontalGridLines.linesInterval&&n.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(e){r+=e}),l=0,n.model.snapSettings.verticalGridLines.linesInterval&&n.model.snapSettings.verticalGridLines.linesInterval.forEach(function(e){l+=e}),d=this._scaleSnapInterval(n.model,n._currZoom),s={id:e.id+"pattern_grid",x:0,y:0,width:l*d,height:r*d,patternUnits:"userSpaceOnUse"},h=i.pattern(s),d=this._scaleSnapInterval(n.model,d),this._renderHorizontalGridlines(d,h,l,n,i),this._renderVerticalGridlines(d,h,r,n,i),g.appendChild(h),c=i.rect({id:e.id+"pattern_gridline",x:n._hScrollOffset,y:n._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+e.id+"pattern_grid)"
}),o.appendChild(c),u||(n._diagramLayer?a.insertBefore(o,n._diagramLayer):a.appendChild(o))}else o=document.getElementById(e.id+"_grid"),o&&(u=document.getElementById(e.id+"pattern_gridline"),u&&u.parentNode&&u.parentNode.removeChild(u))},_updateBackground:function(e,i,a,n){var o,s,r={x:e,y:i},l=document.getElementById(n._id+"_canvas_backgroundColor");l&&t.datavisualization.Diagram.Util.attr(l,r),o=document.getElementById(n._id+"_canvas_backgroundImage"),s=n._getDigramBounds(),o&&t.datavisualization.Diagram.Util.attr(o,{transform:"scale("+a+")",x:s.x,y:s.y,width:s.width,height:s.height})},_updateGrid:function(e,i,a,n){var o,s,r,l,d,h,c,u=document.getElementById(n._canvas.id+"pattern_gridline");if(u){if(s=document.getElementById(n._canvas.id+"pattern_grid"),r=0,n.model.snapSettings.horizontalGridLines.linesInterval)for(o=0;o<n.model.snapSettings.horizontalGridLines.linesInterval.length;o++)r+=n.model.snapSettings.horizontalGridLines.linesInterval[o];if(l=0,n.model.snapSettings.verticalGridLines.linesInterval)for(o=0;o<n.model.snapSettings.verticalGridLines.linesInterval.length;o++)l+=n.model.snapSettings.verticalGridLines.linesInterval[o];c={x:e,y:i},t.datavisualization.Diagram.Util.attr(u,c),a=this._scaleSnapInterval(n.model,a),d=n._svg,h=d.defs({id:n._canvas.id+"patterndefinition"}),s&&h.removeChild(s),c={id:n._canvas.id+"pattern_grid",x:0,y:0,width:l*a,height:r*a,patternUnits:"userSpaceOnUse"},s=n._svg.pattern(c),this._renderHorizontalGridlines(a,s,l,n,n._svg),this._renderVerticalGridlines(a,s,r,n,n._svg),h.appendChild(s)}},_scaleSnapInterval:function(e,t){if(t>=2)for(;t>=2;)t/=2;else if(.5>=t)for(;.5>=t;)t*=2;var i;if(1!==t){for(e.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<e.snapSettings.horizontalGridLines.snapInterval.length;i++)e.snapSettings.horizontalGridLines._snapinterval[i]=e.snapSettings.horizontalGridLines.snapInterval[i]*t;for(e.snapSettings.verticalGridLines._snapinterval=[],i=0;i<e.snapSettings.verticalGridLines.snapInterval.length;i++)e.snapSettings.verticalGridLines._snapinterval[i]=e.snapSettings.verticalGridLines.snapInterval[i]*t}return t},_updateRulerSegment:function(t,i,a,n,o,s){if(n.model.rulerSettings.showRulers){for(var r,l,d,h=n.model.snapSettings,c=e("#"+(s?n._hRuler[0].id:n._vRuler[0].id)).ejRuler("instance"),u=e("#"+(s?n._vRuler[0].id:n._hRuler[0].id)).ejRuler("instance"),g=c._updateSegmentWidth(n._currZoom),m=u._updateSegmentWidth(n._currZoom),p=g/c.model.interval,f=0,v=s?h.verticalGridLines:h.horizontalGridLines,_=0;_<c.model.interval;_++)l=0==_?1.25:.25,d=Number(f+l/2),r=s?o.path({d:"M "+d+" 0 L "+d+" "+m+" Z",stroke:v.lineColor,"stroke-width":l,"stroke-dasharray":v.lineDashArray}):o.path({d:"M 0 "+d+" L "+m+" "+d+" Z",stroke:v.lineColor,"stroke-width":l,"stroke-dasharray":v.lineDashArray}),f+=p+l/2,r&&i.appendChild(r);s?i.setAttribute("width",g):i.setAttribute("height",g)}},_checkForDefaultGridlines:function(e){var t,i=[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75];if(e){if(e.length>0&&i.length>0&&e.length!=i.length)return!1;for(t=0;t<i.length;t++)if(i[t]!=e[t])return!1}return!0},_renderHorizontalGridlines:function(e,i,a,n,o){var s,r,l,d,h,c,u=n.model,g=u.snapSettings;if(n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)if(n.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(n.model.snapSettings.horizontalGridLines.linesInterval))this._updateRulerSegment(e,i,a,n,o);else for(s=0,l=0,d=0;d<g.horizontalGridLines.linesInterval.length;d+=2)h=g.horizontalGridLines.linesInterval[d],r=Number(s+h/2),c=o.path({d:"M 0 "+r*e+" L "+a*e+" "+r*e+" Z",stroke:g.horizontalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":g.horizontalGridLines.lineDashArray}),s+=g.horizontalGridLines.linesInterval[d+1]+h,i.appendChild(c),l++},_renderVerticalGridlines:function(e,i,a,n,o){var s,r,l,d,h,c,u=n.model,g=u.snapSettings;if(g.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)if(n.model.rulerSettings.showRulers&&this._checkForDefaultGridlines(n.model.snapSettings.verticalGridLines.linesInterval))this._updateRulerSegment(e,i,a,n,o,!0);else for(s=0,l=0,d=0;d<g.verticalGridLines.linesInterval.length;d+=2)h=u.snapSettings.verticalGridLines.linesInterval[d],r=Number(s+h/2),c=o.path({d:"M "+r*e+" 0 L "+r*e+" "+a*e+" Z",stroke:g.verticalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":g.verticalGridLines.lineDashArray}),s+=g.verticalGridLines.linesInterval[d+1]+h,i.appendChild(c),l++},transformView:function(e,i,a){var n=(t.datavisualization.Diagram.ScrollUtil._getRulerSize(e),e._view),o={transform:"translate("+i+","+a+")"};t.datavisualization.Diagram.Util.attr(n,o),t.datavisualization.Diagram.Util.attr(e._adornerLayer,o),t.datavisualization.Diagram.Util.attr(e._expander,{transform:"translate("+i+","+a+"),scale("+e.model.scrollSettings.currentZoom+")"}),e._htmlLayer&&(e._htmlLayer.style.left=i+"px",e._htmlLayer.style.top=a+"px",e._htmlLayer.style.position="absolute")},scaleContent:function(e,i){var a,n,o,s,r,l,d=e._diagramLayer;for(t.datavisualization.Diagram.Util.attr(d,{transform:"scale("+i+")"}),a="function"==typeof e.model.scrollSettings.horizontalOffset?e.model.scrollSettings.horizontalOffset():e.model.scrollSettings.horizontalOffset,n="function"==typeof e.model.scrollSettings.verticalOffset?e.model.scrollSettings.verticalOffset():e.model.scrollSettings.verticalOffset,t.datavisualization.Diagram.Util.attr(e._expander,{transform:"translate("+-a+","+-n+"),scale("+i+")"}),e._htmlLayer&&(e._htmlLayer.style.webkitTransform="scale("+i+")",e._htmlLayer.style.MozTransform="scale("+i+")",e._htmlLayer.style.OTransform="scale("+i+")",e._htmlLayer.style.msTransform="scale("+i+")",e._htmlLayer.style.transform="scale("+i+")"),e.selectionList.length>0&&this.updateSelector(e.selectionList[0],e._adornerSvg,i,e,e.model.selectedItems.constraints),e.selectionList[0]&&e.model.selectedItems.userHandles&&e.model.selectedItems.userHandles.length>0&&(o=!1,"pseudoGroup"==e.selectionList[0].type&&(o=!0),e.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&t.datavisualization.Diagram.SvgContext.updateUserHandles(e.model.selectedItems.userHandles,e.selectionList[0],e._adornerSvg,o,!1,i,e)),s=e.nodes(),r=0,l=s.length;l>r;++r)this._updatePortScale(s[r],e)},_updatePortScale:function(e,t){var i,a,n;if(e=t.nameTable[t._getChild(e)],this._updatePorts(e,t._adornerSvg,t),"pseudoGroup"!=e.type&&(i=e.children,i&&i.length>0))for(a=0,n=i.length;n>a;++a)this._updatePortScale(i[a],t)},setSize:function(i,a,n){if(t.datavisualization.Diagram.Util.attr(i._svg.document,{width:a+"px",height:n+"px"}),!i._svgParentDimention){var o=t.datavisualization.Diagram.ScrollUtil._getRulerSize(i);i._svgParentDimention={},i._svgParentDimention.width=i.element.width()-o.left,i._svgParentDimention.height=i.element.height()-o.top}e(i._svgParent).css("width",i._svgParentDimention.width+"px").css("height",i._svgParentDimention.height+"px"),t.datavisualization.Diagram.Util.attr(i._adornerSvg.document,{width:a+"px",height:n+"px"})},_findIndex:function(t,i){var a,n,o,s=1;return o=i.parent?e("#"+i.parent.name).find(">.node,>.connector,>.group"):e("#DiagramContent_canvas_svg").find(">.node,>.connector,>.group"),"helper"!=i.name&&(a=o[o.length-1],a&&"helper"==a.id&&(a=o[o.length-2]),a&&(n=0,"ej-d-node"==a.className.animVal||"ej-d-group"==a.className.animVal?s=n+1:"ej-d-connector"==a.className.animVal&&(s=n+1))),s},renderNode:function(e,i,a,n,o,s){var r,l,d=e.width?e.width:e._width||0,h=e.height?e.height:e._height||0,c=e.name,u=0,g=0,m=0,p=0,f=0,v=e.visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",o)?"visible":"hidden";return n||(m=e.offsetX-d*e.pivot.x,p=e.offsetY-h*e.pivot.y,u=e.offsetX,g=e.offsetY,f=e.rotateAngle),t.datavisualization.Diagram.Util.canCrispEdges(e,o)&&(m=Math.floor(m)+.5,p=Math.floor(p)+.5),l={id:c,"class":"ej-d-node",transform:"rotate("+f+","+u+","+g+"),translate("+m+","+p+")",visibility:v},t.datavisualization.Diagram.Util.canEnablePointerEvents(e,o)||(l.style="pointer-events:none"),e._isClassifier&&(l["class"]+=" ej-d-classifier"),r=i.g(l),a?a.appendChild(r):i.appendChild(r),e._isDisabled&&t.datavisualization.Diagram.Util.attr(r,{style:"pointer-events:none;"}),this._renderNode(e,i,r,o,n,s),e&&e.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(e,o),e._isClassifier&&delete e._isClassifier,r},_renderNode:function(e,t,i,a,n,o){this._renderShape(e,t,i,a),this._renderLabels(e,t,a,n),this._renderPorts(e,a._adornerSvg&&!o?a._adornerSvg:t,a,o),e.outEdges.length>0&&this._renderIcons(e,a)},_renderShadow:function(e,i){var a,n,o,s,r,l;e.segments||(a=i.document.getElementById(e.name),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(n=e.fillColor,"image"===e.type||"text"===e.type||"html"===e.type?o=i.document.getElementById(e.name+"_backRect"):"text"!=e.type&&"image"!=e.type&&(o=i.document.getElementById(e.name+"_shape")),o&&(s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),r={id:e.name+"_shadow",width:e.width,height:e.height,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=n||"transparent"!=n?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:e.shadow.opacity,"stroke-dasharray":""},"native"===e.type||"html"===e.type?a.insertBefore(i.rect(r),o):(l=o.cloneNode(!0),a.insertBefore(l,o),t.datavisualization.Diagram.Util.attr(l,r)))))},_updateShadow:function(e,i){var a=(i.document.getElementById(e.name),t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance)),n={id:e.name+"_shadow",transform:"translate("+a.x+","+a.y+")",opacity:e.shadow.opacity};i.g(n)},_deleteLabel:function(e,t,i,a,n){var o,s,r,l,t;if("html"===i.model.labelRenderingMode){if(o=n.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=this._findChild(o.childNodes,e))for(r=s.childNodes.length,l=0;r>l;l++)s.childNodes[l].id==e.name+"_"+t.name+"_lblbg"&&s.childNodes[l].parentNode.removeChild(s.childNodes[l])}else t=a.document.getElementById(e.name+"_"+t.name),t&&t.parentNode.removeChild(t)},_deletePort:function(e,t,i,a){if(e){var t=a.document.getElementById(e.name+"_"+t.name);t&&t.parentNode.removeChild(t)}},_removeShadow:function(e,t){if("text"!=e.type){var i,a,n=e.name;"bpmn"===e.type&&e.children&&"group"!=e.shape&&(n=e.children[0].name),i=t.document.getElementById(n),a=t.document.getElementById(n+"_shadow"),i&&a&&i.removeChild(a)}},_renderphase:function(e,i,a,n,o){var s,r,l,d,h;s=i.g({id:e.name+"_phase_g","class":"ej-d-seperator"}),e.parent?a.appendChild(s):i.appendChild(s);var c="visible",u=0,g=0;if(o){r=n._getChildren(o.children),r.length>1&&(l=n.nameTable[r[0]]);var m,p=t.datavisualization.Diagram.Util.bounds(o),f=[],v=p.top+50,_=p.left+50;"vertical"==e.orientation?(f.push({x:0,y:0}),f.push({x:p.width,y:0}),m=this._convertToSVGPoints(f),u=p.x,g=p.y+e.offset+l.height,l&&(v+=l.height),g<p.bottom&&g>v||(c="hidden")):(f.push({x:0,y:l.height?l.height:0}),f.push({x:0,y:p.height}),m=this._convertToSVGPoints(f),u=p.x+e.offset,g=p.y,u<p.right&&u>_||(c="hidden")),d={id:e.name+"_phase",stroke:e.lineColor,"stroke-width":e.lineWidth,"stroke-dasharray":e.lineDashArray,points:m},h=i.polyline(d),s.appendChild(h),d={id:e.name+"_phase_hitTest","class":"hitTest","stroke-width":10,points:m,stroke:"transparent"},h=i.polyline(d),s.appendChild(h),s.setAttribute("transform","translate("+u+","+g+")")}},renderphase:function(e,t,i,a,n){var o,s;a._views.forEach(function(t){o=a._views[t],s=o.svg||o._canvas,i&&(i=s.document.getElementById(i.id)),o.context._renderphase(e,s,i||o.diagramLayer,a,n)})},_renderGroupBackground:function(e,i,a,n){var o,s,r,l;if("none"!=e.fillColor){var d=e.offsetX-e.width*e.pivot.x,h=e.offsetY-e.height*e.pivot.y,c=e.fillColor,u=e.borderColor;("bpmn"==e.type&&"group"!=e.shape||e.classifier&&"package"==e.classifier)&&(c="transparent",u="transparent"),t.datavisualization.Diagram.Util.canCrispEdges(e,n)&&(d=Math.floor(d)+.5,h=Math.floor(h)+.5);var g=e.rotateAngle,m=new t.datavisualization.Diagram.Point(d+e.width*e.pivot.x,h+e.height*e.pivot.y),p={id:e.name+"_shape",rx:e.cornerRadius,ry:e.cornerRadius,width:Math.round(e.width<0?0:e.width),height:Math.round(e.height<0?0:e.height),fill:c,stroke:u,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray,transform:"rotate("+g+","+m.x+","+m.y+"),translate("+d+","+h+")"};("umlclassifier"==e.type||e._isClassifier)&&(p["class"]="ej-d-group ej-d-classifier"),e.gradient&&"bpmn"!=e.type&&(p.fill=this._renderGradient(e.name,e.gradient,a)),this._addCssClass(e,p),o=a.rect(p),i.appendChild(o),"bpmn"===e.type&&"group"===e.shape&&e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),"group"===e.shape&&0===e.children.length&&(s.x=e.offsetX-e.width*e.pivot.x+s.x,s.y=e.offsetY-e.height*e.pivot.y+s.y),r={id:e.name+"_shadow",width:e.width,height:e.height,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=c||"transparent"!=c?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:e.shadow.opacity,"stroke-dasharray":""},l=o.cloneNode(!0),i.insertBefore(l,o),t.datavisualization.Diagram.Util.attr(l,r))}},renderGroup:function(i,a,n,o,s,r,l){var d,h,c,u,g,m,p,f,n,v,_=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",s)?"visible":"hidden",y={id:i.name,"class":"ej-d-group",visibility:_};if(t.datavisualization.Diagram.Util.canEnablePointerEvents(i,s)||(y.style="pointer-events:none"),("umlclassifier"==i.type||i._isClassifier)&&(y["class"]+=" ej-d-classifier"),d=a.g(y),n?n.appendChild(d):a.appendChild(d),""==i.parent&&i.container&&(r&&(i.height=0,i.width=0),l||s._updateChildAdjacentConnectors(i)),this._renderGroupBackground(i,d,a,s),i.isSwimlane&&(s._disableSwimlaneUptate=!0),h=i.children,h&&h.length>0)for(c=0,u=h.length;u>c;c++)g=o[t.datavisualization.Diagram.Util.getChild(h[c])],g&&("group"===g._type?("umlclassifier"==i.type&&(g._isClassifier=!0),this.renderGroup(g,a,d,o,s,r,l),t.datavisualization.Diagram.Util._updateGroupBounds(g,s,!0),t.datavisualization.Diagram.DiagramContext.update(g,s)):g.segments?(t.datavisualization.Diagram.Util.updateBridging(g,s),this.renderConnector(g,a,d,s)):("umlclassifier"==i.type&&(g._isClassifier=!0),this.renderNode(g,a,d,void 0,s,l),g._isService&&(m=e.extend(!0,{},g),m.name=g.name+"service",m.offsetX=g.offsetX+7,m.offsetY=g.offsetY+5,this.renderNode(m,a,d,void 0,s,l))));return this._renderLabels(i,a,s),this._renderPorts(i,s._adornerSvg&&!l?s._adornerSvg:a,s,l),i.isSwimlane&&delete s._disableSwimlaneUptate,i&&i.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(i,s),i&&i.isSwimlane&&(v=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(s,i),s._views.forEach(function(e){var t,a;for(p=s._views[e],f=p.svg||p._canvas,n&&(n=f.document.getElementById(n.id)),t=0;v&&t<v.length;t++)a=s.nameTable[s._getChild(v[t])],a&&p.context._renderphase(a,f,n||p.diagramLayer,s,i)})),i._isClassifier&&delete i._isClassifier,d},_renderGradient:function(e,t,i){var a,n;return"linear"===t.type?(n=this._renderLinearGradient(i.id+"_"+e,t,i),a="url(#"+n+")"):"radial"===t.type&&(n=this._renderRadialGradient(i.id+"_"+e,t,i),a="url(#"+n+")"),a},_checkGradientTag:function(e,t,i){if(t.getElementById(e+"_gradient")){var a=t.getElementById(e+"_gradient");(i&&"radialGradient"===a.localName||!i&&"linearGradient"===a.localName)&&a.parentNode.removeChild(a)}},_renderLinearGradient:function(e,t,i){var a,n,o=i.document.getElementById(i.document.parentNode.parentNode.id+"patterndefinition")||i.document.getElementById(e+"patterndefinition");return o?(this._checkGradientTag(e,i,!0),a={id:e+"_gradient",x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"},n=i.linearGradient(a),this._renderStops(t,i,n),o.appendChild(n),n.id):null},_renderRadialGradient:function(t,i,a){var n,o,s=a.document.getElementById(e(a.document).parents()[1].id+"patterndefinition")||a.document.getElementById(t+"patterndefinition");return s?(this._checkGradientTag(t,a,!1),n={id:t+"_gradient",cx:i.cx+"%",cy:i.cy+"%",fx:i.fx+"%",fy:i.fy+"%",r:i.r+"%"},o=a.radialGradient(n),this._renderStops(i,a,o),s.appendChild(o),o.id):null},_renderStops:function(e,t,i){var a,n,o,s;if(t.getElementById(i.getAttribute("id"))===i)for(;i.firstChild;)i.removeChild(i.firstChild);for(a=e.stops,o=0,s=a.length;s>o;o++)n=a[o],i.appendChild(t.stop({offset:n.offset+"%","stop-color":n.color,"stop-opacity":n.opacity}))},_renderShape:function(e,t,i,a){var n=e._shape?e._shape:e.type;switch(n){case"rectangle":this._renderRect(e,t,i);break;case"ellipse":this._renderEllipse(e,t,i);break;case"image":this._renderImage(e,t,i);break;case"path":this._renderPath(e,t,i);break;case"polygon":this._renderPolygon(e,t,i);break;case"text":this._renderTextElement(e,t,i,a);break;case"html":this._renderHtmlElement(e,t,i,a);break;case"native":this._rendercontent(e,t,i,a)}},_renderHTMLTemplate:function(t,i){return t.templateId&&e.templates?i._renderEjTemplate("#"+t.templateId,t):void 0},_renderSvgTemplate:function(e,t,i,a){var n,o,s,r,l=document.createElement("div");l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+a+"</g></svg>",document.body.appendChild(l),n=document.getElementById("tempNative"),o=n.cloneNode(!0),o.id=e.name+"_shape",i.appendChild(o),s={id:e.name+"_shape",fill:e.fillColor,stroke:e.borderColor,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray},this._addCssClass(e,s),e.gradient&&(s.fill=this._renderGradient(e.name,e.gradient,t)),t.g(s),r=this._scaleNodeContent(e,n),r&&o.setAttribute("transform","translate("+r.x+","+r.y+"),scale("+r.sx+","+r.sy+")"),o.setAttribute("id",e.name+"_shape"),l.parentNode.removeChild(l)},_scaleNodeContent:function(e,t){var i,a,n,o;if("none"!=e.scale){t&&(n="html"==e.type?t.getBoundingClientRect():t.getBBox()),"html"==e.type&&(n.x=n.left,n.y=n.top),i=e.width?e.width:e._width,a=e.height?e.height:e._height,t||(n={x:e.offsetX-e.width*e.pivot.x,y:e.offsetY-e.height*e.pivot.y,width:i,height:a});var s=n.width?i/n.width:1,r=n.height?a/n.height:1,l=n.x*s*-1,d=n.y*r*-1;return"stretch"!=e.scale&&"none"!=e.contentAlignment?(o="meet"==e.scale?Math.min(s,r):Math.max(s,r),e.contentAlignment.indexOf("xmid")>-1?l=i/2-n.width*o/2:e.contentAlignment.indexOf("xmax")>-1&&(l=n.x+i-n.width*o),e.contentAlignment.indexOf("ymid")>-1?d=n.y+a/2-n.height*o/2:e.contentAlignment.indexOf("ymax")>-1&&(d=n.y+a-n.height*o),{x:l,y:d,sx:o,sy:o}):{x:l,y:d,sx:s,sy:r}}return null},_rendercontent:function(i,a,n,o){var s,r,l;if(i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){var d=i.fillColor,h=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},i.shadow.angle,i.shadow.distance),c={id:i.name+"_shadow",width:i.width,height:i.height,stroke:"none"!=i.borderColor||"transparent"!=i.borderColor?"lightgrey":"none",fill:"none"!=d||"transparent"!=d?"lightgrey":"none",transform:"translate("+h.x+","+h.y+")",opacity:i.shadow.opacity};n.appendChild(a.rect(c))}!i.segments&&i.templateId&&e.templates&&(s=i.width,r=i.height,"node"!==i._type||i.height||i.width||(i.width=i._width,i.height=i._height),l=o._renderEjTemplate("#"+i.templateId,i),i.width=s,i.height=r,this._renderSvgTemplate(i,a,n,l))},_fill:function(e,t){var i;return e.gradient&&(i=this._renderGradient(e.name,e.gradient,t)),i||(i=e.fillColor),i},_addCssClass:function(e,t){return e.cssClass&&t&&(t["class"]=t["class"]?t["class"]+" "+e.cssClass:e.cssClass),e._cssClass=e.cssClass,t},_updateCssClass:function(e,t){if((""!=e._cssClass||""===e._cssClass&&""!==e.cssClass)&&void 0!==e._cssClass&&e.cssClass!=e._cssClass){var i=t["class"];return i&&(t["class"]=i.replace(e._cssClass,"").trim()),this._addCssClass(e,t)}return t},_renderRect:function(e,i,a){var n,o,s,r=this._fill(e,i),l=e.width?e.width:e._width,d=e.height?e.height:e._height,h={id:e.name+"_shape",rx:e.cornerRadius,ry:e.cornerRadius,role:"presentation",width:l,height:d,fill:r,stroke:e.borderColor,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray};e._isClassifier&&(n="ej-d-node ej-d-classifier"),h["class"]=n,this._addCssClass(e,h),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),s={id:e.name+"_shadow",rx:e.cornerRadius,ry:e.cornerRadius,width:e.width,height:e.height,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=r||"transparent"!=r?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:e.shadow.opacity},a.appendChild(i.rect(s))),a.appendChild(i.rect(h))},_renderEllipse:function(e,i,a){var n,o,s=e.width?e.width:e._width,r=e.height?e.height:e._height,l=this._fill(e,i),d={id:e.name+"_shape",rx:s/2,ry:r/2,role:"presentation",cx:s/2,cy:r/2,fill:l,stroke:e.borderColor,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray};this._addCssClass(e,d),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(n=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),o={id:e.name+"_shadow",rx:e.width/2,ry:e.height/2,cx:e.width/2,cy:e.height/2,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+n.x+","+n.y+")",opacity:e.shadow.opacity},a.appendChild(i.ellipse(o))),a.appendChild(i.ellipse(d))},_renderImage:function(e,i,a){var n,o=(e.fillColor,this._renderBackgroundRect(e,i,a),e.width?e.width:e._width),s=e.height?e.height:e._height,r=t.datavisualization.Diagram.Util._getImageAlignment(e.contentAlignment),l="none"==e.scale?"meet":e.scale,d={id:e.name+"_shape",opacity:e.opacity,preserveAspectRatio:"stretch"!=l&&"none"!=r?r+" "+l:"none",width:o,height:s,role:"img"},h=new Image;h.src=e.source,"none"==e.scale&&(d.width=h.width||o,d.height=h.height||s),n=i.image(d),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),a.appendChild(n)},_renderPolygon:function(e,i,a){var n,o,s,r,l=this._fill(e,i);t.datavisualization.Diagram.Geometry.updatePolygonPoints(e),n=this._convertToSVGPoints(e.points),o={id:e.name+"_shape",fill:l,stroke:e.borderColor,role:"presentation","stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray,points:n},this._addCssClass(e,o),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),r={id:e.name+"_shadow",points:n,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:e.shadow.opacity},a.appendChild(i.polygon(r))),a.appendChild(i.polygon(o))},_renderPath:function(e,i,a){var n,o,s,r,l=this._fill(e,i),d=e.width?e.width:e._width,h=e.height?e.height:e._height;e._absolutePath=n=e._preventStretch||e._polyline?e.pathData:t.datavisualization.Diagram.Geometry.updatePath(0,0,d,h,e.pathData,i,null,e),o={id:e.name+"_shape",d:n,opacity:e.opacity,role:"presentation","stroke-dasharray":e.borderDashArray,stroke:e.borderColor,"stroke-width":e.borderWidth,fill:l},e._isClassifier&&(o["class"]="ej-d-node ej-d-classifier"),this._addCssClass(e,o),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),r={id:e.name+"_shadow",width:e.width,height:e.height,d:n,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",fill:"none"!=l||"transparent"!=l?"lightgrey":"none",transform:"translate("+s.x+","+s.y+")",opacity:e.shadow.opacity},a.appendChild(i.path(r))),a.appendChild(i.path(o))},_renderHtmlElement:function(i,a,n,o){var s,r,l,d,h,c,u,g,m;this._renderBackgroundRect(i,a,n);if(!i.segments&&i.templateId){m=a.document.parentNode.getElementsByClassName("htmlLayer")[0],s=e(m).children("#"+i.name+"_parentdiv")[0],s&&m.removeChild(s);var p=i.width?i.width:i._width,f=i.height?i.height:i._height,v=i.offsetX-p*i.pivot.x,_=i.offsetY-f*i.pivot.y,r=a.document.getElementById(i.name+"_html");r||(r=document.createElement("div")),l="width:"+p+"px;height:"+f+"px;padding:1px; left:"+v+"px; top:"+_+"px;position:absolute;",l+="display: block; border:0px; pointer-events: all; opacity:"+i.opacity+";",l+="transform:rotate("+i.rotateAngle+"deg)",d={id:i.name+"_html","class":"foreignObject",style:l},this._addCssClass(i,d),t.datavisualization.Diagram.Util.attr(r,d),!i.segments&&i.templateId&&(h=this._renderHTMLTemplate(i,o),r.innerHTML=h),c=document.createElement("div"),u={id:i.name+"_parentdiv","class":"ej-d-node"},t.datavisualization.Diagram.Util.attr(c,u),c.appendChild(r),g=i.visible?"visible":"hidden",c.style.visibility=g,m=a.document.parentNode.getElementsByClassName("htmlLayer")[0],m?m.appendChild(c):a.document.parentNode.appendChild(r)}},_initializeGuidelines:function(e,t,i){var a=e.g(t);return i.appendChild(a),a},_renderSideAlignmentLines:function(e,t,i,a,n){var o=a.line({x1:e.x*n,y1:e.y*n,x2:t.x*n,y2:t.y*n,stroke:"#07EDE1","stroke-width":1});i.appendChild(o)},_renderCenterAlignmentLines:function(e,t,i,a,n){var o=a.line({x1:e.x*n,y1:e.y*n,x2:t.x*n,y2:t.y*n,stroke:"#07EDE1","stroke-width":1});i.appendChild(o)},_renderSpacingLines:function(e,t,i,a,n){var o,s,r,l;i&&(r=a.g({}),e.x==t.x?(o="M"+(e.x*n-5)+" "+(e.y*n+5)+" L"+e.x*n+" "+e.y*n+" L"+(e.x*n+5)+" "+(e.y*n+5)+"z",s="M"+(t.x*n-5)+" "+(t.y*n-5)+" L"+t.x*n+" "+t.y*n+" L"+(t.x*n+5)+" "+(t.y*n-5)+"z",r.appendChild(a.line({x1:e.x*n-8,x2:e.x*n+8,y1:e.y*n-1,y2:e.y*n-1,stroke:"#07EDE1","stroke-width":1})),r.appendChild(a.line({x1:t.x*n-8,x2:t.x*n+8,y1:t.y*n+1,y2:t.y*n+1,stroke:"#07EDE1","stroke-width":1}))):(o="M"+(e.x*n+5)+" "+(e.y*n+5)+" L"+e.x*n+" "+e.y*n+" L"+(e.x*n+5)+" "+(e.y*n-5)+"z",s="M"+(t.x*n-5)+" "+(t.y*n-5)+" L"+t.x*n+" "+t.y*n+" L"+(t.x*n-5)+" "+(t.y*n+5)+"z",r.appendChild(a.line({x1:e.x*n-1,x2:e.x*n-1,y1:e.y*n-8,y2:e.y*n+8,stroke:"#07EDE1","stroke-width":1})),r.appendChild(a.line({x1:t.x*n+1,x2:t.x*n+1,y1:t.y*n-8,y2:t.y*n+8,stroke:"#07EDE1","stroke-width":1}))),r.appendChild(a.path({d:o,fill:"#07EDE1"})),l=a.line({x1:e.x*n,y1:e.y*n,x2:t.x*n,y2:t.y*n,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"}),r.appendChild(l),r.appendChild(a.path({d:s,fill:"#07EDE1"})),i.appendChild(r))},_removeGuidelines:function(e,t){null!=t&&e.removeChild(t)},update:function(e,t){t&&!t._isInit&&"new"!==e._status&&(e._status="update");var i=t._svg;"group"===e._type?this.updateGroup(e,i,t):e.segments?this.updateConnector(e,i,t):this.updateNode(e,i,t)},_updateGoupBackground:function(e,i,a){var n,o,s,r,l,d=e.offsetX-e.width*e.pivot.x,h=e.offsetY-e.height*e.pivot.y,c=e.rotateAngle,u=new t.datavisualization.Diagram.Point(d+e.width*e.pivot.x,h+e.height*e.pivot.y),g=e.fillColor,m=e.borderColor,p=t.datavisualization.Diagram.NodeConstraints;("bpmn"==e.type&&"group"!=e.shape||e.classifier&&"package"==e.classifier)&&(g="transparent",m="transparent"),t.datavisualization.Diagram.Util.canCrispEdges(e,a)&&(d=Math.floor(d)+.5,h=Math.floor(h)+.5),n={id:e.name+"_shape",rx:e.cornerRadius,ry:e.cornerRadius,width:Math.round(e.width<0?0:e.width),height:Math.round(e.height<0?0:e.height),fill:g,stroke:m,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray,transform:"rotate("+c+","+u.x+","+u.y+"),translate("+d+","+h+")"},"group"===e.shape&&e.constraints&p.Shadow&&(o=i.document.getElementById(e.name+"_shadow"),s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),d=e.offsetX-e.width*e.pivot.x+s.x,h=e.offsetY-e.height*e.pivot.y+s.y,r={id:e.name+"_shadow",width:e.width,height:e.height,stroke:"none"!=e.borderColor||"transparent"!=e.borderColor?"lightgrey":"none",transform:"translate("+d+","+h+")",opacity:e.shadow.opacity,"stroke-dasharray":""},o&&t.datavisualization.Diagram.Util.attr(o,r)),e.gradient&&"bpmn"!=e.type&&(n.fill=this._renderGradient(e.name,e.gradient,i)),l=i.getElementById(e.name+"_shape"),l&&(n["class"]=l.getAttribute("class"),this._updateCssClass(e,n),t.datavisualization.Diagram.Util.attr(l,n))},updateGroup:function(i,a,n,o,s){var r,l,d,h,c,u,g,m=n._getChildren(i.children),p=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",f="display:block;";for(i.visible||(f="display:none;"),t.datavisualization.Diagram.Util.canEnablePointerEvents(i,n)||(f="pointer-events:none"),a.g({id:i.name,visibility:p,style:f}),r=0,l=m.length;l>r;r++)d=n.nameTable[m[r]],d&&("group"===d._type?this.updateGroup(d,a,n,o,s):d.segments?(t.datavisualization.Diagram.Util.updateBridging(d,n),this.updateConnector(d,a,n)):(this.updateNode(d,a,n,o,s),d._isService&&(h=e.extend(!0,{},d),h.name=d.name+"service",h.offsetX=d.offsetX+7,h.offsetY=d.offsetY+5,this.updateNode(h,a,n,o,s))));if(a.g({id:i.name,visibility:p,style:f}),this._updateGoupBackground(i,a,n),this._updateAssociatedConnector(i,a,n),this._updateLabels(i,a,n),this._updatePorts(i,n._adornerSvg&&!s?n._adornerSvg:a,n,s),i.isSwimlane&&(c=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),u=null,c&&c.length>0))for(g=0;g<c.length;g++)u=n.nameTable[n._getChild(c[g])],u&&this._updatephase(u,n,i),this._updatePhaseStyle(u,{},n)},_removephases:function(e,i){var a,n,o;if(e.isSwimlane&&(a=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(i,e)))for(n=a.length;n>=0;n--)o=i.nameTable[i._getChild(a[n])],this._removePhase(i,o)},_removePhase:function(e,t){t&&e._views.forEach(function(i){var a=e._views[i],n=a.svg||a._canvas,o=n.document.getElementById(t.name+"_phase_g");o&&o.parentNode.removeChild(o)})},_updatePhaseStyle:function(e,i,a){if(e&&i){var n=e.visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",a)?"visible":"hidden";a._svg.g({id:e.name+"_phase_g",visibility:n}),i.id=e.name+"_phase",a._svg.g(i)}},_updatephase:function(e,t,i){var a,n;t._views.forEach(function(o){a=t._views[o],n=a.svg||a._canvas,a.context._updatephase1(e,t,n,i)})},_updatephase1:function(i,a,n,o){var s,r;if(n=n?n:a._svg,o){var l,d=0,h=0,c=null,u=[],g=t.datavisualization.Diagram.Util.bounds(o),m=a._getChildren(o.children);m.length>1&&(s=a.nameTable[m[0]]);var p=g.top+50,f=g.left+50;"vertical"==i.orientation?(d=g.x,h=g.y+s.height+i.offset,s&&(p+=s.height),h-.1<=g.bottom&&h-.1>=p&&(c="translate("+d+","+h+")"),u.push({x:0,y:0}),u.push({x:g.width,y:0}),l=this._convertToSVGPoints(u)):(d=g.x+i.offset,h=g.y,d-.1<=g.right&&d-.1>f&&(c="translate("+d+","+h+")"),s&&(u.push({x:0,y:s.height}),u.push({x:0,y:g.height})),l=this._convertToSVGPoints(u)),r={points:l,id:i.name+"_phase"},n.polyline(r),r={points:l,id:i.name+"_phase_hitTest"},n.polyline(r),c&&(r={id:i.name+"_phase_g",transform:c}),i.label&&a.model.labelRenderingMode!=t.datavisualization.Diagram.LabelRenderingMode.Svg&&this._updatePhaseLabel(i,i.label,a),n.g(r),n.getElementById(r.id)&&e("#"+r.id).insertAfter(e("#"+r.id)[0].parentNode.lastChild)}},_updatePhaseLabel:function(e,i,a){var n=a._svg,o=a._getPhaseBounds(e),s=n.getElementById(e.name+"_"+i.name);if(s){if(s.setAttribute("fill",i.fontColor),!i.text)return;s.textContent=i.text,o=t.datavisualization.Diagram.Util.bounds(e),this._wrapText(e,o,s,i,n),this._alignTextOnPhase(e,o,s,i,n)}},updateLabelStyle:function(i,a,n,o){var s,r,l;a.templateId?o&&o.model.labelRenderingMode!==t.datavisualization.Diagram.LabelRenderingMode.Svg&&(r=n.document.parentNode.getElementsByClassName("htmlLayer")[0],l=e(r).find("#"+i.name+"_"+a.name)[0],i&&l&&a&&(l.style.opacity=a.opacity,l.style.visibility=a.visible?"":"hidden")):o&&o.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?(s={id:i.name+"_"+a.name+"_lblbg",fill:a.fillColor,stroke:a.borderColor,"stroke-width":a.borderWidth,"pointer-events":"none",visibility:a.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden","fill-opacity":a.opacity,"stroke-opacity":a.opacity
},n.rect(s),s={id:i.name+"_"+a.name,"class":"ej-d-label","font-family":a.fontFamily,"font-size":a.fontSize,fill:a.fontColor,"text-decoration":a.textDecoration,"font-weight":a.bold?"bold":"normal","font-style":a.italic?"italic":"normal",visibility:a.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden","fill-opacity":a.opacity,"stroke-opacity":a.opacity},l=n.text(s),s["class"]=l.getAttribute("class"),this._updateCssClass(a,s),t.datavisualization.Diagram.Util.attr(l,s)):(r=n.document.parentNode.getElementsByClassName("htmlLayer")[0],l=e(r).find("#"+i.name+"_"+a.name)[0],i&&l&&a&&!a.templateId&&(l.style.fontWeight=a.bold?"bold":"",l.style.fontStyle=a.italic?"italic":"",l.style.visibility=a.visible?"":"hidden",l.style.opacity=a.opacity,l.style.textDecoration=a.textDecoration,l.style.fontFamily=a.fontFamily,l.style.fontSize=a.fontSize+"px",l.style.color=a.fontColor,l.style.backgroundColor=a.fillColor,l.style.borderColor=a.borderColor,l.style.borderWidth=a.borderWidth+"px",l.style.borderStyle="solid",i._isHeader&&(l.style.borderWidth="0px",l.style.backgroundColor="transparent"),s=this._updateCssClass(a,{"class":l.className}),s&&(l.className=s["class"])))},updatePort:function(e,i,a,n){var o,s=a.getElementById(e.name+"_"+i.name);s&&(s&&s.parentNode&&s.parentNode.removeChild(s),o=a.getElementById(e.name+"_ej_ports"),s=t.datavisualization.Diagram.SvgContext._renderPort(e,i,n._adornerSvg,n),o.appendChild(s))},_updateNodeStyle:function(i,a){var n,o,s,r,l;i&&a&&(n={},n.opacity=i.opacity,n.fill=i.fillColor,n.stroke=i.borderColor,n["stroke-width"]=i.borderWidth,n["stroke-dasharray"]=i.borderDashArray,i.gradient&&(n.fill=this._renderGradient(i.name,i.gradient,a)),"node"==i._type&&(o="text"==i.type||"html"==i.type?"_backRect":"_shape","html"==i.type&&(s=a.document.parentNode.getElementsByClassName("htmlLayer")[0],r=e(s).children("#"+i.name+"_parentdiv")[0].childNodes[0],r&&(r.style.opacity=i.opacity)),r=a.getElementById(i.name+o),r&&(n["class"]=r.getAttribute("class"),this._updateCssClass(i,n),t.datavisualization.Diagram.Util.attr(r,n)),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(l=a.document.getElementById(i.name+"_shadow"),l&&t.datavisualization.Diagram.Util.attr(l,{fill:"none"!=i.fillColor||"transparent"!=i.fillColor?"lightgrey":"none"}))))},_updateConnectorStyle:function(e,i){var a,n;e&&i&&(a={},a.opacity=e.opacity,a.stroke=e.lineColor,a["stroke-width"]=e.lineWidth,a["stroke-dasharray"]=e.lineDashArray,n=i.getElementById(e.name+"_segments"),n&&(a["class"]=n.getAttribute("class"),this._updateCssClass(e,a),t.datavisualization.Diagram.Util.attr(n,a)))},updateTargetDecoratorStyle:function(e,i){var a,n;i&&(a={},a.stroke=e.targetDecorator.borderColor,a.fill=e.targetDecorator.fillColor,n=i.getElementById(e.name+"_targetDecorator"),n&&(a["class"]=n.getAttribute("class"),this._updateCssClass(e.targetDecorator,a),t.datavisualization.Diagram.Util.attr(n,a)))},updateSourceDecoratorStyle:function(e,i){var a,n;i&&(a={},a.stroke=e.sourceDecorator.borderColor,a.fill=e.sourceDecorator.fillColor,n=i.getElementById(e.name+"_sourceDecorator"),n&&(a["class"]=n.getAttribute("class"),this._updateCssClass(e.sourceDecorator,a),t.datavisualization.Diagram.Util.attr(n,a)))},updateNode:function(e,t,i,a,n){if(t){if(i&&!i._isInit&&"new"!==e._status&&(e._status="update"),this._updateLabels(e,t,i),this._updateNode(e,t,i),e.outEdges.length&&this._updateIcons(e,t,i),e._scaled=!1,i._layoutInAction)return;this._updateAssociatedConnector(e,t,i),this._updatePorts(e,i._adornerSvg&&!n?i._adornerSvg:t,i,n)}},updateTextBlock:function(t,i,a,n){var o=a.document.parentNode.getElementsByClassName("htmlLayer")[0],s=e(o).children("#"+t.name+"_label")[0],r=e(s).children("#"+t.name+"_shape_lblbg")[0],l=r.childNodes[0];t&&l&&i&&(l.style.fontWeight=i.bold?"bold":"",l.style.fontStyle=i.italic?"italic":"",l.style.textDecoration=i.textDecoration,l.style.fontFamily=i.fontFamily,l.style.fontSize=i.fontSize+"px",l.style.color=i.fontColor),this._updateTextElement(t,a,n)},_updateAssociatedConnector:function(e,i,a){var n,o;if(!a._associatedConnectorsUpdate){if(e.inEdges&&e.inEdges.length>0)for(n=0,o=e.inEdges.length;o>n;n++)a.nameTable[e.inEdges[n]]&&(a.nameTable[e.inEdges[n]]&&t.datavisualization.Diagram.Util.canBridge(a.nameTable[e.inEdges[n]],a)&&(t.datavisualization.Diagram.Util.updateBridging(a.nameTable[e.inEdges[n]],a),a._updateConnectorBridging(a.nameTable[e.inEdges[n]])),a._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(a.nameTable[e.inEdges[n]],a));if(e.outEdges&&e.outEdges.length>0)for(n=0,o=e.outEdges.length;o>n;n++)a.nameTable[e.outEdges[n]]&&(a.nameTable[e.outEdges[n]]&&t.datavisualization.Diagram.Util.canBridge(a.nameTable[e.outEdges[n]],a)&&(t.datavisualization.Diagram.Util.updateBridging(a.nameTable[e.outEdges[n]],a),a._updateConnectorBridging(a.nameTable[e.outEdges[n]])),a._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(a.nameTable[e.outEdges[n]],a))}},_updateNode:function(i,a,n){var o,s,r,l,d=i.width?i.width:i._width,h=i.height?i.height:i._height,c=i.offsetX-d*i.pivot.x,u=i.offsetY-h*i.pivot.y,g=i.rotateAngle,m=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),p=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden";switch(t.datavisualization.Diagram.Util.canCrispEdges(i,n)&&(c=Math.floor(c)+.5,u=Math.floor(u)+.5),l={id:i.name,transform:"rotate("+g+","+m.x+","+m.y+"),translate("+c+","+u+")",visibility:p},l.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(i,n)?"":"pointer-events:none",a.g(l),o=i._shape?i._shape:i.type){case"rectangle":a.rect({id:i.name+"_shape",width:0>d?0:d,height:0>h?0:h}),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"ellipse":a.ellipse({id:i.name+"_shape",rx:d/2,ry:h/2,cx:d/2,cy:h/2}),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.ellipse({id:i.name+"_shadow",rx:i.width/2,ry:i.height/2,cx:i.width/2,cy:i.height/2});break;case"image":this._updateBackgroundRect(i,a);var f=t.datavisualization.Diagram.Util._getImageAlignment(i.contentAlignment),v="none"==i.scale?"meet":i.scale,l={id:i.name+"_shape",preserveAspectRatio:"stretch"!=v&&"none"!=f?f+" "+v:"none"};"none"!=i.scale&&(l.width=d,l.height=h),a.image(l),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"path":i._preventStretch?s=i._absolutePath=i.pathData:i._scaled||!i._absolutePath?(s=t.datavisualization.Diagram.Geometry.updatePath(0,0,d,h,i.pathData,a,i._absoluteBounds),i._absolutePath=s,i._scaled=!1):s=i._absolutePath,a.path({id:i.name+"_shape",d:s}),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.path({id:i.name+"_shadow",d:s});break;case"polygon":this._updatePolygon(i,a);break;case"text":this._updateTextElement(i,a,n),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"html":this._updateHtmlElement(i,a,n),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"native":r=this._scaleNodeContent(i,e("#"+i.name+"_shape")[0]),l={id:i.name+"_shape"},i.width&&(l.width=i.width),i.height&&(l.height=i.height),r&&(l.transform="translate("+r.x+","+r.y+"),scale("+r.sx+","+r.sy+")"),a.g(l),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&a.rect({id:i.name+"_shadow",width:i.width,height:i.height})}},_updateHtmlElement:function(i,a,n){this._updateBackgroundRect(i,a);var o,s=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",r=i.width?i.width:i._width,l=i.height?i.height:i._height,d=i.offsetX-r*i.pivot.x,h=i.offsetY-l*i.pivot.y,c=a.document.parentNode.getElementsByClassName("htmlLayer")[0],u=e(c).children("#"+i.name+"_parentdiv");u&&(o=e(u).children("#"+i.name+"_html")[0],o&&(o.style.left=d+"px",o.style.top=h+"px",o.style.webkitTransform="rotate("+i.rotateAngle+"deg)",o.style.MozTransform="rotate("+i.rotateAngle+"deg)",o.style.OTransform="rotate("+i.rotateAngle+"deg)",o.style.msTransform="rotate("+i.rotateAngle+"deg)",o.style.transform="rotate("+i.rotateAngle+"deg)",o.style.opacity=i.opacity,o.style.visibility=s)),o&&(o.style.width=i.width.toString()+"px",o.style.height=i.height.toString()+"px")},_updatePolygon:function(e,i){t.datavisualization.Diagram.Geometry.updatePolygonPoints(e),i.polygon({id:e.name+"_shape",points:this._convertToSVGPoints(e.points)}),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&i.polygon({id:e.name+"_shadow",points:this._convertToSVGPoints(e.points)})},_convertToSVGPoints:function(e){for(var t="",i=0,a=e.length;a>i;i++)t+=e[i].x+","+e[i].y+" ";return t.trim()},_renderTextElement:function(i,a,n,o){var s,r,l,d,h,c,u;if(o.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){this._renderBackgroundRect(i,a,n);var g=i.textBlock,m=a.getElementById(i.name),p={id:i.name+"_shape_lblbg","class":"ej-d-label","font-family":g.fontFamily,"font-size":g.fontSize,fill:g.fontColor,"text-decoration":g.textDecoration,"font-weight":g.bold?"bold":"normal","font-style":g.italic?"italic":"normal"},s=a.text(p);m.appendChild(s),this._renderLabelSpanElement(s,i,g,a,o,!1)}else if(s=i.textBlock){r=a.document.parentNode.getElementsByClassName("htmlLayer")[0],this._renderBackgroundRect(i,a,n),l=document.createElement("div"),d=document.createElement("span"),t.datavisualization.Diagram.Util.attr(d,{id:i.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal; alignment-baseline:middle"}),s.bold&&(d.style.fontWeight="bold"),s.italic&&(d.style.fontStyle="italic"),d.style.textDecoration=s.textDecoration,d.style.fontFamily=s.fontFamily,d.style.fontSize=s.fontSize+"px",d.style.color=s.fontColor,d.textContent=s.text,h="display: inline-block; position: absolute; width: inherit; height: inherit; pointer-events: none; ",t.datavisualization.Diagram.Util.attr(l,{id:i.name+"_shape_lblbg",style:h}),l.appendChild(d),c=e(r).children("#"+i.name+"_label")[0],c&&r.removeChild(c),c=document.createElement("div");var f=i.width?i.width:i._width,v=i.height?i.height:i._height,_=i.offsetX-f*i.pivot.x,y=i.offsetY-v*i.pivot.y,h="width:"+f+"px; height:"+v+"px; left:"+_+"px; top:"+y+"px; display: block; position: absolute; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(c,{id:i.name+"_label","class":"ej-d-node",style:h}),c.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",c.style.MozTransform="rotate("+i.rotateAngle+"deg) ",c.style.OTransform="rotate("+i.rotateAngle+"deg) ",c.style.msTransform="rotate("+i.rotateAngle+"deg)",c.style.transform="rotate("+i.rotateAngle+"deg) ",c.appendChild(l),r&&r.appendChild(c),u=t.datavisualization.Diagram.Util.bounds(i),this._alignTextOnLabel(i,u,d,l,i.textBlock)}},_updateTextElement:function(i,a,n){var o,s,r;if(n.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){this._updateBackgroundRect(i,a);var l=i.textBlock,d=(a.getElementById(i.name),{id:i.name+"_shape_lblbg","class":"ej-d-label","font-family":l.fontFamily,"font-size":l.fontSize,fill:l.fontColor,"text-decoration":l.textDecoration,"font-weight":l.bold?"bold":"normal","font-style":l.italic?"italic":"normal"});a.text(d);this._updateLabelSpanElement(i,l,a,n,!1)}else if(this._updateBackgroundRect(i,a),o=a.document.parentNode.getElementsByClassName("htmlLayer")[0]){var h,c,u,g,m=this._findChild(o.childNodes,i),p=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",f=t.datavisualization.Diagram.Util.bounds(i);m&&(h=f.width,c=f.height,u=i.offsetX-i.width*i.pivot.x,g=i.offsetY-i.height*i.pivot.y,m.style.width=h+"px",m.style.height=c+"px",m.style.left=u+"px",m.style.top=g+"px",m.style.visibility=p,m.style.webkitTransform="rotate("+i.rotateAngle+"deg)",m.style.MozTransform="rotate("+i.rotateAngle+"deg)",m.style.OTransform="rotate("+i.rotateAngle+"deg)",m.style.msTransform="rotate("+i.rotateAngle+"deg)",m.style.transform="rotate("+i.rotateAngle+"deg)"),s=e(m).children("#"+i.name+"_shape_lblbg")[0],s&&(r=s.childNodes[0],r.textContent=i.textBlock.text,this._alignTextOnLabel(i,f,r,s,i.textBlock,n))}},_renderBackgroundRect:function(e,i,a){var n,o,s=this._fill(e,i),r={id:e.name+"_backRect","class":"backrect",x:0,y:0,width:e.width,height:e.height,fill:s,stroke:e.borderColor,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray};this._addCssClass(e,r),e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(n=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),o={id:e.name+"_shadow","class":"backrect",width:e.width,height:e.height,stroke:"lightgrey",fill:"none"!=s||"transparent"!=s?"lightgrey":"none",transform:"translate("+n.x+","+n.y+")",opacity:e.shadow.opacity},a.appendChild(i.rect(o))),a.appendChild(i.rect(r))},_updateBackgroundRect:function(e,t){var i=this._fill(e,t),a={id:e.name+"_backRect",x:0,y:0,width:e.width,height:e.height,fill:i,stroke:e.borderColor,"stroke-width":e.borderWidth,opacity:e.opacity,"stroke-dasharray":e.borderDashArray,"class":e.cssClass};t.rect(a)},_hideNode:function(e,t){var i={id:e.name,style:"pointer-events:none;"};t.rect(i)},_showNode:function(e,t){var i={id:e.name,style:"pointer-events:auto;"};t.rect(i)},_removePhasehelper:function(e){e._adornerSvg.getElementById("phase_helper")&&e._adornerSvg.removeChild(e._adornerSvg.getElementById("phase_helper"),e._adornerLayer)},_updatePhaseHelper:function(e,t,i){if(t){var a,n=(e._adornerSvg,e._currZoom);i.width=i.width<0?1:i.width,i.height=i.height<0?1:i.height,a={id:"phase_helper","class":"helper","pointer-events":"none",width:i.width*n,height:i.height*n},e._adornerSvg.rect(a)}},_phasehelper:function(e,t,i){if(t){var a=e._adornerSvg,n=e._currZoom,o=i.x+i.width/2,s=i.y+i.height/2,r=a.rect({id:"phase_helper","class":"helper","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:i.width*n,height:i.height*n,fill:"transparent",stroke:"green",transform:"translate("+(o-i.width/2)*n+","+(s-i.height/2)*n+"),rotate(0,"+i.width/2*n+","+i.height/2*n+")"});e._adornerLayer.appendChild(r)}},_drawContainerHelper:function(e){var i,a,n,o,s,r,l=e.activeTool.helper,d=e._adornerSvg,h=e._currZoom;l&&(i=t.datavisualization.Diagram.Util.bounds(l,!0)),a=i.height,n=i.width,o=l.pivot?{x:i.width*l.pivot.x,y:i.height*l.pivot.y}:{x:n/2,y:a/2},s=l.rotateAngle?l.rotateAngle:0,r=d.rect({id:"helper","class":"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:n*h,height:a*h,fill:"transparent",stroke:"red",transform:"translate("+i.x*h+","+i.y*h+"),rotate("+s+","+o.x*h+","+o.y*h+")"}),e._adornerLayer.appendChild(r)},_updateContainerHelper:function(e){var i,a,n,o,s,r,l=e.activeTool.helper,d=e._currZoom;l&&(a=t.datavisualization.Diagram.Util.bounds(l,!0)),n=a.height,o=a.width,s=l.pivot?{x:a.width*l.pivot.x,y:a.height*l.pivot.y}:{x:o/2,y:n/2},e._raiseOffsetPropertyChange(l,a.center.x,a.center.y,!0),e._raiseSizePropertyChange(l,a.width/l.width,a.height/l.height,!0),r=l.rotateAngle?l.rotateAngle:0,i={id:"helper","class":"helper",width:o*d,height:n*d,fill:"transparent",stroke:"red",transform:"translate("+a.x*d+","+a.y*d+"),rotate("+r+","+s.x*d+","+s.y*d+")"},e._adornerSvg.rect(i)},_removeContainerHelper:function(e,t,i){t.getElementById("helper")&&t.removeChild(t.getElementById("helper"),i)},setNodeShape:function(t,i,a,n){var o,s;a?(s=i.getElementById(a.name),o=e(s).find("#"+t.name)[0]):o=i.getElementById(t.name),o&&(e(o).empty(),this._renderNode(t,i,o,n))},setLine:function(t,i,a,n){var o,s;a?(s=i.getElementById(a.name),o=e(s).find("#"+t.name)[0]):o=i.getElementById(t.name),e(o).empty(),this.renderConnector(t,i,o,n)},addNodeLabel:function(e,t,i,a,n){this._renderLabels(e,i,n)},renderConnector:function(e,i,a,n){var o,s,r,l,d=e.visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",n)?"visible":"hidden";if(s=t.datavisualization.Diagram.Util.canCrispEdges(e,n)?{id:e.name,"class":"ej-d-connector",visibility:d,opacity:e.opacity,transform:"translate(0.5,0.5)"}:{id:e.name,"class":"ej-d-connector",visibility:d,opacity:e.opacity},t.datavisualization.Diagram.Util.canEnablePointerEvents(e,n)||(s.style="pointer-events:none"),o=i.g(s),a?a.id!==o.id&&a.appendChild(o):i.appendChild(o),r=i.g({id:e.name+"segments"}),this._renderSegments(e,i,r,n),o.appendChild(r),this._renderLabels(e,i,n),this._renderDecorators(e,i,o,n),e.shape)for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(e,n),l=0;l<e._inlineDecorators.length;l++)this.renderNode(e._inlineDecorators[l],i,o,void 0,n);return o},_renderSegments:function(e,i,a,n){var o,s,r=(e.visible&&"msie"===(n&&n._browserInfo?n._browserInfo.name:t.browserInfo().name)?"collapse":"hidden",this._findPath(e,n)),l={id:e.name+"_hitTest","class":"hitTest","stroke-width":e.lineHitPadding,d:r,stroke:"transparent",visibility:"hidden"};l["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(e,n)&&e.visible?"stroke":"none",o=i.path(l),a.appendChild(o),l={id:e.name+"_segments",d:r,fill:"none",stroke:e.lineColor,"stroke-width":e.lineWidth,"stroke-dasharray":e.lineDashArray,opacity:e.opacity},this._addCssClass(e,l),o=i.path(l),a.appendChild(o),e.shape&&"umlactivity"==e.shape.type&&"exception"==e.shape.activityFlow&&(l={id:e.name+"_Activityflow","class":"umlactivityflow",fill:"none",stroke:e.lineColor,"pointer-events":"none","stroke-width":e.lineWidth,"stroke-dasharray":e.lineDashArray,opacity:e.opacity,d:e._temppath},s=i.path(l),this._addCssClass(e,l),a.appendChild(s))},_findPath:function(e,i){for(var a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_=0;_<e.segments.length;_++){if(a=e.segments[_],a._bridges.length>0)for(n=0;n<a._bridges.length;n++)o=a._bridges[n],o._rendered=!1;if(s=a.points,e.shape&&"sequence"==e.shape.flow&&"default"==e.shape.sequence&&0==_){r={x:a.points[0].x,y:a.points[0].y},l=t.datavisualization.Diagram.Geometry.distance(a.points[0],a.points[1]),l=Math.min(30,l/2);var y=t.datavisualization.Diagram.Geometry.findAngle(a.points[0],a.points[1]),b=t.datavisualization.Diagram.Geometry.transform({x:r.x,y:r.y},y,l),x=t.datavisualization.Diagram.Geometry.transform({x:b.x,y:b.y},y+45,-12),D=t.datavisualization.Diagram.Geometry.transform({x:x.x,y:x.y},y+45,24);d=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?"M"+Math.floor(x.x)+" "+Math.floor(x.y)+" L"+Math.floor(D.x)+" "+Math.floor(D.y):"M"+x.x+" "+x.y+" L"+D.x+" "+D.y}if(e.shape&&"umlactivity"==e.shape.type&&"exception"==e.shape.activityFlow&&0==_){r={x:a.points[0].x,y:a.points[0].y},l=t.datavisualization.Diagram.Geometry.distance(a.points[0],a.points[1]),l=Math.max(30,l/2);var y=t.datavisualization.Diagram.Geometry.findAngle(a.points[0],a.points[1]),b=t.datavisualization.Diagram.Geometry.transform({x:r.x,y:r.y},y,l),x=t.datavisualization.Diagram.Geometry.transform({x:b.x,y:b.y},y+145,9),D=t.datavisualization.Diagram.Geometry.transform({x:x.x,y:x.y},y+225,14);d=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?"M"+Math.floor(x.x)+" "+Math.floor(x.y)+" L"+Math.floor(D.x)+" "+Math.floor(D.y):"M"+D.x+" "+x.y+"L"+D.x+" "+D.y+" L"+x.x+" "+x.y+" L"+x.x+" "+D.y}if(0==_&&(i&&e.sourceNode&&(h=i._findNode(e.sourceNode)),s=this._clipDecorators(e,a,!0,h),"bezier"==a.type&&e.sourceDecorator&&e.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(s[0]=t.datavisualization.Diagram.Util._adjustPoint(s[0],a._point1,!0,e.lineWidth)),v=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?"M"+Math.floor(s[0].x)+" "+Math.floor(s[0].y):"M"+s[0].x+" "+s[0].y),_==e.segments.length-1&&(i&&e.targetNode&&(h=i._findNode(e.targetNode)),s=this._clipDecorators(e,a,!1,h)),"bezier"!=a.type)if(e.cornerRadius>0)for(u=0;u<s.length-1;u++)c=t.datavisualization.Diagram.Geometry.distance(s[u],s[u+1]),c>0&&(f=_<e.segments.length-1||u<s.length-2?c<2*e.cornerRadius?t.datavisualization.Diagram.Util._adjustPoint(s[u],s[u+1],!1,c/2):t.datavisualization.Diagram.Util._adjustPoint(s[u],s[u+1],!1,e.cornerRadius):s[u+1],(_>0||u>0)&&(c<2*e.cornerRadius?(p=t.datavisualization.Diagram.Util._adjustPoint(s[u],s[u+1],!0,c/2),(_<e.segments.length-1||u<s.length-2)&&(f=null)):p=t.datavisualization.Diagram.Util._adjustPoint(s[u],s[u+1],!0,e.cornerRadius)),p&&(v+=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?" Q"+Math.floor(s[u].x)+" "+Math.floor(s[u].y)+" "+Math.floor(p.x)+" "+Math.floor(p.y):" Q"+s[u].x+" "+s[u].y+" "+p.x+" "+p.y),f&&(a._bridges.length>0&&(v=this._updateBridging(a,v,u),"orthogonal"===a.type&&(v=this._updateBridging(a,v,u+1))),v+=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?" L"+Math.floor(f.x)+" "+Math.floor(f.y):" L"+f.x+" "+f.y));else for(u=0;u<s.length;u++)u>0&&(v=this._updateBridging(a,v,u)+(t.datavisualization.Diagram.Util.canCrispEdges(e,i)?" L"+Math.floor(s[u].x)+" "+Math.floor(s[u].y):" L"+s[u].x+" "+s[u].y));else g=a._endPoint,e.targetDecorator&&e.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(g=t.datavisualization.Diagram.Util._adjustPoint(a._endPoint,a._point2,!0,e.lineWidth)),e.targetNode&&i&&(m=i._findNode(e.targetNode),"none"!=h.borderColor&&(g=t.datavisualization.Diagram.Util._adjustPoint(g,a._point2,!0,m.borderWidth/2))),v+=t.datavisualization.Diagram.Util.canCrispEdges(e,i)?" C"+Math.floor(a._point1.x)+" "+Math.floor(a._point1.y)+" "+Math.floor(a._point2.x)+" "+Math.floor(a._point2.y)+" "+Math.floor(g.x)+" "+Math.floor(g.y):" C"+a._point1.x+" "+a._point1.y+" "+a._point2.x+" "+a._point2.y+" "+g.x+" "+g.y}return e.shape&&"sequence"==e.shape.flow&&"default"==e.shape.sequence&&(v+=d),e.shape&&"exception"==e.shape.activityFlow&&"umlactivity"==e.shape.type&&(v=v,e._temppath=d),v},_updateBridging:function(e,t,i){var a,n,o=t;if(e._bridges.length>0)if("straight"===e.type)for(a=0;a<e._bridges.length;a++)n=e._bridges[a],n._rendered||(o+=" L"+n.startPoint.x+" "+n.startPoint.y,o+=n.path);else if("orthogonal"===e.type)for(a=0;a<e._bridges.length;a++)n=e._bridges[a],n.segmentPointIndex!==i||n._rendered||(o+=" L"+n.startPoint.x+" "+n.startPoint.y,o+=n.path,n._rendered=!0);return o},_refreshSegments:function(e,t,i){this._updateConnector(e,t,i),this._updateDecorators(e,t,i)},_refreshOnlySegments:function(e,t,i){var a=this._findPath(e,i),n=t.document.getElementById(e.name+"_segments");n&&(n.setAttribute("d",a),n=t.document.getElementById(e.name+"_hitTest"),n.setAttribute("d",a))},_clipDecorators:function(e,i,a,n){var o,s,r,l,d,h,c=[];if(!a&&e.targetDecorator&&e.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(h=0;h<i.points.length;h++)c[h]=i.points[h];o=c[c.length-1],s=c[c.length-2],r=t.datavisualization.Diagram.Geometry.distance(o,s),r=0==r?1:r,l=e.lineWidth,d=t.datavisualization.Diagram.Point(),d.x=o.x+l*(s.x-o.x)/r,d.y=o.y+l*(s.y-o.y)/r,n&&"none"!=n.borderColor&&(d=t.datavisualization.Diagram.Util._adjustPoint(d,s,!0,n.borderWidth/2)),c[c.length-1]=d}else if(a&&e.sourceDecorator&&e.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(h=0;h<i.points.length;h++)c[h]=i.points[h];o=c[0],s=c[1],r=t.datavisualization.Diagram.Geometry.distance(o,s),r=0==r?1:r,l=e.lineWidth,d=t.datavisualization.Diagram.Point(),d.x=o.x+l*(s.x-o.x)/r,d.y=o.y+l*(s.y-o.y)/r,"bezier"==i.type&&(d.x=o.x+(i._point1.x-o.x)/r,d.y=o.y+(i._point1.y-o.y)/r),n&&"none"!=n.borderColor&&(d=t.datavisualization.Diagram.Util._adjustPoint(d,"bezier"!=i.type?s:i._point1,!0,n.borderWidth/2)),c[0]=d}else if(a){for(h=0;h<i.points.length;h++)c[h]=i.points[h];n&&"none"!=n.borderColor&&(c[0]=t.datavisualization.Diagram.Util._adjustPoint(c[0],c[1],!0,n.borderWidth/2))}else{for(h=0;h<i.points.length;h++)c[h]=i.points[h];n&&"none"!=n.borderColor&&(c[c.length-1]=t.datavisualization.Diagram.Util._adjustPoint(c[c.length-1],c[c.length-2],!0,n.borderWidth/2))}return c},_updateConnector:function(e,i,a){var n,o;a&&!a._isInit&&"new"!==e._status&&(e._status="update"),n=this._findPath(e,a),i.path({id:e.name+"_segments",d:n}),o={id:e.name+"_hitTest",d:n,"stroke-width":e.lineHitPadding},o["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(e,a)?e.isPhase||"move"===a.activeTool.name&&a.activeTool.inAction||a._selectedSymbol&&a.selectionList[0]&&a.selectionList[0].name==e.name?"none":e.visible?"stroke":"none":"none",i.path(o),e.shape&&"umlactivity"==e.shape.type&&"exception"==e.shape.activityFlow&&(o={id:e.name+"_Activityflow","class":"umlactivityflow",fill:"none",stroke:e.lineColor,"pointer-events":"none","stroke-width":e.lineWidth,"stroke-dasharray":e.lineDashArray,opacity:e.opacity,d:e._temppath},i.path(o))},updateConnector:function(e,i,a){var n,o,s;if(i&&(n=e.visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",a)?"visible":"hidden",o=t.datavisualization.Diagram.Util.canCrispEdges(e,a)?{id:e.name,visibility:n,opacity:e.opacity,transform:"translate(0.5,0.5)"}:{id:e.name,visibility:n,opacity:e.opacity},o.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(e,a)?"":"pointer-events:none",a._animatingLayout||i.g(o),this._updateConnector(e,i,a),this._updateLabels(e,i,a),this._updateDecorators(e,i,a),e.shape))for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(e,a),s=0;s<e._inlineDecorators.length;s++)this.updateNode(e._inlineDecorators[s],i,a)},renderDecorators:function(e,t,i){var a=t.getElementById(e.name);this._renderDecorators(e,t,a,i)},clearDecorators:function(e,t,i){this._updateConnector(e,t,i);var a=t.getElementById(e.name),n=t.getElementById(e.name+"_targetDecorator");n&&t.removeChild(n,a),n=t.getElementById(e.name+"_sourceDecorator"),n&&t.removeChild(n,a)},_renderDecorators:function(e,i,a,n){var o,s,r,l,d;e.targetDecorator&&e.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(l=e.segments[e.segments.length-1],o=l.points[l.points.length-2],s=e.targetPoint,"bezier"==l.type&&(o=l._point2),e.targetNode&&n&&(r=n._findNode(e.targetNode),r&&"none"!=r.borderColor&&(s=t.datavisualization.Diagram.Util._adjustPoint(s,o,!0,r.borderWidth/2))),this._renderDecorator(e.name+"_targetDecorator",s,o,e,e.targetDecorator,i,a)),e.sourceDecorator&&e.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(l=e.segments[0],o=e.sourcePoint,s=l.points[1],"bezier"==l.type&&(s=l._point1),e.sourceNode&&n&&(d=n._findNode(e.sourceNode),d&&"none"!=d.borderColor&&(o=t.datavisualization.Diagram.Util._adjustPoint(o,s,!0,d.borderWidth/2))),this._renderDecorator(e.name+"_sourceDecorator",o,s,e,e.sourceDecorator,i,a))},_renderIcons:function(e,t){var i,a,n,o=e.expandIcon,s=e.collapseIcon;if("none"!=o.shape||"none"!=s.shape){var r,l=e.width?e.width:e._width||0,d=e.height?e.height:e._height||0,h=e.name,c=0,u=0,g=0,m=0,p=0,f=e.visible?"visible":"hidden";g=e.offsetX-l*e.pivot.x,m=e.offsetY-d*e.pivot.y,c=e.offsetX,u=e.offsetY,p=e.rotateAngle,i={id:h,transform:"rotate("+p+","+c+","+u+"),translate("+g+","+m+")",visibility:f},a=t._adornerSvg,r=a.g(i),n=a.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||t._expander,n.appendChild(r),void 0!=o&&e.isExpanded&&this._renderIcon(e,a,o,r,t),void 0==s||e.isExpanded||this._renderIcon(e,a,s,r,t)}},_renderIcon:function(e,i,a,n,o){var s,r,n,l,d,h,c,u;if(void 0!=a){if(r=t.datavisualization.Diagram.Util._getIconPosition(a,t.datavisualization.Diagram.Util.bounds(e,!0),!0),"path"!=a.shape)this._renderExpanderTemplate(e,i,a,n,o,r);else if("path"==a.shape)return n=document.createElementNS("http://www.w3.org/2000/svg","g"),n.setAttribute("id",e.name+"_expander"),n.setAttribute("class","ej-d-icon-template"),l=t.datavisualization.Diagram.Geometry.updatePath(r.x-a.width/2,r.y-a.height/2,a.width,a.height,a.pathData,i),d=e.visible?"visible":"hidden",a._absolutePath=l,a.margin.left&&a.margin.right&&(a.width-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(a.height-=(a.margin.top||0)+(a.margin.bottom||0)),s={id:e.name+"_pathexpander",x:r.x,y:r.y,width:a.width,height:a.height,fill:a.borderColor,stroke:a.borderColor,"stroke-width":a.borderWidth,visibility:d,d:l},this._addCssClass(n,s),h=i.path(s),n.appendChild(h),n;return"image"==a.shape&&(c=new Image,c.src=a.source,u=i.image(s),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c.src),n.appendChild(u)),u}},_renderExpanderTemplate:function(e,t,i,a,n,o,s){var r,l,d,h,c,u=this.construct_template_iconshape(i,e.isExpanded,n);if("undefined"!=u){s&&a.removeChild(t.document.getElementById(e.name+"_expander")),r=document.createElement("div"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+u+"</g></svg>",document.body.appendChild(r),l=document.getElementById("tempNative"),d=l.cloneNode(!0),d.id=e.name+"_expander";var g=l.getBBox(),m=i.width,p=i.height,f=g.width?m/g.width:1,v=g.height?p/g.height:1;if(r.parentNode.removeChild(r),a.appendChild(d),h=Math.min(f,v),c=e.visible?"visible":"hidden",i.horizontalAlignment||i.verticalAlignment){({x:i.offset.x,y:i.offset.y});switch(i.horizontalAlignment){case"left":o.x+=0;break;case"center":o.x-=i.width/2;break;case"right":o.x-=i.width}switch(i.verticalAlignment){case"top":o.y+=0;break;case"center":o.y-=i.height/2;break;case"bottom":o.y-=i.height}var _=o.x-g.x*f,y=o.y-g.y*v,b={id:e.name+"_expander","class":"ej-d-icon-template",transform:"translate("+_+","+y+"),scale("+f+","+v+")",x:o.x,y:o.y,width:i.width,height:i.height,fill:i.borderColor,stroke:i.borderColor,"stroke-width":i.borderWidth};t.g(b)}}},construct_template_iconshape:function(e,t,i){var a;if(e.shape){switch(e.shape){case"arrowup":a='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M8.7,7.2L8.9,7h2.2l0.2,0.2l0,0l4.8,4.8h-2.5L10,8.4L6.4,12H3.9L8.7,7.2L8.7,7.2z"/></path></rect>';break;case"arrowdown":a='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M9,12.2l0.1,0.1h1.7l0.1-0.1l0,0l3.8-3.8h-2L10,11.2L7.2,8.4h-2L9,12.2L9,12.2z"/></path></rect>';break;case"plus":a='<rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/></line><line style=" fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="10" y1="6.1" x2="10" y2="13.9"/></line></rect>';break;case"minus":a=' <rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/></line></rect>';break;case"template":a=i._renderEjTemplate("#"+e.templateId,e)}return a}},_updateIcons:function(e,t,i){var a,t,n,o=e.expandIcon,s=e.collapseIcon;if("none"!=o.shape||"none"!=s.shape){var r,l=e.width?e.width:e._width||0,d=e.height?e.height:e._height||0,h=e.name,c=0,u=0,g=0,m=0,p=0,f=e.visible?"visible":"hidden";g=e.offsetX-l*e.pivot.x,m=e.offsetY-d*e.pivot.y,c=e.offsetX,u=e.offsetY,p=e.rotateAngle,a={id:h,transform:"rotate("+p+","+c+","+u+"),translate("+g+","+m+")",visibility:f},t=i._adornerSvg,r=t.g(a),n=t.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||i._expander,void 0!=o&&e.isExpanded&&this._updateIcon(e,i._adornerSvg,r,o,i),void 0==s||e.isExpanded||this._updateIcon(e,i._adornerSvg,r,s,i)}},_updateIcon:function(e,i,a,n,o){var s,r,l,d,h,c;void 0!=n&&(e._scaled||e._updateExpander)&&(r=t.datavisualization.Diagram.Util._getIconPosition(n,t.datavisualization.Diagram.Util.bounds(e,!0),!0),"path"!=n.shape?(e._scaled||e._updateExpander)&&this._renderExpanderTemplate(e,i,n,a,o,r,!0):"path"==n.shape&&(l=t.datavisualization.Diagram.Geometry.updatePath(r.x-n.width/2,r.y-n.height/2,n.width,n.height,n.pathData,i),d=e.visible?"visible":"hidden",n._absolutePath=l,n.margin.left&&n.margin.right&&(n.width-=(n.margin.left||0)+(n.margin.right||0)),n.margin.top&&n.margin.bottom&&(n.height-=(n.margin.top||0)+(n.margin.bottom||0)),
s={id:e.name+"_pathexpander",x:r.x,y:r.y,width:n.width,height:n.height,fill:n.borderColor,stroke:n.borderColor,"stroke-width":n.borderWidth,visibility:d,d:l},i.path(s)),"image"==n.shape&&(h=new Image,h.src=n.source,c=i.image(s),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),a.appendChild(c)),e._updateExpander=!1)},_renderDecorator:function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m,p,f=t.datavisualization.Diagram.Size(o.width,o.height);switch(o.shape){case"arrow":h=this._constructArrow(i,f),d={id:e,"class":"decorator",d:h,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),c=1.1*o.borderWidth;break;case"openarrow":h=this._constructArrow(i,f,!0),d={id:e,"class":"decorator",d:h,fill:"transparent",stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),c=1.1*o.borderWidth;break;case"circle":u=f.width/2,g=f.height/2,d={id:e,"class":"decorator",rx:u,ry:g,cx:i.x+f.width/2,cy:i.y,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.ellipse(d),c=.5*o.borderWidth;break;case"diamond":h=this._constructDiamond(i,f,s),d={id:e,"class":"decorator",x:i.x,y:i.y,width:f.width,height:f.height,d:h,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),c=.7*o.borderWidth;break;case"path":h=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-f.height/2,f.width,f.height,o.pathData,s),o._absolutePath=h,d={id:e,"class":"decorator",x:i.x,y:i.y,width:f.width,height:f.height,d:h,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},this._addCssClass(o,d),l=s.path(d),c=.5*o.borderWidth}l&&("none"!=o.borderColor?(m=t.datavisualization.Diagram.Geometry.findAngle(i,a),p=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},m,c),l.setAttribute("transform","translate("+p.x+","+p.y+"),rotate("+m+" "+i.x+" "+i.y+")")):l.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,a)+" "+i.x+" "+i.y+")"),r.appendChild(l))},_updateDecorators:function(e,i,a){var n,o,s,r,l,d;e.targetDecorator&&e.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(r=e.segments[e.segments.length-1],l=r.points,n=l[l.length-2],o=e.targetPoint,"bezier"==r.type&&(n=r._point2),e.targetNode&&a&&(s=a._findNode(e.targetNode),s&&"none"!=s.borderColor&&(o=t.datavisualization.Diagram.Util._adjustPoint(e.targetPoint,n,!0,s.borderWidth/2))),this._updateDecorator(e.name+"_targetDecorator",o,n,e,e.targetDecorator,i)),e.sourceDecorator&&e.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(r=e.segments[0],l=r.points,n=e.sourcePoint,o=l[1],"bezier"==r.type&&(o=r._point1),e.sourceNode&&a&&(d=a._findNode(e.sourceNode),"none"!=d.borderColor&&(n=t.datavisualization.Diagram.Util._adjustPoint(e.sourcePoint,o,!0,d.borderWidth/2))),this._updateDecorator(e.name+"_sourceDecorator",n,o,e,e.sourceDecorator,i))},_updateDecorator:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p=t.datavisualization.Diagram.Size(o.width,o.height);switch(o.shape){case"arrow":d=this._constructArrow(i,p),l={id:e,d:d},r=s.path(l),h=1.1*o.borderWidth;break;case"openarrow":d=this._constructArrow(i,p,!0),l={id:e,d:d,fill:"transparent",stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.path(l),h=1.1*o.borderWidth;break;case"circle":c=p.width/2,u=p.height/2,l={id:e,rx:c,ry:u,cx:i.x+p.width/2,cy:i.y,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.ellipse(l),h=.5*o.borderWidth;break;case"diamond":d=this._constructDiamond(i,p,s),l={id:e,x:i.x,y:i.y,width:p.width,height:p.height,d:d,fill:o.fillColor,stroke:o.borderColor,"stroke-width":o.borderWidth},r=s.path(l),h=.7*o.borderWidth;break;case"path":d=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-p.height/2,p.width,p.height,o.pathData,s),o._absolutePath=d,l={id:e,d:d},r=s.path(l),h=.5*o.borderWidth}r&&("none"!=o.borderColor?(g=t.datavisualization.Diagram.Geometry.findAngle(i,a),m=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},g,h),r.setAttribute("transform","translate("+m.x+","+m.y+"),rotate("+g+" "+i.x+" "+i.y+")")):r.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,a)+" "+i.x+" "+i.y+")"))},_constructArrow:function(e,i,a){var n=new t.datavisualization.Diagram.Path;return n.moveTo(e.x+i.width,e.y+i.height/2),n.lineTo(e.x,e.y),n.lineTo(e.x+i.width,e.y-i.height/2),a||n.close(),n.toString()},_constructDiamond:function(e,i){var a=new t.datavisualization.Diagram.Path;return a.moveTo(e.x+i.width,e.y),a.lineTo(e.x+i.width/2,e.y+i.height/2),a.lineTo(e.x,e.y),a.lineTo(e.x+i.width/2,e.y-i.height/2),a.lineTo(e.x+i.width,e.y),a.toString()},_addLabel:function(i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_;if(o&&o.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){if(_=this._renderSVGLabel(i,a,n,o),void 0!=s&&s!=i.labels.length-1&&!(s>i.labels.length-1)&&(r=i.labels[s])){var y=o._svg.document.getElementById(i.name+"_"+r.name+"_lblbg"),b=o._svg.document.getElementById(i.name+"_"+a.name+"_lblbg"),x=o._svg.document.getElementById(i.name+"_"+a.name);y&&b&&y.parentNode.insertBefore(b,y),x&&x&&y.parentNode.insertBefore(x,y)}}else u=t.datavisualization.Diagram.Util.bounds(i),l=u.width,d=u.height,h=u.x,c=u.y,m=n.document.parentNode.getElementsByClassName("htmlLayer")[0],g=e(m).children("#"+i.name+"_label")[0],p="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector",g||(g=document.createElement("div"),f="width:"+l+"px; height:"+d+"px; left:"+h+"px; top:"+c+"px; display: block; position: absolute; pointer-events: none; ; padding: inherit;",v="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector",i._isClassifier&&(v+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(g,{id:i.name,"class":v,style:f}),i.rotateAngle&&(g.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",g.style.MozTransform="rotate("+i.rotateAngle+"deg) ",g.style.OTransform="rotate("+i.rotateAngle+"deg) ",g.style.msTransform="rotate("+i.rotateAngle+"deg)",g.style.transform="rotate("+i.rotateAngle+"deg) ",g.style["transform-origin"]=100*i.pivot.x+"% "+100*i.pivot.y+"%"),m&&m.appendChild(g)),t.datavisualization.Diagram.Util.attr(g,{id:i.name+"_label","class":p}),_=this._renderLabel(i,u,a,g,m,n,l,d,o),void 0!=s&&g.insertBefore(_,g.childNodes[s])},_getCharBoundsValues:function(e,t,i,a,n){var o,s,r,l,d,h,c,u={id:a.name+"_"+t.name+"temp","class":"ej-d-label","font-family":t.fontFamily,"font-size":t.fontSize},g=i.text(u);if(i.document.appendChild(g),o=i.tspan({id:a.name+"_"+t.name+"temp_snap"}),o.textContent=e,g.appendChild(o),s=g.childNodes[0].getComputedTextLength(),u["font-style"]="normal",u["font-weight"]="bold",i.text(u),r=g.childNodes[0].getComputedTextLength(),u["font-style"]="italic",u["font-weight"]="normal",i.text(u),l=g.childNodes[0].getComputedTextLength(),u["font-style"]="italic",u["font-weight"]="bold",i.text(u),d=g.childNodes[0].getComputedTextLength(),i.document.removeChild(g)," "==e){t.text&&(h=t.text[n-1]&&"\n"!=t.text[n-1]?t.text[n-1]:"W",c=t.text[n+1]&&"\n"!=t.text[n+1]?t.text[n+1]:"W");var m=this._getCharBoundsValues(h,t,i,a,n),p=this._getCharBoundsValues(c,t,i,a,n),f=this._getCharBoundsValues(h+" "+c,t,i,a,n);return{normal:f.normal-(m.normal+p.normal),bold:f.bold-(m.bold+p.bold),italic:f.italic-(m.italic+p.italic),boldItalic:f.boldItalic-(m.boldItalic+p.boldItalic)}}return{normal:s,bold:r,italic:l,boldItalic:d}},_updateHashTableValues:function(e,t,i,a,n){for(var o,s=0;s<e.length;s++)t[e[s]]||(o="\n"==e[s]?"new_space_line":e[s],t[o]=this._getCharBoundsValues(e[s],i,n,a,s))},_updateHashTable:function(e,i,a,n,o){var s,r,l,d;if(e&&a&&n)if(e.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap||o)(""!=e.text||""!=e.hyperlink)&&(r=e.text?e.text:e.hyperlink,s=n._labelHashTable[e.fontFamily],s||(s=n._labelHashTable[e.fontFamily]={}),this._updateHashTableValues(r,s,e,i,a,n));else if(e.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow){for(r=e.text?e.text:e.hyperlink,l=r.split("\n"),d=0;d<l.length;d++){var h=l[d],c=h.split(" "),s=n._labelHashTable[e.fontFamily];s||(s=n._labelHashTable[e.fontFamily]={}),this._updateHashTableValues(c,s,e,i,a,n),this._updateHashTableValues([" "],s,e,i,a,n)}s.new_space_line=this._getCharBoundsValues(" ",e,a,i)}},_getSuitableLabelSize:function(e,t,i){t="\n"==t||"."===t?"new_space_line":t;var a=i._labelHashTable[e.fontFamily][t];return e.bold&&e.italic?a.boldItalic:e.bold?a.bold:e.italic?a.italic:a.normal},_postionConnectorTextElement:function(e,i,a,n,o){var s,r,l,d=0,h=0,c=t.datavisualization.Diagram.Util.bounds(e),u=a.getBBox(),g=(this._getCharBoundsValues("W",i,n,e),i.horizontalAlignment),m=i.verticalAlignment,p=!1;if(e.segments&&"segmentpath"==i.relativeMode){switch(s=this._getConnectorHandlePosition(i,e,1,o),r=s.position,d=r.x,h=r.y,l=t.datavisualization.Diagram.Util._alignLabelOnSegments(e,i,o,s),m=l.vAlign,g=l.hAlign,p=!0,g){case"left":d=0+i.margin.left;break;case"right":d=-u.width-i.margin.right;break;case"center":d=d+-u.width/2+(i.margin.left-i.margin.right);break;case"stretch":d=u.width/2}switch(m){case"top":h=0+i.margin.top;break;case"bottom":h=-u.height-i.margin.bottom;break;case"center":h=h+-u.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":h=u.height/2}}else{switch(g){case"left":d=u.width/2;break;case"right":d=-u.width/2}switch(m){case"top":h=u.height/2;break;case"bottom":h=-u.height/2}e.segments&&(d+=c.left,h+=c.top),d+=c.width*i.offset.x,h=h+c.height*i.offset.y-2}"segmentpath"==!i.relativeMode&&(d*=i.offset.x?i.offset.x/.5:0,h=h*(i.offset.y?i.offset.y/.5:0)+i.fontSize,d+=c.center.x-c.width/2,h+=c.center.y-c.height/2),this._updateLabelBackground(d,h+i.fontSize,u,e,i,a,n,o),e.segments&&e.segments.length>0?a.setAttribute("transform","translate("+d+","+(h-2)+") rotate("+i.rotateAngle+" "+(u.x+u.width/2)+" "+(u.y+u.height/2)+")"):a.setAttribute("transform","translate("+d+","+(h-2)+") rotate("+i.rotateAngle+" "+(u.x+u.width/2)+" "+(u.y+u.height/2)+")")},_postionNodeTextElement:function(e,i,a,n,o){var s,r=0,l=0,d=t.datavisualization.Diagram.Util.bounds(e),h=a.getBBox(),c=t.datavisualization.Diagram.Rectangle(h.x,h.y,h.width,h.height);switch(c.height>=2&&(c.height-=2),s=this._getCharBoundsValues("W",i,n,e),i.horizontalAlignment){case"left":r=0+i.margin.left;break;case"right":r=-c.width-i.margin.right;break;case"center":r=-c.width/2+(i.margin.left-i.margin.right);break;case"stretch":r=-(c.width/2)}switch(i.verticalAlignment){case"top":l=0+i.margin.top;break;case"bottom":l=-c.height-i.margin.bottom;break;case"center":l=-c.height/2+(i.margin.top-i.margin.bottom);break;case"stretch":l=-(c.height/2)}if(r+=d.width*i.offset.x,l=l+d.height*i.offset.y-2,this._updateLabelBackground(r,l+i.fontSize,c,e,i,a,n,o),e.segments&&e.segments.length>0)a.setAttribute("transform","translate("+(d.center.x-c.width/2)+","+(d.center.y-c.height/2+i.fontSize)+")");else if("group"===e.type||e.children&&e.children.length>0){var u=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),r=(e.width?e.width:e._width,e.height?e.height:e._height,r+(e.offsetX-e.width/2)),l=l+(e.offsetY-e.height/2),g=e.rotateAngle+i.rotateAngle;a.setAttribute("transform","rotate("+g+","+u.x+","+u.y+"),translate("+r+","+l+")")}else a.setAttribute("transform","translate("+r+","+l+") rotate("+i.rotateAngle+" "+(c.x+c.width/2)+" "+(c.y+c.height/2)+")")},_postionSpanElement:function(e,t,i,a,n){for(var o,s,r=0;r<i.childNodes.length;r++)o=i.childNodes[r],o&&(s=this._getSVGTextAlignPosition(o,e,t,i,a,n),o.setAttribute("x",s.x))},_getSVGTextAlignPosition:function(e,t,i,a){var n,o,s=0;if(e&&i)switch(n=e.getAttribute("totalWidth"),n=n?Number(n):e.getComputedTextLength(),o=a.getBBox(),i.textAlign){case"left":s=o.x;break;case"right":s=o.x+o.width-n;break;case"center":case"justify":s=o.x+o.width/2-n/2}return{x:s,y:0}},_updateTspanElement:function(e,t,i,a,n){this._postionSpanElement(e,t,i,a,n),e.segments&&e.segments.length>0?this._postionConnectorTextElement(e,t,i,a,n):this._postionNodeTextElement(e,t,i,a,n)},_updateLabelBackground:function(i,a,n,o,s,r,l){var d,h,c="stretch"===s.verticalAlignment?o.height-2:n.height,u="stretch"===s.horizontalAlignment?o.width-2:n.width;if(i="stretch"===s.horizontalAlignment?1:i,a="stretch"===s.verticalAlignment?1:a-s.fontSize,d=e("#"+o.name+"_"+s.name+"_lblbg")[0],h={id:o.name+"_"+s.name+"_lblbg",height:c,width:u,x:i,y:a,transform:"rotate("+s.rotateAngle+" "+(i+u/2)+" "+(a+c/2)+")"},"group"===o.type||o.children&&o.children.length>0){var g=t.datavisualization.Diagram.Point(o.offsetX,o.offsetY),i=i+(o.offsetX-o.width/2),a=a+(o.offsetY-o.height/2),m=o.rotateAngle+s.rotateAngle;h.x=0,h.y=0,h.transform="rotate("+m+","+g.x+","+g.y+"),translate("+i+","+a+")"}l.rect(h)},_renderLabelSpanElement:function(e,i,a,n,o,s){var r,l;a.templateId||(this._updateHashTable(a,i,n,o),e&&e.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),a.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(e,i,a,n,o,s):a.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(e,i,a,n,o,s):(r=n.tspan(),e.appendChild(r),r.setAttribute("x","0px"),r.setAttribute("y","0px"),a.textOverflow?(l=this._getLabelSize(a,i,o),this._updateOverFlowTspan(e,i,a,n,o,s,a.text,r,l)):r.textContent=a.text),this._updateTspanElement(i,a,e,n,o))},_getLabelSize:function(e,i){var a=t.datavisualization.Diagram.Util.bounds(i);return Math.max(e.width,a.width)},_svgTextWrapping:function(e,i,a,n,o){var s,r,l,d,h,c=(t.datavisualization.Diagram.Util.bounds(i),a.fontSize+2),u=n.tspan();for(u.setAttribute("x","0px"),e.childNodes&&0===e.childNodes.length?u.setAttribute("dy",c-2):u.setAttribute("dy",c),e.appendChild(u),s=0,r=a.text?a.text:a.hyperlink,u.textContent+=r[0],l=this._getLabelSize(a,i,o),s+=this._getSuitableLabelSize(a,r[0],o)*(a.fontSize/a.fontSize),d=1;d<r.length;d++)if("\n"==r[d]||s+this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)>=l){if(a.textOverflow)return"ellipsis"==a.overflowType&&(u.textContent=u.textContent.substr(0,u.textContent.length-3),u.textContent+="..."),!1;(textSeries.length-1>j||s>0)&&(u.setAttribute("totalWidth",s),u=n.tspan(),e.appendChild(u),h=e.getBBox(),u.setAttribute("x","0px"),u.setAttribute("y",c)),"\n"!=r[d]?(u.textContent+=r[d],s=this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)):s=0}else u.textContent+=r[d],s+=this._getSuitableLabelSize(a,r[d],o)*(a.fontSize/a.fontSize)},_updateOverFlowTspan:function(e,t,i,a,n,o,s,r,l){var d,h=s;this._updateHashTable(i,t,a,n,!0);var c=0,u="",g="",m=0;for("ellipsis"==i.overflowType&&(m=this._getSuitableLabelSize(i,".",n)*(i.fontSize/12)*3),d=0;d<h.length&&(u=h[d],c+=this._getSuitableLabelSize(i,u,n)*(i.fontSize/12),!(c+m>=l));d++)g+=u;r.textContent=g+("ellipsis"==i.overflowType?"...":"")},_svgWordWrapping:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v=0;for(r=t.datavisualization.Diagram.Util.bounds(i),l=a.text?a.text.split("\n"):a.hyperlink.split("\n"),d=a.fontSize+2,h=0;h<l.length;h++)if(f=e.getBBox(),p=n.tspan(),p.setAttribute("x","0px"),e.childNodes&&0===e.childNodes.length?p.setAttribute("dy",d-2):p.setAttribute("dy",d),e.appendChild(p),c=l[h],v=0,u=this._getLabelSize(a,i,o)," "===c)p.textContent=" ";else for(g=c.split(" "),m=0;m<g.length;m++)if(v+this._getSuitableLabelSize(a,g[m],o)*(a.fontSize/a.fontSize)>=u){if(a.textOverflow){this._updateOverFlowTspan(e,i,a,n,o,s,c,p,u);break}(g.length-1>m||v>0)&&(p.setAttribute("totalWidth",v),p=n.tspan(),e.appendChild(p),f=e.getBBox(),p.setAttribute("x","0"),p.setAttribute("dy",d)),"\n"!=g[m]?(p.textContent+=g[m],v=this._getSuitableLabelSize(a,g[m],o)*(a.fontSize/a.fontSize)):v=0}else v&&(p.textContent+=" ",v+=this._getSuitableLabelSize(a," ",o)*(a.fontSize/a.fontSize)),p.textContent+=g[m],v+=this._getSuitableLabelSize(a,g[m],o)*(a.fontSize/a.fontSize)},_renderLabelSVG:function(e,t,i,a){var n,o=i.getElementById(e.name),s=a._renderEjTemplate("#"+t.templateId,t),r=document.createElement("div");return r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g class="ej-label-template" id='+e.name+"_"+t.name+">"+s+"</g></svg>",document.body.appendChild(r),n=document.getElementById(e.name+"_"+t.name).cloneNode(!0),o.appendChild(n),r.parentNode.removeChild(r),n},_renderSVGLabel:function(e,i,a,n,o){var s,r,l,d,h=a.getElementById(e.name);return i.templateId&&i.templateType===t.datavisualization.Diagram.TemplateType.Svg?(this._renderLabelSVG(e,i,a,n,o),this._updateSVGTemplate(e,i,a,n,o)):(s={id:e.name+"_"+i.name+"_lblbg",fill:e._isHeader?"transparent":i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,"pointer-events":"none",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},r=a.rect(s),h.appendChild(r),s={id:e.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:""!==i.hyperlink?"blue":i.fontColor,"text-decoration":""!==i.hyperlink?"underline":i.textDecoration,"font-weight":i.bold?"bold":"normal","font-style":i.italic?"italic":"normal",visibility:i.visible?"visible":"hidden","fill-opacity":i.opacity,"stroke-opacity":i.opacity},this._addCssClass(i,s),i.hyperlink?(l=document.createElementNS("http://www.w3.org/2000/svg","a"),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i.hyperlink),l.setAttribute("target","_blank"),l.setAttribute("class","ej-d-anchor"),d=a.text(s),l.appendChild(d),h.appendChild(l)):(d=a.text(s),h.appendChild(d)),this._renderLabelSpanElement(d,e,i,a,n,o)),h},_renderSVGLabels:function(e,t,i,a){var n,o;if(e.labels.length&&"text"!=e.type)for(n=e.labels,o=0;o<n.length;o++)this._renderSVGLabel(e,n[o],t,i,a)},_updateLabelSpanElement:function(i,a,n,o,s){var r,l,d=n.getElementById(i.name+"_"+a.name);i.textBlock&&(d=n.getElementById(i.name+"_shape_lblbg")),d&&(e(d).empty(),this._updateHashTable(a,i,n,o),a.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?this._svgTextWrapping(d,i,a,n,o,s):a.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow?this._svgWordWrapping(d,i,a,n,o,s):(r=n.tspan(),d.appendChild(r),r.setAttribute("x","0px"),r.setAttribute("y",a.fontSize),a.textOverflow?(l=this._getLabelSize(a,i,o),this._updateOverFlowTspan(d,i,a,n,o,s,a.text,r,l)):r.textContent=a.text),this._updateTspanElement(i,a,d,n,o))},_updateSVGTemplate:function(e,i,a,n){var o,s,r,l=0,d=0,h=t.datavisualization.Diagram.Util.bounds(e),c=a.document.getElementById(e.name+"_"+i.name);if(c){if(o=c.getBBox(),e.segments&&"segmentpath"==i.relativeMode){s=this._getConnectorHandlePosition(i,e,1,n),r=s.position,l=r.x,d=r.y;var u=t.datavisualization.Diagram.Util._alignLabelOnSegments(e,i,n,s),g=u.vAlign,m=u.hAlign;switch(m){case"left":l=l-o.x+i.margin.left;break;case"right":l=l-o.width-i.margin.right;break;case"stretch":case"center":l=l-o.width/2+i.margin.left-i.margin.right}switch(g){case"top":d=d-o.y+i.margin.top;break;case"bottom":d=d-o.height+i.margin.bottom;break;case"stretch":case"center":d=d-o.height/2+i.margin.top-i.margin.bottom}}else{switch(i.horizontalAlignment){case"left":l=h.width/2+i.margin.left;break;case"right":l=h.width/2-o.width;break;case"stretch":l=h.width/2-o.width/2;break;case"center":l=h.width/2-o.width/2}switch(i.verticalAlignment){case"top":d=h.height/2;break;case"bottom":d=h.height/2-o.height;break;case"stretch":d=h.height/2-o.height/2;break;case"center":d=h.height/2-o.height/2}l=l*(i.offset.x?i.offset.x/.5:0)+i.margin.left-i.margin.right,d=d*(i.offset.y?i.offset.y/.5:0)+i.margin.top-i.margin.bottom,e.segments&&(l+=h.left,d+=h.top)}c.setAttribute("transform","translate("+l+","+d+") rotate("+i.rotateAngle+" "+(o.x+o.width/2)+" "+(o.y+o.height/2)+")")}},_updateLabelTemplate:function(i,a,n,o,s){var r,l,d;if(a.templateId)if(o&&o.model.labelRenderingMode===t.datavisualization.Diagram.LabelRenderingMode.Svg)r=n.document.getElementById(i.name+"_"+a.name),r.parentNode.removeChild(r),l=this._renderLabelSVG(i,a,n,o,s),d={visibility:a.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",o)?"visible":"hidden",style:"opacity:"+a.opacity},t.datavisualization.Diagram.Util.attr(l,d);else{var h=n.document.parentNode.getElementsByClassName("htmlLayer")[0]||o._htmlLayer,c=this._findChild(h.childNodes,i),u=e(c).children("#"+i.name+"_"+a.name+"_lblbg")[0],g=o._renderEjTemplate("#"+a.templateId,a),m=u.childNodes[0];m.innerHTML=g}},_updateSVGLabel:function(e,i,a,n,o){var s,r;i.templateId?(s=document.getElementById(e.name+"_"+i.name),s&&(r={visibility:i.visible?"visible":"hidden",style:"opacity:"+i.opacity}),t.datavisualization.Diagram.Util.attr(s,r),this._updateSVGTemplate(e,i,a,n,o)):(r={id:e.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:""!==i.hyperlink?"blue":i.fontColor,"text-decoration":""!==i.hyperlink?"underline":i.textDecoration},a.text(r),this._updateLabelSpanElement(e,i,a,n,o))},_updateSVGLabels:function(e,t,i,a){var n,o;if(e.labels.length&&"text"!=e.type)for(n=e.labels,o=0;o<n.length;o++)this._updateSVGLabel(e,n[o],t,i,a)},_renderLabels:function(i,a,n,o){var s,r;if(n&&n.model.labelRenderingMode!=t.datavisualization.Diagram.LabelRenderingMode.Svg){if(i.labels.length&&"text"!=i.type){var l,d,h,c,u,g=i.labels,m=t.datavisualization.Diagram.Util.bounds(i),p=!1;for(s=0;s<g.length;s++)if(i.labels[s].hyperlink)this._renderSVGLabel(i,i.labels[s],a,n,o);else{if(!p){p=!0,r=a.document.parentNode.getElementsByClassName("htmlLayer")[0],u=e(r).children("#"+i.name+"_label")[0],u&&r.removeChild(u),u=document.createElement("div"),i.segments?(l=m.width,d=m.height,h=m.x,c=m.y):(l=i.width?i.width:i._width,d=i.height?i.height:i._height,h=i.offsetX-l*i.pivot.x,c=i.offsetY-d*i.pivot.y),o&&(h=0,c=0);var f=i.visible&&t.datavisualization.Diagram.Util.enableLayerOption(i,"visible",n)?"visible":"hidden",v="width:"+l+"px; height:"+d+"px; left:"+h+"px; top:"+c+"px; display: block; position: absolute; pointer-events: none; visibility:"+f+"; padding: inherit;",_="node"===i._type?"ej-d-node":"group"===i._type?"ej-d-group":"ej-d-connector";i._isClassifier&&(_+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(u,{id:i.name+"_label","class":_,style:v}),i.rotateAngle&&(u.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",u.style.MozTransform="rotate("+i.rotateAngle+"deg) ",u.style.OTransform="rotate("+i.rotateAngle+"deg) ",u.style.msTransform="rotate("+i.rotateAngle+"deg)",u.style.transform="rotate("+i.rotateAngle+"deg) ",u.style["transform-origin"]=100*i.pivot.x+"% "+100*i.pivot.y+"%"),r&&r.appendChild(u)}this._renderLabel(i,m,g[s],u,r,a,l,d,n)}}}else this._renderSVGLabels(i,a,n,o)},_isParentVisible:function(e,t){for(var i=t.document.getElementById(e);i&&("DiagramLayer"!=i.getAttribute("class")||i.localName&&"svg"!==i.localName)&&(!i.localName||"svg"===i.localName);){if(i&&"visible"!==i.getAttribute("visibility"))return!0;i=i.parentNode}},_renderLabel:function(e,i,a,n,o,s,r,l,d){var h,c,u,g,m,p,f=document.createElement("div"),v=document.createElement("span");return a.templateId&&(h=d._renderEjTemplate("#"+a.templateId,a)),s.document&&"overview_svg"===s.document.getAttribute("class")?t.datavisualization.Diagram.Util.attr(v,this._addCssClass(a,{id:e.name+"_"+a.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; line-height: normal; pointer-events: none"})):(c=t.datavisualization.Diagram.Util.canEnablePointerEvents(e,d),u="ej-d-label",e._isClassifier&&(u+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(v,this._addCssClass(a,{id:e.name+"_"+a.name,"class":u,style:"display: inline-block; position: absolute; line-height: normal; pointer-events:"+(c?"all":"none")}))),("stretch"==a.horizontalAlignment||"stretch"==a.verticalAlignment)&&(g=this._rotateLabel(r,l,a),"stretch"==a.horizontalAlignment&&(v.style.width=Math.abs(g.x)+"px"),"stretch"==a.verticalAlignment&&(v.style.alignItems="center",v.style.display="flex",v.style.justifyContent="center",v.style.height=Math.abs(g.y)+"px"),a.textOverflow&&(v.style.display="inline-block",0==a.rotateAngle&&e._isHeader?(v.style.top=Math.abs(g.y)/2-a.fontSize/2+"px",v.style.left="0px"):e._isHeader&&(v.style.left=Math.abs(g.y)/2-a.fontSize/2+"px",v.style.top="0px"))),a.bold&&(v.style.fontWeight="bold"),a.italic&&(v.style.fontStyle="italic"),(!a.visible||this._isParentVisible(e.name,s))&&(v.style.visibility="hidden"),v.style.opacity=a.opacity,v.style.textDecoration=a.textDecoration,v.style.fontFamily=a.fontFamily,v.style.fontSize=a.fontSize+"px",v.style.color=a.fontColor,v.style.backgroundColor=a.fillColor,v.style.borderColor=a.borderColor,v.style.borderWidth=a.borderWidth+"px",e._isHeader&&(v.style.borderWidth="0px",v.style.backgroundColor="transparent"),v.style.borderStyle="solid",v.textContent=a.text,a.width=r=r>a.width?r:a.width,a.height=l=l>a.height?l:a.height,a.margin.left&&a.margin.right&&(r-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(l-=(a.margin.top||0)+(a.margin.bottom||0)),m="display: inline-block; position: absolute; pointer-events: none; width:"+r+"px;height:"+l+"px;",t.datavisualization.Diagram.Util.attr(f,{id:e.name+"_"+a.name+"_lblbg",style:m}),a.templateId||(f.appendChild(v),n.appendChild(f),this._alignTextOnLabel(e,i,v,f,a,d,p)),a.templateId&&(p=document.createElement("div"),p.setAttribute("class","ej-label-template"),p.setAttribute("id",e.name+"_"+a.name),p.innerHTML=h,f.appendChild(p),n.appendChild(f),p.style.position="absolute",this._alignTextOnLabel(e,i,p,f,a,d)),f},_findChild:function(e,t){for(var i=e.length,a=0;i>a;a++)if(e[a].id==t.name+"_label")return e[a]},_updateLabels:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m,p;if(a.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg)a._isSelectMode||this._updateSVGLabels(e,i,a);else if(e.labels&&"text"!=e.type){var f,v,_,y,b=e.labels,x=t.datavisualization.Diagram.Util.bounds(e),D=a._htmlLayer?a._htmlLayer:i.document.parentNode.getElementsByClassName("htmlLayer")[0];for(D&&(n=D.childNodes[e.zOrder],n&&n.id==e.name||(o=D.childNodes,n=this._findChild(o,e,i))),n&&(e.segments?(f=x.width,v=x.height,_=x.x,y=x.y):(f=e.width?e.width:e._width,v=e.height?e.height:e._height,_=e.offsetX-f*e.pivot.x,y=e.offsetY-v*e.pivot.y),s=e.visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",a)?"visible":"hidden",n.style.width=f+"px",n.style.height=v+"px",n.style.left=_+"px",n.style.top=y+"px",n.style.opacity=e.opacity,r="rotate("+e.rotateAngle+"deg) ",l=e.pivot?100*e.pivot.x+"% "+100*e.pivot.y+"%":"50% 50%",n.style.webkitTransform=r,n.style.MozTransform=r,n.style.OTransform=r,n.style.msTransform=r,n.style.transform=r,n.style["transform-origin"]=n.style["ms-transform-origin"]=n.style["webkit-transform-origin"]=n.style["o-transform-origin"]=n.style["moz-transform-origin"]=l,n.style.visibility=s),u=0;u<b.length;u++)e.labels[u].hyperlink?this._updateSVGLabel(e,e.labels[u],i,a):n&&(g=b[u],d=n.childNodes[u],d&&(m=d.childNodes[0],g.text||m.textContent?(c=f>g.width?f:g.width,g.margin.left&&g.margin.right&&(c-=(g.margin.left||0)+(g.margin.right||0)),g.margin.top&&g.margin.bottom&&(h-=(g.margin.top||0)+(g.margin.bottom||0)),d.style.height=h+"px",d.style.width=c+"px",g.templateId||(m.textContent=g.text),("stretch"==g.horizontalAlignment||"stretch"==g.verticalAlignment)&&(p=this._rotateLabel(f,v,g),"stretch"==g.horizontalAlignment&&(m.style.width=Math.abs(p.x)+"px"),"stretch"==g.verticalAlignment&&(m.style.alignItems="center",m.style.display="flex",m.style.justifyContent="center",m.style.height=Math.abs(p.y)+"px"),g.textOverflow&&(m.style.display="inline-block")),this._alignTextOnLabel(e,x,m,d,g,a)):e._isHeader&&(m.style["pointer-events"]=a&&a.activeTool&&"move"===a.activeTool.name&&a.activeTool.inAction?"none":"all")))}},_alignTextOnPhase:function(e,i,a,n,o){var s,r,l,d;o.getElementById(e.name)&&(s=o.getElementById(e.name).getBoundingClientRect()),s&&(r=a.getBBox(),l=o.getElementById(e.name+"_"+n.name+"_lblbg"),a.setAttribute("transform","translate("+-r.width/2+",50), rotate(0,0,0)"),a.setAttribute("pointer-events","auto"),l&&(d={width:r.width,height:r.height,fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,transform:"translate("+-r.width+","+s.top+"), rotate(0,0,0)"},t.datavisualization.Diagram.Util.attr(l,d)))},updateLabel:function(i,a,n,o){var s,r;if("string"==typeof a.text){var l,d,h,c,u,g=t.datavisualization.Diagram.Util.bounds(i),m=o._htmlLayer||n.document.parentNode.getElementsByClassName("htmlLayer")[0],p=e(m).children("#"+i.name+"_label")[0];i.segments?(c=g.width,u=g.height):(c=i.width?i.width:i._width,u=i.height?i.height:i._height),l=e(p).children("#"+i.name+"_"+a.name+"_lblbg")[0],l?(s=l.childNodes[0],h=c>a.width?c:a.width,a.margin.left&&a.margin.right&&(h-=(a.margin.left||0)+(a.margin.right||0)),a.margin.top&&a.margin.bottom&&(d-=(a.margin.top||0)+(a.margin.bottom||0)),l.style.height=d+"px",l.style.width=h+"px",l.style.opacity=i.opacity,a.templateId||(s.textContent=a.text),s.style.opacity=a.opacity,("stretch"==a.horizontalAlignment||"stretch"==a.verticalAlignment)&&(r=this._rotateLabel(c,u,a),"stretch"==a.horizontalAlignment&&(s.style.width=Math.abs(r.x)+"px"),"stretch"==a.verticalAlignment&&(s.style.alignItems="center",s.style.display="flex",s.style.justifyContent="center",s.style.height=Math.abs(r.y)+"px"),a.textOverflow&&(s.style.display="inline-block")),"node"!=i.type||i.width||i.height||this.updateNode(i,n,o),this._alignTextOnLabel(i,g,s,l,a,o)):this._updateLabelSpanElement(i,a,n,o)}},_alignTextOnLabel:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m;if(e.segments&&"segmentpath"==o.relativeMode){h=this._getConnectorHandlePosition(o,e,1,s);var p=h.position,c={x:(p.x-i.x)/i.width,y:(p.y-i.y)/i.height},f=t.datavisualization.Diagram.Util._alignLabelOnSegments(e,o,s,h);d=f.vAlign,l=f.hAlign}else c={x:o.offset.x,y:o.offset.y},l=o.horizontalAlignment,d=o.verticalAlignment;a.style["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(e,s)?s&&s.activeTool&&"move"===s.activeTool.name&&s.activeTool.inAction?"none":"all":"none",u=e.width?e.width:e._width,g=e.height?e.height:e._height,u-=o.margin.left+o.margin.right,g-=o.margin.top+o.margin.bottom,r={x:u,y:g},o.textOverflow&&(a.style.textOverflow=o.overflowType,a.style.overflow="hidden",a.style.whiteSpace="nowrap",a.style.width=u+"px"),o.rotateAngle&&(m=t.Matrix.identity(),t.Matrix.rotate(m,o.rotateAngle,c.x,c.y),r=t.Matrix.transform(m,{x:u,y:g}));var v,_,y=0,b=0;t.datavisualization.Diagram.Util.canMoveLabel(e);switch(o.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap?(a.style.whiteSpace="nowrap",a.style.wordWrap="normal",a.style.maxWidth="",a.style.maxHeight=""):o.templateId||(o.textOverflow||(a.style.whiteSpace="justify"!=o.textAlign?"pre-wrap":"pre-line"),o.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?(a.style.wordBreak="break-all",a.style.wordWrap="break-word",e.segments?a.style.maxWidth=(i.width>o.width?i.width:o.width)+"px":(Math.abs(r.x)<o.width&&(r.x=o.width),a.style.maxWidth=Math.abs(r.x)+"px",a.style.maxHeight=Math.abs(r.y)+"px")):(a.style.wordWrap="break-word",a.style.maxWidth="",a.style.maxHeight="")),l){case t.datavisualization.Diagram.HorizontalAlignment.Left:y="0%",v=o.margin.left+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Center:y="-50%",v=o.margin.left-o.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Right:y="-100%",v=-o.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:y="-50%"}switch(d){case t.datavisualization.Diagram.VerticalAlignment.Top:b="0%",_=o.margin.top+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Center:b="-50%",_=o.margin.top-o.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:b="-100%",_=-o.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Stretch:b="-50%"}o.margin.left&&o.margin.right&&o.margin.top&&o.margin.bottom&&!e._isClassifier&&!e._isClassMember?(a.style.marginLeft=v,a.style.marginTop=_):(n.style.marginLeft=v,n.style.marginTop=_),c.x*=100,c.y*=100,a.style.textAlign=o.textAlign,a.style.webkitTransform="translate("+y+", "+b+") rotate("+o.rotateAngle+"deg)",
a.style.MozTransform="translate("+y+", "+b+") rotate("+o.rotateAngle+"deg)",a.style.OTransform="translate("+y+", "+b+") rotate("+o.rotateAngle+"deg)",a.style.msTransform="translate("+y+", "+b+") rotate("+o.rotateAngle+"deg)",a.style.transform="translate("+y+", "+b+") rotate("+o.rotateAngle+"deg)","stretch"==o.horizontalAlignment||"stretch"==o.verticalAlignment||o.templateId||(a.style.left="0px",a.style.top="0px"),n&&(n.style.left=c.x+"%",n.style.top=c.y+"%")},_rotateLabel:function(e,i,a){var n,o={x:e,y:i};return a.rotateAngle&&(n=t.Matrix.identity(),t.Matrix.rotate(n,a.rotateAngle,0,0),o=t.Matrix.transform(n,{x:e,y:i})),o},_renderLabelGroup:function(e,t,i){var a,n;if("group"==e._type){for(a=0;a<e.children.length;a++)n=i.nameTable[i._getChild(e.children[a])],"group"==n._type?this._renderLabelGroup(n,t,i):this._renderLabelsAsSvg(n,t,i);this._renderLabelsAsSvg(e,t,i)}},_renderLabelsAsSvg:function(e,t,i){var a,n=t.document.getElementById(e.name);if("text"===e.type)this._renderTextElementAsSvg(e,e.textBlock,n,t,i);else for(a=0;a<e.labels.length;a++)this._renderTextElementAsSvg(e,e.labels[a],n,t,i)},_renderTextElementAsSvg:function(e,i,a,n,o){var s,r,l,d,h,c,u={id:e.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,visibility:i.visible||"text"===e.type?"visible":"hidden","pointer-events":"none"};i.bold&&(u["font-weight"]="bold"),i.italic&&(u["font-style"]="italic"),s=n.text(u),s.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),s.textContent=i.text,u={id:e.name+"_"+i.name+"_lblbg",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,transform:"translate(0,0)"},r=n.rect(u),i.text&&(a.appendChild(s),a.insertBefore(r,s),l=t.datavisualization.Diagram.Util.bounds(e),d=!1,e._isHeader&&i.rotateAngle&&o&&(h=o.nameTable[e.parent],h&&h.isLane&&(d=!0),c=o.nameTable[e.parent],c&&c.isPhaseStack&&"vertical"==!e.orientation&&(d=!0)),this._wrapText(e,l,s,i,n,d),this._alignTextOnSvgLabel(e,l,s,i,n,o,d))},_alignTextOnSvgLabel:function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m=a.getBBox(),p=t.datavisualization.Diagram.Util._getLabelPosition(n,i);r&&(m=t.datavisualization.Diagram.Util._rBounds(m,n.rotateAngle),p=t.datavisualization.Diagram.Util._getLabelPosition(n,i,null,null,r,a)),l=r?p:this._adjustOffsetWithTextBounds(e,n,a,p,m,i,s),d=n.borderWidth||0,a.setAttribute("transform","translate("+(l.x+d)+","+(l.y+d)+"), rotate("+n.rotateAngle+","+(p.x-l.x)+","+(p.y-l.y)+")"),h=o.getElementById(e.name+"_"+n.name+"_lblbg"),h&&(c=l.x+m.x,u=l.y,"mozilla"===t.browserInfo().name&&(u=l.y+n.fontSize/2),c+=d/2,u+=d/2,g={width:m.width+d,height:m.height+d,transform:"translate("+c+","+u+"), rotate("+n.rotateAngle+","+(p.x-c)+","+(p.y-u)+")",fill:n.fillColor?n.fillColor:"transparent",stroke:n.borderColor,"stroke-width":n.borderWidth},r&&(g.fill="transparent"),t.datavisualization.Diagram.Util.attr(h,g))},_adjustOffsetWithTextBounds:function(e,i,a,n,o,s,r){var l,d,h,c={x:0,y:0},u=0;if(e.segments&&"segmentpath"===i.relativeMode){var g=this._getConnectorHandlePosition(i,e,1,r),m=g.position,p={x:(m.x-s.x)/s.width,y:(m.y-s.y)/s.height};p=t.datavisualization.Diagram.Util._getLabelPosition(i,s,p),n.x=p.x,n.y=p.y,h=t.datavisualization.Diagram.Util._alignLabelOnSegments(e,i,r,g),d=h.hAlign,l=h.vAlign}else d=i.horizontalAlignment,l=i.verticalAlignment;if(l==t.datavisualization.Diagram.VerticalAlignment.Top?u=n.y:l==t.datavisualization.Diagram.VerticalAlignment.Center?u=n.y-o.height/2:l==t.datavisualization.Diagram.VerticalAlignment.Bottom?u=n.y-o.height:l==t.datavisualization.Diagram.VerticalAlignment.Stretch&&(u=n.y-o.height/2),c.y=u,"justify"==i.textAlign)c.x=a.childNodes.length>1?n.x-e.width/2:n.x;else switch(d){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=n.x;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=n.x+o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=n.x+o.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=n.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=n.x;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=n.x+o.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=n.x-o.width;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=n.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=n.x}break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:c.x=n.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:c.x=n.x;break;case t.datavisualization.Diagram.TextAlign.Right:c.x=n.x+s.width/2}}return(e.segments||"group"==e._type)&&(c.x=c.x+s.x,c.y=c.y+s.y,n.x+=s.x,n.y+=s.y),"mozilla"===t.browserInfo().name&&(c.y=c.y-i.fontSize/2),c},_wrapText:function(e,t,i,a,n,o){for(var s,r,l,d,h,c,u,g=a.text;i.hasChildNodes();)i.removeChild(i.lastChild);e.segments?(s=t.width,r=t.height):(s=t.width-a.margin.left-a.margin.right,r=t.height-a.margin.top-a.margin.bottom),o&&(l=s,s=r,r=l),s-=2*(a.borderWidth?a.borderWidth:1),s=s<a.width?a.width:s;var m,p,f,v,_,y=g.split("\n");if(n.getElementById(i.id)&&(f=n.getElementById(i.id).childNodes),f){for(d="wrapwithoverflow"==a.wrapping,p=0;p<y.length;p++)if(m=n.tspan(),m.style.fontSize=a.fontSize,i.appendChild(m),"nowrap"!=a.wrapping)if(" "===y[p])m.textContent=" ";else for(h="wrapwithoverflow"==a.wrapping?y[p].split(" "):y[p],_=0;_<h.length;_++)c=h[_],c.indexOf("-")>=0&&d?(m=this._splitHyphenWord(m,c,i,a,s,n),_==h.length-1?_==h.length-1||(m=n.tspan(),i.appendChild(m)):this._getTextLength(n,i,m.textContent+" "+(h[_+1]||"")).width>s&&(m=n.tspan(),i.appendChild(m))):(m.textContent+=(m.textContent&&d?" ":"")+h[_],v=f[f.length-1].getComputedTextLength(),v>=s?_==h.length-1||(m=n.tspan(),i.appendChild(m)):(d||a&&"wrap"===a.wrapping)&&(u=m.textContent,_<h.length-1&&(h[_+1].indexOf("-")>=0&&d?(m=this._splitHyphenWord(m,h[_+1],i,a,s,n),this._getTextLength(n,i,m.textContent+" "+(h[_+1]||"")).width>s&&(m=n.tspan(),i.appendChild(m)),_++):(m.textContent+=(d?" ":"")+(h[_+1]||""),v=f[f.length-1].getComputedTextLength(),m.textContent=u,v>s&&(m=n.tspan(),i.appendChild(m))))));else m.textContent+=y[p];this._wrapTextAlign(i,f,a.fontSize,a.textAlign,e,a,n)}},_splitHyphenWord:function(e,t,i,a,n,o){for(var s,r=e.textContent,l="wrapwithoverflow"==a.wrapping,d=e.textContent?e.textContent+" ":"",h=t.split("-"),c=0;c<h.length;c++)d+=h[c],s=this._getTextLength(o,i,d),s>=n?(e.textContent=r,e=o.tspan(),i.appendChild(e),d=c<h.length-1?h[c]+"-":h[c],r=d):(l||a&&"wrap"===a.wrapping)&&(r=d,c<h.length-1&&(d+="-",this._getTextLength(o,i,d)>n?(e.textContent=r,e=o.tspan(),i.appendChild(e),d="-"):r=d));return e.textContent=r,e},_getTextLength:function(e,t,i){var a,n=e.tspan();return t.appendChild(n),n.textContent=i,a=n.getComputedTextLength(),t.removeChild(n),a},_getTSpanLength:function(e,t,i,a){var n,o=0;if(e&&e.textContent)for(n=0;n<e.textContent.length;n++)o+=this._getCharBoundsValues(e.textContent[n],t,i,a).bold;return o},_wrapTextAlign:function(e,i,a,n,o,s,r){for(var l,d,h,c,u,g,m,p=2,f=0;f<i.length;f++){switch(l=i[f],"justify"==n&&f!=i.length-1?(m=l.textContent," "==m[m.length-1]&&(m=m.slice(0,m.length-1))," "==m[0]&&(m=m.slice(1,m.length)),l.textContent=m,c=l.getComputedTextLength(),u=o.width-c,g=u/(m.split(" ").length-1),l.setAttribute("word-spacing",g+"px"),c=l.getComputedTextLength()):(d=this._getTSpanLength(l,s,r,o),c=d?d:l.getComputedTextLength()),"justify"==n&&(n=i.length>1?"left":"center"),n){case"left":c=0;break;case"center":c=-c/2;break;case"right":c=-c}h={x:Number(c),dy:p>2?a*p:a},0==c&&""==l.textContent?p++:p=2,t.datavisualization.Diagram.Util.attr(l,h)}},_renderPorts:function(e,t,i,a){var n,o,s,r,l,d,h,c,u=e.width?e.width:e._width||0,g=e.height?e.height:e._height||0,m=e.offsetX-u*e.pivot.x,p=e.offsetY-g*e.pivot.y,f=e.ports,v=i._currZoom;for(i.model.palettes||a?s=t.getElementById(e.name):(d={id:e.name+"_ej_ports","pointer-events":"all",padding:"inherit"},"group"!==e._type&&(d.transform="rotate("+e.rotateAngle+","+e.offsetX*v+","+e.offsetY*v+"), translate("+m*v+","+p*v+")"),s=t.g(d)),h=0,c=f.length;c>h;++h)n=f[h],o=this._renderPort(e,n,t,i),s.appendChild(o);l=t.getElementById(e.parent+"_ej_ports"),""!=e.parent&&(l||(r=t.g({id:e.parent+"_ej_ports","pointer-events":"all",padding:"inherit"}),i.model.palettes||a?t.getElementById(e.name).appendChild(r):t.getElementById(i._canvas.id+"_portLayer").appendChild(r),l=r)),i.model.palettes||a||(l?l.appendChild(s):t.getElementById(i._canvas.id+"_portLayer").appendChild(s))},_renderPort:function(e,i,a,n){var o,s,r,l,d,h,c,u,g=t.datavisualization.Diagram.Size(i.size,i.size),m=n._currZoom?n._currZoom:1;switch(r=i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect?"hidden":t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",n)?"visible":"hidden",l="group"===e._type?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(e,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(e,!0),!0),"group"===e._type&&e.rotateAngle&&(d=t.Matrix.identity(),t.Matrix.rotate(d,e.rotateAngle,e.offsetX,e.offsetY),l=t.Matrix.transform(d,l),i._absolutePoint=l),i.shape){case"x":h=this._constructX(l,i.size,m),s={id:e.name+"_"+i.name,"class":"ej-d-port",fill:i.fillColor,visibility:r,stroke:i.borderColor,"stroke-width":i.borderWidth,d:h},this._addCssClass(i,s),o=a.path(s);break;case"circle":c=g.width/2,u=g.height/2,s={id:e.name+"_"+i.name,"class":"ej-d-port",rx:c,ry:u,visibility:r,cx:l.x*m,cy:l.y*m,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth},this._addCssClass(i,s),o=a.ellipse(s);break;case"square":s={id:e.name+"_"+i.name,"class":"ej-d-port",x:l.x*m-i.size/2,visibility:r,y:l.y*m-i.size/2,width:g.width,height:g.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth},this._addCssClass(i,s),o=a.rect(s);break;case"path":var p=g.width,f=g.height,h=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(l.x*m-i.size/2,l.y*m-i.size/2,p,f,i.pathData,a);s={id:e.name+"_"+i.name,width:p,height:f,d:h,stroke:i.borderColor,"stroke-width":i.borderWidth,fill:i.fillColor,visibility:r},this._addCssClass(i,s),o=a.path(s)}return o},deleteLabel:function(e,t,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n._canvas;n.context._deleteLabel(e,t,i,o,n)})},deletePort:function(e,t,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n._canvas;n.context._deletePort(e,t,i,"overview"!==n.type?i._adornerSvg:o,n)})},_insertPort:function(e,i,a,n,o,s){var r,l,d,h;for(r=s?a.getElementById(e.name):a.getElementById(e.name+"_ej_ports"),l=t.datavisualization.Diagram.SvgContext._renderPort(e,i,a,o),d=[],h=0;h<r.childNodes.length;h++)"ej-d-port"==r.childNodes[h].className.animVal&&d.push(r.childNodes[h]);void 0!=n?0==d.length?r.appendChild(l):r.insertBefore(l,d[n]?d[n]:d[d.length]):r.appendChild(l),(i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&l.setAttribute("visibility","hidden")},_updatePort:function(e,i,a,n,o){var s,r,l,d,h,c,u=t.datavisualization.Diagram.Size(i.size,i.size),g=null,m=o?1:n._currZoom;switch(g="group"===e._type?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(e,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(e,!0),!0),r=e.name+"_"+i.name,"group"===e._type&&e.rotateAngle&&(l=t.Matrix.identity(),t.Matrix.rotate(l,e.rotateAngle,e.offsetX,e.offsetY),g=t.Matrix.transform(l,g),i._absolutePoint=g),s=i.visibility&t.datavisualization.Diagram.PortVisibility.Visible&&t.datavisualization.Diagram.Util.enableLayerOption(e,"visible",n)?"visible":"hidden",i.shape){case"x":d=this._constructX(g,i.size,m),a.path({id:r,d:d,visibility:s});break;case"circle":h=u.width/2,c=u.height/2,"group"===e.type?a.ellipse({id:r,rx:h,ry:c,cx:0,cy:0,visibility:s,transform:"rotate("+e.rotateAngle+","+g.x*m+","+g.y*m+"),translate("+g.x*m+","+g.y*m+")"}):a.ellipse({id:r,rx:h,ry:c,visibility:s,cx:g.x*m,cy:g.y*m});break;case"square":"group"===e.type?a.rect({id:r,x:0,y:0,visibility:s,transform:"rotate("+e.rotateAngle+","+g.x*m+","+g.y*m+"),translate("+(g.x*m-i.size/2)+","+(g.y*m-i.size/2)+")"}):a.rect({id:r,visibility:s,x:g.x*m-i.size/2,y:g.y*m-i.size/2});break;case"path":var p=u.width,f=u.height,d=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(g.x*m-i.size/2,g.y*m-i.size/2,p,f,i.pathData,a),v={id:r,visibility:s,d:d};"group"===e.type&&(v={id:r,d:d,visibility:s,transform:"rotate("+e.rotateAngle+","+g.x*m+","+g.y*m+")"}),a.path(v)}},_updatePorts:function(e,t,i,a){var n,o;if(e.ports){var s,r,l=e.ports,d=i._currZoom,h=e.width?e.width:e._width,c=e.height?e.height:e._height,u=e.offsetX-h*e.pivot.x,g=e.offsetY-c*e.pivot.y;for(r=a?t.getElementById(e.name):t.getElementById(e.name+"_ej_ports"),n=0,o=l.length;o>n;++n)s=l[n],this._updatePort(e,s,t,i);r&&"group"!==e._type&&(a||r.setAttribute("transform","rotate("+e.rotateAngle+","+e.offsetX*d+","+e.offsetY*d+"), translate("+u*d+","+g*d+")"))}},_constructX:function(e,i,a){var n=new t.datavisualization.Diagram.Path;return n.moveTo(e.x*a-i/2,e.y*a-i/2),n.lineTo(e.x*a+i/2,e.y*a+i/2),n.moveTo(e.x*a+i/2,e.y*a-i/2),n.lineTo(e.x*a-i/2,e.y*a+i/2),n.toString()},_enableSelectedNode:function(t,i,a){var n,o,s,r,l,d,h,c,u,g;if(t){if("pseudoGroup"==t.type)for(n=t.children,o=0,s=n.length;s>o;o++)r=a.nameTable[a._getChild(n[o])],r&&this._enableSelectedNode(r,i,a);else l={id:t.name,"pointer-events":"auto",style:"pointer-events:block"},t.segments&&(d=i.document.getElementById(t.name+"_hitTest"),d&&d.setAttribute("pointer-events",t.visible?"stroke":"none")),i.g(l);t&&"html"===t.type&&(h=a._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],h&&(c=e(h).find("#"+t.name+"_parentdiv")[0]),c&&(c.style.pointerEvents="all",u=c.children[0],u&&(u.style.pointerEvents="all"))),a._adornerSvg&&(g=a._adornerSvg.document.getElementById(a._adornerSvg.document.id+"handle_g"),g&&g.setAttribute("pointer-events","visible")),t.isLane&&(e("#diagram").find(".s-resize").css("pointer-events","visible"),e("#diagram").find(".e-resize").css("pointer-events","visible")),e("#diagram").find(".ej-d-seperator").css("pointer-events","visible")}},_disableSelectedNode:function(t,i,a){var n,o,s,r,l,d,h,c,u,g;if(t){if("pseudoGroup"==t.type)for(n=t.children,o=0,s=n.length;s>o;o++)r=a.nameTable[a._getChild(n[o])],r&&this._disableSelectedNode(r,i,a);else l={id:t.name,style:"pointer-events:none","pointer-events":"none"},t.segments&&(d=i.document.getElementById(t.name+"_hitTest"),d.setAttribute("pointer-events","none")),i.g(l);a._adornerSvg&&(h=a._adornerSvg.document.getElementById(a._adornerSvg.document.id+"handle_g"),h&&h.setAttribute("pointer-events","none")),t&&"html"===t.type&&(c=a._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],c&&(u=e(c).find("#"+t.name+"_parentdiv")[0]),u&&(u.style.pointerEvents="none",g=u.children[0],g&&(g.style.pointerEvents="none"))),t.isLane&&(e("#diagram").find(".s-resize").css("pointer-events","none"),e("#diagram").find(".e-resize").css("pointer-events","none")),e("#diagram").find(".ej-d-seperator").css("pointer-events","none")}},_drawStackHighlighter:function(e,i,a,n,o,s){var r,l=[],d=t.datavisualization.Diagram.Util.bounds(e);s?o.y>=d.y&&o.y<d.center.y?(l.push({x:d.topLeft.x*n-5,y:d.topLeft.y*n-5}),l.push({x:d.topLeft.x*n,y:d.topLeft.y*n}),l.push({x:d.topLeft.x*n-5,y:d.topLeft.y*n+5}),l.push({x:d.topLeft.x*n,y:d.topLeft.y*n}),l.push({x:d.topRight.x*n,y:d.topRight.y*n}),l.push({x:d.topRight.x*n+5,y:d.topRight.y*n-5}),l.push({x:d.topRight.x*n,y:d.topRight.y*n}),l.push({x:d.topRight.x*n+5,y:d.topRight.y*n+5}),l.push({x:d.topRight.x*n,y:d.topRight.y*n})):(l.push({x:d.bottomLeft.x*n-5,y:d.bottomLeft.y*n-5}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n}),l.push({x:d.bottomLeft.x*n-5,y:d.bottomLeft.y*n+5}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}),l.push({x:d.bottomRight.x*n+5,y:d.bottomRight.y*n-5}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}),l.push({x:d.bottomRight.x*n+5,y:d.bottomRight.y*n+5}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n})):o.x>=d.x&&o.x<d.center.x?(l.push({x:d.topLeft.x*n-5,y:d.topLeft.y*n-5}),l.push({x:d.topLeft.x*n,y:d.topLeft.y*n}),l.push({x:d.topLeft.x*n+5,y:d.topLeft.y*n-5}),l.push({x:d.topLeft.x*n,y:d.topLeft.y*n}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n}),l.push({x:d.bottomLeft.x*n-5,y:d.bottomLeft.y*n+5}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n}),l.push({x:d.bottomLeft.x*n+5,y:d.bottomLeft.y*n+5}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n}),l.push({x:d.bottomLeft.x*n,y:d.bottomLeft.y*n})):(l.push({x:d.topRight.x*n-5,y:d.topRight.y*n-5}),l.push({x:d.topRight.x*n,y:d.topRight.y*n}),l.push({x:d.topRight.x*n+5,y:d.topRight.y*n-5}),l.push({x:d.topRight.x*n,y:d.topRight.y*n}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}),l.push({x:d.bottomRight.x*n-5,y:d.bottomRight.y*n+5}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}),l.push({x:d.bottomRight.x*n+5,y:d.bottomRight.y*n+5}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}),l.push({x:d.bottomRight.x*n,y:d.bottomRight.y*n}));var r=this._convertToSVGPoints(l),h={id:"nodeHighlighter",points:r,fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",style:"pointer-events: none"},c=i.polyline(h);return a.appendChild(c),c},_drawNodeHighlighter:function(e,i,a,n){var o,s=e.width?e.width:e._width,r=e.height?e.height:e._height,l=e.offsetX-s*e.pivot.x,d=e.offsetY-r*e.pivot.y,h=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),c="rotate("+e.rotateAngle+","+h.x*n+","+h.y*n+")",u=e.isLane||e.isSwimlane?"red":"#0dc923",g={id:"nodeHighlighter","class":"ej-d-node",x:l*n,y:d*n,width:s*n,height:r*n,fill:"transparent",stroke:u,"stroke-width":2,"pointer-events":"none",transform:c,style:"pointer-events: none"};return o=i.rect(g),a.appendChild(o),o},_drawNavigationHighlighter:function(e,t,i,a){var n={id:"nodeHighlighter",x:e.x*a,y:e.y*a,width:e.width*a,height:e.height*a,fill:"transparent",stroke:"black","stroke-dasharray":"2 2","shape-rendering":"crispEdges",style:"pointer-events: none"};i.appendChild(t.rect(n))},_removeNodeHighlighter:function(e,t){var i=e.getElementById("nodeHighlighter");i&&e.removeChild(i,t)},_drawPortHighlighter:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v=(i.width?i.width:i._width,i.height?i.height:i._height,"#8CC63F"),_="#1A1A1A",y=.5;return e?(l=t.datavisualization.Diagram.Size(2*e.size,2*e.size),d=t.datavisualization.Diagram.Util._getPortPosition(e,t.datavisualization.Diagram.Util.bounds(i,!0)),p=t.Matrix.identity(),t.Matrix.rotate(p,i.rotateAngle,i.offsetX,i.offsetY),d=t.Matrix.transform(p,d),h=(d.x-e.size)*o,c=(d.y-e.size)*o,u="rotate(0,"+(h+l.width/2)+","+(c+l.height/2)+")",s&&(s.portHighlight=!0)):(g=t.datavisualization.Diagram.Util.bounds(i,!0),l=t.datavisualization.Diagram.Size(g.width,g.height),d=t.datavisualization.Diagram.Point(g.x,g.y),h=d.x*o,c=d.y*o,_=v,v="transparent",y=2,m=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),u="rotate("+i.rotateAngle+","+m.x*o+","+m.y*o+")"),f={id:"portHighlighter","class":"ej-d-port",x:h,y:c,width:l.width*o,height:l.height*o,fill:v,stroke:_,"stroke-width":y,"pointer-events":"none",transform:u},r=a.rect(f),n.appendChild(r),r},_drawConnectorHighlighter:function(e,t,i){var a=t._adornerSvg,n=a.g({id:"connector_highlighter",visibility:"visible",transform:"scale("+i+")"});t._adornerLayer.appendChild(n);var o=this._findPath(e,t),s={id:"highlighter_segments",d:o,fill:"none",stroke:"#0dc923","stroke-width":e.lineWidth,"pointer-events":"none"},r=a.path(s);return n.appendChild(r),n},_removeConnectorHighlighter:function(e,t){var i=t.getElementById("connector_highlighter");i&&e.removeChild(i)},_removePortHighlighter:function(e,t){var i=e.getElementById("portHighlighter");i&&e.removeChild(i,t)},_renderPhaseResize:function(e,i,a,n,o){var s,r,l,d=[],h="",c=!1,u=!1,g=t.datavisualization.Diagram.Util.bounds(e);d=[],d.push({x:g.topLeft.x*a,y:g.topLeft.y*a}),d.push({x:g.bottomLeft.x*a,y:g.bottomLeft.y*a}),s=this._convertToSVGPoints(d),l={id:"w-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"},r=i.polyline(l),o.appendChild(r),d=[],d.push({x:g.topLeft.x*a,y:g.topLeft.y*a}),d.push({x:g.topRight.x*a,y:g.topRight.y*a}),s=this._convertToSVGPoints(d),l={id:"n-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"},r=i.polyline(l),o.appendChild(r),h="","vertical"==e.orientation&&(h="e-resize",u=!0),d=[],d.push({x:g.topRight.x*a,y:g.topRight.y*a}),d.push({x:g.bottomRight.x*a,y:g.bottomRight.y*a}),s=this._convertToSVGPoints(d),u&&(l={id:"e-resize-hitTest","class":h,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":u?"stroke":"none"},r=i.polyline(l),o.appendChild(r)),l={id:"e-resize","class":h,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":u?"stroke":"none"},r=i.polyline(l),o.appendChild(r),h="","horizontal"==e.orientation&&(h="s-resize",c=!0),d=[],d.push({x:g.bottomLeft.x*a,y:g.bottomLeft.y*a}),d.push({x:g.bottomRight.x*a,y:g.bottomRight.y*a}),s=this._convertToSVGPoints(d),c&&(l={id:"s-resize-hitTest","class":h,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":c?"stroke":"none"},r=i.polyline(l),o.appendChild(r)),l={id:"s-resize","class":h,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":c?"stroke":"none"},r=i.polyline(l),o.appendChild(r)},renderSelector:function(t,i,a,n,o,s,r){var l,d,h,c,u;e(".phaseSelector").remove(),l=t.width?t.width:t._width,d=t.height?t.height:t._height,t.segments?(c=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),a.appendChild(c),this._renderEndPointHandle(t,i,n)):"phase"!=t.type?t.isLane||t.isSwimlane?(c=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),a.appendChild(c),this._renderPhaseResize(t,i,n,o,c,s)):(h=this._selectorLocation(t,n,r),c=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:h}),a.appendChild(c),this._updateMultiSelectHandle(t,n,o,r),this._renderResizeHandle(t,i,n,o,r)):"phase"==t.type&&s&&(c=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+s.x*n+","+s.y*n+"),rotate(0,"+s.width/2*n+","+s.height/2*n+")"}),i.document.getElementById(i.document.id+"handle_g")||a.appendChild(c),u=i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:s.width<0?1:s.width*n,height:s.height<0?1:s.height*n,fill:"transparent",stroke:"red"}),c.appendChild(u))},_updateMultiSelectHandle:function(e,i,a,n){var o,s,r;if("pseudoGroup"===e.type&&t.datavisualization.Diagram.Util.canDragHelper(n)){var l=e.width?e.width:e._width,d=e.height?e.height:e._height,h=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY);n._svg.getElementById(n.element[0].id+"_multiselector")?(o={id:n.element[0].id+"_multiselector",width:l,height:d,transform:"rotate("+e.rotateAngle+","+h.x+","+h.y+"),translate("+(e.offsetX-l*e.pivot.x)+","+(e.offsetY-d*e.pivot.y)+")"},n._svg.rect(o)):(o={id:n.element[0].id+"_multiselector","class":"ej-d-multiselector",width:l,height:d,transform:"rotate("+e.rotateAngle+","+h.x+","+h.y+"),translate("+(e.offsetX-l*e.pivot.x)+","+(e.offsetY-d*e.pivot.y)+")",fill:"transparent",opacity:".5"},s=n._svg.getElementById(n.element[0].id+"_canvas_diagramLayer"),r=n._svg.rect(o),s.insertBefore(r,s.firstChild))}},_renderResizeHandle:function(e,i,a,n,o){var s,r,l=e.width?e.width:e._width,d=e.height?e.height:e._height,h=e.pivot?e.pivot:{x:.5,y:.5},c=t.datavisualization.Diagram.Point(l*h.x,-20/a),u="visible";if("label"!==e._type&&t.datavisualization.Diagram.Util.canShowResizeThumbs(o)){var g=t.datavisualization.Diagram.Rectangle(0,0,14,14),m=t.datavisualization.Diagram.Rectangle(l/2*a,0,14,14),p=t.datavisualization.Diagram.Rectangle(0,d/2*a,14,14);u=this._resizeHandleVisiblity(g,m,p)}n&t.datavisualization.Diagram.SelectorConstraints.Rotator&&"umlclassifier"!=e.type&&(r=0,"hidden"==u&&(r=-20),this._renderPivotLine(e,i,a,r),this._renderRotateThumb("rotateHandle",e,c.x,c.y+r,a,i)),n&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",e,i,a),"umlclassifier"!=e.type&&("label"==e._type&&(s=!(e.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable)),this._renderResizeCorner("nw-resize",e,0,0,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest),void 0,u),this._renderResizeCorner("ne-resize",e,l*a,0,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast),void 0,u),this._renderResizeCorner("sw-resize",e,0,d*a,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),void 0,u),this._renderResizeCorner("se-resize",e,l*a,d*a,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast),void 0,u),this._renderResizeCorner("n-resize",e,l/2*a,0,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth),void 0,u),this._renderResizeCorner("w-resize",e,0,d/2*a,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest),void 0,u),this._renderResizeCorner("e-resize",e,l*a,d/2*a,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast),void 0,u),this._renderResizeCorner("s-resize",e,l/2*a,d*a,i,"label"==e._type?s:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth),void 0,u)))},renderUserHandles:function(e,t,i,a,n,o,s){var r,l,d;if(t&&("phase"===t.type&&s&&(r=s._getPhaseBounds(t)),e.length))for(l=i.g({id:i.document.id+"userHandle_g","class":"userHandle","pointer-events":"visible"}),o.appendChild(l),d=0;d<e.length;d++)(a&&e[d].enableMultiSelection||!a)&&this._renderUserHandle(e[d],t,i,n,l,r,s)},_renderUserHandle:function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m,p,f,v=this._getHandlePosition(e,i,n,s,r),_=v.x*n,y=v.y*n,b=this._getHandleShape(e,_,y);e._size=e.size;var x=o.appendChild(a.circle(b)),D={id:e.name+"_title"},C=a.title(D);switch(C.innerHTML=e.name,x.appendChild(C),e.shape){case"path":d=e._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,e.size/2,e.size/2,e.pathData,a),l=this._getHandleIcon(e,_-e.size/4,y-e.size/4),l.d=d,o.appendChild(a.path(l));break;case"image":l=this._getHandleIcon(e,_-e.size/4,y-e.size/4),l.preserveAspectRatio="none",h=new Image,h.src=e.source,c=a.image(l),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),o.appendChild(c);break;case"native":u=e.visible?"visible":"hidden",l=this._getHandleIcon(e,_-e.size/4,y-e.size/4),g=r._renderEjTemplate("#"+e.templateId,e),m=document.createElement("div"),m.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+g+"</g></svg>",document.body.appendChild(m),p=document.getElementById("tempNative").cloneNode(!0),p.id=e.name+"_shape",o.appendChild(p);var s=p.getBBox(),w=l.width,z=l.height,S=s.width?w/s.width:1,P=s.height?z/s.height:1;p.setAttribute("transform","scale("+S+","+P+")"),m.parentNode.removeChild(m),f=a.g(l),f.appendChild(p),o.appendChild(f)}},_getHandleIcon:function(e,t,i){var a=e.visible?"visible":"hidden";return{id:e.name+"_icon","class":"userHandle-icon",fill:e.pathColor,transform:"translate("+t+","+i+")",visibility:a,width:e.size/2,height:e.size/2}},_getHandlePosition:function(e,i,a,n){var o,s,r;if(i&&(!i.segments||e.offset)){o=t.datavisualization.Diagram.Point(),s="phase"===i.type&&n?t.datavisualization.Diagram.Util.bounds(n):t.datavisualization.Diagram.Util.bounds(i,!0);var l=e.offset,d=e.size,h=e.margin,c=t.datavisualization.Diagram.Point(0,0),u=t.Matrix.identity();switch(t.Matrix.rotate(u,i.rotateAngle,i.offsetX,i.offsetY),e.position){case"topleft":l={x:0,y:0},h={left:-25,top:-25,bottom:0,right:0};break;case"topcenter":l={x:.5,y:0},h={left:0,top:-25,bottom:0,right:0};break;case"topright":l={x:1,y:0},h={left:0,top:-25,bottom:0,right:-25};break;case"middleleft":l={x:0,y:.5},h={left:-25,top:0,bottom:0,right:0};break;case"middleright":l={x:1,y:.5},h={left:0,top:0,bottom:0,right:-25};break;case"bottomleft":h={left:-25,top:0,bottom:-25,right:0},l={x:0,y:1};break;case"bottomcenter":l={x:.5,y:1},h={left:0,top:0,bottom:-25,right:0};break;case"bottomright":l={x:1,y:1},h={left:0,top:0,bottom:-25,right:-25}}switch(c.x+=h.left-h.right,c.y+=h.top-h.bottom,e.horizontalAlignment){case t.datavisualization.Diagram.HorizontalAlignment.Left:c.x+=d/2;break;case t.datavisualization.Diagram.HorizontalAlignment.Right:c.x-=d/2}switch(e.verticalAlignment){case t.datavisualization.Diagram.VerticalAlignment.Top:c.y+=d/2;break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:c.y-=d/2}return o.x+=s.x+s.width*l.x+c.x/a,o.y+=s.y+s.height*l.y+c.y/a,i.segments||(r=t.datavisualization.Diagram.Point(o.x,o.y),o=t.Matrix.transform(u,r)),o}},_getConnectorHandlePosition:function(e,i,a,n){var o,s=t.datavisualization.Diagram.Util._findOffsetOnConnector(i,e,e.segmentOffset,n),r=s.segment,l=s.point,d=s.offset,h=(i.segments[r],i.segments[r].points[l]),c=t.datavisualization.Diagram.Geometry.findAngle(h,i.segments[r].points[l+1]);return e.alignment&&"auto"!=e.alignment?(1==e.offset&&(c+=180),{position:t.datavisualization.Diagram.Geometry.transform(s.offset,0!=e.offset&&1!=e.offset?c+45:c,this._getAlignedPosition(i,e)),angle:c}):(o=this._avoidOverlapWithSourceAndTarget(i,e.offset,e.size,s.offset,c,r,l,n),d={position:o.position,angle:1==e.offset?(180+c)%360:c,direction:o.direction})},_getAlignedPosition:function(e,t){var i=void 0===t.text?10:0;switch(t.alignment){case"center":return 0;case"before":return-((t.size||0)/2+i);case"after":return(t.size||0)/2+i}return 0},_avoidOverlapWithSourceAndTarget:function(e,i,a,n,o,s,r,l){var d,h,c,u,g,m=n,p=(e.segments[s],90);if(0==i?(d=e.segments[s].points[r+2]?e.segments[s].points[r+2]:e.segments[s+1]?e.segments[s+1].points[1]:null,d&&(h=t.datavisualization.Diagram.Geometry.findAngle(e.segments[s].points[r],d)),e.sourceNode&&(p=45)):1==i&&(d=e.segments[s].points[r-1]?e.segments[s].points[r-1]:e.segments[s-1]?e.segments[s-1][e.segments[s].points.length-2]:null,d&&(h=t.datavisualization.Diagram.Geometry.findAngle(e.segments[s].points[r+1],d)),o+=180,o%=360,e.targetNode&&(p=45)),d)if(o%90==0)h>270&&0==o&&(o=360),90==o?o>h?(o+=p,c="right"):(o-=p,c="left"):270==o?o>h?(o+=p,c="left"):(o-=p,c="right"):180==o?o>h?(o+=p,c="bottom"):(o-=p,c="top"):o>h?(o+=p,c="top"):(o-=p,c="bottom"),m=t.datavisualization.Diagram.Geometry.transform(m,o,void 0!=a?Math.max(5,a/2+10):0);else{var f,v=45,_=135,y=225,b=315;(0==i&&e.sourceNode||1==i&&e.targetNode)&&(u=0==i&&e.sourceNode?l.nameTable[e.sourceNode]:l.nameTable[e.targetNode],u&&(f=t.datavisualization.Diagram.Util.bounds(u)),f&&(g=180/(2+2/(f.height/f.width)),v=g,_=180-g,y=_+2*g,b=360-g)),p=o>=v&&_>=o||o>=y&&b>=o?o%180>90?-p:p:o>_&&y>o?o>180?-45:45:o>0?-45:45,m=t.datavisualization.Diagram.Geometry.transform(m,o+p,void 0!=a?Math.max(5,a/2+10):0)}else{var f,v=45,_=135,y=225,b=315;(0==i&&e.sourceNode||1==i&&e.targetNode)&&(u=0==i&&e.sourceNode?l.nameTable[e.sourceNode]:l.nameTable[e.targetNode],u&&(f=t.datavisualization.Diagram.Util.bounds(u)),f&&(g=180/(2+2/(f.height/f.width)),v=g,_=180-g,y=_+2*g,b=360-g)),p=o>=v&&_>=o||o>=y&&b>=o?o%180>90?-p:p:o>_&&y>o?o>180?-45:45:v>=o?-45:45,o+=360,o%=360,
m=t.datavisualization.Diagram.Geometry.transform(m,o+p,void 0!=a?Math.max(5,a/2+(Math.abs(p%45)>0?13:10)):0)}return{position:m,direction:c}},_getHandleShape:function(e,t,i){var a=e.visible?"visible":"hidden";return{id:e.name+"_shape","class":"userHandle",cx:t,cy:i,r:e.size/2,fill:e.backgroundColor,stroke:e.borderColor,"stroke-width":e.borderWidth||0,visibility:a}},_updateHandleShape:function(e,t,i,a){var n=e.visible?"visible":"hidden",o={id:e.name+"_shape",cx:t,cy:i,r:e.size/2,fill:e.backgroundColor,stroke:e.borderColor,"stroke-width":e.borderWidth||0,visibility:n};a.circle(o)},_updateHanleIcon:function(e,t,i,a,n){var o=e.visible?"visible":"hidden",s={id:e.name+"_icon",d:t,fill:e.pathColor,transform:"translate("+a+","+n+")",visibility:o};i.path(s)},_getHanleIcon:function(e,t){return{id:e.name,d:t,stroke:e.borderColor,"stroke-width":e.borderWidth,fill:e.fillColor}},renderPivotPoint:function(e,i,a,n,o,s){var r=e.width*(e.pivot?e.pivot.x:.5),l=e.height*(e.pivot?e.pivot.y:.5),d="visible";if(t.datavisualization.Diagram.Util.canShowResizeThumbs(s)){var h=e.width?e.width:e._width,c=e.height?e.height:e._height,u=t.datavisualization.Diagram.Rectangle(0,0,14,14),g=t.datavisualization.Diagram.Rectangle(h/2*i,0,14,14),m=t.datavisualization.Diagram.Rectangle(0,c/2*i,14,14);d=this._resizeHandleVisiblity(u,g,m)}a.getElementById("pivot")?t.datavisualization.Diagram.SvgContext._updateResizeCorner("pivot",r*i,l*i,a,d,n,o,s,void 0):t.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",e,r*i,l*i,a,void 0,4,d),this._updatePivotLine(e,a,i,!0)},_removePivotPoint:function(e,t,i){var a=t.getElementById("pivot");a&&(a.parentNode.removeChild(a),this._updatePivotLine(e,t,i,!1))},_renderPivotLine:function(e,i,a,n){if(!e.container){var o=e.width?e.width:e._width,s=(e.height?e.height:e._height,e.pivot?e.pivot:{x:.5,y:.5}),r=t.datavisualization.Diagram.Point(o*s.x,-20/a);n&&(r.y+=n);var l=t.datavisualization.Diagram.Point(o*s.x,0),d=i.getElementById(i.document.id+"handle_g"),h=i.line({id:"pivotLine",x1:r.x*a,y1:r.y*a,x2:l.x*a,y2:l.y*a,stroke:"label"==e._type?"red":"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});d.appendChild(h)}},_renderResizeBorder:function(e,i,a,n){var o,s=a.getElementById(a.document.id+"handle_g"),r=i.width?i.width:i._width,l=i.height?i.height:i._height;o="umlclassifier"==i.type?t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(e,i,a,n):a.rect({id:e,"class":"resizeRect",width:r*n,height:l*n,stroke:"label"==i._type?"red":"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none","pointer-events":"none"}),s.appendChild(o)},_renderResizeCorner:function(e,i,a,n,o,s,r,l){var d,h,c=o.getElementById(o.document.id+"handle_g"),u="white";t.datavisualization.Diagram.Util.canResize(i)||(u="darkgray"),s&&(u="darkgray",d="none"),h={id:e,"class":"resizeCorners",fill:u,stroke:"label"==i._type?"#097F7F":"black","stroke-width":1,cx:a,cy:n,r:r||7,visibility:l},h=this._setPadding(h),c.appendChild(o.circle(h)),h={id:e+"_transparent","class":e,fill:"transparent",cx:h.cx,cy:h.cy,r:r||10,visibility:h.visibility},d&&(h["pointer-events"]=d),c.appendChild(o.circle(h))},_setPadding:function(e){if(("n-resize"===e.id||"w-resize"===e.id||"e-resize"===e.id||"s-resize"===e.id)&&"hidden"===e.visibility){var t=20;"n-resize"===e.id&&(e.cy=e.cy-t),"w-resize"===e.id&&(e.cx=e.cx-t),"e-resize"===e.id&&(e.cx=e.cx+t),"s-resize"===e.id&&(e.cy=e.cy+t),e.visibility="visible"}return e},_renderRotateThumb:function(e,i,a,n,o,s){if(!i.container){var r=s.getElementById(s.document.id+"handle_g"),l="#231f20";t.datavisualization.Diagram.Util.canRotate(i)||(l="darkgray");var d=20,h=20,c={id:"rotatehandle","class":e,fill:l,stroke:"black","stroke-width":.5,width:d,height:h,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(a*o-d/2)+","+(n*o-h)+")"},u=s.path(c),g=s.circle({id:"rotate","class":e,fill:"transparent",stroke:"none",cx:d/2,cy:h/2,r:13,transform:"translate("+(a*o-d/2)+","+(n*o-h)+")"});r.appendChild(u),r.appendChild(g)}},_refreshEndPointHandles:function(e,t,i){var a,n,o;if(e&&e.segments){if(a=t.getElementById(t.document.id+"handle_g"),a&&a.childNodes.length>0)for(n=a.childNodes.length-1;n>=0;n--)o=a.childNodes[n],"sourceEndPoint"!==o.id&&"targetEndPoint"!==o.id&&o.parentNode.removeChild(o);this._renderEndPointHandle(e,t,i)}},_renderEndPointHandle:function(e,i,a){var n,o,s,r;if(!e.isPhase)for(n=t.datavisualization.Diagram.Util.canDragSegmentThumbs(e),o=0;o<e.segments.length;o++)s=e.segments[o],"bezier"==s.type&&(this._renderBezierLine("bezierline1_"+o,s._startPoint,s._point1,a,i,n),this._renderBezierLine("bezierline2_"+o,s._endPoint,s._point2,a,i,n),this._renderEndPointCorner("bezierpoint1_"+o,s._point1.x*a,s._point1.y*a,!1,i,n),this._renderEndPointCorner("bezierpoint2_"+o,s._point2.x*a,s._point2.y*a,!1,i,n)),r=s.points,0==o&&this._renderEndPointCorner("sourceEndPoint",s._startPoint.x*a,s._startPoint.y*a,t.datavisualization.Diagram.Util.isSourceConnected(e),i,t.datavisualization.Diagram.Util.canDragSourceEnd(e)),o==e.segments.length-1?(this._renderEndPointCorner("targetEndPoint",s._endPoint.x*a,s._endPoint.y*a,t.datavisualization.Diagram.Util.isTargetConnected(e),i,t.datavisualization.Diagram.Util.canDragTargetEnd(e)),"orthogonal"==s.type&&this._renderTerminalOrthoThumbs(s,i,a,o,n)):"orthogonal"!=s.type?this._renderSegmentEndThumb("segmentEnd_"+o,s._endPoint.x*a,s._endPoint.y*a,t.datavisualization.Diagram.Util.isSourceConnected(e),i,t.datavisualization.Diagram.Util.canDragSourceEnd(e)):this._renderTerminalOrthoThumbs(s,i,a,o,n)},_renderTerminalOrthoThumbs:function(e,i,a,n,o){var s,r,l,d;if(e.points.length>2)for(r=0;r<e.points.length-1;r++)d=t.datavisualization.Diagram.Geometry.distance(e.points[r],e.points[r+1]),s=e.points[r].y.toFixed(2)==e.points[r+1].y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+r+"_"+n,(e.points[r].x+e.points[r+1].x)/2*a,(e.points[r].y+e.points[r+1].y)/2*a,i,l,s,o);else d=e.length||t.datavisualization.Diagram.Geometry.distance(e._startPoint,e._endPoint),l=d>=50?"visible":"hidden",s=e._startPoint.y.toFixed(2)==e._endPoint.y.toFixed(2)?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+n,(e._endPoint.x+e._startPoint.x)/2*a,(e._endPoint.y+e._startPoint.y)/2*a,i,l,s,o)},_renderEndPointCorner:function(e,t,i,a,n,o){var s,r=n.getElementById(n.document.id+"handle_g"),l=a?"#8CC63F":"white";o||(l="darkgray"),s={id:e,"class":e,opacity:.75,fill:l,stroke:"black","stroke-width":2,cx:t,cy:i,r:7},n.getElementById(e)?n.circle(s):r.appendChild(n.circle(s))},_renderSegmentEndThumb:function(e,t,i,a,n,o){var s,r=n.getElementById(n.document.id+"handle_g"),l="#e2e2e2";o||(l="darkgray"),s={id:e,"class":"segmentEnd",fill:l,stroke:"black","stroke-width":2,cx:t,cy:i,r:5},r.appendChild(n.circle(s))},_renderOrthogonalThumb:function(e,t,i,a,n,o,s){var r,l,d,h,c,u;"horizontal"==o?(r="M0,7 L15,0 L30,7 L15,14 z",l=-15,d=-7):(r="M7,0 L0,15 L7,30 L14,15 z",l=-7,d=-15),h=a.getElementById(a.document.id+"handle_g"),c="#e2e2e2",s||(c="darkgray"),u={id:e,"class":"segmentEnd",fill:c,stroke:"black","stroke-width":1,d:r,transform:"translate("+(t+l)+","+(i+d)+")",visibility:n},h.appendChild(a.path(u))},_renderBezierLine:function(e,t,i,a,n){var o=n.line({id:e,x1:t.x*a,y1:t.y*a,x2:i.x*a,y2:i.y*a,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"}),s=n.getElementById(n.document.id+"handle_g");s.appendChild(o)},_renderControlPointCorner:function(e,t,i,a){var n,o=a.g({"class":e});a.getElementById(a.document.id+"handle_g").appendChild(o),n={id:e+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:t.x,cy:t.y,r:5},o.appendChild(a.circle(n))},_selectorLocation:function(e,i,a){var n,o,s,r=e.width,l=e.height;return"label"!==e._type?n="translate("+(e.offsetX-r*e.pivot.x)*i+","+(e.offsetY-l*e.pivot.y)*i+"),rotate("+e.rotateAngle+","+r*e.pivot.x*i+","+l*e.pivot.y*i+")":(o=a.findNode(e._parent),l=l?l:o.height,s=a.activeTool._findLabelAtNode(o,e),o.segments?o.segments&&"segmentpath"!==e.relativeMode?n="translate("+s.x*i+","+s.y*i+"),rotate("+e.rotateAngle+","+r/2*i+","+l/2*i+")":(s=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(e,o,i,a),s.position.x=s.position.x+e.margin.left-e.margin.right,s.position.y=s.position.y+e.margin.top-e.margin.bottom,n="translate("+(s.position.x-r/2)*i+","+(s.position.y-l/2)*i+"),rotate("+s.angle+","+r/2*i+","+l/2*i+"),rotate("+e.rotateAngle+","+r/2*i+","+l/2*i+")"):n="translate("+s.x*i+","+s.y*i+"),rotate("+o.rotateAngle+"),rotate("+e.rotateAngle+","+r/2*i+","+l/2*i+")"),n},updateSelector:function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m,p,f;if(e)if(l=e.width?e.width:e._width,d=e.height?e.height:e._height,e.segments)this._updateEndPointHandle(e,i,a),o&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(n.model.selectedItems.userHandles,e,i,!1,!1,a,n);else if("phase"===e.type)c=n._getPhaseBounds(e),i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+c.x*a+","+c.y*a+"),rotate(0,"+c.width/2*a+","+c.height/2*a+")"}),i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:c.width<0?1:c.width*a,height:c.height<0?1:c.height*a,fill:"transparent",stroke:"red"});else{if(e.isSwimlane||e.isLane||(h=this._selectorLocation(e,a,n),u=i.g({id:i.document.id+"handle_g",transform:h})),t.datavisualization.Diagram.Util.canShowResizeThumbs(n)){var v=i.document.parentNode.getElementsByClassName("resizeCorners"),_=i.document.getElementById("rotatehandle"),y=r?"hidden":"visible";for(g=0;g<v.length;g++)v[g].setAttribute("visibility",y);null!=_&&(m=i.document.getElementById("pivotLine"),_.setAttribute("visibility",y),m.setAttribute("visibility",y))}if(p=n.getObjectType(e),"group"!==p&&"pseudoGroup"!==e.type&&("move"==n.activeTool.name||"rotate"==n.activeTool.name||"labelMove"==n.activeTool.name||"labelRotate"==n.activeTool.name)&&n.activeTool.inAction||(this._updateMultiSelectHandle(e,a,o,n),this._updateResizeHandle(e,i,a,o,s,r,n)),("rotatetool"==n.activeTool.name||"labelRotate"==n.activeTool.name)&&n.activeTool.inAction&&this.renderPivotPoint(e,a,i,s,r,n),n.model.selectedItems.userHandles&&n.model.selectedItems.userHandles.length>0&&(f=!1,n.selectionList[0]&&"multipleSelection"==n.selectionList[0].name&&(f=!0),o&t.datavisualization.Diagram.SelectorConstraints.UserHandles))return this.updateUserHandles(n.model.selectedItems.userHandles,e,i,f,!1,a,n),!0}},_updatePhaseResize:function(e,i,a){var n,o,s=[],r=t.datavisualization.Diagram.Util.bounds(e);s=[],s.push({x:r.topLeft.x*a,y:r.topLeft.y*a}),s.push({x:r.bottomLeft.x*a,y:r.bottomLeft.y*a}),n=this._convertToSVGPoints(s),o={id:"w-resize",points:n},i.polyline(o),s=[],s.push({x:r.topLeft.x*a,y:r.topLeft.y*a}),s.push({x:r.topRight.x*a,y:r.topRight.y*a}),n=this._convertToSVGPoints(s),o={id:"n-resize",points:n},i.polyline(o),s=[],s.push({x:r.topRight.x*a,y:r.topRight.y*a}),s.push({x:r.bottomRight.x*a,y:r.bottomRight.y*a}),n=this._convertToSVGPoints(s),o={id:"e-resize-hitTest",points:n},i.polyline(o),o={id:"e-resize",points:n},i.polyline(o),s=[],s.push({x:r.bottomLeft.x*a,y:r.bottomLeft.y*a}),s.push({x:r.bottomRight.x*a,y:r.bottomRight.y*a}),n=this._convertToSVGPoints(s),o={id:"s-resize-hitTest",points:n},i.polyline(o),o={id:"s-resize",points:n},i.polyline(o)},_updateResizeHandle:function(e,i,a,n,o,s,r){var l,d;if(e.isSwimlane||e.isLane)this._updatePhaseResize(e,i,a,n);else{var h,c=e.width?e.width:e._width,u=e.height?e.height:e._height,g=e.pivot?e.pivot:{x:.5,y:.5},m=(e._corners,"visible");if(t.datavisualization.Diagram.Util.canShowResizeThumbs(r)){var p=t.datavisualization.Diagram.Rectangle(0,0,14,14),f=t.datavisualization.Diagram.Rectangle(c/2*a,0,14,14),v=t.datavisualization.Diagram.Rectangle(0,u/2*a,14,14);m=this._resizeHandleVisiblity(p,f,v)}l=t.datavisualization.Diagram.Point(c*g.x,-20/a),n&t.datavisualization.Diagram.SelectorConstraints.Rotator&&"umlclassifier"!=e.type&&(d=0,"hidden"==m&&(d=-20),this._updateRotateHandle("rotate",l.x,l.y+d,a,i,e),this._updatePivotLine(e,i,a,void 0,d)),n&t.datavisualization.Diagram.SelectorConstraints.Resizer&&("umlclassifier"!=e.type&&("label"==e._type&&(h=!(e.constraints&t.datavisualization.Diagram.LabelConstraints.Resizable)),this._updateResizeCorner("nw-resize",0,0,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._updateResizeCorner("n-resize",c/2*a,0,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._updateResizeCorner("ne-resize",c*a,0,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._updateResizeCorner("w-resize",0,u/2*a,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._updateResizeCorner("e-resize",c*a,u/2*a,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._updateResizeCorner("sw-resize",0,u*a,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._updateResizeCorner("s-resize",c/2*a,u*a,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._updateResizeCorner("se-resize",c*a,u*a,i,m,o,s,r,"label"==e._type?h:!(e.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast))),this._updateResizeBorder("resizeBorder",e,i,a))}},_resizeHandleVisiblity:function(e,i,a){var n=t.datavisualization.Diagram.Geometry.intersectsRect(e,i),o=t.datavisualization.Diagram.Geometry.intersectsRect(e,a),s="visible";return(n===!0||o===!0)&&(s="hidden"),s},_updateRotateHandle:function(e,t,i,a,n){var o=20,s=20,r={id:"rotatehandle",transform:"translate("+(t*a-o/2)+","+(i*a-s)+")"};n.path(r),n.circle({id:"rotate",transform:"translate("+(t*a-o/2)+","+(i*a-s)+")"})},_updatePivotLine:function(e,i,a,n,o){var s,r,l=e.width?e.width:e._width,d=e.height?e.height:e._height,h=e.pivot?e.pivot:{x:.5,y:.5},c=t.datavisualization.Diagram.Point(l*h.x,-20/a);o&&(c.y+=o),s=n?t.datavisualization.Diagram.Point(l*h.x,d*h.y):t.datavisualization.Diagram.Point(l*h.x,0),r=i.line({id:"pivotLine",x1:c.x*a,y1:c.y*a,x2:s.x*a,y2:s.y*a})},_updateResizeBorder:function(e,i,a,n){var o,s=i.width?i.width:i._width,r=i.height?i.height:i._height;"umlclassifier"==i.type?o=t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(e,i,a,n):a.rect({id:e,width:s*n,height:r*n})},_updateResizeCorner:function(e,i,a,n,o,s,r,l,d){var h={id:e,cx:i,cy:a,visibility:o};h=this._setPadding(h),t.datavisualization.Diagram.Util.canShowResizeThumbs(l)&&(r&&s!=e?h.visibility="hidden":("visible"==h.visibility||r)&&(h.visibility="visible")),n.circle(h),h={id:e+"_transparent",cx:h.cx,cy:h.cy,visibility:h.visibility},h["pointer-events"]="hidden"===h.visibility||d?"none":"all",n.circle(h)},_updateEndPointHandle:function(e,i,a){for(var n,o,s=t.datavisualization.Diagram.Util.canDragSegmentThumbs(e),r=0;r<e.segments.length;r++)n=e.segments[r],o=n.points,r==e.segments.length-1?(this._updateEndPointCorner("targetEndPoint",o[o.length-1].x*a,o[o.length-1].y*a,t.datavisualization.Diagram.Util.isTargetConnected(e),i,t.datavisualization.Diagram.Util.canDragTargetEnd(e)),"orthogonal"==n.type&&this._updateTerminalOrthoThumbs(n,i,a,r,s)):"orthogonal"!=n.type?this._updateSegmentEndThumb("segmentEnd_"+r,n._endPoint.x*a,n._endPoint.y*a,t.datavisualization.Diagram.Util.isSourceConnected(e),i,t.datavisualization.Diagram.Util.canDragSourceEnd(e)):this._updateTerminalOrthoThumbs(n,i,a,r,s),0==r&&this._updateEndPointCorner("sourceEndPoint",o[0].x*a,o[0].y*a,t.datavisualization.Diagram.Util.isSourceConnected(e),i,t.datavisualization.Diagram.Util.canDragSourceEnd(e)),"bezier"==n.type&&(this._updateEndPointCorner("bezierpoint1_"+r,n._point1.x*a,n._point1.y*a,!1,i,s),this._updateEndPointCorner("bezierpoint2_"+r,n._point2.x*a,n._point2.y*a,!1,i,s),this._updateBezierLine("bezierline1_"+r,n._startPoint,n._point1,a,i),this._updateBezierLine("bezierline2_"+r,n._endPoint,n._point2,a,i))},_updateEndPointCorner:function(e,t,i,a,n,o){var s,r=a?"#8CC63F":"white";o||(r="darkgray"),s={id:e,fill:r,cx:t,cy:i},n.circle(s)},_updateSegmentEndThumb:function(e,t,i,a,n){var o={id:e,cx:t,cy:i};n.circle(o)},_updateOrthoThumb:function(e,t,i,a,n,o,s){var r,l,d,h,c="#e2e2e2";s||(c="darkgray"),"horizontal"==o?(r="M0,7 L15,0 L30,7 L15,14 z",l=-15,d=-7):(r="M7,0 L0,15 L7,30 L14,15 z",l=-7,d=-15),h={id:e,visibility:n,transform:"translate("+(t+l)+","+(i+d)+")",d:r,fill:c},a.path(h)},_updateTerminalOrthoThumbs:function(e,i,a,n,o){var s,r,l,d;if(e.points.length>2)for(r=0;r<e.points.length-1;r++)d=t.datavisualization.Diagram.Geometry.distance(e.points[r],e.points[r+1]),s=e.points[r].y.toFixed(2)==e.points[r+1].y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+r+"_"+n,(e.points[r].x+e.points[r+1].x)/2*a,(e.points[r].y+e.points[r+1].y)/2*a,i,l,s,o);else d=e.length||t.datavisualization.Diagram.Geometry.distance(e._startPoint,e._endPoint),s=e._startPoint.y.toFixed(2)==e._endPoint.y.toFixed(2)?"horizontal":"vertical",l=d>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+n,(e._endPoint.x+e._startPoint.x)/2*a,(e._endPoint.y+e._startPoint.y)/2*a,i,l,s,o)},_updateBezierLine:function(e,t,i,a,n){n.line({id:e,x1:t.x*a,y1:t.y*a,x2:i.x*a,y2:i.y*a})},_updateControlPointCorner:function(e,t,i,a){a.circle({id:e+"_"+i,cx:t.x,cy:t.y})},updateUserHandles:function(e,i,a,n,o,s,r){var l,d=a.document.getElementById(a.document.id+"userHandle_g");if(r.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles)if(d){if(e&&e.length>0)for(l=0;l<e.length;l++)(n&&e[l].enableMultiSelection||!n)&&this._updateHandle(e[l],i,a,o,s,r)}else this.renderUserHandles(e,i,a,n,s,r._adornerLayer,r)},_updateHandle:function(e,i,a,n,o,s){var r,l,d,h;!n&&i&&e.visible?(r=this._getHandlePosition(e,i,o,null,s),l=e._absolutePath,l&&e.size==e._size||(l=e._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,e.size/2,e.size/2,e.pathData,a)),e._size=e._size,d=r.x*o,h=r.y*o,this._updateHandleShape(e,d,h,a),this._updateHanleIcon(e,l,a,d-e.size/4,h-e.size/4),a.getElementById(e.name+"_shape")&&e.visible&&(a.getElementById(e.name+"_shape").style.display="block",a.getElementById(e.name+"_icon").style.display="block")):a.getElementById(e.name+"_shape")&&(a.getElementById(e.name+"_shape").style.display="none",a.getElementById(e.name+"_icon").style.display="none")},clearSelector:function(e,t,i){var a=e.getElementById(e.document.id+"handle_g");a&&t.removeChild(a),a=e.getElementById(e.document.id+"userHandle_g"),a&&t.removeChild(a),i&&(a=i._svg.getElementById(i.element[0].id+"_multiselector"),a&&a.parentNode.removeChild(a))},clearSegments:function(t){var i=t.getElementById(t.document.id+"handle_g");e(i).find(".segmentEnd").remove()},addSegments:function(e,t,i){e.getElementById(e.document.id+"handle_g");this._renderSegmentHandle(t,e,i)},_renderSegmentHandle:function(e,i,a){var n,o,s,r;if(!e.isPhase)for(n=t.datavisualization.Diagram.Util.canDragSegmentThumbs(e),o=0;o<e.segments.length;o++)s=e.segments[o],"bezier"==s.type&&(this._renderBezierLine("bezierline1_"+o,s._startPoint,s._point1,a,i,n),this._renderBezierLine("bezierline2_"+o,s._endPoint,s._point2,a,i,n),this._renderEndPointCorner("bezierpoint1_"+o,s._point1.x*a,s._point1.y*a,!1,i,n),this._renderEndPointCorner("bezierpoint2_"+o,s._point2.x*a,s._point2.y*a,!1,i,n)),r=s.points,0===o||o===e.segments.length-1||("orthogonal"!=s.type?this._renderSegmentEndThumb("segmentEnd_"+o,s._endPoint.x*a,s._endPoint.y*a,t.datavisualization.Diagram.Util.isSourceConnected(e),i,t.datavisualization.Diagram.Util.canDragSourceEnd(e)):this._renderTerminalOrthoThumbs(s,i,a,o,n))},_initializePageBreaks:function(e,t,i){var a=e.g(t);return i.appendChild(a),a},_renderVPageBreakLine:function(e,t,i,a){var n=i.line({x1:e.x,y1:e.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});a.appendChild(n)},_renderPageSettingsRect:function(e,t,i,a,n,o,s){var r=i.rect({id:"pageback",x:e.x,y:e.y,width:t.x,height:t.y,style:"fill:"+o+";stroke:"+n+";stroke-width:"+s});a.appendChild(r)},_updatePageBakground:function(e,i,a,n,o,s,r){var l=a.document.getElementById("pageback"),d={x:e.x,y:e.y,width:i.x<0?0:i.x,height:i.y<0?0:i.y,style:"fill:"+s+";stroke:"+o+";stroke-width:"+r};l&&t.datavisualization.Diagram.Util.attr(l,d)},_renderHPageBreakLine:function(e,t,i,a){var n=i.line({x1:e.x,y1:e.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});a.appendChild(n)},_removePageBreaks:function(e,t,i){null!=t&&null!=i&&i.removeChild(t)},removeChild:function(e,t){var i,a,n=t.svg.document.getElementById(e.name),o=t.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=this._findChild(o.childNodes,e),r=t.svg.document.parentNode.getElementsByClassName("AdornerLayer")[0];r&&(i=r.parentNode.getElementById(e.name+"_ej_ports")),n&&n.parentNode.removeChild(n),i&&i.parentNode.removeChild(i),s&&o.removeChild(s),"node"===e._type&&"html"===e.type&&(a=o.children[e.name+"_parentdiv"],a&&a.parentNode&&a.parentNode.removeChild(a))}},t.datavisualization.Diagram.DiagramContext={_renderNodes:function(e,t,i,a){var n,o,s,r,l;if(a.nodes())for(n=a.nodes(),o=0,s=n.length;s>o;++o)r=a.nameTable[n[o].name],l=e.svg||e._canvas,this._renderNodeObject(r,e,t,i,a)},_renderNodeObject:function(e,i,a,n,o){var s=i.svg||i._canvas;"group"!==e._type||e.parent?e.parent||i.context.renderNode(e,s,i.diagramLayer,null,o):(!e.container,i.context.renderGroup(e,s,i.diagramLayer,o.nameTable,o,a,n),t.datavisualization.Diagram.DiagramContext.update(e,o))},_renderConnectors:function(e,t){var i,a,n,o,s;if(t.connectors()){for(i=t.connectors(),a=e.svg||e._canvas,o=0,s=i.length;s>o;++o)n=i[o],t._setZorder(n);for(o=0,s=i.length;s>o;++o)n=i[o],this._renderConnectorObject(n,e,t)}},_renderConnectorObject:function(e,i,a){var n=i.svg||i._canvas;t.datavisualization.Diagram.Util.updateBridging(e,a),e.parent||i.context.renderConnector(e,n,i.diagramLayer,a)},updateViewPort:function(e){var i;e._svgParentDimention=null,e._views.forEach(function(a){i=e._views[a],i.context==t.datavisualization.Diagram.SvgContext&&"mainview"==i.type&&t.datavisualization.Diagram.PageUtil._updatePageSize(e)})},renderNode:function(e,t,i){var a,n;t._views.forEach(function(o){a=t._views[o],n=a.svg||a._canvas,i&&(i=n.document.getElementById(i.id));var s="overview"==a.type;a.context.renderNode(e,n,i||a.diagramLayer,void 0,t,s)})},addLabel:function(e,t,i,a){var n,o;i._views&&i._views.forEach(function(s){n=i._views[s],o=n.svg||n.canvas,n.context._addLabel(e,t,o,i,a)})},renderPort:function(e,t,i,a){var n,o,s;i._views.forEach(function(r){n=i._views[r],s="overview"===n.type,o=n.svg||n._canvas,n.context._insertPort(e,t,s?o:i._adornerSvg,a,i,s)})},renderConnector:function(e,t,i){var a,n;t._views.forEach(function(o){a=t._views[o],n=a.svg||a._canvas,a.context.renderConnector(e,n,i||a.diagramLayer,t)})},renderGroup:function(e,t,i){var a,n;t._views.forEach(function(o){var s;a=t._views[o],n=a.svg||a._canvas,i=a.svg.getElementById(e.parent),"overview"==a.type&&(s=!0),a.context.renderGroup(e,n,i||a.diagramLayer,t.nameTable,t,null,s)})},update:function(e,t,i){var a,n,o=!0;e.isSwimlane&&t._disableSwimlaneUptate&&(o=!1),o&&t._views.forEach(function(o){var s,r;a=t._views[o],n=a.svg||a._canvas,t&&!t._isInit&&"new"!==e._status&&(e._status="update"),s="overview"==a.type,"group"===e._type||"pseudoGroup"===e.type?a.context.updateGroup(e,n,t,i,s):e.segments?a.context.updateConnector(e,n,t):"label"==e._type?(r=t.findNode(e._parent),a.context.updateLabel(r,e,n,t)):a.context.updateNode(e,n,t,i,s)})},_refreshSegments:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,e.segments&&i.context._refreshSegments(e,a,t)})},_refreshOnlySegments:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,e.segments&&i.context._refreshOnlySegments(e,a,t)})},renderShadow:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i._canvas,i.context._renderShadow(e,a)})},updateShadow:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i._canvas,i.context._updateShadow(e,a)})},removeShadow:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i._canvas,i.context._removeShadow(e,a)})},addNodeLabel:function(e,t,i,a){var n,o;a._views&&a._views.forEach(function(s){n=a._views[s],o=n.svg||n.canvas,n.context.addNodeLabel(e,t,o,i,a)})},updateLabel:function(e,i,a){var n,o;a._views.forEach(function(s){n=a._views[s],o=n.svg||n.canvas,a.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?n.context._updateSVGLabel(e,i,o,a):n.context.updateLabel(e,i,o,a)})},updatePort:function(e,t,i){var a,n;i._views.forEach(function(o){a=i._views[o];var s="overview"===a.type;n=s?a.svg||a.canvas:i._adornerSvg,a.context.updatePort(e,t,n,i)})},setLabelTemplate:function(e,t,i){var a,n;i._views.forEach(function(o){a=i._views[o],n=a.svg||a.canvas,a.context._updateLabelTemplate(e,t,n,i)})},setNodeShape:function(e,t,i){var a,n;t._views.forEach(function(o){a=t._views[o],n=a.svg||a.canvas,a.context.setNodeShape(e,n,i,t)})},setLine:function(e,t,i){var a,n;t._views.forEach(function(o){a=t._views[o],n=a.svg||a.canvas,a.context.setLine(e,n,i,t)})},renderDecorators:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context.renderDecorators(e,a,t)})},clearDecorators:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context.clearDecorators(e,a,t)})},updateTargetDecoratorStyle:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context.updateTargetDecoratorStyle(e,a)})},updateSourceDecoratorStyle:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context.updateSourceDecoratorStyle(e,a)})},updateNodeStyle:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context._updateNodeStyle(e,a)})},updateLabelStyle:function(e,t,i){i._views.forEach(function(a){var n=i._views[a],o=n.svg||n.canvas;n.context.updateLabelStyle(e,t,o,i)})},updateConnectorStyle:function(e,t){var i,a;t._views.forEach(function(n){i=t._views[n],a=i.svg||i.canvas,i.context._updateConnectorStyle(e,a)})},updateTextBlock:function(e,t,i){var a,n;i._views.forEach(function(o){a=i._views[o],n=a.svg||a.canvas,a.context.updateTextBlock(e,t,n,i)})},updateBPMNNodeStyle:function(e,i){var a,n,o=0;if(e=t.datavisualization.Diagram.Util._updateBpmnChild(e,i),e.children)for(n=i._getChildren(e.children),o=0;o<n.length;o++)a=i.nameTable[n[o]],t.datavisualization.Diagram.DiagramContext.updateNodeStyle(a,i,e);else t.datavisualization.Diagram.DiagramContext.updateNodeStyle(e,i)},updateBPMNNodeShape:function(e,i){var a,n,o,s=0;if(e=t.datavisualization.Diagram.Util._updateBpmnChild(e,i),n=i._getChildren(e.children),n.length>0&&i.nameTable[n[0]])for(s=0;s<n.length;s++)a=i.nameTable[n[s]],a&&t.datavisualization.Diagram.DiagramContext.setNodeShape(a,i,e);else o=i._svg.getElementById(e.name),o.parentNode.removeChild(o),i.add(e)}}}(jQuery,Syncfusion),function(e,t,i){"use strict";t.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,_requiresID:!0,validTags:["div"],nameTable:{},defaults:{width:"250px",height:"400px",labelRenderingMode:"html",paletteItemWidth:i,paletteItemHeight:i,previewWidth:i,previewHeight:i,previewOffset:{x:110,y:110},diagramId:"",headerHeight:30,selectedPaletteName:"",cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[],defaultSettings:{connector:null,node:null},selectionChange:null,create:null,destroy:null},_oldItem:null,_labelHashTable:{},dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){"msie"===t.browserInfo().name&&Number(t.browserInfo().version)<9||(this.nameTable={},this.selectedItem=null,this.activePalette=null,this._selectedElement=null,this._renderSymbolPalette(),this._wireEvents(),this.updateScrollerViewport())},_setModel:function(t){var i,a;for(i in t)switch(i){case"width":this._setWidth(t[i]);break;case"height":this._setHeight(t[i]);break;case"paletteItemWidth":this.model.paletteItemWidth=t[i],this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=t[i],this._redrawContent();break;case"headerHeight":this._setHeaderHeight(t[i]);break;case"cssClass":this._setCssClass(t[i]);break;case"showPaletteItemText":this._showItemText(t[i]);break;case"allowDrag":this._setAllowDrag(t[i]);break;case"palettes":this._updatePalettes(t[i]);break;case"selectedPaletteName":a=this._getPalette(t.selectedPaletteName),a&&a!==this.activePalette&&(e(this._getPaletteHeaderDiv(this.activePalette.name)).removeClass("selected"),this.activePalette=a,e(this._getPaletteHeaderDiv(this.activePalette.name)).addClass("selected"))}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){this._canvas=document.createElement("div"),this._canvas.setAttribute("class","e-scanvas"),this._canvas.setAttribute("id",this.element[0].id+"_canvas"),this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";"),this.element.append(this._canvas),this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight(),enableTouchScroll:!1}),this._renderPalettes()},_updatePalettes:function(t){this.model.palettes=t,e("#"+this.element[0].id+"_canvas").empty(),this._renderPalettes(),this.updateScrollerViewport()},_renderPalettes:function(){var e,i,a=this.model.palettes;if(a)for(e=0,i=a.length;i>e;e++)a[e]=t.datavisualization.Diagram.Palette(a[e]),this._initPaletteitems(a[e]),this._renderPalette(a[e])},_updatePaletteItemWidth:function(e){var i=t.datavisualization.Diagram.Util.bounds(e);e.segments?i.width>this.element.width()-40&&!e.paletteItem&&t.datavisualization.Diagram.Util.scale(e,(this.element.width()-45)/i.width,1,i.center):e.width>this.element.width()-40?e.width=this.element.width()-40:e.paletteItem&&e.paletteItem.width&&e.paletteItem.width>this.element.width()-40&&(e.paletteItem.width=this.element.width()-40)},_renderHtmlLayer:function(e,i){var a,n=document.createElement("div"),o={id:e.id+"_htmlLayer","class":"htmlLayer"};return t.datavisualization.Diagram.Util.attr(n,o),a=n,n.style.pointerEvents="none",n.style.position="absolute",n.style.left=i?i.style.paddingLeft:"0px",n.style.top=i?i.style.paddingTop:"0px",e.appendChild(a),a},_initPaletteitems:function(e){if(e.items)for(var t=0;t<e.items.length;t++)e.items[t]=this._extendPaletteItem(e.items[t])},_initGroupNode:function(i){for(var a=null,n=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,o=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null,s=0;s<i.children.length;s++)a=i.children[s],"object"==typeof a&&("group"==a._type?(a=t.datavisualization.Diagram.Group(e.extend(!0,{},n,a)),a=t.datavisualization.Diagram.Util._updateBpmnChild(a,this),this._initGroupNode(a)):a=a.segments?t.datavisualization.Diagram.Connector(e.extend(!0,{},o,a)):t.datavisualization.Diagram.Node(e.extend(!0,{},n,a)),a=t.datavisualization.Diagram.NodeType(a,this),
a.parent=i.name,i.children[s]=a.name,this.nameTable[a.name]=a)},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var e=this.element.width();return Math.abs(e)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var e=this.element.height();return Math.abs(e)},_renderPalette:function(e){this._renderHeader(e),this._updateHeaderWrapper(e,this.model.headerHeight),this._renderContent(e),this._collapse(e),this._updatePaletteVisibility(e)},_renderHeader:function(i){var a=document.createElement("div"),n={id:i.name.replace(/\s/gi,"_")+"_header","class":"e-header",style:"height:"+this.model.headerHeight+"px;"};i.constraints&this._canHeaderVisible(i)||(n.style+="display:none"),t.datavisualization.Diagram.Util.attr(a,n),this._renderHeaderArrow(a,i.expanded,i.name,this._canExpand(i)),i.templateId&&e.templates?this._renderHeaderTemplate(a,i):this._renderHeaderText(a,i.name),this._addExpandedClass(a,i.expanded),this._disableClickClass(a,this._canExpand(i)),this.model.selectedPaletteName===i.name&&(e(a).addClass("selected"),this.activePalette=i),this._canvas.appendChild(a)},_renderHeaderText:function(e,t){var i=document.createElement("span");i.setAttribute("class","e-header-text"),i.innerHTML=t,e.appendChild(i)},_renderHeaderTemplate:function(e,i){var a=this._renderEjTemplate("#"+i.templateId,i),n=document.createElement("div"),o={id:i.name+"_Wrapper","class":"e-header-wrapper"};t.datavisualization.Diagram.Util.attr(n,o),this._renderTemplateContent(i,n,a),e.appendChild(n)},_renderTemplateContent:function(i,a,n){var o,s=document.createElement("div");s.innerHTML=n,s.style.display="inline-block",document.body.appendChild(s),o=s.cloneNode(!0),o.id=i.name+"_templateHeader";var r=s.offsetWidth,l=s.offsetHeight,d=e("#"+this._id).width()-18/r,h=this.model.headerHeight/l,c=Math.min(d,h),u=(c-1)*r/2;t.datavisualization.Diagram.Util.attr(o,{style:"position: relative; left: "+u+"px; transform: scale("+c+")"}),a.appendChild(o),s.parentNode.removeChild(s)},_renderHeaderArrow:function(t,i,a,n){var o,s;n?(o=t.getElementsByClassName("e-header-arrow e-icon")[0],o||(o=document.createElement("span"),o.setAttribute("class","e-header-arrow e-icon"),o.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;"),this._addExpandedClass(o,i),this.model.selectedPaletteName===name&&e(o).addClass("selected"),t.appendChild(o))):(s=t.getElementsByClassName("e-header-arrow e-icon")[0],s&&s.parentNode.removeChild(s))},_renderContent:function(e){var t,i,a,n=this._getPaletteContentDiv(e.name);if(n||(n=document.createElement("div"),this._canvas.appendChild(n)),n.setAttribute("id",e.name.replace(/\s/gi,"_")+"_content"),n.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(e)&&n.setAttribute("style","border-bottom-width: 0px;"),t=e.items,t&&t.length>0)for(i=0,a=t.length;a>i;i++)t[i].parent?this.nameTable[t[i].name]=t[i]:(this._renderItem(t[i],n),this.nameTable[t[i].name]=t[i])},_getPaletteContentDiv:function(t){return e(this.element).find("#"+t.replace(/\s/gi,"_")+"_content")[0]},_getPaletteHeaderDiv:function(t){return e(this.element).find("#"+t.replace(/\s/gi,"_")+"_header")[0]},_updateRenderSize:function(e,i,a){var n,o,s;if(!e.paletteItem||"group"===e.type&&!e.isLane||"group"===e._type&&"bpmn"===e.type)e.segments?(s=t.datavisualization.Diagram.Util.bounds(e),t.datavisualization.Diagram.Util._translate(e,i.width/2-s.center.x,i.height/2-s.center.y,this.nameTable)):"group"==e._type?this._checkItemUpdate(e)?(n=i.width/e.width,o=i.height/e.height,this.scale(e,n,o,e.pivot,a,null,null,null,this),t.datavisualization.Diagram.Util._translate(e,i.width/2-e.offsetX,i.height/2-e.offsetY,a,null,this)):t.datavisualization.Diagram.Util._translate(e,e.width/2-e.offsetX,e.height/2-e.offsetY,a,null,this):(e.width=i.width,e.height=i.height,e.offsetX=i.width/2,e.offsetY=i.height/2);else if(e.segments&&e.paletteItem&&e.paletteItem.enableScale&&!e.isPhase){var s=t.datavisualization.Diagram.Util.bounds(e),r=(e.paletteItem.width?e.paletteItem.width:this.model.paletteItemWidth)/s.width,l=(e.paletteItem.height?e.paletteItem.height:this.model.paletteItemHeight)/s.height;t.datavisualization.Diagram.Util.scale(e,r,l,{x:.5,y:.5}),this._updatePaletteItemWidth(e)}else if(e.segments&&e.paletteItem&&e.paletteItem.enableScale&&!e.isPhase||e.isPhase&&e.paletteItem.width!=e.paletteItem.height){var s=t.datavisualization.Diagram.Util.bounds(e),r=(e.paletteItem.width?e.paletteItem.width:this.model.paletteItemWidth)/s.width,l=(e.paletteItem.height?e.paletteItem.height:this.model.paletteItemHeight)/s.height;t.datavisualization.Diagram.Util.scale(e,r,l,{x:.5,y:.5}),this._updatePaletteItemWidth(e)}else"node"==e._type&&this._checkItemUpdate(e)&&(e.width=i.width,e.height=i.height,e.offsetX=i.width/2,e.offsetY=i.height/2)},_checkItemUpdate:function(e){return!e.paletteItem||!e.paletteItem.enableScale},_updatePreviewSize:function(e,i){var a,n,o;if(e.paletteItem&&("group"!==e.type||e.isLane))if(e.segments&&e.paletteItem&&e.paletteItem.enableScale&&!e.isPhase){var o=t.datavisualization.Diagram.Util.bounds(e),s=(e.paletteItem.previewWidth?e.paletteItem.previewWidth:this.model.previewWidth)/o.width,r=(e.paletteItem.previewHeight?e.paletteItem.previewHeight:this.model.previewHeight)/o.height;t.datavisualization.Diagram.Util.scale(e,s,r,{x:.5,y:.5}),this._updatePaletteItemWidth(e)}else if(e.segments&&e.paletteItem&&e.paletteItem.enableScale&&!e.isPhase||e.isPhase&&e.paletteItem.previewWidth!=e.paletteItem.previewHeight){var o=t.datavisualization.Diagram.Util.bounds(e),s=(e.paletteItem.previewWidth?e.paletteItem.previewWidth:this.model.previewWidth)/o.width,r=(e.paletteItem.previewHeight?e.paletteItem.previewHeight:this.model.previewHeight)/o.height;t.datavisualization.Diagram.Util.scale(e,s,r,{x:.5,y:.5}),this._updatePaletteItemWidth(e)}else("node"==e._type||"group"==e._type)&&(e.width=i.width,e.height=i.height,e.offsetX=i.width/2,e.offsetY=i.height/2);else e.segments?(o=t.datavisualization.Diagram.Util.bounds(e),t.datavisualization.Diagram.Util._translate(e,i.width/2-o.center.x,i.height/2-o.center.y,this.nameTable)):e.container&&!e.isLane?(a=i.width/e.width,n=i.height/e.height,this.scale(e,a,n,e.pivot,this.nameTable,null,null,null,this),t.datavisualization.Diagram.Util._translate(e,i.width/2-e.offsetX,i.height/2-e.offsetY,this.nameTable,null,this)):(e.width=i.width,e.height=i.height,e.offsetX=i.width/2,e.offsetY=i.height/2)},_getRenderItemSize:function(e){var i,a,n,o,s,r=this.model.paletteItemWidth,l=this.model.paletteItemHeight;return e.segments?(s=t.datavisualization.Diagram.Util.bounds(e),e.paletteItem?(r=e.paletteItem.width?e.paletteItem.width:r,l=e.paletteItem.height?e.paletteItem.height:l,r=r?r:e.width,l=l?l:e.height,e.paletteItem.width=r,e.paletteItem.height=l):(s=t.datavisualization.Diagram.Util.bounds(e),r=r?r:s.width,l=l?l:s.height)):"group"===e.type?(s=t.datavisualization.Diagram.Util._getChildrenBounds(e,this),e.paletteItem&&!e.isLane?(r=e.paletteItem.width?e.paletteItem.width:r,l=e.paletteItem.height?e.paletteItem.height:l,r=r?r:s.width,l=l?l:s.height,e.paletteItem.width=r,e.paletteItem.height=l):e.paletteItem&&e.isLane?e.paletteItem.enableScale?(r=e.paletteItem.width?e.paletteItem.width:r,l=e.paletteItem.height?e.paletteItem.height:l,r=r?r:s.width,l=l?l:s.height,e.paletteItem.width=r,e.paletteItem.height=l):(i=(e.paletteItem.width?e.paletteItem.width:this.model.paletteItemWidth)/e.width,a=(e.paletteItem.height?e.paletteItem.height:this.model.paletteItemHeight)/e.height,t.datavisualization.Diagram.Util.scale(e,i,a,{x:.5,y:.5},this.nameTable,!1,!1,!1,this),n=1e-4,o=.001,e.isLane&&e.paletteItem&&!e.paletteItem.enableScale&&("horizontal"===e.orientation?n-=2.2:n+=.8,o-=1),t.datavisualization.Diagram.Util._translate(e,n,o,this.nameTable,!1,this),r=e.width?e.width:r,l=e.height?e.height:l):(r=r?r:s.width,l=l?l:s.height)):e.paletteItem?(r=e.paletteItem.width?e.paletteItem.width:r,l=e.paletteItem.height?e.paletteItem.height:l,r=r?r:e.width,l=l?l:e.height,e.paletteItem.width=r,e.paletteItem.height=l):(s=t.datavisualization.Diagram.Util.bounds(e),r=s.width?s.width:r,l=s.height?s.height:l),{width:r,height:l}},_renderPetternDefinition:function(e,t){if(e&&t){var i=t.document.getElementById(e+"patterndefinition");i||(i=t.defs({id:e+"patterndefinition"}),t.appendChild(i))}},_renderItem:function(t,i){for(var a,n=e.extend(!0,{},t),o=this._getRenderItemSize(n),s=[],r=0;t.children&&r<t.children.length;r++)s[t.children[r]]=e.extend(!0,{},this.nameTable[t.children[r]]);return this._updateRenderSize(n,o,s),a=this._renderItemContainer(n.name,i,null,o,n),n.segments?this._renderConnector(n,a,o):"node"!=n._type||n.children&&n.children.length>0?this._renderGroup(n,a,o,s):this._renderNode(n,a,o),n.isLane&&n.paletteItem&&!n.paletteItem.enableScale&&"vertical"===n.orientation&&a.document.setAttribute("height",o.height+2),n},_getPreviewItemSize:function(e){var i,a=this.model.previewWidth,n=this.model.previewHeight;return e.segments?(i=t.datavisualization.Diagram.Util.bounds(e),e.paletteItem?(a=e.paletteItem.previewWidth?e.paletteItem.previewWidth:a,n=e.paletteItem.previewHeight?e.paletteItem.previewHeight:n,a=a?a:e.width,n=n?n:e.height,a=a?a:i.width,n=n?n:i.height,e.paletteItem.previewWidth=a,e.paletteItem.previewHeight=n):(i=t.datavisualization.Diagram.Util.bounds(e),a=a?a:i.width,n=n?n:i.height)):"group"===e.type?(i=t.datavisualization.Diagram.Util._getChildrenBounds(e,this),e.paletteItem&&!e.isLane?(a=e.paletteItem.previewWidth?e.paletteItem.previewWidth:a,n=e.paletteItem.previewHeight?e.paletteItem.previewHeight:n,a=a?a:i.width,n=n?n:i.height,e.paletteItem.previewWidth=a,e.paletteItem.previewHeight=n):e.paletteItem&&e.isLane?e.paletteItem.enableScale?(a=e.paletteItem.previewWidth?e.paletteItem.previewWidth:a,n=e.paletteItem.previewHeight?e.paletteItem.previewHeight:n,a=a?a:i.width,n=n?n:i.height,e.paletteItem.previewWidth=a,e.paletteItem.previewHeight=n):(a=e.paletteItem.previewWidth?e.paletteItem.previewWidth:a,n=e.paletteItem.previewHeight?e.paletteItem.previewHeight:n):(a=a?a:i.width,n=n?n:i.height)):e.paletteItem?(a=e.paletteItem.previewWidth?e.paletteItem.previewWidth:a,n=e.paletteItem.previewHeight?e.paletteItem.previewHeight:n,a=a?a:e.width,n=n?n:e.height,e.paletteItem.previewWidth=a,e.paletteItem.previewHeight=n):(i=t.datavisualization.Diagram.Util.bounds(e),a=i.width?i.width:a,n=i.height?i.height:n),{width:a,height:n}},_renderItemContainer:function(e,i,a,n,o){var s=document.createElement("div"),r=this.model.showPaletteItemText?n.height+18:n.height,l=n.width,d=o&&o.paletteItem?o.paletteItem.margin.left:4,h=o&&o.paletteItem?o.paletteItem.margin.top:4,c=o&&o.paletteItem?o.paletteItem.margin.right:4,u=o&&o.paletteItem?o.paletteItem.margin.bottom:4,g={id:e+"_paletteItem",draggable:"true",height:r+"px",width:l+"px","class":"e-paletteItem",style:"padding-left:"+d+"px;padding-right:"+(c+2)+"px;padding-top:"+(h+1)+"px;padding-bottom:"+(u+1)+"px;height:"+(r+1)+"px;width:"+(l+1)+"px;-ms-touch-action: none;touch-action: none;"};return t.datavisualization.Diagram.Util.attr(s,g),i.appendChild(s),this.model.allowDrag&&this._setItemDraggable(s),this._renderAnchor(s,e,n,o)},_renderAnchor:function(e,i,a,n){var o,s=document.createElement("div"),r={id:i+"_anchor",height:a.height+"px","class":"e-anchor"};return t.datavisualization.Diagram.Util.attr(s,r),e.appendChild(s),o=this._renderSvg(s,i,a),this._renderText(s,i,a,n),o},_renderSvg:function(i,a,n){var o,s,r=document.createElement("div"),l={id:a+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;","class":"e-svg-container",style:"width:"+n.width+"px;height:"+n.height+"px;"};return t.datavisualization.Diagram.Util.attr(r,l),l={id:a+"_svg",width:n.width,height:n.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},s=new t.datavisualization.Diagram.Svg(l),r.appendChild(s.document),i.id.split("_clone").length>1&&(o=e(i).parents(".e-paletteItem")[0]),this._renderHtmlLayer(r,o),i.appendChild(r),s},_renderText:function(e,i,a,n){var o,s,r,l=document.createElement("div");l.setAttribute("class","e-text-container"),l.setAttribute("style","width:"+a.width+"px; text-align : center;overflow: hidden;text-overflow: ellipsis;font-size: 12px;"),o=document.createElement("span"),o.setAttribute("class","e-paletteItemText"),n&&n.paletteItem&&(i=n.paletteItem.label?n.paletteItem.label:i),o.innerHTML=i.split("_clone").length>1?i.split("_clone")[0]:i,n&&n.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap&&(o.style.whiteSpace="nowrap",o.style.wordWrap="normal"),n&&n.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap&&(o.style.whiteSpace="pre-wrap",o.style.wordBreak="break-all",o.style.wordWrap="break-word"),n&&n.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(o.style.whiteSpace="pre-wrap",o.style.wordWrap="break-word"),l.appendChild(o),this.model.showPaletteItemText||(l.style.display="none"),e.appendChild(l),n&&!n.paletteItem.enableScale&&(s=document.getElementById(n.name+"_paletteItem"),r=document.getElementById(n.name+"_anchor").lastChild.getBoundingClientRect(),s.style.height=a.height+r.height+"px")},_renderNode:function(e,i,a){this._renderPetternDefinition(i.id+"_"+e.name,i);var n=t.datavisualization.Diagram.SvgContext.renderNode(e,i,null,!0,this),o=!1;null!=i.document.getAttribute("drag")&&(o=!0),this._transformItem(n,e.width,e.height,e,o,a)},_updateChildBounds:function(e,i){var a,n,o=null;if("group"==e._type){for(a=this._getChildren(e.children),n=0;n<a.length;n++)o=i[a[n]],"group"==o._type&&this._updateChildBounds(o,i);t.datavisualization.Diagram.Util._updateChildBounds(e,this)}},_getChildren:function(e){var t,i,a;if(e){for(t=[],i=0;i<e.length;i++)a=e[i],a&&("object"==typeof a?t.push(a.name):"string"==typeof a&&t.push(a));return t}},_renderGroup:function(e,i,a,n){this._renderPetternDefinition(i.id+"_"+e.name,i),n||(n=this.nameTable),(!e.container||e.isLane)&&this._updateChildBounds(e,n);var o=t.datavisualization.Diagram.SvgContext.renderGroup(e,i,null,n,this,!1,!0),s=!1;null!=i.document.getAttribute("drag")&&(s=!0),this._transformItem(o,e.width,e.height,e,s,a)},_renderConnector:function(e,i,a){var n=t.datavisualization.Diagram.SvgContext.renderConnector(e,i,null,this),o=t.datavisualization.Diagram.Util.bounds(e),s=!1;null!=i.document.getAttribute("drag")&&(s=!0),this._transformItem(n,o.width,o.height,e,s,a)},_wireEvents:function(){this._on(this.element,t.eventType.click,".e-header",this._headerClick),this._on(this.element,t.eventType.mouseDown,".e-header",this._headerMouseDown),this._on(this.element,"mouseover",".e-header",this._headerMouseOver),this._on(this.element,"mouseout",".e-header",this._headerMouseOut),this._on(this.element,t.eventType.mouseDown,".e-paletteItem",this._itemMouseDown),this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver),this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut),this._on(this.element,t.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(e){this._expandOrCollapsePalette("",e.currentTarget);var t=this._getActivePalette(e.currentTarget.id);t&&t!==this.activePalette&&(this.activePalette=t)},_headerMouseDown:function(e){e.preventDefault(),e.stopPropagation()},_headerMouseOver:function(t){var i=this._getActivePalette(t.currentTarget.id);i&&this._canExpand(i)&&(e(t.currentTarget).addClass("hover"),e(t.currentTarget).find(".e-header-arrow").addClass("hover"))},_headerMouseOut:function(t){e(t.currentTarget).removeClass("hover"),e(t.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var a,n,o,s,r,l,d;if(this.model.diagramId&&(a=e("#"+this.model.diagramId).ejDiagram("instance"),a.activeTool instanceof t.datavisualization.Diagram.LineTool&&(a.activeTool._showAllPorts(!0),a.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(e(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,e(i.currentTarget).hasClass("selected")||e(i.currentTarget).addClass("selected"),n=this._getActivePalette(i.currentTarget.parentElement.id),n&&n!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(e(i.currentTarget.parentElement).prev()),this.activePalette=n),this.activePalette&&this._selectedElement)for(o=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),s=this.activePalette.items,r=0,l=s.length;l>r;r++)d=s[r],d.name===o&&(this.selectedItem=d)},_itemMouseOver:function(t){e(t.currentTarget).addClass("hover")},_itemMouseOut:function(t){e(t.currentTarget).removeClass("hover")},_itemDraStart:function(e){var t=e.originalEvent.dataTransfer;t.setData("Text",this.element[0].id),t.effectAllowed="copy"},_itemClick:function(i){var a,n,o,s,r,l,d,h,c,u,g,m;if(("click"===i.type||"touchend"===i.type&&!e(".dragClone")[0])&&this.model.diagramId){if(a=e("#"+this.model.diagramId).ejDiagram("instance"),n=e.extend(!0,{},this.selectedItem),n.name+=t.datavisualization.Diagram.Util.randomId(),"bpmn"==n.type&&(n.children=[]),o=a.getObjectType(n),"group"==o){for(s=this._getChildren(n.children),r=0;r<s.length;r++)l=e.extend(!0,{},this.nameTable[s[r]]),l.parent=n.name,l.name=n.name+l.name,n.children[r]=l.name,a.nameTable[l.name]=l,a.nodes().push(l),a._nodes=e.extend(!0,[],a.nodes()),a.nameTable[l]&&a._updateQuad(a.nameTable[l]);n.isLane||(n.height=n.width=0,a._updateChildBounds(n,a.nameTable))}n&&n.isLane&&(d=t.datavisualization.Diagram.Util.randomId(),a._cloneGroupNode(n,d),h=t.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(n,a.nameTable),h.isLane=n.isLane,h.orientation=n.orientation,h.height=120,h=t.datavisualization.Diagram.Lane(h),c=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(h,a,null,!0),c&&(c.offsetX+=10,c.offsetY+=40)),u=e.extend(!0,{},this._oldItem),g=c?c:n,this._oldItem=e.extend(!0,{},g),m={oldElement:u,newElement:g},this._trigger("selectionChange",m)}},_updatePaletteVisibility:function(e){this._canHeaderVisible(e)&&(this._canPaletteVisible(e)?(this._getPaletteHeaderDiv(e.name).style.display="",this._getPaletteContentDiv(e.name).style.display=""):(this._getPaletteHeaderDiv(e.name).style.display="none",this._getPaletteContentDiv(e.name).style.display="none"))},_collectionChanged:function(e){var t,i,a;"insert"==e.changeType?this._renderPalette(e.element):"remove"==e.changeType&&(t=e.element,null!=t&&(i=this._getPaletteHeaderDiv(t.name),i&&i.parentNode.removeChild(i),a=this._getPaletteContentDiv(t.name),a&&a.parentNode.removeChild(a)))},_extendPaletteItem:function(i){var a=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,n=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null;return i.shape&&"object"==typeof i.shape?t.datavisualization.Diagram.Util._updateShapeProperties(i):i=t.datavisualization.Diagram.NodeType(i,this),"connector"==i.type?i=t.datavisualization.Diagram.Connector(e.extend(!0,{},n,i)):i.isLane?i=t.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i,this.nameTable):"phase"==i.type?i=t.datavisualization.Diagram.Util._mapPalettePhase(i):i.container?i=t.datavisualization.Diagram.ContainerHelper._initContainer(this,i):"group"===i._type||i.children&&i.children.length>0?(i=t.datavisualization.Diagram.Group(e.extend(!0,{},a,i)),i=t.datavisualization.Diagram.Util._updateBpmnChild(i,this),this._initGroupNode(i,this),t.datavisualization.Diagram.Util._updateGroupBounds(i,this)):i=t.datavisualization.Diagram.Node(e.extend(!0,{},a,i)),i},addPaletteItem:function(e,t){for(var i,a,n,o,s,r=0;r<this.model.palettes.length;r++)for(i=[],t.length?i=t:i.push(t),a=0;a<i.length;a++)s=this.model.palettes[r],s.name===e&&(n=this._extendPaletteItem(i[a]),s.items.push(n),o=this._getPaletteContentDiv(e),this.nameTable[n.name]=n,this._renderItem(n,o))},removePaletteItem:function(i,a){for(var n,o,s,r,l,d,h,c,u=0;u<this.model.palettes.length;u++)for(n=[],a.length?n=a:n.push(a),o=0;o<n.length;o++)if(c=this.model.palettes[u],c.name===i){if(s=n[o],t.datavisualization.Diagram.Util.removeItem(c.items,s),delete this.nameTable[s.name],s.children&&s.children.length)for(r=0;r<s.children.length;r++)l=s.children[r],l&&("object"==typeof l?delete this.nameTable[l.name]:delete this.nameTable[l]);h=this._getPaletteContentDiv(i),d=e(h).find("#"+s.name+"_paletteItem")[0],d&&(h.removeChild(d),this.selectedItem=null)}},expandPalette:function(e){var t=this._findPalette(e);t&&!t.expanded&&this._canExpand(t)&&(t.expanded=!0,this._expandOrCollapsePalette(e))},collapsePalette:function(e){var t=this._findPalette(e);t&&t.expanded&&this._canExpand(t)&&(t.expanded=!1,this._expandOrCollapsePalette(e))},addPalette:function(e){this.model.palettes.push(e),this._renderPalette(e)},removePalette:function(e){for(var i,a,n,o=0;o<this.model.palettes.length;o++)n=this.model.palettes[o],n.name===e&&(t.datavisualization.Diagram.Util.removeItem(this.model.palettes,n),i=this._getPaletteHeaderDiv(n.name),i&&i.parentNode.removeChild(i),a=this._getPaletteContentDiv(n.name),a&&a.parentNode.removeChild(a))},setWidth:function(e){this.model.width=e,this._setWidth(e)},setHeight:function(e){this.model.height=e,this._setHeight(e)},setPaletteItemWidth:function(e){this.model.paletteItemWidth=e,this._redrawContent()},setPaletteItemHeight:function(e){this.model.paletteItemHeight=e,this._redrawContent()},setHeaderHeight:function(e){this.model.headerHeight=e,this._setHeaderHeight(e)},setCssClass:function(e){this._setCssClass(e),this.model.cssClass=e},showPaletteItemText:function(e){this._showItemText(e),this.model.showPaletteItemText=e},searchPalette:function(e,i){var a=new t.datavisualization.Diagram.Collection;return""!=i&&(e=this._getSearchPaletteItems(i),a.add(e)),a},updatePalette:function(e,t){var a,n,o=this._findPalette(e);o&&t&&(t.constraints&&o.constraints!=t.constraints&&(o.constraints=t.constraints,a=this._getPaletteHeaderDiv(o.name),this._renderHeaderArrow(a,o.expanded,o.name,this._canExpand(o)),this._disableClickClass(a,this._canExpand(o)),this._updatePaletteVisibility(o),a.style.display=this._canHeaderVisible(o)&&this._canPaletteVisible(o)?"":"none"),t.expanded!=i&&this._canExpand(o)&&(o.expanded=t.expanded,this._expandOrCollapsePalette(e)),t.items&&t.items.length>0&&(n=this._getPaletteContentDiv(o.name),n.innerHTML="",o.items=t.items,this._initPaletteitems(o),this._renderContent(o))),this.updateScrollerViewport()},_findPalette:function(e){for(var t,i=0;i<this.model.palettes.length;i++)if(this.model.palettes[i].name==e||this.model.palettes[i].name==e.replace(/\_/gi," ")){t=this.model.palettes[i];break}return t},_canExpand:function(e){return e.constraints&t.datavisualization.Diagram.PaletteConstraints.Expandable},_canHeaderVisible:function(e){return e.constraints&t.datavisualization.Diagram.PaletteConstraints.HeaderVisibility},_canPaletteVisible:function(e){return e.constraints&t.datavisualization.Diagram.PaletteConstraints.Visible},_canClick:function(e){var t,i;return e&&(t=e.id.split("_header")[0],t&&(i=this._findPalette(t),this._canExpand(i)))?!0:void 0},_expandOrCollapsePalette:function(t,i){var a,i=i||(t?this._getPaletteHeaderDiv(t):null);if(i){if(!this._canClick(i))return!1;a=this,e(i).next(".e-scontent").slideToggle(200,function(){a._refresh()}),this._updateHeaderState(i)}},_getSearchPaletteItems:function(e){for(var i,a=new t.datavisualization.Diagram.Palette,n=this.model.palettes,o=0;o<n.length;o++)if(n[o].name.toLocaleLowerCase().search(e.toLocaleLowerCase())>=0)for(i=0;i<n[o].items.length;i++)this.element.find("#"+n[o].items[i].name+"_paletteItem")[0].style.display="block";else for(i=0;i<n[o].items.length;i++)this.element.find("#"+n[o].items[i].name+"_paletteItem")[0].style.display=n[o].items[i].name.toLocaleLowerCase().search(e.toLocaleLowerCase())>=0?"block":"none";return a},_disableClickClass:function(t,i){i?e(t).removeClass("e-disableclick"):e(t).addClass("e-disableclick")},_addExpandedClass:function(t,i){i?e(t).addClass("expanded"):e(t).addClass("collapsed")},_collapse:function(t){t.expanded||e(this._getPaletteHeaderDiv(t.name)).next(".e-scontent").slideToggle(10)},_transformItem:function(e,i,a,n,o,s){var r,l;if(!o)if(s&&!n.segments&&n.paletteItem&&n.paletteItem.width&&n.paletteItem.height&&n.paletteItem.enableScale){var d=30*s.width/100,h=30*s.height/100,c=(s.width-d)/n.width,u=(s.height-h)/n.height;c=u=Math.min(c,u),c=c>1?1:c,u=u>1?1:u;var g=s.width/2-i*c/2,m=s.height/2-a*u/2,p="";p+="translate("+g+","+m+")",p+="scale("+c+","+u+")",e.setAttribute("transform",p),r=e.parentNode.nextSibling,r||(r=document.getElementById(e.id+"_svgWrapper_htmlLayer")),r.style.webkitTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.MozTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.OTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.msTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.transform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",n&&"msie"===t.browserInfo().name&&"group"==n._type&&"html"===n.type&&(l=document.getElementById(n.name+"_html"),l.setAttribute("style","zoom:"+scale+";"))}else if(n.segments){if(s&&n.paletteItem&&n.paletteItem.width&&n.paletteItem.height||n.isPhase&&n.paletteItem&&n.paletteItem.enableScale){var d=s.width/10,h=s.height/10,c=(s.width-d)/i,u=(s.height-h)/a;c=u=Math.min(c,u),c=c>1?1:c,u=u>1?1:u;var g=s.width/2-i*c/2,m=s.height/2-a*u/2,p="";p+="translate("+g+","+m+")",p+="scale("+c+","+u+")",e.setAttribute("transform",p),r=document.getElementById(e.id+"_svgWrapper_htmlLayer"),r.style.webkitTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.MozTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.OTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.msTransform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",r.style.transform="translate("+g+"px,"+m+"px) scale("+c+", "+u+")",n&&"msie"===t.browserInfo().name&&"group"==n._type&&"html"===n.type&&(l=document.getElementById(n.name+"_html"),l.setAttribute("style","zoom:"+scale+";"))}}else{var f=i/(i+3*n.borderWidth),v=a/(a+3*n.borderWidth),_=(i-i*f)/2,y=(a-a*v)/2;e.childNodes[0].setAttribute("transform","scale("+f+","+v+") translate("+_+","+y+")"),n&&"image"===n.type&&e.childNodes[1]?e.childNodes[1].setAttribute("transform","scale("+f+","+v+") translate("+_+","+y+")"):n&&"group"===n._type&&e.setAttribute("transform","scale("+f+","+v+") translate("+_+","+y+")")}},_getScaleFactor:function(e,t){var i=30*this.model.paletteItemWidth/100,a=30*this.model.paletteItemHeight/100,n=(this.model.paletteItemWidth-i)/e,o=(this.model.paletteItemHeight-a)/t;return n=n>1?1:n,o=o>1?1:o,Math.min(n,o)},_getTranslateFactor:function(){var e=.15*this.model.paletteItemWidth,t=.15*this.model.paletteItemHeight;return Math.min(e,t)},_setWidth:function(e){this.element.css("width",e)},_setHeight:function(e){this.element.css("height",e)},_setHeaderHeight:function(e){var t,i;for(this.element.find(".e-header").css("height",e),this.element.find(".e-header-arrow").css("top",(e-16)/2),t=0;t<this.model.palettes.length;t++)i=this.model.palettes[t],i&&this._updateHeaderWrapper(i,e);this.updateScrollerViewport()},_updateHeaderWrapper:function(e,t){var i,a=document.getElementById(e.name+"_Wrapper");a&&(i=a.getBoundingClientRect(),i.height>0&&(a.style.marginTop=t/2-i.height/2+"px"))},_setCssClass:function(e){this.element.removeClass(this.model.cssClass).addClass(e)},_showItemText:function(e){e!==this.model.showPaletteItemText&&(e?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_setAllowDrag:function(t){var i,a,n,o,s;if(this.model.allowDrag=t,i=this.model.palettes)for(n=0;n<i.length;n++)if(o=i[n].items)for(s=0;s<o.length;s++)a=document.getElementById(o[s].name+"_paletteItem"),this.model.allowDrag?this._setItemDraggable(a):e(a).ejDraggable("instance").destroy()},_cloneNode:function(e){var i,a,n=t.datavisualization.Diagram.Util.randomId();if(e.children&&e.children.length>0)for(a=0;a<e.children.length;a++)i=this._cloneChildren(e.children[a],n),this.nameTable[i.name]=i,e.children[a]=i.name;return e.name+=n,e},_cloneChildren:function(t,i){if("object"==typeof t)return a=e.extend(!0,{},t),a.parent+=i,a.name+=i,a;if("string"==typeof t){var a=this.nameTable[t];if(a)return this._cloneChildren(a,i)}},_setItemDraggable:function(i){var a=this.element[0].id,n=this;e(i).ejDraggable({clone:!0,cursorAt:{top:n.model.previewOffset.y,left:n.model.previewOffset.x},helper:function(){var i,a,o,s,r,l,d=e("#"+n.model.diagramId).ejDiagram("instance");if(i=n.model.paletteItemWidth,a=n.model.paletteItemHeight,d._selectedSymbol=n.selectedItem,d._symbolPalette=n.model,o=e.extend(!0,{},n.selectedItem),o=n._cloneNode(o),o.isLane&&(n.model.paletteItemWidth=o.paletteItem&&o.paletteItem.previewWidth?o.paletteItem.previewWidth:n.model.previewWidth,n.model.paletteItemHeight=o.paletteItem&&o.paletteItem.previewHeight?o.paletteItem.previewHeight:n.model.previewHeight),s=n._getPreviewItemSize(n.selectedItem),r=n._renderItemContainer(n.selectedItem.name+"_clone",document.body,!0,s),r.document.setAttribute("drag","true"),d._paletteTable=n.nameTable,d._palNameTable=e.extend(!0,{},n.nameTable),o.segments){var h=t.datavisualization.Diagram.Util.bounds(o),c=(s.width-10)/h.width,u=(s.height-10)/h.height;t.datavisualization.Diagram.Util.scale(o,c,u,h.topLeft,d.nameTable),n._renderConnector(o,r,s)}else{if(o.isLane&&o.paletteItem&&!o.paletteItem.enableScale)o.width=s.width,o.height=s.height,o.offsetX=o.width/2,o.offsetY=o.height/2;else if("group"==o._type){var g=s.width/o.width,m=s.height/o.height;n.scale(o,g,m,o.pivot,n.nameTable,null,null,null,n),t.datavisualization.Diagram.Util._translate(o,o.width/2-o.offsetX,o.height/2-o.offsetY,n.nameTable,null,n)}else o.width=s.width-10,o.height=s.height-10,s&&(s.width=s.width-10,s.height=s.height-10),o.offsetX=o.width/2+10,o.offsetY=o.height/2+1;n._updatePreviewSize(o,s),"node"==o._type?n._renderNode(o,r,s):n._renderGroup(o,r)}return l=document.getElementById(n.selectedItem.name+"_clone_paletteItem"),e(l).addClass("dragClone"),n.model.paletteItemWidth=i,n.model.paletteItemHeight=a,e(l)},drag:function(){var t=this.helper[0];e("#"+n.selectedItem.name+"_clone_svg").css("padding","2px"),e("#"+n.selectedItem.name+"_clone_svg").siblings(".htmlLayer").css("padding","2px"),t&&t.setAttribute("paletteId",a)},dragStop:function(t){var i,a=!1;t.event&&t.event.originalEvent&&t.event.originalEvent.changedTouches?a=!0:t.event&&t.event.changedTouches&&(a=!0),i=e("#"+n.model.diagramId).ejDiagram("instance"),a&&i._isDropOver&&(i._svgdrop(t.event,this),i._isDropped=!0),i._selectedSymbol=null,e(this.helper).remove()}})},_redrawContent:function(){for(var t,i,a,n,o,s=this.element.find(".e-scontent"),r=0,l=s.length;l>r;++r)if(t=s[r],e(t).empty(),i=this.model.palettes[r],a=i.items,a&&a.length>0)for(n=0,o=a.length;o>n;n++)this._renderItem(a[n],t)},_getPalette:function(e){for(var t,i=this.model.palettes,a=0,n=i.length;n>a;a++)if(t=i[a],(t.name===e||t.name===e.replace(/\_/gi," "))&&t!==this.activePalette)return t;return null},_getActivePalette:function(e){var t=e.slice(0,e.lastIndexOf("_"));return this._getPalette(t)},_updateHeaderState:function(e){this._clearHeaderSelection(),this._updateExpandState(e),this._updateHeaderSelection(e)},_updateExpandState:function(t){e(t).hasClass("expanded")?(e(t).removeClass("expanded").addClass("collapsed"),e(t).find(".e-header-arrow").removeClass("expanded").addClass("collapsed"),e(t).attr("aria-expanded","false"),e(t).attr("aria-selected","false")):(e(t).removeClass("collapsed").addClass("expanded"),e(t).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"),e(t).attr("aria-selected","true"),e(t).attr("aria-expanded","true"))},_updateHeaderSelection:function(t){e(t).hasClass("selected")||(e(t).addClass("selected"),e(t).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){
this.element.find(".e-header").removeClass("selected"),this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(e,t){var i=this._getPaletteContentDiv(e.name);this._renderItem(t,i)},_removeItem:function(e,t){var i=this._getPaletteContentDiv(e.name);i.removeChild(document.getElementById(t.name+"_paletteItem")),t===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var e=this.element.ejScroller("instance");e.model.touchScroll=!1,e.model.width=this._setViewPortWidth(),e.model.height=this._setViewPortHeight(),this._refresh()},_refresh:function(){this.element.ejScroller("refresh")},_getNodeDimension:function(e){var i,a,n=e._width,o=e._height,s=e.width?e.width:e.maxWidth?e.maxWidth:e.minWidth,r=document.createElement("span"),l=0,d=0;if(e.labels.length){for(t.datavisualization.Diagram.Util.attr(r,{id:e.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(r),a=0;a<e.labels.length;a++)i=e.labels[a],i.bold&&(r.style.fontWeight="bold"),i.italic&&(r.style.fontStyle="italic"),r.style.textDecoration=i.textDecoration,r.style.fontFamily=i.fontFamily,r.style.fontSize=i.fontSize+"px",r.style.color=i.fontColor,r.style.backgroundColor=i.fillColor,r.style.borderColor=i.borderColor,r.style.borderWidth=i.borderWidth,r.textContent=i.text,r.style.wordWrap="break-word",r.style.whiteSpace="pre",s&&(r.style.maxWidth=s-(i.margin.left+i.margin.right)-i.fontSize+"px"),l+=r.offsetWidth+i.margin.left+i.margin.right,d+=r.offsetHeight+i.margin.top+i.margin.bottom;e._width=l,e._height=d,e.minWidth&&(e.minWidth>e._width||!e._width)&&(e._width=e.minWidth),e.maxWidth&&(e.maxWidth<e._width||!e._width)&&(e._width=e.maxWidth),e.minHeight&&(e.minHeight>e._height||!e._height)&&(e._height=e.minHeight),e.maxHeight&&(e.maxHeight<e._height||!e._height)&&(e._height=e.maxHeight),e.width||"left"!=e.labels[0].horizontalAlignment||(e.offsetX+=(e._width-n)*(1-e.pivot.x)),e.width||"right"!=e.labels[0].horizontalAlignment||(e.offsetX-=(e._width-n)*e.pivot.x),e.height||"top"!=e.labels[0].verticalAlignment||(e.offsetY+=(e._height-o)*(1-e.pivot.y)),e.height||"bottom"!=e.labels[0].verticalAlignment||(e.offsetY-=(e._height-o)*e.pivot.y),this.element[0].removeChild(r)}},_getNewNode:function(i){return i.shape&&"object"==typeof i.shape&&t.datavisualization.Diagram.Util._updateShapeProperties(i),t.datavisualization.Diagram.Node(e.extend(!0,{},this.model.defaultSettings.node,i))},_getNewGroup:function(i){return"bpmn"==i.type&&(i=t.datavisualization.Diagram.Util._updateBpmnChild(t.datavisualization.Diagram.Node(i),this)),t.datavisualization.Diagram.Group(e.extend(!0,{},this.model.defaultSettings.group,i))},scale:function(e,i,a,n,o,s,r,l,d){var h,c,u,g,m,p=t.Matrix.identity();if(e.segments)for(t.Matrix.scale(p,i,a,n.x,n.y),u=0;u<e.segments.length;u++){for(g=e.segments[u],m=0;m<g.points.length;m++)g.points[m]=t.Matrix.transform(p,g.points[m]),0!=u||0!=m||e.sourceNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(e,t.Matrix.transform(p,e.sourcePoint),!1)),u!=e.segments.length-1||m!=g.points.length-1||e.targetNode||(g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],e.targetPoint=g._endPoint);g._startPoint=g.points[0],g._endPoint=g.points[g.points.length-1],"orthogonal"==g.type?g.length||0===g.length?g.length=g._length=t.datavisualization.Diagram.Geometry.distance(g._startPoint,g._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(g,e.segments[u-1],e.segments[u+1],e.sourcePoint,e.targetPoint):(g.point&&(g.point=g._endPoint),g._point=g._endPoint)}else{if("group"===e._type){for(h=e.children,u=0;u<h.length;u++)c=o["string"==typeof h[u]?h[u]:h[u].name],c&&(this.scale(c,i,a,n,o),c.parent&&c.parent!=e.name&&"pseudoGroup"!=e.type&&t.datavisualization.Diagram.Util._updateGroupBounds(o[c.parent],d));t.datavisualization.Diagram.Util._updateGroupBounds(e,d)}t.Matrix.rotate(p,-e.rotateAngle,n.x,n.y),t.Matrix.scale(p,i,a,n.x,n.y),t.Matrix.rotate(p,e.rotateAngle,n.x,n.y);var f=t.Matrix.transform(p,t.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),v=e.width*i,_=e.height*a;v>1&&(e.width=v,e.offsetX=f.x),_>1&&(e.height=_,e.offsetY=f.y)}},_translate:function(e,i,a,n,o,s){var r,l,d;if(e.segments)t.datavisualization.Diagram.Util._translateLine(e,i,a,e);else if(e.offsetX+=i,e.offsetY+=a,"group"===e._type&&!o){for(r=s._getChildren(e.children),d=0;d<r.length;d++)l=n[r[d]],this._translate(l,i,a,n,null,s),l.parent&&l.parent!=e.name&&"pseudoGroup"!=e.type&&t.datavisualization.Diagram.Util._updateGroupBounds(n[l.parent],s);"group"!=e._type&&e.container&&t.datavisualization.Diagram.Util._updateGroupBounds(e,s)}}})}(jQuery,Syncfusion),function(e,t){"use strict";var i,a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x;t.datavisualization.Diagram.extend=function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);i.prototype=t.prototype,e.prototype=new i},i=function(){function i(e,i){this.name=e,this.diagram=i,this.helper=null,this.inAction=!1,this.selectedObject=null,this.startPoint=t.datavisualization.Diagram.Point(0,0),this.currentPoint=t.datavisualization.Diagram.Point(0,0),this.previousPoint=t.datavisualization.Diagram.Point(0,0),this.cursor="default",this._currentPossibleConnection=null,this._previousPossibleConnection=null,this._possibleConnectionPort=null,this.singleAction=!1,this.svgHelper=null,this.single=null,this._centralPoint=t.datavisualization.Diagram.Point(0,0),this._enableAutoNode=null,this._prevTool=null,this.activeLabel=null,this._adjustLines={lines:[]}}return i.prototype.abort=function(){this._endAction(),this.diagram.selectionList&&this.diagram.selectionList[0]&&t.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints),this.diagram._removeTooltip()},i.prototype._snapTop=function(e,i,a,n,o,s){var r,l,d,h=n;if(i.top=!0,e.left=e.right=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.y-this.initialBounds.height*o.pivot.y+n-(o.offsetY-o.height*o.pivot.y),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,e,i,a,d,this.selectedObject,s)),i.snapped)h=n-d+i.offset;else if(r.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var c=this.initialBounds.y-this.initialBounds.height*o.pivot.y,u=c+n,g=t.datavisualization.Diagram.SnapUtil._round(u,r.horizontalGridLines.snapInterval,l);h=g-c}return h},i.prototype._checkGroupChildren=function(e,i,a){for(var n,o,s=this.diagram._getChildren(i.children),r=0;r<s.length;r++)n=this.diagram.nameTable[s[r]],n&&t.datavisualization.Diagram.Util.canSelect(n)&&t.datavisualization.Diagram.Util.enableLayerOption(n,"lock",this.diagram)&&(o=t.datavisualization.Diagram.Util.bounds(n),t.datavisualization.Diagram.Geometry.containsRect(a,o)&&e.indexOf(n)<0?e.push(n):"group"===n._type&&this._checkGroupChildren(e,n,a))},i.prototype._getSwimLaneStackIndex=function(e){var i,a,n=null;return"canvas"==e.container.type&&(e.parent&&(i=this.diagram.nameTable[e.parent]),i&&(a=t.datavisualization.Diagram.Util.bounds(e),n="vertical"===i.container.orientation?this.currentPoint.y>=a.y&&this.currentPoint.y<a.center.y?this._getIndex(i.children,e):this._getIndex(i.children,e)+1:this.currentPoint.x>=a.x&&this.currentPoint.x<a.center.x?this._getIndex(i.children,e):this._getIndex(i.children,e)+1)),n},i.prototype._getIndex=function(e,t){var i,a;if(!e||!t)return-1;for(i=null,a=0;a<e.length;a++)if(i=this.diagram.nameTable[this.diagram._getChild(e[a])],i&&i.name==t.name)return a},i.prototype._snapLeft=function(e,i,a,n,o,s){var r,l,d,h,c=a;if(e.left=!0,i.top=i.bottom=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.x-this.initialBounds.width*o.pivot.x+a-(o.offsetX-o.width*o.pivot.x),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,e,i,d,n,this.selectedObject,s)),h=t.datavisualization.Diagram.Util.bounds(o),e.snapped)c=a-d+e.offset;else if(r.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var u=this.initialBounds.x-this.initialBounds.width*o.pivot.x,g=u+a,m=t.datavisualization.Diagram.SnapUtil._round(g,r.horizontalGridLines.snapInterval,l);c=m-u}return c},i.prototype._snapBottom=function(e,i,a,n,o,s){var r,l,d,h,c=n;if(!this.diagram._disableSnap)if(i.bottom=!0,e.left=e.right=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.y+this.initialBounds.height*(1-o.pivot.y)+n-(o.offsetY+o.height*(1-o.pivot.y)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,e,i,a,d,this.selectedObject,s)),h=t.datavisualization.Diagram.Util.bounds(o),i.snapped)c=n-d+i.offset;else if(r.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var u=this.initialBounds.y+this.initialBounds.height*(1-o.pivot.y),g=u+n,m=t.datavisualization.Diagram.SnapUtil._round(g,r.horizontalGridLines.snapInterval,l);c=m-u}return c},i.prototype._snapRight=function(e,i,a,n,o,s){var r,l,d,h=a;if(!this.diagram._disableSnap)if(e.right=!0,i.top=i.bottom=!1,r=this.diagram.model.snapSettings,l=this.diagram._currZoom,!this.diagram._enableSnapToObject()||o.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(d=this.initialBounds.x+this.initialBounds.width*(1-o.pivot.x)+a-(o.offsetX+o.width*(1-o.pivot.x)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,e,i,d,n,this.selectedObject,s)),e.snapped)h=a-d+e.offset;else if(r.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var c=this.initialBounds.x+this.initialBounds.width*(1-o.pivot.x),u=c+a,g=t.datavisualization.Diagram.SnapUtil._round(u,r.verticalGridLines.snapInterval,l);h=g-c}return h},i.prototype.keydown=function(e){var i=e.keyCode?e.keyCode:e.which;27===i&&this.inAction?(this.diagram._selectedSymbol?(this.diagram._documentmouseup(e),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._selectedSymbol=null):(this.seletedObject||this.selectedObject)&&(this.selectedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this.seletedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.seletedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.seletedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram)),this.abort()):46===i&&this.inAction?(this.diagram._selectedSymbol&&(this.diagram._documentmouseup(e),this.diagram._selectedSymbol=null),this.abort()):this.inAction||27!=i||this.diagram._clearSelection()},i.prototype._getSwimlaneHeader=function(e){var t;return e&&e.isSwimlane&&e.children&&e.children.length>0&&(t=this.diagram.nameTable[this.diagram._getChild(e.children[0])]),t},i.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg),this._removeHighLighter()},i.prototype._cloneGroupNode=function(t,i){var a,n,o,s,r=null;if(n=e.extend(!0,{},t),n.name+=i,t&&"group"===t._type)for(n.children=[],o=this.diagram._getChildren(t.children),s=0;s<o.length;s++)r=this.diagram.nameTable[this.diagram._getChild(o[s])],a=e.extend(!0,{},r),a.name+=i,a.parent&&(a.parent+=i),"group"===a._type&&this._cloneGroupNode(a,i),this.diagram.nameTable[a.name]=a,n.children.push(a);return n},i.prototype._updateNextPhases=function(e,i,a){var n,o,s,r,l=0;for(l="horizontal"==e.orientation?i:a,n=this.diagram._getPhaseIndex(e.name),s=this.diagram.nameTable[e.parent],r=n+1;r<s.phases.length;r++)o=this.diagram.nameTable[this.diagram._getChild(s.phases[r])],o&&(o.offset+=l),t.datavisualization.Diagram.SvgContext._updatephase(o,this.diagram)},i.prototype._getphase=function(e){return this.diagram.nameTable[e]},i.prototype._containsSwimlane=function(e){var t,i;for(t in e)if(i=this.diagram.nameTable[this.diagram._getChild(e[t])],i.isSwimlane||i.isLane)return!0;return!1},i.prototype._raiseEndPointDrag=function(e,t,i,a){if(t||i){var n,o,s,r;return o=this._currentPossibleConnection?this._currentPossibleConnection:null,s=this._possibleConnectionPort?this._possibleConnectionPort:null,r=this.currentPoint,n=t?"Target":"Source",this._raiseEvent("connector"+n+"Change",{element:e,node:o,port:s,point:r,dragState:a,cancel:!1})}},i.prototype._decideSelectedItem=function(e,t,i){var a,n,o=null;return t?(t.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&t.parent==this.diagram.selectionList[0].name&&!i?(o=t,"bpmn"==this.diagram.selectionList[0].type&&(o=this.diagram.selectionList[0])):i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==t.name?o=t:(a=this.diagram.nameTable[t.parent],t.isPhase?(n=t.name.split("phaseStack")[1],n&&(t=this.diagram.nameTable[n]),o=t):(o=this._decideSelectedItem(e,a,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&o&&this.diagram.selectionList[0].name==o.name&&!i&&(o=t))):o=t,o):null},i.prototype._isParentAsLane=function(e){for(var t,i,a,n=0;e.children&&n<e.children.length>0;n++)if(t=this.diagram.nameTable[this.diagram._getChild(e.children[n])],t&&(i=this.diagram.nameTable[t.parent],i&&i.isLane))return a=this.diagram.nameTable[i.parent],this.diagram._activeSwimLane=this.diagram.nameTable[a.parent],!0;return null},i.prototype._getAdjustjecentLines=function(e){if(!e.segments){for(var t=0;e.inEdges&&e.inEdges.length>0&&t<e.inEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[e.inEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[e.inEdges[t]]));for(t=0;e.outEdges&&e.outEdges.length>0&&t<e.outEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[e.outEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[e.outEdges[t]]))}},i.prototype._containsCollection=function(e,t){for(var i=0;e&&e.length>0&&i<e.length;i++)if(t&&e[i].name===t.name)return!0},i.prototype._updateMultipleUndoObject=function(e){for(var t,i=[],a=0;e.children&&e.children.length>0&&a<e.children.length;a++)t=this.diagram.nameTable[this.diagram._getChild(e.children[a])],t&&(i.push(jQuery.extend(!0,{},t)),this._getAdjustjecentLines(t));this._undoObject||(this._undoObject={collection:i,adjustLines:jQuery.extend(!0,{},this._adjustLines)})},i.prototype._updateNameTable=function(e){this.diagram._updateNameTable(e)},i.prototype._getParentSwimlane=function(e){var t;return e&&e.isLane?(t=this.diagram.nameTable[e.parent],this.diagram.nameTable[t.parent]):null},i.prototype._removeHighLighter=function(){t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)},i.prototype._getPadding=function(e){var t,i=0,a=0;return e&&e.parent&&(t=this.diagram.nameTable[e.parent],t&&(i=t.paddingRight,a=t.paddingBottom)),{x:i,y:a}},i.prototype._findStackOverNode=function(e,i){var a,n,o,s,r,l,d,h;if(e&&(a=this.diagram.nameTable[e.parent],n=null,a))for(r=a.children.length,l=0;r>l;l++)if(n=this.diagram.nameTable[this.diagram._getChild(a.children[l])],o=this.mousePosition(i),s=t.datavisualization.Diagram.Util.bounds(n),d=this.diagram.nameTable[this.diagram._getChild(a.children[r-1])],h=this.diagram.nameTable[this.diagram._getChild(a.children[0])],"vertical"==a.container.orientation){if(o.y>=s.y&&o.y<=s.bottom)return n;if(o.y<=h.offsetY-h.height/2)return h;if(o.y>=d.offsetY+d.height/2)return d}else{if(o.x>=s.x&&o.x<=s.right)return n;if(o.x<=h.offsetX-h.width/2)return h;if(o.x>=d.offsetX+d.width/2)return d}},i.prototype._getPageBounds=function(){var e=t.datavisualization.Diagram.Rectangle(0,0,0,0),i=this.diagram.model.pageSettings;return e.x="diagram"===i.boundaryConstraints?Math.min(this.diagram._getDigramBounds().x,0):0,e.y="diagram"===i.boundaryConstraints?Math.min(this.diagram._getDigramBounds().y,0):0,e.width="page"===i.boundaryConstraints&&i.pageWidth?i.pageWidth:this.diagram.element.width(),e.height="page"===i.boundaryConstraints&&i.pageHeight?i.pageHeight:this.diagram.element.height(),e},i.prototype._nodeHighLighter=function(e){var i,a,n,o=null,s=null,r=null;e&&this.selectedObject.parent?(i=this.diagram.nameTable[this.selectedObject.parent],i&&(i.container&&"stack"==i.container.type&&this.selectedObject.name!=e.name?(a=this._stackOverNode,t.datavisualization.Diagram.SvgContext._drawStackHighlighter(a,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,"vertical"===i.container.orientation)):i.container&&"canvas"==i.container.type&&this.selectedObject.parent!=e.name&&!e.isPhase&&t.datavisualization.Diagram.Util.canAllowDrop(e)?t.datavisualization.Diagram.Util._canBeTarget(this.diagram,e)&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(e,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter())):e&&e.container&&!e.isSwimlane?this.selectedObject.isLane?(i=this.diagram.nameTable[e.parent],i&&-1===e.name.indexOf("phaseStack")&&t.datavisualization.Diagram.Util.canDrawStackHighlighter(this.diagram,this.selectedObject,e)&&t.datavisualization.Diagram.SvgContext._drawStackHighlighter(e,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,"vertical"===i.container.orientation)):t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(e,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):e.segments?this._removeHighLighter():t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(e,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom),this._nodeToHit&&e&&e.name!=this._nodeToHit.name&&(s=t.datavisualization.Diagram.Util.bounds(this._nodeToHit),r=this._getTargetNode(this._nodeToHit,s),this._raiseEvent("mouseLeave",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(this._nodeToHit),target:this.diagram.getNode(r)})),e?(this._nodeToHit&&this._nodeToHit.name!==e.name||!this._nodeToHit)&&(this._nodeToHit=e,this.selectedObject.parent&&(o=this.diagram.nameTable[this.selectedObject.parent]),"pseudoGroup"==this.selectedObject.type&&(n=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],n&&n.parent&&(o=this.diagram.nameTable[n.parent])),s=t.datavisualization.Diagram.Util.bounds(e),r=this._getTargetNode(e,s),this._raiseEvent("mouseEnter",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(o),target:this.diagram.getNode(r)})):this._nodeToHit=null,e&&(this.selectedObject.parent&&(o=this.diagram.nameTable[this.selectedObject.parent]),s=t.datavisualization.Diagram.Util.bounds(e),r=this._getTargetNode(e,s),this._raiseEvent("mouseOver",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(o),target:this.diagram.getNode(r)}))},i.prototype._doubleClick=function(e){var t,i;e&&e.parent&&(t=this.diagram.nameTable[e.parent],t&&(i=e.name,this.diagram.updateSelectedObject(i),t.isLane||t.isSwimlane||t.isPhaseStack||(this.diagram._clearSelection(!0),this.diagram.addSelection(e,!0))))},i.prototype._itemClick=function(e,t,i,a){var n,o,s,r,l;if(t&&t.parent){if(n=this.diagram.nameTable[t.parent])if(n.container)t&&!this.diagram._selectedSymbol&&(o=t.name,-1!=o.indexOf("_header_swimlane")?e&&this.diagram.updateSelectedObject(e.parent,n):-1!=o.indexOf("_Headerr_")?this.diagram.updateSelectedObject(t.parent):t&&t.isPhase?e.isPhase&&(l=this.diagram.nameTable[e.parent],l&&(0===this.diagram.selectionList.length||this.diagram.selectionList[0].name!=l.name)&&(this.diagram._clearSelection(!0),this.diagram.addSelection(e,!0),this.selectedObject=null)):this.diagram.updateSelectedObject(o)),this.diagram._selectedGNode=null;else if("group"===n.type){if(n.parent){if(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)s=this.diagram.nameTable[n.parent];else for(;n.parent&&(s=this.diagram.nameTable[n.parent],!s||!s.isLane);)if(r=this.diagram.nameTable[n.parent],this.diagram._selectedGNode&&r){if(r.name===this.diagram._selectedGNode.name){this.diagram.updateSelectedObject(n.name);break}n=r}else n=r;s&&s.isLane&&(l=this._getSelectedItem(t,a),l&&this.diagram.updateSelectedObject(l.name))}this.selectedObject&&this.selectedObject.parent&&(this.diagram._selectedGNode=this.selectedObject)}}else t?this.diagram._selectedSymbol||this.diagram.updateSelectedObject(t.name):this.diagram._selectedGNode=null;e&&("pseudoGroup"==e.type||"multipleSelection"==e.name)&&t&&!this._containsChild(e,t.name)&&this.diagram.updateSelectedObject(e.name)},i.prototype._getSelectedItem=function(e,t){var i;return e&&e.parent?(i=this.diagram.nameTable[e.parent],t&&t.name==i.name?e:i.isLane?e:this._getSelectedItem(i)):void 0},i.prototype._getTargetNode=function(e,i){for(var a,n,o,s,r=null,l=[],d=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),h=0;h<d.length;h++)if(a=d[h],a.objects.length>0)for(n=0;n<a.objects.length;n++)o=a.objects[n],!o.segments&&o.visible&&(r=t.datavisualization.Diagram.Util.bounds(o),-1==l.indexOf(o)&&t.datavisualization.Diagram.Geometry.intersectsRect(i,r)&&l.push(o));for(s=[],s.push(e),h=0;h<l.length;h++)l[h].name!=e.name&&s.push(l[h]);return s},i.prototype._updateMargin=function(e,i){var a,n,o,s,r;if("pseudoGroup"==e.type)for(a=null,n=this.diagram._getChildren(e.children),o=0;o<n.length;o++)a=this.diagram.nameTable[n[o]],this._updateMargin(a,i);else if(i&&i.container&&"canvas"==i.container.type){var l=t.datavisualization.Diagram.Util.bounds(i),d=t.datavisualization.Diagram.Util.bounds(e),h=t.datavisualization.Diagram.Geometry.rect([d.topLeft,d.topRight,d.bottomRight,d.bottomLeft]);e.marginLeft=h.x-(l.x+i.paddingLeft),e.marginTop=h.y-(l.y+i.paddingTop),i.isLane&&(s=0,r=0,"horizontal"===i.orientation?(s=50,r=0):(s=0,r=50),e.marginLeft=e.marginLeft>=s?e.marginLeft:s,e.marginTop=e.marginTop>=r?e.marginTop:r)}},i.prototype._getNodeUnderMouse=function(){var e,i,a,n,o=this.diagram._nodeUnderMouse;if(this.diagram._focusedElement&&(this.diagram._focusedElement.isPhase||this.diagram._focusedElement.isLane||this.diagram._focusedElement.isSwimlane)&&(i=!0),this.diagram._focusedElement&&o&&this._containsChild(this.diagram._focusedElement,o.name)&&o&&(i||!t.datavisualization.Diagram.Util.canAllowDrop(o)))if(a=this.diagram.getObjectType(o),"connector"==a||"group"===a)e=o;else if(o.parent){if(n=this.diagram.nameTable[o.parent],n&&n.container&&"stack"==n.container.type&&t.datavisualization.Diagram.Util.canAllowDrop(o))return o;a=this.diagram.getObjectType(n),n&&"node"!=a&&(e=n)}if(e){if(this.selectedObject!=e&&t.datavisualization.Diagram.Util.canAllowDrop(e)&&("bpmn"!=e.type||"bpmn"==this.selectedObject.type))return e}else if(o&&this.selectedObject!=o&&t.datavisualization.Diagram.Util.canAllowDrop(o))return o},i.prototype._isChange=function(e,t){var i=null;return"group"===e._type||"pseudoGroup"===e.type||"group"===t._type||"pseudoGroup"===t.type?("group"!==e._type&&"pseudoGroup"!==e.type||"group"===t._type||"pseudoGroup"===t.type||(i=!this._containsChild(e,t.name)),"group"===e._type||"pseudoGroup"===e.type||"group"!==t._type&&"pseudoGroup"!==t.type?("group"===e._type||"pseudoGroup"===e.type)&&("group"===t._type||"pseudoGroup"===t.type)&&e.name==t.name&&(i=!0):i=!this._containsChild(t,e.name)):e.name==t.name&&(i=!0),i},i.prototype._containsChild=function(e,t){var i,a,n,o=!0,s=null;if(e.children)for(a=this.diagram._getChildren(e.children),n=0;n<a.length;n++)s=this.diagram.nameTable[a[n]],i=this.diagram.getObjectType(s),"group"===i?o=this._containsChild(s,t):s&&s.name==t&&(o=!1);return o},i.prototype._findNodeUnderMouse=function(i,a){var n,o,s,r,l=null,d=null,h=this.diagram._isForeignObject(i.target);return h&&(i.target=h),o=e(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),s=i.target.className,o&&(h||"div"!=i.target.localName)?(n=o.attr("class"),n&&("ej-d-node"===n||"ej-d-group"===n||t.datavisualization.Diagram.Util.isClassifier(i))?(d=this.diagram._findNode(o.attr("id")),d||(d=this.diagram._findNode(o.attr("id").split("_label")[0])),d||(d=this.diagram._findNode(o.attr("id").split("_parentdiv")[0]))):"ej-d-connector"===n?(d=this.diagram._findConnector(o.attr("id")),d||(d=this.diagram._findConnector(o.attr("id").split("_label")[0]))):"ej-d-multiselector"===s.animVal&&(d=this.diagram.selectionList[0]),!d&&i.target&&i.target.parentNode&&(r=i.target.parentNode.id.split("_ej_ports"),d=this.diagram.findNode(r[0]))):this.diagram._isLabelTemplate(i)&&(d=this.diagram._findNode(o.attr("id")),d||(d=this.diagram._findConnector(o.attr("id")))),l=d&&!d.parent?d:this._decideSelectedItem(i,d,a),this.prevSelectObject=l,a&&this.diagram.selectionList[0]&&(l&&"group"===l._type&&!this._containsChild(l,this.diagram.selectionList[0].name)?l=l:l&&this.diagram.selectionList[0].name!=l.name&&this._isChange(this.diagram.selectionList[0],l)?l=this.diagram.selectionList[0]:d&&d.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],l)&&(l=this.diagram.selectionList[0])),this.actualObject=d&&this.diagram._selectedSymbol&&d.name!=this.diagram._selectedSymbol.name&&this.diagram._symbolDrop?this.diagram._selectedSymbol:d,l},i.prototype._findLabelUnderMouse=function(i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f,v,_,y=e(i.target),b=y[0].getAttribute("class");if(this.diagram.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg){if(!b||"ej-d-label"==!b)if(y[0].parentNode&&(r=y[0].parentNode.getAttribute("class")),"ej-d-label"===r){for(l=y[0].parentNode.id.split("_"),d="",_=1;_<l.length;_++)d+=l[_],_!=l.length-1&&(d+="_");if(h=this.diagram.nameTable[l[0]],h&&h.labels.length>0)for(_=0;_<h.labels.length;_++)if(h.labels[_].name===d)return this.activeLabel=h.labels[_],h.labels[_]}else for(c=i.target.parentNode;c;){if(c&&(b=c.getAttribute("class")),"ej-label-template"===b)for(v=c.id.split("_"),s=this.diagram._findNode(v[0]),s||(s=this.diagram._findConnector(v[0])),_=0;s&&_<s.labels.length;_++)if(m=s.labels[_].name.split("_"),v[v.length-1]==m[m.length-1])return g=s.labels[_],this.diagram._selectedSymbol||(this.activeLabel=g),g;if(c&&c.id===this.diagram.element[0].id+"_canvas_svg")break;c=c.parentNode}}else if("ej-d-label"==b){if(f=e(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),f&&(v=f[0].getAttribute("id"),u=f[0].getAttribute("class")))if("ej-d-node"===u||"ej-d-group"===u)s=this.diagram._findNode(v),s||(s=this.diagram._findNode(v.split("_label")[0])),g=this.diagram._findLabelAtPoint(n?n:this.currentPoint,s),this.diagram._selectedSymbol||(this.activeLabel=g);else if("ej-d-connector"===u){if(s=this.diagram._findConnector(v),s||(s=this.diagram._findConnector(v.split("_label")[0])),g=this.diagram._findLabelAtPoint(n?n:this.currentPoint,s),t.datavisualization.Diagram.Util.canMoveLabel(s)||o){if(null==g&&(y=e(i.target),b=y[0].getAttribute("class"),"ej-d-label"==b))for(v=i.target.id.split("_"),_=0;_<s.labels.length;_++)m=s.labels[_].name.split("_"),v[v.length-1]==m[m.length-1]&&(g=s.labels[_])}else g=null;this.diagram._selectedSymbol||(this.activeLabel=g)}}else if(this.diagram._isLabelTemplate(i)){if(p=e(i.target).parents(".ej-label-template"),f=p[0]){if(v=f.parentNode.id.split("_"),s=this.diagram._findNode(v[0]),s||(s=this.diagram._findConnector(v[0])),s)for(_=0;_<s.labels.length;_++)m=s.labels[_].name.split("_"),v[2]==m[m.length-1]&&(g=s.labels[_]);this.diagram._selectedSymbol||(this.activeLabel=g)}}else this.activeLabel=null;return s},i.prototype._findLabelAtNode=function(i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y=null;if(i&&i.labels.length>0)for(l=t.datavisualization.Diagram.Util.bounds(i,!0),n=i.labels,c=0,u=n.length;u>c;c++)y=n[c],y.name==a.name&&(o=t.datavisualization.Diagram.Util._getLabelPosition(y,l),o.x=l.x+o.x,o.y=l.y+o.y,this.diagram.model.labelRenderingMode==t.datavisualization.Diagram.LabelRenderingMode.Svg?(f=document.getElementById(i.name+"_"+y.name).getBBox(),g=f.width?f.width:0,m=f.height?f.height:0):(p=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=e(p).find("#"+i.name+"_"+y.name)[0],g=f?f.offsetWidth:0,m=f?f.offsetHeight:0),g||(g=i.width),m||(m=y.fontSize),v=t.datavisualization.Diagram.Size(g,m),y.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?o.y+=v.height/2:y.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Bottom&&(o.y-=v.height/2),y.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Left?o.x+=v.width/2:y.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Right&&(o.x-=v.width/2),s=o.x-(y.width?y.width/2:i.width/2),r=o.y-(y.height?y.height/2:i.height/2),h=t.datavisualization.Diagram.Point(s,r),i.segments||(d=t.Matrix.identity(),t.Matrix.rotate(d,i.rotateAngle,i.offsetX,i.offsetY),h=t.Matrix.transform(d,h)),_={x:h.x,y:h.y,width:v.width,height:v.height});return _},i.prototype._getLabelCenter=function(e){var i,a,n=this.diagram.findNode(e._parent),o=this._findLabelAtNode(n,e);if(n.segments)"segmentpath"==e.relativeMode?(o=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(e,n,1,this.diagram),a=t.datavisualization.Diagram.Point(o.position.x+e.margin.left-e.margin.right,o.position.y+e.margin.top-e.margin.bottom)):a=t.datavisualization.Diagram.Point(o.x+e.width/2,o.y+e.height/2);else{i=t.Matrix.identity(),t.Matrix.rotate(i,-n.rotateAngle,n.offsetX,n.offsetY);var s=t.Matrix.transform(i,t.datavisualization.Diagram.Point(o.x,o.y)),r=t.datavisualization.Diagram.Point(s.x+e.width/2,s.y+e.height/2),l=t.Matrix.identity();t.Matrix.rotate(l,n.rotateAngle,n.offsetX,n.offsetY),a=t.Matrix.transform(l,t.datavisualization.Diagram.Point(r.x,r.y))}return a},i.prototype._resizeObject=function(e,i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f,v={snapped:!1,offset:0,left:!1,right:!1},_={snapped:!1,offset:0,top:!1,bottom:!1},y=this.previousPoint,b=this.currentPoint,x=t.datavisualization.Diagram.Point(0,0);switch(l="label"!==e._type?e.rotateAngle:this.diagram._findLabelRotateAngle(e),u=t.Matrix.identity(),t.Matrix.rotate(u,-l),g=t.Matrix.identity(),d=e.text?this._getLabelCenter(e):t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),t.Matrix.rotate(g,l,d.x,d.y),m=e.width,p=e.height,"label"!==e._type?(h=e.offsetX-m*e.pivot.x,c=e.offsetY-p*e.pivot.y):(h=d.x-e.width/2,c=d.y-e.height/2),this._resizeDirection){case"n-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h+m/2,c+p)),f=1,r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(a=this._snapTop(v,_,i,a,e,b==y)),s=(this.initialBounds.height-a)/e.height;break;case"e-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h,c+p/2)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(i=this._snapRight(v,_,i,a,e,b==y,o)),a=0,f=(this.initialBounds.width+i)/e.width,s=1;break;case"w-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h+m,c+p/2)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(i=this._snapLeft(v,_,i,a,e,b==y)),a=0,f=(this.initialBounds.width-i)/e.width,s=1;break;case"s-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h+m/2,c)),f=1,r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),
i=r.x,a=r.y,"label"!==e._type&&(a=this._snapBottom(v,_,r.x,r.y,e,!(!b||!y||b!=y))),s=(this.initialBounds.height+a)/e.height;break;case"ne-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h,c+p)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(i=this._snapRight(v,_,i,a,e,b==y,o),a=this._snapTop(v,_,i,a,e,b==y)),f=(this.initialBounds.width+i)/e.width,s=(this.initialBounds.height-a)/e.height;break;case"nw-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h+m,c+p)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(a=this._snapTop(v,_,i,a,e,b==y),i=this._snapLeft(v,_,i,a,e,b==y)),f=(this.initialBounds.width-i)/e.width,s=(this.initialBounds.height-a)/e.height;break;case"se-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h,c)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(a=this._snapBottom(v,_,i,a,e,b==y,o),i=n?i:this._snapRight(v,_,i,a,e,b==y)),f=(this.initialBounds.width+i)/e.width,s=(this.initialBounds.height+a)/e.height;break;case"sw-resize":x=t.Matrix.transform(g,t.datavisualization.Diagram.Point(h+m,c)),r=t.Matrix.transform(u,t.datavisualization.Diagram.Point(i,a)),i=r.x,a=r.y,"label"!==e._type&&(a=this._snapBottom(v,_,i,a,e,b==y,o),i=this._snapLeft(v,_,i,a,e,b==y)),f=(this.initialBounds.width-i)/e.width,s=(this.initialBounds.height+a)/e.height}return t.datavisualization.Diagram.Rectangle(x.x,x.y,f,s)},i.prototype._selectionContainsChild=function(e){var t,i,a,n,o;if(this.diagram.selectionList[0].children){for(t=this.diagram._getChildren(this.diagram.selectionList[0].children),i=null,a=0;a<t.length;a++)if(i=this.diagram.nameTable[t[a]],i&&i.name==e)return!0}else if("group"===this.diagram.selectionList[0]._type&&"pseudoGroup"!=this.diagram.selectionList[0].type){if(this.diagram.selectionList[0].name==e)return!0}else if(this.diagram.nameTable[e]&&"group"===this.diagram.nameTable[e]._type){for(t=this.diagram._getChildren(this.diagram.nameTable[e].children),n=0;n<t.length;n++)if(i=this.diagram.nameTable[t[n]],i&&(o=this._selectionContainsChild(i.name)),o)return o}else if(this.diagram.selectionList[0].name==e)return!0;return!1},i.prototype._isSelected=function(e){var t,i,a=null,n=this.diagram.nameTable[e];if(this._selectionContainsChild(n.name))return!0;if("group"===n._type)for(t=this.diagram._getChildren(n.children),i=0;i<t.length;i++)if(a=t[i],this._selectionContainsChild(a))return!0;return!1},i.prototype._isColleagueSelected=function(e){var t,i,a,n=this.diagram.nameTable[e],o=null;if(n.parent&&(t=this.diagram.nameTable[n.parent]))for(i=this.diagram._getChildren(t.children),a=0;a<i.length;a++)if(o=i[a],this._isSelected(o))return!0;return!1},i.prototype._isInSelection=function(e){var t,i,a;if("pseudoGroup"==this.diagram.selectionList[0].type&&this.diagram.selectionList[0].children)for(t=this.diagram._getChildren(this.diagram.selectionList[0].children),i=null,a=0;a<t.length;a++)if(i=this.diagram.nameTable[t[a]],i.name==e)return!0},i.prototype._getCloneNode=function(e){var t=null;return t=jQuery.extend(!0,{},e),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},i.prototype._getProcessedObject=function(e){var t,i=this.diagram.nameTable[e];if(i){if(this._isInSelection(e))return null;if(this._selectionContainsChild(i.name))return{add:i,remove:null};if(!i.parent)return{add:i,remove:null};if(!this._selectionContainsChild(i.parent))return this._isColleagueSelected(i.parent)&&!this._selectionContainsChild(i.parent)?this._isSelected(i.parent)?{add:i,remove:null}:{add:this.diagram.nameTable[i.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(i.parent)?{add:this.diagram.nameTable[i.name],remove:this.diagram.nameTable[i.parent]}:this._getProcessedObject(i.parent);if(this._isInSelection(i.parent))return{add:i,remove:this.diagram.nameTable[i.parent]};if(t=this.diagram.nameTable[i.parent])return{add:t,remove:this.diagram.nameTable[t.parent]}}},i.prototype.hasSameParent=function(){var e,t,i,a,n;if("pseudoGroup"==this.selectedObject.type){if(e=this.selectedObject,t=null,this.diagram.nameTable[this.diagram._getChild(e.children[0])])for(i=this.diagram.nameTable[this.diagram._getChild(e.children[0])].parent,a=this.diagram._getChildren(e.children),n=0;n<a.length;n++)if(t=this.diagram.nameTable[a[n]],t.parent!=i||""==t.parent)return!1;return!0}return!1},i.prototype._fromDiagram=function(e){for(var t=!0,i=null,a=0;a<e.length;a++)if(i=this.diagram.nameTable[this.diagram._getChild(e[a])],i&&i.parent){t=!1;break}return t},i.prototype._fromContainer=function(e){for(var t=null,i=null,a=0;a<e.length;a++)if(t=this.diagram.nameTable[this.diagram._getChild(e[a])],t.parent&&(i=this.diagram.nameTable[t.parent],i&&i.container))return!0},i.prototype._fromSameContainer=function(e){for(var t=null,i=null,a=0;a<e.length;a++)if(t=this.diagram.nameTable[this.diagram._getChild(e[a])],!i&&t.parent&&(i=t.parent),t.parent&&t.parent!=i)return!1;return!0},i.prototype._anyFromContainer=function(e){for(var t=null,i=null,a=0;a<e.length;a++)if(t=this.diagram.nameTable[this.diagram._getChild(e[a])],t.parent&&(i=this.diagram.nameTable[t.parent]),i&&i.container&&"canvas"===i.container.type)return!0;return!1},i.prototype._processCtrlKey=function(i){var a,n,o,s,r,l,d;if(this.diagram.selectionList.length>0&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)){var h,l,c,u=this.diagram.selectionList,g=[],m=[],p=[];"pseudoGroup"==u[0].type?(h=!0,a=this._findNodeUnderMouse(i)):a=this._findNodeUnderMouse(i);var f=this._findNodeUnderMouse(i,!0),v=this.selectedObject,_=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:f,cancel:!1,event:i});if(this._itemClick(this.selectedObject,this.actualObject,f),_.cancel&&(this.selectedObject=v),this.actualObject)if(this.actualObject.parent)h?(n=u[0],o=this._getProcessedObject(this.actualObject.name),o?(this.selectedObject?(n.children=this.diagram._getChildren(n.children),t.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name)):o.remove&&(n.children=this.diagram._getChildren(n.children),t.datavisualization.Diagram.Util.removeItem(n.children,o.remove.name)),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||n.children.push(this.selectedObject.name):o.add&&(this._hasMultipleSelection(o.add)||n.children.push(o.add.name))):(l=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(n.children=this.diagram._getChildren(n.children),t.datavisualization.Diagram.Util.removeItem(n.children,this.selectedObject.name)):n.children.push(this.selectedObject.name):this._hasMultipleSelection(l)?(n.children=this.diagram._getChildren(n.children),t.datavisualization.Diagram.Util.removeItem(n.children,l.name)):n.children.push(l.name)),t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),n.children.length<=1?(s=this.diagram.nameTable[this.diagram._getChild(n.children[0])],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.selectedObject=s,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=u[0],this.diagram.updateSelection())):("group"===this.diagram.selectionList[0]._type&&"bpmn"!==this.diagram.selectionList[0].type?(u=this.diagram.selectionList[0],o=this._getProcessedObject(this.actualObject.name),l=o.add,o&&this.diagram._hasSelection()&&this.diagram._clearSelection()):(o=null,"group"===a._type&&(o=this._getProcessedObject(this.actualObject.name)),l=o?o.add:a,u=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection()),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,d=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u.name!=l.name&&d.children.push(u.name),this.selectedObject?d.children.push(this.selectedObject.name):this._containsChild(d,l.name)&&d.children.push(l.name),this._checkRepeatedChild(d.children),this.diagram.nodes().push(d),this.diagram._nodes=e.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[d.name]=d,t.datavisualization.Diagram.Util._updateGroupBounds(d,this.diagram),this.selectedObject=d,this.diagram._addSelection(this.selectedObject));else if(h){for(n=u[0],l=this.selectedObject?this.selectedObject:this.actualObject,c=this._hasMultipleSelection(l)?"remove":"insert","insert"==c?(n.children.push(l.name),g.push(l)):(t.datavisualization.Diagram.Util.removeItem(n.children,l.name),m.push(l)),r=0;r<n.children.length;r++)p.push(this.diagram.nameTable[this.diagram._getChild(n.children[r])]);_={changeType:c,state:"changing",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:m,newItems:g,cancel:!1},this._raiseEvent("selectionChange",_),_.cancel||("remove"==c&&t.datavisualization.Diagram.Util.removeItem(this.diagram.model.selectedItems.children,l),this.diagram.updateSelection(this.selectedObject),t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),this.selectedObject=u[0],this.diagram.model.selectedItems.children.length?t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints):(t.datavisualization.Diagram.Util.clear(this.diagram.selectionList),t.datavisualization.Diagram.SvgContext.clearSelector(this.diagram._adornerSvg,this.diagram._adornerLayer,this)),_={changeType:c,state:"changed",element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:m,newItems:g,cancel:!1},this._raiseEvent("selectionChange",_))}else l=this.actualObject,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,u=this.diagram.selectionList[0],l!=u&&(this.diagram._hasSelection()&&this.diagram._clearSelection(!0),d=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),d.children.push(u.name),this.selectedObject?d.children.push(this.selectedObject.name):d.children.push(l.name),this.diagram.nodes().push(d),this.diagram._nodes=e.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[d.name]=d,t.datavisualization.Diagram.Util._updateGroupBounds(d,this.diagram,null,!0),this.selectedObject=d,this.diagram._addSelection(this.selectedObject));this.selectedObject=this.diagram.selectionList[0]}else a=this._findNodeUnderMouse(i),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(this.selectedObject=a);return a},i.prototype._checkRepeatedChild=function(i){for(var a,n=null,o=e.extend(!0,{},i),o=this.diagram._getChildren(o),s=0;s<o.length;s++)if(n=this.diagram.nameTable[o.children[s]],"group"===n._type)for(a=0;a<o.children.length;a++)this._containsChild(n,o.children[a])||(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,o.children[a]))},i.prototype._hasMultipleSelection=function(e){for(var t=this.diagram._getChildren(this.diagram.selectionList[0].children),i=0;i<t.length;i++)if(e.name==t[i])return!0;return!1},i.prototype._getNextParent=function(e){if(e.parent){var t=this.diagram.nameTable[e.parent];return this._hasMultipleSelection(t)?e:this._getNextParent(t)}return e},i.prototype._findObj=function(e,t){var i,a,n=e.getAttribute("id");return t?i=this.diagram._findChildren(t,n):(a=e.getAttribute("class"),a&&("ej-d-node"===a||"ej-d-group"===a?i=this.diagram._findNode(n):"ej-d-connector"===a&&(i=this.diagram._findConnector(n)))),i},i.prototype.mousedown=function(e){this.startPoint=this.mousePosition(e),this.currentPoint=this.startPoint,this.previousPoint=this.startPoint,this.diagramBounds=this.diagram._getDigramBounds()},i.prototype._isPolyline=function(){return"connector"===this.diagram.model.drawType.type&&this.diagram.model.drawType.segments&&this.diagram.model.drawType.segments.length>0&&"polyline"===this.diagram.model.drawType.segments[0].type?!0:void 0},i.prototype.mousemove=function(e){(!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this instanceof t.datavisualization.Diagram.LineTool||this._isPolyline()||this.diagram.model.rulerSettings.showRulers)&&(this.currentPoint=this.mousePosition(e)),this._drawRulerMarkers(e)},i.prototype._removeRulerMarkers=function(){var e,t,i=document.getElementsByClassName("ej-d-ruler-marker");if(i&&i.length>0)for(t=i.length-1;t>=0;t--)e=i[t],e&&e.parentNode.removeChild(e)},i.prototype._drawRulerMarker=function(e,i,a,n){var o,s,r,l,d,h,c,u,g,m;if(e){if(u=i[0].getElementsByTagName("svg"),u.length>0)for(d in u){o=u[d];break}o&&(s=t.datavisualization.Diagram.ScrollUtil._getRulerSize(this.diagram),h=n?{id:i[0].id+"_marker",x1:0,y1:0,x2:s.left,y2:0,stroke:e.markerColor,"stroke-width":1.5,"class":"ej-d-ruler-marker"}:{id:i[0].id+"_marker",x1:0,y1:0,x2:0,y2:s.top,stroke:e.markerColor,"stroke-width":1.5,"class":"ej-d-ruler-marker"},c=this._createMarkarLine(i,h),r=this.diagram._currZoom,l=a.model.offset-a._starValue,n?(m=this.currentPoint.y*r-this.diagram._vScrollOffset+l,c.setAttribute("transform","translate(0 "+m+")")):(g=this.currentPoint.x*r-this.diagram._hScrollOffset+l,c.setAttribute("transform","translate("+g+" 0)")),o.appendChild(c))}},i.prototype._createMarkarLine=function(e,i){if(e){var a=document.getElementById(e[0].id+"_marker");return a&&a.parentNode.removeChild(a),a=document.createElementNS("http://www.w3.org/2000/svg","line"),t.datavisualization.Diagram.Util.attr(a,i),a}},i.prototype._drawRulerMarkers=function(){this.diagram.model.rulerSettings.showRulers&&(this._drawRulerMarker(this.diagram.model.rulerSettings.horizontalRuler,this.diagram._hRuler,this.diagram._hRulerInstance,!1),this._drawRulerMarker(this.diagram.model.rulerSettings.verticalRuler,this.diagram._vRuler,this.diagram._vRulerInstance,!0))},i.prototype.mouseup=function(){this._endAction(),this.diagram._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(this.diagram),this.singleAction&&this.diagram.activateTool("select"),delete this.diagramBounds,this._adjustLines={lines:[]},this._undoObject=null,this._redoObject=null},i.prototype.mousePosition=function(e){return this.diagram._mousePosition(e)},i.prototype.updateCursor=function(e){this.diagram._currentCursor=e,this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(e){var i=t.datavisualization.Diagram.Point();if(this.diagram.model.snap&t.datavisualization.Diagram.Snap.Grid){var a=this.diagram.model.magnification/100,n=this.diagram.model.grid.horizontalSpacing*a,o=this.diagram.model.grid.verticalSpacing*a,s=e.x%n,r=e.y%o;i.x=s>=n/2?e.x+n-s:e.x-s,i.y=r>=o/2?e.y+o-r:e.y-r}return i},i.prototype.snap=function(e){var i=this.diagram.model.snapSettings,a=this.diagram._currZoom;return i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(e.x=t.datavisualization.Diagram.SnapUtil._round(e.x,i.verticalGridLines.snapInterval,a)),i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(e.y=t.datavisualization.Diagram.SnapUtil._round(e.y,i.horizontalGridLines.snapInterval,a)),e},i.prototype._endAction=function(){var i,a,n,o,s,r,l,d,h;if(this.inAction=!1,this.svgHelper)if(i=this.helper,a=this.diagram._spatialSearch,"group"!=i._type)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(a,a.quadTable[i.name],i);else for(n=this.helper.children.length-1,o=n;o>=0;o--)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(a,a.quadTable[i.children[o].name],i.children[o]);this.helper&&(this.svgHelper&&(s=this.diagram,r=this,this.diagram._views.forEach(function(t){var i=s._views[t];if(r.helper)var a=i.svg.getElementById(r.helper.name),n=i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],o=e(n).find("#"+r.helper.name)[0];a&&a.parentNode&&a.parentNode.removeChild(a),o&&n.removeChild(o)})),this.helper.gradient&&(l=this.diagram._svg.getElementsByTagName("defs")[0],d=this.diagram._svg.getElementById(this.helper.name+"_gradient"),l&&d&&l.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))),h=document.getElementById(this.helper.name+"_parentdiv"),h&&h.parentNode.removeChild(h)),this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)),this._currentPossibleConnection=null,this._possibleConnectionPort=null,this.helper=null,this.svgHelper=null,this.selectedObject=null,this.startPoint=t.datavisualization.Diagram.Point(0,0),this.currentPoint=t.datavisualization.Diagram.Point(0,0),this.previousPoint=t.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(e){var t=!1;switch(e){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":t=!0}return t},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=e.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(e,t){var i,a,n,o,s;for(t?e.name+="helper":e.name="helper",e.opacity=.5,i=e.labels,a=0,n=i.length;n>a;++a)i[a].name+="helper";if(e.ports)for(o=e.ports,a=0,n=o.length;n>a;++a)o[a].name+="helper";if("group"===e._type)for(s=this.diagram._getChildren(e.children),a=0,n=s.length;n>a;a++)this._updateHelperName(s[a],!0)},i.prototype._raiseEvent=function(e,t){return this.diagram.model[e]&&(t.elementType=this.diagram.getObjectType(t.element),t.diagramId=this.diagram.element[0].id,this.diagram._trigger(e,t)),t},i.prototype._findPort=function(e,t){var i,a,n,o,s=this.diagram._findPortAtPoint(e,t);if(!s&&"group"===t._type)for(a=this.diagram._getChildren(t.children),n=0;n<a.length;n++)if(o=this.diagram.nameTable[a[n]],o&&!o.segments&&!o._isInternalShape)if(i=this._findPort(e,o),i&&"group"!=this.diagram.getObjectType(o))this._currentPossibleConnection=o,s=i;else if(i)return i;return s},i.prototype._checkConnectionPossible=function(e){var i,a,n,o,s,r,l,d,h=null,c=null,u=this._sourcePossibleConnection,g=t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),m=this.diagram._findConnectableNodeUnderMouse(e);if(m&&(this._sourcePossibleConnection||this.selectedObject)&&(this.selectedObject&&("targetEndPoint"==this._endPoint&&this.selectedObject.sourceNode&&(u=this.diagram.nameTable[this.selectedObject.sourceNode]),"sourceEndPoint"==this._endPoint&&this.selectedObject.targetNode&&(u=this.diagram.nameTable[this.selectedObject.targetNode])),this.selectedObject&&!this.selectedObject._isAnnotationLine&&(m=t.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,u,m))),m&&!m.segments)"pseudoGroup"==m.type||m.isLane||m.isSwimlane?(this._currentPossibleConnection=null,this._possibleConnectionPort=null):(this._showPorts(m),this._currentPossibleConnection=m,(null==this._previousPossibleConnection||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof t.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(i=t.datavisualization.Diagram.Point(0,0),"targetEndPoint"==this._endPoint?(i.x=this.selectedObject.targetPoint.x-25,i.y=this.selectedObject.targetPoint.y-25):"sourceEndPoint"==this._endPoint&&(i.x=this.selectedObject.sourcePoint.x-25,i.y=this.selectedObject.sourcePoint.y-25),a=t.datavisualization.Diagram.Rectangle(i.x,i.y,50,50),n=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,a),o=0;this._nearestNodes&&o<this._nearestNodes.length;o++)this._showPort(this._nearestNodes[o],!0);for(this._nearestNodes=[],o=0;o<n.length;o++)if(s=n[o],s.objects.length>0)for(r=0;r<s.objects.length;r++)l=s.objects[r],d=t.datavisualization.Diagram.Util.bounds(l),t.datavisualization.Diagram.Geometry.intersectsRect(a,d)?!l.segments&&l.visible&&(this._showPort(l),this._nearestNodes.push(l)):l.segments||this._showPort(l,!0);this._currentPossibleConnection=null,this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(h=this._findPort(g,this._currentPossibleConnection),this._currentPossibleConnection&&(this._sourcePossibleConnection||this.selectedObject)&&this.selectedObject&&!this.selectedObject._isAnnotationLine&&(c=t.datavisualization.Diagram.bpmnHelper.canAllowConnection(this.diagram,u,this._currentPossibleConnection),this._currentPossibleConnection!=c&&(this._showPort(this._currentPossibleConnection,!0),c&&this._showPort(c),h=null),this._currentPossibleConnection=c),h&&t.datavisualization.Diagram.Util.canConnect(h,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(h,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.diagram):t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=h,h&&t.datavisualization.Diagram.Util.canConnect(h,!0)){var p=this._currentPossibleConnection,f=t.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,t.datavisualization.Diagram.Util.bounds(p,!0)),v=t.Matrix.identity();t.Matrix.rotate(v,p.rotateAngle,p.offsetX,p.offsetY),f=t.Matrix.transform(v,f),this.currentPoint=f}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(e){e?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==e.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(e)):null!=this._currentPossibleConnection&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(e,i){var a,n,o,s,r;if(i){if(a=e.ports)for(s=0,r=a.length;r>s;++s)n=a[s],(n.visibility&t.datavisualization.Diagram.PortVisibility.Hover||n.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&("endPoint"==this.name||this instanceof t.datavisualization.Diagram.LineTool))&&(o=this.diagram._adornerSvg.getElementById(e.name+"_"+n.name),o&&o.setAttribute("visibility","hidden"))}else if(e.visible&&(a=e.ports))for(s=0,r=a.length;r>s;++s)n=a[s],(n.visibility&t.datavisualization.Diagram.PortVisibility.Hover||n.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&("endPoint"==this.name&&this.inAction||this instanceof t.datavisualization.Diagram.LineTool))&&(o=this.diagram._adornerSvg.getElementById(e.name+"_"+n.name),o&&o.setAttribute("visibility","visible"))},i.prototype._getAllLaneChildren=function(e,t){var i,a,n=this.diagram.getNode(e.name);if(n&&n.lanes&&n.lanes.length>0)for(i=0;i<n.lanes.length;i++)for(a=0;a<n.lanes[i].children.length;a++)t.push(n.lanes[i].children[a]);return t},i.prototype._getAllChildren=function(e){for(var t=0;t<e.length;t++)e[t].isSwimlane&&e.concat(this._getAllLaneChildren(e[t],e));return e},i.prototype._showAllPorts=function(e){var i,a,n=this.diagram.nodes();if(n=n.slice(),n=this._getAllChildren(n),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)||(e=!0),e)for(i=0,a=n.length;a>i;i++)this._showPort(n[i],e);else for(i=0,a=n.length;a>i;++i)this._showPort(n[i])},i.prototype._disconnect=function(e){var i,a=this.diagram.nameTable[e.targetNode],n=null;a&&(n=t.datavisualization.Diagram.Util.findPortByName(a,e.targetPort),i=this._raiseEvent("connectionChange",{element:e,connection:null,port:null,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(a.inEdges,e.name),i.cancel||(e.targetNode=null,e.targetPort=null)),a=this.diagram.nameTable[e.sourceNode],a&&(n=t.datavisualization.Diagram.Util.findPortByName(a,e.sourcePort),i=this._raiseEvent("connectionChange",{element:e,connection:null,port:null,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(a.outEdges,e.name),i.cancel||(e.sourceNode=null,e.sourcePort=null))},i.prototype.getLabelUnderMouse=function(){return this.diagram._findLabelEditing?null:this.activeLabel},i.prototype._getNodesfrombounds=function(e,i){for(var a,n,o,s,r,l,d=[],h=this.diagram._sortByZIndex(this.diagram.nodes()),c=0,u=h.length;u>c;c++)o=this.diagram.nameTable[h[c].name],t.datavisualization.Diagram.Util.canConnect(o)&&(a=t.datavisualization.Diagram.Util.bounds(o,!1),s=[a.points[0],a.points[1],a.points[2],a.points[3],a.points[0]],r=[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.right,y:e.bottom},{x:e.left,y:e.bottom},{x:e.left,y:e.top}],this.diagram._autoConnectEndPoint=!0,n=t.datavisualization.Diagram.Util.interSect(s,r,null,this.diagram),delete this.diagram._autoConnectEndPoint,l=!1,0==n.length&&(l=t.datavisualization.Diagram.Geometry.containsPoint(a,i)),(n&&n.length||l)&&d.push(o));return this._getAllChildren(d)},i.prototype._slopDistance=function(e,t,i){var a,n,o,s,r,l,d,h,c,u;r=i.x,l=i.y,a=e.x,n=e.y,o=t.x,s=t.y;var g=r-a,m=l-n,p=o-a,f=s-n,v=g*p+m*f,_=p*p+f*f,y=-1;return 0!=_&&(y=v/_),0>y?(d=a,h=n):y>1?(d=o,h=s):(d=a+y*p,h=n+y*f),c=r-d,u=l-h,Math.sqrt(c*c+u*u)},i.prototype._getNearestNodePorts=function(e,i,a,n){var o,s,r,l,d,h,c,u,g,m=null,p=null;for(n.x=n.left,n.y=n.top,n.width=n.right-n.left,n.height=n.bottom-n.top,o=0;o<i.length;o++)for(r=this.diagram.nameTable[i[o].name],c=t.datavisualization.Diagram.Util.bounds(r),s=0;r.ports&&r.ports.length>0&&s<r.ports.length;s++)l=r.ports[s],h=t.datavisualization.Diagram.Util._getPortPosition(l,c),g=t.Matrix.identity(),t.Matrix.rotate(g,r.rotateAngle,r.offsetX,r.offsetY),h=t.Matrix.transform(g,h),u=t.datavisualization.Diagram.Geometry.distance(h,this.currentPoint),(!d||d&&d>u)&&(d=u,t.datavisualization.Diagram.Geometry.containsPoint(n,h)&&(m=l),p=r);return{nearestNode:p,nearestPort:m}},i.prototype._updateConnectionTarget=function(e,i){"targetEndPoint"==this._endPoint;if(e=i?e:this.diagram.nameTable[this.diagram._getChild(e)]){var a=this.currentPoint,n={left:a.x-e._endPointHitPadding.left,top:a.y-e._endPointHitPadding.top,right:e._endPointHitPadding.right+a.x,bottom:e._endPointHitPadding.bottom+a.y},o=this._getNodesfrombounds(n,a),s=this._getNearestNodePorts(e,o,a,n);s.nearestNode&&(this._currentPossibleConnection=s.nearestNode,s.nearestPort&&(t.datavisualization.Diagram.Util.canConnect(s.nearestPort,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection))&&(this._possibleConnectionPort=s.nearestPort)),this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(this._possibleConnectionPort,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._currentPossibleConnection&&t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom),this.diagram._dock(e,this.diagram.nameTable,!0)}},i.prototype._raiseConnectionChangeEvent=function(e,i){var a,n={element:e,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1},o=n.connection?n.connection.name:null,s=n.port?n.port.name:null;return i?(o!=e.targetNode||s!=e.targetPort)&&(n=this._raiseEvent("connectionChange",n)):(o!=e.sourceNode||s!=e.sourcePort)&&(n=this._raiseEvent("connectionChange",n)),n.cancel?void 0:(i?(this._currentPossibleConnection&&e.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(e.name),e.targetNode&&(a=this.diagram.nameTable[e.targetNode],a&&t.datavisualization.Diagram.Util.removeItem(a.inEdges,e.name))),this.diagram._comparePropertyValues(e,"targetNode",{targetNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),e.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,this.diagram._comparePropertyValues(e,"targetPort",{targetPort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),e.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&e.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(e.name),e.sourceNode&&(a=this.diagram.nameTable[e.sourceNode],a&&t.datavisualization.Diagram.Util.removeItem(a.outEdges,e.name))),this.diagram._comparePropertyValues(e,"sourceNode",{sourceNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),e.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,this.diagram._comparePropertyValues(e,"sourcePort",{sourcePort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),e.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0)},i}(),t.datavisualization.Diagram.ToolBase=i,a=function(i){function a(e){i.call(this,"select",e),this.cursor="default",this._svgHelper=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){i.prototype.mousedown.call(this,e);var a=this._findNodeUnderMouse(e);this.selectedObject=a&&t.datavisualization.Diagram.Util.canSelect(a)&&t.datavisualization.Diagram.Util.enableLayerOption(a,"lock",this.diagram)?a:null,this._itemClick(this.selectedObject,this.actualObject,this.selectedObject),this._nodeUnderMouseDown=this.diagram._findNodeUnderMouse(e)},a.prototype.mousemove=function(e){i.prototype.mousemove.call(this,e);var a=this._nodeUnderMouseDown;(!this.selectedObject&&!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||a&&a.isLane&&t.datavisualization.Diagram.Util.canMultiSelectOnLane(a)||a&&"connector"!=a._type&&t.datavisualization.Diagram.Util.canMultiSelectOnNode(a))&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},a.prototype.mouseup=function(a){var n,o,s,r,l,d,h,c;if(this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction)if(this.currentPoint=this.mousePosition(a),n=t.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}]),0!==n.width||0!==n.height){if(o=[],o=this.diagram._getNodesfrombounds(n),this.diagram._hasSelection()&&(o=this.diagram._getChildren(o),t.datavisualization.Diagram.Util.removeItem(o,"multipleSelection"),this.diagram._clearSelection(!!o.length)),o.length>0){if(s=o,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.RubberBand,s.length>1){for(l=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),d=0;d<s.length;d++)l.children.push(this.diagram._getChild(s[d]));this.diagram.nodes().push(l),this.diagram._nodes=e.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[l.name]=l,r=l}else t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(r=o[0]);r&&(("group"===r._type||"pseudoGroup"===r.type)&&t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.diagram._addSelection(r))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(a.ctrlKey||a.shiftKey?t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&this._processCtrlKey(a):this.diagram._hasSelection()&&(!this.selectedObject||this.diagram.selectionList[0].name!=this.selectedObject.name)&&this.diagram._clearSelection(!!this.selectedObject),this.diagram._enableAPIMethods=!1,
this.diagram._addSelection(this.selectedObject),this.diagram._enableAPIMethods=!0):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1,this._nodeUnderMouseDown=null,(this.selectedObject||this.actualObject)&&(h=this._findNodeUnderMouse(a),c=this.diagram._mousePosition(a.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(h),actualObject:this.actualObject,count:this.diagram._getEventDetail(a),offsetX:c.x,offsetY:c.y,event:a})),i.prototype.mouseup.call(this,a)},a.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null),i.prototype._endAction.apply(this)},a.prototype._initHelper=function(){var e,t,i;this._svgHelper||(e=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(e),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper","class":"rubberBandSelection",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),e.appendChild(i),e.setAttribute("pointer-events","none"),this._svgHelper=e)},a.prototype._updateHelper=function(){var e=this.diagram._adornerSvg.getElementById("helper"),t=Math.abs(this.startPoint.x-this.currentPoint.x),i=Math.abs(this.startPoint.y-this.currentPoint.y),a=this.diagram._currZoom,n=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*a,o=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*a;e&&this.diagram._adornerSvg.rect({id:e.id,x:n,y:o,width:t*a,height:i*a})},a}(i),t.datavisualization.Diagram.SelectTool=a,n=function(i){function a(e){i.call(this,"move",e),this.cursor="move",this._isMouseDown=!1,this.diffx=0,this.diffy=0,this.helper=null,this.hoverNode=null,this.stackOverNode=null,this.undoObject=[],this.activeLabel=null,this._canMoveLabel=!1,this.dragState=""}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diffx=0,this.diffy=0,this._allowPan(this.selectedObject,"mousedown",e),i.prototype.mousedown.call(this,e),this._isMouseDown=!0,this._canMoveLabel=!1,this.activeLabel=null,e)var a=this._findNodeUnderMouse(e);a&&!t.datavisualization.Diagram.Util.canSelect(a)&&t.datavisualization.Diagram.Util.enableLayerOption(a,"lock",this.diagram)?this.updateCursor("default"):"pointer"!=this.diagram._currentCursor&&this.updateCursor(this.cursor),this.dragState=t.datavisualization.Diagram.DragState.Starting},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h;this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this._allowPan(this.selectedObject,"mousemove",a),i.prototype.mousemove.call(this,a),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),n=!this.inAction,this._isMouseDown&&!this.inAction&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y||this.diagram._selectedSymbol)&&!this.selectedObject&&(this.diagram.selectionList&&this.diagram.selectionList[0]&&"pseudoGroup"===this.diagram.selectionList[0].type||this.diagram._selectedSymbol||t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram))&&(this._updateSelectedObject(),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),null!=this.selectedObject&&(o=s=t.datavisualization.Diagram.Util.bounds(this.selectedObject),r={bounds:{x:s.x,y:s.y,width:s.width,height:s.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},l={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection(!0),this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:r,newValue:l,cancel:!1}),d={},this.selectedObject&&("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(d=this.diagram._getChildTable(this.selectedObject,d)),h=e.extend(!0,{},{childTable:d,node:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},h))),this._isMouseDown&&this.selectedObject&&t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&!this.diagram._isEditing&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(this.dragState=t.datavisualization.Diagram.DragState.Dragging,this.inAction||(this.inAction=!0,this.updateCursor("move"),this._updateSelection(),this.selectedObject.segments&&(t.datavisualization.Diagram.Util.isTargetConnected(this.selectedObject)||t.datavisualization.Diagram.Util.isSourceConnected(this.selectedObject))&&this._disconnect(this.selectedObject),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram)),this.diagram&&!this.diagram._isEditing&&(this._containerMouseMove(a),this.helper||this._updateObject(),this.selectedObject.segments||this.selectedObject.isLane||this.diagram._renderTooltip(this.selectedObject,n),this.diagram._updateSelectionHandle(!0))),this.previousPoint=this.currentPoint,this._stackOverNode=this._findStackOverNode(this.helper,a),delete this.diagram._notAllow},a.prototype._updateSelectedObject=function(){var e=this.diagram._focusedElement;e&&(this.diagram.selectionList[0]&&"pseudoGroup"==this.diagram.selectionList[0].type?this.selectedObject=this.diagram.selectionList[0]:this.diagram.selectionList[0]!=e?(this.diagram._clearSelection(!0),this.selectedObject=this.diagram.nameTable[e.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name])},a.prototype._nodeCanHighlight=function(e){var t=!1;return-1==this.diagram._getChildren(e.children).indexOf(this.selectedObject.name)&&("group"!=this.selectedObject._type?t=!0:"group"===e._type&&(this._containsChild(this.selectedObject,e.name)||(t=!0))),t},a.prototype._swimlanPhaseDrag=function(){if(this.selectedObject&&this.selectedObject.isPhase){var e=null,i=this._getNodeUnderMouse();i&&(e=this._getSwimLaneNode(i,this.selectedObject,!0)),e&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(e,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom)}},a.prototype._containerMouseMove=function(e){var i,a,n,o=this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent];o&&o.container?(n=o.container,("canvas"==n.type||"stack"==n.type)&&(t.datavisualization.Diagram.canvasHelper._updateHelper(this.diagram),t.datavisualization.Diagram.canvasHelper._updateHighlighter(this.diagram,e))):(this.selectedObject.isSwimlane||("pseudoGroup"==this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?this._removeHighLighter():this.isDiagram(e)||this.selectedObject.segments?!this.isDiagram(e)&&this.selectedObject.isPhase?t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram):this._removeHighLighter():(i=this._getNodeUnderMouse(),i&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&"stack"!=i.container.type?(this.selectedObject.name!=i.name&&"pseudoGroup"!=this.selectedObject.type&&t.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,i)&&this._nodeHighLighter(i),i&&("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this._fromDiagram(this.selectedObject.children)&&this._nodeHighLighter(i)):i&&(this._removeHighLighter(),i.segments?t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(i,this.diagram,this.diagram._currZoom):this._nodeHighLighter(i)))),a||("pseudoGroup"==this.selectedObject.type?this._fromDiagram(this.diagram._getChildren(this.selectedObject.children))?(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)):(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint):t.datavisualization.Diagram.Util.canMove(this.selectedObject)&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint))),this._swimlanPhaseDrag(e)},a.prototype.isDiagram=function(e){return!(e.target.id!=this.diagram._id+"_canvas_svg"&&!e.target.id.match(this.selectedObject.name))},a.prototype._allowPan=function(e,i,a){"mousedown"===i&&this.diagram.tools.panTool.mousedown(a),e&&("group"===e._type||"node"==e._type)&&e.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan&&("mousemove"===i?this.diagram.tools.panTool.mousemove(a):"mouseup"===i&&this.diagram.tools.panTool.mouseup(a))},a.prototype._checkForDropEvent=function(e,i){var a;if(!this.diagram._selectedSymbol){var n=this.diagram,o=e,s=null,r=t.datavisualization.Diagram.ObjectTypes.Diagram;this.selectedObject&&this.selectedObject.parent&&(n=this.diagram.nameTable[this.selectedObject.parent],n.isLane?r=t.datavisualization.Diagram.ObjectTypes.Lane:"group"==n._type&&(r=t.datavisualization.Diagram.ObjectTypes.Group)),e&&!i&&(s=t.datavisualization.Diagram.Util.bounds(e),o=this._getTargetNode(e,s));do{if(!e||t.datavisualization.Diagram.Util.canAllowDrop(e))break;if(e.parent)e=this.diagram.nameTable[e.parent];else{if(e.container)break;e=null}}while(e);if(e)return a=this._raiseEvent("drop",{cancel:!1,element:this.selectedObject,source:this.diagram.getNode(n),target:this.diagram.getNode(o),sourceType:r}),a.cancel}return!1},a.prototype._getSwimLaneNode=function(e,t,i){if(e.isSwimlane)if(i){if(this.diagram.nameTable[this.diagram._getChild(e.children[2])].container.orientation==t.orientation)return e}else if(this.diagram.nameTable[this.diagram._getChild(e.children[2])].container.orientation!=t.orientation)return e;if(e.parent){var a=this.diagram.nameTable[e.parent];if(a)return this._getSwimLaneNode(a,t,i)}return null},a.prototype._cloneGroupNode=function(t,i){var a,n,o,s,r=null;if(n=e.extend(!0,{},t),n.name+=i,t&&"group"===t._type)for(n.children=[],o=this.diagram._getChildren(t.children),s=0;s<o.length;s++)r=this.diagram.nameTable[o[s]],a=e.extend(!0,{},r),a.name+=i,a.parent&&(a.parent+=i),"group"===a._type&&this._cloneGroupNode(a,i),this.diagram.nameTable[a.name]=a,n.children.push(a);return n},a.prototype._outOfBoundsLaneDrop=function(e,i){var a,n,o;if(e&&e.isLane&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var s=(t.datavisualization.Diagram.Util.bounds(e),this._getPageBounds()),r=i.offsetX,l=i.offsetY,d=0,h=0,c=0,u=0,g=this.diagram.nameTable[this.diagram._getChild(i.children[2])],m=this.diagram.nameTable[this.diagram._getChild(i.children[0])];if(u=m?m.height:u,c=i.phaseSize?i.phaseSize:c,g&&(a=this.diagram.nameTable[this.diagram._getChild(g.children[0])],a&&(d=a.minHeight>100?a.minHeight:100,h=a.minWidth>100?a.minWidth:100)),"horizontal"===e.orientation?(n=h,o=d+m.height+c):(n=h+c,o=d+m.height),r+n/2+5>=s.width||r-n/2-5<=s.x||l+o/2+5>=s.height||l-o/2-5<=s.y)return!1}return!0},a.prototype._getMouseOverElement=function(t,i){var a,n,o,s=null;if(t&&t.target)for(var r=e(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group,.ej-d-group ej-d-classifier,.ej-d-node ej-d-classifier,.ej-d-label ej-d-classifier"),l=r[0],d=1;l;)if(a=this.diagram._isForeignObject(t.target),a?s=this.diagram._findNode(l.getAttribute("id").split("_parentdiv")[0]):(s=this.diagram._findNode(l.getAttribute("id")),s||(s=this.diagram._findNode(l.getAttribute("id").split("_label")[0]))),s&&s.container)l=null;else{if(s&&i&&s._isHeader&&s.parent&&(n=this.diagram.nameTable[s.parent],n&&n.isSwimlane))break;l=r[d],!l&&s&&s.parent&&(o=this.diagram.nameTable[s.parent],o&&o.isLane&&(s=o)),d++}return s},a.prototype._multiNodedrag=function(e){t.datavisualization.Diagram.canvasHelper&&!this._containsSwimlane(this.selectedObject.children)&&t.datavisualization.Diagram.canvasHelper._multiNodedrag(this.diagram,e,this.selectedObject)},a.prototype._changeNodeState=function(e,i,a){var n,o,s,r,l,d,h,c,u,g=null,m=this._getMouseOverElement(e,a);return m&&(m=this.selectedObject&&!this.selectedObject.isLane||m.isLane?m:null),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(this.diagram._isDragg=!0,m&&(g=this._getSwimLaneNode(m,this.selectedObject)),m&&g?t.datavisualization.Diagram.canvasHelper._addNewLane(this.diagram,m,g):(o=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],this.diagram._isUndo=!0,this.diagram.remove(this.selectedObject),t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.selectedObject),this.diagram._selectedSymbol&&t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.diagram._selectedSymbol),this.diagram._isUndo=!1,s=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram,null,null,o),s&&(r={element:this.diagram.getNode(this.selectedObject),cancel:!1},this.diagram._selectedSymbol=null,this._outOfBoundsLaneDrop(this.selectedObject,s)?(this.diagram._raiseDropEvent(r),r.cancel?this.selectedObject=null:(this.diagram._eventCause.nodeCollectionChange=t.datavisualization.Diagram.CollectionChangeCause.Drop,this.diagram.add(s)?(s=this.diagram.nameTable[s.name]||s,this.diagram._selectedSymbol=s,this.diagram._updateDroppedSymbol(s),this.selectedObject=s):this.selectedObject=null)):this.selectedObject=null))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(l=this.diagram.nameTable[this.selectedObject.parent],l&&(d=l.container,this._removeHelpers(),d&&"canvas"==d.type?(t.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),"pseudoGroup"==this.selectedObject.type||this.diagram._isDragg||(this._swimlaneNodeDragged=t.datavisualization.Diagram.canvasHelper._singleNodedrag(this.diagram,e,m))):"stack"==d.type?t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer):(this.isDiagram(e)&&this._addToDiagram(),this.diffx=this.diffy=0))):this.selectedObject&&!this.selectedObject.isSwimlane&&("pseudoGroup"==this.selectedObject.type&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHelpers(),this._multiNodedrag(e,m)):"connector"==this.selectedObject.type&&!this.selectedObject.isPhase||this.isDiagram(e)||"pseudoGroup"==this.selectedObject.type?"connector"!=this.selectedObject.type||this.selectedObject.isPhase?(u="","pseudoGroup"!=this.selectedObject.type&&"multipleSelection"!=this.selectedObject.name||!this.diagram._activeSwimLane?!this.diagram._activeSwimLane&&m&&m.isLane?(this.diagram._activeSwimLane=this._getParentSwimlane(m),this._multiNodedrag(e,m),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,m,"group"),this.selectedObject=null):m&&("bpmn"==m.type||m.container)&&(this._multiNodedrag(e,m),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,m,"group"),this.selectedObject=null):(this._multiNodedrag(e,m),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,this.diagram._activeSwimLane,"group"),this.selectedObject=null)):m&&("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this._fromDiagram(this.selectedObject.children)&&t.datavisualization.Diagram.Util.canAllowDrop(m)&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._multiNodedrag(e,m)):(m=this._getMouseOverElement(e),this.diagram._isDragg||(m&&m.container&&t.datavisualization.Diagram.Util.canAllowDrop(m)&&!this._checkForDropEvent(m)&&!m.isSwimlane&&t.datavisualization.Diagram.bpmnHelper.canAllowDropOnContainer(this.selectedObject,m)?(h=this.helper?this.helper:this.selectedObject,t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,h,m)?(t.datavisualization.Diagram.canvasHelper._addNodeToContainer(this.diagram,this.selectedObject,m),c=this.diagram._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,this.diagram._raiseGroupChangeEvent(this.selectedObject,null,m,c)):(this.diagram._translate(this.selectedObject,this.undoObject.node.offsetX-this.selectedObject.offsetX,this.undoObject.node.offsetY-this.selectedObject.offsetY,this.diagram.nameTable),this.diagram._updateAssociatedConnectorEnds(this.selectedObject,this.diagram.nameTable))):m&&this.selectedObject.name!=m.name&&this._checkForDropEvent(m,!0)))),this._removeHelpers(),this._checkPhaseDrop(e),n},a.prototype._checkPhaseDrop=function(e){var i,a,n,o,s,r,l=null;this.selectedObject&&this.selectedObject.isPhase&&(n=this._findNodeUnderMouse(e),n&&(l=this._getSwimLaneNode(n,this.selectedObject,!0)),l?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),o=this._getSwimlaneHeader(l),"vertical"==this.selectedObject.orientation?(i=this.currentPoint.x-(l.offsetX-l.width/2),a="horizontal"):(i=this.currentPoint.y-(l.offsetY-l.height/2),i-=o?o.height:0,a="vertical"),s={element:this.selectedObject,cancel:!1,target:l},this.diagram._dropPhase=!0,this.diagram.remove(this.selectedObject),delete this.diagram._dropPhase,this.diagram._selectedSymbol=null,this.inAction=!1,r=this.selectedObject.labels&&this.selectedObject.labels.length>0?this.selectedObject.labels[0]:{text:"Phase"},this.diagram._addPhase(l.name,{name:t.datavisualization.Diagram.Util.randomId(),offset:i,orientation:a,label:r,lineColor:this.selectedObject.lineColor,lineDashArray:this.selectedObject.lineDashArray,lineWidth:this.selectedObject.lineWidth}),this.diagram._selectedSymbol=null):(this.diagram._remove(this.selectedObject),this.diagram._clearSelection(!0),this.selectedObject=null,this.diagram._selectedSymbol=null))},a.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg),this._removeHighLighter(),this.diffx=0,this.diffy=0},a.prototype._updateNodeState=function(e,i){var a,n,o,s,r,l,d,h,c,u,g;if(this.diagram.nameTable[this.selectedObject.parent]&&(a=this.diagram.nameTable[this.selectedObject.parent].container),n=this._getNodeUnderMouse(),n&&(n=!this.selectedObject.isLane||n.isLane?n:null),a){if("canvas"==a.type)n&&i&&(o=this.selectedObject.parent,s=this.diagram._getSwimlane(o),s&&this.diagram._updateChildAdjacentConnectors(s,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram));else if("stack"==a.type&&(r=this._checkForDropEvent(n),!r))if(l=this._stackOverNode){if(d=this.diagram.nameTable[l.parent],d||(d=n),h=t.datavisualization.Diagram.Util.bounds(d),c=d.rotateAngle,0==d.rotateAngle||0!=c||this.diagram._rotate(d,-d.rotateAngle,this.diagram.nameTable),d.children=this.diagram._getChildren(d.children),this.selectedObject.name!=l.name&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.canvasHelper._swapLane(this.diagram,d.children,this.selectedObject.name,l.name,"vertical"===d.container.orientation,d),d.children&&d.children.length>0))for(u=0;u<d.children.length;u++)d.children[u]=this.diagram.nameTable[d.children[u]]}else this.diffx=this.diffy=0}else"pseudoGroup"==this.selectedObject.type&&(g=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],g&&g.parent&&(a=this.diagram.nameTable[g.parent].container),a&&"canvas"==a.type&&n&&i&&(o=this.selectedObject.parent,this.diagram._updateChildAdjacentConnectors(o,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)));this.selectedObject&&this.selectedObject.lebels&&this.selectedObject.lebels.length>0&&this.diagram.nameTable[this.selectedObject.name]&&this.diagram._updateQuad(this.selectedObject)},a.prototype.mouseup=function(a,n){var o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D=this.inAction;if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction?(this.dragState=t.datavisualization.Diagram.DragState.Completed,t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),s=this._changeNodeState(a,n,!0),this.inAction=!1,this.selectedObject&&(r=l=t.datavisualization.Diagram.Util.bounds(this.selectedObject),d={bounds:{x:l.x,y:l.y,width:l.width,height:l.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.selectedObject.isLane||(this._swimlaneNodedragged||(c=this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)),this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container&&s||(this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:d,newValue:h,cancel:!1}),this.dragState="")),n||this._updateNodeState(a,s),this._updateObject(),g={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(g=this.diagram._getChildTable(this.selectedObject,g)),this.diagram._selectedSymbol||this.selectedObject.isPhase||this.selectedObject.isLane||this._isLane||this.diagram._isDragg||(m={childTable:g,node:this.selectedObject},u=e.extend(!0,{},m),p={type:"positionchanged",undoObject:jQuery.extend(!0,{},this.undoObject),redoObject:jQuery.extend(!0,{},u),isMultipleNode:"group"===this.selectedObject._type,category:"internal",activeLabel:this.activeLabel},this._multipleUndo||this.diagram.addHistoryEntry(p),this.selectedObject.parent&&"bpmn"==this.diagram.nameTable[this.selectedObject.parent].type&&this.diagram._isGroupActionEnabled&&(this.diagram._closeGroupAction(),delete this.diagram._isGroupActionEnabled)),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isSwimlane&&(this.diagram._selectedSymbol=null),this.diagram._updateSelectionHandle(),o=this.selectedObject,this._isLane=!1,this._multipleUndo=!1)):this.selectedObject?o=this._findNodeUnderMouse(a):(a.ctrlKey||a.shiftKey?o=this._processCtrlKey(a):(f=!0,v=a.target.className,_=t.datavisualization.Diagram.Util.isClassifier(a)?t.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(a,this.diagram):this._findNodeUnderMouse(a),3===a.which&&this.diagram.selectionList[0]&&("pseudoGroup"===this.diagram.selectionList[0].type||"group"===this.diagram.selectionList[0]._type)&&this._hasMultipleSelection(_)&&(f=!1),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&this._isMouseDown&&(this.selectedObject=f?_:this.diagram.selectionList[0]),o=this.selectedObject),y=this.diagram.selectionList.length>0?this.diagram.selectionList[0]:null,this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection(!0)),!c&&this.selectedObject){if(this.selectedObject&&"pseudoGroup"!=this.selectedObject.type&&!D){var C=this._findNodeUnderMouse(a,!0),w=this.selectedObject,z=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:C,model:this.diagram.model,cancel:!1,event:a});this._itemClick(this.selectedObject,this.actualObject,C,y),z.cancel&&(this.selectedObject=w)}this.selectedObject&&(this._allowPan(this.selectedObject,"mouseup",a),this.selectedObject.isPhase||this._updateSelection(),this._enableLabel(this.selectedObject,this.activeLabel),this.selectedObject&&""===this.selectedObject.parent&&(this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):this.diagram._isHyperLink(a)||t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),b=this.selectedObject,this.diagram._isDragg&&!this.diagram._selectionContains(b)&&(this.diagram._clearSelection(),b.isPhase||this.diagram._addSelection(b)))),o&&!D&&(x=this.diagram._mousePosition(a.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(o),actualObject:this.diagram.getNode(this.actualObject),count:this.diagram._getEventDetail(a),offsetX:x.x,offsetY:x.y,event:a}))}this._multipleUndo=!1,delete this.diffx,delete this.diffy,delete this._isMouseDown,delete this.actualObject,delete this._swimlaneNodedragged,this.diagram._removeTooltip(),this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit(),delete this.hoverNode,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._activeSwimLane=null,i.prototype.mouseup.call(this,a)},a.prototype._updateObject=function(){var e,i,a,n;if(this.selectedObject)if("pseudoGroup"==this.selectedObject.type)for(i=this.diagram._getChildren(this.selectedObject.children),a=0,n=i.length;n>a;a++)e=this.diagram.nameTable[i[a]],e&&t.datavisualization.Diagram.DiagramContext.update(e,this.diagram);else this.selectedObject.parent&&(t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.diagram._updateParentBounds(this.diagram.nameTable[this.selectedObject.parent])),this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},a.prototype._endAction=function(){i.prototype._endAction.apply(this),this._isMouseDown=!1,this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},a.prototype._updateHelperXY=function(e,i,a){var n,o,s,r,l,d,h=a.x<i.x,c=a.y<i.y,u=this.diffx+(a.x-i.x),g=this.diffy+(a.y-i.y);(this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(n=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,h,c,t.datavisualization.Diagram.Point(u,g),a,i)),n||(n=t.datavisualization.Diagram.Point(u,g)),this.diffx=u-n.x,this.diffy=g-n.y,t.datavisualization.Diagram.Geometry.isEmptyPoint(n)||(o=t.datavisualization.Diagram.Util.bounds(e),o=t.datavisualization.Diagram.Rectangle(o.left,o.top,o.right-o.left,o.bottom-o.top),s={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},this._outOfBoundsDrag(e,n.x,n.y)&&this.diagram._translate(e,n.x,n.y,this.diagram.nameTable),r=t.datavisualization.Diagram.Util.bounds(e),r=t.datavisualization.Diagram.Rectangle(r.left,r.top,r.right-r.left,r.bottom-r.top),l={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},d=this._raiseDragEvent({element:this.diagram.getNode(this.helper),offset:n,oldValue:s,newValue:l,cancel:!1}),d&&!d.cancel?this.inAction||"group"===e._type&&t.datavisualization.Diagram.Util._updateGroupBounds(e,this.diagram):this.diagram._translate(e,-n.x,-n.y,this.diagram.nameTable))},a.prototype._outOfBoundsDrag=function(e,i,a,n){var o,s,r;if(i=i?i:0,a=a?a:0,e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)&&(o=t.datavisualization.Diagram.Util.bounds(e),s=this._getPageBounds(),n&&(i="horizontal"===n?0:i,a="vertical"===n?0:a),o)){if(r=this._getPadding(e),e.isPhase)return!0;if((!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(o.right+i+r.x>s.width||o.left+i-r.x<s.x)||(!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(o.bottom+a+r.y>s.height||o.top+a-r.y<s.y))return this.updateCursor("not-allowed"),!1}return this.diagram._notAllow||this.updateCursor("move"),!0},a.prototype._updateXY=function(e,i,a,n){var o,s,r,l,d,h,c=a.x<i.x,u=a.y<i.y,g=this.diffx+(a.x-i.x),m=this.diffy+(a.y-i.y);if((this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(o=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,c,u,t.datavisualization.Diagram.Point(g,m),a,i)),o||(o=t.datavisualization.Diagram.Point(g,m)),this.diffx=g-o.x,this.diffy=m-o.y,(!t.datavisualization.Diagram.Geometry.isEmptyPoint(o)||this.diagram._selectedSymbol&&!this.inAction)&&(r=t.datavisualization.Diagram.Util.bounds(e),r=t.datavisualization.Diagram.Rectangle(r.left,r.top,r.right-r.left,r.bottom-r.top),l={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},e.segments||t.datavisualization.Diagram.Util.canAllowPan(e)&&(0===this.diagram._hScrollOffset&&(o.x=0),0===this.diagram._vScrollOffset&&(o.y=0)),n&&!e.isSwimlane&&"pseudoGroup"!=e.type&&(this.diagram._preventDocking=!0),this._outOfBoundsDrag(e,o.x,o.y))){if(this.diagram._raiseOffsetPropertyChange(e,o.x,o.y,!0),this.diagram._translate(e,o.x,o.y,this.diagram.nameTable),delete this.diagram._preventDocking,d=t.datavisualization.Diagram.Util.bounds(e),d=t.datavisualization.Diagram.Rectangle(d.left,d.top,d.right-d.left,d.bottom-d.top),h={bounds:{x:d.x,y:d.y,width:d.width,height:d.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},this.diagram._selectedSymbol){if(s={element:this.diagram.getNode(this.selectedObject),allowDrop:!0,target:this._getNodeUnderMouse(),oldValue:l,newValue:h,cancel:!1},s.target&&s.target.segments&&t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(s.target,this.diagram,this.diagram._currZoom),this._raiseEvent("dragOver",s),s.allowDrop)this.diagram._notAllow||this.updateCursor("move");else if(this.updateCursor("not-allowed"),!this.inAction)return this.diagram._removeSymbolFromDiagram(),!0}else s=this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:o,oldValue:l,newValue:h,cancel:!1});s&&!s.cancel||this.diagram._selectedSymbol?("group"===e._type&&"bpmn"!=e.type||"pseudoGroup"===e.type)&&(t.datavisualization.Diagram.Util._updateGroupBounds(e,this.diagram),(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject)):s&&s.cancel&&this.diagram._translate(e,-o.x,-o.y,this.diagram.nameTable)}},a.prototype._boundsInterSects=function(e,t){var i,a=[];return t&&(i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height},{x:t.x,y:t.y}],a=this._intersect(e,i,a)),a},a.prototype._intersect=function(e,i,a){for(var n,o,s=[],r=0;r<e.length-1;r++){for(n=0;n<i.length-1;n++)o=t.datavisualization.Diagram.Util.interSect2(e[r],e[r+1],i[n],i[n+1]),t.datavisualization.Diagram.Geometry.isEqualPoint(t.datavisualization.Diagram.Point(0,0),o)||s.push(o);
a&&i.length>=1}return s},a.prototype._getInterceptWithSegment=function(e,i){for(var a,n,o,s,r,l,d,h=[],c=t.datavisualization.Diagram.Util.findLength(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),u=1;u<i.length;u++){s=[i[u-1],i[u]],o=[],n=Math.round(t.datavisualization.Diagram.Util.findAngle(s[0],s[1])%360,2),a=Math.round(t.datavisualization.Diagram.Util.findAngle(s[1],s[0])%360,2),r=n>0&&90>=n||n>180&&270>=n?90:-90,o.push(t.datavisualization.Diagram.Geometry.transform(e,n+r,c)),o.push(t.datavisualization.Diagram.Geometry.transform(e,a+r,c)),l=this._intersect(s,o,!1);for(d in l)h.push(l[d])}return h},a.prototype._raiseDragEvent=function(e){return this.diagram._selectedSymbol||this.diagram._isDragg?void 0:(e.dragState=this.dragState,this._raiseEvent("drag",e))},a.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))},a.prototype._disableLabel=function(t,i){if(t&&i){var a=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],n="text"==t._shape?t.name:t.name+"_"+i.name,o=e(a).find("#"+n+".ej-d-label")[0];o&&(o.style.pointerEvents="none")}},a.prototype._enableLabel=function(t,i){if(t&&i){var a=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],n="text"==t._shape?t.name:t.name+"_"+i.name,o=e(a).find("#"+n+".ej-d-label")[0];o&&(o.style.pointerEvents="all")}},a}(i),t.datavisualization.Diagram.MoveTool=n,o=function(e){function i(t){e.call(this,"Port",t),this.cursor="pointer",this._isMouseDown=!1}return t.datavisualization.Diagram.extend(i,e),i.prototype.mousedown=function(t){this._isMouseDown=!0,e.prototype.mousedown.call(this,t),this.activePort=this.diagram._getvalues(t)},i.prototype.mousemove=function(t){this.activePort&&(e.prototype.mousemove.call(this,t),this.inAction||(this.inAction=!0,this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)],this.undoObject=jQuery.extend(!0,{},{node:this.selectedObject})),this._updatePortXY(this.activePort.source,this.previousPoint,this.currentPoint)),this.previousPoint=this.currentPoint},i.prototype.mouseup=function(e){if(this._isMouseDown=!1,this.diagram.deactivateTool(e),this.inAction){this.inAction=!1;var t={type:"portpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},{node:this.selectedObject}),category:"internal",activePort:this.activePort.source};this._multipleUndo||this.diagram.addHistoryEntry(t)}},i.prototype._updatePortXY=function(e,t,i){var a=i.x-t.x,n=i.y-t.y;this.activePort&&(this.selectedObject||(this.selectedObject=this.diagram.nameTable[this.diagram._getChild(this.activePort.source.parent)]),this.diagram._translatePort(this.selectedObject,e,a,n))},i}(i),t.datavisualization.Diagram.PortTool=o,s=function(i){function a(e){i.call(this,"resize",e),this.cursor="default",this._resizeDirection=null,this._mouseOffset=t.datavisualization.Diagram.Size(0,0),this.diffx=0,this.diffy=0,this._startPoint=t.datavisualization.Diagram.Size(0,0),this.undoObject=null,this.pseudoGroupConstraints=null,this._mouseDown=!1,this.resizeState=""}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mousedown.call(this,e),this._mouseDown=!0,this.resizeState=t.datavisualization.Diagram.ResizeState.Starting},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h,c,u,g;i.prototype.mousemove.call(this,a),n=!this.inAction,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],s={},r=l=t.datavisualization.Diagram.Util.bounds(this.selectedObject),d={bounds:{x:l.x,y:l.y,width:l.width,height:l.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:r.x,y:r.y,width:r.width,height:r.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:d,newValue:h,cancel:!1,direction:this._resizeDirection}),("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(s=this.diagram._getChildTable(this.selectedObject,s)),c={childTable:s,node:this.selectedObject},this.selectedObject&&"pseudoGroup"===this.selectedObject.type&&(this.pseudoGroupConstraints=this.diagram.model.selectedItems.getConstraints&&e.isFunction(this.diagram.model.selectedItems.getConstraints)?this.diagram.model.selectedItems.getConstraints():t.datavisualization.Diagram.Util._getPseudoGroupConstraints(this.diagram,this.selectedObject,this.selectedObject)),o=e.extend(!0,{},c),this.undoObject=jQuery.extend(!0,{},o),this._resizeDirection=a.target.getAttribute("class"),this.selectedObject.width||(this.selectedObject.width=this.selectedObject._width),this.selectedObject.height||(this.selectedObject.height=this.selectedObject._height),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0),this.selectedObject&&(this.resizeState=t.datavisualization.Diagram.DragState.Resizing,u=!1,this.selectedObject&&this.selectedObject.parent?(g=this.diagram.nameTable[this.selectedObject.parent],g.container&&("canvas"==g.container.type||"stack"==g.container.type)&&(u=!0)):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(u=!0),this.selectedObject&&u||"pseudoGroup"===this.selectedObject.type&&this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children))?"pseudoGroup"===this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject):t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&"stack"==this.diagram.nameTable[this.selectedObject.parent].container.type?(this.helper||(this.helper=this._getCloneNode(this.selectedObject)),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):"pseudoGroup"!=this.selectedObject.type?this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):"pseudoGroup"==this.selectedObject.type&&!this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint)),this.helper||(this.selectedObject.isSwimlane?this._isMouseDown||(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),this.diagram._renderTooltip(this.selectedObject,n),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){var n,o,s,r,l,d,h,c,u,g,m,p,f=null;this._mouseDown=!1,this.inAction&&(this.resizeState=t.datavisualization.Diagram.ResizeState.Completed,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,n=!1,s=t.datavisualization.Diagram.Util.bounds(this.undoObject.node),r={bounds:{x:s.x,y:s.y,width:s.width,height:s.height},offsetX:this.undoObject.node.offsetX,offsetY:this.undoObject.node.offsetY,width:this.undoObject.node.width,height:this.undoObject.node.height},o=t.datavisualization.Diagram.Util.bounds(this.selectedObject),this.selectedObject.parent&&(l=this.diagram.nameTable[this.selectedObject.parent],l&&l.container&&(o=t.datavisualization.Diagram.Util.bounds(this.helper))),d={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:o.x+o.width/2,offsetY:o.y+o.height/2,width:o.width,height:o.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:r,newValue:d,cancel:!1,direction:this._resizeDirection}),this.resizeState="",h=!0,(this.selectedObject.isLane||this.selectedObject.isSwimlane)&&(g={},g=this.diagram._getChildTable(this.selectedObject,g),f=e.extend(!0,{},{childTable:g,node:this.selectedObject})),this.selectedObject&&this.selectedObject.parent?(c=this.diagram.nameTable[this.selectedObject.parent],c.container&&("canvas"==c.container.type||"stack"==c.container.type)&&(n=!0)):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(n=!0),this.selectedObject&&n&&!c.isLaneStack?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,c)&&(this.selectedObject.isLane?t.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject):t.datavisualization.Diagram.canvasHelper._singleNodeResize(this.diagram,a,this.selectedObject),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram))):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject),h=!1):("pseudoGroup"==this.selectedObject.type||"multipleSelection"==this.selectedObject.name)&&this.diagram._activeSwimLane&&t.datavisualization.Diagram.canvasHelper._multiNodeResize(this.diagram,a,this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),h&&t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),g={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(g=this.diagram._getChildTable(this.selectedObject,g)),m={childTable:g,node:this.selectedObject},u=e.extend(!0,{},m),p={type:"sizechanged",undoObject:f?f:this.undoObject,redoObject:jQuery.extend(!0,{},u),isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(p),this.diagram._removeTooltip(),this._multipleUndo=!1),i.prototype.mouseup.call(this,a)},a.prototype._updateSize=function(e,i,a,n,o,s,r,l,d){var h,c,u,g,m,p,f,v,_,y=n?n:this.currentPoint.x-this.startPoint.x,b=o?o:this.currentPoint.y-this.startPoint.y,x=this._resizeObject(e,y,b,l,d),D=t.datavisualization.Diagram.Point(x.x,x.y),C=x.width,w=x.height;if(e&&(this.pseudoGroupConstraints||(this.pseudoGroupConstraints=e.constraints)),this.pseudoGroupConstraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio&&("n-resize"==this._resizeDirection||"s-resize"==this._resizeDirection||"w-resize"==this._resizeDirection||"e-resize"==this._resizeDirection?(h=t.Matrix.identity(),c=t.Matrix.transform(h,t.datavisualization.Diagram.Point(i.x-a.x,i.y-a.y)),Math.abs(c.x)>Math.abs(c.y)?w=C:C=w):w=C=i!=a?Math.max(w,C):0),u=t.datavisualization.Diagram.Size(),0>C&&(C=1),0>w&&(w=1),u.width=C,u.height=w,g=t.datavisualization.Diagram.Util.bounds(e),g=t.datavisualization.Diagram.Rectangle(g.left,g.top,g.right-g.left,g.bottom-g.top),m={bounds:{x:g.x,y:g.y,width:g.width,height:g.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},!t.datavisualization.Diagram.Geometry.isEmptySize(u)){if(this.resizeState=t.datavisualization.Diagram.ResizeState.Resizing,!this._outOfBoundsDrag(e,C,w,D))return!0;this.diagram._raiseSizePropertyChange(e,C,w,!0),this.diagram.scale(e,C,w,D,this.diagram.nameTable,null,s,r),p=t.datavisualization.Diagram.Util.bounds(e),p=t.datavisualization.Diagram.Rectangle(p.left,p.top,p.right-p.left,p.bottom-p.top),f={bounds:{x:p.x,y:p.y,width:p.width,height:p.height},offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},v=e.pathData,(g.width!=p.width||g.height!=p.height)&&(_=this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:u,oldValue:m,newValue:f,direction:this._resizeDirection})),v&&e.pathData!=v&&(e._absoluteBounds=null,e._scaled=!0),_&&_.cancel&&!r&&this.diagram.scale(e,1/C,1/w,D,this.diagram.nameTable),"group"===e._type&&t.datavisualization.Diagram.Util._updateGroupBounds(e,this.diagram),this.diagram._updateAssociatedConnectorEnds(e,this.diagram.nameTable)}this.pseudoGroupConstraints=null},a.prototype._getSwimLaneNode=function(e){var t,i,a,n;return e&&(t=e.parent,i=this.diagram.nameTable[t],i&&(a=i.parent,a&&(n=this.diagram.nameTable[a])))?n:void 0},a.prototype._outOfBoundsDrag=function(e,i,a,n){var o;if(!this.diagram._skipoutOfBounds&&e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var s=this._getPageBounds(),r=e.height*a-e.height,l=e.width*i-e.width;if(!this.inAction&&e.isLane){var d=this._getSwimLaneNode(e),h=t.datavisualization.Diagram.Util.bounds(d),c=this._getPadding(e);if(!this.diagram._selectedSymbol&&h.right+l+c.x>s.width||!this.diagram._selectedSymbol&&h.bottom+r+c.y>s.height)return this.updateCursor("not-allowed"),!1}else{var h=t.datavisualization.Diagram.Util.bounds(e),c=this._getPadding(e),u=t.Matrix.identity();if(t.Matrix.rotate(u,-e.rotateAngle,n.x,n.y),t.Matrix.scale(u,i,a,n.x,n.y),t.Matrix.rotate(u,e.rotateAngle,n.x,n.y),o=t.Matrix.transform(u,t.datavisualization.Diagram.Point(e.offsetX,e.offsetY)),!this.diagram._selectedSymbol&&(o.x+(h.width+l)/2+c.x>s.width||o.x-(h.width+l)/2<s.x)||!this.diagram._selectedSymbol&&(o.y+(h.height+r)/2+c.y>s.height||o.y-(h.height+r)/2<s.y))return this.updateCursor("not-allowed"),!1}this.updateCursor(this._resizeDirection)}return!0},a}(i),t.datavisualization.Diagram.ResizeTool=s,r=function(i){function a(e){i.call(this,"endPoint",e),this.cursor="move",this._endPoint=null,this._undoObject=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(a){var n;if(!this.inAction){i.prototype.mousedown.call(this,a),a.ctrlKey&&a.shiftKey&&(n=e(a.target).parents(".ej-d-connector"),n.length>0&&(this.selectedObject=this.diagram.nameTable[n[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))),this._initialValue=null,this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]),this.undoObject=this._getClonedObject(this.selectedObject),this._endPoint=a.target.getAttribute("class"),this.targetid=a.target.id,this._selectedSegment="",this._nearestNodes=[];var o="targetEndPoint"==this._endPoint,s="sourceEndPoint"==this._endPoint;this._raiseEndPointDrag(this.selectedObject,o,s,t.datavisualization.Diagram.DragState.Starting)}},a.prototype.mousemove=function(a){var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_;if(i.prototype.mousemove.call(this,a),n=!this.inAction,this.selectedObject&&!(a.ctrlKey&&a.shiftKey)){o=!1,2==this.selectedObject.segments.length&&(o=!0);var y=this.currentPoint.x-this.previousPoint.x,b=this.currentPoint.y-this.previousPoint.y,x=e.extend(!0,{},this.selectedObject.sourcePoint),D=e.extend(!0,{},this.selectedObject.targetPoint),C=e.extend(!0,{},this.selectedObject.segments);if(this._outOfBoundsDrag(this.selectedObject,this.currentPoint.x,this.currentPoint.y))if(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)this.inAction&&(this.selectedSegment&&"segmentEnd"==this._endPoint?(p=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Dragging),p.cancel||0==y&&0==b||(f=this.currentPoint.x-this.startPoint.x,v=this.currentPoint.y-this.startPoint.y,this._initialValue&&(f=this._initialValue.x+f-this.selectedSegment._endPoint.x,v=this._initialValue.y+v-this.selectedSegment._endPoint.y),y=0>y*f?0:f,b=0>b*v?0:v,this._updateAdjacentSegments(y,b))):"segmentEnd"!=this._endPoint&&(("targetEndPoint"==this._endPoint||"sourceEndPoint"==this._endPoint)&&this._checkConnectionPossible(a),_=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Dragging),_.cancel||(this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,_.updateSelection))),this.diagram._updateSelectionHandle(!0),this.diagram._updateQuad(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram));else{if(this.inAction=!0,this.selectedObject.segments.length>0)for(s=0;s<this.selectedObject.segments.length;s++)this.selectedObject.segments[s]._bridges=[];r=this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest"),r&&r.setAttribute("pointer-events","none"),l=this.diagram._svg.getElementById(this.selectedObject.name),l&&l.setAttribute("pointer-events","none"),d=this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g"),d&&d.setAttribute("pointer-events","none"),h=this.targetid.split("_"),h.reverse(),c=Number(h[0]),this.selectedSegment=this.selectedObject.segments[c],u=this.selectedSegment,this.selectedSegment&&"orthogonal"==this.selectedSegment.type?(g=!1,0===c&&(m=!0),this.selectedSegment.length&&this.selectedSegment.direction?0==c?(this.insertFirstSegment(y,b,h),g=!0):this.nextSegment=this.selectedObject.segments[c+1]:(this._addTerminalSegment(y,b,h),g=!0)):this.nextSegment=this.selectedObject.segments[c+1],g&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(o||m||!this.selectedObject.sourcePort),!(o||!u.length&&0!==u.length||!this.selectedObject.targetPort),this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)),this.selectedSegment||"targetEndPoint"!=this._endPoint||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]),this.selectedSegment||"sourceEndPoint"!=this._endPoint||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]),this.selectedSegment&&(this._initialValue={x:this.selectedSegment._endPoint.x,y:this.selectedSegment._endPoint.y}),this.diagram._updateSelectionHandle(!0),this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Starting)}this.diagram._comparePropertyValues(this.selectedObject,"sourcePoint",{sourcePoint:x},!0),this.diagram._comparePropertyValues(this.selectedObject,"targetPoint",{targetPoint:D},!0),this.diagram._comparePropertyValues(this.selectedObject,"segments",{segments:C},!0)}this.previousPoint=this.currentPoint},a.prototype._raiseSegmentEditEvent=function(e){return this._raiseEvent("segmentChange",{element:this.selectedObject,dragState:e,point:this.currentPoint,cancel:!1})},a.prototype._updateAdjacentSegments=function(e,i){var a,n,o=this.selectedSegment,s={x:e+o._endPoint.x,y:i+o._endPoint.y};s=this.snap(s),"orthogonal"==o.type?("left"==o._direction||"right"==o._direction?(i=s.y-o._endPoint.y,o._startPoint.y+=i,o._endPoint.y=o._startPoint.y):(e=s.x-o._endPoint.x,o._startPoint.x+=e,o._endPoint.x=o._startPoint.x),o.points[0]=o._startPoint,o.points[o.points.length-1]=o._endPoint,a=this.selectedObject.segments.indexOf(this.selectedSegment),n=this.selectedObject.segments[a-1],n&&this.updatePreviousSegment(o,n,e,i)):"straight"==o.type?(o.points[o.points.length-1]=o._endPoint=s,o._point=o.point=s):(o.points[o.points.length-1]=o._endPoint=s,o._point=o.point=s,t.datavisualization.Diagram.Util._updateBezierPoints(o)),this.nextSegment&&this.updateNextSegment(o,this.nextSegment,e,i)},a.prototype._addTerminalSegment=function(e,i,a){var n,o,s,r,l,d,h=this.selectedSegment;for(this.selectedObject.segments.pop(),n=this.selectedObject.segments[this.selectedObject.segments.length-1]&&"orthogonal"==this.selectedObject.segments[this.selectedObject.segments.length-1].type?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,o=0;o<h.points.length-2;o++)s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(h.points[o],h.points[o+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(h.points[o],h.points[o+1])}),0==s.length&&(s._direction="top"==n.direction||"bottom"==n.direction?s.direction=e>0?"right":"left":s.direction=i>0?"bottom":"top"),n=s,this.selectedObject.segments.push(s);if(r=Number(a[1]),(2==h.points.length||r==h.points.length-2)&&(n&&(n.length+=5,n._length=n.length),0!=r)){var c=t.datavisualization.Diagram.Geometry.distance(h.points[h.points.length-2],h._endPoint),u=t.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint),g=t.datavisualization.Diagram.Segment({type:"orthogonal",length:2*c/3,direction:u});this.selectedObject.segments.push(g)}l=t.datavisualization.Diagram.Segment({type:"orthogonal"}),this.selectedObject.segments.push(l),d=Number(a[0])+(Number(a[1])||0),this.selectedSegment=this.selectedObject.segments[d],this.nextSegment=this.selectedObject.segments[d+1],d==this.selectedObject.segments.length-2?this.nextSegment._direction=0==Number(a[0])?t.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint):h._direction:l._direction=t.datavisualization.Diagram.Util._getBezierDirection(h.points[h.points.length-2],h._endPoint),0==d&&this.insertFirstSegment(e,i,a)},a.prototype.insertFirstSegment=function(e,i,a){var n,o,s,r,l,d,h,c,u=this.selectedSegment;if(this.selectedObject.sourcePort&&u.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),r=[],o=0;o<u.points.length-1;o++)s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[o],u.points[o+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[o],u.points[o+1])}),0==s.length&&(s._direction=!n||"top"!=n.direction&&"bottom"!=n.direction?s.direction=i>0?"bottom":"top":s.direction=e>0?"right":"left"),n=s,r.push(s);this.selectedObject.segments=r.concat(this.selectedObject.segments),this.selectedSegment=this.selectedObject.segments[Number(a[1])],this.nextSegment=this.selectedObject.segments[Number(a[1])+1]}else u=this.selectedObject.segments[0],r=[],r.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:u.direction,length:u.length/3})),"bottom"==u.direction||"top"==u.direction?(l=Math.max(5,Math.abs(e)),d=e>0?"right":"left"):(l=Math.max(5,Math.abs(i)),d=i>0?"bottom":"top"),r.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:d,length:l})),h=this.selectedObject.segments[1],h&&h.length&&(d!=h.direction&&(l*=-1),h.length-=l,h._length=h.length),u.length=u._length=2*u._length/3,this.selectedObject.segments=r.concat(this.selectedObject.segments),c=Number(a[0])+Number(a[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},a.prototype.updatePreviousSegment=function(e,i,a,n){i._endPoint=i.points[i.points.length-1]=e._startPoint,"orthogonal"==i.type?("bottom"==i.direction?(i.length+=n,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):"top"==i.direction?(i.length-=n,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)):"right"==i.direction?(i.length+=a,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):"left"==i.direction&&(i.length-=a,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):"bezier"==i.type&&t.datavisualization.Diagram.Util._updateBezierPoints(i)},a.prototype.updateNextSegment=function(e,i,a,n){var o,s,r=e._endPoint;i._startPoint=i.points[0]=this.selectedSegment._endPoint,i&&("orthogonal"==i.type?(i.length||0===i.length)&&("left"==i._direction||"right"==i._direction?(0!=a&&("right"==i._direction?i._length-=a:i._length+=a,(i.length||0===i.length)&&(i.length=i._length,i.length<0&&("left"==i.direction?i.direction="right":"right"==i.direction&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),0!=n&&"orthogonal"!=e.type&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=r.y,o=this.selectedObject.segments.indexOf(i),s=this.selectedObject.segments[o+1],s._startPoint.y=s.points[0].y=i._endPoint.y,s.length&&("bottom"==s.direction?(s.length-=n,s.length<0&&(s.direction="top",s.length*=-1)):(s.length+=n,s.length<0&&(s.direction="bottom",s.length*=-1))))):(0!=n&&("bottom"==i._direction?i._length-=n:i._length+=n,(i.length||0===i.length)&&(i.length=i._length,i.length<0&&("top"==i.direction?i.direction="bottom":"bottom"==i.direction&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),0!=a&&"orthogonal"!=e.type&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=r.x,o=this.selectedObject.segments.indexOf(i),s=this.selectedObject.segments[o+1],s.length&&("right"==s.direction?(s.length+=a,s.length<0&&(s.direction="left",s.length*=-1)):(s.length-=a,s.length<0&&(s.direction="right",s.length*=-1)))))):"bezier"==i.type&&t.datavisualization.Diagram.Util._updateBezierPoints(i))},a.prototype.mouseup=function(e){var a,n,o,s,r,l;if(e.shiftKey&&e.ctrlKey)this._addOrRemoveStraightSegments(e);else if(this.inAction){if(this.inAction=!1,"segmentEnd"==this._endPoint&&"orthogonal"==this.selectedSegment.type){if(o=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Completed),!o.cancel){var d=this.selectedObject.segments.indexOf(this.selectedSegment),h=this.selectedObject.segments[d-1],c=this.selectedObject.segments[d+1],u=!1;h&&"orthogonal"==h.type&&Math.abs(h.length)<5?1!=d&&(u=this._removePrevSegment(d)):c&&"orthogonal"==c.type&&(a=c.length||0===c.length?c.length:t.datavisualization.Diagram.Geometry.distance(c.points[0],c.points[1]),Math.abs(5>=a)&&(u=this._removeNextSegment(d))),u&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))}}else"segmentEnd"!=this._endPoint&&(n=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Completed),this.diagram.nameTable[this.selectedObject.name]||(this.selectedObject=null),this.selectedObject&&(n.cancel?n&&n.cancel&&n.eventType&&("connectorSourceChange"===n.eventType&&(this.undoObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.diagram.nameTable[this.undoObject.sourceNode].outEdges.push(this.selectedObject.name),this.selectedObject.sourcePort=this.undoObject.sourcePort):null==this.undoObject.sourceNode&&this.selectedObject.sourceNode?(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.selectedObject.sourcePort=this.undoObject.sourcePort,this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.sourcePoint=this.undoObject.sourcePoint,this.selectedObject.segments=this.undoObject.segments)),"connectorTargetChange"===n.eventType&&(this.undoObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.diagram.nameTable[this.undoObject.targetNode].inEdges.push(this.selectedObject.name),this.selectedObject.targetPort=this.undoObject.targetPort):null==this.undoObject.targetNode&&this.selectedObject.targetNode?(this.selectedObject.targetNode=this.undoObject.targetNode,this.selectedObject.targetPort=this.undoObject.targetPort,this.selectedObject.targetPoint=this.undoObject.targetPoint,this.selectedObject.segments=this.undoObject.segments):(this.selectedObject.segments=this.undoObject.segments,this.selectedObject.targetPoint=this.undoObject.targetPoint))):(this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer))));this.selectedObject&&(this.selectedObject.annotation&&(s=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(this.selectedObject,this.undoObject.targetNode,s,null,this.diagram)),this.diagram._dock(this.selectedObject,this.diagram.nameTable,!0),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext.update(this.selectedObject,this.diagram),this.diagram._updateConnectorBridging(this.selectedObject),this.diagram._updateQuad(this.selectedObject),this.diagram._updateSelectionHandle(),this.selectedObject.annotation&&t.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(this.selectedObject,this.diagram),this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").setAttribute("pointer-events","stroke"),this.diagram._svg.getElementById(this.selectedObject.name).setAttribute("pointer-events","auto")),this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g").setAttribute("pointer-events","visible"),this._initialValue=null)}if(this.selectedObject)for(r={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this.diagram.addHistoryEntry(r),l=0;l<this._nearestNodes.length;l++)this._showPort(this._nearestNodes[l],!0);delete this._nearestNodes,i.prototype.mouseup.call(this,e)},a.prototype._addOrRemoveStraightSegments=function(e){var i,a,n,o,s,r;if("segmentEnd"==this._endPoint)i=e.target.id,a=i.split("_"),a.reverse(),n=Number(a[0]),s=this.selectedObject.segments[n],s&&"straight"==s.type&&(o=this.selectedObject.segments[n+1],o&&(this.selectedObject.segments.splice(n,1),o._startPoint=o.points[0]=s._startPoint,l=!0));else{var i=(e.target.getAttribute("class"),e.target.id),l=!1,n=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[n]&&"straight"==this.selectedObject.segments[n].type&&(s=this.selectedObject.segments[n],r=t.datavisualization.Diagram.Segment({type:"straight",_point:s._endPoint}),this.selectedObject.segments.splice(n+1,0,r),n+1!=this.selectedObject.segments.length-1&&(r.point=r._point),s._point=s.point=s.points[1]=s._endPoint=this.currentPoint,
r.points[0]=r._startPoint=this.currentPoint,r.points[1]=r._endPoint=r._point,l=!0)}l&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))},a.prototype._findIndex=function(){for(var e,i,a,n,o,s,r,l,d,h=[],c=0;c<this.selectedObject.segments.length;c++)e=this.selectedObject.segments[c],i={x:Math.min(e._startPoint.x,e._endPoint.x),y:Math.min(e._startPoint.y,e._endPoint.y),width:Math.abs(e._startPoint.x-e._endPoint.x),height:Math.abs(e._startPoint.y-e._endPoint.y)},t.datavisualization.Diagram.Geometry.inflate(i,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),t.datavisualization.Diagram.Geometry.containsPoint(i,this.currentPoint)&&h.push(e);if(1==h.length)return this.selectedObject.segments.indexOf(h[0]);for(c=0;c<h.length;c++)s=h[c],d=this.currentPoint,r=(d.y-s._startPoint.y)/(s._endPoint.y-d.y),l=(d.x-s._startPoint.x)/(s._endPoint.x-d.x),a=Math.abs(r-l),0==c&&(n=a,o=0),n>a&&(n=a,o=c);return this.selectedObject.segments.indexOf(h[o])},a.prototype._removeNextSegment=function(e){var i=this.selectedObject.segments[e-1],a=this.selectedObject.segments[e+2],n=this.selectedObject.segments[e+1];return n.length||0===n.length?(this.selectedObject.segments.splice(e,2),"top"==this.selectedSegment.direction||"bottom"==this.selectedSegment.direction?(a._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=a._startPoint.x):(a._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=a._startPoint.y)):(this.selectedObject.segments.splice(e+1,1),"top"==this.selectedSegment.direction||"bottom"==this.selectedSegment.direction?i._endPoint.x=n._endPoint.x:i._endPoint.y=n._endPoint.y,i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&a&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,a._startPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,a._startPoint)),(a.length||0===a.length)&&(a._length=a.length=t.datavisualization.Diagram.Geometry.distance(i._endPoint,a._endPoint),a.length&&(a._direction=a.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,a._endPoint)))),!0},a.prototype._removePrevSegment=function(e){var i,a,n,o=this.selectedObject.segments[e-2],s=this.selectedObject.segments[e+1],r=s.length||0===s.length?s.length:t.datavisualization.Diagram.Geometry.distance(s.points[0],s.points[1]);return 5>=r?(i=this.selectedObject.segments[e+2],s.length===r?this.selectedObject.segments.splice(e-1,4):this.selectedObject.segments.splice(e-1,3),i?("top"==o.direction||"bottom"==o.direction?(o._endPoint.y=i._endPoint.y,i._startPoint.x=o._endPoint.x):(o._endPoint.x=i._endPoint.x,i._startPoint.y=o._endPoint.y),(o.length||0===o.length)&&(o._length=o.length=t.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint),o.length&&(o._direction=o.direction=t.datavisualization.Diagram.Util._getBezierDirection(o._startPoint,o._endPoint))),(i.length||0===i.length)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)))):(o._endPoint=this.selectedObject.endPoint,o.direction=o.length=o._length=null,o._direction=s._direction)):(a=this.selectedObject.segments[e+1],this.selectedObject.segments.splice(e-1,2),n=this.selectedSegment,"left"==n.direction||"right"==n.direction?(o._endPoint.x=a._startPoint.x,a._startPoint.y=o._endPoint.y):(o._endPoint.y=a._startPoint.y,a._startPoint.x=o._endPoint.x),(this.selectedSegment.length||0===this.selectedSegment.length)&&(o._length=o.length=t.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint),o._length&&(o._direction=o.direction=t.datavisualization.Diagram.Util._getBezierDirection(o._startPoint,o._endPoint))),(a.length||0===a.length)&&(a._length=a.length=t.datavisualization.Diagram.Geometry.distance(a._startPoint,a._endPoint),a.length&&(a._direction=a.direction=t.datavisualization.Diagram.Util._getBezierDirection(a._startPoint,a._endPoint)))),!0},a.prototype._getClonedObject=function(t){if(t){var i=e.extend(!0,{},t);return i.targetNode=t.targetNode,i.sourceNode=t.sourceNode,i.targetPort=t.targetPort,i.sourcePort=t.sourcePort,i}},a.prototype._updateConnection=function(e,i){var a,n;this._updateConnectionTarget(e),"targetEndPoint"==this._endPoint?(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(e.targetNode!=this._currentPossibleConnection.name||e.targetPort!=this._possibleConnectionPort.name)&&(a=this._raiseConnectionChangeEvent(e,!0)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(e.targetNode!=this._currentPossibleConnection.name||e.targetPort)&&(a=this._raiseConnectionChangeEvent(e,!0)):this.selectedObject.targetNode&&(a=this._raiseConnectionChangeEvent(e,!0)),a&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(e.segments.length>2||2==e.segments[0].points.length)&&t.datavisualization.Diagram.Util._updatePreviousSegment(e),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))):"sourceEndPoint"==this._endPoint&&(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(e.sourceNode!=this._currentPossibleConnection.name||e.sourcePort!=this._possibleConnectionPort.name)&&(a=this._raiseConnectionChangeEvent(e)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(e.sourceNode!=this._currentPossibleConnection.name||e.sourcePort)&&(a=this._raiseConnectionChangeEvent(e)):(this.selectedObject.sourceNode&&(a=this._raiseConnectionChangeEvent(e),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),a&&t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))),n=this.selectedSegment._endPoint,this.diagram._dock(e,this.diagram.nameTable,i),a&&"sourceEndPoint"==this._endPoint&&this.selectedObject.segments.length>1&&(2==this.selectedSegment.points.length&&!this.selectedObject.sourcePort&&this.selectedSegment.length?("right"==this.selectedSegment.direction||"left"==this.selectedSegment.direction?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<n.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-n.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<n.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-n.y)),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)):a&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)))},a.prototype._disconnect=function(){},a.prototype._endAction=function(){this._showPorts();var e;this._currentPossibleConnection&&!this._possibleConnectionPort&&(e=this._currentPossibleConnection),i.prototype._endAction.apply(this),this._endPoint&&(this._endPoint=null,e&&(this.diagram._checkToolToActivate(e,this.currentPoint),this.diagram._updateCursor()))},a.prototype._outOfBoundsDrag=function(e,i,a){if(i=i?i:0,a=a?a:0,e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,e,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updatePoints=function(e,i){var a,n,o,s,r,l,d,h,c,u,g,m,p,f,v=!1,_="";if(this._endPoint&&"segmentEnd"!=this._endPoint&&this.selectedSegment&&(a="targetEndPoint"==this._endPoint,n="sourceEndPoint"==this._endPoint,this._endPoint)){switch(s=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint){case"targetEndPoint":o=this.selectedSegment._endPoint;break;case"sourceEndPoint":o=this.selectedSegment._startPoint;break;case"bezierpoint1":o=this.selectedSegment._point1;break;case"bezierpoint2":o=this.selectedSegment._point2}if(r=this.currentPoint,null==this._possibleConnectionPort&&(r=this.snap(r)),l=t.datavisualization.Diagram.Point(o.x-r.x,o.y-r.y),d=this._raiseEndPointDrag(e,a,n,i),d&&(v=d.cancel,_=d.type),!t.datavisualization.Diagram.Geometry.isEmptyPoint(l)&&!v)if(a||n){if(h=this._currentPossibleConnection?t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1):!1,this._outOfBoundsDrag(this.selectedObject,r.x,r.y,a)&&(this.selectedObject.segments.length>1&&(a||h||"orthogonal"!=this.selectedSegment.type||!this.selectedSegment.length&&0!==this.selectedSegment.length?a&&!h&&"orthogonal"==this.selectedSegment.type&&2==this.selectedSegment.points.length&&(g=r.x-this.selectedSegment._endPoint.x,m=r.y-this.selectedSegment._endPoint.y,"left"==this.selectedSegment._direction||"right"==this.selectedSegment._direction?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=m,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=g,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),p=this.selectedObject.segments.length-1,this.selectedObject.segments[p-1]&&this.updatePreviousSegment(this.selectedObject.segments[p],this.selectedObject.segments[p-1],g,m)):(this.selectedObject.sourcePoint=r,g=r.x-this.selectedSegment._startPoint.x,m=r.y-this.selectedSegment._startPoint.y,"left"==this.selectedSegment.direction||"right"==this.selectedSegment.direction?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=t.datavisualization.Diagram.Util._getBezierDirection(r,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],g,m),u=this.selectedObject.segments[1],c=!1,u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))),0==this.selectedSegment.length||0===u.length?(0==u.length&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,"left"==this.selectedSegment._direction||"right"==this.selectedSegment._direction?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,u=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,u._startPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,e.segments[1],e.sourcePoint,e.targetPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(e.segments[1],e.segments[0],e.segments[2],e.sourcePoint,e.targetPoint),u._startPoint=u.points[0]=e.segments[0]._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,e.segments[1],e.sourcePoint,e.targetPoint),c=!0):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,e.segments[1],e.sourcePoint,e.targetPoint),u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))))),(n||a)&&!h&&(f=this.selectedSegment.points.length,this.diagram._setEndPoint(e,t.datavisualization.Diagram.Point(r.x,r.y),a),f!=this.selectedSegment.points.length||c)))return{updateSelection:!0,cancel:v}}else t.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,t.datavisualization.Diagram.Point(r.x,r.y),s)}return{cancel:v,eventType:_}},a}(i),t.datavisualization.Diagram.ConnectionEditTool=r,l=function(i){function a(e){i.call(this,"shapeTool",e),this.cursor="crosshair",this._drawingPolygon=!1,this._points=[]}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){var t,a;i.prototype.mousedown.call(this,e),this._isPolyline()&&e&&!this._sourcePossibleConnection&&(this._currentPossibleConnection&&(t=this.mousePosition(e),this._possibleConnectionPort=this.diagram._findPortAtPoint(t,this._currentPossibleConnection)),this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort)),this._drawingPolygon?(a=this.helper.points[this.helper.points.length-1],a={x:a.x,y:a.y},this.helper.points.push(a),this._points.push(this.snap(this.currentPoint))):(this.selectedObject=this.createNode(),"bpmn"==this.selectedObject.type&&this.diagram._initGroupNode(this.selectedObject),this.selectedObject._type="node"),this._prevPoint=this.currentPoint},a.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},a.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},a.prototype.createNode=function(){var i,a,n,o;return this._isPolyline()?(i=e.extend(!0,{},this.diagram.model.drawType),i.sourcePoint=this.currentPoint,i.targetPoint=this.currentPoint,i.segments=[{type:"straight"}],a=this.diagram._getNewConnector(i)):a=this.diagram._getNewNode(this.diagram.model.drawType),a.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"node"+t.datavisualization.Diagram.Util.randomId(),n=this.snap(this.currentPoint),this._isPolyline()||(a.offsetX=n.x,a.offsetY=n.y,a.width=5,a.height=5),"text"==a.type||this._isPolyline()||(a.shape=this.diagram.model.drawType.shape?this.diagram.model.drawType.shape:a.shape),"polygon"!=this.diagram.model.drawType.shape&&!this._isPolyline()||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||(this._drawingPolygon=!0,o=this.snap(this.startPoint),a.points=[{x:o.x,y:o.y},{x:n.x,y:n.y}],this._points=[{x:o.x,y:o.y},{x:n.x,y:n.y}]),t.datavisualization.Diagram.NodeType(a,this.diagram)},a.prototype.mousemove=function(e){if(i.prototype.mousemove.call(this,e),this.selectedObject)if(this.inAction)this._updateHelper();else{if(this.inAction=!0,!("polygon"!==this.selectedObject.shape||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)){var t=this.snap(this.startPoint),a=this.snap(this.currentPoint);this.selectedObject.points=[{x:t.x,y:t.y},{x:a.x,y:a.y}],this._points=[{x:t.x,y:t.y},{x:a.x,y:a.y}]}this._initHelper(),this._renderHelper()}this._isPolyline()&&e&&this._checkConnectionPossible(e),this.previousPoint=this.currentPoint},a.prototype._addPolyline=function(e){var t,i,a,n;for(this._currentPossibleConnection&&(t=this.mousePosition(e),this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this.diagram._findPortAtPoint(t,this._currentPossibleConnection)),i=[],this._currentPossibleConnection&&this._sourcePossibleConnection&&(this._sourcePossibleConnection=this._sourcePossibleConnection.name===this._currentPossibleConnection.name?null:this._sourcePossibleConnection),a=1;a<this.selectedObject.points.length-2;a++)i.push({type:"straight",point:this.selectedObject.points[a]});n=this.diagram._getNewConnector(this.selectedObject),n.name=this.selectedObject.name,n.sourcePoint=this.selectedObject.points[0],n.targetPoint=this.selectedObject.points[this.selectedObject.points.length-1],n.segments=i,n.sourceNode=this._sourcePossibleConnection?this._sourcePossibleConnection.name:null,n.targetNode=this._targetPossibleConnection?this._targetPossibleConnection.name:null,n.sourcePort=this._sourcePort?this._sourcePort.name:null,n.targetPort=this._targetPort?this._targetPort.name:null,this.diagram.add(n),this._sourcePossibleConnection=null,this._targetPossibleConnection=null,this._sourcePort=null,this._targetPort=null},a.prototype.mouseup=function(e){var t=!1;!this._drawingPolygon||2==e.button||2==this.diagram._getEventDetail(e)||this._sourcePossibleConnection&&this._currentPossibleConnection&&this._sourcePossibleConnection.name!=this._currentPossibleConnection.name||this._sourcePort&&this._targetPort&&this._sourcePort.name!==this._targetPort.name?(this.inAction&&(this.inAction=!1,this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()?this._addPolyline(e):this.diagram.add(this.selectedObject)),t=!0):this._currentPossibleConnection&&this.helper&&(this.selectedObject.points.length>0&&(this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this._isPolyline()&&this._addPolyline(e)),t=!0),t&&(this.diagram._toolToActivate="selectTool",this.diagram._drawingTool=!1,i.prototype.mouseup.call(this,e),this._drawingPolygon&&(this.diagram._disableDefaultContextMenu=!0,delete this._drawingPolygon,delete this._points))},a.prototype._renderHelper=function(){this.svgHelper||(this._isPolyline()?this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram):"bpmn"!=this.helper.type?this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer,void 0,this.diagram):(this.helper._type="group",this.diagram._initGroupNode(this.helper),this.svgHelper=t.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram.nameTable,this.diagram)),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},a.prototype._outOfBoundsDrag=function(e,i,a){if(i=i?i:0,a=a?a:0,e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(null!=e.sourceNode&&!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,e,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updateHelper=function(){var i,a,n,o=this._getStartPoint(),s=this._getCurrentPoint();if(this._drawingPolygon&&this._outOfBoundsDrag(this.helper,s.x,s.y)&&this._outOfBoundsDrag(this.helper,o.x,o.y)){var r=this.snap(this.currentPoint),l=this.snap(this.previousPoint),d={x:r.x-l.x,y:r.y-l.y};if(this.helper.points[this.helper.points.length-1].x+=d.x,this.helper.points[this.helper.points.length-1].y+=d.y,this._points[this._points.length-1].x+=d.x,this._points[this._points.length-1].y+=d.y,this._isPolyline()){for(i=[],a=0;a<this.helper.points.length-1;a++)i.push({type:"straight",point:this.helper.points[a]});this.helper.sourcePoint=this.helper.points[0],this.helper.targetPoint=this.helper.points[this.helper.points.length-1],this.helper.segments=i,this.helper=this.diagram._getNewConnector(this.helper),this.diagram._dock(this.helper,this.diagram.nameTable)}}n=e.extend(!0,{},this.helper),this._updateSize(this.helper,this.snap(this.startPoint),this.snap(this.currentPoint)),this.diagram._comparePropertyValues(this.helper,"height",{height:n.height},!0),this.diagram._comparePropertyValues(this.helper,"width",{width:n.width},!0),this.diagram._comparePropertyValues(this.helper,"offsetX",{offsetX:n.offsetX},!0),this.diagram._comparePropertyValues(this.helper,"offsetY",{offsetY:n.offsetY},!0),"polygon"!=this.helper.shape||this._drawingPolygon||(this.helper.width=0!=this.helper.width?this.helper.width:5,this.helper.height=0!=this.helper.height?this.helper.height:5),t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},a.prototype._updateSize=function(e,i,a){if(this._outOfBoundsDrag(this.helper,a.x,a.y)&&this._outOfBoundsDrag(this.helper,i.x,i.y)){var n=this._drawingPolygon?this._points:[i,a],o=t.datavisualization.Diagram.Geometry.rect(n),s={width:o.width,height:o.height},r={x:o.x,y:o.y};t.datavisualization.Diagram.Geometry.isEmptySize(s)||("bpmn"!=this.helper.type?(e.offsetX=r.x+s.width/2,e.offsetY=r.y+s.height/2,e.width=s.width,e.height=s.height,"path"===e._shape&&(e._scaled=!0)):(e._type="group",this.diagram._translate(e,r.x+s.width/2-e.offsetX,r.y+s.height/2-e.offsetY,this.diagram.nameTable),this.diagram.scale(e,s.width/this.helper.width,s.height/this.helper.height,new t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),this.diagram.nameTable),t.datavisualization.Diagram.Util._updateGroupBounds(e,this.diagram)))}},a}(i),t.datavisualization.Diagram.ShapeTool=l,d=function(i){function a(e,t){i.call(this,e,t),this.cursor="crosshair",this._isMouseDown=!1,this._targetPossibleConnection=null,this._sourcePossibleConnection=null,this._targetPort=null,this._sourcePort=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){if(i.prototype.mousedown.call(this,e),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)){if(this._isMouseDown=!0,this.diagram._hasSelection()&&this.diagram._clearSelection(),e&&"touchstart"===e.type&&(this._currentPossibleConnection=this.diagram._findConnectableNodeUnderMouse(e),this._currentPossibleConnection)){var a=this.mousePosition(e);this._possibleConnectionPort=this.diagram._findPortAtPoint(a,this._currentPossibleConnection)}this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort),this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Starting)}},a.prototype._updateConnection=function(e){e&&(this._updateConnectionTarget(this.helper,!0),this._raiseConnectionChangeEvent(e,"sourceEndPoint"!=this._endPoint))},a.prototype.mousemove=function(a){if(i.prototype.mousemove.call(this,a),this._checkConnectionPossible(a),this._isMouseDown)if(this.inAction){if(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this._updateConnection(this.helper),this.helper){var n=this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Dragging),o=e.extend(!0,{},this.helper);n.cancel||this._updateHelper(),this.diagram._comparePropertyValues(this.helper,"sourcePoint",{sourcePoint:o.sourcePoint},!0),this.diagram._comparePropertyValues(this.helper,"targetPoint",{targetPoint:o.targetPoint},!0),this.diagram._comparePropertyValues(this.helper,"segments",{segments:o.segments},!0),this.diagram._comparePropertyValues(this.helper,"targetNode",{targetNode:this._targetPossibleConnection},!0),this.diagram._comparePropertyValues(this.helper,"targetPort",{targetPort:this._targetPort},!0)}}else this.inAction=!0,this._initHelper(),this._renderHelper();this.previousPoint=this.currentPoint},a.prototype.mouseup=function(e){var a,n,o,s;if(this._targetPort=this._possibleConnectionPort||this._targetPort,this._targetPossibleConnection=this._targetPossibleConnection?this._targetPossibleConnection:this._currentPossibleConnection,this._removeHighLighter(),t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._isMouseDown=!1,this.inAction){this.inAction=!1;var r=this._getStartPoint(),l=this._getCurrentPoint(),d=t.datavisualization.Diagram.Geometry.distance(r,l);this._outOfBoundsDrag(this.helper,l.x,l.y)&&this._outOfBoundsDrag(this.helper,r.x,r.y)&&d>0&&(a=this.createConnector(r,l),a.name="connector"+t.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(n=this._raiseEvent("connectionChange",{element:a,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,t.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.sourceNode=this._sourcePossibleConnection.name,a.sourcePort=this._sourcePort.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(n=this._raiseEvent("connectionChange",{element:a,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,t.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.sourceNode=this._sourcePossibleConnection.name))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(n=this._raiseEvent("connectionChange",{element:a,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,t.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.targetNode=this._targetPossibleConnection.name,a.targetPort=this._targetPort.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(n=this._raiseEvent("connectionChange",{element:a,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name),o=this._raiseEndPointDrag(a,!0,!1,t.datavisualization.Diagram.DragState.Completed),n.cancel||o.cancel||(a.targetNode=this._targetPossibleConnection.name))),s=this.diagram.add(a),s&&(a=this.diagram.nameTable[a.name],t.datavisualization.Diagram.Util.updateBridging(a,this.diagram),t.datavisualization.Diagram.SvgContext.update(a,this.diagram),this.diagram._updateConnectorBridging(a)))}this.singleAction&&this.diagram.deactivateTool(),this._prevTool&&(this._prevTool.inAction=!1),this._showPorts(),i.prototype.mouseup.call(this,e)},a.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},a.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},a.prototype._initHelper=function(){this.helper=this.createConnector(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(0,0)),this.diagram._setZorder(this.helper),this.helper.name="helper",this.helper._connectorType="helper"},a.prototype.createConnector=function(){return null},a.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram),this.svgHelper=this.diagram._svg.document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),e(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),e(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},a.prototype._outOfBoundsDrag=function(e,i,a){if(i=i?i:0,a=a?a:0,e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var n=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=n.width||i<=n.x)||!this.diagram._selectedSymbol&&(a>=n.height||a<=n.y))return this.updateCursor("not-allowed"),!1}else if(null!=e.sourceNode&&!t.datavisualization.Diagram.bpmnHelper.canMoveOutofBounds(this.diagram,e,i,a))return this.updateCursor("not-allowed"),!1;return this.updateCursor(this.cursor),!0},a.prototype._updateHelper=function(){var e=[],i=this._getStartPoint(),a=this._getCurrentPoint();e.push(i),e.push(a),this._outOfBoundsDrag(this.helper,a.x,a.y)&&this._outOfBoundsDrag(this.helper,i.x,i.y)&&(this.diagram._setEndPoint(this.helper,i,!1),this.diagram._setEndPoint(this.helper,a,!0),this._disconnect(this.helper),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,
this._targetPossibleConnection.inEdges.push(this.helper.name))),this.diagram._dock(this.helper,this.diagram.nameTable)),t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},a.prototype._endAction=function(){i.prototype._endAction.apply(this),this._targetPossibleConnection=null,this._sourcePossibleConnection=null,this._targetPort=null,this._sourcePort=null,this._isMouseDown=!1},a.prototype._showPorts=function(){},a.prototype._showAllPorts=function(e){i.prototype._showAllPorts.call(this,e)},a}(i),t.datavisualization.Diagram.LineTool=d,h=function(i){function a(e){i.call(this,"straightLine",e)}return t.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(t,i){var a={segments:[{type:"straight"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(e.extend(!0,{},a,this.diagram.model.drawType))},a}(d),t.datavisualization.Diagram.StraightLineTool=h,c=function(i){function a(e){i.call(this,"orthogonalLine",e)}return t.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(t,i){var a={segments:[{type:"orthogonal"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(e.extend(!0,{},a,this.diagram.model.drawType))},a}(d),t.datavisualization.Diagram.OrthogonalLineTool=c,u=function(i){function a(e){i.call(this,"bezierLine",e)}return t.datavisualization.Diagram.extend(a,i),a.prototype.createConnector=function(t,i){var a={segments:[{type:"bezier"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(e.extend(!0,{},a,this.diagram.model.drawType))},a}(d),t.datavisualization.Diagram.BezierLineTool=u,g=function(i){function a(e){i.call(this,"rotatetool",e),this._mouseOffset=t.datavisualization.Diagram.Size(0,0),this.undoObject=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){var a,n,o,s;i.prototype.mousedown.call(this,t),this.selectedObject=this.diagram.selectionList[0],n={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(n=this.diagram._getChildTable(this.selectedObject,n)),o={childTable:n,node:this.selectedObject},a=e.extend(!0,{},o),this.undoObject=jQuery.extend(!0,{},a),s=this.diagram._currZoom},a.prototype.mousemove=function(e){var a,n,o,s,r,l;if(i.prototype.mousemove.call(this,e),a=!this.inAction,this.selectedObject){if(!this.inAction){if("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)for(n=this.diagram._getChildren(this.selectedObject.children),o=0;o<n.length;o++)if(s=this.diagram.nameTable[n[o]],!s.segments&&!t.datavisualization.Diagram.Util.canRotate(s))return;this._initialValue=this.selectedObject.rotateAngle,this.inAction=!0}r=!1,this.selectedObject.parent?(l=this.diagram.nameTable[this.selectedObject.parent],l.container&&(r=!0)):"pseudoGroup"==this.selectedObject.type&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(r=!0),r?"pseudoGroup"==this.selectedObject.type&&this._isParentAsLane(this.selectedObject)?(t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram)):(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.inEdges=this.helper.outEdges=[],this.helper.type=null,this.helper.name="helper"),this._rotate(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)):"pseudoGroup"==this.selectedObject.type&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))?this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,a)):("pseudoGroup"===this.selectedObject.type&&this._updateMultipleUndoObject(this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,a))}this.previousPoint=this.currentPoint},a.prototype._rotate=function(e){var i,a,n,o,s,r,l=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),d=this.currentPoint,h=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(l.x,l.y),d)+90;h=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,h)-e.rotateAngle,n=t.datavisualization.Diagram.Util.bounds(e),i=t.datavisualization.Diagram.Rectangle(n.left,n.top,n.right-n.left,n.bottom-n.top),o={bounds:i,offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},this.diagram._comparePropertyValues(e,"rotateAngle",{rotateAngle:h},!0),this.diagram._rotate(e,h,this.diagram.nameTable),n=t.datavisualization.Diagram.Util.bounds(e),a=t.datavisualization.Diagram.Rectangle(n.left,n.top,n.right-n.left,n.bottom-n.top),s={bounds:a,offsetX:e.offsetX,offsetY:e.offsetY,width:e.width,height:e.height},r=this._raiseEvent("rotationChange",{element:this.diagram.getNode(e),angle:e.rotateAngle,oldValue:o,newValue:s,cancel:!1}),r.cancel&&this.diagram._rotate(e,-h,this.diagram.nameTable)},a.prototype.mouseup=function(a){var n,o,s,r,l,d;if(this.inAction){this.inAction=!1;var h=!1,c=!0,u=!1;this.selectedObject.parent?(n=this.diagram.nameTable[this.selectedObject.parent],n.container&&(h=!0)):"pseudoGroup"==this.selectedObject.type&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(o=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],n=this.diagram.nameTable[o.parent],n.container&&(h=!0)),"pseudoGroup"!=this.selectedObject.type&&"multipleSelection"!=this.selectedObject.name||!this.diagram._activeSwimLane?h&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),this._removeHighLighter(),"canvas"==n.container.type&&(u=!0),u&&(t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,n)?t.datavisualization.Diagram.canvasHelper._singleNodeRotate(this.diagram,a,this.selectedObject):c=!1)):t.datavisualization.Diagram.canvasHelper._multiNodeRotate(this.diagram,a,this.selectedObject),"pseudoGroup"!=this.selectedObject.type?c&&this._rotate(this.selectedObject):this._fromContainer(this.diagram._getChildren(this.selectedObject.children))||this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),r={},("group"===this.selectedObject._type||"pseudoGroup"===this.selectedObject.type)&&(r=this.diagram._getChildTable(this.selectedObject,r)),l={childTable:r,node:this.selectedObject},s=e.extend(!0,{},l),d={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},s),isMultipleNode:"group"===this.selectedObject._type,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(d),this.selectedObject&&t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom),this.diagram._updateSelectionHandle(),this.diagram._removeTooltip()}this._multipleUndo=!1,i.prototype.mouseup.call(this,a)},a}(i),t.datavisualization.Diagram.RotateTool=g,m=function(e){function i(i){e.call(this,"PivotTool",i),this._mouseOffset=t.datavisualization.Diagram.Size(0,0)}return t.datavisualization.Diagram.extend(i,e),i.prototype.mousedown=function(t){e.prototype.mousedown.call(this,t),this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(e.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var a=this.currentPoint.x-this.previousPoint.x,n=this.currentPoint.y-this.previousPoint.y,o=t.Matrix.identity();t.Matrix.rotate(o,-this.selectedObject.rotateAngle);var s=t.Matrix.transform(o,t.datavisualization.Diagram.Point(a,n)),r=(this.selectedObject.width*this.selectedObject.pivot.x+s.x)/this.selectedObject.width,l=(this.selectedObject.height*this.selectedObject.pivot.y+s.y)/this.selectedObject.height;this.selectedObject.pivot.x=r,this.selectedObject.pivot.y=l,this.selectedObject.offsetX+=a,this.selectedObject.offsetY+=n,this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(e){var i=t.datavisualization.Diagram.Point(e.offsetX,e.offsetY),a=this.currentPoint,n=this.FindAngle(i,a);this.diagram._rotate(e,n-e.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle()),e.prototype.mouseup.call(this,t)},i}(i),t.datavisualization.Diagram.PivotTool=m,p=function(e){function i(t){e.call(this,"panTool",t),this.diagram=t,this._isMouseDown=!1,this.cursor="pointer"}return t.datavisualization.Diagram.extend(i,e),i.prototype.mousedown=function(t){var i;e.prototype.mousedown.call(this,t);var a=this.diagram._svg.document,n=this.diagram._svg.document.createSVGPoint(),o=this.diagram._isTouchEvent(t);return n.x=o.clientX,n.y=o.clientY,i=n.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),a.lastMouseX=i.x,a.lastMouseY=i.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){if(e.prototype.mousemove.call(this,i),this._isMouseDown&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)){this.inAction=!0;var a=this.diagram._svg.document,n=this.diagram._svg.document.createSVGPoint(),o=this.diagram._isTouchEvent(i);n.x=o.clientX,n.y=o.clientY;var s,r,l=n.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),d=l.x,h=l.y;return s=d-a.lastMouseX,r=h-a.lastMouseY,this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||(s=0),this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY||(r=0),t.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,s,r,t.datavisualization.Diagram.Point(d,h)),a.lastMouseX=d,a.lastMouseY=h,!1}},i.prototype.mouseup=function(i){this.inAction=!1,document.onmousemove=null,document.onmouseup=null,this._isMouseDown=!1,this.diagram._removeTooltip(),this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit(),delete this.hoverNode,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),e.prototype.mouseup.call(this,i)},i}(i),t.datavisualization.Diagram.PanTool=p,f=function(i){function a(e,a){i.call(this,e,a),this.boundingRect=t.datavisualization.Diagram.Rectangle(),this.activeLabel=null,this._overNode="",this.cursor="crosshair"}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){i.prototype.mousedown.call(this,e),this._findNodeUnderMouse(e);var t=this._getNodeUnderMouse();t&&(this._overNode=this.selectedObject&&!this.selectedObject.isLane||t.isLane?t.name:""),this.diagram._isEditing&&this.diagram._endEdit()},a.prototype.createNode=function(){},a.prototype.mousemove=function(e){i.prototype.mousemove.call(this,e),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},a.prototype.mouseup=function(e){var i,a,n;this.activeLabel=null,i=12,this.inAction?(n=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),(0===n.width||0===n.height)&&(n.width=90,n.height=i),this.selectedObject=this.createNode(n.x+n.width/2,n.y+n.height/2,n.width,n.height),this.diagram._startEdit(this.selectedObject)):(a=this._findNodeUnderMouse(e),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(null==a||a.isSwimlane||a.isLane?(n=t.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-i/2,90,i),this._endAction(),this.selectedObject=this.createNode(n.x+n.width/2,n.y+n.height/2,n.width,i),this.diagram._startEdit(this.selectedObject)):(this.selectedObject=a,this.diagram._startEdit(this.selectedObject)))),this._overNode=""},a.prototype.getBoundingRect=function(e,t){var e=this.snap(this.startPoint),t=this.snap(this.currentPoint),i=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y),n=e.x>t.x?t.x:e.x,o=e.y>t.y?t.y:e.y;return{x:n,y:o,width:i,height:a}},a.prototype._initHelper=function(){var e,t,i;this._svgHelper||(e=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(e),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),e.appendChild(i),e.setAttribute("pointer-events","none"),this._svgHelper=e)},a.prototype._updateHelper=function(){var e=this.snap(this.startPoint),t=this.snap(this.currentPoint),i=this.diagram._adornerSvg.getElementById("helper"),a=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),o=this.diagram._currZoom,s=(e.x>t.x?t.x:e.x)*o,r=(e.y>t.y?t.y:e.y)*o;i&&this.diagram._adornerSvg.rect({id:i.id,x:s,y:r,width:a*o,height:n*o})},a.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null),i.prototype._endAction.apply(this)},a.prototype._findNodeUnderMouse=function(t){var i,a,n,o,s,r=this.diagram._isForeignObject(t.target);if(r&&(t.target=r),a=t.target,"ej-d-label"==a.getAttribute("class"))n=e(a).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],i=this._findObj(n),this.activeLabel=this.diagram._findLabelAtPoint(this.currentPoint,i);else if(o=e(t.target).parents("g"),o.length>3){var l=o[o.length-4],d=l.getAttribute("id"),h=l.getAttribute("class");h&&("ej-d-node"===h||"ej-d-group"===h?(i=this.diagram._findNode(d),s=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=s):"ej-d-connector"===h&&(i=this.diagram._findConnector(d),s=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=s))}return i},a}(t.datavisualization.Diagram.ToolBase),t.datavisualization.Diagram.TextToolBase=f,v=function(i){function a(e){i.call(this,"textTool",e)}return t.datavisualization.Diagram.extend(a,i),a.prototype.createNode=function(i,a,n,o){var s,r={offsetX:i,offsetY:a,width:n,height:o,parent:this._overNode,labels:[],ports:[],type:"text"},l=this.diagram._getNewNode(e.extend(!0,{},r,this.diagram.model.drawType));return l.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"text"+t.datavisualization.Diagram.Util.randomId(),(l._type="text")&&(l._type="node"),s=this.diagram.nameTable[l.parent],s&&s.container&&this._updateMargin(l,s),l},a}(t.datavisualization.Diagram.TextToolBase),t.datavisualization.Diagram.TextTool=function(e){return new v(e)},_=function(i){function a(e){i.call(this,"phase",e),this.selectedSeperator=null,this._svgHelper=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){i.prototype.mousedown.call(this,e),this.inAction=!0,this.diagram._selectedGNode=null},a.prototype._getSeperator=function(t){if(e(t.target).parents("g").first()[0]){var i=e(t.target).parents("g").first()[0].id;if(i)return this._getphase(i.split("_phase_g")[0])}},a.prototype._removePhasehelper=function(){t.datavisualization.Diagram.SvgContext._removePhasehelper(this.diagram)},a.prototype._outOfBoundsDrag=function(e){var i,a,n,o=this.currentPoint.x-this.startPoint.x,s=this.currentPoint.y-this.startPoint.y;if(e&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){if(i=this._getPageBounds(),a=this.diagram.nameTable[e.parent],a&&(n=t.datavisualization.Diagram.Util.bounds(a),!this.diagram._selectedSymbol&&(n.right+o>=i.width||e.offset+o<i.x)||!this.diagram._selectedSymbol&&(n.bottom+s>=i.height||e.offset+s<i.y)))return this.updateCursor("not-allowed"),!1;"horizontal"==e.orientation?this.updateCursor("e-resize"):this.updateCursor("n-resize")}return!0},a.prototype._updatePhasehelper=function(i){var a,n,o=this._bounds?jQuery.extend(!0,{},this._bounds):this.diagram._getPhaseBounds(i),s=this.startPoint,r=this.currentPoint,l={snapped:!1,offset:0,left:!1,right:!1},d={snapped:!1,offset:0,top:!1,bottom:!1};this.selectedObject=this.diagram.nameTable[this.selectedSeperator.parent],this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},"horizontal"===i.orientation?(a=r.x-s.x,a=this._snapRight(l,d,a,0,this.selectedObject,!1),n=0,this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+a},!0)):(a=0,n=r.y-s.y,n=this._snapBottom(l,d,0,n,this.selectedObject,!1),this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+n},!0)),o&&(o.width+=a,o.height+=n,this._helperBounds=e.extend(!0,{},o),t.datavisualization.Diagram.SvgContext._updatePhaseHelper(this.diagram,i,o))},a.prototype._drawPhasehelper=function(e){var i=this.diagram._getPhaseBounds(e);e&&i&&t.datavisualization.Diagram.SvgContext._phasehelper(this.diagram,e,i)},a.prototype.mousemove=function(e){if(i.prototype.mousemove.call(this,e),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._outOfBoundsDrag(this.selectedSeperator)){if(this.selectedSeperator)this.selectedSeperator&&(this._bounds||(this._bounds=this.diagram._getPhaseBounds(this.selectedSeperator)),this._updatePhasehelper(this.selectedSeperator));else{if(this.inAction){var a=this._getSeperator(e);a&&!this.selectedSeperator&&(this.selectedSeperator=a)}this._drawPhasehelper(this.selectedSeperator),this.diagram.selectionList[0]&&"phase"!=this.diagram.selectionList[0].type?(this.diagram._clearSelection(!0),this.diagram.addSelection(this.selectedSeperator,!0)):this.diagram.addSelection(this.selectedSeperator,!0)}this.previousPoint=this.currentPoint}},a.prototype._getPadding=function(e){var t,i,a=20,n=20,o=this.diagram.nameTable[this.diagram._getChild(e.children[e.children.length-1])];return o&&(t=o.children,t.length>0&&(i=this.diagram.nameTable[this.diagram._getChild(t[0])],i&&i.isLane&&(a=i.paddingRight,n=i.paddingBottom))),{x:a,y:n}},a.prototype.mouseup=function(e){var a,n,o,s,r=this._getSeperator(e);if(this.diagram.selectionList.length>0&&r&&this.diagram.selectionList[0].name!=r.name&&this.diagram._clearSelection(!0),r&&!this.selectedSeperator)this.selectedSeperator=r,this.diagram.addSelection(this.selectedSeperator,!0);else if(this.selectedSeperator&&(a=this.selectedSeperator.parent.split("phaseStack")[0],a&&(n=this.diagram.nameTable[a],n&&this._helperBounds&&n.isSwimlane))){var l=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this.diagram,n),d=0,h=l.indexOf(this.selectedSeperator.name);h>0?d=this.diagram.nameTable[this.diagram._getChild(l[h-1])].offset:"horizontal"===n.orientation&&(d=50),o=jQuery.extend(!0,{},this.selectedSeperator),"horizontal"===n.orientation?this.diagram._updatePhase({name:this.selectedSeperator.name,offset:d+this._helperBounds.width}):this.diagram._updatePhase({name:this.selectedSeperator.name,offset:d+this._helperBounds.height}),s={type:"phasepositionchanged",undoObject:jQuery.extend(!0,{},o),redoObject:jQuery.extend(!0,{},jQuery.extend(!0,{},this.selectedSeperator)),category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(s),this.diagram.addSelection(this.selectedSeperator,!0)}this._removePhasehelper(),this._bounds=null,this.inAction=!1,this.selectedSeperator=null,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mouseup.call(this,e)},a.prototype._getOuterPhaseNodes=function(e,i){var a,n,o;if(e){var s=this.diagram.nameTable[this.diagram._getChild(e.children[2])],r=[],l=null,d=null;for(a=0;s&&a<s.children.length;a++)if(n=this.diagram.nameTable[this.diagram._getChild(s.children[a])],n&&n.children&&n.children.length>1)for(o=0;o<n.children.length;o++)d=this.diagram.nameTable[this.diagram._getChild(n.children[o])],d&&(l=t.datavisualization.Diagram.Util.bounds(d),i?l.y>e.offsetY-e.height/2+this.selectedSeperator.offset&&r.push(d):l.x>e.offsetX-e.width/2+this.selectedSeperator.offset&&r.push(d))}return r},a}(i),t.datavisualization.Diagram.PhaseTool=_,y=function(i){function a(e){i.call(this,"labelMove",e),this._isMouseDown=!1,this.undoObject=[],this.inAction=!1}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){var t,a,n;i.prototype.mousedown.call(this,e),this._isMouseDown=!0,e&&("ej-d-label"==e.target.className||"ej-d-label"===e.target.parentNode.getAttribute("class"))&&(t=this.diagram._nodeUnderMouse,a=e.target.id,a||(a=e.target.parentNode.id),n=a.split("_"),this.selectedObject=this.diagram._findLabel(t,n[1]),this.selectedObject||(this.selectedObject=t.labels[0]),t.segments||(this.selectedObject.width=this.selectedObject.width>t.width?this.selectedObject.width:t.width,this.selectedObject.height=this.selectedObject.height>t.height?this.selectedObject.height:t.height),this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection(!0))},a.prototype.mousemove=function(a){var n,o,s;i.prototype.mousemove.call(this,a),this.selectedObject&&this.selectedObject._parent&&(n=this.diagram.findNode(this.selectedObject._parent),this._isMouseDown&&!this.inAction&&!this.inAction&&this.selectedObject&&(this.inAction=!0,o={},s=e.extend(!0,{},{childTable:o,node:n,activeLabel:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},s)),this._isMouseDown&&this.selectedObject&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&(t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&t.datavisualization.Diagram.Util.canMove(this.selectedObject)||t.datavisualization.Diagram.Util.canMoveLabel(n))&&!this.diagram._isEditing&&(this.inAction||(this.inAction=!0),this.updateCursor("move"),this._updateSelection(),this._updateLabelXY(this.selectedObject,this.previousPoint,this.currentPoint),this.diagram._updateSelectionHandle(!0))),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){var n;if(this.selectedObject&&this.selectedObject._parent&&(n=this.diagram.findNode(this.selectedObject._parent),(t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&t.datavisualization.Diagram.Util.enableLayerOption(this.selectedObject,"lock",this.diagram)&&t.datavisualization.Diagram.Util.canMove(this.selectedObject)||t.datavisualization.Diagram.Util.canMoveLabel(n))&&(this.diagram._addSelection(this.selectedObject,!0),this.inAction))){this.inAction=!1;var o=e.extend(!0,{},{childTable:{},node:n,label:this.selectedObject}),s={type:"labelpositionchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},o),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(s)}delete this._isMouseDown,i.prototype.mouseup.call(this,a)},a.prototype._updateLabelXY=function(e,i,a){var n,o,s=a.x-i.x,r=a.y-i.y,l=this.diagram.findNode(e._parent);l.segments||(n=t.Matrix.identity(),t.Matrix.rotate(n,-l.rotateAngle),o=t.Matrix.transform(n,t.datavisualization.Diagram.Point(s,r)),s=o.x,r=o.y),l.segments&&"segmentpath"==e.relativeMode&&t.datavisualization.Diagram.Util.isAllowDragLimit(l)?this._updateLabelOffset(l,e,s,r):this.diagram.translateLabel(l,e,s,r)},a.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject,!0))},a.prototype._updateLabelOffset=function(i,a,n,o,s,r,l){var d,h,c,u,g,m,p,s,f,v,_,y,b,x,D,C,w={minDistance:null},z=null,S=0;if(i.segments&&"segmentpath"===a.relativeMode){if(d=e.extend(!0,{},a),h={x:0,y:0,width:0,height:0,centerX:0,centerY:0},s?g=s:(h=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,i,a),y=this.diagram._currZoom,h.x=h.x+n,h.y=h.y+o,c="svg"===this.diagram.model.labelRenderingMode?{x:h.centerX+n,y:h.centerY+o}:{x:h.x+h.width/2,y:h.y+h.height/2},u={x:this.currentPoint.x-c.x,y:this.currentPoint.y-c.y},g={x:this.currentPoint.x-u.x,y:this.currentPoint.y-u.y}),m=t.datavisualization.Diagram.Util.getPoints(i),p=this._getInterceptWithSegment(g,m),s=this._getRelativeOffset(g,m,w),f=this._getLengthFromListOfPoints(m),b=t.datavisualization.Diagram.Util.bounds(i),p.length>0){if(_={minDistance:null},v=this._getRelativeOffset(g,p,_),null!=w.minDistance&&_.minDistance<w.minDistance&&(s=v),s){for(x in m){if(null!=z){if(D=t.datavisualization.Diagram.Geometry.rect([z,m[x]]),t.datavisualization.Diagram.Geometry.containsPoint(D,s)){S+=t.datavisualization.Diagram.Util.findLength(z,s);break}S+=t.datavisualization.Diagram.Util.findLength(z,m[x])}z=m[x]}C=t.datavisualization.Diagram.Point(S/f,0)}this._updateLabelMargin(i,a,C,g,n,o,r,l)}else this._updateLabelMargin(i,a,null,g,n,o);this.diagram._comparePropertyValues(i,"labels",d,!0)}},a.prototype._updateLabelMargin=function(e,i,a,n,o,s,r,l){var d,h,c,u,g,m,p,f,v,_,y,b;if(a=a?a:{x:i.segmentOffset,y:0},i&&a&&(p=i.dragLimit,m=t.datavisualization.Diagram.Util.getPoints(e),g=this._getLengthFromListOfPoints(m),a.x>0&&a.x<1)){c={angle:null},u=this._getPointAtLength(g*a.x,m,c);var x=this.diagram._currZoom,h=(t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,e,i),{x:0,y:0,width:0,height:0});if(h=t.datavisualization.Diagram.Util.getLabelbounds(this.diagram,e,i,!0),h.x=h.x/x+o,h.y=h.y/x+s,h.width=h.width/x,h.height=h.height/x,d={x:u.x-p.left-h.width/2,y:u.y-p.top-h.height/2,width:p.left+p.right+h.width,height:p.top+p.bottom+h.height},t.datavisualization.Diagram.Geometry.containsPoint(d,n))n=n;else{f=[u,n],v=this._boundsInterSects(f,d,!1);for(_ in v)y=v[_],n=y}b=this._checkCursorLimit(i,u,n,h),i.margin={left:b.x?n.x-u.x:i.margin.left,top:b.y?n.y-u.y:i.margin.top,right:0,bottom:0},i.segmentOffset=a.x,r&&l&&(i.width=r,i.height=l),t.datavisualization.Diagram.DiagramContext.updateLabel(e,i,this.diagram)}},a.prototype._getInterceptWithSegment=function(e,i){for(var a,n,o,s,r,l,d,h=[],c=t.datavisualization.Diagram.Util.findLength(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(this.diagram._viewPort.width,this.diagram._viewPort.height)),u=1;u<i.length;u++){s=[i[u-1],i[u]],o=[],n=Math.round(t.datavisualization.Diagram.Util.findAngle(s[0],s[1])%360,2),a=Math.round(t.datavisualization.Diagram.Util.findAngle(s[1],s[0])%360,2),r=n>0&&90>=n||n>180&&270>=n?90:-90,o.push(t.datavisualization.Diagram.Geometry.transform(e,n+r,c)),o.push(t.datavisualization.Diagram.Geometry.transform(e,a+r,c)),l=this._intersect(s,o,!1);for(d in l)h.push(l[d])}return h},a.prototype._getRelativeOffset=function(e,t,i){for(var a,n,o,s=0;s<t.length;s++)o=t[s],n=Math.round(Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2))),(null==i.minDistance||Math.min(Math.abs(i.minDistance),Math.abs(n))==Math.abs(n))&&(a=o,i.minDistance=n);return a},a.prototype._getLengthFromListOfPoints=function(e){var i,a,n=0;i=e[0];for(a in e)n+=t.datavisualization.Diagram.Util.findLength(i,e[a]),i=e[a];return n},a.prototype._getPointAtLength=function(e,i,a){var n,o,s,r,l;a.angle=0;var d,h,c=0,u=null,g=t.datavisualization.Diagram.Point(0,0);for(d in i)if(h=i[d],u){if(n=t.datavisualization.Diagram.Util.findLength(u,h),c+n>=e){o=e-c,s=t.datavisualization.Diagram.Util.findAngle(u,h),r=o*Math.cos(s*Math.PI/180),l=o*Math.sin(s*Math.PI/180),g=t.datavisualization.Diagram.Point(u.x+r,u.y+l),a.angle=s;break}c+=n,u=h}else u=h;return g},a.prototype._checkCursorLimit=function(e,t,i,a){var n=!1,o=!1;return i.x>=t.x-e.dragLimit.left-a.width/2&&i.x<=t.x+e.dragLimit.right+a.width/2&&(n=!0),i.y>=t.y-e.dragLimit.top-a.height/2&&i.y<=t.y+e.dragLimit.bottom+a.height/2&&(o=!0),{x:n,y:o}},a.prototype._boundsInterSects=function(e,t){var i,a=[];return t&&(i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height},{x:t.x,y:t.y}],a=this._intersect(e,i,a)),a},a.prototype._intersect=function(e,i,a){for(var n,o,s=[],r=0;r<e.length-1;r++){for(n=0;n<i.length-1;n++)o=t.datavisualization.Diagram.Util.interSect2(e[r],e[r+1],i[n],i[n+1]),t.datavisualization.Diagram.Geometry.isEqualPoint(t.datavisualization.Diagram.Point(0,0),o)||s.push(o);a&&i.length>=1}return s},a.prototype.getCenterOfLabel=function(e,i){var a=t.datavisualization.Diagram.Point(0,0);if(this.selectedObject&&this.selectedObject._parent){var n=t.datavisualization.Diagram.Util.getPoints(this.diagram.findNode(this.selectedObject._parent)),o=this._getLengthFromListOfPoints(n),a=this._getPointAtLength(o*i,n,{});a.x+=e.margin.left-e.margin.right,a.y+=e.margin.top-e.margin.bottom}return a},a}(i),t.datavisualization.Diagram.LabelMoveTool=y,b=function(i){function a(e){i.call(this,"labelResize",e),this._resizeDirection=null,this.undoObject=null,this._mouseDown=!1}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(e){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),i.prototype.mousedown.call(this,e),this._mouseDown=!0,this.selectedObject=this.diagram.selectionList[0]},a.prototype.mousemove=function(a){var n;if(i.prototype.mousemove.call(this,a),!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown){this.selectedObject=this.diagram.selectionList[0];var o=this.diagram.findNode(this.selectedObject._parent),s=e.extend(!0,{},{childTable:{},node:o,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},s),this._resizeDirection=a.target.getAttribute("class"),n=this._getLabelCenter(this.selectedObject),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:n.y,x:n.x},this.inAction=!0}this.selectedObject&&this.inAction&&t.datavisualization.Diagram.Util.canResize(this.selectedObject)&&(this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype.mouseup=function(a){if(this._mouseDown=!1,this.inAction&&this.selectedObject){this.inAction=!1;var n=e.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),label:this.selectedObject}),o={type:"labelsizechanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},n),isMultipleNode:"group"===this.selectedObject._type,category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(o),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0)}i.prototype.mouseup.call(this,a)},a.prototype._updateSize=function(e){var i,a,n,o,s,r,l,d=this.diagram.findNode(e._parent),h=t.Matrix.identity(),c=this.currentPoint.x-this.startPoint.x,u=this.currentPoint.y-this.startPoint.y,g=this.diagram._findLabelRotateAngle(e),m=this._getLabelCenter(e),p=this._resizeObject(e,c,u);if(i=p.width,a=p.height,0>i&&(i=1),0>a&&(a=1),i&&1!=i||a&&1!=a){n=t.Matrix.identity(),t.Matrix.rotate(n,-d.rotateAngle,d.offsetX,d.offsetY),o=t.datavisualization.Diagram.Util.bounds(d,!0),t.Matrix.rotate(h,-g,p.x,p.y),t.Matrix.scale(h,i,a,p.x,p.y),t.Matrix.rotate(h,g,p.x,p.y);var f=t.Matrix.transform(h,t.datavisualization.Diagram.Point(m.x,m.y)),v=e.height*a,_=e.width*i;d.segments&&"segmentpath"==e.relativeMode?this.diagram.tools.labelMove._updateLabelOffset(d,e,0,0,f,_,v):(d.segments||(f=t.Matrix.transform(n,f)),f.x=f.x-e.margin.left+e.margin.right,f.y=f.y-e.margin.top+e.margin.bottom,s=this._findLabelAtNode(d,e),e.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Top?f.y-=s.height/2:e.verticalAlignment==t.datavisualization.Diagram.VerticalAlignment.Bottom&&(f.y+=s.height/2),e.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Left?f.x-=s.width/2:e.horizontalAlignment==t.datavisualization.Diagram.HorizontalAlignment.Right&&(f.x+=s.width/2),r=o.width/(f.x-o.x),l=o.height/(f.y-o.y),_>1&&(e.width=_,e.offset.x=1/r),v>1&&(e.height=v,
e.offset.y=1/l))}},a}(i),t.datavisualization.Diagram.LabelResizeTool=b,x=function(i){function a(e){i.call(this,"labelRotate",e),this.inAction=!1,this.undoObject=null}return t.datavisualization.Diagram.extend(a,i),a.prototype.mousedown=function(t){i.prototype.mousedown.call(this,t),this.selectedObject=this.diagram.selectionList[0];var a=this.diagram.findNode(this.selectedObject._parent),n=e.extend(!0,{},{childTable:{},node:a,activeLabel:this.selectedObject});this.undoObject=jQuery.extend(!0,{},n)},a.prototype.mousemove=function(e){i.prototype.mousemove.call(this,e),this.selectedObject&&t.datavisualization.Diagram.Util.canRotate(this.selectedObject)&&(this.inAction||(this.inAction=!0),this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0)),this.previousPoint=this.currentPoint},a.prototype._rotate=function(e){var i,a,n;t.Matrix.identity();i=this.diagram._findLabelRotateAngle(e),a=this._getLabelCenter(e),n=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(a.x,a.y),this.currentPoint)+90,n=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,n)-i,e.rotateAngle+=n,e.rotateAngle%=360,e.rotateAngle<0&&(e.rotateAngle+=360)},a.prototype.mouseup=function(a){if(this.inAction){this.inAction=!1,this._rotate(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);var n=e.extend(!0,{},{childTable:{},node:this.diagram.findNode(this.selectedObject._parent),activeLabel:this.selectedObject}),o={type:"labelrotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},n),category:"internal",activeLabel:this.selectedObject};this.diagram.addHistoryEntry(o),this.selectedObject&&t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom),this.diagram._updateSelectionHandle()}i.prototype.mouseup.call(this,a)},a}(i),t.datavisualization.Diagram.LabelRotateTool=x}(jQuery,Syncfusion),function(e,t){"use strict";var i,a;t.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart",RadialTree:"radialtree",SymmetricLayout:"symmetriclayout"},t.datavisualization.Diagram.ChartOrientations={Horizontal:"horizontal",Vertical:"vertical"},t.datavisualization.Diagram.ChartTypes={Left:"left",Right:"right",Alternate:"alternate",Center:"center"},t.datavisualization.Diagram.Layout={doLayout:function(i,a){var n,o,s,r=i.model,l={diagram:i,_anchorX:0,_anchorY:0,_graphNodes:{},_firstLevelNodes:[],_centerNode:null,levels:[],maxLevel:0,layoutNodes:[]};for(n in r.layout)"type"==n?l.type=i._layoutType():"orientation"==n?l.orientation=i._layoutOrientation():"fixedNode"==n?l.fixedNode=i._fixedNode():"horizontalSpacing"==n?l.horizontalSpacing=Number(i._horizontalSpacing()):"verticalSpacing"==n?l.verticalSpacing=Number(i._verticalSpacing()):"marginX"==n?l.marginX=Number(i._layoutMarginX()):"marginY"==n?l.marginY=Number(i._layoutMarginY()):"getLayoutInfo"==n?"string"==typeof r.layout.getLayoutInfo?l.getLayoutInfo=t.util.getObject(r.layout.getLayoutInfo,window):e.isFunction(r.layout.getLayoutInfo)&&(l.getLayoutInfo=r.layout.getLayoutInfo):"getConnectorSegments"==n?"string"==typeof r.layout.getConnectorSegments?l.getConnectorSegments=t.util.getObject(r.layout.getConnectorSegments,window):e.isFunction(r.layout.getConnectorSegments)&&(l.getConnectorSegments=r.layout.getConnectorSegments):l[n]=r.layout[n];return l.updateView=void 0===a?!0:l.updateView,l.objects=[],"symmetriclayout"===l.type?(o=new SymmetricLayoutManager(l.diagram.model,50),o.MaxIteration=l.maxIteration,o.SpringLength=l.springLength,o.SpringFactor=l.springFactor,s=new GraphLayoutManager,s.updateLayout(l.diagram,o)):"radialtree"!=l.type?t.datavisualization.Diagram.HierarchicalLayout.doLayout(l):t.datavisualization.Diagram.RadialTreeLayout.doLayout(l),l.updateView?void 0:l.objects}},t.datavisualization.Diagram.HierarchicalLayout={doLayout:function(e){var i,a,n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y;if(i=e.diagram,a=i.model,n=i.nodes(),this._checkMultiparent(n,e))t.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(e);else if(n.length>0){for(h=0;h<n.length;h++)o=n[h],o.excludeFromLayout||(s=e._graphNodes[o.name]=this._setUpLayoutInfo(e,o),s.tree.hasSubTree=!1,o.inEdges&&o.inEdges.length&&!this._isAnnotationShape(o,!1)||e._firstLevelNodes.push(o));if(e.root||i.model.dataSourceSettings.root){if(e.root)e.rootNode=r=i.nameTable[i._getChild(e.root)];else for(l=i.model.dataSourceSettings.root,d=i.model.dataSourceSettings.id,h=0;h<n.length;h++)n[h][d]===l&&(e.rootNode=r=i.nameTable[i._getChild(n[h].name)]);if(r&&0===e._firstLevelNodes.length)return void t.datavisualization.Diagram.MultipleParentHierarchicalLayout.doLayout(e)}for(h=0;h<e._firstLevelNodes.length;h++)o=e._firstLevelNodes[h],this._updateEdges(e,o,1);if(e._firstLevelNodes.length>0){for(e._rootNode=e._firstLevelNodes[0],u=0,g=0,h=0;h<e._firstLevelNodes.length;h++)c=this._updateTree(e,u,g,e._firstLevelNodes[h],0,e._firstLevelNodes[h-1]),_=e._graphNodes[e._firstLevelNodes[h].name],_.y<c.y&&(c.y=_.y),_.x<c.x&&(c.x=_.x),"lefttoright"==e.orientation||"righttoleft"==e.orientation?g=c.right+e.horizontalSpacing:u=c.right+e.horizontalSpacing,0==h?(m=c.x,f=c.y,p=c.right,v=c.bottom):(m=Math.min(m,c.x),f=Math.min(f,c.y),p=Math.max(p,c.right),v=Math.max(v,c.bottom));for(this._updateAnchor(e,{x:m,y:f,right:p,bottom:v}),i._layoutInAction=!0,h=0;h<e._firstLevelNodes.length;h++)this._updateNodes(e,e._firstLevelNodes[h],0);if(i._layoutInAction=!1,e.updateView||(i._internalLayout=e),e.updateView){for(h=0;h<e._firstLevelNodes.length;h++)this._updateConnectors(e,e._firstLevelNodes[h],1);for(y=0;y<e.diagram.model.connectors.length;y++)delete e.diagram.model.connectors[y]._visited;for(y=0;y<e.diagram.model.nodes.length;y++)delete e.diagram.model.nodes[y]._visited1,delete e.diagram.model.nodes[y]._isRightAdded}}}delete e.diagram.minSpaceBetweenNode},_checkMultiparent:function(e,t){var i,a;if(e&&e.length>0)for(i=0;i<e.length;i++)if(a=e[i],t._processedNodes=[],a&&(a.inEdges&&a.inEdges.length>1&&!this._isAnnotationShape(a,!0)||this._checkCyclicNodes(a,t,a.name)))return delete t._processedNodes,!0;return delete t._processedNodes,!1},_checkCyclicNodes:function(e,t,i){var a,n,o,s;if(e.outEdges&&e.outEdges.length>0&&!this._isLoopProcessed(t,e.name))for(t._processedNodes.push(e.name),a=0;a<e.outEdges.length;a++)if(n=t.diagram.nameTable[e.outEdges[a]],n&&(n.targetNode===i||(o=t.diagram.nameTable[n.targetNode],o&&o.outEdges&&o.outEdges.length>0&&(s=this._checkCyclicNodes(o,t,i)))))return!0;return!1},_isLoopProcessed:function(e,t){for(var i=e._processedNodes,a=0;a<i.length;a++)if(i[a]===t)return!0;return!1},_isAnnotationShape:function(e,t){if(e&&"bpmn"===e.type&&"group"===e._type&&e.annotation&&e.annotation.text)if(t){if(e.inEdges.length<=2)return!0}else if(e.inEdges.length<=1)return!0;return!1},_updateTree:function(e,t,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_;return a._visited1?a._treeBounds:(a._visited1=!0,r=this._getDimensions(e,a,t,i,n),l=e._graphNodes[a.name],e.maxLevel=Math.max(e.maxLevel,n),d=n,c=this._hasChild(e,a),c||l.tree.assistants.length?(_=r.y+r.height+e.verticalSpacing,l.tree.assistants.length&&(h=this._setDepthSpaceForAssistants(e,a,_,r.height,n,e.verticalSpacing),d=h.level,_=h.bottom),l.tree.assistants.length||"horizontal"==l.tree.orientation||(_=r.y+r.height+e.verticalSpacing/2),l.tree.children.length&&(u="horizontal"!=l.tree.orientation||"balanced"==l.tree.type&&1!=l.tree.children.length?"balanced"==l.tree.type?this._updateHorizontalTreeWithMultipleRows(e,a,o,r.x,_,d):this._updateVerticalTree(e,a,r.x,_,d,s):this._updateHorizontalTree(e,a,o,r.x,_,d)),l.y&&l.y>r.y||(l.y=r.y),l.mid&&(t=l.mid),l.tree.assistants.length&&(v=void 0!==t?t:r.x,f=this._setBreadthSpaceForAssistants(e,a,r,v,_,n),c||(m=u=f,t=(m.x+m.right)/2-r.width/2,u=m),p=f?f.canMoveBy:void 0),l.x=t,l.translate||(l._treeWidth=u.right-u.x),g={x:t,y:r.y,right:t+r.width,bottom:r.y+r.height},this._translateSubTree(e,a,g,u,r,n,p,void 0!=o,s),"string"!=typeof l.firstChild&&(l.firstChild.x+=l.subTreeTranslation),a._treeBounds=u,u):(a._treeBounds=this._updateLeafNode(e,a,o,r,n,s),a._treeBounds))},_updateLeafNode:function(e,t,i,a,n,o){var s,r;return s=e._graphNodes[t.name],s.x&&s.x>a.x||(s.x=a.x),s.y&&s.y>a.y||(s.y=a.y),s.maxLevel=Math.max(n,s.maxLevel||0),r={x:a.x,y:a.y,right:a.x+a.width,bottom:a.y+a.height},s.maxLevel=Math.max(s.maxLevel||0,n),this._translateSubTree(e,t,r,r,a,n,void 0,void 0!=i,o),{x:s.x,y:s.y,right:s.x+a.width,bottom:s.y+a.height}},_translateSubTree:function(e,t,i,a,n,o,s,r,l){var d=e._graphNodes[t.name],h=e.diagram.nameTable[d.firstChild?d.firstChild.child:d.tree.children[0]],c=h?e._graphNodes[h.name]:null,u=this._hasChild(e,t),g=this._findIntersectingLevels(e,i,o,d.actualLevel),m=this._findIntersectingLevels(e,a,o,d.actualLevel),p=[];g.length&&d.translate?(d.intersect=g,this._spaceLeftFromPrevSubTree(e,t,i),d.canMoveBy=d.diff,void 0!==s&&(d.canMoveBy=Math.min(s,d.canMoveBy)),h&&void 0!==c.canMoveBy&&(c.canMoveBy>=d.canMoveBy&&(d.translated=!0),d.canMoveBy=Math.min(d.canMoveBy,c.canMoveBy)),r&&(d.x-=d.canMoveBy,d.subTreeTranslation-=d.canMoveBy,u&&(this._shiftSubordinates(e,m,d.canMoveBy),a.x=Math.min(a.x,d.x),a.right=Math.max(a.right,d.x+n.width),a.bottom=Math.max(a.bottom,d.y+n.height),a.x-=d.canMoveBy,a.right-=d.canMoveBy),h&&c.canMoveBy>d.canMoveBy?d.canMoveBy=c.canMoveBy-d.canMoveBy:h&&void 0!==d.canMoveBy&&(d.canMoveBy=0))):(u&&(a.x=Math.min(a.x,i.x),a.right=Math.max(a.right,i.x+n.width),a.bottom=Math.max(a.bottom,d.y+n.height)),d.translate||(d.canMoveBy=0,d.subTreeTranslation=0)),l||(i={x:d.x,y:n.y,right:d.x+n.width,bottom:n.y+n.height},p.push({rBounds:i}),this._updateRearBounds(e,t,p,o))},_updateRearBounds:function(e,t,i,a,n){var o,s,n,r,l,d,h,c,u=!0;if(t&&(d=e._graphNodes[t.name],n=d.intersect,u=!d.tree.children.length&&!d.tree.assistants.length),r=i[0].rBounds,l=i[i.length-1].rBounds,n&&n.length){for(o=e.levels[n[0]].rBounds,h=o.bottom,o.y<r.y&&(o.bottom=r.y,i.splice(0,0,{rBounds:o})),h>l.bottom?i.push({rBounds:{x:o.x,right:o.right,y:r.bottom,bottom:h}}):(o=e.levels[n[n.length-1]].rBounds,u&&o.bottom>l.bottom&&(o.y=l.bottom,i.push({rBounds:o}))),s=n[0],c=i.length-1;c>=0;c--)e.levels.splice(s,0,i[c]);s+=i.length,e.levels.splice(s,n.length)}else for(s=this._findLevel(e,i[i.length-1].rBounds,a),c=i.length-1;c>=0;c--)e.levels.splice(s,0,i[c])},_shiftSubordinates:function(e,t,i){var a;if(0!=i)for(a=0;a<t.length;a++)e.levels[t[a]].rBounds&&(e.levels[t[a]].rBounds.x-=i,e.levels[t[a]].rBounds.right-=i)},_setDepthSpaceForAssistants:function(e,t,i,a,n,o){for(var s,r,l,d=e._graphNodes[t.name],h=i,c=0;c<d.tree.assistants.length;c++)s=e._graphNodes[d.tree.assistants[c]],s&&(s.tree.children=s.tree.assistants=[],s.y=i,l=e.diagram.nameTable[d.tree.assistants[c]],r=l.height?l.height:l._height,("lefttoright"==e.orientation||"righttoleft"==e.orientation)&&(r=l.width?l.width:l._width),h=i+r+o/2,e.maxLevel=n+1,c%2==1&&c!=d.tree.assistants.length-1&&(i=h,n++));return{level:e.maxLevel,bottom:i+r+o}},_setBreadthSpaceForAssistants:function(e,t,i,a,n,o){for(var s,r,l,d,h,c,u,g,m=e._graphNodes[t.name],p=o,f=0;f<m.tree.assistants.length;f++)s=e._graphNodes[m.tree.assistants[f]],s&&(d=e.diagram.nameTable[m.tree.assistants[f]],r=d.width?d.width:d._width,("lefttoright"==e.orientation||"righttoleft"==e.orientation)&&(r=d.height?d.height:d._height),h=f%2==0?a+i.width/2-20-r:a+i.width/2+20,l=this._updateTree(e,h,s.y,e.diagram.nameTable[m.tree.assistants[f]],p+1),this._hasChild(e,t)||(0==f?u=l:this._uniteRects(u,l)),f%2==0&&s.prevBounds&&(c=void 0===c?s.canMoveBy:Math.min(c,s.canMoveBy)),(f%2==1||f==m.tree.assistants.length-1)&&(g=this._findIntersectingLevels(e,l,p+1),this._updateRearBounds(e,null,[{rBounds:l}],p+1,g),p++));return u&&(u.canMoveBy=c),u},_updateHorizontalTree:function(e,t,i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C=this._getDimensions(e,t,a,n,o),w=e._graphNodes[t.name],z=w.tree.type,S=o,P=a,T=n;e.levels.slice(0,e.levels.length);if(this._hasChild(e,t)){for(y="lefttoright"==e.orientation||"righttoleft"==e.orientation,b=0;b<w.tree.children.length;b++)s=e.diagram.nameTable[w.tree.children[b]],v=s.width?s.width:s._width,_=s.height?s.height:s._height,d=y?_:v,h=y?v:_,u=e.levels[S+1]?e.levels[S+1].rBounds:null,l=this._updateTree(e,P,T,s,S+1,e.diagram.nameTable[w.tree.children[b-1]]),r=e._graphNodes[s.name],w.maxLevel=Math.max(w.maxLevel||0,r.maxLevel||0),m={x:r.x,y:r.y,right:r.x+d,bottom:r.y+h},0==b&&(g={x:Math.min(r.x,l.x),y:Math.min(r.y,l.y),right:l.right,bottom:l.bottom},c=r),x?(x.x=m.x,x.y=m.y,m.right>x.right&&(x.right=m.right),x.bottom=m.bottom):x=m,0==b&&(w.firstChild={x:r.x,canMoveBy:r.canMoveBy,child:s.name}),this._hasChild(e,s)&&(!w.firstChild||w.firstChild.x>=r.firstChild.x?(r.firstChild&&w.firstChild.canMoveBy<r.canMoveBy&&(D=w.firstChild.canMoveBy,r.canMoveBy=D,e._graphNodes[w.firstChild.child].canMoveBy=D,w.firstChild.canMoveBy=D),w.firstChild={x:r.firstChild.x,canMoveBy:void 0!==D?D:r.canMoveBy,child:s.name}):r.firstChild&&r.translated&&w.firstChild.canMoveBy>r.canMoveBy&&(w.firstChild.canMoveBy=e._graphNodes[w.firstChild.child].canMoveBy=r.canMoveBy)),p=p?Math.max(r.maxLevel,p):r.maxLevel,s._isRightAdded||(this._uniteRects(g,l),P=0!=b&&!this._hasChild(e,s)&&r.subTreeTranslation<0?l.right-r.subTreeTranslation+e.horizontalSpacing:l.right+e.horizontalSpacing),s._isRightAdded=!0;isNaN(f)||(c.canMoveBy=f),w.mid=(c.x+x.right)/2-C.width/2,"left"==z?w.mid=m.right-C.width:"right"==z&&(w.mid=a)}return g},_updateHorizontalTreeWithMultipleRows:function(e,t,i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C,w,z,S,P,T,j,L,N,O,M=this._getDimensions(e,t,a,n,o),E=e._graphNodes[t.name],k=(E.tree.type,o),A=a,I=n,s=(e.levels.slice(0,e.levels.length),[]),U=0;if(this._hasChild(e,t)){var B="lefttoright"==e.orientation||"righttoleft"==e.orientation,H=this._splitChildrenInRows(e,t),R=5==E.tree.children.length&&3==H[0].length,G=[],W=[];if(R)W=H;else for(P=0;P<H.length;P++){if(G[P]=[],W[P]=[],v=H[P].length,H[P].length%2!=1)for(v=Math.ceil(H[P].length/2),_=0;v>_;_++)G[P].push(H[P][_]);for(O=G[P].length;O<H[P].length;O++)W[P].push(H[P][O])}for(y=[],U=0,P=0;P<G.length&&G[P].length;P++){for(A=a,y[P-1]&&(I=y[P-1].bottom+e.verticalSpacing),O=0;O<G[P].length;O++)r=e.diagram.nameTable[G[P][O]],p=r.width?r.width:r._width,f=r.height?r.height:r._height,h=B?f:p,c=B?p:f,u=e.levels[k+1]?e.levels[k+1].rBounds:null,l=e._graphNodes[r.name],l.actualLevel=k+1+P,d=this._updateTree(e,A,I,r,k+1,e.diagram.nameTable[G[P][O-1]]),0==O?y[P]={x:d.x,y:d.y,right:d.right,bottom:d.bottom}:this._uniteRects(y[P],d),0==P&&0==O?(U=l.canMoveBy,E.firstChild={x:l.x,child:r.name,canMoveBy:l.canMoveBy}):0==O&&void 0!==l.canMoveBy&&U>l.canMoveBy&&(U=Math.min(U,l.canMoveBy||0),E.firstChild={x:l.x,child:r.name,canMoveBy:l.canMoveBy}),A=d.right+e.horizontalSpacing;b=0==P?y[P].right:Math.max(b,y[P].right),u=m}for(P=0;P<G.length&&G[P].length;P++){if(b!=y[P].right)for(x=b-y[P].right,O=0;O<G[P].length;O++)D=e.diagram.nameTable[G[P][O]],C=e._graphNodes[G[P][O]],C.x+=x;0==P?g={x:y[0].x,y:y[0].y,right:y[0].right,bottom:y[0].bottom}:this._uniteRects(g,y[P]),u=d}for(w=(b||0)+(void 0!==b?e.horizontalSpacing/2:0),void 0!==b&&(E.mid=w-M.width/2,z=b+e.horizontalSpacing),I=n,S=[],P=0;P<W.length;P++){for(A=H[P].length%2==1&&P==W.length-1||R?a:z||a,0!=P&&(I=S[P-1].bottom+e.verticalSpacing),O=0;O<W[P].length;O++)r=e.diagram.nameTable[W[P][O]],p=r.width?r.width:r._width,f=r.height?r.height:r._height,h=B?f:p,c=B?p:f,u=e.levels[k+1]?e.levels[k+1].rBounds:null,l=e._graphNodes[r.name],l.actualLevel=k+1+P,0==O&&G[P]&&G[P].length&&(l.translate=!1),R&&1==P&&(0==O&&j+h+e.horizontalSpacing<=L&&(T=!0,A=j-h/2),T&&1==O&&(A=L-h/2)),d=this._updateTree(e,A,I,r,k+1,e.diagram.nameTable[W[P][O-1]]),R&&2>=O&&0==P&&1==O&&(j=d.x-e.horizontalSpacing/2,L=d.x+h+e.horizontalSpacing/2),0==O?S[P]={x:d.x,y:d.y,right:d.right,bottom:d.bottom}:this._uniteRects(S[P],d),g||(g={x:S[P].x,y:S[P].y,right:S[P].right,bottom:S[P].bottom}),this._uniteRects(g,S[P]),A=d.right+e.horizontalSpacing,u=d,(!E.firstChild||(P==W.length-1&&H[P].length%2==1||R)&&0==O&&void 0!==l.canMoveBy&&U>l.canMoveBy)&&(U=Math.min(U,l.canMoveBy||0),E.firstChild={x:l.x,child:r.name,canMoveBy:l.canMoveBy});if(R&&1==P&&(N=S[0].right-S[0].x>=S[1].right-S[1].x?0:1),P==H.length-1&&(H[P].length%2==1||R&&1==P)){var s=W[P][Math.floor(W[P].length/2)],V=e.diagram.nameTable[s],X=this._getDimensions(e,V,e._graphNodes[s].x,e._graphNodes[s].y,k+1);if(x=void 0,!T&&R?(1==N&&(P=0),x=(S[N].x+S[N].right)/2-(S[P].x+S[P].right)/2,0==P&&(E.mid+=x)):R||void 0===z||(x=z-e.horizontalSpacing/2-(e._graphNodes[s].x+X.width/2)),void 0!==x)for(O=0;O<W[P].length;O++)if(e._graphNodes[W[P][O]].x+=x,e._graphNodes[W[P][O]].canMoveBy+=x,O==W[P].length-1){var r=(this._getDimensions(e,e.diagram.nameTable[W[P][O]],e._graphNodes[W[P][O]].x,e._graphNodes[W[P][O]].y,e._graphNodes[W[P][O]].actualLevel),e._graphNodes[W[P][O]]),Y=this._findIntersectingLevels(e,{x:r.x,y:r.y,right:r.x+M.width,bottom:r.y+M.height},e._graphNodes[W[P][O]].actualLevel);this._updateRearBounds(e,null,[{rBounds:{x:r.x,y:r.y,right:r.x+M.width,bottom:r.y+M.height}}],e._graphNodes[W[P][O]].actualLevel,Y)}R&&(E.mid=(L+j)/2+(0==P?x:0)-M.width/2),void 0==E.mid&&e._graphNodes[s]&&(E.mid=e._graphNodes[s].x),T=!1,P++}}}return g},_updateVerticalTree:function(e,t,i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C,w,z,S,P,T,j,L=[],N=[];for(f=this._getDimensions(e,t,i,a,n),v=e._graphNodes[t.name],_=e.diagram.nameTable[v.tree.children[0]],y="lefttoright"==e.orientation||"righttoleft"==e.orientation,b="left"==v.tree.type||"leftoffset"==v.tree.type?-1:0,x=i,D=a,C=n,w=0;w<v.tree.children.length;w++)"alternate"==v.tree.type&&(z=w%2==0&&v.tree.children.length>2?"left":"right",b=w%2==0&&v.tree.children.length>2?-1:0),x=i+this._findOffset(e,t,v,z),s=e.diagram.nameTable[v.tree.children[w]],P=s.width?s.width:s._width,T=s.height?s.height:s._height,d=y?T:P,h=y?P:T,l=this._updateTree(e,x+b*d,D,s,n+1,void 0,!0),r=e._graphNodes[s.name],g={x:r.x,y:r.y,right:r.x+d,bottom:r.y+h},0==w?(this._uniteRects(l,g),u=l):this._uniteRects(u,l),!r.prevBounds||"alternate"==v.tree.type&&w%2==1&&v.tree.children.length>2||(j=void 0!==j?Math.min(r.canMoveBy,j):r.canMoveBy),v.maxLevel=Math.max(v.maxLevel||0,r.maxLevel||0),"alternate"==v.tree.type&&v.tree.children.length>2&&w%2==0?(0!=w&&(D=c.bottom+e.verticalSpacing/2),N.push({rBounds:g}),r.levelBounds&&(N=N.concat(r.levelBounds))):(D="alternate"==v.tree.type&&v.tree.children.length>2?Math.max(l.bottom,c.bottom)+e.verticalSpacing/2:l.bottom+e.verticalSpacing/2,n=v.maxLevel,L.push({rBounds:g}),p?this._uniteRects(p,g):p={x:r.x,y:r.y,right:r.x+d,bottom:r.y+h},r.levelBounds&&(L=L.concat(r.levelBounds))),0==w&&(v.firstChild={x:r.x,canMoveBy:r.canMoveBy,child:s.name}),this._hasChild(e,s)&&(!v.firstChild||v.firstChild.x>=r.firstChild.x?(r.firstChild&&v.firstChild.canMoveBy<r.canMoveBy&&(j=v.firstChild.canMoveBy,r.canMoveBy=j,e._graphNodes[v.firstChild.child].canMoveBy=j,v.firstChild.canMoveBy=j),v.firstChild={x:r.firstChild.x,canMoveBy:void 0!==j?j:r.canMoveBy,child:s.name}):r.firstChild&&r.translated&&v.firstChild.canMoveBy>r.canMoveBy&&(v.firstChild.canMoveBy=e._graphNodes[v.firstChild.child].canMoveBy=r.canMoveBy)),c=g;return o?v.levelBounds=L:("alternate"==v.tree.type&&v.tree.children.length>2&&(m={x:N[0].rBounds.x,y:N[0].rBounds.y,right:N[N.length-1].rBounds.right,bottom:N[N.length-1].rBounds.bottom},S=this._findIntersectingLevels(e,m,C+1),this._updateRearBounds(e,null,N,C+1,S)),S=this._findIntersectingLevels(e,p||u,C+1),this._updateRearBounds(e,null,p?L:[{rBounds:u}],C+1,S)),isNaN(j)||(e._graphNodes[_.name].canMoveBy=j),v.childBounds=u,v.mid=i,u},_splitChildrenInRows:function(t,i){var a,n,o=t._graphNodes[i.name],s=4,r=[],l=o.tree.children.length,d=e.extend([],!0,o.tree.children);for(o.tree.rows?(a=o.tree.children.length,n=Math.ceil(a/o.tree.rows),s=n%2==0?n:n+1):3==o.tree.children.length||4==o.tree.children.length?s=2:5==o.tree.children.length&&(s=3);l>0;)r[r.length]=d.splice(0,s),l-=s,s>l&&(s=l);return r},_findOffset:function(e,t,i,a){var n=0,o="lefttoright"==e.orientation||"righttoleft"==e.orientation?t.height?t.height:t._height:t.width?t.width:t._width,s=a?a:i.tree.type;switch(n=i.tree.offset||(0===i.tree.offset?0:20),"alternate"==i.tree.type&&n>=e.horizontalSpacing&&(n=e.horizontalSpacing/2),s){case"left":n=o/2-n;break;case"right":n+=o/2}return n},_translateSiblings:function(e,t,i){var a,n,o,s;for(o=e._graphNodes[t.name],s=e._graphNodes[i.name].diff-e._graphNodes[i.name].canMoveBy,a=0;a<o.tree.children.length&&i.name!=o.tree.children[a];a++)n=e._graphNodes[o.tree.children[a]],n.x+=s},_uniteRects:function(e,t){e.x=Math.min(e.x,t.x),e.right=Math.max(e.right,t.right),e.bottom=Math.max(e.bottom,t.bottom)},_spaceLeftFromPrevSubTree:function(e,t,i){for(var a,n,o=e._graphNodes[t.name],s=e.horizontalSpacing,r=0;r<o.intersect.length;r++)n=e.levels[o.intersect[r]].rBounds,a=i.x-(n.right+s),(void 0==o.diff||a<o.diff)&&(o.diff=a,o.prevBounds=e.levels[o.intersect[r]])},_findIntersectingLevels:function(e,t,i,a){var n,o,s,r={x:t.x,y:t.y,right:t.right,bottom:t.bottom};r.y-=e.verticalSpacing/2,r.bottom+=e.verticalSpacing/2,n=[],s=void 0!==a?a:i,o=e.levels[s]?e.levels[s].rBounds:null;do{if(o&&(r.y<o.y&&r.bottom>o.y||r.y<o.bottom&&o.bottom<r.bottom||r.y>=o.y&&r.bottom<=o.bottom||r.y<o.y&&r.bottom>o.bottom))n.splice(0,0,s);else if(o&&o.bottom<r.y)break;s--,o=e.levels[s]?e.levels[s].rBounds:null}while(s>=0);s=(void 0!==a?a:i)+1,o=e.levels[s]?e.levels[s].rBounds:null;do{if(o&&(r.y<o.y&&r.bottom>o.y||r.y<o.bottom&&o.bottom<r.bottom||r.y>=o.y&&r.bottom<=o.bottom||r.y<o.y&&r.bottom>o.bottom))n.push(s);else if(o&&o.y>r.bottom)break;s++,o=e.levels[s]?e.levels[s].rBounds:null}while(s<=e.levels.length);return n},_findLevel:function(e,t){for(var i=t,a=0,n=e.levels[a]?e.levels[a].rBounds:null;a<e.levels.length;){if(n&&i.bottom<n.y)return a;a++,n=e.levels[a]?e.levels[a].rBounds:null}return a},_updateEdges:function(e,i,a){var n,o,s=e._graphNodes[i.name];if(i.outEdges&&i.outEdges.length&&i.isExpanded)for(n=0;n<i.outEdges.length;n++)o=e.diagram.nameTable[e.diagram.nameTable[i.outEdges[n]].targetNode],o.excludeFromLayout||(t.datavisualization.Diagram.Util._collectionContains(o.name,s.tree.children)||s.tree.children.push(o.name),o.outEdges&&o.outEdges.length&&o.isExpanded&&(s.tree.hasSubTree=!0),this._updateEdges(e,o,a+1));s.tree.level=a,s.tree.hasSubTree&&(s.tree.orientation="horizontal"),e.getLayoutInfo&&"organizationalchart"==e.type&&(e.getLayoutInfo(e.diagram,i,s.tree),"balanced"==s.tree.type&&s.tree.hasSubTree&&(s.tree.type="center",s.tree.orientation="horizontal")),e.level&&"alternate"!=s.tree.type&&a>=e.level&&(s.tree.hasSubTree=!1)},_updateAnchor:function(e,i){var a,n,o,s,r,l,d,h,c,u,g,m,p;if(e.diagram.viewPort=n=t.datavisualization.Diagram.ScrollUtil._viewPort(e.diagram,!0),n.x=0,n.y=0,d=e.bounds?e.bounds:n,h=e.diagram._layoutOrientation(),"toptobottom"==h||"bottomtotop"==h){switch(e.horizontalAlignment){case"left":e._anchorX=d.x-i.x+e.margin.left;break;case"right":e._anchorX=d.x+d.width-e.margin.right-i.right;break;case"center":e._anchorX=d.x+d.width/2-(i.x+i.right)/2}switch(e.verticalAlignment){case"top":c=d.y+e.margin.top,e._anchorY="toptobottom"==h?c:i.bottom+c;break;case"bottom":u=d.y+d.height-e.margin.bottom,e._anchorY="toptobottom"==h?u-i.bottom:u;break;case"center":p=d.y+d.height/2,e._anchorY="toptobottom"==e.orientation?p-(i.y+i.bottom)/2:p+(i.y+i.bottom)/2}}else if("lefttoright"==h||"righttoleft"==h){switch(e.horizontalAlignment){case"left":g=d.x+e.margin.left,e._anchorX="lefttoright"==h?g:i.bottom+g;break;case"right":m=d.x+d.width-e.margin.right,e._anchorX="lefttoright"==h?m-i.bottom:m;break;case"center":p=d.width/2+d.x,e._anchorX="lefttoright"==e.orientation?p-(i.y+i.bottom)/2:p+(i.y+i.bottom)/2}switch(e.verticalAlignment){case"top":e._anchorY=d.y+e.margin.top-i.x;break;case"center":e._anchorY=d.y+d.height/2-(i.right+i.x)/2;break;case"bottom":e._anchorY=d.y+d.height-e.margin.bottom-i.right}}if(e.fixedNode){for(o=e.diagram.nameTable[e.fixedNode],s=o.width?o.width:o._width,r=o.height?o.height:o._height,e._anchorX=o.offsetX,e._anchorY=o.offsetY,e._anchorX+="righttoleft"==e.orientation?s*o.pivot.x:-s*o.pivot.x,e._anchorY+="bottomtotop"==e.orientation?r*o.pivot.y:-r*o.pivot.y,a=o,l=0;a.inEdges.length;)a=this._getParentNode(e,a),l+=e._graphNodes[a.name].subTreeTranslation||0;"lefttoright"==e.orientation||"righttoleft"==e.orientation?(e._anchorX-=e._graphNodes[o.name].y,e._anchorY-=e._graphNodes[o.name].x+l):(e._anchorX-=e._graphNodes[o.name].x+l,e._anchorY-=e._graphNodes[o.name].y)}},_updateConnectors:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m=0,p=0,f=0,v=0,_=0,y=0;if(r=e._graphNodes[i.name],i.outEdges.length)for(n=0;n<i.outEdges.length;n++)if(o=e.diagram.nameTable[i.outEdges[n]],s=e.diagram.nameTable[o.targetNode],o.visible&&!o._visited){if(o._visited=!0,e.getConnectorSegments)h=e.getConnectorSegments(e.diagram,o);else if(r&&-1!=r.tree.children.indexOf(o.targetNode)){var b=i.width?i.width:i._width,x=i.height?i.height:i._height,D=s.width?s.width:s._width,C=s.height?s.height:s._height;"organizationalchart"==e.type&&("toptobottom"==e.orientation||"bottomtotop"==e.orientation?(p="toptobottom"==e.orientation?x:-x,v="toptobottom"==e.orientation?-C:C,l="toptobottom"==e.orientation?"bottom":"top",r.tree.assistants.length?(_=Math.abs(s.offsetY+v/2-(i.offsetY+p/2))-e.verticalSpacing/2,h=[{type:"orthogonal",length:_,direction:l}]):"horizontal"!=r.tree.orientation||1!=o.segments.length&&"balanced"!=r.tree.type?"horizontal"==r.tree.orientation?h=[{type:"orthogonal"}]:r.tree.enableRouting&&(_=Math.abs(s.offsetY-(i.offsetY+p/2)),h=[{type:"orthogonal",length:_,direction:l}],r.tree.offset<5&&(d="left"==r.tree.type?"right":"left",_=e.verticalSpacing/4,y=Math.abs(r.tree.offset)+e.horizontalSpacing/2,h=[{type:"orthogonal",length:_,direction:l},{type:"orthogonal",length:y,direction:d}])):"balanced"==r.tree.type?5==r.tree.children.length&&n>2?(c=r.tree.children[1],isNaN(e._graphNodes[c]._treeWidth)&&(e._graphNodes[c]._treeWidth=e.diagram.nameTable[c].width),u=3==n?e.diagram.nameTable[c].offsetX-e._graphNodes[c]._treeWidth/2-e.horizontalSpacing/2:e.diagram.nameTable[c].offsetX+e._graphNodes[c]._treeWidth/2+e.horizontalSpacing/2,h=[{type:"orthogonal",length:e.verticalSpacing/2,direction:"bottom"},{type:"orthogonal",length:i.offsetX-u,direction:"left"},{type:"orthogonal",length:s.offsetY+v/2-(i.offsetY+p/2)-e.verticalSpacing,direction:"bottom"}]):(g=Math.min(30,e.verticalSpacing/2)*("bottom"==l?1:-1),_=Math.abs(s.offsetY+v*s.pivot.y-g-(i.offsetY+p*(1-s.pivot.y))),h=[{type:"orthogonal",length:_,direction:l}]):e.diagram._dock(o,e.diagram.nameTable)):(m="lefttoright"==e.orientation?b:-b,f="lefttoright"==e.orientation?-D:D,l="lefttoright"==e.orientation?"right":"left",r.tree.assistants.length?(_=Math.abs(s.offsetX+f/2-(i.offsetX+m/2))-e.verticalSpacing/2,h=[{type:"orthogonal",length:_,direction:l}]):"horizontal"!=r.tree.orientation||1!=o.segments.length&&"balanced"!=r.tree.type?"horizontal"==r.tree.orientation?h=[{type:"orthogonal"}]:(_=Math.abs(s.offsetX-(i.offsetX+m/2)),h=[{type:"orthogonal",length:_,direction:l}],r.tree.offset<5&&(d="left"==r.tree.type?"bottom":"top",_=e.verticalSpacing/4,y=Math.abs(r.tree.offset)+10,h=[{type:"orthogonal",length:_,direction:l},{type:"orthogonal",length:y,direction:d}])):"balanced"==r.tree.type?5==r.tree.children.length&&n>2?(c=r.tree.children[1],isNaN(e._graphNodes[c]._treeWidth)&&(e._graphNodes[c]._treeWidth=e.diagram.nameTable[c].width),u=3==n?e.diagram.nameTable[c].offsetY-e._graphNodes[c]._treeWidth/2-e.verticalSpacing/2:e.diagram.nameTable[c].offsetY+e._graphNodes[c]._treeWidth/2+e.verticalSpacing/2,h=[{type:"orthogonal",length:e.horizontalSpacing/2,direction:"right"},{type:"orthogonal",length:i.offsetY-u,direction:"top"},{type:"orthogonal",length:s.offsetX+f/2-(i.offsetX+m/2)-e.horizontalSpacing,direction:"right"}]):(g=Math.min(30,e.horizontalSpacing/2)*("right"==l?1:-1),_=Math.abs(s.offsetX+f*s.pivot.x-g-(i.offsetX+m*(1-s.pivot.x))),h=[{type:"orthogonal",length:_,direction:l}]):e.diagram._dock(o,e.diagram.nameTable)))}h?e.diagram.updateConnector(o.name,{segments:h}):e.diagram._dock(o,e.diagram.nameTable),e.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(o,e.diagram),s&&!s.excludeFromLayout&&(s.isExpanded||this._hasChild(e,s))&&this._updateConnectors(e,s,a+1)}if(r&&r.tree.assistants.length)for(n=0;n<r.tree.assistants.length;n++)s=e.diagram.nameTable[r.tree.assistants[n]],o=e.diagram.nameTable[s.inEdges[0]],_=Math.abs(s.offsetY-(i.offsetY+p/2)),h=[{type:"orthogonal",length:_,direction:l}],h&&e.diagram.updateConnector(o.name,{segments:h}),e.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(o,e.diagram),(s.isExpanded||this._hasChild(e,s))&&this._updateConnectors(e,s,a+1)},_updateNodes:function(e,i,a,n,o,s){var r,l,d,h,c;i._visited=!0;var u=i.width?i.width:i._width,g=i.height?i.height:i._height,m=i.offsetX,p=i.offsetY;if(i.excludeFromLayout||(m=e._anchorX,p=e._anchorY,"lefttoright"==e.orientation?(m+=e._graphNodes[i.name].y+u/2,p+=e._graphNodes[i.name].x+a+g/2):"righttoleft"==e.orientation?(m-=e._graphNodes[i.name].y+u/2,p+=e._graphNodes[i.name].x+a+g/2):"toptobottom"==e.orientation?(m+=e._graphNodes[i.name].x+a+u/2,p+=e._graphNodes[i.name].y+g/2):(m+=e._graphNodes[i.name].x+a+u/2,p-=e._graphNodes[i.name].y+g/2),e._graphNodes&&(d=e._graphNodes[i.name],d&&(h=d.tree,h.enableRouting||(e.diagram.minSpaceBetweenNode||(e.diagram.minSpaceBetweenNode=[]),e.diagram.minSpaceBetweenNode.push(i.name)))),o=o?o:0,s=s?s:0,m+=o,p+=s,e.updateView?e.diagram._translate(i,m-(i.offsetX||0),p-(i.offsetY||0),e.diagram.nameTable):(n=i.name==e.fixedNode||n,!n&&this._withinView(m,p,u,g,i,e)?(m!=i.offsetX||p!=i.offsetY)&&e.objects.push({object:i.name,diff:m-i.offsetX,diffy:p-i.offsetY}):e.diagram._translate(i,m-(i.offsetX||0),p-(i.offsetY||0),e.diagram.nameTable))),c=[],this._hasChild(e,i))for(l=0;l<e._graphNodes[i.name].tree.children.length;l++)r=e.diagram.nameTable[e._graphNodes[i.name].tree.children[l]],this._updateNodes(e,r,a+(e._graphNodes[i.name].subTreeTranslation||0),n,o,s),c.push(r);if(e._graphNodes[i.name].tree.assistants.length)for(l=0;l<e._graphNodes[i.name].tree.assistants.length;l++)r=e.diagram.nameTable[e._graphNodes[i.name].tree.assistants[l]],this._updateNodes(e,r,a+(e._graphNodes[i.name].subTreeTranslation||0),null,o,s);e.diagram._updateQuad(e.diagram.nameTable[i.name]),e.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,e.diagram)},_withinView:function(e,t,i,a,n,o){var s=o.diagram.model.scrollSettings.horizontalOffset/o.diagram.model.scrollSettings.currentZoom,r=o.diagram.model.scrollSettings.verticalOffset/o.diagram.model.scrollSettings.currentZoom,l=o.diagram.model.scrollSettings.viewPortWidth/o.diagram.model.scrollSettings.currentZoom+s,d=o.diagram.model.scrollSettings.viewPortHeight/o.diagram.model.scrollSettings.currentZoom+r;return(e+i/2>s||n.offsetX+i/2>s)&&(l>e-i/2||n.offsetX-i/2<l)&&(t+a/2>r||n.offsetY+a/2>r)&&(d>t-a/2||n.offsetY-a/2<d)},_getDimensions:function(e,t,i,a,n){var o,s=t.width?t.width:t._width,r=t.height?t.height:t._height;return("lefttoright"==e.orientation||"righttoleft"==e.orientation)&&(n||(o=i,i=a,a=o),r=t.width?t.width:t._width,s=t.height?t.height:t._height),{x:i,y:a,width:s,height:r}},_getParentNode:function(e,t){return t.inEdges&&t.inEdges.length?e.diagram.nameTable[e.diagram.nameTable[t.inEdges[0]].sourceNode]:void 0},_hasChild:function(e,t){var t=e._graphNodes[t.name];return t.tree.children&&t.tree.children.length},_setUpLayoutInfo:function(e){var t={};return t.subTreeTranslation=0,"organizationalchart"==e.type?t.tree={orientation:"vertical",type:"alternate",offset:20,enableRouting:!0}:"hierarchicaltree"==e.type&&(t.tree={orientation:"horizontal",type:"center",enableRouting:!0}),t.tree.children=[],t.tree.assistants=[],t.tree.level=0,t.translate=!0,t}},t.datavisualization.Diagram.RadialTreeLayout={doLayout:function(e){
var t,i,a;for(t=e.diagram,i=t.nodes(),a=0;a<i.length;a++)i[a].excludeFromLayout||(e._graphNodes[i[a].name]=this._setUpLayoutInfo(e,i[a]),i[a].inEdges&&i[a].inEdges.length||e._firstLevelNodes.push(i[a]));e.rootNode&&t.nameTable[e.rootNode]?e._centerNode=t.nameTable[e.rootNode]:e._firstLevelNodes.length&&(e._centerNode=e._firstLevelNodes[0],t.model.layout.rootNode=e._centerNode.name),e._centerNode&&(this._updateEdges(e,e._centerNode,0),this._depthFirstAllignment(e,e._centerNode,0,0),this._populateLevels(e),this._transformToCircleLayout(e),this._updateAnchor(e),this._updateNodes(e,e._centerNode))},_updateEdges:function(e,t,i){var a,n,o=e._graphNodes[t.name];for(e.layoutNodes.push(o),o.level=i,o.visited=!0,e.maxLevel=Math.max(e.maxLevel,i),a=0;a<t.outEdges.length;a++)n=e.diagram.nameTable[e.diagram.nameTable[t.outEdges[a]].targetNode],n.excludeFromLayout||n.visited||(o.children.push(n),this._updateEdges(e,n,i+1))},_depthFirstAllignment:function(e,t,i,a){var n,o,s,r,l;if(t){if(o=e._graphNodes[t.name],o.children.length){for(a+=300,l=0;l<o.children.length;l++)n=this._depthFirstAllignment(e,o.children[l],i,a),i=n.x,a=n.y;if(o.children=o.children.sort(function(t,i){return e._graphNodes[t.name].x-e._graphNodes[i.name].x}),s=e._graphNodes[o.children[0].name].min,r=e._graphNodes[o.children[o.children.length-1].name].max,o.x=s+(r-s)/2,i=r+e.horizontalSpacing,o.segmentOffset=r+e.horizontalSpacing,o.x-=o.width/2,o.y-=o.height/2,o.min=s,o.max=r,o.x<s&&o.visited){for(o.x=s,i=o.x+o.width/2-(r-s)/2,o.visited=!1,l=0;l<o.children.length;l++)n=this._depthFirstAllignment(e,o.children[l],i,a);o.visited=!0,i=o.x+o.width+e.horizontalSpacing}r=e._graphNodes[o.children[o.children.length-1].name].segmentOffset,i=r>i?r:i,a-=300,o.y=a}else o.x=i,o.y=a,o.min=i,o.max=i+o.width,i+=o.width+e.horizontalSpacing;return{x:i,y:a}}},_populateLevels:function(e){var t,i,a,n,o=[],s=Math.min.apply(Math,e.layoutNodes.map(function(e){return e.x})),r=Math.max.apply(Math,e.layoutNodes.map(function(t){return t.x+t.width+e.horizontalSpacing})),l=r-s;for(e.levels=[],t=0;t<=e.maxLevel;t++){for(o=e.layoutNodes.filter(function(e){return e.level==t?e:void 0}),i={},o=o.sort(function(e,t){return e.x-t.x}),i.min=o[0].x,i.max=o[o.length-1].x+o[o.length-1].width+e.horizontalSpacing,i._actualCircumference=0,i.height=0,a=0;a<o.length;a++)o[a].height>i.height&&(i.height=o[a].height),i._actualCircumference+=Math.max(o[a].width,o[a].height),a!=o.length-1&&(i._actualCircumference+=e.horizontalSpacing);for(i.circumference=i.max-i.min,i._actualCircumference<i.circumference&&(i.circumference=(i.circumference+i._actualCircumference)/2),i.radius=i.circumference/(2*Math.PI)+i.height,i.nodes=[],t>1&&e.levels[t-1].radius+e.levels[t-1].height>=i.radius&&(i.radius=e.levels[t-1].radius+e.levels[t-1].height),n=0;n<o.length;n++)o[n].ratio=Math.abs(o[n].x+o[n].width/2-s)/l,i.nodes.push(o[n]);e.levels.push(i)}},_transformToCircleLayout:function(e){var t,i,a,n=e._graphNodes[e._centerNode.name];for(n.x=0,n.y=0,t=1;t<e.levels.length;t++)for(i=0;i<e.levels[t].nodes.length;i++)a=e.levels[t].nodes[i],a.x=Math.cos(360*a.ratio*Math.PI/180)*(e.levels[t].radius+e.verticalSpacing*t),a.y=Math.sin(360*a.ratio*Math.PI/180)*(e.levels[t].radius+e.verticalSpacing*t),e._anchorX=Math.min(e._anchorX,a.x),e._anchorY=Math.min(e._anchorY,a.y)},_updateAnchor:function(e){var i=t.datavisualization.Diagram.ScrollUtil._viewPort(e.diagram);e._centerNode?(e._anchorX=e._centerNode.offsetX||i.width/2,e._anchorY=e._centerNode.offsetY||i.height/2):(e._anchorX=i.width/2,e._anchorY=i.height/2)},_updateNodes:function(e,i){var a,n,o=e._graphNodes[i.name],s=o.x+e._anchorX,r=o.y+e._anchorY;for(e.diagram._translate(i,s-i.offsetX||0,r-i.offsetY||0,e.diagram.nameTable),a=0;a<o.children.length;a++)n=o.children[a],this._updateNodes(e,e.diagram.nameTable[n.name]);e.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,e.diagram)},_isValidLayout:function(e){if(e._centerNode){var t=Math.max.apply(Math,e.diagram.nodes().map(function(e){return e.inEdges.length}));if(2>t)return!0}return!1},_setUpLayoutInfo:function(e,t){var i={};return i.name=t.name,i.x=0,i.y=0,i.min=0,i.max=0,i.width=t.width?t.width:t._width,i.height=t.height?t.height:t._height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i}},t.datavisualization.Diagram.MultipleParentHierarchicalLayout={doLayout:function(e){var i,a,n,o,s,r,l,d,h,c,u,g;for(this.diagram=e.diagram,i=this.diagram.nodes(),this.nodes=[],a={},u=0;u<i.length;u++)n=this._createVertex(i[u],i[u].name,0,0,i[u].width,i[u].height),this.nodes.push(n),a[n.name]=n;if(o=[],null==this.roots&&null!=parent)for(s=this._findRoots(a,e),u=0;u<s.length;u++)l=Object(),o.push(l),this._traverse(s[u],!0,null,l,o,a);for(r={marginX:0,marginY:0},u=0;u<o.length;u++){l=o[u],d=[];for(h in l)d.push(l[h]);c=new t.datavisualization.Diagram.MultiParentModel(this,d,s,e),this._cycleStage(c),this._layeringStage(c,s),this._crossingStage(c),r=this._placementStage(c,r.marginX,r.marginY,parent)}var m=this._getModelBounds(this.nodes),p=t.datavisualization.Diagram.ScrollUtil._viewPort(e.diagram,!0),f=(p.width-m.width)/2,v=e.margin||{};for(v.left=v.left||0,v.right=v.right||0,v.top=v.top||0,v.bottom=v.bottom||0,e.marginX&&(v.left=e.marginX),e.marginY&&(v.top=e.marginY),u=0;u<this.nodes.length;u++)if(g=this.nodes[u],g&&!g.source&&!g.target){var _=this.diagram.nameTable[g.name],y=g.geometry.x+_.width/2+v.left,b=g.geometry.y+_.height/2+v.top,x=y,D=b;"bottomtotop"===e.orientation?D=m.height-b:"righttoleft"===e.orientation&&(x=m.width-y),x+=f,this.diagram._translate(_,x-_.offsetX,D-_.offsetY,e.diagram.nameTable),this.diagram._isInit||t.datavisualization.Diagram.DiagramContext.update(_,this.diagram)}},_getModelBounds:function(e){var i,a,n;for(e=e.slice(),i=null,a=null,n=0;n<e.length;n++)i=e[n].geometry,a=a?t.datavisualization.Diagram.Geometry.union(a,i):i;return a},_placementStage:function(e,t,i,a){var n=this._coordinateAssignment(t,i,a,e);return n.model=e,n.widestRankValue=null,this._placementStageExecute(n,a),{marginX:n.marginX+e.layout.horizontalSpacing,marginY:n.marginY+e.layout.verticalSpacing}},_calculateWidestRank:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m=!1;for(("lefttoright"===e.model.layout.orientation||"righttoleft"===e.model.layout.orientation)&&(m=!0),n=-e.verticalSpacing,o=0,e.rankSizes=[],e.rankOffset=[],s=a.maxRank;s>=0;s--){var p=0,f=a.ranks[s],v=m?e.marginY:e.marginX;for(c=0;c<f.length;c++)r=f[c],r.cell&&(r.cell.inEdges||r.cell.outEdges)?(l=t.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[r.cell.name]),null!=l&&(r.width=l.width,r.height=l.height),p=Math.max(p,m?r.width:r.height)):t.datavisualization.Diagram.CrossReduction.prototype._isVertex(r)||(d=1,null!=r.edges&&(d=r.edges.length),r.width=10*(d-1)),m&&(r.height||(r.height=0)),v+=(m?r.height:r.width)/2,this._setXY(r,s,v,!!m),this._setTempVariable(r,s,v),v+=(m?r.height:r.width)/2+e.horizontalSpacing,v>e.widestRankValue&&(e.widestRankValue=v,e.widestRank=s),e.rankSizes[s]=v;for(e.rankOffset[s]=n,h=p/2+o/2+e.verticalSpacing,o=p,"north"==e.orientation||"west"==e.orientation?n+=h:n-=h,c=0;c<f.length;c++)u=f[c],g=this._getOffset(u,n,p,!m),this._setXY(u,s,g,!m)}},_getOffset:function(e,t,i,a){return t-(a?(i-e.height)/2:(i-e.width)/2)},_setTempVariable:function(e,i,a){t.datavisualization.Diagram.CrossReduction.prototype._isVertex(e)?e.temp[0]=a:e.temp[i-e.minRank-1]=a},_coordinateAssignment:function(e,t,i,a){var n={};return n.horizontalSpacing=a.layout.horizontalSpacing,n.verticalSpacing=a.layout.verticalSpacing,n.orientation="north",n.marginX=n.marginX=e?e:0,n.marginY=n.marginY=t?t:0,n},_getXY:function(e,i,a){return t.datavisualization.Diagram.CrossReduction.prototype._isVertex(e)?a?e.y[0]:e.x[0]:a?e.y[i-this.minRank-1]:e.x[i-this.minRank-1]},_setXY:function(e,t,i,a){e&&e.cell&&(e.cell.inEdges||e.cell.outEdges?a?e.y[0]=i:e.x[0]=i:a?e.y[t-e.minRank-1]=i:e.x[t-e.minRank-1]=i)},_rankCoordinates:function(e,i,a,n){var o,s,r,l,d,h=!1;("lefttoright"===e.model.layout.orientation||"righttoleft"===e.model.layout.orientation)&&(h=!0);var c=n.ranks[i],u=0,g=(h?e.marginY:e.marginX)+(e.widestRankValue-e.rankSizes[i])/2;for(o=0;o<c.length;o++)s=c[o],t.datavisualization.Diagram.CrossReduction.prototype._isVertex(s)?(r=t.datavisualization.Diagram.Util.bounds(this.diagram.nameTable[s.cell.name]),null!=r&&(s.width=r.width,s.height=r.height),u=Math.max(u,s.height)):t.datavisualization.Diagram.CrossReduction.prototype._isVertex(s)||(l=1,null!=s.edges&&(l=s.edges.length),h?s.height=10*(l-1):s.width=10*(l-1)),d=(h?s.height:s.width)/2,g+=d,this._setXY(s,i,g,!!h),this._setTempVariable(s,i,g),g+=d+e.horizontalSpacing},_initialCoords:function(e,t,i){var a;for(this._calculateWidestRank(e,t,i),a=e.widestRank;a>=0;a--)a<i.maxRank&&this._rankCoordinates(e,a,t,i);for(a=e.widestRank+1;a<=i.maxRank;a++)a>0&&this._rankCoordinates(e,a,t,i)},_isAncestor:function(e,t){if(null!=t&&null!=e.hashCode&&null!=t.hashCode&&e.hashCode.length<t.hashCode.length){if(e.hashCode==t.hashCode)return!0;if(null==e.hashCode||null==e.hashCode)return!1;for(var i=0;i<e.hashCode.length;i++)if(e.hashCode[i]!=t.hashCode[i])return!1;return!0}return!1},_weightedCellSorter:function(e,t){var i={};return i.cell=e?e:null,i.weightedValue=t?t:0,i.visited=!1,i.rankIndex=null,i},_minNode:function(e,i){for(var a,n,o,s,r,l,d,h,c,u,g=[],m={map:{}},p=[],f=0;f<=i.maxRank;f++)for(p[f]=i.ranks[f],a=0;a<p[f].length;a++)n=p[f][a],o=this._weightedCellSorter(n,f),o.rankIndex=a,o.visited=!0,g.push(o),t.datavisualization.Diagram.MultiParentModel.prototype._setDictionary(m,n,o,!0);for(var v=10*g.length,_=0,y=1;g.length>0&&v>=_;){var b=g.shift(),x=b.cell,D=b.weightedValue,C=parseInt(b.rankIndex),w=t.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(x,D),z=t.datavisualization.Diagram.CrossReduction.prototype._getConnectedCellsOnLayer(x,D,!0),S=w.length,P=z.length,T=this._medianXValue(e,w,D+1),j=this._medianXValue(e,z,D-1),L=S+P,N=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(x,D),O=N;L>0&&(O=(T*S+j*P)/L),s=!1,r=null,N-y>O?0==C?(r=O,s=!0):(l=p[D][C-1],d=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(l,D),d=d+l.width/2+e.intraCellSpacing+x.width/2,O>d?(r=O,s=!0):d<t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(x,D)-y&&(r=d,s=!0)):O>N+y&&(h=p[D].length,C==h-1?(r=O,s=!0):(c=p[D][C+1],u=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(c,D),u=u-c.width/2-e.intraCellSpacing-x.width/2,u>O?(r=O,s=!0):u>t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(x,D)+y&&(r=u,s=!0))),s&&(this._setTempVariable(x,D,r),this._updateNodeList(g,m,w),this._updateNodeList(g,m,z)),t.datavisualization.Diagram.CrossReduction.prototype._isVertex(b.cell)&&(b.visited=!1),_++}},_updateNodeList:function(e,i,a){for(var n,o,s=0;s<a.length;s++)n=a[s],o=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(i,n),null!=o&&0==o.visited&&(o.visited=!0,e.push(o))},_medianXValue:function(e,i,a){var n,o;if(0==i.length)return 0;for(n=[],o=0;o<i.length;o++)n[o]=t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(i[o],a);if(n.sort(function(e,t){return e-t}),i.length%2==1)return n[Math.floor(i.length/2)];var s=i.length/2,r=n[s-1],l=n[s];return(r+l)/2},_placementStageExecute:function(e){var i,a,n,o,s,r,l,d=!1;for(("lefttoright"===e.model.layout.orientation||"righttoleft"===e.model.layout.orientation)&&(d=!0),e.jettyPositions=Object(),i=e.model,d?e.currentYDelta=0:e.currentXDelta=0,this._initialCoords(e,{model:i},i),this._minNode(e,i),a=1e8,e.maxIterations||(e.maxIterations=8),n=0;n<e.maxIterations;n++){if((d?e.currentYDelta:e.currentXDelta)<a){for(o=0;o<i.ranks.length;o++)for(s=i.ranks[o],r=0;r<s.length;r++)l=s[r],this._setXY(l,o,t.datavisualization.Diagram.CrossReduction.prototype._getTempVariable(l,o),!!d);a=d?e.currentYDelta:e.currentXDelta}d?e.currentYDelta=0:e.currentXDelta=0}this._setCellLocations(e,i)},_setCellLocations:function(e,t){for(var i=this._getValues(t.vertexMapper),a=0;a<i.length;a++)this._setVertexLocation(e,i[a])},_garphModelsetVertexLocation:function(i,a,n,o){var s=(i.model,a.geometry),r=null;return null!=s&&(r=new t.datavisualization.Diagram.Rectangle(n,o,s.width,s.height),(s.x!=n||s.y!=o)&&(s=e.extend(!0,{},s),s.x=n,s.y=o,a.geometry=s)),r},_setVertexLocation:function(e,t){var i=!1;("lefttoright"===e.model.layout.orientation||"righttoleft"===e.model.layout.orientation)&&(i=!0);var a=t.cell,n=t.x[0]-t.width/2,o=t.y[0]-t.height/2;this._garphModelsetVertexLocation(e,a,n,o),i?(e.marginY||(e.marginY=null),e.marginY=Math.max(e.marginY,o+t.height)):(e.marginX||(e.marginX=null),e.marginX=Math.max(e.marginX,n+t.width))},_getValues:function(e){var t,i=[];if(e.map)for(t in e.map)i.push(e.map[t]);return i},_createVertex:function(e,i,a,n,o,s){var r=new t.datavisualization.Diagram.Rectangle(a,n,o,s);return r.relative=!0,{value:i,geometry:r,name:i,vertex:!0,inEdges:e.inEdges.slice(),outEdges:e.outEdges.slice()}},_crossingStage:function(e){var i=new t.datavisualization.Diagram.CrossReduction(this);i._execute(e)},_layeringStage:function(e){this._initialRank(e),this._fixRanks(e)},_initialRank:function(e){for(var i,a,n,o,s,r=e._startNodes,l=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(e.vertexMapper),d=r.slice();r.length>0;){var h=r[0],c=h.connectsAsTarget,u=h.connectsAsSource,g=!0,m=1e8;for(a=0;a<c.length;a++){if(o=c[a],5270620!=o.temp[0]){g=!1;break}s=o.source,m=Math.min(m,s.temp[0]-1)}if(g){if(h.temp[0]=m,e.maxRank||(e.maxRank=1e8),e.maxRank=Math.min(e.maxRank,m),null!=u)for(a=0;a<u.length;a++)o=u[a],o.temp[0]=5270620,s=o.target,-1==s.temp[0]&&(r.push(s),s.temp[0]=-2);r.shift()}else if(i=r.shift(),r.push(h),i==h&&1==r.length)break}for(a=0;a<l.length;a++)l[a].temp[0]-=e.maxRank;for(a=0;a<d.length;a++){var h=d[a],p=0,c=h.connectsAsSource;for(n=0;n<c.length;n++)o=c[n],s=o.target,h.temp[0]=Math.max(p,s.temp[0]+1),p=h.temp[0]}e.maxRank=1e8-e.maxRank},_fixRanks:function(e){e._fixRanks()},_cycleStage:function(e){var i,a,n,o,s,r,l={};for(e._startNodes=[],i=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionaryValues(e.vertexMapper),a={},s=0;s<i.length;s++)i[s].temp[0]=-1,a[i[s].id]=i[s];if(window.model=e,window.objLayout=this,n=null,null!=e.roots)for(o=e.roots,n=[],s=0;s<o.length;s++)n[s]=t.datavisualization.Diagram.MultiParentModel.prototype._getDictionary(e.vertexMapper,o[s]),null!=n[s]&&e._startNodes.push(n[s]);e._visit("removeParentConnection",n,!0,null,l,a),r=t.datavisualization.Diagram.MultiParentModel.prototype._clone(l,null,!0),e._visit("removeNodeConnection",a,!0,r,l,a)},_remove:function(e,i){var a,n,o=null;if("object"==typeof i)for(a=t.datavisualization.Diagram.Util.indexOf(i,e);a>=0;)i.splice(a,1),o=e,a=t.datavisualization.Diagram.Util.indexOf(i,e);for(n in i)i[n]==e&&(delete i[n],o=e);return o},_invert:function(e){var t=e.source;e.source=e.target,e.target=t,e.isReversed=!e.isReversed},_traverse:function(e,t,i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f;if(null!=e)if(s=e.name,null==o?0:null==o[s]){if(null==a[s])for(m=0;m<n.length;m++)if(p=n[m],null!=p[s]){for(f in p)a[f]=p[f];return n.splice(m,1),a}}else{for(null==a[s]&&(a[s]=e),null!==o&&delete o[s],r=this._getEdges(e),l=[],m=0;m<r.length;m++)l[m]=this._getVisibleTerminal(r[m],!0)==e;for(m=0;m<r.length;m++)if(!t||l[m]){for(d=this._getVisibleTerminal(r[m],!l[m]),h=1,c=0;c<r.length;c++){if(c==m)continue;u=l[c],g=this._getVisibleTerminal(r[c],!u),g==d&&(u?h++:h--)}h>=0&&(a=this._traverse(d,t,r[m],a,n,o))}}return a},_findRoots:function(e,t){var i,a,n,o,s,r=[],l=null,d=-1e5;for(a in e){var h=e[a],c=this._getEdges(h),u=0,g=0;for(n=0;n<c.length;n++)o=this._getVisibleTerminal(c[n],!0),o.name==h.name?u++:g++;0==g&&u>0&&r.push(h),s=u-g,s>d&&(d=s,l=h),t.rootNode&&e[a].name===t.rootNode.name&&(i=h)}return 0==r.length&&null!=l&&(t&&t.rootNode?r.push(i):r.push(l)),r},_getEdges:function(e){var t,i=[];if(e){for(t=0;e.inEdges.length>0&&t<e.inEdges.length;t++)i.push(this.diagram.nameTable[e.inEdges[t]]);for(t=0;e.outEdges.length>0&&t<e.outEdges.length;t++)i.push(this.diagram.nameTable[e.outEdges[t]])}return i},_getVisibleTerminal:function(e,t){var i,a=this.diagram.nameTable[e.targetNode];for(t&&(a=this.diagram.nameTable[e.sourceNode]),i=0;i<this.nodes.length;i++)if(this.nodes[i].name===a.name)return this.nodes[i]},_getEdgesBetween:function(e,t,i){var a,n,o,s,r;for(i=null!=i?i:!1,a=this._getEdges(e),n=[],o=0;o<a.length;o++)s=this._getVisibleTerminal(a[o],!0),r=this._getVisibleTerminal(a[o],!1),(s!=e||r!=t)&&(i||s!=t||r!=e)||n.push(a[o]);return n}},i=function(){function i(e,i,a,n){var o,s,r,l,d,h;for(this.roots=a,this.vertexMapper={map:{}},o=[],this.layout=n,this.maxRank=1e8,this._createInternalCells(e,i,o),s=0;s<i.length;s++){for(r=o[s].connectsAsSource,l=0;l<r.length;l++)if(d=r[l],h=d.edges,null!=h&&h.length>0){var c=h[0],u=e._getVisibleTerminal(c,!1),g=this._getDictionary(this.vertexMapper,u);o[s]==g&&(u=e._getVisibleTerminal(c,!0),g=this._getDictionary(this.vertexMapper,u)),null!=g&&o[s]!=g&&(d.target=g,0==g.connectsAsTarget.length&&(g.connectsAsTarget=[]),t.datavisualization.Diagram.Util.indexOf(g.connectsAsTarget,d)<0&&g.connectsAsTarget.push(d))}o[s].temp[0]=1}}return i.prototype.dfsCount=0,i.prototype._createInternalCells=function(e,i,a){for(var n,o,s,r,l,d,h,c=0;c<i.length;c++){for(a[c]={x:[],y:[],temp:[],cell:i[c],id:i[c].name,connectsAsTarget:[],connectsAsSource:[]},this._setDictionary(this.vertexMapper,i[c],a[c]),n=t.datavisualization.Diagram.MultipleParentHierarchicalLayout._getEdges(i[c]),a[c].connectsAsSource=[],o=0;o<n.length;o++)if(s=e._getVisibleTerminal(n[o],!1),s!=i[c]&&(r=e._getEdgesBetween(i[c],s,!1),l=e._getEdgesBetween(i[c],s,!0),null!=r&&r.length>0&&2*l.length>=r.length)){for(d={x:[],y:[],temp:[],edges:r,ids:[]},h=0;h<r.length;h++)d.ids.push(r[h].name);d.source=a[c],a[c].connectsAsSource||(a[c].connectsAsSource=[]),t.datavisualization.Diagram.Util.indexOf(a[c].connectsAsSource,d)<0&&a[c].connectsAsSource.push(d)}a[c].temp[0]=0}},i.prototype._fixRanks=function(){var e,t,i,a,n,o=[];for(this.ranks=[],i=0;i<this.maxRank+1;i++)o[i]=[],this.ranks[i]=o[i];if(e=null,null!=this.roots)for(t=this.roots,e=[],i=0;i<t.length;i++)a=t[i],n=this._getDictionary(this.vertexMapper,a),e[i]=n;this._visit("updateMinMaxRank",e,!1,null,null,null,o)},i.prototype._updateMinMaxRank=function(e,i,a,n,o,s,r,l){var d,h;if(i.maxRank||0==i.maxRank||(i.maxRank=-1),i.minRank||0==i.minRank||(i.minRank=-1),0==o&&i.maxRank<0&&i.minRank<0&&(l[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=l[i.maxRank].length-1),null!=e&&null!=a&&(d=e.maxRank-i.maxRank,d>1))for(a.maxRank=e.maxRank,a.minRank=i.maxRank,a.temp=[],a.x=[],a.y=[],h=a.minRank+1;h<a.maxRank;h++)l[h].push(a),t.datavisualization.Diagram.MultipleParentHierarchicalLayout._setTempVariable(a,h,l[h].length-1)},i.prototype._setDictionary=function(e,t,i){var a,n=t.name;return n||(n=this._getDictionary(e,t)),a=e.map[n],e.map[n]=i,a},i.prototype._getDictionary=function(e,t){this.multiObjectIdentityCounter||0==this.multiObjectIdentityCounter||(this.multiObjectIdentityCounter=0);var i=t.name;return i?e.map[i]:t.layoutObjectId?e.map[t.layoutObjectId]:(t.layoutObjectId="graphHierarchyNode#"+this.multiObjectIdentityCounter++,t.layoutObjectId)},i.prototype._getDictionaryValues=function(e,t){var i=[];for(var t in e.map)i.push(e.map[t]);return i},i.prototype._visit=function(e,t,i,a,n,o,s){var r,l;if(null!=t){for(r=0;r<t.length;r++)l=t[r],null!=l&&(null==a&&(a={}),i?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=r,this._extendedDfs(null,l,null,e,a,l.hashCode,r,0,n,o,s)):this._depthFirstSearch(null,l,null,e,a,0,n,o,s));this.dfsCount++}},i.prototype._depthFirstSearch=function(e,t,i,a,n,o,s,r,l){var d,h,c,u,g;if(null!=t)if(d=t.id,null==n[d])for(n[d]=t,this._updateConnectionRank(a,e,t,i,o,0,s,r,l),h=t.connectsAsSource.slice(),c=0;c<h.length;c++)u=h[c],g=u.target,this._depthFirstSearch(t,g,u,a,n,o+1,s,r,l);else this._updateConnectionRank(a,e,t,i,o,1,s,r,l)},i.prototype._updateConnectionRank=function(e,t,i,a,n,o,s,r,l){("removeParentConnection"===e||"removeNodeConnection"===e)&&this._removeConnectionEdge(t,i,a,n,o,s,r,l,"removeNodeConnection"===e),"updateMinMaxRank"===e&&this._updateMinMaxRank(t,i,a,n,o,s,r,l)},i.prototype._removeConnectionEdge=function(e,t,i,a,n,o,s,r){window.objLayout._isAncestor(t,e)&&(window.objLayout._invert(i),window.objLayout._remove(i,e.connectsAsSource),r?(t.connectsAsSource.push(i),e.connectsAsTarget.push(i),window.objLayout._remove(i,t.connectsAsTarget)):(e.connectsAsTarget.push(i),window.objLayout._remove(i,t.connectsAsTarget),t.connectsAsSource.push(i))),o[t.id]=t,delete s[t.id]},i.prototype._extendedDfs=function(e,t,i,a,n,o,s,r,l,d,h){var c,u,g,m,p,f;if(null!=t)if(null!=e&&(null==t.hashCode||t.hashCode[0]!=e.hashCode[0])&&(c=e.hashCode.length+1,t.hashCode=e.hashCode.slice(),t.hashCode[c-1]=s),u=t.id,null==n[u])for(n[u]=t,this._updateConnectionRank(a,e,t,i,r,0,l,d,h),g=t.connectsAsSource.slice(),m=0;m<g.length;m++)p=g[m],f=p.target,this._extendedDfs(t,f,p,a,n,t.hashCode,m,r+1,l,d,h);else this._updateConnectionRank(a,e,t,i,r,1,l,d,h)},i.prototype._clone=function(i,a,n){var o,s;if(n=null!=n?n:!1,null!=i&&"function"==typeof i.constructor){o=new i.constructor;for(s in i)"layoutObjectId"!=s&&(null==a||t.datavisualization.Diagram.Util.indexOf(a,s)<0)&&(o[s]=n||"object"!=typeof i[s]?i[s]:e.extend(!0,{},i[s]))}return o},i}(),t.datavisualization.Diagram.MultiParentModel=i,a=function(){function e(){}return e.prototype._calculateCrossings=function(e){for(var t=e.ranks.length,i=0,a=1;t>a;a++)i+=this._calculateRankCrossing(a,e);return i},e.prototype._getTempVariable=function(e,t){return e?this._isVertex(e)?e.temp[0]:e.temp[t-e.minRank-1]:void 0},e.prototype._calculateRankCrossing=function(e,t){for(var i,a,n,o,s,r,l,d,h,c=0,u=t.ranks[e],g=t.ranks[e-1],m=[],p=0;p<u.length;p++){var f=u[p],v=this._getTempVariable(f,e),_=this._getConnectedCellsOnLayer(f,e,!0),y=[];for(i=0;i<_.length;i++)a=_[i],n=this._getTempVariable(a,e-1),y.push(n);y.sort(function(e,t){return e-t}),m[v]=y}for(o=[],p=0;p<m.length;p++)o=o.concat(m[p]);for(s=1;s<g.length;)s<<=1;for(r=2*s-1,s-=1,l=[],p=0;r>p;++p)l[p]=0;for(p=0;p<o.length;p++)for(d=o[p],h=d+s,++l[h];h>0;)h%2&&(c+=l[h+1]),h=h-1>>1,++l[h];return c},e.prototype._execute=function(e){var t,i,a,n,o,s,r,l,d,h;for(this.nestedBestRanks=[],d=0;d<e.ranks.length;d++)this.nestedBestRanks[d]=e.ranks[d].slice();for(t=0,i=this._calculateCrossings(e),d=0;24>d&&2>t;d++){if(this._weightedMedian(d,e),a=this._calculateCrossings(e),i>a)i=a,t=0;else for(t++,h=0;h<this.nestedBestRanks.length;h++)for(n=e.ranks[h],o=0;o<n.length;o++)s=n[o],this._setTempVariable(s,h,o);if(0==i)break}for(r=[],l=[],d=0;d<e.maxRank+1;d++)l[d]=[],r[d]=l[d];for(d=0;d<this.nestedBestRanks.length;d++)for(h=0;h<this.nestedBestRanks[d].length;h++)l[d].push(this.nestedBestRanks[d][h]);e.ranks=r},e.prototype._isVertex=function(e){return!(!e||!e.cell||!e.cell.inEdges&&!e.cell.outEdges)},e.prototype._weightedMedian=function(e,t){var i,a=e%2==0;if(a)for(i=t.maxRank-1;i>=0;i--)this._medianRank(i,a);else for(i=1;i<t.maxRank;i++)this._medianRank(i,a)},e.prototype._getConnectedCellsOnLayer=function(e,t,i){var a,n,o="nextLayerConnectedCells",s="connectsAsTarget";if(i&&(o="previousLayerConnectedCells",s="connectsAsSource"),e){if(this._isVertex(e)){if(null==e[o])for(e[o]=[],e[o][0]=[],n=0;n<e[s].length;n++)a=e[s][n],void 0==a.maxRank&&(a.maxRank=-1),-1==a.maxRank||(i?a.minRank==t-1:a.maxRank==t+1)?e[o][0].push(i?a.target:a.source):e[o][0].push(a);return e[o][0]}if(null==e[o])for(e[o]=[],n=0;n<e.temp.length;n++)e[o][n]=[],n==(i?0:e.temp.length-1)?e[o][n].push(i?e.target:e.source):e[o][n].push(e);return e[o][t-e.minRank-1]}},e.prototype._medianValue=function(e,t){for(var i,a=[],n=0,o=0;o<e.length;o++)i=e[o],a[n++]=this._getTempVariable(i,t);if(a.sort(function(e,t){return e-t}),n%2==1)return a[Math.floor(n/2)];if(2==n)return(a[0]+a[1])/2;var s=n/2,r=a[s-1]-a[0],l=a[n-1]-a[s];return(a[s-1]*l+a[s]*r)/(r+l)},e.prototype._setTempVariable=function(e,t,i){e&&(e.temp[0]=i)},e.prototype._medianRank=function(e,t){for(var i,a,n,o,s=this.nestedBestRanks[e].length,r=[],l=[],d=0;s>d;d++)o=this.nestedBestRanks[e][d],i={_medianValue:0,cell:!1},i.cell=o,a=t?this._getConnectedCellsOnLayer(o,e):this._getConnectedCellsOnLayer(o,e,!0),n=t?e+1:e-1,null!=a&&0!=a.length?(i._medianValue=this._medianValue(a,n),r.push(i)):l[this._getTempVariable(o,e)]=!0;for(r.sort(this._compare),d=0;s>d;d++)null==l[d]&&(o=r.shift().cell,this._setTempVariable(o,e,d))},e.prototype._compare=function(e,t){if(null!=e&&null!=t){if(t._medianValue>e._medianValue)return-1;if(t._medianValue<e._medianValue)return 1}return 0},e}(),t.datavisualization.Diagram.CrossReduction=a}(jQuery,Syncfusion);var SizeF=function(){function e(e,t){this.width=e,this.height=t}return e}(),GraphForceNode=function(){function e(e){this.m_fVelocityX=0,this.m_fVelocityY=0,this.m_lstNodes=[],this.m_gnNode=e;var t=ej.datavisualization.Diagram.Util.bounds(e);this.m_ptLocation=t._center,this.m_lstNodes=[],e._parents||(e._parents=[]),e._children||(e._children=[]),this.m_lstNodes=e._parents.concat(e._children)}return Object.defineProperty(e.prototype,"graphNode",{get:function(){return this.m_gnNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this.m_lstNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"location",{get:function(){return this.m_ptLocation},set:function(e){this.m_ptLocation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocityX",{get:function(){return this.m_fVelocityX},set:function(e){this.m_fVelocityX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"velocityY",{get:function(){return this.m_fVelocityY},set:function(e){this.m_fVelocityY=e},enumerable:!0,configurable:!0}),e.prototype.ApplyChanges=function(){this.m_gnNode._center=this.m_ptLocation},e}(),SymmetricLayoutManager=function(){function e(){this.m_szMaxForceVelocity=new SizeF(e.c_fMAX_VELOCITY,e.c_fMAX_VELOCITY),this.m_fVertexDistance=0,this.m_dSpringFactor=e.c_dCOEF,this.m_nMaxIteraction=e.c_nMAX_ITERACTION,this.m_fVertexDistance=e.c_nSPRING_LENGTH}return Object.defineProperty(e.prototype,"SpringLength",{get:function(){return this.m_fVertexDistance},set:function(e){this.m_fVertexDistance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SpringFactor",{get:function(){return this.m_dSpringFactor},set:function(e){this.m_dSpringFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MaxIteraction",{get:function(){return this.m_nMaxIteraction},set:function(e){this.m_nMaxIteraction=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedNode",{get:function(){return this.m_objSelectedNode},set:function(e){this.m_objSelectedNode!==e&&(this.m_objSelectedNode=e)},enumerable:!0,configurable:!0}),e.prototype.doGraphLayout=function(e){var t,i,a=this.selectedNode;this.diagram=e.diagram,a.Bounds=e._getModelBounds(this.diagram.nodes());var n=a.GraphNodes,o=this._convertGraphNodes(n),s=o.length;for(s=Math.min(this.m_nMaxIteraction,s*s*s),this._preLayoutNodes(o,a.Bounds),t=0,i=s;i>t;t++)this._makeSymmetricLayout(o),this._appendForces(o);this._resetGraphPosition(o,a)},e.prototype._preLayoutNodes=function(e,t){for(var i,a,n=Math.max(t?t.width:25,t?t.height:25),o={x:n/2,y:n/2},s=2*Math.PI/e.length,r=s,l=0;l<e.length;l++)i=e[l],a=this._getForceNode(i),a.location={x:o.x+n*Number(Math.cos(r).toFixed(2)),y:o.y+n*Number(Math.sin(r).toFixed(2))},r-=s},e.prototype.DoLayout=function(e){this.selectedNode=e.selectedNode,this.doGraphLayout(e)},e.prototype._collectionContains=function(e,t){for(var i=0;i<t.length;i++)if(t[i].name===e)return!0},e.prototype._makeSymmetricLayout=function(e){for(var t,i,a,n,o,s,r,l,d,h=0;h<e.length;h++){for(t=e[h],l=this._getForceNode(t),i=l.nodes,a=0;a<i.length;a++)r=i[a],this._collectionContains(r.name,e)&&this._calcNodesForce(l,this._getForceNode(r));for(n=0,o=i.length;o>n&&!(2>o);n++){var c=this._getForceNode(i[n]),u=n+1>=o?this._getForceNode(i[0]):this._getForceNode(i[n+1]),g=180/i.length*Math.PI/180,m=2*this.m_fVertexDistance*Math.sin(g);this._calcRelatesForce(c,u,m)}for(s=0;s<e.length;s++)r=e[s],this._collectionContains(r.name,i)||r.name===t.name||(d=this._getForceNode(r),this._updateNeigbour(l,d))}},e.prototype._appendForces=function(e){for(var t,i,a=null,n=0;n<e.length;n++)t=e[n],a=this._getForceNode(t),i=a.location,i.x+=Math.min(a.velocityX,this.m_szMaxForceVelocity.width),i.y+=Math.min(a.velocityY,this.m_szMaxForceVelocity.height),a.velocityX=0,a.velocityY=0,a.location=i},e.prototype._resetGraphPosition=function(e,t){for(var i,a,n=new SizeF(Number.MAX_VALUE,Number.MAX_VALUE),o=null,s=0;s<e.length;s++)i=e[s],o=this._getForceNode(i),a={x:o.location.x-i.width/2,y:o.location.y-i.height/2},n.width=Math.min(n.width,a.x),n.height=Math.min(n.height,a.y);for(s=0;s<e.length;s++)i=e[s],o=this._getForceNode(i),a=o.location,a.x-=n.width-t.location?t.location.x:0,a.y-=n.height-t.location?t.location.y:0,o.location=a,o.ApplyChanges()},e.prototype._convertGraphNodes=function(e){var t,i,a,n=[];for(t in e)e[t]&&(i=e[t],a=new GraphForceNode(i),i._tag=a,n.push(i));return n},e.prototype._getForceNode=function(e){return e._tag},e.prototype._updateNeigbour=function(e,t){if(null!=t&&null!=e){var i=this._pointDistance(e.location,t.location),a=this._lineAngle(e.location,t.location),n=.9*this.m_fVertexDistance;n>i&&this._calcForce(i,n,a,t)}},e.prototype._lineAngle=function(e,t){var i=0,a=t.x-e.x,n=t.y-e.y;return 0===a?i=0>=n?3*Math.PI/2:Math.PI/2:0===n?i=0>a?Math.PI:0:(i=Math.atan(n/a),0>a&&n>0?i=Math.PI+i:0>a&&0>n?i=Math.PI+i:a>0&&0>n&&(i=2*Math.PI+i)),i},e.prototype._pointDistance=function(e,t){var i=0,a=t.x-e.x,n=t.y-e.y,o=a*a+n*n;return o>0&&(i=Math.sqrt(o)),i},e.prototype._calcRelatesForce=function(e,t,i){var a=this._pointDistance(e.location,t.location),n=this._lineAngle(e.location,t.location);i>a&&this._calcForce(a,i,n,t)},e.prototype._calcNodesForce=function(e,t){var i=this._pointDistance(e.location,t.location),a=this._lineAngle(e.location,t.location);(i>this.m_fVertexDistance||i<this.m_fVertexDistance)&&this._calcForce(i,this.m_fVertexDistance,a,t)},e.prototype._calcForce=function(e,t,i,a){var n=a.nodes.length,o=e-t,s=this.m_dSpringFactor/(n*n)*Math.sqrt(n);if(0!==o){var r=o*s,l=r,d=Math.cos(i)*l,h=Math.sin(i)*l;a.velocityX-=d,a.velocityY-=h}},e.c_dCOEF=.442,e.c_fMAX_VELOCITY=50,e.c_nMAX_ITERACTION=1e3,e.c_nSPRING_LENGTH=100,e}(),GraphLayoutManager=function(){function e(){this.visitedStack=[],this.cycleEdgesCollection=[],this.m_hashPassedNodes={}}return Object.defineProperty(e.prototype,"selectedNode",{get:function(){return this.m_objSelectedNode},set:function(e){this.m_objSelectedNode!==e&&(this.m_objSelectedNode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"passedNodes",{get:function(){return null==this.m_hashPassedNodes&&(this.m_hashPassedNodes={}),this.m_hashPassedNodes},set:function(e){this.m_hashPassedNodes!==e&&(this.m_hashPassedNodes=e)},enumerable:!0,configurable:!0}),e.prototype.updateLayout=function(e,t){var i,a,n,o,s,r,l;for(this.diagram=e,i=e.nodes(),i.length>0&&(this.m_helperSelectedNode=$.extend(!0,{},i[0])),a=[],n=0;n<e.nodes().length;n++)a.push(e.nodes()[n]);for(n=0;n<e.connectors().length;n++)a.push(e.connectors()[n]);for(this._updateLayout1(a,t),o=this._getModelBounds(e.nodes()),s=ej.datavisualization.Diagram.ScrollUtil._viewPort(e,!0),n=0;n<e.nodes().length;n++){var d=e.nodes()[n],h=(s.width-o.width)/2,c=e.model.layout.margin||{};c.left=c.left||0,c.right=c.right||0,c.top=c.top||0,c.bottom=c.bottom||0,e.model.layout.marginX&&(c.left=e.model.layout.marginX),e.model.layout.marginY&&(c.top=e.model.layout.marginY),r=d._tag.location.x-(d.offsetX-d.width/2)-o.x+h+c.left,l=d._tag.location.y-(d.offsetY-d.height/2)-o.y+c.top,this.diagram._translate(d,r,l,e.nameTable),delete d._tag,delete d._center,delete d._children,delete d._isCycleEdge,delete d._parents,this.diagram._isInit||ej.datavisualization.Diagram.DiagramContext.update(d,this.diagram);
}},e.prototype._getModelBounds=function(e){var t,i,a,n,o;for(e=e.slice(),t=null,i=null,n=0;n<e.length;n++)a=e[n],o=ej.datavisualization.Diagram.Util.bounds(a),t={x:a._tag?a._tag.location.x:o.x,y:a._tag?a._tag.location.y:o.y,width:a.width,height:a.height},i=i?ej.datavisualization.Diagram.Geometry.union(i,t):t;return i},e.prototype._updateLayout1=function(e,t){var i,a,n;if(this._detectCyclesInGraph(e),i=e.length,i>0){var o=[],s=[],r=[];for(a=0;a<e.length;a++)n=e[a],void 0===n._isCycleEdge&&(n._isCycleEdge=!1),n.segments&&!n._isCycleEdge?s.push(n):n.segments?o.push(n):r.push(n);for(s=s.concat(r),s=o.concat(s);i>this._dictionaryLength(this.passedNodes);)this._getNodesToPosition(s),null!=this.selectedNode&&(t.DoLayout(this),this.selectedNode=null,this.visitedStack=[],this.cycleEdgesCollection.forEach(function(e){e._isCycleEdge=!1}));this.m_hashPassedNodes=null,this.m_objSelectedNode=null}return!1},e.prototype._getNodesToPosition=function(e){for(var t,i=0;i<e.length;i++)if(t=e[i],!this._collectionContains(t.name,this.passedNodes)){t&&this._selectNodes(t);break}},e.prototype._selectNodes=function(e){var t=e;e.segments?this._exploreGraphEdge(e):null!=t&&this._addNode(e,"passed")&&(this._addNode(e,"selected"),this._isConnectedToAnotherNode(t)?(this.selectedNode={},this.selectedNode.LeftMargin=10,this.selectedNode.TopMargin=10,this._selectConnectedNodes(t)):this.selectedNode=e)},e.prototype._selectConnectedNodes=function(e){var t,i,a,n,o=this.selectedNode;o.GraphNodes||(o.GraphNodes={}),t=e,null!=t&&this._addNode(t,"passed")&&(i=t.name,this._dictionaryContains(o.GraphNodes,t)?(n=o.GraphNodes[i],n.Added&&(n.Added=!1,this._getConnectedRelatives(n),this._exploreRelatives(e))):(a=this._addGraphNode(t),this._getConnectedRelatives(a),this._exploreRelatives(e)))},e.prototype._exploreRelatives=function(e){this._exploreRelatives1(e,"Parents"),this._exploreRelatives1(e,"Children")},e.prototype._exploreRelatives1=function(e,t){var i,a,n,o,s=[];for("Parents"===t?s=e.inEdges:"Children"===t&&(s=e.outEdges),i=0;i<s.length;i++)a=this.diagram.nameTable[s[i]],this._addNode(a,"passed")&&(n=this.diagram.nameTable[a.sourceNode],o=this.diagram.nameTable[a.targetNode],"Parents"===t&&null!=n&&this._collectionContains(n.name,this.diagram.nodes())?this._selectConnectedNodes(this.diagram.nameTable[a.sourceNode]):"Children"===t&&null!=o&&this._collectionContains(o.name,this.diagram.nodes())&&this._selectConnectedNodes(this.diagram.nameTable[a.targetNode]))},e.prototype._getConnectedRelatives=function(e){this._getConnectedParents(e),this._getConnectedChildren(e)},e.prototype._dictionaryContains=function(e,t){for(var i=Object.keys(e),a=0;a<i.length;a++)if(e[i[a]].name===t.name)return!0;return!1},e.prototype._dictionaryLength=function(e){var t=Object.keys(e);return t.length},e.prototype._getConnectedChildren=function(e){for(var t,i,a,n=this.selectedNode,o=e,s=0;s<o.outEdges.length;s++)t=this.diagram.nameTable[o.outEdges[s]],t._isCycleEdge||(i=this.diagram.nameTable[t.targetNode],this._collectionContains(i.name,this.diagram.nodes())&&null!=i&&i.visible&&(this._dictionaryContains(n.GraphNodes,i)?a=n.GraphNodes[i.name]:(a=this._addGraphNode(i),a.Added=!0),e._children||(e._children=[]),a._parents||(a._parents=[]),this._setNode(a._parents,e),this._findNode(e._children,a.name)<0&&e._children.push(a)))},e.prototype._getConnectedParents=function(e){for(var t,i,a,n=this.selectedNode,o=e,s=0;s<o.inEdges.length;s++)t=this.diagram.nameTable[o.inEdges[s]],t._isCycleEdge||(i=this.diagram.nameTable[t.sourceNode],this._collectionContains(i.name,this.diagram.nodes())&&null!=i&&i.visible&&(this._dictionaryContains(n.GraphNodes,i)?a=n.GraphNodes[i.name]:(a=this._addGraphNode(i),a.Added=!0),e._parents||(e._parents=[]),a._children||(a._children=[]),this._setNode(a._children,e),this._findNode(e._parents,a.name)<0&&e._parents.push(a)))},e.prototype._setNode=function(e,t){var i=this._findNode(e,t.name);i>=0&&i<e.length?e[i]=t:e.push(t)},e.prototype._findNode=function(e,t){var i,a,n,o=-1;if(null!=e&&""!==t)for(i=0,a=e.length;a>i;i++){if(n=e[i],"string"==typeof n&&n===t){o=i;break}if(null!=n&&n.name===t){o=i;break}}return o},e.prototype._addGraphNode=function(e){var t,i,a=this.selectedNode;return a.GraphNodes||(a.GraphNodes={}),t=e,null!=a&&(a.GraphNodes[t.name]=t,i=this.m_helperSelectedNode,null!=i&&e.name===i.name&&(this.m_helperSelectedNode=t)),t},e.prototype._isConnectedToAnotherNode=function(e){var t=!1,i=e.inEdges.concat(e.outEdges);return i.length>0&&(null!=e.inEdges&&e.inEdges.length>0&&(t=this._searchEdgeCollection(e.inEdges,"FromNode")),!t&&null!=e.outEdges&&e.outEdges.length>0&&(t=this._searchEdgeCollection(e.outEdges,"ToNode"))),t},e.prototype._searchEdgeCollection=function(e,t){for(var i,a=!1,n=0;n<e.length-1;n++)if(i=this.diagram.nameTable[e[n]],this._addNode(i,"passed")&&!i._isCycleEdge&&("FromNode"===t&&null!=this.diagram.nameTable[i.sourceNode]||"ToNode"===t&&null!=this.diagram.nameTable[i.targetNode])){a=!0;break}return a},e.prototype._exploreGraphEdge=function(e){var t,i,a=e;null!=a&&!a._isCycleEdge&&this._addNode(e,"passed")&&(this._addNode(e,"selected"),t=this.diagram.nameTable[a.sourceNode],i=this.diagram.nameTable[a.targetNode],null!=t?this._selectNodes(t):null!=i?this._selectNodes(i):this.selectedNode=e)},e.prototype._addNode=function(e,t){var i=e;return"passed"!==t&&i.visible||this._dictionaryContains(this.passedNodes,i)||(this.passedNodes[i.name]=i),!!i.visible},e.prototype._detectCyclesInGraph=function(e){for(var t,i,a,n,o=[],s=[],r=0;r<e.length;r++)e[r].segments||o.push(e[r]);if(o.length>0)for(s.push(o[0]),this.visitedStack.push(o[0]);s.length>0;)t=s[s.length-1],i=this._getUnVisitedChildNodes(t),i.length>0?(a=i[0],n=i[i.length-1],this._collectionContains(a.name,this.visitedStack)?(n._isCycleEdge=!0,this.cycleEdgesCollection.push(n)):(s.push(a),this.visitedStack.splice(0,0,a))):s.pop()},e.prototype._getUnVisitedChildNodes=function(e){var t,i,a,n=[];if(e.outEdges.length>0){for(t=0;t<e.outEdges.length;t++)if(i=this.diagram.nameTable[e.outEdges[t]],!this._collectionContains(i.name,this.visitedStack))return a=this.diagram.nameTable[i.targetNode],null!=a&&n.push(a),n.push(i),this.visitedStack.splice(0,0,i),n;return n}return n},e.prototype._collectionContains=function(e,t){for(var i=0;i<t.length;i++)if(t[i].name===e)return!0},e}();!function(e,t){"use strict";t.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,a,n,o,s,r){var l,d,h,c,u;if(r&&t.datavisualization.Diagram.Util.canZooming(i)||!r&&t.datavisualization.Diagram.Util.canPanning(i)){var g=t.datavisualization.Diagram.ScrollUtil._viewPort(i,!0),m={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:g},p=t.Matrix.identity();t.Matrix.scale(p,i._currZoom,i._currZoom),t.Matrix.translate(p,-i._hScrollOffset,-i._vScrollOffset),l=i._currZoom*a,l>i.model.scrollSettings.maxZoom?a=i.model.scrollSettings.maxZoom/i._currZoom:l<i.model.scrollSettings.minZoom&&(a=i.model.scrollSettings.minZoom/i._currZoom),d=t.Matrix.identity(),h=s?t.Matrix.transform(p,s):t.datavisualization.Diagram.Point(e(i.element).width()/2,e(i.element).height()/2),t.Matrix.scale(d,a,a,h.x,h.y),l=i._currZoom*a,t.Matrix.translate(d,n,o),t.Matrix.multiply(p,d),c=t.Matrix.transform(p,t.datavisualization.Diagram.Point(0,0)),i._compareModelProperty("scrollSettings",!0),this._applyTransform(i,l,c,r,g),u={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:g},i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Zoom,r||(i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan),i._raiseEvent("scrollChange",{newValues:u,oldValues:m})}},_applyTransform:function(e,i,a,n,o){e._currZoom=i;var s=-1*a.x,r=-1*a.y,l=e._getDigramBounds();if(!n&&e._scrollLimit()!==t.datavisualization.Diagram.ScrollLimit.Infinity)if(e._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Diagram){l.x-=e.model.scrollSettings.padding.left,l.y-=e.model.scrollSettings.padding.top,l.width+=e.model.scrollSettings.padding.left+e.model.scrollSettings.padding.right,l.height+=e.model.scrollSettings.padding.top+e.model.scrollSettings.padding.bottom;var d=l.width*e._currZoom>o.width,h=l.height*e._currZoom>o.height,c=(l.width+l.x)*e._currZoom-o.width,u=(l.height+l.y)*e._currZoom-o.height;!d&&s>e._hScrollOffset&&s>l.x*e._currZoom||d&&s<e._hScrollOffset&&s<l.x*e._currZoom?s=e._hScrollOffset:(!d&&s<e._hScrollOffset&&c>s||d&&s>e._hScrollOffset&&s>c)&&(s=e._hScrollOffset),!h&&r>e._vScrollOffset&&r>l.y*e._currZoom||h&&r<e._vScrollOffset&&r<l.y*e._currZoom?r=e._vScrollOffset:(!h&&r<e._vScrollOffset&&u>r||h&&r>e._vScrollOffset&&r>u)&&(r=e._vScrollOffset)}else s<e._hScrollbar.model.minimum&&!(0==e._hScrollbar.model.minimum&&-e._hScrollOffset>a.x)?s=e._hScrollOffset:s>e._hScrollbar.model.maximum&&(s=e._hScrollbar.model.maximum),r<e._vScrollbar.model.minimum&&!(0==e._vScrollbar.model.minimum&&-e._vScrollOffset>a.y)?r=e._vScrollOffset:r>e._vScrollbar.model.maximum&&(r=e._vScrollbar.model.maximum);e._updateScrollOffset(s,r,!0,n)}},t.datavisualization.Diagram.PageUtil={_createPageBreaks:function(e){this._removePageBreaks(e);var i={id:e._canvas.id+"pagebreaks","pointer-events":"none"},a=t.datavisualization.Diagram.SvgContext._initializePageBreaks(e._svg,i,e._pageBackgroundLayer);this._updatePageBreaks(a,e)},_removePageBreaks:function(e){var i=e._svg.getElementById(e._canvas.id+"pagebreaks");i&&t.datavisualization.Diagram.SvgContext._removePageBreaks(e._svg,i,e._pageBackgroundLayer)},_updatePageBreaks:function(e,i){var a,n,o,s,r=i._getDigramBounds(),l=(i.model.pageSettings,r.x),d=r.width+r.x,h=r.y,c=r.height+r.y,u=i._currZoom,g=i._pageHeight(),m=i._pageWidth(),p=i._pageMargin(),f=parseInt(Math.ceil((d-l)/m)),v=parseInt(Math.ceil((c-h)/g));for(l=-i._canvas.clientLeft+(p+l)*u,h=-i._canvas.clientTop+(p+h)*u,a=(m*f-2*p)*u,n=(g*v-2*p)*u,t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(l,h),t.datavisualization.Diagram.Point(l+a,h),i._svg,e),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(l,h),t.datavisualization.Diagram.Point(l,h+n),i._svg,e),o=1;f>o;o++)t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(l+(m*o-p)*u,h),t.datavisualization.Diagram.Point(l+(m*o-p)*u,h+n),i._svg,e);for(s=1;v>s;s++)t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(l,h+(g*s-p)*u),t.datavisualization.Diagram.Point(l+a,h+(g*s-p)*u),i._svg,e);t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(l+a,h),t.datavisualization.Diagram.Point(l+a,h+n),i._svg,e),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(l,h+n),t.datavisualization.Diagram.Point(l+a,h+n),i._svg,e)},_updatePageSize:function(e,i){var a,n,o=!1,s="string"==typeof e.model.pageSettings.pageOrientation?e.model.pageSettings.pageOrientation:e._pageOrientation(),r="string"==typeof e.model.pageSettings.pageWidth?e.model.pageSettings.pageWidth:e._pageWidth(),l="string"==typeof e.model.pageSettings.pageHeight?e.model.pageSettings.pageHeight:e._pageHeight();s==t.datavisualization.Diagram.PageOrientations.Landscape?l>r&&(o=!0):r>l&&(o=!0),o&&(a=r,e._pageWidth(l),e._pageHeight(a));var d=e._getDigramBounds(),h=e._currZoom,c=d.x*h,u=d.y*h,g=d.width*h,m=d.height*h,p=e.model.pageSettings;e._pageBackgroundLayer&&e._pageBackgroundLayer.firstChild?t.datavisualization.Diagram.SvgContext._updatePageBakground(t.datavisualization.Diagram.Point(c,u),t.datavisualization.Diagram.Point(g,m),e._svg,e._pageBackgroundLayer,e._pageBorderColor(),e._pageBackgroundColor(),e._pageBorderWidth()):t.datavisualization.Diagram.SvgContext._renderPageSettingsRect(t.datavisualization.Diagram.Point(c,u),t.datavisualization.Diagram.Point(g,m),e._svg,e._pageBackgroundLayer,e._pageBorderColor(),e._pageBackgroundColor(),e._pageBorderWidth()),e.model.backgroundImage&&e.model.backgroundImage.source&&t.datavisualization.Diagram.SvgContext._updateBackground(e._hScrollOffset,e._vScrollOffset,e._currZoom,e),e._svg.document.style.left=0,e._svg.document.style.top=0,n=!1,r||l||(n=!0),p.pageWidth&&l&&(e._showPageBreak()?this._createPageBreaks(e):this._removePageBreaks(e)),i||t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(e)}},t.datavisualization.Diagram.ScrollUtil={_transform:function(e,i,a,n){t.datavisualization.Diagram.SvgContext.transformView(e,-i,-a),n&&t.datavisualization.Diagram.SvgContext.scaleContent(e,e._currZoom),this._updateRuler(e,i,a),t.datavisualization.Diagram.PageUtil._updatePageSize(e),t.datavisualization.Diagram.SvgContext._updateGrid(i,a,e._currZoom,e)},_updateRuler:function(i,a,n){if(i&&i.model.rulerSettings.showRulers){var o=this._getRulerSize(i),s=t.datavisualization.Diagram.ScrollUtil._getRulerGeometry(i,!0);void 0!=a&&i._hRuler&&(t.datavisualization.Diagram.SvgContext._updateRulerSpace(i,s,!0),e("#"+i._hRuler[0].id).ejRuler({offset:a,scale:i._currZoom,length:s.width+100}),i._hRuler[0].style.marginLeft=o.left-i._hRulerInstance._hRulerDiff+"px"),void 0!=n&&i._vRuler&&(t.datavisualization.Diagram.SvgContext._updateRulerSpace(i,s,!1),e("#"+i._vRuler[0].id).ejRuler({offset:n,scale:i._currZoom,length:s.height+100}),i._vRuler[0].style.marginTop=-i._vRulerInstance._vRulerDiff+"px")}},_viewPort:function(e,i){var a,n;if(e._viewPort&&!i)return e._viewPort;var o=(e.element[0],e.element[0].getBoundingClientRect()),s=o.width,r=e._vScrollbar&&e._vScrollbar.model.height?e._vScrollbar.model.height:null,l=r&&o.height===r?r+18:o.height,d=window.screenX<0?-1*window.screenX:window.screenX;return 0===s&&(s=Math.floor(window.innerWidth-d-Math.floor(o.left))),a=window.screenY<0?-1*window.screenY:window.screenY,0===l&&(l=Math.floor(window.innerHeight-a-Math.floor(o.window))),n=this._getRulerSize(e),t.datavisualization.Diagram.Size(s-n.left,l-n.top)},_getRulerSize:function(e){var t=0,i=0;return e.model.rulerSettings.showRulers&&(e.model.rulerSettings.horizontalRuler.thickness&&(i=e.model.rulerSettings.horizontalRuler.thickness),e.model.rulerSettings.verticalRuler.thickness&&(t=e.model.rulerSettings.verticalRuler.thickness)),{left:t,top:i}},_getRulerGeometry:function(e){var t=this._getRulerSize(e),i=e._viewPort.height,a=e._viewPort.width;return a<e._canvas.clientWidth-t.left&&(a=e._canvas.clientWidth-t.left),i<e._canvas.clientHeight-t.top&&(i=e._canvas.clientHeight-t.top),e.model.rulerSettings.horizontalRuler.length&&(a=e.model.rulerSettings.horizontalRuler.length),e.model.rulerSettings.verticalRuler.length&&(i=e.model.rulerSettings.verticalRuler.length),{width:a,height:i}},_union:function(e,t){var i,a,n,o;return e.width<=0?t:e.width>0?(i=Math.min(e.x,t.x),a=Math.min(e.y,t.y),t.width===1/0||e.width===1/0?e.width=1/0:(n=Math.max(e.x+e.width,t.x+t.width),e.width=Math.max(n-i,0)),t.height===1/0||e.height===1/0?e.height=1/0:(o=Math.max(e.y+e.height,t.y+t.height),e.height=Math.max(o-a,0)),e.x=i,e.y=a,e):void 0},_setScrollContentSize:function(i){var a,n,o,s,r,l,d,h,c,u,g,m=i._currZoom,p=this._viewPort(i);p=t.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,p.width,p.height);var f=i.model.scrollSettings.padding,v=i._spatialSearch.pageLeft,_=i._spatialSearch.pageRight,y=i._spatialSearch.pageTop,b=i._spatialSearch.pageBottom,x=v,D=y;v>_&&(v=_=0),y>b&&(y=b=0),i.model.pageSettings&&(a=Number(i._pageWidth()),n=Number(i._pageHeight()),a>0&&n>0?(i._multiplePage()?(v=Math.floor(v/a)*a,y=Math.floor(y/n)*n,_=Math.ceil(_/a)*a,b=Math.ceil(b/n)*n):(v=0,y=0,_=a,b=n),v-=f.left,_+=f.right,y-=f.top,b+=f.bottom,x=v,D=y):(v=0>v?v:0,y=0>y?y:0,i._spatialSearch.pageLeft-v<f.left&&(v+=i._spatialSearch.pageLeft-v-f.left),i._spatialSearch.pageTop-y<f.top&&(y+=i._spatialSearch.pageTop-y-f.top),i._spatialSearch.pageRight+f.right>p.width&&i._spatialSearch.pageRight<p.width?_+=f.right+i._spatialSearch.pageRight-p.width:i._spatialSearch.pageRight>p.width&&(_+=f.right),i._spatialSearch.pageBottom+f.bottom>p.height&&i._spatialSearch.pageBottom<p.height?b+=f.bottom+i._spatialSearch.pageBottom-p.height:i._spatialSearch.pageBottom>p.height&&(b+=f.bottom),x-=f.left,D-=f.top)),v*=m,y*=m,_*=m,b*=m,o=t.datavisualization.Diagram.Rectangle(0,0,0,0),o=this._union(o,t.datavisualization.Diagram.Rectangle(0,0,p.width,p.height)),o=this._union(o,t.datavisualization.Diagram.Geometry.rect([{x:v,y:y},{x:_,y:b}])),o.width-=p.width,o.height-=p.height,o.x>i._hScrollOffset&&(l=o.x-i._hScrollOffset,o.x-=l,o.width+=l),i._hScrollOffset>o.x+o.width&&(o.width=i._hScrollOffset-o.x),s=o.x,r=Math.max(0,o.x+o.width),o.y>i._vScrollOffset&&(l=o.y-i._vScrollOffset,o.y-=l,o.height+=l),i._vScrollOffset>o.y+o.height&&(o.height=i._vScrollOffset-o.y),d=o.y,h=Math.max(0,o.y+o.height),o.width=o.width<p.width?p.width:o.width,o.height=o.height<p.height?p.height:o.height,i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited&&(c=i.model.pageSettings.scrollableArea,s=c.x*m,d=c.y*m,r=(c.x+c.width)*m-p.width,h=(c.y+c.height)*m-p.height,b=(c.y+c.height)*m,_=(c.x+c.width)*m,y=c.y*m,v=c.x*m),v>=i._hScrollOffset&&_<=p.width+i._hScrollOffset?(i._hScrollbar._remove(),i._hScrollbar.model.width=0,i._hScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,s):0,i._hScrollbar.model.maximum=0):(i._preventScrollerUpdate?(i._hScrollbar.model.minimum=s,i._hScrollbar.model.maximum=r):(e("#"+i._canvas.id+"_hScrollbar").ejScrollBar({width:p.width-18,viewportSize:p.width-18,maximum:r,minimum:s}),e("#"+i._canvas.id+"_hScrollbar").ejScrollBar("scroll",i._hScrollOffset)),u=document.getElementById(i._canvas.id+"_hScrollbar"),u.style.marginTop=p.height-18+"px",u.style.visibility=Math.round(x*m)>=Math.round(i._hScrollOffset)&&Math.round(_)<=Math.round(p.width+i._hScrollOffset)?"hidden":"visible"),y>=i._vScrollOffset&&b<=p.height+i._vScrollOffset?(i._vScrollbar._remove(),i._vScrollbar.model.height=0,i._vScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,d):0,i._vScrollbar.model.maximum=0):(i._preventScrollerUpdate?(i._vScrollbar.model.minimum=d,i._vScrollbar.model.maximum=h):(e("#"+i._canvas.id+"_vScrollbar").ejScrollBar({height:p.height-18,viewportSize:p.height-18,maximum:h,minimum:d}),e("#"+i._canvas.id+"_vScrollbar").ejScrollBar("scroll",i._vScrollOffset)),g=document.getElementById(i._canvas.id+"_vScrollbar"),g.style.visibility=Math.round(D*m)>=Math.round(i._vScrollOffset)&&Math.round(b)<=Math.round(p.height+i._vScrollOffset)?"hidden":"visible"),i._isMobile&&i._disableScrollbar(),t.datavisualization.Diagram.SvgContext.setSize(i,o.width,o.height)},_setMinMaxValues:function(e,t,i,a,n,o,s){var r=e.model.pageSettings.scrollableArea;return t=Math.max(t,r.x*s),i=Math.max(i,r.y*s),a=Math.min((r.x+r.width)*s-o.width,a),n=Math.min((r.y+r.height)*s-o.height,n),a=a>0?a:0,n=n>0?n:0,{minX:t,minY:i,maxX:a,maxY:n}},_initScrollbar:function(i){var a=i._canvas,n=document.getElementById(a.id+"_hScrollbar"),o=document.getElementById(a.id+"_vScrollbar"),s=this._viewPort(i);e(n).ejScrollBar({orientation:t.ScrollBar.Orientation.Horizontal,width:s.width-18,viewportSize:s.width-18,scroll:function(e){var a,n;null!=e.source&&("thumb"==e.source||"button"==e.source||"key"==e.source)&&null!=e.scrollData&&(a={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(e.scrollLeft,i._vScrollOffset),n={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:n,oldValues:a}))}}),i._hScrollbar=e(n).ejScrollBar("instance"),e(o).ejScrollBar({orientation:t.ScrollBar.Orientation.Vertical,height:s.height-18,viewportSize:s.height-18,scroll:function(e){var a,n;null!=e.source&&("thumb"==e.source||"button"==e.source||"key"==e.source)&&null!=e.scrollData&&(a={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(i._hScrollOffset,e.scrollTop),n={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:n,oldValues:a}))}}),i._vScrollbar=e(o).ejScrollBar("instance")}},t.datavisualization.Diagram.SnapUtil={_canConsider:function(e,t,i){var a=!1;return t!=i&&("group"==t._type||"pseudoGroup"==t._type?a=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(e,t,i):"group"==i._type&&"bpmn"!=i.type||"pseudoGroup"==i.type?a=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(e,i,t):t.segments||(a=!(t==i))),a},_contains:function(e,t,i){var a,n,o,s=i.name,r=null;if(t.children.indexOf(s)>=0){if(r=e[s],r==i)return!0}else if(t.children.indexOf(i)>=0)return!0;if("group"==t._type||"pseudoGroup"==t._type){for(a=!1,n=0;n<t.children.length;n++)if(this.diagram&&(o="string"==typeof t.children[n]?e[t.children[n]]:e[t.children[n].name],o&&("string"==typeof o&&(o=e[o]),"group"==o._type&&(a=this._contains(e,o,i)),a)))return a;return a}return!1},_round:function(e,t,i){var a,n;for(i=i>1?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):Math.pow(2,Math.ceil(Math.log(i)/Math.log(2))),a=0,n=0;n<t.length;n++)a+=t[n];a/=i;var o=Math.floor(Math.abs(e)/a),s=e%a,r=o*a;if(r!=e)if(e>=0)for(n=0;n<t.length;n++){if(s<=t[n]/i)return r+(s<t[n]/(2*i)?0:t[n]/i);r+=t[n]/i,s-=t[n]/i}else for(r=-1*r,n=t.length-1;n>=0;n--){if(Math.abs(s)<=t[n]/i)return r-(Math.abs(s)<t[n]/(2*i)?0:t[n]/i);r-=t[n]/i,s+=t[n]/i}return e},_findNodes:function(e,i,a,n,o){for(var s,r,l,d,h=[],c=t.datavisualization.Diagram.SpatialUtil.findQuads(e,o?n:a),u=0;u<c.length;u++)if(s=c[u],s.objects.length>0)for(d=0;d<s.objects.length;d++)r=s.objects[d],!r.segments&&r.visible&&(l=t.datavisualization.Diagram.Util.bounds(r),-1==h.indexOf(r)&&t.datavisualization.Diagram.Geometry.intersectsRect(a,l)&&h.push(r),o&&o.indexOf(r)&&t.datavisualization.Diagram.Geometry.intersectsRect(n,l)&&o.push(r));return h},_snapAngle:function(e,t){var i=e._snapAngle(),a=t%i;return a>=i/2?t+i-a:t-a},_snapPoint:function(e,i,a,n,o,s,r){var l=e.model.snapSettings,d=e._currZoom,h=t.datavisualization.Diagram.Point(),c=t.datavisualization.Diagram.Util.bounds(i),u={snapped:!1,offset:0},g={snapped:!1,offset:0};this.diagram=e,e._enableSnapToObject()&&this._snapObject(e,i,u,g,o,r==s);var m=c.x+o.x,p=c.y+o.y,f=c.x+c.width+o.x,v=c.y+c.height+o.y,_=this._round(f,l.verticalGridLines.snapInterval,d),y=this._round(m,l.verticalGridLines.snapInterval,d),b=this._round(p,l.horizontalGridLines.snapInterval,d),x=this._round(v,l.horizontalGridLines.snapInterval,d),D=c.x+c.width,C=c.y+c.height;return u.snapped?h.x=e._enableSnapToObject()?u.offset:s.x-r.x:e._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(o.x)>=1&&(h.x+=a?Math.abs(_-D)>Math.abs(y-c.x)?y-c.x:_-D:Math.abs(_-D)<Math.abs(y-c.x)?_-D:y-c.x):h.x=s.x-r.x,g.snapped?h.y=g.offset:e._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(o.y)>=1&&(h.y+=n?Math.abs(x-C)>Math.abs(b-c.y)?b-c.y:x-C:Math.abs(x-C)<Math.abs(b-c.y)?x-C:b-c.y):h.y=s.y-r.y,h},_snapObject:function(e,i,a,n,o,s){var r,l,d,h,c,u,g,m,p=null,f=null,v=[],_=[],y=[],b=[],x=t.datavisualization.Diagram.Util.bounds(i),D=e._currZoom,C=e._hScrollOffset,w=e._vScrollOffset,z=e._snapObjectDistance(),S=e._viewPort,P=t.datavisualization.Diagram.Rectangle(C/D,x.y-z-5,S.width/D,x.height+2*z+10),T=t.datavisualization.Diagram.Rectangle(x.x-z-5,w/D,x.width+2*z+10,S.height/D);for(S=t.datavisualization.Diagram.Rectangle(C/D,w/D,S.width/D,S.height/D),d=this._findNodes(e._spatialSearch,i,T,S),g=e.nameTable,h=0;h<d.length;h++)c=d[h],t.datavisualization.Diagram.Util._canBeTarget(e,c)&&!c.segments&&this._canConsider(g,i,c)&&(u=t.datavisualization.Diagram.Util.bounds(c),u.y+u.height<x.y+o.y?y.push({object:c,distance:Math.abs(x.y+o.y-u.y-u.height)}):u.y>x.y+o.y+x.height&&b.push({object:c,distance:Math.abs(x.y+o.y+x.height-u.y)}),(null==p||p>Math.abs(u.y-x.y-o.y))&&(Math.abs(u.x+u.width/2-(x.x+x.width/2+o.x))<=z?(r=this._createSnapObject(u,x,"centerX"),p=Math.abs(u.y-x.y)):Math.abs(u.x-(x.x+o.x))<=z?(r=this._createSnapObject(u,x,"left"),p=Math.abs(u.y-x.y)):Math.abs(u.x+u.width-(x.x+x.width+o.x))<=z?(r=this._createSnapObject(u,x,"right"),p=Math.abs(u.y-x.y)):Math.abs(u.x+u.width-(x.x+o.x))<=z?(r=this._createSnapObject(u,x,"leftRight"),p=Math.abs(u.y-x.y)):Math.abs(u.x-(x.x+x.width+o.x))<=z&&(r=this._createSnapObject(u,x,"rightLeft"),p=Math.abs(u.y-x.y))));for(d=this._findNodes(e._spatialSearch,i,P,S),h=0;h<d.length;h++)c=d[h],t.datavisualization.Diagram.Util._canBeTarget(e,c)&&!c.segments&&this._canConsider(g,i,c)&&(u=t.datavisualization.Diagram.Util.bounds(c),u.x+u.width<x.x+o.x&&(v[v.length]={object:c,distance:Math.abs(x.x+o.x-u.x-u.width)}),u.x>x.x+o.x+x.width&&(_[_.length]={object:c,distance:Math.abs(x.x+o.x+x.width-u.x)}),(null==f||f>Math.abs(u.x-x.x-o.x))&&(Math.abs(u.y+u.height/2-(x.y+x.height/2+o.y))<=z?(l=this._createSnapObject(u,x,"centerY"),f=Math.abs(u.x-x.x)):Math.abs(u.y-x.y-o.y)<=z?(l=this._createSnapObject(u,x,"top"),f=Math.abs(u.x-x.x)):Math.abs(u.y+u.height-(x.y+x.height+o.y))<=z?(l=this._createSnapObject(u,x,"bottom"),f=Math.abs(u.x-x.x)):Math.abs(u.y+u.height-x.y-o.y)<=z?(l=this._createSnapObject(u,x,"topBottom"),f=Math.abs(u.x-x.x)):Math.abs(u.y-(x.y+x.height+o.y))<=z&&(l=this._createSnapObject(u,x,"bottomTop"),f=Math.abs(u.x-x.x))));m=this._createGuidelines(e,r,l,a,n,s),a.snapped||this._createHSpacingLines(e,i,v,_,a,n,s,m,o,z),n.snapped||this._createVSpacingLines(e,i,y,b,a,n,s,m,o,z)},_snapSize:function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m,p,f,v=null,_=null,y=t.datavisualization.Diagram.Util.bounds(s),b=e.nameTable,x=[],D=[],C=e._currZoom,w=e._hScrollOffset,z=e._vScrollOffset,S=e._snapObjectDistance(),P=e._viewPort,T=t.datavisualization.Diagram.Rectangle(w/C,(y.y-5)/C,P.width/C,(y.height+10)/C),j=t.datavisualization.Diagram.Rectangle((y.x-5)/C,z/C,(y.width+10)/C,P.height/C);for(P=t.datavisualization.Diagram.Rectangle(w/C,z/C,P.width/C,P.height/C),h=[],c=this._findNodes(e._spatialSearch,s,j,P,h),u=0;u<c.length;u++)g=c[u],this._canConsider(b,s,g)&&!g.segments&&(m=t.datavisualization.Diagram.Util.bounds(g),(null==v||v>Math.abs(m.y-y.y))&&(i.left?Math.abs(y.x+n-m.x)<=S?(l=this._createSnapObject(m,y,"left"),v=Math.abs(m.y-y.y)):Math.abs(y.x+n-m.x-m.width)<=S&&(l=this._createSnapObject(m,y,"leftRight"),v=Math.abs(m.y-y.y)):i.right&&(Math.abs(y.x+n+y.width-m.x-m.width)<=S?(l=this._createSnapObject(m,y,"right"),v=Math.abs(m.y-y.y)):Math.abs(y.x+n+y.width-m.x)<=S&&(l=this._createSnapObject(m,y,"rightLeft"),v=Math.abs(m.y-y.y)))));for(c=this._findNodes(e._spatialSearch,s,T,P),u=0;u<c.length;u++)g=c[u],this._canConsider(b,s,g)&&!g.segments&&(m=t.datavisualization.Diagram.Util.bounds(g),(null==_||_>Math.abs(m.x-y.x))&&(a.top?Math.abs(y.y+o-m.y)<=S?(d=this._createSnapObject(m,y,"top"),_=Math.abs(m.x-y.x)):Math.abs(y.y+o-m.y-m.height)<=S&&(d=this._createSnapObject(m,y,"topBottom"),_=Math.abs(m.x-y.x)):a.bottom&&(Math.abs(y.y+y.height+o-m.y-m.height)<=S?(d=this._createSnapObject(m,y,"bottom"),_=Math.abs(m.x-y.x)):Math.abs(y.y+y.height+o-m.y)<=S&&(d=this._createSnapObject(m,y,"bottomTop"),_=Math.abs(m.x-y.x)))));for(u=0;u<h.length;u++)if(g=h[u],this._canConsider(b,s,g)){var L,N=t.datavisualization.Diagram.Util.bounds(g),O=i.left?-n:n,M=Math.abs(y.width+O-N.width);S>=M&&(L=i.left?-N.width+y.width:N.width-y.width,x[x.length]={source:g,diff:M,offset:L}),O=a.top?-o:o,p=Math.abs(y.height+O-N.height),S>=p&&(L=a.top?-N.height+y.height:N.height-y.height,D[D.length]={source:g,diff:p,offset:L})}e.activeTool.selectedSeperator||(f=this._createGuidelines(e,l,d,i,a,r)),!i.snapped&&x.length>0&&(i.left||i.right)&&this._addSameWidthLines(e,x,i,r,f,s),!a.snapped&&D.length>0&&(a.top||a.bottom)&&this._addSameHeightLines(e,D,a,r,f,s)},_createSnapObject:function(e,i,a){var n;switch(a){case"left":n={start:t.datavisualization.Diagram.Point(e.x,Math.min(e.y,i.y)),end:t.datavisualization.Diagram.Point(e.x,Math.max(e.y+e.height,i.y+i.height)),offsetX:e.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":n={start:t.datavisualization.Diagram.Point(e.x+e.width,Math.min(e.y,i.y)),end:t.datavisualization.Diagram.Point(e.x+e.width,Math.max(e.y+e.height,i.y+i.height)),offsetX:e.x+e.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":n={start:t.datavisualization.Diagram.Point(Math.min(e.x,i.x),e.y),end:t.datavisualization.Diagram.Point(Math.max(e.x+e.width,i.x+i.width),e.y),offsetY:e.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":n={start:t.datavisualization.Diagram.Point(Math.min(e.x,i.x),e.y+e.height),end:t.datavisualization.Diagram.Point(Math.max(e.x+e.width,i.x+i.width),e.y+e.height),offsetY:e.y+e.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":n={start:t.datavisualization.Diagram.Point(Math.min(e.x,i.x),e.y+e.height),end:t.datavisualization.Diagram.Point(Math.max(e.x+e.width,i.x+i.width),e.y+e.height),offsetY:e.y+e.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":n={start:t.datavisualization.Diagram.Point(Math.min(e.x,i.x),e.y),end:t.datavisualization.Diagram.Point(Math.max(e.x+e.width,i.x+i.width),e.y),offsetY:e.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":n={start:t.datavisualization.Diagram.Point(e.x+e.width,Math.min(e.y,i.y)),end:t.datavisualization.Diagram.Point(e.x+e.width,Math.max(e.y+e.height,i.y+i.height)),offsetX:e.x+e.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":n={start:t.datavisualization.Diagram.Point(e.x,Math.min(e.y,i.y)),end:t.datavisualization.Diagram.Point(e.x,Math.max(e.y+e.height,i.y+i.height)),offsetX:e.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":n={start:t.datavisualization.Diagram.Point(e.x+e.width/2,Math.min(e.y,i.y)),end:t.datavisualization.Diagram.Point(e.x+e.width/2,Math.max(e.y+e.height,i.y+i.height)),offsetX:e.x+e.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":n={start:t.datavisualization.Diagram.Point(Math.min(e.x,i.x),e.y+e.height/2),end:t.datavisualization.Diagram.Point(Math.max(e.x+e.width,i.x+i.width),e.y+e.height/2),offsetY:e.y+e.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return n},_createGuidelines:function(e,i,a,n,o,s){var r={id:e._canvas.id+"guideline",style:"pointer-events:none;"},l=t.datavisualization.Diagram.SvgContext._initializeGuidelines(e._adornerSvg,r,e._adornerLayer),d=e._currZoom,h=e._hScrollOffset,c=e._vScrollOffset;return i&&(n.offset=i.offsetX,n.snapped=!0,s||("sideAlign"==i.type?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,l,e._adornerSvg,d,h,c):"centerAlign"==i.type&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,l,e._adornerSvg,d,h,c))),a&&(o.offset=a.offsetY,o.snapped=!0,s||("sideAlign"==a.type?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(a.start,a.end,l,e._adornerSvg,d,h,c):"centerAlign"==a.type&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(a.start,a.end,l,e._adornerSvg,d,h,c))),e._guideline=l,l},_removeGuidelines:function(e){var i=e._guideline?e._guideline:e._adornerSvg.getElementById(e._canvas.id+"guideline");null!=i&&(t.datavisualization.Diagram.SvgContext._removeGuidelines(e._adornerLayer,i),delete e._guideline)},_sortByDistance:function(e,t,i){var a,n,o;if(i)for(a=0;a<e.length;a++)for(n=a+1;n<e.length;n++)e[a][t]>e[n][t]&&(o=e[a],e[a]=e[n],e[n]=o);else for(a=0;a<e.length;a++)for(n=a+1;n<e.length;n++)e[a][t]<e[n][t]&&(o=e[a],e[a]=e[n],e[n]=o)},_createHSpacingLines:function(e,i,a,n,o,s,r,l,d,h){var c,u,g,m,p,f,v,_,y,b=null;this._sortByDistance(a,"distance",!0),this._sortByDistance(n,"distance",!0),c=[],u=t.datavisualization.Diagram.Util.bounds(i),a.length>0&&(c[c.length]=a[0],g=t.datavisualization.Diagram.Util.bounds(a[0].object),
b=g.y,a.length>1?(p=t.datavisualization.Diagram.Util.bounds(a[1].object),f=g.x-p.x-p.width,Math.abs(f-a[0].distance)<=h?b=this._findEquallySpacedNodesAtLeft(a,f,b,c):f=a[0].distance):f=a[0].distance),this._sortByDistance(c,"distance"),c[c.length]={object:i,distance:0},b=u.y<b||!b?u.y:b,n.length>0&&(m=t.datavisualization.Diagram.Util.bounds(n[0].object),b=m.y<b?m.y:b,n.length>1&&(p=t.datavisualization.Diagram.Util.bounds(n[1].object),v=p.x-m.x-m.width),a.length>0?Math.abs(n[0].distance-a[0].distance)<=h?(_=Math.abs(n[0].distance-a[0].distance)/2,n[0].distance<a[0].distance?f-=_:f+=_,c[c.length]=n[0]):1==a.length&&(g=void 0,c.splice(0,1),c[c.length]=n[0],f=v):(f=v,c[c.length]=n[0]),n.length>1&&m.x+m.width<p.x&&(b=this._findEquallySpacedNodesAtRight(n,v,b,c,h))),c.length>2&&(this._addHSpacingLines(e,c,r,l,b),y=0,r&&(y=d.x),g?o.offset=f-Math.abs(u.x+y-g.x-g.width)+y:m&&(o.offset=Math.abs(u.x+u.width+y-m.x)-f+y),o.snapped=!0)},_createVSpacingLines:function(e,i,a,n,o,s,r,l,d,h){var c,u,g,m,p,f,v,_,y,b=null;this._sortByDistance(a,"distance",!0),this._sortByDistance(n,"distance",!0),c=[],u=t.datavisualization.Diagram.Util.bounds(i),a.length>0&&(c[c.length]=a[0],g=t.datavisualization.Diagram.Util.bounds(a[0].object),b=g.x+g.width,a.length>1?(p=t.datavisualization.Diagram.Util.bounds(a[1].object),f=g.y-p.y-p.height,Math.abs(f-a[0].distance)<=h?b=this._findEquallySpacedNodesAtTop(a,f,b,c):f=a[0].distance):f=a[0].distance),this._sortByDistance(c,"distance"),c[c.length]={object:i,distance:0},b=u.x+u.width>b||!b?u.x+u.width:b,n.length>0&&(m=t.datavisualization.Diagram.Util.bounds(n[0].object),b=m.x+m.width>b?m.x+m.width:b,n.length>1&&(p=t.datavisualization.Diagram.Util.bounds(n[1].object),v=p.y-m.y-m.height),a.length>0?Math.abs(n[0].distance-a[0].distance)<=h?(_=Math.abs(n[0].distance-a[0].distance)/2,n[0].distance<a[0].distance?f-=_:f+=_,c[c.length]=n[0]):1==a.length&&(g=void 0,c.splice(0,1),c[c.length]=n[0],f=v):(f=v,c[c.length]=n[0]),n.length>1&&p.y>m.y+m.height&&(b=this._findEquallySpacedNodesAtBottom(n,v,b,c,h))),c.length>2&&(this._addVSpacingLine(e,c,r,l,b),y=0,r&&(y=d.y),g?s.offset=f-Math.abs(u.y+y-g.y-g.height)+y:m&&(s.offset=Math.abs(u.y+u.height+y-m.y)-f+y),s.snapped=!0)},_addHSpacingLines:function(e,i,a,n,o){var s,r,l,d=e._currZoom,h=e._hScrollOffset,c=e._vScrollOffset;if(i.length>2&&!a)for(s=0;s<i.length-1;s++)r=t.datavisualization.Diagram.Util.bounds(i[s].object),l=t.datavisualization.Diagram.Util.bounds(i[s+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(r.x+r.width,o-15),t.datavisualization.Diagram.Point(l.x,o-15),n,e._adornerSvg,d,h,c)},_addVSpacingLine:function(e,i,a,n,o){var s,r,l,d=e._currZoom,h=e._hScrollOffset,c=e._vScrollOffset;if(i.length>2&&!a)for(l=0;l<i.length-1;l++)s=t.datavisualization.Diagram.Util.bounds(i[l].object),r=t.datavisualization.Diagram.Util.bounds(i[l+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o+15,s.y+s.height),t.datavisualization.Diagram.Point(o+15,r.y),n,e._adornerSvg,d,h,c)},_addSameWidthLines:function(e,i,a,n,o,s){var r,l,d=e._currZoom,h=e._hScrollOffset,c=e._vScrollOffset;this._sortByDistance(i,"offset");var u=t.datavisualization.Diagram.Util.bounds(s),g=i[0],m=t.datavisualization.Diagram.Util.bounds(g.source),p=[];for(p.push(i[0]),r=1;r<i.length;r++)l=t.datavisualization.Diagram.Util.bounds(i[r].source),l.width==m.width&&p.push(i[r]);if(p.length>0&&!n)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(u.x+g.offset,u.y-15),t.datavisualization.Diagram.Point(u.x+u.width+g.offset,u.y-15),o,e._adornerSvg,d,h,c),r=0;r<p.length;r++)u=t.datavisualization.Diagram.Util.bounds(p[r].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(u.x,u.y-15),t.datavisualization.Diagram.Point(u.x+u.width,u.y-15),o,e._adornerSvg,d,h,c);a.offset=g.offset,a.snapped=!0},_addSameHeightLines:function(e,i,a,n,o,s){var r,l,d=e._currZoom,h=e._hScrollOffset,c=e._vScrollOffset;this._sortByDistance(i,"offset");var u=t.datavisualization.Diagram.Util.bounds(s),g=i[0],m=t.datavisualization.Diagram.Util.bounds(g.source),p=[];for(p.push(i[0]),r=0;r<i.length;r++)l=t.datavisualization.Diagram.Util.bounds(i[r].source),l.height==m.height&&p.push(i[r]);if(p.length>0){if(!n)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(u.x+u.width+15,u.y+g.offset),t.datavisualization.Diagram.Point(u.x+u.width+15,u.y+u.height+g.offset),o,e._adornerSvg,d,h,c),r=0;r<p.length;r++)u=t.datavisualization.Diagram.Util.bounds(p[r].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(u.x+u.width+15,u.y),t.datavisualization.Diagram.Point(u.x+u.width+15,u.y+u.height),o,e._adornerSvg,d,h,c);a.offset=g.offset,a.snapped=!0}},_findEquallySpacedNodesAtLeft:function(e,i,a,n){for(var o,s,r,l=1;l<e.length&&(o=t.datavisualization.Diagram.Util.bounds(e[l-1].object),s=t.datavisualization.Diagram.Util.bounds(e[l].object),r=o.x-s.x-s.width,Math.abs(r-i)<=1);l++)n[n.length]=e[l],s.y<a&&(a=s.y);return a},_findEquallySpacedNodesAtRight:function(e,i,a,n,o){var s,r,l,d,h,c=e[0].distance;if(Math.abs(i-c)<=o)for(h=0;h<e.length-1&&(s=e[h].object,r=t.datavisualization.Diagram.Util.bounds(e[h+1].object),l=t.datavisualization.Diagram.Util.bounds(s),d=r.x-l.x-l.width,Math.abs(d-i)<=1);h++)n[n.length]=e[h+1],l.y<a&&(a=l.y);return a},_findEquallySpacedNodesAtTop:function(e,i,a,n){for(var o,s,r,l=1;l<e.length&&(o=t.datavisualization.Diagram.Util.bounds(e[l-1].object),s=t.datavisualization.Diagram.Util.bounds(e[l].object),r=o.y-s.y-s.height,Math.abs(r-i)<=1);l++)n[n.length]=e[l],s.x+s.width>a&&(a=s.x+s.width);return a},_findEquallySpacedNodesAtBottom:function(e,i,a,n,o){var s,r,l,d,h,c=e[0].distance;if(Math.abs(i-c)<=o)for(h=0;h<e.length-1&&(s=e[h].object,r=t.datavisualization.Diagram.Util.bounds(e[h+1].object),l=t.datavisualization.Diagram.Util.bounds(s),d=r.y-l.y-l.height,Math.abs(d-i)<=1);h++)n[n.length]=e[h+1],l.x+l.width>a&&(a=l.x+l.width);return a}},t.datavisualization.Diagram.SpatialUtil={findQuads:function(e,t){e.quads=[];var i=e.parentQuad;return this._findQuads(e,i,t),e.quads},_addIntoAQuad:function(e){for(var t=!1;!t;)t=this._add(e,e.parentQuad)},_setCurrentNode:function(e,i,a){var n,o,s,r,l;if(e.childnode=i,n=t.datavisualization.Diagram.Util.bounds(i),e.childLeft=n.left,e.childTop=n.top,e.childRight=n.right,e.childBottom=n.bottom,a)for(o=i.labels,s=0;s<o.length;s++)r=o[s],r&&r.visible&&!a.activeTool.inAction&&(l=t.datavisualization.Diagram.Util.getLabelbounds(a,i,r),l&&(n=a._union(l,n),n=t.datavisualization.Diagram.Util.bounds(n),e.childLeft=n.left,e.childTop=n.top,e.childRight=n.right,e.childBottom=n.bottom))},_add:function(e,i){if(this._isContained(e,i))return this._selectQuad(e,i),!0;var a,n=!i.objects.length&&null==i.first&&null==i.second&&null==i.third&&null==i.fourth;return e.childLeft<i.left?e.childTop<i.top?(a=t.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,2*i.width,2*i.height),n||(a.fourth=i)):(a=t.datavisualization.Diagram.Quad(i.left-i.width,i.top,2*i.width,2*i.height),n||(a.second=i)):e.childTop<i.top?(a=t.datavisualization.Diagram.Quad(i.left,i.top-i.height,2*i.width,2*i.height),n||(a.third=i)):(a=t.datavisualization.Diagram.Quad(i.left,i.top,2*i.width,2*i.height),n||(a.first=i)),i.parent=a,e.parentQuad=a,!1},_isContained:function(e,t){return e.childLeft>=t.left&&e.childRight<=t.left+t.width&&e.childTop>=t.top&&e.childBottom<=t.top+t.height},_selectQuad:function(e,t){for(var i=t;null!==i;)i=this._getQuad(e,i)},_getQuad:function(e,i){var a,n,o=i.width/2,s=i.height/2;if(o>=100&&s>=100)if(a=i.left+o,n=i.top+s,e.childRight<=a){if(e.childBottom<=n)return i.first?i.first:i.first=t.datavisualization.Diagram.Quad(i.left,i.top,o,s,i);if(e.childTop>=n)return i.third?i.third:i.third=t.datavisualization.Diagram.Quad(i.left,n,o,s,i)}else if(e.childLeft>=a){if(e.childBottom<=n)return i.second?i.second:i.second=t.datavisualization.Diagram.Quad(a,i.top,o,s,i);if(e.childTop>=n)return i.fourth?i.fourth:i.fourth=t.datavisualization.Diagram.Quad(a,n,o,s,i)}return i.objects.push(e.childnode),e.quadTable[e.childnode.name]=i,null},_findQuads:function(e,t,i){t.first&&this._isIntersect(t.first,i)&&this._findQuads(e,t.first,i),t.second&&this._isIntersect(t.second,i)&&this._findQuads(e,t.second,i),t.third&&this._isIntersect(t.third,i)&&this._findQuads(e,t.third,i),t.fourth&&this._isIntersect(t.fourth,i)&&this._findQuads(e,t.fourth,i),t.objects.length>0&&e.quads.push(t)},_isIntersect:function(e,t){return!(e.left+e.width<t.x||e.top+e.height<t.y||e.left>t.x+t.width||e.top>t.y+t.height)},_update:function(e){if(null!=e.parent&&0==e.objects.length&&null==e.first&&null==e.second&&null==e.third&&null==e.fourth){var t=e.parent;t.first==e?t.first=null:t.second==e?t.second=null:t.third==e?t.third=null:t.fourth==e&&(t.fourth=null),this._update(e.parent)}},_isWithinPageBounds:function(e,t){return t.left>=e.pageLeft&&t.right<=e.pageRight&&t.top>=e.pageTop&&t.bottom<=e.pageBottom},_updateBounds:function(e,i,a,n){var o=!1;i.topElement&&a.name==i.topElement.name&&(o=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top")),i.leftElement&&a.name==i.leftElement.name&&(o=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left")),i.rightElement&&a.name==i.rightElement.name&&(o=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right")),i.bottomElement&&a.name==i.bottomElement.name&&(o=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom")),o&&e._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(e,void 0!==n?n:!0)},_findQuadElement:function(e,i,a){var n,o;switch(a){case"bottom":null!=i.third||null!=i.fourth?(null!=i.third&&this._findQuadElement(e,i.third,a),null!=i.fourth&&this._findQuadElement(e,i.fourth,a)):(null!=i.first&&this._findQuadElement(e,i.first,a),null!=i.second&&this._findQuadElement(e,i.second,a));break;case"top":null!=i.first||null!=i.second?(null!=i.first&&this._findQuadElement(e,i.first,a),null!=i.second&&this._findQuadElement(e,i.second,a)):(null!=i.third&&this._findQuadElement(e,i.third,a),null!=i.fourth&&this._findQuadElement(e,i.fourth,a));break;case"left":null!=i.first||null!=i.third?(null!=i.first&&this._findQuadElement(e,i.first,a),null!=i.third&&this._findQuadElement(e,i.third,a)):(null!=i.second&&this._findQuadElement(e,i.second,a),null!=i.fourth&&this._findQuadElement(e,i.fourth,a));break;case"right":null!=i.second||null!=i.fourth?(null!=i.second&&this._findQuadElement(e,i.second,a),null!=i.fourth&&this._findQuadElement(e,i.fourth,a)):(null!=i.third&&this._findQuadElement(e,i.third,a),null!=i.first&&this._findQuadElement(e,i.first,a))}for(o=0;o<i.objects.length;o++)n=t.datavisualization.Diagram.Util.bounds(i.objects[o]),"bottom"===a&&(e.pageBottom<=n.bottom||null==e.pageBottom)?(e.pageBottom=n.bottom,e.bottomElement=i.objects[o]):"top"===a&&(e.pageTop>=n.top||null==e.pageTop)?(e.pageTop=n.top,e.topElement=i.objects[o]):"left"===a&&(e.pageLeft>=n.left||null==e.pageLeft)?(e.pageLeft=n.left,e.leftElement=i.objects[o]):"right"===a&&(e.pageRight<=n.right||null==e.pageRight)&&(e.pageRight=n.right,e.rightElement=i.objects[o])},_initializeNodes:function(e,t){for(var i,a,n=e.nodes(),o=0;o<n.length;o++)i=n[o],a=this.getObjectType(i),"group"!=a&&this._updateQuad(e,t,i)},_initializeConnectors:function(e,t){for(var i=e.connectors(),a=0;a<i.length;a++)this._updateQuad(e,t,i[a])},_updateQuad:function(i,a,n){var o,s,r,l,d;this._setCurrentNode(a,n,i),o=t.datavisualization.Diagram.Util.bounds(n),s=a.quadTable[n.name],s?this._isContained(a,s)||(this._removeFromaQuad(a,s,n),this._addIntoAQuad(a)):(a.parentQuad||(a.parentQuad=t.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(a)),this._isWithinPageBounds(a,o)&&a.leftElement!=n&&a.topElement!=n&&a.rightElement!=n&&a.bottomElement!=n||(r=!1,l=!1,a.pageLeft>=a.childLeft||null==a.pageLeft?(a.pageLeft=a.childLeft,a.leftElement=n,r=!0):n==a.leftElement&&(a.pageLeft=null,this._findQuadElement(a,a.parentQuad,"left"),l=r=!0),a.pageTop>=a.childTop||null==a.pageTop?(a.pageTop=a.childTop,a.topElement=n,r=!0):n==a.topElement&&(a.pageTop=null,this._findQuadElement(a,a.parentQuad,"top"),l=r=!0),a.pageBottom<=a.childBottom||null==a.pageBottom?(r=!0,a.pageBottom=a.childBottom,a.bottomElement=n):n==a.bottomElement&&(a.pageBottom=null,this._findQuadElement(a,a.parentQuad,"bottom"),l=r=!0),a.pageRight<=a.childRight||null==a.pageRight?(a.pageRight=a.childRight,a.rightElement=n,r=!0):n==a.rightElement&&(a.pageRight=null,this._findQuadElement(a,a.parentQuad,"right"),l=r=!0)),d=i.activeTool.diagramBounds,r&&i.model.pageSettings.multiplePage&&(i.model.pageSettings.pageWidth||i.model.pageSettings.pageHeight)&&d&&(r=!1,(l||a.pageLeft<d.x||a.pageTop<d.y||a.pageRight>d.x+d.width||a.pageBottom>d.y+d.height)&&(r=!0,i.activeTool.diagramBounds=i._getDigramBounds())),r&&(i._views.forEach(function(t){var a,n=i._views[t];"overview"==n.type&&(a=e("#"+t).ejOverview("instance"),a&&a._updateOverview(n))}),!i._layoutInAction&&i._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(i,i.activeTool.inAction||i._selectedSymbol))},_removeFromaQuad:function(e,t,i){if(t){var a=t.objects.indexOf(i);t.objects.splice(a,1),this._update(t),delete e.quadTable[i.name]}}},t.datavisualization.Diagram.Quad=function(e,t,i,a,n){return{left:e,top:t,width:i,height:a,parent:n,first:null,second:null,third:null,fourth:null,objects:[]}},t.datavisualization.Diagram.SpatialSearch=function(){return{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:t.datavisualization.Diagram.Quad(0,0,200,200),quadTable:{}}},t.datavisualization.Diagram.ClassifierHelper={getEditableElementUnderMouse:function(e,t){var i,a=t._findNodeUnderMouse(e);return a&&(i=a.name.match("_attribute")?"attribute":a.name.match("_method")?"method":a.name.match("_member")?"member":"header",i&&a.parent&&(a=t.nameTable[a.parent])),a},getMovableElementUnderMouse:function(e,t){var i=t._findNodeUnderMouse(e);e.target.className;return!i||!i.parent||"umlclassifier"==i.type||(i=t.nameTable[i.parent]),i},getSelectableElementUnderMouse:function(e,t){var i=t._findNodeUnderMouse(e);return!i||!i.parent||"umlclassifier"==i.type||(i=t.nameTable[i.parent]),i},getDropableElementUnderMouse:function(e,i){var a=i._findNodeUnderMouse(e);return i._nodeUnderMouse||(i._nodeUnderMouse=a),a&&t.datavisualization.Diagram.Util.canAllowDrop(a)?a:!0},renderResizeBorder:function(e,t,i,a){var n=t.width?t.width:t._width,o=t.height?t.height:t._height;return i.rect({id:e,width:n*a+t.borderWidth+4,height:o*a+t.borderWidth+4,x:-(t.borderWidth/2+2),y:-(t.borderWidth/2+2),stroke:"#f93732","stroke-width":2,"stroke-dasharray":"0",fill:"none","pointer-events":"none"})},getEditboxValue:function(i,a,n){for(var o,s,r,l,d,h,c,u,g,m=0;m<a.children.length;m++)"string"==typeof a.children[m]&&(a.children[m]=n.nameTable[n._getChild(a.children[m])]),o=a.children[m].name.match("_attribute")?"attribute":a.children[m].name.match("_method")?"method":a.children[m].name.match("_member")?"member":"header";for(s=i.split("\n"),g=0;g<s.length;g++)s[g]=s[g].trim().replace(/\s+/g," "),!s[g].indexOf("---")>-1&&"+"==s[g].charAt(0)||"-"==s[g].charAt(0)||"#"==s[g].charAt(0)||"~"==s[g].charAt(0)?s[g]=s[g]:g!=s[g].length-s[g].length&&!s[g].indexOf("---")>-1&&s[g].length>0&&"member"!=o&&!a.enumeration&&(s[g]="+ "+s[g]),s[g].indexOf("---")>-1&&s[g].match(/\w|\d|\D|\s/g)&&(r=s[g].match(/---/g),s[g]=r[0]);for(i=s.join("\n"),l=i.split("\n---\n"),g=0;g<l.length;g++)l[g]=l[g].replace(/^\n+/g,"");for(l[0].indexOf("+")>-1&&(l[0]=l[0].replace(/[+]/g,"")),l[0].length>0&&(a.children[0].labels[0].text=l[0]),a.children[1]&&!l[2]?a.children[1].labels[0].text=l[1]:a.children[1]&&l[2]&&(a.children[1].name.indexOf("method")>-1?a.children[1].labels[0].text.indexOf(l[1])>-1?(a.children[1].labels[0].text=l[1],l.pop()):a.children[1].labels[0].text=l[2]:(d=a.children[1].name.indexOf("attribute")>-1?l[1]:a.children[1].name.indexOf("member")>-1?l[1]:l[2],a.children[1].labels[0].text=d)),a.children[2]&&(a.children[2].labels[0].text=l[2]),m=0;m<a.children.length;m++)h=a.children[m].labels[0].text,h&&h.indexOf("--")>-1&&(h=h.replace(/---\n*/g,""),a.children[m].labels[0].text=h),h&&h.endsWith("\n")&&(c=h.replace(/\n+$/g,""),a.children[m].labels[0].text=c),u=a.children[m].labels[0].text?a.children[m].labels[0].text.length:null,!u&&0>=u&&(n._remove(a.children[m]),m--),n.nameTable[a.children[m].name]=a.children[m];if(l[2]&&!a.children[2]||l[1]&&!a.children[1]){var p=[],f=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast),v={width:a.width,offsetX:a.offsetX,parent:a.name,ports:[],fillColor:"transparent",borderColor:a.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0};for(m=0;m<a.children.length;m++)0!=m&&a.children[m].name.indexOf("_attribute")>-1&&l[2].length>0?p.push({name:a.name+"_method_classifier",labels:[{text:l[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f}):0!=m&&a.children[m].name.indexOf("_method")>-1&&l[1].length>0&&p.push({name:a.name+"_attribute_classifier",labels:[{text:l[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f});for(a.children.length<2&&(l[1]&&p.push({name:a.name+"_attribute_classifier",labels:[{text:l[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f}),l[2]&&p.push({name:a.name+"_method_classifier",labels:[{text:l[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:f})),g=0;g<p.length;g++)p[g].labels[0]=e.extend(!0,{},a.labels[0],p[g].labels[0]),p[g]=t.datavisualization.Diagram.Node(e.extend(!0,{},v,p[g])),n._getNodeDimension(p[g],p[g].labels[0]),p[g].offsetY+=a.offsetY-a.height/2,n.add(p[g]),n.nameTable[p[g].name]=p[g];a.children[2]&&a.children[2].match("_attribute")&&(a.children.splice(1,0,a.children[2]),a.children.pop()),"string"==typeof a.children[1]&&(a.children[1]=n.nameTable[a.children[1]]),"string"==typeof a.children[2]&&(a.children[2]=n.nameTable[a.children[2]])}for(m=0;m<a.children.length;m++)1==a.children.length&&(a["class"]&&(delete a["class"].attributes,delete a["class"].methods),a["interface"]&&(delete a["interface"].attributes,delete a["interface"].methods),a.enumeration&&delete a.enumeration.members),2==a.children.length&&(a["class"]&&(a.children[m].name.match("attribute")&&delete a["class"].methods,a.children[m].name.match("method")&&delete a["class"].attributes),a["interface"]&&(a.children[m].name.match("attribute")&&delete a["interface"].methods,a.children[m].name.match("method")&&delete a["interface"].attributes)),this._updateClassNode(a.children[m],a);return i},getUMLConnectorValue:function(t,i,a){var n,o,s,r;return(a.name===t.name+"_sourcelabel"||a.name===t.name+"_targetlabel")&&(("onetoone"==t.shape.multiplicity.type||"manytoone"==t.shape.multiplicity.type||"onetomany"==t.shape.multiplicity.type)&&(1==i.length&&(i.indexOf("1")>-1||i.indexOf("*")>-1)&&(n=!0),o=!1,a.name!==t.name+"_sourcelabel"||"onetoone"!=t.shape.multiplicity.type&&"onetomany"!=t.shape.multiplicity.type?a.name===t.name+"_targetlabel"&&("manytoone"==t.shape.multiplicity.type||"onetoone"==t.shape.multiplicity.type)&&(i="1",t.shape.multiplicity=e.extend(!0,{},t.shape.multiplicity,{target:{optional:o,lowerBounds:null,upperBounds:null}})):(i="1",t.shape.multiplicity=e.extend(!0,{},t.shape.multiplicity,{source:{optional:o,lowerBounds:null,upperBounds:null}}))),i=this.umlConnectorEditBox(i),i.match(/\d\.{3}\d/g)?r=i.split("..."):n||(s=this.umlConnectorMultiplicity(t),a.name==t.name+"_sourcelabel"?(r=s[0].text.split("..."),i=s[0].text):(r=s[1].text.split("..."),i=s[1].text)),r&&(t.shape.multiplicity=a.name==t.name+"_sourcelabel"?e.extend(!0,{},t.shape.multiplicity,{source:{optional:o,lowerBounds:r[0],upperBounds:r[1]}}):e.extend(!0,{},t.shape.multiplicity,{target:{optional:o,lowerBounds:r[0],upperBounds:r[1]}}))),a.text=i,t},umlConnectorMultiplicity:function(e){var t,i,a,n,o,s,r=[];return e.shape.multiplicity.source&&(e.shape.multiplicity.source.lowerBounds=this.umlConnectorEditBox(e.shape.multiplicity.source.lowerBounds),e.shape.multiplicity.source.upperBounds=this.umlConnectorEditBox(e.shape.multiplicity.source.upperBounds)),e.shape.multiplicity.target&&(e.shape.multiplicity.target.lowerBounds=this.umlConnectorEditBox(e.shape.multiplicity.target.lowerBounds),e.shape.multiplicity.target.upperBounds=this.umlConnectorEditBox(e.shape.multiplicity.target.upperBounds)),o=e.shape.multiplicity.source,s=e.shape.multiplicity.target,t=o.upperBounds?o.lowerBounds+"..."+o.upperBounds:o.lowerBounds,i=s.upperBounds?s.lowerBounds+"..."+s.upperBounds:s.lowerBounds,"manytoone"==e.shape.multiplicity.type&&(e.shape.multiplicity.target.optional=!1,a=t?t:"*",n="1"),"onetomany"==e.shape.multiplicity.type&&(e.shape.multiplicity.source.optional=!1,n=i?i:"*",a="1"),"manytomany"==e.shape.multiplicity.type&&(a=t?t:"*",n=i?i:"*"),"onetoone"==e.shape.multiplicity.type&&(e.shape.multiplicity.target.optional=!1,e.shape.multiplicity.source.optional=!1,a="1",n="1"),r.push({name:e.name+"_sourcelabel",text:a,segmentOffset:0,alignment:"before",margin:{left:5,top:5}},{name:e.name+"_targetlabel",text:n,segmentOffset:1,alignment:"before",margin:{right:5,bottom:5}}),r},umlConnectorEditBox:function(e){return"string"==typeof e&&e.match(/[a-zA-Z]/g)&&(e=e.replace(/[a-zA-Z]/g,"")),e},EnableorDisableConnection:function(e,t,i){return i.shape&&"umlclassifier"==i.shape.type&&"association"!=i.shape.relationship&&("dependency"!=i.shape.relationship&&"inheritance"!=i.shape.relationship&&"realization"!=i.shape.relationship&&t&&e&&e["interface"]&&t["class"]&&(e=null),"dependency"==i.shape.relationship&&t&&e&&e["class"]&&t["interface"]&&(e=null)),e},getClassifierNodeDimension:function(e,t){for(var i,a,n,o=0;o<e.children.length;o++)t._getNodeDimension(e.children[o]);for(e._height=0,o=0;o<e.children.length;o++)i=e.children[o].height?e.children[o].height:e.children[o]._height,e.children[o].offsetY=e._height+i/2,e._height+=i,e.height=e._height;for(a=e.children[0]._width,e.children[1]&&(a=e.children[0]._width>e.children[1]._width?e.children[0]._width:e.children[1]._width),e.children[2]&&(a=e.children[2]._width>a?e.children[2]._width:a),e.children[0].width=a,e.children[1]&&(e.children[1].width=a),e.children[2]&&(e.children[2].width=a),e.width=a,n=0;n<e.children.length;n++)e.children[n].offsetY+=e.offsetY-e.height/2;return t._updateAssociatedConnectorEnds(e,t.nameTable),e},_updateClassNode:function(e,i){var a,n;if(e.name.match("_header"))i["class"]?i["class"].name=e.labels[0].text:i["interface"]?i["interface"].name=e.labels[0].text:i.enumeration.name=e.labels[0].text;else{for(var o,s,r,l,d=e.name.match("_attribute")?"attribute":e.name.match("_method")?"method":"member",h=e.labels[0],c=[],u=h.text.split("\n"),g=[],m=0;m<u.length;m++)switch(u[m].indexOf("+")>-1?o="public":u[m].indexOf("-")>-1?o="private":u[m].indexOf("#")>-1?o="protected":u[m].indexOf("~")>-1&&(o="package"),(u[m].indexOf("+")>-1||u[m].indexOf("-")>-1||u[m].indexOf("#")>-1||u[m].indexOf("~")>-1)&&(u[m]=u[m].replace(/[+|~|#|-]\s/g,"")),d){case"attribute":l=u[m].split(/:[ ]*/g),g.push(t.datavisualization.Diagram.ClassAttribute({name:l[0],type:l[1],scope:o}));break;case"method":for(s=u[m].split(/["("|")"]/g),a=0;a<s.length;a++)s[a].indexOf(",")>-1&&(l=s[a].split(",")),a==s.length-1&&(s[a]=s[a].replace(/[:\s]|:/g,""));if(l)for(n=0;n<l.length;n++)r=l[n].split(":"),c.push(t.datavisualization.Diagram.ClassmethodArguments({name:r[0],type:r[1]}));3!=s.length||l||(s[1].indexOf(":")>-1?(r=s[1].split(":"),c.push(t.datavisualization.Diagram.ClassmethodArguments({name:r[0],type:r[1]}))):c.push(t.datavisualization.Diagram.ClassmethodArguments({name:s[1]}))),g.push(t.datavisualization.Diagram.ClassMethod({name:s[0],arguments:c,type:s[s.length-1],scope:o}));break;case"member":g.push(t.datavisualization.Diagram.ClassMember({name:u[m]}))}"attribute"==d?i["class"]?i["class"].attributes=g:i["interface"]&&(i["interface"].attributes=g):"method"==d?i["class"]?i["class"].methods=g:i["interface"]&&(i["interface"].methods=g):i.enumeration.members=g}}},t.datavisualization.Diagram.SwimLaneContainerHelper={_initSwimLane:function(e,i){var i=t.datavisualization.Diagram.SwimLane(i);return i=this._initLaneCollection(e,i),this._swapPhaseSize(i),i=this._setPhaseMinValues(e,i),this._initPhaseCollection(e,i)},_initLaneCollection:function(e,i){var a,n,o,s;for(0===i.lanes.length&&(i.lanes=[t.datavisualization.Diagram.Lane({orientation:i.orientation})]),a=0;a<i.lanes.length;a++){if(i.lanes[a]=t.datavisualization.Diagram.Lane(i.lanes[a]),i.lanes[a].container={type:"canvas",orientation:i.orientation},i.lanes[a].borderColor=i.lanes[a].borderColor?i.lanes[a].borderColor:"black",i.lanes[a].orientation=i.orientation?i.orientation:"horizontal",i.lanes[a].horizontalAlign="horizontal"===i.orientation?"stretch":"left",i.lanes[a].verticalAlign="vertical"===i.orientation?"stretch":"top",i.lanes[a].addInfo=i.lanes[a].addInfo?i.lanes[a].addInfo:{},i.lanes[a].fillColor=i.lanes[a].fillColor,i.lanes[a].paddingTop=20,i.lanes[a].paddingRight=20,i.lanes[a].paddingBottom=20,i.lanes[a].paddingLeft=20,i.lanes[a].constraints=i.lanes[a].constraints?i.lanes[a].constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,i.lanes[a].cssClass=i.lanes[a].cssClass,i.lanes[a]._laneHeader=i.lanes[a]._laneHeader?i.lanes[a]._laneHeader:null,i.lanes[a].labels&&i.lanes[a].labels.length>0)for(n=0;n<i.lanes[a].labels.length;n++)i.lanes[a].labels[n]=t.datavisualization.Diagram.Label(i.lanes[a].labels[n]);o=i.lanes[a]._laneHeader=i.lanes[a]._laneHeader?i.lanes[a]._laneHeader:i.lanes[a].header,s=this._initLaneHeader(e,i.lanes[a],o,i),i.lanes[a].children.splice(0,0,s)}return i},_initLaneHeader:function(e,i,a,n){var o,s,n,r=i.header,l=n.orientation;return"horizontal"===l?(o="left",s="stretch",r.rotateAngle=270):(o="stretch",s="top",r.rotateAngle=0),n=t.datavisualization.Diagram.Node({_hidePorts:!0,_isHeader:!0,name:e._isUndo&&a.name?a.name:i.name+"_Headerr_",type:"node",labels:[r],height:a.height?a.height:50,width:a.width?a.width:50,fillColor:r.fillColor?r.fillColor:"white",rotateAngle:0,horizontalAlign:o,verticalAlign:s,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20}),n.labels[0].name=r&&r._labelName&&e._isUndo?r._labelName:n.name+"_label",n},_initPhaseCollection:function(e,i){var a,n=0,o=0;for(0===i.phases.length&&(i.phases=[t.datavisualization.Diagram.Phase({orientation:i.orientation})]),a=0;a<i.phases.length;a++)i.phases[a]._UndoRedo=e._UndoRedo,i.phases[a]._isUndo=e._isUndo,i.phases[a]=t.datavisualization.Diagram.Phase(i.phases[a]),i.phases[a].isPhase=!0,i.phases[a]._hidePorts=!0,i.phases[a].constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,i.phases[a].parent="",i.phases[a]._isHeader=!0,i.phases[a]._type="node",i.phases[a].orientation=i.orientation,e._isLoad?i.phases[a].labels&&i.phases[a].labels.length>0&&(i.phases[a].label=[i.phases[a].labels[0]]):i.phases[a].label&&0!=i.phaseSize&&(i.phases[a].label.rotateAngle="vertical"===i.orientation?270:0,i.phases[a].labels=[i.phases[a].label]),"horizontal"===i.orientation?(i.phases[a].width=i.phases[a].offset-o,i.phases[a].height=i.phaseSize,o=i.phases[a].offset):(i.phases[a].height=i.phases[a].offset-n,i.phases[a].width=i.phaseSize,n=i.phases[a].offset);return i},_setPhaseMinValues:function(e,t){var i,a,n;if(a=t.phases[0])for(a.offset<70&&(a.offset=70),n=1;n<t.phases.length;n++)i=t.phases[n],a=t.phases[n-1],a.offset+20>=i.offset&&(i.offset=a.offset+20);return t},_swapPhaseSize:function(e){if(e.phases.length>0)for(var t,i,a=e.phases,n=0;n<a.length;n++)for(t=0;t<a.length-n-1;t++)a[t].offset>a[t+1].offset&&(i=a[t],a[t]=a[t+1],a[t+1]=i)},_setLastPhaseSize:function(e){if(e.phases.length>0){var t=e.phases[e.phases.length-1];t.offset="horizontal"===e.orientation?e.width:e.height}},_createSwimlane:function(e,i){var a,n,o,s,r=this._createSwimlaneHeader(e,i),l="horizontal"===i.orientation?"vertical":"horizontal",d=i.orientation;"horizontal"===d?(a=Math.round(r.height+i.phaseSize),n=0):(a=r.height,n=Math.round(i.phaseSize));var h={name:i.name+"phaseStack",isPhaseStack:!0,container:{type:"stack",orientation:d},minHeight:10,minWidth:10,children:i.phases,marginTop:r.height,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect&~t.datavisualization.Diagram.NodeConstraints.AllowDrop},c={name:i.name+"laneStack",isLaneStack:!0,container:{type:"stack",orientation:l},children:i.lanes,marginTop:a,marginLeft:n,verticalAlign:"stretch",horizontalAlign:"stretch",constraints:(t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop)&~t.datavisualization.Diagram.NodeConstraints.Connect},u={_hidePorts:!0,name:i.name,container:{type:"canvas"},children:[r,c],addInfo:i.addInfo?i.addInfo:null,paletteItem:i.paletteItem?i.paletteItem:null,constraints:i.constraints,cssClass:i.cssClass,offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,orientation:i.orientation,phaseSize:i.phaseSize,isSwimlane:!0,height:i.height?i.height:100,width:i.width?i.width:100};return u.offsetX=i.offsetX?i.offsetX:100,u.offsetY=i.offsetY?i.offsetY:100,o=t.datavisualization.Diagram.containerCommon._cloneObject(e,u,t.datavisualization.Diagram.Util.randomId()),o=t.datavisualization.Diagram.ContainerHelper._initContainer(e,o),s=t.datavisualization.Diagram.Util.bounds(o),s=this._setSwimlaneSize(e,u,s),t.datavisualization.Diagram.containerCommon._removeObject(e,o),"horizontal"===d?(h.maxHeight=i.phaseSize,h.minWidth=10):(h.minHeight=10,h.maxWidth=i.phaseSize),u.children.splice(1,0,h),this._setPhaseValues(e,u,s),t.datavisualization.Diagram.ContainerHelper._initContainer(e,u)},_setSwimlaneSize:function(e,t,i){var a,n,o;if("horizontal"===t.orientation){if(t.width>i.width){for(n=t.children[1].children,o=0;o<n.length;o++)n[o].minWidth=t.width;i.width=t.width}t.height>i.height&&(n=t.children[1].children,a=n[n.length-1],a.minHeight+=t.height-i.height,i.height=t.height)}else if(t.width>i.width&&(n=t.children[1].children,a=n[n.length-1],a.minWidth+=t.width-i.width,i.height=t.height),t.height>i.height){for(n=t.children[1].children,o=0;o<n.length;o++)n[o].minHeight=t.height-2*t.children[0].height;i.height=t.height}return i},_setPhaseValues:function(e,t,i){var a,n,o,s,r,l=t.children[1].children,d=l[l.length-1],h=t.orientation;if("horizontal"===h)if(d.offset<=i.width)for(1==l.length?(d.offset=i.width,d.width=i.width):(n=l[l.indexOf(d)-1],d.offset=i.width,d.width=i.width-n.offset),s=t.children[2].children,r=0;r<s.length;r++)s[r].minWidth=d.offset;else{for(o=0,r=0;r<l.length;r++)l[r].offset>=o&&(o=l[r].offset);for(s=t.children[2].children,r=0;r<s.length;r++)s[r].minWidth=o;
}else if(a=t.children[0],d.offset<=i.height-a.height)for(1==l.length?(d.offset=i.height-a.height,d.height=d.offset):(n=l[l.indexOf(d)-1],d.offset=i.height-a.height,d.height=i.height-n.offset-a.height),s=t.children[2].children,r=0;r<s.length;r++)s[r].minHeight=d.offset;else{for(o=0,r=0;r<l.length;r++)l[r].offset>=o&&(o=l[r].offset);for(s=t.children[2].children,r=0;r<s.length;r++)s[r].minHeight=o}},_createSwimlaneHeader:function(e,i){var a,n=i.header,o=i.lanes[0]._laneHeader?i.lanes[0]._laneHeader:null;return n.name=i.name+"_header_swimlane_label",a=t.datavisualization.Diagram.Node({_type:"node",_hidePorts:!0,_isHeader:!0,name:i.name+"_header_swimlane",labels:[n],height:void 0!=n.height?n.height:50,width:void 0!=n.width?n.width:50,fillColor:i.header.fillColor?i.header.fillColor:o?o.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name}),a.labels[0].fillColor="transparent",e._isLoad&&(a.fillColor=i.header.fillColor),a},_updateSwimlane:function(e,i){this._updateLaneStack(e,i),this._updatePhaseStack(e,i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,i)},_updateLaneStack:function(e,t){for(var i,a,n,o=this.getLanes(e,t),s=0;s<o.length;s++)if(n=e.nameTable[e._getChild(o[s])]){for(i=1;i<n.children.length;i++)a="string"==typeof n.children[i]?e.nameTable[n.children[i]]:n.children[i],a.marginBottom=a.marginRight=0;this._updateLane(e,n)}},_updatePhaseStack:function(e,i){var a=e.nameTable[e._getChild(i.children[1])];t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a)},_updateLane:function(e,i){t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,i)},getPhases:function(e,t,i){var a,n;return t&&(t.children[1]&&(a=i?i[e._getChild(t.children[1])]:e.nameTable[e._getChild(t.children[1])]),a&&(n=e._getChildren(a.children),n&&n.length>0))?n:void 0},getLanes:function(e,t){var i,a;return t&&t.isSwimlane&&t.children[2]&&(i=e.nameTable[e._getChild(t.children[2])]),i&&(a=i.children,a&&a.length>0)?a:void 0},_updateLanesMinValue:function(e,t,i,a){for(var n,o=this.getLanes(e,t),s=0;s<o.length;s++)n=e.nameTable[e._getChild(o[s])],n&&(n[i]=a)},_resizeLastPhase:function(){},_getPhaseBounds:function(e,i){var a,n,o,s,r,l,d,h=null,c=0,u=0,g=0,m=0;return i&&"phase"==i.type&&i.parent&&(s=this._getPrevPhase(e,i),r=this._getNextPhase(e,i),a=e.nameTable[i.parent.split("phaseStack")[0]],a&&a.orientation&&(h=t.datavisualization.Diagram.Util.bounds(a),"horizontal"==a.orientation?(o=this._getPrevOffset(e,i,s,r,a,h),s&&s.name===i.name?(c=o.left+h.left,u=c+(i.offset-c-o.left)):(s&&(c=h.left+s.offset),u=i.offset-c+h.left),g=o.top+h.top,m=h.bottom-g,n=t.datavisualization.Diagram.Rectangle(c,g,u,m)):(o=this._getPrevOffset(e,i,s,r,a,h),s===i?(c=o.left+h.left,m=i.offset+g,g=o.top+h.top):(l=e.nameTable[e._getChild(a.children[0])],d=l?l.height:0,c=o.left+h.left,s&&(g=s.offset+h.top+d),m=h.top+i.offset-g+d),u=h.right-c,n=t.datavisualization.Diagram.Rectangle(c,g,u,m)))),n},_getPrevPhase:function(e,i){var a,n=null,o=e.nameTable[i.parent.split("phaseStack")[0]],s=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,o);return o&&s&&s.length>0&&(a=this._getPhaseIndex(e,i.name),n=0===a?e.nameTable[e._getChild(s[0])]:e.nameTable[e._getChild(s[a-1])]),n},_getPrevOffset:function(e,t,i,a,n){var o,s,r,l,d=0,h=0;return n.children[0]&&(r=e.nameTable[e._getChild(n.children[0])],r&&(h=r.height)),"horizontal"==n.orientation&&(n.children[2]&&(o=e.nameTable[e._getChild(n.children[2])]),o&&o.children&&o.children.length>0&&(s=e.nameTable[e._getChild(o.children[0])],s&&s.children&&s.children.length>0&&(l=e.nameTable[e._getChild(s.children[0])],l&&-1!=l.name.indexOf("_Headerr")&&(d=l.width)))),{left:d,top:h}},_getNextPhase:function(e,i){var a,n=null,o=e.nameTable[i.parent.split("phaseStack")[0]],s=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,o);return o&&s&&s.length>0&&(a=e._getPhaseIndex(i.name),n=a===s.length-1?e.nameTable[e._getChild(s[a])]:e.nameTable[e._getChild(s[a+1])]),n},_getPhaseIndex:function(e,i){var a,n,o,s=-1;return a=e.nameTable[i],a&&a.parent&&(n=e.nameTable[a.parent.split("phaseStack")[0]],o=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,n),o&&o.length>0&&(s=o.indexOf(i))),s},_cloneLaneObj:function(t,i,a,n){var o,s,r,l=n?n:t.nameTable;if(i=e.extend(!0,{},i),o=i.children,o&&o.length>0)for(s=0;s<o.length;s++)r=l[t._getChild(o[s])],r&&(r=jQuery.extend(!0,{},r),r&&r.children&&r.children.length&&(r=t._cloneLaneObj(r,a,n)),r.name+=a,r.parent=a,i.children[s]=r,n&&t._preserveConnection(n,r));return i&&i.header&&(i.header.name+=a),i.name+=a,i},_cloneSwimlaneObj:function(t,i,a,n){var o;if(i=e.extend(!0,{},i),i&&i.isSwimlane){if(i=jQuery.extend(!0,{},i),i.name+=a,i.lanes&&i.lanes.length>0)for(o=0;o<i.lanes.length;o++)i.lanes[o]&&(i.lanes[o]=t._cloneLaneObj(i.lanes[o],a,n&&n.childTable?n.childTable:null));if(i.phases&&i.phases.length>0)for(o=0;o<i.phases.length;o++)i.phases[o]&&(i.phases[o].name+=a,i.phases[o].parent="")}return i},_pasteSwimlaneObj:function(e,i,a){if(i=e._pasteSwimlane(i,a)){var n=e._isUndo?0:10*e._pasteIndex;e._translate(i,n,n,e.nameTable),t.datavisualization.Diagram.DiagramContext.update(i,e)}return i},_pasteSwimlane:function(e,i,a){if(e._pasteObj=!0,i&&i.isSwimlane){var n=e._isUndo?0:10*e._pasteIndex,o=e._cloneSwimlaneObj(e._getNode(i.name,a?a.childTable:null),e._swimlanePaste?"":t.datavisualization.Diagram.Util.randomId(),a);return o=t.datavisualization.Diagram.ContainerHelper._initContainer(e,o,a),e._outOfBoundsOnNudge(o,n,n)?(e.add(o),e._pasteObj=!1,o):(t.datavisualization.Diagram.containerCommon._removeObject(e,o),null)}},_updateNextPhase:function(e,i,a,n){for(var o,s=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i),r=n+1;r<s.length;r++)o=e.nameTable[e._getChild(s[r])],o&&(o.offset+=a)},_getOuterNodes:function(e,i,a,n){for(var o,s,r,l,d=[],h=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(e,i),c="horizontal"===i.orientation?"left":"top",u="horizontal"===i.orientation?a:n,g=0;g<h.length;g++)if(o=e.nameTable[e._getChild(h[g])],o&&o.children.length>1)for(s=0;s<o.children.length;s++)r=e.nameTable[e._getChild(o.children[s])],r&&(l=t.datavisualization.Diagram.Util.bounds(r),l[c]>u&&d.push(r));return d},_getInnerNodes:function(e,i,a,n){for(var o,s,r,l,d=[],h=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(e,i),c="horizontal"===i.orientation?"left":"top",u="horizontal"===i.orientation?"right":"bottom",g=0;g<h.length;g++)if(o=e.nameTable[e._getChild(h[g])],o&&o.children.length>1)for(s=0;s<o.children.length;s++)r=e.nameTable[e._getChild(o.children[s])],r&&(l=t.datavisualization.Diagram.Util.bounds(r),l[c]>=a&&l[u]<=n&&d.push(r));return d},_moveOuterNodes:function(e,i,a,n){var o,s,r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i),l=e.nameTable[e._getChild(r[n])],d=t.datavisualization.Diagram.Util.bounds(i),h=e.nameTable[e._getChild(i.children[0])],c=d.left+l.offset,u=d.top+l.offset+h.height,g="horizontal"===i.orientation?"offsetX":"offsetY",m=("horizontal"===i.orientation?c:u,"horizontal"===i.orientation?"marginLeft":"marginTop"),p=e._getOuterNodes(i,c,u);if(p&&p.length>0)for(o=0;o<p.length;o++)s=e.nameTable[e._getChild(p[o])],e._translate(s,"offsetX"===g?a:0,"offsetY"===g?a:0,e.nameTable),s[m]+=a},_moveOnPhaseChange:function(e,i,a){var n,o,s,r,l,d=i.parent.split("phaseStack")[0];if(d&&(o=e.nameTable[d]),o){for(s=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(e,o),r=e.nameTable[e._getChild(o.children[0])],l=0;l<s.length;l++)n=e.nameTable[e._getChild(s[l])],n&&("horizontal"===i.orientation?(n.width+=a,n.minWidth=n.width):(n.height+=a,n.minHeight=n.height));"horizontal"===i.orientation?o.minWidth+=a:o.minHeight=n.height,t.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(e,o)}},_getPhaseDifferece:function(e,i,a,n){var o,s,r,l,d,h=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i),c=e.nameTable[e._getChild(h[a])],u=t.datavisualization.Diagram.Util.bounds(i),g="horizontal"===i.orientation?"left":"top",m=e.nameTable[e._getChild(i.children[0])],p=0;return"vertical"===i.orientation&&(p=m.height),0===a?(s=e._getInnerNodes(i,u[g]+p,u[g]+c.offset+p),s&&s.length>0?(r=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(r,e),l=t.datavisualization.Diagram.Util.bounds(r)):(l=t.datavisualization.Diagram.Util.bounds(),l.right=u.left+50),"horizontal"===i.orientation?(u.left+(c.offset+n)>=l.right+20||(d=l.right+20-(u.left+(c.offset+n)),n+=d),c.offset+n<100&&(n=0)):(u.top+m.height+(c.offset+n)>=l.bottom+20||(d=l.bottom+20-(u.top+p+(c.offset+n)),n+=d),c.offset+n<100&&(n=0))):(o=e.nameTable[e._getChild(h[a-1])],s=e._getInnerNodes(i,u[g]+o.offset+p,u[g]+c.offset+p),s&&s.length>0?(r=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(r,e),l=t.datavisualization.Diagram.Util.bounds(r)):(l=t.datavisualization.Diagram.Util.bounds(),l.bottom=u.top+m.height+o.offset),"horizontal"===i.orientation?u.left+(c.offset+n)>=l.right+20||(d=l.right+20-(u.left+(c.offset+n)),n+=d):u.top+m.height+(c.offset+n)>=l.bottom+20||(d=l.bottom+20-(u.top+m.height+(c.offset+n)),n+=d)),o&&c.offset-o.offset+n<20&&(n-=c.offset-o.offset+n-20),n}},t.datavisualization.Diagram.ContainerHelper={_initContainer:function(e,i){if(i.container)switch(i.container.type){default:case"canvas":if(i=t.datavisualization.Diagram.canvasHelper._initCanvas(e,i),"bpmn"==i.type){var a=t.datavisualization.Diagram.ContainerHelper.updateparent(i,e);a||t.datavisualization.Diagram.bpmnHelper.updateCanvas(i,e)}break;case"stack":i=t.datavisualization.Diagram.stackHelper._initStack(e,i)}else("swimlane"===i.type||i.isSwimlane)&&(i=t.datavisualization.Diagram.SwimLaneContainerHelper._initSwimLane(e,i),i=t.datavisualization.Diagram.SwimLaneContainerHelper._createSwimlane(e,i));return i},_add:function(i,a){var n,o,s,r,l,d;if("connector"!==i.getObjectType(a)&&(n=a.parent?i.nameTable[a.parent]:null,n&&n.container)){for(o=n.children.length-1;o>=0;o--)s=i.nameTable[i._getChild(n.children[o])],s.name===a.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(n.children,n.children[o]);r=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,i._isLaneApi&&(r=t.datavisualization.Diagram.GroupChangeCause.Unknown),i._raiseGroupChangeEvent(a,null,n,r),n.children.push(a),i._disableSwimlaneUptate=!0,t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(i),l=e.extend(!0,{},n),this._updateCollectionChange(i,n,!0),t.datavisualization.Diagram.canvasHelper._updateAddRemoveNodeConnectors(i,n,l),delete i._disableSwimlaneUptate,t.datavisualization.Diagram.canvasHelper._updateLastSwimlanePhase(i,a),d=i._svg.document.getElementById(a.parent),"group"===a._type?t.datavisualization.Diagram.DiagramContext.renderGroup(a,i,d):t.datavisualization.Diagram.DiagramContext.renderNode(a,i,d),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(i,a)}},updateparent:function(e,t){var i=e;if(t)for(;i&&i.parent;)if(i=t.nameTable[i.parent],i&&i.isLane)return i;return!1},_updateCollectionChange:function(e,i,a,n){var o,s,r,l,n,d;e._diagramClear||(r=!0,i&&(l=t.datavisualization.Diagram.Util.bounds(i),o={x:l.x,y:l.y},i.container&&("canvas"===i.container.type?i._isBpmn?(n=this.updateparent(i,e),n?t.datavisualization.Diagram.canvasHelper._updateCollectionChange(e,i):t.datavisualization.Diagram.bpmnHelper.updateCanvas(i,e)):t.datavisualization.Diagram.canvasHelper._updateCollectionChange(e,i):t.datavisualization.Diagram.stackHelper._updateCollectionChange(e,i,null,n)),(a&&!i.isLane&&!i._isBpmn||i.isSwimlane)&&(e._disableSwimlaneUptate&&(r=!1),d=t.datavisualization.Diagram.Util.bounds(i),s={x:d.x,y:d.y},e._translate(i,o.x-s.x,o.y-s.y,e.nameTable),r&&t.datavisualization.Diagram.DiagramContext.update(i,e))),!i||!i.container||i.isLane||i.isSwimlane||i.isLaneStack||i.isPhaseStack||t.datavisualization.Diagram.DiagramContext.update(i,e))}},t.datavisualization.Diagram.stackHelper={_initStack:function(e,i){return i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(e,i),i=this._initChildren(e,i),this._setSize(e,i),this._alignChildren(e,i),i},_initGroupNode:function(e,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(e,i)},_initChildren:function(e,i){return t.datavisualization.Diagram.containerCommon._initChildren(e,i)},_setSize:function(e,t){var i=this._getStackBoundsBounds(e,t);i.width>=t.minWidth&&i.width<=t.maxWidth?t.width=i.width:i.width<=t.minWidth?t.width=t.minWidth:i.width>=t.maxWidth&&(t.width=t.maxWidth),i.height>=t.minHeight&&i.height<=t.maxHeight?t.height=i.height:i.height<=t.minHeight?t.height=t.minHeight:i.height>=t.maxHeight&&(t.height=t.maxHeight)},_getStackBoundsBounds:function(e,i){var a,n,o,s,r=t.datavisualization.Diagram.Rectangle(),l=0,d=0,h=0,c=0,u=i.container.orientation?i.container.orientation:"vertical";if(i.children&&i.children.length>0)for(s=i.children,a=0;a<s.length;a++)n="string"==typeof s[a]?e.nameTable[s[a]]:s[a],n&&(o=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Geometry.rect([o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]),o&&("vertical"===u?(d=o.width+=n.marginLeft+n.marginRight,d>h&&(h=o.width=d),o.width="stretch"===n.horizontalAlign&&o.width>n.minWidth?o.width:h,o.height+=n.marginTop+n.marginBottom,o.height+=r.height):(l=o.height+=n.marginTop+n.marginBottom,l>c&&(c=o.height=l),o.height="stretch"===n.verticalAlign&&o.height>n.minHeight?o.height:c,o.width+=n.marginLeft+n.marginRight,o.width+=r.width),o.x=0,o.y=0),r=e._union(r,o));return r.width+=i.paddingLeft+i.paddingRight,r.height+=i.paddingTop+i.paddingBottom,r},_alignChildren:function(e,t){for(var i,a,n=0,o=0,s=t.children,r=0;r<s.length;r++)a="string"==typeof s[r]?e.nameTable[s[r]]:s[r],a&&(i=this._getStackPosition(e,a,t,n,o),this._translate(e,a,i.x,i.y),"vertical"==t.container.orientation?o+=(a.height?a.height:a._height)+a.marginTop+a.marginBottom:n+=(a.width?a.width:a._width)+a.marginLeft+a.marginRight)},_getStackPosition:function(e,i,a,n,o){var s,r,l=0,d=0,h=t.datavisualization.Diagram.Util.bounds(a),c=t.datavisualization.Diagram.Util.bounds(i),u=(a.container.orientation?a.container.orientation:"vertical",i.width?i.width:i._width),g=i.height?i.height:i._height;if("vertical"==a.container.orientation)switch(d=h.y-c.y+o+i.marginTop+a.paddingTop,i.horizontalAlign){case"left":l=h.x-c.x+i.marginLeft+a.paddingLeft;break;case"center":l=h.center.x-c.center.x;break;case"right":l=h.x+h.width-(c.x+c.width+a.paddingRight);break;case"stretch":s=(a.width-(a.paddingLeft+a.paddingRight)-(i.marginLeft+i.marginRight))/u,e.scale(i,s,1,a.pivot,e.nameTable),h=t.datavisualization.Diagram.Util.bounds(a),c=t.datavisualization.Diagram.Util.bounds(i,e),l=h.x+a.paddingLeft+i.marginLeft-c.x}else switch(l=h.x-c.x+n+i.marginLeft+a.paddingLeft,i.verticalAlign){case"top":d=h.y-c.y+i.marginTop+a.paddingTop;break;case"center":d=h.center.y-c.center.y;break;case"bottom":d=h.y+h.height-(c.y+c.height+a.paddingBottom);break;case"stretch":r=(a.height-(a.paddingTop+a.paddingBottom)-(i.marginTop+i.marginBottom))/g,e.scale(i,1,r,a.pivot,e.nameTable),h=t.datavisualization.Diagram.Util.bounds(a),c=t.datavisualization.Diagram.Util.bounds(i,e),d=h.y+a.paddingTop+i.marginTop-c.y}return{x:l,y:d}},_translate:function(e,i,a,n){var o,s,r;if(a||n)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,a,n,i);else{if(i.offsetX+=a,i.offsetY+=n,"group"===i._type||"pseudoGroup"===i.type||"umlclassifier"==i.type)for(o=i.children,r=0;o&&r<o.length;r++)s=e.nameTable[e._getChild(o[r])],s&&this._translate(e,s,a,n);t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,a,n,null,e)}},_updateCollectionChange:function(e,i,a,n){if(this._setSize(e,i),this._alignChildren(e,i),i.parent){var o=e.nameTable[i.parent];o||n&&i.isPhaseStack&&(o=n),o&&o.container&&!a&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,o)}}},t.datavisualization.Diagram.canvasHelper={_initCanvas:function(e,i){return i._type="group",i.type||(i.type="group"),i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(e,i),i=this._initChildren(e,i),this._setSize(e,i),this._alignChildren(e,i),i},_initGroupNode:function(e,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(e,i)},_initChildren:function(e,i){return t.datavisualization.Diagram.containerCommon._initChildren(e,i)},_setSize:function(i,a,n,o){var s,r,l,d=this._getCanvasBounds(i,a,o),h=t.datavisualization.Diagram.Util.bounds(a);if(h=t.datavisualization.Diagram.Geometry.rect([h.topLeft,h.topRight,h.bottomRight,h.bottomLeft]),d.width>=a.minWidth&&d.width<=a.maxWidth?d.width=d.width:d.width<=a.minWidth?d.width=a.minWidth:d.width>=a.maxWidth&&(d.width=a.maxWidth),d.height>=a.minHeight&&d.height<=a.maxHeight?d.height=d.height:d.height<=a.minHeight?d.height=a.minHeight:d.height>=a.maxHeight&&(d.height=a.maxHeight),n){var c=d.width/h.width,u=d.height/h.height,g=d.x+d.width/2-(h.x+h.width/2),m=d.y+d.height/2-(h.y+h.height/2),p=t.datavisualization.Diagram.Point(a.offsetX,a.offsetY);if(i._translate(a,g,m,i.nameTable,!0),i.scale(a,c,u,t.datavisualization.Diagram.Point(a.offsetX,a.offsetY),i.nameTable),a._isBpmn){for(s=i._getChildren(a.children),r=0;r<s.length;r++)l=i.nameTable[s[r]],l&&l._isInternalShape&&t.datavisualization.Diagram.Util.canResize(l)&&(l=e.extend(!0,l,{offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}));t.datavisualization.Diagram.Util._updateBPMNProperties(a,i,i.nameTable,!0)}t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(a,1/c,1/u,p,i)}else a.width=d.width,a.height=d.height},_alignChildren:function(i,a){for(var n,o,s=!0,r=a.children,l=0;l<r.length;l++)o="string"==typeof r[l]?i.nameTable[r[l]]:r[l],o&&!o._isInternalShape&&(i._disablePhaseUpdate&&o.isPhaseStack&&(s=!1),s&&(n=this._getCanvasPosition(i,o,a),this._translate(i,o,n.x,n.y))),o&&o._isInternalShape&&t.datavisualization.Diagram.Util.canResize(o)&&(o=e.extend(!0,o,{offsetX:a.offsetX,offsetY:a.offsetY,width:a.width,height:a.height}),t.datavisualization.Diagram.Util._updateBPMNProperties(a,i,i.nameTable,!0))},_translate:function(e,i,a,n){var o,s,r;if(a||n)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,a,n,i);else{if(i.offsetX+=a,i.offsetY+=n,"group"===i._type||"pseudoGroup"===i.type)for(o=i.children,r=0;r<o.length;r++)s=e.nameTable[e._getChild(o[r])],s&&(this._translate(e,s,a,n),e._updateQuad(s));t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,a,n,null,e)}},_getCanvasPosition:function(e,i,a){var n,o,s=0,r=0,l=t.datavisualization.Diagram.Util.bounds(a),d=t.datavisualization.Diagram.Util.bounds(i);switch(i.horizontalAlign){case"left":s=l.x-d.x+i.marginLeft+a.paddingLeft;break;case"center":s=l.x+l.width/2-(d.x+d.width/2)+i.marginLeft+a.paddingLeft;break;case"right":s=l.x+l.width-i.marginRight-(d.x+d.width+a.paddingRight);break;case"stretch":n=(l.width-a.paddingLeft-a.paddingRight-i.marginLeft-i.marginRight)/i.width,e.scale(i,n,0,a.pivot,e.nameTable),d=t.datavisualization.Diagram.Util.bounds(i,e),s=l.x+a.paddingLeft-d.x+i.marginLeft}switch(i.verticalAlign){case"top":r=l.y-d.y+i.marginTop+a.paddingTop;break;case"center":r=l.y+l.height/2-(d.y+d.height/2)+i.marginTop+a.paddingTop;break;case"bottom":r=l.y+l.height-i.marginBottom-(d.y+d.height+a.paddingBottom);break;case"stretch":o=(l.height-a.paddingTop-a.paddingBottom-i.marginTop-i.marginBottom)/i.height,e.scale(i,0,o,a.pivot,e.nameTable),d=t.datavisualization.Diagram.Util.bounds(i,e),r=l.y+a.paddingTop-d.y+i.marginTop}return{x:s,y:r}},_getCanvasBounds:function(e,i,a){var n,o,s,r,l,d,h,c=t.datavisualization.Diagram.Rectangle(),u=0;if(i.children&&i.children.length>0)for(h=i.children;u<h.length;u++)n="string"==typeof h[u]?e.nameTable[h[u]]:h[u],n&&!n._isInternalShape&&(o=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Geometry.rect([o.topLeft,o.topRight,o.bottomRight,o.bottomLeft]),"stretch"===n.horizontalAlign&&(o.width=o.width>=i.minWidth?o.width:1,(i.isLane||i.isSwimlane)&&0==u&&(o.width=1)),"stretch"===n.verticalAlign&&(o.height=o.height>=i.minHeight?o.height:1,i.isLane&&0==u&&(o.height=1)),o&&(l=n.marginLeft>0?o.x-n.marginLeft:o.x,d=n.marginTop>0?o.y-n.marginTop:o.y,s=void 0==s?l:Math.min(s,l),r=void 0==r?d:Math.min(r,d),o.width+=n.marginLeft+(a?0:n.marginRight),o.height+=n.marginTop+(a?0:n.marginBottom),o.x=0,o.y=0,"bpmn"==i.type&&(n.marginLeft<0&&(o.width-=n.marginLeft),n.marginTop<0&&(o.height-=n.marginTop))),c=t.datavisualization.Diagram.Geometry.union(c,o));return"bpmn"==i.type&&t.datavisualization.Diagram.Geometry.isEmptyRect(c)?(c=t.datavisualization.Diagram.Util.bounds(i),c=t.datavisualization.Diagram.Geometry.rect([c.topLeft,c.topRight,c.bottomRight,c.bottomLeft])):(c.width+=i.paddingLeft+i.paddingRight,c.height+=i.paddingTop+i.paddingBottom,c.x=s-i.paddingLeft,c.y=r-i.paddingTop),c},_updateCollectionChange:function(e,i){var a,n=!1;"resize"===e.activeTool.name&&i.container&&(n=!0),this._setSize(e,i,null,n),this._alignChildren(e,i),i.parent&&(a=e.nameTable[i.parent],a&&a.container&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a))},_getSwimlane:function(e,t){var i,a,n=e.nameTable[e._getChild(t)];return n&&n.isLane&&(i=e.nameTable[n.parent],i&&(a=e.nameTable[i.parent]))?e.getNode(a.name):void 0},_laneConnectors:function(e,t,i){var a,n,t,o;if(t&&t.isLane)for(n=0;n<t.children.length;n++)if(o=e.nameTable[e._getChild(t.children[n])]){if(o.inEdges&&o.inEdges.length>0)for(a=0;a<t.children.length;a++)e._collectionContains(o.inEdges[a],i)||i.push(o.inEdges[a]);if(o.outEdges&&o.outEdges.length>0)for(a=0;a<t.children.length;a++)e._collectionContains(o.outEdges[a],i)||i.push(o.outEdges[a])}},_connectorRelateTolaneCollection:function(e,t,i){if(t){var a,n,o,s,r;if(s=t.sourceNode?e.nameTable[t.sourceNode]:null,o=t.targetNode?e.nameTable[t.targetNode]:null,s&&s.parent&&(a=e.nameTable[s.parent]),o&&o.parent&&(n=e.nameTable[o.parent]),a&&n&&n.name===a.name)return!1;for(r=0;r<i.length;r++)if(a&&a.name===i[r]||n&&n.name===i[r])return!0}return!1},_recreateConnectorSegments:function(e,i,a,n,o){if(e&&i){var s,r,l,d,h,c,u=[],g=[];if(i=e.nameTable[e._getChild(i)],(i&&i.isLane||i.isSwimlane)&&i.isLane&&Array.isArray(a)){for(c=this._getIntermediateLanes(e,a,n,o),l=0;l<c.length;l++)d=e.nameTable[e._getChild(c[l])],this._laneConnectors(e,d,u);for(s=this._getSwimlane(e,i.name),h=s.lanes,l=0;l<h.length;l++)d=e.nameTable[e._getChild(h[l])],this._laneConnectors(e,d,g);for(l=0;l<u.length;l++)r=e.nameTable[e._getChild(u[l])],r&&this._connectorRelateTolaneCollection(e,r,[n,o])&&(r.segments=[],t.datavisualization.Diagram.Util._initializeSegments(r,"orthogonal"));for(l=0;l<g.length;l++)r=e.nameTable[e._getChild(g[l])],r&&this._updateConnectorEndPoints(e,r)}}},_isLineInterSectingNode:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f=!1;if(i&&a&&(n=t.datavisualization.Diagram.Util.bounds(a),o=[{x:n.topLeft.x,y:n.topLeft.y},{x:n.topRight.x,y:n.topRight.y},{x:n.bottomRight.x,y:n.bottomRight.y},{x:n.bottomLeft.x,y:n.bottomLeft.y},{x:n.topLeft.x,y:n.topLeft.y}]),s=i.segments,s&&s.length>0)for(r=0;!f&&r<s.length;r++)if(l=s[r],l&&l.points.length>0)for(d=l.points,m=0;!f&&m<d.length-1;m++)for(h=d[m],c=d[m+1],p=0;!f&&p<o.length-1;p++)if(u=o[p],g=o[p+1],this._isInterSecting(h.x,h.y,c.x,c.y,u.x,u.y,g.x,g.y,!0)){f=!0;break}return f},_updateConnectorEndPoints:function(e,i){var a,n,o;e&&i&&(a=!1,i.sourcePoint=t.datavisualization.Diagram.Point(),i.targetPoint=t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initConnectionEnds(i,e),t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),e._dock(i,e.nameTable),i.sourceNode&&(n=e.nameTable[i.sourceNode]),n&&this._isLineInterSectingNode(e,i,n)&&(a=!0),i.targetNode&&(o=e.nameTable[i.targetNode]),o&&this._isLineInterSectingNode(e,i,o)&&(a=!this._anySegmentOrtho(i)),a&&(i.segments=[],t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),e._dock(i,e.nameTable)),t.datavisualization.Diagram.Util._initializeSegments(i,"orthogonal"),e._dock(i,e.nameTable))},_anySegmentOrtho:function(e){var t,i,a=!1;if(e&&e.segments&&e.segments.length>0)for(i=0;i<e.segments.length;i++)if(t=e.segments[i],t&&"orthogonal"!==t.type){a=!0;break}return a},_getIntermediateLanes:function(e,t,i,a){var n,o=[];if(t){var s=t.indexOf(i),r=t.indexOf(a),l=Math.min(s,r),d=Math.max(s,r);for(n=l;d>=n;n++)o.push(t[n])}return o},_swapLane:function(i,a,n,o,s,r){var l,d,h=i.nameTable[o],c=a.slice(),u=i.tools.move,g=this._getSwimlane(i,n);if(u._undoObject=e.extend(!0,{},{name1:n,name2:o}),h){var m=t.datavisualization.Diagram.Util.bounds(h),p=a.indexOf(n),f=a.indexOf(o);a.splice(a.indexOf(n),1),f+=p>f?0:-1,f+=s?u.currentPoint.y>=m.y&&u.currentPoint.y<m.center.y?0:1:u.currentPoint.x>=m.x&&u.currentPoint.x<m.center.x?0:1,a.splice(f,0,n)}u._redoObject=e.extend(!0,{},{name1:o,name2:n}),l={type:"swapLane",undoObject:jQuery.extend(!0,{},u._undoObject),redoObject:jQuery.extend(!0,{},u._redoObject),currentIndex:p,moveIndex:f,category:"internal"},d=this._getSwimlane(i,n),g&&i._comparePropertyValues(d,"lanes",{lanes:g.lanes},!0),i.addHistoryEntry(l),u._multipleUndo=!0,r&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,r,!1),i.activeTool.selectedObject&&(t.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(i,i.activeTool.selectedObject.name,c,n,o),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(i,i.activeTool.selectedObject))},_updateHelper:function(e){e.activeTool.helper?(this._updateHelperXY(e,e.activeTool.helper,e.activeTool.previousPoint,e.activeTool.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(e)):this._initHelper(e)},_updateHelperXY:function(e,i,a,n){var o,s,r=n.x<a.x,l=n.y<a.y,d=e.activeTool.diffx+(n.x-a.x),h=e.activeTool.diffy+(n.y-a.y),c=e.activeTool.diagram._enableSnapToObject();e.activeTool.diagram._enableSnapToObject(!0),o=t.datavisualization.Diagram.SnapUtil._snapPoint(e,e.activeTool.helper,r,l,t.datavisualization.Diagram.Point(d,h),n,a),e.activeTool.diagram._enableSnapToObject(c),o||(o=t.datavisualization.Diagram.Point(d,h)),e.activeTool.diffx=d-o.x,e.activeTool.diffy=h-o.y,t.datavisualization.Diagram.Geometry.isEmptyPoint(o)||(s=e.activeTool._raiseDragEvent({element:e.getNode(e.activeTool.helper),offset:o,cancel:!1}),s&&!s.cancel&&(e.activeTool._outOfBoundsDrag(i,o.x,o.y)&&e._translate(i,o.x,o.y,e.nameTable),"group"===i._type&&t.datavisualization.Diagram.Util._updateGroupBounds(i,e)))},_initHelper:function(e){e.activeTool.helper=this._getCloneNode(e.activeTool.selectedObject),e.activeTool.helper._name=e.activeTool.selectedObject.name,e.activeTool.helper.name="helper",e.activeTool.startPoint=e.activeTool.currentPoint,t.datavisualization.Diagram.SvgContext._drawContainerHelper(e)},_getCloneNode:function(e){var t=null;return t=jQuery.extend(!0,{},e),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},_updateHighlighter:function(e,t){var i=e.activeTool._getMouseOverElement(t);!i||i.segments||e.activeTool.selectedObject.isLane&&!i.isLane?e.activeTool._removeHighLighter():e.activeTool._nodeHighLighter(i,t)},_updateNodeMargin:function(i,a,n){var o,s,r,l,d;if("group"==a._type)for(o=0;o<a.children.length;o++)s=a.children[o],this._updateNodeMargin(i,"string"==typeof s?i.nameTable[s]:s,a);if(a&&n){var h=e.extend(!1,{},a),c=t.datavisualization.Diagram.Util.bounds(a),u=t.datavisualization.Diagram.Util.bounds(n),g=!(!n.container||!n.container.type||"stack"!=n.container.type);g?"horizontal"===n.container.orientation?a.marginTop=c.top-u.top-n.paddingTop:a.marginLeft=c.left-u.left-n.paddingLeft:(a.marginLeft=c.left-u.left-n.paddingLeft,a.marginTop=c.top-u.top-n.paddingTop);var m=c.right-c.left,p=c.bottom-c.top,f=u.x+u.width-(c.x+m)-n.paddingRight;a.marginRight=0>f?0:f,r=u.y+u.height-(c.y+p)-n.paddingBottom,a.marginBottom=0>r?0:r,n.isLane&&(l=0,d=0,"horizontal"===n.orientation?(l=50,d=0):(l=0,d=50),a.marginLeft=a.marginLeft>=l?a.marginLeft:l,a.marginTop=a.marginTop>=d?a.marginTop:d,i._comparePropertyValues(a,"marginLeft",{marginLeft:h.marginLeft},!0),i._comparePropertyValues(a,"marginRight",{marginLeft:h.marginRight},!0),i._comparePropertyValues(a,"marginBottom",{marginLeft:h.marginBottom},!0),i._comparePropertyValues(a,"marginRight",{marginLeft:h.marginRight},!0))}},_singleNodedrag:function(i,a,n){var o,s,r,l,d,h=!i.activeTool._checkForDropEvent(n);if(h)if(n){if((t.datavisualization.Diagram.Util.canAllowDrop(n)||n.name==i.activeTool.selectedObject.parent)&&n.container&&"canvas"==n.container.type)if(s=!(n._isBpmn&&(!n._isBpmn||i.activeTool.selectedObject.parent==n.name)),t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(i,i.activeTool.helper,n)&&s)(n.isLane||"canvas"==n.container.type)&&this._disableConnectorUpdate(i),i.activeTool.seletedObject=i.nameTable[i.activeTool.selectedObject.name],i.activeTool.selectedObject.parent&&(o=i.nameTable[i.activeTool.selectedObject.parent]),i._disablePhaseUpdate=!0,i._disableSwimlaneUptate=!0,this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,n,null,!0),r=i._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,i._raiseGroupChangeEvent(i.activeTool.selectedObject,o,n,r),i._comparePropertyValues(i.activeTool.selectedObject,"parent",{parent:o.name},!0),delete i._disablePhaseUpdate,delete i._disableSwimlaneUptate,this._updateLastSwimlanePhase(i,i.activeTool.selectedObject),(n.isLane||"canvas"==n.container.type)&&this._enableConnectorUpdateNode(i,i.activeTool.selectedObject);else if(n._isBpmn){var c=i.nameTable[i.activeTool.selectedObject.parent];c.width,c.height,{x:c.offsetX,y:c.offsetY};i._translate(i.activeTool.selectedObject,i.activeTool.helper.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.helper.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable),l=t.datavisualization.Diagram.ContainerHelper.updateparent(n,i),l?(this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,n,null,!0)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(c,i)}else i._translate(i.activeTool.selectedObject,i.activeTool.undoObject.node.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.undoObject.node.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable),this._updateLastSwimlanePhase(i,n)}else d=e.extend(!0,{},i.activeTool.selectedObject),"pseudoGroup"!=i.activeTool.selectedObject.type&&this._disableConnectorUpdate(i),i.activeTool.selectedObject.parent&&(o=i.nameTable[i.activeTool.selectedObject.parent]),this._removeNodeFromContainer(i,i.activeTool.selectedObject),i._raiseGroupChangeEvent(i.activeTool.selectedObject,o,null,"group"),this._addMultiNodeToDiagram(i,i.activeTool.selectedObject),this._enableConnectorUpdateNode(i,d),i._updateAssociatedConnectorEnds(d,i.nameTable);return!0},_updateLastSwimlanePhase:function(e,i){var a,n,o=t.datavisualization.Diagram.ContainerHelper.updateparent(i,e);o&&o.isLane&&(a=e.nameTable[o.parent],a&&(n=e.nameTable[a.parent],n&&this._updateLastPhase(e,n)))},_updateLastPhase:function(e,i){var a,n;if(i&&i.isSwimlane){var o,s=e.nameTable[e._getChild(i.children[2])],r=e.nameTable[e._getChild(i.children[1])],l=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(e,s),d=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(e,r),h=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(e,i),c=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(e,i);o=e.nameTable[e._getChild(c[0])],h.length>0&&(a=e.nameTable[h[h.length-1]],
a&&("horizontal"===i.orientation?(n=l.width-d.width,a.width+=n,a.offset+=n,o&&o.isLane&&(o.minWidth+=n)):(n=l.height-d.height,a.height+=n,a.offset+=n,o&&o.isLane&&(o.minHeight+=n))),t.datavisualization.Diagram.SwimLaneContainerHelper._updatePhaseStack(e,i))}},_disableConnectorUpdate:function(e){e._disableSegmentChange=!0},_enableConnectorUpdate:function(e,t,i){delete e._disableSegmentChange,t&&(e._updateChildAdjacentConnectors(t,!0),i||(e._disableSegmentChange=!0,this._updateSwimalneAssociatedConnectors(e,t,e._svg),delete e._disableSegmentChange),this._updateChildAdjacentConnectors(e,t))},_updateChildAdjacentConnectors:function(e,i){var a,n,o=e._getChildTable(i,{});for(a in o)n=e.nameTable[e._getChild(a)],n&&n.segments&&-1==i.children.indexOf(a)&&t.datavisualization.Diagram.DiagramContext.update(n,e)},_updateSwimalneAssociatedConnectors:function(e,i,a,n){var o,s,r,l=e._getChildren(i.children);if(l&&l.length>0)for(o=0,s=l.length;s>o;o++)r=e.nameTable[l[o]],r&&("group"===r._type?this._updateSwimalneAssociatedConnectors(e,r,a,n):this._updateSwimalneAssociatedConnectors(e,r,a,n));"group"!=i.type&&t.datavisualization.Diagram.SvgContext._updateAssociatedConnector(i,a,e)},_enableConnectorUpdateNode:function(e,t){var i,a=null;t&&t.parent&&(a=e.nameTable[t.parent]),a&&(a.isLane?(i=e.nameTable[a.parent.split("laneStack")[0]],i&&i.isSwimlane&&this._enableConnectorUpdate(e,i)):"bpmn"==a.type?this._enableConnectorUpdate(e,a):a.container&&"canvas"===a.container.type&&this._enableConnectorUpdate(e,a))},_enableConnectorUpdatePhase:function(e,t){if(t&&(t.isPhase||"phase"===t.type)){var i=e.nameTable[t.parent.split("phaseStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(e,i)}},_enableConnectorUpdateLane:function(e,t){if(t&&t.isLane){var i=e.nameTable[t.parent.split("laneStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(e,i)}},_outOfBoundaryMultiNodeDrop:function(e,i){var a,n,o,s,r;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(e)&&i&&"pseudoGroup"===i.type)for(s=i.children,r=0;r<s.length;r++)if(a=e.nameTable[e._getChild(s[r])],n=this._getTargets(e,a),n&&n.length>0&&!a.segments&&(o=this._getContainerFromTarget(e,n,a),o&&!this._isExeedBounds(e,a,o)))return!1;return!0},_multiNodedrag:function(e,i,a){var n,o,s,r,l,d,h,c,u;if(this._outOfBoundaryMultiNodeDrop(e,a)){if(a){if(e._disableSwimlaneUptate=!0,this._disableConnectorUpdate(e),a.children.length>0)for(r=a.children,l=0;l<r.length;l++)n=e.nameTable[e._getChild(r[l])],!n||"connector"===n.type||n.segments||(o=this._getTargets(e,n),o&&o.length>0?(s=this._getContainerFromTarget(e,o,n),s?this._addNodeToContainer(e,n,s):this._addMultiNodeToDiagram(e,n)):this._addMultiNodeToDiagram(e,n)),n.parent&&(d=e.nameTable[n.parent],d&&d.isLane&&(h=e.nameTable[d.parent.split("laneStack")[0]],h&&(e._updateSwimlanes||(e._updateSwimlanes=[]),e._collectionContains(h.name,e._updateSwimlanes)||e._updateSwimlanes.push(h.name))));if(delete e._disableSwimlaneUptate,e._updateSwimlanes&&e._updateSwimlanes.length>0)for(c=0;c<e._updateSwimlanes.length;c++)t.datavisualization.Diagram.DiagramContext.update(e.nameTable[e._updateSwimlanes[c]],e),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(e,e.nameTable[e._updateSwimlanes[c]]);else delete e._disableSegmentChange;delete e._updateSwimlanes,this._getRedoObject(e,a),u={type:"positionchanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},e.activeTool._undoObject),redoObject:jQuery.extend(!0,{},e.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},e.addHistoryEntry(u),e.activeTool._multipleUndo=!0,t.datavisualization.Diagram.Util._updateGroupBounds(a,e),e.updateSelection()}}else this._updateBoundsExceedNodes(e,a,"move")},_updateBoundsExceedNodes:function(e,i,a){var n,o,s,r,l,d=e.tools[a].undoObject,h=i.children;for(i.rotateAngle=d.node.rotateAngle,n=0;n<h.length;n++)o=d.childTable[h[n]],s=e.nameTable[e._getChild(h[n])],o&&s&&("move"===a?e._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,e.nameTable):"resize"===a?(e._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,e.nameTable),e.scale(s,o.width/s.width,o.height/s.height,t.datavisualization.Diagram.Point(s.offsetX,s.offsetY),e.nameTable)):"rotate"===a&&(e._translate(s,o.offsetX-s.offsetX,o.offsetY-s.offsetY,e.nameTable),r=o.rotateAngle-s.rotateAngle,s.rotateAngle+=r),"group"===s._type&&t.datavisualization.Diagram.Util._updateGroupBounds(s,e),e._updateAssociatedConnectorEnds(o,e.nameTable),o.parent&&(l=e.nameTable[o.parent],l&&l.children.length>0&&(l.children.push(o.name),s.parent=o.parent)),t.datavisualization.Diagram.DiagramContext.update(o,e));t.datavisualization.Diagram.Util._updateGroupBounds(i,e),e.updateSelection()},_getContainerFromTarget:function(e,i,a){for(var n,o,s=0;s<i.length;s++)if(i[s].container&&"canvas"===i[s].container.type&&(n=t.datavisualization.Diagram.Util.bounds(a),o=t.datavisualization.Diagram.Util.bounds(i[s]),n.center.x>o.left&&n.center.x<o.right&&n.center.y>o.top&&n.center.y<o.bottom))return i[s]},_getTargets:function(e,i){var a,n,o,s,r,l,d,h,c,u=null,g=[];if(i)for(a=t.datavisualization.Diagram.Util.bounds(i),o=t.datavisualization.Diagram.SpatialUtil.findQuads(e._spatialSearch,a),s=0;s<o.length;s++)if(r=o[s],r.objects.length>0)for(l=0;l<r.objects.length;l++)if(d=r.objects[l],!d.segments&&d.visible&&(u=t.datavisualization.Diagram.Util.bounds(d),-1==g.indexOf(d)&&t.datavisualization.Diagram.Geometry.intersectsRect(a,u)))if(d.isSwimlane){h=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(e,d);for(c in h)n=e.nameTable[e._getChild(h[c])],n&&g.splice(0,0,n)}else g.push(d);return g},_removeFromParentContainer:function(e,t){this._removeNodeFromContainer(e,t)},_removeNodeFromContainer:function(e,i,a){var n,o,s,r,l,d;if(e._removedFromContiner=!0,"pseudoGroup"!==i.type){if(d=e.nameTable[i.parent]){for(s=d.children,n=s,n=n.slice(0),r=0;r<s.length;r++)l=e.nameTable[e._getChild(s[r])],l.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(d.children,s[r]);t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(e._spatialSearch,e._spatialSearch.quadTable[l.name],l),o={element:d,cause:e.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:n,newValue:s},e._raisePropertyChange(o),e._comparePropertyValues(i,"parent",{parent:""},o.cause),i.parent="","group"===l._type?t.datavisualization.Diagram.SvgContext.renderGroup(l,e._svg,e._diagramLayer,e.nameTable,e):l.segments?t.datavisualization.Diagram.SvgContext.renderConnector(l,e._svg,e._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(l,e._svg,e._diagramLayer,void 0,e),a||t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,d,!0)}}else if(s=i.children,s.length>0){for(this._getUndoObject(e,i),r=0;r<s.length;r++)l=e.nameTable[e._getChild(s[r])],l&&this._removeNodeFromContainer(e,l,!0);l.parent&&(d=e.nameTable[l.parent]),d&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,d,!0)}},_addDrgaHistoryEntry:function(e,t){var i,a={},a=e._getChildTable(t,a);e.activeTool._multipleUndo=!0,i={type:"positionchanged",node:jQuery.extend(!0,{},t),childTable:a,category:"internal",swimlaneMultiSelection:!0},e.addHistoryEntry(i)},_cloneNode:function(t,i,a){var n,o,s;if(i){if(i=e.extend(!0,{},i),i.name+=a,i.parent+=a,i.children&&i.children.length>0)for(o=i.children,s=0;s<o.length;s++)n=t.nameTable[t._getChild(o[s])],n&&(i.children[s]=this._cloneNode(t,n,a));return i}},_isExeedBounds:function(e,i,a){var n,o,s,r,l,d,h;if(e._disableUpdateQuad=!0,i&&a&&a.isLane&&(n=e.nameTable[a.parent.split("laneStack")[0]])){if(o=t.datavisualization.Diagram.Util.randomId(),s=e._cloneSwimlaneObj(e._getNode(n.name),o),s=t.datavisualization.Diagram.ContainerHelper._initContainer(e,s),r=this._cloneNode(e,i,o),e.nameTable[r.name]=r,l=e.nameTable[a.name+o]){if(l.children.push(r.name),this._updateNodeMargin(e,r,e.nameTable[a.name+o]),e._disableSwimlaneUptate=!0,this._disableConnectorUpdate(e),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,l),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,s),delete e._disableSegmentChange,delete e._disableSwimlaneUptate,d=t.datavisualization.Diagram.Util.bounds(s),t.datavisualization.Diagram.containerCommon._removeObject(e,l),t.datavisualization.Diagram.containerCommon._removeObject(e,s),delete e._disableUpdateQuad,h=e.activeTool._getPageBounds(),d.bottom>h.height||d.right>h.width)return!1;l.children.pop(r.name)}e.nameTable[r.name]}return delete e._disableUpdateQuad,!0},_outOfBoundaryNodeDrop:function(e,i,a){return t.datavisualization.Diagram.Util.canMoveOutofBoundary(e)?this._isExeedBounds(e,i,a):!0},_getAssociatedConnectors:function(t,i,a){var n,a=a||[],o=0;if(i&&!i.segments){if(i.children&&i.children.length>0)for(o=0;o<i.children.length;o++)this._getAssociatedConnectors(t,t.nameTable[t._getChild(i.children[o])],a);for(o=0;o<i.inEdges.length;o++)n=t.nameTable[t._getChild(i.inEdges[o])],n&&a.push(e.extend(!0,{},n));for(o=0;o<i.outEdges.length;o++)n=t.nameTable[t._getChild(i.outEdges[o])],n&&a.push(e.extend(!0,{},n))}return a},_addNodeToContainer:function(i,a,n,o,s){var r,l,d,h,c,u,g,m,p,f,v,_,y,b,x;if("connector"!==i.getObjectType(a)&&a&&n&&!a.isPhase)if(a.parent&&(r=i.nameTable[a.parent],r.container||(l=r.children,t.datavisualization.Diagram.Util.removeFromCollection(i,l,a),t.datavisualization.Diagram.Util._updateGroupBounds(r,i))),"pseudoGroup"!==a.type){var D=t.datavisualization.Diagram.Util.bounds(i.activeTool.helper),C=t.datavisualization.Diagram.Util.bounds(i.activeTool.selectedObject),w=i.activeTool.helper?D.x-C.x:0,z=i.activeTool.helper?D.y-C.y:0;if(i._raiseOffsetPropertyChange(a,a.offsetX+w,a.offsetY+z,!0),i._translate(a,w,z,i.activeTool.diagram.nameTable),d=n.children,d=d.slice(0),n.children.push(a),t.datavisualization.Diagram.Util.removeItem(i.nodes(),a),h={element:n,cause:i.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:d,newValue:n.children},i._raisePropertyChange(h),i._comparePropertyValues(a,"parent",{parent:n.name},h.cause),a.parent=n.name,this._updateNodeMargin(i,a,n),i._isDragg&&(c=i._historyList,c&&c.currentEntry&&c.currentEntry.object&&""===c.currentEntry.object.parent&&(c.currentEntry.object=e.extend(!0,{},a))),u=i._svg.getElementById(n.name),"group"===a._type?t.datavisualization.Diagram.DiagramContext.renderGroup(a,i,u):a.segments||t.datavisualization.Diagram.DiagramContext.renderNode(a,i,u),this._disableConnectorUpdate(i),o||("bpmn"==n.type&&(g=e.extend(!0,{},{node:n})),m=jQuery.extend(!0,{},n),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,n,!0),this._updateAddRemoveNodeConnectors(i,n,m),"bpmn"==n.type&&(i._isGroupActionEnabled=!0,i._startGroupAction(),p={type:"sizechanged",node:jQuery.extend(!0,{},n),undoObject:g,redoObject:e.extend(!0,{},{node:n}),category:"internal"},i.addHistoryEntry(p))),f=this._getAssociatedConnectors(i,a),f.length>0)for(y=0;y<f.length;y++)v=i._svg.getElementById(f[y].name),i._removeElement(f[y]),this._zOrder++,f[y].zOrder=this._zOrder,t.datavisualization.Diagram.DiagramContext.renderConnector(f[y],i);this._updateLastSwimlanePhase(i,a),s||this._enableConnectorUpdateNode(i,a),i._findLabelEditing&&n.children.splice(n.children.indexOf(a.name),1)}else if(_=a.children,_.length>0){for(y=0;y<_.length;y++)b=i.nameTable[i._getChild(_[y])],b&&this._addNodeToContainer(i,b,n,!0);b&&b.parent&&(x=i.nameTable[b.parent]),x&&(t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,x,!0),t.datavisualization.Diagram.Util._updateGroupBounds(a,i),t.datavisualization.Diagram.SvgContext.updateSelector(a,i._adornerSvg,i._currZoom,i,i.model.selectedItems.constraints))}},_addMultiNodeToDiagram:function(e,i){var a,n,o;if(e.activeTool.helper){var s=t.datavisualization.Diagram.Util.bounds(e.activeTool.helper),r=t.datavisualization.Diagram.Util.bounds(i),l=e.activeTool.helper?s.x-r.x:0,d=e.activeTool.helper?s.y-r.y:0;e._translate(i,l,d,e.nameTable)}for(a=e.nodes(),n=a.length-1;n>=0;n--)o=e.nameTable[e._getChild(a[n])],i.name===o.name&&t.datavisualization.Diagram.Util.removeItem(a,a[n]);e.nodes().push(i),e._removedFromContiner&&("group"===i._type?t.datavisualization.Diagram.SvgContext.renderGroup(i,e._svg,e._diagramLayer,e.nameTable,e):i.segments?t.datavisualization.Diagram.SvgContext.renderConnector(i,e._svg,e._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(i,e._svg,e._diagramLayer,void 0,e)),delete e._removedFromContiner,e.activeTool.helper&&this._updateLastSwimlanePhase(e,e.activeTool.helper)},_singleNodeResize:function(e,t,i){e.activeTool.selectedObject&&this._resizeNode(e,i)},_resizeNode:function(e,i){var a;if(i){var n=(t.datavisualization.Diagram.Util.bounds(i),t.datavisualization.Diagram.Util.bounds(e.activeTool.helper),!0);i.isLane||(""==i.parent&&i._parent&&(i.parent=i._parent,delete i._parent,n=!1),i.segments||(i.parent&&(a=e.nameTable[i.parent]),a&&a.isLane&&this._disableConnectorUpdate(e),n&&e.activeTool._updateSize(i,e.activeTool.startPoint,e.activeTool.currentPoint),a&&(this._updateNodeMargin(e,i,a),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a,!0),this._updateLastSwimlanePhase(e,i)),this._enableConnectorUpdateNode(e,i)))}},_updateResizeHelper:function(e){var i,a;e.activeTool.helper?(i=t.datavisualization.Diagram.Util.bounds(e.activeTool.helper),e._resizeStack=!0,e.activeTool._updateSize(e.activeTool.helper,e.activeTool.previousPoint,e.activeTool.currentPoint,null,null,null,!0),delete e._resizeStack,a=t.datavisualization.Diagram.Util.bounds(e.activeTool.helper),e.activeTool.selectedObject.container&&!e.activeTool.helper._isBpmn&&e._translate(e.activeTool.helper,i.topLeft.x-a.topLeft.x,i.topLeft.y-a.topLeft.y,e.nameTable),t.datavisualization.Diagram.SvgContext._updateContainerHelper(e)):(e.activeTool.helper=e.activeTool._getCloneNode(e.activeTool.selectedObject),e.activeTool.helper.inEdges=e.activeTool.helper.outEdges=[],e.activeTool.helper.type=null,e.activeTool.helper.name="helper",t.datavisualization.Diagram.SvgContext._drawContainerHelper(e),e.activeTool._startPoint=e.activeTool.currentPoint,e._resizeStack=!0,e.activeTool._updateSize(e.activeTool.helper,e.activeTool.previousPoint,e.activeTool.currentPoint,null,null,null,!0),delete e._resizeStack)},_multiNodeResize:function(e,i,a){var n,o,s,r,l,d;if(a)if(this._outOfBoundaryMultiNodeDrop(e,a)){if(a.children.length>0)for(r=a.children,l=0;l<r.length;l++)n=e.nameTable[e._getChild(r[l])],o=this._getTargets(e,n),o&&o.length>0?(s=this._getContainerFromTarget(e,o,n),s?this._addNodeToContainer(e,n,s):this._addMultiNodeToDiagram(e,n)):this._addMultiNodeToDiagram(e,n);this._getRedoObject(e,a),d={type:"sizechanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},e.activeTool._undoObject),redoObject:jQuery.extend(!0,{},e.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},e.addHistoryEntry(d),e.activeTool._multipleUndo=!0,t.datavisualization.Diagram.Util._updateGroupBounds(a,e),e.updateSelection()}else this._updateBoundsExceedNodes(e,a,"resize")},_singleNodeRotate:function(e,t,i){e.activeTool.selectedObject&&this._rotateNode(e,i)},_rotateNode:function(e,i){var a,n,o,s;i&&(a=!0,i.container||(""==i.parent&&i._parent&&(i.parent=i._parent,delete i._parent,a=!1),i.parent&&(n=e.nameTable[i.parent]),n&&n.isLane&&this._disableConnectorUpdate(e),i.segments||(a&&(o=e.nameTable[e.activeTool.selectedObject.name],e.activeTool.helper&&(s=e.activeTool.helper.rotateAngle-e.nameTable[e.activeTool.selectedObject.name].rotateAngle,e._comparePropertyValues(i,"rotateAngle",{rotateAngle:e.activeTool.helper.rotateAngle},!0),e._rotate(e.activeTool.selectedObject,s,e.nameTable))),n&&(this._updateNodeMargin(e,i,n),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,n,!0),this._updateLastSwimlanePhase(e,i)),this._enableConnectorUpdateNode(e,i))))},_multiNodeRotate:function(e,i,a){var n,o,s,r,l,d;if(a)if(this._outOfBoundaryMultiNodeDrop(e,a)){if(a.children.length>0)for(r=a.children,l=0;l<r.length;l++)n=e.nameTable[e._getChild(r[l])],o=this._getTargets(e,n),o&&o.length>0?(s=this._getContainerFromTarget(e,o,n),s?this._addNodeToContainer(e,n,s):this._addMultiNodeToDiagram(e,n)):this._addMultiNodeToDiagram(e,n);this._getRedoObject(e,a),d={type:"rotationchanged",node:jQuery.extend(!0,{},a),undoObject:jQuery.extend(!0,{},e.activeTool._undoObject),redoObject:jQuery.extend(!0,{},e.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0},e.addHistoryEntry(d),e.activeTool._multipleUndo=!0,t.datavisualization.Diagram.Util._updateGroupBounds(a,e),e.updateSelection()}else this._updateBoundsExceedNodes(e,a,"rotate")},_updateDropLaneProperties:function(e,i,a){if(i&&a){i.orientation=a.orientation,i.horizontalAlign="horizontal"===a.orientation?"stretch":"left",i.verticalAlign="vertical"===a.orientation?"stretch":"top",i.paddingBottom=20,i.paddingTop=20,i.paddingLeft=20,i.paddingRight=20;var n=e.nameTable[e._getChild(i.children[0])];n&&(n.marginLeft=-20,n.marginTop=-20,n.marginRight=-20,n.marginBottom=-20,n.constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,n._isHeader=!0)}return i},_updateAddRemoveNodeConnectors:function(e,t,i){if(t&&t.isLane&&i&&i.isLane){var a=0,n=0;a=t.width-i.width,n=t.height-i.height,(a||n)&&this._updateOverlappedConnectorSegment(e,i,a,n)}},_updateAddRemoveLaneConnectors:function(e,t){if(t&&t.isLane){var i,a,n,o,t,s=[];for(a=this._getSwimlane(e,t.name),n=a.lanes,o=0;o<n.length;o++)t=e.nameTable[e._getChild(n[o])],this._laneConnectors(e,t,s);for(o=0;o<s.length;o++)i=e.nameTable[e._getChild(s[o])],i&&this._updateConnectorEndPoints(e,i)}},_outOfBoundaryAddLane:function(i,a,n,o){var s,r,l,d,h;return!(t.datavisualization.Diagram.Util.canMoveOutofBoundary(i)&&(s=i._cloneSwimlaneObj(i._getNode(a.name),t.datavisualization.Diagram.Util.randomId()),s=t.datavisualization.Diagram.ContainerHelper._initContainer(i,s),r=i.activeTool._cloneGroupNode(e.extend(!0,{},n),t.datavisualization.Diagram.Util.randomId()),i.nameTable[r.name]=r,l=i.nameTable[i._getChild(s.children[2])],o||0===o?l.children.splice(o,0,r.name):l.children.push(r.name),r.parent=l.name,i._disableSwimlaneUptate=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,r),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,s),this._enableConnectorUpdate(i,s),delete i._disableSwimlaneUptate,d=t.datavisualization.Diagram.Util.bounds(s),t.datavisualization.Diagram.containerCommon._removeObject(i,r),t.datavisualization.Diagram.containerCommon._removeObject(i,s),h=i.activeTool._getPageBounds(),d.bottom>h.height||d.right>h.width))},_addNewLane:function(e,i,a,n,o){var s,r,l,d,h,o,c,u,g,m,p,f;if(e.activeTool._removeHelpers(),r=e.nameTable[e._getChild(a.children[2])]){if(l=e.activeTool._cloneGroupNode(e.activeTool.selectedObject,n?"":t.datavisualization.Diagram.Util.randomId()),l=this._updateDropLaneProperties(e,l,a),d=e._isUndo,e._isUndo=!0,e.activeTool.selectedObject=null,e.remove(e.activeTool.selectedObject),e._isUndo=d,e._isUndo||this._outOfBoundaryAddLane(e,a,l,o)){if(h=!1,f={element:e.getNode(l),cancel:!1,target:i},i&&(o=void 0!==o?o:e.activeTool._getSwimLaneStackIndex(i)),o||0===o?r.children.splice(o,0,l):r.children.push(l),l.parent=r.name,e._isUndo||e._raiseDropEvent(f),e.remove(l),!f.cancel){if(e.activeTool._isLane=!0,l.isLane&&(c=e.nameTable[e._getChild(l.children[0])],c&&l.labels&&c.labels.length>0))for(u=0;u<c.labels.length;u++)c.labels[u].visible=!0;e._isUndo||(g=e._getChildTable(l,{}),m={type:"collectionchanged",object:jQuery.extend(!0,{},l),childTable:jQuery.extend(!0,{},g),index:o,changeType:"insert",category:"internal"},e.addHistoryEntry(m)),e._preventHistoryEntry=!0,e.add(l)&&(h=!0,e._updateDroppedSymbol(l)),delete e._preventHistoryEntry}this._disableConnectorUpdate(e),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,r),this._updateAddRemoveLaneConnectors(e,l),t.datavisualization.Diagram.canvasHelper._updateLastPhase(e,a),this._enableConnectorUpdateLane(e,l),h&&(p=e._isUndo?t.datavisualization.Diagram.GroupChangeCause.HistoryChange:t.datavisualization.Diagram.GroupChangeCause.Drop,f={changeType:"insert",element:e.getNode(l),state:"changed",cause:p},e._raiseEvent("nodeCollectionChange",f)),s=!0}e._clearSelection(!0),s&&e._addSelection(a,!0),e.activeTool.selectedObject=null}},_outOfBoundsOnLaneResize:function(e,i,a){var n,o,s;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(e)&&(n=a?e.nameTable[i.parent.split("laneStack")[0]]:i,o=t.datavisualization.Diagram.Util.randomId(),n)){var r=t.datavisualization.Diagram.Util.bounds(n),l=0,d=0;if(i.height!=e.activeTool.helper.height&&(d=e.activeTool.helper.height-i.height),i.width!=e.activeTool.helper.width&&(l=e.activeTool.helper.width-i.width),s=e.activeTool._getPageBounds(),r.bottom+d>s.height||r.right+l>s.width)return!1}return!0},_getLaneIndex:function(e,t){for(var i=e.lanes,a=0;a<i.length;a++)if(t.name===i[a].name)return a;return null},_isCanAddNodeToSegmentUpdate:function(e,t,i){if(i){if(!i||!i.parent)return!1;var a,n,o=e.nameTable[i.parent];if(!o||!o.isLane)return!1;if(a=this._getSwimlane(e,o.name),n=this._getLaneIndex(a,o),n>t)return!0}return!1},_getUpdateConnectorByEdges:function(e,t,i,a){t&&(this._getUpdateSegmentConnectors(e,t,i,a,t.inEdges),this._getUpdateSegmentConnectors(e,t,i,a,t.outEdges))},_getUpdateSegmentConnectors:function(e,t,i,a,n){var o,s,r,l;if(n&&n.length>0)for(l=0;l<n.length;l++)o=e.nameTable[n[l]],o.sourceNode&&(s=e.nameTable[o.sourceNode]),o.targetNode&&(r=e.nameTable[o.targetNode]),s&&r&&this._isCanAddNodeToSegmentUpdate(e,i,s)&&this._isCanAddNodeToSegmentUpdate(e,i,r)&&!e._collectionContains(o.name,a)&&a.push(o)},_updateConnectorSegments:function(e,i,a,n){var o,s,r,l,d,h,c=this._getSwimlane(e,i.name);if(o=this._getLaneIndex(c,i),null!=o)for(s=[],r=c.lanes,l=o+1;l<r.length;l++)for(d=r[l].children,h=0;h<d.length;h++)this._getUpdateConnectorByEdges(e,d[h],o,s);if(s&&s.length>0&&null!=a&&null!=n)for(l=0;l<s.length;l++)t.datavisualization.Diagram.Util._translateLine(s[l],a,n,s[l])},_resizeLane:function(i,a){var n,o,s,r,l,d,h,c,u,g=i.nameTable[a.name],m=!0;if(g)if(g.isLane||g._isBpmn){if(this._outOfBoundsOnLaneResize(i,g,!0)){if("bpmn"==g.type&&g.container){var p=i.activeTool.helper,f=p.width/a.width,v=p.height/a.height,_={x:a.offsetX,y:a.offsetY};i._raiseSizePropertyChange(a,p.width/a.width,p.height/a.height,!0),i.activeTool._undoObject=e.extend(!0,{},{node:g}),g=e.extend(!0,g,{width:p.width,height:p.height,offsetX:p.offsetX,offsetY:p.offsetY,minWidth:p.width,minHeight:p.height}),g.parent?(n=t.datavisualization.Diagram.ContainerHelper.updateparent(g,i),n?(g.minWidth=i.activeTool.helper.width,g.minHeight=i.activeTool.helper.height,t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0),this._updateLastSwimlanePhase(i,g)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(g,i)):t.datavisualization.Diagram.bpmnHelper.updateCanvas(g,i),t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(g,1/f,1/v,_,i),i.activeTool._redoObject=e.extend(!0,{},{node:g})}else g.container&&(i._raiseSizePropertyChange(a,i.activeTool.helper.width/a.width,i.activeTool.helper.height/a.height,!0),i.activeTool._undoObject=e.extend(!0,{},{node:g}),i._comparePropertyValues(a,"minWidth",{minWidth:i.activeTool.helper.width},!0),i._comparePropertyValues(a,"offsetX",{offsetX:a.offsetX+i.activeTool.helper.width/2},!0),g.minWidth=i.activeTool.helper.width<=100?100:i.activeTool.helper.width,i._comparePropertyValues(a,"minHeight",{minHeight:i.activeTool.helper.height},!0),i._comparePropertyValues(a,"offsetY",{offsetY:a.offsetY+i.activeTool.helper.height/2},!0),g.minHeight=i.activeTool.helper.height<=100?100:i.activeTool.helper.height,i.activeTool._redoObject=e.extend(!0,{},{node:g}));u={type:"sizechanged",node:jQuery.extend(!0,{},g),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(u),i.activeTool._multipleUndo=!0,g.isLane&&(this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0),o=g.width-i.activeTool._undoObject.node.width,s=g.height-i.activeTool._undoObject.node.height,r=i._preventDocking,l=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undoObject.node,o,s),i._preventDocking=r,i._disableSegmentChange=l,this._updateConnectorSegments(i,g,o,s),this._enableConnectorUpdateLane(i,g))}}else g.isSwimlane?(d=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,g),d.length>0&&(c=i.nameTable[i._getChild(d[d.length-1])],c&&(i.activeTool._undoObject=e.extend(!0,{},{node:c}),i._raiseSizePropertyChange(g,i.activeTool.helper.width/g.width,i.activeTool.helper.height/g.height,!0),"vertical"===g.orientation?(h=c.width+i.activeTool.helper.width-g.width,i._comparePropertyValues(c,"minWidth",{minWidth:h},!0),i._comparePropertyValues(c,"offsetX",{offsetX:a.offsetX+h/2},!0),c.minWidth=100>=h?100:h):(h=c.height+i.activeTool.helper.height-g.height,h==c.minHeight?m=!1:(i._comparePropertyValues(c,"minHeight",{minHeight:h},!0),i._comparePropertyValues(c,"offsetY",{offsetY:a.offsetY+h/2},!0),c.minHeight=100>=h?100:h)),m&&(this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),this._enableConnectorUpdateLane(i,g),i.activeTool._redoObject=e.extend(!0,{},{node:c}),u={type:"sizechanged",node:jQuery.extend(!0,{},g),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(u),i.activeTool._multipleUndo=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0),this._enableConnectorUpdateLane(i,g))))):g.container&&(g.minWidth=i.activeTool.helper.width,g.minHeight=i.activeTool.helper.height,t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,g,!0))},_updateOverlappedConnectorSegment:function(e,i,a,n){var o,s,r,l,d,h,c,u,g,m,p,f,v;if(i&&(void 0!=a&&void 0!=n&&(p=this._overLappedConnectros(e,i)),p&&p.length>0))for(f=t.datavisualization.Diagram.Util.bounds(i),"horizontal"===i.orientation?(o=f.bottomLeft,s=f.bottomRight):(o=f.topRight,s=f.bottomRight),r=[],l=0;l<p.length;l++)if(d=this._lineSegmentsIntersect(e,i,p[l],{start:o,end:s}),d&&d.length>0)for(h=0;h<d.length;h++)c=Object.keys(d[h])[0],u=d[h][c].index,v=d[h][c].point,g=e.nameTable[e._getChild(c)],g&&g.segments&&g.segments.length>0&&("horizontal"===i.orientation?(g.segments[u]&&(m=g.segments[u].length),m&&(g.segments[u].length+=n)):(m=g.segments[u].length,m&&(g.segments[u].length+=a)),this._updateConnectorEndPoints(e,g))},_lineSegmentsIntersect:function(e,t,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b;if(n=a.start.x,o=a.start.y,s=a.end.x,r=a.end.y,_=[],y=t&&t.orientation?t.orientation:"horizontal",i=e.nameTable[e._getChild(i)],i&&i.segments&&i.segments.length>0&&1!==i.segments.length)for(l=0;l<i.segments.length;l++)if(d=i.segments[l],d&&d.points.length>0)for(h=0;h<d.points.length-1;h++)c=d.points[h],u=d.points[h+1],c&&u&&(g=c.x,m=c.y,p=u.x,f=u.y,this._isInterSecting(n,o,s,r,g,m,p,f)&&(v={},b=h,"horizontal"===y?c.y>o&&(b=-1):c.x>n&&(b=-1),v[i.name]={index:l,point:b},_.push(v)));return _},_isInterSecting:function(e,t,i,a,n,o,s,r,l){var d=i-e,h=a-t,c=s-n,u=r-o,g=(-h*(e-n)+d*(t-o))/(-c*h+d*u),m=(+c*(t-o)-u*(e-n))/(-c*h+d*u);return l?g>0&&1>g&&m>0&&1>m:g>=0&&1>=g&&m>=0&&1>=m},_overLappedConnectros:function(e,t){var i,a,n,o,s,r=this._getSwimlane(e,t.name);if(r&&r.isSwimlane&&(i=this._getLaneIndex(r,t),a=e.nameTable[t.parent],n=[],a&&a.isLaneStack&&a&&a.children.length>0))for(o=i;o>=0;o--)s=e.nameTable[e._getChild(a.children[o])],s&&s.isLane&&this._laneConnectors(e,s,n);return n},_getUndoObject:function(t,i){var a={},a=t._getChildTable(i,a);t.activeTool._undoObject=e.extend(!0,{},{node:i,childTable:a})},_getRedoObject:function(t,i){var a={},a=t._getChildTable(i,a);t.activeTool._redoObject=e.extend(!0,{},{node:i,childTable:a})},_undoRemoveNodeFromContainer:function(e,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=e.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)o=e.nameTable[e._getChild(n[s])],o&&o.name===i.name&&(e.nodes().push(n[s]),t.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]));t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a,!0)}},_undoAddNodeToContainer:function(i,a,n){var o,s,r,l;a&&"pseudoGroup"!==a.type&&(o=i.nameTable[n.parent],n.segments?a.sourceNode||a.targetNode||(r=t.datavisualization.Diagram.Util.bounds(a,!0),l=t.datavisualization.Diagram.Util.bounds(n,!0),t.datavisualization.Diagram.Util._translateLine(a,l.center.x-r.center.x,l.center.y-r.center.y)):i._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,i.nameTable),o?(a.parent=o.name,o.children.push(a),t.datavisualization.Diagram.Util.removeItem(i.nodes(),a),s=i._svg.getElementById(o.name),o._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,o,i),a=e.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,o),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o,!0)):(i._swimlaneOuterNodes||(i._swimlaneOuterNodes=[]),i._swimlaneOuterNodes.push(a)),"group"===a._type?t.datavisualization.Diagram.DiagramContext.renderGroup(a,i,s):a.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(a,i,s):t.datavisualization.Diagram.DiagramContext.renderNode(a,i,s))},_undoDragNode:function(t,i,a,n){if(a=e.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type){var o=e.extend(!0,{},a),s=e.extend(!0,{},i);n||(this._disableConnectorUpdate(t),t._disableSwimlaneUptate=!0),this._undoRemoveNodeFromContainer(t,i),this._undoAddNodeToContainer(t,i,a),n||delete t._disableSwimlaneUptate,t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),n||(s.parent?this._enableConnectorUpdateNode(t,s):this._enableConnectorUpdateNode(t,o)),i.parent||this._updateAssociatedConnectorEnds(t,i,t.nameTable)}},_undoMultiDragNode:function(i,a){var n,o,s,r,l,d,h,c,u,g,m,p=e.extend(!0,{},a.node);if(p&&"pseudoGroup"===p.type){for(o=p.children,i._disableSwimlaneUptate=!0,u=0;u<o.length;u++)this._disableConnectorUpdate(i),s=i.nameTable[i._getChild(o[u])],r=s.parent,n=a.undo&&s?a.undoObject.childTable?a.undoObject.childTable[s.name]:null:a.redoObject.childTable?a.redoObject.childTable[s.name]:null,this._undoDragNode(i,s,n,!0),r||n.parent&&(r=n.parent),r?(l=i.nameTable[r],l&&l.isLane&&(d=i.nameTable[l.parent.split("laneStack")[0]],d&&(i._updateSwimlanes||(i._updateSwimlanes=[]),i._collectionContains(d.name,i._updateSwimlanes)||i._updateSwimlanes.push(d.name)))):(delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,s,i.nameTable)),delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,s,i.nameTable);if(delete i._disableSwimlaneUptate,i._updateSwimlanes&&i._updateSwimlanes.length>0)for(h=0;h<i._updateSwimlanes.length;h++)t.datavisualization.Diagram.DiagramContext.update(i.nameTable[i._updateSwimlanes[h]],i),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(i,i.nameTable[i._updateSwimlanes[h]]);if(i._swimlaneOuterNodes&&i._swimlaneOuterNodes.length>0){for(h=0;h<i._swimlaneOuterNodes.length;h++)if(c=i._swimlaneOuterNodes[h],c&&"connector"!==c.type){for(u=0,g=c.inEdges.length;g>u;u++)m=i.nameTable[c.inEdges[u]],m&&(i._dock(m,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(m,i));for(u=0,g=c.outEdges.length;g>u;u++)m=i.nameTable[c.outEdges[u]],m&&(i._dock(m,i.nameTable),t.datavisualization.Diagram.DiagramContext.update(m,i))}delete i._swimlaneOuterNodes}delete i._updateSwimlanes,i._clearSelection(!0),t.datavisualization.Diagram.Util._updateGroupBounds(p,i),
i._addSelection(p,!0),delete i.nameTable[p.name],i.nameTable[p.name]=p}},_updateAssociatedConnectorEnds:function(e,i,a){var n,o,s,r,l,d,h;if("connector"!==e.getObjectType(i)&&(i.inEdges.length||i.outEdges.length)){for(r=e._isNodeToNodeConnection(i),l=i,"bpmn"==i.type&&"group"==i._type&&(l="object"==typeof i.children[0]?i.children[0]:e.nameTable[i.children[0]]),r&&(d=t.datavisualization.Diagram.Util._findSegmentPoints(l)),h={},e._parentNode&&(h=e._getChildTable(e._parentNode,{})),n=0,o=i.inEdges.length;o>n;n++)s=a[i.inEdges[n]],!s||e._parentNode&&h[s.sourceNode]||(s.targetPadding?delete l._segmentPoints:l._segmentPoints=d,e._dock(s,a),t.datavisualization.Diagram.DiagramContext.update(s,e));for(n=0,o=i.outEdges.length;o>n;n++)s=a[i.outEdges[n]],!s||e._parentNode&&h[s.targetNode]||(s.sourcePadding?delete l._segmentPoints:l._segmentPoints=d,e._dock(s,a));delete l._segmentPoints}},_undoRemoveResizeNodeFromContainer:function(e,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=e.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)o=e.nameTable[e._getChild(n[s])],o&&o.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a,!0)}},_undoAddResizeNodeToContainer:function(i,a,n){if("pseudoGroup"!==a.type){var o,s=i.nameTable[n.parent];a.segments||(i._translate(a,n.offsetX-a.offsetX,n.offsetY-a.offsetY,i.nameTable),i.scale(a,n.width/a.width,n.height/a.height,t.datavisualization.Diagram.Point(a.offsetX,a.offsetY),i.nameTable),"group"===a._type&&t.datavisualization.Diagram.Util._updateGroupBounds(a,i),a.container&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,a,!0)),s&&(a.parent=s.name,s.children.push(a.name),o=i._svg.getElementById(s.name),s._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,s,i),a=e.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,s),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,s,!0)),"group"===a._type?t.datavisualization.Diagram.DiagramContext.renderGroup(a,i,o):a.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(a,i,o):t.datavisualization.Diagram.DiagramContext.renderNode(a,i,o)}},_undoResizeNode:function(t,i,a,n){a=e.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type&&(n||this._disableConnectorUpdate(t),this._undoRemoveResizeNodeFromContainer(t,i),this._undoAddResizeNodeToContainer(t,i,a),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),n||this._enableConnectorUpdateNode(t,i))},_undoMultiResizeNode:function(i,a){var n,o,s,r,l=e.extend(!0,{},a.node);if(l&&"pseudoGroup"===l.type){for(o=l.children,s=0;s<o.length;s++)r=i.nameTable[i._getChild(o[s])],n=a.undo&&r?a.undoObject.childTable?a.undoObject.childTable[r.name]:null:a.redoObject.childTable?a.redoObject.childTable[r.name]:null,this._undoResizeNode(i,r,n);i._clearSelection(!0),t.datavisualization.Diagram.Util._updateGroupBounds(l,i),i._addSelection(l,!0),delete i.nameTable[l.name],i.nameTable[l.name]=l}},_undoResizeLane:function(i,a,n){var o,s,r,l,d,h,c=i.nameTable[a.name];c&&(n&&n.node&&n.node.isSwimlane?(o=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,n.node),o.length>0&&(s=i.nameTable[o[o.length-1]],s&&(a=n.undo?n.undoObject&&n.undoObject.node?n.undoObject.node:s:n.undoObject&&n.redoObject.node?n.redoObject.node:s,i._comparePropertyValues(s,"minWidth",{minWidth:a.minWidth}),s.minWidth=a.minWidth,i._comparePropertyValues(s,"minHeight",{minHeight:a.minHeight}),s.minHeight=a.minHeight,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),this._enableConnectorUpdateLane(i,c)))):c.isLane&&(c.container&&(i.activeTool._undonode=e.extend(!0,{},{node:c}),i._comparePropertyValues(c,"minWidth",{minWidth:a.minWidth}),c.minWidth=a.minWidth,i._comparePropertyValues(c,"minHeight",{minHeight:a.minHeight}),c.minHeight=a.minHeight),this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,c,!0),r=c.width-i.activeTool._undonode.node.width,l=c.height-i.activeTool._undonode.node.height,d=i._preventDocking,h=i._disableSegmentChange,delete i._preventDocking,delete i._disableSegmentChange,this._updateOverlappedConnectorSegment(i,i.activeTool._undonode.node,r,l),i._preventDocking=d,i._disableSegmentChange=h,this._updateConnectorSegments(i,c,r,l),this._enableConnectorUpdateLane(i,c)))},_undoRemoveRotateNodeFromContainer:function(e,i){var a,n,o,s;if("pseudoGroup"!==i.type&&(a=e.nameTable[i.parent])){for(i.parent="",n=a.children,s=0;s<n.length;s++)o=e.nameTable[e._getChild(n[s])],o&&o.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(a.children,n[s]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,a,!0)}},_undoAddRotateNodeToContainer:function(i,a,n){var o,s,r;"pseudoGroup"!==a.type&&(o=i.nameTable[n.parent],a.segments||(r=n.rotateAngle-a.rotateAngle,i._rotate(a,r,i.nameTable)),o&&(a.parent=o.name,o.children.push(a.name),s=i._svg.getElementById(o.name),o._isBpmn?(t.datavisualization.Diagram.bpmnHelper.resetNodeMargin(a,o,i),a=e.extend(!0,a,{marginLeft:n.marginLeft,marginRight:n.marginRight,marginTop:n.marginTop,marginBottom:n.marginBottom})):this._updateNodeMargin(i,a,o),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o,!0)),"group"===a._type?t.datavisualization.Diagram.DiagramContext.renderGroup(a,i,s):a.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(a,i,s):t.datavisualization.Diagram.DiagramContext.renderNode(a,i,s))},_undoRotateNode:function(t,i,a,n){a=e.extend(!0,{},a),i&&a&&"pseudoGroup"!==i.type&&(n||this._disableConnectorUpdate(t),this._undoRemoveRotateNodeFromContainer(t,i),this._undoAddRotateNodeToContainer(t,i,a),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),n||this._enableConnectorUpdateNode(t,i))},_undoMultiRotateNode:function(i,a){var n,o,s,r,l=e.extend(!0,{},a.node);if(l&&"pseudoGroup"===l.type){for(o=l.children,s=0;s<o.length;s++)r=i.nameTable[i._getChild(o[s])],n=a.undo&&r?a.undoObject.childTable?a.undoObject.childTable[r.name]:null:a.redoObject.childTable?a.redoObject.childTable[r.name]:null,this._undoRotateNode(i,r,n,!0);i._clearSelection(!0),l.rotateAngle=n.rotateAngle,t.datavisualization.Diagram.Util._updateGroupBounds(l,i),i._addSelection(l,!0),delete i.nameTable[l.name],i.nameTable[l.name]=l}},_undoSwap:function(e,i){var a,n,o,s;e.activeTool._removeHelpers(),e._clearSelection(!0);var r=i.undo?i.insertIndex:i.moveIndex,l=e.nameTable[i.undoObject.name1],d=l&&l.parent?e.nameTable[l.parent]:null;d&&d.children.length>0&&(a=d.children),n=a.slice(),o=this._getSwimlane(e,a[0]),a&&a.length>0&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(e),this._undoSwapLane(e,a,r,l,null),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(e,d,!1),t.datavisualization.Diagram.canvasHelper._recreateConnectorSegments(e,l.name,n,i.undoObject.name2,i.undoObject.name1),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(e,l)),s=this._getSwimlane(e,a[0]),e._comparePropertyValues(s,"lanes",{lanes:o.lanes})},_undoSwapLane:function(e,t,i,a){t&&t.length>0&&(t.splice(t.indexOf(a),1),t.splice(i,0,a))}},t.datavisualization.Diagram.containerCommon={_initGroupNode:function(e,i){var a,n=null;for(i=e._getNewGroup(i),a=0;a<i.children.length;a++)n=i.children[a],n&&"object"==typeof n&&("object"!=typeof n.shape&&(n=t.datavisualization.Diagram.NodeType(n,e)),"group"==n._type||n.children||n.segments||"connector"==n.type?n.segments||"connector"==n.type?(n=e._getNewConnector(n),""==n.name&&(n.name=t.datavisualization.Diagram.Util.randomId())):(n=e._getNewGroup(n),""==n.name&&(n.name=t.datavisualization.Diagram.Util.randomId()),n=this._initGroupNode(e,n)):("bpmn"!=i.type&&(n=e._getNewNode(n)),""==n.name&&(n.name=t.datavisualization.Diagram.Util.randomId()),"node"==n._type&&n.labels.length&&(0==n.width||0==n.height)&&e._getNodeDimension(n)),i.children[a]=n,n.parent=i.name);return i},_initChildren:function(e,i){var a,n,o;if(i.children&&i.children.length>0)for(a=i.children,n=0;n<a.length;n++)o="string"==typeof a[n]?e.nameTable[a[n]]:a[n],o&&(o._isInternalShape||(i.container&&("bpmn"===o.type?e._translate(o,0-o.offsetX,0-o.offsetY,e.nameTable):o.offsetX=0,o.offsetY=0),o.container?o=t.datavisualization.Diagram.ContainerHelper._initContainer(e,o):o.children?(o=t.datavisualization.Diagram.Group(o),o=this._initGroupNode(e,a[n]),o=e._getNewGroup(a[n]),o=this._initChildren(e,a[n]),e._isLoad&&"bpmn"!==a[n].type&&this._updateGroupBounds(e,a[n])):o.segments?(o=t.datavisualization.Diagram.Connector(o),o=e._getNewConnector(o)):(o=t.datavisualization.Diagram.NodeType(o,e),o=e._getNewNode(o))),e.nameTable[o.name]=o,i.children[n]=o,e._spatialSearch&&e._updateQuad(o));return i},_getChildrenBounds:function(e,i){var a,n,o,s,r=i.children,l=t.datavisualization.Diagram.Rectangle();for(r.length>0&&(n=e.nameTable[e._getChild(r[0])],n&&(l=t.datavisualization.Diagram.Util._rotateChildBounds(n,i,e))),o=0,s=r.length;s>o;o++)n=e.nameTable[e._getChild(r[o])],n&&("group"===n._type?(t.datavisualization.Diagram.Util._updateGroupBounds(n,e),a=t.datavisualization.Diagram.Util._rotateChildBounds(n,i,e)):a=t.datavisualization.Diagram.Util._rotateChildBounds(n,i,e)),a&&(l=t.datavisualization.Diagram.Geometry.union(l,a));return l},_updateGroupBounds:function(e,i,a){var n,o,s,r,l;if(i&&!i.container&&i&&("pseudoGroup"===i.type||i.children&&i.children.length>0)){n=i.width,o=i.height,s=i.offsetX,r=i.offsetY,a&&t.datavisualization.Diagram.Util._updateRotateAngle(i,e.nameTable);var d=this._getChildrenBounds(e,i),h=d.x+d.width*i.pivot.x,c=d.y+d.height*i.pivot.y,u={x:h,y:c};i.rotateAngle&&(l=t.Matrix.identity(),t.Matrix.rotate(l,i.rotateAngle),u=t.Matrix.transform(l,u)),d&&(i.offsetX=u.x,i.offsetY=u.y,i.width=d.width,i.height=d.height)}},_cloneObject:function(t,i,a){var n,o;if(i){if(n=e.extend(!0,{},i),n.children&&n.children.length>0)for(o=0;o<n.children.length;o++)n.children[o]=this._cloneObject(t,n.children[o],a);n.name+=a}return n},_removeObject:function(e,t){var i;if(t){if("string"==typeof t&&(t=e.nameTable[t]),t&&t.children&&t.children.length>0)for(i=0;i<t.children.length;i++)this._removeObject(e,t.children[i]);t&&delete e.nameTable[t.name]}}}}(jQuery,Syncfusion),function(e,t){"use strict";t.widget("ejRuler","ej.datavisualization.ejRuler",{element:null,validTags:["div"],model:null,defaults:{offset:0,orientation:"horizontal",scale:1,interval:5,segmentWidth:100,arrangeTick:null,tickAlignment:"rightorbottom",markerColor:"red",length:null,thickness:25},_init:function(){"msie"===t.browserInfo().name&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderRuler())},_renderRuler:function(){this._updateRulerGeometry()},_updateRulerGeometry:function(){var t=this.model.length;t||(t="horizontal"===this.orientation?e(this.element[0]).width():e(this.element[0]).height()),this.element[0].style.height=("horizontal"===this.model.orientation?this.model.thickness:t)+"px",this.element[0].style.width=("horizontal"===this.model.orientation?t:this.model.thickness)+"px",this.element[0].style.textAlign="left",this._renderRulerSpace(),this._updateRuler()},_renderRulerSpace:function(){var e=this._getRulerGeometry(),t=document.getElementById(this.element[0].id+"_ruler_space");return t||(t=document.createElement("div"),t.setAttribute("id",this.element[0].id+"_ruler_space"),t.setAttribute("class","ej-ruler-space"),t.style.height=e.height+"px",t.style.width=e.width+"px",t.style["float"]="left",this.element[0].appendChild(t)),t},_updateRuler:function(){var e,t,i=this._getRulerSize(),a=this._getRulerGeometry(),n=0,o=0,s=this._getRulerSVG(a);s&&(n=this.model.length,{}.height=i,o=this.model.offset,n&&n!=1/0&&(e=n+this.model.segmentWidth,t=o,this._updateSegments(t,e+Math.abs(t),s,i)))},_updateSegments:function(e,t,i,a){for(var n,o=e,s={trans:0};t>o;)n=this._getNewSegment(o,i),n&&(i.document.appendChild(n.segment),o=this._updateSegment(e,t,n,o,s,i,a))},_updateSegment:function(e,t,i,a,n,o,s){var r=this._updateSegmentWidth(this.model.scale);return a==e?(this.model.startValue=Math.floor(e/r)*r/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue,this._starValue=a=this.model.startValue*this.model.scale,"horizontal"===this.model.orientation?this._hRulerDiff=e-a:this._vRulerDiff=e-a):a>t||a>t||(this.model.startValue=a/this.model.scale,this.model.startValue=this.model.startValue%1!=0?Number(this.model.startValue.toFixed(1)):this.model.startValue,i.label.textContent=this.model.startValue),this._updateTickLabel(i,s),"horizontal"===this.model.orientation?i.segment.setAttribute("transform","translate("+n.trans+" 0)"):i.segment.setAttribute("transform","translate(0 "+n.trans+")"),n.trans+=r,a+r},_updateTickLabel:function(e,i){var a,n;"horizontal"===this.model.orientation?a="rightorbottom"===this.model.tickAlignment?{x:2,y:i/2+5.5-5.5}:{x:2,y:i/2+5.5}:(n=e.segment.lastChild.getBBox(),a="rightorbottom"===this.model.tickAlignment?{x:0,y:n.height,"font-size":"11",transform:"rotate(270)translate("+-(n.width+2)+" "+(i/2-n.height)+")"}:{x:0,y:n.height,"font-size":"11",transform:"rotate(270)translate("+-(n.width+2)+" "+(i/2-n.height/2)+")"}),t.datavisualization.Diagram.Util.attr(e.segment.lastChild,a)},_getNewSegment:function(e,t){var i=this._createNewTicks(e,t),a=this._createTickLabel(t,i);return{segment:i,label:a}},_createNewTicks:function(e,t){for(var i,a,n=this._updateSegmentWidth(this.model.scale),o=t.g({"class":"ej-ruler-segment"}),s=0;s<this.model.interval;s++)a=n/this.model.interval,i=this._createTick(t,a,s+1,e),o.appendChild(i);return o},_getLinePoint:function(e,t,i){var i,a=this._updateSegmentWidth(this.model.scale),n=this._getRulerSize();return t*=i-1,t%a==0?n:.3*n},_createTick:function(i,a,n,o){var s,i,r,l,d,h,c,u=this._getLinePoint(i,a,n),g=this._getRulerSize(),m=this.model.arrangeTick;return"string"==typeof m&&(m=t.util.getObject(m,window)),e.isFunction(m)&&(l={ruler:s,tickLength:u,tickInterval:Number((o+a*(n-1)).toFixed(1))},m(l),u=l.tickLength),"horizontal"===this.model.orientation?(h=a*(n-1),d="rightorbottom"===this.model.tickAlignment?{x1:h,y1:g,x2:h,y2:g-u,"stroke-width":"1"}:{x1:h,y1:g-(g-u),x2:h,y2:0,"stroke-width":"1"},r=i.line(d)):(c=a*(n-1),d="rightorbottom"===this.model.tickAlignment?{x1:g,y1:c,x2:g-u,y2:c,"stroke-width":"1"}:{x1:0,y1:c,x2:g-(g-u),y2:c,"stroke-width":"1"},r=i.line(d)),r.setAttribute("class","ej-ruler-tick"),r},_createTickLabel:function(e,t){if(t){var i=e.text({"class":"ej-ruler-tick-label"});t.appendChild(i)}return i},_updateSegmentWidth:function(e){if(100!=this.model.segmentWidth)return this.model.segmentWidth;var t,i,a=25,n=1,o=100;for(i=Math.pow(2,Math.round(Math.log(e)/Math.log(2))),t=o,t=o/i;t>100;)n/=10,t/=10;for(;25>t;)n*=10,t*=10;return t>=a&&t%a!=0&&(t=Math.round(t/a)*a),t*e/n},_getRulerGeometry:function(){return{width:e(this.element[0]).width(),height:e(this.element[0]).height()}},_getRulerSize:function(){return this.model.thickness},_getRulerSVG:function(e){var i,a,n,o=this._getRulerSize();if(i=document.getElementById(this.element[0].id+"_ruler_space")){if(n=new t.datavisualization.Diagram.Svg({id:this.element[0].id+"_Ruler_svg",width:"horizontal"===this.model.orientation?e.width:o,height:"horizontal"===this.model.orientation?o:e.height,style:"position:inherit;"}),i.childNodes.length>0)for(a=i.childNodes.length-1;a>=0;a--)i.childNodes[a].parentNode.removeChild(i.childNodes[a]);i.appendChild(n.document)}return n},_setModel:function(e){for(var t in e)switch(t){case"offset":case"length":case"interval":case"segmentWidth":case"tickAlignment":case"markerColor":case"thickness":this._updateRuler();break;case"arrangeTick":this._updateRuler(),this.model.arrangeTick=e.arrangeTick}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){}})}(jQuery,Syncfusion),function(e,t){"use strict";t.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){"msie"===t.browserInfo().name&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderCanvas(),this._setParent(this.model.sourceID))},_renderCanvas:function(){var t=e("#"+this.element[0].id+"_canvas")[0];t||(t=document.createElement("div"),this.element.append(t)),t.setAttribute("id",this.element[0].id+"_canvas"),t.setAttribute("class","drawing"),t.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;"),this.element[0].setAttribute("tabindex","0"),this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width}),this._canvas=t},_renderDocument:function(i){var a,n,o,s;if(i.canvas=this._canvas,window.SVGSVGElement){n=e("#"+this._canvas.id+"_svg")[0],n&&n.parentNode.removeChild(n),a={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style,"class":"overview_svg"},n=new t.datavisualization.Diagram.Svg(a),this._svg=n,i.svg=n;var r=document.getElementById(this._id),l=r,d=e(l).width(),h=e(l).height(),c=l.getBoundingClientRect(),u=window.screenX<0?-1*window.screenX:window.screenX;0===d&&(d=Math.floor(window.innerWidth-u-Math.floor(c.left))),o=window.screenY<0?-1*window.screenY:window.screenY,0===h&&(h=Math.floor(window.innerHeight-o-Math.floor(c.top))),n.document.setAttribute("width",d),n.document.setAttribute("height",h),this.width=d,this.height=h,i.diagramLayer=t.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg),s=n.defs({id:i.canvas.id+"patterndefinition"}),n.appendChild(s),i.canvas.appendChild(n.document),this._renderHtmlLayer(i.canvas),this._addOverviewRectPanel(i)}},_removeDocument:function(){var e,t=document.getElementById(this._canvas.id+"_svg");this._canvas.removeChild(t),e=document.getElementById(this._canvas.id+"_htmlLayer"),this._canvas.removeChild(e)},_renderHtmlLayer:function(e){var i,a=document.createElement("div"),n={id:e.id+"_htmlLayer","class":"htmlLayer"};return t.datavisualization.Diagram.Util.attr(a,n),i=a,a.style.pointerEvents="none",a.style.position="absolute",a.style.left="0px",a.style.top="0px",e.appendChild(i),i},_setModel:function(e){var t=!1;for(var i in e)switch(i){case"sourceID":this._setParent(e[i]);break;case"width":case"height":t||(this._renderCanvas(),this._setParent(this.model.sourceID)),t=!0}},_setParent:function(t){if(this._parent){var i=e("#"+this._parent._id).ejDiagram("instance");this._parent=null,i._setOverview(null,this._id)}t&&(this.model.sourceID=t,this._parent=e("#"+t).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=e(this._canvas);this._on(i,t.eventType.mouseDown,this._mousedown),this._on(i,t.eventType.mouseMove,this._mousemove),this._on(i,t.eventType.mouseUp,this._mouseup),this._on(i,t.eventType.mouseLeave,this._documentmouseup),this._on(i,"touchstart",this.handleTouchStart),this._on(i,"touchmove",this.handleTouchMove),this._on(i,"touchend",this.handleTouchEnd)},_mouseup:function(e){var t,i,a,n;if(this._currentPoint=this._mouseposition(e),t=this.width,i=this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if("pan"!=this._actionName&&this._helper){a=this._helper.getBBox(),this._resizeDirection=this._resizeDirection||"";var o=a.x,s=a.y,r=a.width,l=a.height;"topleft"==this._resizeDirection||"topright"==this._resizeDirection||"bottomleft"==this._resizeDirection||"bottomright"==this._resizeDirection;this._renderOverviewRect(o,s,r,l)}}else if((e.target.id==this._canvas.id+"overviewbackrect"||"helper"==e.target.id)&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var n=document.getElementById(this._canvas.id+"overviewrect"),a=n.getBBox(),r=a.width||100,l=a.height||100/this._viewPortRatio;this.inAction=!0,this._actionName="pan",this._renderOverviewRect(this._currentPoint.x-r/2,this._currentPoint.y-l/2,r,l),this.inAction=!1}this._helper&&(n=document.getElementById(this._canvas.id+"overviewhandle"),n.removeChild(this._helper),this._helper=null),this._actionName="",this._startPoint=null,this._currentPoint=null,this._prevPoint=null,this._helper=null,this._viewPortRatio=1,this._resizeDirection="",this._inAction=!1},_mousedown:function(e){if("overviewbackrect"==e.target.className.animVal&&(this._actionName="draw"),e.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),"overviewresizer"==e.target.className.animVal)switch(this._actionName="scale",e.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}this._startPoint=this._prevPoint=this._mouseposition(e);var i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(e){var i=this._parent._isTouchEvent(e);i||(i=e);var a=this._canvas.scrollLeft,n=this._canvas.scrollTop,o=this._canvas.getBoundingClientRect(),s=i.clientX+a-o.left,r=n+i.clientY-o.top;return new t.datavisualization.Diagram.Point(s,r)},_updateCursor:function(e){if("overviewresizer"==e.target.className.animVal)switch(e.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor="default"},_mousemove:function(e){if(this._updateCursor(e),this._currentPoint=this._mouseposition(e),this._actionName)switch(this._actionName){case"draw":this._inAction||this._startPoint.x==this._currentPoint.x&&this._startPoint.y!=this._currentPoint.y||(this._initHelper(),this._inAction=!0),this._inAction&&this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0),this._updateOverviewRectangle();break;case"pan":(this._startPoint.x!=this._currentPoint.x||this._startPoint.y==this._currentPoint.y||this._inAction)&&(this._inAction=!0,this._translateOverviewRectangle())}this._prevPoint=this._currentPoint},_documentmouseup:function(){if(this._inAction=!1,this._actionName="",this._helper){var e=document.getElementById(this._canvas.id+"overviewhandle");e.removeChild(this._helper),this._helper=null}},_addOverviewRectPanel:function(){var i,a,n,o,s,r=e("#"+this._canvas.id+"_overviewsvg")[0];r&&r.parentNode.removeChild(r),r=new t.datavisualization.Diagram.Svg({id:this._canvas.id+"_overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px",width:this.width,height:this.height}),this._canvas.appendChild(r.document),i=r.g({id:this._id+"_overviewlayer"}),r.appendChild(i),a=r.rect({fill:"transparent",width:"100%",height:"100%","class":"overviewbackrect",id:this._canvas.id+"overviewbackrect"}),i.appendChild(a),n=e(i),this._on(n,t.eventType.mouseDown,this._mousedown),this._on(n,t.eventType.mouseMove,this._mousemove),this._on(n,t.eventType.mouseUp,this._mouseup),this._on(n,t.eventType.mouseLeave,this._documentmouseup),this._on(n,"touchstart",this.handleTouchStart),this._on(n,"touchmove",this.handleTouchMove),this._on(n,"touchend",this.handleTouchEnd),o=r.g({id:this._canvas.id+"overviewhandle"}),i.appendChild(o),s=r.rect({id:this._canvas.id+"overviewrect",fill:"transparent"}),o.appendChild(s),this._renderOverviewCorner("left",o),this._renderOverviewCorner("right",o),this._renderOverviewCorner("top",o),this._renderOverviewCorner("bottom",o),this._renderOverviewCorner("topleft",o),this._renderOverviewCorner("topright",o),this._renderOverviewCorner("bottomleft",o),this._renderOverviewCorner("bottomright",o)},_updateOverview:function(e){var i,a,n,o,s,r,l,d,h,c;e=e||this._parent._views[this._id],n=this._parent._getDigramBounds(),i=n.width,a=n.height;var u=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),g=this.width,m=this.height;e.context==t.datavisualization.Diagram.SvgContext?(o=Math.max(i,u.width),s=Math.max(a,u.height),this.contentWidth=o=Math.max(o,g/m*s),this.contentHeight=s=Math.max(s,m/g*o),r=document.getElementById(this._canvas.id+"_diagramLayer"),l=Math.min(g/o,m/s),this.scale=l,r.setAttribute("transform","scale("+l+","+l+"),translate("+-n.x+","+-n.y+")"),d=document.getElementById(this._canvas.id+"_htmlLayer"),d.style.webkitTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.MozTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.OTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.msTransform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",d.style.transform="scale("+l+") translate("+-n.x+"px,"+-n.y+"px)",h=document.getElementById(this._id+"_overviewlayer"),h.setAttribute("transform","translate("+-n.x*l+","+-n.y*l+")")):(c=e._canvas.document.getContext("2d"),e.scale&&c.scale(1/e.scale.x,1/e.scale.y),e.scale={x:l,y:l},c.scale(l,l),t.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,e)),this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var e=this._currentPoint.x-this._prevPoint.x,t=this._currentPoint.y-this._prevPoint.y;if("scale"==this._actionName){var i,a,n={width:0,height:0},o=0,s=0;switch(this._resizeDirection){case"left":n.width-=e,n.height-=e/this._viewPortRatio,o=e,s=e/this._viewPortRatio/2;break;case"right":n.width+=e,n.height+=e/this._viewPortRatio,s=e/this._viewPortRatio/-2;break;case"top":n.height-=t,n.width-=t*this._viewPortRatio,s=t,o=t*this._viewPortRatio/2;break;case"bottom":n.height+=t,n.width+=t*this._viewPortRatio,o=t*this._viewPortRatio/-2;break;case"topleft":Math.abs(t)>Math.abs(e)?e=t*this._viewPortRatio:t=e/this._viewPortRatio,n.width-=e,n.height-=t,o=e,s=t;break;case"topright":Math.abs(t)>Math.abs(e)?e=-t*this._viewPortRatio:t=-(e/this._viewPortRatio),s=t,n.width+=e,n.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(e)?e=-t*this._viewPortRatio:t=-e/this._viewPortRatio,o=e,n.width-=e,n.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(e)?e=t*this._viewPortRatio:t=e/this._viewPortRatio,n.width+=e,n.height+=t}this._updateHelper(o,s,n,i,a)}},_initHelper:function(){var e,t,i;if(!this._helper){var a=this._svg,n=document.getElementById(this._canvas.id+"overviewhandle"),o=(this._parent._currZoom,this._startPoint.x),s=this._startPoint.y,r=1,l=1;"scale"==this._actionName&&(e=document.getElementById(this._canvas.id+"overviewrect"),t=e.getBBox(),o=t.x,s=t.y,r=t.width,l=t.height),i=a.rect({id:"helper",x:o,y:s,width:r,height:l,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),this._helper=i}},_updateHelper:function(e,i,a){var e,i,n,o;if(a)var s=this._helper.getBBox(),r=s.x+e,l=s.y+i,d=s.width+a.width,h=s.height+a.height;else{e=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x,i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y,Math.abs(i)>Math.abs(e)?(e=this._viewPortRatio*i,o=!0,n=!1):(i=e/this._viewPortRatio,n=!0,o=!1);var s=this._helper.getBBox(),r=this._startPoint.x>this._currentPoint.x?s.x-e:s.x,l=this._startPoint.y>this._currentPoint.y?s.y-i:s.y,d=s.width+e,h=s.height+i}this._helper&&t.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:r,y:l,width:0>d?0:d,height:0>h?0:h})},_renderOverviewCorner:function(e,t){var i,a,n=this._svg;"top"==e||"bottom"==e||"right"==e||"left"==e?(i=n.rect({id:this._canvas.id+"visible"+e}),t.appendChild(i),a=n.rect({id:this._canvas.id+e,"class":"overviewresizer",fill:"transparent"}),t.appendChild(a)):(i=n.circle({id:this._canvas.id+"visible"+e}),t.appendChild(i),a=n.circle({id:this._canvas.id+e,"class":"overviewresizer",fill:"transparent"}),t.appendChild(a))},_updateOverviewrect:function(e,i,a,n){if(a&&n){var o=document.getElementById(this._canvas.id+"overviewrect"),s={x:e,y:i,width:Math.max(1,a),height:Math.max(1,n)};t.datavisualization.Diagram.Util.attr(o,s),this._updateOverviewCorner("top",e+8,i-2,Math.max(0,a-16),2),this._updateOverviewCorner("bottom",e+8,i+n,Math.max(0,a-16),2),this._updateOverviewCorner("left",e-2,i+8,2,Math.max(0,n-16)),this._updateOverviewCorner("right",e+a,i+8,2,Math.max(0,n-16)),this._updateOverviewCorner("topleft",e,i,5,5),this._updateOverviewCorner("topright",e+a,i,5,5),this._updateOverviewCorner("bottomleft",e,i+n,5,5),this._updateOverviewCorner("bottomright",e+a,i+n,5,5)}},_scrollOverviewRect:function(e,i,a,n){if(!this._actionName||n){var o=this.width,s=this.height,r=Math.min(this.contentWidth/o,this.contentHeight/s),l={},d=l.x=e/a/r,h=l.y=i/a/r,c=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),u=l.width=c.width/a/r,g=l.height=c.height/a/r;c.width/c.height;if(n)return{x:d,y:h,width:u,height:g};this._updateOverviewrect(d,h,u,g)}},_updateOverviewCorner:function(e,i,a,n,o){var s,r,l,d="visible"+e,h=document.getElementById(this._canvas.id+d);"top"==e||"bottom"==e||"right"==e||"left"==e?(s={x:i,y:a,width:n,height:o,fill:"#ED1C24"},r={x:i-2,y:a-2,width:2==n?4:n,height:2==o?4:o}):(s={cx:i,cy:a,r:4,fill:"#ED1C24"},r={cx:i,cy:a,r:6,fill:"transparent"}),t.datavisualization.Diagram.Util.attr(h,s),l=document.getElementById(this._canvas.id+e),t.datavisualization.Diagram.Util.attr(l,r)},_translateOverviewRectangle:function(){var e=this.width,i=this.height,a=this._currentPoint.x-this._prevPoint.x,n=this._currentPoint.y-this._prevPoint.y,o=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),s=(Math.min(o.width/e,o.height/i),document.getElementById(this._canvas.id+"overviewrect")),r=s.getBBox(),l=r.x+a,d=r.y+n,h=r.width,c=r.height;this._updateOverviewrect(l,d,h,c),this._updateView(this._parent._currZoom,l,d,h,c,null)},_updateView:function(i,a,n,o,s,r){var l,d,h=this.width,c=this.height,u=this.contentWidth/h,g=this.contentHeight/c,m=a*u*i,p=n*g*i,f=this._parent._getDigramBounds();if(1!=i||"pan"==this._actionName){var v=e("#"+this._parent._canvas.id+"_hScrollbar").ejScrollBar("instance").model,_=-m+v.maximum,y=-m+this._parent._hScrollOffset,b=-p+this._parent._vScrollOffset;f.width*i<_&&(d=f.width*i-_,Math.abs(d)<Math.abs(y)&&(y-=d)),v=e("#"+this._parent._canvas.id+"_vScrollbar").ejScrollBar("instance").model,l=-p+v.maximum,f.height*i<l&&(d=f.height*i-l,Math.abs(d)<Math.abs(b)&&(b-=d))}t.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,y,b,r,!1)},_renderOverviewRect:function(e,i,a,n){var o,s=this.width,r=this.height,l=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),d=a/s*this.contentWidth,h=n/r*this.contentHeight,c=Math.max(l.width/d,l.height/h);c>=.25&&30>=c&&(this._updateView(c,e,i,a,n,new t.datavisualization.Diagram.Point(0,0)),o=this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom,!0),
this._updateOverviewrect(o.x,o.y,o.width,o.height))},handleTouchStart:function(e){e.preventDefault()},handleTouchMove:function(e){e.preventDefault()},handleTouchEnd:function(e){e.preventDefault()},handleTouchLeave:function(e){e.preventDefault()}})}(jQuery,Syncfusion),function(e,t){"use strict";var i=function(){function i(e){return this.document=document.createElement("canvas"),this.id=e.id,this._scaleX=1,this._scaleY=1,e&&t.datavisualization.Diagram.Util.attr(this.document,e),this}return i.prototype.rect=function(e,t,i,a,n,o){var s=this.document.getContext("2d");s.beginPath(),n&&n.angle&&this.rotateContext(n,s),o&&(this.setStyle(o,s),o.dashArray&&this.dashedRectangle(e,t,i,a,o.dashArray)),s.fillRect(e,t,i,a),s.strokeRect(e,t,i,a),s.closePath(),n&&n.angle&&s.restore()},i.prototype.roundedRect=function(e,t,i,a,n,o,s){var r,l=this.document.getContext("2d");l.beginPath(),o&&o.angle&&this.rotateContext(o,l);var d,h,c=[{x:e+n,y:t},{x:e+i-n,y:t},{x:e+i,y:t+n},{x:e+i,y:t+a-n},{x:e+i-n,y:t+a},{x:e+n,y:t+a},{x:e,y:t+a-n},{x:e,y:t+n}],u=[{x:e+i,y:t},{x:e+i,y:t+a},{x:e,y:t+a},{x:e,y:t}],g=0;for(s&&this.setStyle(s,l),l.moveTo(c[0].x,c[0].y),r=0;r<c.length;r+=2)d=c[r+1],l.lineTo(d.x,d.y),h=c[r+2]||c[0],l.quadraticCurveTo(u[g].x,u[g].y,h.x,h.y),g++;if(l.fill(),s&&s.dashArray)for(g=0,r=0;r<c.length;r+=2)this.dashedLine(c[r].x,c[r].y,c[r+1].x,c[r+1].y,s.dashArray),this.quadraticCurve(c[r+1],u[g],c[r+2]||c[0],s),g++;l.stroke(),l.closePath(),o&&o.angle&&l.restore()},i.prototype.ellipse=function(e,i,a,n,o,s){var r,l=this.document.getContext("2d");s&&this.setStyle(s,l),r=4*((Math.sqrt(2)-1)/3),l.beginPath(),o&&o.angle&&this.rotateContext(o,l),l.moveTo(e,i-n),l.bezierCurveTo(e+r*a,i-n,e+a,i-r*n,e+a,i),l.bezierCurveTo(e+a,i+r*n,e+r*a,i+n,e,i+n),l.bezierCurveTo(e-r*a,i+n,e-a,i+r*n,e-a,i),l.bezierCurveTo(e-a,i-r*n,e-r*a,i-n,e,i-n),l.fill(),s&&s.dashArray&&(this.bezierCurve(t.datavisualization.Diagram.Point(e,i-n),new t.datavisualization.Diagram.Point(e+r*a,i-n),new t.datavisualization.Diagram.Point(e+a,i-r*n),new t.datavisualization.Diagram.Point(e+a,i),s),this.bezierCurve(t.datavisualization.Diagram.Point(e+a,i),new t.datavisualization.Diagram.Point(e+a,i+r*n),new t.datavisualization.Diagram.Point(e+r*a,i+n),new t.datavisualization.Diagram.Point(e,i+n),s),this.bezierCurve(t.datavisualization.Diagram.Point(e,i+n),new t.datavisualization.Diagram.Point(e-r*a,i+n),new t.datavisualization.Diagram.Point(e-a,i+r*n),new t.datavisualization.Diagram.Point(e-a,i),s),this.bezierCurve(t.datavisualization.Diagram.Point(e-a,i),new t.datavisualization.Diagram.Point(e-a,i-r*n),new t.datavisualization.Diagram.Point(e-r*a,i-n),new t.datavisualization.Diagram.Point(e,i-n),s)),l.stroke(),l.closePath(),o&&o.angle&&l.restore()},i.prototype.circle=function(e,t,i,a,n){var o=this.document.getContext("2d");n&&this.setStyle(n,o),a&&a.angle&&this.rotateContext(a,o),n&&n.dashArray?(o.beginPath(),o.arc(e,t,i,0,2*Math.PI),o.fill(),o.stroke(),o.closePath()):this.ellipse(e,t,2*i,2*i,a,n),a&&a.angle&&o.restore()},i.prototype.arc=function(e,t,i,a,n,o){var s,r,l={angle:a,x:e,y:t},d=this.document.getContext("2d");o&&this.setStyle(o,d),l&&l.angle&&this.rotateContext(l,d),d.beginPath(),s=0,r=Math.PI,n||(s=Math.PI,r=0),o&&o.dashArray?d.arc(e,t,i,s,r):d.arc(e,t,i,s,r),d.stroke(),d.closePath(),l&&l.angle&&d.restore()},i.prototype.path=function(e,i,a,n,o,s,r){var l,d,h,c,u,g,m=this.document.getContext("2d");r&&this.setStyle(r,m),m.beginPath(),l=i,d=a,m.translate(l,d),s&&s.angle&&this.rotateContext(s,m),h=document.createElementNS("http://www.w3.org/2000/svg","path"),h.setAttribute("d",e),this.document.appendChild(h);for(var p,f,v,_,y,b,x=this.getSegments(h),D=x,i=0,a=0,C=0,w=D.length;w>C;++C){switch(c=D[C],u=c.command,"x1"in c&&(v=c.x1),"x2"in c&&(y=c.x2),"y1"in c&&(_=c.y1),"y2"in c&&(b=c.y2),"x"in c&&(i=c.x),"y"in c&&(a=c.y),u){case"M":m.moveTo(i,a),c.x=i,c.y=a;break;case"L":m.lineTo(i,a),c.x=i,c.y=a;break;case"C":m.bezierCurveTo(v,_,y,b,i,a),c.x=i,c.y=a,c.x1=v,c.y1=_,c.x2=y,c.y2=b;break;case"Q":m.quadraticCurveTo(v,_,i,a),c.x=i,c.y=a,c.x1=v,c.y1=_;break;case"A":var z=new t.datavisualization.Diagram.Point(p,f),S=c.r1,P=c.r2,T=c.angle*(Math.PI/180),j=c.largeArcFlag,L=c.sweepFlag,N=new t.datavisualization.Diagram.Point(i,a),O=new t.datavisualization.Diagram.Point(Math.cos(T)*(z.x-N.x)/2+Math.sin(T)*(z.y-N.y)/2,-Math.sin(T)*(z.x-N.x)/2+Math.cos(T)*(z.y-N.y)/2),M=Math.pow(O.x,2)/Math.pow(S,2)+Math.pow(O.y,2)/Math.pow(P,2);M>1&&(S*=Math.sqrt(M),P*=Math.sqrt(M)),g=(j==L?-1:1)*Math.sqrt((Math.pow(S,2)*Math.pow(P,2)-Math.pow(S,2)*Math.pow(O.y,2)-Math.pow(P,2)*Math.pow(O.x,2))/(Math.pow(S,2)*Math.pow(O.y,2)+Math.pow(P,2)*Math.pow(O.x,2))),isNaN(g)&&(g=0);var E=new t.datavisualization.Diagram.Point(g*S*O.y/P,g*-P*O.x/S),k=new t.datavisualization.Diagram.Point((z.x+N.x)/2+Math.cos(T)*E.x-Math.sin(T)*E.y,(z.y+N.y)/2+Math.sin(T)*E.x+Math.cos(T)*E.y),A=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},I=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(A(e)*A(t))},U=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(I(e,t))},B=U([1,0],[(O.x-E.x)/S,(O.y-E.y)/P]),H=[(O.x-E.x)/S,(O.y-E.y)/P],R=[(-O.x-E.x)/S,(-O.y-E.y)/P],G=U(H,R);I(H,R)<=-1&&(G=Math.PI),I(H,R)>=1&&(G=0);var W=1-L?1:-1,V=B+W*(G/2);new t.datavisualization.Diagram.Point(k.x+S*Math.cos(V),k.y+P*Math.sin(V));if(c.centp=k,c.xAxisRotation=T,c.rx=S,c.ry=P,c.a1=B,c.ad=G,c.sweepFlag=L,null!=m){var I=S>P?S:P,X=S>P?1:S/P,Y=S>P?P/S:1;m.save(),m.translate(k.x,k.y),m.rotate(T),m.scale(X,Y),m.arc(0,0,I,B,B+G,1-L),m.scale(1/X,1/Y),m.rotate(-T),m.translate(-k.x,-k.y),m.restore()}break;case"Z":case"z":m.closePath(),i=p,a=f}p=i,f=a}m.fill(),r&&r.dashArray?this.drawDashedPath(D,r):m.stroke(),m.translate(-d,-d),s&&s.angle&&m.restore()},i.prototype.getSegments=function(i){for(var a,n,o,s,r,l,d,h,c,u,g,m,p,f,v=t.datavisualization.Diagram.Util.convertPathToArray(i.getAttribute("d")),_=[],y=0,b=0,x=0,D=v.length;D>x;++x){switch(a=v[x],n=a.pathSegTypeAsLetter,"x1"in a&&(c=a.x1),"x2"in a&&(g=a.x2),"y1"in a&&(u=a.y1),"y2"in a&&(m=a.y2),"x"in a&&(y=a.x),"y"in a&&(b=a.y),n){case"M":_.push({command:"M",x:y,y:b});break;case"L":_.push({command:"L",x0:d,y0:h,x:y,y:b});break;case"H":_.push({command:"L",x0:d,y0:h,x:y,y:h});break;case"V":_.push({command:"L",x0:d,y0:h,x:d,y:b});break;case"C":_.push({command:"C",x0:d,y0:h,x1:c,y1:u,x2:g,y2:m,x:y,y:b});break;case"S":l&&(o="C"==l.command||"S"==l.command?{x:l.x2,y:l.y2}:{x:l.x0,y:l.y0},s=new t.datavisualization.Diagram.Point(2*d-o.x,2*h-o.y),_.push({command:"C",x0:d,y0:h,x1:s.x,y1:s.y,x2:g,y2:m,x:y,y:b}));break;case"Q":_.push({command:"Q",x0:d,y0:h,x1:c,y1:u,x:y,y:b});break;case"T":l&&(o="Q"==l.command?{x:l.x1,y:l.y1}:{x:l.x0,y:l.y0},s=new t.datavisualization.Diagram.Point(2*d-o.x,2*h-o.y),_.push({command:"Q",x0:d,y0:h,x1:s.x,y1:s.y,x:y,y:b}));break;case"A":r=e.extend(!0,{},a),r.command="A",_.push(r);break;case"Z":case"z":_.push({command:"L",x0:y,y0:b,x:p,y:f}),y=d,b=h}l=_[_.length-1],("M"===n||"m"===n)&&(p=y,f=b),d=y,h=b}return _},i.prototype.drawDashedPath=function(e,i){for(var a,n,o,s,r,l,d,h,c,u,g=0,m=0,p=0,f=e.length;f>p;++p){switch(a=e[p],n=a.command,"x1"in a&&(s=a.x1),"x2"in a&&(l=a.x2),"y1"in a&&(r=a.y1),"y2"in a&&(d=a.y2),"x"in a&&(g=a.x),"y"in a&&(m=a.y),n){case"M":u={x:g,y:m};break;case"L":this.dashedLine(h,c,g,m,i.dashArray);break;case"H":this.dashedLine(h,c,g,c,i.dashArray);break;case"V":this.dashedLine(h,c,h,m,i.dashArray);break;case"C":this.bezierCurve(t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(s,r),t.datavisualization.Diagram.Point(l,d),t.datavisualization.Diagram.Point(g,m),i);break;case"Q":this.quadraticCurve(t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(s,r),t.datavisualization.Diagram.Point(g,m),i);break;case"A":if(o=this.document.getContext("2d"),null!=o){var v=a.rx>a.ry?a.rx:a.ry,_=a.rx>a.ry?1:a.rx/a.ry,y=a.rx>a.ry?a.ry/a.rx:1;o.save(),o.translate(a.centp.x,a.centp.y),o.rotate(a.xAxisRotation),o.scale(_,y),this.dashedArc(v,0,0,a.a1,a.a1+a.ad,1-a.sweepFlag,i.dashArray),o.scale(1/_,1/y),o.rotate(-a.xAxisRotation),o.translate(-a.centp.x,-a.centp.y),o.restore()}break;case"Z":case"z":this.dashedLine(g,m,u.x,u.y,i.dashArray),g=h,m=c}h=g,c=m}},i.prototype.calculateCirclePoints=function(e,i,a,n,o,s){var r,l,d,h;for(n=180*n/Math.PI,o=180*o/Math.PI,r=2*Math.PI*e*(Math.abs(n-o)/360)*.7,l=Math.abs(n-o)/r,l=s?-1*l:l,d=0,h=[];r>d;)h.push(t.datavisualization.Diagram.Geometry.transform({x:i,y:a},n+l*d,e)),d++;return h},i.prototype.polygon=function(e,t,i){var a,n=this.document.getContext("2d");for(n.beginPath(),t&&t.angle&&this.rotateContext(t,n),i&&this.setStyle(i,n),n.moveTo(e[0].x,e[0].y),a=1;a<e.length;a++)n.lineTo(e[a].x,e[a].y);if(n.lineTo(e[0].x,e[0].y),n.fill(),i&&i.dashArray){for(a=1;a<e.length;a++)this.line(e[a-1],e[a],i);this.line(e[a-1],e[0],i)}n.stroke(),n.closePath(),t&&t.angle&&n.restore()},i.prototype.image=function(e,t,i,a,n,o,s,r){var l,d,h,c,u,g=this.document.getContext("2d");if(g.beginPath(),o&&o.angle&&this.rotateContext(o,g),s&&this.setStyle(s,g),a&&n){var m,p,f=e.width,v=e.height,_=a,y=n;if(r&&"none"!==r.alignment)if(l=r.alignment.substr(1,3),d=r.alignment.substr(5,3),"slice"===r.scale){h=function(){m=_,p=v*_/f},c=function(){m=f*y/v,p=y},_>y?(h(),y>p&&c()):_===y?f>v?c():h():(c(),_>m&&h());var b=this.getSliceOffset(l,m,_,f),x=this.getSliceOffset(d,p,y,v),D={sx:b,sy:x,swidth:f-b,sheight:v-x,dx:0,dy:0,dwidth:m-b*(m/f),dheight:p-x*(p/v)},C=document.createElement("canvas");C.setAttribute("width",a),C.setAttribute("height",n),u=C.getContext("2d"),u.drawImage(e,D.sx,D.sy,D.swidth,D.sheight,D.dx,D.dy,D.dwidth,D.dheight),g.drawImage(C,t,i,a,n)}else if("meet"===r.scale){var w=v/f,z=y/_,m=z>w?_:y/w,p=z>w?_*w:y;t+=this.getMeetOffset(l,m,_),i+=this.getMeetOffset(d,p,y),g.drawImage(e,0,0,f,v,t,i,m,p)}else g.drawImage(e,t,i,a,n);else g.drawImage(e,t,i,a,n)}else g.drawImage(e,t,i);g.closePath(),o&&o.angle&&g.restore()},i.prototype.getSliceOffset=function(e,t,i,a){switch(e){case"min":return 0;case"mid":return(t-i)/2*a/t;case"max":return(t-i)*a/t;default:return"invalid"}},i.prototype.getMeetOffset=function(e,t,i){var a=Math.max(t,i),n=Math.min(t,i);switch(e){case"min":return 0;case"mid":return(a-n)/2;case"max":return a-n;default:return"invalid"}},i.prototype.text=function(e,t,i,a,n){var o=this.document.getContext("2d");o.beginPath(),a&&a.angle&&this.rotateContext(a,o),n&&this.setStyle(n,o),o.fillText(e.text,t,i),o.closePath(),a&&a.angle&&o.restore()},i.prototype.line=function(e,t,i,a,n){var o=this.document.getContext("2d");a||(o.beginPath(),i&&this.setStyle(i,o)),i&&i.dashArray?this.dashedLine(e.x,e.y,t.x,t.y,i.dashArray):(a||o.moveTo(e.x,e.y),o.lineTo(t.x,t.y),o.stroke()),n||o.closePath()},i.prototype.polyline=function(e,t){var i,a=this.document.getContext("2d");for(a.beginPath(),t&&this.setStyle(t,a),i=1;i<e.length;i++)this.line(e[i-1],e[i],t);a.stroke()},i.prototype.bezierCurve=function(e,t,i,a,n){var o,s,r,l,d=this.document.getContext("2d");if(d.beginPath(),d.moveTo(e.x,e.y),n&&this.setStyle(n,d),n&&n.dashArray){for(o=[],this.flattenCubicBezier(o,e,t,i,a),s=0,r=0;r<n.dashArray.length;r++)s+=Number(n.dashArray[r]);var h=o.length/s,c=!0,u=0;for(r=0;h>r;r++)for(l=0;l<n.dashArray.length;l++)u+=Number(n.dashArray[l]),u<o.length&&(c?d.lineTo(o[u].x,o[u].y):d.moveTo(o[u].x,o[u].y)),c=!c}else d.moveTo(e.x,e.y),d.bezierCurveTo(t.x,t.y,i.x,i.y,a.x,a.y);d.stroke()},i.prototype.quadraticCurve=function(e,t,i,a){var n,o,s,r,l=this.document.getContext("2d");if(l.beginPath(),l.moveTo(e.x,e.y),a&&this.setStyle(a,l),a&&a.dashArray){for(n=[],this.flattenQuadraticBezier(n,e,t,i),o=0,s=0;s<a.dashArray.length;s++)o+=Number(a.dashArray[s]);var d=n.length/o,h=!0,c=0;for(s=0;d>s;s++)for(r=0;r<a.dashArray.length;r++)c+=Number(a.dashArray[r]),c<n.length&&(h?l.lineTo(n[c].x,n[c].y):l.moveTo(n[c].x,n[c].y)),h=!h}else l.moveTo(e.x,e.y),l.quadraticCurveTo(t.x,t.y,i.x,i.y);l.stroke()},i.prototype.arrow=function(e,t,i,a,n){var o=this.document.getContext("2d");o.beginPath(),n&&this.setStyle(n,o),t&&t.angle&&this.rotateContext(t,o),o.moveTo(e.x+i.width,e.y+i.height/2),o.lineTo(e.x,e.y),o.lineTo(e.x+i.width,e.y-i.height/2),a||(o.closePath(),o.fill()),o.stroke(),t&&t.angle&&o.restore()},i.prototype.diamond=function(e,t,i,a){var n=this.document.getContext("2d");n.beginPath(),a&&this.setStyle(a,n),t&&t.angle&&this.rotateContext(t,n),n.moveTo(e.x+i.width,e.y),n.lineTo(e.x+i.width/2,e.y+i.height/2),n.lineTo(e.x,e.y),n.lineTo(e.x+i.width/2,e.y-i.height/2),n.lineTo(e.x+i.width,e.y),n.stroke(),n.fill(),n.closePath(),t&&t.angle&&n.restore()},i.prototype.dashedLine=function(e,t,i,a,n){var o=this.document.getContext("2d");o.save();var s=i-e,r=a-t,l=Math.sqrt(s*s+r*r),d=Math.atan2(r,s);o.beginPath(),o.translate(e,t),o.moveTo(0,0),o.rotate(d);for(var h=n.length,c=0,u=!0,g=0;l>g;)g+=Number(n[c++%h]),g>l&&(g=l),u?o.lineTo(g,0):o.moveTo(g,0),u=!u,o.stroke();o.restore()},i.prototype.dashedRectangle=function(e,t,i,a,n){this.dashedLine(e,t,e+i,t,n),this.dashedLine(e+i,t,e+i,t+a,n),this.dashedLine(e+i,t+a,e,t+a,n),this.dashedLine(e,t+a,e,t,n)},i.prototype.dashedArc=function(e,t,i,a,n,o,s){for(var r,l,d,h=0,c=0;c<s.length;c++)h+=Number(s[c]);r=this.calculateCirclePoints(e,t,i,a,n,o,h),l=this.document.getContext("2d"),l.beginPath();var u=r.length/h,g=!0,m=0;for(c=0;u>c;c++)for(d=0;d<s.length;d++)m+=Number(s[d]),m<r.length&&(g?(l.lineTo(r[m].x,r[m].y),l.stroke()):l.moveTo(r[m].x,r[m].y)),g=!g;l.closePath()},i.prototype.absolutePath=function(e){for(var a,n,o,s,r,l,d,h,c,u=t.datavisualization.Diagram.Util.convertPathToArray(e.getAttribute("d")),g=0,m=0,p=0,f=u.length;f>p;++p){if(a=u[p],n=a.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(n))"x"in a&&(g=a.x),"y"in a&&(m=a.y);else{switch("x1"in a&&(l=g+a.x1),"x2"in a&&(h=g+a.x2),"y1"in a&&(d=m+a.y1),"y2"in a&&(c=m+a.y2),"x"in a&&(g+=a.x),"y"in a&&(m+=a.y),n){case"m":o={pathSegTypeAsLetter:"M",x:g,y:m};break;case"l":o={pathSegTypeAsLetter:"L",x:g,y:m};break;case"h":o={pathSegTypeAsLetter:"H",x:g};break;case"v":o={pathSegTypeAsLetter:"V",y:m};break;case"c":o={pathSegTypeAsLetter:"C",x:g,y:m,x1:l,y1:d,x2:h,y2:c};break;case"s":o={pathSegTypeAsLetter:"S",x:g,y:m,x2:h,y2:c};break;case"q":o={pathSegTypeAsLetter:"Q",x:g,y:m,x1:l,y1:d};break;case"t":o={pathSegTypeAsLetter:"T",x:g,y:m};break;case"a":o={pathSegTypeAsLetter:"A",x:g,y:m,r1:r1,r2:r2,angle:angle,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag};break;case"z":case"Z":g=s,m=r,o=u[p]}o&&(u[p]=o)}("M"===n||"m"===n)&&(s=g,r=m)}return e.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(u)),i.prototype._scalePathData=function(e,t,i,a){return e!==i?e=a!==i?e*t-(Number(i)*t-Number(i))+(a-Number(i)):Number(e)*t-(Number(i)*t-Number(i)):a!==i&&(e=a),e},e},i.prototype.setStyle=function(e,t){e.fill&&(t.fillStyle=e.fill),e.stroke&&(t.strokeStyle="none"==e.stroke?"transparent":e.stroke),e.font&&(t.font=e.font),e.lineWidth&&(t.lineWidth=e.lineWidth)},i.prototype.rotateContext=function(e,t){t.save(),t.translate(e.x,e.y),t.rotate(e.angle*Math.PI/180),t.translate(-e.x,-e.y)},i.prototype.pathBounds=function(e){for(var i,a,n,o,s,r,l,d,h,c,u,g,m,p=0,f=0,v=0,_=e.length;_>v;++v)switch(i=e[v],a=i.command,0==v&&i.x&&i.y&&(c=g=i.x,u=m=i.y),"x1"in i&&(o=i.x1),"x2"in i&&(r=i.x2),"y1"in i&&(s=i.y1),"y2"in i&&(l=i.y2),"x"in i&&(p=i.x),"y"in i&&(f=i.y),a){case"M":d=p,h=f;case"L":case"H":case"V":p&&(c=Math.min(p,c),g=Math.max(p,g)),f&&(u=Math.min(f,u),m=Math.max(f,m));break;case"C":case"S":n=this.getBezierBounds(t.datavisualization.Diagram.Point(d,h),t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(r,l),t.datavisualization.Diagram.Point(p,f)),c=Math.min(n.x,c),g=Math.max(n.x+n.width,g),u=Math.min(n.y,u),m=Math.max(n.y+n.height,m);break;case"Q":case"q":case"T":n=this.getQuadraticBounds(t.datavisualization.Diagram.Point(d,h),t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(p,f)),c=Math.min(n.x,c),g=Math.max(n.x+n.width,g),u=Math.min(n.y,u),m=Math.max(n.y+n.height,m);break;case"Z":case"z":p=d,f=h}return{x:c,y:u,width:g-c,height:m-u}},i.prototype.flattenCubicBezier=function(e,i,a,n,o,s){for(var s=1.5,r=Number((t.datavisualization.Diagram.Geometry.distance(a,i)+t.datavisualization.Diagram.Geometry.distance(n,a)+t.datavisualization.Diagram.Geometry.distance(o,n))/s),l=0;r>=l;l++){var d=l/r,h=(1-d)*(1-d)*(1-d)*i.x+3*d*(1-d)*(1-d)*a.x+3*d*d*(1-d)*n.x+d*d*d*o.x,c=(1-d)*(1-d)*(1-d)*i.y+3*d*(1-d)*(1-d)*a.y+3*d*d*(1-d)*n.y+d*d*d*o.y;e.push(new t.datavisualization.Diagram.Point(h,c))}},i.prototype.flattenQuadraticBezier=function(e,i,a,n,o){for(var o=1.5,s=Number((t.datavisualization.Diagram.Geometry.distance(a,i)+t.datavisualization.Diagram.Geometry.distance(n,a))/o),r=0;s>=r;r++){var l=r/s,d=(1-l)*(1-l)*i.x+2*l*(1-l)*a.x+l*l*n.x,h=(1-l)*(1-l)*i.y+2*l*(1-l)*a.y+l*l*n.y;e.push(new t.datavisualization.Diagram.Point(d,h))}},i.prototype.getBezierBounds=function(e,i,a,n,o){for(var s,r,l,d,o=3,h=Number((t.datavisualization.Diagram.Geometry.distance(i,e)+t.datavisualization.Diagram.Geometry.distance(a,i)+t.datavisualization.Diagram.Geometry.distance(n,a))/o),c=0;h>=c;c++){var u=c/h,g=(1-u)*(1-u)*(1-u)*e.x+3*u*(1-u)*(1-u)*i.x+3*u*u*(1-u)*a.x+u*u*u*n.x,m=(1-u)*(1-u)*(1-u)*e.y+3*u*(1-u)*(1-u)*i.y+3*u*u*(1-u)*a.y+u*u*u*n.y;0==c?(s=l=g,r=d=m):(s=Math.min(g,s),r=Math.min(m,r),l=Math.max(g,l),d=Math.max(m,d))}return{x:s,y:r,width:l-s,height:d-r}},i.prototype.getQuadraticBounds=function(e,i,a,n){for(var o,s,r,l,n=3,d=Number((t.datavisualization.Diagram.Geometry.distance(i,e)+t.datavisualization.Diagram.Geometry.distance(a,i))/n),h=0;d>=h;h++){var c=h/d,u=(1-c)*(1-c)*e.x+2*c*(1-c)*i.x+c*c*a.x,g=(1-c)*(1-c)*e.y+2*c*(1-c)*i.y+c*c*a.y;0==h?(o=r=u,s=l=g):(o=Math.min(u,o),s=Math.min(g,s),r=Math.max(u,r),l=Math.max(g,l))}return{x:o,y:s,width:r-o,height:l-s}},i}();t.datavisualization.Diagram.Canvas=i,t.datavisualization.Diagram.CanvasContext={_renderDocument:function(e,i){var a={id:e.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:e.style,"pointer-events":"none"};e._canvas=new t.datavisualization.Diagram.Canvas(a),i._view=e.canvas,e.canvas.appendChild(e._canvas.document),"mainview"==e.type&&(this._canvas=e.canvas,i._svg=this._svg=e._canvas)},_renderGroupBackground:function(e,i,a){var n,o,s,r,l,d;e.pivot||(e.pivot={},e.pivot.x=.5,e.pivot.y=.5),n=i.document.getContext("2d"),e.visible&&(o={angle:e.rotateAngle,x:e.offsetX*i._scaleX,y:e.offsetY*i._scaleY},n.save(),n.translate(o.x,o.y),n.rotate(o.angle*Math.PI/180),n.translate(-o.x,-o.y),n.fillStyle="bpmn"!=e.type?e.fillColor:"transparent",n.strokeStyle="bpmn"!=e.type?e.borderColor:"transparent",n.lineWidth=e.borderWidth,e.borderDashArray&&(-1!=e.borderDashArray.indexOf("[")||e.borderDashArray instanceof Array?s=e.borderDashArray:-1!=e.borderDashArray.indexOf(",")?s=e.borderDashArray.split(","):-1!=e.borderDashArray.indexOf(" ")&&(s=e.borderDashArray.split(" ")),n.setLineDash?n.setLineDash(s):n.mozDash?n.mozDash=s:r={dashArray:s})),l=e.offsetX*i._scaleX-e.width*i._scaleX*e.pivot.x,d=e.offsetY*i._scaleY-e.height*i._scaleY*e.pivot.y,t.datavisualization.Diagram.Util.canCrispEdges(e,a)&&(l=Math.floor(l)+.5,d=Math.floor(d)+.5),i.rect(l,d,e.width*i._scaleX,e.height*i._scaleY,null,r),n.restore()},renderGroup:function(e,t,i){var a,n,o,s,r,l,d,h,c;if(e.visible){for(a=t.document.getContext("2d"),n={angle:e.rotateAngle,x:e.offsetX*t._scaleX,y:e.offsetY*t._scaleY},a.save(),this._renderGroupBackground(e,t,i),o=0;o<e.children.length;o++)s=i.nameTable[i._getChild(e.children[o])],s&&("group"===s._type?this.renderGroup(s,t,i):"node"===s._type?this.renderNode(s,t):s.segments&&this.renderConnector(s,t));if(a.translate(n.x,n.y),a.rotate(n.angle*Math.PI/180),a.translate(-n.x,-n.y),r=e.offsetX*t._scaleX-e.width*t._scaleX*e.pivot.x,l=e.offsetY*t._scaleY-e.height*t._scaleY*e.pivot.y,e.isLane||(this.renderLabels(e,t),this.renderPorts(e,t,r,l)),e.isSwimlane&&i._renderCanvasPhase(e,t),e.annotation&&e._annotation&&e._annotation.length)for(d=0;d<e._annotation.length;d++)i.nameTable[e._annotation[d]]&&(h=i.nameTable[e._annotation[d]],c=i.getObjectType(h),"node"==c?this.renderNode(h,t):"connector"==c&&this.renderConnector(h,t));a.restore()}},_isExportable:function(e,i){var a,i,n,o,s=!0;if("image"===e.type)try{i=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100}),n=i.document.getContext("2d"),n.save(),i.rect(0,0,e.width*i._scaleX,e.height*i._scaleY),o=new Image,o.src=e.source,i.image(o,0,0,e.width*i._scaleX,e.height*i._scaleY,void 0,void 0,{scale:e.scale,alignment:e.contentAlignment}),n.restore(),a=i.document.toDataURL()}catch(r){s=!1}return s},_isImageExportable:function(e){var i,a,n,o,s=!0;if(e.source)try{a=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100}),n=a.document.getContext("2d"),n.save(),o=new Image,o.src=e.source,a.image(o,0,0,100,100,void 0,void 0,{scale:e.scale,alignment:e.alignment}),n.restore(),i=a.document.toDataURL()}catch(r){s=!1}return s},renderNode:function(e,i,a){var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b=i.document.getContext("2d");if(e.visible&&this._isExportable(e,i)){n=e.width||e._width||0,o=e.height||e._height||0,n*=i._scaleX,o*=i._scaleY;var x=e.offsetX*i._scaleX,D=e.offsetY*i._scaleY,g={angle:e.rotateAngle,x:x,y:D};if(b.save(),b.translate(g.x,g.y),b.rotate(g.angle*Math.PI/180),b.translate(-g.x,-g.y),b.save(),b.fillStyle=e.fillColor,b.strokeStyle="none"!=e.borderColor&&e.borderWidth?e.borderColor:"transparent",b.lineWidth=e.borderWidth,b.globalAlpha=e.opacity,s=x-n*e.pivot.x,r=D-o*e.pivot.y,t.datavisualization.Diagram.Util.canCrispEdges(e,i._diagram)&&(s=Math.floor(s)+.5,r=Math.floor(r)+.5),"path"==e._shape?this._renderGradient(e,b,0,0):this._renderGradient(e,b,s,r),l=e.fillColor,e.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){switch(b.save(),b.strokeStyle="lightgrey",d=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},e.shadow.angle,e.shadow.distance),b.fillStyle="none"!=l||"transparent"!=l?"lightgrey":"none",e._shape){case"image":case"rectangle":e.cornerRadius?i.roundedRect(s+d.x,r+d.y,n,o,e.cornerRadius,null):i.rect(s+d.x,r+d.y,n,o,null);break;case"ellipse":i.ellipse(s+n/2+d.x,r+o/2+d.y,n/2,o/2,null);break;case"path":u=e._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(u=t.datavisualization.Diagram.Geometry.updatePath(s,r,n,o,u,i._diagram._svg,null,null)),i.path(u,s+d.x,r+d.y,n,o,null);break;case"polygon":f=this._updatePolygonPoints(e,i),b.translate(d.x,d.y),i.polygon(f,null,c)}b.restore()}switch(e.borderDashArray&&(-1!=e.borderDashArray.indexOf("[")||e.borderDashArray instanceof Array?h=e.borderDashArray:-1!=e.borderDashArray.indexOf(",")?h=e.borderDashArray.split(","):-1!=e.borderDashArray.indexOf(" ")&&(h=e.borderDashArray.split(" ")),b.setLineDash?b.setLineDash(h):b.mozDash?b.mozDash=h:c={dashArray:h}),e._shape){case"rectangle":e.cornerRadius?i.roundedRect(s,r,n,o,e.cornerRadius,null,c):i.rect(s,r,n,o,null,c);break;case"ellipse":i.ellipse(s+n/2,r+o/2,n/2,o/2,null,c);break;case"path":u=e._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(u=t.datavisualization.Diagram.Geometry.updatePath(0,0,n,o,u,i._diagram._svg,null,null)),i.path(u,s,r,n,o,null,c);break;case"image":g={angle:e.rotateAngle,x:x,y:D},i.rect(s,r,n,o,null,c),m=new Image,m.src=e.source,i.image(m,s,r,n,o,void 0,void 0,{scale:e.scale,alignment:e.contentAlignment});break;case"text":i.rect(s,r,n,o,null,c),e.textBlock&&(p="",e.textBlock.italic&&(p+="italic "),e.textBlock.bold&&(p+="bold "),p+=e.textBlock.fontSize+" ",p+=e.textBlock.fontFamily,b.font=p,this._renderTextElement(e,e.textBlock,i));break;case"polygon":f=this._updatePolygonPoints(e,i),i.polygon(f,null,c);break;case"native":case"html":a._raiseEvent("templateNodeRendering",{element:e,canvas:i})}if(b.restore(),this.renderPorts(e,i,s,r),"text"!=e.type&&this.renderLabels(e,i),e.annotation&&e._annotation&&e._annotation.length)for(v=0;v<e._annotation.length;v++)a.nameTable[e._annotation[v]]&&(_=a.nameTable[e._annotation[v]],y=a.getObjectType(_),"node"==y?this.renderNode(_,i):"connector"==y&&this.renderConnector(_,i));b.restore()}},renderPhases:function(e,t,i){var a,n,o;e&&t&&(n=t.document.getContext("2d"),n.save(),n.strokeStyle=e.lineColor?e.lineColor:"black",n.lineWidth=e.lineWidth?e.lineWidth:1,e.lineDashArray&&(-1!=e.lineDashArray.indexOf("[")||e.lineDashArray instanceof Array?o=e.lineDashArray:-1!=e.lineDashArray.indexOf(",")?o=e.lineDashArray.split(","):-1!=e.lineDashArray.indexOf(" ")&&(o=e.lineDashArray.split(" ")),n.setLineDash?n.setLineDash(o):n.mozDash?n.mozDash=o:a={dashArray:o}),i&&i.length>0&&t.line(i[0],i[1],a)),n.restore()},renderConnector:function(e,t){var i,a,n,o;if(e.visible&&(i=t.document.getContext("2d"),i.save(),i.strokeStyle=e.lineColor,i.lineWidth=e.lineWidth,e.lineDashArray&&(-1!=e.lineDashArray.indexOf("[")||e.lineDashArray instanceof Array?a=e.lineDashArray:-1!=e.lineDashArray.indexOf(",")?a=e.lineDashArray.split(","):-1!=e.lineDashArray.indexOf(" ")&&(a=e.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(a):i.mozDash?i.mozDash=a:n={dashArray:a}),e.segments&&this._renderSegments(e,t,n),i.restore(),this._renderDecorators(e,t),this.renderLabels(e,t),e.shape))for(o=0;o<e._inlineDecorators.length;o++)this.renderNode(e._inlineDecorators[o],t)},_renderSegments:function(e,i,a){for(var n,o,s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D=0;D<e.segments.length;D++){if(n=e.segments[D],n._bridges.length>0)for(o=0;o<n._bridges.length;o++)s=n._bridges[o],s._rendered=!1;if(r=n.points,l=i._diagram,0==D?(l&&e.sourceNode&&(h=l._findNode(e.sourceNode)),r=t.datavisualization.Diagram.SvgContext._clipDecorators(e,n,!0,h),"bezier"==n.type&&e.sourceDecorator&&e.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(r[0]=t.datavisualization.Diagram.Util._adjustPoint(r[0],n._point1,!0,e.lineWidth)),m=r[0],d=!0):d=!1,D==e.segments.length-1&&(l&&e.targetNode&&(h=l._findNode(e.targetNode)),r=t.datavisualization.Diagram.SvgContext._clipDecorators(e,n,!1,h),m&&e.segments.length<2&&(r[0]=m,m=null),c=!0),e.shape&&"sequence"==e.shape.flow&&"default"==e.shape.sequence&&0==D){u={x:n.points[0].x,y:n.points[0].y},g=t.datavisualization.Diagram.Geometry.distance(n.points[0],n.points[1]),g=Math.min(30,g/2);var C=t.datavisualization.Diagram.Geometry.findAngle(n.points[0],n.points[1]),w=t.datavisualization.Diagram.Geometry.transform({x:u.x,y:u.y},C,g),z=t.datavisualization.Diagram.Geometry.transform({x:w.x,y:w.y},C+135,-12),S=t.datavisualization.Diagram.Geometry.transform({x:z.x,y:z.y},C+135,24)}if(e.shape&&"sequence"==e.shape.flow&&"default"==e.shape.sequence&&0==D){u={x:n.points[0].x,y:n.points[0].y},g=t.datavisualization.Diagram.Geometry.distance(n.points[0],n.points[1]),g=Math.min(30,g/2);var C=t.datavisualization.Diagram.Geometry.findAngle(n.points[0],n.points[1]),w=t.datavisualization.Diagram.Geometry.transform({x:u.x,y:u.y},C,g),z=t.datavisualization.Diagram.Geometry.transform({x:w.x,y:w.y},C+135,-12),S=t.datavisualization.Diagram.Geometry.transform({x:z.x,y:z.y},C+135,24)}if("bezier"==n.type)m=r[0],p=n._endPoint,e.targetDecorator&&e.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(p=t.datavisualization.Diagram.Util._adjustPoint(n._endPoint,n._point2,!0,e.lineWidth)),i.bezierCurve(m,n._point1,n._point2,p,a);else if(e.cornerRadius>0)for(_=0;_<r.length-1;_++)y=t.datavisualization.Diagram.Geometry.distance(r[_],r[_+1]),y>0&&(b=v||f,v=D<e.segments.length-1||_<r.length-2?y<2*e.cornerRadius?this._adjustPoint(r[_],r[_+1],!1,y/2):this._adjustPoint(r[_],r[_+1],!1,e.cornerRadius):r[_+1],(D>0||_>0)&&(y<2*e.cornerRadius?(f=this._adjustPoint(r[_],r[_+1],!0,y/2),(D<e.segments.length-1||_<r.length-2)&&(v=null)):f=this._adjustPoint(r[_],r[_+1],!0,e.cornerRadius)),b&&f?i.quadraticCurve(b,r[_],f,a):f=r[_],n._bridges.length>0&&this._updateBridging(n,i,_+1,f?f:r[_],v?v:r[_+1],e.bridgeSpace,a,!(!d||1!=x),!(!c||x!=r.length-1)),v&&(n._bridges.length>0||i.line(f,v,a)));else for(x=1;x<r.length;x++)n._bridges.length>0?this._updateBridging(n,i,x,r[x-1],r[x],e.bridgeSpace,a,!(!d||1!=x),!(!c||x!=r.length-1)):i.line(this._scalePointforStretch(r[x-1],i,e),this._scalePointforStretch(r[x],i,e),a,!d||1!=x,!c||x!=r.length-1)}e.shape&&"sequence"==e.shape.flow&&"default"==e.shape.sequence&&i.line(this._scalePointforStretch(z,i,e),this._scalePointforStretch(S,i,e),a)},_scalePointforStretch:function(e,i,a){var n={x:e.x,y:e.y};return a&&t.datavisualization.Diagram.Util.canCrispEdges(a,i._diagram)&&(n.x=Math.floor(n.x),n.y=Math.floor(n.y)),n.x*=i._scaleX,n.y*=i._scaleY,n},_updateBridging:function(e,i,a,n,o,s,r,l,d){var h,c,u,g,m=this._findAngle(n,o),p=i._diagram.bridgeDirection();if(e._bridges.length>0)if("straight"===e.type){for(u=0;u<e._bridges.length;u++)if(g=e._bridges[u],!g._rendered){h=null!=e._bridges[u-1]&&e._bridges[u-1].segmentPointIndex==g.segmentPointIndex?e._bridges[u-1].endPoint:n,i.line(h,g.startPoint,r,!(l||0==u),!0);var f=g.startPoint.x+(g.endPoint.x-g.startPoint.x)/2,v=g.startPoint.y+(g.endPoint.y-g.startPoint.y)/2,_=t.datavisualization.Diagram.Util.sweepDirection(m,p,null,i._diagram);i.arc(f,v,s/2,m,_,r),null!=e._bridges[u+1]&&e._bridges[u+1].segmentPointIndex==g.segmentPointIndex?i.line(g.endPoint,e._bridges[u+1].startPoint,r,!1):i.line(g.endPoint,o,r,!1,!d),g._rendered=!0}}else if("orthogonal"===e.type){for(c=n,u=0;u<e._bridges.length;u++)if(g=e._bridges[u],g.segmentPointIndex===a&&!g._rendered){h=null!=e._bridges[u-1]&&e._bridges[u-1].segmentPointIndex==g.segmentPointIndex?e._bridges[u-1].endPoint:n,i.line(h,g.startPoint,r,!(l||0==u),!0);var f=g.startPoint.x+(g.endPoint.x-g.startPoint.x)/2,v=g.startPoint.y+(g.endPoint.y-g.startPoint.y)/2,_=t.datavisualization.Diagram.Util.sweepDirection(m,p,null,i._diagram);i.arc(f,v,s/2,m,_,r),null!=e._bridges[u+1]&&e._bridges[u+1].segmentPointIndex==g.segmentPointIndex?i.line(g.endPoint,e._bridges[u+1].startPoint,r,!1):c=g.endPoint,g._rendered=!0}i.line(c,o,r,!1,!d)}},_findAngle:function(e,t){var i=e.x-t.x,a=e.y-t.y;return Math.atan2(a,i)*(180/Math.PI)},_adjustPoint:function(e,i,a,n){var o,s=a?{x:e.x,y:e.y}:{x:i.x,y:i.y};return e.x==i.x?e.y<i.y&&a||e.y>i.y&&!a?s.y+=n:s.y-=n:e.y==i.y?e.x<i.x&&a||e.x>i.x&&!a?s.x+=n:s.x-=n:a?(o=t.datavisualization.Diagram.Geometry.findAngle(e,i),s=t.datavisualization.Diagram.Geometry.transform(e,o,n)):(o=t.datavisualization.Diagram.Geometry.findAngle(i,e),s=t.datavisualization.Diagram.Geometry.transform(i,o,n)),s},renderLabels:function(e,t){for(var i,a,n=0;n<e.labels.length;n++)i=e.labels[n],a=t.document.getContext("2d"),a.save(),a.globalAlpha=i.opacity,a.lineWidth=i.borderWidth,a.strokeStyle=i.borderColor,i.text&&i.visible&&this._renderTextElement(e,i,t),a.restore()},renderPorts:function(e,i,a,n){for(var o,s,r,l,d,h,c,u=i.document.getContext("2d"),g=0;g<e.ports.length;g++)if(o=e.ports[g],!(o.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||o.visibility&t.datavisualization.Diagram.PortVisibility.Hover||o.visibility&t.datavisualization.Diagram.PortVisibility.Connect))switch(s=t.datavisualization.Diagram.Util._getPortPosition(o,t.datavisualization.Diagram.Util.bounds(e,!0)),s=this._scalePointforStretch(s,i),r=o.size*i._scaleY,u.fillStyle=o.fillColor,u.strokeStyle=o.borderColor,u.lineWidth=o.borderWidth,o.shape){case"x":u.beginPath(),u.moveTo(s.x-r/2,s.y-r/2),u.lineTo(s.x+r/2,s.y+r/2),u.moveTo(s.x+r/2,s.y-r/2),u.lineTo(s.x-r/2,s.y+r/2),u.stroke(),u.fill(),u.closePath();break;case"circle":l=r/2,d=r/2,i.ellipse(s.x,s.y,l,d);break;case"square":i.rect(s.x-r/2,s.y-r/2,r,r);break;case"path":u.save(),"group"==e._type?(u.translate(offsetX,e.offsetY),u.rotate(-e.rotateAngle*Math.PI/180),u.translate(-offsetX,-e.offsetY),e.rotateAngle&&(h={angle:e.rotateAngle,x:o._absolutePoint.x,y:o._absolutePoint.y}),c=o._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(c=t.datavisualization.Diagram.Geometry.updatePath(o._absolutePoint.x,o._absolutePoint.y,r,r,c,i._diagram._svg,null,null)),i.path(c,0,0,r,r,h)):(a=s.x-e.width*o.offset.x,n=s.y-e.height*o.offset.y,c=o._absolutePath,(1!==i._scaleX||1!==i._scaleY)&&(c=t.datavisualization.Diagram.Geometry.updatePath(a,n,r,r,c,i._diagram._svg,null,null)),i.path(c,a,n,r,r,h)),
u.restore()}},_renderTextElement:function(e,t,i){var a,n,o,s;t&&(a={childNodes:[]},n=i.document.getContext("2d"),n.save(),o="",t.italic&&(o+="italic "),t.bold&&(o+="bold "),o+=t.fontSize*i._scaleY+"px ",o+=t.fontFamily,n.font=o,s=this._wrapText(e,a,t,i),this._alignTextOnLabel(t,e,a,i,s),n.restore())},_alignTextOnLabel:function(e,i,a,n,o){var s,r,l,d,h,c,u,g,m,p,f,v,_,y,b,x,D,C,w,z,S=i.width||i._width||0,P=i.height||i._height||0;S*=n._scaleX,P*=n._scaleY,s={width:o&&o.width||e.width,height:a.childNodes.length*e.fontSize*n._scaleY},r=t.datavisualization.Diagram.Util.bounds(i),r.width*=n._scaleX,r.height*=n._scaleY,r.x*=n._scaleX,r.y*=n._scaleY,c=n._diagram,i.segments&&"segmentpath"==e.relativeMode?(u=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(e,i,1,c),g=this._scalePointforStretch(u.position,n),l={x:(g.x-r.x)/r.width,y:(g.y-r.y)/r.height},m=t.datavisualization.Diagram.Util._alignLabelOnSegments(i,e,c,u),h=m.vAlign,d=m.hAlign):(d=e.horizontalAlignment,h=e.verticalAlignment),l=t.datavisualization.Diagram.Util._getLabelPosition(e,r,l);var T={x:0,y:0},j={x:l.x,y:l.y},L=0;switch(L=h==t.datavisualization.Diagram.VerticalAlignment.Top?l.y+s.height/2:h==t.datavisualization.Diagram.VerticalAlignment.Center||h==t.datavisualization.Diagram.VerticalAlignment.Stretch?l.y:l.y-s.height/2,T.y=L,T.x=l.x,j.y=L,p=n.document.getContext("2d"),"justify"==e.textAlign?a.childNodes.length>1?(p.textAlign="left",s.width=S-2*e.borderWidth):p.textAlign="center":p.textAlign=e.textAlign,d){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(j.x=l.x+s.width/2,p.textAlign){case t.datavisualization.Diagram.TextAlign.Left:T.x=l.x;break;case t.datavisualization.Diagram.TextAlign.Center:T.x=l.x+s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:T.x=l.x+s.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(j.x=l.x,p.textAlign){case t.datavisualization.Diagram.TextAlign.Left:T.x=l.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:T.x=l.x;break;case t.datavisualization.Diagram.TextAlign.Right:T.x=l.x+s.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(j.x=l.x-s.width/2,p.textAlign){case t.datavisualization.Diagram.TextAlign.Left:T.x=l.x-s.width;break;case t.datavisualization.Diagram.TextAlign.Center:T.x=l.x-s.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:T.x=l.x}break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:j.x=l.x,T.x=l.x}v=r.x,_=r.y,i.segments||(v=i.offsetX*n._scaleX-S*i.pivot.x,_=i.offsetY*n._scaleY-P*i.pivot.y);var N=e.borderWidth||0,O=v+T.x+(o?o.x:0)-N/2,L=_+T.y-s.height/2-N/2;for("stretch"==e.verticalAlignment?n.rect(O,r.y,s.width+N,r.height+N,null,{fill:e.fillColor&&!i._isHeader?e.fillColor:"transparent",stroke:N&&!i._isHeader?e.borderColor||"transparent":"transparent",lineWidth:N}):n.rect(O,L,s.width+N,s.height+N,null,{fill:e.fillColor?e.fillColor:"transparent",stroke:N?e.borderColor||"transparent":"transparent",lineWidth:N}),f={angle:e.rotateAngle,x:v+j.x,y:_+j.y},"justify"==e.textAlign&&(y=Math.max(S,e.width)-2*e.borderWidth),p.save(),p.translate(f.x,f.y),p.rotate(f.angle*Math.PI/180),p.translate(-f.x,-f.y),b=0;b<a.childNodes.length;b++){var M=a.childNodes[b],E=O+M.x-o.x+N/2,k=L+M.dy*b+e.fontSize*n._scaleY*.8+N/2,A=p.measureText(M.text).width;if(y>A&&b<a.childNodes.length-1&&(x=M.text," "==x[x.length-1]&&(x=x.slice(0,x.length-1))," "==x[0]&&(x=x.slice(1,x.length)),A=p.measureText(x).width,D=x.split(" "),D.length>1)){for(C=(y-A)/p.measureText(" ").width/(D.length-1),C=Math.round(C),w="",z=0;C>z;z++)w+=" ";M.text=x.replace(" ",w)}if("stretch"==e.horizontalAlignment)switch(e.textAlign){case"left":M.x=l.x-s.width/2;break;case"center":M.x=-s.width/2;break;case"right":M.x=-l.x-s.width/2}n.text({text:M.text},E-M.x,k,null,{fill:e.fontColor}),"none"!=e.textDecoration&&this._renderTextDecoration(E-M.x,k,p.measureText(M.text).width,e,n)}p.restore()},_wrapText:function(e,i,a,n){var o,s,r,l,d,h,c,u,g,m=a.text;void 0!=a.rotateAngle&&n&&n._diagram?(o=n._diagram.nameTable[e.parent],o&&o.isLane&&0!==a.rotateAngle?(r=t.datavisualization.Diagram.Util.bounds(e),s=r.width,r.width=r.height,r.height=s):r=t.datavisualization.Diagram.Util.bounds(e)):r=t.datavisualization.Diagram.Util.bounds(e),r.width*=n._scaleX,r.height*=n._scaleY,r.x*=n._scaleX,r.y*=n._scaleY,e.segments?(l=r.width,d=r.height):(l=r.width-a.margin.left-a.margin.right,d=r.height-a.margin.top-a.margin.bottom),l-=2*(a.borderWidth?a.borderWidth:1),l=l<a.width?a.width:l;for(var p,f,v=m.split("\n"),_=n.document.getContext("2d"),y="wrapwithoverflow"==a.wrapping,b=0;b<v.length;b++)if(h="","nowrap"!=a.wrapping)for(c="wrapwithoverflow"==a.wrapping?v[b].split(" "):v[b],f=0;f<c.length;f++)u=c[f],u.indexOf("-")>=0&&y?(h=this._splitHyphenWord(h,u,i,a,_,l),f==c.length-1?(i.childNodes[i.childNodes.length]={text:h},h=""):_.measureText(h+" "+(c[f+1]||"")).width>l&&(i.childNodes[i.childNodes.length]={text:h},h="")):(h+=(h&&y?" ":"")+c[f],p=_.measureText(h).width,p>=l?(i.childNodes[i.childNodes.length]={text:h},h=""):((y||a&&"wrap"===a.wrapping)&&(g=h,f<c.length-1&&(c[f+1].indexOf("-")>=0&&y?(h=this._splitHyphenWord(h,c[f+1],i,a,_,l),_.measureText(h+" "+(c[f+1]||"")).width>l&&(i.childNodes[i.childNodes.length]={text:h},h=""),f++):(g+=(y?" ":"")+(c[f+1]||""),_.measureText(g).width>l&&(i.childNodes[i.childNodes.length]={text:h},h="")))),f==c.length-1&&(i.childNodes[i.childNodes.length]={text:h},h="")));else h+=v[b],i.childNodes[i.childNodes.length]={text:h};return this._wrapTextAlign(i,i.childNodes,a.fontSize*n._scaleY,a.textAlign,_,e,a,n)},_splitHyphenWord:function(e,t,i,a,n,o){for(var s,r="wrapwithoverflow"==a.wrapping,l=e?e+" ":"",d=t.split("-"),h=0;h<d.length;h++)l+=d[h],s=n.measureText(l).width,s>=o?(i.childNodes[i.childNodes.length]={text:e},l=h<d.length-1?d[h]+"-":d[h],e=l):(r||a&&"wrap"===a.wrapping)&&(e=l,h<d.length-1&&(l+="-",n.measureText(l).width>o?(i.childNodes[i.childNodes.length]={text:e},l="-"):e=l));return e},_wrapTextAlign:function(e,i,a,n,o,s,r,l){var d,h,c,u,g=t.datavisualization.Diagram.Util.bounds(s);for(g.width*=l._scaleX,g.height*=l._scaleY,g.x*=l._scaleX,g.y*=l._scaleY,c=0;c<i.length;c++){if(u=o.measureText(i[c].text).width,d=u,"stretch"==r.horizontalAlignment)d=g.width,u=-d/2;else switch(n){case"left":u=0;break;case"center":u=-u/2;break;case"right":u=-u;break;case"justify":u=i.length>1?0:-u/2}i[c].x=Number(u),i[c].dy=a,h?(h.x=Math.min(h.x,u),h.width=Math.max(h.width,d)):h={x:u,width:d}}return h},_renderTextDecoration:function(e,t,i,a,n){var o,s,r=n.document.getContext("2d");switch(r.save(),r.strokeStyle=a.fontColor,r.lineWidth=1,r.textAlign){case"center":e-=i/2;break;case"right":e-=i}switch(t+=2,a.textDecoration){case"overline":t-=a.fontSize*n._scaleY;break;case"line-through":t-=a.fontSize/2*n._scaleY}o={x:e,y:t},s={x:e+i,y:t},n.line(o,s,null),r.restore()},_renderGradient:function(e,t,i,a){var n,o,s,r,l,d;if(e.gradient){for(r=0;r<e.gradient.stops.length;r++)n=n?Math.max(n,e.gradient.stops[r].offset):e.gradient.stops[r].offset,o=o?Math.min(o,e.gradient.stops[r].offset):e.gradient.stops[r].offset;if("linear"==e.gradient.type)for(s=t.createLinearGradient(i+e.gradient.x1,a+e.gradient.y1,i+e.gradient.x2,a+e.gradient.y2),r=0;r<e.gradient.stops.length;r++)l=e.gradient.stops[r],d=0>o?(n+l.offset)/(2*n):l.offset/n,s.addColorStop(d,l.color);else if("radial"==e.gradient.type)for(s=t.createRadialGradient(i+e.gradient.fx,a+e.gradient.fy,0,i+e.gradient.cx,a+e.gradient.cy,e.gradient.r),r=0;r<e.gradient.stops.length;r++)l=e.gradient.stops[r],d=0>o?(n+l.offset)/(2*n):l.offset/n,s.addColorStop(d,l.color);t.fillStyle=s}},_renderDecorators:function(e,i){var a,n,o,s,r,l=i._diagram;e.targetDecorator&&e.targetDecorator.shape&&(s=e.segments[e.segments.length-1],a=s.points[s.points.length-2],n=e.targetPoint,"bezier"==s.type&&(a=s._point2),e.targetNode&&l&&(o=l._findNode(e.targetNode),o&&"none"!=o.borderColor&&(n=t.datavisualization.Diagram.Util._adjustPoint(n,a,!0,o.borderWidth/2))),this._renderDecorator(e.name+"_targetDecorator",n,a,e.targetDecorator,i)),e.sourceDecorator&&e.sourceDecorator.shape&&(s=e.segments[0],a=e.sourcePoint,n=s.points[1],"bezier"==s.type&&(n=s._point1),e.sourceNode&&l&&(r=l._findNode(e.sourceNode),r&&"none"!=r.borderColor&&(a=t.datavisualization.Diagram.Util._adjustPoint(a,n,!0,r.borderWidth/2))),this._renderDecorator(e.name+"_sourceDecorator",a,n,e.sourceDecorator,i))},_renderDecorator:function(e,i,a,n,o){var s,r,l,d,h,c=this._scalePointforStretch(i,o),u=this._scalePointforStretch(a,o),g=new t.datavisualization.Diagram.Size(Number(n.width*o._scaleY),Number(n.height*o._scaleY)),m=o.document.getContext("2d");switch(m.fillStyle=n.fillColor,m.strokeStyle="none"==n.borderColor?"transparent":n.borderColor,m.lineWidth=n.borderWidth,r=t.datavisualization.Diagram.Geometry.findAngle(c,u),l={angle:r,x:c.x,y:c.y},n.shape){case"arrow":o.arrow(c,l,g);break;case"openarrow":o.arrow(c,l,g,!0);break;case"circle":d=g.width/2,h=g.height/2,o.ellipse(c.x+g.width/2,c.y,d,h,l);break;case"diamond":o.diamond(c,l,g);break;case"path":o.path(n._absolutePath,0,0,g.width,g.height,l)}return s},_updatePolygonPoints:function(e,i){var a,n,o,s,r,l,d=[];if(e.points){for(a=e.width||e._width||0,n=e.height||e._height||0,a*=i._scaleX,n*=i._scaleY,s=0;s<e.points.length;s++)o=e.points[s],d.push({x:o.x,y:o.y});if(d.length){this._scalePoints(d,e,i);var h=t.datavisualization.Diagram.Geometry.rect(d),c=e.offsetX*i._scaleX-a*e.pivot.x-h.x,u=e.offsetY*i._scaleY-n*e.pivot.y-h.y;for(s=0,r=d.length;r>s;++s)l=t.datavisualization.Diagram.Geometry.translate(d[s],c,u),d[s]=l}}return d},_scalePoints:function(e,i,a){var n,o,s,r,l,d,h=t.datavisualization.Diagram.Geometry.rect(e);if(h.width>0&&h.height>0)for(n=i.width||i._width||0,o=i.height||i._height||0,n*=a._scaleX,o*=a._scaleY,s=n/h.width,r=o/h.height,l=0,d=e.length;d>l;++l)e[l].x=e[l].x*s,e[l].y=e[l].y*r},updateNode:function(e,t){this.refreshCanvas(e,t)},updateConnector:function(e,t){this.refreshCanvas(e,t)},updateGroup:function(e,t){this.refreshCanvas(e,t)},refreshCanvas:function(e,t){var i,a,n=t.document.getContext("2d");for(n.save(),view.scale&&n.scale(1/view.scale.x,1/view.scale.y),i={x:t.document.offsetLeft,y:t.document.offsetTop,width:t.document.offsetWidth,height:t.document.offsetHeight},n.clearRect(i.x,i.y,i.width,i.height),view.scale&&n.scale(view.scale.x,view.scale.y),n.restore(),a=0;a<e.nodes.length;a++)"node"===e.nodes[a]._type?this.renderNode(e.nodes[a],t):"group"===e.nodes[a]._type&&this.renderGroup(e.nodes[a],t);for(a=0;a<e.connectors.length;a++)this.renderConnector(e.connectors[a],t)},updateViewport:function(){},addNodeLabel:function(e,t){this.refreshCanvas(e,t)},updateLabel:function(e,t){this.refreshCanvas(e,t)},setNodeShape:function(e,t){this.refreshCanvas(e,t)},setLine:function(e,t){this.refreshCanvas(e,t)},renderDecorators:function(e,t){this.refreshCanvas(e,t)},clearDecorators:function(e,t){this.refreshCanvas(e,t)},updateTargetDecoratorStyle:function(e,t){this.refreshCanvas(e,t)},updateSourceDecoratorStyle:function(e,t){this.refreshCanvas(e,t)},_updateNodeStyle:function(e,t){this.refreshCanvas(e,t)},updateLabelStyle:function(e,t){this.refreshCanvas(e,t)},updateConnectorStyle:function(e,t){this.refreshCanvas(e,t)},updateTextBlock:function(e,t,i){this.refreshCanvas(e,i)},removeChild:function(){this.refreshCanvas(model,canvas)}}}(jQuery,Syncfusion)}),watermark({watermark_txt:decodeURI("%E5%8C%97%E4%BA%AC%E4%B8%8A%E5%8C%97%E6%99%BA%E4%BF%A1%E7%A7%91%E6%8A%80%E6%9C%89%E9%99%90%E5%85%AC%E5%8F%B8")});var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},powerbi;!function(e){var t;!function(t){var i;!function(t){var i;!function(t){"use strict";var i=e.extensibility.utils.dataview.DataViewObjectsParser,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dataPoint=new n,t.nodes=new o,t.labels=new s,t.layout=new r,t.connectors=new l,t}return __extends(t,e),t}(i);t.VisualSettings=a;var n=function(){function e(){this.defaultColor="",this.showAllDataPoints=!0,this.fill="",this.fillRule="",this.fontSize=12}return e}();t.dataPointSettings=n;var o=function(){function e(){this.level=2,this.height=50,this.width=120,this.horizontalSpacing=30,this.verticalSpacing=30,this.fillColor="white",this.borderColor="black",this.shape="Rectangle"}return e}();t.nodesSettings=o;var s=function(){function e(){this.leftSpacing=0,this.spacing=18,this.fontSize=18,this.fontFamily="Arial",this.fontColor="black",this.scale="stretch"}return e}();t.labelsSettings=s;var r=function(){function e(){this.type="hierarchicaltree",this.orientation="TopToBottom"}return e}();t.layoutSettings=r;var l=function(){function e(){this.color="black",this.cornerRadius=0,this.shape="none"}return e}();t.connectorsSettings=l}(i=t.swOrgChart2A3BCE7191B5491FBB82F771A169702D||(t.swOrgChart2A3BCE7191B5491FBB82F771A169702D={}))}(i=t.visual||(t.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(powerbi){var extensibility;!function(extensibility){var visual;!function(visual){var swOrgChart2A3BCE7191B5491FBB82F771A169702D;!function(swOrgChart2A3BCE7191B5491FBB82F771A169702D){"use strict";var Visual=function(){function Visual(e){console.log("Visual constructor",e),this.host=e.host,this.target=e.element,this.updateCount=0;this.target.parentNode.className=this.target.parentNode.className+" "+this.target.className}return Visual.prototype.nodeTemplate=function(e,t,i,a,n){return function(o,s){s.level==n&&(s.isExpanded=!1),s.source=s[t[0]]?s[t[0]]:"",s.fillColor=s[i[0]]?s[i[0]]:a;for(var r in e)e.hasOwnProperty(r)&&(s.labels[r].text=s[e[r]])}},Visual.prototype.addLevel=function(e,t,i){var a=0,n=e.length;for(a=0;n>a;a++){var o=e[a][t],s=this.getLevel(e,o,t,i);e[a].level=s}return e},Visual.prototype.getLevel=function(e,t,i,a){for(var n=0,o=e;n<o.length;n++){var s=o[n],r=0==s[a]?""+s[a]:s[a];if(s[i]==t)return r?1+this.getLevel(e,s[a],i,a):1}return 1},Visual.prototype.update=function(options){var _this=this;if(options.type!=powerbi.VisualUpdateType.Resize&&options.type!=powerbi.VisualUpdateType.ResizeEnd&&36!=options.type){this.settings=Visual.parseSettings(options&&options.dataViews&&options.dataViews[0]);var orientation=eval("ej.datavisualization.Diagram.LayoutOrientations."+this.settings.layout.orientation),type=this.settings.layout.type,height=this.settings.nodes.height,width=this.settings.nodes.width,horizontalSpacing=this.settings.nodes.horizontalSpacing,verticalSpacing=this.settings.nodes.verticalSpacing,fillColor=this.settings.nodes.fillColor,borderColor=this.settings.nodes.borderColor,basicShapes=eval("ej.datavisualization.Diagram.BasicShapes."+this.settings.nodes.shape),level=this.settings.nodes.level<=0?1:this.settings.nodes.level,leftSpacing=this.settings.labels.leftSpacing,labelsSpacing=this.settings.labels.spacing,fontSize=this.settings.labels.fontSize,fontFamily=this.settings.labels.fontFamily,fontColor=this.settings.labels.fontColor,scale=this.settings.labels.scale,connectorColor=this.settings.connectors.color,connectorShape=this.settings.connectors.shape,connectorcornerRadius=this.settings.connectors.cornerRadius;console.log("Visual update",options),"undefined"!=typeof this.textNode&&(this.textNode.textContent=(this.updateCount++).toString());var values=options.dataViews[0].categorical.categories,datas=[],arrLabel=[],arrObjLabels=[],arrColor=[],arrLink=[],arrImage=[],obj={},id=null,parentId=null,toolTip=[],ind=null;for(var i in values){var arrValue=values[i].values,roles=values[i].source.roles;for(var j in arrValue){var name_1=values[i].source.displayName,value=values[i].values[j];for(var key in roles)roles.hasOwnProperty(key)&&("0"==i&&datas.push({}),"id"==key&&(id=name_1),"parentId"==key&&(parentId=name_1),"toolTip"==key&&(name_1="toolTip"+name_1,null==value&&(value="NA")),datas[j][name_1]=value)}}for(var key in datas)if(datas.hasOwnProperty(key)){var value=datas[key][id];null!=value&&""!=value||0==value||datas.splice(parseInt(key),1)}for(var key in values)if(values.hasOwnProperty(key)){var name_2=values[key].source.displayName,roles=values[key].source.roles;for(var key_1 in roles)roles.hasOwnProperty(key_1)&&("label"==key_1?arrLabel.push(name_2):"color"==key_1?arrColor.push(name_2):"image"==key_1?arrImage.push(name_2):"link"==key_1?arrLink.push(name_2):"toolTip"==key_1&&toolTip.push("toolTip"+name_2))}var data=this.addLevel(datas,id,parentId),isImage=arrImage.length>0,spacing=10;for(var key in arrLabel)"0"!=key&&(spacing=labelsSpacing+spacing),1==arrLabel.length?(obj.name="label"+key,obj.fontSize=fontSize,obj.fontFamily=fontFamily,obj.fontColor=fontColor,obj.margin={left:leftSpacing},obj.textOverflow=!0):arrLabel.hasOwnProperty(key)&&(obj.name="label"+key,obj.horizontalAlignment="left",obj.verticalAlignment="top",obj.fontSize=fontSize,obj.fontFamily=fontFamily,obj.fontColor=fontColor,obj.offset={x:0,y:0},obj.margin={left:leftSpacing,top:spacing},obj.textOverflow=!0),arrObjLabels.push(obj),obj={};for(var content='<div id="diagram"></div><script type="text/x-jsrender" id="mouseovertoolTipId"> <div style="background-color: #272727; color: #FFFFFF; border-width:1px;border-style: solid;border-color: #d3d3d3;white-space: nowrap;"> ',i=0;i<toolTip.length;i++)content+="<span >"+toolTip[i].substring(7)+' : </span> <span style="margin: 10px;">{{:'+toolTip[i]+":}}</span> </br>";content+="</div></script>",this.target.innerHTML=content;var links=arrLink[0],node={constraints:ej.datavisualization.Diagram.NodeConstraints.InheritTooltip|ej.datavisualization.Diagram.NodeConstraints.PointerEvents,width:width,height:height,borderColor:borderColor,labels:arrObjLabels,shape:basicShapes,collapseIcon:{shape:"plus",width:10,height:10},expandIcon:{shape:"minus",width:10,height:10},type:isImage?"image":"",scale:scale,fillColor:fillColor,isExpanded:!0};$("#diagram").ejDiagram({width:"100%",height:"100%",tool:ej.datavisualization.Diagram.Tool.None,layout:{type:type,horizontalSpacing:horizontalSpacing,verticalSpacing:verticalSpacing,orientation:orientation},defaultSettings:{node:node,connector:{segments:[{type:"orthogonal"}],targetDecorator:{width:5,height:5,shape:connectorShape,fillColor:connectorColor,borderColor:connectorColor},lineColor:connectorColor,cornerRadius:connectorcornerRadius}},tooltip:{templateId:"mouseovertoolTipId",alignment:{horizontal:"center",vertical:"bottom"}},selectedItems:{constraints:~ej.datavisualization.Diagram.SelectorConstraints.Rotator},nodeTemplate:this.nodeTemplate(arrLabel,arrImage,arrColor,fillColor,level),dataSourceSettings:{id:id,parent:parentId,dataSource:data},pageSettings:{pageWidth:"100%",pageHeight:"100%",scrollLimit:"diagram"},snapSettings:{snapConstraints:ej.datavisualization.Diagram.SnapConstraints.None},click:function(e){if(e.actualObject){var t=e.actualObject[links];t&&_this.host.launchUrl(t)}}}),$(".mainview_svg").css("background-color","transparent"),$(".e-scrollbar").css("background-color","transparent")}},Visual.parseSettings=function(e){return swOrgChart2A3BCE7191B5491FBB82F771A169702D.VisualSettings.parse(e)},Visual.prototype.enumerateObjectInstances=function(e){return swOrgChart2A3BCE7191B5491FBB82F771A169702D.VisualSettings.enumerateObjectInstances(this.settings||swOrgChart2A3BCE7191B5491FBB82F771A169702D.VisualSettings.getDefault(),e)},Visual}();swOrgChart2A3BCE7191B5491FBB82F771A169702D.Visual=Visual}(swOrgChart2A3BCE7191B5491FBB82F771A169702D=visual.swOrgChart2A3BCE7191B5491FBB82F771A169702D||(visual.swOrgChart2A3BCE7191B5491FBB82F771A169702D={}))}(visual=extensibility.visual||(extensibility.visual={}))}(extensibility=powerbi.extensibility||(powerbi.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i;!function(t){t.swOrgChart2A3BCE7191B5491FBB82F771A169702D={name:"swOrgChart2A3BCE7191B5491FBB82F771A169702D",displayName:"swOrgChart","class":"Visual",version:"1.1.0",apiVersion:"1.10.0",create:function(t){return new e.extensibility.visual.swOrgChart2A3BCE7191B5491FBB82F771A169702D.Visual(t)},custom:!0}}(i=t.plugins||(t.plugins={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));